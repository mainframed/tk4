//HERC01P JOB MSGCLASS=A,MSGLEVEL=(1,1)                                 00010000
// EXEC PGM=IEFBR14                                                     00020000
//DD1 DD DSN=HERC01.MAPDISK.ASM,DISP=(MOD,DELETE),                      00030000
//       UNIT=DISK,VOL=SER=PUB001,SPACE=(TRK,(20,20,20)),               00040000
//       DCB=(RECFM=FB,LRECL=80,BLKSIZE=3120)                           00050000
//*                                                                     00060000
// EXEC PGM=IEBUPDTE,PARM=NEW                                           00070000
//SYSPRINT DD SYSOUT=*                                                  00080000
//SYSUT2 DD DSN=HERC01.MAPDISK.ASM,DISP=(NEW,CATLG),                    00090000
//       UNIT=DISK,VOL=SER=PUB001,SPACE=(TRK,(20,20,20)),               00100000
//       DCB=(RECFM=FB,LRECL=80,BLKSIZE=3120)                           00110000
//SYSIN  DD *,DCB=BLKSIZE=3200                                          00120000
./ ADD NAME=MAPDISK                                                     00130000
MAPDISK  TITLE 'M A P D I S K  ***  DASD MAPPING PROGRAM'               00140000
         MACRO                                                          00150000
         TSGINNRA  &P                                                   00160000
.*                                                                      00170000
.*       PDSDOC *PREFORMATTING MACRO...............(GUIDE UK M56042AS)* 00180000
.*                                                                      00190000
         GBLC  &GSS(5)                                                  00200000
         LCLA  &A                                                       00210000
         AIF   ('&P'(K'&P,1) EQ ')').C1                                 00220000
&GSS(2)  SETC  '+'                                                      00230000
&GSS(4)  SETC  ''                                                       00240000
&GSS(5)  SETC  ''                                                       00250000
.C4      AIF   (&A GE K'&P).C2                                          00260000
&A       SETA  &A+1                                                     00270000
         AIF   ('&P'(&A,1) EQ '+').C3                                   00280000
         AGO   .C4                                                      00290000
.C2      ANOP                                                           00300000
&GSS(1)  SETC  '&P'                                                     00310000
&GSS(3)  SETC  '0'                                                      00320000
         MEXIT                                                          00330000
.C3      ANOP                                                           00340000
&GSS(1)  SETC  '&P'(1,&A-1)                                             00350000
&GSS(3)  SETC  '&P'(&A+1,K'&P-&A)                                       00360000
         MEXIT                                                          00370000
.C1      ANOP                                                           00380000
&GSS(1)  SETC  ''                                                       00390000
&GSS(2)  SETC  ''                                                       00400000
&GSS(3)  SETC  '0'                                                      00410000
.C6      ANOP                                                           00420000
&A       SETA  &A+1                                                     00430000
         AIF   ('&P'(&A,1) EQ '(').C5                                   00440000
         AGO   .C6                                                      00450000
.C5      AIF   (&A EQ 1).C7                                             00460000
&GSS(3)  SETC  '&P'(1,&A-1)                                             00470000
.C7      ANOP                                                           00480000
&GSS(4)  SETC  ','                                                      00490000
&GSS(5)  SETC  '&P'(&A+1,K'&P-&A-1)                                     00500000
         MEND                                                           00510000
         MACRO                                                          00520000
&SEGNAME RIN   &REGS,&LINK=R4                                           00530000
.*********************************************************************  00540000
.*       PDSDOC *RE-ENTRANT SUBROUTINE ENTRY MACRO....................* 00550000
.*                                                                      00560000
.*       THIS MACRO CAN BE USED TO CONTROL THE LINKAGE BETWEEN          00570000
.*       SUBROUTINES AND EFFECT THE SAVING AND RESTORING OF             00580000
.*       LINK REGISTERS AND PARAMETER REGISTERS. A TYPICAL SEQUENCE     00590000
.*       MIGHT BE:                                                      00600000
.*                                                                      00610000
.* DOWORK RIN   (R6,R7,R8) ENTER ROUTINE AND SAVE REGS 6,7,8            00620000
.*        ----                                                          00630000
.*        ----                                                          00640000
.*        ----                                                          00650000
.*        ----                                                          00660000
.*        CODEOUT                RESTORE REGS 6,7,8 AND RETURN          00670000
.*                                                                      00680000
.*       THE LINK REGISTER IS ASSUMED TO BE REGISTER 4 BUT OPERAND      00690000
.*       'LINK=' CAN BE USED TO VARY THIS AT WILL.                      00700000
.*                                                                      00710000
.*       THE MACRO ASSUMES THAT AN AREA EXISTS IN THE PROGRAM CALLED    00720000
.*       'SGBXSAVE' AND WILL SAVE REGISTERS IN SUCCESSIVE FULLWORD      00730000
.*       LOCATIONS IN THAT AREA. IN ORDER TO GENERATE AN AREA OF THE    00740000
.*       CORRECT SIZE, THE MACRO CAN BE CODED WITH THE SINGLE           00750000
.*       OPERAND - 'GENERATE'.                                          00760000
.*                                                                      00770000
.*       THIS MACRO WAS DEVELOPED OUT OF 'SEGIN', SO SHARES MANY GLOBAL 00780000
.*       VARIABLES WITH THAT MACRO. THESE TWO MACROS MAY THEREFORE BE   00790000
.*       INTERMIXED WITHIN ONE PROGRAM.                                 00800000
.*                                                                      00810000
.*       01APR92 CART1 COPIED 'SEGIN', CHANGED TO MY REG. CONVENTIONS   00820000
.*                                                                      00830000
.*********************************************************************  00840000
.*                                                                      00850000
.*                                                                      00860000
.*                                                                      00870000
         GBLA  &SEGBCTR            COUNTER OF FULLWORDS USED            00880000
         LCLC  &WORKC              USED TO TIDY UP NAME FIELDS          00890000
         LCLA  &INDX               WORK INDEX                           00900000
         GBLC  &SGBARR1(200)       HOLD SAVE REG DETAILS ACROSS SEGMNT  00910000
         GBLC  &SGBARR2(200)       HOLD SAVE REG DETAILS ACROSS SEGMNT  00920000
         GBLA  &SGBINDX            INDEX FOR THE ARRAY                  00930000
.*********************************************************************  00940000
.*       TEST FOR 'GENERATE' TYPE ENTRY                                 00950000
.*********************************************************************  00960000
         AIF   ('&REGS' EQ 'GENERATE').GENER GENERATE WORK AREA         00970000
.*********************************************************************  00980000
.*       INITIALISE INDEX DATA ETC.                                     00990000
.*********************************************************************  01000000
&SGBINDX SETA  1                   INITIALISE THE ARRAY INDEX           01010000
&SEGNAME DS    0H                  SEGMENT ENTRY POINT                  01020000
.*********************************************************************  01030000
.*       SAVE THE LINK REGISTER                                         01040000
.*********************************************************************  01050000
&WORKC   SETC  'SGBXSAVE'.'+&SEGBCTR' GENERATE NEXT SAVE AREA NAME      01060000
&SEGBCTR SETA  &SEGBCTR+4          INCREMENT THE SAVE AREA CTR          01070000
&SGBARR1(&SGBINDX) SETC '&WORKC'   SAVE NAME OF AREA                    01080000
&SGBARR2(&SGBINDX) SETC '&LINK'    SAVE REGISTER ID                     01090000
&SGBINDX SETA  &SGBINDX+1          INCREMENT GLOBAL INDEX               01100000
         ST    &LINK,&WORKC        SAVE LINK REGISTER                   01110000
.*********************************************************************  01120000
.*       SAVE REGISTERS AS REQUIRED                                     01130000
.*********************************************************************  01140000
         AIF   (T'&REGS EQ 'O').MEND1 EXIT IF NO REGS 2B SAVED          01150000
&INDX    SETA  1                   INITIALISE LOOP COUNTER              01160000
.LOOP1   ANOP                      LOOP FOR REGISTERS TO BE SAVED       01170000
&WORKC   SETC  'SGBXSAVE'.'+&SEGBCTR' GENERATE THE NEXT SLOT NAME       01180000
&SEGBCTR SETA  &SEGBCTR+4            GENERATE OFFS NEXT SAVE AREA       01190000
&SGBARR1(&SGBINDX) SETC '&WORKC'   SAVE NAME OF AREA                    01200000
&SGBARR2(&SGBINDX) SETC '&REGS(&INDX)' SAVE REGISTER ID                 01210000
&SGBINDX SETA  &SGBINDX+1          INCREMENT GLOBAL INDEX               01220000
         ST    &REGS(&INDX),&WORKC SAVE REGISTER.                       01230000
&INDX    SETA  &INDX+1             INCREMENT LOOP COUNTER               01240000
         AIF   (&INDX LE N'&REGS).LOOP1 PROCESS ALL SPECIFIED OPERANDS  01250000
.*********************************************************************  01260000
.*       EXIT FROM THIS MACRO                                           01270000
.*********************************************************************  01280000
.MEND1  MEXIT                                                           01290000
.*********************************************************************  01300000
.*      GERNERATE WORK AREA ENTRIES FOR THE REQUIRED SAVE AREAS         01310000
.*********************************************************************  01320000
.GENER   ANOP                                                           01330000
SGBXSAVE DS    0F                  RIN SAVE AREAS                       01340000
         DS    &SEGBCTR.X          STORAGE FOR SAVE AREAS               01350000
         MEND                                                           01360000
         MACRO                                                          01370000
&NAME    ROUT                                                           01380000
.*********************************************************************  01390000
.*       PDSDOC *RE-ENTRANT SUB-ROUTINE EXIT MACRO....................* 01400000
.*                                                                      01410000
.*       THIS IS THE PARTNER MACRO TO 'RIN' AND WILL RESTORE ALL        01420000
.*       SAVED REGISTERS AND THEN RETURN CONTROL TO THE LINK REGISTER   01430000
.*       DEFINED IN THE RIN MACRO. (SEE COMMENTS AN 'RIN' MACRO         01440000
.*       FOR MORE DETAILS.                                              01450000
.*                                                                      01460000
.*********************************************************************  01470000
.*                                                                      01480000
.* 01APR92 CART1 COPIED 'SEGOUT'                                        01490000
.*                                                                      01500000
.*********************************************************************  01510000
.*      VARIABLE DEINITION AREA                                         01520000
.*********************************************************************  01530000
         GBLA  &SEGBCTR            COUNTER OF FULLWORDS USED            01540000
         LCLC  &WORKC              USED TO TIDY UP NAME FIELDS          01550000
         LCLC  &WORKD              GENERAL WORK AREA                    01560000
         LCLA  &INDX               WORK INDEX                           01570000
         GBLC  &SGBARR1(200)       HOLD SAVE REG DETAILS ACROSS SEGMNT  01580000
         GBLC  &SGBARR2(200)       HOLD SAVE REG DETAILS ACROSS SEGMNT  01590000
         GBLA  &SGBINDX            INDEX FOR THE ARRAY                  01600000
.*********************************************************************  01610000
.*       DEFINE A LABEL IF HE WANTS ONE                                 01620000
.*********************************************************************  01630000
         AIF   (T'&NAME EQ 'O').NONAME                                  01640000
&NAME    EQU   *                   EXIT POINT THIS SEGMENT              01650000
.NONAME  ANOP                                                           01660000
.*********************************************************************  01670000
.*       RESTORE REGISTERS                                              01680000
.*********************************************************************  01690000
&INDX    SETA  1                   INITIALISE LOOP COUNTER              01700000
.LOOP1   ANOP                      LOOP FOR REGISTERS TO BE SAVED       01710000
&WORKC   SETC  '&SGBARR1(&INDX)'   GENERATE THE NEXT SLOT NAME          01720000
&WORKD   SETC  '&SGBARR2(&INDX)'   GENERATE THE REGISTER NAME           01730000
         L     &WORKD,&WORKC       RESTORE REGISTER                     01740000
&INDX    SETA  &INDX+1             INCREMENT LOOP COUNTER               01750000
         AIF   (&INDX LT &SGBINDX).LOOP1 PROCESS ALL SPECIFIED OPERANDS 01760000
.*********************************************************************  01770000
.*       GENERATE THE RETURN LINKAGE                                    01780000
.*********************************************************************  01790000
&WORKD   SETC  '&SGBARR2(1)'       GET LINK REGISTER NAME               01800000
         BR    &WORKD              RETURN TO CALLER                     01810000
         MEND                                                           01820000
         MACRO                                                          01830000
&NAME    DATE  &TO,&FORMAT='YYDDD',&PREFORM=NO,&FROM='S'                01840000
         GBLC  &GSS(5)                                                  01850000
         LCLA  &A(6),&A1,&A2,&A3,&A4,&A5,&A6                            01860000
         LCLB  &B1,&B2                                                  01870000
         LCLC  &GNAME,&C1,&C2,&C3,&C4                                   01880000
.*                                                                      01890000
.*                                                                      01900000
.*       PDSDOC *MACRO TO REFORMAT DATE TO DDMMMYY (GUIDE UK M56005AS)* 01910000
.*                                                                      01920000
.*                                                                      01930000
.*  THE DATE MACRO-INSTRUCTION ENABLES THE PROGRAMMER TO EDIT A PACKED  01940000
.* DECIMAL DATE IN THE FORM 'YYDDD+' TO HIS OWN SPECIFICATIONS.         01950000
.*                                                                      01960000
.*  THE PARAMETERS ARE GIVEN AS FOLLOWS  :                              01970000
.*                                                                      01980000
.*  TO         THE ADDRESS OF THE FIRST BYTE OF THE AREA THAT IS TO     01990000
.*             CONTAIN THE EDITED DATE.                                 02000000
.*                                                                      02010000
.*  FORMAT     SPECIFIES A CHARACTER STRING WHICH IS SCANNED BY THE     02020000
.*             MACRO-INSTRUCTION FOR THE FOLLOWING IDENTIFIERS WHICH    02030000
.*             ARE REPLACED AS SHEWN  :                                 02040000
.*                                                                      02050000
.*             YYDDD               YEAR NUMBER AND DAY NUMBER.          02060000
.*             MMM                 MONTH IN CHARACTER FORM (JAN-DEC).   02070000
.*             DDD                 DAY NUMBER.                          02080000
.*             YY                  YEAR NUMBER.                         02090000
.*             MM                  MONTH NUMBER (01=JAN  12=DEC)        02100000
.*             DD                  DAY OF THE MONTH.                    02110000
.*                                                                      02120000
.*             IF THIS PARAMETER IS OMITTED 'YYDDD' IS ASSUMED.         02130000
.*       THE REMAINDER OF THE LIST IS TREATED AS SPECIFIED IN THE       02140000
.* 'PREFORM' PARAMETER. NOTE THAT THE 'FORMAT' PARAMETER MUST ALWAYS    02150000
.* BE ENCLOSED WITHIN QUOTES.                                           02160000
.*                                                                      02170000
.*  PREFORM    SPECIFIES THE TREATMENT OF THE PARTS OF THE FORMAT LIST  02180000
.*             THAT ARE NOT IDENTIFIERS.                                02190000
.*             'PREFORM=NO' SPECIFIES THAT NON-IDENTIFIER PARTS OF THE  02200000
.*             FORMAT LIST ARE TO BE STORED IN THE TO-AREA AS LITERALS. 02210000
.*             'PREFORM=YES' SPECIFIES THAT NON-IDENTIFIER PARTS OF THE 02220000
.*             FORMAT LIST ARE TO BE IGNORED.                           02230000
.*             IF THIS PARAMETER IS OMITTED 'NO' IS ASSUMED.            02240000
.*                                                                      02250000
.*  FROM       SPECIFIES THE ADDRESS OF A 3 BYTE PACKED DECIMAL FIELD   02260000
.*             CONTAINING THE DATE THAT IS TO BE EDITED OR 'S' WHICH    02270000
.*             SPECIFIES THAT THE CURRENT MACHINE DATE IS TO BE USED.   02280000
.*             IF THIS PARAMETER IS OMITTED 'S' IS ASSUMED.             02290000
.*                                                                      02300000
.*                                                                      02310000
&NAME    DS    0H                  FORCE ALIGNMENT.                     02320000
&GNAME   SETC  'IHB'.'&SYSNDX'                                          02330000
         AIF   ('&TO' EQ '').E1                                         02340000
         TSGINNRA  &TO                                                  02350000
         AIF   ('&GSS(5)' EQ '').C1                                     02360000
&C1      SETC  '('                                                      02370000
&C2      SETC  ')'                                                      02380000
&C3      SETC  ','                                                      02390000
.C1      ANOP                                                           02400000
&A(1)    SETA  0                                                        02410000
&A(2)    SETA  0                   MMM POINTER                          02420000
&A(3)    SETA  0                   DDD POINTER                          02430000
&A(4)    SETA  0                   YY POINTER.                          02440000
&A(5)    SETA  0                   MM POINTER.                          02450000
&A(6)    SETA  0                   DD POINTER.                          02460000
&A1      SETA  2                   START OF FIELD.                      02470000
&A2      SETA  2                   START OF CHARACTER FIELD.            02480000
&A3      SETA  0                   LITERAL COUNT.                       02490000
&A4      SETA  K'&FORMAT-1         END COUNT INDICATOR.                 02500000
.C2      AIF   (&A1+1 GT &A4).C3   NO SPACE FOR YY/MM/DD.               02510000
         AIF   (&A1+2 GT &A4).C4   NO SPACE FOR MMM/DDD.                02520000
         AIF   (&A1+4 GT &A4).C5   NO SPACE FOR YYDDD.                  02530000
&A5      SETA  1                   FIELD TYPE INDICATOR.                02540000
&A6      SETA  5                   SET COUNT FOR INCREMENT.             02550000
         AIF   ('&FORMAT'(&A1,5) EQ 'YYDDD').C6                         02560000
.C5      ANOP                                                           02570000
&A5      SETA  2                   FIELD TYPE INDICATOR.                02580000
&A6      SETA  3                   SET COUNT FOR INCREMENT.             02590000
         AIF   ('&FORMAT'(&A1,3) EQ 'MMM').C6                           02600000
&A5      SETA  3                   FIELD TYPE INDICATOR.                02610000
         AIF   ('&FORMAT'(&A1,3) EQ 'DDD').C6                           02620000
.C4      ANOP                                                           02630000
&A5      SETA  4                   FIELD TYPE INDICATOR.                02640000
&A6      SETA  2                   SET COUNT FOR INCREMENT,             02650000
.C7      AIF   ('&FORMAT'(&A1,2) EQ 'YYMMDD'((&A5-4)*2+1,2)).C6         02660000
&A5      SETA  &A5+1               INCREMENT FIELD TYPE INDICATOR.      02670000
         AIF   (&A5 LT 7).C7       LOOP UNTIL FOUND OR EXHAUSTED.       02680000
.C8      ANOP                                                           02690000
&A1      SETA  &A1+1               INCREMENT FIELD COUNT.               02700000
         AGO .C2                                                        02710000
.C6      AIF   (&A(&A5) NE 0).C8   IS ALREADY FOUND.                    02720000
&A(&A5)  SETA  &A1-1               SET OFFSET ADDRESS.                  02730000
.C13     ANOP                                                           02740000
&A5      SETA  &A1-&A2             LENGTH OF REQUIRED LITERAL.          02750000
&A1      SETA  &A1+&A6             START OF NEXT AREA.                  02760000
&A6      SETA  &A2-2               OFFSET IN TARGET AREA.               02770000
         AIF   (&A5 EQ 0 OR '&PREFORM' EQ 'YES').C9                     02780000
         AIF   (&A5 EQ 1).C10      MVI REQUIRED.                        02790000
&B2      SETB  1                   LITERALS PRESENT.                    02800000
         AIF   (&B1).C11           SECOND ENTRY.                        02810000
         MVC   &GSS(1)&GSS(2)&GSS(3)+&A6.(&A5&GSS(4)&GSS(5)),&GNAME.A+&*02820000
               A3                  MOVE LITERAL.                        02830000
&A3      SETA  &A3+&A5             UPDATE LITERAL COUNT.                02840000
.C9      AIF   (&A1 GT &A4).CX     END OF SCAN.                         02850000
&A2      SETA  &A1                 RESTORE START OF CHARACTER FIELD.    02860000
         AGO   .C2                                                      02870000
.C10     AIF   (&B1).C9                                                 02880000
&C4      SETC  '&FORMAT'(&A2,1)                                         02890000
         MVI   &GSS(1)&GSS(2)&GSS(3)+&A6&C1&GSS(5)&C2,C'&C4' LITERAL    02900000
         AGO   .C9                                                      02910000
.C11     AIF   (&A3 NE 0).C12      NOT FIRST TIME.                      02920000
&GNAME.A DS    0C                  ORIGIN OF LITERALS.                  02930000
.C12     AIF   (&A5 LE 8).C14                                           02940000
&C4      SETC  '&FORMAT'(&A2,8)                                         02950000
         DC    CL8'&C4'                                                 02960000
&A2      SETA  &A2+8                                                    02970000
&A5      SETA  &A5-8                                                    02980000
         AGO   .C12                                                     02990000
.C14     ANOP                                                           03000000
&C4      SETC  '&FORMAT'(&A2,&A5)                                       03010000
         DC    CL&A5'&C4'                                               03020000
&A3      SETA  1                   INDICATE NOT FIRST.                  03030000
         AGO   .C9                                                      03040000
.C3      ANOP                                                           03050000
&A1      SETA  &A4                 SET END INDICATOR.                   03060000
         AGO   .C13                                                     03070000
.CX      AIF   (&B1).B1            IF SECOND ENTRY GO TO FLDS.          03080000
.*                                                                      03090000
.*       END OF FORMAT SCAN - NOW TO GENERATE INSTRUCTIONS.             03100000
.*                                                                      03110000
         AIF   (&A(1)+&A(2)+&A(3)+&A(4)+&A(5)+&A(6) EQ 0).AX            03120000
         AIF   ('&FROM' NE '''S''').A1   NOT CVTDATA.                   03130000
         L     1,16(0,0)           SET GR1 -> CVT.                      03140000
&A1      SETA  57                  OFFSET WITHIN CVT.                   03150000
         AGO   .A2                                                      03160000
.A1      IHBINNRA  &FROM           SET GR1 -> DATE FIELD.               03170000
&A1      SETA  0                   OFFSET FIELD.                        03180000
.A2      AIF   (&A(1) EQ 0).A3     YYDDD NOT REQUIRED.                  03190000
&A2      SETA  &A(1)-1             OFFSET OF YYDDD FIELD.               03200000
         UNPK  &GSS(1)&GSS(2)&GSS(3)+&A2.(5&GSS(4)&GSS(5)),&A1.(3,1)    03210000
&A2      SETA  &A2+4               SET OFFSET FOR OR IMMEDIATE.         03220000
         OI    &GSS(1)&GSS(2)&GSS(3)+&A2&C1&GSS(5)&C2,X'F0' REMOVE ZONE 03230000
         AIF   (&A(4) EQ 0).A4     YY NOT REQUIRED.                     03240000
&A2      SETA  &A(4)-1             OFFSET OF YY ENTRY.                  03250000
&A3      SETA  &A(1)-1             OFFSET OF YYDDD ENTRY.               03260000
         MVC   &GSS(1)&GSS(2)&GSS(3)+&A2.(2&GSS(4)&GSS(5)),&GSS(1)&GSS(*03270000
               2)&GSS(3)+&A3&C1&GSS(5)&C2  SET YY.                      03280000
.A4      AIF   (&A(3) EQ 0).A5     DDD NOT REQUIRED.                    03290000
&A2      SETA  &A(3)-1             OFFSET OF DDD.                       03300000
&A3      SETA  &A(1)+1             OFFSET OF DDD IN YYDDD ENTRY.        03310000
         MVC   &GSS(1)&GSS(2)&GSS(3)+&A2.(3&GSS(4)&GSS(5)),&GSS(1)&GSS(*03320000
               2)&GSS(3)+&A3&C1&GSS(5)&C2   SET DDD.                    03330000
.A5      AIF   (&A(2)+&A(5)+&A(6) EQ 0).AX                              03340000
.A3      AIF   (NOT(&A(4) NE 0 AND &A(1) EQ 0) AND &A(2)+&A(5)+&A(6) EQ*03350000
                0).A6                                                   03360000
         MVO   &GNAME.B+6(2),&A1.(1,1) MOVE YEAR NO. TO WORK AREA.      03370000
         AIF   (NOT(&A(4) NE 0 AND &A(1) EQ 0)).A7                      03380000
         OI    &GNAME.B+7,X'0F'    REMOVE ZONE.                         03390000
&A2      SETA  &A(4)-1             OFFSET OF YY ENTRY.                  03400000
         UNPK  &GSS(1)&GSS(2)&GSS(3)+&A2.(2&GSS(4)&GSS(5)),&GNAME.B+6(2*03410000
               )                   SET YY.                              03420000
.A7      AIF   (&A(2)+&A(5)+&A(6) EQ 0).A6                              03430000
         CVB   0,&GNAME.B          SET GR0 = YY.                        03440000
.A6      AIF   (NOT(&A(3) NE 0 AND &A(1) EQ 0) AND &A(2)+&A(5)+&A(6) EQ*03450000
                0).AX                                                   03460000
&A2      SETA  &A(3)-1                                                  03470000
&A1      SETA  &A1+1                                                    03480000
         AIF   (&A(2)+&A(5)+&A(6) NE 0).A8                              03490000
         UNPK  &GSS(1)&GSS(2)&GSS(3)+&A2.(3&GSS(4)&GSS(5)),&A1.(2,1)    03500000
&A2      SETA  &A2+2                                                    03510000
         OI    &GSS(1)&GSS(2)&GSS(3)+&A2&C1&GSS(5)&C2,X'F0' REMOVE ZONE 03520000
         AGO   .AX                                                      03530000
.A8      MVC   &GNAME.B+6(2),&A1.(1)   MOVE DDD TO WORK AREA.           03540000
         AIF   (NOT(&A(3) NE 0 AND &A(1) EQ 0)).A9                      03550000
         OI    &GNAME.B+7,X'0F'    REMOVE ZONE.                         03560000
         UNPK  &GSS(1)&GSS(2)&GSS(3)+&A2.(3&GSS(4)&GSS(5)),&GNAME.B+6(2*03570000
               )                   STORE DDD.                           03580000
.A9      AIF   (&A(2)+&A(5)+&A(6) EQ 0).AX                              03590000
         LR    1,0                 SET GR1 = YEAR NUMBER.               03600000
         CVB   0,&GNAME.B          SET GR0 = DAY NUMBER.                03610000
         MVI   &GNAME.C+10,28      SET FEBRUARY = 28 DAYS.              03620000
         EX    1,&GNAME.D          TEST FOR LEAP YEAR.                  03630000
         BNZ   *+8                 IF NOT THEN GO TO FIND DD/MM/MMM.    03640000
         MVI   &GNAME.C+10,29      SET FEBRUARY = 29 DAYS.              03650000
         LA    1,&GNAME.C+11       SET GR1 -> JANUARY ENTRY.            03660000
         SR    15,15               SET GR15 = 0.                        03670000
         IC    15,0(1,0)           SET GR15 = DAYS / MONTH.             03680000
         SR    0,15                DECREMENT DAY NUMBER.                03690000
         BNP   *+8                 IF NOT PLUS THEN MONTH FOUND.        03700000
         BCT   1,*-10              LOOP UNTIL FOUND.                    03710000
         AIF   (&A(6) EQ 0).A10    DD NOT REQUIRED.                     03720000
         AR    0,15                RESTORE DD.                          03730000
         CVD   0,&GNAME.B          STORE DD IN WORK AREA.               03740000
         OI    &GNAME.B+7,X'0F'    REMOVE ZONE.                         03750000
&A2      SETA  &A(6)-1             OFFSET OF DD.                        03760000
         UNPK  &GSS(1)&GSS(2)&GSS(3)+&A2.(2&GSS(4)&GSS(5)),&GNAME.B+6(2*03770000
               )                   SET DD.                              03780000
         AIF   (&A(2)+&A(5) EQ 0).AX                                    03790000
.A10     LA    0,&GNAME.C+12       SET GR0 FOR SUBTRACT.                03800000
         SR    0,1                 SET GR0 = MONTH NUMBER.              03810000
         AIF   (&A(5) EQ 0).A11    MM NOT REQUIRED.                     03820000
         CVD   0,&GNAME.B          MOVE MM TO WORK AREA.                03830000
         OI    &GNAME.B+7,X'0F'    REMOVE ZONE.                         03840000
&A2      SETA  &A(5)-1             OFFSET OF MM ENTRY.                  03850000
         UNPK  &GSS(1)&GSS(2)&GSS(3)+&A2.(2&GSS(4)&GSS(5)),&GNAME.B+6(2*03860000
               )                   SET MM.                              03870000
         AIF   (&A(2) EQ 0).AX     MMM NOT REQUIRED.                    03880000
.A11     LR    1,0                 SET GR1 = MM.                        03890000
         AR    1,0                 SET GR1 = MM * I.                    03900000
         AR    1,0                 SET GR1 = MM * 3.                    03910000
         LA    1,&GNAME.E-3(1)     SET GR1 -> REQUIRED CHAR FLD.        03920000
&A2      SETA  &A(2)-1             OFFSET OF MMM ENTRY.                 03930000
         MVC   &GSS(1)&GSS(2)&GSS(3)+&A2.(3&GSS(4)&GSS(5)),0(1) SET MMM 03940000
.AX AIF (NOT(&B2 OR &A(2)+&A(5)+&A(6) NE 0 OR(&A(1) EQ 0 AND &A(4) NE 0*03950000
               ))).END                                                  03960000
         B     &GNAME.F                                                 03970000
.*                                                                      03980000
.*       END OF INSTRUCTION GENERATION-NOW GENERATE CONSTANTS.          03990000
.*                                                                      04000000
  AIF (NOT(&A(2)+&A(5)+&A(6) NE 0 OR (&A(1) EQ 0 AND &A(4) NE 0))).B2   04010000
         DS    0D                                                       04020000
         AIF   (&A(2)+&A(5)+&A(6) EQ 0).B2                              04030000
&GNAME.B DC    PL8'0'                                                   04040000
&GNAME.D TM    *+4,0               MODEL INSTRUCTION.                   04050000
         DC    AL1(3)                                                   04060000
&GNAME.C DC    AL1(31,30,31,30,31,31,30,31,30,31,28,31)                 04070000
         AIF   (&A(2) EQ 0).B2                                          04080000
&GNAME.E DC    C'JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC'                  04090000
.B2      AIF   (&B2 EQ 0).B1                                            04100000
&B1      SETB  1                                                        04110000
         AGO   .C1                                                      04120000
.B1      ANOP                                                           04130000
&GNAME.F DS    0H                                                       04140000
.END     MEXIT                                                          04150000
.E1      MNOTE 12,'***  IHB004  REQUIRED OPERAND(S) NOT SPECIFIED'      04160000
         MEND                                                           04170000
         MACRO                                                          04180000
         GETAUTH &TYPE=GET                                              04190000
         AIF   ('&TYPE' EQ 'ON').ON                                     04200000
         AIF   ('&TYPE' NE 'GET').OFF                                   04210000
.ON      ANOP                                                           04220000
         MNOTE 1,'* THIS PROGRAM REQUIRES APF AUTHORIZATION *'          04230000
.*                                                                      04240000
.OFF     ANOP                                                           04250000
         MEND                                                           04260000
         MACRO                                                          04270000
&NAME    TESTIOT &DDNAME=                                               04280000
.*                                                                      04290000
.*       PDSDOC *MACRO TO SEARCH TIOT FOR GIVEN DDNAME................* 04300000
.*                                                                      04310000
         LCLC  &DDN                                                     04320000
         AIF   ('&NAME' EQ '').NONAME                                   04330000
&NAME    EQU   *                                                        04340000
.NONAME  ANOP                                                           04350000
         CNOP  0,4                                                      04360000
.DDN     BAL   1,*+20 ¬            BRANCH AROUND LIST                   04370000
         DC    A(*+12) ¬           LIST ADDRESS                         04380000
         DC    A(0) ¬              TCB ADDRESS                          04390000
         DC    AL1(2) ¬            FIELD BYTE 1                         04400000
         DC    AL3(0) ¬            FIELD BYTE 2,3,4.                    04410000
         DC    F'0' ¬              ADDRESS TASK INPUT/OUTPUT TABLE      04420000
         SVC   40 ¬                ISSUE EXTRACT SVC                    04430000
         L     1,*-6 ¬             LOAD ADDRESS OF TIOT                 04440000
         XC    *-10(4),*-10 ¬      ZEROISE ADDRESS TIOT AREA            04450000
         LA    1,24(1) ¬           POINT R1 AT START OF FIRST DD ENTRY  04460000
         XR    15,15 ¬             ZEROISE REG.15                       04470000
         CLC   0(4,1),*-22 ¬       TEST IF END OF TIOT                  04480000
         BE    *+26 ¬              YES - GO SET CONDITION CODE TO 4     04490000
         AIF   ('&DDNAME' EQ '').NODDN                                  04500000
&DDN     SETC  '&DDNAME'                                                04510000
         AIF   ('&DDNAME'(1,1) EQ '(').REG                              04520000
         CLC   4(8,1),&DDN ¬       TEST IF SPECIFIED DDN IS IN TIOT     04530000
         AGO   .NEXT                                                    04540000
.NODDN   ANOP                                                           04550000
&DDN     SETC  '(0)'                                                    04560000
.REG     CLC   4(8,1),0&DDN ¬      TEST IF SPECIFIED DDN IS IN TIOT     04570000
.NEXT    BE    *+20 ¬              YES - CONDITION CODE IS ZERO         04580000
         IC    15,0(1) ¬           LOAD LENGTH OF THIS DD ENTRY         04590000
         LA    1,0(15,1) ¬         GET ADDRESS OF NEXT DD ENTRY         04600000
         B     *-30 ¬              REPEAT TEST                          04610000
         LA    15,4 ¬              SET CONDITION CODE TO 4              04620000
         MEND                                                           04630000
         MACRO                                                          04640000
&NAME    GOSUB &ROUTINE,&R                                              04650000
.*                                                                      04660000
.*       PDSDOC *MACRO TO EXECUTE SUB-ROUTINE.........................* 04670000
.*                                                                      04680000
         LCLC  &REG                                                     04690000
         AIF   ('&ROUTINE' EQ '').NOADDR                                04700000
&REG     SETC  '&R'                                                     04710000
         AIF   ('&R' NE '').GOTREG                                      04720000
&REG     SETC  'R4'                                                     04730000
.GOTREG  ANOP                                                           04740000
&NAME    BAL   &REG,&ROUTINE       GO EXECUTE SUBROUTINE                04750000
         MEXIT                                                          04760000
.NOADDR  ANOP                                                           04770000
         MNOTE 8,'** NO SUBROUTINE ADDRESS SPECIFIED'                   04780000
         MEND                                                           04790000
         SPACE 1                                                        04800000
         MACRO                                                          04810000
&NAME    SUBIN &SAVE=,&PREFIX=                                          04820000
.*                                                                      04830000
.*       PDSDOC *MACRO FOR SUB-ROUTINE ENTRANCE.......................* 04840000
.*                                                                      04850000
         GBLA  &SUBINC                                                  04860000
         LCLA  &N,&S                                                    04870000
         LCLC  &R,&P,&PP                                                04880000
&SUBINC SETA   &SUBINC+1                                                04890000
&NAME    DS    0H                                                       04900000
&N       SETA  N'&SAVE                                                  04910000
         AIF   (&N GT 0).C1                                             04920000
         MEXIT                                                          04930000
.C1      ANOP                                                           04940000
&P       SETC  '&PREFIX'                                                04950000
         AIF   ('&P' EQ '').C2                                          04960000
&PP      SETC  '&P.SAVE'                                                04970000
         AGO   .C3                                                      04980000
.C2      ANOP                                                           04990000
&PP      SETC  '$&SUBINC'                                               05000000
.C3      ANOP                                                           05010000
&S       SETA  &S+1                                                     05020000
         AIF   (&S GT &N).C4                                            05030000
         ST    &SAVE(&S),&PP&SAVE(&S) *      PRESERVE REGISTER          05040000
         AGO   .C3                                                      05050000
.C4      ANOP                                                           05060000
         B     &PP.XIT *           BRANCH OVER SAVE AREAS               05070000
&S       SETA  0                                                        05080000
.C5      ANOP                                                           05090000
&S       SETA  &S+1                                                     05100000
         AIF   (&S GT &N).C6                                            05110000
&PP&SAVE(&S) DS F *                SAVE AREA                            05120000
         AGO   .C5                                                      05130000
.C6      ANOP                                                           05140000
&PP.XIT  EQU   * *                 ROUTINE EXIT                         05150000
         MEND                                                           05160000
         SPACE 1                                                        05170000
         MACRO                                                          05180000
&NAME   SUBOUT &RESTORE=,&PREFIX=,&RETURN=                              05190000
.*                                                                      05200000
.*       PDSDOC *MACRO FOR SUB-ROUTINE EXIT...........................* 05210000
.*                                                                      05220000
         GBLA  &SUBINC                                                  05230000
         LCLA  &N,&S                                                    05240000
         LCLC  &R,&P,&PP,&B                                             05250000
         AIF   ('&NAME' EQ '').NONAME                                   05260000
&NAME    DS    0H *                                                     05270000
.NONAME  ANOP                                                           05280000
&N       SETA  N'&RESTORE                                               05290000
         AIF   (&N NE 0).C3                                             05300000
.C1      ANOP                                                           05310000
&B       SETC  'R4'                                                     05320000
         AIF   ('&RETURN' EQ '').C2                                     05330000
         AIF   ('&RETURN'(1,1) NE '(').C11                              05340000
&B       SETC  '&RETURN(1)'                                             05350000
         AGO   .C2                                                      05360000
.C11     ANOP                                                           05370000
&B       SETC  '&RETURN'                                                05380000
         B     &B *                RETURN TO CALLER                     05390000
         MEXIT                                                          05400000
.C2      BR    &B *                RETURN TO CALLER                     05410000
         MEXIT                                                          05420000
.C3      ANOP                                                           05430000
&P       SETC  '&PREFIX'                                                05440000
         AIF   ('&P' EQ '').C4                                          05450000
&PP      SETC  '&P.SAVE'                                                05460000
         AGO   .C5                                                      05470000
.C4      ANOP                                                           05480000
&PP      SETC  '$&SUBINC'                                               05490000
.C5      ANOP                                                           05500000
&S       SETA  &S+1                                                     05510000
         AIF   (&S GT &N).C1                                            05520000
         L     &RESTORE(&S),&PP&RESTORE(&S) *     RESTORE REGISTER      05530000
         AGO   .C5                                                      05540000
         MEND                                                           05550000
         MACRO                                                  EL10060 05560000
&NAME    BLKPRT                                                         05570000
         CNOP  0,4                 FORCE FULLWORD ALIGNMENT     EL10060 05580000
         BAL   R1,*+16             SET ADDRESS TO INLINE PARMS  EL10060 05590000
         DC    A(BANSLT1)          GET ADDRESS OF SLANT OPTION  EL10060 05600000
         DC    A(BANTXT1)          GET ADDRESS OF TEXT          EL10060 05610000
         DC    AL1(128)                                         EL10060 05620000
         DC    AL3(BANPLN1)        GET LINE DISPLACEMENT        EL10060 05630000
         L     R15,=V(BLKPRT)      POINT TO BLOCK LETTER ROUTINEEL10060 05640000
         BALR  R14,R15                                          EL10060 05650000
         MEND                                                           05660000
         SPACE 1                                                        05670000
         PUNCH ' ORDER MAPDISK(P) '                             GP09136 05680000
         PUNCH '  SETCODE AC(1) '                               GP09136 05690000
*********************************************************************   05700000
*        PDSDOC *MAP DISKS WITH ICF/VSAM DETAILS - SMS VERSION........* 05710000
*  REGRESSED TO MVS W/VSAM CATALOGS; SOME NEW STUFF DISABLED.           05720000
*  FROM CBT 429  FILE 172, WITH LOCAL MODS  GERHARD POSTPISCHIL GP09136 05730000
*                                                                       05740000
*        PRODUCED AT TRIANGLE UNIVERSITIES COMPUTATION CENTER,          05750000
*                    RESEARCH TRIANGLE PARK,                            05760000
*                    NORTH CAROLINA, 27709                              05770000
*        SYSTEMS PROGRAMMER - H. L. JACKSON                             05780000
*        MODIFIED FOR 2314 DEC67 BY TED BAUER & FRED FELBER MINNEAPOLIS 05790000
*                                                                       05800000
*                                                                       05810000
*              MONSANTO COMPANY                                         05820000
*             ==================                                        05830000
*                                                                       05840000
*   1960'S _ PROGRAM INTRODUCED IN THE INSTALLATION OF MONSANTO LTD     05850000
*             LONDON - SOMETIMES IN LAST THREE YEARS OF THE YEARS 60.   05860000
*                                                                       05870000
*   1970'S - MODIFIED A LOT BY SYSTEMS PROGRAMMERS OF MONSANTO EUROPE   05880000
*             BRUSSELS - DURING THE YEARS 70.                           05890000
*                                                                       05900000
*                _ FOR 3330-11 SUPPORT  (MARCH 72 - P.S. GRANT)         05910000
*                _ MFT TO MVS COMPATIBILITY (1977)                      05920000
*                _ FOR 3350 SUPPORT (DEC. 79 - J. NOLS)                 05930000
*                _ ETC ................                                 05940000
*                                                                       05950000
*   1980'S - JUNE 81 - K. O'NEILL                                       05960000
*              PRINT OUT COMPLETELY REFORMATTED.                        05970000
*                                                                       05980000
*          - SEPTEMBER 81 - K. O'NEILL                                  05990000
*              SUPPORT FOR INDEXED VTOC (DF/DS RELEASE 1.2)             06000000
*              MEMBERS PER PDS ADDED                                    06010000
*                                                                       06020000
*          - JANUARY   82 - K. O'NEILL                                  06030000
*              BYPASS DDNAME JOBLIB                                     06040000
*              EXTENT NUMBER INCREASED FROM 2 TO 3 CHARACTERS           06050000
*              CORRECTION OF LOGIC ERROR - ABEND S0C9 IF                06060000
*              BLOCKSIZE 19069 ENCOUNTERED ON 3350.                     06070000
*                                                                       06080000
*          - JANUARY   83 - K. O'NEILL                                  06090000
*              PARM PROCESSING                                          06100000
*              REFDT WAS BEING CHANGED BY THE 'COUNT MEMBERS            06110000
*              IN PDS' ROUTINE. BY DEFAULT WILL NOT CHECK NUMBER.       06120000
*              IF PDS INFO NEEDED SPECIFY PARM='PDS'.                   06130000
*                                                                       06140000
*********************************************************************   06150000
        EJECT                                                           06160000
*********************************************************************   06170000
*                                                                       06180000
*                                                                       06190000
*    INTERDATA A.G.                                                     06200000
*          - AUGUST  1987 - D.H.CARTWRIGHT                              06210000
*              MODIFIED TO BYPASS BLOCKS/TRACK CALCULATIONS             06220000
*              BUT INSTEAD USE THE 'STAR' ROUTINE TO CALCULATE          06230000
*              TRACK CAPACITY.                                          06240000
*                                                                       06250000
*          - MARCH   1988 - D.H.CARTWRIGHT                              06260000
*              ADDED ALTERNATE CYLINDER VALUES FOR 3380                 06270000
*                                                                       06280000
*    SPRECHER ENERGIE A.G.                                              06290000
*          - JUNE 1989 - D.H.CARTWRIGHT                                 06300000
*          V6  MODIFIED TO WRITE SUMMARY RECORDS FOR LATER ANALYSIS     06310000
*              PROCESS CHAINED FMT3 DSCB FOR VSAM EXTENTS               06320000
*                                                                       06330000
*          - AUGUST 1989 - D.H.CARTWRIGHT                               06340000
*          V7  MODIFIED TO SHOW DATA-SET-CHANGED BIT                    06350000
*              26JUN90 CART1 CHANGE REPORT TITLE TO SHOW LATEST VERSION 06360000
*                                                                       06370000
*          - OCTOBER 1990 - D.H.CARTWRIGHT                              06380000
*          V8  COMBINED WITH THE 'LISTICF' PROGRAM FROM THE GERMAN      06390000
*              G.U.I.D.E. GOODIES TAPE. THIS ALLOWS MORE DETAIL TO BE   06400000
*              SHOWN FOR ICF VSAM DATASETS                              06410000
*          V8.1 CALCULATE SPACE UTILISATION AND WASTE IN SUMMARY RECS.  06420000
*                                                                       06430000
*          - MAY 1991     - D.H.CARTWRIGHT                              06440000
*          V8.2 ADDED TODDATE ROUTINE TO PROCESS VSAM TIMESTAMPS        06450000
*               ADDED DVCT PROCESSING TO GET NO. SPARE TRACKS           06460000
*               SHOW PERCENT CA AND CI SPLITS                           06470000
*                                                                       06480000
*          - SEPT 1991    - D.H.CARTWRIGHT                              06490000
*          V8.3 ADDED SHAREOPTIONS TO SUMMARY RECORD                    06500000
*                                                                       06510000
*          - 30MAR92      - D.H.CARTWRIGHT                              06520000
*          V8.4 SHOW VSAM COMPONENT TYPE IN DSORG                       06530000
*                                                                       06540000
*          - 04MAY92      - D.H.CARTWRIGHT                              06550000
*          V8.5 GIVE VVDS FIVE DATA BUFFERS FOR PERFORMANCE             06560000
*                                                                       06570000
*          - 22MAY92      - D.H.CARTWRIGHT                              06580000
*          V8.6 CALCULATE DAYS SINCE LAST REFERENCE FOR SUMMARY         06590000
*                                                                       06600000
*    DARNICK COMPUTING LTD.                                             06610000
*          - JULY 1994 - D.H.CARTWRIGHT                                 06620000
*          V8.7 CORRECT TRKCALC CODE FOR BLK ALLOCATIONS                06630000
*                                                                       06640000
*          - JULY 1995 - D.H.CARTWRIGHT                                 06650000
*          V9.0 ADD SMS SUPPORT FOR VVR TYPE 'N' RECORDS                06660000
*                                                                       06670000
*          - NOV. 1997 - D.H.CARTWRIGHT                                 06680000
*          V9.1 DF/SMS 1.2 MAY NOT PRODUCE TYPE 22 VVR CELLS            06690000
*                                                                       06700000
*          - DEC. 1999 - D.H.CARTWRIGHT                                 06710000
*          V9.2 RECOGNISE HFS FILES                                     06720000
*                                                                       06730000
*          - MAY  2009 - G. POSTPISCHIL                         GP09136 06740000
*          REGRESSED FOR MVS 3.8 SUPPORT; FIXED LABEL=SUL SPACE;        06750000
*          FIXED 0CX FOR MISSING SYSOUT; LRECL=X; OTHER MINOR FIXES     06760000
*                      - K. LEONARD                                @Q01 06770000
*          VERIFY EXISTENCE OF VVDS PRIOR TO ALLOCATION                 06780000
*                                                                       06790000
*    CEDAR LAKE EMPORIUM LLC                                            06800000
*          - FEBRUARY 2010 - E.G. LISS                          EL10060 06810000
*          V9.3 ADDED BANNER PAGE FOR EACH VOLUME                       06820000
*                                                                       06830000
*********************************************************************   06840000
        EJECT                                                           06850000
*********************************************************************   06860000
*                                                                       06870000
* FUNCTION                                                              06880000
*                                                                       06890000
*  TO MAP THE ALLOCATION OF DATA SETS ON DISK PACKS.                    06900000
*                                                                       06910000
*********************************************************************   06920000
* INPUT    PARM - IF PDS INFORMATION IS REQUIRED A PARM OF:-            06930000
*                 PARM='PDS' IS REQUIRED. THE DEFAULT IS TO NOT         06940000
*                 RECEIVE PDS INFORMATION.                              06950000
*                                                                       06960000
*                                                                       06970000
* VOLUMES TO BE MAPPED  ALL VOLUMES TO BE MAPPED MUST HAVE A DD CONTROL 06980000
*                  CARD, THE DDNAME MAY BE ANYTHING, IT IS PREFFERED    06990000
*                  IF THEY ARE DD1, DD2, ETC.  DISP=OLD,VOLUME=SER AND  07000000
*                  UNIT=  MUST BE GIVEN. NO OTHER PARAMETERS ARE NEEDED 07010000
*                  THESE DD CARDS MUST FOLLOW THE SYSUT1 DD CARD.       07020000
*                                                                       07030000
* OUTPUT  SYSPRINT : MAP OF ALL DATA SETS                               07040000
*         SYSOUT   : (OPTIONAL) EXTENT MAP OF THE DISK          GP09136 07050000
*                                                                       07060000
*                                                                       07070000
*********************************************************************   07080000
*                                                                       07090000
*        THIS  PROGRAM MODIFIED  16 MARCH 1972 TO ALLOW FOR             07100000
*        3330'S.  THE MAIN PROBLEM WAS THAT SPACE WAS ALLOCATED         07110000
*        IN-LINE FOR TABLES AND THESE TABLES WERE NOT LARGE ENOUGH      07120000
*        FOR 3330'S.  THE PROGRAM WAS CHANGED TO OBTAIN CORE (GETMAIN)  07130000
*        FOR THE MAJORITY OF THE TABLES NEEDED.  ALSO NO CHECKING       07140000
*        WAS MADE FOR END OF TABLE SO THIS CODE WAS ALSO INSERTED.      07150000
*        IF TABLE OVERFLOW OCCURS A MESSAGE WILL BE PRINTED WHICH       07160000
*        INDICATES WHICH TABLE NEEDS TO BE INCREASED:                   07170000
*          ***MAPDISK TABLE OVERFLOW***D                                07180000
*                                      *                                07190000
*          *****************************                                07200000
*          *                                                            07210000
*          ***WHERE D=0  INCREASE FMT1SIZE                              07220000
*                   D=1  INCREASE F356SIZE                              07230000
*                   D=3  INCREASE ACCTSIZE                              07240000
*                   D=7  INCREASE SRTSIZE                               07250000
*        EQU'S WERE USED TO FACILITATE CHANGES                          07260000
*        IT IS ACKNOWLEDGED BY THE MODIFIER THAT THE MODIFIEE           07270000
*        SHOULD PROBABLY BE CHANGED SO THAT NO BOUNDS EXIST FOR         07280000
*        TABLES OTHER THAN REGION SIZE BUT TIME WAS NOT AVAILABLE       07290000
*                                                                       07300000
*********************************************************************   07310000
         EJECT                                                          07320000
*******************************************************************     07330000
*                                                                 *     07340000
*        LIMITATIONS                                              *     07350000
*       ------------                                              *     07360000
*                                                                 *     07370000
* 1) MUST BE RUN AUTHORISED FROM AN AUTHORISED LIBRARY            *     07380000
*                                                                 *     07390000
* 2) VSAM CODE ONLY WORKS WITH ICF/VSAM CATALOGS. NOTE THAT THE   *     07400000
*    VSAM ERROR HANDLING CODE OCCASIONALLY TERMINATES THE PROGRAM *     07410000
*    FOR NO KNOWN REASON. THIS BUG IS UNDER INVESTIGATION.        *     07420000
*    THIS VERSION IS COMPATIBLE WITH DFP 2.4, BUT MAY NEED TO     *     07430000
*    BE REWORKED FOR DFP 3.X                                      *     07440000
*                                                                 *     07450000
* 3) THE CODE TO PROCESS PDS DIRECTORIES WILL ALWAYS UPDATE THE   *     07460000
*    LAST-DATE-REFERENCED IN THE FMT1 DSCB. YOU ARE ADVISED NOT   *     07470000
*    TO INVOKE THIS FUNCTION.                                     *     07480000
*                                                                 *     07490000
*******************************************************************     07500000
         SPACE 2                                                        07510000
*********************************************************************   07520000
*                                                                       07530000
*         REGISTER EQUATES                                              07540000
*                                                                       07550000
*********************************************************************   07560000
*                                                                       07570000
* GENERAL REGISTER USAGE                                                07580000
*        0     TTR OF VTOC PLUS STANDARD PARAM REGISTER                 07590000
*        1     DEB ADDRESS PLUS STANDARD PARAM REGISTER                 07600000
*        2     WORK                                                     07610000
*        2     PARAMETER TO CONVERT TTR - BOOST R IN ABSOLUTE           07620000
*        2     CONVERT TO RELATIVE TRACK, TEMP. REG.                    07630000
*        2     MDCB POINTER                                             07640000
*        3     WORKING REG - SORT FORMAT1 DSCB'S DS TABLE ADDRESS       07650000
*        3     ABSOLUTE TO RELATIVE TRACK, TEMP. STORE                  07660000
*        4     WORKING REG - SORT F1  KOUNT REGISTER                    07670000
*        4     RETURN FOR SUBROUTINES                                   07680000
*        5     WORKING REG - SORT F1 ADDRESS OF DSCB                    07690000
*        5     WORKING REG - VVDS RECORD LENGTH                         07700000
*        6     BASE FOR PROGRAM, SECOND                                 07710000
*        7     BASE ADDRESS FOR 3-5-6 DSCB TABLE                        07720000
*        7     VVDS RECORD POINTER                                      07730000
*        8     BASE REGISTER                                            07740000
*        9     VVDS ENTRIES TABLE POINTER                               07750000
*        9     BASE FOR UCB ADDRESS LIST                                07760000
*        10    BASE FOR DSCB DESCRIPTION BLOCK                          07770000
*        11    BASE FOR UCB DESCRIPTION BLOCK                           07780000
*        12                                                             07790000
*        12    BASE REGISTER #4                                         07800000
*        13    SAVE AREA POINTER AND BASE #1                            07810000
*        14    RETURN FOR SUBS                                          07820000
*        15    POINTER AND CONDITION CODE RETURN                        07830000
*                                                                       07840000
*********************************************************************   07850000
MAPDISK  START 0                                                GP09136 07860000
R0       EQU   0                   SYSTEMS                              07870000
R1       EQU   1                   SYSTEMS                              07880000
R2       EQU   2                   WORK & TEMP                          07890000
R3       EQU   3                   WORK & TEMP                          07900000
R4       EQU   4                   WORK & TEMP                          07910000
R5       EQU   5                   WORK & TEMP                          07920000
R6       EQU   6                   BASE REGISTER FOR PROGRAM            07930000
R7       EQU   7                   BASE TABLE                           07940000
R8       EQU   8                   BASE REGISTER                        07950000
R9       EQU   9                   WORK UCB DSECT                       07960000
R10      EQU   10                  BASE DSCB DSECT                      07970000
R11      EQU   11                  BASE REGISTER #3                     07980000
R12      EQU   12                  BASE REGISTER #2                     07990000
R13      EQU   13                  SAVE AND BASE #1                     08000000
R14      EQU   14                  RETURN                               08010000
R15      EQU   15                  REGISTER ASSIGNMENTS                 08020000
         SPACE 2                                                        08030000
*********************************************************************   08040000
*                                                                       08050000
*         INITIALIZATION                                                08060000
*                                                                       08070000
*********************************************************************   08080000
         PRINT GEN                                                      08090000
         B     BEGIN-MAPDISK(,R15)                              GP09136 08100000
         DC    AL1(17),CL17'MAPDISK &SYSDATE'                   GP09136 08110000
SAVEAREA DS    18F                RE-USE ENTRY AS SAVE AREA     GP09136 08120000
         ORG   SAVEAREA                                         GP09136 08130000
BEGIN    STM   R14,R12,12(R13)    SAVE ENTRY REGS               GP09136 08140000
         LR    R9,R13             SAVE OLD SAVE                 GP09136 08150000
         LA    R13,BEGIN-MAPDISK(,R15)   FIRST BASE             GP09136 08160000
         LA    R6,2048              MAKE CONSTANT               GP09136 08170000
         LA    R12,2048(R6,R13)   SECOND BASE                   GP09136 08180000
         LA    R11,2048(R6,R12)   THIRD BASE                    GP09136 08190000
         LA    R8,2048(R6,R11)    FOURTH BASE                   GP09136 08200000
         LA    R6,2048(R6,R8)     FIFTH BASE                    GP09136 08210000
         ST    R13,8(,R9)         LINK UP                       GP09136 08220000
         ST    R9,4(,R13)         LINK DOWN                     GP09136 08230000
         USING BEGIN,R13,R12,R11,R8,R6   MUCH TOO BIG           GP09136 08240000
*OLD*    PGMIN USING=(R13,R12,R11,R8,R6),EQUATES=NO                     08250000
         SPACE 2                                                        08260000
*******************************************************************     08270000
*        PROCESS PARM FIELD                                       *     08280000
*******************************************************************     08290000
         SPACE 1                                                        08300000
         LA    R1,0(,R1)           CLEAN PARM POINTER           GP09136 08310000
         LTR   R1,R1               IS THERE ONE ?               GP09136 08320000
         BZ    ENDPARM             NO                           GP09136 08330000
         L     R1,0(,R1)           LOAD PARM ADDRESS            GP09136 08340000
         LA    R1,0(,R1)           CLEAN PARM ADDRESS           GP09136 08350000
         LTR   R1,R1               IS THERE ONE ?               GP09136 08360000
         BZ    ENDPARM             NO                           GP09136 08370000
         CLC   =H'3',0(R1)         ONLY VALID LENGTH ?          GP09136 08380000
         BNE   ENDPARM             NO; IGNORE                   GP09136 08390000
         CLC   =C'PDS',2(R1)       GET DIRECTORY COUNTS?        GP09136 08400000
         BNE   ENDPARM             BRANCH IF NO                         08410000
         OI    PARMSWCH,X'FF'      SET PARM SWITCH ON                   08420000
ENDPARM  DS    0H                  FINISHED PARM PROCESSING             08430000
         EJECT                                                          08440000
*********************************************************************   08450000
*         DATE PROCESSING                                               08460000
*********************************************************************   08470000
         SR    R1,R1               ASK FOR CURRENT TIME                 08480000
         GOSUB TODDATE             GO FORMAT TOD-CLOCK                  08490000
         DATE  HEADDATE,FORMAT='DD MMM YY',FROM=TODPJUL FORMAT DATE ..  08500000
         MVC   HEADTIME,TODTIME    .. AND TIME IN HEADING               08510000
         LA    R1,TODDSCB          POINT TO BINARY DATE                 08520000
         GOSUB STDDAY01            CONVERT TO STANDARD DAY NO.          08530000
         STH   R1,STDRUN           SAVE DAY NO. OF THIS RUN             08540000
         EJECT                                                          08550000
*********************************************************************   08560000
*         OPEN FILES                                                    08570000
*********************************************************************   08580000
         SPACE 2                                                        08590000
         LA    R2,SYSUT2SW         POINT AT MDCB LIST                   08600000
         USING MDCB,R2             ESTABLISH ITS ADDRESSSABILITY        08610000
         OI    MDCBFLAG,DDINT      EXPRESS INTEREST                     08620000
         GOSUB TESTIOT             GO FIND IF IT IS PRESENT             08630000
         GOSUB OPEN                GO OPEN IT                           08640000
         DROP  R2                  END MDCB ADDRESSABILITY              08650000
         SPACE 1                                                        08660000
         OPEN  (PRINT,(OUTPUT))                                         08670000
         USING IHADCB,R9                                                08680000
         LA    R9,PRINT            OPEN SUCCESSFUL?                     08690000
         TM    DCBOFLGS,X'10'                                           08700000
         BZ    RETURN              NO                                   08710000
         OPEN  (SYSOUT,(OUTPUT))                                        08720000
         LA    R9,SYSOUT                                                08730000
         TM    DCBOFLGS,X'10'      OPEN SUCCESSFUL?                     08740000
         DROP  R9                                                       08750000
         BNZ   HVSYSOUT            YES                          GP09136 08760000
         LA    R0,BR14       GET DUMMY OUTPUT ROUTINE           GP09136 08770000
         STCM  R0,7,DCBPUTA-IHADCB+SYSOUT   DUMMY PUT           GP09136 08780000
         EJECT                                                          08790000
HVSYSOUT DS    0H                                               GP09136 08800000
         GETMAIN VC,LA=BOUNDS,A=TBLADDR  CHECK AVAILABLE STORAGE        08810000
         FREEMAIN  V,A=TBLADDR     FREE IT                              08820000
         NC    TBLLENG+2,=X'F800'  TRUNCATE TO 2K                       08830000
         L     R0,TBLLENG          *    SAVE 10K FOR PDS                08840000
         S     R0,=F'10240'        ***  PROCESSING AND ABEND            08850000
         ST    R0,TBLLENG          *                                    08860000
         GETMAIN R,LV=(0)          GET TABLE AREA                       08870000
         LR    R7,R1               LOAD START OF AREA                   08880000
         ST    R1,VSAMAREA         SET VSAM AREA POINTER                08890000
         A     R1,VSAMLEN          BUMP STORAGE OVER INPUT AREA         08900000
         ST    R1,TBLADDR                                               08910000
         ST    R1,VVETBL           SAVE START OF VVE TABLE              08920000
         ST    R1,VVENOW           SAVE 1ST ENTRY OF VVE TABLE          08930000
         A     R7,TBLLENG          ADD LENGTH OF TABLE                  08940000
         ST    R7,F356TBL          START OF F356 TABLE                  08950000
         ST    R7,F356END          END OF F356 TABLE                    08960000
         L     R15,CVTPTR          LOAD CVT POINTER             GP09136 08970000
         USING CVT,R15                                                  08980000
         MVC   APPEN,CVTXAPG+1     MOVE ADDRESS ONCE                    08990000
         DROP  R15                 END CVT ADDRESSABILITY               09000000
         EXTRACT TIOT,'S',FIELDS=(TIOT) GET ADDRESS OF TIOT IN WORK     09010000
         L     R2,TIOT             BRING ADDRESS OF TIOT IN             09020000
         LA    R2,TIOENTRY-TIOT1(,R2)  BUILD UP TO FIRST DDNAME GP09136 09030000
         ST    R2,TIOT             STORE VALUE FOR NEXT TIME AROUND     09040000
         GETAUTH TYPE=GET          AUTHORISATION                        09050000
         SPACE 1                                                        09060000
DISKLOOP DS    0H                  ( CLEAR PRINT LINE                   09070000
         MVI   DATANAME,C' '       ( CLEAR PRINT LINE                   09080000
         MVC   DATANAME+1(132),DATANAME  ( CLEAR PRINT LINE             09090000
         MVI   ERMS+L'ERMS-1,C'0'     SET UP ERROR MESSAGE VALUE        09100000
         SR    R15,R15             ZEROISE 4 BYTES                      09110000
         ST    R15,THISALLC        ZEROISE TRACKS ALLOC                 09120000
         ST    R15,THISUSED        ZEROISE TRACKS USEDC                 09130000
         L     R15,F356TBL         GET F356TBL START                    09140000
         ST    R15,F356END         RESET TABLE END                      09150000
         EJECT                                                          09160000
*********************************************************************   09170000
*         DD CHECKS                                                     09180000
*********************************************************************   09190000
SWT1     NOP   MANY                SWITCH FOR MORE THAN ONE VOL IN DD   09200000
         L     R2,TIOT             CHECK FOR END OF WORK                09210000
         USING TIOENTRY,R2         DECLARE ENTRY MAPPING        GP09136 09220000
TIOTLOOP DS    0H                                                       09230000
         SR    R3,R3               CLEAR COUNT REG                      09240000
         ICM   R3,1,TIOELNGH       ENTRY LENGTH                 GP09136 09250000
         BZ    ALLDONE             BRANCH IF DONE                       09260000
         B     LOOKON              GO TEST FOR SPECIAL NAMES            09270000
BYPASSDD AR    R2,R3               BUMP TO NEXT DD              GP09136 09280000
         B     TIOTLOOP            CONTINUE TO LOOK FOR DDNAMES         09290000
LOOKON   DS    0H                                                       09300000
         CLC   =C'SYS',TIOEDDNM    SPECIAL SYSTEM DD ?          GP09136 09310000
         BE    BYPASSDD            BYPASS IF  SYSTEM DDNAME             09320000
         CLC   =C'PGM=',TIOEDDNM   SPECIAL SYSTEM DD ?          GP09136 09330000
         BE    BYPASSDD            BYPASS IF DD IS PGM=                 09340000
         CLC   =C'STEP',TIOEDDNM   SPECIAL SYSTEM DD ?          GP09136 09350000
         BE    BYPASSDD            BYPASS  DD  IF STEPCAT DD            09360000
         CLC   =C'JOB',TIOEDDNM    JOBLIB OR JOBCAT  ?          GP09136 09370000
         BE    BYPASSDD            BYPASS IF JOBLIB                     09380000
         CLI   TIOEDDNM,C' '       IS THERE A DD NAME?          GP09136 09390000
         BE    BYPASSDD            BYPASS IF NO DD NAME                 09400000
         SR    R4,R4                                            GP09136 09410000
         ICM   R4,7,TIOEFSRT       LOOK AT FIRST UCB            GP09136 09420000
         BZ    BYPASSDD            BYPASS IF NONE               GP09136 09430000
         CLI   UCBTBYT3-UCBOB(R4),UCB3DACC  DASD DEVICE ?       GP09136 09440000
         BNE   BYPASSDD            NO; SKIP                     GP09136 09450000
         MVC   TESTDDNM,TIOEDDNM   MOVE THIS NAME TO DCB        GP09136 09460000
         MVC   UTILDDNM,TIOEDDNM     AND UTILITY DATA BLOCK     GP09136 09470000
         MVC   HEAD2DD,TIOEDDNM    AND IN TITLE                 GP09136 09480000
         LA    R9,TIOESTTB-4       SAVE START OF UCBS - 1       GP09136 09490000
         DROP  R2                  DONE WITH ENTRY MAPPING      GP09136 09500000
         AR    R2,R3               READY FOR NEXT DDNAME        GP09136 09510000
         ST    R2,TIOT             REPLACE                              09520000
         RDJFCB  (TEST)            GET VOLUMN NO. FOR THIS DD           09530000
         LA    R4,JFCBAREA         ESTABLISH ADDRESSABILITY             09540000
         USING IEFJFCBN,R4         FOR JFCB                             09550000
         TM    JFCBTSDM,X'20'      SEE IF USER SPECIFIED A SYSOUT       09560000
         BNO   CHECKV              OR SYSIN,BRANCH IF NOT               09570000
         MVC   EXTOUT+10(L'ERMS1),ERMS1                                 09580000
         DROP  R4                  END JFCB ADDRESSABILITY              09590000
         SPACE 1                                                        09600000
PRINTIT  DS    0H                                                       09610000
         BAL   R14,LINE1OUT        PRINT FROM EXTOUT                    09620000
         B     DISKLOOP            PROCESS NEXT ONE                     09630000
CHECKV   SH    R3,=AL2(TIOESTTB-TIOENTRY)  - OVERHEAD           GP09136 09640000
         SRL   R3,2                R3=NUMBER OF VOLUMES                 09650000
         STC   R3,TIOTNVOL         SAVE NUMBER OF VOLUMES               09660000
         OI    SWT1+1,X'F0'        TURN ON SW FOR MULTI VOLS            09670000
MANY     SR    R3,R3                                                    09680000
         ICM   R3,1,TIOTNVOL       GET NUMBER OF VOLS REMAINING GP09136 09690000
         BZ    DISKLOOP            LOOK FOR MORE DD'S                   09700000
VOLICK   BCT   R3,SLIPIN           LAST ONE DOES NOT BRANCH             09710000
         NI    SWT1+1,X'0F'        TURN OFF SWITCH                      09720000
SLIPIN   LA    R9,4(,R9)           GET ADDR OF NEXT UCB                 09730000
         ST    R9,UCBADDR          SAVE IT                              09740000
         STC   R3,TIOTNVOL         SAVE NUMBER OF VOLS                  09750000
         ICM   R7,B'0111',1(R9)    GET UCB ADDRESS                      09760000
         BZ    DISKLOOP            SKIP IF NONE                         09770000
         USING UCB,R7              ESTABLISH UCB ADDRESSABILITY         09780000
         MVC   SAVESER,SRTEVOLI    SAVE VOLUME SERIAL SERIAL            09790000
         MVC   SERMSG,SRTEVOLI     PUT IN VOLSER                        09800000
         MVC   MSGTP,SRTEVOLI      PUT IN VOLSER                        09810000
         ZAP   PAGEKNT,=P'0'       CLEAR PAGE COUNTS                    09820000
         ZAP   GPAGEKNT,=P'0'                                           09830000
         IC    R1,UCBTYP+3         GET DASD TYPE                GP09136 09840000
         N     R1,=A(DVCTYPMK)     MASK FOR UNIT TYPE           GP09136 09850000
         MH    R1,=H'6'            CONVERT TO OFFSET            GP09136 09860000
         LA    R1,DASDTYPE(R1)     GET TYPE ADDRESS             GP09136 09870000
         MVC   HEAD2TY,0(R1)       MOVE TO HEADER               GP09136 09880000
         EJECT                                                  EL10060 09890000
****************************************************************EL10060 09900000
*         PRINT BANNER PAGES HERE                               EL10060 09910000
****************************************************************EL10060 09920000
BANNER   EQU   *                                                EL10060 09930000
         MVC   BANTXT1(6),SAVESER  GET VOLSER                   EL10060 09940000
         MVI   BANTXT1+6,C' '                                   EL10060 09950000
         MVI   BANTXT1+7,C' '                                   EL10060 09960000
         BLKPRT                                                 EL10060 09970000
         MVI   BANPLNC,C'1'        SET PAGE EJECT               EL10060 09980000
         LA    R2,BANPLNC                                       EL10060 09990000
         LA    R3,12                                            EL10060 10000000
BANPUT1  PUT   PRINT,(R2)                                       EL10060 10010000
         PUT   SYSOUT,(R2)                                      EL10060 10020000
         LA    R2,132(,R2)                                      EL10060 10030000
         BCT   R3,BANPUT1                                       EL10060 10040000
*                                                               EL10060 10050000
         MVC   BANTXT1(6),HEAD2TY  GET VOLSER                   EL10060 10060000
         MVI   BANTXT1+6,C' '                                   EL10060 10070000
         MVI   BANTXT1+7,C' '                                   EL10060 10080000
         BLKPRT                                                 EL10060 10090000
         MVI   BANPLNC,C'-'        SET TRIPLE SPACE             EL10060 10100000
         LA    R2,BANPLNC                                       EL10060 10110000
         LA    R3,12                                            EL10060 10120000
BANPUT2  PUT   PRINT,(R2)                                       EL10060 10130000
         PUT   SYSOUT,(R2)                                      EL10060 10140000
         LA    R2,132(,R2)                                      EL10060 10150000
         BCT   R3,BANPUT2                                       EL10060 10160000
*                                                               EL10060 10170000
         MVC   BANTXT1,HEAD2DD     GET DDNAME                   EL10060 10180000
         BLKPRT                                                 EL10060 10190000
         MVI   BANPLNC,C'-'        SET TRIPLE SPACE             EL10060 10200000
         LA    R2,BANPLNC                                       EL10060 10210000
         LA    R3,12                                            EL10060 10220000
BANPUT3  PUT   PRINT,(R2)                                       EL10060 10230000
         PUT   SYSOUT,(R2)                                      EL10060 10240000
         LA    R2,132(,R2)                                      EL10060 10250000
         BCT   R3,BANPUT3                                       EL10060 10260000
*                                                               EL10060 10270000
         MVC   BANTXT1,=CL8'DATASET' SYSPRINT ONLY              EL10060 10280000
         BLKPRT                                                 EL10060 10290000
         MVI   BANPLNC,C'-'        SET TRIPLE SPACE             EL10060 10300000
         LA    R2,BANPLNC                                       EL10060 10310000
         LA    R3,12                                            EL10060 10320000
BANPUT4  PUT   PRINT,(R2)                                       EL10060 10330000
         LA    R2,132(,R2)                                      EL10060 10340000
         BCT   R3,BANPUT4                                       EL10060 10350000
*                                                               EL10060 10360000
         MVC   BANTXT1,=CL8'EXTENT' SYSOUT ONLY                 EL10060 10370000
         BLKPRT                                                 EL10060 10380000
         MVI   BANPLNC,C'-'        SET TRIPLE SPACE             EL10060 10390000
         LA    R2,BANPLNC                                       EL10060 10400000
         LA    R3,12                                            EL10060 10410000
BANPUT5  PUT   SYSOUT,(R2)                                      EL10060 10420000
         LA    R2,132(,R2)                                      EL10060 10430000
         BCT   R3,BANPUT5                                       EL10060 10440000
*                                                                       10450000
         EJECT                                                          10460000
*********************************************************************   10470000
*         DASD TYPE CHECKS                                              10480000
*********************************************************************   10490000
         CLI   UCBTYP+2,X'20'      CHECK IF DIRECT ACCESS               10500000
         BE    ONOFF               BRANCH IF UNIT IS A DASD             10510000
UNITERR  DS    0H                  WRONG UNIT TYPE                      10520000
         MVC   EXTOUT+10(L'ERMS2),ERMS2                                 10530000
         B     PRINTIT             GO PRINT IT                          10540000
         SPACE 1                                                GP09136 10550000
DASDTYPE DC    CL6'?DASD?',C'2311  2301  2303  9345  2321  '  0 GP09136 10560000
         DC    C'2305A 2305B 2314  3330  3340  3350  '       06 GP09136 10570000
         DC    C'3375  3330-13380  3390  '                   0C GP09136 10580000
         SPACE 1                                                        10590000
ONOFF    DS    0H                  CHECK FOR ON LINE                    10600000
         TM    SRTESTAT,X'80'      IS UNIT ON-LINE?                     10610000
         BZ    UNITERR             BRANCH IF OFF-LINE                   10620000
         LR    R1,R7               COPY UCB ADDRESS                     10630000
         GOSUB GETDVCT             GET DEVICE CHARACTERISTICS           10640000
         USING DVCT,R1             ESTABLISH TABLE ADDRESSABILITY       10650000
         MVC   NOSPARES,DVCALT     SET UP NUMBER OF SPARES              10660000
         DROP  R1                  END DVCT ADDRESSABILITY              10670000
         SPACE 1                                                        10680000
ITSADISK DS    0H                  NOW KNOW DEVICE TYPE                 10690000
         MVC   TTRVTOC,UCBVTOC                                          10700000
         MVI   SEEK,0                                                   10710000
         MVC   SEEK+1(7),SEEK      CLEAR CONVERT BIN                    10720000
         ST    R7,UCBXREF          STORE UCB ADDRESS                    10730000
         MODESET KEY=ZERO,MODE=SUP GET INTO RIGHT FRAME OF MIND  *DHC*  10740000
         L     R15,CVTPTR          LOAD CVT POINTER             GP09136 10750000
         USING CVT,R15                                                  10760000
         L     R15,CVTPCNVT        LOAD ADDRESS OF CONVERT ROUTINE      10770000
         DROP  R15                 END CVT ADDRESSABILITY               10780000
         L     R0,UCBVTOC                                               10790000
         LA    R1,MYDEB            ADDRESS OF PSEUDO DEB                10800000
         LA    R2,SEEK             ADDRESS TO STORE                     10810000
         LA    R4,SAVECNVT         SAVE AREA INDEPENDENT OF BASE REGS   10820000
         STM   R9,R13,0(R4)        SAVE REGS                            10830000
GOCNVT   DS    0H                  INVOKE IECPCNVT                      10840000
         BALR  R14,R15             GO TO CONVERT ROUTINE                10850000
EXCNVT   DS    0H                  RETURN FROM IECPCNVT                 10860000
         LM    R9,R13,0(R4)        RETURN REGS                          10870000
         MODESET KEY=NZERO,MODE=PROB  RETURN TO PREVIOUS STATE *DHC*    10880000
         B     GETVVRS             GO PROCESS VVDS                      10890000
         SPACE 1                                                        10900000
         DROP  R7                  END UCB ADDRESSABILITY               10910000
         EJECT                                                          10920000
*********************************************************************   10930000
*        VVDS PROCESSING - READ VVR'S AND SAVE ADDRESSES                10940000
*********************************************************************   10950000
         SPACE 1                                                        10960000
GETVVRS  DS    0H                  LOOK FOR VVR'S                       10970000
         L     R14,CVTPTR          GET CVT                      GP09139 10980000
         TM    CVTDCB-CVTMAP(R14),X'80'  XA OR LATER? (CVTMSE)  GP09139 10990000
         BZ    VVDSDONE            ASSUME NOT ACTIVE ON NEW(ER) SYSTEM  11000000
         L     R9,VVETBL           GET ADDRESS OF VVR TABLE             11010000
         XC    VVECNT,VVECNT       RESET RECORD COUNT                   11020000
         USING VVETABLE,R9         ESTABLISH TABLE ADDRESSABILITY       11030000
         MVC   DYNVOL,SAVESER      PUT VOLSER IN VVDS DSNAME       @Q01 11040000
         OBTAIN CAMSERCH           LOOK FOR VVDS ON VTOC           @Q01 11050000
         LTR   R15,R15             ANY VVDS ON THIS VOLUME?        @Q01 11060000
         BNZ   VVDSDONE            NO, SKIP VVDS PROCESSING        @Q01 11070000
         GOSUB DYNAVVDS            GO DYNAMICALLY ALLOCATE VVDS         11080000
         LTR   R15,R15             ALLOCATED OK?                        11090000
         BNZ   VVDSDONE            NO, HANDLE THAT SITUATION            11100000
         OI    VSAMSW,DDPRES       SHOW DD PRESENT                      11110000
         SPACE 1                                                        11120000
         XC    VVDSRBA,VVDSRBA     RBA = 0                              11130000
*NEW*    OPEN  (VVDSACB),MODE=24   OPEN THE ACB                         11140000
         OPEN  (VVDSACB)           OPEN THE ACB                 GP09136 11150000
         LTR   R15,R15             OPEN OK?                             11160000
*        BNZ   OPENERR             NO, ABEND                            11170000
         BNZ   VVDSDONE            NO, SKIP THIS BIT                    11180000
         OI    VSAMSW,DDOPEN       SHOW DD OPEN                         11190000
         GOSUB VVDSGET             GO READ THE VOLUME CONTROL RECORD    11200000
         SPACE 1                                                        11210000
VVDSLOOP DS    0H                  READ THE WHOLE VVDS                  11220000
         GOSUB VVDSGET             GO READ THE VVVDS                    11230000
         L     R2,VVDSAREA         GET RECORD POINTER                   11240000
         USING VVR,R2              ESTABLISH ADDRESSABILITY TO HEADER   11250000
         CLI   VVRTYPE,C'N'        NONVSAM RECORD?                      11260000
         BE    VVDSMRBA            YES, REMEMBER                        11270000
         CLI   VVRTYPE,C'Z'        PRIMARY RECORD?                      11280000
         BNE   VVDSLOOP            NO, FORGET IT                        11290000
         SPACE 1                                                        11300000
VVDSMRBA DS    0H                  MEMORISE THE RBA OF THIS ENTRY       11310000
         MVI   VVENAME,BLANK       CLEAR NAME ..                        11320000
         MVC   VVENAME+1(L'VVENAME-1),VVENAME .. TO BLANKS              11330000
         IC    R1,VVRCMPNL         GET COMPONENT NAME LENGTH            11340000
         BCTR  R1,0                DECREMENT FOR LENGTH FIELD           11350000
         BCTR  R1,0                DECREMENT FOR EXECUTE                11360000
         EX    R1,VVEMOVE          COPY COMPONENT NAME                  11370000
         SHOWCB  RPL=VVDSRPL,AREA=(S,VVERBA),                          +11380000
               LENGTH=L'VVERBA,FIELDS=(RBA)                             11390000
         LTR   R15,R15             TEST RETURN CODE                     11400000
         BNZ   SHOWERR             HANDLE PROBLEMS                      11410000
         LH    R1,VVECNT           GET RECORD COUNT                     11420000
         LA    R1,1(R1)            ADD ONE                              11430000
         STH   R1,VVECNT           SAVE NEW COUNT                       11440000
         LA    R9,VVETABL(R9)      POINT TO NEXT TABLE SLOT             11450000
         C     R9,F356TBL          HAVE WE RUN OUT OF ROOM?             11460000
         BNL   VVDS090             YES, ISSUE WARNING                   11470000
         B     VVDSLOOP            GO ROUND FOR NEXT RECORD             11480000
         SPACE 2                                                        11490000
VVEMOVE  MVC   VVENAME(*-*),VVRCMPNM  MOVE COMPONENT NAME    *EXECUTED* 11500000
         SPACE 1                                                        11510000
         DROP  R2                  END HEADER ADDRESSABILITY            11520000
         EJECT                                                          11530000
VVDSEOF  DS    0H                  END OF SEQUENTIAL VVDS               11540000
         MODCB RPL=VVDSRPL,OPTCD=(ADR,DIR,LOC,NSP)  SWITCH TO DIRECT    11550000
         LTR   R15,R15             MODCB OK ?                           11560000
         BNZ   MODCBERR            NO ==> ABEND                         11570000
         SPACE 1                                                        11580000
         XC    VVDSRBA,VVDSRBA     RBA = 0                              11590000
         POINT RPL=VVDSRPL         RESET FILE                           11600000
*        CLOSE (VVDSACB)                                                11610000
*        OPEN  (VVDSACB)                                                11620000
*        WTO   'MAPDISK ==> VVDS END OF FILE - CALL SYSTEMS'            11630000
         SPACE 1                                                        11640000
         MODCB EXLST=VVDSEXLS,EODAD=VSAMEOF  CHANGE EOD ADDRESS         11650000
         LTR   R15,R15             MODCB OK ?                           11660000
         BNZ   MODCBERR            NO ==> ABEND                         11670000
         B     VVDSDONE            CARRY ON                             11680000
         SPACE 1                                                        11690000
         DROP  R9                  END VVR TABLE ADDRESSABILITY         11700000
         SPACE 2                                                        11710000
VVDS090  DS    0H                                                       11720000
         WTO   'MAPDISK ==> VVDS TABLE OVERFLOW - CALL SYSTEMS',       *11730000
               ROUTCDE=11                                               11740000
         XC    VVECNT,VVECNT       RESET RECORD COUNT                   11750000
         SPACE 1                                                        11760000
VVDSDONE DS    0H                  VVDS SEQUENTIAL READ IS OVER         11770000
         LA    R2,VVETABL          GET LENGTH OF VVE TABLE ELEMENT      11780000
         MH    R2,VVECNT           CALCULATE TABLE LENGTH               11790000
         L     R7,TBLADDR          LOAD START OF TABLE                  11800000
         LA    R7,0(R7,R2)         CALCULATE START OF F1 TABLE          11810000
         ST    R7,DSTBL            START OF F1 TABLE                    11820000
         ST    R7,DSEND            END OF F1 TABLE                      11830000
         L     R7,F356TBL          R7=START OF 3-5-6 DSCB POINTERS      11840000
         L     R9,UCBADDR          R9=ADDR OF NEXT UCB ADDRESS          11850000
         MVC   NTRKNT,=F'1'        START DSCB'S AT BOTTOM OF TABLE      11860000
         MVC   SRTKNT,=F'1'        START SORT COUNT AT BOTTOM           11870000
         GOSUB SORTVVR             GO SORT THE VVR ENTRY TABLE          11880000
         EJECT                                                          11890000
*********************************************************************   11900000
*        VTOC PROCESSING - READ AND SAVE DSCB'S                         11910000
*********************************************************************   11920000
         SPACE 1                                                        11930000
GETDSCB  DS    0H                  LOOK FOR DSCB'S                      11940000
         LA    R10,WORK            ADDRESS FOR DSCB FORMAT 4            11950000
         USING DSCBS,R10           SETTING UP ADDRESSES                 11960000
         OBTAIN  LIST              LOOK FOR DSCB'S                      11970000
         LTR   R15,R15             SEE IF OK                            11980000
         BZ    NEXTCHK             OK                                   11990000
         SPACE 1                                                        12000000
CHECKIT  C     R15,=F'8'           MIDDLE OF TEST RANGE                 12010000
         BL    VOL                 VOLUME NOT MOUNTED                   12020000
         BE    FETCHNXT            NOT THERE ANY MORE, GET NEXT DSCB    12030000
         B     IOER                TERMINAL ERROR                       12040000
         SPACE 1                                                        12050000
NEXTCHK  CLI   DS4IDFMT,C'4'       CHECK FOR FORMAT 4                   12060000
         BNE   IOER                FIRST BLOCK MUST BE                  12070000
         MVC   SAVEF4,DSCBS        SAVE ALL OF FORMAT 4                 12080000
         MVC   SVCOUNT,DS4DEVDT    SAVE NUMBER OF DSCBS PER TRACK       12090000
         MVC   SAVEHWM,DS4HPCHR    SAVE HIGH WATER MARK IN VTOC         12100000
         CLC   SAVEHWM,DS4F6PTR    IS THERE A FORMAT6 PAST THIS         12110000
         BNL   FETCHNXT            BRANCH IF NOT                        12120000
         MVC   SAVEHWM,DS4F6PTR    OTHERWISE, SAVE THIS ADDRESS         12130000
         EJECT                                                          12140000
FETCHNXT SR    R2,R2               CLEAR WORKING REG                    12150000
         LA    R10,SAVEF4          SET UP ADDRESS FOR IT                12160000
         IC    R2,ADDRS+4          RECORD COUNT IN                      12170000
         LA    R2,1(R2)            BOOST BY ONE                         12180000
         CH    R2,TRKCNT           CHECK NUMBER OF RECORDS ON THE TRACK 12190000
         BNH   FETCHSQ             GO FETCH NEXT                        12200000
         MVC   WORK(4),ADDRS       MOVE TO TAKE CARE OF BOUNDRY         12210000
         LH    R2,WORK+2           LOAD HH OF CCHH                      12220000
         LA    R2,1(R2)            BUMP TO NEXT TRACK                   12230000
         STH   R2,WORK+2                                                12240000
         CH    R2,DS4DEVSZ+2       END OF CYL?                          12250000
         BL    PUTBACK             NO                                   12260000
         SR    R2,R2                                                    12270000
         STH   R2,WORK+2           RESET TRACK TO ZERO                  12280000
         SR    R2,R2               CLEAR WORK REG                       12290000
         ICM   R2,B'0011',WORK     GET CYL                              12300000
         LA    R2,1(R2)            BUMP                                 12310000
         STH   R2,WORK                                                  12320000
PUTBACK  DS    0H                                                       12330000
         MVC   ADDRS(4),WORK       PLACE BACK (CYL + 1)                 12340000
         LA    R2,1                RECORD = 1                           12350000
FETCHSQ  STC   R2,ADDRS+4          STORE RECORD COUND                   12360000
FETCHRND CLC   SAVEHWM,ADDRS       SEE IF VTOC FINISHED                 12370000
         BL    PRMAP               GO PRINT OUT MAP OF DISK             12380000
F1DSCBS  OBTAIN  LIST              NEXT DSCB                            12390000
         LTR   R15,R15             CHECK FOR SUCCESS                    12400000
         BNZ   CHECKIT1            JUMP IF BAD                  GP09136 12410000
         LA    R10,WORK            RE INSTATE FOR NEXT TWO CHECKS       12420000
         CLI   DS4IDFMT,0          CHECK FOR FORMAT 0                   12430000
         BE    FETCHNXT            IGNORE IF SO                         12440000
         CLC   SAVEHWM,DS1PTRDS    SEE IF CHAIN ADDRESS HIGHER THAN     12450000
         BNL   CHECKF1             ANY SO FAR.  BRANCH IF NOT           12460000
         MVC   SAVEHWM,DS1PTRDS    SAVE IT IF SO                        12470000
CHECKF1  CLI   DS4IDFMT,C'1'       CHECK FOR FORMAT 1                   12480000
         BE    FORMAT1             GO PROCESS                           12490000
         SH    R7,H160             BACK UP ENTRY                        12500000
         CL    R7,DSEND            TABLES OVERLAPPED?                   12510000
         BNH   TABLOVF0            YES                                  12520000
         ST    R7,F356END          STORE NEW END                        12530000
         LA    R1,4(R7)                                                 12540000
         ST    R1,0(R7)            STORE PTR TO DSCB                    12550000
         MVC   4(140,R7),WORK      SAVE DSCB                            12560000
         MVC   144(8,R7),SEEK      SAVE CCHHR                           12570000
         B     FETCHNXT            GO GET NEXT DSCB                     12580000
         EJECT                                                          12590000
FORMAT1  DS    0H                                                       12600000
         NOP   SORTGEN                                                  12610000
SORTGEN  DS    0H                                                       12620000
         L     R3,DSEND            END OF TABLE                         12630000
         MVC   4(140,R3),WORK      SAVE DSCB                            12640000
         MVC   144(8,R3),SEEK      SAVE CCHHR                           12650000
         LA    R1,4(R3)            PTR TO DSCB                          12660000
         LA    R3,160(R3)          NEW END                              12670000
         CL    R3,F356END          TABLES OVERLAPPED?                   12680000
         BNL   TABLOVF0            YES                                  12690000
         ST    R3,DSEND            SAVE NEW END                         12700000
         L     R3,DSTBL            START OF TABLE                       12710000
         SH    R3,H160                                                  12720000
         L     R4,NTRKNT           NO OF ENTRIES                        12730000
SORTF12  DS    0H                                                       12740000
         BCT   R4,SORTF11                                               12750000
         ST    R1,160(R3)          STORE DSCB PTR                       12760000
SORTF14  L     R4,NTRKNT           BRING IN COUNT                       12770000
         LA    R4,1(R4)            TO BOOST BY ONE                      12780000
         ST    R4,NTRKNT                                                12790000
         B     FETCHNXT            GO GET NEXT DSCB                     12800000
SORTF11  LA    R3,160(R3)          BOOST TABLE ADDR                     12810000
         L     R5,0(R3)            POINTER TO DSCB                      12820000
         CLC   WORK(44),0(R5)      LOOK AT DSNAME                       12830000
         BH    SORTF12             JUMP AROUND IF IT DOES NOT FIT       12840000
SORTF13  ST    R1,0(R3)            PUT ADDRESS IN TABLE                 12850000
         LR    R1,R5               LAST ADDRESS MOVED AROUND            12860000
         L     R5,160(R3)          NEXT ADDR                            12870000
         LA    R3,160(R3)          BOOST TO NEXT                        12880000
         BCT   R4,SORTF13          MOVE ALL UP                          12890000
         ST    R1,0(R3)            PUT OUT LAST ADDRESS                 12900000
         B     SORTF14             FINISH UP THIS DSCB                  12910000
         SPACE 1                                                        12920000
CHECKIT1 C     R15,=F'8'           MIDDLE OF AREA                       12930000
         BL    VOL1                                                     12940000
         BE    FETCHNXT                                                 12950000
         B     IOER                                                     12960000
         EJECT                                                          12970000
PRMAP    DS    0H                                                       12980000
         NI    HEADER+1,X'0F'      PRINT FULL HEADER                    12990000
         BAL   R14,HEADING         PRINT HEADING                        13000000
         L     R9,DSEND                                                 13010000
         ST    R9,SRTBL            SRT TABLE                            13020000
         ST    R9,SREND                                                 13030000
         L     R9,F356END                                               13040000
         ST    R9,ACCTABLE         ACC TABLE                            13050000
         ST    R9,ACCEND                                                13060000
         MVI   OUTBIN,C'0'         SKIP TO NEXT LINE, ONE BLANK LINE    13070000
         MVC   DATANAME(4),=C'VTOC'                                     13080000
         LA    R1,DS4VTOCE         PUT OUT EXTENT SIZE                  13090000
         BAL   R14,ABTOREL         CONVERT TO RELATIVE TRACKS R2 BACK   13100000
         LA    R3,1                PSUEDO EXTENT NO 1                   13110000
         BAL   R14,STORMAP         STORE EXTENT FOR MAP R1,R2,DATANAME  13120000
         BAL   R14,LENGTH          FIND LENGTH OF DATA SET R2-R3 BACK   13130000
         BAL   R14,NEDIT           PREPARE TO PRINT R3,R1               13140000
         MVC   SPALLOC,EDITWA+3    PUT IN SPACE USED                    13150000
         LR    R9,R2               SAVE TOTAL FOR AWHILE                13160000
         MVC   HOLD+4(4),DS4HPCHR  GET END MARKER                       13170000
         SRL   R2,16                                                    13180000
         BAL   R14,ABTOREL1        DO ONLY USED                         13190000
         BAL   R14,LENGTH                                               13200000
         BAL   R14,NEDIT                                                13210000
         MVC   SPUSED,EDITWA+3     PUT IN SPACE USED                    13220000
         BAL   R14,LINETEST        TEST PAGE EJECT                      13230000
         PUT   PRINT,OUTBIN        PRINT LINE OF OUTPUT                 13240000
         LR    R2,R9               OUT OF ICE                           13250000
         LA    R3,1                EXTENT NUMBER                        13260000
         BAL   R14,FULLEDIT        DO FULL EDIT                         13270000
         BAL   R14,LINE1OUT                                             13280000
         NI    GENOPT,FF-GENSMS    RESET FLAG                           13290000
         TM    DS4SMSFG,DS4SMSCV   SMS VOLUME?                          13300000
         BNO   PRL0001             BRANCH IF NO                         13310000
         MVC   DSORG,=CL4'SMS'     YES, REPORT IT                       13320000
         OI    GENOPT,GENSMS       AND SET FLAG                         13330000
         SPACE 1                                                        13340000
PRL0001  DS    0H                  CONTINUE                             13350000
         TM    DS4VTOCI,DS4DOSBT+DS4IVTOC  INDEXED VTOC ?               13360000
         BNO   DOSONLY             BRANCH IF NO                         13370000
         MVC   DATANAME(10),=CL10'FREE SPACE'                           13380000
         EJECT                                                          13390000
*********************************************************************   13400000
*                                                                       13410000
*         START INDEXED VTOC/OS VTOC ROUTINE FOR FREE SPACE INFO.       13420000
*         LINK TO IXVTOCF5 PROGRAM IF IT IS INDEXED.                    13430000
*                                                                       13440000
*********************************************************************   13450000
         MVC   DATANAME+L'DATANAME-7(7),=C'IX VTOC'                     13460000
         L     R14,CVTPTR          GET CVT                      GP09136 13470000
         TM    CVTDCB-CVTMAP(R14),X'80'  XA OR LATER? (CVTMSE)  GP09136 13480000
         BO    CARON                                            GP09136 13490000
         NI    SAVEF4+58,255-DS4IVTOC  CVAF NOT AVAILABLE       GP09136 13500000
DOSONLY  TM    DS4VTOCI,DS4DOSBT   TEST FOR DSCB 5                      13510000
         BO    DOF1S               NO DSCB 5 JUMPS                      13520000
         MVC   DATANAME(10),=CL10'FREE SPACE'                           13530000
*OLD*    MVC   DATANAME+L'DATANAME-30(30),=C'* NOT AN IX VTOC--INFORM TX13540000
               SG                  *'                                   13550000
         MVC  DATANAME+L'DATANAME-30(18),=C'* NOT AN IX VTOC *' GP09136 13560000
BLANK    EQU   X'40'               *                                    13570000
CARON    MVI   SPUSED,BLANK        *****    CLEAR USED SPACE            13580000
         MVC   SPUSED+1(4),SPUSED  *                                    13590000
         L     R10,F356TBL         START OF TABLE                       13600000
         SH    R10,H160                                                 13610000
         L     R10,0(R10)          ADDR FO F5 DSCB                      13620000
         SR    R3,R3               CLEAR EXTENT COUNT                   13630000
         TM    SAVEF4+58,DS4DOSBT+DS4IVTOC  INDEXED VTOC ?              13640000
         BO    IXVTOC1             BRANCH IF YES                        13650000
         CLI   DS5FMTID,C'5'       CHECK FOR 5                          13660000
         BNE   IOER1               BAD, GO TO NEXT VOL                  13670000
IXVTOC1  L     R9,ACCTABLE         GET TO START OF ACCUM TABLE          13680000
         SR    R1,R1               CLEAR ACCUM REG.                     13690000
         TM    SAVEF4+58,DS4DOSBT+DS4IVTOC  INDEXED VTOC ?              13700000
         BNO   NEXTDS              BRANCH IF NO                         13710000
         XC    PSEUDOF5,PSEUDOF5   YES, CLEAR BUFFER TO INDICATE 1ST    13720000
IXVTOC2  L     R4,UCBXREF          LOAD UCB ADDRESS                     13730000
         LA    R5,PSEUDOF5         POINT R5 TO BUFFER OF PSEUDO DSCB F5 13740000
         LINK  EP=IXVTOCF5         ASK FOR IT                           13750000
         DROP  R10                 DROP CURRENT ADDRESSABILITY          13760000
         USING DSCBS,R4            ESTABLISH TEMPORARY ADDRESSABILITY   13770000
PSEUDGO  LA    R4,PSEUDOF5         POINT R4 TO PSEUDO DSCB FORMAT 5     13780000
         LA    R5,8                ESTABLISH LOOP FOR THE FIRST 8 EXTS  13790000
         LA    R4,DS5AVEXT         POINT R4 TO AREA OF EXTENTS          13800000
         BAL   R14,NOTHER          DECODE FIRST EIGHT EXTENTS           13810000
         LA    R4,PSEUDOF5         POINT R4 TO PSEUDO DSCB FORMAT 5     13820000
         LA    R5,18               ESTABLISH LOOP FOR THE LAST 18 EXTS  13830000
         LA    R4,DS5MAVET         POINT R4 TO AREA OF EXTENTS          13840000
         BAL   R14,NOTHER          DECODE LAST 18 EXTENTS               13850000
         LA    R4,PSEUDOF5         POINT R4 TO PSEUDO DSCB FORMAT 5     13860000
         C     R5,DS5PTRDS+1       CHECK IF MORE EXTENTS                13870000
         BE    ENDDSCB5            NO, QUIT                             13880000
         B     IXVTOC2             YES, GO READ NEXT ONE                13890000
         DROP  R4                  DROP TEMPORARY ADDRESSABILITY        13900000
         USING DSCBS,R10           RE-ESTABLISH NORMAL ADDRESSABILITY   13910000
NEXTDS   LA    R5,8                8 FIELDS FIRST                       13920000
         LA    R4,DS5AVEXT         AREA OF EXTENTS                      13930000
         BAL   R14,NOTHER          DO FIRST 8 EXTENTS                   13940000
         LA    R5,18               LAST IN DSCB                         13950000
         LA    R4,DS5MAVET                                              13960000
         BAL   R14,NOTHER          DO LAST 18 EXTENTS                   13970000
         C     R5,DS5PTRDS+1       CHECK IF ONE MORE DSCB5 AROUND       13980000
         BE    ENDDSCB5            NO, QUIT                             13990000
         BAL   R14,SRCHDSCB        GO SEARCH FOR DSCB 5                 14000000
         B     NEXTDS              KEEP GOING TILL END                  14010000
ENDDSCB5 SH    R9,H4                                                    14020000
         MVC   0(4,R9),=F'0'       END OF LIST                          14030000
         ST    R9,ACCEND           SAVE ADDR                            14040000
         BAL   R14,NEDIT           MAKE EXTENT COUNT PRINTABLE          14050000
         MVC   EXTENTS,EDITWA+5    AND PRINT IT                         14060000
         LR    R3,R1               COUNT IN PARM AREA                   14070000
         BAL   R14,NEDIT           READY FOR PRINT                      14080000
         MVC   SPALLOC,EDITWA+3    PUT IN SPACE ALLOCATED               14090000
         GOSUB SUMMARY             GO CREATE SUMMARY RECORD             14100000
         PUT   PRINT,OUTBIN                                             14110000
         MVC   DATANAME,=CL44'          FREE SPACE                    ' 14120000
         B     PRNTCOM             GO PRINT AND SORT ALL EXTENTS        14130000
         EJECT                                                          14140000
*********************************************************************   14150000
*                                                                       14160000
*         PROCESS FREE SPACE EXTENTS                                    14170000
*                                                                       14180000
*********************************************************************   14190000
         SPACE 1                                                        14200000
NOTHER   DS    0H                                                       14210000
         SUBIN SAVE=(R3)           SUBROUTINE ENTRY                     14220000
NOTHER1  DS    0H                  PROCESS ONE EXTENT                   14230000
         MVC   WORK(5),0(R4)       LOAD UP  EXTENT VALUE                14240000
         SR    R15,R15             CLEAR WORKING REGISTER               14250000
         ICM   R15,B'0011',WORK+2                                       14260000
         MH    R15,SAVEF4+64                                            14270000
         SR    R2,R2                                                    14280000
         IC    R2,WORK+4                                                14290000
         AR    R15,R2              FIRST TRACK PLUS CYLINDER            14300000
         BZ    ENDDSCB5            DONE IF NOTHING THERE                14310000
         AR    R1,R15              ACCUMULATE TOTAL                     14320000
         ICM   R2,B'0011',WORK                                          14330000
         AR    R15,R2              STOP ADDRESS PLUS ONE                14340000
         SLL   R2,16               MOVE TO LEFT                         14350000
         ALR   R2,R15              ALL TOGETHER                         14360000
         BCTR  R2,0                LESS ONE                             14370000
         SH    R9,H4               NEXT ENTRY                           14380000
         CL    R9,SREND            TABLE OVFL?                          14390000
         BNH   TABLOVF0            YES                                  14400000
         ST    R2,0(R9)            PUT IT AWAY IN ACCUM                 14410000
         LA    R4,5(R4)            GO TO NEXT ONE                       14420000
         LA    R3,1(R3)            COUNT EXTENTS                        14430000
         BCT   R5,NOTHER1          GO DO FOR NEXT                       14440000
         SPACE 1                                                        14450000
         SUBOUT RETURN=(R14)       RETURN TO CALLER                     14460000
         EJECT                                                          14470000
*********************************************************************   14480000
*                                                                       14490000
*         START REAL DATA SET PRINT OUTS HERE, THRU WITH 4 AND 5        14500000
*         DO  FORMAT  1  DSCB'S                                         14510000
*                                                                       14520000
*********************************************************************   14530000
FINEST   ST    R4,NTRKNT           STORE CORRECT VALUE FOR COUNT        14540000
NXTF1    NOP   DONXTF1             BR ALWAYS EXCEPT 1ST TIME            14550000
         OI    NXTF1+1,X'F0'       SET BR ON                            14560000
         BAL   R14,HEADING         START NEW PAGE FOR DATA SETS         14570000
         MVC   ANXTDSCB,DSTBL      SET START OF DSCB TABLE              14580000
DONXTF1  DS    0H                  PROCESS NEXT DSCB                    14590000
         L     R1,ANXTDSCB         GET ADDRESS OF NEXT DSCB TABLE ENTRY 14600000
         L     R10,0(R1)           ADDRESS OF DSCB IS IN                14610000
         MVC   DATANAME,DS1DSNAM   BRING IN NAME OF DATA SET            14620000
         LA    R1,DS1CREDT         LOAD ADDRESS OF CREATION DATE        14630000
         LA    R2,CRDATE           PLACE TO STORE                       14640000
         BAL   R14,CALEN           GO DO CALENDAR                       14650000
         LA    R1,DS1EXPDT         PICKUP EXPIRY DATE                   14660000
         LA    R2,PURGDATE         STORE                                14670000
         BAL   R14,CALEN           GO DO CALENDAR                       14680000
         LA    R1,DS1REFD          PICKUP LAST-REFERENCED DATE          14690000
         LA    R2,REFDATE          STORE                                14700000
         BAL   R14,CALEN           GO DO CALENDAR                       14710000
         ICM   R14,B'0111',0(R1)   TEST IF EVER REFERENCED              14720000
         BNZ   *+4+4               YES, USE THAT DATE                   14730000
         LA    R1,DS1CREDT         NO,COUNT FROM CREATE DATE            14740000
         GOSUB STDDAY01            GO CONVERT REFERENCE DATE            14750000
         STH   R1,STDREF           SAVE VALUE                           14760000
         SPACE 1                                                        14770000
TYPON    SR    R3,R3                                                    14780000
         IC    R3,DS1NOEPV         GET EXTENT NO.                       14790000
         BAL   R14,NEDIT           BRANCH TO THE EDIT                   14800000
         MVC   EXTENTS,EDITWA+5    PUT IN EXTENTS                       14810000
         CLI   DS1EXT1,X'40'       USER LABEL TRACK PRESENT?    GP09136 14820000
         BNE   *+8                   NO                         GP09136 14830000
         LA    R3,1(,R3)           ALLOW FOR ADDITIONAL EXTENT  GP09136 14840000
         ST    R3,EXTKNT           STORE EXTENT VALUE FOR CALCULATIONS  14850000
SEC2     L     R9,ACCTABLE         NOW READY TO FIND PRIMARY ALLOC      14860000
         LH    R3,DS1LSTAR         RELATIVE NUMBER OF TRACKS USED       14870000
         CLI   DS1LSTAR+2,X'00'    PARTIAL TRACK USED?                  14880000
         BE    *+8                 NO. SKIP NEXT INSTN.                 14890000
         LA    R3,1(0,R3)          ADD 1 FOR PARTIAL TRACK USED         14900000
         ST    R3,THISUSED         SAVE THIS VALUE                      14910000
         TM    DS1DSORG,X'42'      PS/PO ?                      GP09136 14920000
         BZ    SKIPPCTU            NO; USAGE NOT AVAILABLE      GP09136 14930000
         BAL   R14,NEDIT           BRANCH TO THE EDIT                   14940000
         MVC   SPUSED,EDITWA+3     PUT IN SPACE USED                    14950000
SKIPPCTU XC    DSLEN,DSLEN         CLEAR ACCUMULATOR                    14960000
         LA    R1,DS1EXT1          F1 FIRST EXTENT                      14970000
         L     R5,EXTKNT           NUMBER OF EXTENTS                    14980000
         LTR   R5,R5               TEST FOR AN EMPTY DATA SET           14990000
         BZ    EXTSS3              JUMP IF EMPTY                        15000000
         C     R5,=F'3'            CHECK FOR ALL EXTENTS IN F1          15010000
         BNH   *+4+4               YES, USE THIS VALUE                  15020000
         LA    R5,3                SET FOR FIRST 3                      15030000
         L     R14,EXTKNT          EXTENT COUNT BACK                    15040000
         SR    R14,R5              REDUCE BY THOSE TO BE DONE NOW       15050000
         ST    R14,EXTKNT          SAVE NEW EXTENT COUNT                15060000
         BAL   R14,ALLSUM          SUM UP ALLOCATION                    15070000
         EJECT                                                          15080000
EXTSS1   DS    0H                  CHECK FOR FMT 3 DSCB                 15090000
         L     R5,EXTKNT           EXTENT COUNT BACK                    15100000
         LTR   R5,R5               CHECK FOR MORE EXTENTS               15110000
         BNP   EXTSS3              THRU                                 15120000
         BAL   R14,SRCHDSCB        GET NEW FORMAT 3 DSCB                15130000
         CLI   DS3FMTID,C'3'       IS THIS A FORMAT3            GP09136 15140000
         BE    EXTDO3              BRANCH IF YES                GP09136 15150000
         BAL   R14,SRCHDSCB        GO GET FORMAT 3                      15160000
EXTDO3   DS    0H                                                       15170000
         LA    R1,DS3EXTNT         START OF GROUP                       15180000
         MVC   10*4(9*10,R1),DS3ADEXT  MAKE EXTENTS CONTIGUOUS  GP09136 15190000
         L     R5,EXTKNT           EXTENT COUNT BACK                    15200000
         C     R5,=F'13'           13 MORE FIELDS ?             GP09136 15210000
         BNH   *+4+4               YES, USE THIS VALUE                  15220000
         LA    R5,13               SET TO 13                    GP09136 15230000
         L     R14,EXTKNT          EXTENT COUNT BACK                    15240000
         SR    R14,R5              REDUCE BY THOSE TO BE DONE NOW       15250000
         ST    R14,EXTKNT          SAVE NEW EXTENT COUNT                15260000
         BAL   R14,ALLSUM          SUM UP SOME MORE                     15270000
         B     EXTSS1              GO TEST FURTHER EXTENTS              15280000
         EJECT                                                          15290000
EXTSS3   L     R3,DSLEN            PUT IN OUTPUT AREA                   15300000
         ST    R3,THISALLC         SAVE FOR LATER                       15310000
         BAL   R14,NEDIT           PUT OUT TOTAL                        15320000
         MVC   SPALLOC,EDITWA+3    PUT IN TOTAL ALLOCATED               15330000
         SH    R9,H4                                                    15340000
         MVC   0(4,R9),=F'0'       INDICATE END OF LIST BY ZERO         15350000
         CL    R9,SREND                                                 15360000
         BNH   TABLOVF0                                                 15370000
         ST    R9,ACCEND                                                15380000
         L     R1,ANXTDSCB         GET ADDRESS OF CURRENT TABLE ENTRY   15390000
         L     R10,0(R1)           POINT BACK TO F1                     15400000
         TM    DS1DSORG,X'02'                                           15410000
         BZ    NOPDS                                                    15420000
         TM    PARMSWCH,X'FF'      IF PARM NOT 'PDS' .......            15430000
         BZ    NOPDS               .... THEN BYPASS                     15440000
         RDJFCB  (UTILITY)         READ IN PARMS                        15450000
         LA    R4,PDSAREA          ESTABLISH ADDRESSABILITY             15460000
         USING IEFJFCBN,R4         FOR JFCB                             15470000
         MVC   JFCBDSNM(44),DS1DSNAM                                    15480000
         MVI   JFCBNVOL,1          ONE VOLUME                           15490000
         MVC   JFCBVOLS(6),SAVESER  PUT IN VOLUME SERIAL NUMBER         15500000
         OI    JFCBIND2,JFCSHARE   SET DISP FOR SHARED USE              15510000
         OI    JFCBTSDM,JFCNWRIT   DO NOT UPDATE LAST REFERENCE  *DHC*  15520000
         MVC   JFCBCRDT(6),DS1CREDT MOVE IN BOTH DATES                  15530000
         DROP  R4                  END JFCB ADDRESSABILITY              15540000
         SPACE 1                                                        15550000
         OPEN  (UTILITY,(INPUT)),TYPE=J                                 15560000
         SR    R2,R2               JUST ZERO FOR TEST                   15570000
         SR    R3,R3               CLEAR NO. USED REG                   15580000
         SR    R4,R4               CLEAR TOTAL SIZE REG                 15590000
         SR    R5,R5               ZEROIZE FOR NO. MEMBS STEP           15600000
PDSLOOP  GET   UTILITY,WORK                                             15610000
         CH    R2,WORK             SEE IF BLOCK IS USED                 15620000
         BZ    PDSLOP              IF ZERO, AVAILABLE                   15630000
         EJECT                                                          15640000
*********************************************************************   15650000
*       INSERT NEW ROUTINE HERE FOR NUMBER OF MEMBERS IN A PDS          15660000
*********************************************************************   15670000
MEMBERS  LR    R0,R3               SAVE REGISTER 3                      15680000
         LA    R3,WORK             LOAD LENGTH                          15690000
         AH    R3,WORK             ADD LENGTH                           15700000
         LA    R1,WORK+2           MOVE TO START                        15710000
TESTNEXT MVC   WBYTE,11(R1)        SAVE LENGTH VARIABLE FIELDS          15720000
         NI    WBYTE,X'1F'         ZEROIZE 3 FIRST BITS (USED FLAG)     15730000
         IC    R2,WBYTE            LOAD LENGTH                          15740000
         SLA   R2,1                MULTIPLY BY 2                        15750000
         LA    R1,12(R2,R1)        POINT R1 TO NEXT MEMBER              15760000
         A     R5,=F'1'            INCREMENT MEMBERS COUNT BY 1         15770000
         CR    R3,R1               IS IT END OF CURRENT DIR. BLK.?      15780000
         BE    ENDMEMB             YES...QUIT LOOP                      15790000
         B     TESTNEXT            NO....GO PROCESS NEXT ONE            15800000
ENDMEMB  LR    R3,R5               MAKE R3 NO. OF MEMBERS               15810000
         S     R3,=F'1'            TAKE ONE OFF ..........              15820000
*                                 FOR SOME REASON ONE TOO MANY ¦¦       15830000
         BAL   R14,NEDIT           GO TO EDIT ROUTINE                   15840000
         MVC   ISRKP+2,EDITWA+3    PUT NO. IN ISRKP (+A BIT) AREA       15850000
         LR    R3,R0               RESTORE REGISTER 3                   15860000
         SR    R2,R2               ZEROIZE REGISTER 2                   15870000
*********************************************************************   15880000
         A     R3,=F'1'                                                 15890000
PDSLOP   A     R4,=F'1'                                                 15900000
         B     PDSLOOP             MERRY GO ROUND TILL EOV (DS END)     15910000
PDSEND   LA    R1,DRBLUSED                                              15920000
         BAL   R14,NEDIT           BLOCKS USED                          15930000
         MVC   DRBLUSED,EDITWA+4   PUT IN DIRECTORY BLOCKS USED         15940000
         LR    R3,R4                                                    15950000
         BAL   R14,NEDIT           TOTAL NUMBER OF BLOCKS               15960000
         MVC   DRBLOCKS,EDITWA+4   PUT IN DIRECTORY BLOCKS ALLOC.       15970000
CLOSEPDS DS    0H                                                       15980000
         CLOSE (UTILITY)           READY FOR NEXT ROUND                 15990000
         EJECT                                                          16000000
********************************************************************    16010000
*                                                                       16020000
*         CHECK DATA SET ORGANIZATION                                   16030000
*                                                                       16040000
********************************************************************    16050000
NOPDS    DS    0H                  WE ENDED PDS PROCESSING              16060000
         L     R1,ANXTDSCB         GET NEXT DSCB ADDRESS                16070000
         LA    R1,160(R1)          INCREMENT TABLE ENTRY LENGTH         16080000
         ST    R1,ANXTDSCB         SAVE THE RESULT                      16090000
         LA    R5,DSORG                                                 16100000
         MVI   0(R5),BLANK         CLEAR AREA                           16110000
         MVC   1(3,R5),0(R5)       CLEAR AREA                           16120000
         ICM   R3,3,DS1RKP         ANY RKP ?                    GP09136 16130000
         BZ    TESTKEY             NO; SEE WHETHER KEY - ZERO   GP09136 16140000
         SR    R3,R3               CLEAR REGISTER 3             GP09136 16150000
         ICM   R3,B'0011',DS1RKP   AS ITS I.S. DO RKP STATS     GP09136 16160000
         BAL   R14,NEDIT           BRANCH TO NEDIT              GP09136 16170000
         MVC   ISRKP,EDITWA+3      PUT IN RELATIVE KEY POSITION GP09136 16180000
         B     SHOWKEY             IF RKP - 0, SHOW KEYLN       GP09136 16190000
TESTKEY  ICM   R3,1,DS1KEYL        IS THERE A KEY ?             GP09136 16200000
         BZ    DEFERKEY            NO; SHOW ONLY FOR ISAM       GP09136 16210000
SHOWKEY  SR    R3,R3               CLEAR REGISTER 3             GP09136 16220000
         IC    R3,DS1KEYL          ALSO DO KEY LENGTH STATS     GP09136 16230000
         BAL   R14,NEDIT           BRANCH TO NEDIT              GP09136 16240000
         MVC   ISKEYLEN,EDITWA+5   PUT IN KEY LENGTH            GP09136 16250000
DEFERKEY TM    DS1DSORG,X'FF'      CHECK TO SEE IF ANYTHING THERE       16260000
         BNZ   QUESTION            IF THERE IS -- BRANCH                16270000
         TM    DS1DSORG+1,X'08'    PUT CHECK ON NEXT BIT (VSAM)         16280000
         BZ    QUESTION            BRANCH IF NOT                        16290000
         MVC   0(L'CHARVSAM,R5),CHARVSAM   YES, PUT IT IN REPORT        16300000
         B     CHBIT3              AND BYPASS OTHER ORGS                16310000
QUESTION DS    0H                  LOOK AT DSORG                        16320000
         MVC   0(2,R5),=C'??'      IF NOT PUT IN EXCLAMATION MARKS      16330000
         TM    DS1SMSFG,DS1PDSE    IS IT A PDSE?                        16340000
         BZ    CHBITHF             NO, TRY SOMETHING ELSE               16350000
         MVC   0(4,R5),=C'PDSE'    YES, SHOW THAT                       16360000
*        B     CHBIT4              END OF STORY                         16370000
CHBITHF  TM    DS1SMSFG,DS1PDSEX   IS IT A HFS FILE?                    16380000
         BZ    CHBIT01             NO, TRY SOMETHING ELSE               16390000
         MVC   0(4,R5),=C'HFS '    YES, SHOW THAT                       16400000
         B     CHBIT4              END OF STORY                         16410000
CHBIT01  TM    DS1DSORG,X'40'      SEE IF BIT IS THERE                  16420000
         BZ    CHBIT1              BRANCH IF NOT                        16430000
         MVC   0(2,R5),=C'PS'      IF SO PUT IN TYPE--SEQUENTIAL        16440000
         LA    R5,2(R5)                                                 16450000
CHBIT1   TM    DS1DSORG,X'20'      PUT CHECK ON NEXT BIT                16460000
         BZ    CHBIT2              BRANCH IF NOT                        16470000
         MVC   0(2,R5),=C'DA'      IF SO PUT IN TYPE--DIRECT ACCESS     16480000
         LA    R5,2(R5)                                                 16490000
CHBIT2   TM    DS1DSORG,X'02'      CHECK MORE BITS                      16500000
         BZ    CHBIT25             BRANCH IF NOT                        16510000
         MVC   0(2,R5),=C'PO'      IF SO PUT IN TYPE--PARTITIONED       16520000
         LA    R5,2(R5)                                                 16530000
CHBIT25  TM    DS1DSORG,X'80'      CHECK FOR INDEXED SEQ.               16540000
         BZ    CHBIT3              BRANCH IF NOT                        16550000
         MVC   0(2,R5),=C'IS'      IF SO PUT IN TYPE--ISAM              16560000
         LA    R5,2(,R5)                                                16570000
         SR    R3,R3               CLEAR REGISTER 3                     16580000
         ICM   R3,B'0011',DS1RKP   AS ITS I.S. DO RKP STATS             16590000
*************** NOTE:- DS1RKP NOT ON HALF-WORD BOUNDARY, HENCE ICM      16600000
         BAL   R14,NEDIT           BRANCH TO NEDIT                      16610000
         MVC   ISRKP,EDITWA+3      PUT IN RELATIVE KEY POSITION         16620000
         SR    R3,R3               CLEAR REGISTER 3             GP09136 16630000
         IC    R3,DS1KEYL          ALSO DO KEY LENGTH STATS             16640000
         BAL   R14,NEDIT           BRANCH TO NEDIT                      16650000
         MVC   ISKEYLEN,EDITWA+5   PUT IN KEY LENGTH                    16660000
CHBIT3   TM    DS1DSORG,X'01'      CHECK MORE BITS                      16670000
         BZ    CHBIT4              BRANCH IF NOT                        16680000
         MVI   0(R5),C'U'          IF SO PUT IN TYPE--UNMOVABLE         16690000
         EJECT                                                          16700000
********************************************************************    16710000
*                                                                       16720000
*         CHECK RECORD FORMAT                                           16730000
*                                                                       16740000
********************************************************************    16750000
CHBIT4   LA    R5,RECFM                                                 16760000
         MVI   0(R5),BLANK         CLEAR AREA FROM TIME BEFORE          16770000
         MVC   1(4,R5),0(R5)                                            16780000
         MVC   0(1,R5),=C'?'       IF NOT PUT IN EXCLAMATION MARK       16790000
         TM    DS1RECFM,X'FF'      CHECK TO SEE IF NOTHING THERE        16800000
         BZ    CHBIT13             SKIP AROUND                  GP09136 16810000
CHBITNO  LM    R15,R1,=A(TABREC,2,TABRECN)  POINT TO RECFMS     GP09136 16820000
         MVC   FW(1),DS1RECFM      MAKE WORKING COPY            GP09136 16830000
         SR    R14,R14               FOR IC                     GP09136 16840000
         TM    DS1RECFM,X'C0'      ANY OF F, U, V ?             GP09136 16850000
         BZ    CHBIT4LP            YES; ELSE ALLOW D            GP09136 16860000
         AR    R15,R0              SKIP RECFM=D ENTRY           GP09136 16870000
CHBIT4LP IC    R14,0(,R15)         GET TEST BIT                 GP09136 16880000
         EX    R14,EXRECFTM        SEE IF BIT(S) ON             GP09136 16890000
         BNO   CHBIT4UP            NO; TRY NEXT                 GP09136 16900000
         MVC   0(1,R5),1(R15)      MOVE RECFM CHAR              GP09136 16910000
         LA    R5,1(,R5)           ADVANCE                      GP09136 16920000
         EX    R14,EXRECFXI        TURN BIT(S) OFF              GP09136 16930000
CHBIT4UP BXLE  R15,R0,CHBIT4LP     TRY NEXT                     GP09136 16940000
         B     CHBIT13             GO IN                                16950000
         SPACE 1                                                        16960000
EXRECFTM TM    FW,*-*              TEST BIT ON                  GP09136 16970000
EXRECFXI XI    FW,*-*              TURN BIT OFF                 GP09136 16980000
TABREC   DC    X'20',C'D'          RECFM=D                      GP09136 16990000
TABRECU  DC    X'C0',C'U'          RECFM=U                      GP09136 17000000
         DC    X'80',C'F'          RECFM=F                      GP09136 17010000
         DC    X'40',C'V'          RECFM=V                      GP09136 17020000
         DC    X'20',C'T'          RECFM=.T                     GP09136 17030000
         DC    X'10',C'B'          RECFM=.B                     GP09136 17040000
         DC    X'08',C'S'          RECFM=.S                     GP09136 17050000
         DC    X'04',C'A'          RECFM=..A                    GP09136 17060000
TABRECN  DC    X'02',C'M'          RECFM=..M                    GP09136 17070000
         EJECT                                                          17080000
********************************************************************    17090000
*                                                                       17100000
*         CHECK BLOCKSIZE, LRECL, ALLOC UNITS ETC                       17110000
*                                                                       17120000
********************************************************************    17130000
CHBIT13  LH    R3,DS1BLKL          BRING IN BLOCK SIZE                  17140000
         BAL   R14,NEDIT                                                17150000
         MVC   BLKSIZE,EDITWA+3    PUT IN BLOCKSIZE                     17160000
         MVI   LRECL+2,C'X'        PRESET FOR LRECL=X           GP09136 17170000
         LH    R3,DS1LRECL         RECORD LENGTH                        17180000
*GYP*    LTR   R3,R3               LRECL=X ?                    GP09136 17190000
*GYP*    BM    RECLX               YES                          GP09136 17200000
         N     R3,=X'0000FFFF'     TREAT X'8000' AS POSITIVE    GP09136 17210000
         BAL   R14,NEDIT           SYMBOLS IN                           17220000
         MVC   LRECL,EDITWA+3      PUT IN LRECL                         17230000
         SPACE 1                                                        17240000
RECLX    TM    DS1DSIND,DS1DSCHA   TEST DATA-SET-CHANGED BIT            17250000
         BNO   SEAG001             NOT ON, PASS                         17260000
         MVI   DSCHA,C'*'          SHOW DATA SET CHANGED                17270000
         SPACE 1                                                        17280000
SEAG001  DS    0H                  JUST A LABEL                         17290000
         MVC   ALUNIT,=C' CYL '                                         17300000
         TM    DS1SCALO,X'C0'      CHECK FOR CYLINDER                   17310000
         BO    CHBIT14             IT IS IF JUMPS                       17320000
         MVC   ALUNIT,=C' TRK '                                         17330000
         TM    DS1SCALO,X'40'      TEST FOR BLOCK ALLOCATION            17340000
         BNO   TRKS                BRANCH IF NOT BLOCKS                 17350000
         MVC   ALUNIT,=C' BLK '                                         17360000
         EJECT                                                          17370000
*********************************************************************   17380000
*                                                                       17390000
*         ROUTINE TO CALCULATE BLOCKS PER TRACK                         17400000
*                                                                       17410000
*********************************************************************   17420000
         SPACE 2                                                        17430000
STARRING DS    0H                  INVOKE STAR SERVICES                 17440000
         SR    R0,R0               ASSUME NO ANSWER                     17450000
         SR    R1,R1               CLEAR REG.                           17460000
         IC    R1,DS1KEYL          GET KEY LENGTH                       17470000
         STH   R1,RKDD             SAVE R=0 AND K=KEYLEN                17480000
         MVI   RKDD,1              SET R=1 FOR TRACK CAPACITY           17490000
         LH    R1,DS1BLKL          NOW GET BLOCKSIZE                    17500000
         LTR   R1,R1               TEST FOR VALUE                       17510000
         BZ    STARROUT            EXIT IF NONE                         17520000
         STH   R1,RKDD+2           SAVE DD=BLOCKSIZE                    17530000
         SPACE 1                                                        17540000
         TRKCALC FUNCTN=TRKCAP,UCB=UCBXREF,                            X17550000
               RKDD=RKDD,                                              X17560000
               REGSAVE=YES,MF=I    STAR MACRO                           17570000
         SPACE 1                                                        17580000
STARROUT DS    0H                  EXIT FROM STAR ROUTINE               17590000
         LH    R3,DS1SCALO+2       BLKS REQUESTED/BLKS PER TRK=TRKS     17600000
         LTR   R3,R3               TEST FOR VALUE                       17610000
         BZ    CHBIT15             SKIP IF ZERO                         17620000
         LTR   R14,R0              GET BLOCKS PER TRACK                 17630000
         BZ    CHBIT15             SKIP IF ZERO                         17640000
         XR    R2,R2                                                    17650000
         DR    R2,R14                                                   17660000
         LTR   R2,R2               SEE IF REMAINDER                     17670000
         BZ    CHBIT15                                                  17680000
         LA    R3,1(R3)            BUMP IF REMAINDER                    17690000
         B     CHBIT15                                                  17700000
         EJECT ,                                                        17710000
CHBIT14  LH    R3,DS1SCALO+2       GET 2ND ALLOCATION                   17720000
         MH    R3,SAVEF4+64                                             17730000
         B     CHBIT15                                                  17740000
TRKS     LH    R3,DS1SCALO+2       GET SECONDARY  BY TRACKS             17750000
CHBIT15  DS    0H                  COME BACK                            17760000
         BAL   R14,NEDIT                                                17770000
         MVC   ALL2ND,EDITWA+4     PUT IN 2ND ALLOCATION                17780000
         MVI   OUTBIN,C'0'         DOUBLE SPACE                         17790000
         CLC   CHARVSAM,DSORG      IS IT A VSAM DATASET?                17800000
         BNE   SKIP1               NO, CARRY ON                         17810000
         GOSUB VVDSDATA            YES, GO FIND OUT MORE ABOUT IT       17820000
         B     SKIP1BIS            GO BUILD SUMMARY RECORD              17830000
         SPACE 1                                                        17840000
SKIP1    DS    0H                  PROCESS NON-VSAM DATASETS            17850000
         TM    GENOPT,GENSMS       IS THIS AN SMS VOLUME?               17860000
         BNO   SKIP1BIS            NO, SO NO NVSAM VVDS RECORDS         17870000
         GOSUB VVDSDATA            YES, GO FIND OUT MORE ABOUT DATASET  17880000
         SPACE 1                                                        17890000
SKIP1BIS DS    0H                  CREATE SUMMARY RECORD                17900000
         GOSUB SUMMARY             GO CREATE SUMMARY RECORD             17910000
         PUT   PRINT,OUTBIN        PRINT LINE                           17920000
         AP    LINEKNT,=P'1'       BUMP LINE COUNT                      17930000
PRNTCOM  BAL   R14,PRNTEXTS        GO PRINT AND SORT ALL EXTENTS        17940000
         MVI   DATANAME,BLANK      CLEAR PRINT LINE                     17950000
         MVC   DATANAME+1(132),DATANAME  CLEAR PRINT LINE               17960000
         LA    R2,SRSPACE          POINT TO SUMMARY RECORD              17970000
         MVI   0(R2),C' '          CLEAR AREA                           17980000
         MVC   1(SRRECLEN-1,R2),0(R2)  ..TO BLANKS                      17990000
         BAL   R14,LINETEST        TEST PAGE EJECT                      18000000
DOF1S    L     R4,NTRKNT           LOAD COUNT OF FMT 1'S                18010000
         BCT   R4,FINEST           GET NEXT F1                          18020000
         NI    NXTF1+1,X'0F'       SET BR OFF, NO MORE F1'S             18030000
         EJECT                                                          18040000
*********************************************************************   18050000
*                                                                       18060000
*         START OF ALLOCATION MAP FOR SYSOUT                            18070000
*                                                                       18080000
*********************************************************************   18090000
MAPZ     OI    HEADER+1,X'F0'      SET TO NOP COLUMN HEADING            18100000
         L     R5,SRTKNT           LOAD UP NO OF EXTENTS                18110000
         BCTR  R5,0                CORRECT COUNT                        18120000
         L     R9,SRTBL            START OF SORT BIN                    18130000
         XC    CHECKER,CHECKER     ZERO EXTENT CHECKER                  18140000
MAP3     BAL   R14,SYSHEAD         TITLE                                18150000
         MVI   SOUTBIN,C' '        CLEAR SYSOUT PRINT LINE              18160000
         MVC   SOUTBIN+1(132),SOUTBIN                                   18170000
MAP2     L     R10,0(R9)           BRING IN ADDRESS STORED IN TABLE     18180000
         L     R2,44(R10)          BRING IN SIZE                        18190000
         BAL   R14,LENGTH          LENGTH                               18200000
         BAL   R14,NEDIT           EDIT IT                              18210000
         MVC   LNGTH,EDITWA+3      PUT IN LENGTH OF EXTENT              18220000
         SR    R3,R3               CLEAR WORK REG                       18230000
         ICM   R3,B'0011',HOLD     FIRST TRACK                          18240000
         BAL   R14,NEDIT           EDIT IT                              18250000
         MVC   STRTT,EDITWA+3      PUT IN START TRACK                   18260000
         BCTR  R3,0                SUBTRACT 1                           18270000
         C     R3,CHECKER          IS IT EQUAL TO END OF LAST XTENT     18280000
         BNE   ERRFLAG             BRANCH IF NOT                        18290000
         C     R5,=F'1'            IS THIS LAST EXTENT                  18300000
         BNE   OK                  BRANCH IF NOT                        18310000
         ICM   R3,B'0011',SAVEF4+62  NUMBER OF CYLINDERS                18320000
         MH    R3,SAVEF4+64        TIMES NO. OF TRACKS/CYLINDER         18330000
         LH    R14,NOSPARES        GET NO. SPARES                       18340000
         SR    R3,R14              SUBTRACT FROM TOTAL NO. TRACKS       18350000
         BCTR  R3,0                MINUS 1                              18360000
         ICM   R14,B'0011',HOLD+2  GET EXTENT END                       18370000
         CR    R3,R14              COMPARE WITH DEVICE END              18380000
         BE    OK                                                       18390000
ERRFLAG  MVC   STRTT-2(2),=C'**'   FLAG IT                              18400000
OK       DS    0H                                                       18410000
         ICM   R3,B'0011',HOLD+2   LAST TRACK                           18420000
         BAL   R14,NEDIT                                                18430000
         MVC   LSTT,EDITWA+3       PUT IN LAST TRACK NO.                18440000
         ST    R3,CHECKER          SAVE TO CHECK AGAINST NEXT XTENT     18450000
         SR    R3,R3                                                    18460000
         IC    R3,48(R10)          EXTENT VALUE                         18470000
         BAL   R14,NEDIT                                                18480000
         MVC   EXTT,EDITWA+5       PUT IN EXTENT                        18490000
         MVC   SHLINE,0(R10)       BRING IN DATA SET NAME               18500000
         BAL   R14,SLNE1OUT        PRINT LINE                           18510000
         LA    R9,56(R9)                                                18520000
         BCT   R5,MAP2             FALL THRU ON LAST                    18530000
         EJECT                                                          18540000
*********************************************************************   18550000
*                                                                       18560000
************  THROUGH WITH THIS VOLUME, PREPARE TO GO TO NEXT           18570000
*                                                                       18580000
*********************************************************************   18590000
         SPACE 1                                                        18600000
MAPPED   DS    0H                  FINISHED MAPPING ONE VOLUME          18610000
         L     R3,ACCEND           CALC FREE SPACE                      18620000
         S     R3,SREND            IN TABLE                             18630000
         SRL   R3,11               DIVIDE BY 2K                         18640000
         SLL   R3,1                MULT BY 2                            18650000
         BAL   R14,NEDIT           PUT IN MESSAGE                       18660000
         MVC   SIZEF,EDITWA+4      PUT IN SIZE                          18670000
         PUT   SYSOUT,FREESPC      WRITE IT                             18680000
         XC    STDREF,STDREF       CLEAR REFERENCE DAY COUNT            18690000
         TM    VSAMSW,DDPRES+DDOPEN WAS ACB PROCESSED?                  18700000
         BNO   DISKLOOP            NO, GO ROUND FOR NEXT DISK           18710000
         SPACE 1                                                        18720000
         MVC   VVENOW,VVETBL       RESET CURRENT POINTER TO START       18730000
         MODCB RPL=VVDSRPL,OPTCD=(ADR,SEQ,LOC) SWITCH TO SEQUENTIAL     18740000
         LTR   R15,R15             MODCB OK ?                           18750000
         BNZ   MODCBERR            NO ==> ABEND                         18760000
         SPACE 1                                                        18770000
         XC    VVDSRBA,VVDSRBA     RBA = 0                              18780000
         POINT RPL=VVDSRPL         RESET FILE                           18790000
*        CLOSE (VVDSACB)                                                18800000
*        OPEN  (VVDSACB)                                                18810000
*        WTO   'MAPDISK ==> VVDS END OF FILE - CALL SYSTEMS'            18820000
         SPACE 1                                                        18830000
         MODCB EXLST=VVDSEXLS,EODAD=VVDSEOF RESTORE EOD ADDRESS         18840000
         LTR   R15,R15             MODCB OK ?                           18850000
         BNZ   MODCBERR            NO ==> ABEND                         18860000
         SPACE 1                                                        18870000
         CLOSE (VVDSACB)           CLOSE THE VVDS                       18880000
         NI    VSAMSW,FF-DDOPEN    TURN OFF FLAG                        18890000
         LA    R4,S99AREA          SET UP SVC 99 PARM AREA BASE REG     18900000
         USING S99RB,R4            ESTABLISH ADDRESSABILITY             18910000
         MVI   S99VERB,S99VRBUN    INDICATE UNALLOCATION TO BE DONE     18920000
         LA    R1,S99PARM          LOAD ADDRESS OF SVC 99 PARM AREA     18930000
         DYNALLOC  ,               PERFORM DYNAMIC UNALLOCATION         18940000
         LTR   R15,R15             DYNALLOC OK ?                        18950000
         BNZ   DYNAERR             NO, SHOW ERROR                       18960000
         DROP  R4                  END DYNALLOC ADDRESSABILITY          18970000
         NI    VSAMSW,FF-DDPRES    TURN OFF FLAG                        18980000
         B     DISKLOOP            GO LOOK FOR NEXT VOL                 18990000
         EJECT                                                          19000000
*********************************************************************   19010000
*                                                                       19020000
*        ALL VOLUMES PROCESSED. TIDY UP AND LEAVE.                      19030000
*                                                                       19040000
*********************************************************************   19050000
         SPACE 1                                                        19060000
ALLDONE  PUT   SYSOUT,MSGDONE                                   GP09136 19070000
         PUT   PRINT,MSGDONE                                    GP09136 19080000
         CLOSE (PRINT)                                                  19090000
         CLOSE (SYSOUT)                                                 19100000
         LA    R2,SYSUT2SW         POINT AT MDCB LIST                   19110000
         USING MDCB,R2             ESTABLISH ITS ADDRESSSABILITY        19120000
         GOSUB CLOSE               GO CLOSE IT                          19130000
         DROP  R2                  END MDCB ADDRESSABILITY              19140000
         SPACE 1                                                        19150000
RETURN   DS    0H                                                       19160000
*        GETAUTH TYPE=OFF          UN-AUTHORISATION                     19170000
*        ABEND 1111,DUMP           ===>TESTING<===                      19180000
         L     R13,4(,R13)         RESTORE REG 13 TO CALLER'S SAVE      19190000
         LM    R14,R12,R12(13)     RESTORE REGS                         19200000
         SR    R15,R15             SET RETURN CODE OF ZERO 08/11/71     19210000
BR14     BR    R14                 RETURN TO CALLER                     19220000
MSGDONE  DC    CL133'- END OF UTILITY - DISK PACKS ARE MAPPED'  GP09136 19230000
         EJECT ,                                                        19240000
*        *********************************                              19250000
*        *     OBTAIN INFORMATION FROM   *                              19260000
*        *           V  V  D  S          *                              19270000
*        *********************************                              19280000
         SPACE 1                                                        19290000
VVDSDATA DS    0H                                                       19300000
         SUBIN SAVE=(R3,R4,R5,R7,R9)  SUBROUTINE ENTRY                  19310000
         TM    VSAMSW,DDPRES+DDOPEN CAN WE DO IT?                       19320000
         BNO   VSAMDONE            NO, GO OUT AGAIN                     19330000
         L     R9,VVENOW           LOAD TABLE POINTER                   19340000
         USING VVETABLE,R9         ESTABLISH ADDRESSABILITY             19350000
         SPACE 1                                                        19360000
VSAM010  DS    0H                  SEARCH FOR VVE ENTRY                 19370000
         CLC   DS1DSNAM,VVENAME    RIGHT DSNAME?                        19380000
         BE    VSAM020             YES, PROCESS IT                      19390000
         BL    VSAMDONE            NAME NOT IN TABLE                    19400000
         LA    R9,VVETABL(R9)      INCREMENT TABLE POINTER              19410000
         C     R9,DSTBL            RAN OFF END OF VVE TABLE?            19420000
         BL    VSAM010             NO, TRY NEXT ENTRY                   19430000
         B     VSAMDONE            NAME NOT IN TABLE                    19440000
         SPACE 1                                                        19450000
VSAM020  DS    0H                                                       19460000
         ST    R9,VVENOW           SAVE TABLE POINTER                   19470000
         MVC   VVDSRBA,VVERBA      INSERT RBA OF VVR                    19480000
         SPACE 1                                                        19490000
VSAM025  DS    0H                                                       19500000
         GOSUB VVDSGET             GO READ THE VVDS ENTRY               19510000
         L     R7,VVDSAREA         GET RECORD POINTER                   19520000
         USING VVR,R7              ESTABLISH HEADER ADDRESSABILITY      19530000
         CLI   VVRTYPE,C'N'        NONVSAM VVR ?                        19540000
         BE    NVSAM30             YES, GO PROCESS                      19550000
         CLI   VVRTYPE,C'Z'        PRIMARY VVR ?                        19560000
         BNE   VSAM028             NO ==> GET NEXT RECORD               19570000
         SPACE 1                                                        19580000
VSAM027  DS    0H                                                       19590000
         LH    R5,VVRLEN           GET RECORD LENGTH                    19600000
         SR    R4,R4               CLEAR A REGISTER                     19610000
         ICM   R4,B'0001',VVRCMPNL  GET LENGTH OF NAME                  19620000
         BCTR  R4,0                REDUCE FOR LENGTH FIELD              19630000
         BCTR  R4,0                REDUCE FOR EXECUTE                   19640000
         EX    R4,VSAMCOMP         EXECUTE COMPARE                      19650000
         BE    VSAM030             RICHTIGER SATZ                       19660000
         SPACE 1                                                        19670000
VSAM028  DS    0H                                                       19680000
         MODCB RPL=VVDSRPL,OPTCD=(ADR,SEQ,LOC)                          19690000
         LTR   R15,R15             MODCB OK ?                           19700000
         BNZ   MODCBERR            NO ==> ABEND                         19710000
         SPACE 1                                                        19720000
         B     VSAM025             TRY NEXT RECORD                      19730000
         EJECT                                                          19740000
VSAM030  DS    0H                                                       19750000
         MODCB RPL=VVDSRPL,OPTCD=(ADR,DIR,LOC,NSP)                      19760000
         LTR   R15,R15             MODCB OK ?                           19770000
         BNZ   MODCBERR            NO ==> ABEND                         19780000
         SPACE 1                                                        19790000
         OI    VVDSSWCH,VVDSNCL    SET SWITCH FOR HEADER NAME CELL      19800000
         MVI   DSORG+3,C'I'        ASSUME IT IS INDEX COMPONENT         19810000
         TM    VVRFLAG,VVRCOMPT    IS IT AN INDEX?                      19820000
         BO    *+4+4               YES, WE WERE RIGHT                   19830000
         MVI   DSORG+3,C'D'        NO, FLAG AS DATA                     19840000
         LA    R7,2(R7)            SKIP VVR RECORD LENGTH FIELD         19850000
         SH    R5,0(R7)            SUBTRACT FROM RECORD LENGTH          19860000
         AH    R7,0(R7)            POINT TO NEXT CELL                   19870000
         SPACE 1                                                        19880000
         CLI   2(R7),X'21'         DATASET INFORMATION CELL ?           19890000
         BNE   VSAM040             NO ==> GO ON                         19900000
         LR    R1,R7               POINT TO NEW CELL                    19910000
         USING TYPE@21,R1          ESTABLISH ADDRESSABILITY             19920000
         OI    VVDSSWCH,VVDST21    SET SWITCH FOR SUBTYPE X'21'         19930000
         SR    R3,R3               CLEAR LENGTH REGISTER                19940000
         CLC   0(2,R7),=XL2'0060'  TEST CELL LENGTH                     19950000
         BNH   VSAM30C             SKIP IF NO SMS DATA                  19960000
         LA    R4,VVR21SCL         POINT TO STORAGE CLASS LENGTH        19970000
         ICM   R3,B'0011',0(R4)    GET LENGTH OF STORAGE CLASS          19980000
         BZ    VSAM30A             SKIP IT IF NONE                      19990000
         BCTR  R3,0                DECREMENT FOR EXECUTE                20000000
         LA    R2,SRSPACE          POINT TO RECORD AREA                 20010000
         USING SRRECORD,R2         ESTABLISH ADDRESSABILITY             20020000
         LA    R15,SRSTOGCL        POINT TO SUMMARY FIELD               20030000
         EX    R3,NVSMOVE          COPY CLASS NAME TO SUMMARY RECORD    20040000
         LA    R3,1(,R3)           RESTORE LENGTH                       20050000
         SPACE 1                                                        20060000
VSAM30A  DS    0H                  PROCESS NEXT SMS FIELD               20070000
         LA    R4,2(R3,R4)         UPDATE INPUT POINTER                 20080000
         ICM   R3,B'0011',0(R4)    GET LENGTH OF DATA CLASS             20090000
         BZ    VSAM30B             SKIP IT IF NONE                      20100000
         BCTR  R3,0                DECREMENT FOR EXECUTE                20110000
         LA    R15,SRDATACL        POINT TO SUMMARY FIELD               20120000
         EX    R3,NVSMOVE          COPY CLASS NAME TO SUMMARY RECORD    20130000
         LA    R3,1(,R3)           RESTORE LENGTH                       20140000
         SPACE 1                                                        20150000
VSAM30B  DS    0H                  PROCESS NEXT SMS FIELD               20160000
         LA    R4,2(R3,R4)         UPDATE INPUT POINTER                 20170000
         ICM   R3,B'0011',0(R4)    GET LENGTH OF MANAGEMENT CLASS       20180000
         BZ    VSAM30C             SKIP IT IF NONE                      20190000
         BCTR  R3,0                DECREMENT FOR EXECUTE                20200000
         LA    R15,SRMGMTCL        POINT TO SUMMARY FIELD               20210000
         EX    R3,NVSMOVE          COPY CLASS NAME TO SUMMARY RECORD    20220000
         SPACE 1                                                        20230000
VSAM30C  DS    0H                  PROCESS NEXT SMS FIELD               20240000
         SH    R5,0(R7)            SUBTRACT FROM RECORD LENGTH          20250000
         LTR   R5,R5               END OF RECORD ?                      20260000
         BZ    VSAM060                                                  20270000
         AH    R7,0(R7)            POINT TO NEXT CELL                   20280000
         DROP  R2                  END SUMMARY ADDRESSING               20290000
         SPACE 1                                                        20300000
VSAM040  DS    0H                                                       20310000
         CLI   2(R7),X'60'         AMDSB CELL ?                         20320000
         BNE   VSAM050             NO ==> GO ON                         20330000
         LR    R2,R7               GET AMDSB CELL ADDRESS               20340000
         USING TYPE@60,R2          ESTABLISH ADDRESSABILITY             20350000
         SPACE 1                                                        20360000
         OI    VVDSSWCH,VVDST60    SET SWITCH FOR SUBTYPE X'60'         20370000
         SH    R5,0(R7)            SUBTRACT FROM RECORD LENGTH          20380000
         LTR   R5,R5               END OF RECORD ?                      20390000
         BZ    VSAM060             YES ==> TRY Q TYPE                   20400000
         AH    R7,0(R7)            POINT TO NEXT CELL                   20410000
         SPACE 1                                                        20420000
VSAM050  DS    0H                                                       20430000
         CLI   2(R7),X'23'         VOLUME  INFORMATION CELL ?           20440000
         BNE   VSAM060             NO ==> GO ON                         20450000
         LR    R4,R7               GET VOLUME CELL ADDRESS              20460000
         USING TYPE@23,R4          ESTABLISH ADDRESSABILITY             20470000
         SPACE 1                                                        20480000
         OI    VVDSSWCH,VVDST23    SET SWITCH FOR SUBTYPE X'23'         20490000
         B     VSAM060             GO PROCESS VSAM COMPONENTS           20500000
         SPACE 2                                                        20510000
VSAMCOMP CLC   VVENAME(*-*),VVRCMPNM  COMPARE NAMES         *EXECUTE*   20520000
         EJECT                                                          20530000
*********************************************************************   20540000
*                                                                       20550000
*        LIST ATTRIBUTES OF VSAM COMPONENT, NOW THAT WE KNOW THEM       20560000
*                                                                       20570000
*********************************************************************   20580000
         SPACE 1                                                        20590000
VSAM060  DS    0H                                                       20600000
         TM    VVDSSWCH,VVDST21+VVDST23+VVDST60 ENOUGH INFORMATION?     20610000
*        BNO   VSAM028                 NO ==> TRY NEXT RECORD           20620000
         BNO   VSAM099             NO, CONTINUED DATASET. FORGET        20630000
         LA    R5,RECFM                                                 20640000
         MVI   0(R5),BLANK         CLEAR AREA FROM TIME BEFORE          20650000
         MVC   1(4,R5),0(R5)                                            20660000
         MVI   RECFM,C'V'          DEFAULT VARIABLE RECORDS             20670000
         ICM   R3,B'1111',VVRAMLCL GET MAX RECORD SIZE                  20680000
         BAL   R14,NEDIT           MAKE LRECL PRINTABLE                 20690000
         MVC   LRECL,EDITWA+3      AND PRINT IT                         20700000
         CLC   VVRAMLCL,VVRLRECL   MAX SAME AS AVERAGE?                 20710000
         BNE   *+4+4               NO, LEAVE AS RECFM=V                 20720000
         MVI   RECFM,C'F'          YES, FIXED LENGTH RECORDS            20730000
         TM    VVRAMATR,VVRAMSPN   SPANNED RECORDS?                     20740000
         BNO   *+4+4               NO, LEAVE BLANK                      20750000
         MVI   RECFM+1,C'S'        YES, SHOW IT                         20760000
         LH    R3,VVRAMNXT         GET NUMBER OF EXTENTS                20770000
         BAL   R14,NEDIT           MAKE PRINTABLE                       20780000
         MVC   EXTENTS,EDITWA+5    AND PRINT IT                         20790000
         ICM   R3,B'1111',VVRAMCIV GET CI SIZE                          20800000
         BAL   R14,NEDIT           MAKE CISIZE PRINTABLE                20810000
         MVC   BLKSIZE,EDITWA+3    PRINT IT AS BLOCKSIZE                20820000
         LR    R15,R3              COPY CI SIZE                         20830000
         SR    R14,R14             CLEAR EVEN REGISTER                  20840000
         LH    R5,VVRAMCCA         GET #CI'S PER CA                     20850000
         MR    R14,R5              CALCULATE THEIR PRODUCT              20860000
         LR    R5,R15              AND REMEMBER IT                      20870000
         SR    R14,R14             CLEAR EVEN REGISTER                  20880000
         ICM   R15,B'1111',VVRDSHU GET HIGH USED RBA                    20890000
         DR    R14,R5              GET NUMBER OF CA'S IN DATASET        20900000
         LTR   R14,R14             ANY REMAINDER?                       20910000
         BZ    *+4+4               NO, DO NOT ROUND                     20920000
         LA    R15,1(R15)          YES, SO ROUND UP TRACKS              20930000
         LR    R0,R15              SAVE NUMBER OF CA'S                  20940000
         SR    R14,R14             CLEAR EVEN REGISTER                  20950000
         SR    R5,R5               CLEAR REGISTER                       20960000
         ICM   R5,B'0011',VVRTRKAU GET TRACKS PER CA                    20970000
         MR    R14,R5              CALCULATE SPACE USED                 20980000
         LR    R3,R15              GET SPACE USED                       20990000
         ST    R3,THISUSED         SAVE THIS VALUE                      21000000
         BAL   R14,NEDIT           MAKE PRINTABLE                       21010000
         MVC   SPUSED,EDITWA+3     AND PRINT IT                         21020000
         IC    R15,VVRATTR2        PICK UP SHAREOPTIONS                 21030000
         LA    R3,VVRA2REG         SET REGION SHARING MASK              21040000
         NR    R3,R15              STRIP OUT REGION VALUE               21050000
         SRL   R3,6                SHIFT DOWN                           21060000
         LA    R3,1(,R3)           ADD ONE TO DECODE                    21070000
         BAL   R14,NEDIT           MAKE PRINTABLE                       21080000
         MVC   CTREGSHR,EDITWA+7   COPY TO SAVE AREA                    21090000
         LA    R3,VVRA2SYS         SET REGION SHARING MASK              21100000
         NR    R3,R15              STRIP OUT REGION VALUE               21110000
         SRL   R3,4                SHIFT DOWN                           21120000
         LA    R3,1(,R3)           ADD ONE TO DECODE                    21130000
         BAL   R14,NEDIT           MAKE PRINTABLE                       21140000
         MVC   CTSYSSHR,EDITWA+7   COPY TO SAVE AREA                    21150000
         SPACE 1                                                        21160000
         DROP  R1                  END DATASET CELL ADDRESSING          21170000
         DROP  R4                  END VOLUME CELL ADDRESSING           21180000
         EJECT ,                                                        21190000
         ICM   R1,B'1111',VVRAMCAS GET NO. CA SPLITS                    21200000
         GOSUB PERCENT0            GO CALCULATE PERCENTAGE              21210000
         LR    R3,R1               GET THE ANSWER                       21220000
         BAL   R14,NEDIT           MAKE IT PRINTABLE                    21230000
         MVC   VSCASPLT,EDITWA+5   COPY TO PRINT LINE                   21240000
         MH    R0,VVRAMCCA         CALCULATE NO. CI'S                   21250000
         ICM   R1,B'1111',VVRAMCIS GET NO. CI SPLITS                    21260000
         GOSUB PERCENT0            GO CALCULATE PERCENTAGE              21270000
         LR    R3,R1               GET THE ANSWER                       21280000
         BAL   R14,NEDIT           MAKE IT PRINTABLE                    21290000
         MVC   VSCISPLT,EDITWA+5   COPY TO PRINT LINE                   21300000
         SPACE 1                                                        21310000
         LA    R1,VVRAMSTS         POINT AT TIMESTAMP                   21320000
         GOSUB TODDATE             GO CONVERT IT                        21330000
         CLC   REFDATE,TODYY       COMPARE VVDS AND VTOC DATES          21340000
         BNL   VSAM061             USE VTOC IF VALID                    21350000
         MVC   REFDATE,TODYY       ELSE USE VVDS DATE                   21360000
         LA    R1,TODDSCB          POINT TO BINARY DATE                 21370000
         GOSUB STDDAY01            CONVERT TO STANDARD DAY NO.          21380000
         STH   R1,STDREF           SAVE DAY NO. OF REFERENCE            21390000
VSAM061  DS    0H                  PROCESS KEY INFORMATION              21400000
         TM    VVRAMATR,VVRAMDST   TEST FOR KSDS                        21410000
         BNO   VSAM099             NO, SKIP KEY DETAILS                 21420000
         SPACE 1                                                        21430000
         SR    R3,R3               CLEAR WORK REGISTER                  21440000
         ICM   R3,B'0011',VVRAMRKP GET KEY POSITION                     21450000
         BAL   R14,NEDIT           MAKE PRINTABLE                       21460000
         MVC   ISRKP,EDITWA+3      AND PRINT IT                         21470000
         ICM   R3,B'0011',VVRAMKLN GET KEY LENGTH                       21480000
         BAL   R14,NEDIT           MAKE PRINTABLE                       21490000
         MVC   ISKEYLEN,EDITWA+5   AND PRINT IT                         21500000
         B     VSAM099             GO TO RETURN                         21510000
         SPACE 1                                                        21520000
         DROP  R2                  END AMDSB CELL ADDRESSING            21530000
         EJECT                                                          21540000
*********************************************************************   21550000
*                                                                       21560000
*        LIST SMS ATTRIBUTES OF NONVSAM COMPONENT                       21570000
*                                                                       21580000
*********************************************************************   21590000
         SPACE 1                                                        21600000
NVSAM30  DS    0H                  PROCESS SMS NONVSAM VVR              21610000
         DROP  R7                  END 'Z' RECORD ADDRESSABILITY        21620000
         USING TYPE@N,R7           ESTABLISH NONVSAM ADDRESSABILITY     21630000
         LH    R5,VVRNLEN          GET RECORD LENGTH                    21640000
         SR    R3,R3               CLEAR LENGTH REGISTER                21650000
         ICM   R3,B'0011',VVRNENTL GET LENGTH OF ENTRY NAME             21660000
         BCTR  R3,0                DECREMENT FOR EXECUTE                21670000
         EX    R3,NVSCOMP          EXECUTE COMPARE                      21680000
*        BNE   VSAM028             WRONG, GO GET NEXT RECORD            21690000
         MODCB RPL=VVDSRPL,OPTCD=(ADR,DIR,LOC,NSP)                      21700000
         LA    R7,2(R7)            SKIP VVR RECORD LENGTH FIELD         21710000
         SH    R5,0(R7)            SUBTRACT FROM RECORD LENGTH          21720000
         BZ    NVSAM39             SKIP IT IF NOTHING LEFT              21730000
         AH    R7,0(R7)            POINT TO NEXT CELL                   21740000
         SPACE 1                                                        21750000
         CLI   2(R7),X'22'         SMS DATA  CELL ?                     21760000
         BNE   NVSAM39             NO ==> GO ON                         21770000
         OI    VVDSSWCH,VVDST22    SET SWITCH FOR SUBTYPE X'22'         21780000
         LR    R1,R7               POINT TO NEW CELL                    21790000
         USING TYPE@22,R1          ESTABLISH ADDRESSABILITY             21800000
         LA    R2,SRSPACE          POINT TO RECORD AREA                 21810000
         USING SRRECORD,R2         ESTABLISH ADDRESSABILITY             21820000
         LA    R4,VVRSMSCL         POINT TO STORAGE CLASS LENGTH        21830000
         SR    R3,R3               CLEAR LENGTH REGISTER                21840000
         ICM   R3,B'0011',0(R4)    GET LENGTH OF STORAGE CLASS          21850000
         BZ    NVSAM32             SKIP IT IF NONE                      21860000
         BCTR  R3,0                DECREMENT FOR EXECUTE                21870000
         LA    R15,SRSTOGCL        POINT TO SUMMARY FIELD               21880000
         EX    R3,NVSMOVE          COPY CLASS NAME TO SUMMARY RECORD    21890000
         LA    R3,1(,R3)           RESTORE LENGTH                       21900000
         SPACE 1                                                        21910000
NVSAM32  DS    0H                  PROCESS NEXT SMS FIELD               21920000
         LA    R4,2(R3,R4)         UPDATE INPUT POINTER                 21930000
         ICM   R3,B'0011',0(R4)    GET LENGTH OF DATA CLASS             21940000
         BZ    NVSAM34             SKIP IT IF NONE                      21950000
         BCTR  R3,0                DECREMENT FOR EXECUTE                21960000
         LA    R15,SRDATACL        POINT TO SUMMARY FIELD               21970000
         EX    R3,NVSMOVE          COPY CLASS NAME TO SUMMARY RECORD    21980000
         LA    R3,1(,R3)           RESTORE LENGTH                       21990000
         SPACE 1                                                        22000000
NVSAM34  DS    0H                  PROCESS NEXT SMS FIELD               22010000
         LA    R4,2(R3,R4)         UPDATE INPUT POINTER                 22020000
         ICM   R3,B'0011',0(R4)    GET LENGTH OF MANAGEMENT CLASS       22030000
         BZ    NVSAM39             SKIP IT IF NONE                      22040000
         BCTR  R3,0                DECREMENT FOR EXECUTE                22050000
         LA    R15,SRMGMTCL        POINT TO SUMMARY FIELD               22060000
         EX    R3,NVSMOVE          COPY CLASS NAME TO SUMMARY RECORD    22070000
         SPACE 1                                                        22080000
NVSAM39  DS    0H                  PROCESS NEXT SMS FIELD               22090000
*        DC    A(0)                ABEND S0C1                  *DEBUG*  22100000
         B     VSAM099             GO TO RETURN                         22110000
         SPACE 2                                                        22120000
NVSCOMP  CLC   VVENAME(*-*),VVRNENTN  COMPARE NAMES           *EXECUTE* 22130000
NVSMOVE  MVC   0(*-*,R15),2(R4)    GENERIC MOVE INSTRUCTION   *EXECUTE* 22140000
         SPACE 2                                                        22150000
         DROP  R2                  END SUMMARY RECORD ADDRESSABILITY    22160000
         EJECT                                                          22170000
VSAMEOF  DS    0H                                                       22180000
         XC    VVDSRBA,VVDSRBA     RBA = 0                              22190000
         POINT RPL=VVDSRPL                                              22200000
*        CLOSE (VVDSACB)                                                22210000
*        OPEN  (VVDSACB)                                                22220000
*        WTO   'LISTICF ==> VVDS END OF FILE - CALL SYSTEMS'            22230000
         B     VSAM099             GO TO RETURN                         22240000
         SPACE 1                                                        22250000
VSAM099  DS    0H                                                       22260000
         MVI   VVDSSWCH,X'00'      RESET SWITCH                         22270000
         SPACE 1                                                        22280000
VSAMDONE DS    0H                  VSAM DATASET PROCESSING FINISHED     22290000
         SUBOUT  RESTORE=(R3,R4,R5,R7,R9)  SUBROUTINE EXIT              22300000
         SPACE 1                                                        22310000
         DROP  R7                  END HEADER CELL ADDRESSING           22320000
         EJECT                                                          22330000
*********************************************************************   22340000
*                                                                       22350000
*         START OF ALLOCATION MAP FOR SYSPRINT EXTENTS                  22360000
*                                                                       22370000
*********************************************************************   22380000
ABTOREL  MVC   HOLD(8),2(R1)       MOVE FOR BOUNDRIES                   22390000
         SR    R2,R2               CLEAR WORK REG                       22400000
         ICM   R2,B'0011',HOLD     CC                                   22410000
         MH    R2,SAVEF4+64                                             22420000
         SR    R3,R3               CLEAR WORK REG                       22430000
         ICM   R3,B'0011',HOLD+2   HH                                   22440000
         ALR   R2,R3                                                    22450000
ABTOREL1 DS    0H                                                       22460000
         SR    R3,R3               CLEAR WORK REG                       22470000
         ICM   R3,B'0011',HOLD+4   CC                                   22480000
         MH    R3,SAVEF4+64                                             22490000
         AH    R3,HOLD+6           HH                                   22500000
         SLL   R2,16               MOVE TO TOP                          22510000
         ALR   R2,R3               PUT TOGETHER                         22520000
         BR    R14                 EXIT                                 22530000
         SPACE 2                                                        22540000
ALLSUM   ST    R14,HOLD+8          TAKE CARE OF FETCHING ALLOCATIONS    22550000
ALLSUM1  BAL   R14,ABTOREL         CONVERT TO RELATIVE TRACKS           22560000
         SH    R9,H4                                                    22570000
         ST    R2,0(R9)            STORE IN TABLE                       22580000
         BAL   R14,LENGTH          GET LENGTH IN R3                     22590000
         L     R14,DSLEN           GET CURRENT ACCUMULATOR              22600000
         AR    R14,R3              TOTAL UP ALL LENGTHS FOR DS          22610000
         ST    R14,DSLEN           SAVE UPDATED ACCUMULATOR             22620000
         LA    R1,10(R1)           SET FOR NEXT                         22630000
         BCT   R5,ALLSUM1          LOOP                                 22640000
         L     R14,HOLD+8          RESTORE                              22650000
         BR    R14                 BACK OUT                             22660000
         EJECT                                                          22670000
**********************************************************************  22680000
*        ROUTINE TO CONVERT PACKED DATESTAMP TO CHARACTER YYDDD      *  22690000
**********************************************************************  22700000
         SPACE 1                                                        22710000
CALEN    SR    R3,R3               COMPUTE YEARS AND DAYS               22720000
         IC    R3,0(R1)            PICK UP YEAR                         22730000
         CVD   R3,WORK                                                  22740000
         UNPK  0(2,R2),WORK+6(2)   YEAR                                 22750000
         OI    1(R2),X'F0'         ZONE                                 22760000
         MVC   WORK(2),1(R1)       FETCH LAST TWO BYTES                 22770000
         LH    R3,WORK                                                  22780000
         CVD   R3,WORK             TO DECIMAL                           22790000
         UNPK  2(3,R2),WORK+6(2)   DAYS                                 22800000
         OI    4(R2),X'F0'         ZONE                                 22810000
         BR    R14                 RETURN                               22820000
         SPACE 2                                                        22830000
**********************************************************************  22840000
*        DATA EDIT ROUTINES                                          *  22850000
**********************************************************************  22860000
         SPACE 1                                                        22870000
NEDIT    DS    0H                  EDIT ROUTINE                         22880000
         CVD   R3,WORK             CONVERT TO PACKED                    22890000
         MVC   EDITWA,PATTERN      MOVE PATTERN                         22900000
         ED    EDITWA,WORK+4       EDIT                                 22910000
         BR    R14                 RETURN                               22920000
         SPACE 2                                                        22930000
FULLEDIT ST    R14,HOLD+4          SAVE RETURN                          22940000
         BAL   R14,NEDIT                                                22950000
         MVC   ZEXT,EDITWA+5       PUT IN EXTENT                        22960000
         BAL   R14,LENGTH          DETERMINE LENGTH                     22970000
         BAL   R14,NEDIT                                                22980000
         MVC   ZLNGTH,EDITWA+3     PUT IN LENGTH                        22990000
         LH    R3,HOLD                                                  23000000
         BAL   R14,NEDIT                                                23010000
         MVC   ZFIRST,EDITWA+3     PUT IN FIRST TRACK                   23020000
         LH    R3,HOLD+2                                                23030000
         BAL   R14,NEDIT                                                23040000
         MVC   ZLAST,EDITWA+3      PUT IN LAST TRACK                    23050000
         L     R14,HOLD+4          RESTORE RETURN ADDRESS               23060000
         BR    R14                                                      23070000
         SPACE 2                                                        23080000
LENGTH   SUBIN SAVE=(R4)           LENGTH CALCULATIONP                  23090000
         ST    R2,HOLD             SAVE VALUE FOR TEMP                  23100000
         SR    R3,R3               CLEAR WORK REG                       23110000
         ICM   R3,B'0011',HOLD+2   BRING IN LAST POSITION               23120000
         A     R3,=F'1'            UPDATE                               23130000
         SR    R4,R4               CLEAR WORK REG                       23140000
         ICM   R4,B'0011',HOLD     BRING IN FIRST POSITION              23150000
         SR    R3,R4               TAKE OFF START TRACK VALUE           23160000
         SUBOUT  RESTORE=(R4),RETURN=(14)  GO BACK                      23170000
         EJECT                                                          23180000
*********************************************************************   23190000
*         PAGE COUNT PROCESSING FOR SYSPRINT                            23200000
*********************************************************************   23210000
LINE0OUT MVI   SWIT,X'00'          SET FOR NO PAGE TEST                 23220000
LINE1OUT ST    R14,HOLD+16         SAVE RETURN                          23230000
         TM    GENOPT,X'20'        NEW PAGE?                            23240000
         BZ    NOFORM              NO                                   23250000
         BAL   R14,HEADING         YES                                  23260000
         NI    GENOPT,X'DF'        RESET SWITCH                         23270000
NOFORM   PUT   PRINT,EXTOUT                                             23280000
         MVC   EXTOUT+1(132),EXTOUT  CLEAR LINE                         23290000
         TS    SWIT                DO PAGE TEST?                        23300000
         BC    8,LINEOUT           NO                                   23310000
LINE2OUT CP    LINEKNT,=P'56'      END OF PAGE?                         23320000
         BL    LINEOUT             NO                                   23330000
         OI    GENOPT,X'20'        YES SET FLAG                         23340000
LINEOUT  AP    LINEKNT,=P'1'       BUMP LINE COUNT                      23350000
         L     R14,HOLD+16                                              23360000
         BR    R14                                                      23370000
LINETEST ST    R14,HOLD+16                                              23380000
         CP    LINEKNT,=P'56'                                           23390000
         BL    NOEJE                                                    23400000
         NI    GENOPT,X'DF'                                             23410000
         BAL   R14,HEADING                                              23420000
NOEJE    AP    LINEKNT,=P'1'                                            23430000
         L     R14,HOLD+16                                              23440000
         BR    R14                                                      23450000
         EJECT                                                          23460000
PRNTEXTS L     R9,ACCTABLE         SET UP TABLE OF STORED EXTENTS       23470000
         SH    R9,H4                                                    23480000
         MVC   EXTKNT,=F'0'        SET EXTENT COUNT TO 1                23490000
         ST    R14,HOLD+8                                               23500000
         LA    R2,SRSPACE          POINT TO RECORD AREA                 23510000
         USING SRRECORD,R2         ESTABLISH ADDRESSABILITY             23520000
         MVC   ZMGMTCL,SRMGMTCL    COPY MANAGEMENT CLASS IN FIRST LINE  23530000
         MVC   ZDATACL,SRDATACL    COPY DATA CLASS IN FIRST LINE        23540000
         MVC   ZSTORCL,SRSTOGCL    COPY STORAGE CLASS IN FIRST LINE     23550000
         DROP  R2                  END SUMMARY RECORD ADDRESSABILITY    23560000
         MVI   SWIT,0              NO TEST  EJECT 1ST TIME              23570000
PRNTXT1  L     R2,0(R9)            LOAD IN EXTENT SIZE                  23580000
         LTR   R2,R2               CHECK FOR END OF LIST                23590000
         BZ    JUMPS1              NO MORE LINES OUT                    23600000
         L     R3,EXTKNT           BRING EXTENT COUNT IN                23610000
         LA    R3,1(R3)            BOOST                                23620000
         ST    R3,EXTKNT           RESTORE                              23630000
         BAL   R14,STORMAP         STORE EXTENT FOR MAP OUTPUT          23640000
         L     R3,EXTKNT           COUNT BACK IN                        23650000
         BAL   R14,FULLEDIT        CONVERT AND DISPLAY IN EBCDIC        23660000
         SH    R9,H4               NEXT ENTRY                           23670000
         BAL   R14,LINE1OUT        PRINT LINE W/ LINE TEST              23680000
         B     PRNTXT1                                                  23690000
JUMPS1   L     R14,HOLD+8          RESTORE RETURN ADDRESS               23700000
         BR    R14                                                      23710000
         EJECT                                                          23720000
*********************************************************************   23730000
*         PAGE HEADING PROCESSING                                       23740000
*********************************************************************   23750000
SYSHEAD  DS    0H                                                       23760000
         ST    R14,HOLD            SAVE RETURN                          23770000
         AP    PAGEKNT,=P'1'       ADD ONE TO PAGE COUNT                23780000
         MVC   PAGEPLC,PATTERN     PUT IN EDIT MASK                     23790000
         ED    PAGEPLC,PAGEKNT     NUMBER FOR PAGE                      23800000
         PUT   SYSOUT,HEAD1                                             23810000
         PUT   SYSOUT,GSKIP2                                            23820000
         PUT   SYSOUT,TEXTT        PUT IN HEADING                       23830000
         ZAP   LINEKNT,=P'3'       INITIATE 3 LINES PRINTED             23840000
         L     R14,HOLD                                                 23850000
         BR    R14                 RETURN                               23860000
         SPACE 2                                                        23870000
HEADRET  DS    0H                                                       23880000
         L     R14,HOLD                                                 23890000
         BR    R14                 RETURN                               23900000
         EJECT                                                          23910000
HEADING  ST    R14,HOLD            SAVE RETURN                          23920000
         AP    PAGEKNT,=P'1'       ADD ONE TO PAGE COUNT                23930000
         MVC   PAGEPLC,PATTERN     PUT IN EDIT MASK                     23940000
         ED    PAGEPLC,PAGEKNT     NUMBER FOR PAGE                      23950000
         PUT   PRINT,HEAD1         TITLE HEADING                        23960000
         ZAP   LINEKNT,=P'2'       INITIATE 3 LINES PRINTED             23970000
HEADER   B     HEADTXT             NOP TO PRINT TEXTT                   23980000
         PUT   PRINT,HEAD3         COLUMN HEADING                       23990000
         PUT   PRINT,HEAD4         COLUMN HEADING                       24000000
         PUT   PRINT,HEAD5         COLUMN HEADING                       24010000
         AP    LINEKNT,=P'3'       3 MORE LINES PRINTED                 24020000
HEADTXT  L     R14,HOLD            RESTORE                              24030000
         BR    R14                 CONTINUE                             24040000
         EJECT                                                          24050000
*********************************************************************   24060000
*         LINE PROCESSING FOR SYSOUT                                    24070000
*********************************************************************   24080000
SLNE0OUT MVI   SWIT,X'00'          SET FOR NO PAGE TEST                 24090000
SLNE1OUT ST    R14,HOLD+16         SAVE RETURN                          24100000
         TM    GENOPT,X'20'        NEW PAGE?                            24110000
         BZ    SOFORM              NO                                   24120000
         BAL   R14,SYSHEAD         YES                                  24130000
         NI    GENOPT,X'DF'        RESET SWITCH                         24140000
SOFORM   PUT   SYSOUT,EXTOUT                                            24150000
         MVC   EXTOUT+1(132),EXTOUT  CLEAR LINE                         24160000
         TS    SWIT                DO PAGE TEST?                        24170000
         BC    8,SLNEOUT           NO                                   24180000
SLNE2OUT CP    LINEKNT,=P'56'      END OF PAGE?                         24190000
         BL    SLNEOUT             NO                                   24200000
         OI    GENOPT,X'20'        YES SET FLAG                         24210000
SLNEOUT  AP    LINEKNT,=P'1'       BUMP LINE COUNT                      24220000
         L     R14,HOLD+16                                              24230000
         BR    R14                                                      24240000
         SPACE 2                                                        24250000
SRCHDSCB SUBIN ,                   LOOK FOR DSCB BY DISK ADDRESS        24260000
         L     R5,F356TBL          GET TO START OF TABLE AFTER F5       24270000
         SH    R5,H160             BACK UP IN TABLE                     24280000
         SH    R5,H160                                                  24290000
NEXTETRY CLC   147(5,R5),DS1PTRDS  COMPARE CCHHR                        24300000
         BE    SETITUP             THERE                                24310000
         SH    R5,H160             NEXT ONE                             24320000
         CR    R5,R7               END OF TABLE                         24330000
         BNL   NEXTETRY            NO                                   24340000
         B     IOER2               NOT THER SO ERROR                    24350000
SETITUP  L     R10,0(R5)           LOAD DSCB ADDR                       24360000
         SUBOUT RETURN=(R14)       RETURN TO CALLER                     24370000
         EJECT ,                                                        24380000
STORMAP  MVC   WORK(44),DATANAME   FETCH NAME                           24390000
         ST    R2,WORK+44          STORE TRACKS                         24400000
         STC   R3,WORK+48          STORE EXTENT NUMBER                  24410000
         L     R3,SREND            END OF TABLE                         24420000
         MVC   4(49,R3),WORK       STORE EXTENTS                        24430000
         LA    R1,4(R3)            SAVE ADDR                            24440000
         LA    R3,56(R3)           BUMP END                             24450000
         CL    R3,ACCEND           TABLE OVERLAP                        24460000
         BNL   TABLOVF0            YES                                  24470000
         ST    R3,SREND            SAVE END                             24480000
         L     R3,SRTBL            GET START                            24490000
         SH    R3,H56                                                   24500000
         L     R4,SRTKNT           NO OF ENTRIES                        24510000
SORTE12  BCT   R4,SORTE11                                               24520000
         ST    R1,56(R3)           STORE ADDRESS                        24530000
SORTE14  L     R4,SRTKNT                                                24540000
         LA    R4,1(R4)            BOOST FOR NEXT ENTRY                 24550000
         ST    R4,SRTKNT                                                24560000
         BR    R14                 EXIT                                 24570000
         SPACE 2                                                        24580000
SORTE11  LA    R3,56(R3)           BOOST TO NEXT                        24590000
         L     R5,0(R3)            POINTER TP SORT MATERIAL             24600000
         CL    R2,44(R5)           LOOK AT REL TRACK                    24610000
         BH    SORTE12             JUMP AROUND IF TOO BIG               24620000
SORTE13  ST    R1,0(R3)            STORE ADDRESS IN TABLE               24630000
         LR    R1,R5               LAST ADDRESS                         24640000
         L     R5,56(R3)           NEXT ADDRESS                         24650000
         LA    R3,56(R3)           BOOST                                24660000
         BCT   R4,SORTE13          MOVE ALL REST POINTERS UP            24670000
         ST    R1,0(R3)            CATCH LAST ONE                       24680000
         B     SORTE14             GO FINISH                            24690000
         EJECT                                                          24700000
*        *********************************                              24710000
*        *     DYNALLOC VVDS             *                              24720000
*        *********************************                              24730000
         SPACE 1                                                        24740000
DYNAVVDS DS    0H                                                       24750000
         SUBIN SAVE=(R4)           SUBROUTINE ENTRY                     24760000
         SPACE 1                                                        24770000
         MVC   DYNVOL,SAVESER      PUT VOLSER IN DSNAME                 24780000
         MVC   DYNVVOL,SAVESER     AND IN VOLUME TEXT                   24790000
         LA    R1,DYNCBP           LOAD CB-CHAIN START ADDR.            24800000
         SPACE 1                                                        24810000
         DYNALLOC  ,                                                    24820000
         LTR   R15,R15             DYNALLOC OK ?                        24830000
         BNZ   DYNAERR             NO, SHOW ERROR                       24840000
         MVC   VVDSACB+40(8),DYNDNAME  INSERT DDNAME                    24850000
         MVC   UALDDNAM,DYNDNAME   MOVE DDNAME TO UNALLOCATION TXT UNIT 24860000
         XR    R15,R15                                                  24870000
         SPACE 1                                                        24880000
DYNVVDSE DS    0H                                                       24890000
         SUBOUT  RESTORE=(R4)      RETURN TO CALLER                     24900000
         EJECT                                                          24910000
*******************************************************************     24920000
*        THIS ROUTINE USES A BUBBLE SORT TO SEQUENCE THE          *     24930000
*        VVR  LIST ON THE KEY FIELD.                              *     24940000
*******************************************************************     24950000
         SPACE 2                                                        24960000
SORTVVR  SUBIN SAVE=(R4,R5,R7,R9)  SUBROUTINE ENTRY                     24970000
         L     R9,VVETBL           GET ADDRESS OF VVR TABLE             24980000
         USING VVETABLE,R9         ESTABLISH TABLE ADDRESSABILITY       24990000
         SPACE 1                                                        25000000
         LR    R7,R9               SAVE START ADDRESS                   25010000
         LH    R4,VVECNT           GET NUMBER OF ENTRIES                25020000
         LTR   R5,R4               SET NUMBER OF LOOPS                  25030000
         BZ    SORTED              EXIT IF NONE                         25040000
         BCTR  R5,0                TO NO. OF MEMBERS-1                  25050000
         SPACE 2                                                        25060000
HUBBLE   DS    0H                  TOP OF BUBBLE SORT LOOP              25070000
         LR    R9,R7               RESTORE INPUT POINTER                25080000
         LTR   R4,R5               SET NUMBER OF MEMBERS                25090000
         BZ    SORTED              EXIT IF NONE                         25100000
         MVI   FLAG,X'00'          RESET FLAG                           25110000
         SPACE 1                                                        25120000
BUBBLE   DS    0H                  TOP OF LOOP FOR CURRENT PASS         25130000
         CLC   VVENAME,VVENAME+VVETABL  TEST ADJOINING ENTRIES          25140000
         BNH   NEXTMEMB            BYPASS SWAP IF IN SEQUENCE           25150000
         SPACE 1                                                        25160000
         XC    0(VVETABL,R9),VVETABL(R9)  SWAP                          25170000
         XC    VVETABL(VVETABL,R9),0(R9)  ENTRIES                       25180000
         XC    0(VVETABL,R9),VVETABL(R9)  OVER                          25190000
         OI    FLAG,X'FF'          SET FLAG FOR SEQUENCE CHANGED        25200000
         SPACE 1                                                        25210000
NEXTMEMB DS    0H                  TEST NEXT SEQUENCE                   25220000
         LA    R9,VVETABL(,R9)     UPDATE POINTER                       25230000
         BCT   R4,BUBBLE           GO TRY NEXT PAIR                     25240000
         TM    FLAG,X'FF'          WERE ANY SEQUENCE CHANGES MADE?      25250000
         BNO   SORTED              NO,LIST IS IN SEQUENCE               25260000
         BCT   R5,HUBBLE           ELSE GO ROUND AGAIN                  25270000
         SPACE 2                                                        25280000
SORTED   SUBOUT  RESTORE=(R4,R5,R7,R9)  SORT RETURN                     25290000
         DROP  R9                  END ADDRESSABILITY                   25300000
         EJECT                                                          25310000
*******************************************************************     25320000
*        SUMMARY RECORD CREATION                                        25330000
*******************************************************************     25340000
         SPACE 1                                                        25350000
SUMMARY  DS    0H                  WRITE A RECORD TO SYSUT2             25360000
         SUBIN SAVE=(R2,R3,R4)     SUBROUTINE ENTRY                     25370000
         LA    R2,SYSUT2SW         POINT TO FILE CONTROL BLOCK          25380000
         USING MDCB,R2             ESTABLISH ADDRESSABILITY             25390000
         TM    MDCBFLAG,DDPRES+DDOPEN  TEST IF ABLE TO WRITE            25400000
         BNO   SUMMARYX            NO, FORGET THE WHOLE THING           25410000
         DROP  R2                  FINISHED WITH MDCB                   25420000
         SPACE 1                                                        25430000
         LA    R2,SRSPACE          POINT TO RECORD AREA                 25440000
         USING SRRECORD,R2         ESTABLISH ADDRESSABILITY             25450000
         MVI   SRSPUSED+4,C'0'     PRIME SPACE USED                     25460000
         MVI   SRSPWST+4,C'0'      .. SPACE WASTED                      25470000
         MVI   SRSP100+2,C'0'      .. SPACE PERCENT                     25480000
         CLC   SPUSED,HEAD4        COMPARE SPACE USED WITH BLANKS       25490000
         BE    *+4+6               YES, LEAVE PRIMED VALUE              25500000
         MVC   SRSPUSED,SPUSED     ELSE COPY SPACE USED                 25510000
         MVC   SRVOLSER,SAVESER    COPY VOLUME SERIAL                   25520000
         MVC   SRDSNAME,DATANAME   ..DATASET NAME                       25530000
         MVC   SRCRDATE,CRDATE     ..CREATE DATE                        25540000
         MVC   SREXPDT,PURGDATE    ..EXPIRE DATE                        25550000
         MVC   SRREFDT,REFDATE     ..REFERENCE DATE                     25560000
         MVC   SRDSORG,DSORG       ..DSORG                              25570000
         MVC   SRDSCHA,DSCHA       ..DATA SET CHANGED                   25580000
         MVC   SRRECFM,RECFM       ..RECFM                              25590000
         MVC   SRLRECL,LRECL       ..LRECL                              25600000
         MVC   SRBLKSZE,BLKSIZE    ..BLOCKSIZE                          25610000
         MVC   SRALUNIT,ALUNIT     ..UNIT OF ALLOCATION                 25620000
         MVC   SRSPALC,SPALLOC     ..SPACE ALLOC                        25630000
         MVC   SRALL2ND,ALL2ND     ..SECONDARY ALLOCATION               25640000
         MVC   SREXTENT,EXTENTS    ..NO. EXTENTS                        25650000
         LH    R3,STDREF           GET LAST REFERENCE STD. DAY (LARGER) 25660000
         SH    R3,STDRUN           MINUS RUN STD. DAY NO. (SMALLER)     25670000
         STCM  R3,B'0011',SRBDAYS  EQUALS DAYS SINCE REFERENCE          25680000
         EJECT                                                          25690000
         CLC   DSORG(2),=C'PS'     IS IT A SEQUENTIAL FILE?             25700000
         BE    SUMM003             YES, GO STRAIGHT ON                  25710000
         CLC   DSORG(2),=C'PO'     IS IT A PDS?                         25720000
         BNE   SUMM001             NO,SKIP DIRECTORY INFORMATION        25730000
         MVC   SRDRBALC,DRBLOCKS   ..NO. DIRECTORY BLOCKS               25740000
         MVC   SRDRBUSE,DRBLUSED   ..NO. DIRECTORY BLOCKS USED          25750000
         B     SUMM003             SKIP KEY INFORMATION                 25760000
         SPACE 1                                                        25770000
SUMM001  DS    0H                  TEST FOR INDEX INFORMATION           25780000
         CLC   DSORG(2),=C'IS'     IS IT AN ISAM FILE?                  25790000
         BE    SUMM002             YES, GET KEY INFORMATION             25800000
         CLC   CHARVSAM,DSORG      IS IT A VSAM FILE?                   25810000
         BNE   SUMM003             NO,SKIP KEY INFORMATION              25820000
         MVC   SRCASPLT,VSCASPLT   COPY CA SPLIT PERCENT                25830000
         MVC   SRCISPLT,VSCISPLT    ..  CI SPLIT PERCENT                25840000
         MVC   SRREGSHR,CTREGSHR    ..  REGION SHAREOPTION              25850000
         MVC   SRSYSSHR,CTSYSSHR    ..  SYSTEM SHAREOPTION              25860000
         SPACE 1                                                        25870000
SUMM002  DS    0H                  COPY KEY DATA                        25880000
         MVC   SRISRKP,ISRKP       ..RELATIVE KEY POSITION              25890000
         MVC   SRISKLN,ISKEYLEN    ..KEY LENGTH                         25900000
         SPACE 1                                                        25910000
SUMM003  DS    0H                  BASIC DATA COMPLETE                  25920000
         L     R0,THISALLC         GET SPACE ALLOCATED                  25930000
         LR    R3,R0               COPY TO WORK REGISTER                25940000
         S     R3,THISUSED         MINUS SPACE USED                     25950000
         BM    SUMM004             IF NEGATIVE, FORGET IT               25960000
         BAL   R14,NEDIT           OR GIVE SPACE WASTED                 25970000
         MVC   SRSPWST,EDITWA+3    MOVE IT TO SUMMARY RECORD            25980000
         L     R1,THISUSED         GET SPACE USED                       25990000
         GOSUB PERCENT0            GO CALCULATE PERCENTAGE              26000000
         LR    R3,R1               GET THE ANSWER                       26010000
         BAL   R14,NEDIT           MAKE IT PRINTABLE                    26020000
         MVC   SRSP100,EDITWA+5    COPY TO SUMMARY RECORD               26030000
         SPACE 1                                                        26040000
SUMM004  DS    0H                  PROCES DSNAME QUALIFIERS             26050000
         LA    R3,3                SET NUMBER OF QUALIFIERS             26060000
         LA    R14,SRDSNAME        POINT TO DSNAME                      26070000
         LA    R2,SRQUAL1          POINT TO ANSWER FIELD                26080000
         DROP  R2                  FINISHED WITH ADDRESSABILITY         26090000
         EJECT                                                          26100000
SUMMQUAL DS    0H                  WRITE QUALIFIERS IN SUMMARY RECORD   26110000
         LR    R1,R14              COPY START ADDRESS                   26120000
         GOSUB CHARWORD            GO FIND LENGTH OF QUALIFIER          26130000
         LTR   R1,R1               IS THERE ONE?                        26140000
         BZ    SUMMOUT             NO, LEAVE BLANK                      26150000
         BCTR  R1,0                DECREMENT FOR EXECUTE                26160000
         EX    R1,CHARMOVE         MOVE QUALIFIER TO RECORD             26170000
         LA    R14,2(R1,R14)       POINT TO NEXT INDEX                  26180000
         LA    R2,8(,R2)           POINT TO NEXT OUTPUT FIELD           26190000
         BCT   R3,SUMMQUAL                                              26200000
         SPACE 1                                                        26210000
SUMMOUT  DS    0H                  WRITE SUMMARY RECORD                 26220000
         LA    R2,SRSPACE          POINT TO RECORD AREA                 26230000
         GOSUB SYSUT2WT            GO WRITE RECORD                      26240000
         SPACE 1                                                        26250000
SUMMARYX DS    0H                  RETURN TO CALLER                     26260000
         SUBOUT  RESTORE=(R2,R3,R4)  SUBROUTINE EXIT                    26270000
         SPACE 1                                                        26280000
CHARMOVE MVC   0(*-*,R2),0(R14)    MOVE DSN QUALIFIER      *EXECUTED*   26290000
         EJECT                                                          26300000
*******************************************************************     26310000
*        WRITE SUBROUTINE FOR SYSUT2                              *     26320000
*******************************************************************     26330000
         SPACE 1                                                        26340000
SYSUT2WT DS    0H                  WRITE A RECORD TO SYSUT2             26350000
         SUBIN SAVE=(R4,R3)        SUBROUTINE ENTRY                     26360000
         LR    R3,R2               SAVE RECORD ADDRESS                  26370000
         LA    R2,SYSUT2SW         POINT TO FILE CONTROL BLOCK          26380000
         USING MDCB,R2             ESTABLISH ADDRESSABILITY             26390000
         TM    MDCBFLAG,DDPRES+DDOPEN  TEST IF ABLE TO WRITE            26400000
         BO    SYSUT2WU            YES, CONTINUE                        26410000
         TM    MDCBFLAG,DDPRES+DDINT  HAVE WE ALLOCATED IT?             26420000
         BM    SYSUT2WX            UNABLE TO, FORGET IT                 26430000
         GOSUB OPEN                NO, GO OPEN IT                       26440000
         DROP  R2                  FINISHED WITH MDCB                   26450000
         SPACE 1                                                        26460000
SYSUT2WU DS    0H                  WRITE A RECORD TO SYSUT2             26470000
         LA    R1,SYSUT2           POINT TO DCB                         26480000
         LR    R2,R3               AND RECORD                           26490000
         GOSUB PUTMOVE             GO OUTPUT RECORD                     26500000
         SPACE 1                                                        26510000
SYSUT2WX DS    0H                  RETURN TO CALLER                     26520000
         SUBOUT  RESTORE=(R4,R3)   SUBROUTINE EXIT                      26530000
         EJECT                                                          26540000
*******************************************************************     26550000
*        GENERALISED PUT/MOVE SUBROUTINE                          *     26560000
*        ON ENTRY    R1 --> DCB                                   *     26570000
*                    R2 --> DATA                                  *     26580000
*******************************************************************     26590000
         SPACE 1                                                        26600000
PUTMOVE  DS    0H                  WRITE A RECORD TO SYSUT2             26610000
         SUBIN SAVE=(R1,R2)        SUBROUTINE ENTRY                     26620000
         LR    R9,R4               SAVE LAST BRANCH  *DEBUG*            26630000
         PUT   (R1),(R2)           WRITE A RECORD                       26640000
         SPACE 1                                                        26650000
         SUBOUT  RESTORE=(R1,R2)   SUBROUTINE EXIT                      26660000
         SPACE 2                                                        26670000
*******************************************************************     26680000
*        SUB-ROUTINE TO READ THE VVDS                             *     26690000
*******************************************************************     26700000
         EJECT ,                                                        26710000
VVDSGET  DS    0H                  READ A RECORD FROM THE VVDS          26720000
         SUBIN ,                   SUBROUTINE ENTRY                     26730000
         TM    VSAMSW,DDPRES+DDOPEN CAN WE READ THE FILE?               26740000
         BNO   VVDSGETX            NO,RETURN                            26750000
         GET   RPL=VVDSRPL         READ A RECORD                        26760000
         LTR   R15,R15             READ OK?                             26770000
         BNZ   GETERROR            NO, PROCESS ERROR                    26780000
         SPACE 1                                                        26790000
VVDSGETX DS    0H                  RETURN TO CALLER                     26800000
         SUBOUT  ,                 SUBROUTINE EXIT                      26810000
         EJECT                                                          26820000
*******************************************************************     26830000
*        SUPPLY DEFAULT RECORD LENGTH AND/OR BLOCK SIZE           *     26840000
*         IF NOT CODED.                                           *     26850000
*******************************************************************     26860000
         SPACE 1                                                        26870000
BLKSZRTN SUBIN ,                   SUPPLY DEFAULT LRECL AND/OR BLKS     26880000
         USING IHADCB,R1           ESTABLISH DCB ADDRESSABILITY         26890000
         LH    R4,DCBLRECL         GET LRECL VALUE                      26900000
         LTR   R4,R4               ANY SUPPLIED?                        26910000
         BNZ   *+4+4+4             YES, SKIP SETTING DEFAULT            26920000
         LA    R4,SRRECLEN         FORCE LRECL TO SUMMARY RECORD LEN    26930000
         STH   R4,DCBLRECL         SET DEFAULT                          26940000
         CH    R4,DCBBLKSI         HOW ABOUT BLOCKSIZE                  26950000
         BNH   0(R14)              YES, RETURN TO OPEN                  26960000
         SLL   R4,3                DEFAULT BLOCK IN EIGHTS              26970000
         STH   R4,DCBBLKSI         SET DEFAULT                          26980000
         SUBOUT  RETURN=(R14)      RETURN TO OPEN ROUTINES              26990000
         SPACE 1                                                        27000000
         DROP  R1                  END DCB ADDRESSING                   27010000
         SPACE 3                                                        27020000
*******************************************************************     27030000
*        TEST IF A DD STATEMENT IS PRESENT BEFORE OPEN            *     27040000
*******************************************************************     27050000
         SPACE 1                                                        27060000
TESTIOT  SUBIN ,                   TEST TASK INPUT/OUTPUT TABLE         27070000
         TESTIOT DDNAME=4(R2)      TEST IF DDNAME FOUND IN TIOT         27080000
         B     *+4(R15)            TEST CONDITION CODE                  27090000
         OI    0(R2),DDPRES        TELL THAT DD STATEMENT SUPPLIED      27100000
         SUBOUT  ,                 RETURN TO CALLER                     27110000
         EJECT                                                          27120000
*******************************************************************     27130000
*        OPEN ROUTINE                                             *     27140000
*******************************************************************     27150000
         SPACE 1                                                        27160000
OPEN     SUBIN SAVE=(R3,R4)        OPEN DATA SET                        27170000
         USING MDCB,R2             ESTABLISH DD LIST ADDRESSABILITY     27180000
         TM    MDCBFLAG,DDINT+DDPRES  TEST IF DD INTERESTING AND        27190000
         BNO   OPENX               BRANCH IF NOT                        27200000
         TM    MDCBFLAG,DDOPEN     TEST IF DD ALREADY OPEN              27210000
         BO    OPENX               BRANCH IF OPEN                       27220000
         L     R3,MDCBDCB          GET DCB ADDRESS                      27230000
         USING IHADCB,R3           ESTABLISH ADDRESSABILITY             27240000
         CLC   MDCBOPEN,=CL8'INPUT'  TEST FOR INPUT D/S                 27250000
         BE    OPENZ               BRANCH IF INPUT D/S                  27260000
         CLC   MDCBOPEN,=CL8'OUTPUT'  TEST FOR OUTPUT D/S               27270000
         BE    OPENW               BRANCH IF INPUT D/S                  27280000
         CLC   MDCBOPEN,=CL8'EXTEND'  TEST FOR EXTEND D/S               27290000
         BNE   OPENX               GIVE UP IF NOT KNOWN                 27300000
         OPEN  ((R3),(EXTEND))     OPEN EXTEND DATA SET                 27310000
         B     OPENY               GO SET SWITCH                        27320000
OPENW    OPEN  ((R3),(OUTPUT))     OPEN OUTPUT DATA SET                 27330000
         B     OPENY               GO SET SWITCH                        27340000
OPENZ    OPEN  ((R3),(INPUT))      OPEN INPUT DATA SET                  27350000
OPENY    OI    MDCBFLAG,DDOPEN     INDICATE DATA SET OPEN               27360000
OPENX    SUBOUT  RESTORE=(R3,R4)   RETURN TO CALLER                     27370000
         SPACE 1                                                        27380000
         DROP  R3                  END DCB ADDRESSING                   27390000
         EJECT                                                          27400000
*******************************************************************     27410000
*        CLOSE ROUTINE                                            *     27420000
*******************************************************************     27430000
         SPACE 1                                                        27440000
CLOSE    SUBIN SAVE=(R3)           CLOSE DATA SET                       27450000
         TM    MDCBFLAG,DDOPEN     TEST IF DATA SET OPEN                27460000
         BZ    CLOSEX              EXIT IF NOT                          27470000
         L     R3,MDCBDCB          GET DCB ADDRESS                      27480000
         CLC   MDCBCLOS,=CL8'LEAVE'  TEST FOR REPOSITIONING             27490000
         BNE   CLSNLV              REPOSITIONING REQUIRED               27500000
         CLOSE ((R3),LEAVE)        CLOSE DATA SET, NO REPOSITION        27510000
         B     CLOSEX              GO RESET SWITCH                      27520000
         SPACE 1                                                        27530000
CLSNLV   DS    0H                  CLOSE WITH DEFAULT OPTIONS           27540000
         CLOSE ((R3))              CLOSE DATA SET                       27550000
         SPACE 1                                                        27560000
CLOSEX   DS    0H                  RETURN TO CALLER                     27570000
         NI    MDCBFLAG,FF-DDOPEN  SET OFF 'OPEN' SWITCH                27580000
         SUBOUT  RESTORE=(R3)      SUBROUTINE EXIT                      27590000
         SPACE 1                                                        27600000
         DROP  R2                  END DD LIST ADDRESSABILITY           27610000
         EJECT                                                          27620000
*********************************************************************** 27630000
*                                                                     * 27640000
*        PDSDOC *ROUTINE TO FIND LENGTH OF AN 8-BYTE QUALIFIER .......* 27650000
*                                                                     * 27660000
*        ON INPUT R1 ---> START OF QUALIFIER                          * 27670000
*        ON EXIT  R1  =   LENGTH OF QUALIFIER                         * 27680000
*********************************************************************** 27690000
         SPACE 1                                                        27700000
CHARWORD DS    0H                  FIND LENGTH OF QUALIFIER             27710000
         SUBIN SAVE=(R4)           SUBROUTINE ENTRY             GP09136 27720000
         LA    R4,8                SET MAXIMUM LENGTH                   27730000
CHARWRD1 DS    0H                  EXAMINE EACH BYTE                    27740000
         CLI   0(R1),C'.'          IS IT DELIMITER                      27750000
         BE    CHARWRD2            YES, IS LAST CHARACTER               27760000
         CLI   0(R1),X'40'         IS IT BLANK?                         27770000
         BE    CHARWRD2            YES, IS LAST CHARACTER               27780000
         LA    R1,1(,R1)           POINT AT NEXT CHARACTER              27790000
         BCT   R4,CHARWRD1         LOOP ROUND                           27800000
         SPACE 1                                                        27810000
CHARWRD2 LA    R1,8                FOUND END OF TEXT            GP09136 27820000
         SR    R1,R4               RETURN LENGTH                GP09136 27830000
         SUBOUT  RESTORE=(R4)      RETURN TO CALLER             GP09136 27840000
         EJECT                                                          27850000
*COPIED  COPY  PERCENT0            INCLUDE PERCENTAGE CODE              27860000
         SPACE 2                                                        27870000
*********************************************************************** 27880000
*                                                                     * 27890000
*        PDSDOC *PERCENTAGE CALCULATION TO 0 DECIMALS.................* 27900000
*                                                                     * 27910000
* ON ENTRY TO  THIS ROUTINE R0  =  GRAND TOTAL VALUE                  * 27920000
*                           R1  =  VALUE TO BE PROCESSED              * 27930000
* ON EXIT FROM THIS ROUTINE R0  =  UNCHANGED                          * 27940000
*                           R1  =  VALUE AS PERCENT OF R0, TO 0 DECML * 27950000
*********************************************************************** 27960000
         SPACE 1                                                        27970000
PERCENT0 DS    0H                  PERCENTAGE SUB-ROUTINE               27980000
         SUBIN SAVE=(R2,R3)        SUBROUTINE ENTRY                     27990000
         LTR   R3,R1               COPY VALUE                           28000000
         BZ    PERCENTX            EXIT IF ZERO                         28010000
         SR    R2,R2               CLEAR EVEN REGISTER                  28020000
         LTR   R1,R0               COPY BASE VALUE                      28030000
         BZ    PERCENTX            IF ZERO THEN ZERO PERCENT            28040000
         CR    R3,R1               TEST VALUES                          28050000
         BNE   PERCENT             NOT 100%, CALCULATE RATIO            28060000
         L     R1,HUNDRED          IF EQUAL SET SPECIAL VALUE           28070000
         B     PERCENTX            THEN EXIT                            28080000
         SPACE 1                                                        28090000
PERCENT  DS    0H                  CALCULATE RATIO                      28100000
         M     R2,HUNDRED          WORK IN PERCENT                      28110000
         DR    R2,R1               CALCULATE PERCENTAGE                 28120000
         SRA   R1,1                HALVE DIVISOR                        28130000
         CR    R2,R1               TEST REMAINDER                       28140000
         BL    *+4+4               DO NOT ROUND                         28150000
         LA    R3,1(R3)            ELSE ADD ONE TO SIGNIFICANT DIGIT    28160000
         LR    R1,R3               COPY VALUE                           28170000
         SPACE 1                                                        28180000
PERCENTX DS    0H                  SUBROUTINE EXIT                      28190000
         SUBOUT RESTORE=(R2,R3)    RETURN TO CALLER                     28200000
         SPACE 2                                                        28210000
HUNDRED  DC    A(100)              PERCENTAGE FACTOR                    28220000
         EJECT                                                          28230000
*COPIED  COPY TODDATE              COPY TOD-CLOCK ROUTINE               28240000
*********************************************************************** 28250000
*                                                                     * 28260000
*        PDSDOC *TOD-CLOCK DATE CONVERSION ROUTINE....................* 28270000
*                                                                     * 28280000
* ON ENTRY TO  THIS ROUTINE R1 -->  8-BYTE TOD-CLOCK VALUE            * 28290000
* IF R1 = 0 THEN THE CURRENT TOD-CLOCK VALUE IS USED.                 * 28300000
* ON EXIT FROM THIS ROUTINE VARIOUS FIELDS DEFINED WITHIN THIS COPY   * 28310000
* BLOCK ARE UPDATED. THIS ROUTINE ASSUMES THE STANDARD EPOCH IS USED, * 28320000
* I.E. THE YEAR 2000 IS A LEAP YEAR. VALUES PRODUCED FROM THIS CODE   * 28330000
* ARE ONLY VALID WITHIN THE STANDARD EPOCH 1900 - 2042.               * 28340000
*                                                                     * 28350000
* A LOT OF THE CODE CAME FROM THE @STCK MACRO ON THE NASPA TAPE, PLUS * 28360000
* VARIOUS VERSIONS OF THE $STCK MACRO ON THE CBT TAPE.                * 28370000
*                                                                     * 28380000
* HISTORY:                                                            * 28390000
* 09NOV98 DC    CORRECT LOCAL TIME OVERFLOW CODE                      * 28400000
* 04NOV98 DC    CORRECT LOCAL TIME CODING USING CVTXTNT2              * 28410000
* 22MAY92 CART1 REMOVED ALL THE STANDARD DAY NO. STUFF - SEE TODSDAY  * 28420000
*               MAKE ALL CONSTANTS INTO LITERALS, MAY SAVE SOMETHING  * 28430000
*               ADD TODDSCB FIELD AND CODE                            * 28440000
* 11DEC91 CART1 FILL IN PACKED CENTURY FIELD                          * 28450000
* 09DEC91 CART1 FINALLY PUT IN CODE TO CONVERT TIME TO SECONDS*100    * 28460000
* 29APR91 CART1 STARTED WRITING                                       * 28470000
*                                                                     * 28480000
*********************************************************************** 28490000
         SPACE 1                                                        28500000
TODDATE  DS    0H                  TOD-CLOCK CONVERSION ROUTINE         28510000
         SUBIN SAVE=(R4)           SUBROUTINE ENTRY                     28520000
         LTR   R1,R1               TEST FOR POINTER                     28530000
         BNZ   TODDATE2            GOT ONE, USE IT                      28540000
         STCK  TODCLOCK            ELSE GET CURRENT TOD-CLOCK           28550000
         LA    R1,TODCLOCK         AND USE THAT                         28560000
         SPACE 1                                                        28570000
TODDATE2 DS    0H                  ADJUST FOR LOCAL TIME                28580000
         L     R15,16              GET CVT ADDRESS                      28590000
*NEW*    L     R15,X'148'(,R15)    GET CVTXTNT2 ADDRESS                 28600000
         L     R4,X'130'(,R15)     CVTTZ   MVS TIME ZONE ADJUST GP09136 28610000
*NEW*    L     R4,X'3C'(,R15)      GET LOCAL TIME DEVIATION   CVTLDTO   28620000
         LM    R14,R15,0(R1)       GET TOD-CLOCK VALUE                  28630000
*NEW*    ALR   R15,R4              ADD LOCAL DEVIATION                  28640000
*NEW*    BNO   *+4+4               NO OVERFLOW                          28650000
*NEW*    AL    R14,=F'1'           ADD OVERFLOW                         28660000
         ALR   R14,R4              ADD TIME ZONE OFFSET         GP09136 28670000
         STM   R14,R15,TODCLOCK    SAVE ADJUSTED TOD-CLOCK VALUE        28680000
         LM    R0,R1,TODCLOCK      LOAD ADJUSTED TOD-CLOCK VALUE        28690000
         SRDL  R0,12               CONVERT TO MICROSECONDS              28700000
         GOSUB TODSUB1             GO TO CONVERSION CODE                28710000
         STM   R0,R1,BDAYTOD       SAVE DAYS AND MINUTES..              28720000
         STM   R14,R15,BSECTOD     ..AND SECONDS/MICROSECONDS           28730000
         CVD   R14,TODWORKD        CONVERT SECONDS TO DECIMAL           28740000
         GOSUB TODSUB2             AND THEN TO CHARACTER                28750000
         MVC   TODSS,TODWORKC+1    COPY SECONDS TO ANSWER               28760000
         LR    R15,R1              GET MINUTES                          28770000
         SR    R14,R14             CLEAR EVEN REGISTER                  28780000
         D     R14,=F'60'          GET HOURS                            28790000
         CVD   R14,TODWORKD        CONVERT MINUTES TO DECIMAL           28800000
         GOSUB TODSUB2             AND THEN TO CHARACTER                28810000
         MVC   TODMM,TODWORKC+1    COPY MINUTES TO ANSWER               28820000
         CVD   R15,TODWORKD        CONVERT HOURS TO DECIMAL             28830000
         GOSUB TODSUB2             AND THEN TO CHARACTER                28840000
         MVC   TODHH,TODWORKC+1    COPY HOURS TO ANSWER                 28850000
*                                                                       28860000
*        CALCULATE THE YEAR                                             28870000
*                                                                       28880000
         LR    R1,R0               GET DAY NUMBER                       28890000
         LA    R1,1(R1)            ADD ONE DAY FOR TODAY                28900000
         LA    R15,4               1900 IS NOT A LEAP YEAR              28910000
         LA    R14,1900            SET START YEAR                       28920000
         B     TODDATE4            GO LOOP THRU' THE YEARS              28930000
         SPACE 1                                                        28940000
TODDATE3 DS    0H                  CHECK FOR LEAP YEARS                 28950000
         C     R1,=F'366'          LESS THAN 1 LEAP YEAR LEFT?          28960000
         BNH   TODDATE5            YES, FINISHED                        28970000
         S     R1,=F'366'          NO, SUBTRACT LEAP YEAR               28980000
         LA    R14,1(R14)          ADD ONE TO YEAR                      28990000
         LA    R15,3               RESET LOOP COUNTER                   29000000
         SPACE 1                                                        29010000
TODDATE4 DS    0H                  CHECK FOR NON-LEAP YEARS             29020000
         C     R1,=F'365'          LESS THAN 1 YEAR LEFT?               29030000
         BNH   TODDATE5            YES, FINISHED                        29040000
         S     R1,=F'365'          NO, SUBTRACT LEAP YEAR               29050000
         LA    R14,1(R14)          ADD ONE TO YEAR                      29060000
         BCT   R15,TODDATE4        KEEP CHECKING NORMAL YEARS           29070000
         B     TODDATE3            GO CHECK LEAP YEARS                  29080000
         EJECT ,                                                        29090000
TODDATE5 DS    0H                  FOUND THE YEAR                       29100000
         CVD   R14,TODWORKD        CONVERT YEARS TO DECIMAL             29110000
         ZAP   TODPDATE,TODWORKD+4(4) COPY PACKED JULIAN YEARS          29120000
         GOSUB TODSUB2             AND THEN TO CHARACTER                29130000
         MVC   TODYY,TODWORKC+1    COPY YEARS TO ANSWER                 29140000
         SRP   TODPDATE,3,0        SHIFT UP THE YEARS                   29150000
         SPACE 1                                                        29160000
         SRP   TODWORKD,64-2,0     SHIFT OUT YEARS, LEAVING CENTURY     29170000
         GOSUB TODSUB2             CONVERT TO CHARACTER                 29180000
         MVC   TODCC,TODWORKC+1    COPY CENTURY TO ANSWER               29190000
         SPACE 1                                                        29200000
         CVD   R1,TODWORKD         CONVERT JULIAN DAY TO DECIMAL        29210000
         GOSUB TODSUB2             AND THEN TO CHARACTER                29220000
         MVC   TODDDD,TODWORKC     COPY JULIAN DAYS TO ANSWER           29230000
         AP    TODPDATE,TODWORKD+6(2) COPY PACKED JULIAN DAYS           29240000
         ZAP   TODPTIME,TODPDATE   COPY PACKED DATE                     29250000
         SP    TODPTIME,=P'1900000' SUBTRACT EPOCH START                29260000
         OI    TODPTIME+3,X'0F'    CONVERT SIGN                         29270000
         XC    TODWORKD,TODWORKD   CLEAR WORK AREA                      29280000
         MVC   TODWORKD+6(2),TODPJUL+1 COPY JULIAN DAY                  29290000
         CVB   R14,TODWORKD        CONVERT TO BINARY                    29300000
         STCM  R14,B'0011',TODDSCB+1 SAVE BINARY JULIAN DAYS            29310000
         STCM  R14,B'1000',TODWORKD+6 CLEAR PART OF WORK AREA           29320000
         MVO   TODWORKD+6(2),TODPJUL(1) SET UP PACKED YEAR              29330000
         CVB   R14,TODWORKD        CONVERT YEAR TO BINARY               29340000
         STC   R14,TODDSCB         SAVE BINARY YEAR NUMBER              29350000
         SPACE 1                                                        29360000
TODDATE6 DS    0H                  NOW CALCULATE TIME IN SECONDS*100    29370000
         SR    R14,R14             CLEAR EVEN REGISTER                  29380000
         L     R15,BMSCTOD         GET THE MICROSECONDS                 29390000
         D     R14,=F'10000'       DIVIDE FOR HUNDREDTHS                29400000
         LR    R1,R15              COPY ANSWER                          29410000
         SPACE 1                                                        29420000
         SR    R14,R14             CLEAR EVEN REGISTER                  29430000
         L     R15,BSECTOD         GET THE SECONDS                      29440000
         M     R14,=F'100'         MULTIPLY FOR HUNDREDTHS              29450000
         AR    R1,R15              ADD TO  ANSWER                       29460000
         SPACE 1                                                        29470000
         SR    R14,R14             CLEAR EVEN REGISTER                  29480000
         L     R15,BMINTOD         GET THE MINUTES                      29490000
         M     R14,=F'60'          MULTIPLY FOR SECONDS                 29500000
         M     R14,=F'100'         MULTIPLY FOR HUNDREDTHS              29510000
         AR    R1,R15              ADD TO  ANSWER                       29520000
         SPACE 1                                                        29530000
         ST    R1,TODBTIME         SAVE IN DATA AREA                    29540000
         SPACE 1                                                        29550000
TODDATED DS    0H                  SUBROUTINE EXIT                      29560000
         SUBOUT RESTORE=(R4)       RETURN TO CALLER                     29570000
         EJECT ,                                                        29580000
*********************************************************************** 29590000
* SUB-ROUTINE TO CONVERT MICROSECONDS TO SOMETHING USEFUL             * 29600000
*                                                                     * 29610000
* ON ENTRY TO  THIS ROUTINE R0 + R1 = MICROSECONDS                    * 29620000
* ON EXIT                      R0   = DAYS                            * 29630000
*                              R1   = MINUTES                         * 29640000
*                              R14  = SECONDS                         * 29650000
*                              R15  = MICROSECONDS                    * 29660000
*********************************************************************** 29670000
         SPACE 1                                                        29680000
TODSUB1  DS    0H                  TOD-CLOCK CONVERSION SUB-ROUTINE     29690000
         SUBIN ,                   SUB-ROUTINE ENTRY                    29700000
         D     R0,=AL4(60*1000000) CONVERT TO MINUTES                   29710000
         LR    R15,R0              GET MICROSECONDS                     29720000
         SR    R14,R14             CLEAR EVEN REGISTER                  29730000
         D     R14,=F'1000000'     CONVERT TO SECONDS                   29740000
         XR    R14,R15             SWAP ..                              29750000
         XR    R15,R14             .. VALUES                            29760000
         XR    R14,R15             .. OVER TO MORE LOGICAL SEQUENCE     29770000
         SR    R0,R0               CLEAR EVEN REGISTER                  29780000
         D     R0,=AL4(60*24)      GET NO. DAYS                         29790000
         XR    R0,R1               SWAP ..                              29800000
         XR    R1,R0               .. VALUES                            29810000
         XR    R0,R1               .. OVER TO MORE LOGICAL SEQUENCE     29820000
         SPACE 1                                                        29830000
TODSUB1X DS    0H                  SUBROUTINE EXIT                      29840000
         SUBOUT ,                  RETURN TO CALLER                     29850000
         SPACE 2                                                        29860000
*********************************************************************** 29870000
* SUB-ROUTINE TO BUILD TWO DIGIT CHARACTER FIELD                      * 29880000
*                                                                     * 29890000
* ON ENTRY TO  THIS ROUTINE TODWORKD CONTAINS AN UNPACKED VALUE       * 29900000
* ON EXIT TODWORKC CONTAINS THE LAST THREE CHARACTERS OF THIS VALUE   * 29910000
*********************************************************************** 29920000
         SPACE 1                                                        29930000
TODSUB2  DS    0H                  THREE CHARACTER UNPACK ROUTINE       29940000
         SUBIN ,                   SUB-ROUTINE ENTRY                    29950000
         UNPK  TODWORKC(3),TODWORKD+6(2) CONVERT TO CHARACTER           29960000
         OI    TODWORKC+2,X'F0'    MAKE SIGN PRINTABLE                  29970000
         SPACE 1                                                        29980000
TODSUB2X DS    0H                  SUBROUTINE EXIT                      29990000
         SUBOUT ,                  RETURN TO CALLER                     30000000
         EJECT ,                                                        30010000
TODCLOCK DC    D'0'                AREA FOR CURRENT TOD-CLOCK           30020000
TODWORKD DC    D'0'                DOUBLEWORD WORK AREA                 30030000
TODWORKC DC    CL4'    '           FOUR BYTE TEXT WORK AREA             30040000
BDAYTOD  DC    F'0'                TOD CLOCK BINARY DAYS..              30050000
BMINTOD  DC    F'0'                ..BINARY MINUTES                     30060000
BSECTOD  DC    F'0'                ..BINARY SECONDS                     30070000
BMSCTOD  DC    F'0'                ..BINARY MICROSECONDS                30080000
TODBTIME DC    F'0'                TIME OF DAY IN SECONDS*100           30090000
TODPDATE DC    0PL4'00000'         JULIAN DATE IN PACKED FORMAT         30100000
TODPCENT DC    X'00'               CENTURY                              30110000
TODPJUL  DC    PL3'00000'          DATE WITHIN CENTURY IN PACKED FORMAT 30120000
TODPTIME DC    PL4'00000'          DATE IN SAME FORMAT AS 'TIME' DATES  30130000
TODDSCB  DC    XL3'000000'         DATE IN SAME FORMAT AS DSCB1 DATES   30140000
         SPACE 1                                                        30150000
*        TIME AND DATE IN VARIOUS TEXT FORMATS                          30160000
         SPACE 1                                                        30170000
TODTIME  DS    0CL8                TIME HH.MM.SS                        30180000
TODHH    DC    CL2'00'             HOURS                                30190000
         DC    CL1':'              SEPARATOR                            30200000
TODMM    DC    CL2'00'             MINUTES                              30210000
         DC    CL1':'              SEPARATOR                            30220000
TODSS    DC    CL2'00'             SECONDS                              30230000
         SPACE 1                                                        30240000
TODCC    DC    CL2'00'             CENTURY                              30250000
TODYY    DC    CL2'00'             YEAR                                 30260000
TODDDD   DC    CL3'000'            JULIAN DAY                           30270000
         SPACE 1                                                        30280000
TODEND   EQU   *                   END OF TOD CLOCK DATA                30290000
TODLEN   EQU   TODEND-TODCLOCK     LENGTH OF TOD CLOCK DATA             30300000
         EJECT                                                          30310000
*COPIED  COPY STDDAY01             COPY STANDARD DAY CONVERSION         30320000
*********************************************************************** 30330000
*                                                                     * 30340000
*        PDSDOC *STANDARD DAY NUMBER CONVERSION ROUTINE (DSCB1 FORMAT)* 30350000
*                                                                     * 30360000
* ON ENTRY TO  THIS ROUTINE R1 -->  3-BYTE BINARY DATE X'YYDDDD'      * 30370000
* ON EXIT FROM THIS ROUTINE R1  =   BINARY STANDARD DAY NO.           * 30380000
*                                                                     * 30390000
* THE IDEA OF A STANDARD DAY VALUE CAME FROM J.P.GRASSBY PUBLISHED IN * 30400000
* 'FREELANCE INFORMER' VOL. 5 NO.2 BUT MODIFIED TO ONLY COUNT FROM THE* 30410000
* NEXT IBM TOD-CLOCK ROLLOVER DATE IN 2042, RATHER THAN 31/12/9999.   * 30420000
* THIS CONCEPT ALLOWS ARITHMETIC TO BE PERFORM DIRECTLY ON DATES, CAN * 30430000
* BE USED AS AN INDEX KEY (GET NEXT EQUAL OR GT), AND IS A DATE FORM  * 30440000
* INDEPENDENT OF NATIONAL FORMATS OR CALENDAR SCHEMES (EG. ISLAMIC)   * 30450000
*                                                                     * 30460000
* HISTORY:                                                            * 30470000
* 22MAY92 CART1 WROTE BASED ON STDDAY11                               * 30480000
*                                                                     * 30490000
*********************************************************************** 30500000
         SPACE 1                                                        30510000
STDDAY01 RIN   (R0,R2,R3)          SUBROUTINE ENTRY                     30520000
         SR    R4,R4               CLEAR REGISTER                       30530000
         IC    R4,0(,R1)           PICK UP YEAR                         30540000
         STH   R4,HYEARINP         SAVE YEAR VALUE                      30550000
         ICM   R4,B'0011',1(R1)    PICK UP DAY                          30560000
         STH   R4,HDAYINP          SAVE THIS VALUE                      30570000
         LA    R4,42               SET ROLLOVER YEAR                    30580000
         CH    R4,HYEARINP         COMPARE TO INPUT YEAR                30590000
         BNL   *+4+4               CARRY ON IN 21ST CENTURY             30600000
         LA    R4,100(,R4)         ADD A CENTURY IN 20TH                30610000
         STH   R4,HYEARSD1         SAVE ROLLOVER YEAR                   30620000
         LH    R1,HYEARINP         PICK UP THE INPUT YEAR               30630000
         GOSUB SD1LEAP             FIND OUT IF LEAP                     30640000
         LA    R4,260              SET ROLLOVER JULIAN DAY              30650000
         LTR   R2,R2               IS INPUT YEAR LEAP?                  30660000
         BNZ   *+4+4               NO, SKIP THE EXTRA DAY               30670000
         LA    R4,1(,R4)           YES, COUNT AN EXTRA DAY              30680000
         STH   R4,HDAYSD1          SAVE NO. OF STD DAY ZERO             30690000
         CH    R4,HDAYINP          CHECK NEED TO BORROW A YEAR          30700000
         BNL   STDDAY1A            NO, GO STRAIGHT AHEAD                30710000
         LA    R4,365(,R4)         BORROW A YEAR                        30720000
         LA    R1,1(,R1)           EVEN IT UP ON THE INPUT              30730000
         STH   R1,HYEARINP         SAVE UPDATED YEAR VALUE              30740000
         EJECT ,                                                        30750000
STDDAY1A DS    0H                  CALCULATE DIFFERENCE OF YEARS        30760000
         SH    R4,HDAYINP          CALCULATE SPAN BETWEEN DAYS          30770000
         LR    R0,R4               SAVE VALUE                           30780000
         LH    R4,HYEARSD1         GET ROLLOVER YEAR                    30790000
         SR    R4,R1               SUBTRACT THE YEARS                   30800000
         SR    R2,R2               CLEAR EVEN REGISTER                  30810000
         LA    R3,365              SET NO. DAYS IN A YEAR               30820000
         MR    R2,R4               CALCULATE DIFFERENCE IN DAYS         30830000
         AR    R0,R3               COMPUTE TOTAL DAYS FROM ROLLOVER     30840000
         LR    R1,R4               COPY DIFFERENCE IN YEARS             30850000
         GOSUB SD1LEAP             HOW MANY LEAP YEARS?                 30860000
         LR    R1,R0               RECALL SUM TO DATE                   30870000
         AR    R1,R3               ADD EXTRA DAYS FOR LEAP YEARS        30880000
         SPACE 1                                                        30890000
STDDAY1X DS    0H                  SUBROUTINE EXIT                      30900000
         ROUT  ,                   RETURN TO CALLER                     30910000
         EJECT ,                                                        30920000
*********************************************************************** 30930000
* SUB-ROUTINE TO CALCULATE LEAP YEARS - SIMPLY DIVIDE BY FOUR         * 30940000
*                                                                     * 30950000
* ON ENTRY TO  THIS ROUTINE    R1   =  BINARY YEAR NUMBER             * 30960000
* ON EXIT                      R3   =  NUMBER OF LEAP YEARS           * 30970000
*                              R2   =  REMAINING NORMAL YEARS         * 30980000
*********************************************************************** 30990000
         SPACE 1                                                        31000000
SD1LEAP  RIN   ,                   SUBROUTINE ENTRY                     31010000
         LR    R2,R1               LOAD DIVIDEND IN WRONG REG   GP09136 31020000
         SRDA  R2,32               LOAD DIVIDEND IN PROPER REG  GP09136 31030000
         D     R2,=F'4'            DO THE DIVISION              GP09136 31040000
         ROUT ,                    RETURN TO CALLER                     31050000
         SPACE 2                                                        31060000
HDAYINP  DC    H'0'                BINARY DAYS                          31070000
HYEARINP DC    H'0'                BINARY YEARS                         31080000
HDAYSD1  DC    H'0'                BINARY DAYS IN ROLLOVER YEAR         31090000
HYEARSD1 DC    H'0'                BINARY YEARS IN ROLLOVER YEAR        31100000
         EJECT                                                          31110000
*COPIED  COPY GETDVCT              COPY DEVICE CHARACTERISTICS CODE     31120000
*********************************************************************** 31130000
*                                                                     * 31140000
*        PDSDOC *CODE TO LOCATE DEVICE CHARACTERISTICS TABLE FOR DISK.* 31150000
*                                                                     * 31160000
*        ON ENTRY:                                                    * 31170000
*              R1   -> UCB                                            * 31180000
*                                                                     * 31190000
*        ON EXIT:                                                     * 31200000
*              R1   -> DVCT. SPECIFY USING DVCT,R1 FOR ADDRESSABILITY * 31210000
*                                                                     * 31220000
*        IBM MAPPING MACROS USED ARE:                                 * 31230000
*              IEFUCBOB                                               * 31240000
*              IHADVCT                                                * 31250000
*              CVT                                                    * 31260000
*                                                                     * 31270000
*********************************************************************** 31280000
         SPACE 2                                                        31290000
GETDVCT  SUBIN SAVE=(R3,R4)        SUBROUTINE ENTRY                     31300000
         USING UCBOB,R1            ESTABLISH UCB ADDRESSABILITY         31310000
         L     R3,CVTPTR           GET CVT POINTER                      31320000
         USING CVTMAP,R3           ESTABLISH CVT ADDRESSABILITY         31330000
         L     R3,CVTZDTAB         GET DEVICE TABLE START               31340000
         DROP  R3                  END CVT ADDRESSABILITY               31350000
         USING DVCTI,R3            ESTABLISH DCVT INDEX ADDRESSABILITY  31360000
         LA    R4,DVCTYPMK         MASK FOR UNIT TYPE NUMBER            31370000
         N     R4,UCBTYP           PICK UP UNIT TYPE NUMBER             31380000
         IC    R4,DVCTIOFF(R4)     PICK UP OFFSET                       31390000
         LA    R1,0(R4,R3)         POINT TO DEVICE ENTRY                31400000
         SPACE 1                                                        31410000
GOTDVCT  DS    0H                  END OF SUBROUTINE                    31420000
         SUBOUT RESTORE=(R3,R4)    RETURN TO CALLER                     31430000
         SPACE 2                                                        31440000
         DROP  R1                  END UCB ADDRESSABILITY               31450000
         DROP  R3                  END DCVT INDEX ADDRESSABILITY        31460000
         EJECT                                                          31470000
*********************************************************************   31480000
*         ERROR MESSAGES                                                31490000
*********************************************************************   31500000
IOER     WTO   MF=(E,MSSAGE)       PRINT IO ERROR                       31510000
IOER3    PUT   PRINT,MSSAGE+4      PUT MESSAGE ON PRINTER               31520000
         B     PRINTIT             GO PRINT IT                          31530000
IOER1    MVC   EXTOUT+1(L'ERMS3),ERMS3      ERROR MSG                   31540000
         B     IOER                PRINT ERROR                          31550000
         SPACE 1                                                        31560000
TABLOVF0 MVC   EXTOUT+10(L'ERMS),ERMS      PRINT ERROR MESSAGE          31570000
         BAL   R14,LINE1OUT        GO OUTPUT MESSAGE                    31580000
         B     MAPPED              END THIS VOLUME                      31590000
         SPACE 1                                                        31600000
IOER2    MVC   EXTOUT+1(L'ERMS4),ERMS4      ERROR MSG                   31610000
         B     IOER                PRINT ERROR                          31620000
VOL      WTO   MF=(E,LISTWTO)      PRINT INTERVENTION REQD              31630000
         TIME  BIN                 GET TIME                             31640000
         LR    R1,R0                                                    31650000
         A     R1,=F'4000'         ADD FORTY SECONDS                    31660000
         ST    R1,HOLD             SAVE                                 31670000
STALL    TIME  BIN                                                      31680000
         C     R0,HOLD                                                  31690000
         BL    STALL               STALL FORTY  SECONDS                 31700000
         B     GETDSCB             TRY AGAIN                            31710000
VOL1     MVC   MSGTP,SAVESER       INTERVENTION REQUIRED                31720000
         WTO   MF=(E,LISTWTO)                                           31730000
         TIME  BIN                 GIVE OPERATOR TIME TO MOUNT          31740000
         A     R0,=F'4000'         ADD FORTY SECONDS                    31750000
         ST    R0,HOLD             SAVE                                 31760000
STALL1   TIME  BIN                                                      31770000
         C     R0,HOLD             SEE IF AT 40 SECONDS                 31780000
         BL    STALL1              JUMP TO STALL                        31790000
         B     F1DSCBS             TRY AGAIN TO FETCH IT                31800000
NOTHERE  MVC   EXTOUT+1(31),WARNING  VOLUME NOT MOUNTED                 31810000
         B     PRINTIT             GO PRINT IT                          31820000
         EJECT                                                          31830000
*        *********************************                              31840000
*        *     LOGICAL ERROR ROUTINE     *                              31850000
*        *********************************                              31860000
         SPACE 1                                                        31870000
VSMLERAD DS    0H                                                       31880000
         L     R0,12(R7)           LOAD RPL ADDRESS                     31890000
         LA    R1,VSAMMESS                                              31900000
         MVC   VSAMMESS+5(29),=C'VVDS GET ERROR; LERAD ENTERED' GP09136 31910000
*MVS38*  LINK  EP=VSMERROR                                      GP09136 31920000
         SPACE 1                                                        31930000
         ST    R1,FW               SAVE FDBK CODE                       31940000
         SPACE 1                                                        31950000
         BAL   R1,VSAMWTO                                               31960000
         DC    AL2(121)                                                 31970000
         DC    XL2'0000'                                                31980000
VSAMMESS DS    CL121                                                    31990000
VSAMWTO  DS    0H                                                       32000000
         SVC   35                                                       32010000
         SPACE 1                                                        32020000
         B     UABEND                                                   32030000
         EJECT                                                          32040000
*        *********************************                              32050000
*        *     PROGRAMM EXITS/ABENDS     *                              32060000
*        *********************************                              32070000
         SPACE 1                                                        32080000
DATERROR BAL   R1,UABWTO           WRITE MSG AND QUIT           GP09136 32090000
         WTO   'LISTICF ==> ERROR ON DATE CONVERSION - ABEND WITH DUMP'*32100000
               ,ROUTCDE=11,MF=L                                         32110000
         SPACE 2                                                        32120000
DYNERROR DS    0H                                                       32130000
         BAL   R1,UABWTO           WRITE MSG AND QUIT           GP09136 32140000
         WTO   'MAPDISK ==> ERROR ALLOCATING VVDS - ABEND WITH DUMP',  *32150000
               ROUTCDE=11,MF=L                                          32160000
         SPACE 2                                                        32170000
GETERROR DS    0H                                                       32180000
         BAL   R1,UABWTO           WRITE MSG AND QUIT           GP09136 32190000
         WTO   'MAPDISK ==> ERROR ON VSAM GET - ABEND WITH DUMP',      *32200000
               ROUTCDE=11,MF=L                                          32210000
         B     UABEND                                                   32220000
         SPACE 2                                                        32230000
GENCBERR DS    0H                                                       32240000
         BAL   R1,UABWTO           WRITE MSG AND QUIT           GP09136 32250000
         WTO   'MAPDISK ==> ERROR ON VSAM GENCB - ABEND WITH DUMP',    *32260000
               ROUTCDE=11,MF=L                                          32270000
         SPACE 1                                                        32280000
DYNAERR  DS    0H                                                       32290000
*        MVC   CATRRELT(18),=C'VVDS ALLOCATION ER'                      32300000
*        MVC   CATRRELT+18(14),=C'ROR - CODE => '                       32310000
*        LH    R1,DYNCB+4                                               32320000
*        GOSUB CODECONV                                                 32330000
*        ST    R1,FW                                                    32340000
*        MVC   CATRRELT+32(4),FW                                        32350000
*        LA    R15,4                                                    32360000
         ABEND 999,DUMP            =========>   ONLY FOR TEST           32370000
*                                  <==========                          32380000
         B     DYNVVDSE                                                 32390000
         SPACE 2                                                        32400000
MODCBERR DS    0H                                                       32410000
         BAL   R1,UABWTO           WRITE MSG AND QUIT           GP09136 32420000
         WTO   'MAPDISK ==> ERROR ON VSAM MODCB - ABEND WITH DUMP',    *32430000
               ROUTCDE=11,MF=L                                          32440000
         SPACE 2                                                        32450000
SHOWERR  DS    0H                                                       32460000
         BAL   R1,UABWTO           WRITE MSG AND QUIT           GP09136 32470000
         WTO   'MAPDISK ==> ERROR ON VSAM SHOWCB - ABEND WITH DUMP',   *32480000
               ROUTCDE=11,MF=L                                          32490000
         SPACE 2                                                        32500000
OPENERR  DS    0H                                                       32510000
         BAL   R1,UABWTO           WRITE MSG AND QUIT           GP09136 32520000
         WTO   'MAPDISK ==> ERROR ON VSAM OPEN - ABEND WITH DUMP',     *32530000
               ROUTCDE=11,MF=L                                          32540000
         SPACE 2                                                        32550000
UABWTO   WTO   MF=(E,(R1))                                      GP09136 32560000
UABEND   ABEND 1111,DUMP                                                32570000
         EJECT                                                          32580000
*********************************************************************   32590000
*                                                                       32600000
*         SYNAD ROUTINE *                                               32610000
*                                                                       32620000
*********************************************************************   32630000
PDSIOER  DS    0H                                                       32640000
         SYNADAF ACSMETH=QSAM                                           32650000
         MVC   SYNADMS2+1(132),8(R1)  SAVE ERROR MESSAGE                32660000
         MVC   SYNADMS1+65(44),DS1DSNAM  GET DSNAME                     32670000
         PUT   PRINT,SYNADMS1      PUT IN ERROR MESSAGE1                32680000
         BAL   R14,LINE1OUT        PRINT LINE W/ LINE TEST              32690000
         SYNADRLS                                                       32700000
         B     CLOSEPDS            PRINT PDS DSN INFO                   32710000
SYNADMS1 DC    CL133' * * * I/O ERROR OCCURRED READING DIRECTORY OF PDS132720000
               .* * * DSNAME='                                          32730000
         EJECT                                                          32740000
*********************************************************************   32750000
*                                                                       32760000
*         VARIABLES, CONSTANTS, EQUATES , ETC                           32770000
*                                                                       32780000
*********************************************************************   32790000
         DS    0H                                                       32800000
NOSPARES DS    H                   NO OF SPARES                         32810000
TRKCNT   DC    AL1(0)              HALF WORD CHECK FOR NUMBER OF        32820000
SVCOUNT  DC    AL1(0)              DSCB'S PER TRACK                     32830000
LINEKNT  DC    PL2'0'              KEEP TRACK OF LINES PER PAGE         32840000
PAGEKNT  DC    PL2'0'                                                   32850000
GPAGEKNT DC    PL2'0'                                                   32860000
GLINEKNT DC    PL2'0'                                                   32870000
PATTERN  DC    X'4020202020202120'  NEW EDITTING PATTERN                32880000
         SPACE 1                                                        32890000
PARMSWCH DC    X'00'               SWITCH FOR 'FULL' PARM               32900000
SWIT     DC    X'FF'                                                    32910000
FLAG     DC    X'00'               FLAG FOR BUBBLE SORT                 32920000
         SPACE 1                                                        32930000
EDITWA   DS    D                   DOUBLE-WORD WORK AREA FOR NEW EDIT   32940000
TIOTNVOL DS    CL1                 NUMBER OF VOLS PER DD ENTRY          32950000
         DS    0D                                                       32960000
PSEUDOF5 DS    CL140               WORK AREA FOR PSEUDO DSCB FORMAT 5   32970000
*        RETURNED BY 'IXVTOCF5' WHEN DISK SCANNED HAS AN INDEXED VTOC   32980000
SAVEF4   DS    CL140               STORE F4 DSCB FOR MORE REFS          32990000
CHECKER  DC    F'0'                TO CHECK FOR MISSING TRACKS          33000000
EXTKNT   DC    F'0'                SAVE EXTENT COUNT OF F1              33010000
THISALLC DC    F'0'                BINARY TRACKS ALLOCATED              33020000
THISUSED DC    F'0'                BINARY TRACKS USED                   33030000
DSLEN    DC    F'0'                DS SIZE (TRACKS)                     33040000
TTRVTOC  DC    1F'0'               SAVE TTR0 OF VTOC                    33050000
HOLD     DS    5F                  SAVE RETURN ADDRESS                  33060000
SRTKNT   DC    F'1'                ENTRIES IN SORT TABLE                33070000
NTRKNT   DC    F'1'                NEXT ENTRY POSITION FOR DSCB F1      33080000
TIOT     DS    1F                  SAVE TIOT  ADDRESS                   33090000
UCBADDR  DS    F                   ADDRESS OF NEXT UCB ADDRESS          33100000
TYPE     DC    X'30002001'         TYPE FOR DISK                        33110000
STDRUN   DC    H'0'                STANDARD DAY NO. OF RUN              33120000
STDREF   DC    H'0'                REFRENCE DATE STANDARD DAY NO.       33130000
         RIN   GENERATE            REGISTER SAVE AREA                   33140000
         SPACE 1                                                        33150000
         DS    0F                                                       33160000
PDSJFCB  DC    X'87'               READ JFCB                            33170000
         DC    AL3(PDSAREA)                                             33180000
PDSAREA  DS    CL176                                                    33190000
         DS    0F                                                       33200000
STRJFCB  DC    X'87'               ONE ENTRY ONLY                       33210000
         DC    AL3(JFCBAREA)                                            33220000
JFCBAREA DS    CL176               JFCB AREA FOR TEST                   33230000
CAMSERCH CAMLST  SEARCH,DYNDSNM,SAVESER,WORK   VVDS OBTAIN PLIST   @Q01 33240000
LIST     CAMLST  SEEK,ADDRS,SAVESER,WORK                                33250000
         DS    0D                                                       33260000
SEEK     DC    AL3(0)              DUMMY PART                           33270000
ADDRS    DC    XL5'0'              ADDRESS PART                         33280000
MYDEB    DC    4F'0'               FAKE UP A DEB FOR TRACK CONVERSION   33290000
         DC    AL1(1)              ONE EXTENT                           33300000
         DC    AL3(0)                                                   33310000
         DC    1F'0'               NO PURGE                             33320000
         DC    X'0F'               ID                                   33330000
         DC    AL3(0)                                                   33340000
         DC    X'04'               EXTENT SCALE                         33350000
APPEN    DC    AL3(0)              APPENTAGE TABLE ADDRESS              33360000
UCBXREF  DC    XL4'C0000000'       UCB ADDRESS - PLACED BY PROGRAM      33370000
         DC    3AL2(0)             STARTING ADDRESS                     33380000
         DC    X'FFFFFFFF7FFF'     LAST CCHH NUMBER POSSIBLE            33390000
         SPACE 1                                                        33400000
RKDD     DS    0F                  RKDD FOR STAR                        33410000
         DC    AL2(0)              RECORD NO. AND KEYLEN                33420000
         DC    AL2(0)              RECORD LENGTH                        33430000
         EJECT                                                          33440000
SRTBL    DS    F                   ADDRESS OF SORT TABLE                33450000
VVETBL   DS    F                   POINTER TO VVR ENTRIES TABLE         33460000
VVENOW   DS    F                   POINTER TO CURRENT VVR ENTRY         33470000
DSTBL    DS    F                   POINTER TO DSCB TABLE                33480000
ANXTDSCB DS    F                   POINTER TO DSCB TABLE ENTRY          33490000
F356TBL  DS    F                   ADDR OF START OF F356 TABLE          33500000
F356END  DS    F                   SAVED END OF FORMAT356 TABLE         33510000
DSEND    DS    F                   END OF F1 TABLE                      33520000
BOUNDS   DC    F'1024'             BOUNDS FOR GETMAIN                   33530000
         DC    F'600000'           * CART1 09AUG91 *                    33540000
TBLADDR  DC    F'0'                START OF TABLE                       33550000
TBLLENG  DC    F'0'                LENGTH OF TABLE                      33560000
ACCEND   DS    F                                                        33570000
SREND    DS    F                                                        33580000
ACCTABLE DS    F                                                        33590000
H160     DC    H'160'                                                   33600000
H4       DC    H'4'                                                     33610000
H56      DC    H'56'                                                    33620000
VVECNT   DC    H'0'                COUNT OF VVR ENTRIES                 33630000
GENOPT   DC    X'00'               GENERAL FLAGS                        33640000
GENPAGE  EQU   X'20'               NEW PAGE SWITCH                      33650000
GENSMS   EQU   X'08'               VOLUME IS SMS                        33660000
         SPACE 1                                                        33670000
         DS    0D                                                       33680000
WORK     DS    CL350               WORKING STORAGE FOR OBTAIN           33690000
WBYTE    DS    C                   ONE BYTE FOR MEMBERS WORK AREA       33700000
SAVEHWM  DC    XL5'0'              SAVE FOR HIGHEST CCHHR TO CHECK      33710000
CHARVSAM DC    CL2'VS'             DSORG FOR REPORT                     33720000
         DS    0F                  ALIGN FOR SPS                        33730000
MSSAGE   DC    AL2(MSEND-*)                                             33740000
         DC    AL2(0)                                                   33750000
         DC    C' SER='                                                 33760000
SERMSG   DC    CL6' '                                                   33770000
         DC    C' PERMANENT I/O ERROR ON DISK. NO RECOVERY.'            33780000
MSEND    DC    CL80' '                                                  33790000
ERMS     DC    C'***OUT OF SPACE - INCREASE REGION SIZE***'             33800000
ERMS1    DC    C'****IMPOSSIBLE TO MAP A SYSIN OR SYSOUT DD'            33810000
ERMS2    DC    C'*****UNIT NOT A DASD OR UNIT OFF-LINE'                 33820000
ERMS3    DC    C'FMT 5 DSCB NOT FOUND, POINTED TO BY FMT 4 DSCB'        33830000
ERMS4    DC    C'SEARCH FOR FMT 3 OR 5 DSCB UNSUCCESSFUL'               33840000
         DS    0F                                                       33850000
LISTWTO  DC    AL2(TOPMSG-*)                                            33860000
         DC    AL2(0)                                                   33870000
         DC    C' SER '                                                 33880000
MSGTP    DC    CL7' '                                                   33890000
         DC    C'INTERVENTION REQUIRED'                                 33900000
GSKIP2   DC    CL133'0'                                                 33910000
TOPMSG   DS    0C                                                       33920000
SKIP2    DC    C'0'                ONE SPACE PLUS LINE                  33930000
         EJECT                                                          33940000
*********************************************************************   33950000
*                                                                       33960000
*               DETAIL LINE INFORMATION                                 33970000
*                                                                       33980000
*********************************************************************   33990000
OUTBIN   DC    C' '                OUTPUT BIN -  NO  SPACE (PRINT)      34000000
DATANAME DC    CL44'WHO'           DATASET NAME                         34010000
         DC    CL1' '                                                   34020000
CRDATE   DC    CL5'01234'          CREATION DATE                        34030000
         DC    CL1' '                                                   34040000
PURGDATE DC    CL5'99350'          PURGE DATE                           34050000
         DC    CL1' '                                                   34060000
REFDATE  DC    CL5' '              REFERRED-TO DATE                     34070000
DSCHA    DC    CL1' '              DATA SET CHANGED                     34080000
         DC    CL1' '                                                   34090000
DSORG    DC    CL4' '              DATA SET ORGANISATION                34100000
         DC    CL1' '                                           GP09136 34110000
RECFM    DC    CL5' '              RECORD FORMAT                GP09136 34120000
         DC    CL1' '                                                   34130000
LRECL    DC    CL5' '              LOGICAL RECORD LENGTH                34140000
         DC    CL1' '                                                   34150000
BLKSIZE  DC    CL5' '              BLOCK SIZE                           34160000
         DC    CL1' '                                                   34170000
ALUNIT   DC    CL5' '              ALLOC UNITS--(TRK,CYL,BLK)           34180000
SPALLOC  DC    CL5' '              SPACE ALLOCATED TRACKS TOTAL         34190000
         DC    CL1' '                                                   34200000
SPUSED   DC    CL5' '              SPACE USED - TOTAL TRACKS            34210000
         DC    CL1' '                                                   34220000
ALL2ND   DC    CL4' '              SECONDARY ALLOCATION                 34230000
         DC    CL1' '                                                   34240000
EXTENTS  DC    CL3'00'             NUMBER OF EXTENTS                    34250000
         DC    CL1' '                                                   34260000
VSCASPLT DC    0CL3'   '           CA SPLITS PERCENT                    34270000
DRBLOCKS DC    CL4'  35'           NO. DIRECTORY BLOCKS ALLOCATED       34280000
         DC    CL1' '                                                   34290000
VSCISPLT DC    0CL3'   '           CI SPLITS PERCENT                    34300000
DRBLUSED DC    CL4'   0'           NUMBER OF DIRECTORY BLOCKS USED      34310000
         DC    CL1' '                                                   34320000
ISRKP    DC    CL5'    0'          I.S. R.K.P.(RELATIVE KEY POSITION)   34330000
         DC    CL1' '                                                   34340000
ISKEYLEN DC    CL3'  0'            I.S. KEYLENGTH                       34350000
         SPACE 2                                                        34360000
CALCU    DC    CL10' '                                                  34370000
         SPACE 2                                                        34380000
EXTOUT   DC    CL133' '            SPACE FOR OUTPUT LINES               34390000
         ORG   EXTOUT+13                                                34400000
ZEXT     DC    CL3' '              EXTENT NUMBER                        34410000
         DC    CL1' '                                                   34420000
ZFIRST   DC    CL5' '              FIRST TRACK HERE                     34430000
         DC    CL2' '                                                   34440000
ZLAST    DC    CL5' '              LAST TRACK NEXT                      34450000
         DC    CL1' '                                                   34460000
ZLNGTH   DC    CL5' '              LENGTH OF EXTENT                     34470000
         DC    CL16' '                                                  34480000
ZMGMTCL  DC    CL8' '              SMS MANAGEMENT CLASS                 34490000
         DC    CL10' '                                                  34500000
ZDATACL  DC    CL8'  '             SMS DATA CLASS                       34510000
         DC    CL16' '                                                  34520000
ZSTORCL  DC    CL8' '              SMS STORAGE CLASS                    34530000
         SPACE 2                                                        34540000
         ORG   EXTOUT                                                   34550000
SYNADMS2 EQU   EXTOUT                                                   34560000
         SPACE 2                                                        34570000
SOUTBIN  DC    C' '                OUTPUT BIN -  NO  SPACE (SYSOUT)     34580000
MAPS     DC    CL3' '                                                   34590000
STRTT    DC    CL5' '              START TRACK                          34600000
         DC    CL9' '                                                   34610000
LSTT     DC    CL5' '              LAST TRACK                           34620000
         DC    CL10' '                                                  34630000
LNGTH    DC    CL5' '              LENGTH OF EXTENT                     34640000
         DC    CL6' '                                                   34650000
EXTT     DC    CL3' '              EXTENT NUMBER                        34660000
         DC    CL6' '                                                   34670000
SHLINE   DC    CL44' '             DATA SET NAME                        34680000
         DC    CL36' '             REST ARE BLANK                       34690000
         EJECT                                                          34700000
*********************************************************************   34710000
*                                                                       34720000
*               PAGE AND COLUMN HEADINGS                                34730000
*                                                                       34740000
*********************************************************************   34750000
HEAD1    DC    CL1'1'              SKIP TO TOP OF PAGE                  34760000
*OLD*HEAD2    DC    CL37'DARNICK COMPUTING LTD. (V9.2)'                 34770000
         DC    C'MAPDISK (V9.3)    DD '                         GP09136 34780000
HEAD2DD  DC    CL8' ',C' '                                      GP09136 34790000
         DC    CL35'  MAP OF DISK CONTENTS ON VOLUME * '                34800000
SAVESER  DC    CL6'SYSOUT',C' '                                         34810000
HEAD2TY  DC    CL6' '                                           GP09136 34820000
         DC    CL14' *     DATE : '                                     34830000
HEADDATE DS    CL9                                                      34840000
         DC    CL9'  TIME : '                                           34850000
HEADTIME DC    CL8'  .  .  '                                            34860000
         DC    CL5'     '                                               34870000
         DC    CL5'PAGE'                                                34880000
PAGEPLC  DC    CL4' '              PAGE COUNT HERE                      34890000
         SPACE 2                                                        34900000
HEAD3    DC    CL1'0'                                                   34910000
         DC    CL44'*-------------- DATA SET NAME -------------*'       34920000
         DC    CL1' '                                                   34930000
         DC    CL17'*---- DATES ----*'                                  34940000
         DC    CL1' '                                                   34950000
         DC    CL23'*-------- DCB --------*'                            34960000
         DC    CL1' '                                                   34970000
         DC    CL25'*--ALLOCATION (TRACKS)--*'                          34980000
         DC    CL1' '                                                   34990000
         DC    CL19'*-- VS/PO STATS --*'                                35000000
         SPACE 2                                                        35010000
HEAD4    DC    CL1' '                                                   35020000
         DC    CL34' '                                                  35030000
         DC    CL10'           '                                        35040000
         DC    CL6' CREDT'                                              35050000
         DC    CL6' EXPDT'                                              35060000
         DC    CL6' REFDT'                                              35070000
         DC    CL6' DSORG'                                              35080000
         DC    CL6' RECFM'                                              35090000
         DC    CL6' LRECL'                                              35100000
         DC    CL6' CISIZ'                                              35110000
         DC    CL5' TYPE'                                               35120000
         DC    CL6' ALLOC'                                              35130000
         DC    CL6'  USED'                                              35140000
         DC    CL1' '                                                   35150000
         DC    CL5'2NDY '                                               35160000
         DC    CL3'NO.'                                                 35170000
         DC    CL1' '                                                   35180000
         DC    CL5' CA% '                                               35190000
         DC    CL5' CI% '                                               35200000
         DC    CL9'VS RKP-KL'                                           35210000
         SPACE 2                                                        35220000
HEAD5    DC    CL1' '                                                   35230000
         DC    CL34'            EXT-FIRST---LAST-LNGTH'                 35240000
         DC    CL10'           '                                        35250000
         DC    CL1' '                                                   35260000
         DC    CL16'MANAGEMENT CLASS'                                   35270000
         DC    CL1' '                                                   35280000
         DC    CL4' '                                                   35290000
         DC    CL10'DATA CLASS'                                         35300000
         DC    CL4' '                                                   35310000
         DC    CL6' BLKSZ'                                              35320000
         DC    CL1' '                                                   35330000
         DC    CL3' '                                                   35340000
         DC    CL13'STORAGE CLASS'                                      35350000
*        DC    CL3' '                                                   35360000
         DC    CL5'     '                                               35370000
         DC    CL4' EXT'                                                35380000
         DC    CL1' '                                                   35390000
         DC    CL4' DIR'                                                35400000
         DC    CL5' -USE'                                               35410000
         DC    CL1' '                                                   35420000
         DC    CL9'PO MEMBS'                                            35430000
         SPACE 2                                                        35440000
WARNING  DC    CL31'VOLUME NOT MOUNTED OR AVAILABLE'                    35450000
         SPACE 2                                                        35460000
TEXTT    DC    CL133' FIRST TRACK   LAST TRACK       LENGTH       EXTEN135470000
               T  DATA SET NAME'                                        35480000
         SPACE 2                                                        35490000
FREESPC  DS    0CL133                                                   35500000
         DC    CL42'0 REGION MAY BE REDUCED BY APPROXIMATELY  '         35510000
SIZEF    DC    CL4' '                                                   35520000
         DC    CL87'K FOR MAPPING THIS PACK'                            35530000
*                                                               EL10060 35540000
BANSLT1  DC    C'N'                NO SLANT                     EL10060 35550000
BANTXT1  DC    CL8' '              TEXT                         EL10060 35560000
BANPLNC  DS    C                   CARRAGE CONTOL               EL10060 35570000
BANPLN1  DS    12CL132             BLK TEXT                     EL10060 35580000
*                                                                       35590000
         TITLE 'DCB''S AND I/O CONTROL TABLES'                          35600000
*********************************************************************** 35610000
*        DCB'S TABLE                                                  * 35620000
*********************************************************************** 35630000
         SPACE 1                                                        35640000
DCBTABLE DS    0F                                                       35650000
SYSUT2SW DC    X'00',AL3(SYSUT2),CL8'SYSUT2',CL8'OUTPUT',CL8' '         35660000
DCBNTRY  EQU   *-DCBTABLE          LENGTH OF ONE TABLE ELEMENT          35670000
OPENSIZE EQU   *-DCBTABLE          TABLE SIZE OF FULL TIME FILES        35680000
MAXOPEN  EQU   OPENSIZE/DCBNTRY    MAXIMUM NUMBER OF DCB'S TO OPEN      35690000
         SPACE 1                                                        35700000
VSAMSW   DC    X'00',AL3(VVDSACB),CL8' ',CL8' ',CL8' '                  35710000
TABSIZE  EQU   *-DCBTABLE          DCB'S TABLE SIZE                     35720000
MAXDS    EQU   TABSIZE/DCBNTRY     MAXIMUM NUMBER OF DCB'S              35730000
         SPACE 1                                                        35740000
DDBYPASS EQU   128                 DD NON-PROCESS                       35750000
DDINT    EQU   16                  DD INTEREST                          35760000
DDPRES   EQU   8                   DD PRESENT                           35770000
DDOPEN   EQU   1                   DATA SET IS OPEN                     35780000
FF       EQU   255                 ALL BITS ON                          35790000
         SPACE 2                                                        35800000
EXITLIST DC    X'85',AL3(BLKSZRTN)  ENTRY FOR DCB MODIFICATION          35810000
         EJECT                                                          35820000
*******************************************************************     35830000
*        DATA CONTROL BLOCKS                                      *     35840000
*******************************************************************     35850000
         PRINT NOGEN                                                    35860000
         SPACE 3                                                        35870000
*********************************************************************   35880000
*              SYSUT2 - SUMMARY FILE                                    35890000
*********************************************************************   35900000
SYSUT2   DCB   DDNAME=SYSUT2,                                          *35910000
               DSORG=PS,                                               *35920000
               EXLST=EXITLIST,                                         *35930000
               MACRF=PM                                                 35940000
*********************************************************************   35950000
*               PRINT                                                   35960000
*********************************************************************   35970000
PRINT    DCB   DSORG=PS,MACRF=PM,DDNAME=SYSPRINT,BFTEK=S,RECFM=FA,     135980000
               BLKSIZE=133,LRECL=133,BUFNO=14                           35990000
         SPACE 1                                                        36000000
*********************************************************************   36010000
*              SYSOUT                                                   36020000
*********************************************************************   36030000
SYSOUT   DCB   DSORG=PS,RECFM=FA,BFTEK=S,DDNAME=SYSOUT,MACRF=PM,       136040000
               LRECL=133,BLKSIZE=133,BUFNO=10                           36050000
         SPACE 1                                                        36060000
*********************************************************************   36070000
*              UTILITY                                                  36080000
*********************************************************************   36090000
UTILITY  DCB   DSORG=PS,MACRF=GM,DDNAME=SYSUT1,BFTEK=S,RECFM=F,        136100000
               BLKSIZE=256,LRECL=256,BUFNO=4,EODAD=PDSEND,             X36110000
               EXLST=PDSJFCB,SYNAD=PDSIOER                              36120000
UTILDDNM EQU   UTILITY+40,8,C'C'   WHERE DDNAME GOES            GP09136 36130000
         SPACE 1                                                        36140000
*********************************************************************   36150000
*               TEST                                                    36160000
*********************************************************************   36170000
TEST     DCB   DSORG=PS,MACRF=GM,RECFM=F,BLKSIZE=140,BFTEK=S,          136180000
               EXLST=STRJFCB                                            36190000
TESTDDNM EQU   TEST+40,8,C'C'                                   GP09136 36200000
         EJECT                                                          36210000
*        *********************************                              36220000
*        *     VSAM CONTROL BLOCKS       *                              36230000
*        *********************************                              36240000
         SPACE 1                                                        36250000
*NEW*        RMODE31=NONE,                                           +  36260000
VVDSACB  ACB   BUFND=5,                                                *36270000
               EXLST=VVDSEXLS,                                         *36280000
               MACRF=(ADR,DIR,SEQ,IN)                                   36290000
         SPACE 1                                                        36300000
VVDSRPL  RPL   ACB=VVDSACB,                                            *36310000
               AREA=VVDSAREA,                                          *36320000
               AREALEN=4,                                              *36330000
               ARG=VVDSRBA,                                            *36340000
               OPTCD=(ADR,SEQ,LOC,NSP)                                  36350000
         SPACE 1                                                        36360000
VVDSEXLS EXLST EODAD=VVDSEOF,LERAD=VSMLERAD                             36370000
         SPACE 2                                                        36380000
         PRINT GEN                                                      36390000
         EJECT                                                          36400000
*        *********************************                              36410000
*        *     SAVE AREAS / CONSTANTS    *                              36420000
*        *********************************                              36430000
         SPACE 1                                                        36440000
         DS    0D                                                       36450000
DW       DS    0D                                                       36460000
         DS    F                                                        36470000
FW       DS    0F                                                       36480000
         DS    X                                                        36490000
CL3      DS    XL3                                                      36500000
         SPACE 1                                                        36510000
DATE     DS    F                                                        36520000
TIME     DS    F                                                        36530000
VSAMLEN  DC    A(32760)            SIZE OF AREA FOR VVR RECORDS         36540000
VSAMAREA DC    A(0)                ADDRESS OF AREA FOR VVR RECORDS      36550000
VVDSAREA DS    F                                                        36560000
VVDSRBA  DS    F                                                        36570000
         SPACE 1                                                        36580000
SAVECNVT DC    5F'0'               TEMPORARY SAVE AREA                  36590000
         SPACE 2                                                        36600000
PSWD     DC    FL1'8'                                                   36610000
PASSWORD DC    CL8' '                                                   36620000
CTREGSHR DC    CL1' '              SAVE AREA FOR REGION SHAREOPTION     36630000
CTSYSSHR DC    CL1' '              SAVE AREA FOR SYSTEM SHAREOPTION     36640000
         SPACE 1                                                        36650000
GDGBASEL DS    H                                                        36660000
GDGBNML  DS    H                                                        36670000
HW       DS    H                                                        36680000
         SPACE 2                                                        36690000
SWITCH   DC    X'00'               PROCESSING SWITCH                    36700000
CARDENDE EQU   X'80'               EOF INPUT                            36710000
EMPTYGDG EQU   X'40'               EMPTY GDG BASE                       36720000
NODEYES  EQU   X'20'               NODE PRESENT                         36730000
         SPACE 1                                                        36740000
VVDSSWCH DC    X'00'               PROCESSING SWITCH FOR VVDS           36750000
VVDSALL  EQU   X'F8'               VVR ALL SUBTYPES                     36760000
VVDSNCL  EQU   X'80'               VVR HEADER CELL                      36770000
VVDST21  EQU   X'40'               VVR TYPE X'21'                       36780000
VVDST23  EQU   X'20'               VVR TYPE X'23'                       36790000
VVDST60  EQU   X'10'               VVR TYPE X'60'                       36800000
VVDST22  EQU   X'08'               VVR TYPE X'22'                       36810000
         SPACE 2                                                        36820000
TRTAB    DC    C'0123456789ABCDEF'                                      36830000
         EJECT                                                          36840000
*********************************************************************   36850000
*         LITERALS ETC.                                                 36860000
*********************************************************************   36870000
         DS    0D                                                       36880000
         LTORG                                                          36890000
         EJECT                                                          36900000
*        *********************************                              36910000
*        *     DYNALLOC CONTROL BLOCKS   *                              36920000
*        *********************************                              36930000
         SPACE 1                                                        36940000
DYNCBP   DS    0F                                                       36950000
         DC    X'80'                                                    36960000
         DC    AL3(DYNCB)                                               36970000
         SPACE 1                                                        36980000
DYNCB    DC    X'1401'             ALLOCATE                             36990000
         DC    3H'0'                                                    37000000
         DC    A(DYNCBTXT)         TEXT POINTER                         37010000
         DC    2F'0'                                                    37020000
         SPACE 1                                                        37030000
DYNCBTXT DS    0F                                                       37040000
         DC    A(DYNDDN)                                                37050000
         DC    A(DYNDSN)                                                37060000
         DC    A(DYNUNIT)                                               37070000
         DC    A(DYNVOLS)                                               37080000
         DC    X'80'                                                    37090000
         DC    AL3(DYNDISP)                                             37100000
         SPACE 1                                                        37110000
DYNDDN   DC    X'005500010008'     DDNAME = VARIABLE                    37120000
DYNDNAME DC    CL8' '                                                   37130000
         SPACE 1                                                        37140000
DYNDSN   DC    X'000200010011'     DSN=SYS1.VVDS.VVOLSER                37150000
DYNDSNM  DC    CL44'SYS1.VVDS.V'   FINAGLED VVDS NAME           GP/@Q01 37160000
DYNVOL   EQU   DYNDSNM+11,6,C'C'   DEFINE REPLACEMENT PORTION   GP09138 37170000
DYNVVENM EQU   DYNDSNM,17,C'C'     NAME OF VVDS                 GP09138 37180000
         SPACE 1                                                        37190000
DYNVOLS  DC    X'001000010006'     VOL=                                 37200000
DYNVVOL  DC    CL6' '                                                   37210000
         SPACE 1                                                        37220000
DYNUNIT  DC    X'001500010008'     UNIT =                               37230000
DYNVUNIT DC    CL8'SYSALLDA'                                            37240000
         SPACE 1                                                        37250000
DYNDISP  DC    X'00040001000108'   DISP=SHR                             37260000
         EJECT                                                          37270000
*********************************************************************** 37280000
*        DYNAMIC UNALLOCATION TEXT BLOCKS                             * 37290000
*********************************************************************** 37300000
         SPACE 1                                                        37310000
         DS    0F                                                       37320000
S99PARM  DC    X'80',AL3(S99AREA)  ADDRESS OF SVC 99 REQUEST BLOCK      37330000
S99AREA  DC    AL1(S99RBEND-S99RB)  LENGTH OF REQUEST BLOCK             37340000
         DC    X'01'               VERB CODE                            37350000
         DC    XL6'00'                                                  37360000
         DC    A(UALTUPTR)         POINTER TO LIST OF TEXT UNIT PTRS    37370000
         DC    XL8'00'                                                  37380000
         SPACE 1                                                        37390000
         SPACE 1                                                        37400000
UALTUPTR DC    A(UALDDTU)          ADDR OF UNALLOCATION DDNAME TXT UNIT 37410000
         DC    X'80',AL3(UALOVDSP)  ADDR OF UNALLOC OVERIDING DISP TXT  37420000
         SPACE 1                                                        37430000
UALDDTU  DC    X'0001'             UNALLOCATION BY DDNAME               37440000
         DC    X'0001'             ONE PARAMETER                        37450000
         DC    X'0008'             LENGTH OF PARAMETER                  37460000
UALDDNAM DC    CL8' '              DDNAME TO BE UNALLOCATED             37470000
         DS    0H                                                       37480000
UALOVDSP DC    X'0005'             OVERIDING DISPOSITION SPECIFICATION  37490000
         DC    X'0001'             ONE PARAMETER                        37500000
         DC    X'0001'             LENGTH OF PARAMETER                  37510000
UALODISP DC    X'08'               KEEP DATA SET                        37520000
         TITLE 'DSECT MAPS'                                             37530000
*********************************************************************** 37540000
*        DD TABLE ENTRY FORMAT                                        * 37550000
*********************************************************************** 37560000
         SPACE 1                                                        37570000
MDCB     DSECT ,                   FORMAT OF A DCB TABLE ENTRY          37580000
MDCBDCB  DS    0F                  DCB POINTER                          37590000
MDCBFLAG DS    XL1                 FLAGS                                37600000
         DS    AL3                 ADDRESS OF DCB                       37610000
MDCBDDNM DS    CL8'DDNAME'         DDNAME                               37620000
MDCBOPEN DS    CL8'INPUT'          TYPE OF OPEN REQUIRED                37630000
MDCBCLOS DS    CL8'REREAD'         TYPE OF CLOSE REQUIRED               37640000
         SPACE 1                                                        37650000
MDCBLEN  EQU   *-MDCB              LENGTH OF ONE TABLE ENTRY            37660000
         SPACE 2                                                        37670000
*********************************************************************** 37680000
*        VVDS ENTRY TABLE FORMAT                                      * 37690000
*********************************************************************** 37700000
         SPACE 1                                                        37710000
VVETABLE DSECT ,                   FORMAT OF VVDS ENTRY TABLE           37720000
VVENAME  DS    CL45                NAME OF ENTRY                        37730000
         DS    AL3                 PADDING FOR ALIGNMENT                37740000
VVERBA   DS    AL4                 RBA NUMBER                           37750000
         SPACE 1                                                        37760000
VVETABL  EQU   *-VVETABLE          LENGTH OF ONE TABLE ENTRY            37770000
         EJECT                                                          37780000
*********************************************************************   37790000
*                                                                       37800000
*         DSECT   OF  DSCB1                                             37810000
*                                                                       37820000
*********************************************************************   37830000
DSCBS    DSECT                                                          37840000
         PRINT NOGEN                                                    37850000
         IECSDSL1  (1)                                                  37860000
DS1FLAG1 EQU   DS1NOBDB+1,1,C'X'  MORE FLAGS                            37870000
DS1COMPR EQU   X'80'           COMPRESSABLE EXTENDED IF DS1STRP         37880000
DS1CPOIT EQU   X'40'           CHECKPOINTED D S                         37890000
DS1SMSFG EQU   DS1FLAG1+17,1,C'X'  SMS FLAG                             37900000
DS1SMSDS EQU   X'80'           SMS D S                                  37910000
DS1SMSUC EQU   X'40'           NO BCS ENTRY                             37920000
DS1REBLK EQU   X'20'           MAY BE REBLOCKED                         37930000
DS1CRSDB EQU   X'10'           BLKSZ BY DADSM                           37940000
DS1PDSE  EQU   X'08'           PDS/E                                    37950000
DS1STRP  EQU   X'04'           EXTENDED FORMAT D S                      37960000
DS1PDSEX EQU   X'02'           HFS D S                                  37970000
DS1DSAE  EQU   X'01'           EXTENDED ATTRIBUTES EXISY                37980000
DS1SCEXT EQU   DS1SMSFG+1,3,C'X'  SECONDARY SPACE EXTENSION             37990000
DS1SCXTF EQU   DS1SCEXT,1,C'X'  -"- FLAG                                38000000
DS1SCAVB EQU   X'80'           SCXTV IS AVG BLOCK LEN                   38010000
DS1SCMB  EQU   X'40'                 IS IN MEGBYTES                     38020000
DS1SCKB  EQU   X'20'                 IS IN KILOBYTES                    38030000
DS1SCUB  EQU   X'10'                 IS IN BYTES                        38040000
DS1SCCP1 EQU   X'08'           SCXTV COMPACTED BY 256                   38050000
DS1SCCP2 EQU   X'04'                 COMPACTED BY 65536                 38060000
DS1SCXTV EQU   DS1SCXTF+1,2,C'X'  SEC SPACE EXTNSION VALUE              38070000
DS1ORGAM EQU   DS1ACBM         CONSISTENT NAMING - VSAM D S             38080000
DS1RECFF EQU   X'80'           RECFM F                                  38090000
DS1RECFV EQU   X'40'           RECFM V                                  38100000
DS1RECFU EQU   X'C0'           RECFM U                                  38110000
DS1RECFT EQU   X'20'           RECFM T   001X XXXX IS D                 38120000
DS1RECFB EQU   X'10'           RECFM B                                  38130000
DS1RECFS EQU   X'08'           RECFM S                                  38140000
DS1RECFA EQU   X'04'           RECFM A                                  38150000
DS1RECMC EQU   X'02'           RECFM M                                  38160000
*   OPTCD DEFINITIONS   BDAM    W.EFA..R                                38170000
*                       ISAM    WUMIY.LR                                38180000
*             BPAM/BSAM/QSAM    WUCHBZTJ                                38190000
DS1OPTIC EQU   X'80'  FOR DS1ORGAM - CATLG IN ICF CAT                   38200000
DS1OPTBC EQU   X'40'           ICF CATALOG                              38210000
DS1RACDF EQU   DS1IND40                                                 38220000
DS1SECTY EQU   DS1IND10                                                 38230000
DS1WRSEC EQU   DS1IND04                                                 38240000
DS1SCAL1 EQU   DS1SCALO,1,C'X'    SEC. ALLOC FLAGS                      38250000
DS1DSPAC EQU   X'C0'         SPACE REQUEST MASK                         38260000
DS1CYL   EQU   X'C0'           CYLINDER BOUND                           38270000
DS1TRK   EQU   X'80'           TRACK                                    38280000
DS1AVRND EQU   X'41'           AVG BLOCK + ROUND                        38290000
DS1AVR   EQU   X'40'           AVG BLOCK LEN                            38300000
DS1MSGP  EQU   X'20'                                                    38310000
DS1EXT   EQU   X'10'           SEC. EXTENSION EXISTS                    38320000
DS1CONTG EQU   X'08'           REQ. CONTIGUOUS                          38330000
DS1MXIG  EQU   X'04'           MAX                                      38340000
DS1ALX   EQU   X'02'           ALX                                      38350000
DS1DSABS EQU   X'00'           ABSOLUTE TRACK                           38360000
DS1SCAL3 EQU   DS1SCAL1+1,3,C'X'  SEC ALLOC QUANTITY                    38370000
         SPACE 1                                                        38380000
*********************************************************************   38390000
*                                                                       38400000
*         DSECT   OF DSCB2                                              38410000
*                                                                       38420000
*********************************************************************   38430000
         ORG   DSCBS                                                    38440000
DSCBS    DSECT                                                          38450000
         IECSDSL1  (2)                                                  38460000
         SPACE 1                                                        38470000
*********************************************************************   38480000
*                                                                       38490000
*         DSECT   OF DSCB3                                              38500000
*                                                                       38510000
*********************************************************************   38520000
         ORG   DSCBS                                                    38530000
DSCBS    DSECT                                                          38540000
         IECSDSL1  (3)                                                  38550000
         EJECT                                                          38560000
*********************************************************************   38570000
*                                                                       38580000
*         DSECT   OF DSCB4                                              38590000
*                                                                       38600000
*********************************************************************   38610000
         ORG   DSCBS                                                    38620000
DSCBS    DSECT                                                          38630000
         DC    44X'04'             44 FIRST BYTES OF FORMAT 4           38640000
         IECSDSL1  (4)                                                  38650000
*S4VTOCI DS    XL1           VTOC INDICATORS                            38660000
*S4DOSBT EQU   X'80'           VSE CONTAMINATED                         38670000
DS4DVTOC EQU   X'40'           INDEX DISABLED                           38680000
DS4EFVLD EQU   X'20'           FMT 7 FREE SPACE                         38690000
*S4DSTKP EQU   X'10'           VSE STACKED                              38700000
*S4DOCVT EQU   X'08'           VSE CONVERTED                            38710000
*S4DIRF  EQU   X'04'           INTERRUPTED                              38720000
*S4DICVT EQU   X'02'           RECLAIMED                                38730000
*S4IVTOC EQU   X'01'           INDEXED                                  38740000
         ORG DS4NOEXT+1                                                 38750000
DS4SMSFG DS    XL1           SMS FLAGS                                  38760000
DS4SMSTS EQU   X'C0'           SMS VOLUME                               38770000
DS4SMS   EQU   X'C0'           SMS VOLUME                               38780000
DS4SMSCV EQU   X'40'           SMS INITIALIZING                         38790000
DS4NTSMS EQU   X'00'           NON-SMS VOLUME                           38800000
DS4DEVAC DS    AL1           # ALT CYLS                                 38810000
         ORG   DS4DEVSZ      REDEFINE DS4DEVSZ                          38820000
DS4DSCYL DS    XL2             # CYLINDERS                              38830000
DS4DSTRK DS    XL2             # TRKS PER CYLINDER                      38840000
DS4DEVAV EQU   X'10'           ALT.CYL # VALID                          38850000
         SPACE 1                                                        38860000
*********************************************************************   38870000
*                                                                       38880000
*         DSECT   OF DSCB5                                              38890000
*                                                                       38900000
*********************************************************************   38910000
         ORG   DSCBS                                                    38920000
DSCBS    DSECT                                                          38930000
         IECSDSL1  (5)                                                  38940000
         SPACE 1                                                        38950000
*********************************************************************   38960000
*                                                                       38970000
*         DSECT   OF DSCB6                                              38980000
*                                                                       38990000
*********************************************************************   39000000
         ORG   DSCBS                                                    39010000
DSCBS    DSECT                                                          39020000
         IECSDSL1  (6)                                                  39030000
         EJECT                                                          39040000
*********************************************************************   39050000
*                                                                       39060000
*         UCB DSECT                                                     39070000
*                                                                       39080000
*********************************************************************   39090000
UCB      DSECT                                                          39100000
         IEFUCBOB                                                       39110000
         SPACE 2                                                        39120000
*********************************************************************   39130000
*                                                                       39140000
*         CVT DSECT                                                     39150000
*                                                                       39160000
*********************************************************************   39170000
         SPACE 1                                                        39180000
         CVT   DSECT=YES,LIST=YES                                       39190000
         SPACE 2                                                        39200000
*********************************************************************   39210000
*                                                                       39220000
*         DEB MAPPING MACRO                                             39230000
*                                                                       39240000
*********************************************************************   39250000
         IEZDEB  LIST=YES                                               39260000
         EJECT                                                          39270000
*********************************************************************   39280000
*                                                                       39290000
*         JFCB MACRO (IEFJFCBN DSECT)                                   39300000
*                                                                       39310000
*********************************************************************   39320000
         SPACE 1                                                        39330000
IEFJFCBN DSECT ,                   DUMMY SECTION                        39340000
         IEFJFCBN  LIST=YES        IBM MAPPING MACRO                    39350000
         SPACE 2                                                        39360000
*********************************************************************   39370000
*                                                                       39380000
*         DCBD MACRO (IHADCB DSECT)                                     39390000
*                                                                       39400000
*********************************************************************   39410000
         DCBD  DSORG=PS,DEVD=DA    DCB DSECT                            39420000
         EJECT                                                          39430000
         IHADVCT   ,               DEVICE CHARACTERISTICS TABLE ENTRY   39440000
         EJECT                                                  GP09136 39450000
MYTIOT   DSECT ,                                                GP09136 39460000
         IEFTIOT1  ,               TIOT                         GP09136 39470000
         EJECT                                                          39480000
         IEFZB4D0  ,               SVC 99 REQUEST BLOCK DSECT           39490000
         TITLE 'MAPDISK SUMMARY RECORD FORMAT'                          39500000
*********************************************************************   39510000
*                                                                       39520000
* FUNCTION                                                              39530000
*                                                                       39540000
*  TO MAP THE SUMMARY RECORDS CREATED BY THE 'MAPDISK' PROGRAM.         39550000
*                                                                       39560000
*                                                                       39570000
*    SPRECHER ENERGIE A.G.                                              39580000
*          - JUNE 1989 - D.H.CARTWRIGHT                                 39590000
*              INITIAL FORMAT CREATED.                                  39600000
*          - AUGUST 1989 - D.H.CARTWRIGHT                               39610000
*              INCLUDE D.S. CHANGED FLAG                                39620000
*          - OCTOBER 1990 - D.H.CARTWRIGHT                              39630000
*              ADD KEY POSITION AND CALCULATED SPACE USAGE              39640000
*          - MAY 1991     - D.H.CARTWRIGHT                              39650000
*              ADD VSAM SPLIT PERCENTAGES                               39660000
*          - 30SEP91 CART1 ADD SHAREOPTIONS                             39670000
*          - 21MAY92 CART1 ADD COUNT ONE AND BINARY DAYS FROM REFERENCE 39680000
*                                                                       39690000
*    DARNICK COMPUTING LTD.                                             39700000
*          - 14JUL95 DHC ADD FIELDS FOR SMS DATA                        39710000
*                                                                       39720000
*                                                                       39730000
*********************************************************************   39740000
         SPACE 3                                                        39750000
*********************************************************************   39760000
*                                                                       39770000
*               DETAIL LINE INFORMATION                                 39780000
*                                                                       39790000
*********************************************************************   39800000
SRRECORD DSECT ,                  SUMMARY RECORD FORMAT          CC     39810000
SRVOLSER DC    CL6' '             VOLUME SERIAL NUMBER            1     39820000
SRQUAL1  DC    CL8' '             QUALIFIER LEVEL 1               7     39830000
SRQUAL2  DC    CL8' '             QUALIFIER LEVEL 2              15     39840000
SRQUAL3  DC    CL8' '             QUALIFIER LEVEL 3              23     39850000
SRDSNAME DC    CL44' '            DATASET NAME                   31     39860000
SRCRDATE DC    CL5' '             CREATION DATE                  75     39870000
SREXPDT  DC    CL5' '             EXPIRY DATE                    80     39880000
SRREFDT  DC    CL5' '             REFERRED-TO DATE               85     39890000
SRDSORG  DC    CL4' '             DATA SET ORGANISATION          90     39900000
SRRECFM  DC    CL3' '             RECORD FORMAT                  94     39910000
SRLRECL  DC    CL5' '             LOGICAL RECORD LENGTH          97     39920000
SRBLKSZE DC    CL5' '             BLOCK SIZE                    102     39930000
SRALUNIT DC    CL5' '             ALLOC UNITS--(TRK,CYL,BLK)    107     39940000
SRSPALC  DC    CL5' '             SPACE ALLOCATED TRACKS TOTAL  112     39950000
SRSPUSED DC    CL5' '             SPACE USED - TOTAL TRACKS     117     39960000
SRALL2ND DC    CL4' '             SECONDARY ALLOCATION          122     39970000
SREXTENT DC    CL3' '             NUMBER OF EXTENTS             126     39980000
SRDRBALC DC    0CL4' '            NO. DIRECTORY BLOCKS ALLOCATED129     39990000
SRCASPLT DC    CL3' '             PERCENT CA'S SPLIT            129     40000000
SRREGSHR DC    CL1' '             REGIONAL SHARING ATTRIBUTE    132     40010000
SRDRBUSE DC    0CL4' '            NO. DIRECTORY BLOCKS USED     133     40020000
SRCISPLT DC    CL3' '             PERCENT CI'S SPLIT            133     40030000
SRSYSSHR DC    CL1' '             SYSTEM SHARING ATTRIBUTE      136     40040000
SRDSCHA  DC    CL1' '             DATA SET CHANGED              137     40050000
SRISRKP  DC    CL5' '             INDEXED FILE KEY POSITION     138     40060000
SRISKLN  DC    CL3' '             INDEXED FILE KEY LENGTH       143     40070000
SRSPWST  DC    CL5' '             SPACE OVER ALLOCATED TRACKS   146     40080000
SRSP100  DC    CL3' '             SPACE USAGE IN PERCENT        151     40090000
         DC    XL1'00'            RESERVED - SET TO ZERO        154     40100000
SRPONE   DC    PL2'1'             CONSTANT ONE - FOR COUNTING   155     40110000
SRBDAYS  DC    XL2'0000'          BINARY DAYS SINCE ACCESSED    157     40120000
         DC    CL2'  '            RESERVED - SET TO BLANK       159     40130000
SRSTOGCL DC    CL8'  '            SMS STORAGE CLASS             161     40140000
SRDATACL DC    CL8'  '            SMS DATA CLASS                169     40150000
SRMGMTCL DC    CL8'  '            SMS MANAGEMENT CLASS          177     40160000
         SPACE 2                                                        40170000
SRRECLEN EQU   *-SRRECORD         LENGTH OF RECORD             =184     40180000
         SPACE 1                                                        40190000
MAPDISK  CSECT ,                                                GP09136 40200000
SRSPACE  DC    CL(SRRECLEN)' '    AREA FOR SUMMARY RECORD       GP09136 40210000
         TITLE 'VVDS CATALOG DATA FORMATS'                              40220000
*********************************************************************** 40230000
*        PDSDOC *VVR RECORD FORMATS...................................* 40240000
*                                                                     * 40250000
*        V V R   H E A D E R   C E L L                                * 40260000
*                                                                     * 40270000
*********************************************************************** 40280000
TYPE@Z   DSECT                                                          40290000
VVR      DS    0CL11                   VVR HEADER CELL                  40300000
VVRLEN   DS    CL2                     LENGTH OF ENTIRE VVR             40310000
VVRHDR   DS    0CL9                    VVR HEADER                       40320000
VVRHDLEN DS    CL2                     LENGTH OF HEADER CELL            40330000
VVRTYPE  DS    C                       TYPE 'Z' OR 'Q'                  40340000
VVRFLAG  DS    C                       HEADER FLAG                      40350000
VVRRESV1 EQU   X'80'                   RESERVED                         40360000
VVRSELFD EQU   X'40'                   SELV DESCRIBING VVR FOR VVDS     40370000
VVRCATSD EQU   X'20'                   CATALOG SELFDESCRIBING VVR       40380000
VVRRESV2 EQU   X'10'                   RESERVED                         40390000
VVRCOMPT EQU   X'08'                   COMP-TYPE 0 => 'D', 1 => 'I'     40400000
VVRRESV3 EQU   X'07'                   RESERVED                         40410000
VVRKRQ   DS    CL4                     KEY RANGE QUALIFIER              40420000
VVRV1    DS    0C                      RESERVED                         40430000
VVRCMPNL DS    C                       COMPONENT NAME LENGTH            40440000
VVRCMPNM DS    CL45                    COMPONENT NAME                   40450000
         ORG   VVR                                                      40460000
VVRKEYL  DS    C                       LENGTH OF KEY (<= 45)            40470000
VVRKEY   DS    CL45                    KEY (CLUSTER NAME + PAD)         40480000
         ORG   VVR                                                      40490000
VVRCATNL DS    C                       CATALOG NAME LENGTH              40500000
VVRCATNM DS    CL45                    CATALOG NAME                     40510000
         ORG   VVR                                                      40520000
VVRBSENL DS    C                       LENGTH OF AIX NAME               40530000
VVRBSENM DS    CL45                    AIX NAME                         40540000
         EJECT                                                          40550000
*********************************************************************** 40560000
*                                                                     * 40570000
*        V V R   N O N - V S A M   C E L L                            * 40580000
*                                                                     * 40590000
*********************************************************************** 40600000
TYPE@N   DSECT ,                       NON-VSAM CELL                    40610000
VVRNLEN  DS    CL2                     LENGTH OF ENTIRE VVR             40620000
VVRNHDLN DS    CL2                     LENGTH OF HEADER CELL            40630000
VVRTYPEN DS    C'N'                    TYPE 'N'                         40640000
         DS    XL4                     RESERVED                         40650000
VVRNENTL DS    XL2                     LENGTH OF ENTRY NAME             40660000
VVRNENTN DS    CL44                    NAME OF ENTRY                    40670000
         DS    XL1                     RESERVED                         40680000
VVRNCATL DS    XL2                     LENGTH OF CATALOG NAME           40690000
VVRNCATN DS    CL44                    NAME OF CATALOG FOR ENTRY        40700000
         EJECT                                                          40710000
*********************************************************************** 40720000
*                                                                     * 40730000
*        V V R   D A T A S E T   I N F O R M A T I O N   C E L L      * 40740000
*                                                                     * 40750000
*********************************************************************** 40760000
TYPE@21  DSECT                                                          40770000
VVRDSINF DS    0CL53                   VVR DS INFO CELL                 40780000
VVRDSLEN DS    CL2                     LENGTH OF DS INFO CELL           40790000
VVRDSTYP DS    C                       TYPE X'21' FOR VVR DS INFO CELL  40800000
VVRATTR1 DS    C                       DATA SET ATRIBUTES               40810000
VVRA1SPD EQU   X'80'                   SPEED                            40820000
VVRA1UNQ EQU   X'40'                   UNIQUE                           40830000
VVRA1REU EQU   X'20'                   REUSE                            40840000
VVRA1ERS EQU   X'10'                   ERASE                            40850000
VVRA1RSV EQU   X'08'                   RESERVED                         40860000
VVRA1IUP EQU   X'04'                   INHIBIT UPDATE                   40870000
VVRA1TEX EQU   X'02'                   TEMPORARY EXPORT                 40880000
VVRA1TRO EQU   X'01'                   TRACK OVERFLOW                   40890000
VVRATTR2 DS    C                       SHARE ATTRIBUTES                 40900000
VVRA2REG EQU   X'C0'                   REGIONAL SHARING ATTRIBUTES      40910000
VVRA2SYS EQU   X'30'                   SYSTEM SHARING ATTRIBUTES        40920000
VVRA2RSV EQU   X'0C'                   RESERVED                         40930000
VVRA2INT EQU   X'02'                   INTERNAL SYSTEM DATA SET         40940000
VVRA2NUS EQU   X'01'                   COMPONENT IS NOT USABLE          40950000
VVROPIND DS    C                       OPEN INDICATOR                   40960000
VVRBUFSZ DS    CL4                     MINIMUM BUFFER SIZE              40970000
VVRSPACE DS    0CL7                    SPACE                            40980000
VVRPRISP DS    CL3                     PRIMARY SPACE ALLOCATION         40990000
VVRSECSP DS    CL3                     SECONDARY SPACE ALLOCATION       41000000
VVRSPCFG DS    C                       SPACE FLAGS                      41010000
VVRSPCOP EQU   X'C0'                   SPACE OPTIONS                    41020000
VVRSPTRK EQU   X'80'                   TRACK ALLOCATION                 41030000
VVRSPCYL EQU   X'C0'                   CYLINDER ALLOCATION              41040000
VVRSPCRS EQU   X'3F'                   RESERVED                         41050000
VVRDSHU  DS    CL4                     DATASET HI USED RBA              41060000
VVRDSHA  DS    CL4                     DATASET HI ALLOC RBA             41070000
VVRLRECL DS    CL4                     AVG LOGICAL RECORD LENGTH        41080000
VVRDSRSV DS    CL2                     RESERVED                         41090000
VVREXCPX DS    CL8                     EXCEPTION EXIT                   41100000
VVRDSHK  DS    CL4                     DATASET HI KEY RBA               41110000
VVRCLSFG DS    C                       CLUSTER ATTRIBUTE FLAG           41120000
VVRCLRSV EQU   X'FC'                   RESERVED                         41130000
VVRCFSWS EQU   X'02'                   CLUSTER DESCRIBES SWAPSPACE      41140000
VVRCFPGS EQU   X'01'                   CLUSTER DESCIBES PAGESPACE       41150000
VVRAIXFG DS    C                       AIX ATTRIBUTE FLAG               41160000
VVRAIUPG EQU   X'80'                   UPGRADE AIX                      41170000
VVRAIRSV EQU   X'7F'                   RESERVED                         41180000
VVRTMSTP DS    CL8                     TIMESTAMP                        41190000
         DS    8XL4                    UNKNOWN                          41200000
         DS    XL1                     UNKNOWN                          41210000
         DS    XL1'24'                 UNKNOWN FLAGS                    41220000
         DS    XL1'46'                 UNKNOWN FLAGS                    41230000
         DS    XL1                     UNKNOWN                          41240000
         DS    XL1'01'                 UNKNOWN                          41250000
         DS    XL3                     UNKNOWN                          41260000
         DS    XL4                     UNKNOWN                          41270000
VVR21SCL DS    XL2                     LENGTH OF STORAGE CLASS          41280000
VVR21SCN DS    CL8' '                  NAME OF STORAGE CLASS            41290000
VVR21DCL DS    XL2                     LENGTH OF DATA CLASS             41300000
VVR21DCN DS    CL8' '                  NAME OF DATA CLASS               41310000
VVR21MCL DS    XL2                     LENGTH OF MANAGEMENT CLASS       41320000
VVR21MCN DS    CL8' '                  NAME OF MANAGEMENT CLASS         41330000
         EJECT                                                          41340000
*********************************************************************** 41350000
*                                                                     * 41360000
*        V V R   S M S  I N F O R M A T I O N   C E L L               * 41370000
*                                                                     * 41380000
*********************************************************************** 41390000
TYPE@22  DSECT                                                          41400000
VVRSMINF DS    0CL150                  VVR SMS INFO CELL                41410000
VVRSMLEN DS    CL2                     LENGTH OF SMS INFO CELL          41420000
VVRSMTYP DS    C                       TYPE X'22' FOR VVR SMS INFO CELL 41430000
         DS    XL1                     UNKNOWN                          41440000
         DS    XL4                     UNKNOWN                          41450000
         DS    XL4                     UNKNOWN                          41460000
         DS    XL1                     UNKNOWN                          41470000
         DS    XL1'24'                 UNKNOWN FLAGS                    41480000
         DS    XL1'46'                 UNKNOWN FLAGS                    41490000
         DS    XL1                     UNKNOWN                          41500000
         DS    XL1'01'                 UNKNOWN                          41510000
         DS    XL3                     UNKNOWN                          41520000
         DS    XL4                     UNKNOWN                          41530000
VVRSMSCL DS    XL2                     LENGTH OF STORAGE CLASS          41540000
VVRSMSCN DS    CL8' '                  NAME OF STORAGE CLASS            41550000
VVRSMDCL DS    XL2                     LENGTH OF DATA CLASS             41560000
VVRSMDCN DS    CL8' '                  NAME OF DATA CLASS               41570000
VVRSMMCL DS    XL2                     LENGTH OF MANAGEMENT CLASS       41580000
VVRSMMCN DS    CL8' '                  NAME OF MANAGEMENT CLASS         41590000
         DS    XL32                    UNKNOWN                          41600000
         EJECT                                                          41610000
*********************************************************************** 41620000
*                                                                     * 41630000
*        V V R   V O L U M E   I N F O R M A T I O N   C E L L        * 41640000
*                                                                     * 41650000
*********************************************************************** 41660000
TYPE@23  DSECT                                                          41670000
VVRVOLIN DS    0CL38                   VVR VOL INFO CELL                41680000
VVRVOLLN DS    CL2                     LENGTH OF VOL INFO CELL          41690000
VVRVOLTP DS    C                       TYPE X'23' FOR VOL INFO CELL     41700000
VVRVOLFG DS    C                       VOLUME FLAGS                     41710000
VVRPRIME EQU   X'80'                   PRIME VOLUME                     41720000
VVRVRSV1 EQU   X'40'                   RESERVED                         41730000
VVROVFLW EQU   X'20'                   OVERFLOW VOLUME                  41740000
VVRVRSV2 EQU   X'1F'                   RESERVED                         41750000
VVRNOEXT DS    C                       EXT-NO. FOR DSET ON VOLUME       41760000
VVRHKRBA DS    CL4                     HIGH KEY RBA                     41770000
VVRHURBA DS    CL4                     HIGH USED RBA                    41780000
VVRHARBA DS    CL4                     HIGH ALLOCATED RBA               41790000
VVRBLKSZ DS    CL4                     BLOCKSIZE                        41800000
VVRBLKTK DS    CL2                     NUMBER OF BLOCKS PER TRACK       41810000
VVRTRKAU DS    CL2                     TRACKS PER ALLOCATION UNIT       41820000
VVRTPEXT DS    C                       EXTENT TYPE FLAG                 41830000
VVRSSDAT EQU   X'80'                   SEQUENCE SET WITH DATA           41840000
VVRNOPFM EQU   X'40'                   EXTENTS NOT PREFORMATTED         41850000
VVRCONV  EQU   X'20'                   CONVERTED VSAM DATASET VOLUME    41860000
VVRTPRSV EQU   X'1F'                   RESERVED                         41870000
VVRTKCYL DS    CL2                     TRACKS PER CYLINDER              41880000
VVRBYTTK DS    CL4                     BYTES PER TRACK                  41890000
VVRBYTAU DS    CL4                     BYTES PER ALLOCATION UNIT        41900000
VVRLOKYL DS    CL2                     LOW KEY LENGTH                   41910000
VVRLOKYV DS    CL45                    LOW KEY ON VOLUME                41920000
         ORG   VVRVOLIN                                                 41930000
VVRXTENT DS    0CL2                    EXTENT DESCRIBTION               41940000
VVRXTNTL DS    CL2                     LENGTH OF EXTENT SECTION         41950000
VVRXTNT  DS    0CL20                   EXTENTS (ONE OR MORE SETS)       41960000
VVRX     DS    0CL20                   INDIVIDUAL EXTENT                41970000
VVRXSEQN DS    CL2                     SEQUENCE NUMBER                  41980000
VVRXSCH  DS    0CL4                    STARTING CCHH                    41990000
VVRXSC   DS    CL2                     STARTING CC                      42000000
VVRXSH   DS    CL2                     STARTING HH                      42010000
VVRXECH  DS    0CL4                    ENDING CCHH                      42020000
VVRXEC   DS    CL2                     ENDING CC                        42030000
VVRXEH   DS    CL2                     ENDING HH                        42040000
VVRXNTRK DS    CL2                     NUMBER OF TRACKS                 42050000
VVRXSRBA DS    CL4                     STARTING RBA                     42060000
VVRXERBA DS    CL4                     ENDING RBA                       42070000
         EJECT                                                          42080000
*********************************************************************** 42090000
*                                                                     * 42100000
*        V V R   A M D S B   C E L L                                  * 42110000
*                                                                     * 42120000
*********************************************************************** 42130000
TYPE@60  DSECT                                                          42140000
VVRAMDCL DS    0CL98                   VVR AMDSB CELL                   42150000
VVRAMDCN DS    CL2                     LENGTH OF ENTIRE VVR AMDSB CELL  42160000
VVRAMCAT DS    0CL96                                                    42170000
VVRAMSB1 DS    0CL6                                                     42180000
VVRAMID  DS    C                       TYPE X'60' FOR VVR AMDSB CELL    42190000
VVRAMATR DS    C                       ATTRIBUTES                       42200000
VVRAMDST EQU   X'80'                   1 => KSDS, 0 => ESDS             42210000
VVRAMWCK EQU   X'40'                   WRITE CHECK                      42220000
VVRAMSDT EQU   X'20'                   SEQUENCE SET WITH DATA           42230000
VVRAMREP EQU   X'10'                   REPLICATION                      42240000
VVRAMORD EQU   X'08'                   USE VOLUMES IN LIST ORDER        42250000
VVRAMRGE EQU   X'04'                   KEY RANGE DATA SET               42260000
VVRAMRDS EQU   X'02'                   RRDS                             42270000
VVRAMSPN EQU   X'01'                   SPANNED RECORDS ARE ALLOWED      42280000
VVRAMLEN DS    CL2                     LENGTH OF AMDSB                  42290000
VVRAMNST DS    0CL2                    NUMBER OF ENTRIES IN IDX SECTION 42300000
VVRAMAKP DS    CL2                     ALTERNATE KEY RKP                42310000
VVRAMKEY DS    0CL4                    KEY DESCRIBTION                  42320000
VVRAMRKP DS    CL2                     RELATIVE KEY POSITION            42330000
VVRAMKLN DS    CL2                     KEY LENGTH                       42340000
VVRAMSB2 DS    0CL10                                                    42350000
VVRAMPCA DS    CL1                     % FREE CI IN CA                  42360000
VVRAMPCI DS    CL1                     % FREE BYTES IN CI               42370000
VVRAMCCA DS    CL2                     NUMBER OF CI'S PER CA            42380000
VVRAMFCA DS    CL2                     FREE CI'S  IN CA                 42390000
VVRAMFCI DS    CL4                     FREE BYTES PER CI                42400000
VVRAMCIR DS    0CL8                                                     42410000
VVRAMCIV DS    CL4                     CONTROL INTERVAL SIZE            42420000
VVRAMLCL DS    CL4                     MAXIMUM RECORD SIZE              42430000
VVRAMSB3 DS    0CL68                                                    42440000
VVRAMHLR DS    0CL4                     RBA OF HIGH LEVEL INDEX RECORD  42450000
VVRAMSLT DS    CL4                     RECORD SLOTS PER CI              42460000
VVRAMSSR DS    0CL4                     RBA OF FIRST SEQ.SET RECORD     42470000
VVRAMMRR DS    CL4                     MAX. RELATIVE RECORD NUMBER      42480000
VVRAMARD DS    CL4                     PONTER TO FIRST ARDB             42490000
VVRAMAT3 DS    C                       ATTRIBUTES                       42500000
VVRAMUNQ EQU   X'80'                   NON-UNIQUE OR UNIQUE KEYS        42510000
VVRAMFLT EQU   X'40'                   CYLINDER FAULT ON MSS OR STAGE   42520000
VVRAMBND EQU   X'20'                   BIND OR DO NOT BIND ON MSS       42530000
VVRAMWAT EQU   X'10'                   WAIT OR NOR-WAIT ON RELINQUISH   42540000
VVRAMLM  EQU   X'08'                   LOAD MODE OR DATASET LOADED      42550000
VVRAMRS1 EQU   X'07'                   RESERVED                         42560000
VVRAMSNO DS    C                       NUMBER OF CONCURRENT REQUESTS    42570000
VVRAMRS2 DS    CL4                     RESERVED                         42580000
VVRAMBFI DS    0CL2                    NUMBER OF INDEX BUFFERS          42590000
VVRAMBFD DS    CL2                     NUMBER OF DATA BUFFERS           42600000
VVRAMSTS DS    CL8                     SYSTEM TIME STAMP                42610000
VVRAMNIL DS    CL2                     NUMBER OF INDEX LEVELS           42620000
VVRAMNXT DS    CL2                     NUMBER OF EXTENTS                42630000
VVRAMNLR DS    CL4                     NUMBER OF LOGICAL RECORDS        42640000
VVRAMDLR DS    CL4                     NUMBER OF DELETED RECORDS        42650000
VVRAMILR DS    CL4                     NUMBER OF INSERTED RECORDS       42660000
VVRAMULR DS    CL4                     NUMBER OF UPDATED RECORDS        42670000
VVRAMRLR DS    CL4                     NUMBER OF RETRIEVED RECORDS      42680000
VVRAMASP DS    CL4                     BYTES OF FREE SPACE IN DATASET   42690000
VVRAMCIS DS    CL4                     NUMBER OF CI SPLITS              42700000
VVRAMCAS DS    CL4                     NUMBER OF CA SPLITS              42710000
VVRAMEXC DS    CL4                     NUMBER OF EXCP'S                 42720000
         SPACE 2                                                        42730000
         END   MAPDISK                                                  42740000
./ ADD NAME=BLKPRT                                                      42750000
         MACRO                                                          42760000
&NAME    EREGS                                                          42770000
.* SET UP REGISTER EQU                                                  42780000
         AIF   (T'&NAME EQ 'O').NONAME                                  42790000
&NAME    EQU   *                                                        42800000
.NONAME  ANOP                                                           42810000
R0       EQU   0                                                        42820000
R1       EQU   1                                                        42830000
R2       EQU   2                                                        42840000
R3       EQU   3                                                        42850000
R4       EQU   4                                                        42860000
R5       EQU   5                                                        42870000
R6       EQU   6                                                        42880000
R7       EQU   7                                                        42890000
R8       EQU   8                                                        42900000
R9       EQU   9                                                        42910000
R10      EQU   10                                                       42920000
R11      EQU   11                                                       42930000
R12      EQU   12                                                       42940000
R13      EQU   13                                                       42950000
R14      EQU   14                                                       42960000
R15      EQU   15                                                       42970000
         MEND                                                           42980000
         MACRO                                                          42990000
&NAME    ESTART &TYPE=CSECT,&DESC=,&VER=,&BASE=,&REGS=NO,              *43000000
               &PLIF=                                                   43010000
         AIF   (T'&TYPE EQ 'O').TYPERR                                  43020000
         AIF   (T'&VER EQ 'O').VERR                                     43030000
         AIF   (T'&DESC EQ 'O').DERR                                    43040000
         AIF   ('&TYPE' EQ 'CSECT').TYPEC                               43050000
         AIF   ('&TYPE' EQ 'START').TYPES                               43060000
.TYPERR  MNOTE 12,'*** TYPE MUST BE CSECT OR START ***'                 43070000
         MEXIT                                                          43080000
.VERR    MNOTE 12,'*** VER OMITTED ***'                                 43090000
         MEXIT                                                          43100000
.DERR    MNOTE 12,'*** DESC OMITTED ***'                                43110000
         MEXIT                                                          43120000
.TYPEC   ANOP                                                           43130000
&NAME    CSECT                                                          43140000
         AGO   .OK                                                      43150000
.TYPES   ANOP                                                           43160000
&NAME    START                                                          43170000
.OK      ANOP                                                           43180000
         AIF   (T'&REGS EQ 'O').REGOK                                   43190000
         AIF   ('&REGS' EQ 'YES').REGOK                                 43200000
         AIF   ('&REGS' EQ 'NO').REGOK                                  43210000
         MNOTE 12,'*** REGS INVALID ***'                                43220000
         MEXIT                                                          43230000
.REGOK   ANOP                                                           43240000
*                                                                       43250000
         AIF   (T'&PLIF EQ 'O').NOPL1                                   43260000
         MVI   18(15),C'N'            SET NO PLI ENTRY POINT            43270000
         B     12(15)                 SKIP HEADER STUFF                 43280000
         ENTRY &PLIF                                                    43290000
&PLIF    MVI   10(15),C'Y'            SET PL1 ENTRY POINT               43300000
         BALR  15,0                                                     43310000
ID1&SYSNDX B     ID4&SYSNDX.(15)        SKIP HEADER STUFF               43320000
ID5&SYSNDX DS   C                                                       43330000
IDP&SYSNDX EQU  ID5&SYSNDX-ID1&SYSNDX                                   43340000
         AGO   .NOPL12                                                  43350000
.NOPL1   ANOP                                                           43360000
ID1&SYSNDX B     ID4&SYSNDX.(15)       BRANCH AROUND IDENT CONSTANTS    43370000
.NOPL12  ANOP                                                           43380000
         DC    AL1(ID3&SYSNDX-ID2&SYSNDX)                               43390000
ID2&SYSNDX DC    CL8'&NAME'                                             43400000
         DC    C&VER                                                    43410000
         DC    C' &SYSDATE &SYSTIME - '                                 43420000
         DC    C&DESC                                                   43430000
         DS    0F                                                       43440000
IDS&SYSNDX EQU   *-ID1&SYSNDX                                           43450000
         DS    18F                                                      43460000
ID3&SYSNDX DS    0H                                                     43470000
         AIF   (T'&REGS EQ 'O').NOREG                                   43480000
         AIF   ('&REGS' EQ 'NO').NOREG                                  43490000
         EREGS                                                          43500000
.NOREG   ANOP                                                           43510000
ID4&SYSNDX EQU   *-ID1&SYSNDX                                           43520000
*                                                                       43530000
         STM   14,12,12(13)                                             43540000
*                                                                       43550000
         LR    5,13                COPY CALLER'S SAVEAREA ADDR          43560000
         LA    13,IDS&SYSNDX.(15)  ESTABLISH MY SAVEAREA                43570000
         ST    5,4(,13)            BACK CHAIN SAVE AREAS                43580000
         ST    13,8(,5)            FORWARD CHAIN SAVE AREAS             43590000
         AIF   (T'&BASE EQ 'O').NOBASE                                  43600000
         BALR  &BASE.,0            ESTABLISH BASE REG VALUE             43610000
         USING *,&BASE                                                  43620000
.NOBASE  ANOP                                                           43630000
         AIF   (T'&PLIF EQ 'O').SKIPLI                                  43640000
         CLI   IDP&SYSNDX.(15),C'Y'     SET CC BASED ON PLI INDICATOR   43650000
.SKIPLI  ANOP                                                           43660000
         MEND                                                           43670000
         MACRO                                                          43680000
&NAME    ERETURN &RC=                                                   43690000
.* RETURN TO SYSTEM WITH RETURN CODE                                    43700000
&NAME    L     13,4(0,13)          RESET TO CALLERS SAVE AREA           43710000
         RETURN (14,12),RC=&RC                                          43720000
         MEND                                                           43730000
         TITLE 'BLOCK LETTER ROUTINE'                                   43740000
*********************************************************************** 43750000
*                                                                     * 43760000
*        CREATE BLOCK LETTERS                                         * 43770000
*        --------------------                                         * 43780000
*        THIS ROUTINE FORMATS BLOCK LETTERS.  THIS                    * 43790000
*        CODE WAS EXTRACTED FROM HASPPRPU (JES2) PRINT DRIVER         * 43800000
*        AND EXTENSIVELY MODIFIED TO SIMPLY PRODUCE A LINE OF BLOCK   * 43810000
*        LETTERS VIA SUBROUTINE CALL.                                 * 43820000
*                                                                     * 43830000
*********************************************************************** 43840000
*                                                                     * 43850000
*     THREE PARMS MUST BE PASSED USING STANDARD IBM LINKAGE           * 43860000
*       PARM1=SLANT INDICATOR - 1 CHARACTER (Y/N)                     * 43870000
*       PARM2=TEXT FOR BLOCK LETTERS - 8 CHARACTERS                   * 43880000
*       PARM3=BUFFER FOR BLOCK LETTERS - 12 LINES OF 132 CHARS        * 43890000
*                                                                     * 43900000
*********************************************************************** 43910000
*                                                                     * 43920000
*     V1.0.0 - NOV 1, 2008                                            * 43930000
*        ADDED '/' CHARACTER AND OTHER COMMENTS                       * 43940000
*                                                                     * 43950000
*********************************************************************** 43960000
BLKPRT   ESTART TYPE=START,DESC='BLOCK LETTER GENERATION',             *43970000
               VER='1.0.0',REGS=YES,BASE=R12,PLIF=BLKPRTF               43980000
         BNE   NOTPLI                                                   43990000
         LM    R2,R4,0(R1)         GET PLI PARMLIST OF DDB              44000000
         L     R2,0(0,R2)          GET DATA ADDRS                       44010000
         L     R3,0(0,R3)                                               44020000
         L     R4,0(0,R4)                                               44030000
         B     COMM                                                     44040000
NOTPLI   EQU   *                                                        44050000
         LM    R2,R4,0(R1)                                              44060000
COMM     EQU   *                                                        44070000
         SLL   R4,8                GET RID OF HIGH ORDER BIT            44080000
         SRL   R4,8                   FROM LAST PARM                    44090000
         MVC   SLANTIND,0(R2)      GET SLANT IND                        44100000
         MVC   PCCWORK,0(R3)       GET TEXT                             44110000
         LR    R1,R4               GET BUFFER                           44120000
         MVC   PBLKWORK,PCCWORK    SAVE TEXT                            44130000
         OC    PCCWORK(8),=8X'C0'  SHIFT ALL TO 4TH QUADRANT            44140000
         TR    PCCWORK(8),BLOCKTR-X'C0'  TRANSLATE TO INDEX VALUE       44150000
         SLR   R4,R4               LINE 0 OF 12                         44160000
BLKBLD   STH   R4,PCEFORM+8        SAVE LINE COUNTER                    44170000
         ST    R1,PLNDISPL         SAVE NEW LINE DISPLACEMENT           44180000
         MVI   0(R1),C' '          FILL LINE                            44190000
         MVC   1(131,R1),0(R1)      WITH BLANKS                         44200000
         LA    R7,7                SCAN FOR                             44210000
BLKCENTR LA    R15,PBLKWORK(R7)      LAST                               44220000
         CLI   0(R15),C' '            NON-                              44230000
         BNE   SKIP510                 BLANK                            44240000
         BCT   R7,BLKCENTR              CHARACTER                       44250000
SKIP510  LA    R7,1(,R7)           COMPUTE                              44260000
         MH    R7,=H'7'             BEGINNING                           44270000
         SH    R7,=H'67'             PRINT POSITION                     44280000
         LCR   R7,R7                  TO CENTER                         44290000
         LA    R5,0(R7,R1)             BLOCK LETTERS                    44300000
         CLI   SLANTIND,C'N'       TEST FOR SLANTING OPTION             44310000
         BE    SKIP520             BR IF NO                             44320000
         LA    R5,6(,R5)           ELSE, SLANT                          44330000
         SRL   R4,1                 BLOCK                               44340000
         SLR   R5,R4                 LETTERS                            44350000
SKIP520  SLR   R4,R4               SET FOR A LETTER INDEX OF 0          44360000
BLKLUP   IC    R7,PBLKWORK(R4)     USE RELATIVE TEXT LETTER             44370000
         STC   R7,$POSTSAV          TO FORM BLOCK TEXT                  44380000
         LA    R7,PCCWORK(R4)      CURRENT LETTER INDEX                 44390000
         SLR   R15,R15             CLEAR REGISTER                       44400000
         ICM   R15,1,0(R7)         GET TRANSLATED LETTER INDEX          44410000
         BZ    BLKSTOR             BRANCH IF INDEX ZERO                 44420000
         BCTR  R15,0               DECREMENT BY ONE                     44430000
         MH    R15,=H'24'          CONVERT TO DISPLACEMENT              44440000
         AH    R15,PCEFORM+8       SELECT FOR LINE WITHIN LETTER        44450000
         LA    R15,BLOCKA(R15)     LETTER MASK ADDRESS                  44460000
         ICM   R15,12,0(R15)       LETTER MASK BITS                     44470000
BLKSTOR  LA    R7,12               BLOCK WIDTH OF 12                    44480000
BLKLOOP  ALR   R15,R15             SHIFT LEFT AND TEST HIGH BIT         44490000
         BC    12,SKIP530          BRANCH IF OFF                        44500000
         MVC   0(1,R5),$POSTSAV    OVERSTORE BLANK TO FORM BLOCK        44510000
SKIP530  LA    R5,1(,R5)           INCREMENT COL NUMBER                 44520000
         BCT   R7,BLKLOOP          BRANCH TO FILL 12 COL'S              44530000
         LA    R5,2(,R5)           2 BLANKS BETWEEN BLOCKS              44540000
         LA    R4,1(,R4)           STEP TO NEXT LETTER INDEX            44550000
         CL    R4,=F'8'            HAVE WE DONE 8 BLOCKS                44560000
         BL    BLKLUP              BRANCH IF NO                         44570000
         L     R1,PLNDISPL         GET NEW                              44580000
         LA    R1,132(,R1)          LINE DISPLACEMENT                   44590000
         LH    R4,PCEFORM+8        GET LINE COUNTER                     44600000
         LA    R4,2(,R4)           STEP TO NEXT LINE                    44610000
         CH    R4,=H'24'           LAST LINE FINISHED                   44620000
         BL    BLKBLD              BRANCH IF NO                         44630000
         ST    R1,PLNDISPL         SAVE NEW LINE DISPLACEMENT           44640000
         ERETURN RC=0                                                   44650000
         TITLE 'MISCELLANEOUS TABLES'                                   44660000
*********************************************************************** 44670000
*                                                                     * 44680000
*        BLOCK LETTER TABLE                                           * 44690000
*                                                                     * 44700000
*        BLOCKTR IS USED WITH A TR INSTRUCTION TO GET THE OFFSET OF   * 44710000
*        THE BIT PATTERN FOR THE CHARACTER.                           * 44720000
*                                                                     * 44730000
*        EACH BLOCK? DEFINES THE BIT PATTERN FOR EACH CHARACTER.      * 44740000
*        THE BLOCK IS 24 BYTES LONG.  EACH GROUP OF 2 BYTES DESCRIBE  * 44750000
*        A LINE IN THE BLOCK LETTER.  BITS 1-12 ARE USED 13-16 ARE    * 44760000
*        NOT USED.                                                    * 44770000
*                                                                     * 44780000
*********************************************************************** 44790000
         SPACE 1                                                        44800000
BLOCKTR  DC    X'00010203040506070809000000000000'   +X'C0'             44810000
         DC    X'000A0B0C0D0E0F101112001300000000'   +X'D0'             44820000
         DC    X'00281415161718191A1B000000000000'   +X'E0'             44830000
         DC    X'1C1D1E1F202122232425002627000000'   +X'F0'             44840000
         SPACE 2                                                        44850000
BLOCKA   DC    X'7FE0FFF0C030C030C030FFF0FFF0C030C030C030C030C030'      44860000
BLOCKB   DC    X'FFE0FFF0C030C030C060FFC0FFC0C060C030C030FFF0FFE0'      44870000
BLOCKC   DC    X'7FE0FFF0C030C000C000C000C000C000C000C030FFF07FE0'      44880000
BLOCKD   DC    X'FF80FFC0C060C030C030C030C030C030C030C060FFC0FF80'      44890000
BLOCKE   DC    X'FFF0FFF0C000C000C000FF00FF00C000C000C000FFF0FFF0'      44900000
BLOCKF   DC    X'FFF0FFF0C000C000C000FF00FF00C000C000C000C000C000'      44910000
BLOCKG   DC    X'7FE0FFF0C030C000C000C000C1F0C1F0C030C030FFF07FE0'      44920000
BLOCKH   DC    X'C030C030C030C030C030FFF0FFF0C030C030C030C030C030'      44930000
BKOCKI   DC    X'7FE07FE0060006000600060006000600060006007FE07FE0'      44940000
BLOCKJ   DC    X'3FF03FF0030003000300030003000300C300C300FF007E00'      44950000
BLOCKK   DC    X'C030C060C0C0C180C300FE00FE00C300C180C0C0C060C030'      44960000
BLOCKL   DC    X'C000C000C000C000C000C000C000C000C000C000FFF0FFF0'      44970000
BLOCKM   DC    X'C030E070F0F0D9B0CF30C630C030C030C030C030C030C030'      44980000
BLOCKN   DC    X'C030E030F030D830CC30C630C330C1B0C0F0C070C030C010'      44990000
BLOCKO   DC    X'FFF0FFF0C030C030C030C030C030C030C030C030FFF0FFF0'      45000000
BLOCKP   DC    X'FFE0FFF0C030C030C030FFF0FFE0C000C000C000C000C000'      45010000
BLOCKQ   DC    X'7FE0FFF0C030C030C030C030C030C330C1B0C0F0FFE07FB0'      45020000
BLOCKR   DC    X'FFE0FFF0C030C030C030FFF0FFE0C300C180C0C0C060C030'      45030000
BLOCK$   DC    X'06007FE0FFF0C630E6007FC03FE00670C630FFF07FE00600'      45040000
BLOCKS   DC    X'7FE0FFF0C030C000E0007FC03FE000700030C030FFF07FE0'      45050000
BLOCKT   DC    X'FFF0FFF00600060006000600060006000600060006000600'      45060000
BLOCKU   DC    X'C030C030C030C030C030C030C030C030C030C030FFF07FE0'      45070000
BLOCKV   DC    X'C030C030C030C030C030C030C030606030C019800F000600'      45080000
BLOCKW   DC    X'C030C030C030C030C030C030C630CF30D9B0F0F0E070C030'      45090000
BLOCKX   DC    X'C030C030606030C019800F000F00198030C06060C030C030'      45100000
BLOCKY   DC    X'C030C030606030C019800F00060006000600060006000600'      45110000
BLOCKZ   DC    X'FFF0FFF0006000C001801FC01FC00C00180030007FF0FFF0'      45120000
BLOCK0   DC    X'3FC07FE0C0F0C1B0C330C630CC30D830F030E0307FE03FC0'      45130000
BLOCK1   DC    X'06000E001E0006000600060006000600060006007FE07FE0'      45140000
BLOCK2   DC    X'7FE0FFF0C0300030003000600180060018006000FFF0FFF0'      45150000
BLOCK3   DC    X'7FE0FFF0C0300030003001E001E000300030C030FFF07FE0'      45160000
BLOCK4   DC    X'038007800D80198031807FF0FFF001800180018001800180'      45170000
BLOCK5   DC    X'FFF0FFF0C000C000C000FF80FFC0006000300030FFF0FFE0'      45180000
BLOCK6   DC    X'7FE0FFF0C030C000C000FFE0FFF0C030C030C030FFF07FE0'      45190000
BLOCK7   DC    X'FFF0FFE0C0C0018003000600060006000600060006000600'      45200000
BLOCK8   DC    X'7FE0FFF0C030C03060603FC03FC06060C030C030FFF07FE0'      45210000
BLOCK9   DC    X'7FE0FFF0C030C030C030FFF0FFF000300030C030FFF07FE0'      45220000
BLOCK#   DC    X'30C030C0FFF0FFF030C030C030C030C0FFF0FFF030C030C0'      45230000
BLOCK@   DC    X'3FC07FE0C030003000301E303F306330C330C3307FE03FC0'      45240000
*        DC    B'1234567812345678'                                      45250000
BLOCKSL  EQU   *                                                        45260000
         DC    B'0000000000010000'                                      45270000
         DC    B'0000000000110000'                                      45280000
         DC    B'0000000001100000'                                      45290000
         DC    B'0000000011000000'                                      45300000
         DC    B'0000000110000000'                                      45310000
         DC    B'0000001100000000'                                      45320000
         DC    B'0000011000000000'                                      45330000
         DC    B'0000110000000000'                                      45340000
         DC    B'0001100000000000'                                      45350000
         DC    B'0011000000000000'                                      45360000
         DC    B'0110000000000000'                                      45370000
         DC    B'1100000000000000'                                      45380000
         EJECT                                                          45390000
PLNDISPL DS    F                                                        45400000
PCCWORK  DS    CL8                                                      45410000
PCEFORM  DS    3F                                                       45420000
PBLKWORK DS    CL8                                                      45430000
$POSTSAV DS    CL1                                                      45440000
PBUF     DC    F'0'                                                     45450000
SLANTIND DS    CL1                                                      45460000
         LTORG                                                          45470000
         END                                                            45480000
         TITLE 'BLOCK LETTER ROUTINE'                                   45490000
*********************************************************************** 45500000
*                                                                     * 45510000
*        CREATE BLOCK LETTERS                                         * 45520000
*        --------------------                                         * 45530000
*        THIS ROUTINE FORMATS BLOCK LETTERS.  THIS                    * 45540000
*        CODE WAS EXTRACTED FROM HASPPRPU (JES2) PRINT DRIVER         * 45550000
*        AND EXTENSIVELY MODIFIED TO SIMPLY PRODUCE A LINE OF BLOCK   * 45560000
*        LETTERS VIA SUBROUTINE CALL.                                 * 45570000
*                                                                     * 45580000
*********************************************************************** 45590000
*                                                                     * 45600000
*     THREE PARMS MUST BE PASSED USING STANDARD IBM LINKAGE           * 45610000
*       PARM1=SLANT INDICATOR - 1 CHARACTER (Y/N)                     * 45620000
*       PARM2=TEXT FOR BLOCK LETTERS - 8 CHARACTERS                   * 45630000
*       PARM3=BUFFER FOR BLOCK LETTERS - 12 LINES OF 132 CHARS        * 45640000
*                                                                     * 45650000
*********************************************************************** 45660000
*                                                                     * 45670000
*     V1.0.0 - NOV 1, 2008                                            * 45680000
*        ADDED '/' CHARACTER AND OTHER COMMENTS                       * 45690000
*                                                                     * 45700000
*********************************************************************** 45710000
BLKPRT   ESTART TYPE=START,DESC='BLOCK LETTER GENERATION',             *45720000
               VER='1.0.0',REGS=YES,BASE=R12,PLIF=BLKPRTF               45730000
         BNE   NOTPLI                                                   45740000
         LM    R2,R4,0(R1)         GET PLI PARMLIST OF DDB              45750000
         L     R2,0(0,R2)          GET DATA ADDRS                       45760000
         L     R3,0(0,R3)                                               45770000
         L     R4,0(0,R4)                                               45780000
         B     COMM                                                     45790000
NOTPLI   EQU   *                                                        45800000
         LM    R2,R4,0(R1)                                              45810000
COMM     EQU   *                                                        45820000
         SLL   R4,8                GET RID OF HIGH ORDER BIT            45830000
         SRL   R4,8                   FROM LAST PARM                    45840000
         MVC   SLANTIND,0(R2)      GET SLANT IND                        45850000
         MVC   PCCWORK,0(R3)       GET TEXT                             45860000
         LR    R1,R4               GET BUFFER                           45870000
         MVC   PBLKWORK,PCCWORK    SAVE TEXT                            45880000
         OC    PCCWORK(8),=8X'C0'  SHIFT ALL TO 4TH QUADRANT            45890000
         TR    PCCWORK(8),BLOCKTR-X'C0'  TRANSLATE TO INDEX VALUE       45900000
         SLR   R4,R4               LINE 0 OF 12                         45910000
BLKBLD   STH   R4,PCEFORM+8        SAVE LINE COUNTER                    45920000
         ST    R1,PLNDISPL         SAVE NEW LINE DISPLACEMENT           45930000
         MVI   0(R1),C' '          FILL LINE                            45940000
         MVC   1(131,R1),0(R1)      WITH BLANKS                         45950000
         LA    R7,7                SCAN FOR                             45960000
BLKCENTR LA    R15,PBLKWORK(R7)      LAST                               45970000
         CLI   0(R15),C' '            NON-                              45980000
         BNE   SKIP510                 BLANK                            45990000
         BCT   R7,BLKCENTR              CHARACTER                       46000000
SKIP510  LA    R7,1(,R7)           COMPUTE                              46010000
         MH    R7,=H'7'             BEGINNING                           46020000
         SH    R7,=H'67'             PRINT POSITION                     46030000
         LCR   R7,R7                  TO CENTER                         46040000
         LA    R5,0(R7,R1)             BLOCK LETTERS                    46050000
         CLI   SLANTIND,C'N'       TEST FOR SLANTING OPTION             46060000
         BE    SKIP520             BR IF NO                             46070000
         LA    R5,6(,R5)           ELSE, SLANT                          46080000
         SRL   R4,1                 BLOCK                               46090000
         SLR   R5,R4                 LETTERS                            46100000
SKIP520  SLR   R4,R4               SET FOR A LETTER INDEX OF 0          46110000
BLKLUP   IC    R7,PBLKWORK(R4)     USE RELATIVE TEXT LETTER             46120000
         STC   R7,$POSTSAV          TO FORM BLOCK TEXT                  46130000
         LA    R7,PCCWORK(R4)      CURRENT LETTER INDEX                 46140000
         SLR   R15,R15             CLEAR REGISTER                       46150000
         ICM   R15,1,0(R7)         GET TRANSLATED LETTER INDEX          46160000
         BZ    BLKSTOR             BRANCH IF INDEX ZERO                 46170000
         BCTR  R15,0               DECREMENT BY ONE                     46180000
         MH    R15,=H'24'          CONVERT TO DISPLACEMENT              46190000
         AH    R15,PCEFORM+8       SELECT FOR LINE WITHIN LETTER        46200000
         LA    R15,BLOCKA(R15)     LETTER MASK ADDRESS                  46210000
         ICM   R15,12,0(R15)       LETTER MASK BITS                     46220000
BLKSTOR  LA    R7,12               BLOCK WIDTH OF 12                    46230000
BLKLOOP  ALR   R15,R15             SHIFT LEFT AND TEST HIGH BIT         46240000
         BC    12,SKIP530          BRANCH IF OFF                        46250000
         MVC   0(1,R5),$POSTSAV    OVERSTORE BLANK TO FORM BLOCK        46260000
SKIP530  LA    R5,1(,R5)           INCREMENT COL NUMBER                 46270000
         BCT   R7,BLKLOOP          BRANCH TO FILL 12 COL'S              46280000
         LA    R5,2(,R5)           2 BLANKS BETWEEN BLOCKS              46290000
         LA    R4,1(,R4)           STEP TO NEXT LETTER INDEX            46300000
         CL    R4,=F'8'            HAVE WE DONE 8 BLOCKS                46310000
         BL    BLKLUP              BRANCH IF NO                         46320000
         L     R1,PLNDISPL         GET NEW                              46330000
         LA    R1,132(,R1)          LINE DISPLACEMENT                   46340000
         LH    R4,PCEFORM+8        GET LINE COUNTER                     46350000
         LA    R4,2(,R4)           STEP TO NEXT LINE                    46360000
         CH    R4,=H'24'           LAST LINE FINISHED                   46370000
         BL    BLKBLD              BRANCH IF NO                         46380000
         ST    R1,PLNDISPL         SAVE NEW LINE DISPLACEMENT           46390000
         ERETURN RC=0                                                   46400000
         TITLE 'MISCELLANEOUS TABLES'                                   46410000
*********************************************************************** 46420000
*                                                                     * 46430000
*        BLOCK LETTER TABLE                                           * 46440000
*                                                                     * 46450000
*        BLOCKTR IS USED WITH A TR INSTRUCTION TO GET THE OFFSET OF   * 46460000
*        THE BIT PATTERN FOR THE CHARACTER.                           * 46470000
*                                                                     * 46480000
*        EACH BLOCK? DEFINES THE BIT PATTERN FOR EACH CHARACTER.      * 46490000
*        THE BLOCK IS 24 BYTES LONG.  EACH GROUP OF 2 BYTES DESCRIBE  * 46500000
*        A LINE IN THE BLOCK LETTER.  BITS 1-12 ARE USED 13-16 ARE    * 46510000
*        NOT USED.                                                    * 46520000
*                                                                     * 46530000
*********************************************************************** 46540000
         SPACE 1                                                        46550000
BLOCKTR  DC    X'00010203040506070809000000000000'   +X'C0'             46560000
         DC    X'000A0B0C0D0E0F101112001300000000'   +X'D0'             46570000
         DC    X'00281415161718191A1B000000000000'   +X'E0'             46580000
         DC    X'1C1D1E1F202122232425002627000000'   +X'F0'             46590000
         SPACE 2                                                        46600000
BLOCKA   DC    X'7FE0FFF0C030C030C030FFF0FFF0C030C030C030C030C030'      46610000
BLOCKB   DC    X'FFE0FFF0C030C030C060FFC0FFC0C060C030C030FFF0FFE0'      46620000
BLOCKC   DC    X'7FE0FFF0C030C000C000C000C000C000C000C030FFF07FE0'      46630000
BLOCKD   DC    X'FF80FFC0C060C030C030C030C030C030C030C060FFC0FF80'      46640000
BLOCKE   DC    X'FFF0FFF0C000C000C000FF00FF00C000C000C000FFF0FFF0'      46650000
BLOCKF   DC    X'FFF0FFF0C000C000C000FF00FF00C000C000C000C000C000'      46660000
BLOCKG   DC    X'7FE0FFF0C030C000C000C000C1F0C1F0C030C030FFF07FE0'      46670000
BLOCKH   DC    X'C030C030C030C030C030FFF0FFF0C030C030C030C030C030'      46680000
BKOCKI   DC    X'7FE07FE0060006000600060006000600060006007FE07FE0'      46690000
BLOCKJ   DC    X'3FF03FF0030003000300030003000300C300C300FF007E00'      46700000
BLOCKK   DC    X'C030C060C0C0C180C300FE00FE00C300C180C0C0C060C030'      46710000
BLOCKL   DC    X'C000C000C000C000C000C000C000C000C000C000FFF0FFF0'      46720000
BLOCKM   DC    X'C030E070F0F0D9B0CF30C630C030C030C030C030C030C030'      46730000
BLOCKN   DC    X'C030E030F030D830CC30C630C330C1B0C0F0C070C030C010'      46740000
BLOCKO   DC    X'FFF0FFF0C030C030C030C030C030C030C030C030FFF0FFF0'      46750000
BLOCKP   DC    X'FFE0FFF0C030C030C030FFF0FFE0C000C000C000C000C000'      46760000
BLOCKQ   DC    X'7FE0FFF0C030C030C030C030C030C330C1B0C0F0FFE07FB0'      46770000
BLOCKR   DC    X'FFE0FFF0C030C030C030FFF0FFE0C300C180C0C0C060C030'      46780000
BLOCK$   DC    X'06007FE0FFF0C630E6007FC03FE00670C630FFF07FE00600'      46790000
BLOCKS   DC    X'7FE0FFF0C030C000E0007FC03FE000700030C030FFF07FE0'      46800000
BLOCKT   DC    X'FFF0FFF00600060006000600060006000600060006000600'      46810000
BLOCKU   DC    X'C030C030C030C030C030C030C030C030C030C030FFF07FE0'      46820000
BLOCKV   DC    X'C030C030C030C030C030C030C030606030C019800F000600'      46830000
BLOCKW   DC    X'C030C030C030C030C030C030C630CF30D9B0F0F0E070C030'      46840000
BLOCKX   DC    X'C030C030606030C019800F000F00198030C06060C030C030'      46850000
BLOCKY   DC    X'C030C030606030C019800F00060006000600060006000600'      46860000
BLOCKZ   DC    X'FFF0FFF0006000C001801FC01FC00C00180030007FF0FFF0'      46870000
BLOCK0   DC    X'3FC07FE0C0F0C1B0C330C630CC30D830F030E0307FE03FC0'      46880000
BLOCK1   DC    X'06000E001E0006000600060006000600060006007FE07FE0'      46890000
BLOCK2   DC    X'7FE0FFF0C0300030003000600180060018006000FFF0FFF0'      46900000
BLOCK3   DC    X'7FE0FFF0C0300030003001E001E000300030C030FFF07FE0'      46910000
BLOCK4   DC    X'038007800D80198031807FF0FFF001800180018001800180'      46920000
BLOCK5   DC    X'FFF0FFF0C000C000C000FF80FFC0006000300030FFF0FFE0'      46930000
BLOCK6   DC    X'7FE0FFF0C030C000C000FFE0FFF0C030C030C030FFF07FE0'      46940000
BLOCK7   DC    X'FFF0FFE0C0C0018003000600060006000600060006000600'      46950000
BLOCK8   DC    X'7FE0FFF0C030C03060603FC03FC06060C030C030FFF07FE0'      46960000
BLOCK9   DC    X'7FE0FFF0C030C030C030FFF0FFF000300030C030FFF07FE0'      46970000
BLOCK#   DC    X'30C030C0FFF0FFF030C030C030C030C0FFF0FFF030C030C0'      46980000
BLOCK@   DC    X'3FC07FE0C030003000301E303F306330C330C3307FE03FC0'      46990000
*        DC    B'1234567812345678'                                      47000000
BLOCKSL  EQU   *                                                        47010000
         DC    B'0000000000010000'                                      47020000
         DC    B'0000000000110000'                                      47030000
         DC    B'0000000001100000'                                      47040000
         DC    B'0000000011000000'                                      47050000
         DC    B'0000000110000000'                                      47060000
         DC    B'0000001100000000'                                      47070000
         DC    B'0000011000000000'                                      47080000
         DC    B'0000110000000000'                                      47090000
         DC    B'0001100000000000'                                      47100000
         DC    B'0011000000000000'                                      47110000
         DC    B'0110000000000000'                                      47120000
         DC    B'1100000000000000'                                      47130000
         EJECT                                                          47140000
PLNDISPL DS    F                                                        47150000
PCCWORK  DS    CL8                                                      47160000
PCEFORM  DS    3F                                                       47170000
PBLKWORK DS    CL8                                                      47180000
$POSTSAV DS    CL1                                                      47190000
PBUF     DC    F'0'                                                     47200000
SLANTIND DS    CL1                                                      47210000
         LTORG                                                          47220000
         END                                                            47230000
./ ENDUP                                                                47240000
//*                                                                     47250000
//ASM1     EXEC PGM=IFOX00,PARM=OBJ,REGION=128K                         47260000
//SYSLIB   DD   DSN=SYS1.AMODGEN,DISP=SHR                               47270000
//         DD   DSN=SYS1.MACLIB,DISP=SHR                                47280000
//SYSUT1   DD   DSN=&&SYSUT1,UNIT=SYSSQ,SPACE=(3400,(600,100)),         47290000
//             SEP=(SYSLIB)                                             47300000
//SYSUT2   DD   DSN=&&SYSUT2,UNIT=SYSSQ,SPACE=(3400,(300,50)),          47310000
//             SEP=(SYSLIB,SYSUT1)                                      47320000
//SYSUT3   DD   DSN=&&SYSUT3,UNIT=SYSSQ,SPACE=(3400,(300,50))           47330000
//SYSPRINT DD   SYSOUT=A,DCB=BLKSIZE=1089                               47340000
//SYSPUNCH DD   SYSOUT=B                                                47350000
//SYSGO    DD   DSN=&&OBJSET,UNIT=SYSSQ,SPACE=(80,(200,50)),            47360000
//             DISP=(NEW,PASS)                                          47370000
//SYSIN    DD  DSN=HERC01.MAPDISK.ASM(MAPDISK),DISP=SHR                 47380000
//*                                                                     47390000
//ASM2     EXEC PGM=IFOX00,PARM=OBJ,REGION=128K                         47400000
//SYSLIB   DD   DSN=SYS1.AMODGEN,DISP=SHR                               47410000
//         DD   DSN=SYS1.MACLIB,DISP=SHR                                47420000
//SYSUT1   DD   DSN=&&SYSUT1,UNIT=SYSSQ,SPACE=(1700,(600,100)),         47430000
//             SEP=(SYSLIB)                                             47440000
//SYSUT2   DD   DSN=&&SYSUT2,UNIT=SYSSQ,SPACE=(1700,(300,50)),          47450000
//             SEP=(SYSLIB,SYSUT1)                                      47460000
//SYSUT3   DD   DSN=&&SYSUT3,UNIT=SYSSQ,SPACE=(1700,(300,50))           47470000
//SYSPRINT DD   SYSOUT=A,DCB=BLKSIZE=1089                               47480000
//SYSPUNCH DD   SYSOUT=B                                                47490000
//SYSGO    DD   DSN=&&OBJSET,UNIT=SYSSQ,SPACE=(80,(200,50)),            47500000
//             DISP=(MOD,PASS)                                          47510000
//SYSIN    DD  DSN=HERC01.MAPDISK.ASM(BLKPRT),DISP=SHR                  47520000
//*                                                                     47530000
//LKED     EXEC PGM=IEWL,PARM=(XREF,LET,LIST,NCAL),REGION=128K,         47540000
//             COND=(7,LT)                                              47550000
//SYSLIN   DD   DSN=&&OBJSET,DISP=(OLD,DELETE)                          47560000
//         DD   DDNAME=SYSIN                                            47570000
//SYSUT1   DD   DSN=&&SYSUT1,UNIT=(SYSDA,SEP=(SYSLIN,SYSLMOD)),         47580000
//             SPACE=(1024,(50,20))                                     47590000
//SYSPRINT DD  SYSOUT=A                                                 47600000
//SYSLMOD  DD   DSN=HERC01.TEST.LOADLIB(MAPDISK),DISP=SHR               47610000
//

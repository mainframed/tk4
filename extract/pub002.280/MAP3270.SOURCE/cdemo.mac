000100 ID DIVISION.
000200 PROGRAM-ID.  CDEMO.
000300******************************************************************
000400*
000500*  CDEMO - COBOL PROGRAM TO DEMO MAP3270
000600*          NOTE - THE PROGRAM IS INTENDED TO BE USED FOR DEMO
000700*          PURPOSES AND IS NOT PRODUCTION QUALITY.
000800*
000900* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
001000*
001100*  (C) COPYRIGHT 2009  CEDAR LAKE EMPORIUM LLC   ALL RIGHTS
001200*      RESERVED.
001300*
001400*  THIS SOURCE CODE AS WELL AS ANY OBJECT CODE RESULTING FROM THIS
001500*  SOURCE CODE MAY BE DISTRIBUTED FREELY PROVIDED NO FEE IS CHARGE
001600*  AND FOR NON-COMERCIAL PURPOSES.
001700*
001800*  FOR COMMERCIAL DISTRIBUTION RIGHTS, CONTACT THE COPYRIGHT OWNER
001900*
002000******************************************************************
002100 ENVIRONMENT DIVISION.
002200 DATA DIVISION.
002300 WORKING-STORAGE SECTION.
002400 01  FILLER PIC X(32)  VALUE '***** START   CDEMO  WKSTG *****'.
002500 01  WS-ERRORS-FOUND         PIC S9(4)  COMP SYNC VALUE +0.
002600*
002700 01  AIDS COPY AIDCODES.
002800*
002900 01  WS-MODULE-BLK.
003000     05  WS-MODULE-NAME1     PIC X(8)   VALUE 'T3270IO '.
003100     05  WS-MODULE-ADDR      PIC X(4)   VALUE LOW-VALUES.
003200     05  WS-CALL-MODE1       PIC X      VALUE 'K'.
003300     05  FILLER              PIC XXX    VALUE LOW-VALUES.
003400*
003500 01  IOCB.
003600     05  IOCBFUNC                PIC X(4).
003700         88  IOCBFUNC-STRT           VALUE 'STRT'.
003800         88  IOCBFUNC-END            VALUE 'END '.
003900         88  IOCBFUNC-IO             VALUE 'IO  '.
004000     05  IOCBRC                  PIC S9(4) COMP.
004100     05  IOCBLEN                 PIC S9(4) COMP.
004200     05  IOCBADDR                PIC S9(8) COMP.
004300     05  FILLER                  PIC X(20).
004400 01  TEXT-IN-01.
004500     05  TIN-STRING              PIC X(50).
004600     05  TIN-BYTE        REDEFINES TIN-STRING
004700                                 PIC X OCCURS 50 TIMES.
004800     05  TIN-LEN                 PIC S9(4) COMP SYNC.
004900     05  TIN-MOVE                PIC S9(4) COMP SYNC.
005000 01  TEXT-OUT.
005100     05  TOUT-STRING             PIC X(50).
005200     05  TOUT-BYTE       REDEFINES TOUT-STRING
005300                                 PIC X OCCURS 50 TIMES.
005400     05  TOUT-LEN                PIC S9(4) COMP SYNC.
005500 01  DEMOPAN COPY DEMOPAN.
005600 01  FILLER PIC X(32)  VALUE '****** END   CDEMO  WKSTG ******'.
005700    EJECT
005800 PROCEDURE DIVISION.
005900 START-HERE.
006000
006100     MOVE LOW-VALUES             TO  IOCB.
006200     MOVE 'STRT'                 TO  IOCBFUNC.
006300     PERFORM CALL-3270-IO.
006400     PERFORM CLEAR-INPUT.
006500     PERFORM CLEAR-OUTPUT.
006600
006700     PERFORM NEXT-IO
006800         UNTIL DEMOPAN-AID = AIDPFK03.
006900
007000     MOVE 'END '                 TO  IOCBFUNC.
007100     PERFORM CALL-3270-IO.
007200
007300 E-O-J.
007400
007500     MOVE ZERO TO RETURN-CODE.
007600     STOP RUN.
007700
007800 NEXT-IO.
007900
008000     MOVE 'IO  '                 TO  IOCBFUNC.
008100
008200     PERFORM CALL-3270-IO.
008300
008400     IF DEMOPAN-AID = AIDPFK12  THEN
008500         PERFORM CLEAR-INPUT
008600     ELSE
008700         IF DEMOPAN-AID NOT = AIDPFK03
008800            PERFORM PROCESS-INPUT.
008900     EJECT
009000 PROCESS-INPUT.
009100*
009200*  NORMALLY, INPUT VALIDATION WOULD TAKE PLACE HERE.  SINCE THIS
009300*  IS A DEMO, I WILL ONLY VALIDATE THAT THE STATE CODE WAS
009400*  ENTERER
009500*
009600     MOVE ZERO TO WS-ERRORS-FOUND.
009700     MOVE SPACES TO R23C01-D
009800                    R24C01-D.
009900     IF R09C37-D = SPACES
010000        MOVE 'STATE CODE BLANK' TO R23C01-D
010100        ADD 1 TO WS-ERRORS-FOUND.
010200*  ADDITIONAL EDITS
010300     IF WS-ERRORS-FOUND = ZERO
010400         PERFORM FORMAT-DATA
010500     ELSE
010600         PERFORM CLEAR-OUTPUT
010700         MOVE 'ERROR(S) FOUND ' TO R24C01-D.
010800
010900 FORMAT-DATA.
011000     PERFORM COMPRESS-NAME.
011100     PERFORM COMPRESS-ADDR.
011200     MOVE R08C17-D TO R16C20-D.
011300     PERFORM COMPRESS-CITY.
011400     PERFORM COMPRESS-ZIP.
011500
011600 COMPRESS-NAME.
011700     MOVE SPACES    TO  TOUT-STRING.
011800     MOVE 1         TO  TOUT-LEN.
011900
012000     MOVE FNAME-D   TO  TIN-STRING.
012100     MOVE FNAME-L   TO  TIN-LEN.
012200     PERFORM COPY-TEXT.
012300
012400     MOVE MNAME-D   TO  TIN-STRING.
012500     MOVE MNAME-L   TO  TIN-LEN.
012600     PERFORM COPY-TEXT.
012700
012800     MOVE LNAME-D   TO  TIN-STRING.
012900     MOVE LNAME-L   TO  TIN-LEN.
013000     PERFORM COPY-TEXT.
013100
013200     MOVE TOUT-STRING  TO  R14C20-D.
013300
013400 COMPRESS-ADDR.
013500     MOVE SPACES    TO  TOUT-STRING.
013600     MOVE 1         TO  TOUT-LEN.
013700
013800     MOVE R07C17-D  TO  TIN-STRING.
013900     MOVE R07C17-L  TO  TIN-LEN.
014000     PERFORM COPY-TEXT.
014100
014200     MOVE R07C33-D  TO  TIN-STRING.
014300     MOVE R07C33-L  TO  TIN-LEN.
014400     PERFORM COPY-TEXT.
014500
014600     IF R07C61-D NOT = SPACES
014700         MOVE 'APT ' TO TIN-STRING
014800         MOVE 4      TO TIN-LEN
014900         PERFORM COPY-TEXT.
015000     MOVE R07C61-D  TO  TIN-STRING.
015100     MOVE R07C61-L  TO  TIN-LEN.
015200     PERFORM COPY-TEXT.
015300
015400     MOVE TOUT-STRING  TO  R15C20-D.
015500
015600 COMPRESS-CITY.
015700
015800     MOVE SPACES    TO  TOUT-STRING.
015900     MOVE 1         TO  TOUT-LEN.
016000
016100     MOVE R09C09-D  TO  TIN-STRING.
016200     MOVE R09C09-L  TO  TIN-LEN.
016300     PERFORM COPY-TEXT.
016400
016500     MOVE R09C37-D  TO  TIN-STRING.
016600     MOVE R09C37-L  TO  TIN-LEN.
016700     PERFORM COPY-TEXT.
016800
016900     MOVE TOUT-STRING  TO  R17C20-D.
017000
017100 COMPRESS-ZIP.
017200
017300     MOVE SPACES    TO  TOUT-STRING.
017400     MOVE 1         TO  TOUT-LEN.
017500
017600     MOVE R09C52-D  TO  TIN-STRING.
017700     MOVE R09C52-L  TO  TIN-LEN.
017800     PERFORM COPY-TEXT.
017900
018000     MOVE TOUT-STRING  TO  R18C20-D.
018100     EJECT
018200 COPY-TEXT.
018300     PERFORM FIND-NON-BLANK
018400        VARYING TIN-LEN    FROM TIN-LEN    BY -1
018500          UNTIL TIN-LEN    = 1
018600             OR TIN-BYTE (TIN-LEN) NOT = SPACE.
018700     IF TIN-BYTE (TIN-LEN) NOT = SPACE
018800         PERFORM MOVE-CHAR
018900             VARYING TIN-MOVE FROM 1 BY 1
019000               UNTIL TIN-MOVE > TIN-LEN
019100                  OR TOUT-LEN > 50
019200         ADD 1 TO TOUT-LEN.
019300
019400 FIND-NON-BLANK.
019500
019600 MOVE-CHAR.
019700     MOVE TIN-BYTE (TIN-MOVE)  TO  TOUT-BYTE (TOUT-LEN).
019800     ADD 1 TO TOUT-LEN.
019900
020000 CLEAR-INPUT.
020100     MOVE SPACES TO FNAME-D
020200                    MNAME-D
020300                    LNAME-D
020400                    R07C17-D
020500                    R07C33-D
020600                    R07C61-D
020700                    R08C17-D
020800                    R09C09-D
020900                    R09C37-D
021000                    R09C52-D.
021100     MOVE 'X'   TO  FNAME-C.
021200
021300 CLEAR-OUTPUT.
021400     MOVE SPACES TO R14C20-D
021500                    R15C20-D
021600                    R16C20-D
021700                    R17C20-D
021800                    R18C20-D.
021900 CALL-3270-IO.
022000
022100     CALL 'DYNALOAD' USING WS-MODULE-BLK
022200                           IOCB
022300                           DEMOPAN.
022400*

000100 ID DIVISION.
000200 PROGRAM-ID.  TTYCOB.
000300*****************************************************************
000400*                                                               *
000500* THIS CODE IS PLACED IN THE PUBLIC DOMAIN AND MAY BE FREELY    *
000600* USED AND INCORPORATED INTO DERIVED WORKS AS LONG AS           *
000700* ATTRIBUTION TO THE ORIGINAL AUTHORSHIP REMAINS IN ANY         *
000800* DISTRIBUTED COPIES OF THE COBOL SOURCE.                       *
000900*                                                               *
001000*                                                               *
001100* RELEASE DECEMBER, 2009  BY ED LISS                            *
001200* HTTP://HERCULES.CLEMPORIUM.COM                                *
001300*                                                               *
001400*****************************************************************
001500
001600 ENVIRONMENT DIVISION.
001700 INPUT-OUTPUT SECTION.
001800 DATA DIVISION.
001900 FILE SECTION.
002000 WORKING-STORAGE SECTION.
002100 01  FILLER PIC X(32)  VALUE '***** START DYNALOAD WKSTG *****'.
002200 01  WS-MODULE-BLK-1.
002300     05  WS-MODULE-NAME1     PIC X(8)   VALUE 'TTYRTN  '.
002400     05  WS-MODULE-ADDR      PIC X(4)   VALUE LOW-VALUES.
002500     05  WS-CALL-MODE1       PIC X      VALUE 'K'.
002600     05  FILLER              PIC XXX    VALUE LOW-VALUES.
002700 01  FILLER PIC X(32)  VALUE '***** START TTYRTN PARM    *****'.
002800 01  TTY-PARM   COPY TTYPARM.
002900 01  WS-AID-CODE  COPY AIDCODES.
003000     EJECT
003100 PROCEDURE DIVISION.
003200     MOVE 'STRT'  TO TTY-FUNC-CD.
003300 TEST-AGAIN.
003400     PERFORM 9999-DYNA-CALL-1.
003500*
003600     MOVE 'PUT '               TO TTY-FUNC-CD.
003700     MOVE 'HELLO WORLD!'       TO TTY-LINE-OUT.
003800     MOVE SPACES               TO TTY-LINE-IN.
003900     MOVE SPACES               TO TTY-ERR-MSG.
004000     PERFORM 9999-DYNA-CALL-1.
004100*
004200     MOVE 'PUT '               TO TTY-FUNC-CD.
004300     MOVE 'TTY3270 COBOL HERE' TO TTY-LINE-OUT.
004400     MOVE SPACES               TO TTY-LINE-IN.
004500     MOVE SPACES               TO TTY-ERR-MSG.
004600     PERFORM 9999-DYNA-CALL-1.
004700*
004800     MOVE 'PUT '               TO TTY-FUNC-CD.
004900     MOVE 'TYPE SOME STUFF   ' TO TTY-LINE-OUT.
005000     MOVE SPACES               TO TTY-LINE-IN.
005100     MOVE SPACES               TO TTY-ERR-MSG.
005200     PERFORM 9999-DYNA-CALL-1.
005300*
005400     MOVE 'PRESS PFK3 TO EXIT' TO TTY-LINE-IN.
005500     MOVE SPACES               TO TTY-LINE-OUT.
005600     MOVE 'PRESS PFK3 TO EXIT' TO TTY-ERR-MSG.
005700     PERFORM 1000-ECHO-LINE UNTIL TTY-AID-CD = AIDPFK03.
005800*
005900     MOVE 'PG  '               TO TTY-FUNC-CD.
006000     MOVE 'YES'                TO TTY-LINE-IN.
006100     MOVE 'ARE YOU SURE?'      TO TTY-LINE-OUT.
006200     MOVE 'PRESS PFK3 TO EXIT' TO TTY-ERR-MSG.
006300     PERFORM 9999-DYNA-CALL-1.
006400     IF TTY-AID-CD = AIDPFK03 AND TTY-LINE-IN = 'YES'
006500         NEXT SENTENCE
006600     ELSE
006700         MOVE 'CLR '           TO TTY-FUNC-CD
006800         GO TO TEST-AGAIN.
006900*
007000     MOVE 'END '  TO TTY-FUNC-CD.
007100     PERFORM 9999-DYNA-CALL-1.
007200     STOP RUN.
007300 1000-ECHO-LINE.
007400     MOVE TTY-LINE-IN TO TTY-LINE-OUT.
007500     MOVE '>'         TO TTY-LINE-IN.
007600     MOVE 'IO  '      TO TTY-FUNC-CD.
007700     PERFORM 9999-DYNA-CALL-5.
007800     MOVE SPACES      TO TTY-ERR-MSG.
007900*****************************************************************
008000*                                                               *
008100*   NOTE - NOTE THESE CALLS ARE FUNCTIONALLY EQUIVALENT WHEN    *
008200*          USING THE FIELDS DEFINED IN THE COPY ITEM TTYPARM.   *
008300*                                                               *
008400*   I HAVE CODED BOTH DYNAMIC AND STATIC CALL EXAMPLES.  YOU    *
008500*   CANNOT MIX DYNAMIC AND STATIC CALLS TO THE TTYRTN MODULE    *
008600*   BECAUSE THIS WILL RESULT IN TWO COPIES OF THE MODULE IN     *
008700*   MEMORY.  THEY WILL NOT SHARE THE WORKING STORAGE AND YOU    *
008800*   WILL GET SOME UNUSUAL RESULTS.                              *
008900*                                                               *
009000*****************************************************************
009100 9999-DYNA-CALL-1.
009200     CALL 'DYNALOAD' USING WS-MODULE-BLK-1
009300                           TTY-PARM.
009400**** CALL 'TTYRTN'   USING TTY-PARM.    <== STATIC CALL.
009500 9999-DYNA-CALL-5.
009600     CALL 'DYNALOAD' USING WS-MODULE-BLK-1
009700**** CALL 'TTYRTN'   USING              <-- STATIC CALL.
009800                           TTY-FUNC-CD
009900                           TTY-LINE-OUT
010000                           TTY-LINE-IN
010100                           TTY-ERR-MSG
010200                           TTY-AID-CD.

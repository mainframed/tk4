//PRIMCOB2 JOB (COBOL),
//             'Eratosthenes Sieve',
//             CLASS=A,
//             MSGCLASS=A,
//             REGION=9000K,TIME=1440,
//             MSGLEVEL=(1,1)
//********************************************************************
//*
//* Name: SYS2.JCLLIB(PRIMCOB2)
//*
//* Desc: Sieve of Eratosthenes programmed in COBOL.
//*       All prime numbers up to the value entered via
//*       //GO.SYSIN DD are computed. Due to COBOL
//*       implementation limitations a maximum limit
//*       of 1048544 can be entered.
//*
//********************************************************************
//PRIMES   EXEC COBUCG,
//         PARM.COB='FLAGW,LOAD,SUPMAP,SIZE=6144K,BUF=1024K',
//         PARM.GO='SIZE=6800000'
//COB.SYSPUNCH DD DUMMY
//COB.SYSIN    DD *
   10 * //////////////////////////////////////////////////////////
   20 * // Name: Peter M. Maurer
   30 * // Program: Sieve of Eratosthenes
   40 * // Due: Never
   50 * // Language: COBOL
   60 * //
   70 * // Changes:
   80 * // - Juergen Winkelmann, 2014/10/25, o adaption to IBM OS COBOL
   90 * //                                   o read limit from SYSIN
  100 * //                                   o n**2 (sqrt) shortcut
  110 * //                                   o skip even numbers
  120 * //                                   o compact output format
  130 * //                                   o 1048544 prime flags
  140 * //////////////////////////////////////////////////////////
  150 ***
  160 ***
  170 ***
  180  IDENTIFICATION DIVISION.
  190  PROGRAM-ID.  'PRIMES'.
  200 ***
  210 ***
  220 ***
  230  ENVIRONMENT DIVISION.
  240 **
  250 **
  260  CONFIGURATION SECTION.
  270  SOURCE-COMPUTER.  IBM-360.
  280  OBJECT-COMPUTER.  IBM-360.
  290 **
  300 **
  310  INPUT-OUTPUT SECTION.
  320  FILE-CONTROL.
  330      SELECT PRIMES-SYSIN
  340         ASSIGN TO UT-S-SYSIN.
  350 ***
  360 ***
  370 ***
  380  DATA DIVISION.
  390 **
  400 **
  410  FILE SECTION.
  420  FD  PRIMES-SYSIN
  430      RECORDING MODE IS F
  440      RECORD CONTAINS 80 CHARACTERS
  450      BLOCK  CONTAINS  1 RECORDS
  460      LABEL RECORDS ARE OMITTED
  470      DATA RECORD IS PRIMES-SYSIN-RECORD.
  480  01  PRIMES-SYSIN-RECORD.
  490   02 PRIMES-SYSIN-NUMBER PIC 99999999 OCCURS 10.
  500 **
  510 **
  520  WORKING-STORAGE SECTION.
  530      77 I PIC 99999999 COMP VALUE 1.
  540      77 J PIC 99999999 COMP.
  550      77 K PIC 99999999 COMP VALUE 1.
  560      77 N PIC 99999999 COMP.
  570      77 N-2 PIC 99999999 COMP.
  580      77 SQRTN PIC 99999999 COMP.
  590      77 PRIM-L PIC 9999 VALUE 1 COMP.
  600      77 PRIM-C PIC 99999 VALUE 3 COMP.
  610      77 CROSS-L PIC 9999 COMP.
  620      77 CROSS-C PIC 99999 COMP.
  630      77 PRODUCT PIC 99999999 COMP.
  640      77 ISPRIME PIC 9 VALUE 1.
  650      77 SETPRIME PIC 9 VALUE 1.
  660      01 BLANK-LINE PIC X(160).
  670      01 OUT-INTEGER.
  680       02 SHOWIT PIC ZZZZZZZZ OCCURS 20.
  690      01 OUT REDEFINES OUT-INTEGER.
  700       02 OUT-LINE PIC X(160).
  710      01 C-1-001.
  720       02 C-001 PIC 9 OCCURS 32767.
  730       02 C-002 PIC 9 OCCURS 32767.
  740       02 C-003 PIC 9 OCCURS 32767.
  750       02 C-004 PIC 9 OCCURS 32767.
  760      01 C-1-005.
  770       02 C-005 PIC 9 OCCURS 32767.
  780       02 C-006 PIC 9 OCCURS 32767.
  790       02 C-007 PIC 9 OCCURS 32767.
  800       02 C-008 PIC 9 OCCURS 32767.
  810      01 C-1-009.
  820       02 C-009 PIC 9 OCCURS 32767.
  830       02 C-010 PIC 9 OCCURS 32767.
  840       02 C-011 PIC 9 OCCURS 32767.
  850       02 C-012 PIC 9 OCCURS 32767.
  860      01 C-1-013.
  870       02 C-013 PIC 9 OCCURS 32767.
  880       02 C-014 PIC 9 OCCURS 32767.
  890       02 C-015 PIC 9 OCCURS 32767.
  900       02 C-016 PIC 9 OCCURS 32767.
  910      01 C-1-017.
  920       02 C-017 PIC 9 OCCURS 32767.
  930       02 C-018 PIC 9 OCCURS 32767.
  940       02 C-019 PIC 9 OCCURS 32767.
  950       02 C-020 PIC 9 OCCURS 32767.
  960      01 C-1-021.
  970       02 C-021 PIC 9 OCCURS 32767.
  980       02 C-022 PIC 9 OCCURS 32767.
  990       02 C-023 PIC 9 OCCURS 32767.
 1000       02 C-024 PIC 9 OCCURS 32767.
 1010      01 C-1-025.
 1020       02 C-025 PIC 9 OCCURS 32767.
 1030       02 C-026 PIC 9 OCCURS 32767.
 1040       02 C-027 PIC 9 OCCURS 32767.
 1050       02 C-028 PIC 9 OCCURS 32767.
 1060      01 C-1-029.
 1070       02 C-029 PIC 9 OCCURS 32767.
 1080       02 C-030 PIC 9 OCCURS 32767.
 1090       02 C-031 PIC 9 OCCURS 32767.
 1100       02 C-032 PIC 9 OCCURS 32767.
 1110 ***
 1120 ***
 1130 ***
 1140  PROCEDURE DIVISION.
 1150 **
 1160 **
 1170  MAIN-PART.
 1180      OPEN INPUT PRIMES-SYSIN.
 1190      READ PRIMES-SYSIN AT END DISPLAY '** EOF on SYSIN **'.
 1200      MOVE PRIMES-SYSIN-NUMBER (1) TO N.
 1210      CLOSE PRIMES-SYSIN.
 1220      SUBTRACT 2 FROM N GIVING N-2.
 1230 *
 1240      PERFORM NEXT-SQUARE UNTIL SQRTN GREATER N.
 1250      MOVE I TO SQRTN.
 1260 *
 1270      MOVE 3 TO I.
 1280      PERFORM INIT-1 UNTIL I GREATER N.
 1290 *
 1300      MOVE 1 TO PRIM-L.
 1310      MOVE 3 TO PRIM-C.
 1320      MOVE 3 TO I.
 1330      MOVE 0 TO SETPRIME.
 1340      PERFORM CHECK-NUMBER UNTIL I GREATER SQRTN OR EQUAL SQRTN.
 1350 *
 1360      MOVE 2 TO J.
 1370      MOVE J TO SHOWIT (K).
 1380      MOVE 1 TO PRIM-L.
 1390      MOVE 3 TO PRIM-C.
 1400      MOVE 3 TO I.
 1410      PERFORM PRINT UNTIL I GREATER N.
 1420 *
 1430      MOVE K TO SHOWIT (1).
 1440      MOVE N TO SHOWIT (2).
 1450      DISPLAY ' '.
 1460      DISPLAY SHOWIT (1), ' primes up to ', SHOWIT (2), ' found.'.
 1470      STOP RUN.
 1480 **
 1490 **
 1500  INIT-1.
 1510      PERFORM PRIM-SET THRU PRIM-SET-END.
 1520      ADD 2 TO PRIM-C.
 1530      IF PRIM-C GREATER THAN 32767
 1540          SUBTRACT 32767 FROM PRIM-C
 1550          ADD 1 TO PRIM-L.
 1560      ADD 2 TO I.
 1570 **
 1580 **
 1590  CHECK-NUMBER.
 1600      PERFORM ADVANCE UNTIL I GREATER THAN SQRTN OR EQUAL TO SQRT
 1610 -     N OR ISPRIME EQUAL TO 1.
 1620      IF ISPRIME EQUAL TO 1
 1630          MOVE PRIM-L TO CROSS-L
 1640          MOVE PRIM-C TO CROSS-C
 1650          ADD I I GIVING J
 1660          MULTIPLY I BY I GIVING PRODUCT
 1670          PERFORM CROSS-OUT UNTIL PRODUCT GREATER THAN N
 1680          MOVE CROSS-L TO PRIM-L
 1690          MOVE CROSS-C TO PRIM-C.
 1700      MOVE 0 TO ISPRIME.
 1710 **
 1720 **
 1730  ADVANCE.
 1740      ADD 2 TO PRIM-C.
 1750      IF PRIM-C GREATER THAN 32767
 1760          SUBTRACT 32767 FROM PRIM-C
 1770          ADD 1 TO PRIM-L.
 1780      ADD 2 TO I.
 1790      PERFORM PRIM-QRY THRU PRIM-QRY-END.
 1800 **
 1810 **
 1820  CROSS-OUT.
 1830      DIVIDE PRODUCT BY 32767 GIVING PRIM-L REMAINDER PRIM-C.
 1840      IF PRIM-C EQUAL TO 0 MOVE 32767 TO PRIM-C
 1850          ELSE ADD 1 TO PRIM-L.
 1860      PERFORM PRIM-SET THRU PRIM-SET-END.
 1870      ADD J TO PRODUCT.
 1880 **
 1890 **
 1900  NEXT-SQUARE.
 1910      ADD 1 TO I.
 1920      MULTIPLY I BY I GIVING SQRTN.
 1930 **
 1940 **
 1950  PRINT.
 1960      PERFORM PRIM-QRY THRU PRIM-QRY-END.
 1970      IF ISPRIME EQUAL 1
 1980          MOVE I TO SHOWIT (J)
 1990          ADD 1 TO K
 2000          ADD 1 TO J
 2010          IF J GREATER 20
 2020              DISPLAY OUT-LINE
 2030              MOVE BLANK-LINE TO OUT-LINE
 2040              MOVE 1 TO J.
 2050      IF I GREATER N-2 AND J NOT EQUAL 1 DISPLAY OUT-LINE.
 2060      ADD 2 TO PRIM-C.
 2070      IF PRIM-C GREATER THAN 32767
 2080          SUBTRACT 32767 FROM PRIM-C
 2090          ADD 1 TO PRIM-L.
 2100      ADD 2 TO I.
 2110 **
 2120 **
 2130  PRIM-SET.
 2140      GO TO S-001 S-002 S-003 S-004 S-005 S-006 S-007 S-008 S-009 S
 2150 -           -010 S-011 S-012 S-013 S-014 S-015 S-016 S-017 S-018 S
 2160 -           -019 S-020 S-021 S-022 S-023 S-024 S-025 S-026 S-027 S
 2170 -           -028 S-029 S-030 S-031 S-032 DEPENDING ON PRIM-L.
 2180  S-001.
 2190      MOVE SETPRIME TO C-001 (PRIM-C).
 2200      GO TO PRIM-SET-END.
 2210  S-002.
 2220      MOVE SETPRIME TO C-002 (PRIM-C).
 2230      GO TO PRIM-SET-END.
 2240  S-003.
 2250      MOVE SETPRIME TO C-003 (PRIM-C).
 2260      GO TO PRIM-SET-END.
 2270  S-004.
 2280      MOVE SETPRIME TO C-004 (PRIM-C).
 2290      GO TO PRIM-SET-END.
 2300  S-005.
 2310      MOVE SETPRIME TO C-005 (PRIM-C).
 2320      GO TO PRIM-SET-END.
 2330  S-006.
 2340      MOVE SETPRIME TO C-006 (PRIM-C).
 2350      GO TO PRIM-SET-END.
 2360  S-007.
 2370      MOVE SETPRIME TO C-007 (PRIM-C).
 2380      GO TO PRIM-SET-END.
 2390  S-008.
 2400      MOVE SETPRIME TO C-008 (PRIM-C).
 2410      GO TO PRIM-SET-END.
 2420  S-009.
 2430      MOVE SETPRIME TO C-009 (PRIM-C).
 2440      GO TO PRIM-SET-END.
 2450  S-010.
 2460      MOVE SETPRIME TO C-010 (PRIM-C).
 2470      GO TO PRIM-SET-END.
 2480  S-011.
 2490      MOVE SETPRIME TO C-011 (PRIM-C).
 2500      GO TO PRIM-SET-END.
 2510  S-012.
 2520      MOVE SETPRIME TO C-012 (PRIM-C).
 2530      GO TO PRIM-SET-END.
 2540  S-013.
 2550      MOVE SETPRIME TO C-013 (PRIM-C).
 2560      GO TO PRIM-SET-END.
 2570  S-014.
 2580      MOVE SETPRIME TO C-014 (PRIM-C).
 2590      GO TO PRIM-SET-END.
 2600  S-015.
 2610      MOVE SETPRIME TO C-015 (PRIM-C).
 2620      GO TO PRIM-SET-END.
 2630  S-016.
 2640      MOVE SETPRIME TO C-016 (PRIM-C).
 2650      GO TO PRIM-SET-END.
 2660  S-017.
 2670      MOVE SETPRIME TO C-017 (PRIM-C).
 2680      GO TO PRIM-SET-END.
 2690  S-018.
 2700      MOVE SETPRIME TO C-018 (PRIM-C).
 2710      GO TO PRIM-SET-END.
 2720  S-019.
 2730      MOVE SETPRIME TO C-019 (PRIM-C).
 2740      GO TO PRIM-SET-END.
 2750  S-020.
 2760      MOVE SETPRIME TO C-020 (PRIM-C).
 2770      GO TO PRIM-SET-END.
 2780  S-021.
 2790      MOVE SETPRIME TO C-021 (PRIM-C).
 2800      GO TO PRIM-SET-END.
 2810  S-022.
 2820      MOVE SETPRIME TO C-022 (PRIM-C).
 2830      GO TO PRIM-SET-END.
 2840  S-023.
 2850      MOVE SETPRIME TO C-023 (PRIM-C).
 2860      GO TO PRIM-SET-END.
 2870  S-024.
 2880      MOVE SETPRIME TO C-024 (PRIM-C).
 2890      GO TO PRIM-SET-END.
 2900  S-025.
 2910      MOVE SETPRIME TO C-025 (PRIM-C).
 2920      GO TO PRIM-SET-END.
 2930  S-026.
 2940      MOVE SETPRIME TO C-026 (PRIM-C).
 2950      GO TO PRIM-SET-END.
 2960  S-027.
 2970      MOVE SETPRIME TO C-027 (PRIM-C).
 2980      GO TO PRIM-SET-END.
 2990  S-028.
 3000      MOVE SETPRIME TO C-028 (PRIM-C).
 3010      GO TO PRIM-SET-END.
 3020  S-029.
 3030      MOVE SETPRIME TO C-029 (PRIM-C).
 3040      GO TO PRIM-SET-END.
 3050  S-030.
 3060      MOVE SETPRIME TO C-030 (PRIM-C).
 3070      GO TO PRIM-SET-END.
 3080  S-031.
 3090      MOVE SETPRIME TO C-031 (PRIM-C).
 3100      GO TO PRIM-SET-END.
 3110  S-032.
 3120      MOVE SETPRIME TO C-032 (PRIM-C).
 3130  PRIM-SET-END.
 3140 **
 3150 **
 3160  PRIM-QRY.
 3170      GO TO Q-001 Q-002 Q-003 Q-004 Q-005 Q-006 Q-007 Q-008 Q-009 Q
 3180 -           -010 Q-011 Q-012 Q-013 Q-014 Q-015 Q-016 Q-017 Q-018 Q
 3190 -           -019 Q-020 Q-021 Q-022 Q-023 Q-024 Q-025 Q-026 Q-027 Q
 3200 -           -028 Q-029 Q-030 Q-031 Q-032 DEPENDING ON PRIM-L.
 3210  Q-001.
 3220      MOVE C-001 (PRIM-C) TO ISPRIME.
 3230      GO TO PRIM-QRY-END.
 3240  Q-002.
 3250      MOVE C-002 (PRIM-C) TO ISPRIME.
 3260      GO TO PRIM-QRY-END.
 3270  Q-003.
 3280      MOVE C-003 (PRIM-C) TO ISPRIME.
 3290      GO TO PRIM-QRY-END.
 3300  Q-004.
 3310      MOVE C-004 (PRIM-C) TO ISPRIME.
 3320      GO TO PRIM-QRY-END.
 3330  Q-005.
 3340      MOVE C-005 (PRIM-C) TO ISPRIME.
 3350      GO TO PRIM-QRY-END.
 3360  Q-006.
 3370      MOVE C-006 (PRIM-C) TO ISPRIME.
 3380      GO TO PRIM-QRY-END.
 3390  Q-007.
 3400      MOVE C-007 (PRIM-C) TO ISPRIME.
 3410      GO TO PRIM-QRY-END.
 3420  Q-008.
 3430      MOVE C-008 (PRIM-C) TO ISPRIME.
 3440      GO TO PRIM-QRY-END.
 3450  Q-009.
 3460      MOVE C-009 (PRIM-C) TO ISPRIME.
 3470      GO TO PRIM-QRY-END.
 3480  Q-010.
 3490      MOVE C-010 (PRIM-C) TO ISPRIME.
 3500      GO TO PRIM-QRY-END.
 3510  Q-011.
 3520      MOVE C-011 (PRIM-C) TO ISPRIME.
 3530      GO TO PRIM-QRY-END.
 3540  Q-012.
 3550      MOVE C-012 (PRIM-C) TO ISPRIME.
 3560      GO TO PRIM-QRY-END.
 3570  Q-013.
 3580      MOVE C-013 (PRIM-C) TO ISPRIME.
 3590      GO TO PRIM-QRY-END.
 3600  Q-014.
 3610      MOVE C-014 (PRIM-C) TO ISPRIME.
 3620      GO TO PRIM-QRY-END.
 3630  Q-015.
 3640      MOVE C-015 (PRIM-C) TO ISPRIME.
 3650      GO TO PRIM-QRY-END.
 3660  Q-016.
 3670      MOVE C-016 (PRIM-C) TO ISPRIME.
 3680      GO TO PRIM-QRY-END.
 3690  Q-017.
 3700      MOVE C-017 (PRIM-C) TO ISPRIME.
 3710      GO TO PRIM-QRY-END.
 3720  Q-018.
 3730      MOVE C-018 (PRIM-C) TO ISPRIME.
 3740      GO TO PRIM-QRY-END.
 3750  Q-019.
 3760      MOVE C-019 (PRIM-C) TO ISPRIME.
 3770      GO TO PRIM-QRY-END.
 3780  Q-020.
 3790      MOVE C-020 (PRIM-C) TO ISPRIME.
 3800      GO TO PRIM-QRY-END.
 3810  Q-021.
 3820      MOVE C-021 (PRIM-C) TO ISPRIME.
 3830      GO TO PRIM-QRY-END.
 3840  Q-022.
 3850      MOVE C-022 (PRIM-C) TO ISPRIME.
 3860      GO TO PRIM-QRY-END.
 3870  Q-023.
 3880      MOVE C-023 (PRIM-C) TO ISPRIME.
 3890      GO TO PRIM-QRY-END.
 3900  Q-024.
 3910      MOVE C-024 (PRIM-C) TO ISPRIME.
 3920      GO TO PRIM-QRY-END.
 3930  Q-025.
 3940      MOVE C-025 (PRIM-C) TO ISPRIME.
 3950      GO TO PRIM-QRY-END.
 3960  Q-026.
 3970      MOVE C-026 (PRIM-C) TO ISPRIME.
 3980      GO TO PRIM-QRY-END.
 3990  Q-027.
 4000      MOVE C-027 (PRIM-C) TO ISPRIME.
 4010      GO TO PRIM-QRY-END.
 4020  Q-028.
 4030      MOVE C-028 (PRIM-C) TO ISPRIME.
 4040      GO TO PRIM-QRY-END.
 4050  Q-029.
 4060      MOVE C-029 (PRIM-C) TO ISPRIME.
 4070      GO TO PRIM-QRY-END.
 4080  Q-030.
 4090      MOVE C-030 (PRIM-C) TO ISPRIME.
 4100      GO TO PRIM-QRY-END.
 4110  Q-031.
 4120      MOVE C-031 (PRIM-C) TO ISPRIME.
 4130      GO TO PRIM-QRY-END.
 4140  Q-032.
 4150      MOVE C-032 (PRIM-C) TO ISPRIME.
 4160  PRIM-QRY-END.
/*
//COB.SYSLIB   DD DSNAME=SYS1.COBLIB,DISP=SHR
//GO.SYSOUT   DD SYSOUT=*,DCB=(RECFM=FBA,LRECL=161,BLKSIZE=16100)
//GO.SYSIN    DD *
    2000
/*
//

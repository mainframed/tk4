000100 IDENTIFICATION DIVISION.
000200 PROGRAM-ID. RRDSUPDT.
000300 AUTHOR. JAY MOSELEY.
000400 DATE-WRITTEN. NOVEMBER, 2001.
000500 DATE-COMPILED.
000600
000700* ************************************************************* *
000800* THIS PROGRAM TESTS THE VSAMIO ROUTINE BY READING RECORDS FROM *
000900* AN RRDS CLUSTER SEQUENTIALLY AND UPDATING SELECTED RECORDS.   *
001000* ************************************************************* *
001100
001200 ENVIRONMENT DIVISION.
001300 CONFIGURATION SECTION.
001400 SOURCE-COMPUTER. IBM-370.
001500 OBJECT-COMPUTER. IBM-370.
001600
001700 INPUT-OUTPUT SECTION.
001800 FILE-CONTROL.
001900
002000 DATA DIVISION.
002100 FILE SECTION.
002200
002300 WORKING-STORAGE SECTION.
002400 77  END-OF-FILE-SWITCH          PIC X(1)    VALUE 'N'.
002500     88  END-OF-FILE                         VALUE 'Y'.
002600
002700 77  COUNTER-EDIT                PIC ZZ,ZZZ,ZZ9.
002800
002900 01  VSIO-PARAMETER-VALUES       COPY VSAMIO.
003000 01  RRDSF01                     COPY VSAMIOFB.
003100 01  RRDS-RECORD.
003200     02  RRR-ID.
003300         03  RRRI-HIGH           PIC 9(2).
003400         03  FILLER              PIC 9(7).
003500         03  RRRI-LOW            PIC 9(1).
003600     02  FILLER                  PIC X(70).
003700
003800 PROCEDURE DIVISION.
003900
004000 000-INITIATE.
004100
004200     DISPLAY 'RRDSUPDT: READ/REWRITE RRDS SEQUENTIALLY'.
004300     DISPLAY '----------------------------------------'.
004400     DISPLAY ' '.
004500
004600     MOVE 'RRDSF01' TO VSIO-DDNAME.
004700     MOVE VSIO-RRDS TO VSIO-ORGANIZATION.
004800     MOVE VSIO-SEQUENTIAL TO VSIO-ACCESS.
004900     MOVE VSIO-INPUT-OUTPUT TO VSIO-MODE.
005000     MOVE +80 TO VSIO-RECORD-LENGTH.
005100     MOVE VSIO-OPEN TO VSIO-COMMAND.
005200     CALL 'VSAMIO' USING VSIO-PARAMETER-BLOCK, RRDSF01,
005300                         RRDS-RECORD.
005400*    END-CALL.
005500     IF NOT VSIO-SUCCESS
005600         DISPLAY 'VSAMIO ERROR OCCURRED DURING '
005700                 VSIO-COMMAND
005800         EXHIBIT NAMED VSIO-RETURN-CODE,
005900         EXHIBIT NAMED VSIO-VSAM-RETURN-CODE,
006000                       VSIO-VSAM-FUNCTION-CODE,
006100                       VSIO-VSAM-FEEDBACK-CODE
006200         STOP RUN.
006300*    END-IF.
006400
006500 010-PROCESS.
006600
006700     PERFORM 110-PROCESS-DATA
006800        THRU 119-EXIT
006900       UNTIL END-OF-FILE.
007000*    END-PERFORM.
007100
007200 020-TERMINATE.
007300
007400     MOVE VSIO-CLOSE TO VSIO-COMMAND.
007500     CALL 'VSAMIO' USING VSIO-PARAMETER-BLOCK, RRDSF01,
007600                         RRDS-RECORD.
007700*    END-CALL.
007800     IF NOT VSIO-SUCCESS
007900         DISPLAY 'VSAMIO ERROR OCCURRED DURING '
008000                 VSIO-COMMAND
008100         EXHIBIT NAMED VSIO-RETURN-CODE,
008200         EXHIBIT NAMED VSIO-VSAM-RETURN-CODE,
008300                       VSIO-VSAM-FUNCTION-CODE,
008400                       VSIO-VSAM-FEEDBACK-CODE.
008500*    END-IF.
008600
008700     STOP RUN.
008800
008900 110-PROCESS-DATA.
009000
009100     MOVE VSIO-READ TO VSIO-COMMAND.
009200     CALL 'VSAMIO' USING VSIO-PARAMETER-BLOCK, RRDSF01,
009300                         RRDS-RECORD.
009400*    END-CALL.
009500
009600     IF NOT VSIO-SUCCESS
009700         IF VSIO-END-OF-FILE
009800             MOVE 'Y' TO END-OF-FILE-SWITCH
009900         ELSE
010000             DISPLAY 'VSAMIO ERROR OCCURRED DURING '
010100                     VSIO-COMMAND
010200             EXHIBIT NAMED VSIO-RETURN-CODE,
010300             EXHIBIT NAMED VSIO-VSAM-RETURN-CODE,
010400                           VSIO-VSAM-FUNCTION-CODE,
010500                           VSIO-VSAM-FEEDBACK-CODE
010600             MOVE 'Y' TO END-OF-FILE-SWITCH.
010700*        END-IF
010800*    END-IF.
010900
011000     IF NOT END-OF-FILE
011100         PERFORM 120-UPDATE-PROCESS
011200            THRU 129-EXIT.
011300*    END-IF.
011400
011500 119-EXIT.
011600     EXIT.
011700
011800 120-UPDATE-PROCESS.
011900
012000     IF RRRI-LOW EQUAL 2
012100     OR RRRI-LOW EQUAL 4
012200     OR RRRI-LOW EQUAL 8
012300         MOVE VSIO-RELATIVE-RECORD TO COUNTER-EDIT
012400         DISPLAY COUNTER-EDIT ': ' RRDS-RECORD
012500         MOVE '99' TO RRRI-HIGH
012600         MOVE VSIO-REWRITE TO VSIO-COMMAND
012700         CALL 'VSAMIO' USING VSIO-PARAMETER-BLOCK, RRDSF01,
012800                         RRDS-RECORD
012900*        END-CALL
013000         IF VSIO-SUCCESS
013100             DISPLAY '   UPDATED: ' RRDS-RECORD
013200         ELSE
013300             DISPLAY 'VSAMIO ERROR OCCURRED DURING '
013400                     VSIO-COMMAND
013500             EXHIBIT NAMED VSIO-RETURN-CODE,
013600             EXHIBIT NAMED VSIO-VSAM-RETURN-CODE,
013700                           VSIO-VSAM-FUNCTION-CODE,
013800                           VSIO-VSAM-FEEDBACK-CODE.
013900*        END-IF
014000*    END-IF.
014100
014200     IF RRRI-LOW EQUAL 5
014300     OR RRRI-LOW EQUAL 7
014400         MOVE VSIO-RELATIVE-RECORD TO COUNTER-EDIT
014500         DISPLAY COUNTER-EDIT ': ' RRDS-RECORD
014600         MOVE VSIO-DELETE TO VSIO-COMMAND
014700         CALL 'VSAMIO' USING VSIO-PARAMETER-BLOCK, RRDSF01,
014800                         RRDS-RECORD
014900*        END-CALL
015000         IF VSIO-SUCCESS
015100             DISPLAY '   DELETED  '
015200         ELSE
015300             DISPLAY 'VSAMIO ERROR OCCURRED DURING '
015400                     VSIO-COMMAND
015500             EXHIBIT NAMED VSIO-RETURN-CODE,
015600             EXHIBIT NAMED VSIO-VSAM-RETURN-CODE,
015700                           VSIO-VSAM-FUNCTION-CODE,
015800                           VSIO-VSAM-FEEDBACK-CODE.
015900*        END-IF
016000*    END-IF.
016100
016200 129-EXIT.
016300     EXIT.
016400

000100 IDENTIFICATION DIVISION.
000200 PROGRAM-ID. ESDSUPDT.
000300 AUTHOR. JAY MOSELEY.
000400 DATE-WRITTEN. NOVEMBER, 2001.
000500 DATE-COMPILED.
000600
000700* ************************************************************* *
000800* THIS PROGRAM TESTS THE VSAMIO ROUTINE BY READING RECORDS      *
000900* FROM AN ESDS CLUSTER AND THEN REWRITING SOME OF THE RESORDS   *
001000* WITH CHANGED RECORD CONTENTS.                                 *
001100* ************************************************************* *
001200
001300 ENVIRONMENT DIVISION.
001400 CONFIGURATION SECTION.
001500 SOURCE-COMPUTER. IBM-370.
001600 OBJECT-COMPUTER. IBM-370.
001700
001800 INPUT-OUTPUT SECTION.
001900 FILE-CONTROL.
002000
002100 DATA DIVISION.
002200 FILE SECTION.
002300
002400 WORKING-STORAGE SECTION.
002500 77  END-OF-FILE-SWITCH          PIC X(1)    VALUE 'N'.
002600     88  END-OF-FILE                         VALUE 'Y'.
002700
002800 77  RECORD-COUNTER              PIC S9(8)   VALUE +0.
002900 77  COUNTER-EDIT                PIC ZZ,ZZZ,ZZ9.
003000
003100 01  VSIO-PARAMETER-VALUES       COPY VSAMIO.
003200 01  ESDSF01                     COPY VSAMIOFB.
003300 01  ESDS-RECORD.
003400     02  ESR-ID.
003500         03  ESRI-HIGH           PIC 9(2).
003600         03  FILLER              PIC 9(6).
003700         03  ESRI-LOW            PIC 9(2).
003800     02  FILLER                  PIC X(70).
003900
004000 PROCEDURE DIVISION.
004100
004200     DISPLAY 'ESDSUPDT: READ/REWRITE ESDS SEQUENTIALLY'.
004300     DISPLAY '----------------------------------------'.
004400     DISPLAY ' '.
004500
004600 000-INITIATE.
004700
004800     MOVE 'ESDSF01' TO VSIO-DDNAME.
004900     MOVE VSIO-ESDS TO VSIO-ORGANIZATION.
005000     MOVE VSIO-SEQUENTIAL TO VSIO-ACCESS.
005100     MOVE VSIO-INPUT-OUTPUT TO VSIO-MODE.
005200     MOVE +80 TO VSIO-RECORD-LENGTH.
005300     MOVE +0 TO VSIO-KEY-LENGTH, VSIO-KEY-POSITION.
005400     MOVE VSIO-OPEN TO VSIO-COMMAND.
005500     CALL 'VSAMIO' USING VSIO-PARAMETER-BLOCK, ESDSF01,
005600                         ESDS-RECORD.
005700*    END-CALL.
005800     IF NOT VSIO-SUCCESS
005900         DISPLAY 'VSAMIO ERROR OCCURRED DURING '
006000                 VSIO-COMMAND
006100         EXHIBIT NAMED VSIO-RETURN-CODE,
006200         EXHIBIT NAMED VSIO-VSAM-RETURN-CODE,
006300                       VSIO-VSAM-FUNCTION-CODE,
006400                       VSIO-VSAM-FEEDBACK-CODE
006500         STOP RUN.
006600*    END-IF.
006700
006800 010-PROCESS.
006900
007000     PERFORM 110-PROCESS-DATA
007100        THRU 119-EXIT
007200       UNTIL END-OF-FILE
007300          OR (NOT VSIO-SUCCESS).
007400*    END-PERFORM.
007500
007600 020-TERMINATE.
007700
007800     MOVE VSIO-CLOSE TO VSIO-COMMAND.
007900     CALL 'VSAMIO' USING VSIO-PARAMETER-BLOCK, ESDSF01,
008000                         ESDS-RECORD.
008100*    END-CALL.
008200     IF NOT VSIO-SUCCESS
008300         DISPLAY 'VSAMIO ERROR OCCURRED DURING '
008400                 VSIO-COMMAND
008500         EXHIBIT NAMED VSIO-RETURN-CODE,
008600         EXHIBIT NAMED VSIO-VSAM-RETURN-CODE,
008700                       VSIO-VSAM-FUNCTION-CODE,
008800                       VSIO-VSAM-FEEDBACK-CODE.
008900*    END-IF.
009000
009100     STOP RUN.
009200
009300 110-PROCESS-DATA.
009400
009500     MOVE VSIO-READ TO VSIO-COMMAND.
009600     CALL 'VSAMIO' USING VSIO-PARAMETER-BLOCK, ESDSF01,
009700                         ESDS-RECORD.
009800*    END-CALL.
009900
010000     IF NOT VSIO-SUCCESS
010100         IF VSIO-END-OF-FILE
010200             MOVE 'Y' TO END-OF-FILE-SWITCH
010300         ELSE
010400             DISPLAY 'VSAMIO ERROR OCCURRED DURING '
010500                     VSIO-COMMAND
010600             EXHIBIT NAMED VSIO-RETURN-CODE,
010700             EXHIBIT NAMED VSIO-VSAM-RETURN-CODE,
010800                           VSIO-VSAM-FUNCTION-CODE,
010900                           VSIO-VSAM-FEEDBACK-CODE
011000             MOVE 'Y' TO END-OF-FILE-SWITCH.
011100*        END-IF
011200*    END-IF.
011300
011400     IF NOT END-OF-FILE
011500         ADD +1 TO RECORD-COUNTER
011600         PERFORM 120-UPDATE-PROCESS
011700            THRU 129-EXIT.
011800*    END-IF.
011900
012000 119-EXIT.
012100     EXIT.
012200
012300 120-UPDATE-PROCESS.
012400
012500     IF ESRI-LOW EQUAL 2
012600     OR ESRI-LOW EQUAL 6
012700     OR ESRI-LOW EQUAL 7
012800         MOVE RECORD-COUNTER TO COUNTER-EDIT
012900         DISPLAY COUNTER-EDIT ': ' ESDS-RECORD
013000         MOVE '99' TO ESRI-HIGH
013100         MOVE VSIO-REWRITE TO VSIO-COMMAND
013200         CALL 'VSAMIO' USING VSIO-PARAMETER-BLOCK, ESDSF01,
013300                         ESDS-RECORD
013400*        END-CALL
013500         IF VSIO-SUCCESS
013600             DISPLAY '   UPDATED: ' ESDS-RECORD
013700         ELSE
013800             DISPLAY 'VSAMIO ERROR OCCURRED DURING '
013900                     VSIO-COMMAND
014000             EXHIBIT NAMED VSIO-RETURN-CODE,
014100             EXHIBIT NAMED VSIO-VSAM-RETURN-CODE,
014200                           VSIO-VSAM-FUNCTION-CODE,
014300                           VSIO-VSAM-FEEDBACK-CODE.
014400*        END-IF
014500*    END-IF.
014600
014700 129-EXIT.
014800     EXIT.
014900

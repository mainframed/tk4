000100 IDENTIFICATION DIVISION.
000200 PROGRAM-ID. KSDSUPDT.
000300 AUTHOR. JAY MOSELEY.
000400 DATE-WRITTEN. NOVEMBER, 2001.
000500 DATE-COMPILED.
000600
000700* ************************************************************* *
000800* THIS PROGRAM TESTS THE VSAMIO ROUTINE BY READING RECORDS FROM *
000900* A KSDS CLUSTER SEQUENTAILLY AND UPDATING SELECTED RECORDS.    *
001000* ************************************************************* *
001100
001200 ENVIRONMENT DIVISION.
001300 CONFIGURATION SECTION.
001400 SOURCE-COMPUTER. IBM-370.
001500 OBJECT-COMPUTER. IBM-370.
001600
001700 INPUT-OUTPUT SECTION.
001800 FILE-CONTROL.
001900
002000 DATA DIVISION.
002100 FILE SECTION.
002200
002300 WORKING-STORAGE SECTION.
002400 77  END-OF-FILE-SWITCH          PIC X(1)    VALUE 'N'.
002500     88  END-OF-FILE                         VALUE 'Y'.
002600
002700 77  COUNTER-EDIT                PIC ZZ,ZZZ,ZZ9.
002800
002900 01  VSIO-PARAMETER-VALUES       COPY VSAMIO.
003000 01  KSDSF01                     COPY VSAMIOFB.
003100 01  KSDS-RECORD.
003200     02  KR-KEY                  PIC X(10).
003300     02  FILLER                  PIC X(49).
003400     02  KR-CITY                 PIC X(15).
003500     02  FILLER                  PIC X(06).
003600
003700 PROCEDURE DIVISION.
003800
003900 000-INITIATE.
004000
004100     DISPLAY 'KSDSUPDT: READ/REWRITE KSDS SEQUENTIALLY'.
004200     DISPLAY '----------------------------------------'.
004300     DISPLAY ' '.
004400
004500     MOVE 'KSDSF01' TO VSIO-DDNAME.
004600     MOVE VSIO-KSDS TO VSIO-ORGANIZATION.
004700     MOVE VSIO-SEQUENTIAL TO VSIO-ACCESS.
004800     MOVE VSIO-INPUT-OUTPUT TO VSIO-MODE.
004900     MOVE +80 TO VSIO-RECORD-LENGTH.
005000     MOVE +0 TO VSIO-KEY-POSITION.
005100     MOVE +10 TO VSIO-KEY-LENGTH.
005200     MOVE VSIO-OPEN TO VSIO-COMMAND.
005300     CALL 'VSAMIO' USING VSIO-PARAMETER-BLOCK, KSDSF01,
005400                         KSDS-RECORD.
005500*    END-CALL.
005600     IF NOT VSIO-SUCCESS
005700         DISPLAY 'VSAMIO ERROR OCCURRED DURING '
005800                 VSIO-COMMAND
005900         EXHIBIT NAMED VSIO-RETURN-CODE,
006000         EXHIBIT NAMED VSIO-VSAM-RETURN-CODE,
006100                       VSIO-VSAM-FUNCTION-CODE,
006200                       VSIO-VSAM-FEEDBACK-CODE
006300         STOP RUN.
006400*    END-IF.
006500
006600 010-PROCESS.
006700
006800     PERFORM 110-PROCESS-DATA
006900        THRU 119-EXIT
007000       UNTIL END-OF-FILE.
007100*    END-PERFORM.
007200
007300 020-TERMINATE.
007400
007500     MOVE VSIO-CLOSE TO VSIO-COMMAND.
007600     CALL 'VSAMIO' USING VSIO-PARAMETER-BLOCK, KSDSF01,
007700                         KSDS-RECORD.
007800*    END-CALL.
007900     IF NOT VSIO-SUCCESS
008000         DISPLAY 'VSAMIO ERROR OCCURRED DURING '
008100                 VSIO-COMMAND
008200         EXHIBIT NAMED VSIO-RETURN-CODE,
008300         EXHIBIT NAMED VSIO-VSAM-RETURN-CODE,
008400                       VSIO-VSAM-FUNCTION-CODE,
008500                       VSIO-VSAM-FEEDBACK-CODE.
008600*    END-IF.
008700
008800     STOP RUN.
008900
009000 110-PROCESS-DATA.
009100
009200     MOVE VSIO-READ TO VSIO-COMMAND.
009300     CALL 'VSAMIO' USING VSIO-PARAMETER-BLOCK, KSDSF01,
009400                         KSDS-RECORD.
009500*    END-CALL.
009600
009700     IF NOT VSIO-SUCCESS
009800         IF VSIO-END-OF-FILE
009900             MOVE 'Y' TO END-OF-FILE-SWITCH
010000         ELSE
010100             DISPLAY 'VSAMIO ERROR OCCURRED DURING '
010200                     VSIO-COMMAND
010300             EXHIBIT NAMED VSIO-RETURN-CODE,
010400             EXHIBIT NAMED VSIO-VSAM-RETURN-CODE,
010500                           VSIO-VSAM-FUNCTION-CODE,
010600                           VSIO-VSAM-FEEDBACK-CODE
010700             MOVE 'Y' TO END-OF-FILE-SWITCH.
010800*        END-IF
010900*    END-IF.
011000
011100     IF NOT END-OF-FILE
011200         PERFORM 120-UPDATE-PROCESS
011300            THRU 129-EXIT.
011400*    END-IF.
011500
011600 119-EXIT.
011700     EXIT.
011800
011900 120-UPDATE-PROCESS.
012000
012100     IF KR-CITY EQUAL 'SAN ANTONIO'
012200         DISPLAY KSDS-RECORD
012300         DISPLAY '           BEFORE UPDATE'
012400         MOVE 'AUSTIN' TO KR-CITY
012500         MOVE VSIO-REWRITE TO VSIO-COMMAND
012600         CALL 'VSAMIO' USING VSIO-PARAMETER-BLOCK, KSDSF01,
012700                         KSDS-RECORD
012800*        END-CALL
012900         IF VSIO-SUCCESS
013000             DISPLAY KSDS-RECORD
013100             DISPLAY '           AFTER UPDATE'
013200         ELSE
013300             DISPLAY 'VSAMIO ERROR OCCURRED DURING '
013400                     VSIO-COMMAND
013500             EXHIBIT NAMED VSIO-RETURN-CODE,
013600             EXHIBIT NAMED VSIO-VSAM-RETURN-CODE,
013700                           VSIO-VSAM-FUNCTION-CODE,
013800                           VSIO-VSAM-FEEDBACK-CODE.
013900*        END-IF
014000*    END-IF.
014100
014200     IF KR-CITY EQUAL 'DETROIT'
014300         DISPLAY KSDS-RECORD
014400         DISPLAY '          BEFORE DELETE'
014500         MOVE VSIO-DELETE TO VSIO-COMMAND
014600         CALL 'VSAMIO' USING VSIO-PARAMETER-BLOCK, KSDSF01,
014700                         KSDS-RECORD
014800*        END-CALL
014900         IF VSIO-SUCCESS
015000             DISPLAY '   DELETED  '
015100         ELSE
015200             DISPLAY 'VSAMIO ERROR OCCURRED DURING '
015300                     VSIO-COMMAND
015400             EXHIBIT NAMED VSIO-RETURN-CODE,
015500             EXHIBIT NAMED VSIO-VSAM-RETURN-CODE,
015600                           VSIO-VSAM-FUNCTION-CODE,
015700                           VSIO-VSAM-FEEDBACK-CODE.
015800*        END-IF
015900*    END-IF.
016000
016100 129-EXIT.
016200     EXIT.
016300

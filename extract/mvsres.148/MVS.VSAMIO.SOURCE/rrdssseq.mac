000100 IDENTIFICATION DIVISION.
000200 PROGRAM-ID. RRDSSSEQ.
000300 AUTHOR. JAY MOSELEY.
000400 DATE-WRITTEN. NOVEMBER, 2001.
000500 DATE-COMPILED.
000600
000700* ************************************************************* *
000800* THIS PROGRAM TESTS THE VSAMIO ROUTINE BY USING START AND READ *
000900* NEXT COMMANDS ON AN RRDS CLUSTER (SKIP-SEQ PROCESSING).       *
001000* ************************************************************* *
001100
001200 ENVIRONMENT DIVISION.
001300 CONFIGURATION SECTION.
001400 SOURCE-COMPUTER. IBM-370.
001500 OBJECT-COMPUTER. IBM-370.
001600
001700 INPUT-OUTPUT SECTION.
001800 FILE-CONTROL.
001900
002000 DATA DIVISION.
002100 FILE SECTION.
002200
002300 WORKING-STORAGE SECTION.
002400 77  END-OF-FILE-SWITCH          PIC X(1)    VALUE 'N'.
002500     88  END-OF-FILE                         VALUE 'Y'.
002600
002700 77  RECORD-COUNTER              PIC S9(8).
002800 77  COUNTER-EDIT                PIC ZZ,ZZZ,ZZ9.
002900
003000 01  VSIO-PARAMETER-VALUES       COPY VSAMIO.
003100 01  RRDSF01                     COPY VSAMIOFB.
003200 01  RRDS-RECORD                 PIC X(80).
003300
003400 PROCEDURE DIVISION.
003500
003600 000-INITIATE.
003700
003800     DISPLAY 'RRDSSSEQ: READ RRDS SEQUENTIALLY (W/START)'.
003900     DISPLAY '------------------------------------------'.
004000     DISPLAY ' '.
004100
004200     MOVE 'RRDSF01' TO VSIO-DDNAME.
004300     MOVE VSIO-RRDS TO VSIO-ORGANIZATION.
004400     MOVE VSIO-SEQUENTIAL TO VSIO-ACCESS.
004500     MOVE VSIO-INPUT TO VSIO-MODE.
004600     MOVE +80 TO VSIO-RECORD-LENGTH.
004700     MOVE VSIO-OPEN TO VSIO-COMMAND.
004800     CALL 'VSAMIO' USING VSIO-PARAMETER-BLOCK, RRDSF01,
004900                         RRDS-RECORD.
005000*    END-CALL.
005100     IF NOT VSIO-SUCCESS
005200         DISPLAY 'VSAMIO ERROR OCCURRED DURING '
005300                 VSIO-COMMAND
005400         EXHIBIT NAMED VSIO-RETURN-CODE,
005500         EXHIBIT NAMED VSIO-VSAM-RETURN-CODE,
005600                       VSIO-VSAM-FUNCTION-CODE,
005700                       VSIO-VSAM-FEEDBACK-CODE
005800         STOP RUN.
005900*    END-IF.
006000
006100 010-PROCESS.
006200
006300     PERFORM 110-PROCESS-DATA
006400        THRU 119-EXIT
006500       UNTIL END-OF-FILE.
006600*    END-PERFORM.
006700
006800 020-TERMINATE.
006900
007000     MOVE VSIO-CLOSE TO VSIO-COMMAND.
007100     CALL 'VSAMIO' USING VSIO-PARAMETER-BLOCK, RRDSF01,
007200                         RRDS-RECORD.
007300*    END-CALL.
007400     IF NOT VSIO-SUCCESS
007500         DISPLAY 'VSAMIO ERROR OCCURRED DURING '
007600                 VSIO-COMMAND
007700         EXHIBIT NAMED VSIO-RETURN-CODE,
007800         EXHIBIT NAMED VSIO-VSAM-RETURN-CODE,
007900                       VSIO-VSAM-FUNCTION-CODE,
008000                       VSIO-VSAM-FEEDBACK-CODE.
008100*    END-IF.
008200
008300     STOP RUN.
008400
008500 110-PROCESS-DATA.
008600
008700     DISPLAY 'START RRN EQUAL TO 21'.
008800     MOVE 21 TO VSIO-RELATIVE-RECORD.
008900     MOVE VSIO-START-KEY-EQUAL TO VSIO-COMMAND.
009000     PERFORM 120-START-AND-READ THRU 129-EXIT.
009100     DISPLAY 'START RRN EQUAL TO 51'.
009200     MOVE 51 TO VSIO-RELATIVE-RECORD.
009300     MOVE VSIO-START-KEY-EQUAL TO VSIO-COMMAND.
009400     PERFORM 120-START-AND-READ THRU 129-EXIT.
009500     DISPLAY 'START RRN GREATER THAN OR EQUAL TO 81'.
009600     MOVE 81 TO VSIO-RELATIVE-RECORD.
009700     MOVE VSIO-START-KEY-NOTLESS TO VSIO-COMMAND.
009800     PERFORM 120-START-AND-READ THRU 129-EXIT.
009900     DISPLAY 'START RRN GREATER THAN OR EQUAL TO 111'.
010000     MOVE 111 TO VSIO-RELATIVE-RECORD.
010100     MOVE VSIO-START-KEY-NOTLESS TO VSIO-COMMAND.
010200     PERFORM 120-START-AND-READ THRU 129-EXIT.
010300
010400     MOVE 'Y' TO END-OF-FILE-SWITCH.
010500
010600 119-EXIT.
010700     EXIT.
010800
010900 120-START-AND-READ.
011000
011100     CALL 'VSAMIO' USING VSIO-PARAMETER-BLOCK, RRDSF01,
011200                         RRDS-RECORD.
011300*    END-CALL.
011400
011500     IF NOT VSIO-SUCCESS
011600         IF VSIO-RECORD-NOT-FOUND
011700             DISPLAY '*** RECORD NOT FOUND ***'
011800         ELSE
011900             DISPLAY 'VSAMIO ERROR OCCURRED DURING '
012000                     VSIO-COMMAND
012100             EXHIBIT NAMED VSIO-RETURN-CODE,
012200             EXHIBIT NAMED VSIO-VSAM-RETURN-CODE,
012300                           VSIO-VSAM-FUNCTION-CODE,
012400                           VSIO-VSAM-FEEDBACK-CODE.
012500*        END-IF
012600*    END-IF.
012700
012800     IF NOT VSIO-SUCCESS
012900         GO TO 129-EXIT.
013000
013100     MOVE +0 TO RECORD-COUNTER.
013200     PERFORM 130-READ-AND-DISPLAY THRU 139-EXIT
013300       UNTIL END-OF-FILE
013400          OR RECORD-COUNTER > +4.
013500*    END-PERFORM.
013600     MOVE 'N' TO END-OF-FILE-SWITCH.
013700
013800 129-EXIT.
013900     EXIT.
014000
014100 130-READ-AND-DISPLAY.
014200
014300     MOVE VSIO-READ TO VSIO-COMMAND.
014400     CALL 'VSAMIO' USING VSIO-PARAMETER-BLOCK, RRDSF01,
014500                         RRDS-RECORD.
014600*    END-CALL.
014700
014800     IF VSIO-SUCCESS
014900         MOVE VSIO-RELATIVE-RECORD TO COUNTER-EDIT
015000         DISPLAY COUNTER-EDIT ': ' RRDS-RECORD
015100     ELSE
015200         IF VSIO-END-OF-FILE
015300             MOVE 'Y' TO END-OF-FILE-SWITCH
015400         ELSE
015500             DISPLAY 'VSAMIO ERROR OCCURRED DURING '
015600                     VSIO-COMMAND
015700             EXHIBIT NAMED VSIO-RETURN-CODE,
015800             EXHIBIT NAMED VSIO-VSAM-RETURN-CODE,
015900                           VSIO-VSAM-FUNCTION-CODE,
016000                           VSIO-VSAM-FEEDBACK-CODE.
016100*        END-IF
016200*    END-IF.
016300
016400     ADD +1 TO RECORD-COUNTER.
016500
016600 139-EXIT.
016700     EXIT.
016800
016900

000100 IDENTIFICATION DIVISION.
000200 PROGRAM-ID. ESDSLOAD.
000300 AUTHOR. JAY MOSELEY.
000400 DATE-WRITTEN. NOVEMBER, 2001.
000500 DATE-COMPILED.
000600
000700* ************************************************************* *
000800* THIS PROGRAM TESTS THE VSAMIO ROUTINE BY LOADING AN ESDS      *
000900* CLUSTER WITH RECORDS FROM A SEQUENTIAL DATASET.               *
001000* ************************************************************* *
001100
001200 ENVIRONMENT DIVISION.
001300 CONFIGURATION SECTION.
001400 SOURCE-COMPUTER. IBM-370.
001500 OBJECT-COMPUTER. IBM-370.
001600
001700 INPUT-OUTPUT SECTION.
001800 FILE-CONTROL.
001900
002000     SELECT RECORD-IMAGES
002100         ASSIGN TO DA-2314-S-IMAGES.
002200
002300 DATA DIVISION.
002400 FILE SECTION.
002500 FD  RECORD-IMAGES
002600     LABEL RECORDS ARE STANDARD
002700     BLOCK CONTAINS 10 RECORDS
002800     DATA RECORD IS RECORD-IMAGE.
002900
003000 01  RECORD-IMAGE                PIC X(80).
003100
003200 WORKING-STORAGE SECTION.
003300 77  END-OF-FILE-SWITCH          PIC X(1)    VALUE 'N'.
003400     88  END-OF-FILE                         VALUE 'Y'.
003500
003600 77  RECORD-COUNTER              PIC S9(8)   VALUE +0.
003700 77  COUNTER-EDIT                PIC  ZZ,ZZZ,ZZ9.
003800
003900 01  VSIO-PARAMETER-VALUES       COPY VSAMIO.
004000 01  ESDSF01                     COPY VSAMIOFB.
004100 01  ESDS-RECORD                 PIC X(80).
004200
004300 PROCEDURE DIVISION.
004400
004500 000-INITIATE.
004600
004700     DISPLAY 'ESDSLOAD: WRITE ESDS SEQUENTIALLY'.
004800     DISPLAY '---------------------------------'.
004900     DISPLAY ' '.
005000
005100     OPEN INPUT RECORD-IMAGES.
005200
005300     MOVE 'ESDSF01' TO VSIO-DDNAME.
005400     MOVE VSIO-ESDS TO VSIO-ORGANIZATION.
005500     MOVE VSIO-SEQUENTIAL TO VSIO-ACCESS.
005600     MOVE VSIO-OUTPUT TO VSIO-MODE.
005700     MOVE +80 TO VSIO-RECORD-LENGTH.
005800     MOVE +0 TO VSIO-KEY-LENGTH, VSIO-KEY-POSITION.
005900     MOVE VSIO-OPEN TO VSIO-COMMAND.
006000     CALL 'VSAMIO' USING VSIO-PARAMETER-BLOCK, ESDSF01,
006100                         ESDS-RECORD.
006200*    END-CALL.
006300     IF NOT VSIO-SUCCESS
006400         DISPLAY 'VSAMIO ERROR OCCURRED DURING '
006500                 VSIO-COMMAND
006600         EXHIBIT NAMED VSIO-RETURN-CODE,
006700         EXHIBIT NAMED VSIO-VSAM-RETURN-CODE,
006800                       VSIO-VSAM-FUNCTION-CODE,
006900                       VSIO-VSAM-FEEDBACK-CODE
007000         STOP RUN.
007100*    END-IF.
007200
007300 010-PROCESS.
007400
007500     PERFORM 110-PROCESS-DATA
007600        THRU 119-EXIT
007700       UNTIL END-OF-FILE
007800          OR (NOT VSIO-SUCCESS).
007900*    END-PERFORM.
008000
008100 020-TERMINATE.
008200
008300     CLOSE RECORD-IMAGES.
008400
008500     MOVE VSIO-CLOSE TO VSIO-COMMAND.
008600     CALL 'VSAMIO' USING VSIO-PARAMETER-BLOCK, ESDSF01,
008700                         ESDS-RECORD.
008800*    END-CALL.
008900     IF NOT VSIO-SUCCESS
009000         DISPLAY 'VSAMIO ERROR OCCURRED DURING '
009100                 VSIO-COMMAND
009200         EXHIBIT NAMED VSIO-RETURN-CODE,
009300         EXHIBIT NAMED VSIO-VSAM-RETURN-CODE,
009400                       VSIO-VSAM-FUNCTION-CODE,
009500                       VSIO-VSAM-FEEDBACK-CODE.
009600*    END-IF.
009700
009800     MOVE RECORD-COUNTER TO COUNTER-EDIT.
009900     DISPLAY COUNTER-EDIT ' RECORDS WERE LOADED SUCCESSFULLY'.
010000
010100     STOP RUN.
010200
010300 110-PROCESS-DATA.
010400     READ RECORD-IMAGES
010500         AT END
010600             MOVE 'Y' TO END-OF-FILE-SWITCH.
010700*    END-READ.
010800
010900     IF NOT END-OF-FILE
011000
011100         MOVE RECORD-IMAGE TO ESDS-RECORD
011200
011300         MOVE VSIO-WRITE TO VSIO-COMMAND
011400         CALL 'VSAMIO' USING VSIO-PARAMETER-BLOCK, ESDSF01,
011500                         ESDS-RECORD
011600*        END-CALL
011700
011800         IF VSIO-SUCCESS
011900             ADD +1 TO RECORD-COUNTER
012000         ELSE
012100             IF VSIO-LOGIC-ERROR
012200            AND VSIO-NO-MORE-SPACE
012300                DISPLAY 'INSUFFICIENT SPACE DEFINED IN CLUSTER'
012400                        'TO CONTAIN ALL RECORDS - LOADING '
012500                        'TERMINATED'
012600             ELSE
012700                 DISPLAY 'VSAMIO ERROR OCCURRED DURING '
012800                         VSIO-COMMAND
012900                 EXHIBIT NAMED VSIO-RETURN-CODE,
013000                 EXHIBIT NAMED VSIO-VSAM-RETURN-CODE,
013100                               VSIO-VSAM-FUNCTION-CODE,
013200                               VSIO-VSAM-FEEDBACK-CODE.
013300*            END-IF
013400*        END-IF
013500*    END-IF.
013600
013700 119-EXIT.
013800     EXIT.
013900
014000

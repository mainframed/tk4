         TITLE 'ILRSRT, ASM SLOT SORT                                  *
                        '
ILRSRT   CSECT ,                                                   0001
@MAINENT DS    0H                                                  0001
         USING *,@15                                               0001
         B     @PROLOG                                             0001
         DC    AL1(22)                                             0001
         DC    C'ILRSRT 78110  UZ16491 '                           0001
         DROP  @15
@PROLOG  STM   @14,@12,12(@13)                                     0001
         BALR  @08,0                                               0001
@PSTART  LA    @10,4095(,@08)                                      0001
         USING @PSTART,@08                                         0001
         USING @PSTART+4095,@10                                    0001
*   R9=R1->PTRWORK;                 /* SET SRT WORKAREA BASE         */
         L     R9,PTRWORK(,R1)                                     0111
*   GEN REFS(R9) SETS(R13,R15);                                    0112
      USING @DATD,R9
      LA    R15,SRTSA                 PUT ADDR OF MY S.A. INTO REG 15
      ST    R13,4(R15)                CHAIN BACKWARD TO CALLERS S.A.
      ST    R15,8(R13)                CHAIN FORWARD IN CALLERS S.A.
      LR    R13,R15                   PUT ADDR OF MY S.A. INTO REG 13
*   ATAPTR=R4;                      /* PICK UP ATA BASE- PTM PASSED  */
         ST    R4,ATAPTR                                           0113
*   EPAPTR=ATAEPATH;                /* RESET REG 4 TO EPATH FOR SRT  */
         L     @14,ATAPTR                                          0114
         L     EPAPTR,ATAEPATH(,@14)                               0114
*   RFY                                                            0115
*     R15 UNRSTD;                                                  0115
*                                                                  0115
*/*           P **** FRR **** INDICATE SRT IN CONTROL                */
*                                                                  0116
*   ATASRT=ON;                      /* INDICATE SRT RUNNING          */
         OI    ATASRT(@14),B'00010000'                             0116
*   PRMLADDR=R1;                    /* SAVE ADDRESS OF PARM LIST     */
         ST    R1,PRMLADDR                                         0117
*   RFY                                                            0118
*     R1 UNRSTD;                                                   0118
*                                                                  0118
*   /*****************************************************************/
*   /*                                                               */
*   /* INITIALIZE WORKING VARIABLES, ESTABLISH CONTROL BLOCK POINTERS*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0119
*/*           S INITLZ: INITLZ WORK VBLS, CONTROL BLOCK PTRS         */
*                                                                  0119
*   CALL INITLZ;                                                   0119
*                                                                  0119
         BAL   @14,INITLZ                                          0119
*/*  D (YES,,NO,%SRT20) 1 READ & NO WRITES? PARENODE                 */
*/*           P RE- COMPLIMENT ADDR TO MAKE POSITIVE                 */
*/*           P REMOVE IOE FROM QUE (PARENODE)                       */
*/*           P SETUP FOR CALL TO PROCHIT                            */
*/*  S (,%SRT60) PROCHIT: INIT & CHAIN PCCW, SAVE IOE FOR LATER FREE */
*                                                                  0120
*   IF PNODETST<0 THEN              /* SPECIAL INTERFACE FROM PTM  0120
*                                      INDICATING ONE READ AND NO  0120
*                                      WRITES?                       */
         SLR   @12,@12                                             0120
         L     @11,PAREPTR                                         0120
         L     @05,PNODETST(,@11)                                  0120
         CR    @05,@12                                             0120
         BNL   @RF00120                                            0120
*     DO;                           /* YES-                          */
*       PNODETST=ABS(PNODETST);     /* RESTORE ACTUAL ADDRESS OF READ
*                                      IOE                           */
         L     @02,PAREPTR                                         0122
         L     @02,PNODETST(,@02)                                  0122
         LPR   @02,@02                                             0122
         ST    @02,PNODETST(,@11)                                  0122
*       IOEPTR=PARENODE;            /* GET READ IOE                  */
         L     IOEPTR,PARENODE(,@11)                               0123
*       PARENODE=0;                 /* REMOVE SINGLE ELEMENT FROM  0124
*                                      TREE                          */
         SLR   @02,@02                                             0124
         ST    @02,PARENODE(,@11)                                  0124
*       AIAPTR=IOEAIA;              /* PICK UP AIA BASE              */
         L     AIAPTR,IOEAIA(,IOEPTR)                              0125
*       TSLOTNBR=AIASLOT;           /* REL SLOT NBR FOR REQUEST      */
         LH    @02,AIASLOT(,AIAPTR)                                0126
         N     @02,@CF02144                                        0126
         ST    @02,TSLOTNBR                                        0126
*       PARELCYL=AIACYL;            /* SET UP FOR CALL TO            */
         LH    @02,AIACYL(,AIAPTR)                                 0127
         STH   @02,PARELCYL(,@11)                                  0127
*       SSLOT=AIARCSN;              /* PROCHIT SUBROUTINE            */
         LH    @11,AIARCSN(,AIAPTR)                                0128
         ST    @11,SSLOT                                           0128
*       CALL PROCHIT;               /* INITIALIZE READ I/O REQUEST   */
         BAL   @14,PROCHIT                                         0129
*     END;                          /* END SPECIAL INTERFACE         */
*                                                                  0130
*   /*****************************************************************/
*   /*                                                               */
*   /* LOOP TO CHAIN REQUESTS ON THE IORB BY CYLINDER BY BEST        */
*   /* POSSIBLE SLOT POSITION WITHIN THE CYLINDER. CONTINUE CHAINING */
*   /* REQUESTS UNTIL ONE OF THE FOLLOWING CONDITIONS ARE            */
*   /* ENCOUNTERED... 1) SERVICE BURST QUOTA IS MET, 2) NO PCCWS ARE */
*   /* AVAILABLE, ---- OR ---- 3) NO MORE REQUESTS TO PROCESS,       */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0131
*/*%SRT20:    N LOOP: ONE ITERATION PROCESSES REQUESTS FOR ONE CYL   */
*/*           D (NO,,YES,%SRT60) OUT OF RESOURCES OR IOES ?          */
*                                                                  0131
*   ELSE                            /* NO- NOT SPECIAL INTERFACE FROM
*                                      PTM                           */
*     DO WHILE STOP=NO;                                            0131
*                                                                  0131
         B     @RC00120                                            0131
@RF00120 B     @DE00131                                            0131
@DL00131 DS    0H                                                  0132
*       /*************************************************************/
*       /*                                                           */
*       /* PERFORM CIRCULAR SCAN(C-SCAN) FROM THE CYLINDER LAST      */
*       /* PROCESSED IN THE PAGING DATASET TO FIND THE NEXT          */
*       /* CYLINDER... READ, WRITE, OR READ&WRITE... TO PROCESS      */
*       /* REQUESTS                                                  */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0132
*/*           S CSCANCYL: EMPLOY C-SCAN TO FIND NEXT CYL TO PROCESS  */
*                                                                  0132
*       CALL CSCANCYL;                                             0132
*                                                                  0132
         BAL   @14,CSCANCYL                                        0132
*       /*************************************************************/
*       /*                                                           */
*       /* IF A CYLINDER IS SUCCESSFULLY CHOSEN THEN PROCREQS WILL   */
*       /* BUILD AN I/O REQUEST FOR EVERY USABLE SLOT, SO LONG AS    */
*       /* RESOURCES AND SLOTS REMAIN AVAILABLE...                   */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0133
*/*           D (YES,,NO,%SRT50) CYLINDER OBTAINED ?                 */
*/*           S PROCREQS: BUILD PCCWS FOR REQUESTS ON THIS CYLINDER  */
*                                                                  0133
*       IF STOP=NO THEN                                            0133
         TM    STOP,B'10000000'                                    0133
         BNZ   @RF00133                                            0133
*         CALL PROCREQS;                                           0134
         BAL   @14,PROCREQS                                        0134
*       ELSE                                                       0135
*         ;                                                        0135
*                                                                  0135
@RF00133 DS    0H                                                  0136
*/*%SRT50:    N END CYLINDER PROCESS LOOP                            */
*                                                                  0136
*     END;                          /* END LOOP TO CHAIN I/O REQS    */
*                                                                  0136
@DE00131 TM    STOP,B'10000000'                                    0136
         BZ    @DL00131                                            0136
*   /*****************************************************************/
*   /*                                                               */
*   /* PCCWS TO READ OR WRITE PAGES ALL CHAINED UP ????... THEN      */
*   /* FINISH UP THE I/O REQUEST CHAIN AND INVOKE IOS TO PERFORM THE */
*   /* I/O                                                           */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0137
*/*%SRT60:    S IO: COMPLETE I/O REQUEST CHAIN, STARTIO              */
*                                                                  0137
*   CALL IO;                                                       0137
*                                                                  0137
@RC00120 BAL   @14,IO                                              0137
*   /*****************************************************************/
*   /*                                                               */
*   /* PERFORM NECESSARY CLEAN UP FUNCTIONS BEFORE RETURNING TO THE  */
*   /* CALLER                                                        */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0138
*/*           S CLEANUP: MISC CLEAN UP FUNCTIONS                     */
*                                                                  0138
*   CALL CLEANUP;                                                  0138
         BAL   @14,CLEANUP                                         0138
*   ATASRT=OFF;                     /* RESET SRT IN PROCESS FLAG     */
         L     @12,ATAPTR                                          0139
         NI    ATASRT(@12),B'11101111'                             0139
*/* REG 4 WHICH WAS CHANGED BY SRT TO BE EPATH PTR INSTEAD OF ATA  0140
*    PTR WILL BE RESTORED FOR PTM BEFORE RETURN BY LM ON EXIT.       */
*/*          R RETURN TO CALLER                                      */
*                                                                  0140
*   RETURN;                                                        0140
*                                                                  0140
@EL00001 DS    0H                                                  0140
@EF00001 DS    0H                                                  0140
@ER00001 LM    @14,@12,12(@13)                                     0140
         BR    @14                                                 0140
*/*ILRSRT:  END                                                      */
*                                                                  0141
*                                                                  0141
*/*INITLZ: CHART                                                     */
*/* HEADING                                                        0141
*/* ILRSRT - ASM SLOT SORT                                         0141
*/*                    ILRSRT INITIALIZATION                         */
*/********************************************************************/
*/*                                                                  */
*/*      INITLZ: ILRSRT INITIALIZATION                               */
*/*                                                                  */
*/*      INPUT: INPUT PARAMETER LIST FROM ILRPTM                     */
*/*                                                                  */
*/*      PROCESS: VARIOUS VALUES USED THROUGHOUT SLOT SORT ARE       */
*/*               OBTAINED AND/OR COMPUTED.  WORK VARIABLES ARE      */
*/*               INITIALIZED.                                       */
*/*                                                                  */
*/*      OUTPUT: PART CYLINDER MAP INFORMATION                       */
*/*              ADDR OF PART ENTRY                                  */
*/*              ADDR OF APPROPRIATE DEVICE DEPENDENT FINDSLOT       */
*/*               ROUTINE                                            */
*/*              ZERO WORK VARIABLES                                 */
*/*              COMPUTED SERVICE BURST REQUEST QUOTA                */
*/*                                                                  */
*/*                                                                  */
*/********************************************************************/
*/*INITLZ:   E ILRSRT INITIALIZATION                                 */
*                                                                  0141
*INITLZ:                                                           0141
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0141
INITLZ   DS    0H                                                  0142
*   RFY                                                            0142
*     R14 RSTD;                     /* RESTRICT RETURN REG           */
*/*           M OBTAIN ADDRESS OF PART ENTRY FROM INPUT PARM LIST    */
*                                                                  0143
*   PAREPTR=PTRPARE;                /* ADDR OF PART ENTRY            */
         L     @15,PRMLADDR                                        0143
         L     @12,PTRPARE(,@15)                                   0143
         ST    @12,PAREPTR                                         0143
*   WRITEQUE=PTRWRITE;              /* SET UP WRITE QUEUE PTR        */
         L     @15,PTRWRITE(,@15)                                  0144
         ST    @15,WRITEQUE                                        0144
*   RESPECIFY                                                      0145
*     PAT BASED(PAREPATP);                                         0145
*                                                                  0145
*/*           M GET PAT DATA: MAP ADDR, WORDS/ CYL-MAP, SLOTS/CYL    */
*                                                                  0146
*   CYLMPWDS=PATCYLMW;              /* NBR WORDS/PER PAT CYL MAP     */
         L     @15,PAREPATP(,@12)                                  0146
         LH    @11,PATCYLMW(,@15)                                  0146
         ST    @11,CYLMPWDS                                        0146
*   CYLSLOTS=PATCYLSZ;              /* NBR SLOTS PER CYLINDER        */
*                                                                  0147
         LH    @15,PATCYLSZ(,@15)                                  0147
         ST    @15,CYLSLOTS                                        0147
*   /*****************************************************************/
*   /*                                                               */
*   /* DETERMINE DEVICE-DEPENDENT FINDSLOT ROUTINE ADDRESS USING THE */
*   /* LAST BYTE OF THE HEX DEVICE TYPE CODE AS AN INDEX INTO AN     */
*   /* ADDRESS TABLE                                                 */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0148
*   RESPECIFY                                                      0148
*     PCT BASED(PAREPCTP);                                         0148
*                                                                  0148
*/*           M GET DEV DEPENDENT FINDSLOT RTN ADDR                  */
*/*           N USE HEX DEVTYPE CODE AS INDEX INTO ADDRESS TABLE     */
*                                                                  0149
*   FSRTNPTR=DEVDFSRT(DEVDTABX);    /* GET DEVICE-DEPENDENT        0149
*                                      ADDRESS-TABLE ENTRY           */
         L     @15,PAREPCTP(,@12)                                  0149
         SLR   @11,@11                                             0149
         IC    @11,DEVDTABX(,@15)                                  0149
         SLA   @11,2                                               0149
         L     @15,DEVDFSRT-4(@11)                                 0149
         ST    @15,FSRTNPTR                                        0149
*/*           N ZERO VARIOUS WORK VARIABLES                          */
*/*           M ZERO LAST CHOSEN SLOT NBR IN FINDSLOT PARM LIST      */
*/*           M INITLZ ALL SLOT FLAGS OFF IN FINDSLOT PARM LIST      */
*/*           M ZERO READ CYL VAL (MEANS READ CYL TO BE FOUND)       */
*/*           M INITLZ ALL INTERNAL FLAGS OFF                        */
*/*           M ZERO RETURN CODE                                     */
*                                                                  0150
*   ZEROLIST=''B;                   /* ZERO WORK VARIABLES           */
*                                                                  0150
         XC    ZEROLIST(58),ZEROLIST                               0150
*   /*****************************************************************/
*   /*                                                               */
*   /* COMPUTE THE NUMBER OF REQUESTS THAT CAN BE PROCESSED IN ONE   */
*   /* SERVICE BURST FOR THIS DEVICE.                                */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0151
*/*%INI30:    P COMPUTE NUMBER OF POTENTIAL REQUESTS TO PROCESS      */
*                                                                  0151
*   REQNEED=TWO+ASMBURST/PARERQTM;                                 0151
*                                                                  0151
         L     @00,ASMBURST(,ASMVTPTR)                             0151
         SRDA  @00,32                                              0151
         D     @00,PARERQTM(,@12)                                  0151
         AL    @01,@CF00084                                        0151
         ST    @01,REQNEED                                         0151
*/*           R RETURN                                               */
*                                                                  0152
*   RFY                                                            0152
*     R14 UNRSTD;                   /* RELEASE RETURN REG            */
*   END INITLZ;                     /* END OF SUBROUTINE INITLZ      */
@EL00002 DS    0H                                                  0153
@EF00002 DS    0H                                                  0153
@ER00002 BR    @14                                                 0153
*/*INITLZ:   END                                                     */
*                                                                  0154
*                                                                  0154
*/*SORTTREE:   CHART (FMODE)                                         */
*/* HEADING                                                        0154
*/* ILRSRT - ASM SLOT SORT                                         0154
*/*         READ REQUEST TREE STRUCTURE DIAGRAM                      */
*/*A1 COMMENT (15,50)           THE DIAGRAM BELOW SHOWS THE          */
*/*   COMMENT (16,45)      --READ REQUEST TREE SORT STRUCTURE--      */
*/*                                                                  */
*/*   COMMENT (26,20) REQUESTS (IOES) SORTED BY THE                  */
*/*   COMMENT (27,20) RELATIVE SLOT NUMBER STORED IN                 */
*/*   COMMENT (28,20) THE AIA ADDRESSED FROM THE IOE                 */
*/*                                                                  */
*/*   COMMENT (21,30)  PART ENTRY                                    */
*/*   COMMENT (22,35)       +-----+--  ---  --+--------+-----+       */
*/*   COMMENT (23,35)       ×     ×    ...    ×PARENODE×     ×       */
*/*   COMMENT (24,35)       +-----+--  ---  --+--------+-----+       */
*/*                                            /                     */
*/*                                          /                       */
*/*                                        /                         */
*/*                                      /                           */
*/*                                    /                             */
*/*                                  /                               */
*/*                                /                                 */
*/*                              /                                   */
*/*   COMMENT (25,57)           ×                                    */
*/*   COMMENT (26,57)           ×                                    */
*/*   COMMENT (27,57)           ×                                    */
*/*   COMMENT (28,57)           +---->+-------+                      */
*/*   COMMENT (29,60)              +- × ERL   ×                      */
*/*   COMMENT (30,60)              ×  ×       ×                      */
*/*   COMMENT (31,51)     LE (<=)  ×  ×       × -+  GT (>)           */
*/*   COMMENT (32,53)       LEG    ×  +-------+  ×   LEG             */
*/*   COMMENT (33,60)              ×             ×                   */
*/*   COMMENT (34,60)              ×             ×                   */
*/*   COMMENT (35,48)  +-------+<--+             +-->+-------+       */
*/*   COMMENT (36,48)  × SGC   ×                  +- × AWN   ×       */
*/*   COMMENT (37,48)  ×       ×                  ×  ×       ×       */
*/*   COMMENT (38,48)  ×       × -+            LE ×  ×       × -+    */
*/*   COMMENT (39,48)  +-------+  × GT            ×  +-------+  × GT */
*/*   COMMENT (40,59)             ×               ×             ×    */
*/*   COMMENT (41,59)             V               V             V    */
*/*   COMMENT (42,55)         +-------+      +-------+      +-------+*/
*/*   COMMENT (43,55)         × ETC   ×      × ETAL  ×      × VEJH  ×*/
*/*   COMMENT (44,55)         ×       ×      ×       ×      ×       ×*/
*/*   COMMENT (45,55)         ×       ×      ×       ×      ×       ×*/
*/*   COMMENT (46,55)         +-------+      +-------+      +-------+*/
*/*                                                                  */
*/*                                                                  */
*/*   COMMENT (52,20) CLOSE-UP OF A TYPICAL NODE (READ IOE)          */
*/*                                                                  */
*/*   COMMENT (55,21)  0 +-----------------+                         */
*/*   COMMENT (56,23)    × IOENXTLE        × LE LEG NODE ADDRESS     */
*/*   COMMENT (57,21)  4 +-----------------+                         */
*/*   COMMENT (58,23)    × IOENXTGT        × GT LEG NODE ADDRESS     */
*/*   COMMENT (59,21)  8 +-----------------+                         */
*/*   COMMENT (60,23)    × IOEAIA          × PTR TO AIA              */
*/*   COMMENT (61,20) 12 +-----------------+                         */
*/*   COMMENT (62,23)    × IOEBKPTR        × BACKCHAIN NODE ADDRESS  */
*/*   COMMENT (63,23)    +-----------------+                         */
*/*SORTTREE:  END                                                    */
*                                                                  0154
*                                                                  0154
*/*CSCANCYL: CHART                                                   */
*/* HEADING                                                        0154
*/* ILRSRT - ASM SLOT SORT                  CSCANCYL: FIND NEXT US 0154
*/*ABLE CYLINDER FROM LAST USED CYLINDER (CIRCULAR SCAN)             */
*/********************************************************************/
*/*                                                                  */
*/*      CSCANCYL:  EMPLOY CIRCULAR-SCAN TECHNIQUE TO FIND           */
*/*                  NEXT USABLE CYLINDER FROM LAST USED CYLINDER    */
*/*                                                                  */
*/*      INPUT: PAT                                                  */
*/*             PART ENTRY                                           */
*/*             CURRENT READ CYL VALUE - PRESET BY INITLZ TO ZERO    */
*/*                                                                  */
*/*      PROCESS: THE FOLLOWING DONE UP TO 2 TIMES. ONCE FOR EACH    */
*/*               SCAN DESCRIBED IN THE OBJECT PARAGRAPH ABOVE.      */
*/*                                                                  */
*/*               IF NO READS EXIST FOR THE PAGING SPACE THEN SCAN   */
*/*               FOR A POTENTIAL WRITE CYLINDER FROM THE CURRENTLY  */
*/*               DEFINED STARTING POINT (CYL ZERO OR LAST USED CYL  */
*/*               VALUE) TO THE CURRENTLY DEFINED END POINT (CYL N+1 */
*/*               WHERE N IS THE LAST CYLINDER IN THE PAGING SPACE   */
*/*               OR THE PREVIOUS SCANS STARTING POINT)              */
*/*                                                                  */
*/*               IF AT LEAST ONE READ REQUEST EXISTS THEN FIND THE  */
*/*               NEAREST "READ" CYLINDER TO CURRENTLY DEFINED START-*/
*/*               ING POINT IF NOT ALREADY PREVIOUSLY FOUND.  IF ONE */
*/*               EXISTS BETWEEN THE CURRENT STARTING AND ENDING     */
*/*               POINTS REDEFINE THE CURRENT ENDING POINT TO        */
*/*               THIS CYLINDER VALUE. IN ANY EVENT IF WRITES EXIST, */
*/*               SCAN FOR A 'WRITE' CYLINDER BETWEEN THE CURRENT    */
*/*               STARTING POINT AND ENDING POINTS.                  */
*/*               IF NO CYLINDER IS FOUND THEN THE DATA SET FULL     */
*/*               CONDITION IS SET AND SLOT SORT PROCESSING CEASES.  */
*/*                                                                  */
*/*               IF A CYLINDER IS CHOSEN AND IT HAS READ REQUESTS   */
*/*               FOR IT THEN A CYLINDER MAP MASK IS BUILT WITH A BIT*/
*/*               SET ON FOR EACH READ REQUEST ON THE CYLINDER.      */
*/*                                                                  */
*/*      OUTPUT: -NUMBER OF CYLINDER TO PROCESS (IF FOUND)           */
*/*              -READ CYLINDER VALUE SET (IF FOUND)                 */
*/*              -CYLINDER MAP READ MASK BUILT (IF READ CYLINDER     */
*/*               CHOSEN TO PROCESS)                                 */
*/*              -DATA SET FULL RETURN CODE IF NO CYLINDER FOUND     */
*/*              -INDICATION TO STOP PROCESSING REQUESTS IF NO       */
*/*               CYLINDER FOUND                                     */
*/*                                                                  */
*/*                                                                  */
*/********************************************************************/
*/*CSCANCYL: E  C-SCAN FOR NEXT USABLE CYLINDER                      */
*                                                                  0154
*CSCANCYL:                                                         0154
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0154
CSCANCYL DS    0H                                                  0155
*   RFY                                                            0155
*     R14 RSTD;                                                    0155
*   RETADDR1=R14;                   /* SAVE RETURN ADDR              */
         ST    R14,RETADDR1                                        0156
*   RFY                                                            0157
*     R14 UNRSTD;                                                  0157
*                                                                  0157
*   /*****************************************************************/
*   /*                                                               */
*   /* EACH TIME CSCANCYL IS INVOKED, IT IS TO FIND A CYLINDER ON    */
*   /* WHICH I/O REQUESTS CAN BE MADE. THE FIRST THING TO DO THEN,   */
*   /* NATURALLY, IS TO INITIALIZE ANY VARIABLES ASSOCIATED WITH     */
*   /* PROCESSING A SPECIFIC CYLINDER                                */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0158
*/*           M ZERO THE READ CYLINDER MAP MASK                      */
*                                                                  0158
*   SCYLREAD=''B;                   /* ZERO READ CYLINDER MAP MASK   */
         XC    SCYLREAD(8),SCYLREAD                                0158
*   EPAWTPAT=ADDR(SCYLWRT);         /* SET FOR RECOVERY              */
*                                                                  0159
         LA    @12,SCYLWRT                                         0159
         ST    @12,EPAWTPAT(,EPAPTR)                               0159
*   /*****************************************************************/
*   /*                                                               */
*   /* NEXT WE WANT TO LOOP UP TO TWO TIMES IN OUR ATTEMPT TO FIND A */
*   /* CYLINDER FOR I/O. ONCE TO FIND A CYLINDER BETWEEN WHERE WE    */
*   /* LAST LEFT OFF AND THE END OF THE PAGING SPACE. IF THAT ATTEMPT*/
*   /* FAILS, THEN ONCE AGAIN BETWEEN THE BEGINNING OF THE PAGING    */
*   /* SPACE AND OUR PREVIOUS STARTING POINT.                        */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0160
*/*           N LOOP UNTIL CYL FOUND OR NO I/O POSSIBLE DETERMINED   */
*/*           M PRESET END POINT OF SCAN PAST END OF PAGING SPACE    */
*                                                                  0160
*   ENDCYL=PATCYLNO;                /* PRESET END CYL NBR PAST END OF
*                                      DATA SET                      */
         L     @12,PAREPTR                                         0160
         L     @11,PAREPATP(,@12)                                  0160
         LH    @11,PATCYLNO(,@11)                                  0160
         ST    @11,ENDCYL                                          0160
*/*           M PRESET START POINT AT LAST PROCESSED CYLINDER        */
*                                                                  0161
*   STRTCYL=PARELCYL;               /* REMEMBER LAST CYL USED AS   0161
*                                      CSCAN STARTING POINTING       */
         LH    STRTCYL,PARELCYL(,@12)                              0161
*/*           M PRESET GOTCHA CYL VALUE AS LOOP CTL                  */
*                                                                  0162
*   THISCYL=ENDCYL;                 /* INITLZ WORK CYL NBR VBL       */
         ST    @11,THISCYL                                         0162
*/*%CSN10:    D (YES,,NO,%CSN90) CYL FOUND OR NO POSSIBLE I/O ?      */
*                                                                  0163
*   DO WHILE THISCYL=ENDCYL;                                       0163
*                                                                  0163
         B     @DE00163                                            0163
@DL00163 DS    0H                                                  0164
*     /***************************************************************/
*     /*                                                             */
*     /* IF READ REQUESTS EXIST THEN FIRST FIND A CYLINDER FOR SOME  */
*     /* READS, THEN SEE IF A CYLINDER FOR WRITES EXISTS BETWEEN THE */
*     /* STARTING POINT OF THE SCAN AND THE READ CYLINDER            */
*     /*                                                             */
*     /***************************************************************/
*                                                                  0164
*/*           D (YES,,NO,%CSN40) READ REQUESTS EXIST ?               */
*                                                                  0164
*     IF PARENODE^=ZERO THEN        /* ANY READS ON TREE ?           */
         SLR   @12,@12                                             0164
         L     @11,PAREPTR                                         0164
         C     @12,PARENODE(,@11)                                  0164
         BE    @RF00164                                            0164
*       DO;                                                        0165
*                                                                  0165
*         /***********************************************************/
*         /*                                                         */
*         /* IF THIS IS THE FIRST TIME TO CSCANCYL FOR THIS EXECUTION*/
*         /* OF SLOT-SORT OR IF A NEW READ CYL MUST BE DETERMINED    */
*         /* THEN ATTEMPT TO FIND A READ CYLINDER IN THE PAGING SPACE*/
*         /* BETWEEN THE CYLINDERS DEFINED BY STRTCYL & ENDCYL       */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0166
*/*           D (YES,,NO,%CSN15) OBTAIN NEW READ CYL ?               */
*/*           S GETRDCYL: FIND READ CYL IN PRESET SCAN AREA          */
*                                                                  0166
*         IF READCYL=ZERO THEN      /* MUST A NEW READ CYL BE FOUND  */
         C     @12,READCYL                                         0166
         BNE   @RF00166                                            0166
*           CALL GETRDCYL;                                         0167
         BAL   @14,GETRDCYL                                        0167
*         ELSE                                                     0168
*                                                                  0168
*           /*********************************************************/
*           /*                                                       */
*           /* IF A READ CYLINDER HAS ALREADY BEEN FOUND THEN RESET  */
*           /* CYL NUMBER VALUE IDENTIFYING THE CYLINDER TO PROCESS  */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0168
*/*%CSN15:   N READ CYLINDER ALREADY KNOWN ?                         */
*/*          P RESET PROCESS CYL VALUE                               */
*                                                                  0168
*           THISCYL=READCYL;                                       0168
*                                                                  0168
         B     @RC00166                                            0168
@RF00166 L     @12,READCYL                                         0168
         ST    @12,THISCYL                                         0168
*         /***********************************************************/
*         /*                                                         */
*         /* IF NO READ CYLINDER WAS FOUND, OR IF ONE WAS FOUND AND  */
*         /* IT IS NOT THE SAME AS THE STARTING POINT VALUE ---AND---*/
*         /* WRITE REQUESTS ARE POSSIBLE FOR THIS PAGING SPACE, THEN */
*         /* SEE IF A WRITE CYLINDER EXISTS BETWEEN THE LAST         */
*         /* PROCESSED CYLINDER AND THE CURRENT RECOGNIZED END       */
*         /* CYLINDER                                                */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0169
*/*%CSN20:    D (NO,,YES,%CSN30) GOTCHA CYL = LAST USED CYL ?        */
*/*           D (YES,,NO,%CSN30) WRITE REQS OK FOR PGG SPACE ?       */
*/*           N SCAN FROM START POINT TO END POINT TO FIND CYL     0169
*/*             FOR WRITE REQS                                       */
*/*           S GETWCYL: SCAN FOR WRITE CYLINDER                     */
*                                                                  0169
*         IF THISCYL^=STRTCYL THEN                                 0169
@RC00166 C     STRTCYL,THISCYL                                     0169
         BE    @RF00169                                            0169
*           IF WRITEQUE^=ZERO THEN  /* WRITES EXIST                  */
         L     @12,WRITEQUE                                        0170
         LTR   @12,@12                                             0170
         BZ    @RF00170                                            0170
*             CALL GETWCYL;         /* TRY TO FIND WRITE CYL         */
         BAL   @14,GETWCYL                                         0171
*           ELSE                                                   0172
*             ;                                                    0172
@RF00170 DS    0H                                                  0173
*         ELSE                                                     0173
*           ;                                                      0173
*                                                                  0173
@RF00169 DS    0H                                                  0174
*         /***********************************************************/
*         /*                                                         */
*         /* IF THE READ CYLINDER EXISTS AND IS SELECTED, THEN BUILD */
*         /* A READ-MASK FOR IT...                                   */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0174
*/*%CSN30:    D (NO,,YES,%CSN60) READ CYL FOUND & SELECTED ?         */
*/*           S BRDMASK: BUILD THE READ CYL MAP MASK                 */
*/*           P (,%CSN60) INDICATE NEW READ CYL MUST BE FOUND        */
*                                                                  0174
*         IF THISCYL=READCYL THEN                                  0174
         CLC   THISCYL(4),READCYL                                  0174
         BNE   @RF00174                                            0174
*           DO;                                                    0175
*             CALL BRDMASK;         /* BUILD THE READ MASK           */
         BAL   @14,BRDMASK                                         0176
*             READCYL=ZERO;         /* INDICATE NEW READ CYL MUST BE
*                                      FOUND                         */
         SLR   @12,@12                                             0177
         ST    @12,READCYL                                         0177
*           END;                                                   0178
*         ELSE                                                     0179
*           ;                                                      0179
@RF00174 DS    0H                                                  0180
*       END;                        /* END READS EXIST ON TREE       */
*     ELSE                                                         0181
*                                                                  0181
*       /*************************************************************/
*       /*                                                           */
*       /* NO READS ON THE TREE ?... THEN FIND THE NEXT WRITE        */
*       /* CYLINDER                                                  */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0181
*/*%CSN40:    S GETWCYL: TRY TO FIND CYL FOR WRITES                  */
*                                                                  0181
*       CALL GETWCYL;                                              0181
*                                                                  0181
         B     @RC00164                                            0181
@RF00164 BAL   @14,GETWCYL                                         0181
*     /***************************************************************/
*     /*                                                             */
*     /* IF NO AVAILABLE CYLINDERS BETWEEN CYLINDER LAST PROCESSED   */
*     /* AND THE END OF THE PAGING SPACE, THEN TRY FROM THE START OF */
*     /* THE PAGING SPACE                                            */
*     /*                                                             */
*     /***************************************************************/
*                                                                  0182
*/*%CSN60:    D (NO,,YES,%CSN80) CYLINDER FOUND                      */
*/*           D (NO,,YES,%CSN70) ENTIRE PGG SPACE SCANNED ?          */
*/*           P RESET END POINT TO PREVIOUS START POINT              */
*/*           P (,%CSN80) RESET START POINT TO START OF PAGING SPACE */
*                                                                  0182
*     IF THISCYL=ENDCYL THEN        /* NO CYLINDER FOUND ?           */
@RC00164 CLC   THISCYL(4),ENDCYL                                   0182
         BNE   @RF00182                                            0182
*       IF STRTCYL^=ZERO THEN       /* NOT YET CHECKED FROM START OF
*                                      PAGING SPACE                  */
         LTR   STRTCYL,STRTCYL                                     0183
         BZ    @RF00183                                            0183
*         DO;                                                      0184
*           ENDCYL=STRTCYL;         /* RESET END POINT               */
         ST    STRTCYL,ENDCYL                                      0185
*           THISCYL=STRTCYL;        /* RESET PROCESS CYL VALUE       */
         ST    STRTCYL,THISCYL                                     0186
*           STRTCYL=ZERO;           /* RESET START POINT             */
         SLR   STRTCYL,STRTCYL                                     0187
*         END;                                                     0188
*       ELSE                        /* NO CYLINDERS AVAILABLE        */
*                                                                  0189
*         /***********************************************************/
*         /*                                                         */
*         /* IF NO CYLINDER HAS BEEN SELECTED AND THE ENTIRE PAGING  */
*         /* SPACE HAS BEEN SCANNED, THEN IT IS ASSUMED THE PAGING   */
*         /* SPACE IS FULL AND NO READS EXIST. THEREFORE, I/O REQUEST*/
*         /* (PCCW) BUILDING MUST CEASE                              */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0189
*/*%CSN70:    P SET FLAG TO STOP PROCESSING REQUESTS                 */
*/*           P 'OR' DS FULL CODE INTO RETURN CODE FIELD             */
*                                                                  0189
*         DO;                                                      0189
         B     @RC00183                                            0189
@RF00183 DS    0H                                                  0190
*           STOP=YES;               /* INDICATE TIME TO CUT OUT      */
         OI    STOP,B'10000000'                                    0190
*           RETCODE=RETCODE×IOFULL; /* OR IN DS FULL CODE            */
         L     @12,RETCODE                                         0191
         O     @12,@CF00032                                        0191
         ST    @12,RETCODE                                         0191
*           THISCYL=ZERO;           /* GET OUT OF LOOP               */
         SLR   @12,@12                                             0192
         ST    @12,THISCYL                                         0192
*         END;                                                     0193
*     ELSE                                                         0194
*       ;                                                          0194
*                                                                  0194
@RF00182 DS    0H                                                  0195
*/*%CSN80:    N (,%CSN10) END LOOP TO GET CYL FOR I/O REQS           */
*                                                                  0195
*   END;                            /* END LOOP TO FIND CYLINDER TO
*                                      PROCESS                       */
@RC00182 DS    0H                                                  0195
@DE00163 CLC   THISCYL(4),ENDCYL                                   0195
         BE    @DL00163                                            0195
*/*%CSN90:    R RETURN                                               */
*                                                                  0196
*   RFY                                                            0196
*     R14 RSTD;                                                    0196
*   R14=RETADDR1;                   /* RESTORE RETURN ADDRESS        */
         L     R14,RETADDR1                                        0197
*   RFY                                                            0198
*     R14 UNRSTD;                                                  0198
*   END CSCANCYL;                   /* END SUBROUTINE CSCANCYL       */
@EL00003 DS    0H                                                  0199
@EF00003 DS    0H                                                  0199
@ER00003 BR    @14                                                 0199
*/*CSCANCYL: END                                                     */
*                                                                  0200
*                                                                  0200
*/*GETRDCYL: CHART                                                   */
*/* HEADING                                                        0200
*/* ILRSRT - ASM SLOT SORT                                         0200
*/*GETRDCYL:  FIND NEXT READ CYLINDER FROM LAST PROCESSED            */
*/********************************************************************/
*/*                                                                  */
*/*      GETRDCYL:  FIND NEXT READ CYLINDER FROM LAST PROCESSED      */
*/*                                                                  */
*/*      INPUT: LAST PROCESSED CYLINDER VALUE (STARTING POINT OF     */
*/*               SCAN)                                              */
*/*             PART ENTRY                                           */
*/*             CURRENT CYLINDER TO PROCESS VALUE (PRESET HIGH)      */
*/*                                                                  */
*/*      PROCESS: THE TREE IS EXAMINED, MOVING DOWN ONE NODE AT A    */
*/*               TIME ALONG THE APPROPRIATE LEG (THIS TIME KEYING ON*/
*/*               THE CYLINDER VALUE ASSOCIATED WITH EACH IOE IN THE */
*/*               AIA) IN SEARCH OF ONE OR MORE IOES REPRESENTING    */
*/*               REQUESTS FOR THE NEAREST CYLINDER FORM THE LAST    */
*/*               USED CYLINDER (CURRENT C-SCAN STARTING POINT)      */
*/*                                                                  */
*/*               WHENEVER AN IOE IS FOUND FOR A UNIQUE CYLINDER     */
*/*               BETWEEN TWO CURRENT C-SCAN END POINTS ITS ADDRESS  */
*/*               AMD ASSOCIATED CYLINDER VALUE IS SAVED AND PROCESS-*/
*/*               ING CONTINUES TO FIND AN IOE FOR A CYLINDER NEARER */
*/*               YET TO THE C-SCAN STARTING POINT. THE SERACH       */
*/*               TERMINATES WHEN THE LEG OF THE TREE IT IS SCANNING */
*/*               ENDS OR WHEN AN IOE IS FOUND REPRESENTING A REQUEST*/
*/*               FOR THE SAME CYLINDER AS THE CURRENT C-SCAN START- */
*/*               ING POINT. IF NO READ CYLINDER IS FOUND BETWEEN THE*/
*/*               CURRENT C-SCAN END POINTS, NO C-SCAN WORK VARIABLES*/
*/*               ARE ALTERED.                                       */
*/*                                                                  */
*/*      OUTPUT: IF READ CYLINDER IS FOUND-                          */
*/*                -ADDRESS OF FIRST IOE ENCOUNTERED REPRESENTING    */
*/*                 A REQUEST ON THE READ CYLINDER                   */
*/*                -READ CYLINDER VALUE SET                          */
*/*                -CURRENT CYLINDER TO PROCESS VALUE RESET (THIS    */
*/*                 VALUE ALSO REPRESENTS THE CURRENT C-SCAN ENDING  */
*/*                 POINT)                                           */
*/*                                                                  */
*/*                                                                  */
*/********************************************************************/
*/*GETRDCYL:  E FIND NEXT READ CYL FROM LAST USED                    */
*                                                                  0200
*GETRDCYL:                                                         0200
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0200
GETRDCYL DS    0H                                                  0201
*   RFY                                                            0201
*     R14 RSTD;                     /* RESTRICT RETURN REG           */
*                                                                  0201
*   /*****************************************************************/
*   /*                                                               */
*   /* THE OBJECT OF THIS SUBROUTINE IS TO START AT THE TOP OF THE   */
*   /* READ REQUEST TREE AND FIND THE NEAREST CYLINDER GREATER THAN  */
*   /* OR EQUAL THE SCAN START POINT VALUE FOR WHICH A READ REQUEST  */
*   /* NODE EXISTS --------------------------------------------- TO  */
*   /* START AT THE TOP OF THE TREE... REMEMBER TOP NODE ADDRESS AS  */
*   /* POTENTIAL TOP 'READ' CYLINDER NODE                            */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0202
*/*           M SET UP TO SCAN DOWN TREE                             */
*/*           P SAVE TOP NODE ADDR AS POTENTIAL READ CYL NODE ADDR   */
*/*           M PRESET WORK CYL VALUE VERY LARGE                     */
*                                                                  0202
*   THISNODE=PARENODE;              /* GET FIRST NODE OF TREE        */
         L     @15,PAREPTR                                         0202
         L     THISNODE,PARENODE(,@15)                             0202
*   TOPRDIOE=THISNODE;              /* PRESET TOP NODE FOR READS FROM
*                                      A SPECIFIC CYLINDER           */
*                                                                  0203
         ST    THISNODE,TOPRDIOE                                   0203
*   /*****************************************************************/
*   /*                                                               */
*   /* MOVE DOWN TREE ATTEMPTING TO FIND A READ REQUEST ON THE       */
*   /* NEAREST HIGHER NUMBERED CYLINDER FROM THE LAST PROCESSED      */
*   /* (INCLUDING THE LAST PROCESSED).                               */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0204
*/*           N LOOP, MOVING DOWN TREE ONE NODE WITH EACH ITERATION  */
*/*%GRC10:    D (YES,,NO,%GRC90) YET ANOTHER NODE ?                  */
*                                                                  0204
*   DO WHILE THISNODE^=ZERO;                                       0204
*                                                                  0204
         B     @DE00204                                            0204
@DL00204 DS    0H                                                  0205
*     /***************************************************************/
*     /*                                                             */
*     /* IF CURRENT NODE (IOE) IS FOR A READ FROM A CYLINDER LOWER   */
*     /* NUMBERED THAN THE LAST PROCESSED CYLINDER, THEN MOVE DOWN   */
*     /* THE GREATER-THAN (GT) LEG OF THE TREE                       */
*     /*                                                             */
*     /***************************************************************/
*                                                                  0205
*/*           D (YES,,NO,%GRC20) THIS REQ CYL < START POINT ?        */
*/*           P (,%GRC80) MOVE DOWN GT LEG ONE NODE                  */
*                                                                  0205
*     IF STRTCYL>THISNODE->IOEAIA->AIACYL THEN                     0205
         L     @15,IOEAIA(,THISNODE)                               0205
         CH    STRTCYL,AIACYL(,@15)                                0205
         BNH   @RF00205                                            0205
*       THISNODE=THISNODE->IOENXTGT;                               0206
         L     THISNODE,IOENXTGT(,THISNODE)                        0206
*     ELSE                                                         0207
*                                                                  0207
*       /*************************************************************/
*       /*                                                           */
*       /* IF THE CURRENT NODE IS FOR A READ FROM A CYLINDER HIGHER  */
*       /* NUMBERED THAN THE LAST PROCESSED CYLINDER BUT LOWER THAN  */
*       /* THE CURRENT NEAREST CYLINDER, THEN RESET THE CURRENT      */
*       /* NEAREST VALUES TO THIS CYLINDER AND THIS NODE...          */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0207
*/*%GRC20:    D (YES,,NO,%GRC40) THIS REQ CYL NEAREST SO FAR ?       */
*/*           P SAVE CYL VALUE AS NEAREST SO FAR                     */
*/*           P SAVE NODE ADDR AS POTENTIAL READ CYL NODE ADDR       */
*                                                                  0207
*       IF THISCYL>THISNODE->IOEAIA->AIACYL THEN                   0207
         B     @RC00205                                            0207
@RF00205 L     @15,IOEAIA(,THISNODE)                               0207
         LH    @15,AIACYL(,@15)                                    0207
         C     @15,THISCYL                                         0207
         BNL   @RF00207                                            0207
*         DO;                                                      0208
*           THISCYL=THISNODE->IOEAIA->AIACYL;/* RESET NEAREST CYL VAL*/
         ST    @15,THISCYL                                         0209
*           TOPRDIOE=THISNODE;                                     0210
*                                                                  0210
         ST    THISNODE,TOPRDIOE                                   0210
*/*           P SAVE POTENTIAL READ CYL VALUE                        */
*                                                                  0211
*           READCYL=THISCYL;                                       0211
*                                                                  0211
         ST    @15,READCYL                                         0211
*           /*********************************************************/
*           /*                                                       */
*           /* IF THE NEW CYLINDER VALUE EQUALS THE LAST PROCESSED   */
*           /* VALUE THEN SET UP TO GET OUT OF LOOP IMMEDIATELY      */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0212
*/*           D (YES,,NO,%GRC30) THIS CYL = START POINT ?            */
*/*           P (,%GRC80) INDICATE NO MORE NODES TO SCAN             */
*                                                                  0212
*           IF THISCYL=STRTCYL THEN                                0212
         CR    @15,STRTCYL                                         0212
         BNE   @RF00212                                            0212
*             THISNODE=ZERO;                                       0213
         SLR   THISNODE,THISNODE                                   0213
*           ELSE                                                   0214
*                                                                  0214
*             /*******************************************************/
*             /*                                                     */
*             /* OTHERWISE, SEE IF THERE IS ANOTHER READ REQUEST ON  */
*             /* YET A NEARER CYLINDER                               */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0214
*/*%GRC30:    P (,%GRC80) MOVE DOWN LE LEG ONE NODE                  */
*                                                                  0214
*             THISNODE=THISNODE->IOENXTLE;                         0214
         B     @RC00212                                            0214
@RF00212 L     THISNODE,IOENXTLE(,THISNODE)                        0214
*         END;                                                     0215
*       ELSE                                                       0216
*                                                                  0216
*         /***********************************************************/
*         /*                                                         */
*         /* IF THE CURRENT CYL VALUE IS NOT THE NEAREST OR EQUALS   */
*         /* THE NEAREST, THEN MOVE DOWN THE TREE'S                  */
*         /* LESS-THAN-OR-EQUAL (LE) PATH...                         */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0216
*/*%GRC40:    P MOVE DOWN LE LEG ONE NODE                            */
*                                                                  0216
*         THISNODE=THISNODE->IOENXTLE;                             0216
*                                                                  0216
         B     @RC00207                                            0216
@RF00207 L     THISNODE,IOENXTLE(,THISNODE)                        0216
*/*%GRC80:    N (,%GRC10) END LOOP TO MOVE DOWN TREE ONE NODE AT A 0217
*/*                       TIME                                       */
*                                                                  0217
*   END;                            /* END LOOP TO FIND READ CYL   0217
*                                      NEAREST LAST PROCESSED CYL    */
*                                                                  0217
@RC00207 DS    0H                                                  0217
@RC00205 DS    0H                                                  0217
@DE00204 LTR   THISNODE,THISNODE                                   0217
         BNZ   @DL00204                                            0217
*   /*****************************************************************/
*   /*                                                               */
*   /* SET THE BEST READ CYLINDER VALUE FOUND... NOTE: THIS VALUE MAY*/
*   /* BE MERELY THE CYLINDER FIRST REPRESENTED ON THE TREE IF NO    */
*   /* READ REQUESTS EXIST FOR A CYLINDER WITH A HIGHER NUMBER THAN  */
*   /* THE LAST PROCESSED CYLINDER                                   */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0218
*/*%GRC90:    R RETURN                                               */
*                                                                  0218
*   RFY                                                            0218
*     R14 UNRSTD;                   /* RELEASE RETURN REG            */
*   END GETRDCYL;                   /* END OF SUBROUTINE GETRDCYL    */
@EL00004 DS    0H                                                  0219
@EF00004 DS    0H                                                  0219
@ER00004 BR    @14                                                 0219
*/*GETRDCYL: END                                                     */
*                                                                  0220
*                                                                  0220
*/*GETWCYL: CHART                                                    */
*/* HEADING                                                        0220
*/* ILRSRT - ASM SLOT SORT                                         0220
*/*GETWCYL:  FIND NEXT WRITE CYLINDER FROM LAST PROCESSED            */
*/********************************************************************/
*/*                                                                  */
*/*      GETWCYL:  FIND NEXT WRITE CYLINDER FROM LAST PROCESSED      */
*/*                                                                  */
*/*      INPUT: CURRENT C-SCAN END POINTS                            */
*/*             ADDRESS OF PART BIT MAP                              */
*/*             NUMBER OF WORDS REQUIRED TO MAP ONE CULINDER         */
*/*                                                                  */
*/*      PROCESS: THE CURRENT C-SCAN END POINT VALUES ARE TRANSLATED */
*/*               INTO THE BEGIN POINT ADDRESS AND LENGTH OF A PAT   */
*/*               MAP SCAN FOR A NON-'FF' BYTE. THE SACN IS VIA      */
*/*               COMPARE-LOGICAL-CHARACTERS-LONG.  IF A BIT IS FOUND*/
*/*               THE CYLINDER MAP IT IS IN IS ISOLATED AND THE      */
*/*               CORRESPONDING CYLINDER VLAUE IS DETERMINED. THIS   */
*/*               CYLINDER VALUE WILL BE THE NEXT RELATIVE CYLINDER  */
*/*               IN THE PAGING SPACE TO BE USED.                    */
*/*                                                                  */
*/*      OUTPUT: IF A HIT IS FOUND, THE RELATIVE CYLINDER NUMBER OF  */
*/*              THE WRITE CYLINDER.                                 */
*/*                                                                  */
*/*                                                                  */
*/********************************************************************/
*/*GETWCYL:  E FIND NEXT WRITE CYL FROM LAST USED                    */
*                                                                  0220
*GETWCYL:                                                          0220
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0220
GETWCYL  DS    0H                                                  0221
*   RFY                                                            0221
*     R14 RSTD;                                                    0221
*   RETADDR2=R14;                   /* SAVE RETURN ADDRESS           */
*                                                                  0222
         ST    R14,RETADDR2                                        0222
*   /*****************************************************************/
*   /*                                                               */
*   /* USING THE SCAN STARTING AND ENDING POINT CYL VALUES, COMPUTE  */
*   /* THE BEGIN POINT SCAN ADDRESS AND THE SCAN LENGTH TO PERFORM A */
*   /* COMPARE LOGICAL CHARACTER LONG OPERATION TO FIND A BYTE WITH A*/
*   /* BIT OFF.                                                      */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0223
*/*           M COMPUTE SCAN STARTING POINT ADDRESS                  */
*/*           M COMPUTE LENGTH OF SCAN                               */
*/*           M SET 'FF'X COMPARE CHARACTER                          */
*/*           P SCAN FOR NON-'FF'X BYTE (CLCL)                       */
*                                                                  0223
*   RFY                                                            0223
*    (R1) RSTD;                                                    0223
*                                                                  0223
*   /*****************************************************************/
*   /*                                                               */
*   /* OBTAIN SCAN STARTING ADDRESS                                  */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0224
*   R14=STRTCYL;                    /* GET SCAN START CYL VALUE      */
         LR    R14,STRTCYL                                         0224
*   R1=CYLMPWDS;                    /* NBR WORDS IN CYL MAP          */
         L     R1,CYLMPWDS                                         0225
*   GEN(SLL    R14,1(R1));          /* OFFSET INTO PAT MAP           */
         SLL    R14,1(R1)
*   R14=R14+ADDR(PATMAP);           /* ADDR OF START CYL MAP         */
*                                                                  0227
         L     @15,PAREPTR                                         0227
         L     @15,PAREPATP(,@15)                                  0227
         LA    @15,PATMAP(,@15)                                    0227
         ALR   R14,@15                                             0227
*   /*****************************************************************/
*   /*                                                               */
*   /* OBTAIN LENGTH OF SCAN TO CURRENT 'END' CYLINDER               */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0228
*   RFY                                                            0228
*     R15 RSTD;                                                    0228
*   R15=THISCYL-STRTCYL;            /* NBR CYL MAPS TO SCAN          */
         L     R15,THISCYL                                         0229
         SLR   R15,STRTCYL                                         0229
*   GEN(SLL   R15,1(R1));           /* NBR OF BYTES TO SCAN          */
*                                                                  0230
         SLL   R15,1(R1)
*   /*****************************************************************/
*   /*                                                               */
*   /* SET 'FF'X PADDING CHARACTER FOR CLCL INSTRUCTION              */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0231
*   R1=FFCMPARE;                    /* SET COMPARAND ('FF'X)         */
         L     R1,FFCMPARE                                         0231
*   GEN(CLCL R14,R0);               /* SCAN FOR NON-ONE BIT          */
         CLCL R14,R0
*   RFY                                                            0233
*    (R1) UNRSTD;                                                  0233
*                                                                  0233
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THE SCAN IS SUCCESSFUL IN FINDING A BYTE WITH AT LEAST ONE */
*   /* BIT OFF THEN COMPUTE THE CYL REPRESENTED                      */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0234
*/*           D (YES,,NO,%GWC20) NON-'FF'X BYTE FOUND ?              */
*/*           P COMPUTE WRITE CYL VALUE REPRESENTED                  */
*                                                                  0234
*   IF R15>ZERO THEN                /* CYL WITH AVAILABLE SLOT FOUND
*                                      ?                             */
         LTR   R15,R15                                             0234
         BNP   @RF00234                                            0234
*     DO;                                                          0235
*       RFY                                                        0236
*         R14 RSTD;                                                0236
*       R14=R14-ADDR(PATMAP);       /* OFFSET OF BYTE IN PAT MAP     */
         L     @12,PAREPTR                                         0237
         L     @12,PAREPATP(,@12)                                  0237
         LA    @12,PATMAP(,@12)                                    0237
         SLR   R14,@12                                             0237
*       R15=CYLMPWDS;               /* NBR WORDS IN CYL MAP          */
         L     R15,CYLMPWDS                                        0238
*       GEN(SRL R14,1(R15));        /* CYL VALUE OF MAP BYTE IS IN   */
         SRL R14,1(R15)
*       THISCYL=R14;                /* GET WRITE CYLINDER VALUE      */
         ST    R14,THISCYL                                         0240
*       RFY                                                        0241
*         R15 UNRSTD;                                              0241
*     END;                                                         0242
*   ELSE                                                           0243
*     ;                                                            0243
*                                                                  0243
@RF00234 DS    0H                                                  0244
*/*%GWC20:    R RETURN                                               */
*                                                                  0244
*   R14=RETADDR2;                   /* RESTORE RETURN ADDRESS        */
         L     R14,RETADDR2                                        0244
*   RFY                                                            0245
*     R14 UNRSTD;                                                  0245
*   END GETWCYL;                    /* END SUBROUTINE GETWCYL        */
@EL00005 DS    0H                                                  0246
@EF00005 DS    0H                                                  0246
@ER00005 BR    @14                                                 0246
*/*GETWCYL: END                                                      */
*                                                                  0247
*                                                                  0247
*/*PROCREQS: CHART                                                   */
*/* HEADING                                                        0247
*/* ILRSRT - ASM SLOT SORT                                         0247
*/*PROCREQS:  PROCESS REQUESTS FOR A SPECIFIC CYLINDER               */
*/********************************************************************/
*/*                                                                  */
*/*      PROCREQS: PROCESS REQUESTS FOR A SPECIFIC CYLINDER          */
*/*                                                                  */
*/*      INPUT: RELATIVE CYLINDER NUMBER FOUND BY CSCANCYL           */
*/*             PART ENTRY                                           */
*/*             ADDRESS OF APPROPRIATE FINDSLOT ROUTINE              */
*/*                                                                  */
*/*      PROCESS: THE READ WRITE CYLINDER MAP IS BUILT. THEN THE     */
*/*               FINDSLOT AND PROCHIT SUBROUTINES ARE REPEATEDLY    */
*/*               CALLED TO FIRST CHOOSE A SLOT VIA THE READ-WRITE   */
*/*               MASK (THEREBY CHOOSING EITHER A READ OR WRITE      */
*/*               REQUEST) AND THE LATTER TO PREPARE A PCCW FOR THAT */
*/*               REQUEST.  THE LOOP TERMINATES WHEN RESOURCES (EG   */
*/*               PCCWS) ARE EXHAUSTED, THE SERVICE BURST QUOTA IS   */
*/*               MET OR NO MORE REQUESTS CAN BE CHOSEN FOR THIS     */
*/*               PARTICULAR CYLINDER.  AT THAT TIME, IF ANY WRITE   */
*/*               REQUESTS WERE PREPARED THEN WRTUPDTE IS INVOKED    */
*/*               TO UPDATE THE PAT BIT MAP AND THE PART ENTRY SLOT  */
*/*               SLOT AVAILABLE COUNT.                              */
*/*                                                                  */
*/*      OUTPUT: PART ENTRY LAST USED CYLINDER VALUE UPDATED         */
*/*              INITIALIZED PCCW FOR EACH I/O REQUEST               */
*/*              UPDATED PAT BIT MAP IF WRITE REQUESTS PROCESSED     */
*/*              UPDATED PART ENTRY SLOT AVAILABLE COUNT IF WRITE    */
*/*                REQUESTS PROCESSED                                */
*/*                                                                  */
*/********************************************************************/
*/*PROCREQS: E  PROCESS REQUESTS ON CYLINDER                         */
*                                                                  0247
*PROCREQS:                                                         0247
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0247
PROCREQS DS    0H                                                  0248
*   RFY                                                            0248
*     R14 RSTD;                                                    0248
*   RETADDR1=R14;                   /* SAVE RETURN ADDR              */
         ST    R14,RETADDR1                                        0249
*   RFY                                                            0250
*     R14 UNRSTD;                                                  0250
*                                                                  0250
*/*           P RESET LAST USED CYL VALUE IN PART ENTRY              */
*                                                                  0251
*   PARELCYL=THISCYL;               /* SAVE CYLINDER NBR FOR NEXT  0251
*                                      C-SCAN                        */
*                                                                  0251
         L     @12,THISCYL                                         0251
         L     @11,PAREPTR                                         0251
         STH   @12,PARELCYL(,@11)                                  0251
*   /*****************************************************************/
*   /*                                                               */
*   /* FINISH BUILDING THE CYLINDER MAP MASKS TO BE USED IN          */
*   /* PROCESSING REQUESTS ON THIS CYLINDER                          */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0252
*/*           S BILDMSKS: COMPLETE CYL MAP WORK MASKS                */
*                                                                  0252
*   CALL BILDMSKS;                                                 0252
*                                                                  0252
         BAL   @14,BILDMSKS                                        0252
*   /*****************************************************************/
*   /*                                                               */
*   /* LOOP ONCE FOR EVERY SLOT USED, STOPPING ONLY WHEN NO MORE     */
*   /* POSSIBILITIES EXIST FOR THE CYLINDER OR A RESOURCE HAS RUN OUT*/
*   /* (E.G. PCCWS), OR THE REQUEST QUOTA HAS BEEN MET               */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0253
*/*           N LOOP, FINDING & PROCESSING ONE SLOT EACH ITERATION   */
*/*%PRQ10:    D (YES,,NO,%PRQ70) SLOTS & RESOURCES AVAIL ?           */
*                                                                  0253
*   DO WHILE STOP=NO&(SCYLRDWT(1:4)×SCYLRDWT(5:8))^=ZERO;          0253
*                                                                  0253
         B     @DE00253                                            0253
@DL00253 DS    0H                                                  0254
*     /***************************************************************/
*     /*                                                             */
*     /* FINDSLOT IS A DEVICE-DEPENDENT SUBROUTINE ADDRESSED VIA AN  */
*     /* INTERNAL SLOT-SORT POINTER WHICH WHEN GIVEN A PARAMETER LIST*/
*     /* SPECIFYING THE LAST USED SLOT NUMBER, RETURNS THE NEXT BEST */
*     /* SLOT TO BE USED.                                            */
*     /*                                                             */
*     /***************************************************************/
*                                                                  0254
*/*           S FINDSLOT: OBTAIN NEXT SLOT ON CYL FOR I/O REQ        */
*                                                                  0254
*     GEN(STM   R2,R7,28(R13));     /* SAVE REGS USED BY FINDSLOT    */
         STM   R2,R7,28(R13)
*     CALL FINDSLOT;                                               0255
*                                                                  0255
         L     @15,FSRTNPTR                                        0255
         BALR  @14,@15                                             0255
*     /***************************************************************/
*     /*                                                             */
*     /* SINCE THE FINDSLOT ROUTINES DIRECTLY INVOKE GETREAD OR      */
*     /* SETWRITE VIA ASSEMBLER BRANCH, THE FOLLOWING STATEMENTS     */
*     /* 'INFORM' PLS OF THE FACT AND ENABLE THE COMPILER TO RESOLVE */
*     /* VARIABLE USAGES.                                            */
*     /*                                                             */
*     /***************************************************************/
*                                                                  0256
*     GEN(B     SKIPCALL);                                         0256
         B     SKIPCALL
*     RFY                                                          0257
*       R15 RSTD;                                                  0257
*     IF R15=ZERO THEN                                             0258
         LTR   R15,R15                                             0258
         BNZ   @RF00258                                            0258
*       CALL GETREAD;                                              0259
         BAL   @14,GETREAD                                         0259
*     ELSE                                                         0260
*       CALL SETWRITE;                                             0260
         B     @RC00258                                            0260
@RF00258 BAL   @14,SETWRITE                                        0260
*     RFY                                                          0261
*       R15 UNRSTD;                                                0261
@RC00258 DS    0H                                                  0262
*SKIPCALL:                                                         0262
*                                                                  0262
*     /***************************************************************/
*     /*                                                             */
*     /* WHEN A SLOT IS RETURNED, PROCHIT IS INVOKED TO CARRY ON FROM*/
*     /* THERE.                                                      */
*     /*                                                             */
*     /***************************************************************/
*                                                                  0262
*/*           S PROCHIT: BUILD PCCW FOR REQUEST FOR THIS SLOT        */
*                                                                  0262
*     CALL PROCHIT;                                                0262
*                                                                  0262
SKIPCALL BAL   @14,PROCHIT                                         0262
*/*           N (,%PRQ10) END LOOP TO PROCESS CYL SLOTS              */
*                                                                  0263
*   END;                                                           0263
*                                                                  0263
@DE00253 TM    STOP,B'10000000'                                    0263
         BNZ   @DC00253                                            0263
         ICM   @12,15,SCYLRDWT                                     0263
         ICM   @11,15,SCYLRDWT+4                                   0263
         OR    @12,@11                                             0263
         LTR   @12,@12                                             0263
         BNZ   @DL00253                                            0263
@DC00253 DS    0H                                                  0264
*   /*****************************************************************/
*   /*                                                               */
*   /* INVOKE WRTUPDTE TO UPDATE THE PAT CYLINDER MAP AND TO UPDATE  */
*   /* THE PART ENTRY SLOTS-AVAILABLE COUNT... IF SOME WRITE REQUESTS*/
*   /* WERE PREPARED.                                                */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0264
*/*%PRQ70:     D (YES,,NO,%PRQ80) ANY WRITES PREPARED ?              */
*/*           S WRTUPDTE: WRITE RELATED UPDATES, IF ANY              */
*                                                                  0264
*   IF EPAWRTCT>ZERO THEN           /* ANY WRITE PCCWS PREPARED ?    */
         LH    @12,EPAWRTCT(,EPAPTR)                               0264
         LTR   @12,@12                                             0264
         BNP   @RF00264                                            0264
*     CALL WRTUPDTE;                                               0265
         BAL   @14,WRTUPDTE                                        0265
*   ELSE                                                           0266
*     ;                                                            0266
@RF00264 DS    0H                                                  0267
*   RFY                                                            0267
*     R14 RSTD;                                                    0267
*                                                                  0267
*/*%PRQ80:    R RETURN                                               */
*                                                                  0268
*   R14=RETADDR1;                   /* RESTORE RETURN ADDRESS        */
         L     R14,RETADDR1                                        0268
*   RFY                                                            0269
*     R14 UNRSTD;                                                  0269
*   END PROCREQS;                   /* END SUBROUTINE PROCREQS       */
@EL00006 DS    0H                                                  0270
@EF00006 DS    0H                                                  0270
@ER00006 BR    @14                                                 0270
*/*PROCREQS: END                                                     */
*                                                                  0271
*                                                                  0271
*/*BILDMSKS: CHART                                                   */
*/* HEADING                                                        0271
*/* ILRSRT - ASM SLOT SORT                                         0271
*/* BILDMSKS:  BUILD PAT CYLINDER MAP READ/WRITE MASKS               */
*/********************************************************************/
*/*                                                                  */
*/*      BILDMSKS: BUILD PAT CYLINDER MAP READ/WRITE MASKS           */
*/*                                                                  */
*/*      INPUT: NUMBER OF WORDS REQUIRED TO MAP ONE CYLINDER'S SLOTS */
*/*             PAT                                                  */
*/*             CYLINDER MAP READ MASK IF CURRENT PORCESS CYLINDER   */
*/*               HAS PENDING READ REQUESTS                          */
*/*                                                                  */
*/*      PROCESS: IF NO WRITES EXIST TO PROCESS THEN THE READ/WRITE  */
*/*               MASK IS AUTOMATICALLY A COPY OF THE READ MASK.     */
*/*               OTHERWISE THE WRITE POSSIBILITIES ARE THE ZERO     */
*/*               BITS IN THE PAT CYLINDER MAP.  THE READ MASK BITS  */
*/*               ARE THEN ADDED TO BUILD THE READ/WRITE MASK.       */
*/*                                                                  */
*/*      OUTPUT: READ/WRITE MASK                                     */
*/*              COPY OF PAT CYLINDER MAP                            */
*/*                                                                  */
*/*                                                                  */
*/********************************************************************/
*/*BILDMSKS:  E BUILD PAT CYL MAP WORK MASKS                         */
*                                                                  0271
*BILDMSKS:                                                         0271
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0271
BILDMSKS DS    0H                                                  0272
*   RFY                                                            0272
*     R14 RSTD;                     /* RESTRICT THE RETURN REG       */
*                                                                  0272
*   /*****************************************************************/
*   /*                                                               */
*   /* OBTAIN CYLINDER MAP COPY FROM THE PAT AND BUILD THE READ/WRITE*/
*   /* CYLINDER MAP MASK... ACCORDING TO SIZE OF CYLINDER MAP        */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0273
*   PMAPADDR=ADDR(PATMAP);          /* ADDRESS OF PATCYL             */
         L     @15,PAREPTR                                         0273
         L     PMAPADDR,PAREPATP(,@15)                             0273
         LA    PMAPADDR,PATMAP(,PMAPADDR)                          0273
*   IF CYLMPWDS=TWO THEN            /* TWO WORD CYL MAP              */
         CLC   CYLMPWDS(4),@CF00084                                0274
         BNE   @RF00274                                            0274
*     DO;                                                          0275
*                                                                  0275
*       /*************************************************************/
*       /*                                                           */
*       /* COMPUTE THE ADDRESS OF THE PAT CYLINDER MAP CORRESPONDING */
*       /* TO THE CYL CHOSEN FOR PROCESSING I/O REQUESTS             */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0276
*/*           N BUILD TWO-WORD CYL MAP READ/WRITE MASK               */
*/*           P COMPUTE PAT CYLINDER MAP ADDRESS FOR CYL CHOSEN      */
*                                                                  0276
*       EPACYLA=ADDR(PATCYL(THISCYL*TWO+ONE));/* ADDR PAT CYL MAP    */
         L     @15,THISCYL                                         0276
         SLA   @15,3                                               0276
         LA    @15,PATCYL(@15,PMAPADDR)                            0276
         ST    @15,EPACYLA(,EPAPTR)                                0276
*/*           P OBTAIN COPY OF PAT CYLINDER MAP                      */
*                                                                  0277
*       SCYLCOPY=PATCYLMP;          /* GET COPY OF PAT CYL MAP       */
*                                                                  0277
         MVC   SCYLCOPY(8),PATCYLMP(@15)                           0277
*       /*************************************************************/
*       /*                                                           */
*       /* IF WRITE REQUESTS EXIST THEN PREPARE THE READ/WRITE MASK  */
*       /* ACCORDINGLY. OTHERWISE SET IT EQUAL TO THE READ MASK.     */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0278
*/*           D (YES,,NO,%BMK20) WRITES POSSIBLE ?                   */
*/*           P PRESET READ/WRITE CYL MAP WITH POTENTIAL WRITE HITS  */
*/*           N -(EXCLUSIVE PAT CYL MAP WITH FF'S)-                  */
*/*           P (,%BMK90) 'OR' IN READ HITS INTO READ/WRITE MASK     */
*/*%BMK20:    P (,%BMK90) SET READ/WRITE MASK EQUAL READ MASK        */
*                                                                  0278
*       IF WRITEQUE^=ZERO THEN      /* ANY WRITES TO PROCESS ?       */
         L     @15,WRITEQUE                                        0278
         LTR   @15,@15                                             0278
         BZ    @RF00278                                            0278
*         DO;                       /* NO, THEN                      */
*           SCYLRDWT=ALLFFSTR&&SCYLCOPY;/* PRESET READ/WRITE MASK  0280
*                                      WITH WRITE POSSIBILITIES ONLY */
         MVC   SCYLRDWT(8),ALLFFSTR                                0280
         XC    SCYLRDWT(8),SCYLCOPY                                0280
*           SCYLRDWT=SCYLRDWT×SCYLREAD;/* GET CYL MAP READ/WRT MASK  */
         OC    SCYLRDWT(8),SCYLREAD                                0281
*         END;                                                     0282
*       ELSE                                                       0283
*         SCYLRDWT=SCYLREAD;        /* GET CYL MAP READ/WRT MASK     */
         B     @RC00278                                            0283
@RF00278 MVC   SCYLRDWT(8),SCYLREAD                                0283
*     END;                          /* END TWO WORD CYL MAP          */
*   ELSE                            /* ONE WORD CYL MAP              */
*     DO;                                                          0285
*                                                                  0285
         B     @RC00274                                            0285
@RF00274 DS    0H                                                  0286
*       /*************************************************************/
*       /*                                                           */
*       /* COMPUTE THE ADDRESS OF THE PAT CYLINDER MAP CORRESPONDING */
*       /* TO THE CYL CHOSEN FOR PROCESSING I/O REQUESTS             */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0286
*/*%BMK50:    N OBTAIN ONE-WORD CYL MAP READ/WRITE MASK              */
*/*           P COMPUTE PAT CYLINDER MAP ADDRESS FOR CYL CHOSEN      */
*                                                                  0286
*       EPACYLA=ADDR(PATCYL(THISCYL+ONE));/* ADDR PAT CYL MAP        */
         L     @15,THISCYL                                         0286
         SLA   @15,2                                               0286
         LA    @15,PATCYL(@15,PMAPADDR)                            0286
         ST    @15,EPACYLA(,EPAPTR)                                0286
*/*           P OBTAIN COPY OF PAT CYLINDER MAP                      */
*                                                                  0287
*       SCYLCOPY(1:4)=PATCYLMP;     /* GET COPY OF PAT CYL MAP       */
*                                                                  0287
         MVC   SCYLCOPY(4),PATCYLMP(@15)                           0287
*       /*************************************************************/
*       /*                                                           */
*       /* IF WRITE REQUESTS EXIST THEN PREPARE THE READ/WRITE MASK  */
*       /* ACCORDINGLY. OTHERWISE SET IT EQUAL TO THE READ MASK.     */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0288
*/*           D (YES,,NO,%BMK60) WRITES POSSIBLE ?                   */
*/*           P PRESET READ/WRITE CYL MAP WITH POTENTIAL WRITE HITS  */
*/*           N -(EXCLUSIVE OR PAT CYL MAP WITH FF'S)-               */
*/*           P (,%BMK90) 'OR' IN READ HITS INTO READ/WRITE MASK     */
*/*%BMK60:    P SET READ/WRITE MASK EQUAL READ MASK                  */
*                                                                  0288
*       IF WRITEQUE^=ZERO THEN      /* ANY WRITES TO PROCESS ?       */
         L     @15,WRITEQUE                                        0288
         LTR   @15,@15                                             0288
         BZ    @RF00288                                            0288
*         DO;                       /* NO, THEN                      */
*           SCYLRDWT(1:4)=ALLFFSTR&&SCYLCOPY;/* PRESET R/W MASK WITH
*                                      WRITE POSSIBILITIES           */
         MVC   SCYLRDWT(4),ALLFFSTR                                0290
         XC    SCYLRDWT(4),SCYLCOPY                                0290
*           SCYLRDWT(1:4)=SCYLRDWT(1:4)×SCYLREAD(1:4);/* GET CYL MAP
*                                      R/W MASK                      */
         OC    SCYLRDWT(4),SCYLREAD                                0291
*         END;                                                     0292
*       ELSE                                                       0293
*         SCYLRDWT(1:4)=SCYLREAD;   /* GET CYL MAP READ/WRT MASK     */
         B     @RC00288                                            0293
@RF00288 MVC   SCYLRDWT(4),SCYLREAD                                0293
*     END;                          /* END ONE WORD CYL MAP          */
*/*%BMK90:    R RETURN                                               */
*                                                                  0295
*   RFY                                                            0295
*     R14 UNRSTD;                   /* RELEASE THE RETURN REG        */
*   END BILDMSKS;                   /* END SUBROUTINE BILDMSKS       */
@EL00007 DS    0H                                                  0296
@EF00007 DS    0H                                                  0296
@ER00007 BR    @14                                                 0296
*/*BILDMSKS: END                                                     */
*                                                                  0297
*                                                                  0297
*/*BRDMASK: CHART                                                    */
*/* HEADING                                                        0297
*/* ILRSRT - ASM SLOT SORT                                         0297
*/*BRDMASK:  BUILD THE CYLINDER MAP READ MASK                        */
*/********************************************************************/
*/*                                                                  */
*/*      BRDMASK: BUILD THE CYLINDER MAP READ MASK                   */
*/*                                                                  */
*/*      INPUT: ADDRESS OF FIRST IOE ON TREE FOR SPECIFIC CYLINDER   */
*/*               READ REQUEST                                       */
*/*             VALUE OF CURRENT READ CYLINDER TO BE PROCESSED       */
*/*                                                                  */
*/*      PROCESS:EACH IOE ON THE TREE FROM THE FIRST (INPUT) FOR A   */
*/*              SPECIFIC CYLINDER IS OBTAINED. (CYLINDER VALUE      */
*/*              FOUND IN AIA ADDRESSED FROM THE IOE). THE REALTIVE  */
*/*              SLOT WITHIN THE CYLINDER VALUE IS THEN USED TO BUILD*/
*/*              A MASK TO SET THE APPROPRIATE BIT IN THE READ MASK  */
*/*                                                                  */
*/*      OUTPUT: READ AMSK                                           */
*/*                                                                  */
*/********************************************************************/
*/*BRDMASK:  E BUILD THE CYL MAP READ MASK                           */
*                                                                  0297
*BRDMASK:                                                          0297
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0297
BRDMASK  DS    0H                                                  0298
*   RFY                                                            0298
*     R14 RSTD;                                                    0298
*   RETADDR3=R14;                   /* SAVE RETURN ADDR TO MAINLINE  */
         ST    R14,RETADDR3                                        0299
*   RFY                                                            0300
*     R14 UNRSTD;                                                  0300
*                                                                  0300
*   /*****************************************************************/
*   /*                                                               */
*   /* FIND ALL NODES ON TREE CORRESPONDING TO READ REQUESTS ON A    */
*   /* SPECIFIC CYLINDER --- THE READ CYLINDER FOUND BY GETRDCYL --- */
*   /* THE ADDRESS OF THE FIRST NODE REQUIRED TO SCAN THRU THESE READ*/
*   /* REQUESTS WAS PREVIOUSLY SAVED                                 */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0301
*/*           M OBTAIN THE TOP NODE FOR THIS CYL FOR READ SCAN       */
*                                                                  0301
*   THISNODE=TOPRDIOE;                                             0301
*                                                                  0301
         L     THISNODE,TOPRDIOE                                   0301
*   /*****************************************************************/
*   /*                                                               */
*   /* BELOW, SUBROUTINE GETLOLEC WILL FIND THE NODE REPRESENTING THE*/
*   /* READ REQUEST FOR THE LOWEST RELATIVE SLOT NUMBER IN THE       */
*   /* CYLINDER                                                      */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0302
*/*           S GETLOLEC: GET LOW LE NODE FOR THIS CYL ON THIS LEG   */
*                                                                  0302
*   CALL GETLOLEC;                  /* GET LOW LE NODE FOR READ CYL
*                                      ON THIS LEG                   */
*                                                                  0302
         BAL   @14,GETLOLEC                                        0302
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCESSING DURING EACH ITERATION OF THE FOLLOWING LOOP FINDS A*/
*   /* READ REQUEST FOR A SLOT ON THE CURRENT READ CYLINDER --OR--   */
*   /* DETERMINES THAT NO MORE REQUESTS EXIST FOR THE CYLINDER. FOR  */
*   /* EACH SLOT FOUND ITS CORRESPONDING READ CYL MAP MASK BIT IS SET*/
*   /* ON. PROCESSING IN THIS LOOP IS SUCH THAT THE SLOT REQUESTS ARE*/
*   /* FOUND IN ASCENDING ORDER RELATIVE TO THE CYLINDER             */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0303
*/*           N LOOP, ONCE FOR EACH READ REQUEST FOR CYLINDER        */
*/*%BRD10:    D (NO,,YES,%BRD90) LAST READ REQ FOUND ?               */
*                                                                  0303
*   DO WHILE THISNODE^=ZERO&        /* LOOP CTL SAYS CONTINUE        */
*         THISCYL=THISNODE->IOEAIA->AIACYL;/* -AND- SAME CYL NUMBER  */
*                                                                  0303
         B     @DE00303                                            0303
@DL00303 DS    0H                                                  0304
*     /***************************************************************/
*     /*                                                             */
*     /* TURN BIT ON IN READ MASK CORRESPONDING TO REL. CYL SLOT NBR */
*     /*                                                             */
*     /***************************************************************/
*                                                                  0304
*     RFY                                                          0304
*       R1 RSTD;                                                   0304
*                                                                  0304
*/*           P GET THE RELATIVE SLOT NBR WITHIN CYL FOR THIS REQ    */
*                                                                  0305
*     R1=THISNODE->IOEAIA->AIARCSN; /* OBTAIN REL. CYL SLOT NUMBER   */
         L     @12,IOEAIA(,THISNODE)                               0305
         LH    R1,AIARCSN(,@12)                                    0305
*/*           P BUILD MASK, TURN BIT ON IN CYL MAP READ MASK         */
*                                                                  0306
*     RFY                                                          0306
*      (R14,                                                       0306
*       R15) RSTD;                                                 0306
*     R14=HIORDER8;                 /* SET HI ORDER BIT IN REG       */
         L     R14,HIORDER8                                        0307
*     R15=ZERO;                     /* ZERO ODD REG OF PAIR          */
         SLR   R15,R15                                             0308
*     GEN(SRDL  R14,0(R1));         /* BUILD MASK                    */
         SRDL  R14,0(R1)
*     R14=R14×SCYLREAD(1:4);        /* SET BIT IF IN WORD ONE        */
         ICM   @12,15,SCYLREAD                                     0310
         OR    R14,@12                                             0310
*     R15=R15×SCYLREAD(5:8);        /* SET BIT IF IN WORD TWO        */
         ICM   @12,15,SCYLREAD+4                                   0311
         OR    R15,@12                                             0311
*     STM(R14,R15,SCYLREAD);        /* STORE RESULTING READ MASK     */
         STM   R14,R15,SCYLREAD                                    0312
*     RFY                                                          0313
*      (R1,                                                        0313
*       R14,                                                       0313
*       R15) UNRSTD;                                               0313
*                                                                  0313
*     /***************************************************************/
*     /*                                                             */
*     /* ONCE A CERTAIN NODES CORRESPONDING SLOT HAS BEEN MARKED IN  */
*     /* THE BIT MASK, THE OBJECT IS TO FIND THE NODE ASSOCIATED WITH*/
*     /* THE NEXT LOWEST SLOT NBR (RELATIVE TO THE CYL). ----------- */
*     /* FIRST, SEE IF A NODE IS HUNG FROM THE CURRENT NODE ON THE GT*/
*     /* LEG. IF THERE IS NONE THEN WE MUST MOVE UP THE TREE ON AN LE*/
*     /* LEG TO FIND THE NEXT NODE FOR THIS CYLINDER. IF THE CURRENT */
*     /* NODE IS HUNG ON THE GT LEG OF THE NODE ABOVE OR IF WE ARE   */
*     /* ALREADY AT THE TOP OF THE TREE, IT MAY BE SAFELY ASSUMED    */
*     /* THERE ARE NO MORE REQUESTS FOR THE CURRENT CYLINDER.        */
*     /*                                                             */
*     /***************************************************************/
*                                                                  0314
*/*           P GET ADDRESS OF NEXT NODE DOWN GT LEG                 */
*/*           D (NO,,YES,%BRD40) ANOTHER NODE ON GT LEG ?            */
*/*           D (YES,,NO,%BRD20) NODE ABOVE ON LE LEG ?              */
*/*           P (,%BRD80) MOVE UP TREE ONE NODE: LE LEG              */
*/*%BRD20:    P (,%BRD80) INDICATE TIME TO GET OUT OF LOOP           */
*                                                                  0314
*     IF THISNODE->IOENXTGT=ZERO THEN/* NO NEXT NODE ON GT PATH?     */
         SLR   @12,@12                                             0314
         C     @12,IOENXTGT(,THISNODE)                             0314
         BNE   @RF00314                                            0314
*       IF THISNODE->IOEBKPTR^=ZERO&/* NOT AT TOP OF TREE ?          */
*           THISNODE->IOEBKPTR->IOENXTLE=THISNODE THEN/* ON LE LEG ? */
         L     @11,IOEBKPTR(,THISNODE)                             0315
         CR    @11,@12                                             0315
         BE    @RF00315                                            0315
         C     THISNODE,IOENXTLE(,@11)                             0315
         BNE   @RF00315                                            0315
*         THISNODE=THISNODE->IOEBKPTR;/* MOVE UP TREE LEPATH         */
         LR    THISNODE,@11                                        0316
*       ELSE                                                       0317
*         THISNODE=ZERO;            /* GET OUT OF LOOP               */
         B     @RC00315                                            0317
@RF00315 SLR   THISNODE,THISNODE                                   0317
*     ELSE                                                         0318
*                                                                  0318
*       /*************************************************************/
*       /*                                                           */
*       /* NOW IF THERE IS A NODE HANGING ON THE GT LEG FROM THE     */
*       /* CURRENT NODE, THEN PROCEED TO FIND THE LOWEST NODE ON THE */
*       /* LE LEG STILL REPRESENTING A REQUEST FOR THE CURRENT READ  */
*       /* CYLINDER... THAT NODE WILL BE A REQUEST FOR THE NEXT      */
*       /* LOWEST SLOT ON THE CYLINDER.                              */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0318
*/*%BRD40:    S (,%BRD80) GETLOLEC: GET LOW LE NODE FOR CYL ON THIS
*/*                       LEG                                        */
*                                                                  0318
*       DO;                                                        0318
         B     @RC00314                                            0318
@RF00314 DS    0H                                                  0319
*         THISNODE=THISNODE->IOENXTGT;/* RESET CURRENT NODE PTR      */
         L     THISNODE,IOENXTGT(,THISNODE)                        0319
*         CALL GETLOLEC;            /* GET LOW LE NODE FOR READ CYL
*                                      ON THIS LEG                   */
         BAL   @14,GETLOLEC                                        0320
*       END;                                                       0321
*                                                                  0321
*/*%BRD80:    N (,%BRD10) END LOOP TO FIND READS ON CURRENT READ CYL */
*                                                                  0322
*   END;                            /* END LOOP TO BUILD READ MASK   */
@RC00314 DS    0H                                                  0322
@DE00303 LTR   THISNODE,THISNODE                                   0322
         BZ    @DC00303                                            0322
         L     @12,IOEAIA(,THISNODE)                               0322
         L     @11,THISCYL                                         0322
         CH    @11,AIACYL(,@12)                                    0322
         BE    @DL00303                                            0322
@DC00303 DS    0H                                                  0323
*/*%BRD90:    R RETURN                                               */
*                                                                  0323
*   RFY                                                            0323
*     R14 RSTD;                                                    0323
*   R14=RETADDR3;                   /* RESTORE RETURN ADDRESS        */
         L     R14,RETADDR3                                        0324
*   RFY                                                            0325
*     R14 UNRSTD;                                                  0325
*   END BRDMASK;                    /* END SUBROUTINE BRDMASK        */
@EL00008 DS    0H                                                  0326
@EF00008 DS    0H                                                  0326
@ER00008 BR    @14                                                 0326
*/*BRDMASK: END                                                      */
*                                                                  0327
*                                                                  0327
*/*GETLOLEC: CHART                                                   */
*/* HEADING                                                        0327
*/* ILRSRT - ASM SLOT SORT                   GETLOLEC:  GET LOW LE 0327
*/* NODE REPRESENTING SPECIFIC CYLINDER REQUEST ON LEG OF THE TREE   */
*/********************************************************************/
*/*                                                                  */
*/*        GETLOLEC:  GET LOWEST NODE ON LE LEG OF TREE STILL        */
*/*                   REPRESENTING A READ REQUEST FROM A SPECIFIC    */
*/*                   CYLINDER OF THE PAGING SPACE                   */
*/*                                                                  */
*/*      INPUT: ADDR OF LATEST IOE ON TREE EXAMINED BY BRDMASK       */
*/*             VALUE OF CURRENT READ CYLINDER TO BE PROCESSED       */
*/*                                                                  */
*/*      PROCESS: MOVE DOWN LE LEG FROM INPUT IOE UNTIL LEG ENDS OR  */
*/*               AN IOE FOR A READ REQUEST ON A DIFFERENT CYLINDER  */
*/*               IS FOUND                                           */
*/*                                                                  */
*/*      OUTPUT: ADDRESS OF LAST IOE ON LE LEG (FROM INPUT IOE)      */
*/*              WHICH IS A READ REQUEST FOR THE SAME CYLINDER AS    */
*/*              THE CURRENT READ CYLINDER.                          */
*/*                                                                  */
*/*                                                                  */
*/********************************************************************/
*/*GETLOLEC:   E GET LOW LE NODE FOR CERTAIN CYL                     */
*                                                                  0327
*GETLOLEC:                                                         0327
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0327
GETLOLEC DS    0H                                                  0328
*   RFY                                                            0328
*     R14 RSTD;                     /* RESTRICT RETURN REGISTER      */
*                                                                  0328
*   /*****************************************************************/
*   /*                                                               */
*   /* LOOP: EACH ITERATION MOVING DOWN AN LE LEG OF THE TREE UNTIL  */
*   /* THE END OF THE LEG IS FOUND, OR A NODE REPRESENTING A READ    */
*   /* FROM A DIFFERENT CYLINDER IS FOUND.                           */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0329
*/*           N LOOP DOWN LE PATH UNTIL LEG END OR CYL CHANGE        */
*/*%GLC10:    D (NO,,YES,%GLC90) LAST NODE FOR CYL REACHED ON LEG ?  */
*                                                                  0329
*   DO WHILE THISNODE->IOENXTLE^=ZERO&THISNODE->IOENXTLE->IOEAIA-> 0329
*         AIACYL=THISCYL;                                          0329
*                                                                  0329
         B     @DE00329                                            0329
@DL00329 DS    0H                                                  0330
*/*           P MOVE DOWN TREE ONE NODE, GET NEXT NODE ON LE LEG     */
*                                                                  0330
*     THISNODE=THISNODE->IOENXTLE;                                 0330
*                                                                  0330
         L     THISNODE,IOENXTLE(,THISNODE)                        0330
*/*%GLC60:    N (,%GLC10) END LOOP TO FIND LOWEST LE NODE FOR SPECIFIC
*/*                       CYL                                        */
*                                                                  0331
*   END;                            /* END LOOP TO FIND LOW SLOT FOR
*                                      THIS CYL ON THIS LE LEG       */
@DE00329 L     @15,IOENXTLE(,THISNODE)                             0331
         LTR   @15,@15                                             0331
         BZ    @DC00329                                            0331
         L     @15,IOEAIA(,@15)                                    0331
         LH    @15,AIACYL(,@15)                                    0331
         C     @15,THISCYL                                         0331
         BE    @DL00329                                            0331
@DC00329 DS    0H                                                  0332
*/*%GLC90:    R RETURN                                               */
*                                                                  0332
*   RFY                                                            0332
*     R14 UNRSTD;                   /* RELEASE RETURN REGISTER       */
*   END GETLOLEC;                   /* END SUBROUTINE GETLOLEC       */
@EL00009 DS    0H                                                  0333
@EF00009 DS    0H                                                  0333
@ER00009 BR    @14                                                 0333
*/*GETLOLEC: END                                                     */
*                                                                  0334
*                                                                  0334
*/*PROCHIT: CHART                                                    */
*/* HEADING                                                        0334
*/* ILRSRT - ASM SLOT SORT                                         0334
*/*PROCHIT: ASGN I/O TO SLOT FOUND VIA FINDSLOT ROUTINE              */
*/********************************************************************/
*/*                                                                  */
*/*      PROCHIT: ASGN I/O TO SLOT FOUND VIA FINDSLOT ROUTINE        */
*/*                                                                  */
*/*      INPUT: 1) ADDRESS OF IOE                                    */
*/*             2) NUMBER OF REQUEST YET TO PROCESS (SERVICE BURST)  */
*/*             3) PART ENTRY                                        */
*/*             4) INPUT PARAMETER LIST FORM ILRPTM                  */
*/*                                                                  */
*/*      PROCESS: AN I/O REQUEST (PCCW) IS BUILT AND CHAINED TO THE  */
*/*              IORB. THE IOE IS FREED. IF MORE REQUESTS MAY BE     */
*/*              PROCESSED AN ADDITIONAL PCCW IS OBTAINED FROM THE   */
*/*              ASMVT AVAILABLE QUEUE.                              */
*/*                                                                  */
*/*      OUTPUT: - INITIALZED PCCW CHAINED TO IORB                   */
*/*              - IOE ADDED TO AVAILABLE QUEUE                      */
*/*              - NEW PCCW ADDRESSED IN PART MONITOR PARM LIST      */
*/*              - "STOP" INDICATOR SET IF NO MORE REQUESTS MAY BE   */
*/*                PROCESSED OR RESOURCES UNAVAILABLE                */
*/*                                                                  */
*/*                                                                  */
*/********************************************************************/
*/*PROCHIT:  E ASGN I/O TO SLOT FOUND VIA FINDSLOT                   */
*                                                                  0334
*PROCHIT:                                                          0334
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0334
PROCHIT  DS    0H                                                  0335
*   RFY                                                            0335
*     R14 RSTD;                                                    0335
*   RETADDR2=R14;                   /* SAVE RETURN ADDRESS           */
         ST    R14,RETADDR2                                        0336
*   RFY                                                            0337
*     R14 UNRSTD;                                                  0337
*                                                                  0337
*   /*****************************************************************/
*   /*                                                               */
*   /* IOCHAIN INITIALIZES THE PCCW AND CHAINS THE PCCW TO THE IORB. */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0338
*/*           S IOCHAIN: CHAIN PCCW TO IORB                          */
*                                                                  0338
*   CALL IOCHAIN;                   /* CHAIN PCCW TO IORB            */
         BAL   @14,IOCHAIN                                         0338
*/* D (YES,,NO,%F01) ANYTHING ON INTERNAL Q?                         */
*/* P (,%F02) QUEUE IOE TO LAST ONE ON Q TAIL->IOENXT                */
*/*%F01: P PLACE IOE ON QUEUE                                        */
*/*%F02: P UPDATE TAIL PTR TO THIS IOE                               */
*/* P TAIL->IOENXT=0                                                 */
*                                                                  0339
*   /*****************************************************************/
*   /*                                                               */
*   /* PUT USED IOE ON INTERNAL QUEUE TO BE FREED BEFORE RETURN TO   */
*   /* PART MONITOR ALL AT ONCE BY 1 COMPARE AND SWAP.               */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0339
*   EPAIOEIP=0;                     /* ZERO FOR RECOVERY             */
         SLR   @11,@11                                             0339
         ST    @11,EPAIOEIP(,EPAPTR)                               0339
*   IF EPAFFIOE=0 THEN              /* ANYTHING ON INTERNAL FREE   0340
*                                      QUEUE YET                     */
         C     @11,EPAFFIOE(,EPAPTR)                               0340
         BNE   @RF00340                                            0340
*     EPAFFIOE=IOEPTR;              /* NO- PUT ON AS FIRST           */
         ST    IOEPTR,EPAFFIOE(,EPAPTR)                            0341
*   ELSE                            /* ELEMENTS THERE ALREADY        */
*     EPALFIOE->IOENXT=IOEPTR;      /* PUT ON END                    */
         B     @RC00340                                            0342
@RF00340 L     @11,EPALFIOE(,EPAPTR)                               0342
         ST    IOEPTR,IOENXT(,@11)                                 0342
*   EPALFIOE=IOEPTR;                /* REGARDLESS, THIS ONE IS LAST  */
@RC00340 ST    IOEPTR,EPALFIOE(,EPAPTR)                            0343
*   IOENXT=0;                       /* SO, MAKE SURE ITS CHAIN PTR IS
*                                      ZERO                          */
         SLR   @11,@11                                             0344
         ST    @11,IOENXT(,IOEPTR)                                 0344
*   IOEPTR=0;                       /* DONE WITH THIS ONE            */
*                                                                  0345
         SLR   IOEPTR,IOEPTR                                       0345
*   /*****************************************************************/
*   /*                                                               */
*   /* DETERMINE NOW IF ANY MORE REQUESTS NEED BE PROCESSED ...      */
*   /* CONTINUE AND ATTEMPT TO OBTAIN ANOTHER PCCW IF THE SERVICE    */
*   /* BURST REQUEST QUOTA HAS NOT BEEN MET AND MORE POTENTIAL I/O   */
*   /* REQUESTS ARE POSSIBLE ON THIS PAGING SPACE.                   */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0346
*/*           D (YES,,NO,%PRH40) PROCESS MORE REQUESTS ?             */
*/*           P DECREMENT SERVICE BURST REQUEST QUOTA BY ONE         */
*/*           S (,%PRH50) GETPCCW: TRY TO GET ANOTHER PCCW           */
*/*%PRH40:    P INDICATE TIME TO STOP BUILDING PCCWS                 */
*                                                                  0346
*   IF REQNEED>ONE&                 /* REQUEST QUOTA NOT YET MET?    */
*       (WRITEQUE^=ZERO×PARENODE^=ZERO) THEN/* -AND- MORE REQUESTS ? */
         L     @12,REQNEED                                         0346
         C     @12,@CF00045                                        0346
         BNH   @RF00346                                            0346
         C     @11,WRITEQUE                                        0346
         BNE   @RT00346                                            0346
         L     @12,PAREPTR                                         0346
         C     @11,PARENODE(,@12)                                  0346
         BE    @RF00346                                            0346
@RT00346 DS    0H                                                  0347
*     DO;                                                          0347
*       REQNEED=REQNEED-ONE;        /* DECR REQUEST QUOTA CTR        */
         L     @12,REQNEED                                         0348
         BCTR  @12,0                                               0348
         ST    @12,REQNEED                                         0348
*       CALL GETPCCW;               /* GET PCCW FOR NEXT REQ         */
         BAL   @14,GETPCCW                                         0349
*     END;                                                         0350
*   ELSE                                                           0351
*     STOP=YES;                     /* INDICATE TIME TO STOP SORTING
*                                      AND GET I/O GOING             */
         B     @RC00346                                            0351
@RF00346 OI    STOP,B'10000000'                                    0351
*/*%PRH50:    R RETURN                                               */
*                                                                  0352
*   RFY                                                            0352
*     R14 RSTD;                                                    0352
@RC00346 DS    0H                                                  0353
*   R14=RETADDR2;                   /* RESTORE RETURN REGISTER       */
         L     R14,RETADDR2                                        0353
*   RFY                                                            0354
*     R14 UNRSTD;                                                  0354
*   END PROCHIT;                    /* END SUBROUTINE PROCHIT        */
@EL00010 DS    0H                                                  0355
@EF00010 DS    0H                                                  0355
@ER00010 BR    @14                                                 0355
*/*PROCHIT: END                                                      */
*                                                                  0356
*                                                                  0356
*/*SETWRITE: CHART                                                   */
*/* HEADING                                                        0356
*/* ILRSRT - ASM SLOT SORT                                         0356
*/*SETWRITE: SET UP FOR A WRITE REQUEST                              */
*/********************************************************************/
*/*                                                                  */
*/*      SETWRITE: SET UP FOR A WRITE REQUEST                        */
*/*                                                                  */
*/*      INPUT: - SLOT VALUE FOUND BY FINDSLOT ROUTINE               */
*/*             - VALUE OF CYLINDER CURRENTLY BEING PROCESSED        */
*/*             - NUMBER OF SLOTS PER CYLINDER                       */
*/*             - PART MONITOR PARAMETER LIST                        */
*/*             - CURRENT COUNTS OF WRITES PROCESSED                 */
*/*             - COPY OF PAT CYLINDER BIT MAP FOR CURRENT CYLINDER  */
*/*                                                                  */
*/*      PROCESS: THE RELATIVE NUMBER OF THE SLOT FOUND BY THE FIND- */
*/*               SLOT ROUTINE IS COMPUTED. AN IOE IS OBTAINED FROM  */
*/*               THE WRITE QUEUE PASSED BY PART MONITOR.  IF NO MORE*/
*/*               WRITE REQUESTS EXIST ON THE QUEUE THEN THE READ/   */
*/*               WRITE MASK IS UPDATED SO THAT SETWRITE WILL NO     */
*/*               LONGER BE CALLED FROM THE FINDSLOT ROUTINE.  THE   */
*/*               COUNT OF WRITE REQUESTS CHOSEN FOR THE CURRENT     */
*/*               CYLINDER IS INCREMENTED. THE PART ENTRY INDEX VALUE*/
*/*               AND THE RSN ARE STORED IN THE LSID FIELD OF THE AIA*/
*/*               ADDRESSED FROM THE IOE.                            */
*/*                                                                  */
*/*      OUTPUT:  - UPDATED READ/WRITE MASK (MAYBE)                  */
*/*               - UPDATED WRITE COUNT                              */
*/*               - UPDATED AIA                                      */
*/*               - UPDATED WRITE QUEUE ANCHOR                       */
*/*               - IOE FOR WRITE REQUEST                            */
*/*               - RSN OF SLOT TO BE WRITTEN                        */
*/*                                                                  */
*/********************************************************************/
*/*SETWRITE:  E INITLZ, CHAIN A PCCW FOR A WRITE REQ                 */
*                                                                  0356
*SETWRITE:                                                         0356
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0356
SETWRITE DS    0H                                                  0357
*   RFY                                                            0357
*     R14 RSTD;                                                    0357
*   RETADDR2=R14;                   /* SAVE RETURN ADDRESS           */
         ST    R14,RETADDR2                                        0358
*   RFY                                                            0359
*     R14 UNRSTD;                                                  0359
*   GEN(LM    R2,R7,28(R13));       /* RESTORE FINDSLOT REGS         */
*                                                                  0360
         LM    R2,R7,28(R13)
*   /*****************************************************************/
*   /*                                                               */
*   /* COMPUTE THE PAGING SPACE RELATIVE SLOT NUMBER REPRESENTED BY  */
*   /* THE BIT FOUND VIA THE FINDSLOT ROUTINE                        */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0361
*/*           P COMPUTE RSN OF SLOT FOUND BY FINDSLOT RTN            */
*                                                                  0361
*   TSLOTNBR=THISCYL*CYLSLOTS+SSLOT;/* GET REL SLOT NBR              */
*                                                                  0361
         L     @01,THISCYL                                         0361
         M     @00,CYLSLOTS                                        0361
         AL    @01,SSLOT                                           0361
         ST    @01,TSLOTNBR                                        0361
*   /*****************************************************************/
*   /*                                                               */
*   /* OBTAIN IOE FROM WRITE QUEUE, FROM IT OBTAIN THE ADDRESS OF THE*/
*   /* AIA...                                                        */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0362
*/*           P OBTAIN FIRST IOE ON WRITE QUEUE                      */
*/*           P GET ADDRESS OF AIA FROM IOE                          */
*                                                                  0362
*   IOEPTR=WRITEQUE;                /* GET ADDR 1ST WRITE ON QUEUE   */
         L     IOEPTR,WRITEQUE                                     0362
*   WRITEQUE=IOENXT;                /* RESET WRITE QUEUE ANCHOR      */
         L     @11,IOENXT(,IOEPTR)                                 0363
         ST    @11,WRITEQUE                                        0363
*   PTRWRITE=WRITEQUE;              /* RESET PARM AREA FOR REMAINING
*                                      WRITES REQUIRED BY RECOVERY 0364
*                                                            @ZA28762*/
         L     @05,PRMLADDR                                        0364
         ST    @11,PTRWRITE(,@05)                                  0364
*   EPAIOEIP=IOEPTR;                /* TELL RECOV IOE CURRENTLY BEING
*                                      PROCESSED                     */
*                                                                  0365
         ST    IOEPTR,EPAIOEIP(,EPAPTR)                            0365
*   /*****************************************************************/
*   /*                                                               */
*   /* ----- IF THE WRITE QUEUE IS EMPTY, RESET THE CURRENT          */
*   /* READ/WRITE MASK SO THAT NO MORE WRITE HITS MAY BE RETURNED BY */
*   /* THE FINDSLOT ROUTINE                                          */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0366
*/*           D (YES,,NO,%STW10) WRITE QUEUE EMPTY ?                 */
*/*           P SET REMAINING POTENTIAL WRITE HITS OFF IN R/W MASK   */
*                                                                  0366
*   IF WRITEQUE=ZERO THEN           /* NO MORE WRITE REQUESTS ?      */
         LTR   @11,@11                                             0366
         BNZ   @RF00366                                            0366
*     SCYLRDWT=SCYLRDWT&SCYLCOPY;   /* TURN OFF REMAINING WRITE    0367
*                                      POSSIBILITIES IN R/W MASK     */
         NC    SCYLRDWT(8),SCYLCOPY                                0367
*   ELSE                                                           0368
*     ;                                                            0368
*                                                                  0368
@RF00366 DS    0H                                                  0369
*/*%STW10:    P INCR WRITES- PROCESSED CTR TO LATER UPDATE PARTE CTR */
*                                                                  0369
*   EPAWRTCT=EPAWRTCT+ONE;          /* INCREMENT COUNT OF WRITE    0369
*                                      REQUESTS PREPARED             */
*                                                                  0369
         LA    @11,1                                               0369
         AH    @11,EPAWRTCT(,EPAPTR)                               0369
         STH   @11,EPAWRTCT(,EPAPTR)                               0369
*   /*****************************************************************/
*   /*                                                               */
*   /* FROM THE IOE OBTAINED ABOVE OBTAIN THE ADDRESS OF THE AIA...  */
*   /* STORE THE RELATIVE SLOT NUMBER AND PART ENTRY NN INDEX VALUE  */
*   /* INTO THE AIA                                                  */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0370
*/*           P GET ADDRESS OF AIA FROM IOE                          */
*/*           P STORE RSN AND PARTE NN INDEX INTO AIA LSID FIELD     */
*                                                                  0370
*   AIAPTR=IOEAIA;                  /* GET AIA ADDRESS               */
         L     AIAPTR,IOEAIA(,IOEPTR)                              0370
*   IF AIADUPLX=ON THEN             /* DUPLEX WRITE OPERATION?       */
         TM    AIADUPLX(AIAPTR),B'00010000'                        0371
         BNO   @RF00371                                            0371
*     LSIDPTR=IOELSIDA;             /* USE IOE TO FIND PROPER LSID 0372
*                                      FIELD TO USE                  */
         L     LSIDPTR,IOELSIDA(,IOEPTR)                           0372
*   ELSE                            /* OTHERWISE                     */
*     LSIDPTR=ADDR(AIALSID);        /* ITS ALWAYS THIS FIELD         */
         B     @RC00371                                            0373
@RF00371 LA    LSIDPTR,AIALSID(,AIAPTR)                            0373
*   PRTNN=PARENN;                   /* STORE PART ENTRY INDEX IN LSID*/
@RC00371 L     @11,PAREPTR                                         0374
         LH    @11,PARENN(,@11)                                    0374
         STC   @11,PRTNN(,LSIDPTR)                                 0374
*   SLOT=TSLOTNBR;                  /* STORE RSN IN LSID             */
         MVC   SLOT(2,LSIDPTR),TSLOTNBR+2                          0375
*/*           R RETURN                                               */
*                                                                  0376
*   RFY                                                            0376
*     R14 RSTD;                                                    0376
*   R14=RETADDR2;                   /* RESTORE RETURN REGISTER       */
         L     R14,RETADDR2                                        0377
*   RFY                                                            0378
*     R14 UNRSTD;                                                  0378
*   END SETWRITE;                   /* END SUBROUTINE SETWRITE       */
@EL00011 DS    0H                                                  0379
@EF00011 DS    0H                                                  0379
@ER00011 BR    @14                                                 0379
*/*SETWRITE: END                                                     */
*                                                                  0380
*                                                                  0380
*/*GETREAD: CHART                                                    */
*/* HEADING                                                        0380
*/* ILRSRT - ASM SLOT SORT                                         0380
*/*GETREAD: GET IOE FOR READ REQUEST                                 */
*/********************************************************************/
*/*                                                                  */
*/*      GETREAD:  GET IOE FOR READ REQUEST                          */
*/*                                                                  */
*/*      INPUT: - SLOT VALUE FOUND BY FIND SLOT ROUTINE              */
*/*             - VALUE OF CYLINDER CURRENTLY BEING PROCESSED        */
*/*             - NUBMER OF SLOTS PER CYLINDER                       */
*/*             - PART ENTRY                                         */
*/*             - ADDRESS OF FIRST IOE ON TREE OF READ CYL GROUP     */
*/*                                                                  */
*/*      PROCESS: THE REALTIVE SLOT NUMBER OF THE SLOT FOUND BY THE  */
*/*               FINDSLOT ROUTINE IS COMPUTED. THE IOE CORRESPONDING*/
*/*               TO A REQUEST FOR THAT SLOT IS FOUND AND REMOVED    */
*/*               FROM THE TREE                                      */
*/*                                                                  */
*/*      OUTPUT: - IOE FOR READ REQUEST                              */
*/*              - RSN OF SLOT TO BE READ                            */
*/*                                                                  */
*/********************************************************************/
*/*GETREAD: E GET IOE FOR READ REQUEST                               */
*                                                                  0380
*GETREAD:                                                          0380
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0380
GETREAD  DS    0H                                                  0381
*   RFY                                                            0381
*     R14 RSTD;                                                    0381
*   RETADDR2=R14;                   /* SAVE RETURN ADDRESS           */
         ST    R14,RETADDR2                                        0382
*   RFY                                                            0383
*     R14 UNRSTD;                                                  0383
*   GEN(LM    R2,R7,28(R13));       /* RESTORE FINDSLOT REGS         */
*                                                                  0384
         LM    R2,R7,28(R13)
*   /*****************************************************************/
*   /*                                                               */
*   /* COMPUTE THE PAGING SPACE RELATIVE SLOT NUMBER REPRESENTED BY  */
*   /* THE BIT FOUND VIA THE FINDSLOT ROUTINE                        */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0385
*/*           P COMPUTE RSN OF SLOT FOUND BY FINDSLOT RTN            */
*                                                                  0385
*   TSLOTNBR=THISCYL*CYLSLOTS+SSLOT;/* GET REL SLOT NBR              */
*                                                                  0385
         L     @01,THISCYL                                         0385
         M     @00,CYLSLOTS                                        0385
         AL    @01,SSLOT                                           0385
         ST    @01,TSLOTNBR                                        0385
*   /*****************************************************************/
*   /*                                                               */
*   /* FIND READ REQUEST ON TREE CORRESPONDING TO THE SLOT FOUND BY  */
*   /* THE FINDSLOT ROUTINE                                          */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0386
*/*           P SET UP NODE ADDRS TO SCAN TREE FOR NODE USING SLOT 0386
*/*             FOUND                                                */
*                                                                  0386
*   THISNODE=TOPRDIOE;              /* GET FIRST READ IOE ON TREE FOR
*                                      CURRENT CYL                   */
         L     THISNODE,TOPRDIOE                                   0386
*/*           N LOOP MOVING DOWN TREE ONE NODE AT A TIME             */
*/*%GTR10:    D (NO,,YES,%GTR60) NODE FOUND ?                        */
*                                                                  0387
*   DO WHILE TSLOTNBR^=THISNODE->IOEAIA->AIASLOT;/* FIND IOE         */
*                                                                  0387
         B     @DE00387                                            0387
@DL00387 DS    0H                                                  0388
*     /***************************************************************/
*     /*                                                             */
*     /* WHICH WAY TO MOVE DOWN TREE ---- DEPENDS ON THE SLOT NUMBER */
*     /* REPRESENTED BY THE CURRENT NODE WE ARE EXAMINING            */
*     /*                                                             */
*     /***************************************************************/
*                                                                  0388
*/*           D (YES,,NO,%GTR20) THIS NODE SLOT# > SRCH SLOT# ?      */
*/*           P (,%GTR50) MOVE DOWN TREE ONE NODE: LE PATH           */
*/*%GTR20:    P MOVE DOWN TREE ONE NODE: GT PATH                     */
*                                                                  0388
*     IF THISNODE->IOEAIA->AIASLOT> /* THIS IOE FOR SLOT NBR         */
*         TSLOTNBR THEN             /* GREATER THAN ONE TO FIND ?    */
         L     @12,IOEAIA(,THISNODE)                               0388
         LH    @12,AIASLOT(,@12)                                   0388
         N     @12,@CF02144                                        0388
         C     @12,TSLOTNBR                                        0388
         BNH   @RF00388                                            0388
*       THISNODE=THISNODE->IOENXTLE;/* MOVE DOWN LE LEG OF TREE      */
         L     THISNODE,IOENXTLE(,THISNODE)                        0389
*     ELSE                          /* THIS IOE SLOT NBR LE ?        */
*       THISNODE=THISNODE->IOENXTGT;/* MOVE DOWN GT LEG OF TREE      */
         B     @RC00388                                            0390
@RF00388 L     THISNODE,IOENXTGT(,THISNODE)                        0390
*/*%GTR50:    N (,%GTR10) END LOOP TO FIND READ REQUEST ON TREE      */
*                                                                  0391
*   END;                                                           0391
*                                                                  0391
@RC00388 DS    0H                                                  0391
@DE00387 L     @12,IOEAIA(,THISNODE)                               0391
         LH    @12,AIASLOT(,@12)                                   0391
         N     @12,@CF02144                                        0391
         C     @12,TSLOTNBR                                        0391
         BNE   @DL00387                                            0391
*   /*****************************************************************/
*   /*                                                               */
*   /* CALL REMVNODE TO REMOVE NODE (IOE) FROM THE TREE              */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0392
*/*%GTR60:    S REMVNODE: REMOVE NODE FROM TREE                      */
*                                                                  0392
*   CALL REMVNODE;                  /* REMOVE IOE FROM TREE          */
         BAL   @14,REMVNODE                                        0392
*/*           R RETURN                                               */
*                                                                  0393
*   RFY                                                            0393
*     R14 RSTD;                                                    0393
*   R14=RETADDR2;                   /* RESTORE RETURN REGISTER       */
         L     R14,RETADDR2                                        0394
*   RFY                                                            0395
*     R14 UNRSTD;                                                  0395
*   END GETREAD;                    /* END SUBROUTINE GETREAD        */
@EL00012 DS    0H                                                  0396
@EF00012 DS    0H                                                  0396
@ER00012 BR    @14                                                 0396
*/*GETREAD: END                                                      */
*                                                                  0397
*                                                                  0397
*/*REMVNODE: CHART                                                   */
*/* HEADING                                                        0397
*/* ILRSRT - ASM SLOT SORT                                         0397
*/*REMVNODE: REMOVE NODE (READ REQUEST) FROM TREE                    */
*/********************************************************************/
*/*                                                                  */
*/*      REMVNODE:   REMOVE NODE (READ REQUEST) FROM TREE            */
*/*                                                                  */
*/*      INPUT: - ADDRESS OF IOE TO BE REMOVED FROM TREE             */
*/*             - PART ENTRY                                         */
*/*                                                                  */
*/*      PROCESS: IN SHORT THE ROUTINE REMOVES THE IOE FROM THE TREE */
*/*               BY RECHAINING THOSE NODES HANGING FROM IT TO NEW   */
*/*               LOCATIONS IN THE TREE.                             */
*/*                                                                  */
*/*               RULES:                                             */
*/*               1) IF NO NODES HANG FROM THE TARGET NODE, THE      */
*/*                  PROCEDURE SIMPLY ZEROS THE APPROPRIATE LEG      */
*/*                  POINTER IN THE TARGET ANCESTOR NODE.            */
*/*                                                                  */
*/*               2) IF ONLY ONE LEG OF NODES HANG FROM THE TARGET   */
*/*                  NODE THEN THE LEG IS RECHAINED TO THE TARGET    */
*/*                  ANCESTOR NODE VIA THE SAME POINTER THAT ONCE    */
*/*                  ADDRESSED THE TARGET NODE.                      */
*/*                                                                  */
*/*               3) IF TWO LEGS OF NODES HANG FROM THE TARGET NODE  */
*/*                  THE PROCEDURE IS MORE COMPLEX. IF THE TARGET    */
*/*                  NODE HANGS ON ITS ANCESTORS GT LEG THEN ITS LE  */
*/*                  LEG IS RECHAINED VIA THE ANCESTOR GT LEG POINTER*/
*/*                  THE GT LEG OFF THE TARGET IS RECHAINED TO THE   */
*/*                  LAST NODE ON THE GT LEG HANGING OFF THE FIRST   */
*/*                  NODE NEWLY CHAINED (SEE ABOVE SENTENCE) TO THE  */
*/*                  TARGET ANCESTOR. THE PROCEDURE IS EXACTLY       */
*/*                  REVERSED (IE REPALCE GT WITH LE AND LE WITH GT) */
*/*                  IF THE TARGET NODE IS HANGING ON ITS ANCESTORS  */
*/*                  LE LEG.                                         */
*/*                                                                  */
*/*               4) IF THE TARGET NODE IS THE TOP NODE ON THE TREE  */
*/*                  THE RECHAINING IS DONE AS ABOVE. THE PROCEDURE  */
*/*                  OPERATES AS IF THE TARGET IS CHAINED ON THE GT  */
*/*                  LEG OF IT ANCESTOR.                             */
*/*                                                                  */
*/*               5) IF THE TARGET NODE IS THE ONLY NODE ON THE TREE */
*/*                  THE TREE ANCHOR IN THE PART ENTRY IS ZEROED.    */
*/*                                                                  */
*/*               6) COMPLETE RECHAINING OF ALL NODES INCLUDES  RE-  */
*/*                  SETTING THE BACKWARD POINTER IN THE FIRST NODE  */
*/*                  OF A RECHAINED LEG.                             */
*/*                                                                  */
*/*      OUTPUT: - IOE FREED FORM TREE                               */
*/*              - RESET POINTERS IN NODES AFFECTED BY RECHAINING    */
*/*                                                                  */
*/********************************************************************/
*/*REMVNODE:  E REMOVE READ REQ FROM TREE                            */
*                                                                  0397
*REMVNODE:                                                         0397
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0397
REMVNODE DS    0H                                                  0398
*   RFY                                                            0398
*     R14 RSTD;                                                    0398
*   RETADDR3=R14;                   /* SAVE RETURN ADDRESS           */
         ST    R14,RETADDR3                                        0399
*   RFY                                                            0400
*     R14 UNRSTD;                                                  0400
*                                                                  0400
*   /*****************************************************************/
*   /*                                                               */
*   /* OBJECT: TO REMOVE A NODE FROM THE TREE AND TO RECHAIN ANY     */
*   /* NODES HANGING FROM IT. ---------- FIRST OBTAIN ADDRESSES OF   */
*   /* THE TARGET NODE AND THE TWO POSSIBLE NODES HANGING FROM IT    */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0401
*/*           M OBTAIN ADDRS OF NODES HANGING FROM TARGET            */
*                                                                  0401
*   IOEPTR=THISNODE;                /* SET IOE ADDRESS               */
         LR    IOEPTR,THISNODE                                     0401
*   NEXTGT=IOENXTGT;                /* GET NEXT NODE DOWN GT PATH    */
         L     NEXTGT,IOENXTGT(,IOEPTR)                            0402
*   NEXTLE=IOENXTLE;                /* GET NEXT NODE DOWN LE PATH    */
         L     NEXTLE,IOENXTLE(,IOEPTR)                            0403
*/*           P OBTAIN ADDRESS OF NODE TO WHICH TARGET IS CHAINED    */
*                                                                  0404
*   LASTNODE=IOEBKPTR;                                             0404
*                                                                  0404
         L     LASTNODE,IOEBKPTR(,IOEPTR)                          0404
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THE TARGET NODE IS CHAINED TO ITS ANCESTOR ON THE GT LEG,  */
*   /* --- OR --- THE TARGET NODE IS THE TOP NODE IN THE TREE, THEN  */
*   /* THE PROCEDURE IS TO CHAIN THE NODE ON THE TARGET'S LE LEG     */
*   /* (DAUGHTER-LE-NODE) TO THE TARGET ANCESTOR, THEN TO RECHAIN THE*/
*   /* NODE ON THE TARGET'S GT LEG (DAUGHTER-GT-NODE) TO THE LAST    */
*   /* NODE ON THE DAUGHTER-LE-NODE'S GT LEG. THIS PROCEDURE IS      */
*   /* EXACTLY REVERSED IF THE TARGET IS CHAINED TO ITS ANCESTOR VIA */
*   /* THE LE LEG. THIS TENDS TO MOVE THE NODES FROM THE INNER PART  */
*   /* OF THE TREE TO THE OUTER LEGS AND GUARANTEES THAT NODES       */
*   /* REPRESENTING REQUESTS FOR THE SAME CYLINDER WILL REMAIN       */
*   /* ADJACENT TO EACH OTHER. (ADJACENCY PREVIOUSLY GUARANTEED BY   */
*   /* THE SORTING TECHNIQUE EMPLOYED IN SUBROUTINES SORTREAD AND    */
*   /* ADRTTREE).                                                    */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0405
*/*           D (YES,,NO,%RMN50) TARGET NODE ON ANCESTOR GT LEG ?    */
*/*           N ABOVE DECISION INCLUDES CASE WHERE TARGET IS TOP   0405
*/*             NODE ON THE TREE                                     */
*                                                                  0405
*   IF LASTNODE=ZERO×               /* TARGET ON TOP OF TREE ? OR    */
*       LASTNODE->IOENXTGT=IOEPTR THEN/* IOE HUNG ON GT LEG ?        */
         LTR   LASTNODE,LASTNODE                                   0405
         BZ    @RT00405                                            0405
         C     IOEPTR,IOENXTGT(,LASTNODE)                          0405
         BNE   @RF00405                                            0405
@RT00405 DS    0H                                                  0406
*     DO;                                                          0406
*                                                                  0406
*/*           D (YES,,NO,%RMN30) LE NODE HANGING FROM TARGET ?       */
*                                                                  0407
*       IF NEXTLE^=ZERO THEN        /* NODE EXISTS DOWN LE PATH ?    */
         LTR   NEXTLE,NEXTLE                                       0407
         BZ    @RF00407                                            0407
*         DO;                                                      0408
*                                                                  0408
*           /*********************************************************/
*           /*                                                       */
*           /* RECHAIN EXISTING DAUGHTER-LE-NODE TO TARGET'S ANCESTOR*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  0409
*/*           N RCHAINUP CHAINS DAUGHTER LE NODE TO TARGET ANCESTOR  */
*/*           S RCHAINUP: RECHAIN DAUGHTER LE NODE                   */
*                                                                  0409
*           NEXTNODE=NEXTLE;        /* PRESET NEXTNODE FOR REMOVE    */
         LR    NEXTNODE,NEXTLE                                     0409
*           CALL RCHAINUP;          /* REMOVE NODE, RECHAIN LE LEG   */
         BAL   @14,RCHAINUP                                        0410
*/*           D (YES,,NO,%RMN80) GT NODE HANGING FROM TARGET ?       */
*                                                                  0411
*           IF NEXTGT^=ZERO THEN    /* NODE ALSO EXISTS DOWN GT PATH
*                                      ?                             */
         LTR   NEXTGT,NEXTGT                                       0411
         BZ    @RF00411                                            0411
*             DO;                                                  0412
*                                                                  0412
*               /*****************************************************/
*               /*                                                   */
*               /* OBTAIN ADDRESS OF LAST NODE ON THE                */
*               /* DAUGHTER-LE-NODE GT LEG AND CHAIN THE             */
*               /* DAUGHTER-GT-NODE TO IT                            */
*               /*                                                   */
*               /*****************************************************/
*                                                                  0413
*/*           N GET ADDR OF LAST NODE ON DAUGHTER LE NODE'S GT LEG   */
*/*%RMN10:    D (YES,,NO,%RMN15) ANOTHER NODE DOWN GT LEG ?          */
*/*           P MOVE DOWN GT LEG ONE NODE                            */
*/*           N (,%RMN10) END LOOP TO MOVE DOWN TO END OF GT LEG     */
*                                                                  0413
*               THISNODE=NEXTLE;    /* RESET THISNODE FOR GT SCAN    */
         LR    THISNODE,NEXTLE                                     0413
*               DO WHILE THISNODE->IOENXTGT^=ZERO;/* GO TO LAST NODE */
         B     @DE00414                                            0414
@DL00414 DS    0H                                                  0415
*                 THISNODE=THISNODE->IOENXTGT;/* DOWN GT PATH 1 NODE */
         L     THISNODE,IOENXTGT(,THISNODE)                        0415
*               END;                                               0416
*                                                                  0416
@DE00414 L     @11,IOENXTGT(,THISNODE)                             0416
         LTR   @11,@11                                             0416
         BNZ   @DL00414                                            0416
*/*%RMN15:    P (,%RMN80) RECHAIN DAUGHTER GT NODE TO LAST NODE ON GT
*/*                       LEG                                        */
*                                                                  0417
*               THISNODE->IOENXTGT=NEXTGT;/* RESET END NODE GT LEG   */
         ST    NEXTGT,IOENXTGT(,THISNODE)                          0417
*               NEXTGT->IOEBKPTR=THISNODE;/* RESET BACKWARD PTR      */
         ST    THISNODE,IOEBKPTR(,NEXTGT)                          0418
*             END;                  /* END NODE-DOWN-LE-&-GT-PATHS   */
*           ELSE                                                   0420
*             ;                     /* NODE DOWN LE BUT NOT GT ?     */
@RF00411 DS    0H                                                  0421
*         END;                      /* END NODE-DOWN-LE-PATH         */
*       ELSE                        /* NO NODE DOWN LE PATH ?        */
*                                                                  0422
*         /***********************************************************/
*         /*                                                         */
*         /* IF NO NODE IS HANGING ON THE LE LEG FROM THE TARGET NODE*/
*         /* THEN SIMPLY RECHAIN THE NODE HANGING ON THE GT PATH, IF */
*         /* ANY, TO THE TARGET'S ANCESTOR                           */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0422
*/*%RMN30:    N RCHAINUP CHAINS DAUGHTER GT NODE TO TARGET ANCESTOR  */
*/*           S (,%RMN80) RCHAINUP: RECHAIN DAUGHTER GT NODE         */
*                                                                  0422
*         DO;                                                      0422
         B     @RC00407                                            0422
@RF00407 DS    0H                                                  0423
*           NEXTNODE=NEXTGT;        /* PRESET NEXTNODE FOR REMOVE    */
         LR    NEXTNODE,NEXTGT                                     0423
*           CALL RCHAINUP;          /* REMOVE NODE, RECHAIN GT LEG   */
         BAL   @14,RCHAINUP                                        0424
*         END;                      /* END NODE-DOWN-GT-BUT-NOT-LE   */
*     END;                          /* END IOE-HUNG-ON-GT-PATH       */
*   ELSE                            /* IOE HUNG ON LE PATH ?         */
*                                                                  0427
*     /***************************************************************/
*     /*                                                             */
*     /* -------------------- BELOW IS THE SAME PROCEDURE AS ABOVE;  */
*     /* ONLY THIS TIME, THE TARGET NODE IS HANGING ON ITS ANCESTORS */
*     /* LE LEG. (SEE ABOVE)                                         */
*     /*                                                             */
*     /***************************************************************/
*                                                                  0427
*/*%RMN50:    D (YES,,NO,%RMN80) TARGET NODE ON ANCESTOR LE LEG ?    */
*                                                                  0427
*     DO;                                                          0427
*                                                                  0427
         B     @RC00405                                            0427
@RF00405 DS    0H                                                  0428
*/*           D (YES,,NO,%RMN70) GT NODE HANGING FROM TARGET ?       */
*                                                                  0428
*       IF NEXTGT^=ZERO THEN        /* NODE EXISTS DOWN GT PATH ?    */
         LTR   NEXTGT,NEXTGT                                       0428
         BZ    @RF00428                                            0428
*         DO;                                                      0429
*                                                                  0429
*           /*********************************************************/
*           /*                                                       */
*           /* RECHAIN EXISTING DAUGHTER-GT-NODE TO TARGET'S ANCESTOR*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  0430
*/*           N RCHAINUP CHAINS DAUGHTER GT NODE TO TARGET ANCESTOR  */
*/*           S RCHAINUP: RECHAIN DAUGHTER GT NODE                   */
*                                                                  0430
*           NEXTNODE=NEXTGT;        /* PRESET NEXTNODE FOR REMOVE    */
         LR    NEXTNODE,NEXTGT                                     0430
*           CALL RCHAINUP;          /* REMOVE NODE, RECHAIN GT LEG   */
         BAL   @14,RCHAINUP                                        0431
*/*           D (YES,,NO,%RMN80) LE NODE HANGING FROM TARGET ?       */
*                                                                  0432
*           IF NEXTLE^=ZERO THEN    /* NODE ALSO EXISTS DOWN LE PATH
*                                      ?                             */
         LTR   NEXTLE,NEXTLE                                       0432
         BZ    @RF00432                                            0432
*             DO;                                                  0433
*                                                                  0433
*               /*****************************************************/
*               /*                                                   */
*               /* OBTAIN ADDRESS OF LAST NODE ON THE                */
*               /* DAUGHTER-GT-NODE LE LEG AND CHAIN THE             */
*               /* DAUGHTER-LE-NODE TO IT                            */
*               /*                                                   */
*               /*****************************************************/
*                                                                  0434
*/*           N GET ADDR OF LAST NODE ON DAUGHTER GT NODE'S LE LEG   */
*/*%RMN55:    D (YES,,NO,%RMN60) ANOTHER NODE DOWN LE LEG ?          */
*/*           P MOVE DOWN LE LEG ONE NODE                            */
*/*           N (,%RMN55) END LOOP TO MOVE DOWN TO END OF LE LEG     */
*                                                                  0434
*               THISNODE=NEXTGT;    /* RESET THISNODE FOR LE SCAN    */
         LR    THISNODE,NEXTGT                                     0434
*               DO WHILE THISNODE->IOENXTLE^=ZERO;/* GO TO LAST NODE */
         B     @DE00435                                            0435
@DL00435 DS    0H                                                  0436
*                 THISNODE=THISNODE->IOENXTLE;/* DOWN LE PATH 1 NODE */
         L     THISNODE,IOENXTLE(,THISNODE)                        0436
*               END;                                               0437
*                                                                  0437
@DE00435 L     @11,IOENXTLE(,THISNODE)                             0437
         LTR   @11,@11                                             0437
         BNZ   @DL00435                                            0437
*/*%RMN60:    P (,%RMN80) RECHAIN DAUGHTER LE NODE TO LAST NODE ON LE
*/*                       LEG                                        */
*                                                                  0438
*               THISNODE->IOENXTLE=NEXTLE;/* RESET END NODE LE LEG   */
         ST    NEXTLE,IOENXTLE(,THISNODE)                          0438
*               NEXTLE->IOEBKPTR=THISNODE;/* RESET BACKWARD PTR      */
         ST    THISNODE,IOEBKPTR(,NEXTLE)                          0439
*             END;                  /* END NODE-DOWN-LE-&-GT-PATHS   */
*           ELSE                                                   0441
*             ;                     /* NODE DOWN GT BUT NOT LE ?     */
@RF00432 DS    0H                                                  0442
*         END;                      /* END NODE-DOWN-GT-PATH         */
*       ELSE                        /* NO NODE DOWN GT PATH ?        */
*                                                                  0443
*         /***********************************************************/
*         /*                                                         */
*         /* IF NO NODE IS HANGING ON THE GT LEG FROM THE TARGET NODE*/
*         /* THEN SIMPLY RECHAIN THE NODE HANGING ON THE LE PATH, IF */
*         /* ANY, TO THE TARGET'S ANCESTOR                           */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0443
*/*%RMN70:    N RCHAINUP CHAINS DAUGHTER LE NODE TO TARGET ANCESTOR  */
*/*           S (,%RMN80) RCHAINUP: RECHAIN DAUGHTER LE NODE         */
*                                                                  0443
*         DO;                                                      0443
         B     @RC00428                                            0443
@RF00428 DS    0H                                                  0444
*           NEXTNODE=NEXTLE;        /* PRESET NEXTNODE FOR REMOVE    */
         LR    NEXTNODE,NEXTLE                                     0444
*           CALL RCHAINUP;          /* REMOVE NODE, RECHAIN LE LEG   */
         BAL   @14,RCHAINUP                                        0445
*         END;                      /* END NODE-DOWN-LE-BUT-NOT-GT   */
*     END;                          /* END IOE-HUNG-ON-LE-PATH       */
@RC00428 DS    0H                                                  0448
*/*%RMN80:    R RETURN                                               */
*                                                                  0448
*   RFY                                                            0448
*     R14 RSTD;                                                    0448
@RC00405 DS    0H                                                  0449
*   R14=RETADDR3;                   /* RESTORE RETURN ADDRESS        */
         L     R14,RETADDR3                                        0449
*   RFY                                                            0450
*     R14 UNRSTD;                                                  0450
*   END REMVNODE;                   /* END SUBROUTINE REMVNODE       */
@EL00013 DS    0H                                                  0451
@EF00013 DS    0H                                                  0451
@ER00013 BR    @14                                                 0451
*/*REMVNODE: END                                                     */
*                                                                  0452
*                                                                  0452
*/*RCHAINUP: CHART                                                   */
*/* HEADING                                                        0452
*/* ILRSRT - ASM SLOT SORT                                         0452
*/*RCHAINUP: RECHAIN NODE UPWARD ONE NODE IN TREE                    */
*/********************************************************************/
*/*                                                                  */
*/*      RCHAINUP:  RECHAIN NODE, WHOSE ANCESTOR IS BEING REMOVED    */
*/*                 FROM THE TREE, TO ITS ANCESTOR'S ANCESTOR        */
*/*                                                                  */
*/*      INPUT: - ADDRESS OF NODE TO BE RECHAINED                    */
*/*             - ADDRESS OF NODE TO WHICH IT IS TO BE CHAINED       */
*/*             - PART ENTRY                                         */
*/*                                                                  */
*/*      PROCESS: THE ADDRESS OF THE NODE TO BE RECHAINED IS PLACED  */
*/*               INTO THE APPROPRIATE LEG POINTER OF THE NEW ANCES- */
*/*               TOR NODE. IF THE NEW ANCESTOR IS NON-EXISTANT, IE. */
*/*               THIS NODE WILL BECOME THE NEW TOP NODE IN THE TREE,*/
*/*               THE PART ENTRY TREE ANCHOR POINTER IS RESET. THE   */
*/*               BACKWARD POINTER IN THE NODE TO BE RECHAINED IS    */
*/*               SET TO ADDRESS THE NEW ANCESTOR (SET TO ZERO IF    */
*/*               NO ANCESTOR EXISTS). IF THE TARGET NODE THAT IS    */
*/*               BEING REMOVED FROM THE TREE WAS THE TOP NODE OF A  */
*/*               READ CYLINDER GROUP THE TOP NODE POINTER IS RESET  */
*/*               TO ADDRESS THIS NODE BEING RECHAINED.              */
*/*                                                                  */
*/*      OUTPUT: - UPDATED POINTERS IN RECHAINED NODE AND IT NEW     */
*/*                ANCESOTR                                          */
*/*              - UPDATED PART ENTRY TREE ANCHOR POINTER IN SOME    */
*/*               CASES                                              */
*/*              - UPDATED TOP NODE IN READ CYLINDER GROUP POINTER IN*/
*/*                SOME CASES                                        */
*/*                                                                  */
*/********************************************************************/
*/*RCHAINUP: E RECHAIN NODE UP IN TREE                               */
*                                                                  0452
*RCHAINUP:                                                         0452
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0452
RCHAINUP DS    0H                                                  0453
*   RFY                                                            0453
*     R14 RSTD;                     /* RESTRICT RETURN REGISTER      */
*                                                                  0453
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THE TARGET NODE BEING REMOVED FROM THE TREE IS THE TOP NODE*/
*   /* OF THE TREE, SIMPLY RESET THE PART ENTRY ANCHOR POINTER TO THE*/
*   /* NEXT NODE CHOSEN BY REMVNODE. OTHERWISE, CHAIN THE NEXT NODE  */
*   /* TO THE APPROPRIATE LEG OF THE TARGET NODE'S ANCESTOR          */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0454
*/*           D (NO,,YES,%RCU40) TARGET IOE AT TOP OF TREE ?         */
*                                                                  0454
*   IF LASTNODE^=ZERO THEN          /* NOT AT TOP OF TREE ?          */
         LTR   LASTNODE,LASTNODE                                   0454
         BZ    @RF00454                                            0454
*     DO;                                                          0455
*                                                                  0455
*/*           D (YES,,NO,%RCU20) TARGET IOE ON ANCESTORS GT LEG ?    */
*                                                                  0456
*       IF LASTNODE->IOENXTGT=IOEPTR THEN/* IOE HUNG ON GT LEG ?     */
         C     IOEPTR,IOENXTGT(,LASTNODE)                          0456
         BNE   @RF00456                                            0456
*/*        P (,%RCU40) RECHAIN NEXT NODE TO TARGET ANCESTORS GT LEG  */
*                                                                  0457
*         LASTNODE->IOENXTGT=NEXTNODE;/* RESET NEXTNODE GT LEG       */
         ST    NEXTNODE,IOENXTGT(,LASTNODE)                        0457
*       ELSE                        /* IOE HUNG ON LE LEG ?          */
*/*%RCU20: P (,%RCU40) RECHAIN NEXT NODE TO TARGET ANCESTORS LE LEG  */
*                                                                  0458
*         LASTNODE->IOENXTLE=NEXTNODE;/* RESET NEXTNODE LE LEG       */
         B     @RC00456                                            0458
@RF00456 ST    NEXTNODE,IOENXTLE(,LASTNODE)                        0458
*     END;                                                         0459
*   ELSE                            /* AT TOP OF TREE ?              */
*/*%RCU30:    P RECHAIN NEXT NODE TO PART ENTRY TREE ANCHOR          */
*                                                                  0460
*     PARENODE=NEXTNODE;            /* RESET TREE ANCHOR             */
*                                                                  0460
         B     @RC00454                                            0460
@RF00454 L     @15,PAREPTR                                         0460
         ST    NEXTNODE,PARENODE(,@15)                             0460
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THE NEXT NODE ACTUALLY EXISTS (THE POINTER MAY BE ZERO)    */
*   /* THEN RESET ITS BACKWARD POINTER                               */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0461
*/*%RCU40:    D (NO,,YES,%RCU50) NEXT NODE POINTER ZERO ?            */
*                                                                  0461
*   IF NEXTNODE^=ZERO THEN                                         0461
*                                                                  0461
@RC00454 LTR   NEXTNODE,NEXTNODE                                   0461
         BZ    @RF00461                                            0461
*/*           P RESET BACKWARD POINTER IN NEXT NODE TO NEW ANCESTOR  */
*                                                                  0462
*     NEXTNODE->IOEBKPTR=LASTNODE;  /* RE-BACKWARD CHAIN NEXTNODE    */
         ST    LASTNODE,IOEBKPTR(,NEXTNODE)                        0462
*   ELSE                                                           0463
*     ;                                                            0463
*                                                                  0463
@RF00461 DS    0H                                                  0464
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THE IOE JUST REMOVED FROM THE TREE IS THE FIRST IOE IN A   */
*   /* GROUP (1 OR MORE) OF IOES FOR READS FROM A SPECIFIC CYLINDER, */
*   /* THEN RESET THE TOP-READ-IOE PTR FOR THE GROUP                 */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0464
*/*%RCU50:    D (YES,,NO,%RCU80) TARGET IOE TOP READ FOR CYL ?       */
*/*           P RESET TOP READ-CYL IOE POINTER TO THE NEXT NODE      */
*                                                                  0464
*   IF IOEPTR=TOPRDIOE THEN         /* JUST REMOVED TOP READ REQ FROM
*                                      TREE FOR CURRENT CYL ?        */
         C     IOEPTR,TOPRDIOE                                     0464
         BNE   @RF00464                                            0464
*     TOPRDIOE=NEXTNODE;            /* RESET PTR TO TOP READ IOE     */
         ST    NEXTNODE,TOPRDIOE                                   0465
*   ELSE                                                           0466
*     ;                                                            0466
*                                                                  0466
@RF00464 DS    0H                                                  0467
*/*           L **** FRR **** IOE BEING REMOVED FROM TREE            */
*                                                                  0467
*   EPAIOEIP=IOEPTR;                /* TELL RECOV CURRENT IOE        */
         ST    IOEPTR,EPAIOEIP(,EPAPTR)                            0467
*/*%RCU80:    R RETURN                                               */
*                                                                  0468
*   RFY                                                            0468
*     R14 UNRSTD;                   /* RELEASE RETURN REGISTER       */
*   END RCHAINUP;                   /* END SUBROUTINE RCHAINUP       */
@EL00014 DS    0H                                                  0469
@EF00014 DS    0H                                                  0469
@ER00014 BR    @14                                                 0469
*/*RCHAINUP: END                                                     */
*                                                                  0470
*                                                                  0470
*/*GETPCCW: CHART                                                    */
*/* HEADING                                                        0470
*/* ILRSRT - ASM SLOT SORT                                         0470
*/*                             GET A PCCW FROM ASMVT QUEUE          */
*/********************************************************************/
*/*                                                                  */
*/*      GETPCCW:  GET A PCCW FROM THE ASMVT QUEUE                   */
*/*                                                                  */
*/*      INPUT: - PARAMETER LIST FROM ILRPMT00                       */
*/*             - ASMVT                                              */
*/*                                                                  */
*/*      PROCESS: VIA C&S A PCCW IS REMOVED FROM THE ASMVT PCCW      */
*/*               AVAILABLE QUEUE AND ITS ADDRESS STORED IN THE PART */
*/*               MONITOR PARAMETER LIST                             */
*/*                                                                  */
*/*      OUTPUT: - UPDATED PART MONITOR PARAMETER LIST               */
*/*              - PCCW IF ANY AVAILABLE                             */
*/*              - STOP INDICATOR SET IF NO PCCW AVAILABLE           */
*/*                                                                  */
*/********************************************************************/
*/*GETPCCW:   E GET A PCCW FROM THE ASMVT QUEUE                      */
*                                                                  0470
*GETPCCW:                                                          0470
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0470
GETPCCW  DS    0H                                                  0471
*   RFY                                                            0471
*     R14 RSTD;                                                    0471
*   RETADDR3=R14;                   /* SAVE RETURN ADDR TO MAINLINE  */
         ST    R14,RETADDR3                                        0472
*/*           P SET POINTER TO NEXT PCCW ON ASMVT QUEUE              */
*                                                                  0473
*   RFY                                                            0473
*    (R15) RSTD;                                                   0473
*   LM(R14,R15,ASMPCCWQ);                                          0474
*                                                                  0474
         LM    R14,R15,ASMPCCWQ(ASMVTPTR)                          0474
*/*IBCLOOP:   D (YES,,NO,%GBC70) ANY MORE PCCWS ?                    */
*                                                                  0475
*IBCLOOP:                                                          0475
*   IF R14^=ZERO THEN                                              0475
IBCLOOP  LTR   R14,R14                                             0475
         BZ    @RF00475                                            0475
*     DO;                                                          0476
*                                                                  0476
*/*           P REMOVE A PCCW FROM QUEUE (C&S)                       */
*                                                                  0477
*       RFY                                                        0477
*        (R0,                                                      0477
*         R1) RSTD;                                                0477
*       R0=R14->PCCWPCCW;           /* SET PTR TO NEXT PCCW          */
         L     R0,PCCWPCCW(,R14)                                   0478
*       R1=R15-ONE;                 /* DECREMENT PCCW QUEUE CNT      */
         LR    R1,R15                                              0479
         BCTR  R1,0                                                0479
*       CDS(R14,R0,ASMPCCWQ);       /* REMOVE A PCCW FROM QUEUE      */
         CDS   R14,R0,ASMPCCWQ(ASMVTPTR)                           0480
*/*           D (YES,%GBC90,NO,IBCLOOP) SUCCESSFUL ?                 */
*                                                                  0481
*       BC(NE,IBCLOOP);             /* IF UNSUCCESSFUL, TRY AGAIN    */
         BC    7,IBCLOOP                                           0481
*       PTRPCCW=R14;                /* SAVE PTR TO NEXT PCCW         */
         L     @12,PRMLADDR                                        0482
         ST    R14,PTRPCCW(,@12)                                   0482
*     END;                                                         0483
*   ELSE                                                           0484
*                                                                  0484
*/*%GBC70:    P  SET FLAG TO STOP PROCESSING REQUESTS                */
*                                                                  0484
*     STOP=YES;                     /* NO MORE REQUESTS MAY BE     0484
*                                      PROCESSED                     */
         B     @RC00475                                            0484
@RF00475 OI    STOP,B'10000000'                                    0484
*   RFY                                                            0485
*    (R0,                                                          0485
*     R1,                                                          0485
*     R15) UNRSTD;                                                 0485
*                                                                  0485
@RC00475 DS    0H                                                  0486
*/*%GBC90:   R RETURN                                                */
*                                                                  0486
*   R14=RETADDR3;                   /* RESTORE RETURN ADDRESS        */
         L     R14,RETADDR3                                        0486
*   RFY                                                            0487
*     R14 UNRSTD;                                                  0487
*   END GETPCCW;                                                   0488
*                                                                  0488
@EL00015 DS    0H                                                  0488
@EF00015 DS    0H                                                  0488
@ER00015 BR    @14                                                 0488
*/*GETPCCW: END                                                      */
*                                                                  0489
*                                                                  0489
*/*IOCHAIN:   CHART                                                  */
*/* HEADING                                                        0489
*/* ILRSRT - ASM SLOT SORT                                         0489
*/*                     IOCHAIN ROUTINE - MOVE REQUEST TO IORB CHAIN */
*/********************************************************************/
*/*                                                                  */
*/*      IOCHAIN: CHAIN PCCW TO IORB I/O REQUEST QUEUE               */
*/*                                                                  */
*/*      INPUT: PCCWPTR POINTING TO REQUEST SELECTED,                */
*/*                LASTP POINTING TO LAST PCCW CHAINED TO IORB       */
*/*                                                                  */
*/*      PROCESS: PCCW FOR THE REQUEST IS PLACED ON THE CHAIN FROM   */
*/*               IORB. THE ADDRESS OF THE PCCW IS SAVED SO THAT     */
*/*               ANY FURTHER PCCWS MAY BE CHAINED TO IT.            */
*/*               PCCW INITIALIZED AND CHAINED TO PREVIOUS PCCW      */
*/*                                                                  */
*/*      OUTPUT: - PCCW CHAINED TO IORB                              */
*/*              - PCCW INITIALIZED FOR READ/WRITE                   */
*/*              - ADDRESS OF LAST CHAINED PCCW SAVED                */
*/*                                                                  */
*/********************************************************************/
*/*IOCHAIN:   E INIT + CHAIN PCCW TO IORB                            */
*                                                                  0489
*IOCHAIN:                                                          0489
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0489
IOCHAIN  DS    0H                                                  0490
*   RFY                                                            0490
*     R14 RSTD;                     /* RESTRICT RETURN REG           */
*   RETADDR3=R14;                   /* SAVE RETURN ADDRESS           */
         ST    R14,RETADDR3                                        0491
*   RFY                                                            0492
*     R14 UNRSTD;                                                  0492
*                                                                  0492
*/*INITPCCW:  N INITIALIZE A PCCW                                    */
*/* P SET IORB ADDR                                                  */
*/* P TURN OFF ERROR FLAGS                                           */
*/* P INIT BUFFER ADDRESS                                            */
*/* P INITIALIZE AIA PTR                                             */
*/*%IBC10: D (NO,,YES,%IBC40) READ REQUEST?                          */
*/*%IBC60: P (,%IBC90) SET WRITE INDICATOR                           */
*/*%IBC40: P SET READ FLAG                                           */
*/*%IBC90:   N INITPCCW COMPLETE                                     */
*/* P ZERO NEXT-PCCW PTR IN CURRENT PCCW FOR RECOVERY                */
*/* P UPDATE NUMBER OF PCCWS                                         */
*/* P SET UP FOR ILRCNVRT MACRO                                      */
*/* S ILRCNVRT: CONVERT RBA TO MBBCCHHR                              */
*/* D (YES,,NO,%IBC200) CONVERT OK?                                  */
*/* D (YES,,NO,%IBC50) FIRST PCCW?                                   */
*/* P SET UP IOSB FIELDS- IOSEEK IOSRST IOSVST IOSEEKA               */
*/* P INDICATE SKIP SEEK                                             */
*/* D (YES,%IBC70,NO,) RPS DEVICE?                                   */
*/* P (,%IBC66) INDICATE SKIP SET SECTOR IOSRST                      */
*/*%IBC70: P INDICATE DO SET SECTOR IOSRST                           */
*/* P SET UP SECTOR VALUE                                            */
*/*%IBC66: P SET IOSVST TO IOSRST                                    */
*/*%IBC99:  P SET UP PREV CYL, TRK, REC                              */
*/*%IBC100: R RETURN                                                 */
*/*%IBC50: P CHAIN PCCW TO PREVIOUS PCCW                             */
*/* D (YES,,NO,%IBC52) SAME CYLINDER AS LAST TIME?                   */
*/* D (YES,,NO,%IBC53) SAME TRACK AS LAST TIME?                      */
*/* P INDICATE SKIP SEEK                                             */
*/*%IBC55: D (YES,,NO,%IBC57) RPS DEVICE?                            */
*/* D (YES,,NO,%IBC57) CAN WE DO SET SECTOR?                         */
*/* P SET UP SET SECTOR CCW                                          */
*/* P (,%IBC99) INDICATE DOING SET SECTOR                            */
*/*%IBC52: P (,%IBC69) SET UP SEEK CYLINDER                          */
*/*%IBC57: P (,%IBC99) CHANGE SET SECTOR TO TIC                      */
*/*%IBC69: D (YES,,NO,%IBC55) RPS DEVICE?                            */
*/* P  (,%IBC55) INDICATE DOING SET SECTOR                           */
*/*%IBC53: P (,%IBC55) SET UP SEEK HEAD                              */
*/*%IBC200: R ABEND X'083'                                           */
*/*IOCHAIN:   END                                                    */
*                                                                  0493
*   AIAPTR=IOEAIA;                  /* GET ADDRESS OF AIA            */
         L     AIAPTR,IOEAIA(,IOEPTR)                              0493
*   IORBPTR=PTRIORB;                /* ADDR OF IORB                  */
         L     @11,PRMLADDR                                        0494
         L     @07,PTRIORB(,@11)                                   0494
         ST    @07,IORBPTR                                         0494
*   RESPECIFY                                                      0495
*     IORB BASED(IORBPTR);                                         0495
*   PCCWPTR=PTRPCCW;                /* WORK WITH NEW PCCW            */
         L     PCCWPTR,PTRPCCW(,@11)                               0496
*   IOEAIA=0;                       /* ZERO FOR RECOVERY     @ZA28762*/
         SLR   @11,@11                                             0497
         ST    @11,IOEAIA(,IOEPTR)                                 0497
*   PCCWAIA=AIAPTR;                 /* STORE ADDRESS OF AIA  @ZA28762*/
         ST    AIAPTR,PCCWAIA(,PCCWPTR)                            0498
*   PCCWIORB=IORBPTR;               /* ADDRESS OF ASSOCIATED IORB    */
         ST    @07,PCCWIORB(,PCCWPTR)                              0499
*   PCCWFERR=BITOFF;                /* INDICATE NO ERROR             */
         NI    PCCWFERR(PCCWPTR),B'01111111'                       0500
*   PCBPTR=AIAPTR-(LENGTH(PCB)-LENGTH(AIA));/* ADDRESS PAGE CONTROL
*                                      BLOCK                         */
         LR    PCBPTR,AIAPTR                                       0501
         SL    PCBPTR,@CF01189                                     0501
*   RFY                                                            0502
*     R7 RSTD;                                                     0502
*   R7=PCBRBN;                      /* STORE REAL BLK NBR            */
         LH    R7,PCBRBN(,PCBPTR)                                  0503
         N     R7,@CF02144                                         0503
*   SLL(R7,8);                      /* CONVERT RBN TO REAL ADDRESS   */
         SLL   R7,8                                                0504
*   PCCWADDR=R7;                    /* PLACE IN PCCW                 */
         STCM  R7,7,PCCWADDR(PCCWPTR)                              0505
*   RFY                                                            0506
*     R7 UNRSTD;                                                   0506
*   IF AIAWRITE=OFF THEN            /* READ REQUEST ?                */
         TM    AIAWRITE(AIAPTR),B'10000000'                        0507
         BNZ   @RF00507                                            0507
*     PCCWRDWT=READOP;              /* INDICATE READ REQUEST         */
         MVI   PCCWRDWT(PCCWPTR),X'06'                             0508
*   ELSE                            /* NOT READ                      */
*     PCCWRDWT=WRITEOP;             /* INDICATE WRITE REQUESTED      */
         B     @RC00507                                            0509
@RF00507 MVI   PCCWRDWT(PCCWPTR),X'05'                             0509
*   PCCWPCCW=ZERO;                  /* SET END OF CHAIN FOR RECOVERY */
@RC00507 SLR   @11,@11                                             0510
         ST    @11,PCCWPCCW(,PCCWPTR)                              0510
*   RFY                                                            0511
*    (R0,                                                          0511
*     R1,                                                          0511
*     R15) RSTD;                                                   0511
*   R0=PAREEDBP;                    /* SET EDB HEADER ADDRESS        */
         L     @14,PAREPTR                                         0512
         L     R0,PAREEDBP(,@14)                                   0512
*   PCCWCHHR(1:4)=TSLOTNBR*PAGESZ;  /* SET UP RBA FOR CNVT           */
         L     @14,TSLOTNBR                                        0513
         SLA   @14,12                                              0513
         STCM  @14,15,PCCWCHHR(PCCWPTR)                            0513
*   R1=ADDR(PCCWCHHR);              /* AREA TO CONVERT INTO          */
         LA    R1,PCCWCHHR(,PCCWPTR)                               0514
*   CALL ILRCNVRT;                  /* CONVERT THE RBA               */
         BAL   @14,ILRCNVRT                                        0515
*   IF R15^=ZERO                    /* CONVERT GO OK?                */
*     THEN                                                         0516
         LTR   R15,R15                                             0516
         BZ    @RF00516                                            0516
*     DO;                           /* NO, ISSUE ABEND               */
*       RFY                                                        0518
*         R1 RSTD;                                                 0518
*       GEN( ABEND X'083',,,SYSTEM);/* EDB ERROR                     */
          ABEND X'083',,,SYSTEM
*       RFY                                                        0520
*         R1 UNRSTD;                                               0520
*     END;                                                         0521
*                                                                  0521
*   /*****************************************************************/
*   /*                                                               */
*   /* CONVERT DONE SUCCESSFULLY                                     */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0522
*   RFY                                                            0522
*    (R0,                                                          0522
*     R1,                                                          0522
*     R15) UNRSTD;                                                 0522
@RF00516 DS    0H                                                  0523
*   PCTPTR=PAREPCTP;                /* ADDR OF PCT                   */
         L     @01,PAREPTR                                         0523
         L     PCTPTR,PAREPCTP(,@01)                               0523
*   RESPECIFY                                                      0524
*     PCT BASED(PCTPTR);                                           0524
*   IORBPTR=PTRIORB;                /* ADDR OF IORB                  */
         L     @01,PRMLADDR                                        0525
         L     @15,PTRIORB(,@01)                                   0525
         ST    @15,IORBPTR                                         0525
*   RESPECIFY                                                      0526
*     IORB BASED(IORBPTR);                                         0526
*   IOSBPTR=IORIOSB;                /* ADDR OF IOSB                  */
         L     IOSBPTR,IORIOSB(,@15)                               0527
*   RESPECIFY                                                      0528
*     IOSB BASED(IOSBPTR);                                         0528
*   SSECN=SSLOT//PCTSSECN;          /* UNIQUE RELATIVE SLOT NUM      */
         L     @00,SSLOT                                           0529
         SRDA  @00,32                                              0529
         LH    @14,PCTSSECN(,PCTPTR)                               0529
         DR    @00,@14                                             0529
         ST    @00,SSECN                                           0529
*   NUMREQS=NUMREQS+ONE;            /* UPDATE NUMBER PCCWS           */
         LA    @14,1                                               0530
         AL    @14,NUMREQS                                         0530
         ST    @14,NUMREQS                                         0530
*   SEEK=BITOFF;                    /* INITIALIZE SEEK IND           */
*   SETSEC=BITOFF;                  /* INITIALIZE SET SECTOR IND     */
         NI    SEEK,B'10011111'                                    0532
*   IF LASTP=ZERO                   /* FIRST PCCW?                   */
*     THEN                                                         0533
         L     @14,LASTP                                           0533
         LTR   @14,@14                                             0533
         BNZ   @RF00533                                            0533
*     DO;                           /* YES                           */
*       IOSEEK=PCCWCHHR;            /* SET UP SEEK ADDR              */
         MVC   IOSEEK(8,IOSBPTR),PCCWCHHR(PCCWPTR)                 0535
*       IOSEEKA=IOSEEK;                                            0536
         MVC   IOSEEKA(8,IOSBPTR),IOSEEK(IOSBPTR)                  0536
*       IF IORFRPS=BITOFF           /* RPS DEVICE?                   */
*         THEN                                                     0537
         TM    IORFRPS(@15),B'01000000'                            0537
         BNZ   @RF00537                                            0537
*         DO;                       /* NO                            */
*           IOSRST=ADDR(PCCWSRCH);  /* SKIP SET SECTOR               */
         LA    @15,PCCWSRCH(,PCCWPTR)                              0539
         ST    @15,IOSRST(,IOSBPTR)                                0539
*         END;                                                     0540
*       ELSE                                                       0541
*         DO;                       /* YES RPS                       */
         B     @RC00537                                            0541
@RF00537 DS    0H                                                  0542
*           IOSRST=ADDR(PCCWSSEC);  /* START WITH SET SECTOR         */
         LA    @15,PCCWSSEC(,PCCWPTR)                              0542
         ST    @15,IOSRST(,IOSBPTR)                                0542
*           PCCWSECT=PCTSECNM(SSECN+1);                            0543
*                                                                  0543
         L     @15,SSECN                                           0543
         SLA   @15,2                                               0543
         SLR   @14,@14                                             0543
         IC    @14,PCTSECNM(@15,PCTPTR)                            0543
         STC   @14,PCCWSECT(,PCCWPTR)                              0543
*           /*********************************************************/
*           /*                                                       */
*           /* SET UP SECTOR NUMBER                                  */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0544
*           PCCWSSAD=ADDR(PCCWSECT);/* ADDR OF SEC NUM               */
         LA    @15,PCCWSECT(,PCCWPTR)                              0544
         STCM  @15,7,PCCWSSAD(PCCWPTR)                             0544
*           PCCWSS=SETSECOP;        /* SET SECTOR OP CODE            */
         MVI   PCCWSS(PCCWPTR),X'23'                               0545
*         END;                                                     0546
*       IOSVST=IOSRST;              /* V=R STORAGE                   */
@RC00537 L     @15,IOSRST(,IOSBPTR)                                0547
         ST    @15,IOSVST(,IOSBPTR)                                0547
*     END;                                                         0548
*   ELSE                                                           0549
*     DO;                           /* NOT FIRST PCCW                */
         B     @RC00533                                            0549
@RF00533 DS    0H                                                  0550
*       LASTP->PCCWPCCW=PCCWPTR;    /* CHAIN PCCWS                   */
         L     @05,LASTP                                           0550
         ST    PCCWPTR,PCCWPCCW(,@05)                              0550
*       IF LASTCYL^=PCCWCC          /* SAME CYLINDER AS LAST?        */
*         THEN                                                     0551
         L     @05,LASTCYL                                         0551
         SLR   @15,@15                                             0551
         ICM   @15,3,PCCWCC(PCCWPTR)                               0551
         CR    @05,@15                                             0551
         BE    @RF00551                                            0551
*         DO;                       /* NO,                           */
*           PCCWSK=SEEKCYL;         /* SET UP SEEK CYL               */
         MVI   PCCWSK(PCCWPTR),X'0B'                               0553
*           SEEK=BITON;             /* INDICATE DOING SEEK           */
         OI    SEEK,B'01000000'                                    0554
*           IF IORFRPS=BITON THEN   /* FOR RPS DEVICES               */
         L     @05,IORBPTR                                         0555
         TM    IORFRPS(@05),B'01000000'                            0555
         BNO   @RF00555                                            0555
*             SETSEC=BITON;         /* ALWAYS DO SET SECTOR IF SEEK
*                                      CYL                           */
         OI    SETSEC,B'00100000'                                  0556
*         END;                                                     0557
*       ELSE                                                       0558
*         IF LASTTRK^=PCCWHH        /* SAME TRACK AS LAST?           */
*           THEN                                                   0558
         B     @RC00551                                            0558
@RF00551 L     @05,LASTTRK                                         0558
         SLR   @15,@15                                             0558
         ICM   @15,3,PCCWHH(PCCWPTR)                               0558
         CR    @05,@15                                             0558
         BE    @RF00558                                            0558
*           DO;                     /* NO,                           */
*             PCCWSK=SEEKHD;        /* SET UP SEEK HEAD              */
         MVI   PCCWSK(PCCWPTR),X'1B'                               0560
*             SEEK=BITON;           /* INDICATE DOING SEEK           */
         OI    SEEK,B'01000000'                                    0561
*           END;                                                   0562
*         ELSE                                                     0563
*           ;                       /* NOT DOING SEEK                */
@RF00558 DS    0H                                                  0564
*       IF IORFRPS=BITON            /* RPS DEVICE?                   */
*         THEN                                                     0564
@RC00551 L     @05,IORBPTR                                         0564
         TM    IORFRPS(@05),B'01000000'                            0564
         BNO   @RF00564                                            0564
*         DO;                       /* YES, RPS DEVICE               */
*           TORBA=PCTTRBA(SSECN+1); /* REL TRK POS OF SLOT           */
         L     @15,SSECN                                           0566
         SLA   @15,2                                               0566
         ALR   @15,PCTPTR                                          0566
         SLR   TORBA,TORBA                                         0566
         ICM   TORBA,3,PCTTRBA(@15)                                0566
*           CURRBA=PCTTRBA(LASTSLOT+1);/* REL TRK POS OF ARM         */
*                                                                  0567
         L     @07,LASTSLOT                                        0567
         SLA   @07,2                                               0567
         ALR   @07,PCTPTR                                          0567
         SLR   CURRBA,CURRBA                                       0567
         ICM   CURRBA,3,PCTTRBA(@07)                               0567
*           /*********************************************************/
*           /*                                                       */
*           /* IS THIS SLOT PAST THE PREVIOUS SLOT??                 */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0568
*           IF TORBA>=CURRBA                                       0568
*                                                                  0568
*           /*********************************************************/
*           /*                                                       */
*           /* YES, THEN CALCULATE RELATIVE TRACK POSITION           */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0568
*             THEN                                                 0568
         CR    TORBA,CURRBA                                        0568
         BL    @RF00568                                            0568
*             RELPOS=TORBA-CURRBA;                                 0569
*                                                                  0569
         LR    RELPOS,TORBA                                        0569
         SLR   RELPOS,CURRBA                                       0569
*           /*********************************************************/
*           /*                                                       */
*           /* NO, THEN CALCULATE DISTANCE AROUND THE TRACK          */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0570
*           ELSE                                                   0570
*             RELPOS=PCTMAXTK-TORBA+CURRBA;                        0570
         B     @RC00568                                            0570
@RF00568 LH    RELPOS,PCTMAXTK(,PCTPTR)                            0570
         N     RELPOS,@CF02144                                     0570
         SLR   RELPOS,TORBA                                        0570
         ALR   RELPOS,CURRBA                                       0570
*           IF SETSEC=BITON×        /* SET SECTOR FORCED OR          */
*               RELPOS>PCTMSSB      /* ENOUGH TIME TO DO SET SECTOR ?*/
*             THEN                                                 0571
@RC00568 TM    SETSEC,B'00100000'                                  0571
         BO    @RT00571                                            0571
         LH    @06,PCTMSSB(,PCTPTR)                                0571
         N     @06,@CF02144                                        0571
         CR    RELPOS,@06                                          0571
         BNH   @RF00571                                            0571
@RT00571 DS    0H                                                  0572
*             DO;                   /* YES, SHOULD DO SET SECTOR     */
*               PCCWSECT=PCTSECNM(SSECN+1);                        0573
*                                                                  0573
         L     @05,SSECN                                           0573
         SLA   @05,2                                               0573
         SLR   @15,@15                                             0573
         IC    @15,PCTSECNM(@05,PCTPTR)                            0573
         STC   @15,PCCWSECT(,PCCWPTR)                              0573
*               /*****************************************************/
*               /*                                                   */
*               /* SET UP SECTOR NUMBER                              */
*               /*                                                   */
*               /*****************************************************/
*                                                                  0574
*               PCCWSSAD=ADDR(PCCWSECT);/* ADDR OF SEC NUM           */
         LA    @05,PCCWSECT(,PCCWPTR)                              0574
         STCM  @05,7,PCCWSSAD(PCCWPTR)                             0574
*               PCCWSS=SETSECOP;    /* SET SECTOR OP CODE            */
         MVI   PCCWSS(PCCWPTR),X'23'                               0575
*               SETSEC=BITON;       /* INDICATE DOING SET SECTOR     */
         OI    SETSEC,B'00100000'                                  0576
*             END;                                                 0577
*           ELSE                                                   0578
*             ;                     /* NO, NO SET SECTOR             */
@RF00571 DS    0H                                                  0579
*         END;                                                     0579
*       ELSE                                                       0580
*         ;                         /* NOT DOING SET SECTOR          */
@RF00564 DS    0H                                                  0581
*       LASTP->PCCWN=TICOP;         /* SET UP TIC IN PREVIOUS CCW  0581
*                                      STRING                        */
         L     @05,LASTP                                           0581
         MVI   PCCWN(@05),X'08'                                    0581
*       IF SEEK=BITOFF              /* NEED SEEK CCW?                */
*         THEN                      /* NO SEEK CCW NEEDED            */
         TM    SEEK,B'01000000'                                    0582
         BNZ   @RF00582                                            0582
*         IF SETSEC=BITOFF          /* NEED SET SECTOR?              */
*                                                                  0583
*         /***********************************************************/
*         /*                                                         */
*         /* IF NO SEEK & NO SET SECTOR NEEDED, CHAIN TO SEARCH      */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0583
*           THEN                                                   0583
         TM    SETSEC,B'00100000'                                  0583
         BNZ   @RF00583                                            0583
*           LASTP->PCCWNAD=ADDR(PCCWSRCH);                         0584
         LA    @15,PCCWSRCH(,PCCWPTR)                              0584
         STCM  @15,7,PCCWNAD(@05)                                  0584
*         ELSE                      /* NO SEEK BUT SET SECTOR        */
*                                                                  0585
*           /*********************************************************/
*           /*                                                       */
*           /* IF NO SEEK BUT SET SECTOR, CHAIN TO SET SECTOR        */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0585
*           LASTP->PCCWNAD=ADDR(PCCWSSEC);                         0585
         B     @RC00583                                            0585
@RF00583 LA    @05,PCCWSSEC(,PCCWPTR)                              0585
         L     @01,LASTP                                           0585
         STCM  @05,7,PCCWNAD(@01)                                  0585
*       ELSE                                                       0586
*         DO;                       /* DOING SEEK                    */
*                                                                  0586
         B     @RC00582                                            0586
@RF00582 DS    0H                                                  0587
*           /*********************************************************/
*           /*                                                       */
*           /* CHAIN PREVIOUS SET OF CCWS TO THIS SEEK               */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0587
*           LASTP->PCCWNAD=ADDR(PCCWSEEK);                         0587
         LA    @05,PCCWSEEK(,PCCWPTR)                              0587
         L     @01,LASTP                                           0587
         STCM  @05,7,PCCWNAD(@01)                                  0587
*           IF SETSEC=BITOFF        /* SEEK BUT NO SET SECTOR        */
*             THEN                                                 0588
         TM    SETSEC,B'00100000'                                  0588
         BNZ   @RF00588                                            0588
*             DO;                                                  0589
*                                                                  0589
*               /*****************************************************/
*               /*                                                   */
*               /* IF SEEK & NO SET SECTOR, CHANGE SET SECTOR TO TIC */
*               /*                                                   */
*               /*****************************************************/
*                                                                  0590
*               PCCWSS=TICOP;       /* CHANGE OP CODE TO TIC         */
         MVI   PCCWSS(PCCWPTR),X'08'                               0590
*               PCCWSSAD=ADDR(PCCWSRCH);/* TIC TO SEARCH             */
         LA    @05,PCCWSRCH(,PCCWPTR)                              0591
         STCM  @05,7,PCCWSSAD(PCCWPTR)                             0591
*             END;                                                 0592
*         END;                                                     0593
@RF00588 DS    0H                                                  0594
*     END;                                                         0594
@RC00582 DS    0H                                                  0595
*   LASTCYL=PCCWCC;                 /* REMEMBER LAST CYL USED        */
@RC00533 SLR   @05,@05                                             0595
         ICM   @05,3,PCCWCC(PCCWPTR)                               0595
         ST    @05,LASTCYL                                         0595
*   IF PCTFOVFL(SSECN+1)=BITON      /* OVERFLOW RECORD?              */
*                                                                  0596
*   /*****************************************************************/
*   /*                                                               */
*   /* IF OVERFLOW RECORD, NOW ON NEXT TRACK                         */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0596
*     THEN                                                         0596
         L     @05,SSECN                                           0596
         SLA   @05,2                                               0596
         ALR   @05,PCTPTR                                          0596
         TM    PCTFOVFL(@05),B'10000000'                           0596
         BNO   @RF00596                                            0596
*     LASTTRK=PCCWHH+1;             /* INDICATE ON NEXT TRACK        */
         LA    @05,1                                               0597
         SLR   @15,@15                                             0597
         ICM   @15,3,PCCWHH(PCCWPTR)                               0597
         ALR   @05,@15                                             0597
         ST    @05,LASTTRK                                         0597
*   ELSE                                                           0598
*     LASTTRK=PCCWHH;               /* NO, INDICATE ON CURRENT TRACK */
         B     @RC00596                                            0598
@RF00596 SLR   @05,@05                                             0598
         ICM   @05,3,PCCWHH(PCCWPTR)                               0598
         ST    @05,LASTTRK                                         0598
*   LASTSLOT=(SSLOT+1)//PCTSSECN;   /* AT START OF NEXT SLOT         */
@RC00596 LA    @05,1                                               0599
         AL    @05,SSLOT                                           0599
         LR    @00,@05                                             0599
         SRDA  @00,32                                              0599
         LH    @05,PCTSSECN(,PCTPTR)                               0599
         DR    @00,@05                                             0599
         ST    @00,LASTSLOT                                        0599
*   LASTP=PCCWPTR;                  /* UPDATE LAST PCCW ON IORB PTR  */
         ST    PCCWPTR,LASTP                                       0600
*   PTRPCCW=ZERO;                   /* INDICATE NO EXTRA PCCW        */
         L     @11,PRMLADDR                                        0601
         SLR   @05,@05                                             0601
         ST    @05,PTRPCCW(,@11)                                   0601
*   RFY                                                            0602
*     R14 RSTD;                                                    0602
*   R14=RETADDR3;                   /* RESET RETURN ADDRESS          */
         L     R14,RETADDR3                                        0603
*   END IOCHAIN;                                                   0604
@EL00016 DS    0H                                                  0604
@EF00016 DS    0H                                                  0604
@ER00016 BR    @14                                                 0604
*   RFY                                                            0605
*     R14 UNRSTD;                                                  0605
*                                                                  0606
*/*IO:        CHART                                                  */
*/* HEADING                                                        0606
*/* ILRSRT - ASM SLOT SORT                                         0606
*/*                     FINALIZE I/O PREPARATIONS -- GO TO IOS       */
*/********************************************************************/
*/*                                                                  */
*/*      IO: FINALIZE I/O PREPARATIONS -- GO TO IOS                  */
*/*                                                                  */
*/*      INPUT: - ADDRESS OF LAST PCCW INITIALIZED                   */
*/*             - PARAMETER LIST FROM ILRPTM                         */
*/*             - ASMVT                                              */
*/*                                                                  */
*/*      PROCESS: IF AT LEAST ONE I/O REQUEST WAS PREPARED THE       */
*/*               PCCW CHAIN IS FINALIZED FOR I/O. LAST CCW IS       */
*/*               CHANGED TO NOP CCW. FIELDS IN THE IORB             */
*/*               AND IOSB ARE SET. THE SRB IS PREPARED. THE ASMVT   */
*/*               I/O COUNT IS INCREMENTED(C&S) AND THE TOD IS STORED*/
*/*               IN THE IORB FOR ILRCMP'S REQUEST TIME CALCULATION  */
*/*               LATER. IOS IS INVOKED TO DO THE I/O.               */
*/*                                                                  */
*/*      OUTPUT: IF I/O: COMPLETED IORB-IOSB-SRB STRING              */
*/*                      UPDATED ASMVT I/O COUNT                     */
*/*                      TOD STORED IN IORB                          */
*/*                                                                  */
*/********************************************************************/
*/*IO:        E FINAL SETUP, GO TO IOS                               */
*                                                                  0606
*IO:                                                               0606
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0606
IO       DS    0H                                                  0607
*   RFY                                                            0607
*     R14 RSTD;                     /* RESTRICT RETURN REG           */
*   IORBPTR=PTRIORB;                /* ADDR OF IORB                  */
         L     @15,PRMLADDR                                        0608
         L     @15,PTRIORB(,@15)                                   0608
         ST    @15,IORBPTR                                         0608
*   RESPECIFY                                                      0609
*     IORB BASED(IORBPTR);                                         0609
*                                                                  0609
*   /*****************************************************************/
*   /*                                                               */
*   /* IF AT LEAST ONE PCCW FOR I/O WAS PREPARED AND CHAINED TO THE  */
*   /* IORB, THEN COMPLETE THE IORB, IOSB, SRB CHAIN AND GO TO IOS TO*/
*   /* PROCESS THE REQUESTS                                          */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0610
*/*          D (YES,,NO,%SRTSN) AT LEAST 1 I/O REQUEST ?             */
*/* P SET LAST CCW TO NOP CCW                                        */
*                                                                  0610
*   IF LASTP^=ZERO THEN             /* IS THERE AN I/O REQUEST ?     */
         L     @12,LASTP                                           0610
         SLR   @11,@11                                             0610
         CR    @12,@11                                             0610
         BE    @RF00610                                            0610
*     DO;                                                          0611
*       LASTP->PCCWN=NOP;           /* SET UP LAST CCW               */
         MVI   PCCWN(@12),X'03'                                    0612
*       LASTP->PCCWNFG(1)=NOPFLG;   /* END OF CHAIN                  */
         MVI   PCCWNFG(@12),X'20'                                  0613
*/*          P COMPLETE THE IORB, IOSB, AND SRB                      */
*                                                                  0614
*       IOSBPTR=IORIOSB;            /* ADDR OF IOSB                  */
         L     IOSBPTR,IORIOSB(,@15)                               0614
*       RESPECIFY                                                  0615
*         IOSB BASED(IOSBPTR);                                     0615
*       IORAPND=''B;                /* CLEAR APPENDAGE FLAGS         */
         NI    IORAPND(@15),B'11111000'                            0616
*       IORRQSZ=NUMREQS;            /* SET NUMBER REQUESTS           */
         L     @12,NUMREQS                                         0617
         STC   @12,IORRQSZ(,@15)                                   0617
*       IOSUCB=PAREUCBP;            /* ADDR UCB IN IOSB              */
         L     @15,PAREPTR                                         0618
         L     @15,PAREUCBP(,@15)                                  0618
         ST    @15,IOSUCB(,IOSBPTR)                                0618
*       IOSFLA=FLAINIT;             /* COMMAND AND DATA CHAINING     */
         MVI   IOSFLA(IOSBPTR),X'C0'                               0619
*       IOSPROC=ZERO;               /* MUST BE ZEROED BY DRV         */
         MVI   IOSPROC(IOSBPTR),X'00'                              0620
*       IOSERP=ZERO;                /* MUST BE ZEROED BY DRV         */
         ST    @11,IOSERP(,IOSBPTR)                                0621
*       IOSIPIB=ZERO;               /* MUST BE ZEROED BY DRV         */
         ST    @11,IOSIPIB(,IOSBPTR)                               0622
*/*SRTINCR:   P INCREMENT COUNT OF SRBS DESTINED FOR ILRCMP (C&S)    */
*                                                                  0623
*       RFY                                                        0623
*        (R0,                                                      0623
*         R1) RSTD;                                                0623
*       R0=ASMIOCNT;                                               0624
         L     R0,ASMIOCNT(,ASMVTPTR)                              0624
*SRTINCR:                                                          0625
*       R1=R0+ONE;                                                 0625
SRTINCR  LA    R1,1                                                0625
         ALR   R1,R0                                               0625
*       CS(R0,R1,ASMIOCNT);                                        0626
*                                                                  0626
         CS    R0,@01,ASMIOCNT(ASMVTPTR)                           0626
*/*           D (YES,,NO,SRTINCR) SUCCESSFUL ?                       */
*                                                                  0627
*       BC(NE,SRTINCR);                                            0627
*                                                                  0627
         BC    7,SRTINCR                                           0627
*       /*************************************************************/
*       /*                                                           */
*       /* SAVE TIME OF DAY IN THE IORB PRIOR TO CALLING IOS. THE    */
*       /* TIME OF DAY IS USED IN THE SERVICE BURST CALCULATION.     */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0628
*/*           P SAVE TIME OF DAY IN IORB (SERVICE BURST INFO)        */
*                                                                  0628
*       RFY                                                        0628
*        (R0,                                                      0628
*         R2) UNRSTD;                                              0628
*       IF REQNEED=ONE THEN                                        0629
         CLC   REQNEED(4),@CF00045                                 0629
         BNE   @RF00629                                            0629
*         DO;                       /* ONLY STCK IF BURST FULL       */
*           RFY                                                    0631
*             R15 RSTD;             /* RESTRICT USE OF REG           */
*           R15=IORBPTR;            /* GET ADDRESS OF IORB           */
         L     R15,IORBPTR                                         0632
*           GEN(STCK  IORTSMP(R15));/* STORE TOD                     */
         STCK  IORTSMP(R15)
*           BC(BZ,GOODTIME);        /* TIME STORED SUCCESSFULLY ?    */
         BC    8,GOODTIME                                          0634
*           RFY                                                    0635
*             R15 UNRSTD;           /* RELEASE REG FOR USE           */
*         END;                                                     0636
*       IORTSMP=''B;                /* NO, ZERO TIME FIELD           */
*                                                                  0637
@RF00629 L     @15,IORBPTR                                         0637
         XC    IORTSMP(8,@15),IORTSMP(@15)                         0637
*       /*************************************************************/
*       /*                                                           */
*       /* INVOKE IOS TO PROCESS THE I/O REQUESTS                    */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0638
*GOODTIME:                                                         0638
*       PTRIORB=0;                  /* ZERO PTM/SRT PLIST COPY OF  0638
*                                      IORB PTR SO RECOVERY KNOWS  0638
*                                      WHERE WE ARE                  */
GOODTIME L     @15,PRMLADDR                                        0638
         SLR   @12,@12                                             0638
         ST    @12,PTRIORB(,@15)                                   0638
*/*GOODTIME: P *** RECOV *** ZERO PLIST IORB PTR                     */
*/*           S (,%IOEXIT) IOS: ISSUE STARTIO MACRO                  */
*                                                                  0639
*       R1=IOSSRB;                  /* POINT TO SRB                  */
         L     R1,IOSSRB(,IOSBPTR)                                 0639
*       GEN REFS(CVTPTR,CVTMAP,CVTIXAVL,IOCOM,IOCSTIO,R1,R14,R12,R13);
        STM   R14,R12,12(R13)       SAVE REGS
        STARTIO SRB=(1)
        LM    R14,R12,12(R13)     RESTORE REGS
*     END;                                                         0641
*                                                                  0641
*/*%SRTSN:  P MAKE IORB AVAILABLE                                    */
*                                                                  0642
*   ELSE                                                           0642
*     IORFUSE=OFF;                  /* MAKE IORB AVAILABLE IF NOT  0642
*                                      USED                          */
         B     @RC00610                                            0642
@RF00610 L     @15,IORBPTR                                         0642
         NI    IORFUSE(@15),B'01111111'                            0642
*/*%IOEXIT:   R RETURN                                               */
*                                                                  0643
*   RFY                                                            0643
*     R14 UNRSTD;                   /* RELEASE RETURN REG            */
*   END IO;                         /* END SUBROUTINE IO             */
@EL00017 DS    0H                                                  0644
@EF00017 DS    0H                                                  0644
@ER00017 BR    @14                                                 0644
*/*IO:          END                                                  */
*                                                                  0645
*                                                                  0645
*/*WRTUPDTE: CHART                                                   */
*/* HEADING                                                        0645
*/* ILRSRT - ASM SLOT SORT                                         0645
*/*WRTUPDTE:  WRITE REQUEST EFFECTED UPDATES                         */
*/********************************************************************/
*/*                                                                  */
*/*      WRTUPDTE:  WRITE REQUEST EFFECTED UPDATES                   */
*/*                                                                  */
*/*      INPUT: ADDRESS OF PAT CYLINDER MAP FOR CYLINDER FROM WHICH  */
*/*              AT LEAST ONE WRITE REQUEST WAS CHOSEN               */
*/*             COUNT OF WRITE REQUESTS PREPARED FOR THE CURRENT     */
*/*               CYLINDER                                           */
*/*             PART ENTRY                                           */
*/*                                                                  */
*/*      PROCESS: THE PAT CYLINDER MAP AND THE PART ENTRY SLOTS      */
*/*               AVAILABLE COUNTER ARE UPDATED VIA COMPARE AND SWAP */
*/*               TO REFLECT WRTIES SELECTED FOR PAGING SPACE.       */
*/*                                                                  */
*/*      OUTPUT: UPDATED PAT CYLINDER MAP AND PART ENTRY SLOTS       */
*/*              AVAILABLE COUNTER                                   */
*/*                                                                  */
*/*                                                                  */
*/********************************************************************/
*/*WRTUPDTE: E WRITE REQUEST EFFECTED UPDATES                        */
*                                                                  0645
*WRTUPDTE:                                                         0645
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0645
WRTUPDTE DS    0H                                                  0646
*   RFY                                                            0646
*     R14 RSTD;                                                    0646
*   RETADDR2=R14;                   /* SAVE RETURN ADDR              */
         ST    R14,RETADDR2                                        0647
*   RFY                                                            0648
*     R14 UNRSTD;                                                  0648
*                                                                  0648
*   /*****************************************************************/
*   /*                                                               */
*   /* UPDATE THE PAT CYLINDER MAP WITH THE MASK GENERATED BY        */
*   /* SUCCESSIVE INVOCATIONS OF A FINDSLOT ROUTINE. UPDATE DEPENDS  */
*   /* ON WHETHER THE PAT CYLINDER MAP IS ONE WORD IN LENGTH OR TWO  */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0649
*/*           P OBTAIN ADDRESS OF PAT CYLINDER MAP                   */
*/*           D (YES,,NO,%WTU20) CYL MAP ONE WORD IN LENGTH ?        */
*                                                                  0649
*   RFY                                                            0649
*    (R0,                                                          0649
*     R1,                                                          0649
*     R2,                                                          0649
*     R14,                                                         0649
*     R15) RSTD;                                                   0649
*   R2=EPACYLA;                     /* GET CYL MAP ADDR              */
         L     R2,EPACYLA(,EPAPTR)                                 0650
*   IF CYLMPWDS=ONE THEN            /* ONE WORD CYL MAP ?            */
         CLC   CYLMPWDS(4),@CF00045                                0651
         BNE   @RF00651                                            0651
*     DO;                                                          0652
*                                                                  0652
*/*           P (,%WTU30) 'OR' FINDSLOT RTN WRITE MASK INTO PAT CYL
*/*                       MAP (C&S)                                  */
*                                                                  0653
*       R0=R2->PATCYLMP(1:4);       /* GET CURRENT PAT CYL MAP       */
         ICM   R0,15,PATCYLMP(R2)                                  0653
*SET1WCYL:                                                         0654
*       R1=R0×SCYLWRT(1:4);         /* ADD WRITE HITS                */
SET1WCYL LR    R1,R0                                               0654
         ICM   @12,15,SCYLWRT                                      0654
         OR    R1,@12                                              0654
*       CS(R0,R1,R2->PATCYLMP(1:4));/* ATTEMPT UPDATE                */
         CS    R0,@01,PATCYLMP(R2)                                 0655
*       BC(NE,SET1WCYL);            /* UNSUCCESSFUL, TRY AGAIN       */
         BC    7,SET1WCYL                                          0656
*     END;                                                         0657
*   ELSE                            /* TWO WORD PAT CYL MAP ?        */
*/*%WTU20:    P 'OR' FINDSLOT RTN WRITE MASK INTO PAT CYL MAP (CDS)  */
*                                                                  0658
*     DO;                                                          0658
         B     @RC00651                                            0658
@RF00651 DS    0H                                                  0659
*       LM(R0,R1,R2->PATCYLMP);     /* GET CURRENT PAT CYL MAP       */
         LM    R0,R1,PATCYLMP(R2)                                  0659
*SET2WCYL:                                                         0660
*       R14=R0×SCYLWRT(1:4);        /* ADD WRITE HITS: FIRST WORD    */
SET2WCYL LR    R14,R0                                              0660
         ICM   @12,15,SCYLWRT                                      0660
         OR    R14,@12                                             0660
*       R15=R1×SCYLWRT(5:8);        /* ADD WRITE HITS: 2ND WORD      */
         LR    R15,R1                                              0661
         ICM   @12,15,SCYLWRT+4                                    0661
         OR    R15,@12                                             0661
*       CDS(R0,R14,R2->PATCYLMP);   /* ATTEMPT UPDATE                */
         CDS   R0,R14,PATCYLMP(R2)                                 0662
*       BC(NE,SET2WCYL);            /* UNSUCCESSFUL, TRY AGAIN       */
         BC    7,SET2WCYL                                          0663
*     END;                                                         0664
*   RFY                                                            0665
*    (R2,                                                          0665
*     R14,                                                         0665
*     R15) UNRSTD;                                                 0665
*                                                                  0665
@RC00651 DS    0H                                                  0666
*   /*****************************************************************/
*   /*                                                               */
*   /* UPDATE THE SLOTS-AVAILABLE COUNT IN THE PART ENTRY            */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0666
*/*%WTU30:    P UPDATE SLOTS AVAILABLE CTR IN PART ENTRY (C&S)       */
*                                                                  0666
*   R0=PARESLTA;                    /* GET CURRENT COUNT             */
         L     @12,PAREPTR                                         0666
         L     R0,PARESLTA(,@12)                                   0666
*DECRSLTA:                                                         0667
*   R1=R0-EPAWRTCT;                 /* DECREMENT COUNT               */
DECRSLTA LR    R1,R0                                               0667
         SH    R1,EPAWRTCT(,EPAPTR)                                0667
*   CS(R0,R1,PARESLTA);             /* ATTEMPT REPLACE               */
         L     @12,PAREPTR                                         0668
         CS    R0,@01,PARESLTA(@12)                                0668
*   BC(NE,DECRSLTA);                /* UNSUCCESSFUL, TRY AGAIN       */
         BC    7,DECRSLTA                                          0669
*   RFY                                                            0670
*    (R0,                                                          0670
*     R1) UNRSTD;                                                  0670
*                                                                  0670
*/*           M ZERO COUNT OF WRITE REQUESTS FOR CYLINDER            */
*                                                                  0671
*   EPAWRTCT=ZERO;                  /* ZERO COUNT OF WRITE REQUESTS
*                                      PREPARED                      */
         SLR   @12,@12                                             0671
         STH   @12,EPAWRTCT(,EPAPTR)                               0671
*   RFY                                                            0672
*     R14 RSTD;                                                    0672
*                                                                  0672
*/*           R RETURN                                               */
*                                                                  0673
*   R14=RETADDR2;                   /* RESTORE RETURN REGISTER       */
         L     R14,RETADDR2                                        0673
*   RFY                                                            0674
*     R14 UNRSTD;                                                  0674
*   END WRTUPDTE;                   /* END SUBROUTINE WRTUPDTE       */
@EL00018 DS    0H                                                  0675
@EF00018 DS    0H                                                  0675
@ER00018 BR    @14                                                 0675
*/*WRTUPDTE: END                                                     */
*                                                                  0676
*                                                                  0676
*/*CLEANUP:  CHART                                                   */
*/* HEADING                                                        0676
*/* ILRSRT - ASM SLOT SORT                                         0676
*/*CLEANUP: FINAL ACTIONS BEFORE RETURNING TO CALLER                 */
*/********************************************************************/
*/*                                                                  */
*/*      CLEANUP: FINAL ACTIONS BEFORE RETURNING TO CALLER           */
*/*                                                                  */
*/*      INPUT: REGISTER 13                                          */
*/*                                                                  */
*/*      PROCESS: THE CALLERS SAVEAREA IS RELOADED INTO REG 13.      */
*/*               THE RETURN CODE IS STORED IN CALLERS REGISTER 15   */
*/*               SAVE AREA FIELD.                                   */
*/*                                                                  */
*/*      OUTPUT: UPDATED SAVEAREA POINTER                            */
*/*              UPDATED REGISTER 15 FIELD IN CALLERS SAVEAREA       */
*/*                                                                  */
*/*                                                                  */
*/********************************************************************/
*/*CLEANUP: E FINAL CLEAN UP ACTIONS                                 */
*                                                                  0676
*CLEANUP:                                                          0676
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0676
CLEANUP  DS    0H                                                  0677
*   RFY                                                            0677
*     R14 RSTD;                     /* RESTRICT RETURN ADDRESS REG   */
*/* D (YES,,NO,%F02) ANY IOES ON INTERNAL FREE Q?                    */
*/* P GET PTR TO 1ST IOE ON Q                                        */
*/* P ZERO INTERNAL Q PTRS                                           */
*/* P RETURN IOES TO AVAIL Q (C&S)                                   */
*                                                                  0678
*   RFY                                                            0678
*    (R0,                                                          0678
*     R1,                                                          0678
*     R2,                                                          0678
*     R5) RSTD;                                                    0678
*   RFY                                                            0679
*     ASMPOOLS BASED(R5);                                          0679
*   R5=ADDR(ASMIOEPC);                                             0680
         LA    R5,ASMIOEPC(,ASMVTPTR)                              0680
*   R1=EPAFFIOE;                    /* PICK UP FIRST AND             */
         L     R1,EPAFFIOE(,EPAPTR)                                0681
*   R2=EPALFIOE;                    /* LAST INTERNAL FREE QUEUE PTRS */
         L     R2,EPALFIOE(,EPAPTR)                                0682
*   EPAFFIOE=0;                     /* ZERO FOR RECOVERY             */
         SLR   @15,@15                                             0683
         ST    @15,EPAFFIOE(,EPAPTR)                               0683
*   EPALFIOE=0;                     /* LIKEWISE                      */
         ST    @15,EPALFIOE(,EPAPTR)                               0684
*   R0=ASMCPAVL;                    /* CURRENT CONTENTS OF AVAIL Q   */
         L     R0,ASMCPAVL(,R5)                                    0685
*RETRY1:                                                           0686
*   R2->IOENXT=R0;                  /* CHAIN IN EXISTING             */
RETRY1   ST    R0,IOENXT(,R2)                                      0686
*   CS(R0,R1,ASMCPAVL);             /* UPDATE AVAIL Q                */
         CS    R0,@01,ASMCPAVL(R5)                                 0687
*   BC(NE,RETRY1);                  /* TRY AGAIN IF MISS             */
         BC    7,RETRY1                                            0688
*   RFY                                                            0689
*    (R0,                                                          0689
*     R1,                                                          0689
*     R2,                                                          0689
*     R5) UNRSTD;                                                  0689
*                                                                  0689
*/*%F02:      P RESTORE CALLER'S SAVEAREA REG                        */
*                                                                  0690
*   R13=CALLR13;                    /* GET CALLER'S SVAREA ADDR      */
         L     R13,CALLR13                                         0690
*/* D (YES,%T1,OR,) DS NOT FULL + MORE WRITES?                       */
*/* D (YES,,NO,%F1) MORE READS?                                      */
*/*%T1: P OR ON MORE WORK BIT IN RETCODE                             */
*/*%F1:       P STORE RETURN CODE IN CALLERS SAVEAREA (R15)          */
*                                                                  0691
*   IF((RETCODE=0&WRITEQUE^=0)×     /* IF NOT FULL + MORE WRITES     */
*       PAREIOEQ^=0×                /* IF UNSORTED OR                */
*       PARENODE^=0) THEN           /* SORTED READS REGARDLESS OF  0691
*                                      FULL CONDITION                */
         SLR   @15,@15                                             0691
         C     @15,RETCODE                                         0691
         BNE   @GL00010                                            0691
         C     @15,WRITEQUE                                        0691
         BNE   @RT00691                                            0691
@GL00010 SLR   @15,@15                                             0691
         L     @12,PAREPTR                                         0691
         C     @15,PAREIOEQ(,@12)                                  0691
         BNE   @RT00691                                            0691
         C     @15,PARENODE(,@12)                                  0691
         BE    @RF00691                                            0691
@RT00691 DS    0H                                                  0692
*     RETCODE=RETCODE×IOOKMORE;     /* INDICATE MORE WORK            */
         L     @15,RETCODE                                         0692
         O     @15,@CF00119                                        0692
         ST    @15,RETCODE                                         0692
*   ELSE                                                           0693
*     ;                             /* OTHERWISE LEAVE ALONE         */
@RF00691 DS    0H                                                  0694
*   R13->CALLR15=RETCODE;           /* RET CODE TO CALLER SVAREA     */
         L     @15,RETCODE                                         0694
         ST    @15,CALLR15(,R13)                                   0694
*   PTRWRITE=WRITEQUE;              /* RESET PARM AREA FOR WRITES  0695
*                                      REMAINING                     */
         L     @15,WRITEQUE                                        0695
         L     @12,PRMLADDR                                        0695
         ST    @15,PTRWRITE(,@12)                                  0695
*/*           R RETURN                                               */
*                                                                  0696
*   RFY                                                            0696
*     R14 UNRSTD;                   /* RELEASE RETURN ADDRESS REG    */
*   END CLEANUP;                    /* END SUBROUTINE CLEANUP        */
@EL00019 DS    0H                                                  0697
@EF00019 DS    0H                                                  0697
@ER00019 BR    @14                                                 0697
*/*CLEANUP:   END                                                    */
*                                                                  0698
*FSRTNS:                                                           0698
*   PROCEDURE OPTIONS(NOSAVE,NOSAVEAREA);                          0698
*                                                                  0698
FSRTNS   DS    0H                                                  0699
*   /*****************************************************************/
*   /*                                                               */
*   /* FIND-SLOT-ROUTINE MASKS                                       */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0699
*   DCL                                                            0699
*     FSLOBIT1 FIXED(32) INIT('00000000000000000000000000000001'B),
*     FSLOBIT4 FIXED(32) INIT('00000000000000000000000000001000'B),
*     FSHIBIT3 FIXED(32) INIT('00100000000000000000000000000000'B),
*     FS3COLR3 FIXED(32) INIT('00000000000000000000000001001001'B),
*     FS3COLR5 FIXED(32) INIT('00000000000000000001001001001001'B),
*     FS3COLR9 FIXED(32) INIT('00000001001001001001001001001001'B),
*     FS3COLRB FIXED(32) INIT('01001001001001001001001001001001'B),
*     FS3COLLB FIXED(32) INIT('10010010010010010010010010010010'B),
*     FS3COLL5 FIXED(32) INIT('10010010010010000000000000000000'B),
*     FS3COLL3 FIXED(32) INIT('10010010000000000000000000000000'B),
*     FS4COLL6 FIXED(32) INIT('10001000100010001000100000000000'B),
*     FS4COLL3 FIXED(32) INIT('10001000100000000000000000000000'B),
*     FSDCOLL2 FIXED(32) INIT('10000000000001000000000000000000'B);
*                                                                  0699
*   /*****************************************************************/
*   /*                                                               */
*   /* FIND-SLOT-ROUTINE CONSTANT VALUES                             */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0700
*   DCL                                                            0700
*     FSF1 FIXED(31) DEF(FSLOBIT1),                                0700
*     FSF3 FIXED(31) INIT(3),                                      0700
*     FSF4 FIXED(31) INIT(4),                                      0700
*     FSF9 FIXED(31) INIT(9),                                      0700
*     FSF12 FIXED(31) INIT(12),                                    0700
*     FSF13 FIXED(31) INIT(13),                                    0700
*     FSF15 FIXED(31) INIT(15),                                    0700
*     FSF33 FIXED(31) INIT(33);                                    0700
*                                                                  0700
*/********************************************************************/
*/*                                                                  */
*/*      F2314S: FIND NEXT BEST SLOT ON A 2314 CYLINDER              */
*/*                                                                  */
*/*      INPUT: - LAST SLOT CHOSEN IN CYLINDER                       */
*/*             - READ/WRITE CYLINDER MAP MASK                       */
*/*             - READ CYLINDER MAP MASK                             */
*/*             - NUMBER SLOTS/CYLINDER                              */
*/*                                                                  */
*/*      PROCESS: THE NEXT BEST SLOT IS DETERMINED AND TESTED. IF    */
*/*               NO REQUEST MAY BE PROCESSED FOR IT THEN THE READ/  */
*/*               WRITE MASK IS TESTED, ONE CYLINDER COLUMN AT A     */
*/*               TIME (SEE DIAGRAM) UNTIL A COLUMN WITH A HIT IS    */
*/*               FOUND. A BIT IN THE COLUMN IS FOUND AND A REQUEST  */
*/*               FOR THE SLOT REPRESENTED IS OBTAINED. THE READ/    */
*/*               WRITE MASK IS UPDATED SO THAT THE SLOT WILL NOT BE */
*/*               CHOSEN AGAIN. IF A WRITE REQUEST WAS SELECTED THE  */
*/*               APPROPRIATE BIT IS SET IN THE READ MASK.  THIS     */
*/*               MASK MAY BE LATER USED TO UPDATE THE PAT CYLINDER  */
*/*               MAP.                                               */
*/*                                                                  */
*/*      OUTPUT: - UPDATED SLOT VALUE                                */
*/*              - UPDATED READ/WRITE MASK                           */
*/*              - UPDATED READ (WRITE) MASK IF WRITE SLOT SELECTED  */
*/*              - IOE (VIA GETREAD OR SETWRITE)                     */
*/*                                                                  */
*/********************************************************************/
*                                                                  0701
*F2314S:                                                           0701
*   GEN;                                                           0701
F2314S   DS    0H                                                  0701
*       /*
*
*     2314 CYLINDER RELATIVE SLOT DIAGRAM
*
*    TRK ___________________________
*      0 ×_______0________×_____1__×
*      1 ×________×______2_________×
*      2 ×_______3________×_____4__×
*      3 ×________×______5_________×
*      4 ×_______6________×_____7__×
*      5 ×________×______8_________×
*      6 ×_______9________×____10__×
*      7 ×________×_____11_________×
*      8 ×______12________×____13__×
*      9 ×________×_____14_________×
*     10 ×______15________×____16__×
*     11 ×________×_____17_________×
*     12 ×______18________×____19__×
*     13 ×________×_____20_________×
*     14 ×______21________×____22__×
*     15 ×________×_____23_________×
*     16 ×______24________×____25__×
*     17 ×________×_____26_________×
*     18 ×______27________×____28__×
*     19 ×________×_____29_________×
*
*
* USING LAST SLOT FOUND, NOW FIND NEXT BEST POSSIBLE SLOT TO
* PROCESS AND COLUMN IT IS IN.
         L     R2,SCYLRDWT             GET READ/WRITE MASK
         L     R5,SSLOT                OBTAIN PREVIOUS SLOT NBR
         A     R5,FSF1                 INCR SLOT NBR TO NEXT SEQ
         LR    R0,R5                   SAVE NEXT SLOT NBR
*
         SLR   R4,R4                   ZERO ODD REG OF PAIR
         D     R4,FSF3                 DETERMINE TEST 'COLUMN'
         LTR   R5,R4                   CHECK FOR COL ZERO
         BNZ   B2314NXT                NO, CONTINUE NEXT SLOT TEST
         LTR   R2,R2                   TEST IF ZERO BIT ON
         BM    HIT2314                 IF HIT, THEN PROCESS
         B     T2314                   IF NO HIT, GET NEXT COL AND    **
                                       CONTINUE
*
*  TEST NEXT BEST SLOT
*
B2314NXT LR    R5,R0                   RESTORE SLOT NBR
         L     R0,HIORDER8             SET HI ORDER BIT IN REG
         SRL   R0,0(R5)                BUILD MASK TO TEST NEXT SEQ    **
                                       SLOT
         NR    R0,R2                   TEST FOR HIT
         BNZ   M2314SET                IF HIT, PREPARE TO GET OUT
         LR    R5,R4                   GET COLUMN NUMBER
*
*
*  FIND COLUMN WITH AT LEAST ONE HIT
*
T2314    IC    R5,COL2314(R5)          GET TEST 'COLUMN'
         LR    R1,R2                   GET SCYLRDWT MASK COPY
         SLL   R1,0(R5)                SHIFT COPY FOR CORRECT COLUMN  **
                                       TEST
         N     R1,FS3COLLB             ANY BITS ON....
         BZ    T2314                   IF NOT, LOOP & GET NEXT COLUMN
*
*  FIND SLOT IN COLUMN
*
*  TEST FIRST FIVE CHOICES
*
B2314T5  L     R0,FS3COLL5             GET MASK TO TEST 5 BITS
         NR    R0,R1                   TEST FOR HIT
         BNZ   B2314T3                 HIT EXISTS IN FIRST 5 BITS
         SLL   R1,15                   SHIFT OFF 5 BAD POSSIBILITIES
         A     R5,FSF15                GET SLOT NBR NEXT POSSIBILITY
*
*  TEST THREE OF FIVE CHOICES
*
B2314T3  L     R0,FS3COLL3             GET MASK TO TEST 3 BITS
         NR    R0,R1                   TEST FOR HIT
         BNZ   B2314T1                 HIT EXISTS IN THE 3 BITS
         SLL   R1,9                    SHIFT OFF 3 BAD POSSIBILITIES
         A     R5,FSF9                 GET SLOT NBR NEXT POSSIBILITY
*
*  TEST ONE OF THREE (OR TWO) CHOICES
*
B2314T1  ALR   R1,R1                   SHIFT ONE LEFT, SET            **
                                       CONDITION CODE IF CARRY
         BC    3,HIT2314               GOT A SLOT IF CARRY
         A     R5,FSF3                 IF NO SLOT, INCREMENT SLOT NBR
         N     R1,FSHIBIT3             TEST NEXT BEST POSSIBILITY
         BNZ   HIT2314                 HIT... THEN BRANCH
         A     R5,FSF3                 IF NO SLOT, INCREMENT SLOT NBR
*
*  SLOT FOUND: UPDATE MASKS
*     GET IOE FOR REQUEST
*
HIT2314  L     R0,HIORDER8             SET HI ORDER BIT IN REG
         SRL   R0,0(R5)                BUILD MASK TO SLOT NBR
M2314SET ST    R5,SSLOT                SAVE SLOT NUMBER IN PARMLIST
         XR    R2,R0                   TURN BIT OFF IN SCYLRDWT
         ST    R2,SCYLRDWT
         O     R0,SCYLREAD             GET READ MASK
         C     R0,SCYLREAD             SEE IF BIT ALREADY ON          **
                                       (DETERMINE IF READ-SLOT)
         BE    GETREAD                 GET READ REQUEST FOUND
         ST    R0,SCYLWRT              STORE NEW READ (WRITE) MASK
         B     SETWRITE                GET WRITE REQUEST FOUND
COL2314  DC    XL3'020001'             NEXT BEST SLOT COLUMN ARRAY
*                                                                  0702
*/********************************************************************/
*/*                                                                  */
*/*      F3340S: FIND NEXT BEST SLOT ON A 3340 CYLINDER              */
*/*                                                                  */
*/*      INPUT: - LAST SLOT CHOSEN IN CYLINDER                       */
*/*             - READ/WRITE CYLINDER MAP MASK                       */
*/*             - READ CYLINDER MAP MASK                             */
*/*             - NUMBER SLOTS/CYLINDER                              */
*/*                                                                  */
*/*      PROCESS: THE NEXT BEST SLOT IS DETERMINED AND TESTED. IF    */
*/*               NO REQUEST MAY BE PROCESSED FOR IT THEN THE READ/  */
*/*               WRITE MASK IS TESTED, ONE CYLINDER COLUMN AT A     */
*/*               TIME (SEE DIAGRAM) UNTIL A COLUMN WITH A HIT IS    */
*/*               FOUND. A BIT IN THE COLUMN IS FOUND AND A REQUEST  */
*/*               FOR THE SLOT REPRESENTED IS OBTAINED. THE READ/    */
*/*               WRITE MASK IS UPDATED SO THAT THE SLOT WILL NOT BE */
*/*               CHOSEN AGAIN. IF A WRITE REQUEST WAS SELECTED THE  */
*/*               APPROPRIATE BIT IS SET IN THE READ MASK.  THIS     */
*/*               MASK MAY BE LATER USED TO UPDATE THE PAT CYLINDER  */
*/*               MAP.                                               */
*/*                                                                  */
*/*      OUTPUT: - UPDATED SLOT VALUE                                */
*/*              - UPDATED READ/WRITE MASK                           */
*/*              - UPDATED READ (WRITE) MASK IF WRITE SLOT SELECTED  */
*/*              - IOE (VIA GETREAD OR SETWRITE)                     */
*/*                                                                  */
*/********************************************************************/
*                                                                  0702
*F3340S:                                                           0702
*   GEN;                                                           0702
F3340S   DS    0H                                                  0702
*       /*
*
*          3340 CYLINDER RELATIVE SLOT DIAGRAM
*
*   TRK _________________________________________
*     0 ×____0____×____1____×____2____×____3____×
*     1 ×____4____×____5____×____6____×____7____×
*     2 ×____8____×____9____×___10____×___11____×
*     3 ×___12____×___13____×___14____×___15____×
*     4 ×___16____×___17____×___18____×___19____×
*     5 ×___20____×___21____×___22____×___23____×
*
*
         L     R15,FSF4                PRESET WORK REG
*
         L     R5,SSLOT                OBTAIN PREVIOUS SLOT NBR
         A     R5,FSF1                 INCR SLOT NBR TO NEXT SEQ
         LR    R4,R5                   OBTAIN NEXT SEQ SLOT NBR
         N     R4,FSF3                 GET COLUMN NUMBER
         BNZ   B3340NXT                IF NOT COL 0, TEST BIT
         SR    R5,R15                  GET NEXT SEQ SLOT THIS TRK
B3340NXT L     R2,SCYLRDWT             GET READ/WRITE MASK
         L     R0,HIORDER8             SET HI ORDER BIT IN REG
         SRL   R0,0(R5)                BUILD MASK TO TEST NEXT SEQ    **
                                       SLOT
         NR    R0,R2                   TEST FOR HIT
         BNZ   M3340SET                IF HIT, PREPARE TO GET OUT
*
         LR    R5,R4                   GET COLUMN NUMBER
*
*
T3340    IC    R5,COL3340(R5)          GET TEST 'COLUMN'
         LR    R1,R2                   GET SCYLRDWT MASK COPY
         SLL   R1,0(R5)                SHIFT COPY FOR CORRECT COLUMN  **
                                       TEST
         N     R1,FS4COLL6             ANY BITS ON....
         BZ    T3340                   IF NOT, LOOP & GET NEXT COLUMN
*
B3340T3  L     R0,FS4COLL3             GET MASK TO TEST 3 BITS
         NR    R0,R1                   TEST FOR HIT
         BNZ   B3340T1                 HIT EXISTS IN FIRST 3 BITS
         SLL   R1,12                   SHIFT OFF 3 BAD POSSIBILITIES
         A     R5,FSF12                GET SLOT NBR NEXT POSSIBILITY
*
B3340T1  ALR   R1,R1                   SHIFT ONE LEFT, SET            **
                                       CONDITION CODE IF CARRY
         BC    3,HIT3340               GOT A SLOT IF CARRY
         ALR   R5,R15                  IF NO SLOT, INCREMENT SLOT NBR
         N     R1,FS3COLL3             TEST NEXT BEST POSSIBILITY
         BNZ   HIT3340                 HIT... THEN BRANCH
         ALR   R5,R15                  IF NO SLOT, INCREMENT SLOT NBR
*
*
HIT3340  L     R0,HIORDER8             SET HI ORDER BIT IN REG
         SRL   R0,0(R5)                BUILD MASK TO SLOT NBR
M3340SET ST    R5,SSLOT                SAVE SLOT NUMBER IN PARMLIST
         XR    R2,R0                   TURN BIT OFF IN SCYLRDWT
         ST    R2,SCYLRDWT
         O     R0,SCYLREAD             GET READ MASK
         C     R0,SCYLREAD             SEE IF BIT ALREADY ON          **
                                       (DETERMINE IF READ-SLOT)
         BE    GETREAD                 GET READ REQUEST FOUND
         ST    R0,SCYLWRT              STORE NEW READ (WRITE) MASK
         B     SETWRITE                GET WRITE REQUEST FOUND
COL3340  DC    XL4'01020300'           NEXT BEST SLOT COLUMN ARRAY
*                                                                  0703
*/********************************************************************/
*/*                                                                  */
*/*      F3330S: FIND NEXT BEST SLOT ON A 3330 OR 3330-1 CYLINDER    */
*/*                                                                  */
*/*      INPUT: - LAST SLOT CHOSEN IN CYLINDER                       */
*/*             - READ/WRITE CYLINDER MAP MASK                       */
*/*             - READ CYLINDER MAP MASK                             */
*/*             - NUMBER SLOTS/CYLINDER                              */
*/*                                                                  */
*/*      PROCESS: THE NEXT BEST SLOT IS DETERMINED AND TESTED. IF    */
*/*               NO REQUEST MAY BE PROCESSED FOR IT THEN THE READ/  */
*/*               WRITE MASK IS TESTED, ONE CYLINDER COLUMN AT A     */
*/*               TIME (SEE DIAGRAM) UNTIL A COLUMN WITH A HIT IS    */
*/*               FOUND. A BIT IN THE COLUMN IS FOUND AND A REQUEST  */
*/*               FOR THE SLOT REPRESENTED IS OBTAINED. THE READ/    */
*/*               WRITE MASK IS UPDATED SO THAT THE SLOT WILL NOT BE */
*/*               CHOSEN AGAIN. IF A WRITE REQUEST WAS SELECTED THE  */
*/*               APPROPRIATE BIT IS SET IN THE READ MASK.  THIS     */
*/*               MASK MAY BE LATER USED TO UPDATE THE PAT CYLINDER  */
*/*               MAP.                                               */
*/*               NOTE: THE COLUMNS ARE STAGGERED, TWO WORDS ARE     */
*/*                     NEEDED TO MAP A CYLINDER (THUS TWO REGS FOR  */
*/*                     FOR THE MASK), AND PARTIAL COLUMNS ARE TESTED*/
*/*                     SINCE MORE THAN ONE NEXT BEST SLOT EXIST.    */
*/*                                                                  */
*/*      OUTPUT: - UPDATED SLOT VALUE                                */
*/*              - UPDATED READ/WRITE MASK                           */
*/*              - UPDATED READ (WRITE) MASK IF WRITE SLOT SELECTED  */
*/*              - IOE (VIA GETREAD OR SETWRITE)                     */
*/*                                                                  */
*/********************************************************************/
*                                                                  0703
*F3330S:                                                           0703
*   GEN;                                                           0703
F3330S   DS    0H                                                  0703
*       /*
*
*     3330 & 3330-1 CYLINDER RELATIVE SLOT DIAGRAM
*
* TRK _______________________________________________________________
*   0 ×_________0_________×_________1_________×_________2_________×_×
*   1 ×________3_________×_________4_________×_________5_________×__×
*   2 ×________6________×_________7_________×_________8_________×_9_×
*   3 ×_______9________×________10_________×________11_________×_12_×
*   4 ×______12_______×________13_________×________14_________×_15__×
*   5 ×_____15_______×________16_________×________17_________×__18__×
*   6 ×_____18______×________19_________×________20_________×__21___×
*   7 ×____21______×________22_________×________23_________×___24___×
*   8 ×____24_____×________25_________×________26_________×___27____×
*   9 ×____27____×________28_________×________29_________×____30____×
*  10 ×___30____×________31_________×________32_________×_____33____×
*  11 ×___33___×________34_________×________35_________×_____36_____×
*  12 ×__36___×________37_________×________38_________×______39_____×
*  13 ×__39__×________40_________×________41_________×______42______×
*  14 ×_42__×________43_________×________44_________×_______45______×
*  15 ×_45_×________46_________×________47_________×_______48_______×
*  16 ×___×________49_________×________50_________×________51_______×
*  17 ×__×________52_________×________53_________×________54________×
*  18 ×_×________55_________×________56_________×_________57________×
*
*
         LM    R2,R3,SCYLRDWT          GET READ/WRITE MASK
         L     R5,SSLOT                OBTAIN PREVIOUS SLOT NBR
         A     R5,FSF1                 INCR SLOT NBR TO NEXT SEQ
         C     R5,CYLSLOTS             PAST LAST SLOT IN CYL...
         BL    B3330NXT                NO, CONTINUE PARTIAL COL TEST
         SLR   R5,R5                   ZERO SLOT NBR
         LTR   R2,R2                   TEST IF ZERO BIT ON
         BM    HIT3330                 IF HIT, THEN PROCESS
         B     T3330MW2                IF NO HIT, GET NEXT COL AND    **
                                       CONTINUE
B3330NXT LR    R6,R2                   COPY 1ST WORD OF CYL R/W MASK
         LR    R7,R3                   COPY 2ND WORD OF CYL R/W MASK
         LCR   R4,R5                   GET NEGATIVE OF SLOT NBR
         SRDL  R6,57+6(R4)             SHIFT BITS TO TEST TO RIGHT    **
                                       SIDE OF REG PAIR
T3330PW2 N     R7,FS3COLRB             TEST FOR ANY HITS IN REST OF   **
                                       CYL 'COLUMN' (HI SLOT NBRS)
         BZ    T3330PW1                IF NONE, TEST LOWER SLOT NBRS  **
                                       IN CYL 'COLUMN'
*
         B     B3330T5                 GO FIND FIRST 'ON' BIT
*
T3330PW1 N     R6,FS3COLLB             TEST OF ANY HITS IN REST OF    **
                                       CYL 'COLUMN' (LO SLOT NBRS)
         BZ    G3330COL                NO HIT, THEN PREPARE TO TEST   **
                                       NEXT COLUMN
         S     R5,FSF33                RESET SLOT NBR TO HIGHEST      **
                                       POSSIBLE IN CYL COL LEFT
         SRDL  R6,33                   SET REG FOR BIT TESTS BELOW
         B     B3330T5                 GO FIND FIRST 'ON' BIT
*
*
G3330COL SLR   R4,R4                   ZERO ODD REG OF PAIR
         D     R4,FSF3                 DETERMINE LAST SLOT 'COLUMN'
         LR    R5,R4                   GET COLUMN NUMBER
*
*
T3330MW2 IC    R5,COL3330(R5)          GET TEST 'COLUMN'
         LR    R6,R2                   GET READ/WRITE MASK(WRD1)
         LR    R7,R3                   GET READ/WRITE MASK(WRD2)
         SLDL  R6,0(R5)                SHIFT COPY FOR CORRECT COLUMN  **
                                       TEST
         N     R7,FS3COLRB             ANY BITS ON (HIGHER SLOT NBRS)
         BZ    T3330MW1                IF NOT, TEST 1ST WORD OF MASK  **
                                       (LOWER SLOT NBRS)
         SRL   R7,6                    SHIFT OFF WASTED BITS
         LA    R5,57(R5)               GET MAX SLOT NBR FOR COLUMN
         B     B3330T5                 DETERMINE SLOT NBR
*
*
T3330MW1 N     R6,FS3COLLB             ANY BITS ON (LOWER SLOT NBRS)
         BZ    T3330MW2                IF NOT, LOOP & TEST NEXT COL
         SRDL  R6,33                   SET REG FOR BIT TESTS BELOW
         LA    R5,30(R5)               GET MAX SLOT NBR FOR MASK WRD
*
*
B3330T5  L     R0,FS3COLR5             GET MASK TO TEST 5 BITS
         NR    R0,R7                   TEST FOR HIT
         BNZ   B3330T3                 HIT EXISTS IN BEST 5 BITS
         SRL   R7,15                   SHIFT OFF 5 BAD POSSIBILITIES
         S     R5,FSF15                GET SLOT NBR NEXT POSSIBILITY
B3330T3  L     R0,FS3COLR3             GET MASK TO TEST 3 BITS
         NR    R0,R7                   TEST FOR HIT
         BNZ   B3330T1                 HIT EXISTS IN THE 3 BITS
         SRL   R7,9                    SHIFT OFF 3 BAD POSSIBILITIES
         S     R5,FSF9                 GET SLOT NBR NEXT POSSIBILITY
B3330T1  LR    R6,R7                   SAVE COPY OF MASK
         N     R7,FSLOBIT1             TEST BEST POSSIBILITY
         BNZ   HIT3330                 HIT...
         S     R5,FSF3                 GET SLOT NBR NEXT POSSIBILITY
         N     R6,FSLOBIT4             TEST NEXT BEST POSSIBILITY
         BNZ   HIT3330                 HIT...
         S     R5,FSF3                 GET SLOT NBR OF LAST CHOICE
*
*
HIT3330  L     R6,HIORDER8             SET HI ORDER BIT IN REG
         SRDL  R6,0(R5)                BUILD MASK TO SLOT NBR
M3330SET ST    R5,SSLOT                SAVE SLOT NUMBER IN PARMLIST
         LTR   R6,R6                   TEST FOR ZERO MASK
         BZ    IN2NDWRD                IF ZERO, BIT IN 2ND WORD
         XR    R2,R6                   TURN BIT OFF IN SCYLRDWT
         ST    R2,SCYLRDWT
         O     R6,SCYLREAD             GET READ MASK
         C     R6,SCYLREAD             SEE IF BIT ALREADY ON          **
                                       (DETERMINE IF READ-SLOT)
         BE    GETREAD                 GET READ REQUEST FOUND
         ST    R6,SCYLWRT              STORE NEW READ (WRITE) MASK
         B     SETWRITE                GET WRITE REQUEST FOUND
IN2NDWRD XR    R3,R7
         ST    R3,SCYLRDWT+4
         O     R7,SCYLREAD+4           GET READ MASK
         C     R7,SCYLREAD+4           SEE IF BIT ALREADY ON          **
                                       (DETERMINE IF READ-SLOT)
         BE    GETREAD                 GET READ REQUEST FOUND
         ST    R7,SCYLWRT+4            STORE NEW READ (WRITE) MASK
         B     SETWRITE                GET WRITE REQUEST FOUND
COL3330  DC    XL3'010200'             NEXT BEST SLOT COLUMN ARRAY
*                                                                  0704
*/***********************************************************        */
*/*                                                                  */
*/*       F3350S: FIND NEXT BEST SLOT ON A 3350 SUBCYLINDER          */
*/*                                                                  */
*/*       INPUT: - LAST SLOT CHOSEN IN SUBCYLINDER                   */
*/*              - READ/WRITE SUBCYLINDER MAP MASK                   */
*/*              - READ SUBCYLINDER MAP MASK                         */
*/*              - NUMBER SLOTS/SUBCYLINDER                          */
*/*                                                                  */
*/*       PROCESS: THE NEXT BEST SLOT IS DETERMINED AND              */
*/*                TESTED. IF NO REQUEST MAY BE PROCESSED            */
*/*                FOR IT, THEN THE VERY-NEXT-COLUMN IS              */
*/*                FOUND AND TESTED FOR ZERO (HEAD SWITCHING         */
*/*                TO THE VERY-NEXT-COLUMN IS POSSIBLE ONLY          */
*/*                ACROSS THE PHYSICAL DISK INDEX).                  */
*/*                IF COLUMN ZERO IS NEXT, BEGIN THE                 */
*/*                COLUMN SCAN THERE. OTHERWISE, GET THE             */
*/*                NEXT COLUMN WHICH PERMITS HEAD SWITCHING.         */
*/*                SCAN ONE COLUMN AT A TIME (SEE DIAGRAM)           */
*/*                UNTIL A COLUMN WITH A HIT IS FOUND. A BIT         */
*/*                IN THE COLUMN IS FOUND AND A REQUEST FOR          */
*/*                THE SLOT REPRESENTED IS OBTAINED. THE             */
*/*                READ/WRITE MASK IS UPDATED SO THAT THE            */
*/*                SLOT WILL NOT BE CHOSEN AGAIN. IF A WRITE         */
*/*                REQUEST WAS SELECTED, THE APPROPRIATE BIT         */
*/*                IS SET IN THE READ MASK. THIS MASK MAY BE         */
*/*                USED LATER TO UPDATE THE PAT SUBCYLINDER          */
*/*                MAP.                                              */
*/*                                                                  */
*/*       OUTPUT: - UPDATED SLOT VALUE                               */
*/*               - UPDATED READ/WRITE MASK                          */
*/*               - UPDATED READ (WRITE) MASK IF WRITE SLOT          */
*/*                 SELECTED                                         */
*/*               - IOE (VIA GETREAD OR SETWRITE)                    */
*/*                                                                  */
*/*         NOTE - THE 3350 CYLINDER WITH A CAPACITY OF 130          */
*/*                SLOTS HAS BEEN BROKEN INTO 5 SUBCYLINDERS         */
*/*                OF 26 SLOTS EACH.                                 */
*/*                                                                  */
*/***********************************************************        */
*                                                                  0704
         EJECT
*F3350S:                                                           0704
*   GEN;                                                           0704
F3350S   DS    0H                                                  0704
*      /*
*
* 3350 SUBCYLINDER RELATIVE SLOT DIAGRAM
*
*   COLUMN ->
*   0            1            2            3            4
*   ×        5   ×        6   ×        7   ×        8   ×
*   ×    9   ×   ×   10   ×   ×   11   ×   ×   12   ×   ×
*TRK×    ×   ×   ×    ×   ×   ×    ×   ×   ×    ×   ×   ×
*   V____V___V___V____V___V___V____V___V___V____V___V___V____×
* 0 ×_____00_____×_____01_____×_____02_____×_____03_____×_04_×
* 1 ×________×_____05_____×_____06_____×_____07_____×___08___×
* 2 ×____×_____09_____×_____10_____×_____11_____×_____12_____×
* 3 ×_____13_____×_____14_____×_____15_____×_____16_____×_17_×
* 4 ×________×_____18_____×_____19_____×_____20_____×___21___×
* 5 ×____×_____22_____×_____23_____×_____24_____×_____25_____×
*
*
* GET THE PREVIOUS SLOT NUMBER AND SEE IF THE VERY-NEXT-SLOT
* IS AVAILABLE. IF AVAILABLE, GO PROCESS IT. OTHERWISE, SCAN
* THE COLUMNS ONE BY ONE.
*
        LA    R7,COL3350          GET ADDRESS OF TEST COLUMN
        B     COMSLT26            BRANCH TO COMMON FINDSLOT RTN
*                                                                  0705
*/********************************************************************/
*/*                                                                  */
*/*      F23052S: FIND NEXT BEST SLOT ON A 2305-2 CYLINDER           */
*/*                                                                  */
*/*      INPUT: - LAST SLOT CHOSEN IN CYLINDER                       */
*/*             - READ/WRITE CYLINDER MAP MASK                       */
*/*             - READ CYLINDER MAP MASK                             */
*/*             - NUMBER SLOTS/CYLINDER                              */
*/*                                                                  */
*/*      PROCESS: THE NEXT BEST SLOT IS DETERMINED AND TESTED. IF    */
*/*               NO REQUEST MAY BE PROCESSED FOR IT THEN THE READ/  */
*/*               WRITE MASK IS TESTED, ONE CYLINDER COLUMN AT A     */
*/*               TIME (SEE DIAGRAM) UNTIL A COLUMN WITH A HIT IS    */
*/*               FOUND. A BIT IN THE COLUMN IS FOUND AND A REQUEST  */
*/*               FOR THE SLOT REPRESENTED IS OBTAINED. THE READ/    */
*/*               WRITE MASK IS UPDATED SO THAT THE SLOT WILL NOT BE */
*/*               CHOSEN AGAIN. IF A WRITE REQUEST WAS SELECTED THE  */
*/*               APPROPRIATE BIT IS SET IN THE READ MASK.  THIS     */
*/*               MASK MAY BE LATER USED TO UPDATE THE PAT CYLINDER  */
*/*               MAP.                                               */
*/*               EXAMPLE 1. SUPPOSE 4 WAS LAST SLOT CHOSEN. THEN    */
*/*                          5 IS NEXT BEST. THEN COLUMN TESTS GO AS */
*/*                          FOLLOWS: 6-19,3-16,10-23,7-20,4-17,     */
*/*                          1-14, ETC. IF A HIT IS FOUND TEST ONE   */
*/*                          BIT IN COLUMN. IF NOT THAT ON, HIT IS   */
*/*                          OTHER BIT.                              */
*/*               EXAMPLE 2. SPECIAL CASE.                           */
*/*                          IF 12 OR 25 WAS LAST SLOT CHOSEN THEN   */
*/*                          TWO NEXT BEST POSSIBILITIES ACTUALLY    */
*/*                          EXIST: 0 AND 13. THIS SPECIAL CASE IS   */
*/*                          TESTED EXPLICITLY. IF NEITHER ARE GOOD, */
*/*                          THEN PROCESSING TESTS COLUMNS: 10-23,   */
*/*                          7-20,4-17,1-14,11-24,8-21,ETC.          */
*/*                                                                  */
*/*      OUTPUT: - UPDATED SLOT VALUE                                */
*/*              - UPDATED READ/WRITE MASK                           */
*/*              - UPDATED READ (WRITE) MASK IF WRITE SLOT SELECTED  */
*/*              - IOE (VIA GETREAD OR SETWRITE)                     */
*/*                                                                  */
*/*                                                                  */
*/********************************************************************/
*                                                                  0705
*F23052S:                                                          0705
*   GEN;                                                           0705
F23052S  DS    0H                                                  0705
*       /*
*
*     2305-2 CYLINDER RELATIVE SLOT DIAGRAM
*
* TRK ___________________________________________
*   0 ×_____0______×_____1______×_____2_____×_3_×
*   1 ×____3____×_____4______×_____5_____×__6___×
*   2 ×___6__×_____7______×_____8_____×____9____×
*   3 ×_9_×_____10_____×____11_____×____12______×
*   4 ×____13______×____14______×____15_____×___×
*   5 ×___16____×____17______×____18_____×__19__×
*   6 ×__19__×____20______×____21_____×___22____×
*   7 ×___×_____23_____×____24_____×____25______×
*
*
         LA    R7,COL23052             GET ADDRESS OF TEST COLUMN
COMSLT26  DS    0H                      COMMON RTN FOR 2305-2 & 3350
         L     R2,SCYLRDWT             GET READ/WRITE MASK
         L     R5,SSLOT                OBTAIN PREVIOUS SLOT NBR
         A     R5,FSF1                 INCR SLOT NBR TO NEXT SEQ
         C     R5,CYLSLOTS             PAST LAST SLOT IN CYL...
         BL    B2352NXT                NO, CONTINUE NEXT SLOT TEST
         SLR   R4,R4                   ZERO SLOT NBR
         B     T23052S                 TEST COLUMN ZERO SPECIALLY
*
B2352NXT LR    R4,R5                   OBTAIN NEXT SEQ SLOT NBR
         S     R4,FSF13                OBTAIN COLUMN NUMBER (MAYBE)
         BZ    T23052S                 TEST COLUMN ZERO SPECIALLY
         BP    T2352NXT                BRANCH IF VALID COLUMN NUMBER
         LR    R4,R5                   RESET VALID COLUMN NUMBER
T2352NXT L     R0,HIORDER8             SET HI ORDER BIT IN REG
         SRL   R0,0(R5)                BUILD MASK TO TEST NEXT SEQ    **
                                       SLOT
         NR    R0,R2                   TEST FOR HIT
         BNZ   M2352SET                IF HIT, PREPARE TO GET OUT
*
*
*
T23052   IC    R4,0(R4,R7)             GET TEST 'COLUMN'
T23052S  LR    R0,R2                   GET SCYLRDWT MASK COPY
         SLL   R0,0(R4)                SHIFT COPY FOR CORRECT COLUMN  **
                                       TEST
         N     R0,FSDCOLL2             ANY BITS ON....
         BZ    T23052                  IF NOT, LOOP & GET NEXT COLUMN
         LR    R5,R4                   GET COLUMN NBR
*
*
B23052   ALR   R0,R0                   SHIFT ONE LEFT, SET            **
                                       CONDITION CODE IF CARRY
         BC    3,HIT23052              GOT A SLOT IF CARRY
         A     R5,FSF13                IF NO SLOT, INCREMENT SLOT NBR **
                                       TO ONLY OTHER POSSIBLE SLOT
*
*
HIT23052 L     R0,HIORDER8             SET HI ORDER BIT IN REG
         SRL   R0,0(R5)                BUILD MASK TO SLOT NBR
M2352SET ST    R5,SSLOT                SAVE SLOT NUMBER IN PARMLIST
         XR    R2,R0                   TURN BIT OFF IN SCYLRDWT
         ST    R2,SCYLRDWT
         O     R0,SCYLREAD             GET READ MASK
         C     R0,SCYLREAD             SEE IF BIT ALREADY ON          **
                                       (DETERMINE IF READ-SLOT)
         BE    GETREAD                 GET READ REQUEST FOUND
         ST    R0,SCYLWRT              STORE NEW READ (WRITE) MASK
         B     SETWRITE                GET WRITE REQUEST FOUND
COL23052 DC    XL13'0A0B0C00010203040506070809' NEXT BEST SLOT COLUMN **
                                                ARRAY
COL3350  DC    X'090A0B0C000102030405060708' NEXT COLUMN ARRAY
*                                                                  0706
*/********************************************************************/
*/*                                                                  */
*/*      F23051S: FIND NEXT BEST SLOT ON A 2305-1 CYLINDER           */
*/*                                                                  */
*/*      INPUT: - LAST SLOT CHOSEN IN CYLINDER                       */
*/*             - READ/WRITE CYLINDER MAP MASK                       */
*/*             - READ CYLINDER MAP MASK                             */
*/*             - NUMBER SLOTS/CYLINDER                              */
*/*                                                                  */
*/*      PROCESS: THE NEXT BEST SLOT IS DETERMINED AND TESTED. IF    */
*/*               NO REQUEST MAY BE PROCESSED FOR IT THEN THE READ/  */
*/*               WRITE MASK IS TESTED, ONE CYLINDER COLUMN AT A     */
*/*               TIME (SEE DIAGRAM) UNTIL A COLUMN WITH A HIT IS    */
*/*               FOUND. A BIT IN THE COLUMN IS FOUND AND A REQUEST  */
*/*               FOR THE SLOT REPRESENTED IS OBTAINED. THE READ/    */
*/*               WRITE MASK IS UPDATED SO THAT THE SLOT WILL NOT BE */
*/*               CHOSEN AGAIN. IF A WRITE REQUEST WAS SELECTED THE  */
*/*               APPROPRIATE BIT IS SET IN THE READ MASK.  THIS     */
*/*               MASK MAY BE LATER USED TO UPDATE THE PAT CYLINDER  */
*/*               MAP.                                               */
*/*                                                                  */
*/*      OUTPUT: - UPDATED SLOT VALUE                                */
*/*              - UPDATED READ/WRITE MASK                           */
*/*              - UPDATED READ (WRITE) MASK IF WRITE SLOT SELECTED  */
*/*              - IOE (VIA GETREAD OR SETWRITE)                     */
*/*                                                                  */
*/********************************************************************/
*                                                                  0706
*F23051S:                                                          0706
*   GEN;                                                           0706
F23051S  DS    0H                                                  0706
*       /*
*
*     2305-1 CYLINDER RELATIVE SLOT DIAGRAM
*
* TRK ______________________________
*   0 ×____0___×____1___×____2___×_×
*   1 ×___3___×____4___×____5___×__×
*   2 ×__6___×____7___×____8___×___×
*   3 ×__9__×___10___×___11___×_12_×
*   4 ×_12_×___13___×___14___×_15__×
*   5 ×___×___16___×___17___×__18__×
*   6 ×__×___19___×___20___×__21___×
*   7 ×_×___22___×___23___×___24___×
*
*
         L     R2,SCYLRDWT             GET READ/WRITE MASK
         L     R5,SSLOT                OBTAIN PREVIOUS SLOT NBR
         A     R5,FSF1                 INCR SLOT NBR TO NEXT SEQ
         C     R5,CYLSLOTS             PAST LAST SLOT IN CYL...
         BL    B2351NXT                NO, CONTINUE PARTIAL COL TEST
         SLR   R5,R5                   ZERO SLOT NBR
         LTR   R2,R2                   TEST IF ZERO BIT ON
         BM    HIT23051                IF HIT, THEN PROCESS
         B     T23051                  IF NO HIT, GET NEXT COL AND    **
                                       CONTINUE
B2351NXT LR    R7,R2                   COPY READ/WRITE MASK
         SLR   R6,R6                   ZERO EVEN REG OF PAIR
         SLDL  R6,1(R5)                SHIFT ONLY POTENTIAL HITS FOR  **
                                       CURRENT (FIRST) COLUMN
         N     R6,FS3COLRB             TEST FOR HIT
         BNZ   B23051T3                IF HIT, GO DETERMINE WHICH
*
G2351COL SLR   R4,R4                   ZERO ODD REG OF PAIR
         D     R4,FSF3                 DETERMINE SLOT 'COLUMN'
         LR    R5,R4                   GET COLUMN NUMBER
*
*
T23051   IC    R5,COL23051(R5)         GET TEST 'COLUMN'
         LR    R6,R2                   GET SCYLRDWT MASK COPY
         SLL   R6,0(R5)                SHIFT COPY FOR CORRECT COLUMN  **
                                       TEST
         N     R6,FS3COLLB             ANY BITS ON....
         BZ    T23051                  IF NOT, LOOP & GET NEXT COLUMN
*
*
         SRL   R6,7                    SHIFT OFF MEANINGLESS BITS
         LA    R5,24(R5)               GET MAX SLOT NUMBER FOR COLUMN
B23051T3 L     R0,FS3COLR3             GET MASK TO TEST 3 BITS
         NR    R0,R6                   TEST FIRST 3 BITS
         BNZ   B23051T1                BRANCH IF AT LEAST ONE BIT ON
         SRL   R6,9                    SHIFT OFF 3 BAD POSSIBILITIES
         S     R5,FSF9                 GET SLOT NBR NEXT POSSIBILITY
         L     R0,FS3COLR3             GET MASK TO TEST 3 MORE BITS
         NR    R0,R6                   TEST NEXT 3 BITS
         BNZ   B23051T1                BRANCH IF AT LEAST ONE BIT ON
         SRL   R6,9                    SHIFT OFF 3 BAD POSSIBILITIES
         S     R5,FSF9                 GET SLOT NBR NEXT POSSIBILITY
*
B23051T1 LR    R7,R6                   SAVE COPY OF MASK
         N     R6,FSLOBIT1             TEST BEST POSSIBILITY
         BNZ   HIT23051                HIT...
         S     R5,FSF3                 GET SLOT NBR NEXT POSSIBILITY
         N     R7,FSLOBIT4             TEST NEXT BEST POSSIBILITY
         BNZ   HIT23051                HIT...
         S     R5,FSF3                 GET SLOT NBR OF CHOICE
*
*
HIT23051 L     R0,HIORDER8             SET HI ORDER BIT IN REG
         SRL   R0,0(R5)                BUILD MASK TO SLOT NBR
M2351SET ST    R5,SSLOT                SAVE SLOT NUMBER IN PARMLIST
         XR    R2,R0                   TURN BIT OFF IN SCYLRDWT
         ST    R2,SCYLRDWT
         O     R0,SCYLREAD             GET READ MASK
         C     R0,SCYLREAD             SEE IF BIT ALREADY ON          **
                                       (DETERMINE IF READ-SLOT)
         BE    GETREAD                 GET READ REQUEST FOUND
         ST    R0,SCYLWRT              STORE NEW READ (WRITE) MASK
         B     SETWRITE                GET WRITE REQUEST FOUND
COL23051 DC    XL3'010200'             NEXT BEST SLOT COLUMN ARRAY
*   END FSRTNS;                                                    0707
*                                                                  0707
@EL00020 DS    0H                                                  0707
@EF00020 DS    0H                                                  0707
@ER00020 BR    @14                                                 0707
*/* MACCOMP Y-4SCICW/PZD81                                           */
*/* MACSTAT Y-475152/415304                                          */
*/*A 000000-999999                                           @Z40WPWF*/
*/********************************************************************/
*/*                                                                  */
*/* NAME: ILRCNVRT                                                   */
*/*                                                                  */
*/* STATUS: OS/VS2 RELEASE 4.1, LEVEL 0                              */
*/*                                                                  */
*/* ENTRY POINT: ILRCNVRT                                            */
*/*                                                                  */
*/* FUNCTION: CONVERT AN RBA TO A FULL SEEK ADDRESS- MBBCCHHR        */
*/*                                                                  */
*/* INPUT: R0- EDB HEADER ADDRESS                                    */
*/*        R1- POINTER TO 8 BYTE AREA TO STORE SEEK ADDRESS          */
*/*            WORD 1- RBA TO BE CONVERTED                           */
*/*        R13- SAVE AREA POINTER                                    */
*/*        R14- RETURN ADDRESS                                       */
*/*                                                                  */
*/* PROCESS: CONVERTS AN RBA TO MBBCCHHR USING THE EDB AND LPMB.     */
*/*                                                                  */
*/* OUTPUT: MBBCCHHR IN 8 BYTE AREA POINTED TO BY REG 1              */
*/*         R15- RETURN CODE                                         */
*/*              0 - CONVERSION OK                                   */
*/*              4- EDB NOT FOUND FOR THIS RBA                       */
*/*                                                                  */
*/* EXIT-NORMAL: RETURN TO CALLER                                    */
*/*              R15= 0                                              */
*/*                                                                  */
*/* EXIT-ERROR: RETURN TO CALLER                                     */
*/*              R15= 4                                              */
*/*                                                                  */
*/* EXTERNAL REFERENCES: NONE                                        */
*/*                                                                  */
*/* REGISTERS CLOBBERED: REGISTERS SAVED UPON ENTRY                  */
*/*                      THEN REGS 0-5 USED FOR PROCESSING           */
*/*                      UPON RETURN, ALL REGS RESTORED EXCEPT       */
*/*                      R15 WHICH CONTAINS THE RETURN CODE          */
*/*                                                                  */
*/* MAPPING MACROS USED:  IDAEDB                                     */
*/*                       IDALPMB                                    */
*/*                                                                  */
*/* NOTES: THE CALLING MODULE MUST INCLUDE THE MAPPING MACROS LISTED */
*/*        ABOVE. ADDRESSABILITY FOR THESE MACROS WILL BE SET UP IN  */
*/*        THIS ROUTINE.                                             */
*/*        ALL LABELS AND DATA AREAS CREATED BY THIS ROUTINE BEGIN   */
*/*        WITH THE FIVE CHARACTERS 'CNVRT'.                         */
*/*        THIS ROUTINE REQUIRES THAT THE CALLING MODULE DECLARE     */
*/*        REGISTERS AS R0-R15.                                      */
*/*                                                                  */
*/********************************************************************/
*                                                                  0708
*                                                                  0708
*/*ILRCNVRT: CHART                                                   */
*/* HEADER                                                         0708
*/*  ILRCNVRT:  ASM CONVERT ROUTINE                                  */
*/*ILRCNVRT:  E CONVERT RBA TO SEEK ADDR                             */
*/* P SET UP PTR TO EDB HDR                                          */
*/* P SET UP PTR TO 1ST EDB ENTRY                                    */
*/* P PICK UP RBA FROM INPUT PARMS                                   */
*/* P INITIALIZE RETURN CODE TO 4                                    */
*/* N LOOP WHILE R15 = 4                                             */
*/*%CNV1: D (NO,,YES,%CNV4) ALL EDB ENTRIES TRIED?                   */
*/*       D (YES,,NO,%CNV4) RETURN CODE STILL 4?                     */
*/*       D (YES,,NO,%CNV2) RBA IN THIS EDB ENTRY                    */
*/* P (,%CNV1) SET RETURN CODE TO ZERO                               */
*/*%CNV2: P (,%CNV1) UPDATE TO NEXT EDB ENTRY                        */
*/* N END OF LOOP                                                    */
*/*%CNV4: D (YES,,NO,%CNVEXT)  EDB ENTRY FOUND?                      */
*/* P GET LPMB ADDRESS                                               */
*/* P ZERO 8 BYTE OUTPUT AREA                                        */
*/* P GET RELATIVE RBA PER THIS EXTENT                               */
*/* P SET UP EXTENT NUMBER- M                                        */
*/* P CALCULATE RELATIVE CYLINDER FOR DATA SET                       */
*/* P CALCULATE RELATIVE TRACK FOR DATA SET                          */
*/* P CALCULATE RECORD NUMBER- R                                     */
*/* P CALCULATE ACTUAL CYLINDER FOR DEVICE                           */
*/* P CALCULATE ACTUAL TRACK FOR DEVICE                              */
*/*%CNVEXT: R RETURN TO CALLER                                       */
*/*ILRCNVRT: END                                                     */
*                                                                  0708
*ILRCNVRT:                                                         0708
*   PROC OPTIONS(NOSAVEAREA);                                      0708
ILRCNVRT STM   @14,@12,12(@13)                                     0708
*   DCL                                                            0709
*     1 CNVRTSKA CHAR(8) BASED(R1)  /* FULL SEEK ADDRESS             */
*           BDY(DWORD),                                            0709
*      2 CNVRTM CHAR(1),            /* EXTENT NUMBER                 */
*      2 * CHAR(2),                 /* BIN NUMBER                    */
*      2 CNVRTCC CHAR(2),           /* CYLINDER NUMBER               */
*      2 CNVRTHH CHAR(2),           /* TRACK (HEAD) NUMBER           */
*      2 CNVRTR CHAR(1);            /* RECORD NUMBER                 */
*   DCL                                                            0710
*     CNVRTBAD FIXED(31) CONSTANT(4);/* BAD RETURN CODE              */
*   DCL                                                            0711
*     CNVRTOK FIXED(31) CONSTANT(0);/* GOOD RETURN CODE              */
*   DCL                                                            0712
*     CNVRTRBA FIXED(31) DEFINED(CNVRTSKA);                        0712
*   DCL                                                            0713
*     CNVRTONE FIXED(31) CONSTANT(1);/* CONSTANT OF ONE              */
*   RFY                                                            0714
*    (R0,                                                          0714
*     R1,                                                          0714
*     R2) RSTD;                     /* SAVE PARM REGISTERS           */
*   R2=R0;                          /* SET UP EDBHDPTR IN REG2       */
         LR    R2,R0                                               0715
*   RFY                                                            0716
*     R0 UNRSTD;                    /* NO NEED FOR R0                */
*   RFY                                                            0717
*     R3 RSTD;                                                     0717
*   R3=R2+LENGTH(IDAEDBHD);         /* POINT R3 TO FIRST EDB ENTRY   */
         LA    R3,8                                                0718
         ALR   R3,R2                                               0718
*   RFY                                                            0719
*     R5 RSTD;                                                     0719
*   R5=CNVRTRBA;                    /* RBA TO BE CONVERTED           */
         L     R5,CNVRTRBA(,R1)                                    0720
*   RFY                                                            0721
*    (R4,                                                          0721
*     R15) RSTD;                                                   0721
*   R15=CNVRTBAD;                   /* INITIALIZE RETURN CODE        */
         LA    R15,4                                               0722
*   DO R4=R2->EDBNO TO 1 BY-1       /* LOOP THROUGH EDB ENTRIES      */
*         WHILE R15=CNVRTBAD;                                      0723
         SLR   R4,R4                                               0723
         IC    R4,EDBNO(,R2)                                       0723
         B     @DE00723                                            0723
@DL00723 C     R15,@CF00119                                        0723
         BNE   @DC00723                                            0723
*     IF R5=>R3->EDBLORBA&          /* IF RBA IN THIS EXTENT         */
*         R5<=R3->EDBHIRBA THEN     /* THEN RESET RETURN CODE        */
         CL    R5,EDBLORBA(,R3)                                    0724
         BL    @RF00724                                            0724
         CL    R5,EDBHIRBA(,R3)                                    0724
         BH    @RF00724                                            0724
*       R15=CNVRTOK;                                               0725
         SLR   R15,R15                                             0725
*     ELSE                          /* ELSE, CHECK NEXT ENTRY        */
*       R3=R3+R2->EDBLEN;                                          0726
         B     @RC00724                                            0726
@RF00724 AH    R3,EDBLEN(,R2)                                      0726
*   END;                                                           0727
@RC00724 BCTR  R4,0                                                0727
@DE00723 LTR   R4,R4                                               0727
         BP    @DL00723                                            0727
@DC00723 DS    0H                                                  0728
*   IF R15=CNVRTOK                  /* IF FOUND EDB ENTRY,           */
*     THEN                                                         0728
         LTR   R15,R15                                             0728
         BNZ   @RF00728                                            0728
*     DO;                           /* THEN DO CONVERSION            */
*/*                                                                  */
*/*                 FOUND EDB ENTRY                                  */
*/*                                                                  */
*                                                                  0730
*       R2=R3->EDBLPMBA;            /* GET LPMB ADDRESS              */
         L     R2,EDBLPMBA(,R3)                                    0730
*       CNVRTSKA=''B;               /* ZERO FULL SEEK ADDRESS        */
         XC    CNVRTSKA(8,R1),CNVRTSKA(R1)                         0731
*       R5=R5-R3->EDBLORBA;         /* RELATIVE RBA THIS EXTENT      */
         SL    R5,EDBLORBA(,R3)                                    0732
*       CNVRTM=R3->EDBM;            /* SET UP EXTENT NUMBER          */
         IC    @14,EDBM(,R3)                                       0733
         STC   @14,CNVRTM(,R1)                                     0733
*/*                                                                  */
*/*          OPTIMIZE CODE BY USING ASSEMBLER FOR DIVISION           */
*/*                                                                  */
*                                                                  0734
*       GENERATE REFS(LPMAUSZ,LPMBPTRK,LPMBLKSZ,R2,R4,R5,CNVRTCC,  0734
*           CNVRTHH);                                              0734
*
*           CNVRTCC = REL RBA / BYTES PER ALLOCATION UNIT
*           R5= R5 / LPMAUSZ
*           R4= R5 // LPMAUSZ
*
            SR   R4,R4                 ZERO EVEN REGISTER
            D    R4,LPMAUSZ(,R2)       RBA / BYTES PER ALLOC UNIT
            STCM R5,3,CNVRTCC(R1)      RELATIVE CYL VALVE
            LR   R5,R4                 REMAINDER= RELATIVE TRACK
*
*           CNVRTHH = RELATIVE TRACK / BYTES PER TRACK
*           R5= R5 / LPMBPTRK
*           R4= R5 // LPMBPTRK
*
            SR   R4,R4                 ZERO EVEN REGISTER
            D    R4,LPMBPTRK(,R2)      REL TRACK / BYTES PER TRACK
            STCM R5,3,CNVRTHH(R1)      RELATIVE TRACK VALVE
*
*           CNVRTR= (( RELATIVE RECORD + BLOCKSIZE -1) / BLOCKSIZE)+1
*                R7= ( R6 + LPMBLKSZ - 1 ) / LPMBLKSZ
*
            A    R4,LPMBLKSZ(,R2)      ADD PHYSICAL BLOCKSIZE
            BCTR R4,0                  SUBTRACT 1 FOR ROUNDING
            LR   R5,R4                 SET UP FOR DIVISION
            SR   R4,R4                 ZERO EVEN REGISTER
            D    R4,LPMBLKSZ(,R2)      DIVIDE BY BLOCKSIZE
*       CNVRTR=R5+CNVRTONE;         /* RECORD NUMBER                 */
         LA    @14,1                                               0735
         ALR   @14,R5                                              0735
         STC   @14,CNVRTR(,R1)                                     0735
*/*                                                                  */
*/*      CNVRTCC=(CNVRTCC * LPMTRKAU + CNVRTHH + EDBSTTRK)/ LPMTPC   */
*/*      CNVRTHH=(CNVRTCC * LPMTRKAU + CNVRTHH + EDBSTTRK)// LPMTPC  */
*/*                                                                  */
*                                                                  0736
*       R5=CNVRTCC*(R2->LPMTRKAU)+CNVRTHH+(R3->EDBSTTRK);          0736
         SLR   R5,R5                                               0736
         ICM   R5,3,CNVRTCC(R1)                                    0736
         MH    R5,LPMTRKAU(,R2)                                    0736
         SLR   @14,@14                                             0736
         ICM   @14,3,CNVRTHH(R1)                                   0736
         ALR   R5,@14                                              0736
         AL    R5,EDBSTTRK(,R3)                                    0736
*       GENERATE REFS(LPMTPC,R3,R4,R5,R2,R1,CNVRTCC,CNVRTHH);      0737
*
*           CNVRTCC= R5 / LPMTPC
*           CNVRTHH= R5 // LPMTPC
*
            SR    R4,R4                ZERO EVEN REGISTER
            LH    R3,LPMTPC(,R2)       PICK UP TRACKS PER CYLINDER
            DR   R4,R3                 R5 / LPMTPC
            STCM R5,3,CNVRTCC(R1)      ACTUAL CYLINDER ADDRESS
            STCM R4,3,CNVRTHH(R1)      ACTUAL HEAD ADDRESS
*     END;                          /* END OF CONVERSION PROCESS     */
*   RETURN CODE(R15);               /* RETURN TO CALLER              */
@RF00728 L     @14,12(,@13)                                        0739
         LM    @00,@12,20(@13)                                     0739
         BR    @14                                                 0739
*   END ILRCNVRT;                                                  0740
*   RFY                                                            0741
*    (R1,                                                          0741
*     R2,                                                          0741
*     R3,                                                          0741
*     R4,                                                          0741
*     R5,                                                          0741
*     R15) UNRSTD;                                                 0741
*   END ILRSRT                                                     0742
*                                                                  0742
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.     */
*/*%INCLUDE SYSLIB  (ILRAIA  )                                       */
*/*%INCLUDE SYSLIB  (ILRASMVT)                                       */
*/*%INCLUDE SYSLIB  (ILRATA  )                                       */
*/*%INCLUDE SYSLIB  (CVT     )                                       */
*/*%INCLUDE SYSLIB  (IDAEDB  )                                       */
*/*%INCLUDE SYSLIB  (ILREPATH)                                       */
*/*%INCLUDE SYSLIB  (IECDIOCM)                                       */
*/*%INCLUDE SYSLIB  (ILRIOE  )                                       */
*/*%INCLUDE SYSLIB  (ILRIORB )                                       */
*/*%INCLUDE SYSLIB  (IECDIOSB)                                       */
*/*%INCLUDE SYSLIB  (IDALPMB )                                       */
*/*%INCLUDE SYSLIB  (ILRPART )                                       */
*/*%INCLUDE SYSLIB  (ILRPAT  )                                       */
*/*%INCLUDE SYSLIB  (IHAPCB  )                                       */
*/*%INCLUDE SYSLIB  (ILRPCCW )                                       */
*/*%INCLUDE SYSLIB  (ILRPCT  )                                       */
*/*%INCLUDE SYSLIB  (IHAPSA  )                                       */
*/*%INCLUDE SYSLIB  (IHASRB  )                                       */
*/*%INCLUDE SYSLIB  (ILRCNVRT)                                       */
*                                                                  0742
*       ;                                                          0742
@DATA    DS    0H
@DATD    DSECT
         DS    0F
ILRSRT   CSECT
         DS    0F
@CF00045 DC    F'1'
@CF00084 DC    F'2'
@CF00119 DC    F'4'
@CF00032 DC    F'8'
@CF01189 DC    F'36'
@CF02144 DC    XL4'0000FFFF'
@DATD    DSECT
         DS    0D
ATAPTR   DS    A
IORBPTR  DS    A
PAREPTR  DS    A
CYLMPWDS DS    F
CYLSLOTS DS    F
ENDCYL   DS    F
FSRTNPTR DS    A
PRMLADDR DS    A
RETADDR1 DS    A
RETADDR2 DS    A
RETADDR3 DS    A
REQNEED  DS    F
SSECN    DS    F
THISCYL  DS    F
TSLOTNBR DS    F
TOPRDIOE DS    A
WRITEQUE DS    A
ZEROLIST DS    CL58
         ORG   ZEROLIST
RETCODE  DS    FL4
LASTSLOT DS    FL4
LASTP    DS    AL4
LASTTRK  DS    FL4
LASTCYL  DS    FL4
NUMREQS  DS    FL4
READCYL  DS    FL4
SCYLINFO DS    CL29
         ORG   SCYLINFO
SCYLCOPY DS    CL8
SCYLREAD DS    CL8
         ORG   SCYLREAD
SCYLWRT  DS    CL8
         ORG   SCYLINFO+16
SCYLRDWT DS    CL8
SSLOT    DS    FL4
SCYLFLGS DS    BL1
         ORG   ZEROLIST+57
SRTFLGS  DS    BL1
         ORG   SRTFLGS
STOP     DS    BL1
SEEK     EQU   SRTFLGS+0
SETSEC   EQU   SRTFLGS+0
DPFLG    EQU   SRTFLGS+0
         ORG   ZEROLIST+58
         DS    CL2
SRTSA    DS    CL72
         ORG   SRTSA
@NM00061 DS    CL4
CALLR13  DS    AL4
@NM00062 DS    CL4
SRTR14   DS    AL4
SRTR15   DS    AL4
SRTR0    DS    FL4
SRTR1    DS    AL4
SRTR2    DS    AL4
         ORG   SRTSA+72
         ORG   *+1-(*-@DATD)/(*-@DATD) INSURE DSECT DATA
@ENDDATD EQU   *
ILRSRT   CSECT
         NOPR  ((@ENDDATD-@DATD)/257*16)
         DS    0F
@SIZDATD DC    AL1(0)
         DC    AL3(@ENDDATD-@DATD)
         DS    0D
FSLOBIT1 DC    BL4'00000000000000000000000000000001'
FSLOBIT4 DC    BL4'00000000000000000000000000001000'
FSHIBIT3 DC    BL4'00100000000000000000000000000000'
FS3COLR3 DC    BL4'00000000000000000000000001001001'
FS3COLR5 DC    BL4'00000000000000000001001001001001'
FS3COLR9 DC    BL4'00000001001001001001001001001001'
FS3COLRB DC    BL4'01001001001001001001001001001001'
FS3COLLB DC    BL4'10010010010010010010010010010010'
FS3COLL5 DC    BL4'10010010010010000000000000000000'
FS3COLL3 DC    BL4'10010010000000000000000000000000'
FS4COLL6 DC    BL4'10001000100010001000100000000000'
FS4COLL3 DC    BL4'10001000100000000000000000000000'
FSDCOLL2 DC    BL4'10000000000001000000000000000000'
FSF3     DC    F'3'
FSF4     DC    F'4'
FSF9     DC    F'9'
FSF12    DC    F'12'
FSF13    DC    F'13'
FSF15    DC    F'15'
FSF33    DC    F'33'
ALLFFSTR DC    X'FFFFFFFFFFFFFFFF'
FFCMPARE DC    X'FF000000'
HIORDER8 DC    X'80000000'
DEVDTABL DS    CL4
         ORG   DEVDTABL+0
DEVDFSRT DC    A(0)
         ORG   DEVDTABL+4
         ORG   DEVDTABL+4
         DC    A(0)
         ORG   DEVDTABL+8
         ORG   DEVDTABL+8
         DC    A(0)
         ORG   DEVDTABL+12
         ORG   DEVDTABL+12
         DC    A(0)
         ORG   DEVDTABL+16
         ORG   DEVDTABL+16
         DC    A(0)
         ORG   DEVDTABL+20
         ORG   DEVDTABL+20
         DC    AL4(F23051S)
         ORG   DEVDTABL+24
         ORG   DEVDTABL+24
         DC    AL4(F23052S)
         ORG   DEVDTABL+28
         ORG   DEVDTABL+28
         DC    AL4(F2314S)
         ORG   DEVDTABL+32
         ORG   DEVDTABL+32
         DC    AL4(F3330S)
         ORG   DEVDTABL+36
         ORG   DEVDTABL+36
         DC    AL4(F3340S)
         ORG   DEVDTABL+40
         ORG   DEVDTABL+40
         DC    AL4(F3350S)
         ORG   DEVDTABL+44
         ORG   DEVDTABL+44
         DC    A(0)
         ORG   DEVDTABL+48
         ORG   DEVDTABL+48
         DC    AL4(F3330S)
         ORG   DEVDTABL+52
@00      EQU   00                      EQUATES FOR REGISTERS 0-15
@01      EQU   01
@02      EQU   02
@03      EQU   03
@04      EQU   04
@05      EQU   05
@06      EQU   06
@07      EQU   07
@08      EQU   08
@09      EQU   09
@10      EQU   10
@11      EQU   11
@12      EQU   12
@13      EQU   13
@14      EQU   14
@15      EQU   15
TORBA    EQU   @06
THISNODE EQU   @02
STRTCYL  EQU   @05
RELPOS   EQU   @07
NEXTNODE EQU   @02
NEXTLE   EQU   @05
NEXTGT   EQU   @07
LSIDPTR  EQU   @02
LASTNODE EQU   @06
CURRBA   EQU   @05
PMAPADDR EQU   @02
PCTPTR   EQU   @11
PCCWPTR  EQU   @02
PCBPTR   EQU   @06
IOSBPTR  EQU   @05
IOEPTR   EQU   @12
AIAPTR   EQU   @05
ASMVTPTR EQU   @03
EPAPTR   EQU   @04
R0       EQU   @00
R1       EQU   @01
R2       EQU   @02
R3       EQU   @03
R4       EQU   @04
R5       EQU   @05
R7       EQU   @07
R9       EQU   @09
R12      EQU   @12
R13      EQU   @13
R14      EQU   @14
R15      EQU   @15
R10      EQU   @10
R11      EQU   @11
R6       EQU   @06
R8       EQU   @08
PSA      EQU   0
FLCRNPSW EQU   PSA
FLCROPSW EQU   PSA+8
FLCICCW2 EQU   PSA+16
FLCCVT   EQU   FLCICCW2
PSAEEPSW EQU   PSA+132
PSAESPSW EQU   PSA+136
FLCSVILC EQU   PSAESPSW+1
PSAEPPSW EQU   PSA+140
FLCPIILC EQU   PSAEPPSW+1
FLCPICOD EQU   PSAEPPSW+2
PSAPICOD EQU   FLCPICOD+1
FLCTEA   EQU   PSAEPPSW+4
FLCPER   EQU   PSA+152
FLCMCLA  EQU   PSA+168
FLCIOEL  EQU   FLCMCLA+4
FLCIOA   EQU   FLCMCLA+16
FLCFSA   EQU   FLCMCLA+80
PSASUPER EQU   PSA+552
PSASUP1  EQU   PSASUPER
PSASUP2  EQU   PSASUPER+1
PSASUP3  EQU   PSASUPER+2
PSASUP4  EQU   PSASUPER+3
PSACLHT  EQU   PSA+640
PSALKSA  EQU   PSA+696
PSAHLHI  EQU   PSA+760
PSADSSFL EQU   PSA+836
PSADSSF1 EQU   PSADSSFL
PSADSSF3 EQU   PSADSSFL+2
PSADSSF4 EQU   PSADSSFL+3
PSARSVT  EQU   PSA+896
AIA      EQU   0
AIAFLG1  EQU   AIA+9
AIAWRITE EQU   AIAFLG1
AIADUPLX EQU   AIAFLG1
AIAFLG2  EQU   AIA+10
AIAFLG3  EQU   AIA+11
AIANXAIA EQU   AIA+12
AIACYL   EQU   AIANXAIA
AIARCSN  EQU   AIANXAIA+2
AIAID    EQU   AIA+16
AIALPID  EQU   AIAID
AIALGID  EQU   AIALPID
AIALSID  EQU   AIALGID
AIASSID  EQU   AIALSID+1
AIASLOT  EQU   AIASSID+1
AIARPN   EQU   AIALPID+4
AIALSID2 EQU   AIARPN
AIALPMEP EQU   AIALSID2
AIAGRPSZ EQU   AIA+24
AIALGE   EQU   AIAGRPSZ
ASMVT    EQU   0
ASMFLAG1 EQU   ASMVT
ASMFLAG2 EQU   ASMVT+1
ASMPART  EQU   ASMVT+8
ASMSTAGQ EQU   ASMVT+32
ASMPCCWQ EQU   ASMVT+64
ASMBURST EQU   ASMVT+76
ASMIOCNT EQU   ASMVT+80
ASMLSAI  EQU   ASMVT+144
ASMGOSQS EQU   ASMVT+152
ASMIOEPC EQU   ASMVT+296
ASMWKSA1 EQU   ASMVT+368
ASMWKSA2 EQU   ASMVT+448
ASMWKSA3 EQU   ASMVT+528
ASMWKSA4 EQU   ASMVT+608
ASMWKSA5 EQU   ASMVT+688
ASMPOOLS EQU   0
ASMCPAVQ EQU   ASMPOOLS+8
ASMCPAVL EQU   ASMCPAVQ
ASMCPRSQ EQU   ASMPOOLS+16
ATA      EQU   0
ATASFLGS EQU   ATA+1
ATASRT   EQU   ATASFLGS+1
ATARFLGS EQU   ATA+4
ATARCRSN EQU   ATA+6
ATACLEAR EQU   ATA+8
ATAEPATH EQU   ATACLEAR+4
CVTMAP   EQU   0
CVTDAR   EQU   CVTMAP+72
CVTFLGS1 EQU   CVTDAR
CVTDCB   EQU   CVTMAP+116
CVTIOQET EQU   CVTMAP+120
CVTIXAVL EQU   CVTMAP+124
CVTIERLC EQU   CVTMAP+144
CVTHEAD  EQU   CVTMAP+160
CVTSV76C EQU   CVTHEAD
CVTOPTA  EQU   CVTMAP+182
CVTOPTB  EQU   CVTMAP+183
CVTGTF   EQU   CVTMAP+236
CVTGTFST EQU   CVTGTF
CVTGTFS  EQU   CVTGTFST
CVTSTATE EQU   CVTGTFST
CVTTMODE EQU   CVTGTFST
CVTFORM  EQU   CVTGTFST
CVTAQAVT EQU   CVTMAP+240
CVTTCMFG EQU   CVTAQAVT
CVTVOLM2 EQU   CVTMAP+244
CVTTATA  EQU   CVTVOLM2
CVTTSKS  EQU   CVTTATA
CVTVOLF2 EQU   CVTTSKS
CVTTAT   EQU   CVTTATA+1
CVTATER  EQU   CVTMAP+248
CVTEXT1  EQU   CVTMAP+252
CVTPURG  EQU   CVTMAP+260
CVTQMSG  EQU   CVTMAP+268
CVTDMSR  EQU   CVTMAP+272
CVTRSV37 EQU   CVTDMSR
CVTDMSRF EQU   CVTRSV37
CVTERPV  EQU   CVTMAP+316
CVTINTLA EQU   CVTMAP+320
CVTAPF   EQU   CVTMAP+324
CVTEXT2  EQU   CVTMAP+328
CVTHJES  EQU   CVTMAP+332
CVTPGSIA EQU   CVTMAP+348
CVTA1F1  EQU   CVTMAP+356
CVTSYSK  EQU   CVTMAP+357
CVTVOLM1 EQU   CVTMAP+380
CVTVOLF1 EQU   CVTVOLM1
CVTATMCT EQU   CVTMAP+388
CVTXTNT1 EQU   0
CVTXTNT2 EQU   0
CVTDSSV  EQU   CVTXTNT2
CVTFLGBT EQU   CVTXTNT2+5
CVTQID   EQU   CVTXTNT2+24
CVTRV400 EQU   CVTXTNT2+52
CVTRV409 EQU   CVTXTNT2+53
CVTATCVT EQU   CVTXTNT2+64
CVTRV429 EQU   CVTXTNT2+84
CVTRV438 EQU   CVTXTNT2+85
CVTRV457 EQU   CVTXTNT2+112
CVTRV466 EQU   CVTXTNT2+113
CVTFIX   EQU   0
CVTRELNO EQU   CVTFIX+252
IDAEDBHD EQU   0
EDBNO    EQU   IDAEDBHD+1
EDBLEN   EQU   IDAEDBHD+2
IDAEDB   EQU   0
EDBFLG1  EQU   IDAEDB+2
EDBM     EQU   IDAEDB+3
EDBLPMBA EQU   IDAEDB+4
EDBSTTRK EQU   IDAEDB+8
EDBLORBA EQU   IDAEDB+12
EDBHIRBA EQU   IDAEDB+16
EPATH    EQU   0
EPAIOEIP EQU   EPATH+4
EPAFFIOE EQU   EPATH+12
EPALFIOE EQU   EPATH+16
EPAWTPAT EQU   EPATH+24
EPACYLA  EQU   EPATH+28
EPAWRTCT EQU   EPATH+36
IOCOM    EQU   0
IOCSTIO  EQU   IOCOM+28
IOCOMPTR EQU   0
IOE      EQU   0
IOENXT   EQU   IOE
IOENXTLE EQU   IOENXT
IOELSIDA EQU   IOE+4
IOENXTGT EQU   IOELSIDA
IOEAIA   EQU   IOE+8
IOEWORK  EQU   IOE+12
IOEBKPTR EQU   IOEWORK
IORB     EQU   0
IORRQSZ  EQU   IORB+2
IORFLGS  EQU   IORB+3
IORFUSE  EQU   IORFLGS
IORFRPS  EQU   IORFLGS
IORAPND  EQU   IORFLGS
IORPCCW  EQU   IORB+8
IORIOSB  EQU   IORB+12
IORTSMP  EQU   IORB+24
IOSB     EQU   0
IOSFLA   EQU   IOSB
IOSACHN  EQU   IOSFLA
IOSFLB   EQU   IOSB+1
IOSFLC   EQU   IOSB+2
IOSDVALT EQU   IOSFLC
IOSPROC  EQU   IOSB+3
IOSPKEY  EQU   IOSB+12
IOSOPT   EQU   IOSB+14
IOSOPT2  EQU   IOSB+15
IOSUCB   EQU   IOSB+16
@NM00015 EQU   IOSB+20
IOSCSW   EQU   @NM00015+1
IOSTATUS EQU   IOSCSW+3
IOSSRB   EQU   IOSB+28
IOSIPIB  EQU   IOSB+44
IOSERP   EQU   IOSB+52
IOSRST   EQU   IOSB+72
IOSVST   EQU   IOSB+76
IOSPATH  EQU   IOSB+86
IOSCHN   EQU   IOSPATH
IOSCKEY  EQU   IOSB+89
IOSEEK   EQU   IOSB+92
IOSEEKA  EQU   IOSB+100
IOSCCHH  EQU   IOSEEKA+3
IOSSKHH  EQU   IOSCCHH+2
IDALPMB  EQU   0
LPMBFLGS EQU   IDALPMB+1
LPMAUSZ  EQU   IDALPMB+4
LPMBPTRK EQU   IDALPMB+8
LPMBLKSZ EQU   IDALPMB+12
LPMTRKAU EQU   IDALPMB+16
LPMTPC   EQU   IDALPMB+18
PART     EQU   0
PARTHDR  EQU   PART
PARTTPAR EQU   PARTHDR+24
PARTCOMQ EQU   PARTHDR+48
PARTSPLQ EQU   PARTHDR+56
PARTDUPQ EQU   PARTHDR+64
PARTLOCQ EQU   PARTHDR+72
PARTENT  EQU   0
PARELKUP EQU   PARTENT+4
PARELKFL EQU   PARELKUP
PARETYPE EQU   PARTENT+8
PAREFLG1 EQU   PARTENT+9
PARENN   EQU   PARTENT+10
PAREIOEQ EQU   PARTENT+12
PARESLTA EQU   PARTENT+20
PAREPATP EQU   PARTENT+32
PAREPCTP EQU   PARTENT+36
PAREEDBP EQU   PARTENT+40
PAREUCBP EQU   PARTENT+44
PARENODE EQU   PARTENT+48
PARERQTM EQU   PARTENT+56
PARELCYL EQU   PARTENT+60
PAT      EQU   0
PATHDR   EQU   PAT
PATCYLNO EQU   PATHDR+8
PATCYLSZ EQU   PATHDR+10
PATCYLMW EQU   PATHDR+12
PATMAP   EQU   PAT+16
PATCYL   EQU   0
PATCYLMP EQU   0
PCB      EQU   0
PCBFQP   EQU   PCB
PCBBQP   EQU   PCB+4
PCBRTP   EQU   PCB+8
PCBFL1   EQU   PCBRTP
PCBRLP   EQU   PCB+12
PCBXPT   EQU   PCB+16
PCBFL2   EQU   PCBXPT
PCBPGT   EQU   PCB+20
PCBFL3   EQU   PCBPGT
PCBRBN   EQU   PCB+24
PCBBLOCK EQU   PCB+28
PCBSRB   EQU   PCBBLOCK
PCBRB    EQU   PCBSRB
PCCW     EQU   0
PCCWSECT EQU   PCCW+1
PCCWFLGS EQU   PCCW+2
PCCWFERR EQU   PCCWFLGS
PCCWPCCW EQU   PCCW+4
PCCWAIA  EQU   PCCW+8
PCCWIORB EQU   PCCW+12
PCCWCHHR EQU   PCCW+16
PCCWCC   EQU   PCCWCHHR+3
PCCWHH   EQU   PCCWCHHR+5
PCCWSEEK EQU   PCCW+24
PCCWSK   EQU   PCCWSEEK
PCCWSSEC EQU   PCCW+32
PCCWSS   EQU   PCCWSSEC
PCCWSSAD EQU   PCCWSSEC+1
PCCWSRCH EQU   PCCW+40
PCCWTIC  EQU   PCCW+48
PCCWRW   EQU   PCCW+56
PCCWRDWT EQU   PCCWRW
PCCWADDR EQU   PCCWRW+1
PCCWNOP  EQU   PCCW+64
PCCWN    EQU   PCCWNOP
PCCWNAD  EQU   PCCWNOP+1
PCCWNFG  EQU   PCCWNOP+4
PCT      EQU   0
PCTDTYPX EQU   PCT+12
PCTSSECN EQU   PCT+30
PCTMAXTK EQU   PCT+36
PCTMSSB  EQU   PCT+38
PCTABLE  EQU   PCT+40
PCTSECT  EQU   PCTABLE
PCTSLTNM EQU   PCTSECT
PCTFOVFL EQU   PCTSLTNM
PCTSECNM EQU   PCTSECT+1
PCTTRBA  EQU   PCTSECT+2
SRBSECT  EQU   0
SRB      EQU   SRBSECT
SRBFLC   EQU   SRB+12
CALLSA   EQU   0
CALLR15  EQU   CALLSA+16
PARMLIST EQU   0
PTRIORB  EQU   PARMLIST
PTRPARE  EQU   PARMLIST+4
PTRPCCW  EQU   PARMLIST+8
PTRWRITE EQU   PARMLIST+12
PTRWORK  EQU   PARMLIST+16
GOODLSID EQU   0
PRTNN    EQU   GOODLSID+1
SLOT     EQU   GOODLSID+2
FINDSLOT EQU   0
CNVRTSKA EQU   0
CNVRTM   EQU   CNVRTSKA
CNVRTCC  EQU   CNVRTSKA+3
CNVRTHH  EQU   CNVRTSKA+5
CNVRTR   EQU   CNVRTSKA+7
ASM1WKSV EQU   ASMWKSA1
ASM1RGSV EQU   ASM1WKSV
ASM1WRKA EQU   ASM1WKSV+60
ASM2WKSV EQU   ASMWKSA2
ASM2WRKA EQU   ASM2WKSV+52
ASM2FLGS EQU   ASM2WRKA+12
ASM3WKSV EQU   ASMWKSA3
ASM4WKSV EQU   ASMWKSA4
ASM4RGSV EQU   ASM4WKSV
ASM5WKSV EQU   ASMWKSA5
ASM5RGSV EQU   ASM5WKSV
CVTPTR   EQU   FLCCVT
CVTS01   EQU   CVTPGSIA
CVTLPDIA EQU   CVTS01+12
CVTDIRST EQU   CVTLPDIA
CVTSLIDA EQU   CVTS01+24
CVTCTLFG EQU   CVTS01+50
CVTRV210 EQU   CVTS01+424
CVTRV219 EQU   CVTS01+425
CVTRV228 EQU   CVTS01+426
CVTRV237 EQU   CVTS01+427
CVTMFRTR EQU   CVTS01+452
CVTRV262 EQU   CVTS01+468
CVTRV271 EQU   CVTS01+469
CVTRV280 EQU   CVTS01+470
CVTRV289 EQU   CVTS01+471
CVTGSDA  EQU   CVTS01+600
IOSATTSC EQU   IOSIPIB
IOSWTOWA EQU   IOSIPIB
IOSPCISC EQU   IOSIPIB
PARTPTR  EQU   ASMPART
PATPTR   EQU   PAREPATP
PSARSVTE EQU   PSARSVT
SRBPTR   EQU   IOSSRB
PNODETST EQU   PARENODE
DEVDTABX EQU   PCTDTYPX+1
CNVRTRBA EQU   CNVRTSKA
FLC      EQU   PSA
FSF1     EQU   FSLOBIT1
*                                      START UNREFERENCED COMPONENTS
PSARSAV  EQU   PSARSVTE+60
PSARSTK  EQU   PSARSVTE+56
PSAESAV3 EQU   PSARSVTE+52
PSAESTK3 EQU   PSARSVTE+48
PSAESAV2 EQU   PSARSVTE+44
PSAESTK2 EQU   PSARSVTE+40
PSAESAV1 EQU   PSARSVTE+36
PSAESTK1 EQU   PSARSVTE+32
PSAPSAV  EQU   PSARSVTE+28
PSAPSTK  EQU   PSARSVTE+24
PSAMSAV  EQU   PSARSVTE+20
PSAMSTK  EQU   PSARSVTE+16
PSASSAV  EQU   PSARSVTE+12
PSASSTK  EQU   PSARSVTE+8
PSANSTK  EQU   PSARSVTE+4
PSACSTK  EQU   PSARSVTE
IOSPCIWA EQU   IOSPCISC+44
IOSPCIRS EQU   IOSPCISC+8
@NM00020 EQU   IOSPCISC+4
@NM00019 EQU   IOSPCISC
IOSWRNDR EQU   IOSWTOWA+4
IOSWTOPT EQU   IOSWTOWA+3
IOSWTOCP EQU   IOSWTOWA+2
IOSWTOCH EQU   IOSWTOWA
IOSATTWA EQU   IOSATTSC+40
@NM00018 EQU   IOSATTSC+24
IOSATTSN EQU   IOSATTSC
CVTRV628 EQU   CVTS01+728
CVTRV627 EQU   CVTS01+724
CVTRV626 EQU   CVTS01+720
CVTRV625 EQU   CVTS01+716
CVTRV624 EQU   CVTS01+712
CVTRV623 EQU   CVTS01+708
CVTRV622 EQU   CVTS01+704
CVTRV621 EQU   CVTS01+700
CVTIHASU EQU   CVTS01+696
CVTSUSP  EQU   CVTS01+692
CVTT6SVC EQU   CVTS01+688
CVTCDAL  EQU   CVTS01+684
CVTTCTL  EQU   CVTS01+680
CVTRSUME EQU   CVTS01+676
CVTJTERM EQU   CVTS01+672
CVTASMRM EQU   CVTS01+668
CVTTCASP EQU   CVTS01+664
CVT0PT03 EQU   CVTS01+660
CVT0PT0E EQU   CVTS01+656
CVTRV609 EQU   CVTS01+652
CVTCGK   EQU   CVTS01+648
CVTRAC   EQU   CVTS01+644
CVTHSM   EQU   CVTS01+640
CVTRV605 EQU   CVTS01+636
CVTRV604 EQU   CVTS01+632
CVTEFF02 EQU   CVTS01+628
CVTCBBR  EQU   CVTS01+624
CVTSSCR  EQU   CVTS01+620
CVTEVENT EQU   CVTS01+616
CVTCRCA  EQU   CVTS01+612
CVTTPIO  EQU   CVTS01+608
CVTADV   EQU   CVTS01+604
CVTGSDAB EQU   CVTGSDA
CVTQV3   EQU   CVTS01+596
CVTQV2   EQU   CVTS01+592
CVTQV1   EQU   CVTS01+588
CVTRPT   EQU   CVTS01+584
CVTSSRB  EQU   CVTS01+580
CVTCSDRL EQU   CVTS01+576
CVTEXP1  EQU   CVTS01+572
CVTRMPMT EQU   CVTS01+568
CVTRMPTT EQU   CVTS01+564
CVTVPSA  EQU   CVTS01+560
CVTVSTOP EQU   CVTS01+556
CVTGTFR8 EQU   CVTS01+552
CVTQUIT  EQU   CVTS01+548
CVTVACR  EQU   CVTS01+544
CVTWTCB  EQU   CVTS01+540
CVTSTPRS EQU   CVTS01+536
CVT0PT02 EQU   CVTS01+532
CVTDARCM EQU   CVTS01+528
CVTIRECM EQU   CVTS01+524
CVTJRECM EQU   CVTS01+520
CVTVEMS0 EQU   CVTS01+516
CVTSPFRR EQU   CVTS01+512
CVTRLSTG EQU   CVTS01+508
CVT0TC0A EQU   CVTS01+504
CVTGMBR  EQU   CVTS01+500
CVTLFRM  EQU   CVTS01+496
CVTRMBR  EQU   CVTS01+492
CVTVIOP  EQU   CVTS01+488
CVTRV307 EQU   CVTS01+486
CVTRV306 EQU   CVTS01+484
CVTRV305 EQU   CVTS01+482
CVTRV304 EQU   CVTS01+480
CVTRV303 EQU   CVTS01+478
CVTRV302 EQU   CVTS01+476
CVTTRCA  EQU   CVTS01+472
CVTRV297 EQU   CVTRV289
CVTRV296 EQU   CVTRV289
CVTRV295 EQU   CVTRV289
CVTRV294 EQU   CVTRV289
CVTRV293 EQU   CVTRV289
CVTRV292 EQU   CVTRV289
CVTRV291 EQU   CVTRV289
CVTRV290 EQU   CVTRV289
CVTRV288 EQU   CVTRV280
CVTRV287 EQU   CVTRV280
CVTRV286 EQU   CVTRV280
CVTRV285 EQU   CVTRV280
CVTRV284 EQU   CVTRV280
CVTRV283 EQU   CVTRV280
CVTRV282 EQU   CVTRV280
CVTRV281 EQU   CVTRV280
CVTRV279 EQU   CVTRV271
CVTRV278 EQU   CVTRV271
CVTRV277 EQU   CVTRV271
CVTRV276 EQU   CVTRV271
CVTRV275 EQU   CVTRV271
CVTRV274 EQU   CVTRV271
CVTRV273 EQU   CVTRV271
CVTRV272 EQU   CVTRV271
CVTRV270 EQU   CVTRV262
CVTRV269 EQU   CVTRV262
CVTRV268 EQU   CVTRV262
CVTRV267 EQU   CVTRV262
CVTRV266 EQU   CVTRV262
CVTRV265 EQU   CVTRV262
CVTRV264 EQU   CVTRV262
CVTRV263 EQU   CVTRV262
CVTVFP   EQU   CVTS01+464
CVTVSI   EQU   CVTS01+460
CVTVPSIB EQU   CVTS01+456
CVTMFACT EQU   CVTMFRTR
CVTMFCTL EQU   CVTS01+448
CVTPVBP  EQU   CVTS01+444
CVTPWI   EQU   CVTS01+440
CVTRV254 EQU   CVTS01+438
CVTRV253 EQU   CVTS01+436
CVTRV252 EQU   CVTS01+434
CVTRV251 EQU   CVTS01+433
CVTRV250 EQU   CVTS01+432
CVTRV249 EQU   CVTS01+431
CVTRV248 EQU   CVTS01+430
CVTRV247 EQU   CVTS01+429
CVTRV246 EQU   CVTS01+428
CVTRV245 EQU   CVTRV237
CVTRV244 EQU   CVTRV237
CVTRV243 EQU   CVTRV237
CVTRV242 EQU   CVTRV237
CVTRV241 EQU   CVTRV237
CVTRV240 EQU   CVTRV237
CVTRV239 EQU   CVTRV237
CVTRV238 EQU   CVTRV237
CVTRV236 EQU   CVTRV228
CVTRV235 EQU   CVTRV228
CVTRV234 EQU   CVTRV228
CVTRV233 EQU   CVTRV228
CVTRV232 EQU   CVTRV228
CVTRV231 EQU   CVTRV228
CVTRV230 EQU   CVTRV228
CVTRV229 EQU   CVTRV228
CVTRV227 EQU   CVTRV219
CVTRV226 EQU   CVTRV219
CVTRV225 EQU   CVTRV219
CVTRV224 EQU   CVTRV219
CVTRV223 EQU   CVTRV219
CVTRV222 EQU   CVTRV219
CVTRV221 EQU   CVTRV219
CVTRV220 EQU   CVTRV219
CVTRV218 EQU   CVTRV210
CVTRV217 EQU   CVTRV210
CVTRV216 EQU   CVTRV210
CVTRV215 EQU   CVTRV210
CVTRV214 EQU   CVTRV210
CVTRV213 EQU   CVTRV210
CVTRV212 EQU   CVTRV210
CVTRV211 EQU   CVTRV210
CVTLCCAT EQU   CVTS01+420
CVTPCCAT EQU   CVTS01+416
CVTIPCRP EQU   CVTS01+412
CVTIPCRI EQU   CVTS01+408
CVTIPCDS EQU   CVTS01+404
CVTAIDVT EQU   CVTS01+400
CVTSSAP  EQU   CVTS01+396
CVTEHCIR EQU   CVTS01+392
CVTEHDEF EQU   CVTS01+388
CVTDAIR  EQU   CVTS01+384
CVTPERFM EQU   CVTS01+380
CVT044R2 EQU   CVTS01+376
CVTFETCH EQU   CVTS01+372
CVTRSTWD EQU   CVTS01+368
CVTSPOST EQU   CVTS01+364
CVTIOBP  EQU   CVTS01+360
CVTASMVT EQU   CVTS01+356
CVTRECRQ EQU   CVTS01+352
CVTWSAC  EQU   CVTS01+348
CVTRV149 EQU   CVTS01+344
CVTWSAL  EQU   CVTS01+340
CVTSPSA  EQU   CVTS01+336
CVTGLMN  EQU   CVTS01+332
CVTVEAC0 EQU   CVTS01+328
CVT062R1 EQU   CVTS01+324
CVTRPOST EQU   CVTS01+320
CVTDQIQE EQU   CVTS01+316
CVTCSD   EQU   CVTS01+312
CVTLKRMA EQU   CVTS01+308
CVTRSPIE EQU   CVTS01+304
CVTRENQ  EQU   CVTS01+300
CVTLQCB  EQU   CVTS01+296
CVTFQCB  EQU   CVTS01+292
CVTQCS01 EQU   CVTS01+288
CVTAPFT  EQU   CVTS01+284
CVTPARRL EQU   CVTS01+280
CVTVWAIT EQU   CVTS01+276
CVTGSPL  EQU   CVTS01+272
CVTLSMQ  EQU   CVTS01+268
CVTGSMQ  EQU   CVTS01+264
CVTEXPRO EQU   CVTS01+260
CVTOPCTP EQU   CVTS01+256
CVTSIC   EQU   CVTS01+252
CVTTPIOS EQU   CVTS01+248
CVTRTMS  EQU   CVTS01+244
CVTSDBF  EQU   CVTS01+240
CVTSCBP  EQU   CVTS01+236
CVTSDMP  EQU   CVTS01+232
CVTSV60  EQU   CVTS01+228
CVTRTMCT EQU   CVTS01+224
CVTASCBL EQU   CVTS01+220
CVTASCBH EQU   CVTS01+216
CVTGDA   EQU   CVTS01+212
CVTASVT  EQU   CVTS01+208
CVTVVMDI EQU   CVTS01+204
CVTAQTOP EQU   CVTS01+200
CVTIOSCS EQU   CVTS01+196
CVTSDRM  EQU   CVTS01+192
CVTOPTE  EQU   CVTS01+188
CVTSTXU  EQU   CVTS01+184
CVTQUIS  EQU   CVTS01+180
CVTPARS  EQU   CVTS01+176
CVTS1EE  EQU   CVTS01+172
CVTFRAS  EQU   CVTS01+168
CVTQSAS  EQU   CVTS01+164
CVTCRAS  EQU   CVTS01+160
CVTCRMN  EQU   CVTS01+156
CVTDELCP EQU   CVTS01+152
CVTFRECL EQU   CVTS01+148
CVTGETCL EQU   CVTS01+144
CVTBLDCP EQU   CVTS01+140
CVTAUTHL EQU   CVTS01+136
CVTSCAN  EQU   CVTS01+132
CVTRV144 EQU   CVTS01+130
CVTMAXMP EQU   CVTS01+128
CVTSTCK  EQU   CVTS01+124
CVTRV139 EQU   CVTS01+123
CVTDSSAC EQU   CVTS01+122
CVTRV513 EQU   CVTS01+121
CVTIOSPL EQU   CVTS01+120
CVTPTGT  EQU   CVTS01+116
CVTCSPIE EQU   CVTS01+112
CVTSMFEX EQU   CVTS01+108
CVTOLT0A EQU   CVTS01+104
CVTSRBRT EQU   CVTS01+100
CVTPUTL  EQU   CVTS01+96
CVTASCRL EQU   CVTS01+92
CVTASCRF EQU   CVTS01+88
CVTRV326 EQU   CVTS01+84
CVTRV325 EQU   CVTS01+80
CVTRV324 EQU   CVTS01+76
CVT0VL01 EQU   CVTS01+72
CVTSHRVM EQU   CVTS01+68
CVTRV332 EQU   CVTS01+64
CVTTAS   EQU   CVTS01+60
CVTRSCN  EQU   CVTS01+56
CVTTRAC2 EQU   CVTS01+54
CVTTRACE EQU   CVTS01+52
CVTAPG   EQU   CVTS01+51
CVTSDTRC EQU   CVTCTLFG
CVTGTRCE EQU   CVTCTLFG
CVTNOMP  EQU   CVTCTLFG
CVTRSV79 EQU   CVTCTLFG
CVTDSTAT EQU   CVTCTLFG
CVTRSV78 EQU   CVTCTLFG
CVTRV333 EQU   CVTCTLFG
CVTRV323 EQU   CVTCTLFG
CVTSPVLK EQU   CVTS01+49
CVTRSV77 EQU   CVTS01+48
CVTRV331 EQU   CVTS01+44
CVTRV330 EQU   CVTS01+40
CVTRV329 EQU   CVTS01+36
CVTRV328 EQU   CVTS01+32
CVTRV322 EQU   CVTS01+28
CVTSLID  EQU   CVTSLIDA+1
CVTSYLK  EQU   CVTSLIDA
CVTRV321 EQU   CVTS01+20
CVTRV320 EQU   CVTS01+16
CVTLPDIR EQU   CVTLPDIA+1
CVTRSV69 EQU   CVTDIRST
CVTRSV68 EQU   CVTDIRST
CVTRSV67 EQU   CVTDIRST
CVTRSV66 EQU   CVTDIRST
CVTRSV65 EQU   CVTDIRST
CVTRSV64 EQU   CVTDIRST
CVTRSV63 EQU   CVTDIRST
CVTDICOM EQU   CVTDIRST
CVTPVTP  EQU   CVTS01+8
CVTLPDSR EQU   CVTS01+4
CVTGETL  EQU   CVTS01
ASM5FLGS EQU   ASM5WKSV+64
ASM5AIA  EQU   ASM5WKSV+60
ASM5GCTR EQU   ASM5WKSV+56
ASM5SR14 EQU   ASM5WKSV+52
@NM00006 EQU   ASM5RGSV+4
ASM5RG2  EQU   ASM5RGSV
@NM00005 EQU   ASM4RGSV+4
ASM4RG2  EQU   ASM4RGSV
ASM3SR13 EQU   ASM3WKSV+28
ASM3R14B EQU   ASM3WKSV+24
ASM3R14A EQU   ASM3WKSV+20
ASM3GRPA EQU   ASM3WKSV+16
ASM3TMPA EQU   ASM3WKSV+12
ASM3PIOP EQU   ASM3WKSV+8
ASM3GENQ EQU   ASM3WKSV+4
ASM3SWPQ EQU   ASM3WKSV
ASM2SR14 EQU   ASM2WRKA+16
@NM00004 EQU   ASM2WRKA+13
ASM2WFLG EQU   ASM2FLGS
ASM2RFLG EQU   ASM2FLGS
ASM2DUPQ EQU   ASM2WRKA+8
ASM2CAQ  EQU   ASM2WRKA+4
ASM2PAQ  EQU   ASM2WRKA
ASM2RGSV EQU   ASM2WKSV
ASM1NXTA EQU   ASM1WRKA+4
ASM1ASCB EQU   ASM1WRKA
ASM1RG15 EQU   ASM1RGSV+56
@NM00003 EQU   ASM1RGSV+4
ASM1RG1  EQU   ASM1RGSV
@NM00065 EQU   CNVRTSKA+1
@NM00064 EQU   GOODLSID
CALLR1   EQU   CALLSA+24
CALLR0   EQU   CALLSA+20
CALLR14  EQU   CALLSA+12
@NM00063 EQU   CALLSA
@NM00060 EQU   SRB+40
@NM00059 EQU   SRB+38
SRBPRIOR EQU   SRB+37
SRBPKF   EQU   SRB+36
SRBSAVE  EQU   SRB+32
SRBPARM  EQU   SRB+28
SRBRMTR  EQU   SRB+24
SRBEP    EQU   SRB+20
SRBPTCB  EQU   SRBFLC+4
SRBPASID EQU   SRBFLC+2
SRBCPAFF EQU   SRBFLC
SRBASCB  EQU   SRB+8
SRBFLNK  EQU   SRB+4
SRBID    EQU   SRB
PCTSLOT  EQU   PCTSLTNM
PCTRQTIM EQU   PCT+32
PCTDPGWT EQU   PCT+28
PCTDMASK EQU   PCT+20
PCTNEXT  EQU   PCT+16
PCTCYLSZ EQU   PCT+14
PCTSMAX  EQU   PCT+10
PCTDTYPE EQU   PCT+4
PCTID    EQU   PCT
@NM00034 EQU   PCCW+72
PCCWNCT  EQU   PCCWNOP+6
PCCWCNT  EQU   PCCWRW+6
PCCWRWFG EQU   PCCWRW+4
PCCWTCT  EQU   PCCWTIC+6
PCCWTFG  EQU   PCCWTIC+4
PCCWTAD  EQU   PCCWTIC+1
PCCWT    EQU   PCCWTIC
PCCWSICT EQU   PCCWSRCH+6
PCCWSIFG EQU   PCCWSRCH+4
PCCWSIAD EQU   PCCWSRCH+1
PCCWSIDE EQU   PCCWSRCH
PCCWSSCT EQU   PCCWSSEC+6
PCCWSSFG EQU   PCCWSSEC+4
PCCWSKCT EQU   PCCWSEEK+6
PCCWSKFG EQU   PCCWSEEK+4
PCCWSKAD EQU   PCCWSEEK+1
PCCWR    EQU   PCCWCHHR+7
PCCWBB   EQU   PCCWCHHR+1
PCCWM    EQU   PCCWCHHR
@NM00033 EQU   PCCW+3
@NM00032 EQU   PCCWFLGS
PCCWID   EQU   PCCW
PCBEND   EQU   PCB+64
PCBAIA   EQU   PCB+36
PCBASCB  EQU   PCB+32
PCBSPCTE EQU   PCBRB
PCBVBN   EQU   PCB+26
PCBPGTA  EQU   PCBPGT+1
PCBSWPS2 EQU   PCBFL3
@NM00031 EQU   PCBFL3
PCBNOREC EQU   PCBFL3
PCBDFRLS EQU   PCBFL3
PCBSWPLS EQU   PCBFL3
PCBSWPS1 EQU   PCBFL3
PCBSWPIN EQU   PCBFL3
PCBSWPOT EQU   PCBFL3
PCBXPTA  EQU   PCBXPT+1
@NM00030 EQU   PCBFL2
@NM00029 EQU   PCBFL2
PCBVIO   EQU   PCBFL2
PCBSUPRS EQU   PCBFL2
PCBRESET EQU   PCBFL2
PCBIOERR EQU   PCBFL2
PCBGFAD  EQU   PCBFL2
PCBFREAL EQU   PCBFL2
PCBRLPA  EQU   PCBRLP+1
PCBFXC   EQU   PCBRLP
PCBRTPA  EQU   PCBRTP+1
PCBIOCMP EQU   PCBFL1
PCBIOI   EQU   PCBFL1
PCBROOT  EQU   PCBFL1
PCBLFR   EQU   PCBFL1
PCBLLHLD EQU   PCBFL1
PCBSRBMD EQU   PCBFL1
PCBPEX   EQU   PCBFL1
@NM00028 EQU   PCBFL1
PCBBQPA  EQU   PCBBQP
PCBFQPA  EQU   PCBFQP+1
PCBCQN   EQU   PCBFQP
PATCYLS  EQU   PATMAP
PATRSV1  EQU   PATHDR+14
PATPART  EQU   PATHDR+4
PATIDENT EQU   PATHDR
@NM00027 EQU   PARTENT+62
PAREWTQE EQU   PARTENT+52
PAREIORB EQU   PARTENT+28
PARERRCT EQU   PARTENT+24
PARESZSL EQU   PARTENT+16
@NM00026 EQU   PAREFLG1
PAREINCP EQU   PAREFLG1
PAREDSBD EQU   PAREFLG1
PARENUSE EQU   PAREFLG1
@NM00025 EQU   PARETYPE
PARELOCL EQU   PARETYPE
PAREDPLX EQU   PARETYPE
PARECOMM EQU   PARETYPE
PAREPLPA EQU   PARETYPE
PARECPCT EQU   PARELKUP+2
PAREIORN EQU   PARELKUP+1
@NM00024 EQU   PARELKFL
PAREFSIP EQU   PARELKFL
PAREPARE EQU   PARTENT
PARTENTS EQU   PART+80
PARTLOCL EQU   PARTLOCQ+4
PARTLOCF EQU   PARTLOCQ
PARTDUPL EQU   PARTDUPQ+4
PARTDUPF EQU   PARTDUPQ
PARTSPLL EQU   PARTSPLQ+4
PARTSPLF EQU   PARTSPLQ
PARTCOML EQU   PARTCOMQ+4
PARTCOMF EQU   PARTCOMQ
PARTLOCK EQU   PARTHDR+44
PARTLKUP EQU   PARTHDR+40
@NM00023 EQU   PARTHDR+34
PARTLCNT EQU   PARTHDR+32
PARTPCTQ EQU   PARTHDR+28
PARTDSNL EQU   PARTTPAR
PARTCIR2 EQU   PARTHDR+20
PARTCIR1 EQU   PARTHDR+16
PARTAIAE EQU   PARTHDR+12
PARTEUSE EQU   PARTHDR+8
PARTSIZE EQU   PARTHDR+4
PARTIDEN EQU   PARTHDR
LPMBSST  EQU   IDALPMB+28
LPMBEXT  EQU   IDALPMB+24
@NM00022 EQU   IDALPMB+22
LPMBLKTR EQU   IDALPMB+20
LPMBLEN  EQU   IDALPMB+2
@NM00021 EQU   LPMBFLGS
LPMBSSTH EQU   LPMBFLGS
LPMBTOFL EQU   LPMBFLGS
LPMSS    EQU   LPMBFLGS
LPMREPL  EQU   LPMBFLGS
LPMBRPS  EQU   LPMBFLGS
LPMBID   EQU   IDALPMB
IOSEND   EQU   IOSB+108
IOSSKR   EQU   IOSEEKA+7
IOSSKH2  EQU   IOSSKHH+1
IOSSKH1  EQU   IOSSKHH
IOSSKCC  EQU   IOSCCHH
IOSSKBB  EQU   IOSEEKA+1
IOSSKM   EQU   IOSEEKA
IOSMDM   EQU   IOSB+91
IOSMDB   EQU   IOSB+90
IOSCKEY7 EQU   IOSCKEY
IOSCKEY6 EQU   IOSCKEY
IOSCKEY5 EQU   IOSCKEY
IOSCKEY4 EQU   IOSCKEY
@NM00017 EQU   IOSCKEY
IOSFMSK  EQU   IOSB+88
IOSCUDEV EQU   IOSPATH+1
@NM00016 EQU   IOSCHN
IOSPATH3 EQU   IOSCHN
IOSPATH2 EQU   IOSCHN
IOSEXP   EQU   IOSCHN
IOSGDP   EQU   IOSCHN
IOSAFF   EQU   IOSB+85
IOSRSS1B EQU   IOSB+84
IOSDSID  EQU   IOSB+80
IOSDIE   EQU   IOSB+68
IOSABN   EQU   IOSB+64
IOSNRM   EQU   IOSB+60
IOSPCI   EQU   IOSB+56
IOSPCHN  EQU   IOSB+48
IOSSNS   EQU   IOSB+42
IOSAPMSK EQU   IOSB+40
IOSRES4A EQU   IOSB+36
IOSUSE   EQU   IOSB+32
IOSCSWRC EQU   IOSCSW+5
IOSTSB   EQU   IOSTATUS+1
IOSTSA   EQU   IOSTATUS
IOSCSWCA EQU   IOSCSW
IOSCC    EQU   @NM00015
IOSOPT2X EQU   IOSOPT2
IOSIGP   EQU   IOSOPT2
IOSHTP   EQU   IOSOPT2
IOSRELSE EQU   IOSOPT
IOSAPR   EQU   IOSOPT
IOSTSLL  EQU   IOSOPT
IOSNERP  EQU   IOSOPT
IOSPSLL  EQU   IOSOPT
IOSQISCE EQU   IOSOPT
IOSDEP   EQU   IOSOPT
IOSBYP   EQU   IOSOPT
IOSCOD   EQU   IOSB+13
IOSPKY7  EQU   IOSPKEY
IOSPGDPX EQU   IOSPKEY
IOSIDR   EQU   IOSPKEY
IOSLCL   EQU   IOSPKEY
@NM00014 EQU   IOSPKEY
IOSPGAD  EQU   IOSB+8
IOSASID  EQU   IOSB+6
IOSPRLVL EQU   IOSB+5
IOSDVRID EQU   IOSB+4
IOSFLC7  EQU   IOSFLC
IOSCTCNR EQU   IOSFLC
IOSRWAIT EQU   IOSFLC
IOSTP    EQU   IOSFLC
IOSCC3WE EQU   IOSFLC
IOSVERIF EQU   IOSDVALT
IOSDVMNT EQU   IOSFLC
IOSLOG   EQU   IOSFLB
IOSBDCST EQU   IOSFLB
IOSMSG   EQU   IOSFLB
IOSFLB4  EQU   IOSFLB
IOSFLB3  EQU   IOSFLB
IOSNOTRS EQU   IOSFLB
IOSSDR   EQU   IOSFLB
IOSDIESE EQU   IOSFLB
IOSIOSB  EQU   IOSFLA
IOSDOM   EQU   IOSFLA
IOSEX    EQU   IOSFLA
IOSSMDB  EQU   IOSFLA
IOSSMDA  EQU   IOSFLA
IOSERR   EQU   IOSFLA
IOSCCHN  EQU   IOSACHN
IOSDCHN  EQU   IOSACHN
@NM00013 EQU   IORB+40
IORRSV   EQU   IORB+36
IORPARTE EQU   IORB+32
IORERR   EQU   IORB+20
IORSAVE  EQU   IORB+16
IORSCCW  EQU   IORPCCW
IORIORB  EQU   IORB+4
IORFAE   EQU   IORAPND
IORFNE   EQU   IORAPND
IORFDI   EQU   IORAPND
IORSWAP  EQU   IORFLGS
@NM00012 EQU   IORFLGS
IORNUM   EQU   IORB+1
IORID    EQU   IORB
@NM00011 EQU   IOE+16
IOCOEND  EQU   IOCOM+128
IOCPATCH EQU   IOCOM+124
IOCUCBBM EQU   IOCOM+120
IOCQCNT  EQU   IOCOM+116
IOCIOSDQ EQU   IOCOM+112
IOCIOSEQ EQU   IOCOM+108
IOCSVCF  EQU   IOCOM+104
IOCTCCW  EQU   IOCOM+100
IOCRSVTB EQU   IOCOM+96
IOCMFCNT EQU   IOCOM+92
IOCMFHK  EQU   IOCOM+88
IOCGENA  EQU   IOCOM+84
IOCCCH   EQU   IOCOM+80
IOCASYNQ EQU   IOCOM+76
IOCLCHTB EQU   IOCOM+72
IOCATTBL EQU   IOCOM+68
IOCOMEX  EQU   IOCOM+64
IOCSYNCH EQU   IOCOM+56
IOCCATLK EQU   IOCOM+48
IOCPRGID EQU   IOCOM+44
IOCIOSCP EQU   IOCOM+40
IOCORMGT EQU   IOCOM+36
IOCVOID  EQU   IOCOM+32
IOCSCOMP EQU   IOCOM+24
IOCHD160 EQU   IOCOM+20
IOCINT   EQU   IOCOM+16
IOCCTBL  EQU   IOCOM+12
IOCHIO   EQU   IOCOM+8
IOCPST   EQU   IOCOM+4
IOCPGCT  EQU   IOCOM+2
IOCVOICT EQU   IOCOM
EPACPUID EQU   EPATH+38
EPAMSPAD EQU   EPATH+32
EPAWRTQ  EQU   EPATH+20
EPAIOEQP EQU   EPATH+8
EPAPARM  EQU   EPATH
EDBTKBAL EQU   IDAEDB+20
@NM00010 EQU   EDBFLG1
EDBPSDS  EQU   EDBFLG1
EDBTOFLW EQU   EDBFLG1
EDBLKR   EQU   EDBFLG1
@NM00009 EQU   IDAEDB
EDBLPMBC EQU   IDAEDBHD+4
EDBID    EQU   IDAEDBHD
CVTLEVL  EQU   CVTRELNO+2
CVTNUMB  EQU   CVTRELNO
CVTMDL   EQU   CVTFIX+250
@NM00008 EQU   CVTFIX+248
@NM00007 EQU   CVTFIX
CVTRV482 EQU   CVTXTNT2+128
CVTRV481 EQU   CVTXTNT2+124
CVTRV480 EQU   CVTXTNT2+120
CVTRV479 EQU   CVTXTNT2+118
CVTRV478 EQU   CVTXTNT2+117
CVTRV477 EQU   CVTXTNT2+116
CVTRV476 EQU   CVTXTNT2+115
CVTRV475 EQU   CVTXTNT2+114
CVTRV474 EQU   CVTRV466
CVTRV473 EQU   CVTRV466
CVTRV472 EQU   CVTRV466
CVTRV471 EQU   CVTRV466
CVTRV470 EQU   CVTRV466
CVTRV469 EQU   CVTRV466
CVTRV468 EQU   CVTRV466
CVTRV467 EQU   CVTRV466
CVTRV465 EQU   CVTRV457
CVTRV464 EQU   CVTRV457
CVTRV463 EQU   CVTRV457
CVTRV462 EQU   CVTRV457
CVTRV461 EQU   CVTRV457
CVTRV460 EQU   CVTRV457
CVTRV459 EQU   CVTRV457
CVTRV458 EQU   CVTRV457
CVTRV456 EQU   CVTXTNT2+108
CVTRV455 EQU   CVTXTNT2+104
CVTRV454 EQU   CVTXTNT2+100
CVTRV453 EQU   CVTXTNT2+96
CVTRV452 EQU   CVTXTNT2+94
CVTRV451 EQU   CVTXTNT2+92
CVTRV450 EQU   CVTXTNT2+90
CVTRV449 EQU   CVTXTNT2+88
CVTRV448 EQU   CVTXTNT2+87
CVTRV447 EQU   CVTXTNT2+86
CVTRV446 EQU   CVTRV438
CVTRV445 EQU   CVTRV438
CVTRV444 EQU   CVTRV438
CVTRV443 EQU   CVTRV438
CVTRV442 EQU   CVTRV438
CVTRV441 EQU   CVTRV438
CVTRV440 EQU   CVTRV438
CVTRV439 EQU   CVTRV438
CVTRV437 EQU   CVTRV429
CVTRV436 EQU   CVTRV429
CVTRV435 EQU   CVTRV429
CVTRV434 EQU   CVTRV429
CVTRV433 EQU   CVTRV429
CVTRV432 EQU   CVTRV429
CVTRV431 EQU   CVTRV429
CVTRV430 EQU   CVTRV429
CVTRV428 EQU   CVTXTNT2+80
CVTRV427 EQU   CVTXTNT2+76
CVTRV426 EQU   CVTXTNT2+72
CVTRV425 EQU   CVTXTNT2+68
CVTATACT EQU   CVTATCVT
CVTRV423 EQU   CVTXTNT2+62
CVTRV422 EQU   CVTXTNT2+60
CVTRV421 EQU   CVTXTNT2+58
CVTRV420 EQU   CVTXTNT2+56
CVTRV419 EQU   CVTXTNT2+55
CVTRV418 EQU   CVTXTNT2+54
CVTRV417 EQU   CVTRV409
CVTRV416 EQU   CVTRV409
CVTRV415 EQU   CVTRV409
CVTRV414 EQU   CVTRV409
CVTRV413 EQU   CVTRV409
CVTRV412 EQU   CVTRV409
CVTRV411 EQU   CVTRV409
CVTRV410 EQU   CVTRV409
CVTRV408 EQU   CVTRV400
CVTRV407 EQU   CVTRV400
CVTRV406 EQU   CVTRV400
CVTRV405 EQU   CVTRV400
CVTRV404 EQU   CVTRV400
CVTRV403 EQU   CVTRV400
CVTRV402 EQU   CVTRV400
CVTRV401 EQU   CVTRV400
CVTICB   EQU   CVTXTNT2+48
CVTSKTA  EQU   CVTXTNT2+44
CVTCCVT  EQU   CVTXTNT2+40
CVTRSV98 EQU   CVTXTNT2+36
CVTRSV97 EQU   CVTXTNT2+34
CVTRSV96 EQU   CVTXTNT2+32
CVTOLTEP EQU   CVTXTNT2+28
CVTQIDA  EQU   CVTQID+1
CVTRSV95 EQU   CVTQID
CVTRSV94 EQU   CVTXTNT2+20
CVTRSV93 EQU   CVTXTNT2+16
CVTRSV92 EQU   CVTXTNT2+12
CVTDEBVR EQU   CVTXTNT2+8
CVTRSV91 EQU   CVTXTNT2+6
CVTRSV9H EQU   CVTFLGBT
CVTRSV9G EQU   CVTFLGBT
CVTRSV9F EQU   CVTFLGBT
CVTRSV9E EQU   CVTFLGBT
CVTRSV9D EQU   CVTFLGBT
CVTRSV9C EQU   CVTFLGBT
CVTVME   EQU   CVTFLGBT
CVTNPE   EQU   CVTFLGBT
CVTNUCLS EQU   CVTXTNT2+4
CVTDSSVA EQU   CVTDSSV+1
CVTRSV89 EQU   CVTDSSV
CVTRSV88 EQU   CVTXTNT1+8
CVTRSV87 EQU   CVTXTNT1+4
CVTFACHN EQU   CVTXTNT1
CVTRV488 EQU   CVTMAP+412
CVTRV487 EQU   CVTMAP+408
CVTRV486 EQU   CVTMAP+404
CVTRV485 EQU   CVTMAP+400
CVTACTAP EQU   CVTMAP+396
CVTAUTH  EQU   CVTMAP+392
CVTATMCA EQU   CVTATMCT+1
CVTATMST EQU   CVTATMCT
CVTRSV61 EQU   CVTMAP+384
CVTVOLT1 EQU   CVTVOLM1+1
CVTVOLI1 EQU   CVTVOLF1
CVTSTOA  EQU   CVTMAP+376
CVTRSV58 EQU   CVTMAP+374
CVTRSV57 EQU   CVTMAP+372
CVTDDCE  EQU   CVTMAP+368
CVTPNWFR EQU   CVTMAP+364
CVTSMF   EQU   CVTMAP+360
CVTSULK  EQU   CVTMAP+358
CVTSLKO  EQU   CVTSYSK
CVTSLKP  EQU   CVTSYSK
CVTSLKQ  EQU   CVTSYSK
CVTSLKR  EQU   CVTSYSK
CVTRSV56 EQU   CVTSYSK
CVTRSV55 EQU   CVTSYSK
CVTRSV54 EQU   CVTSYSK
CVTRSV53 EQU   CVTSYSK
CVTRSV52 EQU   CVTA1F1
CVTRSV51 EQU   CVTA1F1
CVTRSV50 EQU   CVTA1F1
CVTRSV49 EQU   CVTA1F1
CVTRSV48 EQU   CVTA1F1
CVTRSV47 EQU   CVTA1F1
CVTSRSW  EQU   CVTA1F1
CVTPFSW  EQU   CVTA1F1
CVTPCVT  EQU   CVTMAP+352
CVTRSV46 EQU   CVTMAP+344
CVTRSV45 EQU   CVTMAP+340
CVTRSV44 EQU   CVTMAP+338
CVTRSV43 EQU   CVTMAP+336
CVTHJESA EQU   CVTHJES+1
CVTRSV42 EQU   CVTHJES
CVTEXT2A EQU   CVTEXT2+1
CVTRSV41 EQU   CVTEXT2
CVTAPFA  EQU   CVTAPF+1
CVTRSV40 EQU   CVTAPF
CVTRV518 EQU   CVTINTLA
CVTRV517 EQU   CVTERPV
CVTEORM  EQU   CVTMAP+312
CVTMCHPR EQU   CVTMAP+308
CVTTZ    EQU   CVTMAP+304
CVTJEPS  EQU   CVTMAP+300
CVTJESCT EQU   CVTMAP+296
CVTMODE  EQU   CVTMAP+292
CVTPTRV  EQU   CVTMAP+288
CVTREAL  EQU   CVTMAP+284
CVTRSV39 EQU   CVTMAP+280
CVTRSV38 EQU   CVTMAP+276
CVTDMSRA EQU   CVTDMSR+1
CVTRV634 EQU   CVTDMSRF
CVTRV633 EQU   CVTDMSRF
CVTRV632 EQU   CVTDMSRF
CVTRV631 EQU   CVTDMSRF
CVTRV630 EQU   CVTDMSRF
CVTRV629 EQU   CVTDMSRF
CVTUDUMP EQU   CVTDMSRF
CVTSDUMP EQU   CVTDMSRF
CVTQMSGA EQU   CVTQMSG+1
CVTRSV36 EQU   CVTQMSG
CVTAMFF  EQU   CVTMAP+264
CVTPURGA EQU   CVTPURG+1
CVTRSV35 EQU   CVTPURG
CVTCBSP  EQU   CVTMAP+256
CVTATERA EQU   CVTATER+1
CVTSYST  EQU   CVTATER
CVTVOLT2 EQU   CVTTAT
CVTVOLI2 EQU   CVTVOLF2
CVTAQAVB EQU   CVTAQAVT+1
CVTRSV34 EQU   CVTTCMFG
CVTRSV33 EQU   CVTTCMFG
CVTRSV32 EQU   CVTTCMFG
CVTRSV31 EQU   CVTTCMFG
CVTRSV30 EQU   CVTTCMFG
CVTRSV29 EQU   CVTTCMFG
CVTLDEV  EQU   CVTTCMFG
CVTTCRDY EQU   CVTTCMFG
CVTGTFA  EQU   CVTGTF+1
CVTRSV27 EQU   CVTGTFST
CVTRNIO  EQU   CVTGTFST
CVTUSR   EQU   CVTGTFST
CVTRV318 EQU   CVTFORM
CVTRV317 EQU   CVTTMODE
CVTRV316 EQU   CVTSTATE
CVTRV315 EQU   CVTGTFS
CVTGTFAV EQU   CVTGTFS
CVT0SCR1 EQU   CVTMAP+232
CVTRV515 EQU   CVTMAP+228
CVTRMS   EQU   CVTMAP+224
CVTPATCH EQU   CVTMAP+220
CVTTSCE  EQU   CVTMAP+216
CVTLNKSC EQU   CVTMAP+214
CVTQABST EQU   CVTMAP+212
CVTMDLDS EQU   CVTMAP+208
CVTUSER  EQU   CVTMAP+204
CVTABEND EQU   CVTMAP+200
CVTSMCA  EQU   CVTMAP+196
CVTRSV18 EQU   CVTMAP+192
CVTQLPAQ EQU   CVTMAP+188
CVTQCDSR EQU   CVTMAP+184
CVTRSV17 EQU   CVTOPTB
CVTRSV16 EQU   CVTOPTB
CVTFP    EQU   CVTOPTB
CVTAPTHR EQU   CVTOPTB
CVTNLOG  EQU   CVTOPTB
CVTTOD   EQU   CVTOPTB
CVTCTIMS EQU   CVTOPTB
CVTPROT  EQU   CVTOPTB
CVTXPFP  EQU   CVTOPTA
CVTASCII EQU   CVTOPTA
CVTRSV13 EQU   CVTOPTA
CVTRSV12 EQU   CVTOPTA
CVTNIP   EQU   CVTOPTA
CVTDDR   EQU   CVTOPTA
CVTAPR   EQU   CVTOPTA
CVTCCH   EQU   CVTOPTA
CVTSNCTR EQU   CVTMAP+180
CVTQMWR  EQU   CVTMAP+176
CVTQOCR  EQU   CVTMAP+172
CVT1EF00 EQU   CVTMAP+168
CVTMZ00  EQU   CVTMAP+164
CVTSV76Q EQU   CVTSV76C
CVTRSV11 EQU   CVTMAP+156
CVT0PT01 EQU   CVTMAP+152
CVTMSER  EQU   CVTMAP+148
CVTRV516 EQU   CVTIERLC
CVTILCH  EQU   CVTMAP+140
CVT0DS   EQU   CVTMAP+136
CVTFBOSV EQU   CVTMAP+132
CVTNUCB  EQU   CVTMAP+128
CVTSV76M EQU   CVTIOQET
CVTDCBA  EQU   CVTMAP+117
CVTMVS2  EQU   CVTDCB
CVT6DAT  EQU   CVTDCB
CVT4MPS  EQU   CVTDCB
CVTRSV09 EQU   CVTDCB
CVT4MS1  EQU   CVTDCB
CVT2SPS  EQU   CVTDCB
CVT1SSS  EQU   CVTDCB
CVTRSV08 EQU   CVTDCB
CVTSTB   EQU   CVTMAP+112
CVTQTD00 EQU   CVTMAP+108
CVTQTE00 EQU   CVTMAP+104
CVTCUCB  EQU   CVTMAP+100
CVTSJQ   EQU   CVTMAP+96
CVTPBLDL EQU   CVTMAP+92
CVTTPC   EQU   CVTMAP+88
CVTSVDCB EQU   CVTMAP+84
CVTBRET  EQU   CVTMAP+82
CVTEXIT  EQU   CVTMAP+80
CVT0FN00 EQU   CVTMAP+76
CVTDARA  EQU   CVTDAR+1
CVTRSV07 EQU   CVTFLGS1
CVTRSV06 EQU   CVTFLGS1
CVTRSV05 EQU   CVTFLGS1
CVTRSV04 EQU   CVTFLGS1
CVTRSV03 EQU   CVTFLGS1
CVTRSV02 EQU   CVTFLGS1
CVTRSV01 EQU   CVTFLGS1
CVTDMPLK EQU   CVTFLGS1
CVTXITP  EQU   CVTMAP+68
CVTZDTAB EQU   CVTMAP+64
CVTMSLT  EQU   CVTMAP+60
CVTDATE  EQU   CVTMAP+56
CVTBTERM EQU   CVTMAP+52
CVTSYSAD EQU   CVTMAP+48
CVTXTLER EQU   CVTMAP+44
CVTILK2  EQU   CVTMAP+40
CVTILK1  EQU   CVTMAP+36
CVTPRLTV EQU   CVTMAP+32
CVTPCNVT EQU   CVTMAP+28
CVT0VL00 EQU   CVTMAP+24
CVTXAPG  EQU   CVTMAP+20
CVTBUF   EQU   CVTMAP+16
CVTJOB   EQU   CVTMAP+12
CVTLINK  EQU   CVTMAP+8
CVT0EF00 EQU   CVTMAP+4
CVTTCBP  EQU   CVTMAP
CVT      EQU   CVTMAP
ATAWORKA EQU   ATACLEAR
ATARCODE EQU   ATA+7
ATARCRF8 EQU   ATARCRSN
ATARCRF7 EQU   ATARCRSN
ATARCRF6 EQU   ATARCRSN
ATARCRF5 EQU   ATARCRSN
ATARCRF4 EQU   ATARCRSN
ATARCRF3 EQU   ATARCRSN
ATARCRF2 EQU   ATARCRSN
ATARCRF1 EQU   ATARCRSN
ATARSV2  EQU   ATARFLGS
ATABADPK EQU   ATARFLGS
ATASCCWP EQU   ATARFLGS
ATASGNST EQU   ATARFLGS
ATARSV1  EQU   ATASFLGS+1
ATASWPDR EQU   ATASFLGS+1
ATATRPAG EQU   ATASFLGS+1
ATASWAP  EQU   ATASFLGS+1
ATAPAGCM EQU   ATASFLGS
ATAPAGIO EQU   ATASFLGS
ATAPOS   EQU   ATASFLGS
ATAPCOMP EQU   ATASFLGS
ATAVIOCM EQU   ATASFLGS
ATASCOMP EQU   ATASFLGS
ATASLSQA EQU   ATASFLGS
ATAQIOE  EQU   ATASFLGS
ATAMODID EQU   ATA
ASMCPRES EQU   ASMCPRSQ+4
ASMCPTAK EQU   ASMCPRSQ
ASMCPCNT EQU   ASMCPAVQ+4
ASMCPEXT EQU   ASMPOOLS+6
ASMCPSIZ EQU   ASMPOOLS+4
ASMCPID  EQU   ASMPOOLS
ASMRSV12 EQU   ASMVT+1000
ASMSAVE  EQU   ASMVT+928
ASMWKSA7 EQU   ASMVT+848
ASMWKSA6 EQU   ASMVT+768
ASMACEPC EQU   ASMVT+344
ASMSWKPC EQU   ASMVT+328
ASMBWKPC EQU   ASMVT+312
ASMRSV10 EQU   ASMVT+280
ASMPVACE EQU   ASMVT+276
ASMPIOFR EQU   ASMVT+272
ASMPVACQ EQU   ASMVT+268
ASMPMSGS EQU   ASMVT+264
ASMPMSG0 EQU   ASMVT+260
ASMPFRLG EQU   ASMVT+256
ASMPRLG  EQU   ASMVT+252
ASMPACT  EQU   ASMVT+248
ASMPSAV  EQU   ASMVT+244
ASMPCMP  EQU   ASMVT+240
ASMPCMPA EQU   ASMVT+236
ASMPCMPN EQU   ASMVT+232
ASMPCMPD EQU   ASMVT+228
ASMPEX   EQU   ASMVT+224
ASMVRMTR EQU   ASMVT+220
ASMPSRBC EQU   ASMVT+216
ASMPSRMT EQU   ASMVT+212
ASMPSWPD EQU   ASMVT+208
ASMPTM   EQU   ASMVT+204
ASMPFRSW EQU   ASMVT+200
ASMPFRSL EQU   ASMVT+196
ASMPQIOE EQU   ASMVT+192
ASMRSV8  EQU   ASMVT+188
ASMVSAMW EQU   ASMVT+184
ASMTASCB EQU   ASMVT+180
ASMRLGWQ EQU   ASMVT+176
ASMRLGRQ EQU   ASMVT+172
ASMTMECB EQU   ASMVT+168
ASMTCBPT EQU   ASMVT+164
ASMREQCT EQU   ASMVT+160
ASMGOSWK EQU   ASMGOSQS+4
ASMGOSWT EQU   ASMGOSQS
ASMLSAIH EQU   ASMLSAI+4
ASMLSAIL EQU   ASMLSAI
ASMCINV  EQU   ASMVT+140
ASMSTGXA EQU   ASMVT+136
ASMLGVT  EQU   ASMVT+132
ASMSLOTV EQU   ASMVT+128
ASMERRS  EQU   ASMVT+124
ASMNVSC  EQU   ASMVT+120
ASMVSC   EQU   ASMVT+116
ASMSLOTS EQU   ASMVT+112
ASMBKSLT EQU   ASMVT+108
ASMRSV7  EQU   ASMVT+92
ASMPSRB  EQU   ASMVT+88
ASMSRBCT EQU   ASMVT+84
ASMPCCWN EQU   ASMVT+72
ASMPCCWC EQU   ASMPCCWQ+4
ASMPCCWA EQU   ASMPCCWQ
ASMRSV6  EQU   ASMVT+48
ASMIORQC EQU   ASMVT+44
ASMIORQR EQU   ASMVT+40
ASMSTAGL EQU   ASMSTAGQ+4
ASMSTAGF EQU   ASMSTAGQ
ASMRSV5  EQU   ASMVT+28
ASMMSGBF EQU   ASMVT+24
ASMEREC  EQU   ASMVT+20
ASMTRPAG EQU   ASMVT+16
ASMGOS   EQU   ASMVT+12
ASMSART  EQU   ASMVT+4
ASMDSSFS EQU   ASMVT+2
ASMWARM  EQU   ASMFLAG2
ASMQUICK EQU   ASMFLAG2
ASMNOTPT EQU   ASMFLAG2
ASMNOTMR EQU   ASMFLAG2
ASMNOSAV EQU   ASMFLAG2
ASMCALLQ EQU   ASMFLAG2
ASMPLPAS EQU   ASMFLAG1
ASMCOMMF EQU   ASMFLAG1
ASMPLPAF EQU   ASMFLAG1
ASMNODPX EQU   ASMFLAG1
ASMRSV1  EQU   ASMFLAG1
ASMNOLCL EQU   ASMFLAG1
ASMNOCWQ EQU   ASMFLAG1
ASMDUPLX EQU   ASMFLAG1
AIADPXCT EQU   AIALGE
AIACEPTR EQU   AIALPMEP
@NM00002 EQU   AIASSID
@NM00001 EQU   AIALSID
AIARSV9  EQU   AIAFLG3
AIARSV8  EQU   AIAFLG3
AIARSV7  EQU   AIAFLG3
AIALPMEC EQU   AIAFLG3
AIARSV6  EQU   AIAFLG3
AIATRPSP EQU   AIAFLG3
AIAPRINO EQU   AIAFLG3
AIARSV5  EQU   AIAFLG3
AIABADID EQU   AIAFLG2
AIAERROR EQU   AIAFLG2
AIASECER EQU   AIAFLG2
AIAPRIER EQU   AIAFLG2
AIARSV4  EQU   AIAFLG2
AIAIORTY EQU   AIAFLG2
AIATERMR EQU   AIAFLG2
AIAFRAUX EQU   AIAFLG2
AIARSV1  EQU   AIAFLG1
AIASWPFX EQU   AIAFLG1
AIAPAGDS EQU   AIAFLG1
AIALSQA  EQU   AIAFLG1
AIAVIO   EQU   AIAFLG1
AIAPRIV  EQU   AIAFLG1
AIAOP    EQU   AIA+8
AIABQPA  EQU   AIA+4
AIAFQPA  EQU   AIA
@NM00058 EQU   PSA+3668
PSASTAK  EQU   PSA+3072
@NM00057 EQU   PSA+1048
PSAUSEND EQU   PSA+1048
PSARV062 EQU   PSA+1044
PSACDAL  EQU   PSA+1040
PSAWTCOD EQU   PSA+1036
PSAATCVT EQU   PSA+1032
PSAPCPSW EQU   PSA+1024
PSAPIR2  EQU   PSA+1020
PSARV059 EQU   PSA+1018
PSASVC13 EQU   PSA+1016
PSALSFCC EQU   PSA+1012
PSASFACC EQU   PSA+1008
PSASTOP  EQU   PSA+992
PSASTART EQU   PSA+976
PSARSPSW EQU   PSA+968
PSASRPSW EQU   PSA+960
PSARV045 EQU   PSA+892
PSARV044 EQU   PSA+888
PSARV043 EQU   PSA+884
PSARV042 EQU   PSA+880
PSARV041 EQU   PSA+876
PSARV040 EQU   PSA+872
PSARV025 EQU   PSA+868
PSADSSED EQU   PSA+868
PSADSSPR EQU   PSA+864
PSADSSFW EQU   PSA+860
PSADSS14 EQU   PSA+856
PSADSSPP EQU   PSA+848
PSADSSRP EQU   PSA+840
PSADSS05 EQU   PSADSSF4
PSADSS10 EQU   PSADSSF4
PSADSSVE EQU   PSADSSF4
PSADSSDE EQU   PSADSSF4
PSADSSC0 EQU   PSADSSF4
PSADSSIE EQU   PSADSSF4
PSADSS12 EQU   PSADSSF4
PSADSSRC EQU   PSADSSF4
PSARV057 EQU   PSADSSF3
PSARV056 EQU   PSADSSF3
PSARV055 EQU   PSADSSF3
PSADSSMC EQU   PSADSSF3
PSADSSRW EQU   PSADSSF3
PSADSSNM EQU   PSADSSF3
PSADSSES EQU   PSADSSF3
PSADSSGP EQU   PSADSSF3
PSADSSF2 EQU   PSADSSFL+1
PSADSSPI EQU   PSADSSF1
PSADSSOI EQU   PSADSSF1
PSADSSSP EQU   PSADSSF1
PSADSSTP EQU   PSADSSF1
PSADSSDW EQU   PSADSSF1
PSADSSDD EQU   PSADSSF1
PSADSSDM EQU   PSADSSF1
PSADSSMV EQU   PSADSSF1
PSADSSTS EQU   PSA+816
PSADSSWK EQU   PSA+812
PSADSSR3 EQU   PSA+808
PSADSSR2 EQU   PSA+804
PSADSSRS EQU   PSA+800
PSASTOR  EQU   PSA+796
PSACPUSA EQU   PSA+794
PSAVSTAP EQU   PSA+792
PSAWKVAP EQU   PSA+788
PSAWKRAP EQU   PSA+784
PSAMCHIC EQU   PSA+783
PSARV061 EQU   PSA+782
PSASYMSK EQU   PSA+781
PSAMCHFL EQU   PSA+780
PSACR0   EQU   PSA+776
PSAPSWSV EQU   PSA+768
PSALITA  EQU   PSA+764
PSACLHS  EQU   PSAHLHI
PSALKR15 EQU   PSALKSA+60
PSALKR14 EQU   PSALKSA+56
PSALKR13 EQU   PSALKSA+52
PSALKR12 EQU   PSALKSA+48
PSALKR11 EQU   PSALKSA+44
PSALKR10 EQU   PSALKSA+40
PSALKR9  EQU   PSALKSA+36
PSALKR8  EQU   PSALKSA+32
PSALKR7  EQU   PSALKSA+28
PSALKR6  EQU   PSALKSA+24
PSALKR5  EQU   PSALKSA+20
PSALKR4  EQU   PSALKSA+16
PSALKR3  EQU   PSALKSA+12
PSALKR2  EQU   PSALKSA+8
PSALKR1  EQU   PSALKSA+4
PSALKR0  EQU   PSALKSA
PSARV023 EQU   PSACLHT+52
PSALOCAL EQU   PSACLHT+48
PSACMSL  EQU   PSACLHT+44
PSAOPTL  EQU   PSACLHT+40
PSATPACL EQU   PSACLHT+36
PSATPDNL EQU   PSACLHT+32
PSATPNCL EQU   PSACLHT+28
PSAIOSLL EQU   PSACLHT+24
PSAIOSUL EQU   PSACLHT+20
PSAIOSCL EQU   PSACLHT+16
PSAIOSSL EQU   PSACLHT+12
PSASALCL EQU   PSACLHT+8
PSAASML  EQU   PSACLHT+4
PSADISPL EQU   PSACLHT
PSASRSA  EQU   PSA+636
PSARV050 EQU   PSA+634
PSADSSGO EQU   PSA+633
PSARECUR EQU   PSA+632
PSAHLHIS EQU   PSA+628
PSAIPCSA EQU   PSA+624
@NM00056 EQU   PSA+621
PSAIPCDM EQU   PSA+620
PSAIPCD  EQU   PSA+616
@NM00055 EQU   PSA+613
PSAIPCRM EQU   PSA+612
PSAIPCR  EQU   PSA+608
PSAMCHEX EQU   PSA+600
PSAMPSW  EQU   PSA+592
PSAEXPS2 EQU   PSA+584
PSAEXPS1 EQU   PSA+576
PSAPIREG EQU   PSA+572
PSARSREG EQU   PSA+568
PSAGPREG EQU   PSA+556
PSARV022 EQU   PSASUP4
PSARV021 EQU   PSASUP4
PSARV020 EQU   PSASUP4
PSARV019 EQU   PSASUP4
PSARV018 EQU   PSASUP4
PSARV017 EQU   PSASUP4
PSARV016 EQU   PSASUP4
PSARV015 EQU   PSASUP4
PSARV014 EQU   PSASUP3
PSAULCMS EQU   PSASUP3
PSARV012 EQU   PSASUP3
PSAESTA  EQU   PSASUP3
PSASPR   EQU   PSASUP3
PSAPSREG EQU   PSASUP3
PSAPI2   EQU   PSASUP3
PSAIOSUP EQU   PSASUP3
PSALCR   EQU   PSASUP2
PSARTM   EQU   PSASUP2
PSAACR   EQU   PSASUP2
PSAIPCE2 EQU   PSASUP2
PSAIPCES EQU   PSASUP2
PSAIPCEC EQU   PSASUP2
PSAGTF   EQU   PSASUP2
PSAIPCRI EQU   PSASUP2
PSATYPE6 EQU   PSASUP1
PSATCTL  EQU   PSASUP1
PSADISP  EQU   PSASUP1
PSALOCK  EQU   PSASUP1
PSAPI    EQU   PSASUP1
PSAEXT   EQU   PSASUP1
PSASVC   EQU   PSASUP1
PSAIO    EQU   PSASUP1
PSAAOLD  EQU   PSA+548
PSAANEW  EQU   PSA+544
PSATOLD  EQU   PSA+540
PSATNEW  EQU   PSA+536
PSALCCAR EQU   PSA+532
PSALCCAV EQU   PSA+528
PSAPCCAR EQU   PSA+524
PSAPCCAV EQU   PSA+520
PSACPULA EQU   PSA+518
PSACPUPA EQU   PSA+516
PSAPSA   EQU   PSA+512
FLCHDEND EQU   PSA+512
FLCCRSAV EQU   FLCMCLA+280
FLCGRSAV EQU   FLCMCLA+216
FLCFPSAV EQU   FLCMCLA+184
FLCFLA   EQU   FLCMCLA+88
FLCRGNCD EQU   FLCMCLA+84
FLCFSAA  EQU   FLCFSA+1
@NM00054 EQU   FLCFSA
@NM00053 EQU   FLCMCLA+72
FLCMCIC  EQU   FLCMCLA+64
@NM00052 EQU   FLCMCLA+20
FLCIOAA  EQU   FLCIOA+1
@NM00051 EQU   FLCIOA
@NM00050 EQU   FLCMCLA+15
@NM00049 EQU   FLCMCLA+14
@NM00048 EQU   FLCMCLA+12
FLCLCL   EQU   FLCMCLA+8
FLCIOELA EQU   FLCIOEL+1
@NM00047 EQU   FLCIOEL
FLCCHNID EQU   FLCMCLA
@NM00046 EQU   PSA+160
FLCMTRCD EQU   PSA+157
@NM00045 EQU   PSA+156
FLCPERA  EQU   FLCPER+1
@NM00044 EQU   FLCPER
@NM00043 EQU   PSA+151
FLCPERCD EQU   PSA+150
FLCMCNUM EQU   PSA+149
@NM00042 EQU   PSA+148
FLCTEAA  EQU   FLCTEA+1
@NM00041 EQU   FLCTEA
PSAPIPC  EQU   PSAPICOD
PSAPIMC  EQU   PSAPICOD
PSAPIPER EQU   PSAPICOD
PSARV049 EQU   FLCPICOD
FLCPILCB EQU   FLCPIILC
@NM00040 EQU   FLCPIILC
@NM00039 EQU   PSAEPPSW
FLCSVCN  EQU   PSAESPSW+2
FLCSILCB EQU   FLCSVILC
@NM00038 EQU   FLCSVILC
@NM00037 EQU   PSAESPSW
FLCEICOD EQU   PSAEEPSW+2
PSASPAD  EQU   PSAEEPSW
@NM00036 EQU   PSA+128
FLCINPSW EQU   PSA+120
FLCMNPSW EQU   PSA+112
FLCPNPSW EQU   PSA+104
FLCSNPSW EQU   PSA+96
FLCENPSW EQU   PSA+88
FLCTRACE EQU   PSA+84
FLCTIMER EQU   PSA+80
FLCCVT2  EQU   PSA+76
FLCCAW   EQU   PSA+72
FLCCSW   EQU   PSA+64
FLCIOPSW EQU   PSA+56
FLCMOPSW EQU   PSA+48
FLCPOPSW EQU   PSA+40
FLCSOPSW EQU   PSA+32
FLCEOPSW EQU   PSA+24
@NM00035 EQU   FLCICCW2+4
FLCICCW1 EQU   FLCROPSW
FLCIPPSW EQU   FLCRNPSW
*                                      END UNREFERENCED COMPONENTS
@RC00183 EQU   @RC00182
@RC00212 EQU   @RC00207
@RC00274 EQU   @EL00007
@RC00288 EQU   @EL00007
@RC00315 EQU   @RC00314
@RC00407 EQU   @RC00405
@RC00456 EQU   @RC00454
@RF00555 EQU   @RC00551
@RC00583 EQU   @RC00582
@RC00610 EQU   @EL00017
@RC00278 EQU   @RC00274
@ENDDATA EQU   *
         END   ILRSRT,(C'PLS1734',0701,78110)

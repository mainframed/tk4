         TITLE 'IEEVCPU VARY CPU MAINLINE                              *
                        '
IEEVCPU  CSECT ,                                                   0001
@MAINENT DS    0H                                                  0001
         USING *,@15                                               0001
         B     @PROLOG                                             0001
         DC    AL1(22)                                             0001
         DC    C'IEEVCPU  UZ19134 78196'                           0001
         DROP  @15
@PROLOG  BALR  @05,0                                               0001
@PSTART  LA    @08,4095(,@05)                                      0001
         LA    @09,4095(,@08)                                      0001
         USING @PSTART,@05                                         0001
         USING @PSTART+4095,@08                                    0001
         USING @PSTART+8190,@09                                    0001
         LR    @06,@01                                             0001
         L     @00,@SIZDATD                                        0001
         GETMAIN  R,LV=(0)
         LR    @07,@01                                             0001
         USING @DATD,@07                                           0001
         LR    @01,@06                                             0001
         ST    @13,@SA00001+4                                      0001
         LR    @13,@07                                             0001
         MVC   @PC00001(4),0(@01)                                  0001
*                                      I = THE CPU #         @G47AN2O*/
*                                                                  0108
*   /*****************************************************************/
*   /*                                                               */
*   /* BEGINNING OF MAINLINE PROCESSING. ZERO OUT NECESSARY FIELDS   */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0109
*   WORKAREA=''B;                   /* ZERO OUT WORK AREA            */
         XC    WORKAREA(116),WORKAREA                              0109
*   VMVPARMS=''B;                   /* ZERO OUT PARM LIST POINTERS   */
         XC    VMVPARMS(52),VMVPARMS                               0110
*   PARMAREA=''B;                   /* ZERO OUT IEEVWKUP'S PARM    0111
*                                                            @G557P2L*/
         XC    PARMAREA(109),PARMAREA                              0111
*   PSAPTR=0;                       /* POINT TO MY PSA       @YM08660*/
         SLR   PSAPTR,PSAPTR                                       0112
*   RFY                                                            0113
*    (R1,                                                          0113
*     R5,                                                          0113
*     R7,                                                          0113
*     R8,                                                          0113
*     R9,                                                          0113
*     R10,                                                         0113
*     R14) RSTD;                    /* RESTRICT REGISTER             */
*   CSCBPTR=R1;                     /* SAVE CSCB ADDRESS             */
*                                                                  0114
         ST    R1,CSCBPTR                                          0114
*   /*****************************************************************/
*   /*                                                               */
*   /* SAVE REGISTERS IN WORK AREA FOR ADDRESSABILITY IN THE EVENT OF*/
*   /* A FAILURE. ESTAE ROUTINE WILL RELOAD REGISTERS                */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0115
*   CODEREG1=R5;                    /* SAVE BASE REGISTERS           */
         ST    R5,CODEREG1                                         0115
*   CODEREG2=R8;                    /* SAVE SECOND BASE REG          */
         ST    R8,CODEREG2                                         0116
*   CODEREG3=R9;                    /* SAVE THIRD BASE REG           */
         ST    R9,CODEREG3                                         0117
*   DATAREG1=R7;                    /* SAVE DATA REGISTER            */
         ST    R7,DATAREG1                                         0118
*   RETADD=R14;                     /* SAVE RETURN ADDRESS           */
         ST    R14,RETADD                                          0119
*   R10=ADDR(ESTAPRM);              /* SETUP FOR ESTAE ROUTINE       */
         LA    R10,ESTAPRM                                         0120
*   ESTLIST=''B;                    /* ZERO OUT ESTAE LIST           */
         XC    ESTLIST(16),ESTLIST                                 0121
*   R1=ADDR(ESTLIST);               /* POINT TO ESTAE ENTERFACE      */
         LA    R1,ESTLIST                                          0122
*   RFY                                                            0123
*    (R1,                                                          0123
*     R5,                                                          0123
*     R7,                                                          0123
*     R8,                                                          0123
*     R9,                                                          0123
*     R10,                                                         0123
*     R14) UNRSTD;                  /* RELEASE REGISTERS             */
*   GEN(ESTAE ESTAERTN,PARAM=(10),PURGE=NONE,MF=(E,(1)));          0124
         ESTAE ESTAERTN,PARAM=(10),PURGE=NONE,MF=(E,(1))
*   RFY                                                            0125
*    (RETCODE) RSTD;                /* RESTRICT REG 15               */
*                                                                  0125
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK IF ESATE HAS BEEN SET UP PROPERLY                       */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0126
*   IF RETCODE^=0 THEN              /* ANY ERROR ?                   */
         LTR   RETCODE,RETCODE                                     0126
         BNZ   @RT00126                                            0126
*     GOTO MAINEXT;                 /* GO CLEAN UP                   */
*                                                                  0127
*   /*****************************************************************/
*   /*                                                               */
*   /* SERIALIZE VARY CPU AND VARY CHANNEL COMMANDS          @ZA24473*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0128
*   GEN(ENQ  (RCNENQQ,RCNENQR,E,3,SYSTEM));/* ENQ SYSZVARY   @ZA24473*/
         ENQ  (RCNENQQ,RCNENQR,E,3,SYSTEM)
*   RECONENQ='1'B;                  /* SET FOOTPRINT         @ZA24473*/
         OI    RECONENQ,B'01000000'                                0129
*/**** SYNTXCHK **************************************************** */
*/* SYNTXCHK WILL SCAN THE INPUT COMMAND AND SET UP NECESSARY FIELDS */
*/* IN THE WORKAREA TO BE USED LATER. COMMAND AUTHORITY IS CHECKED   */
*/* AND WILL TERMINATE SCAN IF ISSUING CONSOLE WAS NOT AUTHORIZED    */
*/* POSSIBLE ERROR INDICATORS ARE: UNAUTH, INVLDSTX, UNIPROC,        */
*/* CHCPUOFF                                                         */
*/****************************************************************** */
*                                                                  0130
*   DO;                                                            0130
*     CHARPTR=ADDR(CHBUF);          /* ADDRESSABILITY TO COMMAND TEXT*/
         L     @14,CSCBPTR                                         0131
         LA    CHARPTR,CHBUF(,@14)                                 0131
*/******** AUTHCHK ************************************************* */
*/* AUTHCHK WILL VERIFY THE AUTHORTY OF THE ISSUING CONSOLE. IF THE  */
*/* ISSUING CONSOLE WAS NOT AUTHORIZED THEN UNAUTH ERROR FLAG WILL   */
*/* BE SET. ROUTINE WILL ACCEPT INTERNALLY ISSUED COMMANDS, COMMANDS */
*/* FROM READERS WITH ATHOURATION OF X'E00' AND COMMANDS ISSUED BY   */
*/* THE MASTER CONSOLE.                                              */
*/****************************************************************** */
*                                                                  0132
*     DO;                                                          0132
*                                                                  0132
*       /*************************************************************/
*       /*                                                           */
*       /* ASSUME MASTER CONSOLE ISSUED COMMAND                      */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0133
*       CONSLID=UCMID;              /* SET MASTER CONSOLE ID         */
*                                                                  0133
         L     @06,CVTPTR                                          0133
         L     @06,UCMBASPT(,@06)                                  0133
         AL    @06,@CF04020                                        0133
         L     @06,UCMMCSPT(,@06)                                  0133
         L     @06,UCMDVEPT(,@06)                                  0133
         MVC   CONSLID(1),UCMID(@06)                               0133
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK IF COMMAND WAS A INTERNAL COMMAND                   */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0134
*       IF CHUCMP^=0 THEN           /* WAS IT INTERNAL?              */
*                                                                  0134
         CLI   CHUCMP(@14),0                                       0134
         BE    @RF00134                                            0134
*         /***********************************************************/
*         /*                                                         */
*         /* COMMAND WAS NOT ISSUED INTERNALY CHECK FOR READER ISSUE */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0135
*         IF CHUCMP='80'X THEN      /* READER ISSUE COMMAND?         */
         CLI   CHUCMP(@14),X'80'                                   0135
         BNE   @RF00135                                            0135
*           DO;                                                    0136
*                                                                  0136
*             /*******************************************************/
*             /*                                                     */
*             /* CHECK FOR PROPER AUTHORIZATION FROM READER          */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0137
*             IF CHINC^='E000'X THEN                               0137
         CLC   CHINC(2,@14),@CH03589                               0137
         BE    @RF00137                                            0137
*               UNAUTH='1'B;        /* SET UNAUTH ERROR FLAG         */
         OI    UNAUTH,B'10000000'                                  0138
*           END;                                                   0139
*                                                                  0139
*       /*************************************************************/
*       /*                                                           */
*       /* COMMAND WAS NOT ISSUED INTERNALLY CHECK IF ISSUING CONSOLE*/
*       /* WAS AUTHORIZED.                                           */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0140
*         ELSE                                                     0140
*                                                                  0140
*           /*********************************************************/
*           /*                                                       */
*           /* CHECK IF MASTER CONSOLE ISSUED COMMAND                */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0140
*           IF UCMID^=CHUCMP THEN   /* WAS IT MASTER                 */
         B     @RC00135                                            0140
@RF00135 L     @14,CVTPTR                                          0140
         L     @14,UCMBASPT(,@14)                                  0140
         AL    @14,@CF04020                                        0140
         L     @14,UCMMCSPT(,@14)                                  0140
         L     @14,UCMDVEPT(,@14)                                  0140
         L     @06,CSCBPTR                                         0140
         CLC   UCMID(1,@14),CHUCMP(@06)                            0140
         BE    @RF00140                                            0140
*             DO;                                                  0141
*               CONSLID=CHUCMP;     /* SAVE ISSUING CONSOLE ID       */
         MVC   CONSLID(1),CHUCMP(@06)                              0142
*               UNAUTH='1'B;        /* SET UNAUTH FLAG               */
         OI    UNAUTH,B'10000000'                                  0143
*             END;                                                 0144
*     END;                          /* END OF AUTHCHECK ROUTINE      */
@RF00140 DS    0H                                                  0145
@RC00135 DS    0H                                                  0145
@RF00134 DS    0H                                                  0146
*                                                                  0146
*     /***************************************************************/
*     /*                                                             */
*     /* VERIFY THAT NO ERROR INDICATORS WERE SET DURING AUTH CHECK  */
*     /*                                                             */
*     /***************************************************************/
*                                                                  0146
*     IF ERRORIND^=0 THEN           /* ANY ERRORS                    */
         ICM   @14,15,ERRORIND                                     0146
         BNZ   @RT00146                                            0146
*       GOTO SYNTEXIT;              /* SKIP PROCESSING               */
*                                                                  0147
*     /***************************************************************/
*     /*                                                             */
*     /* CHECK FOR CHANNEL COMMAND AND SET UP WORKAREA IF FOUND      */
*     /*                                                             */
*     /***************************************************************/
*                                                                  0148
*     IF COMBUF='CH(' THEN          /* CHECK FOR VARY CHANNEL COMMAND*/
         CLC   COMBUF(3,CHARPTR),@CC03591                          0148
         BNE   @RF00148                                            0148
*       DO;                                                        0149
*         CHNIND='1'B;              /* SET CHANNEL INDICATOR         */
         OI    CHNIND,B'10000000'                                  0150
*         CHARPTR=CHARPTR+3;        /* STEP POINTER TO CHANNEL NUMBER*/
*                                                                  0151
         AH    CHARPTR,@CH00074                                    0151
*         /***********************************************************/
*         /*                                                         */
*         /* VERIFY THAT CHANNEL ADDRESS IS VALID HEX DIGIT AND CALL */
*         /* CONVERT TO CONVERT VALUE AND BUILD BIT MASK             */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0152
*         IF(COMBUF=>'A'&COMBUF<='F')×(COMBUF>='0') THEN/* VALID   0152
*                                      DIGIT                         */
         CLI   COMBUF(CHARPTR),C'A'                                0152
         BL    @GL00001                                            0152
         CLI   COMBUF(CHARPTR),C'F'                                0152
         BNH   @RT00152                                            0152
@GL00001 CLI   COMBUF(CHARPTR),C'0'                                0152
         BL    @RF00152                                            0152
@RT00152 DS    0H                                                  0153
*           CALL CONVERT(HEXCHNAD,CHNMASK);/* CONVERT CHARACTER      */
         LA    @14,HEXCHNAD                                        0153
         ST    @14,@AL00001                                        0153
         LA    @14,CHNMASK                                         0153
         ST    @14,@AL00001+4                                      0153
         LA    @01,@AL00001                                        0153
         BAL   @14,CONVERT                                         0153
*         ELSE                                                     0154
*                                                                  0154
*           /*********************************************************/
*           /*                                                       */
*           /* CHARACTER WAS NOT A VALID CHARACTER SET SYNTAX ERROR  */
*           /* AND RETURN                                            */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0154
*           GOTO SYNTERR;           /* GO SET SYNTAX ERROR FLAG      */
*                                                                  0154
*         /***********************************************************/
*         /*                                                         */
*         /* CHARACTER WAS VALID. VERIFY THAT ADDRESS IS VALID FOR   */
*         /* THIS SYSTEM                                             */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0155
*         IF HEXCHNAD>CSDCHAD THEN  /* CHANNEL INVALID ?             */
         L     @14,CVTPTR                                          0155
         L     @14,CVTCSD(,@14)                                    0155
         SLR   @06,@06                                             0155
         ICM   @06,3,HEXCHNAD                                      0155
         CH    @06,CSDCHAD(,@14)                                   0155
         BNH   @RF00155                                            0155
*           DO;                                                    0156
*             CHINV='1'B;           /* SET INVALID CHANNEL FLAG      */
         OI    CHINV,B'00000001'                                   0157
*             GOTO SYNTEXIT;        /* EXIT                          */
         B     SYNTEXIT                                            0158
*           END;                                                   0159
*         CHARPTR=CHARPTR+1;        /* STEP PAST CHANNEL ADDRESS     */
*                                                                  0160
@RF00155 LA    @14,1                                               0160
         ALR   CHARPTR,@14                                         0160
*         /***********************************************************/
*         /*                                                         */
*         /* CHECK IF CHANNEL ADDRESS WAS SPECIFIED IN COMMAND       */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0161
*         IF COMBUF^=',' THEN       /* NEXT CHARACTER A COMMA?       */
*                                                                  0161
         CLI   COMBUF(CHARPTR),C','                                0161
         BE    @RF00161                                            0161
*           /*********************************************************/
*           /*                                                       */
*           /* CPU ADDRESS WAS NOT SPECIFIED. IF MORE THAN ONE CPU IS*/
*           /* ONLINE THEN REJECT COMMAND. ELSE USE THIS CPU'S       */
*           /* ADDRESS AND BITMASK AS DEFAULT                        */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0162
*           IF CSDCPUOL=1 THEN      /* IS ONLY ONE CPU ONLINE        */
         L     @06,CVTPTR                                          0162
         L     @06,CVTCSD(,@06)                                    0162
         CH    @14,CSDCPUOL(,@06)                                  0162
         BNE   @RF00162                                            0162
*             DO;                                                  0163
*               HEXCPUAD=PSACPUPA;  /* USE THIS CPU'S ADDRESS AS   0164
*                                      DEFAULT                       */
         MVC   HEXCPUAD(2),PSACPUPA(PSAPTR)                        0164
*               CPUMSK=CSDCPUAL;    /* USE DEFAULT BIT MASK          */
         MVC   CPUMSK(2),CSDCPUAL(@06)                             0165
*               GOTO SYTXCMND;      /* GO SCAN REST OF COMMAND       */
         B     SYTXCMND                                            0166
*             END;                                                 0167
*                                                                  0167
*         /***********************************************************/
*         /*                                                         */
*         /* CPU ADDRESS WAS NOT SPECIFIED AND MORE THAN ONE CPU IS  */
*         /* ONLINE SET SYNTAX ERROR AND TERMINATE PROCESSING        */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0168
*           ELSE                                                   0168
*             GOTO SYNTERR;         /* SET ERROR FLAG AND EXIT       */
*                                                                  0168
*         /***********************************************************/
*         /*                                                         */
*         /* CPU ADDRESS WAS SPECIFIED VERIFY CHARACTER AND CONVERT  */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0169
*         CHARPTR=CHARPTR+1;        /* STEP PAST COMMA               */
@RF00161 AH    CHARPTR,@CH00067                                    0169
*STXCPUAD:                                                         0170
*         IF(COMBUF=>'A'&COMBUF<='F')/* VALID ALPHA CHARACTER? OR    */
*             ×(COMBUF=>'0')        /* VALID DECIMAL DIGIT?          */
*           THEN                                                   0170
STXCPUAD CLI   COMBUF(CHARPTR),C'A'                                0170
         BL    @GL00003                                            0170
         CLI   COMBUF(CHARPTR),C'F'                                0170
         BNH   @RT00170                                            0170
@GL00003 CLI   COMBUF(CHARPTR),C'0'                                0170
         BL    @RF00170                                            0170
@RT00170 DS    0H                                                  0171
*           CALL CONVERT(HEXCPUAD,CPUMSK);/* CONVERT CHARACTER AND 0171
*                                      BUILD BIT MASK                */
*                                                                  0171
         LA    @14,HEXCPUAD                                        0171
         ST    @14,@AL00001                                        0171
         LA    @14,CPUMSK                                          0171
         ST    @14,@AL00001+4                                      0171
         LA    @01,@AL00001                                        0171
         BAL   @14,CONVERT                                         0171
*         /***********************************************************/
*         /*                                                         */
*         /* WAS NOT A VALID HEX CHARACTER. SET SYNTAX ERROR FLAG    */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0172
*         ELSE                                                     0172
*           GOTO SYNTERR;           /* GO SET SYNTAX ERROR AND RETURN*/
*         CHARPTR=CHARPTR+1;        /* STEP PAST CPU ADDRESS         */
*                                                                  0173
         AH    CHARPTR,@CH00067                                    0173
*         /***********************************************************/
*         /*                                                         */
*         /* CHECK FOR TYPE OF COMMAND. I.E. ONLINE, OFFLINE,        */
*         /* UNCONDITIONAL OFFLINE                                   */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0174
*SYTXCMND:                          /* VERIFY TYPE OF COMMAND AND SET
*                                      UP WORKAREA                   */
*         IF COMBUF='),ONLINE ' THEN/* CHECK FOR ONLINE COMMAND      */
SYTXCMND CLC   COMBUF(9,CHARPTR),@CC03601                          0174
         BNE   @RF00174                                            0174
*           DO;                                                    0175
*             ONLINE='1'B;          /* SET ONLINE INDICATOR          */
         OI    ONLINE,B'00100000'                                  0176
*             GOTO SYTXCHCK;        /* GO VERIFY CPU ONLINE          */
         B     SYTXCHCK                                            0177
*           END;                                                   0178
*                                                                  0178
*         /***********************************************************/
*         /*                                                         */
*         /* CHECK IF THIS IS A OFFLINE COMMAND                      */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0179
*         IF COMBUF='),OFFLINE ' THEN/* OFFLINE COMMAND?             */
@RF00174 CLC   COMBUF(10,CHARPTR),@CC03605                         0179
         BE    @RT00179                                            0179
*           GOTO SYTXCHCK;          /* GO VERIFY CPU ONLINE          */
*                                                                  0180
*         /***********************************************************/
*         /*                                                         */
*         /* IF OFFLINE WITH UNCONDITIONAL IS SPECIFIED THEN SET     */
*         /* UNCOND INDICATOR IN WORK AREA                           */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0181
*         IF COMBUF='),OFFLINE,UNCOND '×COMBUF='),UNCOND,OFFLINE ' THEN
         CLC   COMBUF(17,CHARPTR),@CC03607                         0181
         BE    @RT00181                                            0181
         CLC   COMBUF(17,CHARPTR),@CC03609                         0181
         BNE   @RF00181                                            0181
@RT00181 DS    0H                                                  0182
*           DO;                     /* OFFLINE UNCONDITIONAL REQUEST */
*             UNCOND='1'B;          /* SET UNCONDITIONAL INDICATOR   */
         OI    UNCOND,B'00010000'                                  0183
*             GOTO SYTXCHCK;        /* GO VERIFY CPU ONLINE          */
         B     SYTXCHCK                                            0184
*           END;                                                   0185
*                                                                  0185
*         /***********************************************************/
*         /*                                                         */
*         /* IF CPU OFFLINE WITH CRH OPTION, SET CPU CRH INDICATOR IN*/
*         /* THE WORKAREA.                                   @G557P2L*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  0186
*         IF CHNIND='0'B&(COMBUF='),OFFLINE,KEEPCHAN '×/*    @G557P2L*/
*             COMBUF='),KEEPCHAN,OFFLINE ')/*                @G557P2L*/
*           THEN                                                   0186
@RF00181 TM    CHNIND,B'10000000'                                  0186
         BNZ   @RF00186                                            0186
         CLC   COMBUF(19,CHARPTR),@CC03611                         0186
         BE    @RT00186                                            0186
         CLC   COMBUF(19,CHARPTR),@CC03613                         0186
         BNE   @RF00186                                            0186
@RT00186 DS    0H                                                  0187
*           DO;                     /* VARY CPU OFFLINE WITH CRH?  0187
*                                                            @G557P2L*/
*             KEEPCHAN='1'B;        /* SET KEEPCHAN INDICATOR      0188
*                                                            @G557P2L*/
         OI    KEEPCHAN,B'10000000'                                0188
*             GOTO SYTXCHCK;        /* GO VERIFY CPU ONLINE  @G557P2L*/
         B     SYTXCHCK                                            0189
*           END;                                                   0190
*                                                                  0190
*         /***********************************************************/
*         /*                                                         */
*         /* IF NONE OF THE ABOVE KEYWORDS WERE FOUND THEN SET SYNTAX*/
*         /* ERROR                                                   */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0191
*SYNTERR:                                                          0191
*         INVLDSTX='1'B;            /* SET INVALID SYNTAX ERROR      */
@RF00186 DS    0H                                                  0191
SYNTERR  OI    INVLDSTX,B'01000000'                                0191
*         GOTO SYNTEXIT;            /* RETURN TO CALLER              */
         B     SYNTEXIT                                            0192
*       END;                        /* END OF CHANNEL COMMAND        */
*                                                                  0193
*     /***************************************************************/
*     /*                                                             */
*     /* COMMAND WAS NOT VARY CHANNEL. VERIFY A VARY CPU COMMAND     */
*     /*                                                             */
*     /***************************************************************/
*                                                                  0194
*     IF COMBUF^='CPU(' THEN        /* VARY CPU COMMAND ?            */
@RF00148 CLC   COMBUF(4,CHARPTR),@CC03616                          0194
         BNE   @RT00194                                            0194
*       GOTO SYNTERR;               /* SYNTAX ERROR IF NOT           */
*                                                                  0195
*     /***************************************************************/
*     /*                                                             */
*     /* VERIFY THAT WE ARE NOT RUNNING ON A UNIPROCESSOR            */
*     /*                                                             */
*     /***************************************************************/
*                                                                  0196
*     IF CSDMP^='1'B THEN                                          0196
         L     @14,CVTPTR                                          0196
         L     @14,CVTCSD(,@14)                                    0196
         TM    CSDMP(@14),B'10000000'                              0196
         BO    @RF00196                                            0196
*       DO;                                                        0197
*         UNIPROC='1'B;             /* SET UNIPROCESSOR ERROR FLAG   */
         OI    UNIPROC,B'01000000'                                 0198
*         GOTO SYNTEXIT;            /* RETURN TO CALLER              */
         B     SYNTEXIT                                            0199
*       END;                                                       0200
*     CHARPTR=CHARPTR+4;            /* UPDATE POINTER TO CPU ADDRESS */
@RF00196 AH    CHARPTR,@CH00076                                    0201
*     GOTO STXCPUAD;                /* GO VERIFY CPU ADDRESS         */
*                                                                  0202
         B     STXCPUAD                                            0202
*     /***************************************************************/
*     /*                                                             */
*     /* VERIFY VALIDITY OF COMMAND BY CHECKING IF CPU IS ONLINE FOR */
*     /* VARY CHANNEL COMMAND                                        */
*     /*                                                             */
*     /***************************************************************/
*                                                                  0203
*SYTXCHCK:                                                         0203
*                                                                  0203
*     /***************************************************************/
*     /*                                                             */
*     /* TEST FOR KEEPCHAN SPECIFIED AND SUPPORTED. PRESENTLY ONLY   */
*     /* THE 168MP PROVIDES THIS FUNCTION VIA CRH.           @G557P2L*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0203
*     IF KEEPCHAN='1'B THEN                                        0203
SYTXCHCK TM    KEEPCHAN,B'10000000'                                0203
         BNO   @RF00203                                            0203
*       DO;                         /* CPU OFFLINE CRH ENTERED     0204
*                                                            @G557P2L*/
*         PSAPTR=0;                 /* ADDRESS THIS CPU'S PSA      0205
*                                                            @G557P2L*/
         SLR   PSAPTR,PSAPTR                                       0205
*         PCCAPTR=PSAPCCAV;         /* GET PCCA ADDRESS FOR CRH TEST
*                                                            @G557P2L*/
         L     @14,PSAPCCAV(,PSAPTR)                               0206
         ST    @14,PCCAPTR                                         0206
*         IF IOXCRHA=0×PCCACPID(9:12)^='0168' THEN                 0207
         L     @06,CVTPTR                                          0207
         L     @06,IOCOMPTR(,@06)                                  0207
         L     @06,IOCXPTR(,@06)                                   0207
         ICM   @04,15,IOXCRHA(@06)                                 0207
         BZ    @RT00207                                            0207
         CLC   PCCACPID+8(4,@14),@CC03618                          0207
         BE    @RF00207                                            0207
@RT00207 DS    0H                                                  0208
*           NOKPCHAN='1'B;          /* SET KEEPCHAN NOT SUPPORTED. 0208
*                                                            @G557P2L*/
         OI    NOKPCHAN,B'00010000'                                0208
*         ELSE                                                     0209
*           CPUCRH='1'B;            /* CPU OFFLINE TO ACTIVATE     0209
*                                      CRH.@G557P2L                  */
         B     @RC00207                                            0209
@RF00207 OI    CPUCRH,B'00000001'                                  0209
*       END;                                                       0210
*                                                                  0210
@RC00207 DS    0H                                                  0211
*     /***************************************************************/
*     /*                                                             */
*     /* IF THIS WAS A VARY CHANNEL COMMAND VERIFY THAT THE SPECIFIED*/
*     /* CPU IS ONLINE                                               */
*     /*                                                             */
*     /***************************************************************/
*                                                                  0211
*     IF CHNIND='1'B&(CSDCPUAL&CPUMSK)=0 THEN/*              @Y30CQXA*/
@RF00203 TM    CHNIND,B'10000000'                                  0211
         BNO   @RF00211                                            0211
         SLR   @14,@14                                             0211
         L     @06,CVTPTR                                          0211
         L     @04,CVTCSD(,@06)                                    0211
         SLR   @11,@11                                             0211
         ICM   @11,3,CPUMSK                                        0211
         SLR   @10,@10                                             0211
         ICM   @10,3,CSDCPUAL(@04)                                 0211
         NR    @11,@10                                             0211
         CR    @11,@14                                             0211
         BNE   @RF00211                                            0211
*       DO;                         /*                       @Y30CQXA*/
*                                                                  0212
*         /***********************************************************/
*         /*                                                         */
*         /* SUBJECT CPU IS OFFLINE, CHECK IF SYSTEM IS GENED FOR    */
*         /* CHANNEL RECONFIGURATION HARDWARE.                       */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0213
*         IF IOXCRHA=0 THEN         /* CRH GENED?            @Y30CQXA*/
         L     @06,IOCOMPTR(,@06)                                  0213
         L     @06,IOCXPTR(,@06)                                   0213
         C     @14,IOXCRHA(,@06)                                   0213
         BE    @RT00213                                            0213
*           GOTO REJOFF;            /* GO REJECT COMMAND. CPU OFFLINE
*                                                            @Y30CQXA*/
*                                                                  0214
*         /***********************************************************/
*         /*                                                         */
*         /* SET UP ADDRESSABILITY TO MY OWN PCCA TO DETERMINE SYSTEM*/
*         /* TYPE.                                                   */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0215
*         PSAPTR=0;                 /* ADDRESSABILITY TO MY PSA    0215
*                                                            @Y30CQXA*/
         SLR   PSAPTR,PSAPTR                                       0215
*         PCCAPTR=PSAPCCAV;         /* ADDRESS OF MY PCCA    @Y30CQXA*/
*                                                                  0216
         L     @14,PSAPCCAV(,PSAPTR)                               0216
         ST    @14,PCCAPTR                                         0216
*         /***********************************************************/
*         /*                                                         */
*         /* CHECK IF THIS IS A 168 MP SYSTEM                        */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0217
*         IF CSDMP^='1'B×PCCACPID(9:12)^='0168' THEN/* 168 MP?     0217
*                                                            @Y30CQXA*/
         TM    CSDMP(@04),B'10000000'                              0217
         BNO   @RT00217                                            0217
         CLC   PCCACPID+8(4,@14),@CC03618                          0217
         BNE   @RT00217                                            0217
*           GOTO REJOFF;            /* REJECT COMMAND. NOT 168 MP  0218
*                                                            @Y30CQXA*/
*                                                                  0218
*         /***********************************************************/
*         /*                                                         */
*         /* VERIFY THAT SPECIFIED CPU IS CONFIGURED INTO THE SYSTEM */
*         /* AND IS CAPABLE OF OPERATING THE CRH                     */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0219
*         RFY                                                      0219
*          (R14,                                                   0219
*           R15) RSTD;              /* RESTRICT REGS 14,15   @Y30CQXA*/
*         R14=HEXCPUAD;             /* PICK UP CPU ADDRESS   @Y30CQXA*/
*                                                                  0220
         SLR   R14,R14                                             0220
         ICM   R14,3,HEXCPUAD                                      0220
*         /***********************************************************/
*         /*                                                         */
*         /* ISSUE SIGP SENSE TO SUBJECT CPU                         */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0221
*         GEN(SIGP  R15,R14,1(0));  /* SIGP SENSE            @Y30CQXA*/
*                                                                  0221
         SIGP  R15,R14,1(0)
*         /***********************************************************/
*         /*                                                         */
*         /* ERROR IF CONDITION CODE 3 IS RECEIVED                   */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0222
*         BC(1,REJCC3);             /* CONDITION CODE 3      @Y30CQXA*/
*                                                                  0222
         BC    1,REJCC3                                            0222
*         /***********************************************************/
*         /*                                                         */
*         /* CHECK IF PCCA EXISTS FOR SUBJECT CPU                    */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0223
*         IF PCCAT00P(HEXCPUAD+1)=0 THEN/* PCCA EXIST?       @Y30CQXA*/
         SLR   @06,@06                                             0223
         ICM   @06,3,HEXCPUAD                                      0223
         SLA   @06,2                                               0223
         L     @04,CVTPTR                                          0223
         L     @04,CVTPCCAT(,@04)                                  0223
         L     @06,PCCAT00P(@06,@04)                               0223
         LTR   @06,@06                                             0223
         BNZ   @RF00223                                            0223
*           DO;                     /*                       @Y30CQXA*/
*                                                                  0224
*             /*******************************************************/
*             /*                                                     */
*             /* PCCA DOES NOT EXIST. IF THIS IS A OFFLINE COMMAND   */
*             /* THEN SET CHANNEL OFFLINE ALREADY FLAG FOR CLEANUP   */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0225
*             IF ONLINE^='1'B THEN  /* OFFLINE COMMAND?      @Y30CQXA*/
         TM    ONLINE,B'00100000'                                  0225
         BO    @RF00225                                            0225
*               DO;                 /*                       @Y30CQXA*/
*                                                                  0226
*                 /***************************************************/
*                 /*                                                 */
*                 /* VARY OFFLINE COMMAND, AND A PCCA DOES NOT EXIST.*/
*                 /* SET CHANNEL OFFLINE FLAG AND EXIT TO CLEANUP    */
*                 /*                                                 */
*                 /***************************************************/
*                                                                  0227
*                 CRHNCHN='1'B;     /*                       @Y30CQXA*/
         OI    CRHNCHN,B'00100000'                                 0227
*                 GOTO SYNTEXIT;    /* EXIT                  @Y30CQXA*/
         B     SYNTEXIT                                            0228
*               END;                /* END OF NO PCCA OFFLINE      0229
*                                      PROCESSING            @Y30CQXA*/
*                                                                  0229
*             /*******************************************************/
*             /*                                                     */
*             /* PCCA DOES NOT EXIST AND THIS IS A VARY ONLINE       */
*             /* COMMAND SET FLAG THAT PCCA IS NEEDED                */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0230
*             NOPCCA='1'B;          /* SET NO PCCA FLAG      @Y30CQXA*/
@RF00225 OI    NOPCCA,B'00100000'                                  0230
*           END;                    /* END OF NO PCCA PROCESSING   0231
*                                                            @Y30CQXA*/
*                                                                  0231
*         /***********************************************************/
*         /*                                                         */
*         /* THIS IS A VARY CHANNEL COMMAND FOR A CHANNEL ON A       */
*         /* OFFLINE 168 MP CPU WITH SYSTEM GENED FOR CHANNEL        */
*         /* RECONFIGURATION HARDWARE SUPPORT. SET CRH FOOTPRINT     */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0232
*         CRH='1'B;                 /* SET CRH FLAG          @Y30CQXA*/
@RF00223 OI    CRH,B'00000010'                                     0232
*         GOTO SYNTEXIT;            /* GO EXIT               @Y30CQXA*/
*                                                                  0233
         B     SYNTEXIT                                            0233
*         /***********************************************************/
*         /*                                                         */
*         /* EXIT FOR REJECT COMMAND FOR OFFLINE CPU                 */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0234
*REJOFF:                            /*                       @Y30CQXA*/
*                                                                  0234
*         /***********************************************************/
*         /*                                                         */
*         /* SET ERROR FLAG FOR COMMAND                              */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0234
*         CHCPUOFF='1'B;            /* SET ERROR FLAG        @Y30CQXA*/
REJOFF   OI    CHCPUOFF,B'00001000'                                0234
*         GOTO SYNTEXIT;            /* GO EXIT               @Y30CQXA*/
*                                                                  0235
         B     SYNTEXIT                                            0235
*         /***********************************************************/
*         /*                                                         */
*         /* EXIT FOR REJECT COMMAND FOR NONEXISTANT CPU             */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0236
*REJCC3:                            /*                       @Y30CQXA*/
*         CRHNCPU='1'B;             /* SET UNRESPONSIVE FLAG @Y30CQXA*/
REJCC3   OI    CRHNCPU,B'01000000'                                 0236
*         GOTO SYNTEXIT;            /* GO EXIT               @Y30CQXA*/
         B     SYNTEXIT                                            0237
*       END;                        /* END OF OFFLINE CPU PROCESSING
*                                      FOR VARY CHANNEL              */
*SYNTEXIT:                                                         0239
*   END;                            /* END OF SYNTAX CHECK           */
@RF00211 DS    0H                                                  0239
SYNTEXIT DS    0H                                                  0240
*                                                                  0240
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR ANY ERROR FROM SYNTAX CHECK ROUTINE                 */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0240
*   IF ERRORIND^=0 THEN             /* ANY ERRORS?                   */
         ICM   @06,15,ERRORIND                                     0240
         BNZ   @RT00240                                            0240
*     GOTO MAINEXIT;                /* GO CLEAN UP                   */
*   RFY                                                            0242
*    (RETCODE) UNRSTD;              /* RELEASE REG 15                */
*                                                                  0242
*   /*****************************************************************/
*   /*                                                               */
*   /* FIX PAGES OF PROCESSOR MODULE DURING ENTIRE PROCESSING PAGES  */
*   /* MUST BE FIXED WHILE HOLDING DISPATCHER LOCK AND RESTART       */
*   /* RESOURCE                                                      */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0243
*   RFY                                                            0243
*    (R7,                                                          0243
*     R10,                                                         0243
*     R11) RSTD;                    /* RESTRICT REGS FOR PAGEFIX     */
*   R10=ADDR(IEEVWKUP);             /* LOAD MODULE START ADDRESS FOR
*                                      FIX                           */
         L     R10,@CV03520                                        0244
*   R11=ADDR(IEECLEAN);             /* CSECT END ADDRESS FOR FIX     */
         L     R11,@CV03522                                        0245
*   CALL PAGEFIX;                   /* FIX MODULE PAGES              */
*                                                                  0246
         BAL   @14,PAGEFIX                                         0246
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR ANY ERROR FROM PAGEFIX ROUTINE                      */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0247
*   IF ERRORIND^=0 THEN             /* ANY ERROR?                    */
         ICM   @06,15,ERRORIND                                     0247
         BNZ   @RT00247                                            0247
*     GOTO MAINEXIT;                /* EXIT                          */
*                                                                  0248
*   /*****************************************************************/
*   /*                                                               */
*   /* FIX DYNAMIC WORK AREA ALSO. REG 7 POINTS TO BEGINNING OF WORK */
*   /* AREA                                                          */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0249
*   R10=R7;                         /* COPY WORK AREA ADDRESS INTO 0249
*                                      PARM REG                      */
         LR    R10,R7                                              0249
*   R11=R10+@SIZDATD;               /* ADD LENGTH OF WORK AREA       */
         LR    R11,R10                                             0250
         AL    R11,@SIZDATD                                        0250
*   DATAEND=R11;                    /* SAVE ADDRESS FOR FREE         */
         ST    R11,DATAEND                                         0251
*   CALL PAGEFIX;                   /* FIX PAGES                     */
*                                                                  0252
         BAL   @14,PAGEFIX                                         0252
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR ANY ERROR FROM PAGEFIX ROUTINE                      */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0253
*   IF ERRORIND^=0 THEN             /* ANY ERROR?                    */
         ICM   @06,15,ERRORIND                                     0253
         BNZ   @RT00253                                            0253
*     GOTO MAINEXIT;                /* EXIT                          */
*                                                                  0254
*   /*****************************************************************/
*   /*                                                               */
*   /* SAVE STATUS OF SYSTEM AS IT NOW EXISTS. IF SYSTEM STATUS      */
*   /* CHANGES DURING PROCESSING THEN BACK OUT                       */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0255
*   RFY                                                            0255
*    (R7,                                                          0255
*     R10,                                                         0255
*     R11) UNRSTD;                  /* RELEASE REGISTERS FOR USE     */
*   SYSSTAT=CSDCPUAL;               /* COPY ALIVE MASK               */
         L     @06,CVTPTR                                          0256
         L     @06,CVTCSD(,@06)                                    0256
         MVC   SYSSTAT(2),CSDCPUAL(@06)                            0256
*   PROCSTRT='1'B;                  /* SET ONLINE/OFFLINE PROCESSING
*                                      STARTED               @ZA24473*/
*                                                                  0257
         OI    PROCSTRT,B'00000010'                                0257
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK IF ONLINE OR OFFLINE COMMAND                            */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0258
*   IF ONLINE^='1'B THEN            /* VARY OFFLINE ?                */
         TM    ONLINE,B'00100000'                                  0258
         BO    @RF00258                                            0258
*     CALL OFFLINE;                 /* PERFORM OFFLINE PROCESSING    */
*                                                                  0259
         BAL   @14,OFFLINE                                         0259
*   /*****************************************************************/
*   /*                                                               */
*   /* WAS NOT OFFLINE COMMAND. MUST THEN BE ONLINE                  */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0260
*   ELSE                                                           0260
*     CALL ONLINEP;                 /* PERFORM ONLINE PROCESSING     */
*                                                                  0260
         B     @RC00258                                            0260
@RF00258 BAL   @14,ONLINEP                                         0260
*   /*****************************************************************/
*   /*                                                               */
*   /* ALL PROCESSING HAS BEEN PERFORMED CALL CLEANUP                */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0261
*MAINEXIT:                          /* TO BE USED AFTER ESTAE HAS  0261
*                                      BEEN ESTABLISHED              */
*   GEN(ESTAE 0);                   /* DELETE ESTAE ENVIRONMENT      */
@RC00258 DS    0H                                                  0261
MAINEXIT ESTAE 0
*MAINEXT:                           /* TO BE USED BEFORE ESTAE HAS 0262
*                                      BEEN ESTABLISHED              */
*   CALL IEECLEAN(ADDR(WORKAREA));                                 0262
*                                                                  0262
MAINEXT  LA    @12,WORKAREA                                        0262
         ST    @12,@TF00001                                        0262
         LA    @12,@TF00001                                        0262
         ST    @12,@AL00001                                        0262
         L     @15,@CV03522                                        0262
         LA    @01,@AL00001                                        0262
         BALR  @14,@15                                             0262
*   /*****************************************************************/
*   /*                                                               */
*   /* RESTORE REG 14 THAT WAS SAVED AT ENTRY AND RETURN             */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0263
*   RFY                                                            0263
*    (R14) RSTD;                    /* RESTRICT REG                  */
*   R14=RETADD;                     /* RELOAD SAVED REGISTER         */
         L     R14,RETADD                                          0264
*   RETURN;                         /* RETURN TO MASTER SCHED.       */
@EL00001 L     @13,4(,@13)                                         0265
@EF00001 L     @00,@SIZDATD                                        0265
         LR    @01,@07                                             0265
         FREEMAIN R,LV=(0),A=(1)
@ER00001 BR    @14                                                 0265
*OFFLINE:                                                          0266
*   PROC;                                                          0266
*                                                                  0266
OFFLINE  STM   @14,@12,@SA00002                                    0266
*/****** OFFLINE *************************************************** */
*/* OFFLINE ROUTINE WILL ROUTE CONTROL TO ALL ROUTINES INVOLVED IN   */
*/* OFFLINE PROCESSING. ANY ERROR INCURED BY LOWER LEVEL ROUTINES    */
*/* WILL BE PERCOLATED UP TO OFFLINE WHICH WILL INTURN RETURN CONTROL*/
*/* TO MAINLINE                                                      */
*/********************************************************************/
*                                                                  0267
*   DO;                                                            0267
*                                                                  0267
*     /***************************************************************/
*     /*                                                             */
*     /* CHECK FOR CHANNEL OR CPU COMMAND                            */
*     /*                                                             */
*     /***************************************************************/
*                                                                  0268
*     IF CHNIND='1'B THEN           /* CHANNEL COMMAND?              */
         TM    CHNIND,B'10000000'                                  0268
         BNO   @RF00268                                            0268
*       DO;                                                        0269
*                                                                  0269
*/******* CHKCHNL ************************************************** */
*/* CHKCHNL WILL VERIFY ONLINE/OFFLINE STATUS OF A SPECIFIED CHANNEL */
*/* ROUTINE WILL USE HEXCPUAD TO LOCATE THE PROPER CAT TABLE AND     */
*/* WILL USE HEXCHNAD TO INDEX TO THE PROPER ENTRY WITHIN THE CAT    */
*/* TABLE.                                                           */
*/* POSSIBLE ERROR INDICATORS ARE: OFFALRDY                          */
*/****************************************************************** */
*                                                                  0270
*         DO;                                                      0270
*                                                                  0270
*           /*********************************************************/
*           /*                                                       */
*           /* INDEX INTO PCCA VECTOR TABLE TO LOCATE PCCA ADDRESS   */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0271
*           PCCAPTR=PCCAT00P(HEXCPUAD+1);/* GET PCCA ADDRESS FROM  0271
*                                      TABLE                         */
*                                                                  0271
         SLR   @12,@12                                             0271
         ICM   @12,3,HEXCPUAD                                      0271
         SLA   @12,2                                               0271
         L     @11,CVTPTR                                          0271
         L     @11,CVTPCCAT(,@11)                                  0271
         L     @12,PCCAT00P(@12,@11)                               0271
         ST    @12,PCCAPTR                                         0271
*           /*********************************************************/
*           /*                                                       */
*           /* GET ADDRESSABILITY TO CAT TABLE ENTRY                 */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0272
*           CATPTR=ADDR(PCCACAT)+(8*HEXCHNAD);/* LOCATE CHANNEL ENTRY*/
         LA    CATPTR,PCCACAT(,@12)                                0272
         SLR   @12,@12                                             0272
         ICM   @12,3,HEXCHNAD                                      0272
         SLA   @12,3                                               0272
         ALR   CATPTR,@12                                          0272
*           IF CATNOP='1'B THEN     /* IS CHANNEL OFFLINE            */
         TM    CATNOP(CATPTR),B'01000000'                          0273
         BNO   @RF00273                                            0273
*             OFFALRDY='1'B;        /* IF YES SET INDICATOR          */
         OI    OFFALRDY,B'00100000'                                0274
*         END;                      /* END OF CHKCHNL                */
*                                                                  0275
@RF00273 DS    0H                                                  0276
*         /***********************************************************/
*         /*                                                         */
*         /* CHECK FOR ANY ERROR FROM CHKCHNL                        */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0276
*         IF ERRORIND^=0 THEN       /* ANY ERRORS                    */
         ICM   @12,15,ERRORIND                                     0276
         BNZ   @RT00276                                            0276
*           GOTO OFFEXIT;           /* RETURN TO MAINLINE            */
*       END;                                                       0278
*                                                                  0278
*     /***************************************************************/
*     /*                                                             */
*     /* WAS NOT A VARY CHANNEL COMMAND. MUST THEN BE A VARY CPU     */
*     /* COMMAND                                                     */
*     /*                                                             */
*     /***************************************************************/
*                                                                  0279
*     ELSE                                                         0279
*                                                                  0279
*       /*************************************************************/
*       /*                                                           */
*       /* WAS A VARY CPU COMMAND THEN                               */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0279
*       DO;                                                        0279
*                                                                  0279
         B     @RC00268                                            0279
@RF00268 DS    0H                                                  0280
*/******* CPUSRCH ****************************************************/
*/* CPUSRCH WILL CHECK TO DETERMINE IF THE REQUESTED CPU IS ALREADY  */
*/* OFFLINE AND VERIFY THAT AT LEAST ONE OTHER CPU EXISTS FOR JOB    */
*/* SCHEDULING. THE CSDCPUAL MASK AND CSDCPUJS MASKS WILL BE COMPARED*/
*/* WITH CPUMSK FOR THE TESTS.                                       */
*/* POSSIBLE ERROR INDICATORS ARE: OFFALRDY AND LASTCPU              */
*/********************************************************************/
*                                                                  0280
*         DO;                                                      0280
*                                                                  0280
*           /*********************************************************/
*           /*                                                       */
*           /* CHECK IF THE CPU IS OFFLINE ALREADY                   */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0281
*           IF(CSDCPUAL&CPUMSK)=0 THEN/* IF BIT REPRESENTING THIS CPU
*                                      IS ZERO THEN RESULT WILL BE 0281
*                                      ZERO                          */
         L     @12,CVTPTR                                          0281
         L     @12,CVTCSD(,@12)                                    0281
         SLR   @06,@06                                             0281
         ICM   @06,3,CPUMSK                                        0281
         SLR   @04,@04                                             0281
         ICM   @04,3,CSDCPUAL(@12)                                 0281
         NR    @06,@04                                             0281
         LTR   @06,@06                                             0281
         BNZ   @RF00281                                            0281
*             OFFALRDY='1'B;        /* SET OFFALREADY INDICATOR      */
*                                                                  0282
         OI    OFFALRDY,B'00100000'                                0282
*           /*********************************************************/
*           /*                                                       */
*           /* CHECK IF OTHER CPU'S EXIST FOR SCHEDULING JOBS        */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0283
*           IF(CSDCPUJS&&CPUMSK)=0 THEN/* BITS OTHER THAN THE ONE  0283
*                                      REPRESENTING THIS CPU MUST BE
*                                      SET ELSE RESULT IS ZERO       */
@RF00281 L     @12,CVTPTR                                          0283
         L     @12,CVTCSD(,@12)                                    0283
         SLR   @06,@06                                             0283
         ICM   @06,3,CPUMSK                                        0283
         SLR   @04,@04                                             0283
         ICM   @04,3,CSDCPUJS(@12)                                 0283
         XR    @06,@04                                             0283
         LTR   @06,@06                                             0283
         BNZ   @RF00283                                            0283
*             LASTCPU='1'B;         /* SET LAST CPU INDICATOR        */
         OI    LASTCPU,B'00010000'                                 0284
*         END;                      /* END OF CPU SRCH               */
*                                                                  0285
@RF00283 DS    0H                                                  0286
*         /***********************************************************/
*         /*                                                         */
*         /* CHECK FOR ANY ERRORS                                    */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0286
*         IF ERRORIND^=0 THEN       /* ANY ERRORS?                   */
         ICM   @12,15,ERRORIND                                     0286
         BNZ   @RT00286                                            0286
*           GOTO OFFEXIT;           /* RETURN TO MAINLINE            */
*/******* AFFINSRC ************************************************* */
*/* AFFINSRC WILL SCAN THROUGH THE ADDRESS SPACE VECTOR TABLE SEARCH-*/
*/* ING FOR ALL ACTIVE ASCBS. ALL ACTIVE ASCB'S WILL BE CHECKED FOR  */
*/* AFFINITY TO THE CPU TO GO OFFLINE. A COUNT WILL BE KEPT OF ALL   */
*/* JOBS FOUND WITH AFFINITY AND THE OPERATOR WILL BE GIVEN THE      */
*/* OPPORTUNITY OF CANCELING THE OFFLINE COMMAND OR LEAVING THE CPU  */
*/* UNAVAILABLE FOR SCHEDULING ANY NEW JOBS TO THE SPECIFIED CPU     */
*/* POSSIBLE ERROR INDICATORS ARE: AFFINSW                           */
*/****************************************************************   */
*                                                                  0288
*         DO;                                                      0288
*                                                                  0288
*           /*********************************************************/
*           /*                                                       */
*           /* OBTAIN JOB SCHEDULING RESOURCE                        */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0289
*           GEN(ENQ (JOBSCDQ,JOBSCDR,E,8,SYSTEM));/* ENQ ON JOB SCHED
*                                      RESOURCE                      */
         ENQ (JOBSCDQ,JOBSCDR,E,8,SYSTEM)
*           CSDENQ='1'B;            /* SET ENQ FOOTPRINT             */
         OI    CSDENQ,B'00001000'                                  0290
*           JOBSHED='1'B;           /* SET ENQ FOOTPRINT             */
*                                                                  0291
         OI    JOBSHED,B'00000001'                                 0291
*           /*********************************************************/
*           /*                                                       */
*           /* RESET JOB SCHEDULER BIT REPRESENTING CPU TO BE REMOVED*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  0292
*           CSDCPUJS=CSDCPUJS&      /* CPUJS(I) = 0          @G47AN2O*/
*               (CPUMSK&&FLIP);     /*                       @G47AN2O*/
*                                                                  0292
         L     @12,CVTPTR                                          0292
         L     @12,CVTCSD(,@12)                                    0292
         SLR   @06,@06                                             0292
         ICM   @06,3,CPUMSK                                        0292
         X     @06,@CF03528                                        0292
         SLR   @04,@04                                             0292
         ICM   @04,3,CSDCPUJS(@12)                                 0292
         NR    @06,@04                                             0292
         STH   @06,CSDCPUJS(,@12)                                  0292
*           /*********************************************************/
*           /*                                                       */
*           /* GET DISPATCHER LOCK TO PREVENT ASCB'S FROM CHANGING   */
*           /* DURING OUR SCAN                                       */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0293
*           GENERATE;                                              0293
*                                                                  0293
   SETLOCK    OBTAIN,TYPE=DISP,REGS=USE,MODE=UNCOND,RELATED=('IEEVCPU,XX
               AFFINSRC, LOCK IS RELEASED IN THIS ROUTINE')
*           /*********************************************************/
*           /*                                                       */
*           /* SET UP DO LOOP TO SCAN THROUGH ASVT TABLE SEARCHING   */
*           /* ALL ASCBS                                             */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0294
*           DO LOOPCNT=1 TO ASVTMAXU;/* SCAN THROUGH VECTOR TABLE    */
         LA    @12,1                                               0294
         B     @DE00294                                            0294
@DL00294 DS    0H                                                  0295
*             ASCBPTR=ASVTENTY(LOOPCNT);/* ADDRESSABILITY TO ASCB    */
*                                                                  0295
         SLA   @12,2                                               0295
         L     @06,CVTPTR                                          0295
         L     @04,ASVTPTR(,@06)                                   0295
         L     ASCBPTR,ASVTENTY-4(@12,@04)                         0295
*             /*******************************************************/
*             /*                                                     */
*             /* VERIFY THAT THIS ADDRESS SPACE EXISTS AND IS IN USE */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0296
*             IF ASVTAVAL(LOOPCNT)='0'B&ASCBPTR^=0 THEN/* VALID    0296
*                                      ENTRY?                        */
*                                                                  0296
         ALR   @04,@12                                             0296
         TM    ASVTAVAL-4(@04),B'10000000'                         0296
         BNZ   @RF00296                                            0296
         SLR   @12,@12                                             0296
         CR    ASCBPTR,@12                                         0296
         BE    @RF00296                                            0296
*               /*****************************************************/
*               /*                                                   */
*               /* CHECK IF OTHER CPU'S EXIST THAT CAN PERFORM WORK  */
*               /* IN THIS ADDRESS SPACE. IF NOT THEN INCREMENT      */
*               /* AFFINJOB COUNT AND SET ERROR FLAG                 */
*               /*                                                   */
*               /*****************************************************/
*                                                                  0297
*               IF(ASCBAFFN&CSDCPUJS)=0 THEN/* IS THIS THE ONLY CPU? */
         L     @06,CVTCSD(,@06)                                    0297
         SLR   @04,@04                                             0297
         ICM   @04,3,CSDCPUJS(@06)                                 0297
         SLR   @06,@06                                             0297
         ICM   @06,3,ASCBAFFN(ASCBPTR)                             0297
         NR    @04,@06                                             0297
         CR    @04,@12                                             0297
         BNE   @RF00297                                            0297
*                 DO;                                              0298
*                   AFFINSWT='1'B;  /* SET AFFINITY SWITCH           */
         OI    AFFINSWT,B'00001000'                                0299
*                   AFFINJOB=EVAL(AFFINJOB+1);/* INCR COUNT OF     0300
*                                      AFFINITY JOBS                 */
         LA    @12,1                                               0300
         SLR   @06,@06                                             0300
         ICM   @06,3,AFFINJOB                                      0300
         ALR   @12,@06                                             0300
         STH   @12,AFFINJOB                                        0300
*                 END;                                             0301
*           END;                    /* END OF ASCB SCAN DO LOOP      */
@RF00297 DS    0H                                                  0302
@RF00296 LA    @12,1                                               0302
         AL    @12,LOOPCNT                                         0302
@DE00294 ST    @12,LOOPCNT                                         0302
         L     @06,CVTPTR                                          0302
         L     @06,ASVTPTR(,@06)                                   0302
         C     @12,ASVTMAXU(,@06)                                  0302
         BNH   @DL00294                                            0302
*           GEN                                                    0303
*(SETLOCK  RELEASE,TYPE=DISP,REGS=USE,RELATED=(IEEVCPU,AFFIN));    0303
         SETLOCK  RELEASE,TYPE=DISP,REGS=USE,RELATED=(IEEVCPU,AFFIN)
*           IF AFFINSWT='1'B THEN   /* ANY JOBS FOUND WITH AFFINITY? */
         TM    AFFINSWT,B'00001000'                                0304
         BNO   @RF00304                                            0304
*             DO;                                                  0305
*                                                                  0305
*               /*****************************************************/
*               /*                                                   */
*               /* JOBS HAVE BEEN FOUND WITH AFFINITY. ALLOW JOB     */
*               /* SCHEDULING AND INFORM OPERATOR OF CONDITION.      */
*               /* OPERATOR WILL BE GIVEN THE OPPORTUNITY TO EITHER  */
*               /* TERMINATE THE COMMAND, OR MARK CPU UNAVAILABLE FOR*/
*               /* FURTHER JOB SCHEDULING                            */
*               /*                                                   */
*               /*****************************************************/
*                                                                  0306
*               CSDCPUJS=CSDCPUJS×CPUMSK;/* CPUJS(I) = 1     @G47AN2O*/
         L     @12,CVTPTR                                          0306
         L     @12,CVTCSD(,@12)                                    0306
         SLR   @06,@06                                             0306
         ICM   @06,3,CPUMSK                                        0306
         SLR   @04,@04                                             0306
         ICM   @04,3,CSDCPUJS(@12)                                 0306
         OR    @06,@04                                             0306
         STH   @06,CSDCPUJS(,@12)                                  0306
*               GEN(DEQ  (JOBSCDQ,JOBSCDR,8,SYSTEM));/* RELEASE ENQ
*                                      TO ALLOW JOB SCHEDULING       */
         DEQ  (JOBSCDQ,JOBSCDR,8,SYSTEM)
*               CSDENQ='0'B;        /* RESET FOOTPRINT               */
         NI    CSDENQ,B'11110111'                                  0308
*               RFY                                                0309
*                (R6) RSTD;         /* RESTRICT REG 6                */
*               R6=ADDR(WORKAREA);  /* ADDRESSABILITY FOR COMMON WORK
*                                      AREA                          */
         LA    R6,WORKAREA                                         0310
*               CALL WTORT(1);      /* WRITE AFFINITY FOUND MESSAGE  */
         L     @15,@CV03525                                        0311
         LA    @01,@AL00311                                        0311
         BALR  @14,@15                                             0311
*               RFY                                                0312
*                (R6) UNRSTD;       /* RELEASE REG 6                 */
*AFFREPLY:                          /* ISSUE WTOR FOR OPERATOR REPLY */
*               WTOECB=0;           /* ZERO OUT ECB                  */
AFFREPLY SLR   @12,@12                                             0313
         ST    @12,WTOECB                                          0313
*               REPLY='';           /* BLANK OUT REPLY BUFFER        */
         MVI   REPLY,C' '                                          0314
         MVC   REPLY+1(7),REPLY                                    0314
*               WTORPL1=WTOR1;      /* COPY PARMS INTO PARM LIST     */
         MVC   WTORPL1(85),WTOR1                                   0315
*               GEN(WTOR  ,REPLY,,WTOECB,MF=(E,WTORPL1));/* WTOR     */
*                                                                  0316
         WTOR  ,REPLY,,WTOECB,MF=(E,WTORPL1)
*               /*****************************************************/
*               /*                                                   */
*               /* WAIT ON REPLY FROM OPERATOR                       */
*               /*                                                   */
*               /*****************************************************/
*                                                                  0317
*               GEN(WAIT  ECB=WTOECB);/* WAIT FOR REPLY              */
*                                                                  0317
         WAIT  ECB=WTOECB
*               /*****************************************************/
*               /*                                                   */
*               /* CHECK OPERATORS RESPONSE. IF INVALID REISSUE WTOR,*/
*               /* IF OPERATOR REPLY IS YES THEN MARK CPU UNAVAILABLE*/
*               /* IN CSD, ELSE SET REPLY PROCESSED FLAG AND RETURN  */
*               /* TO NEXT HIGHER LEVEL OF CONTROL                   */
*               /*                                                   */
*               /*****************************************************/
*                                                                  0318
*               IF REPLY^='YES'&REPLY^='NO ' THEN/* VALID REPLY?     */
         CLC   REPLY(3),@CC03639                                   0318
         BE    @RF00318                                            0318
         CLC   REPLY(3),@CC03640                                   0318
         BNE   @RT00318                                            0318
*                 GOTO AFFREPLY;    /* REISSUE WTOR                  */
*                                                                  0319
*               /*****************************************************/
*               /*                                                   */
*               /* REPLY IS VALID CHECK FOR RESPONSE                 */
*               /*                                                   */
*               /*****************************************************/
*                                                                  0320
*               IF REPLY='NO' THEN  /* CANCEL COMMAND                */
@RF00318 CLC   REPLY(2),@CC03641                                   0320
         BNE   @RF00320                                            0320
*                 DO;                                              0321
*                   OPERCNCL='1'B;  /* SET OPERATOR CANCEL FLAG      */
         OI    OPERCNCL,B'00100000'                                0322
*                   REPLYP='1'B;    /* SET REPLY PROCESSED FLAG      */
         OI    REPLYP,B'00010000'                                  0323
*                 END;                                             0324
*                                                                  0324
*               /*****************************************************/
*               /*                                                   */
*               /* OPERATOR REPLY WAS NOT 'NO' MUST HAVE BEEN 'YES'  */
*               /* THEN                                              */
*               /*                                                   */
*               /*****************************************************/
*                                                                  0325
*               ELSE                                               0325
*                 DO;                                              0325
*                                                                  0325
         B     @RC00320                                            0325
@RF00320 DS    0H                                                  0326
*                   /*************************************************/
*                   /*                                               */
*                   /* SET CPU UNAVAILABLE FOR FURTHER JOB SCHEDULING*/
*                   /*                                               */
*                   /*************************************************/
*                                                                  0326
*                   GEN(ENQ (JOBSCDQ,JOBSCDR,E,8,SYSTEM));/* ENQ ON
*                                      JOB SCHED                     */
         ENQ (JOBSCDQ,JOBSCDR,E,8,SYSTEM)
*                   CSDENQ='1'B;    /* SET FOOTPRINT                 */
         OI    CSDENQ,B'00001000'                                  0327
*                   CSDCPUJS=CSDCPUJS&/* CPUJS(I) = 0        @G47AN2O*/
*                       (CPUMSK&&FLIP);/*                    @G47AN2O*/
         L     @12,CVTPTR                                          0328
         L     @12,CVTCSD(,@12)                                    0328
         SLR   @06,@06                                             0328
         ICM   @06,3,CPUMSK                                        0328
         X     @06,@CF03528                                        0328
         SLR   @04,@04                                             0328
         ICM   @04,3,CSDCPUJS(@12)                                 0328
         NR    @06,@04                                             0328
         STH   @06,CSDCPUJS(,@12)                                  0328
*                   GEN(DEQ (JOBSCDQ,JOBSCDR,8,SYSTEM));/* RELEASE 0329
*                                      RESOURCE                      */
         DEQ (JOBSCDQ,JOBSCDR,8,SYSTEM)
*                   CSDENQ='0'B;    /* RESET FOOTPRINT               */
         NI    CSDENQ,B'11110111'                                  0330
*                   REPLYP='1'B;    /* SET REPLY PROCESSED BIT       */
         OI    REPLYP,B'00010000'                                  0331
*                 END;                                             0332
*             END;                  /* END OF OPERATOR REPLY ROUTINE */
*                                                                  0333
*           /*********************************************************/
*           /*                                                       */
*           /* NO JOBS WERE FOUND WITH AFFINITY. RELEASE ENQ AND     */
*           /* CONTINUE PROCESSING                                   */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0334
*           ELSE                                                   0334
*             GEN(DEQ  (JOBSCDQ,JOBSCDR,8,SYSTEM));/* RELEASE      0334
*                                      RESOURCE                      */
         B     @RC00304                                            0334
@RF00304 DS    0H                                                  0334
         DEQ  (JOBSCDQ,JOBSCDR,8,SYSTEM)
*           CSDENQ='0'B;            /* RESET FOOTPRINT               */
@RC00304 NI    CSDENQ,B'11110111'                                  0335
*AFINEXIT:                                                         0336
*         END;                      /* END OF AFFINITY SCAN ROUTINE  */
AFINEXIT DS    0H                                                  0337
*         IF ERRORIND^=0 THEN       /* ANY ERRORS?                   */
         ICM   @12,15,ERRORIND                                     0337
         BNZ   @RT00337                                            0337
*           GOTO OFFEXIT;           /* RETURN TO MAINLINE            */
*       END;                        /* END OF SPECIAL CPU PROCESSING */
*     IF CPUCRH^='1'B THEN                                         0340
*                                                                  0340
@RC00268 TM    CPUCRH,B'00000001'                                  0340
         BO    @RF00340                                            0340
*       /*************************************************************/
*       /*                                                           */
*       /* SCAN SYSTEM DEVICES TO DETERMINE WHICH DEVICES SHOULD BE  */
*       /* TAKEN OFFLINE WITH THE CPU OR CHANNEL                     */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0341
*       IF PCCAT00P(HEXCPUAD+1)->   /* PCCA FOR THIS CPU     @G47AN2O*/
*           PCCAIO=HASIO            /* CPU HAS CHANNELS      @G47AN2O
*                                      ONLINE                @G47AN2O*/
*         THEN                      /* PERFORM DEVPREP FCN   @G47AN2O*/
         SLR   @12,@12                                             0341
         ICM   @12,3,HEXCPUAD                                      0341
         SLA   @12,2                                               0341
         L     @06,CVTPTR                                          0341
         L     @06,CVTPCCAT(,@06)                                  0341
         L     @12,PCCAT00P(@12,@06)                               0341
         TM    PCCAIO(@12),B'01000000'                             0341
         BNO   @RF00341                                            0341
*/**** DEVPREP ***************************************************** */
*/* DEVPREP WILL SCAN ALL UCB'S IN THE SYSTEM TO DETERMINE WHICH     */
*/* DEVICES WILL BE AFFECTED BY A CHANGE OF ONLINE TO OFFLINE STATUS */
*/* OF A CHANNEL OR CPU. ANY DEVICES THAT WILL BE AFFECTED WILL BE   */
*/* INTERROGATED FOR ONLINE/ALLOCATED/NALLOC/OR CONSOLE STATUS       */
*/* A RECORDER BLOCK WILL BE BUILT FOR ANY DEVICE THAT MAY BE        */
*/* AFFECTED. ANY ERRORS ENCOUNTERED WILL CAUSE THE SCAN TO BE       */
*/* TERMINATED AND CONTROL RETURNED TO THE NEXT HIGHER LEVEL OF      */
*/* CONTROL.                                                         */
*/* POSSIBLE ERROR INDICATORS THAT MAY BE SET IN DEVPREP ARE:        */
*/* LASTPATH, NOCORE                                                 */
*/********************************************************************/
*                                                                  0342
*         DO;                                                      0342
*ENQLOOP:                                                          0343
*                                                                  0343
*           /*********************************************************/
*           /*                                                       */
*           /* ENQ EXCLUSIVE WITH ECB. ATTEMPT ENQ AND IF            */
*           /* UNSUCCESSFUL WAIT 5 SECONDS, IF RESOURCE HAS NOT BEEN */
*           /* OBTAINED AFTER 5 SECONDS THEN RELEASE ENQ TO ALLOW    */
*           /* SHARED REQUESTS TO BE SATISIFIED AND ATTEMPT ENQ AGAIN*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  0343
*           RFY                                                    0343
*            (R1,                                                  0343
*             RETCODE) RSTD;        /* RESTRICT REGISTERS            */
ENQLOOP  DS    0H                                                  0344
*           ENQECB=0;               /* ZERO OUT ECB BEFORE ENQ       */
         SLR   @12,@12                                             0344
         ST    @12,ENQECB                                          0344
*           DO;                     /* ENQ                         0345
*                                      (UCBENQQ,UCBENQR,E,2,SYSTEM)
*                                      ECB(ENQECB)                   */
*             RESPECIFY                                            0346
*              (GPR01P) RESTRICTED;                                0346
*             I056(1:16)=I056(1:16)&&I056(1:16);/* ZERO OUT THE TABLE*/
         XC    I056(16),I056                                       0347
*             I05604(1)=2;          /* LENGTH OF MINOR RESOURCE NAME */
         MVI   I05604,X'02'                                        0348
*             I05606(1)=ADDR(UCBENQQ);/* ADDRESS OF MAJOR RESOURCE 0349
*                                      NAME                          */
         LA    @12,UCBENQQ                                         0349
         ST    @12,I05606                                          0349
*             I05607(1)=ADDR(UCBENQR);/* ADDRESS OF MINOR RESOURCE 0350
*                                      NAME                          */
         LA    @12,UCBENQR                                         0350
         ST    @12,I05607                                          0350
*             I05603(1)='01000000'B;/* SET BIT STRING 1 FOR RESOURCE
*                                      ELEMENT                       */
         MVI   I05603,B'01000000'                                  0351
*             I05605(1)='01000100'B;/* SET BIT STRING 2 FOR RESOURCE
*                                      ELEMENT                       */
         MVI   I05605,B'01000100'                                  0352
*             I05601=ADDR(ENQECB);  /* ECB ADDRESS                   */
         LA    @12,ENQECB                                          0353
         ST    @12,I05601                                          0353
*             I05603(1,1)='1'B;     /* SET END OF LIST BIT           */
         OI    I05603,B'10000000'                                  0354
*             GPR01P=ADDR(I05602);  /* LOAD LIST ADDRESS             */
         LA    GPR01P,I05602                                       0355
*             SVC(56);              /* ISSUE ENQ SVC                 */
         SVC   56                                                  0356
*             RESPECIFY                                            0357
*              (GPR01P) UNRESTRICTED;                              0357
*           END;                    /* ENQ                         0358
*                                      (UCBENQQ,UCBENQR,E,2,SYSTEM)
*                                      ECB(ENQECB) ECB ENQ           */
*                                                                  0358
*           /*********************************************************/
*           /*                                                       */
*           /* CHECK RETURN CODE. IF RESOURCE HAS BEEN OBTAINED THEN */
*           /* CONTINUE PROCESSING ELSE WAIT 5 SECONDS               */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0359
*           IF RETCODE^=0 THEN      /* DID WE GET RESOURCE?          */
         LTR   RETCODE,RETCODE                                     0359
         BZ    @RF00359                                            0359
*             DO;                                                  0360
*               GEN(STIMER   WAIT,BINTVL=SEC5);/* WAIT 5 SECONDS     */
*                                                                  0361
         STIMER   WAIT,BINTVL=SEC5
*               /*****************************************************/
*               /*                                                   */
*               /* IF RESOURCE HAS NOT BEEN OBTAINED AFTER 5 SECONDS */
*               /* THEN DEQ TO ALLOW ANY SHARED REQUESTS TO BE       */
*               /* PROCESSED AND ATTEMPT ENQ AGAIN                   */
*               /*                                                   */
*               /*****************************************************/
*                                                                  0362
*               IF POSTBIT^='1'B THEN/* POST SUCCESSFUL?             */
         TM    POSTBIT,B'01000000'                                 0362
         BO    @RF00362                                            0362
*                 DO;                                              0363
*                   GEN(DEQ  (UCBENQQ,UCBENQR,2,SYSTEM));/* RELEASE
*                                      SYSTEM RESOURCE               */
         DEQ  (UCBENQQ,UCBENQR,2,SYSTEM)
*                   GOTO ENQLOOP;   /* RETRY ENQ                     */
         B     ENQLOOP                                             0365
*                 END;                                             0366
*               RFY                                                0367
*                (R1,                                              0367
*                 RETCODE) UNRSTD;                                 0367
@RF00362 DS    0H                                                  0368
*             END;                  /* END OF ENQ LOOP               */
*           UCBENQ='1'B;            /* SET ENQ FOOTPRINT             */
*                                                                  0369
@RF00359 OI    UCBENQ,B'00000010'                                  0369
*           /*********************************************************/
*           /*                                                       */
*           /* SET UP PARAMETERS FOR IEEVDEV THAT ARE COMMON FOR THIS*/
*           /* ROUTINE                                               */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0370
*           DEVSUBCP=HEXCPU1;       /* CPU ADDRESS BEING REMOVED     */
         MVC   DEVSUBCP(1),HEXCPU1                                 0370
*           DEVSUBCH=HEXCHN1;       /* CHANNEL ADDRESS BEING REMOVED */
         MVC   DEVSUBCH(1),HEXCHN1                                 0371
*           LINKPTR=ADDR(DEVSUBP);  /* SET UP POINTER TO PARAMETERS  */
*                                                                  0372
         LA    @12,DEVSUBP                                         0372
         ST    @12,LINKPTR                                         0372
*           /*********************************************************/
*           /*                                                       */
*           /* LOAD MODULE IEEVDEV AND SAVE ADDRESS FOR BRANCH ENTRY */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0373
*           GEN(LOAD  EP=IEEVDEV);  /* LOAD IEEVDEV                  */
         LOAD  EP=IEEVDEV
*           RFY                                                    0374
*            (R0) RSTD;             /* RESTRICT REG 0                */
*           DEVADDR=R0;             /* SAVE IEEVDEV ADDRESS          */
         ST    R0,DEVADDR                                          0375
*           RFY                                                    0376
*            (R0) UNRSTD;           /* RELEASE REGISTER              */
*                                                                  0376
*           /*********************************************************/
*           /*                                                       */
*           /* SET UP COMMON PARAMETER LIST FOR IECVIOPM     @ZA00078*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  0377
*           PATHFC=0;               /* SET FUNCTION CODE TO INDICATE
*                                      OPERATIONAL PATH TEST @ZA00078*/
*                                                                  0377
         MVI   PATHFC,X'00'                                        0377
*           /*********************************************************/
*           /*                                                       */
*           /* LOAD IECVIOPM AND SAVE ENTRY POINT ADDRESS    @ZA00078*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  0378
*           GEN(LOAD  EP=IECVIOPM); /* LOAD IECVIOPM         @ZA00078*/
         LOAD  EP=IECVIOPM
*           RFY                                                    0379
*             R0 RSTD;              /* RESTRICT REGISTER     @ZA00078*/
*           PATHADDR=R0;            /* SAVE IECVIOPM ADDRESS @ZA00078*/
         ST    R0,PATHADDR                                         0380
*           RFY                                                    0381
*             R0 UNRSTD;            /* RELEASE REGISTER      @ZA00078*/
*                                                                  0381
*           /*********************************************************/
*           /*                                                       */
*           /* SET UP DOLOOP TO SCAN ALL UCB'S TILL END OF LOOKUP    */
*           /* TABLE IS REACHED                                      */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0382
*           DO UCBLKPTR=CVTILK2 BY 2 WHILE(UCBTAB^='FFFF'X);       0382
*                                                                  0382
         L     @12,CVTPTR                                          0382
         L     @12,CVTILK2(,@12)                                   0382
         ST    @12,UCBLKPTR                                        0382
         B     @DE00382                                            0382
@DL00382 DS    0H                                                  0383
*             /*******************************************************/
*             /*                                                     */
*             /* CHECK FOR DUMMY TABLE ENTRY AND IF SO SKIP TO NEXT  */
*             /* ENTRY                                               */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0383
*             IF UCBTAB='0000'X THEN/* CHECK FOR DUMMY TABLE ENTRY   */
         L     @12,UCBLKPTR                                        0383
         SLR   @06,@06                                             0383
         ICM   @06,3,UCBTAB(@12)                                   0383
         LTR   @06,@06                                             0383
         BZ    @RT00383                                            0383
*               GOTO ENDLOOP;       /* SKIP PROCESSING STEP TO NEXT
*                                      ENTRY                         */
*             UCBPTR=UCBTAB;        /* PICK UP ADDRESS OF UCB        */
*                                                                  0385
         ST    @06,UCBPTR                                          0385
*             /*******************************************************/
*             /*                                                     */
*             /* IF THIS IS A 2305 AND NOT THE BASE UCB THEN SKIP TO */
*             /* NEXT ENTRY                                          */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0386
*             IF(UCBMTPXP='1'B)&(UCBBASE^=UCBPTR-512) THEN/* NOT 2305*/
         TM    UCBMTPXP(@06),B'00001000'                           0386
         BNO   @RF00386                                            0386
         LR    @12,@06                                             0386
         SH    @12,@CH01762                                        0386
         C     @12,UCBBASE(,@06)                                   0386
         BNE   @RT00386                                            0386
*               GOTO ENDLOOP;       /* SKIP TO NEXT UCB ENTRY        */
*                                                                  0387
*             /*******************************************************/
*             /*                                                     */
*             /* CHECK IF DEVICE IS ALREADY OFFLINE FOR HIER REASONS */
*             /* AND IF SO STEP TO NEXT UCB ENTRY                    */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0388
*             IF UCBVHRSN='1'B THEN /* DEVICE IS OFFLINE FOR HIERACHY*/
@RF00386 L     @12,UCBPTR                                          0388
         TM    UCBVHRSN(@12),B'00000010'                           0388
         BO    @RT00388                                            0388
*               GOTO ENDLOOP;       /* SKIP TO NEXT ENTRY            */
*                                                                  0389
*             /*******************************************************/
*             /*                                                     */
*             /* SET UP UCB ADDRESS IN IEEVDEV PARMS                 */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0390
*             DEVSUBUB=UCBPTR;      /* ADDRESS OF UCB COMMON SEGEMENT*/
*                                                                  0390
         ST    @12,DEVSUBUB                                        0390
*             /*******************************************************/
*             /*                                                     */
*             /* SET UP FUNCTION CODE FOR CHANNEL OR CPU COMMAND     */
*             /* DETERMINE IF THE SPECIFIED SYSTEM RESOURCE          */
*             /* (CHANNEL/CPU) IS INVOLVED WITH THIS DEVICE.         */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0391
*             IF CHNIND='1'B THEN   /* CHANNEL COMMAND?              */
         TM    CHNIND,B'10000000'                                  0391
         BNO   @RF00391                                            0391
*               DEVSUBFC=4;         /* SET FUNCTION CODE 4           */
*                                                                  0392
         MVI   DEVSUBFC,X'04'                                      0392
*             /*******************************************************/
*             /*                                                     */
*             /* COMMAND WAS VARY CPU                                */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0393
*             ELSE                                                 0393
*               DEVSUBFC=3;         /* SET FUNCTION CODE 3           */
         B     @RC00391                                            0393
@RF00391 MVI   DEVSUBFC,X'03'                                      0393
*             RFY                                                  0394
*              (R1,                                                0394
*               R14,                                               0394
*               R15,                                               0394
*               RETCODE) RSTD;      /* RESTRICT REGS                 */
@RC00391 DS    0H                                                  0395
*             R1=ADDR(LINKPTR);     /* POINT TO PARMS                */
         LA    R1,LINKPTR                                          0395
*             DEVSUBGO='1'B;        /* SET FOOTPRINT                 */
         OI    DEVSUBGO,B'00010000'                                0396
*             R15=DEVADDR;          /* ADDRESS OF VDEV               */
         L     R15,DEVADDR                                         0397
*             GEN(BALR R14,R15);    /* LINK TO VDEV                  */
         BALR R14,R15
*             DEVSUBGO='0'B;        /* RESET FOOTPRINT               */
*                                                                  0399
         NI    DEVSUBGO,B'11101111'                                0399
*             /*******************************************************/
*             /*                                                     */
*             /* CHECK IF DEVICE UTILITIZES THIS SYSTEM RESOURCE     */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0400
*             IF RETCODE^=0 THEN    /* OK?                           */
         LTR   RETCODE,RETCODE                                     0400
         BNZ   @RT00400                                            0400
*               GOTO ENDLOOP;       /* SKIP TO NEXT DEVICE           */
*                                                                  0401
*             /*******************************************************/
*             /*                                                     */
*             /* DEVICE USES THE SPECIFIED CPU/CHANNEL, CHECK IF WE  */
*             /* ARE REMOVING THE LAST PATH TO THE SPECIFIED DEVICE. */
*             /* BEFORE CHECKING FOR THE LAST PATH, DETERMINE IF     */
*             /* PATHS MUST BE VALIDATED.                    @ZA00078*/
*             /*                                                     */
*             /*******************************************************/
*                                                                  0402
*             IF UCBVALPH='1'B THEN /* PATHS TO DEVICE MUST BE     0402
*                                      VALIDATED             @ZA00078*/
         L     @12,UCBPTR                                          0402
         TM    UCBVALPH(@12),B'00000010'                           0402
         BNO   @RF00402                                            0402
*               IF UCBACTV='1'B THEN/* I/O ACTIVE ON DEVICE  @ZA00078*/
         TM    UCBACTV(@12),B'00000010'                            0403
         BNO   @RF00403                                            0403
*                 IF(CHNIND='1'B&   /* VARY CHANNEL COMMAND  @ZA00078*/
*                     UCBCHA=HEXCHN1&/* AND ACTIVE CHANNEL IS THE  0404
*                                      CHANNEL GOING OFFLINE @ZA00078*/
*                     UCBCPU=HEXCPU1)×/* AND ACTIVE CPU IS THE     0404
*                                      SPECIFIED CPU         @ZA00078*/
*                     (CHNIND='0'B& /* OR, VARY CPU COMMAND, @ZA00078*/
*                     UCBCPU=HEXCPU1) THEN/* AND THE ACTIVE CPU IS 0404
*                                      THE CPU GOING OFFLINE @ZA00078*/
         TM    CHNIND,B'10000000'                                  0404
         BNO   @GL00014                                            0404
         CLC   UCBCHA(1,@12),HEXCHN1                               0404
         BNE   @GL00014                                            0404
         CLC   UCBCPU(1,@12),HEXCPU1                               0404
         BE    @RT00404                                            0404
@GL00014 TM    CHNIND,B'10000000'                                  0404
         BNZ   @RF00404                                            0404
         L     @12,UCBPTR                                          0404
         CLC   UCBCPU(1,@12),HEXCPU1                               0404
         BNE   @RF00404                                            0404
@RT00404 DS    0H                                                  0405
*                   DO;             /*                       @ZA00078*/
*                                                                  0405
*                     /***********************************************/
*                     /*                                             */
*                     /* DEVICE IS A TP DEVICE - ONLY WAY A DEVICE   */
*                     /* CAN BE IN USE AND NOT HAVE BEEN VALIDATED - */
*                     /* SO PATH IN USE IS THE LAST PATH TO THE      */
*                     /* DEVICE.                             @ZA00078*/
*                     /*                                             */
*                     /***********************************************/
*                                                                  0406
*                     DDD=UCBNAME;  /* COPY DEVICE NAME      @ZA00078*/
         L     @12,UCBPTR                                          0406
         MVC   DDD(3),UCBNAME(@12)                                 0406
*                     LASTPATH='1'B;/* SET LAST PATH FLAG    @ZA00078*/
         OI    LASTPATH,B'00000010'                                0407
*                     GOTO PATHEXIT;/* RETURN TO NEXT LEVEL  @ZA00078*/
         B     PATHEXIT                                            0408
*                   END;            /*                       @ZA00078*/
*                 ELSE              /* ACTIVE I/O NOT ON SPECIFIED 0410
*                                      CHANNEL OR CPU        @ZA00078*/
*                   GOTO ENDLOOP;   /* SKIP TO NEXT DEVICE   @ZA00078*/
*               ELSE                                               0411
*                 IF UCBNALOC='1'B THEN/* DEVICE BEING USED  @ZA14998*/
@RF00403 L     @12,UCBPTR                                          0411
         TM    UCBNALOC(@12),B'00000100'                           0411
         BNO   @RF00411                                            0411
*                   DO;             /* GO TO IECVIOPM TO VALIDATE  0412
*                                      PATHS                 @ZA00078*/
*                     PATHUCB=UCBPTR;/* SUPPLY UCB ADDRESS   @ZA00078*/
         STCM  @12,7,PATHUCB                                       0413
*                     RFY                                          0414
*                      (R1,                                        0414
*                       R14,                                       0414
*                       R15) RSTD;  /* RESTRICT REGISTERS    @ZA00078*/
*                     R1=ADDR(PATHPARM);/* POINT TO PARAMETERS     0415
*                                                            @ZA00078*/
         LA    R1,PATHPARM                                         0415
*                     R15=PATHADDR; /* GET ADDRESS OF IOPM   @ZA00078*/
         L     R15,PATHADDR                                        0416
*                     GEN(BALR  R14,R15);/* LINK TO IECVIOPM @ZA00078*/
         BALR  R14,R15
*                     RFY                                          0418
*                      (R1,                                        0418
*                       R14,                                       0418
*                       R15) UNRSTD;/* RELEASE REGISTERS     @ZA00078*/
*                   END;            /* PATH VALIDATION DONE  @ZA00078*/
*             IF CHNIND='1'B THEN   /* CHANNEL OR CPU COMMAND        */
@RF00411 DS    0H                                                  0420
@RF00402 TM    CHNIND,B'10000000'                                  0420
         BNO   @RF00420                                            0420
*               DEVSUBFC=2;         /* CHANNEL LEVEL FUNCTION CODE   */
*                                                                  0421
         MVI   DEVSUBFC,X'02'                                      0421
*             /*******************************************************/
*             /*                                                     */
*             /* IS A CPU COMMAND THEN, SET CPU FUNCTION CODE        */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0422
*             ELSE                                                 0422
*               DEVSUBFC=1;         /* CPU LEVEL FUNCTION CODE       */
*                                                                  0422
         B     @RC00420                                            0422
@RF00420 MVI   DEVSUBFC,X'01'                                      0422
*             /*******************************************************/
*             /*                                                     */
*             /* SET UP LINKAGE TO PASS IEEVDEV NECESSARY PARMS FOR  */
*             /* PATH DEPENDENCY TESTS THEN LINK                     */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0423
*             R1=ADDR(LINKPTR);     /* SET UP LINKAGE FOR IEEVDEV    */
@RC00420 LA    R1,LINKPTR                                          0423
*             DEVSUBGO='1'B;        /* SET FOOTPRINT                 */
         OI    DEVSUBGO,B'00010000'                                0424
*             R15=DEVADDR;          /* ADDRESS OF IEEVDEV FOR LINK   */
         L     R15,DEVADDR                                         0425
*             GEN(BALR  R14,R15);   /* LINK TO IEEVDEV               */
         BALR  R14,R15
*             RFY                                                  0427
*              (R1,                                                0427
*               R14,                                               0427
*               R15) UNRSTD;        /* RELEASE REGISTERS             */
*             DEVSUBGO='0'B;        /* RESET FOOTPRINT               */
         NI    DEVSUBGO,B'11101111'                                0428
*             RFY                                                  0429
*              (RETCODE) RSTD;      /* RESTRICT REG                  */
*                                                                  0429
*             /*******************************************************/
*             /*                                                     */
*             /* CHECK RETURN CODE FROM IEEVDEV, 00 = NOT LAST PATH  */
*             /* 04 = LAST PATH. ANY THING ELSE IS INVALID. IF LAST  */
*             /* PATH WAS NOT INDICATED RESET CONDITION CODE MASK TO */
*             /* ALLOW MESSAGE INFORMING OPERATOR IF INOPERATIONAL   */
*             /* PATHS EXIST TO THE DEVICE                           */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0430
*             IF RETCODE=0 THEN     /* NOT LAST PATH ?               */
         LTR   RETCODE,RETCODE                                     0430
         BNZ   @RF00430                                            0430
*               DO;                                                0431
*                                                                  0431
*                 /***************************************************/
*                 /*                                                 */
*                 /* RESET CONDITION CODE 3 MASK IN UCB TO PERMIT    */
*                 /* MESSAGES TO BE ISSUED IN THE EVENT OF A         */
*                 /* INOPERATIONAL PATH                              */
*                 /*                                                 */
*                 /***************************************************/
*                                                                  0432
*                 RFY                                              0432
*                  (R10,                                           0432
*                   R11,                                           0432
*                   R12) RSTD;      /* RESTRICT REGISTERS            */
*                 R10=UCBPTR;       /* UCB ADDRESS                   */
         L     R10,UCBPTR                                          0433
*                 GEN REFS(UCBCCWOF,UCBBGN)                        0434
*(IOSGEN  UCBFLG,UCB=(10),TABLE=UCBPMSK,REG=(11,12));              0434
         IOSGEN  UCBFLG,UCB=(10),TABLE=UCBPMSK,REG=(11,12)
*                 RFY                                              0435
*                  (R10,                                           0435
*                   R11,                                           0435
*                   R12) UNRSTD;    /* RELEASE REGISTERS             */
*               END;                                               0436
*             ELSE                                                 0437
*               DO;                                                0437
*                                                                  0437
         B     @RC00430                                            0437
@RF00430 DS    0H                                                  0438
*                 /***************************************************/
*                 /*                                                 */
*                 /* CHECK FOR RETURN CODE 4 (LAST PATH ) AND CHECK  */
*                 /* DEVICE STATUS                                   */
*                 /*                                                 */
*                 /***************************************************/
*                                                                  0438
*                 IF RETCODE=4 THEN /* CHECK FOR LAST PATH CONDITION */
         CH    RETCODE,@CH00076                                    0438
         BNE   @RF00438                                            0438
*                   DO;             /* INCLUDE PATHMAP ROUTINE       */
*/****** PATHMAP *************************************************** */
*/* PATHMAP WILL ANALYZE DEVICE STATUS WHEN A LAST PATH CONDITION    */
*/* IS ENCOUNTERED. DEVICE WILL BE CHECKED FOR NALLOC, CONSOLE,      */
*/* ALLOCATED, AND OFFLINE. IF DEVICE CAN BE TAKEN OFFLINE THEN A    */
*/* RECORDER BLOCK WILL BE BUILT REPRESENTING THE DEVICE FOR LATER   */
*/* USE. IF IT IS DETERMINED THAT THE DEVICE CANNOT BE REMOVED THE   */
*/* LASTPATH BIT WILL BE SET IN THE ERROR INDICATOR AND CONTROL      */
*/* RETURNED TO THE NEXT HIGHER LEVEL OF CONTROL                     */
*/*****************************************************************  */
*                                                                  0440
*                     DO;                                          0440
*                                                                  0440
*                       /*********************************************/
*                       /*                                           */
*                       /* CHECK IF DEVICE IS ALLOCATED OR IN USE BY */
*                       /* SOME SYSTEM FUNCTION AND IF SO SET LAST   */
*                       /* PATH ERROR FLAG AND RETURN TO NEXT HIGHER */
*                       /* LEVEL OF CONTROL IGNORE NALLOC FLAG IF    */
*                       /* DEVICE IS MSS                             */
*                       /*                                           */
*                       /*********************************************/
*                                                                  0441
*                       IF UCBALOC='1'B×(UCBNALOC='1'B&UCBTBYT4^='42'X)
*                         THEN      /*                       @Y30LPXA*/
         L     @14,UCBPTR                                          0441
         TM    UCBALOC(@14),B'00001000'                            0441
         BO    @RT00441                                            0441
         TM    UCBNALOC(@14),B'00000100'                           0441
         BNO   @RF00441                                            0441
         CLI   UCBTBYT4(@14),X'42'                                 0441
         BE    @RF00441                                            0441
@RT00441 DS    0H                                                  0442
*                         DO;                                      0442
*                                                                  0442
*                           /*****************************************/
*                           /*                                       */
*                           /* DEVICE IS IN USE, COPY DEVICE NAME AND*/
*                           /* SET ERROR FLAGS                       */
*                           /*                                       */
*                           /*****************************************/
*                                                                  0443
*                           DDD=UCBNAME;/* COPY DEVICE NAME          */
         L     @14,UCBPTR                                          0443
         MVC   DDD(3),UCBNAME(@14)                                 0443
*                           LASTPATH='1'B;/* SET LAST PATH ERROR FLAG*/
         OI    LASTPATH,B'00000010'                                0444
*                           GOTO PATHEXIT;/* RETURN TO NEXT HIGHER 0445
*                                      LEVEL                         */
         B     PATHEXIT                                            0445
*                         END;                                     0446
*                                                                  0446
*                       /*********************************************/
*                       /*                                           */
*                       /* DEVICE IS NOT ALLOCATED NOR IN USE BY SOME*/
*                       /* SYSTEM FUNCTION IF DEVICE IS ALREADY      */
*                       /* OFFLINE THEN BUILD A RECORDER ENTRY FOR   */
*                       /* HIER ONLY.                                */
*                       /*                                           */
*                       /*********************************************/
*                                                                  0447
*                       IF UCBONLI^='1'B THEN/* UCB OFFLINE?         */
@RF00441 L     @14,UCBPTR                                          0447
         TM    UCBONLI(@14),B'10000000'                            0447
         BO    @RF00447                                            0447
*                         DO;                                      0448
*                           HIER='1'B;/* SET HIER INDICATOR IN FLAG
*                                      BYTE                          */
         OI    HIER,B'10000000'                                    0449
*                           GOTO UCBRCRD;/* GO BUILD RECORDER BLOCK  */
         B     UCBRCRD                                             0450
*                         END;                                     0451
*                                                                  0451
*                       /*********************************************/
*                       /*                                           */
*                       /* DEVICE IS NOT ALLOCATED, NOT IN USE, AND  */
*                       /* ONLINE, CHECK IF DEVICE REPRESENTS A      */
*                       /* CONSOLE                                   */
*                       /*                                           */
*                       /*********************************************/
*                                                                  0452
*                       IF UCBSYSR='1'B THEN/* DEVICE A CONSOLE?     */
@RF00447 L     @14,UCBPTR                                          0452
         TM    UCBSYSR(@14),B'00000010'                            0452
         BNO   @RF00452                                            0452
*                         DO;                                      0453
*                           CNSLSW='1'B;/* INDICATOR FOR CONSOLE   0454
*                                      SWITCH                        */
         OI    CNSLSW,B'00000001'                                  0454
*                           CONSLE='1'B;/* CONSOLE INDICATOR IN FLAG
*                                      BYTE                          */
         OI    CONSLE,B'01000000'                                  0455
*                           GOTO UCBRCRD;/* GO BUILD RECORDER BLOCK  */
         B     UCBRCRD                                             0456
*                         END;                                     0457
*                                                                  0457
*                       /*********************************************/
*                       /*                                           */
*                       /* DEVICE IS ONLINE, NOT IN USE, NOT A       */
*                       /* CONSOLE, AND NOT ALLOCATED CHECK IF       */
*                       /* OPERATOR HAS SPECIFIED UNCONDITIONAL AND  */
*                       /* BUILD A RECORDER BLOCK, ELSE REJECT       */
*                       /* COMMAND BECAUSE OF A LAST PATH CONDITION  */
*                       /*                                           */
*                       /*********************************************/
*                                                                  0458
*                       IF UNCOND='1'B THEN/* UNCONDITIONAL        0458
*                                      SPECIFIED?                    */
@RF00452 TM    UNCOND,B'00010000'                                  0458
         BNO   @RF00458                                            0458
*                         DO;                                      0459
*                           DEVOFF='1'B;/* SET FLAG FOR RECORDER     */
         OI    DEVOFF,B'00010000'                                  0460
*                           GOTO UCBRCRD;/* GO BUILD RECORDER BLOCK  */
         B     UCBRCRD                                             0461
*                         END;                                     0462
*                       ELSE                                       0463
*                         DO;                                      0463
*                                                                  0463
@RF00458 DS    0H                                                  0464
*                           /*****************************************/
*                           /*                                       */
*                           /* OPERATOR HAS NOT SPECIFIED            */
*                           /* UNCONDITIONAL VARY AND THIS REPRESENTS*/
*                           /* LAST PATH TO A ONLINE DEVICE. SET LAST*/
*                           /* PATH ERROR FLAG AND TERMINATE COMMAND */
*                           /*                                       */
*                           /*****************************************/
*                                                                  0464
*                           DDD=UCBNAME;/* COPY DEVICE NAME FOR    0464
*                                      MESSAGE TEXT                  */
         L     @14,UCBPTR                                          0464
         MVC   DDD(3),UCBNAME(@14)                                 0464
*                           LASTPATH='1'B;/* SET ERROR FLAG          */
         OI    LASTPATH,B'00000010'                                0465
*                           GOTO PATHEXIT;/* RETURN TO NEXT LEVEL    */
         B     PATHEXIT                                            0466
*                         END;                                     0467
*                                                                  0467
*                       /*********************************************/
*                       /*                                           */
*                       /* COMMON CALL TO UCBRECORDER ROUTINE        */
*                       /*                                           */
*                       /*********************************************/
*                                                                  0468
*UCBRCRD:                                                          0468
*                       CALL UCBRCRDR;/* BUILD RECORDER BLOCK        */
*                                                                  0468
UCBRCRD  BAL   @14,UCBRCRDR                                        0468
*                       /*********************************************/
*                       /*                                           */
*                       /* END OF PATHMAP ROUTINE..                  */
*                       /*                                           */
*                       /*********************************************/
*                                                                  0469
*PATHEXIT:                                                         0469
*                     END;          /* END OF PATHMAP ROUTINE        */
PATHEXIT DS    0H                                                  0470
*                                                                  0470
*                     /***********************************************/
*                     /*                                             */
*                     /* CHECK FOR ANY ERROR CONDITIONS FROM PATHMAP */
*                     /* ROUTINES AND IF FOUND RETURN TO NEXT HIGHER */
*                     /* LEVEL                                       */
*                     /*                                             */
*                     /***********************************************/
*                                                                  0470
*                     IF ERRORIND^=0 THEN/* CHECK FOR ANY ERRORS     */
         ICM   @14,15,ERRORIND                                     0470
         BNZ   @RT00470                                            0470
*                       GOTO DEVPEXIT;/* RETURN TO NEXT HIGHER     0471
*                                      ROUTINE                       */
*                   END;                                           0472
*                 ELSE                                             0473
*                   DO;                                            0473
*                                                                  0473
         B     @RC00438                                            0473
@RF00438 DS    0H                                                  0474
*                     /***********************************************/
*                     /*                                             */
*                     /* INVALID RETURN CODE RECEIVED FROM IEEVDEV.  */
*                     /* SET CP FAILED INDICATOR AND RETURN TO NEXT  */
*                     /* HIGHER LEVEL                                */
*                     /*                                             */
*                     /***********************************************/
*                                                                  0474
*                     CPFAILED='1'B;/* SET ERROR FLAG                */
         OI    CPFAILED,B'00000100'                                0474
*                     GOTO DEVPEXIT;/* RETURN TO NEXT HIGHER LEVEL   */
         B     DEVPEXIT                                            0475
*                   END;                                           0476
*                 RFY                                              0477
*                  (RETCODE) UNRSTD;/* RELEASE REGISTER 15           */
@RC00438 DS    0H                                                  0478
*               END;                                               0478
*ENDLOOP:                                                          0479
*           END;                    /* END OF DO LOOP                */
@RC00430 DS    0H                                                  0479
ENDLOOP  LA    @12,2                                               0479
         AL    @12,UCBLKPTR                                        0479
         ST    @12,UCBLKPTR                                        0479
@DE00382 L     @12,UCBLKPTR                                        0479
         CLC   UCBTAB(2,@12),@CH03658                              0479
         BNE   @DL00382                                            0479
*DEVPEXIT:                                                         0480
*         END;                      /* END OF DEVPREP ROUTINE        */
DEVPEXIT DS    0H                                                  0481
*     IF ERRORIND^=0 THEN           /* ANY ERRORS?                   */
@RF00341 DS    0H                                                  0481
@RF00340 ICM   @12,15,ERRORIND                                     0481
         BNZ   @RT00481                                            0481
*       GOTO OFFEXIT;               /* RETURN TO MAINLINE            */
*/***** TMRCNSL **************************************************** */
*/* TMRCNSL ROUTINE WILL VERIFY THAT CLOCKS CAN BE SWITCHED FOR A    */
*/* VARY CPU COMMAND, AND WILL CAUSE CONSOLES TO BE SWITCHED IF      */
*/* NECESSARY.                                                       */
*/* POSSIBLE ERROR INDICATORS ARE: NOCLOCK, NOCNSOLE, CPFAILED       */
*/****************************************************************** */
*                                                                  0483
*     DO;                                                          0483
*                                                                  0483
*       /*************************************************************/
*       /*                                                           */
*       /* DETERMINE IF THIS IS A VARY CPU COMMAND AND IF SO SWITCH  */
*       /* CLOCKS                                                    */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0484
*       IF CHNIND^='1'B THEN        /* VARY CPU COMMAND              */
         TM    CHNIND,B'10000000'                                  0484
         BO    @RF00484                                            0484
*         DO;                                                      0485
*           CLOCKSW='1'B;           /* SET FOOTPRINT FOR CLOCK SWITCH*/
         OI    CLOCKSW,B'00000100'                                 0486
*           RFY                                                    0487
*            (R1,                                                  0487
*             RETCODE) RSTD;        /* RESTRICT REGISTERS FOR LINK   */
*           R1=ADDR(PCCAT00P(HEXCPUAD+1));/* LOAD PCCA POINTER     0488
*                                      ADDRESS                       */
         SLR   @14,@14                                             0488
         ICM   @14,3,HEXCPUAD                                      0488
         SLA   @14,2                                               0488
         L     @12,CVTPTR                                          0488
         L     R1,CVTPCCAT(,@12)                                   0488
         LA    R1,PCCAT00P(@14,R1)                                 0488
*           GEN(LINK EP=IEAVRNOT);  /* LINK TO TIMER SWITCH ROUTINE  */
*                                                                  0489
         LINK EP=IEAVRNOT
*           /*********************************************************/
*           /*                                                       */
*           /* CHECK RETURN CODE TO DETERMINE IF CLOCKS CAN BE       */
*           /* SWITCHED                                              */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0490
*           IF RETCODE^=0 THEN      /* CAN CLOCKS BE SWITCHED?       */
         LTR   RETCODE,RETCODE                                     0490
         BZ    @RF00490                                            0490
*             DO;                                                  0491
*               NOCLOCK='1'B;       /* SET ERROR FLAG                */
         OI    NOCLOCK,B'10000000'                                 0492
*               GOTO TMREXIT;       /* RETURN TO CALLER              */
         B     TMREXIT                                             0493
*             END;                                                 0494
*         END;                      /* END OF CPU CLOCK SWITCH     0495
*                                      ROUTINE                       */
*                                                                  0495
@RF00490 DS    0H                                                  0496
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK IF CONSOLES NEED TO BE SWITCHED AND IF SO LINK TO   */
*       /* CONSOLE SWITCH ROUTINE                                    */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0496
*       IF CNSLSW='1'B THEN         /* CONSOLES NEED TO BE SWITCHED? */
@RF00484 TM    CNSLSW,B'00000001'                                  0496
         BNO   @RF00496                                            0496
*         DO;                                                      0497
*           CNSLEXIT='1'B;          /* SET CONSOLE EXIT FOOTPRINT    */
*                                                                  0498
         OI    CNSLEXIT,B'00000001'                                0498
*           /*********************************************************/
*           /*                                                       */
*           /* INITIALIZE PARAMETER FOR CONSOLE SWITCH ROUTINE       */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0499
*           CSWTBLK=''B;            /* ZERO OUT PARAMETER AREA       */
         XC    CSWTBLK(32),CSWTBLK                                 0499
*           CSWTID='IGC0407B';      /* FILL IN IDENTIFIER            */
         MVC   CSWTID(8),@CC03671                                  0500
*           IF CHNIND='1'B THEN     /* CHANNEL OR CPU COMMAND        */
         TM    CHNIND,B'10000000'                                  0501
         BNO   @RF00501                                            0501
*             CSWTFC='20'X;                                        0502
         MVI   CSWTFC,X'20'                                        0502
*           ELSE                                                   0503
*             CSWTFC='40'X;         /* VARY CPU IDENTIFIER           */
         B     @RC00501                                            0503
@RF00501 MVI   CSWTFC,X'40'                                        0503
*           CSWTUC=CVTCUCB;         /* FIRST UCM                     */
@RC00501 L     @14,CVTPTR                                          0504
         MVC   CSWTUC(4),CVTCUCB(@14)                              0504
*           R1=ADDR(CSWTBLK);       /* POINT TO CONTROL BLOCK        */
         LA    R1,CSWTBLK                                          0505
*           SVC(72);                /* ISSUE SVC                     */
*                                                                  0506
         SVC   72                                                  0506
*           /*********************************************************/
*           /*                                                       */
*           /* VERIFY THAT CONSOLES CAN BE SWITCHED AND IF NOT SET   */
*           /* ERROR FLAG                                            */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0507
*           IF RETCODE^=0 THEN      /* CAN CONSOLES BE SWITCHED?     */
         LTR   RETCODE,RETCODE                                     0507
         BZ    @RF00507                                            0507
*             DO;                                                  0508
*               NOCNSOLE='1'B;      /* SET ERROR FLAG                */
         OI    NOCNSOLE,B'01000000'                                0509
*               GOTO TMREXIT;       /* RETURN CONTROL TO CALLER      */
         B     TMREXIT                                             0510
*             END;                                                 0511
*           RFY                                                    0512
*            (R1,                                                  0512
*             RETCODE) UNRSTD;      /* RELEASE REGISTERS FOR USE     */
@RF00507 DS    0H                                                  0513
*/******* CNSLWAIT ************************************************  */
*/* CNSLWAIT WILL WAIT FOR ALL CONSOLES TO BE SWITCHED AND MARKED    */
*/* OFFLINE. A CHECK WILL BE MADE TO DETERMINE IF SYSTEM STATUS      */
*/* HAS CHANGED AND IF SO CPFAILED ERROR FLAG WILL BE SET AND        */
*/* CONTROL RETURNED TO NEXT HIGHER LEVEL OF CONTROL                 */
*/*****************************************************************  */
*                                                                  0513
*CNSLWAIT:                                                         0513
*           LOOPCNT=0;              /* START WITH ZERO COUNT         */
CNSLWAIT SLR   @12,@12                                             0513
         ST    @12,LOOPCNT                                         0513
*CNSLLOOP:                                                         0514
*           RCRDRPTR=ENTRYPTR;      /* ADDRESSABILITY TO RECORDER  0514
*                                      BLOCKS                        */
*                                                                  0514
CNSLLOOP L     RCRDRPTR,ENTRYPTR                                   0514
*           /*********************************************************/
*           /*                                                       */
*           /* SET UP DO LOOP TO SCAN THROUGH ALL RECORDER BLOCKS AND*/
*           /* VERIFY THAT CONSOLES HAVE BEEN MARKED OFFLINE         */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0515
*           DO WHILE(RCRDRPTR^=0);  /* SCAN ALL RECORDER BLOCKS      */
*                                                                  0515
         B     @DE00515                                            0515
@DL00515 DS    0H                                                  0516
*             /*******************************************************/
*             /*                                                     */
*             /* CHECK IF THIS RECORDER BLOCK REPRESENTS A CONSOLE   */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0516
*             IF CONSLFLG='1'B THEN /* CONSOLE?                      */
         TM    CONSLFLG(RCRDRPTR),B'01000000'                      0516
         BNO   @RF00516                                            0516
*               DO;                                                0517
*                 UCBPTR=UCBADDR;   /* ADDRESSABILITY TO UCB         */
         SLR   @12,@12                                             0518
         ICM   @12,7,UCBADDR(RCRDRPTR)                             0518
         ST    @12,UCBPTR                                          0518
*                 IF UCBONLI='1'B THEN/* UCB STILL NOT OFFLINE       */
*                                                                  0519
         TM    UCBONLI(@12),B'10000000'                            0519
         BNO   @RF00519                                            0519
*                   /*************************************************/
*                   /*                                               */
*                   /* UCB STILL NOT OFFLINE VERIFY THAT SYSTEM      */
*                   /* STATUS HAS NOT CHANGED AND WAIT ONE SECOND.   */
*                   /* THEN TRY CHECK AGAIN                          */
*                   /*                                               */
*                   /*************************************************/
*                                                                  0520
*                   DO;                                            0520
*                     IF SYSSTAT^=CSDCPUAL THEN/* SYSTEM STATUS    0521
*                                      CHANGED?                      */
         L     @12,CVTPTR                                          0521
         L     @12,CVTCSD(,@12)                                    0521
         CLC   SYSSTAT(2),CSDCPUAL(@12)                            0521
         BE    @RF00521                                            0521
*                       DO;                                        0522
*                         SYSFAIL='1'B;/* SET ERROR FLAG             */
         OI    SYSFAIL,B'00000100'                                 0523
*                         GOTO CONSEXIT;/* RETURN TO HIGHER LEVEL OF
*                                      CONTROL                       */
         B     CONSEXIT                                            0524
*                       END;                                       0525
*                                                                  0525
*                     /***********************************************/
*                     /*                                             */
*                     /* CHECK LOOP COUNT TO DETERMINE IF MESSAGE    */
*                     /* SHOULD BE ISSUED                            */
*                     /*                                             */
*                     /***********************************************/
*                                                                  0526
*                     IF LOOPCNT=15 THEN/* TIME FOR MESSAGE?         */
@RF00521 CLC   LOOPCNT(4),@CF00344                                 0526
         BNE   @RF00526                                            0526
*                       DO;                                        0527
*                         RFY                                      0528
*                          (R6) RSTD;/* RESTRICT REG 6               */
*                         R6=ADDR(WORKAREA);/* ADDRESS OF WORKAREA   */
         LA    R6,WORKAREA                                         0529
*                         DDD=UCBNAME;/* DEVICE NAME FOR MESSAGE     */
         L     @12,UCBPTR                                          0530
         MVC   DDD(3),UCBNAME(@12)                                 0530
*                         CALL WTORT(2);/* ISSUE DEVICE BUSY MESSAGE */
         L     @15,@CV03525                                        0531
         LA    @01,@AL00531                                        0531
         BALR  @14,@15                                             0531
*                         RFY                                      0532
*                          (R6) UNRSTD;/* RELEASE REG                */
*                       END;                                       0533
*                                                                  0533
*                     /***********************************************/
*                     /*                                             */
*                     /* CHECK LOOP COUNT TO DETERMINE IF OPERATOR   */
*                     /* CAN CANCEL                                  */
*                     /*                                             */
*                     /***********************************************/
*                                                                  0534
*                     IF LOOPCNT=150 THEN/* CANCEL TIME?             */
@RF00526 CLC   LOOPCNT(4),@CF03679                                 0534
         BNE   @RF00534                                            0534
*                       DO;                                        0535
*                         LOOPCNT=0;/* ZERO LOOP COUNT FOR NEXT TIME */
         SLR   @12,@12                                             0536
         ST    @12,LOOPCNT                                         0536
*CONWTOR:                                                          0537
*                         WTOECB=0; /* ZERO ECB                      */
CONWTOR  SLR   @12,@12                                             0537
         ST    @12,WTOECB                                          0537
*                         REPLY=''; /* BLANK OUT REPLY BUFFER        */
         MVI   REPLY,C' '                                          0538
         MVC   REPLY+1(7),REPLY                                    0538
*                         WTORPL2=WTOR2;/* MOVE WTOR TO PARM LIST    */
         MVC   WTORPL2(55),WTOR2                                   0539
*                         WTORDDD=UCBNAME;/* FILL IN DYNAMIC TEXT    */
         L     @12,UCBPTR                                          0540
         MVC   WTORDDD(3),UCBNAME(@12)                             0540
*                         GEN(WTOR  ,REPLY,,WTOECB,MF=(E,WTORPL2));/*
*                                      WTOR                          */
*                                                                  0541
         WTOR  ,REPLY,,WTOECB,MF=(E,WTORPL2)
*                         /*******************************************/
*                         /*                                         */
*                         /* WAIT FOR RESPONSE                       */
*                         /*                                         */
*                         /*******************************************/
*                                                                  0542
*                         GEN(WAIT  ECB=WTOECB);/* WAIT FOR REPLY    */
*                                                                  0542
         WAIT  ECB=WTOECB
*                         /*******************************************/
*                         /*                                         */
*                         /* CHECK OPERATORS RESPONSE                */
*                         /*                                         */
*                         /*******************************************/
*                                                                  0543
*                         IF REPLY^='EXTEND'&REPLY^='CANCEL' THEN/*
*                                      VALID REPLY?                  */
         CLC   REPLY(6),@CC03682                                   0543
         BE    @RF00543                                            0543
         CLC   REPLY(6),@CC03683                                   0543
         BNE   @RT00543                                            0543
*                           GOTO CONWTOR;/* RE ISSUE WTOR            */
*                                                                  0544
*                         /*******************************************/
*                         /*                                         */
*                         /* REPLY IS VALID, CHECK IF CANCEL         */
*                         /*                                         */
*                         /*******************************************/
*                                                                  0545
*                         IF REPLY='CANCEL' THEN/* CANCEL REPLY?     */
@RF00543 CLC   REPLY(6),@CC03683                                   0545
         BNE   @RF00545                                            0545
*                           DO;                                    0546
*                             OPERCNCL='1'B;/* SET OPERATOR CANCEL 0547
*                                      FLAG                          */
         OI    OPERCNCL,B'00100000'                                0547
*                             GOTO CONSEXIT;/* EXIT WITH ERROR FLAG  */
         B     CONSEXIT                                            0548
*                           END;                                   0549
*                                                                  0549
*                         /*******************************************/
*                         /*                                         */
*                         /* REPLY MUST HAVE BEEN EXTEND THEN        */
*                         /*                                         */
*                         /*******************************************/
*                                                                  0550
*                         ELSE                                     0550
*                           GOTO CNSLWAIT;/* LOOP AGAIN              */
*                       END;        /* END OF LOOP COUNT 150       0551
*                                      PROCESSING                    */
*                                                                  0551
*                     /***********************************************/
*                     /*                                             */
*                     /* WAIT ONE SECOND THEN TRY LOOP AGAIN         */
*                     /*                                             */
*                     /***********************************************/
*                                                                  0552
*                     GEN(STIMER  WAIT,BINTVL=SEC1);/* WAIT ONE    0552
*                                      SECOND                        */
@RF00534 DS    0H                                                  0552
         STIMER  WAIT,BINTVL=SEC1
*                     LOOPCNT=LOOPCNT+1;/* INCREMENT LOOP COUNT      */
         LA    @12,1                                               0553
         AL    @12,LOOPCNT                                         0553
         ST    @12,LOOPCNT                                         0553
*                     GOTO CNSLLOOP;/* TRY SCAN OVER AGAIN           */
         B     CNSLLOOP                                            0554
*                   END;                                           0555
*               END;                /* END OF CONSOLE PROCESSING     */
*                                                                  0556
@RF00519 DS    0H                                                  0557
*             /*******************************************************/
*             /*                                                     */
*             /* STEP TO NEXT RECORDER BLOCK ENTRY                   */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0557
*             RCRDRPTR=NEXTPTR;     /* PICK UP NEXT ENTRY ADDRESS    */
@RF00516 L     RCRDRPTR,NEXTPTR(,RCRDRPTR)                         0557
*           END;                    /* END OF DO LOOP                */
*                                                                  0558
@DE00515 LTR   RCRDRPTR,RCRDRPTR                                   0558
         BNZ   @DL00515                                            0558
*           /*********************************************************/
*           /*                                                       */
*           /* ALL CONSOLES HAVE SUCCESSFULLY GONE OFFLINE. SET      */
*           /* CNSLDONE FOOTPRINT                                    */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0559
*           CNSLDONE='1'B;          /* ALL CONSOLES HAVE GONE OFFLINE*/
         OI    CNSLDONE,B'10000000'                                0559
*CONSEXIT:                                                         0560
*         END;                      /* END OF CONSOLE WAIT ROUTINE   */
CONSEXIT DS    0H                                                  0561
*TMREXIT:                                                          0561
*     END;                          /* END OF TMRCNSL ROUTINE        */
@RF00496 DS    0H                                                  0561
TMREXIT  DS    0H                                                  0562
*     IF ERRORIND^=0 THEN           /* ANY ERRORS?                   */
         ICM   @12,15,ERRORIND                                     0562
         BNZ   @RT00562                                            0562
*       GOTO OFFEXIT;               /* RETURN TO MAINLINE            */
*     IF CPUCRH='1'B THEN                                          0564
         TM    CPUCRH,B'00000001'                                  0564
         BO    @RT00564                                            0564
*       GOTO DSPTCHK;               /*                       @G557P2L*/
*     IF PCCAT00P(HEXCPUAD+1)->     /* PCCA FOR THIS CPU     @G47AN2O*/
*         PCCAIO=HASIO              /* CPU HAS CHANNELS      @G47AN2O*/
*       THEN                                                       0566
         SLR   @12,@12                                             0566
         ICM   @12,3,HEXCPUAD                                      0566
         SLA   @12,2                                               0566
         L     @06,CVTPTR                                          0566
         L     @06,CVTPCCAT(,@06)                                  0566
         L     @12,PCCAT00P(@12,@06)                               0566
         TM    PCCAIO(@12),B'01000000'                             0566
         BNO   @RF00566                                            0566
*       DO;                         /* PERFORM UCBMARK AND   @G47AN2O
*                                      CHANNEL FUNCTIONS     @G47AN2O*/
*                                                                  0567
*         /***********************************************************/
*         /*                                                         */
*         /* CALL UCB MARK ROUTINE TO MARK ALL NECESSARY DEVICES     */
*         /* OFFLINE                                                 */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0568
*         CALL UCBMARK;                                            0568
*                                                                  0568
         BAL   @14,UCBMARK                                         0568
*         /***********************************************************/
*         /*                                                         */
*         /* PROCESS CHANNELS                                        */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0569
*/****** CHANNEL *************************************************** */
*/* CHANNEL ROUTINE WILL MARK EITHER THE SPECIFIED CHANNEL OFFLINE   */
*/* FOR A VARY CHANNEL COMMAND OR WILL MARK ALL CHANNELS OFFLINE     */
*/* FOR A VARY CPU COMMAND. A COPY OF THE CHANNEL STATUS IS KEPT IN  */
*/* THE WORKAREA FOR BACKOUT IN THE EVENT OF AN ERROR.               */
*/* POSSIBLE ERROR INDICATORS ARE: PATHRSVD, OPERCNCL                */
*/****************************************************************** */
*                                                                  0569
*         DO;                                                      0569
*                                                                  0569
*           /*********************************************************/
*           /*                                                       */
*           /* ESTABLISH ADDRESSABILITY TO SPECIFIED CPU'S CAT TABLE */
*           /* AND ESTABLISH ADDRESSABILITY TO SPECIFIED CPU'S LCCA  */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0570
*           PCCAPTR=PCCAT00P(HEXCPU1+1);/* PCCA FOR SPECIFIED CPU    */
         SLR   @12,@12                                             0570
         IC    @12,HEXCPU1                                         0570
         SLA   @12,2                                               0570
         L     @11,CVTPTR                                          0570
         L     @06,CVTPCCAT(,@11)                                  0570
         L     @06,PCCAT00P(@12,@06)                               0570
         ST    @06,PCCAPTR                                         0570
*           CATPTR=ADDR(PCCACAT);   /* ADDRESSABILITY TO FIRST CAT 0571
*                                      ENTRY                         */
         LA    CATPTR,PCCACAT(,@06)                                0571
*           LCCAPTR=LCCAT00P(HEXCPU1+1);/* SET UP ADDRESSABILITY FOR
*                                      LCCA                          */
*                                                                  0572
         L     @11,CVTLCCAT(,@11)                                  0572
         L     @12,LCCAT00P(@12,@11)                               0572
         ST    @12,LCCAPTR                                         0572
*           /*********************************************************/
*           /*                                                       */
*           /* SET CHNLSMRK FOOTPRINT THEN COPY STATUS OF CHANNELS IF*/
*           /* VARY CPU COMMAND AND MARK CHANNELS OFFLINE            */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0573
*           CHNLSMRK='1'B;          /* SET CHANNELS MARKED FOOTPRINT */
*                                                                  0573
         OI    CHNLSMRK,B'00100000'                                0573
*           /*********************************************************/
*           /*                                                       */
*           /* CHECK FOR CHANNEL COMMAND                             */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0574
*           IF CHNIND='1'B THEN     /* VARY CHANNEL COMMAND?         */
         TM    CHNIND,B'10000000'                                  0574
         BNO   @RF00574                                            0574
*             DO;                                                  0575
*                                                                  0575
*               /*****************************************************/
*               /*                                                   */
*               /* GET ADDRESS OF SPECIFIED CHANNEL CAT ENTRY        */
*               /*                                                   */
*               /*****************************************************/
*                                                                  0576
*               CATPTR=CATPTR+(8*HEXCHN1);/* GET CAT ENTRY ADDRESS   */
         SLR   @12,@12                                             0576
         IC    @12,HEXCHN1                                         0576
         SLA   @12,3                                               0576
         ALR   CATPTR,@12                                          0576
*               CATNOP='1'B;        /* MARK CHANNEL OFFLINE          */
         OI    CATNOP(CATPTR),B'01000000'                          0577
*             END;                                                 0578
*                                                                  0578
*           /*********************************************************/
*           /*                                                       */
*           /* WAS NOT A VARY CHANNEL COMMAND. MUST THEN BE A VARY   */
*           /* CPU COMMAND                                           */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0579
*           ELSE                                                   0579
*             DO;                                                  0579
*                                                                  0579
         B     @RC00574                                            0579
@RF00574 DS    0H                                                  0580
*               /*****************************************************/
*               /*                                                   */
*               /* VARY CPU COMMAND.. CREATE COPY OF CHANNEL STATUS  */
*               /* IN COPYCAT THEN MARK CHANNELS OFFLINE             */
*               /*                                                   */
*               /*****************************************************/
*                                                                  0580
*               DO LOOPCNT=1 TO 16; /* COPY CHANNEL STATUS           */
         LA    @12,1                                               0580
         ST    @12,LOOPCNT                                         0580
@DL00580 DS    0H                                                  0581
*                 CATCOPY(LOOPCNT)=CATFLG;/* SAVE CAT FLAG IN      0581
*                                      WORKAREA                      */
         LA    @11,CATCOPY-1(@12)                                  0581
         MVC   0(1,@11),CATFLG(CATPTR)                             0581
*                 CATPTR=CATPTR+8;  /* INCREMENT TO NEXT CAT ENTRY   */
         AH    CATPTR,@CH00036                                     0582
*               END;                /* END OF COPYCAT LOOP           */
         AL    @12,@CF00067                                        0583
         ST    @12,LOOPCNT                                         0583
         CH    @12,@CH00055                                        0583
         BNH   @DL00580                                            0583
*               COPYCAT='1'B;       /* SET FOOTPRINT INDICATING THAT
*                                      CAT HAS BEEN COPIED           */
*                                                                  0584
         OI    COPYCAT,B'00000010'                                 0584
*               /*****************************************************/
*               /*                                                   */
*               /* SET POINTER TO ACR RECOVERY CODE IN IEEVWKUP IN   */
*               /* CVT FOR USE BY ACR IN THE EVENT OF A SYSTEM       */
*               /* FAILURE WHILE ALL CHANNELS ARE MARKED OFFLINE     */
*               /*                                                   */
*               /*****************************************************/
*                                                                  0585
*               CVTVACR=ADDR(IEEVACR);/* ACR ENTRY POINT             */
*                                                                  0585
         L     @12,@CV03524                                        0585
         L     @11,CVTPTR                                          0585
         ST    @12,CVTVACR(,@11)                                   0585
*               /*****************************************************/
*               /*                                                   */
*               /* SET INDICATOR FOR ACR INDICATING THAT ALL CHANNELS*/
*               /* ON THIS CPU HAVE BEEN MARKED OFFLINE              */
*               /*                                                   */
*               /*****************************************************/
*                                                                  0586
*               LCCAVARY='1'B;      /* SET ACR BIT                   */
*                                                                  0586
         L     @12,LCCAPTR                                         0586
         OI    LCCAVARY(@12),B'00000001'                           0586
*               /*****************************************************/
*               /*                                                   */
*               /* SET CATPTR BACK TO BEGINNING OF CAT TABLE AND MARK*/
*               /* ALL CHANNELS OFFLINE                              */
*               /*                                                   */
*               /*****************************************************/
*                                                                  0587
*               CATPTR=ADDR(PCCACAT);/* BEGINNING OF CAT TABLE       */
         L     CATPTR,PCCAPTR                                      0587
         LA    CATPTR,PCCACAT(,CATPTR)                             0587
*               DO LOOPCNT=1 TO 16; /* MARK ALL CHANNELS OFFLINE     */
         LA    @12,1                                               0588
         ST    @12,LOOPCNT                                         0588
@DL00588 DS    0H                                                  0589
*                 CATNOP='1'B;      /* SET CHANNEL OFFLINE           */
         OI    CATNOP(CATPTR),B'01000000'                          0589
*                 CATPTR=CATPTR+8;  /* INCREMENT TO NEXT CAT ENTRY   */
         AH    CATPTR,@CH00036                                     0590
*               END;                /* END OF CHANNEL MARK ROUTINE   */
         AL    @12,@CF00067                                        0591
         ST    @12,LOOPCNT                                         0591
         CH    @12,@CH00055                                        0591
         BNH   @DL00588                                            0591
*               PCCAIO=NOIO;        /* THE CPU HAS NO        @G47AN2O
*                                      CHANNELS ONLINE       @G47AN2O*/
         L     @12,PCCAPTR                                         0592
         NI    PCCAIO(@12),B'10111111'                             0592
*             END;                  /* END OF VARY CPU CHANNEL MARK  */
*                                                                  0593
*           /*********************************************************/
*           /*                                                       */
*           /* ALL CHANNELS HAVE BEEN MARKED OFFLINE. FREE UCB ENQ   */
*           /* AND WAIT FOR ALL I/O TO QUIET ON SPECIFIED CPU        */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0594
*TIMELOOP:                          /* TIMER LOOP START              */
*           LOOPCNT=0;              /* INITIALIZE LOOP COUNT TO ZERO */
@RC00574 DS    0H                                                  0594
TIMELOOP SLR   @12,@12                                             0594
         ST    @12,LOOPCNT                                         0594
*QUITLOOP:                          /* QUIET LOOP                    */
*           CALL IEEVIOQ;           /* LINK TO I/O QUIET ROUTINE     */
*                                                                  0595
QUITLOOP BAL   @14,IEEVIOQ                                         0595
*           /*********************************************************/
*           /*                                                       */
*           /* CHECK IF ANY ERROR INDICATORS WERE SET DURING I/O     */
*           /* QUIET PROCESSING IF SO THEN RETURN CONTROL TO NEXT    */
*           /* HIGHER LEVEL OF CONTROL. ERROR INDICATORS THAT MAY    */
*           /* HAVE BEEN SET ARE PATHRSVD, CPFAILED. IONOTQT IS NOT  */
*           /* AN ERROR INDICATOR                                    */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0596
*           IF PATHRSVD='1'B&       /* IS RESERVED SWITCH ON @ZA00805*/
*               LOOPCNT<10 THEN     /* AND STILL IN 10 SECOND RESERVE
*                                      WAIT                  @ZA00805*/
         TM    PATHRSVD,B'00001000'                                0596
         BNO   @RF00596                                            0596
         L     @12,LOOPCNT                                         0596
         CH    @12,@CH01603                                        0596
         BNL   @RF00596                                            0596
*             DO;                   /* WAIT TO ALLOW I/O TIME TO   0597
*                                      COMPLETE              @ZA00805*/
*               PATHRSVD='0'B;      /* RESET RESERVED SWITCH @ZA00805*/
         NI    PATHRSVD,B'11110111'                                0598
*               CATPTR=ADDR(PCCACAT)+((UCBCHA)*LENGTH(CAT));/*     0599
*                                      CALCULATE PTR TO CAT ENTRY FOR
*                                      DEVICE WITH RESERVE   @ZA04821*/
         L     @12,PCCAPTR                                         0599
         LA    CATPTR,PCCACAT(,@12)                                0599
         L     @06,UCBPTR                                          0599
         SLR   @04,@04                                             0599
         IC    @04,UCBCHA(,@06)                                    0599
         SLA   @04,3                                               0599
         ALR   CATPTR,@04                                          0599
*               CATNOP='0'B;        /* SET CHANNEL ONLINE    @ZA00805*/
         NI    CATNOP(CATPTR),B'10111111'                          0600
*               PCCAIO=HASIO;       /* THE CPU HAS           @G47AN2O
*                                      CHANNELS ONLINE       @G47AN2O*/
         OI    PCCAIO(@12),B'01000000'                             0601
*               GEN(STIMER WAIT,BINTVL=SEC1);/* WAIT 1 SECOND      0602
*                                                            @ZA00805*/
         STIMER WAIT,BINTVL=SEC1
*               CATNOP='1'B;        /* SET CHANNEL OFFLINE   @ZA00805*/
         OI    CATNOP(CATPTR),B'01000000'                          0603
*               CALL CHECKIO;       /* NOIO IMPLIES ALL      @G47AN2O
*                                      CHANNELS OFFLINE      @G47AN2O*/
         BAL   @14,CHECKIO                                         0604
*               LOOPCNT=LOOPCNT+1;  /* INCREMENT LOOP COUNT  @ZA00805*/
         LA    @12,1                                               0605
         AL    @12,LOOPCNT                                         0605
         ST    @12,LOOPCNT                                         0605
*               GOTO QUITLOOP;      /* RETRY QUIET ROUTINE   @ZA00805*/
         B     QUITLOOP                                            0606
*             END;                  /* END OF RESERVE WAIT   @ZA00805*/
*           IF UCBENQ='1'B THEN     /* CHANNELS WILL REMAIN OFFLINE,
*                                      SO RELE UCB RESOURCE  @ZA00805*/
@RF00596 TM    UCBENQ,B'00000010'                                  0608
         BNO   @RF00608                                            0608
*             DO;                   /* RELEASE RESOURCE      @ZA00805*/
*               GEN(DEQ  (UCBENQQ,UCBENQR,2,SYSTEM));/*      @ZA00805*/
         DEQ  (UCBENQQ,UCBENQR,2,SYSTEM)
*               UCBENQ='0'B;        /* RESET FOOTPRINT       @ZA00805*/
         NI    UCBENQ,B'11111101'                                  0611
*             END;                  /*                       @ZA00805*/
*           IF ERRORIND^=0 THEN     /* ANY ERROR'S ENCOUNTERED?      */
@RF00608 ICM   @12,15,ERRORIND                                     0613
         BNZ   @RT00613                                            0613
*             GOTO CHANEXIT;        /* RETURN TO NEXT HIGHER LEVEL   */
*                                                                  0614
*           /*********************************************************/
*           /*                                                       */
*           /* CHECK IF I/O HAS NOT BEEN QUIETED YET. IF SO WAIT ONE */
*           /* SECOND AND TRY AGAIN.                                 */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0615
*           IF IONOTQT='1'B THEN    /* I/O NOT QUIET YET??           */
         TM    IONOTQT,B'00001000'                                 0615
         BNO   @RF00615                                            0615
*             DO;                                                  0616
*               IF LOOPCNT=15 THEN  /* TIME TO ISSUE MESSAGE         */
         CLC   LOOPCNT(4),@CF00344                                 0617
         BNE   @RF00617                                            0617
*                 DO;                                              0618
*                   RFY                                            0619
*                    (R6) RSTD;     /* RESTRICT REGISTER FOR       0619
*                                      INTERFACE                     */
*                   R6=ADDR(WORKAREA);/* POINT TO COMMON WORK AREA   */
         LA    R6,WORKAREA                                         0620
*                   CALL WTORT(2);  /* ISSUE DEVICE BUSY MESSAGE     */
         L     @15,@CV03525                                        0621
         LA    @01,@AL00621                                        0621
         BALR  @14,@15                                             0621
*                   RFY                                            0622
*                    (R6) UNRSTD;   /* RELEASE REG                   */
*                 END;                                             0623
*                                                                  0623
*               /*****************************************************/
*               /*                                                   */
*               /* WAS NOT ONE HUNDRED                               */
*               /*                                                   */
*               /*****************************************************/
*                                                                  0624
*               ELSE                                               0624
*                                                                  0624
*                 /***************************************************/
*                 /*                                                 */
*                 /* GIVE OPERATOR OPPORTUNITY TO CANCEL COMMAND     */
*                 /* AFTER 150 TIMES THROUGH LOOP                    */
*                 /*                                                 */
*                 /***************************************************/
*                                                                  0624
*                 IF LOOPCNT=150 THEN/* TWO HUNDRED TIMES THROUGH  0624
*                                      LOOP YET?                     */
         B     @RC00617                                            0624
@RF00617 CLC   LOOPCNT(4),@CF03679                                 0624
         BNE   @RF00624                                            0624
*                   DO;                                            0625
*CHNLWTOR:                          /* ISSUE WTOR                    */
*                     WTOECB=0;     /* ZERO OUT ECB                  */
CHNLWTOR SLR   @12,@12                                             0626
         ST    @12,WTOECB                                          0626
*                     REPLY='';     /* BLANK OUT REPLY BUFFER        */
         MVI   REPLY,C' '                                          0627
         MVC   REPLY+1(7),REPLY                                    0627
*                     WTORPL2=WTOR2;/* COPY PARMS TO PARM LIST       */
         MVC   WTORPL2(55),WTOR2                                   0628
*                     WTORDDD=DDD;  /* COPY DEVICE ADDRESS TO MESSAGE
*                                      TEXT                          */
         MVC   WTORDDD(3),DDD                                      0629
*                     GEN(WTOR  ,REPLY,,WTOECB,MF=(E,WTORPL2));/*  0630
*                                      WTOR                          */
*                                                                  0630
         WTOR  ,REPLY,,WTOECB,MF=(E,WTORPL2)
*                     /***********************************************/
*                     /*                                             */
*                     /* WAIT ON REPLY TO WTOR                       */
*                     /*                                             */
*                     /***********************************************/
*                                                                  0631
*                     GEN(WAIT  ECB=WTOECB);/* WAIT ON REPLY         */
*                                                                  0631
         WAIT  ECB=WTOECB
*                     /***********************************************/
*                     /*                                             */
*                     /* CHECK FOR VALID REPLY TO WTOR. IF REPLY IS  */
*                     /* INVALID REISSUE WTOR                        */
*                     /*                                             */
*                     /***********************************************/
*                                                                  0632
*                     IF REPLY^='EXTEND'&REPLY^='CANCEL' THEN/* VALID
*                                      REPLY?                        */
         CLC   REPLY(6),@CC03682                                   0632
         BE    @RF00632                                            0632
         CLC   REPLY(6),@CC03683                                   0632
         BNE   @RT00632                                            0632
*                       GOTO CHNLWTOR;/* REISSUE WTOR                */
*                                                                  0633
*                     /***********************************************/
*                     /*                                             */
*                     /* OPERATOR ISSUED VALID REPLY EXTEND CHECK OR */
*                     /* CANCEL COMMAND BASED ON OPERATOR RESPONSE   */
*                     /*                                             */
*                     /***********************************************/
*                                                                  0634
*                     IF REPLY='CANCEL' THEN/* OPERATOR REQUEST    0634
*                                      CANCEL?                       */
@RF00632 CLC   REPLY(6),@CC03683                                   0634
         BNE   @RF00634                                            0634
*                       DO;                                        0635
*                         OPERCNCL='1'B;/* SET CANCEL ERROR INDICATOR*/
         OI    OPERCNCL,B'00100000'                                0636
*                         GOTO CHANEXIT;                           0637
         B     CHANEXIT                                            0637
*                       END;                                       0638
*                                                                  0638
*                     /***********************************************/
*                     /*                                             */
*                     /* OPERATOR MUST HAVE THEN REPLYED EXTEND.     */
*                     /*                                             */
*                     /***********************************************/
*                                                                  0639
*                     ELSE          /* OTHERWISE REINITIALIZE LOOP   */
*                       GOTO TIMELOOP;/* REINITIALIZE LOOP COUNT     */
*                   END;            /* END OF OPERATOR RESPONSE      */
*                                                                  0640
*               /*****************************************************/
*               /*                                                   */
*               /* LOOP COUNT WAS NOT 100 OR 200 WAIT ONE SECOND THEN*/
*               /* TRY I/O QUIET ROUTINE AGAIN                       */
*               /*                                                   */
*               /*****************************************************/
*                                                                  0641
*               GEN(STIMER  WAIT,BINTVL=SEC1);/* WAIT ONE SECOND     */
*                                                                  0641
@RF00624 DS    0H                                                  0641
@RC00617 DS    0H                                                  0641
         STIMER  WAIT,BINTVL=SEC1
*               /*****************************************************/
*               /*                                                   */
*               /* CHECK FOR ACR CONDITION DURRING WAIT              */
*               /*                                                   */
*               /*****************************************************/
*                                                                  0642
*               IF SYSSTAT^=CSDCPUAL THEN/* MASK CHANGE?             */
         L     @12,CVTPTR                                          0642
         L     @12,CVTCSD(,@12)                                    0642
         CLC   SYSSTAT(2),CSDCPUAL(@12)                            0642
         BE    @RF00642                                            0642
*                 SYSFAIL='1'B;     /* SET SYSTEM FAILURE FLAG       */
         OI    SYSFAIL,B'00000100'                                 0643
*               LOOPCNT=LOOPCNT+1;  /* INCREMENT LOOP COUNT BY ONE   */
@RF00642 LA    @12,1                                               0644
         AL    @12,LOOPCNT                                         0644
         ST    @12,LOOPCNT                                         0644
*               GOTO QUITLOOP;      /* RETRY QUIET ROUTINE           */
         B     QUITLOOP                                            0645
*             END;                  /* END OF I/O NOT QUIET        0646
*                                      PROCESSING                    */
*CHANEXIT:                          /* END OF CHANNEL ROUTINE        */
*         END;                      /* END OF QUIET ROUTINE LOOP     */
@RF00615 DS    0H                                                  0647
CHANEXIT DS    0H                                                  0648
*       END;                                                       0648
*     IF ERRORIND^=0 THEN           /* ANY ERRORS?                   */
@RF00566 ICM   @12,15,ERRORIND                                     0649
         BNZ   @RT00649                                            0649
*       GOTO OFFEXIT;               /* RETURN TO MAINLINE            */
*                                                                  0650
*     /***************************************************************/
*     /*                                                             */
*     /* IF CHANNEL COMMAND THEN SET COMPLETE FLAG, IF CPU COMMAND   */
*     /* THEN REMOVE CPU                                             */
*     /*                                                             */
*     /***************************************************************/
*                                                                  0651
*     IF CHNIND='1'B THEN           /* CHANNEL COMMAND?              */
         TM    CHNIND,B'10000000'                                  0651
         BNO   @RF00651                                            0651
*       DO;                                                        0652
*                                                                  0652
*         /***********************************************************/
*         /*                                                         */
*         /* CHANNEL IS SUCCESSFULLY OFFLINE.                        */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0653
*         CHOFFOK='1'B;             /* OFFLINE OK                    */
*                                                                  0653
         OI    CHOFFOK,B'00000100'                                 0653
*         /***********************************************************/
*         /*                                                         */
*         /* SET UP LOOP TO SCAN THROUGH ALL CHANNELS ON SUBJECT CPU */
*         /* IF ANY CHANNELS ARE STILL ONLINE THEN EXIT              */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0654
*         PCCAPTR=PCCAT00P(HEXCPUAD+1);/* PCCA POINTER       @Y30CQXA*/
         SLR   @12,@12                                             0654
         ICM   @12,3,HEXCPUAD                                      0654
         SLA   @12,2                                               0654
         L     @11,CVTPTR                                          0654
         L     @11,CVTPCCAT(,@11)                                  0654
         L     @12,PCCAT00P(@12,@11)                               0654
         ST    @12,PCCAPTR                                         0654
*         CATPTR=ADDR(PCCACAT);     /* POINT TO FIRST CAT ENTRY    0655
*                                                            @Y30CQXA*/
         LA    CATPTR,PCCACAT(,@12)                                0655
*         DO LOOPCNT=1 TO 16;       /* LOOP THROUGH ALL CHANNELS   0656
*                                                            @Y30CQXA*/
         LA    @12,1                                               0656
         ST    @12,LOOPCNT                                         0656
@DL00656 DS    0H                                                  0657
*           IF CATNOP='0'B THEN     /* CHANNEL ONLINE?       @Y30CQXA*/
         TM    CATNOP(CATPTR),B'01000000'                          0657
         BZ    @RT00657                                            0657
*             GOTO CHNSON;          /* EXIT                  @Y30CQXA*/
*           CATPTR=CATPTR+8;        /* UPDATE TO NEXT CAT ENTRY    0659
*                                                            @Y30CQXA*/
         AH    CATPTR,@CH00036                                     0659
*         END;                      /* END OF CAT TABLE SCAN @Y30CQXA*/
         AL    @12,@CF00067                                        0660
         ST    @12,LOOPCNT                                         0660
         CH    @12,@CH00055                                        0660
         BNH   @DL00656                                            0660
*         PCCAIO=NOIO;              /* THE CPU HAS NO        @G47AN2O
*                                      CHANNELS ONLINE       @G47AN2O*/
*                                                                  0661
         L     @12,PCCAPTR                                         0661
         NI    PCCAIO(@12),B'10111111'                             0661
*         /***********************************************************/
*         /*                                                         */
*         /* IF CONTROL REACHES THIS POINT ALL CHANNEL ARE OFFLINE.  */
*         /* IF THIS WAS A CRH VARY ISSUE DISASSOCIATE/PURGE FOR SS1 */
*         /* IF PRESENT                                              */
*         /*                                                         */
*         /***********************************************************/
*                                                                  0662
*         IF CRH='1'B THEN          /* CRH VARY ?            @G47AN2O*/
         TM    CRH,B'00000010'                                     0662
         BNO   @RF00662                                            0662
*           DO;                     /*                       @G47AN2O*/
*             CALL DISASSOC;        /* GO ISSUE DISASSOCIATE @Y30LPXA*/
*                                                                  0664
         BAL   @14,DISASSOC                                        0664
*             /*******************************************************/
*             /*                                                     */
*             /* GO DEACTIVATE THE CHANNEL RECONFIGURATION HARDWARE  */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0665
*             RFY                                                  0665
*              (R14,                                               0665
*               R15) RSTD;          /* RESTRICT REGS         @Y30CQXA*/
*             R15=IOXCRHD;          /* ADDRESS OF DEACTIVATE ROUTINE
*                                                            @Y30CQXA*/
         L     @12,CVTPTR                                          0666
         L     @12,IOCOMPTR(,@12)                                  0666
         L     @12,IOCXPTR(,@12)                                   0666
         L     R15,IOXCRHD(,@12)                                   0666
*             GEN(BALR R14,R15);    /* GO DEACTIVATE CRH     @Y30CQXA*/
         BALR R14,R15
*CHNSON:                            /* EXIT POINT FOR ONLINE CHANNELS
*                                                            @Y30CQXA*/
*           END;                    /* END OF CRH PROCESSING FOR VARY
*                                      CHANNEL               @Y30CQXA*/
*       END;                        /* END OF CHANNEL COMMAND      0669
*                                      PROCESSING                    */
*                                                                  0669
*     /***************************************************************/
*     /*                                                             */
*     /* WAS NOT A VARY CHANNEL COMMAND. MUST THEN BE A VARY CPU     */
*     /* COMMAND                                                     */
*     /*                                                             */
*     /***************************************************************/
*                                                                  0670
*     ELSE                                                         0670
*       DO;                                                        0670
*                                                                  0670
         B     @RC00651                                            0670
@RF00651 DS    0H                                                  0671
*/****** DSPTCHK *************************************************   */
*/* DSPTCHK ROUTINE WILL SET UP CONDITIONS FOR REMOVING CPU FROM     */
*/* SYSTEM, PASS CONTROL TO QUIET CODE AND CLEAN UP SYSTEM AFTER     */
*/* CPU HAS BEEN REMOVED. ANY ERRORS WILL BE RETURNED TO NEXT HIGHER */
*/* LEVEL OF CONTROL.                                                */
*/****************************************************************   */
*                                                                  0671
*DSPTCHK:                                                          0671
*         ;                                                        0671
DSPTCHK  DS    0H                                                  0672
*         DO;                                                      0672
*                                                                  0672
*           /*********************************************************/
*           /*                                                       */
*           /* VERIFY THAT SYSTEM STATUS HAS NOT CHANGED SINCE       */
*           /* PROCESSING STARTED.                                   */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0673
*           IF SYSSTAT^=CSDCPUAL THEN/* SYSTEM STATUS CHANGED?       */
         L     @12,CVTPTR                                          0673
         L     @12,CVTCSD(,@12)                                    0673
         CLC   SYSSTAT(2),CSDCPUAL(@12)                            0673
         BE    @RF00673                                            0673
*             DO;                                                  0674
*               SYSFAIL='1'B;       /* SET SYSTEM STATUS ERROR       */
         OI    SYSFAIL,B'00000100'                                 0675
*               GOTO DSPTEXIT;      /* RETURN TO MAINLINE            */
         B     DSPTEXIT                                            0676
*             END;                                                 0677
*                                                                  0677
*           /*********************************************************/
*           /*                                                       */
*           /* INITIALIZE PARAMETERS FOR QUIET CODE                  */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0678
*           QUITPTR=ADDR(PARMAREA); /* ADDRESSABILITY FOR PARMS      */
@RF00673 LA    @06,PARMAREA                                        0678
         ST    @06,QUITPTR                                         0678
*           QTCPUAD=HEXCPUAD;       /* CPU ADDRESS                   */
         MVC   QTCPUAD(2,@06),HEXCPUAD                             0679
*           QTCPUMSK=CPUMSK;        /* CPU MASK                      */
*                                                                  0680
         MVC   QTCPUMSK(2,@06),CPUMSK                              0680
*           /*********************************************************/
*           /*                                                       */
*           /* SET TIMER TO CAUSE A TIMER INTERUPT AFTER ONE SECOND  */
*           /* TO CAUSE THE DISPATCHER TO RECEIVE CONTROL ON THE     */
*           /* ACTIVE CPU AFTER THE SUBJECT CPU HAS GONE OFFLINE.    */
*           /* THIS WILL CAUSE THE VALUE TO BE SET INTO THE ACTIVE   */
*           /* CPU'S TIMER, SINCE THE CLOCKS OF THE SCHEDULED OFFLINE*/
*           /* CPU HAVE BEEN MARKED BAD                              */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0681
*           GEN(STIMER  REAL,BINTVL=SEC1);/* CAUSE TIMER POP         */
*                                                                  0681
         STIMER  REAL,BINTVL=SEC1
*           /*********************************************************/
*           /*                                                       */
*           /* PLACE ADDRESS OF QUIET PARMS IN PSA OF CPU GOING      */
*           /* OFFLINE                                               */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0682
*           PCCAPTR=PCCAT00P(HEXCPUAD+1);/* ADDRESS OF SUBJECT CPU 0682
*                                      PCCA                          */
*                                                                  0682
         SLR   @06,@06                                             0682
         ICM   @06,3,HEXCPUAD                                      0682
         LR    @04,@06                                             0682
         SLA   @04,2                                               0682
         L     @01,CVTPTR                                          0682
         L     @01,CVTPCCAT(,@01)                                  0682
         L     @04,PCCAT00P(@04,@01)                               0682
         ST    @04,PCCAPTR                                         0682
*           /*********************************************************/
*           /*                                                       */
*           /* ASSUME WE ARE RUNNING ON CPU TO BE REMOVED. SET PSA   */
*           /* POINTER TO ZERO                                       */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0683
*           PSAPTR=0;               /* SET PSA POINTER TO ZERO       */
*                                                                  0683
         SLR   PSAPTR,PSAPTR                                       0683
*           /*********************************************************/
*           /*                                                       */
*           /* CHECK IF WE ARE OPERATING ON CPU TO GO OFFLINE        */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0684
*           IF PSACPUPA^=HEXCPUAD THEN/* ON DIFFERENT CPU?           */
         CH    @06,PSACPUPA(,PSAPTR)                               0684
         BE    @RF00684                                            0684
*             PSAPTR=PCCAPSAV;      /* ADDRESS OF SUBJECT CPU PSA    */
         L     PSAPTR,PCCAPSAV(,@04)                               0685
*           PSAWKVAP=QUITPTR;       /* STORE PARM ADDRESS            */
*                                                                  0686
@RF00684 MVC   PSAWKVAP(4,PSAPTR),QUITPTR                          0686
*           /*********************************************************/
*           /*                                                       */
*           /* PLACE POINTER TO QUIET CODE IN CVT FOR USE BY         */
*           /* DISPATCHER DURING TASK SWITCH                         */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0687
*           CVTQUIT=ADDR(IEEVQUIT); /* UPDATE CVT POINTER            */
*                                                                  0687
         L     @06,CVTPTR                                          0687
         L     @04,@CV03523                                        0687
         ST    @04,CVTQUIT(,@06)                                   0687
*           /*********************************************************/
*           /*                                                       */
*           /* SET DISPATCHER HOOK IN LCCA OF CPU TO GO OFFLINE      */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0688
*           LCCAPTR=LCCAT00P(HEXCPUAD+1);/* ADDRESSABILITY TO LCCA OF
*                                      SUBJECT CPU                   */
         SLR   @04,@04                                             0688
         ICM   @04,3,HEXCPUAD                                      0688
         SLA   @04,2                                               0688
         L     @01,CVTLCCAT(,@06)                                  0688
         L     @11,LCCAT00P(@04,@01)                               0688
         ST    @11,LCCAPTR                                         0688
*           LCCAVCPU='1'B;          /* SET DISPATCHER HOOK           */
*                                                                  0689
         OI    LCCAVCPU(@11),B'01000000'                           0689
*           /*********************************************************/
*           /*                                                       */
*           /* LOAD CPU ADDRESS AND CAUSE TASK SWITCH IN SUBJECT CPU */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0690
*           RFY                                                    0690
*            (R1) RSTD;             /* RESTRICT REG ONE              */
*           R1=PCCAT00P(HEXCPUAD+1);/* GET PCCA ADDRESS              */
         L     @06,CVTPCCAT(,@06)                                  0691
         L     R1,PCCAT00P(@04,@06)                                0691
*           GEN REFS(CVTIPCDS,CVTIPCRI,CVTIPCRP,CVT)               0692
*               ( RPSGNL  SWITCH,CPU=(1));/* CAUSE TASK SWITCH       */
          RPSGNL  SWITCH,CPU=(1)
*           RFY                                                    0693
*            (R1) UNRSTD;           /* RELEASE REG ONE               */
*                                                                  0693
*           /*********************************************************/
*           /*                                                       */
*           /* SET UP PSA POINTER TO POINT TO PSA OF CPU GOING       */
*           /* OFFLINE                                               */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0694
*           PCCAPTR=PCCAT00P(HEXCPUAD+1);/* PCCA OF OFFLINE CPU    0694
*                                                            @YM06029*/
         SLR   @06,@06                                             0694
         ICM   @06,3,HEXCPUAD                                      0694
         SLA   @06,2                                               0694
         L     @04,CVTPTR                                          0694
         L     @04,CVTPCCAT(,@04)                                  0694
         L     @06,PCCAT00P(@06,@04)                               0694
         ST    @06,PCCAPTR                                         0694
*           PSAPTR=PCCAPSAV;        /* VIRTUAL ADDRESS OF PSA      0695
*                                                            @YM06029*/
*                                                                  0695
         L     PSAPTR,PCCAPSAV(,@06)                               0695
*           /*********************************************************/
*           /*                                                       */
*           /* CHECK TO SEE IF SUBJECT CPU HAS BEEN MARKED DEAD IN   */
*           /* CSDCPUAL FIELD                                        */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0696
*           DO LOOPCNT=0 TO 20 WHILE((CSDCPUAL&CPUMSK)^=0);        0696
         SLR   @06,@06                                             0696
         ST    @06,LOOPCNT                                         0696
@DL00696 L     @06,CVTPTR                                          0696
         L     @06,CVTCSD(,@06)                                    0696
         SLR   @04,@04                                             0696
         ICM   @04,3,CPUMSK                                        0696
         SLR   @11,@11                                             0696
         ICM   @11,3,CSDCPUAL(@06)                                 0696
         NR    @04,@11                                             0696
         LTR   @04,@04                                             0696
         BZ    @DC00696                                            0696
*             GEN(STIMER  WAIT,BINTVL=SEC1);/* WAIT ONE SECOND       */
*                                                                  0697
         STIMER  WAIT,BINTVL=SEC1
*             /*******************************************************/
*             /*                                                     */
*             /* CHECK FOR A MACHINE CHECK OF CPU TO BE REMOVED      */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0698
*             IF PCCACPUM^='0'B THEN/* MACHINE CHECK?                */
         L     @06,PCCAPTR                                         0698
         TM    PCCACPUM(@06),B'10000000'                           0698
         BNZ   @RT00698                                            0698
*               GOTO DSPTMSG;       /* GO ISSUE MESSAGE              */
*           END;                    /* END OF WAIT LOOP              */
*                                                                  0700
         LA    @06,1                                               0700
         AL    @06,LOOPCNT                                         0700
         ST    @06,LOOPCNT                                         0700
         CH    @06,@CH00228                                        0700
         BNH   @DL00696                                            0700
@DC00696 DS    0H                                                  0701
*           /*********************************************************/
*           /*                                                       */
*           /* CPU HAS BEEN MARKED DEAD OR LOOP HAS GONE TO END CHECK*/
*           /* IF CPU HAS BEEN MARKED DEAD                           */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0701
*           IF(CSDCPUAL&CPUMSK)^=0 THEN/* CPU DEAD??                 */
         L     @06,CVTPTR                                          0701
         L     @06,CVTCSD(,@06)                                    0701
         SLR   @04,@04                                             0701
         ICM   @04,3,CPUMSK                                        0701
         SLR   @11,@11                                             0701
         ICM   @11,3,CSDCPUAL(@06)                                 0701
         NR    @04,@11                                             0701
         LTR   @04,@04                                             0701
         BZ    @RF00701                                            0701
*             DO;                                                  0702
*               LCCAVCPU='0'B;      /* RESET DISPATCHER HOOK         */
         L     @12,LCCAPTR                                         0703
         NI    LCCAVCPU(@12),B'10111111'                           0703
*               CPUNRESP='1'B;      /* SET CPU UNRESPONSIVE ERROR FLG*/
         OI    CPUNRESP,B'00010000'                                0704
*               GOTO DSPTEXIT;      /* RETURN TO HIGHER LEVEL        */
         B     DSPTEXIT                                            0705
*             END;                                                 0706
*                                                                  0706
*           /*********************************************************/
*           /*                                                       */
*           /* CHECK IF COMPLETE BIT HAS BEEN SET BY QUIT CODE       */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0707
*           IF QTCOMP^='1'B THEN    /* COMPLETE BIT SET?             */
@RF00701 L     @06,QUITPTR                                         0707
         TM    QTCOMP(@06),B'10000000'                             0707
         BO    @RF00707                                            0707
*             DO;                                                  0708
*                                                                  0708
*               /*****************************************************/
*               /*                                                   */
*               /* WAIT ONE SECOND FOR QUIET CODE TO COMPLETE AND SET*/
*               /* ERROR FLAG IF NOT FINISHED                        */
*               /*                                                   */
*               /*****************************************************/
*                                                                  0709
*               GEN(STIMER  WAIT,BINTVL=SEC1);/* WAIT ONE SECOND     */
         STIMER  WAIT,BINTVL=SEC1
*               IF QTCOMP^='1'B THEN/* COMPLETE NOW?                 */
         L     @06,QUITPTR                                         0710
         TM    QTCOMP(@06),B'10000000'                             0710
         BO    @RF00710                                            0710
*DSPTMSG:                                                          0711
*                 UNKNSTAT='1'B;    /* WRITE ERROR MESSAGE           */
DSPTMSG  OI    UNKNSTAT,B'00000100'                                0711
*             END;                  /* END OF COMPLETE CHECK         */
*                                                                  0712
*           /*********************************************************/
*           /*                                                       */
*           /* QUIET CODE HAS SET COMPLETE FLAG. CONTINUE PROCESSING */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0713
*           ELSE                                                   0713
*             CPUOFFOK='1'B;        /* SET OFFLINE OK FLAG           */
*                                                                  0713
         B     @RC00707                                            0713
@RF00707 OI    CPUOFFOK,B'00001000'                                0713
*           /*********************************************************/
*           /*                                                       */
*           /* IF VARY CPU,OFFLINE,KEEPCHAN (168MP),ACTIVATE CRH.    */
*           /* NOTE THAT THE CPU STATUS MAY BE UNKNOWN, BUT IN THAT  */
*           /* CASE CRH IS STILL NEEDED AND IF CRH ACTIVATION FAILS, */
*           /* AN ATTEMPT IS MADE TO BRING THE CPU BACK ONLINE.      */
*           /*                                               @G557P2L*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  0714
*           IF CPUCRH='1'B THEN                                    0714
@RC00707 TM    CPUCRH,B'00000001'                                  0714
         BNO   @RF00714                                            0714
*             DO;                   /* ACTIVATE CRH          @G557P2L*/
*               UNKNSTAT='0'B;      /* TURN OFF UNKNOWN STATUS. IF 0716
*                                      CRH FAILS AND UNABLE TO BRING
*                                      CPU BACK ON, ANOTHER MSG WILL
*                                      INDICATE UNKNOWN STATUS -   0716
*                                      RE-IPL.               @G557P2L*/
         NI    UNKNSTAT,B'11111011'                                0716
*               KPCHANFL='1'B;      /* SET IN CASE UNEXPECTED HAPPENS
*                                                            @ZM45610*/
         OI    KPCHANFL,B'01000000'                                0717
*               R15=IOXCRHA;        /* GET CRH ACTIVATION ADDRESS  0718
*                                                            @G557P2L*/
         L     @06,CVTPTR                                          0718
         L     @06,IOCOMPTR(,@06)                                  0718
         L     @06,IOCXPTR(,@06)                                   0718
         L     R15,IOXCRHA(,@06)                                   0718
*               GEN( BALR R14,R15); /* LINK TO CRH ACTIVATION      0719
*                                                            @G557P2L*/
          BALR R14,R15
*               IF RETCODE^=0&RETCODE^=4 THEN                      0720
         LTR   RETCODE,RETCODE                                     0720
         BZ    @RF00720                                            0720
         CH    RETCODE,@CH00076                                    0720
         BE    @RF00720                                            0720
*                 DO;               /* CRH FAILED?           @G557P2L*/
*                   PARMAREA=''B;   /* ZERO OUT IEEVWKUP'S PARMS   0722
*                                                            @ZM45610*/
         XC    PARMAREA(109),PARMAREA                              0722
*                   CALL ONLINEP;   /* BRING CPU BACK ONLINE @G557P2L*/
         BAL   @14,ONLINEP                                         0723
*                   CPUONOK='0'B;   /* RESET ONLINE OKAY FLAG @G5572L*/
         NI    CPUONOK,B'10111111'                                 0724
*                   GOTO OFFEXIT;   /* GET OUT - UNSUCCESSFUL CRH  0725
*                                                            @G557P2L*/
         B     OFFEXIT                                             0725
*                 END;              /* END CRH FAILED        @G557P2L*/
*               ELSE                                               0727
*                 KPCHANFL='0'B;    /* CRH OKAY              @ZM45610*/
@RF00720 NI    KPCHANFL,B'10111111'                                0727
*             END;                  /* END CPUCRH TEST       @G557P2L*/
*                                                                  0728
*           /*********************************************************/
*           /*                                                       */
*           /* CLEAN UP REMAINING STORAGE AREAS                      */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0729
*           DO;                                                    0729
*                                                                  0729
@RF00714 DS    0H                                                  0730
*/******** GTFOFF ************************************************** */
*/* GTFOFF EXIT WILL FREE ANY REMAINING GTF AREAS AFTER A CPU HAS    */
*/* BEEN REMOVED FROM THE SYSTEM. INPUT TO ROUTINE IS CPU ADDRESS    */
*/* IN REGISTER ONE AND SAVE AREA POINTED TO BY REG 13               */
*/********************************************************************/
*                                                                  0730
*             RFY                                                  0730
*              (R1) RSTD;           /* RELEASE REG ONE FOR INTERFACE */
*             R1=HEXCPUAD;          /* LOAD CPU ADDRESS              */
*                                                                  0731
         SLR   R1,R1                                               0731
         ICM   R1,3,HEXCPUAD                                       0731
*             /*******************************************************/
*             /*                                                     */
*             /* LINK TO GTF STORAGE FREE ROUTINE                    */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0732
*             GEN(LINK EP=AHLVCOFF);                               0732
         LINK EP=AHLVCOFF
*             RFY                                                  0733
*              (R1) UNRSTD;         /* RELEASE REG ONE               */
*                                                                  0733
*             /*******************************************************/
*             /*                                                     */
*             /* NO RETURN CODES ARE RETURNED FROM GTF ROUTINE       */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0734
*           END;                    /* ** END OF GTF OFF ROUTINE     */
*           DO;                                                    0735
*                                                                  0735
*/****** FREEMCEL ************************************************** */
*/* FREEMCEL ROUTINE WILL FREE THE EXTENDED MACHINE CHECK LOGOUT     */
*/* AREA OF THE CPU TO BE REMOVED FROM THE SYSTEM. ROUTINE IS LINKED */
*/* TO FROM MAINLINE. ANY ERRORS ARE IGNORED                         */
*/****************************************************************** */
*                                                                  0736
*             RFY                                                  0736
*              (R0,                                                0736
*               R1,                                                0736
*               R14,                                               0736
*               R15) RSTD;          /* RESTRICT REGISTERS            */
*                                                                  0736
*             /*******************************************************/
*             /*                                                     */
*             /* SET UP FUNCTION CODE AND CPU ADDRESS FOR RMS        */
*             /* INTERFACE                                           */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0737
*             R0=4;                 /* LOAD FUNCTION CODE            */
         LA    R0,4                                                0737
*             R1=HEXCPUAD;          /* LOAD CPU ADDRESS              */
         SLR   R1,R1                                               0738
         ICM   R1,3,HEXCPUAD                                       0738
*             R15=RVTPBUCR;         /* LOAD ADDRESS OF RMS INTERFACE */
*                                                                  0739
         L     @06,CVTPTR                                          0739
         L     @06,RVTPTR(,@06)                                    0739
         L     R15,RVTPBUCR(,@06)                                  0739
*             /*******************************************************/
*             /*                                                     */
*             /* LINK TO RMS ROUTINE                                 */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0740
*             GEN(BALR 14,15);      /* LINK TO RMS                   */
         BALR 14,15
*             RFY                                                  0741
*              (R0,                                                0741
*               R1,                                                0741
*               R14,                                               0741
*               R15) UNRSTD;        /* RELEASE REGISTERS             */
*           END;                    /* ** END OF FREEMCEL ROUTINE    */
*           CALL SAVARSUB;          /* FREE CPU RELATED SAVE AREAS   */
         BAL   @14,SAVARSUB                                        0743
*           CPFAILED='0'B;          /* IGNORE ANY ERRORS FROM FREE   */
*                                                                  0744
         NI    CPFAILED,B'11111011'                                0744
*           /*********************************************************/
*           /*                                                       */
*           /* FREE FRR STACKS RELATED TO THIS CPU. ROUND ADDRESS    */
*           /* DOWN TO 8 BYTE MULTIPLE FOR FREE                      */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0745
*           COREPTR=(PSASSTK&'FFFFFFF8'X);/* ROUND DOWN              */
         L     @06,PSASSTK(,PSAPTR)                                0745
         N     @06,@CF03706                                        0745
         ST    @06,COREPTR                                         0745
*           SUBPOOL=245;            /* SUBPOOL NUMBER TO FREE        */
         MVI   SUBPOOL,X'F5'                                       0746
*           GETLENG=YSTAKLEN;       /* LENGTH TO FREE                */
         MVC   GETLENG(2),@CH02073                                 0747
*           CALL FREECORE;          /* FREE OLD FRR STACKS           */
*                                                                  0748
         BAL   @14,FREECORE                                        0748
*           /*********************************************************/
*           /*                                                       */
*           /* GO FREE CPU'S PSA                                     */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0749
*           CALL PSAFREE;           /* FREE PSA                      */
         BAL   @14,PSAFREE                                         0749
*           IF CPUCRH^='1'B THEN    /* FREE PSA IF CPUCRH='1'B ALSO.
*                                                            @ZM45599*/
*                                                                  0750
         TM    CPUCRH,B'00000001'                                  0750
         BO    @RF00750                                            0750
*             /*******************************************************/
*             /*                                                     */
*             /* IF LOST OF CPU CAUSED LOST OF PATHS INFORM MSS THAT */
*             /* A CPU HAS BEEN REMOVED FROM SYSTEM          @G557P2L*/
*             /*                                                     */
*             /*******************************************************/
*                                                                  0751
*             CALL DISASSOC;        /* GO DISASSOCIATE CPU'S @ZM30463*/
         BAL   @14,DISASSOC                                        0751
*DSPTEXIT:                                                         0752
*         END;                      /* END OF DSPTCHK ROUTINE        */
@RF00750 DS    0H                                                  0752
DSPTEXIT DS    0H                                                  0753
*       END;                                                       0753
*   END;                            /* ** END OF OFFLINE DO GROUP    */
*OFFEXIT:                                                          0755
*   END;                            /* END OF OFFLINE PROC           */
@EL00002 DS    0H                                                  0755
@EF00002 DS    0H                                                  0755
@ER00002 LM    @14,@12,@SA00002                                    0755
         BR    @14                                                 0755
*ONLINEP:                                                          0756
*   PROC;                                                          0756
*                                                                  0756
ONLINEP  STM   @14,@12,@SA00003                                    0756
*/****** ONLINE **************************************************** */
*/* ONLINE ROUTINE WILL ROUTE CONTROL TO ROUTINES TO LOGICALLY ADD   */
*/* EITHER A CHANNEL OR CPU TO THE SYSTEM. EACH ROUTINE WILL MONITOR */
*/* ANY ROUTINE OPERATING BELOW IT AND ANY ERROR THAT IS FOUND WILL  */
*/* BE PERCULATED TO THE NEXT HIGHER LEVEL OF CONTROL                */
*/********************************************************************/
*                                                                  0757
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK IF THIS IS A CHANNEL COMMAND                            */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0757
*   IF CHNIND='1'B THEN             /* CHANNEL COMMAND?              */
         TM    CHNIND,B'10000000'                                  0757
         BNO   @RF00757                                            0757
*/****** CHANON **************************************************** */
*/* CHANON ROUTINE WILL PASS CONTROL TO THE CAT TABLE INITIALIZATION */
*/* ROUTINE TO TEST A CHANNEL AND MARK IT ONLINE. POSSIBLE ERROR     */
*/* INDICATORS ARE: CHNTOPER, CPFAILED,CHONLINE                      */
*/****************************************************************** */
*                                                                  0758
*     DO;                                                          0758
*                                                                  0758
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK IF THIS IS A CRH VARY AND IF SO PERFORM SPECIAL     */
*       /* PROCESSING REQUIRED FOR REMOTE CHANNELS                   */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0759
*       IF CRH='1'B THEN            /* CRH VARY?             @Y30CQXA*/
         TM    CRH,B'00000010'                                     0759
         BNO   @RF00759                                            0759
*         DO;                       /*                       @Y30CQXA*/
*                                                                  0760
*           /*********************************************************/
*           /*                                                       */
*           /* CHECK IF A PCCA EXISTS FOR THE SUBJECT CPU AND IF NOT */
*           /* OBTAIN NEW PCCA WITH ALL CHANNELS MARKED OFFLINE      */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0761
*           IF NOPCCA='1'B THEN     /* PCCA EXIST?           @Y30CQXA*/
         TM    NOPCCA,B'00100000'                                  0761
         BNO   @RF00761                                            0761
*             CALL PSACCA;          /* GO GET NEW PCCA       @Y30CQXA*/
*                                                                  0762
         BAL   @14,PSACCA                                          0762
*           /*********************************************************/
*           /*                                                       */
*           /* CHECK IF SUBJECT CHANNEL IS ALREADY ONLINE            */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0763
*           PCCAPTR=PCCAT00P(HEXCPUAD+1);/* PCCA ADDRESS     @Y30CQXA*/
@RF00761 SLR   @11,@11                                             0763
         ICM   @11,3,HEXCPUAD                                      0763
         SLA   @11,2                                               0763
         L     @06,CVTPTR                                          0763
         L     @06,CVTPCCAT(,@06)                                  0763
         L     @11,PCCAT00P(@11,@06)                               0763
         ST    @11,PCCAPTR                                         0763
*           CATPTR=ADDR(PCCACAT)+(8*HEXCHNAD);/* CAT ENTRY ADDRESS 0764
*                                                            @Y30CQXA*/
*                                                                  0764
         LA    CATPTR,PCCACAT(,@11)                                0764
         SLR   @06,@06                                             0764
         ICM   @06,3,HEXCHNAD                                      0764
         SLA   @06,3                                               0764
         ALR   CATPTR,@06                                          0764
*           /*********************************************************/
*           /*                                                       */
*           /* CHECK IF CHANNEL IS ALREADY ONLINE                    */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0765
*           IF CATNOP='0'B THEN     /* CHANNEL ONLINE?       @Y30CQXA*/
         TM    CATNOP(CATPTR),B'01000000'                          0765
         BNZ   @RF00765                                            0765
*             DO;                   /*                       @Y30CQXA*/
*               CHISON='1'B;        /* SET ALREADY ONLINE FOOTPRINT
*                                                            @Y30CQXA*/
         OI    CHISON,B'00001000'                                  0767
*               GOTO CHONEXIT;      /* EXIT                  @Y30CQXA*/
         B     CHONEXIT                                            0768
*             END;                  /*                       @Y30CQXA*/
*                                                                  0769
*           /*********************************************************/
*           /*                                                       */
*           /* CALL IOS ROUTINE TO ISSUE STIDC INSTRUCTION FOR       */
*           /* CHANNEL ON OFFLINE CPU.                               */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0770
*           RFY                                                    0770
*            (R1,                                                  0770
*             R14,                                                 0770
*             R15) RSTD;            /* RESTRICT REGISTERS    @Y30CQXA*/
@RF00765 DS    0H                                                  0771
*           R1=HEXCHNAD*256;        /* CHANNEL ADDRESS       @Y30CQXA*/
         SLR   R1,R1                                               0771
         ICM   R1,3,HEXCHNAD                                       0771
         SLA   R1,8                                                0771
*           R15=IOXSTIDC;           /* ADDRESS OF STIDC ROUTINE    0772
*                                                            @Y30CQXA*/
         L     @11,CVTPTR                                          0772
         L     @11,IOCOMPTR(,@11)                                  0772
         L     @11,IOCXPTR(,@11)                                   0772
         L     R15,IOXSTIDC(,@11)                                  0772
*           GEN(BALR R14,R15);      /* LINK TO IOS           @Y30CQXA*/
*                                                                  0773
         BALR R14,R15
*           /*********************************************************/
*           /*                                                       */
*           /* ON RETURN THE CONDITION CODE FROM THE STIDC           */
*           /* INSTRUCTION WILL BE IN THE HIGH ORDER BYTE OF REGISTER*/
*           /* 1                                                     */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0774
*           TEMPWORK=R1;            /* STORE R1 CONTENTS     @Y30CQXA*/
         ST    R1,TEMPWORK                                         0774
*           RFY                                                    0775
*            (R1,                                                  0775
*             R14,                                                 0775
*             R15) UNRSTD;          /* RELEASE REGS          @Y30CQXA*/
*                                                                  0775
*           /*********************************************************/
*           /*                                                       */
*           /* CHECK FOR CONDITION CODE 3 RETURN FROM STIDC          */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0776
*           IF CCBIT1='1'B&CCBIT2='1'B THEN/* CC = 3?        @Y30CQXA*/
         TM    CCBIT1,B'00110000'                                  0776
         BNO   @RF00776                                            0776
*             DO;                   /*                       @Y30CQXA*/
*               CHNTOPER='1'B;      /* SET ERROR FLAG        @Y30CQXA*/
         OI    CHNTOPER,B'00000001'                                0778
*               GOTO CHONEXIT;      /* RETURN TO MAINLINE    @Y30CQXA*/
         B     CHONEXIT                                            0779
*             END;                  /*                       @Y30CQXA*/
*                                                                  0780
*           /*********************************************************/
*           /*                                                       */
*           /* CONDITION CODE WAS NOT 3, MARK CHANNEL ONLINE         */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0781
*           CATNOP='0'B;            /* MARK CHANNEL ONLINE   @Y30CQXA*/
*                                                                  0781
@RF00776 NI    CATNOP(CATPTR),B'10111111'                          0781
*           /*********************************************************/
*           /*                                                       */
*           /* IF CONDITION CODE WAS ZERO, THEN MOVE CHANNEL ID      */
*           /* INFORMATION INTO CAT AND RESET ID INVALID BIT         */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0782
*           IF CCBIT1^='1'B&CCBIT2^='1'B THEN/* CC=0?        @Y30CQXA*/
         TM    CCBIT1,B'00110000'                                  0782
         BNZ   @RF00782                                            0782
*             DO;                   /*                       @Y30CQXA*/
*                                                                  0783
*               /*****************************************************/
*               /*                                                   */
*               /* RESET INVALID BIT, AND MOVE ID INFORMATION IN     */
*               /*                                                   */
*               /*****************************************************/
*                                                                  0784
*               CATCHID=FLCCHNID;   /* MOVE CHANNEL ID INFORMATION IN
*                                                            @Y30CQXA*/
         MVC   CATCHID(4,CATPTR),FLCCHNID(PSAPTR)                  0784
*               CATNID='0'B;        /* MARK ID VALID         @Y30CQXA*/
         NI    CATNID(CATPTR),B'11110111'                          0785
*             END;                  /*                       @Y30CQXA*/
*                                                                  0786
*           /*********************************************************/
*           /*                                                       */
*           /* CHECK IF CRH IS ALREADY ACTIVE. AND IF NOT ACTIVATE   */
*           /* CRH.                                                  */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0787
*           IF CVTCRCA=0 THEN       /* CRH ACTIVE?           @Y30CQXA*/
@RF00782 L     @12,CVTPTR                                          0787
         ICM   @11,15,CVTCRCA(@12)                                 0787
         BNZ   @RF00787                                            0787
*             DO;                   /*                       @Y30CQXA*/
*               CALL AINIT;         /* MSS ASSOCIATE ROUTINE @Y30LPXA*/
         BAL   @14,AINIT                                           0789
*               RFY                                                0790
*                (R1,                                              0790
*                 R14,                                             0790
*                 R15) RSTD;        /* RESTRICT REGS         @Y30CQXA*/
*               R1=PCCAT00P(HEXCPUAD+1);/* CPU ADDRESS       @Y30CQXA*/
         SLR   @12,@12                                             0791
         ICM   @12,3,HEXCPUAD                                      0791
         SLA   @12,2                                               0791
         L     @11,CVTPTR                                          0791
         L     @11,CVTPCCAT(,@11)                                  0791
         L     R1,PCCAT00P(@12,@11)                                0791
*               GEN(DSGNL ICPUR,CPU=(1));/* RESET CPU        @Y30CQXA*/
*                                                                  0792
         DSGNL ICPUR,CPU=(1)
*               /*****************************************************/
*               /*                                                   */
*               /* SET ACTIVATION FILED ERROR FLAG IN CASE OF ERROR  */
*               /* DURING LINK                                       */
*               /*                                                   */
*               /*****************************************************/
*                                                                  0793
*               CRHFAIL='1'B;       /* SET ERROR FLAG        @Y30CQXA*/
*                                                                  0793
         OI    CRHFAIL,B'10000000'                                 0793
*               /*****************************************************/
*               /*                                                   */
*               /* CALL IOS ROUTINE TO ACTIVATE CRH.                 */
*               /*                                                   */
*               /*****************************************************/
*                                                                  0794
*               R15=IOXCRHA;        /* ADDRESS OF ACTIVATE ROUTINE 0794
*                                                            @Y30CQXA*/
         L     @12,CVTPTR                                          0794
         L     @12,IOCOMPTR(,@12)                                  0794
         L     @12,IOCXPTR(,@12)                                   0794
         L     R15,IOXCRHA(,@12)                                   0794
*               GEN(BALR R14,R15);  /* LINK TO IOS           @Y30CQXA*/
*                                                                  0795
         BALR R14,R15
*               /*****************************************************/
*               /*                                                   */
*               /* CHECK IF ACTIVATED OK.                            */
*               /*                                                   */
*               /*****************************************************/
*                                                                  0796
*               IF RETCODE^=0&RETCODE^=4 THEN/* ERROR?       @Y30CQXA*/
         LTR   RETCODE,RETCODE                                     0796
         BZ    @RF00796                                            0796
         CH    RETCODE,@CH00076                                    0796
         BE    @RF00796                                            0796
*                 DO;                                              0797
*                                                                  0797
*                   /*************************************************/
*                   /*                                               */
*                   /* CRH NOT ACTIVATED. CANCEL ASSOCIATE JUST DONE,*/
*                   /* AND SET ERROR FLAG FOR CLEANUP ROUTINE        */
*                   /*                                               */
*                   /*************************************************/
*                                                                  0798
*                   CALL DISASSOC;  /* CALL DISASSOC ROUTINE @Y30LPXA*/
         BAL   @14,DISASSOC                                        0798
*                   CATNOP='1'B;    /* MARK CHANNEL OFFLINE  @Y30CQXA*/
         OI    CATNOP(CATPTR),B'01000000'                          0799
*                   GOTO CHONEXIT;  /* EXIT                  @Y30CQXA*/
         B     CHONEXIT                                            0800
*                 END;                                             0801
*                                                                  0801
*               /*****************************************************/
*               /*                                                   */
*               /* PROCESSING WAS SUCESSFUL RESET ERROR FLAG         */
*               /*                                                   */
*               /*****************************************************/
*                                                                  0802
*               CRHFAIL='0'B;       /* RESET ERROR FLAG      @Y30CQXA*/
@RF00796 NI    CRHFAIL,B'01111111'                                 0802
*             END;                  /* END OF CRH PROCESSING @Y30CQXA*/
*         END;                      /* END OF CRH DO GROUP   @Y30CQXA*/
*                                                                  0804
*       /*************************************************************/
*       /*                                                           */
*       /* WAS NOT A CRH VARY. MUST THEN BE A NORMAL CHANNEL VARY    */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0805
*       ELSE                        /*                       @Y30CQXA*/
*         DO;                       /*                       @Y30CQXA*/
*                                                                  0805
         B     @RC00759                                            0805
@RF00759 DS    0H                                                  0806
*           /*********************************************************/
*           /*                                                       */
*           /* SET UP ADDRESSABILITY TO CAT ENTRY FOR SPECIFIC       */
*           /* CHANNEL AND DETERMINE IF CHANNEL IS ALREADY ONLINE    */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0806
*           PCCAPTR=PCCAT00P(HEXCPUAD+1);/* GET PCCA ADDRESS         */
         SLR   @12,@12                                             0806
         ICM   @12,3,HEXCPUAD                                      0806
         SLA   @12,2                                               0806
         L     @11,CVTPTR                                          0806
         L     @11,CVTPCCAT(,@11)                                  0806
         L     @12,PCCAT00P(@12,@11)                               0806
         ST    @12,PCCAPTR                                         0806
*           CATPTR=ADDR(PCCACAT)+(8*HEXCHNAD);/* CAT ENTRY ADDRESS   */
*                                                                  0807
         LA    CATPTR,PCCACAT(,@12)                                0807
         SLR   @12,@12                                             0807
         ICM   @12,3,HEXCHNAD                                      0807
         SLA   @12,3                                               0807
         ALR   CATPTR,@12                                          0807
*           /*********************************************************/
*           /*                                                       */
*           /* CHECK TO DETERMINE IF CHANNEL IS ALREADY ONLINE       */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0808
*           IF CATNOP='0'B THEN     /* CHANNEL ONLINE?               */
         TM    CATNOP(CATPTR),B'01000000'                          0808
         BNZ   @RF00808                                            0808
*             CHISON='1'B;          /* SET ONLINE MESSAGE            */
         OI    CHISON,B'00001000'                                  0809
*           ELSE                                                   0810
*             DO;                                                  0810
*                                                                  0810
         B     @RC00808                                            0810
@RF00808 DS    0H                                                  0811
*               /*****************************************************/
*               /*                                                   */
*               /* CHANNEL WAS NOT ALREADY ONLINE, INITIALIZE        */
*               /* PARAMETERS TO PASS TO CAT TABLE INIT ROUTINE      */
*               /*                                                   */
*               /*****************************************************/
*                                                                  0811
*               CHNADDR=(HEXCHNAD*256);/* PASS CHANNEL ADDRESS       */
*                                                                  0811
         SLR   CHNADDR,CHNADDR                                     0811
         ICM   CHNADDR,3,HEXCHNAD                                  0811
         SLA   CHNADDR,8                                           0811
*               /*****************************************************/
*               /*                                                   */
*               /* PASS CONTROL TO WAKEUP ROUTINE TO TEST CHANNEL AND*/
*               /* INIT CAT TABLE                                    */
*               /*                                                   */
*               /*****************************************************/
*                                                                  0812
*               RFY                                                0812
*                (R1,                                              0812
*                 R11,                                             0812
*                 R12,                                             0812
*                 R14,                                             0812
*                 R15) RSTD;        /* RESTRICT REGISTERS FOR IPC    */
*               R11=CHNADDR;        /* POINTER TO PARAMETERS @ZA05995*/
         LR    R11,CHNADDR                                         0813
*               R12=ADDR(IEEVTCH);  /* ADDRESS OF WAKEUP CODE        */
         L     R12,@CV03521                                        0814
*               R1=PCCAPTR;         /* PCCA ADDRESS OF SUBJECT CPU   */
         L     R1,PCCAPTR                                          0815
*               GEN(RISGNL SERIAL,CPU=(1),EP=(12),PARM=(11));/*    0816
*                                      ACTIVATE TCH ROUTINE          */
*                                                                  0816
         RISGNL SERIAL,CPU=(1),EP=(12),PARM=(11)
*               /*****************************************************/
*               /*                                                   */
*               /* CONTROL WILL BE RETURNED EITHER AFTER COMPLETING  */
*               /* TEST OR WITH A RETURN CODE INDICATING THAT THIS IS*/
*               /* A UNIPROCESSOR IN WHICH CASE A DIRECT BRANCH TO   */
*               /* THE ROUTINE WILL BE TAKEN                         */
*               /*                                                   */
*               /*****************************************************/
*                                                                  0817
*               RFY                                                0817
*                (R1,                                              0817
*                 R11,                                             0817
*                 R12,                                             0817
*                 R14,                                             0817
*                 R15) UNRSTD;      /* RELEASE REGISTERS             */
*               RFY                                                0818
*                (RETCODE) RSTD;    /* RESTRICT RETURN CODE REG      */
*                                                                  0818
*               /*****************************************************/
*               /*                                                   */
*               /* CHECK FOR A UNIPROCESSOR                          */
*               /*                                                   */
*               /*****************************************************/
*                                                                  0819
*               IF RETCODE=16 THEN  /* ONE CPU?                      */
         CH    RETCODE,@CH00055                                    0819
         BNE   @RF00819                                            0819
*                 DO;                                              0820
*                                                                  0820
*                   /*************************************************/
*                   /*                                               */
*                   /* WE ARE RUNNING ON A UNIPROCESSOR. SAVE ALL    */
*                   /* REGISTERS AND BRANCH TO WAKEUP CODE. ONLY     */
*                   /* REGISTER SAVED IS REGISTER 13                 */
*                   /*                                               */
*                   /*************************************************/
*                                                                  0821
*                   RFY                                            0821
*                    (R1,                                          0821
*                     R14,                                         0821
*                     R15) RSTD;    /* RESTRICT LINK REGISTERS       */
*                   R1=CHNADDR;     /* POINT TO PARAMETERS FOR     0822
*                                      ROUTINE               @ZA05995*/
         LR    R1,CHNADDR                                          0822
*                   R14=ADDR(REGSAVEA);/* ADDRESS OF SAVE AREA       */
         LA    R14,REGSAVEA                                        0823
*                   R15=ADDR(IEEVTCH);/* ADDRESS OF TEST CHANNEL   0824
*                                      ENTRY POINT                   */
*                                                                  0824
         L     R15,@CV03521                                        0824
*                   /*************************************************/
*                   /*                                               */
*                   /* SAVE ALL REGISTERS IN SAVE AREA, AND KEEP     */
*                   /* ADDRESS OF SAVE AREA IN REGISTER 13 WHICH IS  */
*                   /* NOT TOUCHED ACROSS CALL. RESTORE ALL REGISTERS*/
*                   /* ON RETURN                                     */
*                   /*                                               */
*                   /*************************************************/
*                                                                  0825
*                   GENERATE;                                      0825
        STM   R0,R15,0(R14)           SAVE ALL REGISTERS
        LR    R13,R14                 SAVE ADDRESS OF SAVE AREA
        BALR  R14,R15                 LINK TO ROUTINE
        LM    R0,R15,0(R13)           RESTORE ALL REGISTERS
*                   RFY                                            0826
*                    (R1,                                          0826
*                     R14,                                         0826
*                     R15) UNRSTD;  /* RELEASE REGISTERS             */
*                 END;              /* END OF UNIPROCESSOR PROCESSING*/
*               ELSE                                               0828
*                                                                  0828
*                 /***************************************************/
*                 /*                                                 */
*                 /* WAS NOT UNIPROCESSOR. CHECK FOR SUCCESSFUL      */
*                 /* EXECUTION                                       */
*                 /*                                                 */
*                 /***************************************************/
*                                                                  0828
*                 IF RETCODE^=0 THEN/* SUCCESSFUL?                   */
         B     @RC00819                                            0828
@RF00819 LTR   RETCODE,RETCODE                                     0828
         BZ    @RF00828                                            0828
*                   DO;                                            0829
*                     CPFAILED='1'B;/* SET ERROR FLAG                */
         OI    CPFAILED,B'00000100'                                0830
*                     GOTO CHONEXIT;/* RETURN TO NEXT LEVEL          */
         B     CHONEXIT                                            0831
*                   END;                                           0832
*                                                                  0832
*               /*****************************************************/
*               /*                                                   */
*               /* CONTROL HAS RETURNED FROM WAKEUP ROUTINE. VERIFY  */
*               /* THAT CHANNEL HAS BEEN MARKED ONLINE               */
*               /*                                                   */
*               /*****************************************************/
*                                                                  0833
*               IF CATNOP='1'B THEN /* CHANNEL OFFLINE               */
@RF00828 DS    0H                                                  0833
@RC00819 TM    CATNOP(CATPTR),B'01000000'                          0833
         BNO   @RF00833                                            0833
*                 DO;                                              0834
*                   CHNTOPER='1'B;  /* SET CHANNEL NOT OPER MSG      */
         OI    CHNTOPER,B'00000001'                                0835
*                   GOTO CHONEXIT;  /* RETURN TO NEXT LEVEL          */
         B     CHONEXIT                                            0836
*                 END;                                             0837
*             END;                                                 0838
@RF00833 DS    0H                                                  0839
*         END;                      /*                       @Y30CQXA*/
*                                                                  0839
@RC00808 DS    0H                                                  0840
*       /*************************************************************/
*       /*                                                           */
*       /* CHANNEL HAS BEEN MARKED ONLINE, PROCESS ANY DEVICES THAT  */
*       /* SHOULD BE BROUGHT ONLINE                                  */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0840
*       CHONOK='1'B;                /* INDICATE CHANNEL ONLINE       */
@RC00759 OI    CHONOK,B'00100000'                                  0840
*       CALL DEVCHK;                /* GO TO DEVCHECK ROUTINE        */
         BAL   @14,DEVCHK                                          0841
*       CHONLINE='1'B;              /* SET ONLINE FOOTPRINT          */
         OI    CHONLINE,B'00000010'                                0842
*CHONEXIT:                                                         0843
*     END;                                                         0843
*   ELSE                                                           0844
*                                                                  0844
*     /***************************************************************/
*     /*                                                             */
*     /* WAS NOT A CHANNEL COMMAND. MUST THEN BE A CPU COMMAND       */
*     /*                                                             */
*     /***************************************************************/
*                                                                  0844
*     DO;                                                          0844
*                                                                  0844
         B     @RC00757                                            0844
@RF00757 DS    0H                                                  0845
*       /*************************************************************/
*       /*                                                           */
*       /* DETERMINE IF THE SUBJECT CPU IS ALREADY ONLINE            */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0845
*       IF(CSDCPUAL&CPUMSK)^=0 THEN /* CPU ONLINE ALREADY?           */
         L     @14,CVTPTR                                          0845
         L     @14,CVTCSD(,@14)                                    0845
         SLR   @06,@06                                             0845
         ICM   @06,3,CPUMSK                                        0845
         SLR   @04,@04                                             0845
         ICM   @04,3,CSDCPUAL(@14)                                 0845
         NR    @06,@04                                             0845
         LTR   @06,@06                                             0845
         BZ    @RF00845                                            0845
*         CPUISON='1'B;             /* SET ONLINE FLAG               */
*                                                                  0846
         OI    CPUISON,B'00010000'                                 0846
*       /*************************************************************/
*       /*                                                           */
*       /* CPU WAS NOT ONLINE. NEEDS TO BE BROUGHT ONLINE. SET UP TO */
*       /* BRING CPU ONLINE                                          */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0847
*       ELSE                                                       0847
*         DO;                                                      0847
*                                                                  0847
         B     @RC00845                                            0847
@RF00845 DS    0H                                                  0848
*           /*********************************************************/
*           /*                                                       */
*           /* CPU WAS NOT ONLINE. NEEDS TO BE BROUGHT ONLINE        */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0848
*           DO;                                                    0848
*                                                                  0848
*/****** PREPARE *****************************************************/
*/* PREPARE ROUTINE WILL OBTAIN AND INITIALIZE ALL NECESSARY STORAGE */
*/* AREAS REQUIRED FOR A NEW CPU COMING ONLINE. ADDITIONALLY THE     */
*/* RESTART RESOURCE WILL BE OBTAINED AND A RESTART PSW SET UP TO    */
*/* POINT TO VARY CPU WAKE UP CODE RESIDENT IN THE SYSTEM NUCELUS    */
*/********************************************************************/
*                                                                  0849
*             /*******************************************************/
*             /*                                                     */
*             /* SET UP POINTERS FOR SUBJECT CPU IF THEY EXIST FROM  */
*             /* BEFORE                                              */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0849
*             LCCAPTR=LCCAT00P(HEXCPUAD+1);/* SET LCCA POINTER       */
         SLR   @14,@14                                             0849
         ICM   @14,3,HEXCPUAD                                      0849
         SLA   @14,2                                               0849
         L     @06,CVTPTR                                          0849
         L     @04,CVTLCCAT(,@06)                                  0849
         L     @04,LCCAT00P(@14,@04)                               0849
         ST    @04,LCCAPTR                                         0849
*             PCCAPTR=PCCAT00P(HEXCPUAD+1);/* SET PCCA POINTER       */
*                                                                  0850
         L     @06,CVTPCCAT(,@06)                                  0850
         L     @14,PCCAT00P(@14,@06)                               0850
         ST    @14,PCCAPTR                                         0850
*             /*******************************************************/
*             /*                                                     */
*             /* CHECK IF POINTERS EXIST                             */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0851
*             IF PCCAPTR=0&LCCAPTR=0 THEN/* EXIST ?                  */
*                                                                  0851
         SLR   @06,@06                                             0851
         CR    @14,@06                                             0851
         BNE   @RF00851                                            0851
         CR    @04,@06                                             0851
         BE    @RT00851                                            0851
*               /*****************************************************/
*               /*                                                   */
*               /* IF OLD CCA'S DO NOT EXIST THEN GO DIRECTLY TO     */
*               /* OBTAIN NEW AREAS                                  */
*               /*                                                   */
*               /*****************************************************/
*                                                                  0852
*               GOTO GETPSA;        /* GO OBTAIN NEW STORAGE AREAS   */
*                                                                  0852
*             /*******************************************************/
*             /*                                                     */
*             /* CCA'S EXIST FOR CPU, CHECK IF PSA EXISTS AND IF SO  */
*             /* FREE ANY STORAGE AREAS ASSOCIATED WITH IT.          */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0853
*             IF PCCAPSAV^=0 THEN   /* PSA EXIST?                    */
@RF00851 L     @14,PCCAPTR                                         0853
         L     @14,PCCAPSAV(,@14)                                  0853
         LTR   @14,@14                                             0853
         BZ    @RF00853                                            0853
*               DO;                                                0854
*                 PSAPTR=PCCAPSAV;  /* POINT TO PSA TO BE FREED      */
*                                                                  0855
         LR    PSAPTR,@14                                          0855
*                 /***************************************************/
*                 /*                                                 */
*                 /* FREE EXTENDED LOGOUT AREAS                      */
*                 /*                                                 */
*                 /***************************************************/
*                                                                  0856
*                 DO;                                              0856
*                                                                  0856
*/****** FREEMCEL ************************************************** */
*/* FREEMCEL ROUTINE WILL FREE THE EXTENDED MACHINE CHECK LOGOUT     */
*/* AREA OF THE CPU TO BE REMOVED FROM THE SYSTEM. ROUTINE IS LINKED */
*/* TO FROM MAINLINE. ANY ERRORS ARE IGNORED                         */
*/****************************************************************** */
*                                                                  0857
*                   RFY                                            0857
*                    (R0,                                          0857
*                     R1,                                          0857
*                     R14,                                         0857
*                     R15) RSTD;    /* RESTRICT REGISTERS            */
*                                                                  0857
*                   /*************************************************/
*                   /*                                               */
*                   /* SET UP FUNCTION CODE AND CPU ADDRESS FOR RMS  */
*                   /* INTERFACE                                     */
*                   /*                                               */
*                   /*************************************************/
*                                                                  0858
*                   R0=4;           /* LOAD FUNCTION CODE            */
         LA    R0,4                                                0858
*                   R1=HEXCPUAD;    /* LOAD CPU ADDRESS              */
         SLR   R1,R1                                               0859
         ICM   R1,3,HEXCPUAD                                       0859
*                   R15=RVTPBUCR;   /* LOAD ADDRESS OF RMS INTERFACE */
*                                                                  0860
         L     @06,CVTPTR                                          0860
         L     @06,RVTPTR(,@06)                                    0860
         L     R15,RVTPBUCR(,@06)                                  0860
*                   /*************************************************/
*                   /*                                               */
*                   /* LINK TO RMS ROUTINE                           */
*                   /*                                               */
*                   /*************************************************/
*                                                                  0861
*                   GEN(BALR 14,15);/* LINK TO RMS                   */
         BALR 14,15
*                   RFY                                            0862
*                    (R0,                                          0862
*                     R1,                                          0862
*                     R14,                                         0862
*                     R15) UNRSTD;  /* RELEASE REGISTERS             */
*                 END;              /* ** END OF FREEMCEL ROUTINE    */
*                                                                  0864
*                 /***************************************************/
*                 /*                                                 */
*                 /* CHECK IF FRR STACKS EXIST FOR SUBJECT CPU AND IF*/
*                 /* SO FREE STORAGE                                 */
*                 /*                                                 */
*                 /***************************************************/
*                                                                  0864
*                 IF PSACSTK^=0 THEN/* FRR STACKS EXIST              */
         ICM   @14,15,PSACSTK(PSAPTR)                              0864
         BZ    @RF00864                                            0864
*                   DO;                                            0865
*                                                                  0865
*                     /***********************************************/
*                     /*                                             */
*                     /* ROUND ADDRESS DOWN TO EIGHT BYTE MULTIPLE   */
*                     /* FOR FREE                                    */
*                     /*                                             */
*                     /***********************************************/
*                                                                  0866
*                     COREPTR=(PSASSTK&'FFFFFFF8'X);/* SET UP ADDRESS
*                                      TO FREE                       */
         L     @14,PSASSTK(,PSAPTR)                                0866
         N     @14,@CF03706                                        0866
         ST    @14,COREPTR                                         0866
*                     GETLENG=YSTAKLEN;/* GET LENGTH OF FRR STACK    */
         MVC   GETLENG(2),@CH02073                                 0867
*                     SUBPOOL=245;  /* SET UP STACK LENGTH           */
         MVI   SUBPOOL,X'F5'                                       0868
*                     CALL FREECORE;/* FREE STORAGE                  */
         BAL   @14,FREECORE                                        0869
*                   END;                                           0870
*                                                                  0870
*                 /***************************************************/
*                 /*                                                 */
*                 /* FREE CPU'S PSA STORAGE                          */
*                 /*                                                 */
*                 /***************************************************/
*                                                                  0871
*                 CALL PSAFREE;                                    0871
*                                                                  0871
@RF00864 BAL   @14,PSAFREE                                         0871
*                 /***************************************************/
*                 /*                                                 */
*                 /* ALLOW GTF TO FREE ANY STORAGE AREAS THAT MAY BE */
*                 /* REMAING FROM PREVIOUS TIMES.                    */
*                 /*                                                 */
*                 /***************************************************/
*                                                                  0872
*                 DO;                                              0872
*                                                                  0872
*/******** GTFOFF ************************************************** */
*/* GTFOFF EXIT WILL FREE ANY REMAINING GTF AREAS AFTER A CPU HAS    */
*/* BEEN REMOVED FROM THE SYSTEM. INPUT TO ROUTINE IS CPU ADDRESS    */
*/* IN REGISTER ONE AND SAVE AREA POINTED TO BY REG 13               */
*/********************************************************************/
*                                                                  0873
*                   RFY                                            0873
*                    (R1) RSTD;     /* RELEASE REG ONE FOR INTERFACE */
*                   R1=HEXCPUAD;    /* LOAD CPU ADDRESS              */
*                                                                  0874
         SLR   R1,R1                                               0874
         ICM   R1,3,HEXCPUAD                                       0874
*                   /*************************************************/
*                   /*                                               */
*                   /* LINK TO GTF STORAGE FREE ROUTINE              */
*                   /*                                               */
*                   /*************************************************/
*                                                                  0875
*                   GEN(LINK EP=AHLVCOFF);                         0875
         LINK EP=AHLVCOFF
*                   RFY                                            0876
*                    (R1) UNRSTD;   /* RELEASE REG ONE               */
*                                                                  0876
*                   /*************************************************/
*                   /*                                               */
*                   /* NO RETURN CODES ARE RETURNED FROM GTF ROUTINE */
*                   /*                                               */
*                   /*************************************************/
*                                                                  0877
*                 END;              /* ** END OF GTF OFF ROUTINE     */
*                                                                  0877
*                 /***************************************************/
*                 /*                                                 */
*                 /* CHECK IF CPU RELATED SAVE AREA IS PRESENT AND IF*/
*                 /* SO FREE                                         */
*                 /*                                                 */
*                 /***************************************************/
*                                                                  0878
*                 IF LCCAPTR^=0&LCCACPUS^=0 THEN/* CPU RELATED SAVE
*                                      AREA EXIST                    */
         L     @14,LCCAPTR                                         0878
         SLR   @06,@06                                             0878
         CR    @14,@06                                             0878
         BE    @RF00878                                            0878
         C     @06,LCCACPUS(,@14)                                  0878
         BE    @RF00878                                            0878
*                   DO;                                            0879
*                     CALL SAVARSUB;/* CALL SAVE AREA SUBROUTINE     */
         BAL   @14,SAVARSUB                                        0880
*                     CPFAILED='0'B;/* IGNORE POSSIBLE ERROR         */
         NI    CPFAILED,B'11111011'                                0881
*                   END;                                           0882
*               END;                                               0883
@RF00878 DS    0H                                                  0884
*GETPSA:                                                           0884
*                                                                  0884
*             /*******************************************************/
*             /*                                                     */
*             /* OBTAIN STORAGE FOR CCA'S AND PSA                    */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0884
*             CALL PSACCA;                                         0884
*                                                                  0884
@RF00853 DS    0H                                                  0884
GETPSA   BAL   @14,PSACCA                                          0884
*             /*******************************************************/
*             /*                                                     */
*             /* CHECK FOR ANY ERRORS FROM LOWER LEVEL ROUTINE       */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0885
*             IF ERRORIND^=0 THEN   /* ANY ERRORS?                   */
         ICM   @14,15,ERRORIND                                     0885
         BNZ   @RT00885                                            0885
*               GOTO PREPEXIT;      /* RETURN TO HIGHER LEVEL        */
*             PSACCAOK='1'B;        /* SUCCESSFUL CPU AREAS SETUP  0887
*                                      FOOTPRT               @ZA05955*/
         OI    PSACCAOK,B'00001000'                                0887
*/******* RMSEXIT ************************************************** */
*/* RMSEXIT WILL ALLOCATE BUFFERS TO BE USED FOR MACHINE CHECK LOG-  */
*/* OUT BUFFERS. INPUT NEEDED IS CPU ADDRESS, AND FUNCTION CODE.     */
*/* POSSIBLE ERROR INDICATORS ARE: CPFAILED                          */
*/****************************************************************** */
*                                                                  0888
*             DO;                                                  0888
*                                                                  0888
*               /*****************************************************/
*               /*                                                   */
*               /* SET FUNCTION CODE INTO REGISTER 0 AND CPU ADDRESS */
*               /* INTO REGISTER ONE                                 */
*               /*                                                   */
*               /*****************************************************/
*                                                                  0889
*               RFY                                                0889
*                (R0,                                              0889
*                 R1,                                              0889
*                 R14,                                             0889
*                 R15) RSTD;        /* RESTRICT REGISTERS FOR      0889
*                                      INTERFACE                     */
*               R1=HEXCPUAD;        /* LOAD CPU ADDRESS              */
         SLR   R1,R1                                               0890
         ICM   R1,3,HEXCPUAD                                       0890
*               R0=0;               /* FUNCTION CODE TO ALLOCATE   0891
*                                      BUFFERS                       */
         SLR   R0,R0                                               0891
*               R15=RVTPBUCR;       /* LOAD RMS ROUTINES ADDRESS FROM
*                                      VECTOR TABLE                  */
         L     @06,CVTPTR                                          0892
         L     @06,RVTPTR(,@06)                                    0892
         L     R15,RVTPBUCR(,@06)                                  0892
*               GEN(BALR 14,15);    /* LINK TO ROUTINE               */
*                                                                  0893
         BALR 14,15
*               /*****************************************************/
*               /*                                                   */
*               /* CHECK RETURN CODE AND VERIFY SUCESSFUL OPERATION  */
*               /* ANY ERROR SET CPFAILED INDICATOR                  */
*               /*                                                   */
*               /*****************************************************/
*                                                                  0894
*               IF RETCODE^=0 THEN  /* ANY ERROR?                    */
         LTR   RETCODE,RETCODE                                     0894
         BZ    @RF00894                                            0894
*                 CPFAILED='1'B;    /* SET CPFAILED INDICATOR        */
         OI    CPFAILED,B'00000100'                                0895
*               RFY                                                0896
*                (R0,                                              0896
*                 R1,                                              0896
*                 R14,                                             0896
*                 R15) UNRSTD;      /* RELEASE REGISTERS             */
@RF00894 DS    0H                                                  0897
*             END;                  /* END OF RMS INTERFACE          */
*                                                                  0898
*             /*******************************************************/
*             /*                                                     */
*             /* CHECK FOR ANY ERROR FROM RMSEXIT AND RETURN TO NEXT */
*             /* LEVEL OF CONTROL IF FOUND                           */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0898
*             IF ERRORIND^=0 THEN   /* ANY ERROR?                    */
         ICM   @14,15,ERRORIND                                     0898
         BNZ   @RT00898                                            0898
*               GOTO PREPEXIT;      /* RETURN TO HIGHER LEVEL        */
*/****** RTMEXIT *****************************************************/
*/* RTMEXIT WILL OBTAIN STORAGE FOR SYSTEM FRR STACKS AND PLACE      */
*/* ADDRESS OF STORAGE OBTAINED IN NEW PSA BEING BUILT. A ROUTINE IS */
*/* INCLUDED WITH MAINLINE THAT WILL INITIALIZE FRR STACKS. ROUTINE  */
*/* IS PROVIDED BY RTM AND IS INCLUDED FROM MACRO LIBRARY            */
*/* POSSIBLE ERROR INDICATORS ARE: NOCORE                            */
*/********************************************************************/
*                                                                  0900
*             DO;                                                  0900
*                                                                  0900
*               /*****************************************************/
*               /*                                                   */
*               /* SET UP PARAMETERS FOR GETCORE ROUTINE TO OBTAIN   */
*               /* STORAGE FOR FRR STACKS. SET NOCHAIN FLAG TO       */
*               /* PREVENT FREEING STORAGE ON CLEANUP                */
*               /*                                                   */
*               /*****************************************************/
*                                                                  0901
*               SUBPOOL=245;        /* SET SUBPOOL NUMBER            */
         MVI   SUBPOOL,X'F5'                                       0901
*               GETLENG=YSTAKLEN;   /* LENGTH OF FRR STACKS          */
         MVC   GETLENG(2),@CH02073                                 0902
*               NOCHAIN='1'B;       /* SET NOCHAIN FLAG              */
*                                                                  0903
         OI    NOCHAIN,B'10000000'                                 0903
*               /*****************************************************/
*               /*                                                   */
*               /* CALL GETCORE ROUTINE TO OBTAIN STORAGE            */
*               /*                                                   */
*               /*****************************************************/
*                                                                  0904
*               CALL GETCORE;       /* GET STORAGE                   */
*                                                                  0904
         BAL   @14,GETCORE                                         0904
*               /*****************************************************/
*               /*                                                   */
*               /* VERIFY THAT NO ERROR OCCURED DURING GETMAIN AND   */
*               /* UPDATE PSACSTK TO POINT TO STORAGE OBTAINED       */
*               /*                                                   */
*               /*****************************************************/
*                                                                  0905
*               IF ERRORIND=0 THEN  /* ANY ERRORS?                   */
         ICM   @14,15,ERRORIND                                     0905
         BNZ   @RF00905                                            0905
*                 DO;                                              0906
*                                                                  0906
*/******* NOTE: PSA MUST BE BASED ON PSAPTR AND PSAPTR MUST BE       */
*/* POINTING TO NEW PSA BEING INITIALIZED                            */
*                                                                  0907
*                   PSAPTR=CPUPSA;  /* POINT TO NEW PSA              */
         L     @14,CPUPSA                                          0907
         LR    PSAPTR,@14                                          0907
*                   PSACSTK=COREPTR;/* STORAGE JUST OBTAINED         */
         MVC   PSACSTK(4,PSAPTR),COREPTR                           0908
*                   RFY                                            0909
*                    (R1) RSTD;     /* RESTRICT REGISTER FOR       0909
*                                      INTERFACE                     */
*                   R1=CPUPSA;      /* POINT TO NEW PSA              */
         LR    R1,@14                                              0910
*                   CALL IEAVTSIN;  /* CALL INITIALIZATION ROUTINE   */
         BAL   @14,IEAVTSIN                                        0911
*                   RFY                                            0912
*                    (R1) UNRSTD;   /* RELEASE REG 1                 */
*                 END;                                             0913
*             END;                  /* END OF RTMEXIT ROUTINE        */
@RF00905 DS    0H                                                  0915
*             IF ERRORIND^=0 THEN   /* ANY ERRORS ?                  */
         ICM   @14,15,ERRORIND                                     0915
         BNZ   @RT00915                                            0915
*               GOTO PREPEXIT;      /* RETURN TO HIGHER LEVEL        */
*/****** GTFEXIT *****************************************************/
*/* GTFEXIT WILL INITIALIZE NECESSARY GTF RELEATED AREAS BY INFORMING*/
*/* GTF THAT A CPU IS TO BE BROUGHT ONLINE. NO ERROR INDICATORS WILL */
*/* BE SET IN THIS EXIT.                                             */
*/********************************************************************/
*                                                                  0917
*             DO;                                                  0917
*               RFY                                                0918
*                (R1) RSTD;         /* RESTRICT REGISTER ONE         */
*                                                                  0918
*               /*****************************************************/
*               /*                                                   */
*               /* LOAD CPU ADDRESS OF CPU TO BE BROUGHT ONLINE      */
*               /*                                                   */
*               /*****************************************************/
*                                                                  0919
*               R1=HEXCPUAD;        /* LOAD CPU ADDRESS              */
*                                                                  0919
         SLR   R1,R1                                               0919
         ICM   R1,3,HEXCPUAD                                       0919
*               /*****************************************************/
*               /*                                                   */
*               /* LINK TO GTF ROUTINE                               */
*               /*                                                   */
*               /*****************************************************/
*                                                                  0920
*               GEN(LINK EP=AHLVCON);/* LINK                         */
         LINK EP=AHLVCON
*               RFY                                                0921
*                (R1) UNRSTD;       /* RELEASE REGISTER ONE          */
*             END;                  /* *** GTFEXIT                   */
*                                                                  0923
*             /*******************************************************/
*             /*                                                     */
*             /* SET UP ADDRESSABILITY TO PARAMETERS AND INITIALIZE  */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0923
*             PARMPTR=ADDR(PARMAREA);/* ADDRESSABILITY FOR WAKE UP 0923
*                                      PARMS                         */
         LA    @14,PARMAREA                                        0923
         ST    @14,PARMPTR                                         0923
*             CPUMASK=CPUMSK;       /* PASS CPU MASK                 */
         MVC   CPUMASK(2,@14),CPUMSK                               0924
*             CPUADD=HEXCPUAD;      /* SET UP CPU ADDRESS            */
*                                                                  0925
         MVC   CPUADD(2,@14),HEXCPUAD                              0925
*             /*******************************************************/
*             /*                                                     */
*             /* SET UP WORK REG POINTING TO PARAMETER LIST TO STORE */
*             /* CONTROL REGISTERS INTO                              */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0926
*             RFY                                                  0926
*              (R14) RSTD;          /* RESTRICT REGISTER             */
*             R14=ADDR(XREGS);      /* LOAD ADDRESS FOR CONTROL    0927
*                                      REGISTERS                     */
         L     @12,PARMPTR                                         0927
         LA    R14,XREGS(,@12)                                     0927
*             GEN(STCTL  0,1,0(14));/* STORE CONTROL REGS 0,1 INTO 0928
*                                      PARM LIST                     */
*                                                                  0928
         STCTL  0,1,0(14)
*             /*******************************************************/
*             /*                                                     */
*             /* IF OLD CAT WAS COPIED TO NEW PCCA THEN SET FLAG     */
*             /* INFORMING WAKEUP CODE NOT TO ATTEMPT TO FLUSH I/O   */
*             /* INTERRUPTS                                          */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0929
*             IF OLDCAT='1'B THEN   /* OLD CAT EXIST?        @YM03538*/
         TM    OLDCAT,B'00000100'                                  0929
         BNO   @RF00929                                            0929
*               CATCHK='1'B;        /* SET WAKEUP FLAG       @YM03538*/
*                                                                  0930
         L     @12,PARMPTR                                         0930
         OI    CATCHK(@12),B'00100000'                             0930
*             /*******************************************************/
*             /*                                                     */
*             /* LET IEEVWKUP KNOW WE ARE BACKING OUT FROM AN OFFLINE*/
*             /* CASE THAT HAD STOPPED CPU SUCESSFULLY BEFORE A      */
*             /* FAILURE.                                    @G557P2L*/
*             /*                                                     */
*             /*******************************************************/
*                                                                  0931
*             IF KPCHANFL='1'B THEN                                0931
@RF00929 TM    KPCHANFL,B'01000000'                                0931
         BNO   @RF00931                                            0931
*               BACKVOFF='1'B;      /* SET WAKEUP FLAG.      @ZM45610*/
*                                                                  0932
         L     @12,PARMPTR                                         0932
         OI    BACKVOFF(@12),B'00010000'                           0932
*             /*******************************************************/
*             /*                                                     */
*             /* LOAD ADDRESS OF PSA AND CONVERT TO REAL ADDRESS     */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0933
*             R14=CPUPSA;           /* LOAD VIRTUAL ADDRESS OF PSA   */
@RF00931 L     R14,CPUPSA                                          0933
*             GEN(LRA  14,0(14));   /* CONVERT TO REAL ADDRESS       */
         LRA  14,0(14)
*             PSAADDR=R14;          /* STORE ADDRESS OF PSA FOR    0935
*                                      PREFIX REG                    */
         L     @12,PARMPTR                                         0935
         ST    R14,PSAADDR(,@12)                                   0935
*             VIRTADDR=PARMPTR;     /* SAVE VIRTUAL ADDRESS OF THESE
*                                      PARMS                         */
*                                                                  0936
         ST    @12,VIRTADDR(,@12)                                  0936
*             /*******************************************************/
*             /*                                                     */
*             /* USE DISPATCHER LOCK TO DISABLE TO OBTAIN RESTART    */
*             /* RESOURCE WORD                                       */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0937
*RESTLOOP:                                                         0937
*             GEN                                                  0937
*(SETLOCK OBTAIN,TYPE=DISP,REGS=USE,MODE=UNCOND,RELATED=(CPU,A));  0937
*                                                                  0937
RESTLOOP SETLOCK OBTAIN,TYPE=DISP,REGS=USE,MODE=UNCOND,RELATED=(CPU,A)
*             /*******************************************************/
*             /*                                                     */
*             /* SET UP FRR ENVIRONMENT TO PROTECT RESTART RESOURCE. */
*             /* FRR ROUTINE WILL SIMPLY ZERO RESTART WORD AND PERK  */
*             /* TO ESTAE RTN                                        */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0938
*             RFY                                                  0938
*              (R1,                                                0938
*               R10,                                               0938
*               R14,                                               0938
*               R15,                                               0938
*               RETCODE) RSTD;      /* RESTRECT REGISTERS            */
*             R10=ADDR(FRRRTN);     /* LOAD ADDRESS OF FRR ROUTINE   */
         LA    R10,FRRRTN                                          0939
*             GEN REFS(FRRSPARM,FRRSENTR,FRRSFRRA,FRRSCURR,FRRSELEN,
*                 PSALSFCC)(SETFRR A,FRRAD=(10),WRKREGS=(14,15));  0940
*                                                                  0940
         SETFRR A,FRRAD=(10),WRKREGS=(14,15)
*             /*******************************************************/
*             /*                                                     */
*             /* COMPARE AND SWAP TO OBTAIN RESTART RESOURCE SET UP  */
*             /* REGS FOR COMPARE AND SWAP. ESTABLISH ADDRESSABILITY */
*             /* TO MY OWN PSA TEMPORALLY TO OBTAIN MY LOGICAL CPU   */
*             /* ADDRESS FOR INCLUDING IN RESTART RESOURCE WORD      */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0941
*             PSAPTR=0;             /* ADDRESS MY OWN PSA            */
         SLR   PSAPTR,PSAPTR                                       0941
*             RFY                                                  0942
*              (LCCA) BASED(PSALCCAV);/* VIRTUAL ADDRESS OF MY OWN 0942
*                                      LCCA                          */
*             R14=0;                /* EXPECTED RESTART VALUE        */
         SLR   R14,R14                                             0943
*             R15='0000E5C1'X+(LCCACPUA*65536);/* LOAD VARY CPU    0944
*                                      IDENTIFIER                    */
         L     @11,PSALCCAV(,PSAPTR)                               0944
         LH    R15,LCCACPUA(,@11)                                  0944
         SLA   R15,16                                              0944
         AL    R15,@CF03729                                        0944
*             RFY                                                  0945
*              (LCCA) BASED(LCCAPTR);/* REVERT TO PREVIOUS         0945
*                                      ADDRESSABILITY                */
*             CS(R14,R15,CVTRSTWD); /* ATTEMPT TO OBTAIN RESTART     */
         L     @11,CVTPTR                                          0946
         CS    R14,@15,CVTRSTWD(@11)                               0946
*             BC(8,PREPCONT);       /* CONTINUE OF SUCCESSFUL        */
*                                                                  0947
         BC    8,PREPCONT                                          0947
*             /*******************************************************/
*             /*                                                     */
*             /* IF UNSUCCESSFUL THEN FREE DISPATCHER LOCK FRR & WAIT*/
*             /* ONE SECOND THEN TRY AGAIN                           */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0948
*             GEN(SETFRR  D,WRKREGS=(14,15));/* RELEASE FRR          */
         SETFRR  D,WRKREGS=(14,15)
*             GEN(SETLOCK  RELEASE,TYPE=DISP,REGS=USE,RELATED=(CPU,A));
*                                                                  0949
         SETLOCK  RELEASE,TYPE=DISP,REGS=USE,RELATED=(CPU,A)
*             /*******************************************************/
*             /*                                                     */
*             /* SET TIMER FOR ONE SECOND WAIT                       */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0950
*             GEN(STIMER  WAIT,BINTVL=SEC1);/* WAIT ONE SECOND       */
         STIMER  WAIT,BINTVL=SEC1
*             RFY                                                  0951
*              (R1,                                                0951
*               R10,                                               0951
*               R14,                                               0951
*               R15,                                               0951
*               RETCODE) UNRSTD;    /* RELEASE REGS                  */
*             GOTO RESTLOOP;        /* TRY RESTART RESOURCE AGAIN    */
         B     RESTLOOP                                            0952
*PREPCONT:                                                         0953
*                                                                  0953
*             /*******************************************************/
*             /*                                                     */
*             /* RESTART RESOURCE HAS BEEN OBTAINED. CONTINUE        */
*             /* PROCESSING SET UP TO REVERSE PREFIX TO ABSL. 0-4K   */
*             /* PSA                                                 */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0953
*             PCCAPTR=PSAPCCAV;     /* ADDRESS OF MY PCCA            */
PREPCONT L     @06,PSAPCCAV(,PSAPTR)                               0953
         ST    @06,PCCAPTR                                         0953
*             PSAPTR=PCCAPSAV;      /* VIRTUAL ADDRESS OF MY PSA FOR
*                                      REVERSE PREFIXING             */
*                                                                  0954
         L     PSAPTR,PCCAPSAV(,@06)                               0954
*             /*******************************************************/
*             /*                                                     */
*             /* GET REAL ADDRESS OF WAKEUP PARMS AND PLACE IN PSA   */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0955
*             RFY                                                  0955
*              (R14) RSTD;          /* RESTRICT REG 14               */
*             R14=PARMPTR;          /* WAKEUP PARM POINTER           */
         L     R14,PARMPTR                                         0956
*             GEN(LRA  14,0(14));   /* LOAD REAL ADDRESS OF PARMS    */
         LRA  14,0(14)
*             PSAWKRAP=R14;         /* STORE REAL ADDRESS FOR WAKEUP
*                                      CODE                          */
         ST    R14,PSAWKRAP(,PSAPTR)                               0958
*             SAVEPSW=FLCRNPSW;     /* SAVE ORIGINAL RESTART PSW     */
*                                                                  0959
         MVC   SAVEPSW(8),FLCRNPSW(PSAPTR)                         0959
*             /*******************************************************/
*             /*                                                     */
*             /* SET UP NEW PSW TO POINT TO WAKEUP ROUTINE FIXED IN  */
*             /* THIS MODULE                                         */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0960
*             RNPSW='00080000'X;    /* SET UP FIRST HALF OF NEW PSW  */
         MVC   RNPSW(4,PSAPTR),@CB03735                            0960
*             R14=ADDR(IEEVWKUP);   /* ADDRESS OF WAKEUP ROUTINE     */
         L     R14,@CV03520                                        0961
*             GEN(LRA  R14,0(R14)); /* LOAD REAL ADDRESS OF ROUTINE  */
         LRA  R14,0(R14)
*             RNPSWAD=R14;          /* BUILD RESTART PSW             */
         ST    R14,RNPSWAD(,PSAPTR)                                0963
*             RFY                                                  0964
*              (R14) UNRSTD;        /* RELEASE REG 14                */
*PREPEXIT:                                                         0965
*           END;                    /* END OF PREPARE ROUTINE        */
PREPEXIT DS    0H                                                  0966
*                                                                  0966
*           /*********************************************************/
*           /*                                                       */
*           /* CHECK FOR ANY ERRORS DURING PREPARE                   */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0966
*           IF(ERRORIND)^=0 THEN    /* ERRORS ?                      */
         ICM   @06,15,ERRORIND                                     0966
         BNZ   @RT00966                                            0966
*             GOTO ONEXIT;          /* EXIT                          */
*/******* TRCKRST ****************************************************/
*/* TRCKRST ROUTINE WILL ISSUE A SIGP RESTART TO THE SUBJECT CPU TO  */
*/* BE BROUGHT ONLINE AND MONITOR IT'S PROGRESS. WHEN CPU IS ONLINE  */
*/* RESTART RESOURCE WILL BE FREED AND SUCCESSFUL INDICATORS WILL BE */
*/* SET                                                              */
*/********************************************************************/
*                                                                  0968
*           DO;                                                    0968
*                                                                  0968
*             /*******************************************************/
*             /*                                                     */
*             /* ISSUE SIGP RESTART TO SUBJECT CPU TO ACTIVATE HIM   */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0969
*             RFY                                                  0969
*              (R1,                                                0969
*               RETCODE) RSTD;                                     0969
*             R1=PCCAT00P(HEXCPUAD+1);/* GET CPU PCCA ADDRESS FOR  0970
*                                      SIGP                          */
         SLR   @14,@14                                             0970
         ICM   @14,3,HEXCPUAD                                      0970
         SLA   @14,2                                               0970
         L     @06,CVTPTR                                          0970
         L     @06,CVTPCCAT(,@06)                                  0970
         L     R1,PCCAT00P(@14,@06)                                0970
*             GEN(DSGNL  RESTART,CPU=(1));                         0971
*                                                                  0971
         DSGNL  RESTART,CPU=(1)
*             /*******************************************************/
*             /*                                                     */
*             /* CHECK FOR SUCCESSFUL RETURN CODE FROM IPC           */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0972
*             IF RETCODE^=0 THEN    /* SUCCESSFUL /?                 */
         LTR   RETCODE,RETCODE                                     0972
         BZ    @RF00972                                            0972
*               DO;                                                0973
*                 CPUNRESP='1'B;    /* SET ERROR FLAG                */
         OI    CPUNRESP,B'00010000'                                0974
*                 GOTO TRCKCONT;    /* EXIT                          */
         B     TRCKCONT                                            0975
*               END;                                               0976
*                                                                  0976
*             /*******************************************************/
*             /*                                                     */
*             /* RESTART WAS ACCEPTED. ENTER SENSE LOOP TILL RESTART */
*             /* HAS COMPLETED                                       */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0977
*             LOOPCNT=ONEMEG;       /* INIT CNTR FOR RETRIES IF CPU
*                                      BUSY                  @ZA10795*/
@RF00972 MVC   LOOPCNT(4),ONEMEG                                   0977
*RESTRT:                                                           0978
*             R1=PCCAT00P(HEXCPUAD+1);/* PCCA OF SUBJECT CPU         */
RESTRT   SLR   @14,@14                                             0978
         ICM   @14,3,HEXCPUAD                                      0978
         SLA   @14,2                                               0978
         L     @06,CVTPTR                                          0978
         L     @06,CVTPCCAT(,@06)                                  0978
         L     R1,PCCAT00P(@14,@06)                                0978
*             GEN(DSGNL SENSE,CPU=(1));/* ISSUE SENSE TO CPU         */
*                                                                  0979
         DSGNL SENSE,CPU=(1)
*             /*******************************************************/
*             /*                                                     */
*             /* CHECK IF CPU IS BUSY DOING RESTART                  */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0980
*             IF RETCODE=4 THEN     /* BUSY?                         */
         CH    RETCODE,@CH00076                                    0980
         BNE   @RF00980                                            0980
*               DO;                 /* YES-IEAVEDR RETRIED 1 MEG   0981
*                                      ALREADY               @ZA10795*/
*                 CPUNRESP='1'B;    /* SET UNRESPONSIVE CPU ERR FLAG
*                                                            @ZA10795*/
         OI    CPUNRESP,B'00010000'                                0982
*                 GOTO TRCKCONT;    /* BRANCH CONTINUE PROCESSING  0983
*                                                            @ZA10795*/
         B     TRCKCONT                                            0983
*               END;                /* END OF RETURN CODE BUSY     0984
*                                      PROCESSING            @ZA10795*/
*                                                                  0984
*             /*******************************************************/
*             /*                                                     */
*             /* CPU HAS STORED STATUS. INTERROGATE                  */
*             /*                                                     */
*             /*******************************************************/
*                                                                  0985
*             IF RETCODE=8 THEN     /* ERROR??                       */
@RF00980 CH    RETCODE,@CH00036                                    0985
         BNE   @RF00985                                            0985
*               DO;                                                0986
*                 RFY                                              0987
*                  (R0) RSTD;       /* RESTRICT REG                  */
*                 TEMPWORK=R0;      /* STORE SENSE INFORMATION FOR 0988
*                                      CHECK                         */
         ST    R0,TEMPWORK                                         0988
*                 RFY                                              0989
*                  (R0) UNRSTD;     /* RELEASE REG                   */
*                                                                  0989
*                 /***************************************************/
*                 /*                                                 */
*                 /* INTERROGATE SENSE INFORMATION TO DETERMINE IF A */
*                 /* ERROR HAS OCCURED DURING RESTART. IF A ERROR IS */
*                 /* DETECTED THEN SET CPU UNRESPONSIVE FLAG AND EXIT*/
*                 /*                                                 */
*                 /***************************************************/
*                                                                  0990
*                 IF CKSTOP='1'B×OPINT='1'B×RECCK='1'B×STOP='1'B×NTRDY=
*                     '1'B THEN     /* ANY ERROR?                    */
         TM    CKSTOP,B'01111001'                                  0990
         BZ    @RF00990                                            0990
*                   DO;                                            0991
*                     CPUNRESP='1'B;/* SET UNRESPONSIVE FLAG         */
         OI    CPUNRESP,B'00010000'                                0992
*                     GOTO TRCKCONT;/* RETURN TO NEXT LEVEL          */
         B     TRCKCONT                                            0993
*                   END;                                           0994
*                                                                  0994
*                 /***************************************************/
*                 /*                                                 */
*                 /* RETURN CODE WAS EIGHT, BUT NO ERROR. LOOP WITH  */
*                 /* SENSE TILL A ZERO RETURN CODE IS RECEIVED, OR   */
*                 /* MACHINE ERROR OCCURES                           */
*                 /*                                                 */
*                 /***************************************************/
*                                                                  0995
*                 ELSE                                             0995
*                   DO;             /* YES-CHECK HOW MANY RETRIES  0995
*                                      ALREADY               @ZA10795*/
@RF00990 DS    0H                                                  0996
*                     IF LOOPCNT=0 THEN/* 1 MEG RETRIES?     @ZA10795*/
         ICM   @14,15,LOOPCNT                                      0996
         BNZ   @RF00996                                            0996
*                       DO;         /* YES, THAT IS ENOUGH   @ZA10795*/
*                         CPUNRESP='1'B;/* SET UNRESPONSIVE CPU ERR
*                                      FLAG                  @ZA10795*/
         OI    CPUNRESP,B'00010000'                                0998
*                         GOTO TRCKCONT;/* BRACNH CONTINUE PROCESSING
*                                                            @ZA10795*/
         B     TRCKCONT                                            0999
*                       END;                                       1000
*                     ELSE          /* NO, RETRY AGAIN       @ZA10795*/
*                       DO;                                        1001
@RF00996 DS    0H                                                  1002
*                         LOOPCNT=LOOPCNT-1;/* DECR RETRY COUNTER  1002
*                                                            @ZA10795*/
         L     @14,LOOPCNT                                         1002
         BCTR  @14,0                                               1002
         ST    @14,LOOPCNT                                         1002
*                         GOTO RESTRT;/* BRANCH ISSUE SIGP AGAIN   1003
*                                                            @ZA10795*/
         B     RESTRT                                              1003
*                       END;                                       1004
*                   END;            /* END OF RETURN CODE BUSY     1005
*                                      PROCESSING            @ZA10795*/
*               END;                                               1006
*             RFY                                                  1007
*              (R1,                                                1007
*               RETCODE) UNRSTD;    /* RELEASE REG ONE               */
*                                                                  1007
@RF00985 DS    0H                                                  1008
*             /*******************************************************/
*             /*                                                     */
*             /* ENTER SPIN LOOP TO MONITOR PROGRESS OF SUBJECT CPU  */
*             /*                                                     */
*             /*******************************************************/
*                                                                  1008
*             DO LOOPCNT=5000 TO 0 BY-1;                           1008
*                                                                  1008
         LH    @06,@CH03741                                        1008
         ST    @06,LOOPCNT                                         1008
@DL01008 DS    0H                                                  1009
*               /*****************************************************/
*               /*                                                   */
*               /* CHECK FOR INPROGRESS FLAG IN WAKEUP PARMS         */
*               /*                                                   */
*               /*****************************************************/
*                                                                  1009
*               IF INPROC='1'B THEN /* BIT SET YET??                 */
         L     @04,PARMPTR                                         1009
         TM    INPROC(@04),B'10000000'                             1009
         BO    @RT01009                                            1009
*                 GOTO CKCOMPLT;    /* GO CHECK FOR COMPLETE         */
*             END;                  /* END OF INPROGRESS LOOP        */
*                                                                  1011
         BCTR  @06,0                                               1011
         ST    @06,LOOPCNT                                         1011
         LTR   @06,@06                                             1011
         BNM   @DL01008                                            1011
*             /*******************************************************/
*             /*                                                     */
*             /* IF SPIN LOOP COMPLETES THEN CPU DID NOT RESPOND TO  */
*             /* RESTART                                             */
*             /*                                                     */
*             /*******************************************************/
*                                                                  1012
*             CPUNRESP='1'B;        /* SET UNRESPONSIVE FLAG         */
         OI    CPUNRESP,B'00010000'                                1012
*             GOTO TRCKCONT;        /* RETURN TO NEXT LEVEL          */
*                                                                  1013
         B     TRCKCONT                                            1013
*             /*******************************************************/
*             /*                                                     */
*             /* SET UP SPIN LOOP WAITING FOR COMPLETE INDICATOR FROM*/
*             /* WAKEUP CODE                                         */
*             /*                                                     */
*             /*******************************************************/
*                                                                  1014
*CKCOMPLT:                                                         1014
*             DO LOOPCNT=5000 TO 0 BY-1;/* LOOP FOR COMPLETE BIT     */
*                                                                  1014
CKCOMPLT LH    @06,@CH03741                                        1014
         ST    @06,LOOPCNT                                         1014
@DL01014 DS    0H                                                  1015
*               /*****************************************************/
*               /*                                                   */
*               /* IF COMPLETE BIT HAS BEEN SET THEN CONTINUE        */
*               /* PROCESSING                                        */
*               /*                                                   */
*               /*****************************************************/
*                                                                  1015
*               IF COMPLT='1'B THEN /* COMPLETE BIT SET YET?         */
         L     @04,PARMPTR                                         1015
         TM    COMPLT(@04),B'01000000'                             1015
         BO    @RT01015                                            1015
*                 GOTO TRCKCONT;    /* CONTINUE PROCESSING           */
*             END;                  /* END OF SPIN LOOP              */
*                                                                  1017
         BCTR  @06,0                                               1017
         ST    @06,LOOPCNT                                         1017
         LTR   @06,@06                                             1017
         BNM   @DL01014                                            1017
*             /*******************************************************/
*             /*                                                     */
*             /* IF SPIN LOOP COMPLETES THEN CPU HAS RESPONDED BUT   */
*             /* NOT COMPLETED. CHECK TYPE OF ERROR ENCOUNTERED.     */
*             /*                                                     */
*             /*******************************************************/
*                                                                  1018
*             IF PCCACPUM^='0'B THEN/* MFA ON OFFLINE CPU??          */
         L     @06,PCCAPTR                                         1018
         TM    PCCACPUM(@06),B'10000000'                           1018
         BZ    @RF01018                                            1018
*               MCHECK='1'B;        /* SET MACHINE CHECK FLAG        */
         OI    MCHECK,B'00000010'                                  1019
*             ELSE                                                 1020
*               CPUNRESP='1'B;      /* SET UNRESPONSIVE FLAG         */
         B     @RC01018                                            1020
@RF01018 OI    CPUNRESP,B'00010000'                                1020
*TRCKCONT:                                                         1021
*                                                                  1021
*             /*******************************************************/
*             /*                                                     */
*             /* CPU HAS RESPONDED TO RESTART AND HAS COMPLETED      */
*             /* INITIAL PROCESSING. FREE RESTART RESOURCE AND ENABLE*/
*             /*                                                     */
*             /*******************************************************/
*                                                                  1021
*             FLCRNPSW=SAVEPSW;     /* REPLACE RESTART PSW IN 0-4K 1021
*                                      PSA                           */
@RC01018 DS    0H                                                  1021
TRCKCONT MVC   FLCRNPSW(8,PSAPTR),SAVEPSW                          1021
*             CS(CVTRSTWD,0,CVTRSTWD);/* RELEASE RESTART RESOURCE    */
*                                                                  1022
         L     @12,CVTPTR                                          1022
         L     @06,CVTRSTWD(,@12)                                  1022
         SLR   @04,@04                                             1022
         CS    @06,@04,CVTRSTWD(@12)                               1022
         BZ    @BC01022                                            1022
         ST    @06,CVTRSTWD(,@12)                                  1022
@BC01022 DS    0H                                                  1023
*             /*******************************************************/
*             /*                                                     */
*             /* RELEASE FRR RESOURCE AND DISPATCHER LOCK            */
*             /*                                                     */
*             /*******************************************************/
*                                                                  1023
*             RFY                                                  1023
*              (R0,                                                1023
*               R1,                                                1023
*               R14,                                               1023
*               R15,                                               1023
*               RETCODE) RSTD;      /* RESTRICT REGISTERS            */
*             GEN(SETFRR  D,WRKREGS=(14,15));/* RELEASE FRR          */
         SETFRR  D,WRKREGS=(14,15)
*             GEN                                                  1025
*(SETLOCK  RELEASE,TYPE=DISP,REGS=USE,RELATED=(IEEVCPU,RESTART));  1025
         SETLOCK  RELEASE,TYPE=DISP,REGS=USE,RELATED=(IEEVCPU,RESTART)
*             IF(ERRORIND)^=0 THEN  /* ANY ERRORS?                   */
         ICM   @12,15,ERRORIND                                     1026
         BNZ   @RT01026                                            1026
*               GOTO TRCKEXIT;      /* EXIT IF ERRORS ARE FOUND      */
*                                                                  1027
*             /*******************************************************/
*             /*                                                     */
*             /* LINK TO TIMER ROUTINE TO SYNC CLOCKS WITH NEW CPU   */
*             /* ASSUME CLOCKS ARE IN ERROR IN CASE LINK FAILS       */
*             /*                                                     */
*             /*******************************************************/
*                                                                  1028
*             NOCLOCK='1'B;         /* SET ERROR FLAG                */
         OI    NOCLOCK,B'10000000'                                 1028
*             R1=ADDR(PCCAT00P(HEXCPUAD+1));/* POINT TO PCCA ADDRESS */
         SLR   @12,@12                                             1029
         ICM   @12,3,HEXCPUAD                                      1029
         SLA   @12,2                                               1029
         L     @06,CVTPTR                                          1029
         L     R1,CVTPCCAT(,@06)                                   1029
         LA    R1,PCCAT00P(@12,R1)                                 1029
*             R0=0;                 /* ZERO REG O FOR INTERFACE      */
         SLR   R0,R0                                               1030
*             GEN(LINK EP=IEAVRSSC);/* SYNCHRONIZE CLOCKS            */
*                                                                  1031
         LINK EP=IEAVRSSC
*             /*******************************************************/
*             /*                                                     */
*             /* VERIFY THAT CLOCKS HAVE BEEN SYNCHRONIZED PROPERLY  */
*             /*                                                     */
*             /*******************************************************/
*                                                                  1032
*             IF RETCODE=0 THEN     /* SUCCESSFUL?                   */
         SLR   @12,@12                                             1032
         CR    RETCODE,@12                                         1032
         BNE   @RF01032                                            1032
*               DO;                                                1033
*                 NOCLOCK='0'B;     /* RESET ERROR FLAG              */
         NI    NOCLOCK,B'01111111'                                 1034
*                 CPUONOK='1'B;     /* SET CPU ONLINE OK FLAG        */
*                                                                  1035
         OI    CPUONOK,B'01000000'                                 1035
*                 /***************************************************/
*                 /*                                                 */
*                 /* ZERO PSA PTR TO PREVENT CLEANUP FROM FREEING NEW*/
*                 /* PSA AREA                                        */
*                 /*                                                 */
*                 /***************************************************/
*                                                                  1036
*                 CPUPSA=0;         /* ZERO PSA POINTER      @ZA05955*/
         ST    @12,CPUPSA                                          1036
*                 IF KPCHANFL^='1'B THEN                           1037
         TM    KPCHANFL,B'01000000'                                1037
         BO    @RF01037                                            1037
*                   DO;             /* OFFLINE BACKOUT?      @ZM45610*/
*                                                                  1038
*                     /***********************************************/
*                     /*                                             */
*                     /* CPU IS ONLINE OK. IF CRH IS ACTIVE EXIT TO  */
*                     /* IOS TO DEACTIVATE CRH. IF CRH IS NOT ACTIVE */
*                     /* THEN ISSUE ASSOCIATE FOR MSS DEVICE.        */
*                     /*                                             */
*                     /***********************************************/
*                                                                  1039
*                     IF CVTCRCA^=0 THEN/* CRH ACTIVE?       @Y30CQXA*/
         L     @06,CVTPTR                                          1039
         C     @12,CVTCRCA(,@06)                                   1039
         BE    @RF01039                                            1039
*                       DO;         /*                       @Y30CQXA*/
*                         R15=IOXCRHD;/* DEACTIVATE ADDRESS  @Y30CQXA*/
         L     @12,IOCOMPTR(,@06)                                  1041
         L     @12,IOCXPTR(,@12)                                   1041
         L     R15,IOXCRHD(,@12)                                   1041
*                         GEN(BALR R14,R15);/* GO DEACTIVATE @Y30CQXA*/
         BALR R14,R15
*                       END;        /*                       @Y30CQXA*/
*                     ELSE          /*                       @Y30LPXA*/
*                                                                  1044
*                       /*********************************************/
*                       /*                                           */
*                       /* CRH WAS NOT ACTIVE. NOTIFY MSS OF NEW     */
*                       /* PROCESSOR OPERATING IN MP MODE THROUGH    */
*                       /* ASSOCIATE                                 */
*                       /*                                           */
*                       /*********************************************/
*                                                                  1044
*                       CALL AINIT; /* GO ISSUE ASSOCIATE    @Y30LPXA*/
         B     @RC01039                                            1044
@RF01039 BAL   @14,AINIT                                           1044
*                   END;            /* END NOT OFFLINE,CRH BACKOUT 1045
*                                                            @G557P2L*/
*                                                                  1045
@RC01039 DS    0H                                                  1046
*                 /***************************************************/
*                 /*                                                 */
*                 /* CRH HAS BEEN DEACTIVATED IF ACTIVE, AND MSS HAS */
*                 /* BEEN ASSOCIATED. RELEASE NEW CPU WHICH HAS BEEN */
*                 /* SPINNING DISABLED SINCE SYNCRONIZING CLOCKS     */
*                 /*                                                 */
*                 /***************************************************/
*                                                                  1046
*                 LCCAPTR=LCCAT00P(HEXCPUAD+1);/* POINT TO NEW LCCA
*                                                            @Y30CQXA*/
@RF01037 SLR   @12,@12                                             1046
         ICM   @12,3,HEXCPUAD                                      1046
         SLA   @12,2                                               1046
         L     @06,CVTPTR                                          1046
         L     @06,CVTLCCAT(,@06)                                  1046
         L     @12,LCCAT00P(@12,@06)                               1046
         ST    @12,LCCAPTR                                         1046
*                 LCCATIMR='0'B;    /* RESET SPIN BIT        @Y30CQXA*/
*                                                                  1047
         NI    LCCATIMR(@12),B'11101111'                           1047
*                 /***************************************************/
*                 /*                                                 */
*                 /* NEW CPU HAS NOW BEEN RELEASED TO THE SYSTEM FOR */
*                 /* WORK                                            */
*                 /*                                                 */
*                 /***************************************************/
*                                                                  1048
*               END;                                               1048
*             RFY                                                  1049
*              (R0,                                                1049
*               R1,                                                1049
*               R14,                                               1049
*               R15,                                               1049
*               RETCODE) UNRSTD;    /* RELEASE REGISTERS             */
@RF01032 DS    0H                                                  1050
*TRCKEXIT:                                                         1050
*           END;                    /* END OF TRCKRST ROUTINE        */
TRCKEXIT DS    0H                                                  1051
*           IF ERRORIND^=0 THEN     /* ANY ERRORS?                   */
         ICM   @12,15,ERRORIND                                     1051
         BNZ   @RT01051                                            1051
*             GOTO ONEXIT;                                         1052
*                                                                  1052
*           /*********************************************************/
*           /*                                                       */
*           /* GO BRING ONLINE ANY OFFLINE DEVICES NOW ACCESSABLE. IF*/
*           /* BACKING OUT FROM OFFLINE,KEEPCHAN PROCESSING DEVICE   */
*           /* PROCESSING IS NOT REQUIRED BECAUSE NONE WERE TAKEN    */
*           /* OFFLINE.                                      @G557P2L*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1053
*           IF KPCHANFL^='1'B THEN  /* NOT OFFLINE BACKOUT CASE?   1053
*                                                            @ZM45610*/
         TM    KPCHANFL,B'01000000'                                1053
         BO    @RF01053                                            1053
*             IF PCCAT00P(HEXCPUAD+1)->/* CPU# FROM VARY CMND      1054
*                                                            @G47AN2O*/
*                 PCCAIO=HASIO      /* THE CPU HAS CHNLS     @G47AN2O*/
*               THEN                /*                       @G47AN2O*/
         SLR   @12,@12                                             1054
         ICM   @12,3,HEXCPUAD                                      1054
         SLA   @12,2                                               1054
         L     @06,CVTPTR                                          1054
         L     @06,CVTPCCAT(,@06)                                  1054
         L     @12,PCCAT00P(@12,@06)                               1054
         TM    PCCAIO(@12),B'01000000'                             1054
         BNO   @RF01054                                            1054
*               CALL DEVCHK;        /* CALL DEVICE CHECK ROUTINE     */
         BAL   @14,DEVCHK                                          1055
*           ONLINMSG='1'B;          /* SET ONLINE FLAG               */
@RF01054 DS    0H                                                  1056
@RF01053 OI    ONLINMSG,B'00100000'                                1056
*         END;                                                     1057
*     END;                                                         1058
@RC00845 DS    0H                                                  1059
*ONEXIT:                                                           1059
*                                                                  1059
*/*  CHECK IF OLD CCA AREAS NEED TO BE RESTORED DUE TO ERROR @ZA05955*/
*                                                                  1059
*   IF(ERRORIND^=0)&(PSACCAOK='1'B) THEN/*                   @ZA05955*/
@RC00757 DS    0H                                                  1059
ONEXIT   ICM   @12,15,ERRORIND                                     1059
         BZ    @RF01059                                            1059
         TM    PSACCAOK,B'00001000'                                1059
         BNO   @RF01059                                            1059
*     DO;                           /* CPU AREAS OBTAINED, THEN    1060
*                                      ERROR?                @ZA05955*/
*       R10=OLDPCCA;                /* TEMP SAVE OLD PCCA ADDRESS  1061
*                                                            @ZA05955*/
         L     R10,OLDPCCA                                         1061
*       R11=OLDLCCA;                /* TEMP SAVE OLD LCCA ADDRESS  1062
*                                                            @ZA05955*/
         L     R11,OLDLCCA                                         1062
*       OLDPCCA=PCCAT00P(HEXCPUAD+1);/* SAVE NEW AREA ADDRS  @ZA05955*/
         SLR   @12,@12                                             1063
         ICM   @12,3,HEXCPUAD                                      1063
         SLA   @12,2                                               1063
         L     @06,CVTPTR                                          1063
         L     @04,CVTPCCAT(,@06)                                  1063
         L     @15,PCCAT00P(@12,@04)                               1063
         ST    @15,OLDPCCA                                         1063
*       OLDLCCA=LCCAT00P(HEXCPUAD+1);/* FOR CLEANUP FREEING. @ZA05955*/
         L     @06,CVTLCCAT(,@06)                                  1064
         L     @15,LCCAT00P(@12,@06)                               1064
         ST    @15,OLDLCCA                                         1064
*       PCCAT00P(HEXCPUAD+1)=R10;   /* RESTORE OLD CCA ADDRESSES   1065
*                                                            @ZA05955*/
         ST    R10,PCCAT00P(@12,@04)                               1065
*       LCCAT00P(HEXCPUAD+1)=R11;   /* FOR FUTHER USING.     @ZA05955*/
         ST    R11,LCCAT00P(@12,@06)                               1066
*     END;                                                         1067
*   END;                            /* END OF VARY ONLINE ROUTINE    */
@EL00003 DS    0H                                                  1068
@EF00003 DS    0H                                                  1068
@ER00003 LM    @14,@12,@SA00003                                    1068
         BR    @14                                                 1068
*PAGEFIX:                                                          1069
*   PROC;                                                          1069
*                                                                  1069
PAGEFIX  STM   @14,@12,@SA00004                                    1069
*/****** PAGEFIX *****************************************************/
*/* PAGEFIX ROUTINE WILL FIX STORAGE FOR CALLER TO RUN DISABLED      */
*/* CALLER WILL SET UP REGS BEFORE CALLING ROUTINE. IF NECESSARY     */
*/* CONTROL WILL NOT BE RETURNED TO CALLER UNTIL FUNCTION HAS BEEN   */
*/* PERFORMED. POSSIBLE ERROR INDICATORS ARE CPFAILED.               */
*/********************************************************************
*                                                                    */
*                                                                  1070
*   /*****************************************************************/
*   /*                                                               */
*   /* REGISTERS HAVE BEEN SET UP BY CALLER                          */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1070
*   RFY                                                            1070
*    (R10,                                                         1070
*     R11,                                                         1070
*     R12,                                                         1070
*     RETCODE) RSTD;                /* RESTRICT REGISTERS FOR MACRO  */
*   R12=ADDR(PGFXECB);              /* LOAD ADDRESS OF PAGEFIX ECB   */
         LA    R12,PGFXECB                                         1071
*   PGFXECB=0;                      /* ZERO OUT ECB                  */
         SLR   @14,@14                                             1072
         ST    @14,PGFXECB                                         1072
*   GEN(PGFIX R,A=(10),EA=(11),ECB=(12),LONG=N);/* PAGEFIX           */
*                                                                  1073
         PGFIX R,A=(10),EA=(11),ECB=(12),LONG=N
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK IF WAIT SHOULD BE ISSUED.. CHECK POST BIT IN ECB        */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1074
*   IF POSTED^='1'B THEN            /* ECB POSTED YET?               */
         TM    POSTED,B'01000000'                                  1074
         BO    @RF01074                                            1074
*     GEN(WAIT  ECB=PGFXECB);       /* WAIT ON ECB                   */
*                                                                  1075
         WAIT  ECB=PGFXECB
*   /*****************************************************************/
*   /*                                                               */
*   /* AFTER WE COME OUT OF WAIT CHECK POST CODE TO SEE IF FIX WAS   */
*   /* SUCCESSFUL                                                    */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1076
*   IF PGFXCODE^=0 THEN             /* POST SUCCESSFUL?              */
@RF01074 ICM   @14,7,PGFXCODE                                      1076
         BZ    @RF01076                                            1076
*     CPFAILED='1'B;                /* SET ERROR FLAG                */
         OI    CPFAILED,B'00000100'                                1077
*   RFY                                                            1078
*    (R10,                                                         1078
*     R11,                                                         1078
*     R12,                                                         1078
*     RETCODE) UNRSTD;              /* RELEASE REGISTERS FOR USE     */
*   END;                            /* ** END OF PGFIX ROUTINE       */
@EL00004 DS    0H                                                  1079
@EF00004 DS    0H                                                  1079
@ER00004 LM    @14,@12,@SA00004                                    1079
         BR    @14                                                 1079
*PATHVAL:                                                          1080
*   PROC;                           /* PATH VALIDATE ROUTINE         */
PATHVAL  STM   @14,@12,@SA00005                                    1080
*/***** PATHVAL ******************************************************/
*/* PATHVAL ROUTINE WILL LINK TO AN IOS MODULE (IECVIOPM) TO VALIDATE*/
*/* ALL DEVICE PATHS FROM THE NEW CPU OR CHANNEL. THE UCBCHM FIELD   */
*/* IN THE UCB WILL BE UPDATED TO REFELECT ALL OPERATIONAL PATHS AS  */
*/* BEING ONLINE.                                                    */
*/********************************************************************/
*                                                                  1081
*   /*****************************************************************/
*   /*                                                               */
*   /* SET UP PARAMETER LIST FOR IECVIOPM THAT IS COMMON FOR THIS    */
*   /* ROUTINE.                                                      */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1081
*   IF CHNIND='1'B THEN             /* CHANNEL COMMAND?              */
         TM    CHNIND,B'10000000'                                  1081
         BNO   @RF01081                                            1081
*     PATHFC=2;                     /* SET CHANNEL FUNCTION CODE     */
*                                                                  1082
         MVI   PATHFC,X'02'                                        1082
*   /*****************************************************************/
*   /*                                                               */
*   /* WAS NOT CHANNEL COMMAND, MUST THEN BE CPU COMMAND             */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1083
*   ELSE                                                           1083
*     PATHFC=1;                     /* SET CPU FUNCTION CODE         */
*                                                                  1083
         B     @RC01081                                            1083
@RF01081 MVI   PATHFC,X'01'                                        1083
*   /*****************************************************************/
*   /*                                                               */
*   /* SET UP CPU AND CHANNEL BIT MASKS                              */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1084
*   PATHCPU=CPUMSK;                 /* CPU BIT MASK                  */
@RC01081 MVC   PATHCPU(2),CPUMSK                                   1084
*   PATHCHN=HEXCHNAD;               /* CHANNEL BIT MASK      @YM08136*/
*                                                                  1085
         MVC   PATHCHN(2),HEXCHNAD                                 1085
*   /*****************************************************************/
*   /*                                                               */
*   /* LOAD IECVIOPM AND SAVE ENTRY POINT ADDRESS                    */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1086
*   GEN(LOAD  EP=IECVIOPM);         /* LOAD IECVIOPM                 */
         LOAD  EP=IECVIOPM
*   PATHADDR=R0;                    /* SAVE ENTRY POINT ADDRESS      */
*                                                                  1087
         ST    R0,PATHADDR                                         1087
*   /*****************************************************************/
*   /*                                                               */
*   /* SET UP DO LOOP TO SCAN ALL UCBS IN SYSTEM AND VALIDATE PATHS  */
*   /* TO DEVICES FROM NEW SYSTEM ELEMENT.                           */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1088
*   DO UCBLKPTR=CVTILK2 BY 2 WHILE(UCBTAB^='FFFF'X);/* SCAN          */
*                                                                  1088
         L     @12,CVTPTR                                          1088
         L     @12,CVTILK2(,@12)                                   1088
         ST    @12,UCBLKPTR                                        1088
         B     @DE01088                                            1088
@DL01088 DS    0H                                                  1089
*     /***************************************************************/
*     /*                                                             */
*     /* CHECK FOR DUMMY ENTRY IN LOOKUP TABLE AND SKIP IF SO        */
*     /*                                                             */
*     /***************************************************************/
*                                                                  1089
*     IF UCBTAB='0000'X THEN        /* DUMMY ENTRY?                  */
         L     @12,UCBLKPTR                                        1089
         SLR   @06,@06                                             1089
         ICM   @06,3,UCBTAB(@12)                                   1089
         LTR   @06,@06                                             1089
         BZ    @RT01089                                            1089
*       GOTO PATHSKIP;              /* SKIP PATH VALIDATE            */
*     UCBPTR=UCBTAB;                /* PICK UP UCB ADDRESS           */
*                                                                  1091
         ST    @06,UCBPTR                                          1091
*     /***************************************************************/
*     /*                                                             */
*     /* CHECK FOR EXPOSURE UCB AND SKIP IF SO                       */
*     /*                                                             */
*     /***************************************************************/
*                                                                  1092
*     IF UCBMTPXP='1'B&(UCBBASE^=(UCBPTR-512)) THEN/*        @YM06930*/
         TM    UCBMTPXP(@06),B'00001000'                           1092
         BNO   @RF01092                                            1092
         LR    @12,@06                                             1092
         SH    @12,@CH01762                                        1092
         C     @12,UCBBASE(,@06)                                   1092
         BNE   @RT01092                                            1092
*       GOTO PATHSKIP;              /* SKIP EXPOSURE UCB     @YM06930*/
*                                                                  1093
*     /***************************************************************/
*     /*                                                             */
*     /* CHECK FOR COMMUNICATIONS UCB AND SKIP IF I/O IS ACTIVE ON   */
*     /* DEVICE.                                             @ZA00078*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  1094
*     IF UCB3COMM='1'B&UCBACTV='1'B THEN/*                   @ZA00078*/
@RF01092 L     @12,UCBPTR                                          1094
         TM    UCB3COMM(@12),B'01000000'                           1094
         BNO   @RF01094                                            1094
         TM    UCBACTV(@12),B'00000010'                            1094
         BO    @RT01094                                            1094
*       GOTO PATHSKIP;              /* SKIP ACTIVE COMMUNICATIONS UCB
*                                                            @ZA00078*/
*                                                                  1095
*     /***************************************************************/
*     /*                                                             */
*     /* CHECK FOR DEVICE BEING OFFLINE FOR OPERATOR REASON AND SKIP */
*     /* IF SO                                               @ZA29619*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  1096
*     IF UCBVORSN='1'B THEN         /* DEVICE OFFLINE FOR OPERATOR   */
@RF01094 L     @12,UCBPTR                                          1096
         TM    UCBVORSN(@12),B'00000100'                           1096
         BO    @RT01096                                            1096
*       GOTO PATHSKIP;              /* REASON SKIP TO NEXT DEVICE  1097
*                                                            @ZA29619*/
*                                                                  1097
*     /***************************************************************/
*     /*                                                             */
*     /* SET UP PARAMETER LIST FOR THIS UCB                          */
*     /*                                                             */
*     /***************************************************************/
*                                                                  1098
*     PATHUCB=UCBTAB;               /* SET UP PARM LIST              */
*                                                                  1098
         L     @12,UCBLKPTR                                        1098
         SLR   @06,@06                                             1098
         ICM   @06,3,UCBTAB(@12)                                   1098
         STCM  @06,7,PATHUCB                                       1098
*     /***************************************************************/
*     /*                                                             */
*     /* BALR TO IECVIOPM TO VALIDATE PATHS FROM DEVICE              */
*     /*                                                             */
*     /***************************************************************/
*                                                                  1099
*     RFY                                                          1099
*      (R1,                                                        1099
*       R14,                                                       1099
*       R15) RSTD;                  /* RESTRICT REGISTERS            */
*     R1=ADDR(PATHPARM);            /* POINT TO PARAMETERS           */
         LA    R1,PATHPARM                                         1100
*     R15=PATHADDR;                 /* ADDRESS OF IECVIOPM           */
         L     R15,PATHADDR                                        1101
*     GEN(BALR R14,R15);            /* LINK TO IECVIOPM              */
         BALR R14,R15
*     RFY                                                          1103
*      (R1,                                                        1103
*       R14,                                                       1103
*       R15) UNRSTD;                /* RELEASE REGISTERS             */
*PATHSKIP:                                                         1104
*   END;                            /* END OF DO LOOP                */
PATHSKIP LA    @12,2                                               1104
         AL    @12,UCBLKPTR                                        1104
         ST    @12,UCBLKPTR                                        1104
@DE01088 L     @12,UCBLKPTR                                        1104
         CLC   UCBTAB(2,@12),@CH03658                              1104
         BNE   @DL01088                                            1104
*   END;                            /* END OF PATH VALIDATE ROUTINE  */
@EL00005 DS    0H                                                  1105
@EF00005 DS    0H                                                  1105
@ER00005 LM    @14,@12,@SA00005                                    1105
         BR    @14                                                 1105
*DEVCHK:                                                           1106
*   PROC;                           /* DEVICE CHECK ROUTINE          */
DEVCHK   STM   @14,@12,@SA00006                                    1106
*/****** DEVCHK **************************************************** */
*/* DEVCHK ROUTINE WILL SCAN THROUGH ALL DEVICES IN THE SYSTEM AND   */
*/* DETERMINE WHICH DEVICES SHOULD BE BROUGHT ONLINE WITH A CHANNEL  */
*/* OR CPU THAT IS BEING BROUGHT ONLINE. A RECORDER BLOCK WILL BE    */
*/* BUILT FOR EACH DEVICE TO BE BROUGHT ONLINE THEN CONTROL WILL BE  */
*/* GIVEN TO UCBMARK TO MARK THE DEVICES ONLINE.                     */
*/* POSSIBLE ERROR INDICATORS ARE: DEVNOTON                          */
*/****************************************************************** */
*                                                                  1107
*   /*****************************************************************/
*   /*                                                               */
*   /* CALL PATH VALIDATE ROUTINE TO UPDATE ALL UCB PATHMASKS FOR THE*/
*   /* NEW SYSTEM ELEMENT BROUGHT ONLINE.                            */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1107
*   CALL PATHVAL;                   /* GO VALIDATE PATHS             */
*                                                                  1107
         BAL   @14,PATHVAL                                         1107
*   /*****************************************************************/
*   /*                                                               */
*   /* DETERMINE IF ENQ RESOURCE NEEDS TO BE OBTAINED.               */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1108
*   IF UCBENQ^='1'B THEN            /* IF RESOURCE IS NOT OWNED, ENQ */
         TM    UCBENQ,B'00000010'                                  1108
         BO    @RF01108                                            1108
*     DO;                                                          1109
*       GEN(ENQ  (UCBENQQ,UCBENQR,S,2,SYSTEM));/* ENQ ON UCB RESOURCE*/
         ENQ  (UCBENQQ,UCBENQR,S,2,SYSTEM)
*       UCBENQ='1'B;                /* SET FOOTPRINT                 */
         OI    UCBENQ,B'00000010'                                  1111
*     END;                                                         1112
*                                                                  1112
*   /*****************************************************************/
*   /*                                                               */
*   /* SET UP PARMS FOR IEEVDEV THAT ARE COMMON FOR THIS ROUTINE     */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1113
*   LINKPTR=ADDR(DEVSUBP);          /* LINKAGE POINTER FOR LINK      */
*                                                                  1113
@RF01108 LA    @12,DEVSUBP                                         1113
         ST    @12,LINKPTR                                         1113
*   /*****************************************************************/
*   /*                                                               */
*   /* LOAD MODULE IEEVDEV AND SAVE ADDRESS FOR LATER BALR LINK      */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1114
*   GEN(LOAD  EP=IEEVDEV);          /* LOAD MODULE IEEVDEV           */
         LOAD  EP=IEEVDEV
*   RFY                                                            1115
*    (R0) RSTD;                     /* RESTRICT REG                  */
*   DEVADDR=R0;                     /* SAVE IEEVDEV ADDRESS          */
         ST    R0,DEVADDR                                          1116
*   RFY                                                            1117
*    (R0) UNRSTD;                   /* RELEASE REG                   */
*                                                                  1117
*   /*****************************************************************/
*   /*                                                               */
*   /* SET UP TO SCAN ALL DEVICES TO DECIDE WHICH ARE TO BE BROUGHT  */
*   /* ONLINE                                                        */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1118
*   DO UCBLKPTR=CVTILK2 BY 2 WHILE(UCBTAB^='FFFF'X);/* LOOP TO END OF
*                                      TABLE                         */
*                                                                  1118
         L     @12,CVTPTR                                          1118
         L     @12,CVTILK2(,@12)                                   1118
         ST    @12,UCBLKPTR                                        1118
         B     @DE01118                                            1118
@DL01118 DS    0H                                                  1119
*     /***************************************************************/
*     /*                                                             */
*     /* CHECK FOR DUMMY ENTRY IN LOOKUP TABLE AND SKIP TO NEXT IF   */
*     /* FOUND                                                       */
*     /*                                                             */
*     /***************************************************************/
*                                                                  1119
*     IF UCBTAB='0000'X THEN        /* DUMMY ENTRY?                  */
         L     @12,UCBLKPTR                                        1119
         SLR   @06,@06                                             1119
         ICM   @06,3,UCBTAB(@12)                                   1119
         LTR   @06,@06                                             1119
         BZ    @RT01119                                            1119
*       GOTO DEVLOOP;               /* STEP TO NEXT                  */
*                                                                  1120
*     /***************************************************************/
*     /*                                                             */
*     /* SET UP ADDRESSABILITY TO THIS UCB                           */
*     /*                                                             */
*     /***************************************************************/
*                                                                  1121
*     UCBPTR=UCBTAB;                /* SET UP UCB POINTER            */
*                                                                  1121
         ST    @06,UCBPTR                                          1121
*     /***************************************************************/
*     /*                                                             */
*     /* DETERMINE IF UCB SHOULD BE BROUGHT ONLINE. SKIP ANY THAT    */
*     /* WILL NOT BE AFFECTED. DEVICES TO SKIP ARE ANY THAT ARE      */
*     /* ALREADY ONLINE, OFFLINE FOR OPERATOR REASONS, AND MULTIPLE  */
*     /* EXPOSURE DEVICES SUB UCB'S                                  */
*     /*                                                             */
*     /***************************************************************/
*                                                                  1122
*     IF(UCBMTPXP='1'B&UCBBASE^=(UCBPTR-512))×UCBONLI='1'B/* ONLINE? */
*       THEN                        /*                       @ZA00856*/
         TM    UCBMTPXP(@06),B'00001000'                           1122
         BNO   @GL00030                                            1122
         LR    @12,@06                                             1122
         SH    @12,@CH01762                                        1122
         C     @12,UCBBASE(,@06)                                   1122
         BNE   @RT01122                                            1122
@GL00030 L     @12,UCBPTR                                          1122
         TM    UCBONLI(@12),B'10000000'                            1122
         BO    @RT01122                                            1122
*       GOTO DEVLOOP;               /* SKIP TO NEXT DEVICE           */
*     IF UCBVORSN='1'B THEN         /* OFFLINE FOR OPERATOR  @ZA29619*/
         TM    UCBVORSN(@12),B'00000100'                           1124
         BO    @RT01124                                            1124
*       GOTO DEVLOOP;               /* REASON - SKIP DEVICE  @ZA29619*/
*                                                                  1125
*     /***************************************************************/
*     /*                                                             */
*     /* SET UP REMAINING PARAMETERS TO LINK TO IEEVDEV TO CHECK PATH*/
*     /* STATUS FOR DEVICE CHECK FOR COMMUNICATIONS UCB AND SKIP IF  */
*     /* I/O IS ACTIVE ON DEVICE.                            @ZA00078*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  1126
*     IF UCB3COMM='1'B&UCBACTV='1'B THEN/*                   @ZA00078*/
         TM    UCB3COMM(@12),B'01000000'                           1126
         BNO   @RF01126                                            1126
         TM    UCBACTV(@12),B'00000010'                            1126
         BO    @RT01126                                            1126
*       GOTO DEVLOOP;               /* SKIP ACTIVE COMMUNICATIONS UCB
*                                                            @ZA00078*/
*/*  THE ONLINE/OFFLINE STATUS OF THE MSC MUST NOT CHANGE. @G24LP2L  */
*                                                                  1128
*     IF UCBTBYT4='42'X THEN                                       1128
@RF01126 L     @12,UCBPTR                                          1128
         CLI   UCBTBYT4(@12),X'42'                                 1128
         BE    @RT01128                                            1128
*       GOTO DEVLOOP;               /* THE MSC STATUS CANNOT CHANGE
*                                      TO ONLINE.            @G24LP2L*/
*     DEVSUBUB=UCBPTR;              /* ADDRESS OF UCB COMMON SEGEMENT*/
         ST    @12,DEVSUBUB                                        1130
*     DEVSUBGO='1'B;                /* FOOTPRINT                     */
         OI    DEVSUBGO,B'00010000'                                1131
*     RFY                                                          1132
*      (R1,                                                        1132
*       R14,                                                       1132
*       R15) RSTD;                  /* RESTRICT REGISTERS            */
*     R1=ADDR(LINKPTR);             /* PARAMETER LIST TO BE PASSED   */
         LA    R1,LINKPTR                                          1133
*     DEVSUBCP=HEXCPU1;             /* UPDATE THE PARM LIST  @ZA27917*/
         MVC   DEVSUBCP(1),HEXCPU1                                 1134
*     DEVSUBCH=HEXCHN1;             /* WITH CPU & CHAN ID    @ZA27917*/
*                                                                  1135
         MVC   DEVSUBCH(1),HEXCHN1                                 1135
*     /***************************************************************/
*     /*                                                             */
*     /* DETERMINE THE TYPE OF COMMAND AND SET IEEVDEV FUNCTION CODE */
*     /* ACCORDING. BALR TO IEEVDEV TO TEST THE STATUS OF THE        */
*     /* SPECIFIED DEVICE ASSOCIATED WITH THE CHANNEL OR CPU         */
*     /* SPECIFIED                                           @ZA27917*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  1136
*     IF CHNIND='1'B THEN           /* CHANNEL COMMAND?      @ZA27917*/
         TM    CHNIND,B'10000000'                                  1136
         BNO   @RF01136                                            1136
*       DEVSUBFC=4;                 /* SET FUNC CODE 4       @ZA27917*/
         MVI   DEVSUBFC,X'04'                                      1137
*     ELSE                          /* NO - MUST BE CPU CMD  @ZA27917*/
*       DEVSUBFC=3;                 /* SET FUNC CODE 3       @ZA27917*/
         B     @RC01136                                            1138
@RF01136 MVI   DEVSUBFC,X'03'                                      1138
*     R15=DEVADDR;                  /* ADDR OF IEEVDEV       @ZA27917*/
@RC01136 L     R15,DEVADDR                                         1139
*     GEN(BALR R14,R15);            /* LINK TO IEEVDEV       @ZA27917*/
         BALR R14,R15
*     RFY                                                          1141
*      (RETCODE) RSTD;              /* RESTRIC RETURN REG    @ZA27917*/
*     IF RETCODE=4 THEN             /* PATH NOT AVAILABLE    @ZA27917*/
         CH    RETCODE,@CH00076                                    1142
         BE    @RT01142                                            1142
*       GOTO DEVLOOP;               /* SKIP TO NEXT DEVICE   @ZA27917*/
*     DEVSUBFC=0;                   /* FUNCTION CODE 0       @ZA27917*/
         MVI   DEVSUBFC,X'00'                                      1144
*     R1=ADDR(LINKPTR);             /* PARM LIST TO BE PASSED      1145
*                                                            @ZA27917*/
         LA    R1,LINKPTR                                          1145
*     GEN(BALR R14,R15);            /* LINK TO IEEVDEV       @ZA27917*/
         BALR R14,R15
*     RFY                                                          1147
*      (R1,                                                        1147
*       R14,                                                       1147
*       R15) UNRSTD;                /* RELEASE REGS          @ZA27917*/
*     DEVSUBGO='0'B;                /* RESET FOOTPRINT               */
*                                                                  1148
         NI    DEVSUBGO,B'11101111'                                1148
*     /***************************************************************/
*     /*                                                             */
*     /* CHECK RETURN CODE TO DETERMINE IF DEVICE CAN BE BROUGHT     */
*     /* ONLINE                                                      */
*     /*                                                             */
*     /***************************************************************/
*                                                                  1149
*     IF RETCODE=0 THEN             /* ZERO RETURN CODE ?            */
         LTR   RETCODE,RETCODE                                     1149
         BNZ   @RF01149                                            1149
*       DO;                                                        1150
*                                                                  1150
*         /***********************************************************/
*         /*                                                         */
*         /* RETURN CODE WAS ZERO DEVICE CAN BE BROUGHT ONLINE SET UP*/
*         /* TO BUILD A RECORDER BLOCK                               */
*         /*                                                         */
*         /***********************************************************/
*                                                                  1151
*         DEVON='1'B;               /* DEVICE ON ENTRY               */
         OI    DEVON,B'00100000'                                   1151
*         CALL UCBRCRDR;            /* BUILD RECORDER BLOCK          */
*                                                                  1152
         BAL   @14,UCBRCRDR                                        1152
*         /***********************************************************/
*         /*                                                         */
*         /* CHECK FOR ERROR FROM BUILDING RECORDER BLOCK            */
*         /*                                                         */
*         /***********************************************************/
*                                                                  1153
*         IF NOCORE='1'B THEN       /* NOCORE ERROR ?                */
         TM    NOCORE,B'00000001'                                  1153
         BNO   @RF01153                                            1153
*           DO;                                                    1154
*             NOCORE='0'B;          /* RESET ERROR INDICATOR         */
         NI    NOCORE,B'11111110'                                  1155
*             DEVNOTON='1'B;        /* SET DEVICE NOT ALL ON       1156
*                                      INDICATOR                     */
         OI    DEVNOTON,B'01000000'                                1156
*           END;                                                   1157
*       END;                                                       1158
*                                                                  1158
*     /***************************************************************/
*     /*                                                             */
*     /* RETURN CODE WAS NOT ZERO. IF RETURN CODE IS OTHER THAN FOUR */
*     /* THEN SET NOT ALL DEVICES BROUGHT ONLINE ERROR FLAG          */
*     /*                                                             */
*     /***************************************************************/
*                                                                  1159
*     ELSE                                                         1159
*                                                                  1159
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK FOR ANY ERROR RETURN CODE FROM IEEVDEV. RETURN CODE */
*       /* FOUR INDICATES NO AVAILABLE PATHS, RETURN CODE SIXTEEN    */
*       /* INDICATES DEVICE IN USE BY SYSTEM FUNCTION. ANY THING ELSE*/
*       /* IS INVALID                                                */
*       /*                                                           */
*       /*************************************************************/
*                                                                  1159
*       IF RETCODE^=4&RETCODE^=16 THEN/* INVALID RETURN CODE?        */
         B     @RC01149                                            1159
@RF01149 CH    RETCODE,@CH00076                                    1159
         BE    @RF01159                                            1159
         CH    RETCODE,@CH00055                                    1159
         BE    @RF01159                                            1159
*         DEVNOTON='1'B;            /* SET ERROR FLAG                */
         OI    DEVNOTON,B'01000000'                                1160
*     RFY                                                          1161
*      (RETCODE) UNRSTD;            /* RELEASE REGISTER 15 FOR USE   */
@RF01159 DS    0H                                                  1161
@RC01149 DS    0H                                                  1162
*DEVLOOP:                                                          1162
*   END;                            /* END OF DOLOOP                 */
*                                                                  1162
DEVLOOP  LA    @12,2                                               1162
         AL    @12,UCBLKPTR                                        1162
         ST    @12,UCBLKPTR                                        1162
@DE01118 L     @12,UCBLKPTR                                        1162
         CLC   UCBTAB(2,@12),@CH03658                              1162
         BNE   @DL01118                                            1162
*   /*****************************************************************/
*   /*                                                               */
*   /* ISSUE IOS CHANNEL RESTART TO INFORM IOS OF NEW CHANNELS       */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1163
*   RFY                                                            1163
*    (R1,                                                          1163
*     R12,                                                         1163
*     R14,                                                         1163
*     R15) RSTD;                                                   1163
*   R12=HEXCPUAD;                   /* CPU TO RESTART CHANNELS FOR 1164
*                                                            @YM03483*/
         SLR   R12,R12                                             1164
         ICM   R12,3,HEXCPUAD                                      1164
*   GEN REFS(CVTIXAVL,IOCOM,IOCOMEX,IOCCTBL,IOX,IOXCHMSK,IRTENTRY, 1165
*       IRTCHMSK,LCCAIRT)(IOSGEN  RESTART,REG=(R1,R12,R14,R15),VAR=ALL)
*       ;                                                          1165
         IOSGEN  RESTART,REG=(R1,R12,R14,R15),VAR=ALL
*   RFY                                                            1166
*    (R1,                                                          1166
*     R12,                                                         1166
*     R14,                                                         1166
*     R15) UNRSTD;                  /* RELEASE REGISTERS             */
*                                                                  1166
*   /*****************************************************************/
*   /*                                                               */
*   /* ALL RECORDER BLOCKS HAVE BEEN BUILT GO TO UCB MARK ROUTINE    */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1167
*   CALL UCBMARK;                   /* GO MARK UCB'S                 */
         BAL   @14,UCBMARK                                         1167
*   GEN(DEQ  (UCBENQQ,UCBENQR,2,SYSTEM));/* RELEASE UCB RESOURCE     */
         DEQ  (UCBENQQ,UCBENQR,2,SYSTEM)
*   UCBENQ='0'B;                    /* RESET FOOTPRINT               */
         NI    UCBENQ,B'11111101'                                  1169
*   END;                            /* END OF DEVCHK                 */
@EL00006 DS    0H                                                  1170
@EF00006 DS    0H                                                  1170
@ER00006 LM    @14,@12,@SA00006                                    1170
         BR    @14                                                 1170
*UCBMARK:                                                          1171
*   PROC OPTIONS(SAVE,SAVEAREA);                                   1171
*                                                                  1171
UCBMARK  STM   @14,@12,12(@13)                                     1171
         ST    @13,@SA00007+4                                      1171
         LA    @14,@SA00007                                        1171
         ST    @14,8(,@13)                                         1171
         LR    @13,@14                                             1171
*/***** UCBMARK ***************************************************  */
*/* UCBMARK WILL STEP THROUGH  THE RECORDER BLOCK ENTRIES AND MARK   */
*/* THE UCB REPRESENTED BY THAT BLOCK EITHER ONLINE, OFFLINE,OR      */
*/* SET THE HIERARCHY REASON INDICATOR AS REQUIRED. IF A UCB IS TO   */
*/* BE TAKEN OFFLINE THEN NORMAL UNLOAD PROCESSING WILL BE PER-      */
*/* FORMED                                                           */
*/*****************************************************************  */
*                                                                  1172
*   RCRDRPTR=ENTRYPTR;              /* ADDRESSABILITY TO FIRST     1172
*                                      RECORDER BLOCK                */
*                                                                  1172
         L     RCRDRPTR,ENTRYPTR                                   1172
*   /*****************************************************************/
*   /*                                                               */
*   /* SET UP DOLOOP TO SCAN THROUGH ALL RECORDER BLOCKS AND MARK    */
*   /* UCB'S                                                         */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1173
*   DO WHILE(RCRDRPTR^=0);          /* SCAN ALL RECORDER BLOCKS      */
*                                                                  1173
         B     @DE01173                                            1173
@DL01173 DS    0H                                                  1174
*     /***************************************************************/
*     /*                                                             */
*     /* SET FLAG IN RECORDER BLOCK INDICATING THAT THIS ENTRY HAS   */
*     /* BEEN PROCESSED AND SET UP ADDRESSABILITY TO UCB             */
*     /*                                                             */
*     /***************************************************************/
*                                                                  1174
*     UCBPTR=UCBADDR;               /* ADDRESSABILITY TO UCB       1174
*                                      REPRESENTED                   */
*                                                                  1174
         SLR   @12,@12                                             1174
         ICM   @12,7,UCBADDR(RCRDRPTR)                             1174
         ST    @12,UCBPTR                                          1174
*     /***************************************************************/
*     /*                                                             */
*     /* DETERMINE IF THIS IS A REQUEST TO MARK DEVICE ONLINE        */
*     /*                                                             */
*     /***************************************************************/
*                                                                  1175
*     IF MKDEVON='1'B THEN          /* ONLINE REQUEST?               */
         TM    MKDEVON(RCRDRPTR),B'00100000'                       1175
         BNO   @RF01175                                            1175
*       DO;                                                        1176
*         ALTERUCB='1'B;            /* THIS ENTRY PROCESSED          */
         OI    ALTERUCB(RCRDRPTR),B'00001000'                      1177
*         UCBALTER='1'B;            /* A UCB HAS BEEN ALTERED        */
         OI    UCBALTER,B'10000000'                                1178
*         UCBVHRSN='0'B;            /* RESET HIER REASON INDICATOR   */
         NI    UCBVHRSN(@12),B'11111101'                           1179
*         UCBONLI='1'B;             /* MARK DEVICE ONLINE            */
         OI    UCBONLI(@12),B'10000000'                            1180
*       END;                                                       1181
*                                                                  1181
*     /***************************************************************/
*     /*                                                             */
*     /* WAS NOT ONLINE REQUEST.. DETERMINE IF DEVICE IS TO BE MARKED*/
*     /* OFFLINE OR SET HIERARCHY REASON INDICATOR                   */
*     /*                                                             */
*     /***************************************************************/
*                                                                  1182
*     ELSE                                                         1182
*                                                                  1182
*       /*************************************************************/
*       /*                                                           */
*       /* WAS THIS A OFFLINE REQUEST ?                              */
*       /*                                                           */
*       /*************************************************************/
*                                                                  1182
*       IF MKDEVOFF='1'B×HIERONLY='1'B THEN/* OFFLINE REQUEST        */
         B     @RC01175                                            1182
@RF01175 TM    MKDEVOFF(RCRDRPTR),B'10010000'                      1182
         BZ    @RF01182                                            1182
*         DO;                                                      1183
*           UCBALTER='1'B;          /* A UCB HAS BEEN ALTERED        */
         OI    UCBALTER,B'10000000'                                1184
*           ALTERUCB='1'B;          /* THIS ENTRY HAS BEEN PROCESSED */
         OI    ALTERUCB(RCRDRPTR),B'00001000'                      1185
*           UCBVHRSN='1'B;          /* SET HIER REASON FLAG IN UCB   */
         L     @12,UCBPTR                                          1186
         OI    UCBVHRSN(@12),B'00000010'                           1186
*           UCBONLI='0'B;           /* MARK DEVICE OFFLINE           */
*                                                                  1187
         NI    UCBONLI(@12),B'01111111'                            1187
*           /*********************************************************/
*           /*                                                       */
*           /* DEVICE IS MARKED OFFLINE DETERMINE IF DEVICE SHOULD BE*/
*           /* UNLOADED (TAPE OR DISK )                              */
*           /*                                                       */
*           /*********************************************************/
*                                                                  1188
*           IF(UCB3TAPE='1'B×UCB3DACC='1'B)&HIERONLY^='1'B THEN    1188
*                                                                  1188
         TM    UCB3TAPE(@12),B'10100000'                           1188
         BZ    @RF01188                                            1188
         TM    HIERONLY(RCRDRPTR),B'10000000'                      1188
         BO    @RF01188                                            1188
*             /*******************************************************/
*             /*                                                     */
*             /* DEVICE IS TAPE OR DISK AND THIS WAS NOT A HIERARCHY */
*             /* ONLY REQUEST SO PERFORM OFFLINE PROCESSING          */
*             /*                                                     */
*             /*******************************************************/
*                                                                  1189
*             DO;                                                  1189
*               RFY                                                1190
*                (R1) RSTD;         /* RESTRICT REG ONE              */
*               VMVREQBP=ADDR(VMVPARMS);/* SET UP PARM POINTER       */
         LA    @12,VMVPARMS                                        1191
         ST    @12,VMVREQBP                                        1191
*               VMVUNLOD='1'B;      /* SET UNLOAD INDICATOR          */
*               VMVUCB='1'B;        /* SET UCB INDICATOR             */
         OI    VMVUNLOD(@12),B'11000000'                           1193
*               VMVUCBP=UCBADDR;    /* POINT TO UCB COMMON SEGEMENT  */
         MVC   VMVUCBP(3,@12),UCBADDR(RCRDRPTR)                    1194
*               DO;                 /* LINK EP('IEFAB49C')         1195
*                                      PARAM(VMVREQBP,0,0)           */
*                 I00601='00'X;     /* EP/DE FLAG                    */
         MVI   I00601,X'00'                                        1196
*                 I00602=ADDR('IEFAB49C');/* ADDR OF EP/DE           */
         LA    @12,@CC03768                                        1197
         STCM  @12,7,I00602                                        1197
*                 I00604=0;         /* DCB PTR                       */
         SLR   @12,@12                                             1198
         STCM  @12,7,I00604                                        1198
*                 I00603='00'X;     /* ERRET FLAG                    */
         MVI   I00603,X'00'                                        1199
*                 IOPTLIST(1)=ADDR(VMVREQBP);/* ADDR OF PROB PROG  1200
*                                      PARM                          */
         LA    @12,VMVREQBP                                        1200
         ST    @12,IOPTLIST                                        1200
*                 IOPTLIST(2)=ADDR(0);/* ADDR OF PROB PROG PARM      */
         LA    @12,@CF00275                                        1201
         ST    @12,IOPTLIST+4                                      1201
*                 IOPTLIST(3)=ADDR(0);/* ADDR OF PROB PROG PARM      */
         ST    @12,IOPTLIST+8                                      1202
*                 IOPTLIST(3)=IOPTLIST(3)×'80000000'X;/* SET VL BIT  */
         O     @12,@CF03772                                        1203
         ST    @12,IOPTLIST+8                                      1203
*                 RESPECIFY                                        1204
*                  (GPR01P) RESTRICTED;                            1204
*                 GPR01P=ADDR(IOPTLIST);/* ADDR OF OPTLIST           */
         LA    GPR01P,IOPTLIST                                     1205
*                 RESPECIFY                                        1206
*                  (GPR15P) RESTRICTED;                            1206
*                 GPR15P=ADDR(I006);/* ADDR OF LINK LIST             */
         LA    GPR15P,I006                                         1207
*                 SVC(6);           /* ISSUE LINK SVC                */
         SVC   6                                                   1208
*                 RESPECIFY                                        1209
*                  (GPR01P) UNRESTRICTED;                          1209
*                 RESPECIFY                                        1210
*                  (GPR15P) UNRESTRICTED;                          1210
*               END;                /* LINK EP('IEFAB49C')         1211
*                                      PARAM(VMVREQBP,0,0) LINK TO 1211
*                                      ROUTINE                       */
*               UCBRESV='0'B;       /* RESET RESERVED INDICATOR      */
*               UCBCHGS='0'B;       /* RESET PENDING OFFLINE       1213
*                                      INDICATOR                     */
         L     @12,UCBPTR                                          1213
         NI    UCBRESV(@12),B'10011111'                            1213
*               RFY                                                1214
*                (R1) UNRSTD;       /* RELEASE REG ONE               */
*             END;                                                 1215
*                                                                  1215
*           /*********************************************************/
*           /*                                                       */
*           /* DEVICE WAS NOT A TAPE OR DASD. CHECK IF DEVICE HAS A  */
*           /* ERROR BUFFER WHICH MUST BE RECORDED                   */
*           /*                                                       */
*           /*********************************************************/
*                                                                  1216
*           ELSE                    /*                       @Z40MPXA*/
*                                                                  1216
*             /*******************************************************/
*             /*                                                     */
*             /* CHECK FOR ERROR BUFFER                              */
*             /*                                                     */
*             /*******************************************************/
*                                                                  1216
*             IF UCBERLOG='1'B&HIERONLY^='1'B THEN/* ERROR LOG?      */
         B     @RC01188                                            1216
@RF01188 L     @12,UCBPTR                                          1216
         L     @11,UCBEXTPT(,@12)                                  1216
         TM    UCBERLOG(@11),B'00000100'                           1216
         BNO   @RF01216                                            1216
         TM    HIERONLY(RCRDRPTR),B'10000000'                      1216
         BO    @RF01216                                            1216
*               DO;                 /*                       @ZA15762*/
*                                                                  1217
*                 /***************************************************/
*                 /*                                                 */
*                 /* SET UP TO RECORD BUFFER FOR DEVICE              */
*                 /*                                                 */
*                 /***************************************************/
*                                                                  1218
*                 RFY                                              1218
*                  (R0,                                            1218
*                   R1) RSTD;       /* RESTRICT REGISTERS    @Z40MPXA*/
*                 R0=-UCBPTR;       /* UCB ADDRESS COMPLEMENT      1219
*                                                            @Z40MPXA*/
         LCR   @12,@12                                             1219
         LR    R0,@12                                              1219
*                 R1=0;             /* ZERO REGISTER FOR CALL      1220
*                                                            @Z40MPXA*/
         SLR   R1,R1                                               1220
*                 SVC(91);          /* ISSUE SVC             @Z40MPXA*/
         SVC   91                                                  1221
*                 RFY                                              1222
*                  (R0,                                            1222
*                   R1) UNRSTD;     /* RELEASE REGISTERS     @Z40MPXA*/
*               END;                /*                       @Z40MPXA*/
*         END;                      /* END OF DEVOFF PROCESSING      */
@RF01216 DS    0H                                                  1224
@RC01188 DS    0H                                                  1225
*     RCRDRPTR=NEXTPTR;             /* ADDRESSABILITY FOR NEXT     1225
*                                      RECORDER BLOCK                */
@RF01182 DS    0H                                                  1225
@RC01175 L     RCRDRPTR,NEXTPTR(,RCRDRPTR)                         1225
*   END;                            /* END OF DO LOOP                */
@DE01173 LTR   RCRDRPTR,RCRDRPTR                                   1226
         BNZ   @DL01173                                            1226
*   UCBDONE='1'B;                   /* SET UCB COMPLETE FLAG         */
         OI    UCBDONE,B'01000000'                                 1227
*   END;                            /* ******* END OF UCBMARK PROC   */
@EL00007 L     @13,4(,@13)                                         1228
@EF00007 DS    0H                                                  1228
@ER00007 LM    @14,@12,12(@13)                                     1228
         BR    @14                                                 1228
*                                                                  1229
*/****** PSAFREE *****************************************************
*                                                                    */
*/* ROUTINE WILL INSURE THAT ALL ONLINE CPU'S HAVE BEEN ENABLED AT   */
*/* LEAST ONCE THEN WILL ZERO ALL PSA POINTERS TO THE SUBJECT CPU'S  */
*/* PSA AND FREE THE 4K PSA. IF ANY ERRORS ARE ENCOUNTERED THE PSA   */
*/* WILL NOT BE FREED                                                */
*/********************************************************************/
*                                                                  1229
*PSAFREE:                                                          1229
*   PROC;                                                          1229
*                                                                  1229
PSAFREE  STM   @14,@12,@SA00008                                    1229
*   /*****************************************************************/
*   /*                                                               */
*   /* SET UP LOOP TO SCAN ALL CPU'S POSSIBLE IN THE SYSTEM          */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1230
*   DO LOOPCNT=0 TO 15;             /* LOOP CONTROL                  */
*                                                                  1230
         SLR   @12,@12                                             1230
         ST    @12,LOOPCNT                                         1230
@DL01230 DS    0H                                                  1231
*     /***************************************************************/
*     /*                                                             */
*     /* BUILD BIT MASK REPRESENTING THIS CPU TO TEST ALIVE MASK     */
*     /*                                                             */
*     /***************************************************************/
*                                                                  1231
*     TEMPMASK=CSDMASK(LOOPCNT+1);  /* PICK UP BIT MASK FROM CSD     */
*                                                                  1231
         LR    @06,@12                                             1231
         ALR   @06,@06                                             1231
         L     @04,CVTPTR                                          1231
         L     @15,CVTCSD(,@04)                                    1231
         ALR   @06,@15                                             1231
         SLR   TEMPMASK,TEMPMASK                                   1231
         ICM   TEMPMASK,3,CSDMASK(@06)                             1231
*     /***************************************************************/
*     /*                                                             */
*     /* CHECK IF SUBJECT CPU IS ONLINE                              */
*     /*                                                             */
*     /***************************************************************/
*                                                                  1232
*     IF(CSDCPUAL&TEMPMASK)^=0 THEN /* CPU OFFLINE                   */
         LR    @06,TEMPMASK                                        1232
         SLR   @03,@03                                             1232
         ICM   @03,3,CSDCPUAL(@15)                                 1232
         NR    @06,@03                                             1232
         LTR   @06,@06                                             1232
         BZ    @RF01232                                            1232
*       DO;                                                        1233
*                                                                  1233
*         /***********************************************************/
*         /*                                                         */
*         /* CPU IS ALIVE WAIT TILL CPU HAS BEEN ENABLED AT LEAST    */
*         /* ONCE                                                    */
*         /*                                                         */
*         /***********************************************************/
*                                                                  1234
*         RFY                                                      1234
*          (R1,                                                    1234
*           R11,                                                   1234
*           R12,                                                   1234
*           RETCODE) RSTD;          /* RESTRICT REGS         @YM08660*/
*         R1=PCCAT00P(LOOPCNT+1);   /* ADDRESS OF PCCA               */
         L     @14,LOOPCNT                                         1235
         SLA   @14,2                                               1235
         L     @10,CVTPCCAT(,@04)                                  1235
         L     R1,PCCAT00P(@14,@10)                                1235
*         R12=ADDR(CVTBRET);        /* LOAD ADDRESS OF BR14          */
         LA    R12,CVTBRET(,@04)                                   1236
*         GEN(RISGNL  SERIAL,CPU=(1),EP=(12));/* CAUSE TASK SWITCH   */
*                                                                  1237
         RISGNL  SERIAL,CPU=(1),EP=(12)
*         /***********************************************************/
*         /*                                                         */
*         /* CHECK FOR ANY ERROR RETURN CODE. IF SO DO NOT FREE PSA  */
*         /*                                                         */
*         /***********************************************************/
*                                                                  1238
*         IF RETCODE^=0&RETCODE^=4 THEN                            1238
         LTR   RETCODE,RETCODE                                     1238
         BZ    @RF01238                                            1238
         CH    RETCODE,@CH00076                                    1238
         BNE   @RT01238                                            1238
*           GOTO PSAFREXT;          /* RETURN TO CALLER              */
*         RFY                                                      1240
*          (R1,                                                    1240
*           R11,                                                   1240
*           R12,                                                   1240
*           RETCODE) UNRSTD;        /* RELEASE REGS FOR USE  @YM08660*/
@RF01238 DS    0H                                                  1241
*       END;                        /* END OF FREE ROUTINE           */
*   END;                            /* END OF CPU SCAN ROUTINE       */
*                                                                  1242
@RF01232 LA    @12,1                                               1242
         AL    @12,LOOPCNT                                         1242
         ST    @12,LOOPCNT                                         1242
         CH    @12,@CH00344                                        1242
         BNH   @DL01230                                            1242
*   /*****************************************************************/
*   /*                                                               */
*   /* SET UP CONDITIONS TO FREE PSA LOAD PCCA AND LCCA POINTERS FOR */
*   /* SUBJECT CPU                                                   */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1243
*   PCCAPTR=PCCAT00P(HEXCPUAD+1);   /* LOAD PCCA ADDRESS             */
         SLR   @12,@12                                             1243
         ICM   @12,3,HEXCPUAD                                      1243
         SLA   @12,2                                               1243
         L     @06,CVTPTR                                          1243
         L     @06,CVTPCCAT(,@06)                                  1243
         L     @12,PCCAT00P(@12,@06)                               1243
         ST    @12,PCCAPTR                                         1243
*   COREPTR=PCCAPSAV;               /* ADDRESS OF PSA TO FREE        */
         MVC   COREPTR(4),PCCAPSAV(@12)                            1244
*   GETLENG=LENGTH(PSA);            /* LENGTH TO FREE IS 4K          */
         MVC   GETLENG(2),@CH03995                                 1245
*   SUBPOOL=245;                    /* SUBPOOL NUMBER TO FREE        */
*                                                                  1246
         MVI   SUBPOOL,X'F5'                                       1246
*   /*****************************************************************/
*   /*                                                               */
*   /* ZERO ALL POINTERS TO THIS PSA                                 */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1247
*   PCCAPSAV=0;                     /*                               */
         SLR   @06,@06                                             1247
         ST    @06,PCCAPSAV(,@12)                                  1247
*   PCCAPSAR=0;                     /* ZERO POINTER                  */
*                                                                  1248
         ST    @06,PCCAPSAR(,@12)                                  1248
*   /*****************************************************************/
*   /*                                                               */
*   /* CALL FREEMAIN ROUTINE TO FREE PSA                             */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1249
*   CALL FREECORE;                                                 1249
         BAL   @14,FREECORE                                        1249
*PSAFREXT:                                                         1250
*   END;                            /* END OF PSAFREE ROUTINE        */
@EL00008 DS    0H                                                  1250
@EF00008 DS    0H                                                  1250
@ER00008 LM    @14,@12,@SA00008                                    1250
         BR    @14                                                 1250
*CONVERT:                                                          1251
*   PROC(HEXRSLT,BITMASK) OPTIONS(NOSAVEAREA);                     1251
CONVERT  STM   @14,@12,12(@13)                                     1251
         MVC   @PC00009(8),0(@01)                                  1251
*   DCL                                                            1252
*     HEXRSLT FIXED(16),            /* RESULT FIELD PASSED BY CALLER */
*     BITMASK FIXED(16),            /* BIT MASK FIELD PASSED BY    1252
*                                      CALLER                        */
*     CONVCHAR BIT(8) BASED(CHARPTR);/* CHARACTER TO BE CONVERTED    */
*/*** CONVERT ROUTINE ******************************************     */
*/* CONVERT ROUTINE WILL CONVERT A EBDIC CHARACTER POINTED TO BY     */
*/* CHARPTR INTO A HEX DIGIT AND BUILD A BIT BASK REPRESENTING       */
*/* THE CONVERTED CHARACTER. TWO PARAMETERS ARE REQUIRED. HEXRSLT    */
*/* LOCATION AND BITMASK LOCATION, CHARPTR WILL NOT BE MODIFIED      */
*/****************************************************************   */
*                                                                  1253
*   HEXRSLT=CONVCHAR;               /* MOVE CHARACTER TO BE CONVERTED*/
*                                                                  1253
         L     @12,@PC00009                                        1253
         SLR   @06,@06                                             1253
         IC    @06,CONVCHAR(,CHARPTR)                              1253
         STH   @06,HEXRSLT(,@12)                                   1253
*   /*****************************************************************/
*   /*                                                               */
*   /* DETERMINE IF CHAR IS ALPHA OR NUMERIC. CONVERT TO HEX BY      */
*   /* REMOVING ZONE FOR NUMERICS, OR REMOVING ZONE AND ADDING 9 FOR */
*   /* ALPHA CHARACTERS                                              */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1254
*   IF HEXRSLT<'0' THEN             /* CHECK FOR ALPHA               */
         CH    @06,@CH03594                                        1254
         BNL   @RF01254                                            1254
*     HEXRSLT=HEXRSLT-183;          /* REMOVE ZONE AND ADJUST        */
*                                                                  1255
         SH    @06,@CH03789                                        1255
         STH   @06,HEXRSLT(,@12)                                   1255
*   /*****************************************************************/
*   /*                                                               */
*   /* WAS NOT A ALPHA CHARACTER. MUST THEN BE A DECIMAL DIGIT       */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1256
*   ELSE                                                           1256
*     HEXRSLT=HEXRSLT-240;          /* IS NUMERIC REMOVE ZONE        */
*                                                                  1256
         B     @RC01254                                            1256
@RF01254 L     @12,@PC00009                                        1256
         SLR   @06,@06                                             1256
         ICM   @06,3,HEXRSLT(@12)                                  1256
         SH    @06,@CH03790                                        1256
         STH   @06,HEXRSLT(,@12)                                   1256
*   /*****************************************************************/
*   /*                                                               */
*   /* PICK UP BIT MASK FROM CSD REPRESENTING CPU SPECIFIED          */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1257
*   BITMASK=CSDMASK(HEXRSLT+1);     /* PICK UP BIT MASK FROM CSD     */
@RC01254 L     @12,@PC00009+4                                      1257
         L     @06,@PC00009                                        1257
         SLR   @04,@04                                             1257
         ICM   @04,3,HEXRSLT(@06)                                  1257
         ALR   @04,@04                                             1257
         L     @06,CVTPTR                                          1257
         L     @06,CVTCSD(,@06)                                    1257
         ALR   @06,@04                                             1257
         MVC   BITMASK(2,@12),CSDMASK(@06)                         1257
*   END;                            /* *** END OF CONVERT ROUTINE    */
@EL00009 DS    0H                                                  1258
@EF00009 DS    0H                                                  1258
@ER00009 LM    @14,@12,12(@13)                                     1258
         BR    @14                                                 1258
*UCBRCRDR:                                                         1259
*   PROC;                                                          1259
*                                                                  1259
UCBRCRDR STM   @14,@12,@SA00010                                    1259
*/****** UCBRCRDR ************************************************** */
*/* UCBRCRDR ROUTINE WILL BUILD AND CHAIN DEVICE RECORDER BLOCKS     */
*/* BLOCKS CONSIST OF A CHAIN POINTER, UCB ADDRESS, AND FLAG FIELD   */
*/* FLAG FIELD IS SET UP BY CALLING ROUTINE AND COPIED INTO RECORD-  */
*/* ER BLOCK.                                                        */
*/* POSSIBLE ERROR FLAGS ARE: NOCORE                                 */
*/*****************************************************************  */
*                                                                  1260
*   RCRDRPTR=ENTRYPTR;              /* SET UP ADDRESSABILITY TO FIRST
*                                      RECORDER BLOCK                */
*                                                                  1260
         L     RCRDRPTR,ENTRYPTR                                   1260
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR POSSIBLE DUPLICATE ENTRY. IF DUPLICATE IS FOUND DO  */
*   /* NOT BUILD RECORDER BLOCK, RETURN CONRTOL TO CALLER SET UP     */
*   /* DOLOOP TO SCAN THROUGH RECORDER BLOCKS                        */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1261
*   DO WHILE(RCRDRPTR^=0);          /* SCAN ALL RECORDER BLOCKS      */
         B     @DE01261                                            1261
@DL01261 DS    0H                                                  1262
*     IF UCBPTR=UCBADDR THEN        /* CHECK FOR DUPLICATE ENTRY     */
         L     @12,UCBPTR                                          1262
         SLR   @11,@11                                             1262
         ICM   @11,7,UCBADDR(RCRDRPTR)                             1262
         CR    @12,@11                                             1262
         BE    @RT01262                                            1262
*       GOTO UCBRDEXT;              /* RETURN CONTROL TO CALLER IF 1263
*                                      DUPLICATE IS FOUND            */
*                                                                  1263
*     /***************************************************************/
*     /*                                                             */
*     /* WAS NOT DUPLICATE.. KEEP ON SCANNING                        */
*     /*                                                             */
*     /***************************************************************/
*                                                                  1264
*     ELSE                                                         1264
*       RCRDRPTR=NEXTPTR;           /* ADDRESSABILITY FOR NEXT BLOCK */
         L     RCRDRPTR,NEXTPTR(,RCRDRPTR)                         1264
*   END;                            /* END OF DO LOOP                */
*                                                                  1265
@DE01261 LTR   RCRDRPTR,RCRDRPTR                                   1265
         BNZ   @DL01261                                            1265
*   /*****************************************************************/
*   /*                                                               */
*   /* DUPLICATE DOES NOT EXIST.. SET UP PARAMETERS FOR GETCORE      */
*   /* ROUTINE AND GET STORAGE FOR RECORDER BLOCK.. STORAGE IS FROM  */
*   /* SUBPOOL ZERO                                                  */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1266
*   SUBPOOL=0;                      /* SUBPOOL NUMBER                */
         MVI   SUBPOOL,X'00'                                       1266
*   GETLENG=8;                      /* LENGTH OF RECORDER BLOCK      */
         MVC   GETLENG(2),@CH00036                                 1267
*   CALL GETCORE;                   /* CALL GETCORE ROUTINE          */
*                                                                  1268
         BAL   @14,GETCORE                                         1268
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR ANY POSSIBLE ERROR FROM GETCORE                     */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1269
*   IF ERRORIND^=0 THEN             /* ANY ERROR SET                 */
         SLR   @12,@12                                             1269
         CL    @12,ERRORIND                                        1269
         BNE   @RT01269                                            1269
*     GOTO UCBRDEXT;                /* RETURN CONTROL TO NEXT HIGHER
*                                      LEVEL OF CONTROL              */
*   RCRDRPTR=COREPTR;               /* ADDRESSABILITY FOR STORAGE  1271
*                                      JUST OBTAINED                 */
*                                                                  1271
         L     RCRDRPTR,COREPTR                                    1271
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK IF THIS IS FIRST RECORDER BLOCK AND CHAIN BLOCKS        */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1272
*   IF ENTRYPTR=0 THEN              /* IS THIS THE FIRST BLOCK?      */
         C     @12,ENTRYPTR                                        1272
         BNE   @RF01272                                            1272
*     NEXTPTR=0;                    /* ZERO OUT CHAIN POINTER FOR  1273
*                                      LAST ENTRY                    */
*                                                                  1273
         ST    @12,NEXTPTR(,RCRDRPTR)                              1273
*   /*****************************************************************/
*   /*                                                               */
*   /* WAS NOT FIRST BLOCK ON CHAIN. SO CHAIN BLOCKS TOGETHER        */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1274
*   ELSE                                                           1274
*     NEXTPTR=ENTRYPTR;             /* CHAIN BLOCKS TOGETHER         */
         B     @RC01272                                            1274
@RF01272 MVC   NEXTPTR(4,RCRDRPTR),ENTRYPTR                        1274
*   ENTRYPTR=RCRDRPTR;              /* ANCHOR THIS BLOCK OUT OF    1275
*                                      WORKAREA                      */
*                                                                  1275
@RC01272 ST    RCRDRPTR,ENTRYPTR                                   1275
*   /*****************************************************************/
*   /*                                                               */
*   /* BLOCKS ARE CHAINED TOGETHER.. BUILD ENTRY BY SAVING UCB       */
*   /* ADDRESS AND DEVICE STATUS FIELD OUT OF WORKAREA               */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1276
*   CAUSEFLD=DEVSTAT;               /* FLAG FIELD FROM WORKAREA      */
         MVC   CAUSEFLD(1,RCRDRPTR),DEVSTAT                        1276
*   UCBADDR=UCBPTR;                 /* UCB ADDRESS                   */
*                                                                  1277
         L     @12,UCBPTR                                          1277
         STCM  @12,7,UCBADDR(RCRDRPTR)                             1277
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THIS IS A CONSOLE ENTRY THEN SET FLAG IN UCB FOR CONSOLE   */
*   /* SWITCH ROUTINE                                                */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1278
*   IF CONSLFLG='1'B THEN           /* CONSOLE ENTRY?                */
         TM    CONSLFLG(RCRDRPTR),B'01000000'                      1278
         BNO   @RF01278                                            1278
*     UCBVHRSN='1'B;                /* SET HIER REASON INDICATOR     */
         OI    UCBVHRSN(@12),B'00000010'                           1279
*UCBRDEXT:                                                         1280
*   DEVSTAT=0;                      /* RESET FLAG FIELD IN WORKAREA  */
@RF01278 DS    0H                                                  1280
UCBRDEXT MVI   DEVSTAT,X'00'                                       1280
*   END;                            /* END OF UCB RECORDER ROUTINE   */
@EL00010 DS    0H                                                  1281
@EF00010 DS    0H                                                  1281
@ER00010 LM    @14,@12,@SA00010                                    1281
         BR    @14                                                 1281
*IEEVIOQ:                                                          1282
*   PROC;                           /*                               */
IEEVIOQ  STM   @14,@12,@SA00011                                    1282
*/****** IEEVIOQ *****************************************************/
*/* IEEVIOQ ROUTINE WILL SCAN THROUGH ALL DEVICES ON THE SYSTEM AND  */
*/* VERIFY THAT ALL I/O ACTIVITY ON THE SPECIFIED CPU/CHANNEL HAS    */
*/* COMPLETED. TESTS ARE MADE FOR OUTSTANDING DEVICE RESERVE         */
*/* CONDITIONS. POSSIBLE ERROR FLAGS ARE: PATHRSVD                   */
*/********************************************************************/
*                                                                  1283
*   IONOTQT='0'B;                   /* RESET IO NOT QUIET FLAG       */
*                                                                  1283
         NI    IONOTQT,B'11110111'                                 1283
*   /*****************************************************************/
*   /*                                                               */
*   /* SET UP DO LOOP TO SCAN THROUGH ALL SYSTEM DEVICES             */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1284
*   DO UCBLKPTR=CVTILK2 BY 2 WHILE(UCBTAB^='FFFF'X);/* SCAN          */
*                                                                  1284
         L     @12,CVTPTR                                          1284
         L     @12,CVTILK2(,@12)                                   1284
         ST    @12,UCBLKPTR                                        1284
         B     @DE01284                                            1284
@DL01284 DS    0H                                                  1285
*     /***************************************************************/
*     /*                                                             */
*     /* IF TABLE ENTRY IS ZERO THEN SKIP TO NEXT ENTRY              */
*     /*                                                             */
*     /***************************************************************/
*                                                                  1285
*     IF UCBTAB='0000'X THEN        /* SKIP TO NEXT ENTRY IF DUMMY   */
         L     @12,UCBLKPTR                                        1285
         SLR   @06,@06                                             1285
         ICM   @06,3,UCBTAB(@12)                                   1285
         LTR   @06,@06                                             1285
         BZ    @RT01285                                            1285
*       GOTO IOQLOOP;               /* STEP TO NEXT ENTRY            */
*                                                                  1286
*     /***************************************************************/
*     /*                                                             */
*     /* ESTABLISH ADDRESSABILITY TO UCB                             */
*     /*                                                             */
*     /***************************************************************/
*                                                                  1287
*     UCBPTR=UCBTAB;                /* POINT TO UCB                  */
*                                                                  1287
         ST    @06,UCBPTR                                          1287
*     /***************************************************************/
*     /*                                                             */
*     /* CHECK IF THIS IS A CHANNEL RECONFIGURATION VARY. IF SO OTHER*/
*     /* FLAGS IN THE UCB MUST BE CHECKED FOR OUTSTANDING I/O        */
*     /*                                                             */
*     /***************************************************************/
*                                                                  1288
*     IF CRH='1'B THEN              /* CRH VARY?             @Y30CQXA*/
         TM    CRH,B'00000010'                                     1288
         BNO   @RF01288                                            1288
*       DO;                         /*                       @Y30CQXA*/
*                                                                  1289
*         /***********************************************************/
*         /*                                                         */
*         /* CHECK IF LAST SIO WAS ISSUED FROM SUBJECT CHANNEL       */
*         /*                                                 @Y30CQXA*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  1290
*         IF UCBCHA^=HEXCHN1 THEN   /* FROM OUR CHANNEL      @Y30CQXA*/
         CLC   UCBCHA(1,@06),HEXCHN1                               1290
         BNE   @RT01290                                            1290
*           GOTO IOQLOOP;           /* NO.. SKIP TO NEXT UCB @Y30CQXA*/
*                                                                  1291
*         /***********************************************************/
*         /*                                                         */
*         /* LAST I/O OPERATION WAS FROM CORRECT CHANNEL NUMBER.     */
*         /* CHECK IF A OUTSTANDING RESERVE EXISTS THAT WAS ISSUED BY*/
*         /* THE REMOTE CHANNEL                                      */
*         /*                                                         */
*         /***********************************************************/
*                                                                  1292
*         IF UCBCRHRV='1'B THEN     /* RESERVE?              @Y30CQXA*/
         TM    UCBCRHRV(@06),B'00001000'                           1292
         BNO   @RF01292                                            1292
*           DO;                                                    1293
*                                                                  1293
*             /*******************************************************/
*             /*                                                     */
*             /* SET RESERVED PATH ERROR FLAG AND RETURN TO CALLER   */
*             /*                                                     */
*             /*******************************************************/
*                                                                  1294
*             DDD=UCBNAME;          /* COPY UCB NAME FOR MESSAGE   1294
*                                                            @Y30CQXA*/
         MVC   DDD(3),UCBNAME(@06)                                 1294
*             PATHRSVD='1'B;        /* SET RESERVED ERROR FLAG     1295
*                                                            @Y30CQXA*/
         OI    PATHRSVD,B'00001000'                                1295
*             GOTO IOQEXIT;         /* RETURN TO CALLER      @Y30CQXA*/
         B     IOQEXIT                                             1296
*           END;                    /* END OF RESERVE PROCESSING   1297
*                                                            @Y30CQXA*/
*                                                                  1297
*         /***********************************************************/
*         /*                                                         */
*         /* CHECK IF THE LAST I/O OPERATION WAS ON A REMOTE CHANNEL */
*         /* AND I/O HAS NOT YET COMPLETED.                          */
*         /*                                                         */
*         /***********************************************************/
*                                                                  1298
*         IF UCBIORST='1'B&(UCBBSY='1'B×UCBPSNS='1'B) THEN/* BUSY? 1298
*                                                            @Y30CQXA*/
@RF01292 L     @12,UCBPTR                                          1298
         TM    UCBIORST(@12),B'10000000'                           1298
         BNO   @RF01298                                            1298
         TM    UCBBSY(@12),B'10010000'                             1298
         BZ    @RF01298                                            1298
*           DO;                     /*                       @Y30CQXA*/
*                                                                  1299
*             /*******************************************************/
*             /*                                                     */
*             /* I/O HAS NOT YET COMPLETED. SET BUSY FOOTPRINT AND   */
*             /* CONTINUE                                            */
*             /*                                                     */
*             /*******************************************************/
*                                                                  1300
*             DDD=UCBNAME;          /* DEVICE NAME FOR MESSAGE TEXT
*                                                            @Y30CQXA*/
         MVC   DDD(3),UCBNAME(@12)                                 1300
*             IONOTQT='1'B;         /* SET BUSY FOOTPRINT    @Y30CQXA*/
         OI    IONOTQT,B'00001000'                                 1301
*           END;                    /*                       @Y30CQXA*/
*       END;                        /* END OF CRH PORTION    @Y30CQXA*/
*                                                                  1303
*     /***************************************************************/
*     /*                                                             */
*     /* WAS NOT A CRH VARY. CONTINUE NORMAL PROCESSING      @Y30CQXA*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  1304
*     ELSE                          /*                       @Y30CQXA*/
*                                                                  1304
*       /*************************************************************/
*       /*                                                           */
*       /* IF LAST I/O OPERATION WAS FROM SUBJECT CPU THEN CONTINUE  */
*       /* CHECKING                                                  */
*       /*                                                           */
*       /*************************************************************/
*                                                                  1304
*       IF UCBCPU=HEXCPU1 THEN      /* SHOULD WE CHECK THIS DEVICE?  */
*                                                                  1304
         B     @RC01288                                            1304
@RF01288 L     @12,UCBPTR                                          1304
         CLC   UCBCPU(1,@12),HEXCPU1                               1304
         BNE   @RF01304                                            1304
*         /***********************************************************/
*         /*                                                         */
*         /* LAST I/O OPERATION WAS STARTED FROM SUBJECT CPU. IF THIS*/
*         /* IS A VARY CHANNEL COMMAND THEN VERIFY THAT LAST I/O     */
*         /* OPERATION ORIGINATED FROM SPECIFIED CHANNEL             */
*         /*                                                         */
*         /***********************************************************/
*                                                                  1305
*         IF(CHNIND='1'B)&(UCBCHA^=HEXCHN1) THEN/* LAST I/O FROM OUR
*                                      CHANNEL                       */
         TM    CHNIND,B'10000000'                                  1305
         BNO   @RF01305                                            1305
         CLC   UCBCHA(1,@12),HEXCHN1                               1305
         BNE   @RT01305                                            1305
*           GOTO IOQLOOP;           /* STEP TO NEXT DEVICE           */
*                                                                  1306
*     /***************************************************************/
*     /*                                                             */
*     /* LAST I/O OPERATION WAS FROM OUR CHANNEL/CPU                 */
*     /*                                                             */
*     /***************************************************************/
*                                                                  1307
*         ELSE                                                     1307
*           DO;                                                    1307
*                                                                  1307
@RF01305 DS    0H                                                  1308
*             /*******************************************************/
*             /*                                                     */
*             /* LAST IO OPERATION WAS FROM CHANNEL/CPU COMBINATION  */
*             /* THAT IS TO GO OFFLINE. VERIFY THAT NO OUTSTANDING   */
*             /* RESERVE CONDITIONS EXIST AND I/O HAS COMPLETED      */
*             /*                                                     */
*             /*******************************************************/
*                                                                  1308
*             RFY                                                  1308
*              (R12) RSTD;          /* RESTRICT REGISTER 12          */
*             R12=UCBPTR;           /* COPY UCB ADDRESS INTO REG 12  */
         L     R12,UCBPTR                                          1309
*             GEN(IOSGEN DETECTOR,UCB=(12),VAR=1);/* CHECK FOR     1310
*                                      HARDWARE RESERVED             */
         IOSGEN DETECTOR,UCB=(12),VAR=1
*             RFY                                                  1311
*              (R12) UNRSTD;        /* RELEASE REG 12                */
*             BC(8,CONT);           /* CONDITION CODE NON ZERO     1312
*                                      INDICATES RESERVE OUTSTANDING */
         BC    8,CONT                                              1312
*             DDD=UCBNAME;          /* COPY DEVICE NAME FOR MESSAGE
*                                      TEXT                          */
         L     @12,UCBPTR                                          1313
         MVC   DDD(3),UCBNAME(@12)                                 1313
*             PATHRSVD='1'B;        /* SET RESERVED PATH ERROR FLAG  */
         OI    PATHRSVD,B'00001000'                                1314
*             GOTO IOQEXIT;         /* RETURN TO NEXT HIGHER LEVEL OF
*                                      CONTROL                       */
*                                                                  1315
         B     IOQEXIT                                             1315
*             /*******************************************************/
*             /*                                                     */
*             /* CONTINUE PROCESSING IF NO RESERVE OUTSTANDING       */
*             /*                                                     */
*             /*******************************************************/
*                                                                  1316
*CONT:                                                             1316
*                                                                  1316
*             /*******************************************************/
*             /*                                                     */
*             /* CHECK FOR OUTSTANDING I/O ACTIVITY ON THIS UCB      */
*             /*                                                     */
*             /*******************************************************/
*                                                                  1316
*             IF UCBBSY='1'B×UCBACTV='1'B×UCBPSNS='1'B THEN/* ANY I/O
*                                      OUTSTANDING?                  */
CONT     L     @12,UCBPTR                                          1316
         TM    UCBBSY(@12),B'10010010'                             1316
         BZ    @RF01316                                            1316
*               DO;                                                1317
*                 DDD=UCBNAME;      /* MOVE NAME OF DEVICE TO WORK 1318
*                                      AREA                          */
         MVC   DDD(3),UCBNAME(@12)                                 1318
*                 IONOTQT='1'B;     /* SET NOT QUIET FLAG            */
         OI    IONOTQT,B'00001000'                                 1319
*               END;                                               1320
*           END;                                                   1321
*                                                                  1321
@RF01316 DS    0H                                                  1322
*     /***************************************************************/
*     /*                                                             */
*     /* END OF UCB SCAN LOOP                                        */
*     /*                                                             */
*     /***************************************************************/
*                                                                  1322
*IOQLOOP:                                                          1322
*   END;                            /* ** END OF DO LOOP             */
*                                                                  1322
@RF01304 DS    0H                                                  1322
@RC01288 DS    0H                                                  1322
IOQLOOP  LA    @12,2                                               1322
         AL    @12,UCBLKPTR                                        1322
         ST    @12,UCBLKPTR                                        1322
@DE01284 L     @12,UCBLKPTR                                        1322
         CLC   UCBTAB(2,@12),@CH03658                              1322
         BNE   @DL01284                                            1322
*   /*****************************************************************/
*   /*                                                               */
*   /* END OF I/O QUIET ROUTINE                                      */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1323
*IOQEXIT:                                                          1323
*   END;                            /* END OF IOQUIET ROUTINE        */
@EL00011 DS    0H                                                  1323
@EF00011 DS    0H                                                  1323
@ER00011 LM    @14,@12,@SA00011                                    1323
         BR    @14                                                 1323
*PSACCA:                                                           1324
*   PROC;                           /*                       @Y30CQXA*/
PSACCA   STM   @14,@11,@SA00012                                    1324
*/******* PSACCA *****************************************************/
*/* PSACCA ROUTINE WILL OBTAIN AND INITIALIZE A NEW PCCA, LCCA AND   */
*/* PSA FOR A CPU COMING ONLINE. ADDITIONALLY ANY OLD CCA'S WILL BE  */
*/* FREED.                                                           */
*/********************************************************************/
*                                                                  1325
*   /*****************************************************************/
*   /*                                                               */
*   /* SET UP TO OBTAIN STORAGE FOR CCA'S DO NOT CHAIN STORAGE       */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1325
*   SUBPOOL=245;                    /* SPECIFY SUBPOOL NUMBER        */
         MVI   SUBPOOL,X'F5'                                       1325
*   NOCHAIN='1'B;                   /* DO NOT CHAIN STORAGE          */
         OI    NOCHAIN,B'10000000'                                 1326
*   GETLENG=(LENGTH(PCCA)+LENGTH(LCCA));/* STORAGE FOR CCA'S         */
         MVC   GETLENG(2),@CH03997                                 1327
*   CALL GETCORE;                   /* LINK TO GET CORE ROUTINE      */
*                                                                  1328
         BAL   @14,GETCORE                                         1328
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR ANY ERRORS DURING GETMAIN                           */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1329
*   IF ERRORIND^=0 THEN             /* ANY ERROR?                    */
         ICM   @06,15,ERRORIND                                     1329
         BNZ   @RT01329                                            1329
*     GOTO PSAEXIT;                 /* RETURN TO CALLER              */
*                                                                  1330
*   /*****************************************************************/
*   /*                                                               */
*   /* STORAGE HAS BEEN OBTAINED. SET UP POINTERS TO STORAGE         */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1331
*   PCCAPTR=COREPTR;                /* ADDRESS OF PCCA               */
         L     @06,COREPTR                                         1331
         ST    @06,PCCAPTR                                         1331
*   OLDPCCA=PCCAPTR;                /* SAVE ADDRESS FOR FREE INCASE
*                                      OF ERROR                      */
         ST    @06,OLDPCCA                                         1332
*   LCCAPTR=COREPTR+LENGTH(PCCA);   /* LCCA ADDRESS FOLLOWS PCCA     */
         AH    @06,@CH03961                                        1333
         ST    @06,LCCAPTR                                         1333
*   OLDLCCA=LCCAPTR;                /* SAVE ADDRESS FOR FREE INCASE
*                                      OF ERROR                      */
*                                                                  1334
         ST    @06,OLDLCCA                                         1334
*   /*****************************************************************/
*   /*                                                               */
*   /* OBTAIN STORAGE FOR PSA. STORAGE MUST BE ON 4K BOUNDRY         */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1335
*   NOCHAIN='1'B;                   /* SET NOCHAIN FLAG FOR GETCORE  */
         OI    NOCHAIN,B'10000000'                                 1335
*   SUBPOOL=245;                    /* SUBPOOL NUMBER                */
         MVI   SUBPOOL,X'F5'                                       1336
*   GETLENG=LENGTH(PSA);            /* LENGTH FOR GETMAIN            */
         MVC   GETLENG(2),@CH03995                                 1337
*   CALL GETCORE;                   /* GO OBTAIN STORAGE FOR PSA     */
*                                                                  1338
         BAL   @14,GETCORE                                         1338
*   /*****************************************************************/
*   /*                                                               */
*   /* IF GETMAIN WAS UNSUCCESSFUL THEN RETURN TO CLEANUP            */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1339
*   IF ERRORIND^=0 THEN             /* ANY ERRORS                    */
         ICM   @06,15,ERRORIND                                     1339
         BNZ   @RT01339                                            1339
*     GOTO PSAEXIT;                 /* RETURN TO NEXT HIGHER LEVEL   */
*   CPUPSA=COREPTR;                 /* ADDRESS OF PSA STORAGE        */
*                                                                  1341
         L     @12,COREPTR                                         1341
         ST    @12,CPUPSA                                          1341
*   /*****************************************************************/
*   /*                                                               */
*   /* STORAGE HAS BEEN OBTAINED FOR NECESSARY STORAGE AREAS         */
*   /* INITIALIZE AREAS NOW                                          */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1342
*   DO;                                                            1342
*                                                                  1342
*/********* PSASETUP *********************************************** */
*/* PSASETUP ROUTINE WILL INITIALIZE ANY NECESSARY FIELDS WITHIN THE */
*/* NEW PSA JUST BUILT. A SYSGENED COPY OF THE PSA HAS BEEN SAVED    */
*/* BY NIP AND A POINTER TO IT IS SAVED IN THE CVT.                  */
*/****************************************************************** */
*                                                                  1343
*     /***************************************************************/
*     /*                                                             */
*     /* COPY SAVED PSA INTO STORAGE OBTAINED FOR NEW PSA            */
*     /*                                                             */
*     /***************************************************************/
*                                                                  1343
*     RFY                                                          1343
*      (R10,                                                       1343
*       R11,                                                       1343
*       R14,                                                       1343
*       R15) RSTD;                  /* RESTRICT REGS FOR MVCL        */
*     R10=CPUPSA;                   /* NEW PSA ADDRESS TO MOVE TO    */
         L     @06,CPUPSA                                          1344
         LR    R10,@06                                             1344
*     R11=LENGTH(PSA);              /* LENGTH TO MOVE                */
         LH    R11,@CH03995                                        1345
*     R14=CVTVPSA;                  /* ADDRESS OF SAVED PSA          */
         L     @06,CVTPTR                                          1346
         L     R14,CVTVPSA(,@06)                                   1346
*     R15=R11;                      /* COPY LENGTH OF PSA            */
         LR    R15,R11                                             1347
*     GEN(MVCL R10,R14);            /* MOVE SAVED PSA TO NEW PSA     */
         MVCL R10,R14
*     RFY                                                          1349
*      (R10,                                                       1349
*       R11,                                                       1349
*       R14,                                                       1349
*       R15) UNRSTD;                /* RELEASE REGISTERS FOR USE     */
*                                                                  1349
*     /***************************************************************/
*     /*                                                             */
*     /* SET UP ADDRESSABILITY TO NEW PSA                            */
*     /*                                                             */
*     /***************************************************************/
*                                                                  1350
*     PSAPTR=CPUPSA;                /* ADDRESSABILITY TO NEW PSA     */
         L     PSAPTR,CPUPSA                                       1350
*     PSAPSA='PSA ';                /* SET ACRONYM IN CONTROL BLOCK  */
         MVC   PSAPSA(4,PSAPTR),@CC03809                           1351
*     PSACPUSA=HEXCPUAD;            /* SET STATIC CPU ADDRESS      1352
*                                                            @YM03489*/
         SLR   @06,@06                                             1352
         ICM   @06,3,HEXCPUAD                                      1352
         STH   @06,PSACPUSA(,PSAPTR)                               1352
*     PSACPUPA=HEXCPUAD;            /* SET CPU ADDRESS               */
         STH   @06,PSACPUPA(,PSAPTR)                               1353
*     PSACPULA=HEXCPUAD+'0040'X;    /* SET LOGICAL ADDRESS           */
         LA    @04,64                                              1354
         ALR   @04,@06                                             1354
         STH   @04,PSACPULA(,PSAPTR)                               1354
*     PSAPCCAV=PCCAPTR;             /* VIRTUAL ADDRESS OF PCCA       */
         L     @04,PCCAPTR                                         1355
         ST    @04,PSAPCCAV(,PSAPTR)                               1355
*     PSACDAL=CVTCDAL+4*HEXCPUAD;   /* SUSPEND-RESUME SUPPORT      1356
*                                                            @Z40FPXM*/
         SLA   @06,2                                               1356
         L     @01,CVTPTR                                          1356
         AL    @06,CVTCDAL(,@01)                                   1356
         ST    @06,PSACDAL(,PSAPTR)                                1356
*     RNWAIT='0'B;                  /* RESET WAIT BIT IN RESTART PSW */
         NI    RNWAIT(PSAPTR),B'11111101'                          1357
*     RFY                                                          1358
*      (R14,                                                       1358
*       R15) RSTD;                  /* RESTRICT REGS FOR LRA         */
*                                                                  1358
*     /***************************************************************/
*     /*                                                             */
*     /* GET REAL ADDRESS OF CCA'S FOR PSA                           */
*     /*                                                             */
*     /***************************************************************/
*                                                                  1359
*     R15=PCCAPTR;                  /* LOAD ADDRESS OF PCCA          */
         LR    R15,@04                                             1359
*     GEN(LRA 15,0(15));            /* LOAD REAL ADDRESS OF PCCA     */
         LRA 15,0(15)
*     PSAPCCAR=R15;                 /* STORE REAL ADDRESS OF PCCA    */
         ST    R15,PSAPCCAR(,PSAPTR)                               1361
*     R15=LCCAPTR;                  /* LOAD VIRTUAL ADDRESS OF LCCA  */
         L     R15,LCCAPTR                                         1362
*     GEN(LRA  15,0(15));           /* CONVERT TO REAL ADDRESS       */
         LRA  15,0(15)
*     PSALCCAR=R15;                 /* STORE REAL ADDRESS IN PSA     */
         ST    R15,PSALCCAR(,PSAPTR)                               1364
*     PSALCCAV=LCCAPTR;             /* VIRTUAL LCCA ADDRESS          */
         MVC   PSALCCAV(4,PSAPTR),LCCAPTR                          1365
*     R15=ADDR(PSASTOR);            /* LOAD ADDRESS OF STOR          */
         LA    R15,PSASTOR(,PSAPTR)                                1366
*     GEN(STCTL 1,1,0(15));         /* STORE CONTROL REG ONE INTO PSA*/
         STCTL 1,1,0(15)
*     PSAPTR=0;                     /* ADDRESS MY OWN PSA            */
         SLR   PSAPTR,PSAPTR                                       1368
*     R15=PSAAOLD;                  /* PICK UP MASTERS ASCB ADDR     */
         L     R15,PSAAOLD(,PSAPTR)                                1369
*     R14=FLCTRACE;                 /* GET POINTER TO TRACE TABLE    */
         L     R14,FLCTRACE(,PSAPTR)                               1370
*     PSAPTR=CPUPSA;                /* POINT TO NEW PSA              */
*                                                                  1371
         L     @06,CPUPSA                                          1371
         LR    PSAPTR,@06                                          1371
*     /***************************************************************/
*     /*                                                             */
*     /* COPY ASCB POINTER INTO NEW PSA. SINCE WE ARE CURRENTLY      */
*     /* RUNNING UNDER THE MASTER ASCB, NEW MEMORY WILL ALSO BE      */
*     /*                                                             */
*     /***************************************************************/
*                                                                  1372
*     PSAAOLD=R15;                  /* STORE MASTERS ASCB ADDR       */
         ST    R15,PSAAOLD(,PSAPTR)                                1372
*     FLCTRACE=R14;                 /* STORE TRACE TABLE POINTER     */
         ST    R14,FLCTRACE(,PSAPTR)                               1373
*     PSATOLD=0;                    /* ZERO TCB POINTERS             */
         SLR   @04,@04                                             1374
         ST    @04,PSATOLD(,PSAPTR)                                1374
*     PSATNEW=0;                    /* ZERO TCB POINTERS             */
         ST    @04,PSATNEW(,PSAPTR)                                1375
*     PSAANEW=0;                    /* ZERO ASCB POINTER             */
         ST    @04,PSAANEW(,PSAPTR)                                1376
*     RFY                                                          1377
*      (R14,                                                       1377
*       R15) UNRSTD;                /* RELEASE REG 15 FOR USE        */
*   END;                            /* ** END OF PSASETUP            */
*                                                                  1379
*/****** CCASETUP ************************************************** */
*/* CCASETUP ROUTINE WILL INITIALIZE NEW LCCA AND PCCA FOR CPU TO BE */
*/* BROUGHT ONLINE. NO ERROR INDICATORS ARE SET BY THIS ROUTINE      */
*/****************************************************************** */
*                                                                  1379
*   DO;                                                            1379
*                                                                  1379
*     /***************************************************************/
*     /*                                                             */
*     /* INITIALIZE NEW CCA'S                                        */
*     /*                                                             */
*     /***************************************************************/
*                                                                  1380
*     PCCAPCCA='PCCA';              /* CONTROL BLOCK HEADER          */
         L     @12,PCCAPTR                                         1380
         MVC   PCCAPCCA(4,@12),@CC03811                            1380
*     PCCACPUA=HEXCPUAD;            /* PHYSICAL CPU ADDRESS          */
         SLR   @15,@15                                             1381
         ICM   @15,3,HEXCPUAD                                      1381
         STH   @15,PCCACPUA(,@12)                                  1381
*     PCCACAFM=CPUMSK;              /* BIT MASK FOR THIS CPU         */
         MVC   PCCACAFM(2,@12),CPUMSK                              1382
*     PCCAPSAV=CPUPSA;              /* PSA ADDRESS                   */
*                                                                  1383
         ST    @06,PCCAPSAV(,@12)                                  1383
*     /***************************************************************/
*     /*                                                             */
*     /* IF OLD CAT TABLE EXISTS, THEN COPY OLD CAT INTO NEW PCCA.   */
*     /* THIS IS TO PREVENT THE WAKEUP CODE FROM HAVING TO ENABLE FOR*/
*     /* I/O INTERRUPTIONS TO INITIALIZE THE CAT TABLE ON THE NEW    */
*     /* CPU.                                                @YM03538*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  1384
*     IF PCCAT00P(HEXCPUAD+1)^=0 THEN/* OLD PCCA EXIST?      @YM03538*/
         SLA   @15,2                                               1384
         L     @06,CVTPTR                                          1384
         L     @06,CVTPCCAT(,@06)                                  1384
         L     @06,PCCAT00P(@15,@06)                               1384
         CR    @06,@04                                             1384
         BE    @RF01384                                            1384
*       DO;                                                        1385
*                                                                  1385
*         /***********************************************************/
*         /*                                                         */
*         /* COPY OLD CAT TO NEW PCCA                                */
*         /*                                                         */
*         /***********************************************************/
*                                                                  1386
*         PCCACAT=PCCAT00P(HEXCPUAD+1)->PCCACAT;/* COPY      @YM03538*/
         MVC   PCCACAT(128,@12),PCCACAT(@06)                       1386
*         OLDCAT='1'B;              /* SET FOOTPRINT         @YM03538*/
         OI    OLDCAT,B'00000100'                                  1387
*         CATPTR=ADDR(PCCACAT);     /* POINT TO NEW CAT TABLE      1388
*                                                            @YM03538*/
*                                                                  1388
         LA    CATPTR,PCCACAT(,@12)                                1388
*         /***********************************************************/
*         /*                                                         */
*         /* ZERO OUT ALL OLD INFORMATION                            */
*         /*                                                         */
*         /***********************************************************/
*                                                                  1389
*         DO LOOPCNT=0 TO 15;       /* LOOP THROUGH ALL CHANNELS   1389
*                                                            @YM03538*/
         ST    @04,LOOPCNT                                         1389
@DL01389 DS    0H                                                  1390
*           CATSIOCT=0;             /* ZERO SIO COUNT        @YM03538*/
         SLR   @12,@12                                             1390
         STH   @12,CATSIOCT(,CATPTR)                               1390
*           CATFLA=0;               /* ZERO FLAG BYTE        @YM03538*/
         MVI   CATFLA(CATPTR),X'00'                                1391
*           CATPTR=CATPTR+LENGTH(CAT);/* INCREMENT TO NEXT CAT     1392
*                                                            @YM03538*/
         AH    CATPTR,@CH00036                                     1392
*         END;                      /* END OF LOOP                   */
         AL    @04,@CF00067                                        1393
         ST    @04,LOOPCNT                                         1393
         CH    @04,@CH00344                                        1393
         BNH   @DL01389                                            1393
*       END;                        /* END OF CAT TABLE COPY ROUTINE */
*                                                                  1394
*     /***************************************************************/
*     /*                                                             */
*     /* OLD CAT TABLE DID NOT EXIST. MARK ALL CHANNELS OFFLINE AND  */
*     /* CHANNEL ID INFORMATION INVALID                              */
*     /*                                                             */
*     /***************************************************************/
*                                                                  1395
*     ELSE                                                         1395
*       DO;                         /*                       @Y30CQXA*/
         B     @RC01384                                            1395
@RF01384 DS    0H                                                  1396
*         CATPTR=ADDR(PCCACAT);     /* CAT TABLE ADDRESS     @Y30CQXA*/
         L     CATPTR,PCCAPTR                                      1396
         LA    CATPTR,PCCACAT(,CATPTR)                             1396
*         DO LOOPCNT=0 TO 15;       /* LOOP CONTROL          @Y30CQXA*/
         SLR   @12,@12                                             1397
         ST    @12,LOOPCNT                                         1397
@DL01397 DS    0H                                                  1398
*           CATNOP='1'B;            /* OFFLINE AND INVALID   @Y30CQXA*/
*           CATNID='1'B;            /* ID INVALID            @Y30CQXA*/
*                                                                  1399
         OI    CATNOP(CATPTR),B'01001000'                          1399
*           /*********************************************************/
*           /*                                                       */
*           /* IF CHANNEL IS NOT SYSGENED THEN MARK NOT SYSGENED     */
*           /*                                                       */
*           /*********************************************************/
*                                                                  1400
*           IF LOOPCNT>CSDCHAD THEN /* ABOVE SYSGENED?       @Y30CQXA*/
         L     @11,CVTPTR                                          1400
         L     @11,CVTCSD(,@11)                                    1400
         CH    @12,CSDCHAD(,@11)                                   1400
         BNH   @RF01400                                            1400
*             CATNGEN='1'B;         /* SET NOT GENED         @Y30CQXA*/
         OI    CATNGEN(CATPTR),B'00100000'                         1401
*           CATPTR=CATPTR+8;        /* NEXT CAT ENTRY        @Y30CQXA*/
@RF01400 AH    CATPTR,@CH00036                                     1402
*         END;                      /*                       @Y30CQXA*/
         LA    @12,1                                               1403
         AL    @12,LOOPCNT                                         1403
         ST    @12,LOOPCNT                                         1403
         CH    @12,@CH00344                                        1403
         BNH   @DL01397                                            1403
*       END;                        /*                       @Y30CQXA*/
*     RFY                                                          1405
*      (R15) RSTD;                  /* RESTRICT REGISTER 15          */
@RC01384 DS    0H                                                  1406
*     R15=CPUPSA;                   /* LOAD VIRTUAL ADDRESS OF PSA   */
         L     R15,CPUPSA                                          1406
*     GEN(LRA  15,0(15));           /* LOAD REAL ADDRESS             */
         LRA  15,0(15)
*     PCCAPSAR=R15;                 /* STORE REAL PSA ADDRESS        */
         L     @14,PCCAPTR                                         1408
         ST    R15,PCCAPSAR(,@14)                                  1408
*     RFY                                                          1409
*      (R15) UNRSTD;                /* RELEASR REG 15                */
*     PSAPTR=0;                     /* ADDRESSABILITY TO MY OWN PSA  */
         SLR   PSAPTR,PSAPTR                                       1410
*     LCCAMCR1=PSASTOR;             /* COPY MY CONTROL REG 1 TO LCCA */
         L     @06,LCCAPTR                                         1411
         MVC   LCCAMCR1(4,@06),PSASTOR(PSAPTR)                     1411
*     LCCACPUA=HEXCPUAD+'0040'X;    /* SET LOGICAL CPU ADDRESS       */
         SLR   @04,@04                                             1412
         ICM   @04,3,HEXCPUAD                                      1412
         LA    @15,64                                              1412
         ALR   @15,@04                                             1412
         STH   @15,LCCACPUA(,@06)                                  1412
*     LCCALCCA='LCCA';              /* CONTROL BLOCK HEADER          */
         MVC   LCCALCCA(4,@06),@CC03812                            1413
*   END;                            /* END OF INITIALIZATION ROUTINE */
*                                                                  1415
*   /*****************************************************************/
*   /*                                                               */
*   /* PSA AND CCA'S FOR NEW CPU HAVE BEEN BUILT AND INITIALIZED     */
*   /* UPDATE VECTOR TABLE ENTRIES FOR SUBJECT CPU AND RETURN TO     */
*   /* CALLER IF ONLY A CRH VARY. OTHERWISE ISSUE A CPU RESET TO     */
*   /* VERIFY THAT CPU DOES EXIST                                    */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1415
*   RFY                                                            1415
*    (R10,                                                         1415
*     R11) RSTD;                    /* RESTRICT REGISTERS            */
*   R10=PCCAT00P(HEXCPUAD+1);       /* SAVE OLD VECTOR TABLE POINTER */
         SLA   @04,2                                               1416
         L     @06,CVTPTR                                          1416
         L     @15,CVTPCCAT(,@06)                                  1416
         L     R10,PCCAT00P(@04,@15)                               1416
*   R11=LCCAT00P(HEXCPUAD+1);       /* SAVE OLD VECTOR TABLE POINTER */
*                                                                  1417
         L     @06,CVTLCCAT(,@06)                                  1417
         L     R11,LCCAT00P(@04,@06)                               1417
*   /*****************************************************************/
*   /*                                                               */
*   /* REPLACE POINTERS WITH NEW CCA'S ADDRESSES                     */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1418
*   PCCAT00P(HEXCPUAD+1)=OLDPCCA;   /* REPLACE POINTER WITH NEW      */
         L     @14,OLDPCCA                                         1418
         ST    @14,PCCAT00P(@04,@15)                               1418
*   LCCAT00P(HEXCPUAD+1)=OLDLCCA;   /* REPLACE POINTER WITH NEW      */
         L     @15,OLDLCCA                                         1419
         ST    @15,LCCAT00P(@04,@06)                               1419
*   OLDPCCA=R10;                    /* SAVE ADDRESS FOR FREEING      */
         ST    R10,OLDPCCA                                         1420
*   OLDLCCA=R11;                    /* SAVE ADDRESS FOR FREEING      */
*                                                                  1421
         ST    R11,OLDLCCA                                         1421
*   /*****************************************************************/
*   /*                                                               */
*   /* IF CRH VARY THEN ZERO LCCA POINTER AND SET UP TO FREE LCCA IN */
*   /* CLEANUP ROUTINE                                               */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1422
*   IF CRH='1'B THEN                /* CRH VARY?             @Y30CQXA*/
         TM    CRH,B'00000010'                                     1422
         BO    @RT01422                                            1422
*     GOTO PSAEXIT;                 /*                       @Y30CQXA*/
*                                                                  1423
*   /*****************************************************************/
*   /*                                                               */
*   /* VECTOR TABLES ARE NOW POINTING TO NEW CCA'S. USE IPC TO RESET */
*   /* SUBJECT CPU AND VERIFY IF CPU EXISTS                          */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1424
*   RFY                                                            1424
*    (R1,                                                          1424
*     RETCODE) RSTD;                /* RESTRICT REGS                 */
*RETRY:                                                            1425
*   R1=PCCAT00P(HEXCPUAD+1);        /* GET PCCA ADDR FOR IPC @ZA07523*/
*                                                                  1425
RETRY    SLR   @14,@14                                             1425
         ICM   @14,3,HEXCPUAD                                      1425
         SLA   @14,2                                               1425
         L     @06,CVTPTR                                          1425
         L     @04,CVTPCCAT(,@06)                                  1425
         L     R1,PCCAT00P(@14,@04)                                1425
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK IF CRH IS ACTIVE, AND IF SO ISSUE A CPU RESET INSTEAD OF*/
*   /* A PROGRAM RESET TO PREVENT ANY CRITICAL I/O INFORMATION IN    */
*   /* CHANNELS FROM BEING RESET THIS SHOULD ALSO BE DONE IF BACKING */
*   /* OUT FROM OFFLINE,KEEPCHAN PROCESSING FAILURE.         @G557P2L*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1426
*   IF CVTCRCA^=0×KPCHANFL='1'B THEN/* CRH ACTIVE?           @Y30CQXA*/
         ICM   @14,15,CVTCRCA(@06)                                 1426
         BNZ   @RT01426                                            1426
         TM    KPCHANFL,B'01000000'                                1426
         BNO   @RF01426                                            1426
@RT01426 DS    0H                                                  1427
*/*                                           OR BACKOUT CASE @ZM45610
*                                                                    */
*                                                                  1427
*     DO;                           /* CHECK TO SEE IF CPU IN CHECK
*                                      STOP STATE            @ZA07523*/
*       GEN(DSGNL SENSE,CPU=(1));   /* ISSUE SENSE TO CPU    @ZA07523*/
         DSGNL SENSE,CPU=(1)
*       IF RETCODE=8 THEN           /* STATUS STORED ?       @ZA07523*/
         CH    RETCODE,@CH00036                                    1429
         BNE   @RF01429                                            1429
*         DO;                       /*                       @ZA07523*/
*           TEMPWORK=R0;            /* STORE REG 0 STATUS WORD     1431
*                                                            @ZA07523*/
         ST    R0,TEMPWORK                                         1431
*         END;                      /* END OF CHECK STOP TEST      1432
*                                                            @ZA07523*/
*       ELSE                                                       1433
*         IF RETCODE^=0 THEN        /* CPU RESPONSIVE ?      @ZA07523*/
         B     @RC01429                                            1433
@RF01429 LTR   RETCODE,RETCODE                                     1433
         BNZ   @RT01433                                            1433
*           GOTO CPUERROR;          /* NO, REJECT VARY CPU   @ZA07523*/
*       R1=PCCAT00P(HEXCPUAD+1);    /* PCCA ADDR FOR IPC     @ZA07523*/
@RC01429 SLR   @14,@14                                             1435
         ICM   @14,3,HEXCPUAD                                      1435
         SLA   @14,2                                               1435
         L     @06,CVTPTR                                          1435
         L     @06,CVTPCCAT(,@06)                                  1435
         L     R1,PCCAT00P(@14,@06)                                1435
*       GEN(DSGNL ICPUR,CPU=(1));   /* RESET CPU AND PREFIX REGISTER
*                                                            @Y30CQXA*/
         DSGNL ICPUR,CPU=(1)
*     END;                          /* END OF CRH ACTIVE PROCESS   1437
*                                                            @ZA07523*/
*   ELSE                            /*                       @Y30CQXA*/
*     GEN(DSGNL IPR,CPU=(1));       /* RESET CPU AND PREFIX REGISTER */
*                                                                  1438
         B     @RC01426                                            1438
@RF01426 DS    0H                                                  1438
         DSGNL IPR,CPU=(1)
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK RETURN CODE AND VERIFY THAT CPU EXISTS                  */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1439
*   IF RETCODE^=0 THEN              /* SUCCESSFUL ?                  */
@RC01426 LTR   RETCODE,RETCODE                                     1439
         BZ    @RF01439                                            1439
*CPUERROR:                                                         1440
*     DO;                                                          1440
*                                                                  1440
CPUERROR DS    0H                                                  1441
*       /*************************************************************/
*       /*                                                           */
*       /* REPLACE VECTOR TABLE ENTRIES AND SET UNRESPONSIVE FLAG    */
*       /*                                                           */
*       /*************************************************************/
*                                                                  1441
*       R10=OLDPCCA;                /* PICK UP PCCA ADDRESS          */
         L     R10,OLDPCCA                                         1441
*       R11=OLDLCCA;                /* PICK UP LCCA ADDRESS          */
         L     R11,OLDLCCA                                         1442
*       OLDPCCA=PCCAT00P(HEXCPUAD+1);/* COPY OLD PCCA ADDRESS TO FREE*/
         SLR   @14,@14                                             1443
         ICM   @14,3,HEXCPUAD                                      1443
         SLA   @14,2                                               1443
         L     @06,CVTPTR                                          1443
         L     @04,CVTPCCAT(,@06)                                  1443
         L     @00,PCCAT00P(@14,@04)                               1443
         ST    @00,OLDPCCA                                         1443
*       OLDLCCA=LCCAT00P(HEXCPUAD+1);/* COPY NEW LCCA ADDRESS TO FREE*/
         L     @06,CVTLCCAT(,@06)                                  1444
         L     @00,LCCAT00P(@14,@06)                               1444
         ST    @00,OLDLCCA                                         1444
*       PCCAT00P(HEXCPUAD+1)=R10;   /* REPLACE OLD PCCA ADDRESS      */
         ST    R10,PCCAT00P(@14,@04)                               1445
*       LCCAT00P(HEXCPUAD+1)=R11;   /* REPLACE OLD LCCA ADDRESS      */
         ST    R11,LCCAT00P(@14,@06)                               1446
*       CPUNRESP='1'B;              /* SET ERROR FLAG                */
         OI    CPUNRESP,B'00010000'                                1447
*       GOTO PSAEXIT;               /* RETURN TO NEXT LEVEL OF     1448
*                                      CONTROL                       */
         B     PSAEXIT                                             1448
*     END;                                                         1449
*                                                                  1449
*   /*****************************************************************/
*   /*                                                               */
*   /* CPU HAS RESPONDED. LOOP TILL RESET HAS COMPLETED              */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1450
*RESTLP1:                                                          1450
*   R1=PCCAT00P(HEXCPUAD+1);        /* PICK UP CPU ADDRESS           */
@RF01439 DS    0H                                                  1450
RESTLP1  SLR   @14,@14                                             1450
         ICM   @14,3,HEXCPUAD                                      1450
         SLA   @14,2                                               1450
         L     @06,CVTPTR                                          1450
         L     @06,CVTPCCAT(,@06)                                  1450
         L     R1,PCCAT00P(@14,@06)                                1450
*   GEN(DSGNL SENSE,CPU=(1));       /* ISSUE SENSE TO CPU            */
*                                                                  1451
         DSGNL SENSE,CPU=(1)
*   /*****************************************************************/
*   /*                                                               */
*   /* IF RETURN CODE IS 4 THEN CPU IS BUSY DOING RESET. LOOP        */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1452
*   IF RETCODE=4 THEN               /* BUSY?                         */
         CH    RETCODE,@CH00076                                    1452
         BNE   @RF01452                                            1452
*     DO;                           /* YES- IEAVEDR RETRIED 1 MEG  1453
*                                      ALREADY               @ZA10795*/
*       CPUNRESP='1'B;              /* SET UNRESPONSIVE CPU ERR FLAG
*                                                            @ZA10795*/
         OI    CPUNRESP,B'00010000'                                1454
*       GOTO CPUERROR;              /* BRACNH CONTINUE PROCESSING  1455
*                                                            @ZA10795*/
         B     CPUERROR                                            1455
*     END;                          /* END OF RETURN CODE BUSY     1456
*                                      PROCESSING            @ZA10795*/
*   IF RETCODE=8 THEN               /* ERROR DURRING SENSE?          */
@RF01452 CH    RETCODE,@CH00036                                    1457
         BNE   @RF01457                                            1457
*     DO;                           /* CPU HAS STORED STATUS. CHECK
*                                      STATUS                        */
*       RFY                                                        1459
*        (R0) RSTD;                 /* RESTRICT REG                  */
*       TEMPWORK=R0;                /* STORE STATUS RETURNED         */
*                                                                  1460
         ST    R0,TEMPWORK                                         1460
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK STATUS TO INSURE NO ERROR HAS OCCURED               */
*       /*                                                           */
*       /*************************************************************/
*                                                                  1461
*       RFY                                                        1461
*        (R0) UNRSTD;               /* RELEASE REG                   */
*       IF CKSTOP='1'B×OPINT='1'B×RECCK='1'B×NTRDY='1'B THEN       1462
         TM    CKSTOP,B'00111001'                                  1462
         BZ    @RF01462                                            1462
*         DO;                                                      1463
*                                                                  1463
*           /*********************************************************/
*           /*                                                       */
*           /* ERROR HAS OCCURED DURING RESET                        */
*           /*                                                       */
*           /*********************************************************/
*                                                                  1464
*           CPUNRESP='1'B;          /* SET ERROR FLAG                */
         OI    CPUNRESP,B'00010000'                                1464
*           GOTO CPUERROR;          /* EXIT                          */
         B     CPUERROR                                            1465
*         END;                                                     1466
*     END;                          /* END OF RESET WAIT LOOP        */
@RF01462 DS    0H                                                  1468
*   RFY                                                            1468
*    (R1,                                                          1468
*     R10,                                                         1468
*     R11,                                                         1468
*     RETCODE) UNRSTD;              /* RELEASE REGISTERS             */
*                                                                  1468
@RF01457 DS    0H                                                  1469
*   /*****************************************************************/
*   /*                                                               */
*   /* CPU HAS RESPONDED TO RESET. CONTINUE INITIALIZATION OBTAIN AND*/
*   /* SETUP CPU RELATED SAVE AREAS                                  */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1469
*   CALL SAVARSUB;                  /* GET CPU RELATED SAVE AREAS    */
*                                                                  1469
         BAL   @14,SAVARSUB                                        1469
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR ANY ERROR FROM ROUTINE                              */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1470
*   IF ERRORIND^=0 THEN             /* ANY ERRORS ?                  */
         ICM   @06,15,ERRORIND                                     1470
         BNZ   @RT01470                                            1470
*     GOTO PSAEXIT;                 /* RETURN TO CALLER              */
*PSAEXIT:                                                          1472
*   END;                                                           1472
@EL00012 DS    0H                                                  1472
@EF00012 DS    0H                                                  1472
@ER00012 LM    @14,@11,@SA00012                                    1472
         BR    @14                                                 1472
*GETCORE:                                                          1473
*   PROC;                                                          1473
*                                                                  1473
GETCORE  STM   @14,@12,@SA00013                                    1473
*/********* GETCORE ************************************************ */
*/* GETCORE ROUTINE WILL GET AND CHAIN STORAGE REQUESTED BY CALLER   */
*/* INPUT TO ROUTINE IS LENGTH AND SUBPOOL SPECIFIED IN WORKAREA     */
*/* STORAGE BLOCKS WILL BE CHAINED TOGETHER AND ANCHORED OUT OF      */
*/* WORKAREA FIELD BEGINPTR. SUBPOOL AND LENGTH IS RECORDED IN       */
*/* CHAIN BLOCKS FOR FREEING LATER.                                  */
*/* POSSIBLE ERROR INDICATORS ARE: NOCORE                            */
*/****************************************************************** */
*                                                                  1474
*   IF NOCHAIN='0'B THEN            /* CHECK FOR NOCHAIN INDICATOR   */
*                                                                  1474
         TM    NOCHAIN,B'10000000'                                 1474
         BNZ   @RF01474                                            1474
*     /***************************************************************/
*     /*                                                             */
*     /* IF CALLER HAS REQUESTED TO CHAIN THIS BLOCK WITH ALL OTHER  */
*     /* GETMAINS THEN ADD EIGHT TO REQUESTED LENGTH FOR CHAINING    */
*     /* BLOCKS                                                      */
*     /*                                                             */
*     /***************************************************************/
*                                                                  1475
*     GETLENG=EVAL(GETLENG+8);      /* ADD EIGHT TO LENGTH           */
         LA    @12,8                                               1475
         SLR   @06,@06                                             1475
         ICM   @06,3,GETLENG                                       1475
         ALR   @12,@06                                             1475
         STH   @12,GETLENG                                         1475
*   RFY                                                            1476
*    (RETCODE) RSTD;                /* RESTRICT RETURN CODE REG      */
*                                                                  1476
@RF01474 DS    0H                                                  1477
*   /*****************************************************************/
*   /*                                                               */
*   /* ISSUE CONDITIONAL GETMAIN FOR STORAGE REQUESTED               */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1477
*   DO;                             /* GETMAIN (EC) LV(GETLENG)    1477
*                                      A(COREPTR) SP(SUBPOOL)      1477
*                                      RTCD(RETCODE)                 */
*     RESPECIFY                                                    1478
*      (GPR01P,                                                    1478
*       GPR15F) RESTRICTED;                                        1478
*     I004=I004&&I004;              /* INIT LIST                     */
         XC    I004(10),I004                                       1479
*     I00404='20'X;                 /* TYPE                          */
         MVI   I00404,X'20'                                        1480
*     I00401=GETLENG;               /* LENGTH                        */
         SLR   @14,@14                                             1481
         ICM   @14,3,GETLENG                                       1481
         ST    @14,I00401                                          1481
*     I00403=ADDR(COREPTR);         /* ADDR OF ADDR LIST             */
         LA    @14,COREPTR                                         1482
         STCM  @14,7,I00403                                        1482
*     I00405=SUBPOOL;               /* SUBPOOL VALUE                 */
         MVC   I00405(1),SUBPOOL                                   1483
*     GPR01P=ADDR(I004);            /* REG1 POINTS TO LIST           */
         LA    GPR01P,I004                                         1484
*     SVC(4);                       /* STANDARD-FORM OF GETMAIN      */
         SVC   4                                                   1485
*     RETCODE=GPR15F;               /* SET RETURN CODE               */
*     RESPECIFY                                                    1487
*      (GPR01P,                                                    1487
*       GPR15F) UNRESTRICTED;                                      1487
*   END;                            /* GETMAIN (EC) LV(GETLENG)    1488
*                                      A(COREPTR) SP(SUBPOOL)      1488
*                                      RTCD(RETCODE)                 */
*                                                                  1488
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK RETURN CODE AND SET NOCORE ERROR FLAG IF ERROR          */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1489
*   IF RETCODE^=0 THEN              /* WAS GETMAIN SUCCESSFUL        */
         LTR   RETCODE,RETCODE                                     1489
         BZ    @RF01489                                            1489
*     DO;                                                          1490
*       NOCORE='1'B;                /* SET ERROR FLAG                */
         OI    NOCORE,B'00000001'                                  1491
*       GOTO GETCOREX;              /* RETURN TO CALLER              */
         B     GETCOREX                                            1492
*     END;                                                         1493
*   RFY                                                            1494
*    (RETCODE) UNRSTD;                                             1494
*                                                                  1494
@RF01489 DS    0H                                                  1495
*   /*****************************************************************/
*   /*                                                               */
*   /* ZERO OUT STORAGE OBTAINED                                     */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1495
*   RFY                                                            1495
*    (R10,                                                         1495
*     R11,                                                         1495
*     R14,                                                         1495
*     R15) RSTD;                    /* RESTRICT REGISTERS            */
*   R10=COREPTR;                    /* LOAD ADDRESS OF STORAGE     1496
*                                      OBTAINED                      */
         L     R10,COREPTR                                         1496
*   R11=GETLENG;                    /* LOAD LENGTH OF STORAGE      1497
*                                      OBTAINED                      */
         SLR   R11,R11                                             1497
         ICM   R11,3,GETLENG                                       1497
*   R14=0;                          /* ZERO PAD CHARACTER            */
         SLR   R14,R14                                             1498
*   R15=0;                          /* ZERO LENGTH                   */
         SLR   R15,R15                                             1499
*   GEN(MVCL R10,R14);              /* ZERO STORAGE JUST OBTAINED    */
         MVCL R10,R14
*   RFY                                                            1501
*    (R10,                                                         1501
*     R11,                                                         1501
*     R14,                                                         1501
*     R15) UNRSTD;                  /* RELEASE REGISTERS FOR USE     */
*                                                                  1501
*   /*****************************************************************/
*   /*                                                               */
*   /* IF CHAINING WAS NOT REQUESTED THEN RETURN TO CALLER           */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1502
*   IF NOCHAIN='1'B THEN            /* CHAINNING REQUESTED?          */
         TM    NOCHAIN,B'10000000'                                 1502
         BO    @RT01502                                            1502
*     GOTO GETCOREX;                /* RETURN TO CALLER              */
*                                                                  1503
*   /*****************************************************************/
*   /*                                                               */
*   /* CHAIN THIS BLOCK TO OTHER BLOCKS IN CHAIN AND UPDATE ANCHOR   */
*   /* PTR TO POINT TO THIS BLOCK                                    */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1504
*   IF BEGINPTR=0 THEN              /* FIRST ENTRY                   */
         SLR   @12,@12                                             1504
         C     @12,BEGINPTR                                        1504
         BNE   @RF01504                                            1504
*     FRWRDPTR=0;                   /* ZERO OUT FOR LAST ENTRY       */
*                                                                  1505
         L     @06,COREPTR                                         1505
         ST    @12,FRWRDPTR(,@06)                                  1505
*   /*****************************************************************/
*   /*                                                               */
*   /* WAS NOT FIRST ELEMENT ON CHAIN.. CHAIN BLOCKS TOGETHER        */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1506
*   ELSE                                                           1506
*     FRWRDPTR=BEGINPTR;            /* POINT TO NEXT BLOCK           */
         B     @RC01504                                            1506
@RF01504 L     @12,COREPTR                                         1506
         MVC   FRWRDPTR(4,@12),BEGINPTR                            1506
*   BEGINPTR=COREPTR;               /* ANCHOR THIS BLOCK             */
*                                                                  1507
@RC01504 L     @12,COREPTR                                         1507
         ST    @12,BEGINPTR                                        1507
*   /*****************************************************************/
*   /*                                                               */
*   /* SAVE NECESSARY INFORMATION IN CHAIN BLOCKS FOR FREEMAIN       */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1508
*   LNGTH=GETLENG;                  /* SAVE LENGTH OF REQUEST        */
         MVC   LNGTH(2,@12),GETLENG                                1508
*   SPNUM=SUBPOOL;                  /* SAVE SUBPOOL NUMBER           */
*                                                                  1509
         SLR   @06,@06                                             1509
         IC    @06,SUBPOOL                                         1509
         STH   @06,SPNUM(,@12)                                     1509
*   /*****************************************************************/
*   /*                                                               */
*   /* UPDATE COREPTR TO STORAGE FOR CALLER                          */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1510
*   COREPTR=COREPTR+8;                                             1510
         AH    @12,@CH00036                                        1510
         ST    @12,COREPTR                                         1510
*GETCOREX:                                                         1511
*   NOCHAIN='0'B;                   /* RESET NOCHAIN FLAG            */
GETCOREX NI    NOCHAIN,B'01111111'                                 1511
*   END;                            /* *** END OF GETCORE ROUTINE    */
@EL00013 DS    0H                                                  1512
@EF00013 DS    0H                                                  1512
@ER00013 LM    @14,@12,@SA00013                                    1512
         BR    @14                                                 1512
*                                                                  1513
*/****** FREECORE ****************************************************/
*/* FREECORE ROUTINE WILL FREE STORAGE POINTED TO BY COREPTR. INPUT  */
*/* IS SUBPOOL AND GETLENG FIELDS IN WORKAREA. THESE FIELDS          */
*/* ARE SHARED WITH GETCORE ROUTINE. NO ERROR INDICATORS WILL BE SET */
*/* BY FREECORE ROUTINE.                                             */
*/********************************************************************/
*                                                                  1513
*FREECORE:                                                         1513
*   PROC;                                                          1513
*                                                                  1513
FREECORE STM   @14,@12,12(@13)                                     1513
*   /*****************************************************************/
*   /*                                                               */
*   /* ISSUE CONDITIONAL FREEMAIN                                    */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1514
*   DO;                             /* FREEMAIN (E) LV(GETLENG)    1514
*                                      A(COREPTR) SP(SUBPOOL)        */
*     RESPECIFY                                                    1515
*      (GPR01P) RESTRICTED;                                        1515
*     I005=I005&&I005;              /* INIT LIST                     */
         XC    I005(10),I005                                       1516
*     I00505='00'X;                 /* SET TYPE                      */
         MVI   I00505,X'00'                                        1517
*     I00502=GETLENG;               /* LENGTH                        */
         SLR   @12,@12                                             1518
         ICM   @12,3,GETLENG                                       1518
         STCM  @12,7,I00502                                        1518
*     I00504=ADDR(COREPTR);         /* ADDR OF ADDR LIST             */
         LA    @12,COREPTR                                         1519
         STCM  @12,7,I00504                                        1519
*     I00506=SUBPOOL;               /* SUBPOOL VALUE                 */
         MVC   I00506(1),SUBPOOL                                   1520
*     GPR01P=ADDR(I005);            /* REG1 POINTS TO LIST           */
         LA    GPR01P,I005                                         1521
*     SVC(5);                       /* STANDARD-FORM OF GETMAIN      */
         SVC   5                                                   1522
*     RESPECIFY                                                    1523
*      (GPR01P) UNRESTRICTED;                                      1523
*   END;                            /* FREEMAIN (E) LV(GETLENG)    1524
*                                      A(COREPTR) SP(SUBPOOL)        */
*   END;                            /* END OF FREEMAIN ROUTINE       */
@EL00014 DS    0H                                                  1525
@EF00014 DS    0H                                                  1525
@ER00014 LM    @14,@12,12(@13)                                     1525
         BR    @14                                                 1525
*SAVARSUB:                                                         1526
*   PROC;                                                          1526
*                                                                  1526
SAVARSUB STM   @14,@12,@SA00015                                    1526
*/********* SAVARSUB *********************************************** */
*/* SAVARSUB ROUTINE WILL OBTAIN OR FREE CPU RELATED SAVE AREAS FOR  */
*/* A CPU TO BE BROUGHT ONLINE OR TAKEN OFFLINE. ROUTINE WILL FREE   */
*/* STORAGE IF ADDRESS IS PASSED IN REGISTER ONE, OR WILL OBTAIN     */
*/* STORAGE IF REGISTER ONE IS ZERO. ROUTINE IS INCLUDED FROM MACRO  */
*/* LIBRARY POSSIBLE ERROR INDICATORS ARE: CPFAILED                  */
*/****************************************************************** */
*                                                                  1527
*   DO;                                                            1527
*                                                                  1527
*     /***************************************************************/
*     /*                                                             */
*     /* LOAD PARAMETER TO BE PASSED. NOTE. LCCAPTR MUST BE POINTING */
*     /* TO LCCA OF SUBJECT CPU                                      */
*     /*                                                             */
*     /***************************************************************/
*                                                                  1528
*     RFY                                                          1528
*      (R1,                                                        1528
*       RETCODE) RSTD;              /* RESTRICT REGISTER ONE         */
*     R1=LCCACPUS;                  /* CPU RELATED SAVE AREA         */
*                                                                  1529
         L     @14,LCCAPTR                                         1529
         L     R1,LCCACPUS(,@14)                                   1529
*     /***************************************************************/
*     /*                                                             */
*     /* LINK TO ROUTINE TO GET OR FREE SAVEAREA                     */
*     /*                                                             */
*     /***************************************************************/
*                                                                  1530
*     CALL IEAVSPSA;                /* LINK TO ROUTINE               */
*                                                                  1530
         BAL   @14,IEAVSPSA                                        1530
*     /***************************************************************/
*     /*                                                             */
*     /* CHECK IF ANY ERROR WAS ENCOUNTERED                          */
*     /*                                                             */
*     /***************************************************************/
*                                                                  1531
*     IF RETCODE^=0 THEN            /* ANY ERROR ?                   */
         LTR   RETCODE,RETCODE                                     1531
         BZ    @RF01531                                            1531
*       CPFAILED='1'B;              /* SET CPFAILED ERROR FLAG       */
         OI    CPFAILED,B'00000100'                                1532
*     ELSE                                                         1533
*                                                                  1533
*       /*************************************************************/
*       /*                                                           */
*       /* REPLACE LCCA POINTER WITH ADDRESS OF STORAGE IF A GETMAIN */
*       /* ZERO ENTRY IF A FREEMAIN                                  */
*       /*                                                           */
*       /*************************************************************/
*                                                                  1533
*       LCCACPUS=R1;                /* SAVE RESULT                   */
         B     @RC01531                                            1533
@RF01531 L     @14,LCCAPTR                                         1533
         ST    R1,LCCACPUS(,@14)                                   1533
*     RFY                                                          1534
*      (R1,                                                        1534
*       RETCODE) UNRSTD;            /* RELEASE REGISTER              */
@RC01531 DS    0H                                                  1535
*   END;                                                           1535
*   END;                            /* ** END OF SAVARSUB ROUTINE    */
@EL00015 DS    0H                                                  1536
@EF00015 DS    0H                                                  1536
@ER00015 LM    @14,@12,@SA00015                                    1536
         BR    @14                                                 1536
*AINIT:                                                            1537
*   PROC;                           /*                       @Y30LPXA*/
AINIT    STM   @14,@12,@SA00016                                    1537
*/***** AINIT ********************************************************/
*/* THE AINIT ROUTINE WILL VERIFY THAT MSS IS INCLUDED IN THE SYSTEM */
*/* AND IF SO WILL NOTIFY THE DEVICE THAT A NEW CPU IS BEING BROUGHT */
*/* INTO THE SYSTEM AND WILL BE OPERATING IN MP MODE. A INITIALIZE   */
*/* WILL BE ISSUED TO ACTIVATE THE INTERFACE FOR THE NEW PROCESSOR.  */
*/* ONLY THE ACTIVE PROCESSORS ID WILL BE PRESENTED TO THE DEVICE THE*/
*/* NEW PROCESSORS ID WILL BE FOUND FROM THE DEVICES TABLES. IF THE  */
*/* NEW PROCESSOR IS UNDEFINED TO THE DEVICE A ERROR MESSAGE WILL BE */
*/* ISSUED INFORMING THE OPERATOR OF THE ERROR CONDITION. NORMAL     */
*/* PROCESSING WILL CONTINUE.                                        */
*/********************************************************   @Y30LPXA*/
*                                                                  1538
*   /*****************************************************************/
*   /*                                                               */
*   /* DETERMINE IF MSS IS ACTIVE AND IF SVC 126 NEEDED      @G24LP2L*/
*   /* ACTIVE                                                        */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1538
*   IF(CVTICB^=0&ICBI='1'B)         /* MSS SYSGENED AND ACTIVE     1538
*                                                            @G24LP2L*/
*       &ICBMSCA='0'B THEN          /* AND THE MSC IS NOT ASYMMETRIC
*                                                            @G24LP2L*/
*                                                                  1538
         L     @12,CVTPTR                                          1538
         L     @12,CVTEXT2(,@12)                                   1538
         L     @12,CVTICB(,@12)                                    1538
         LTR   @12,@12                                             1538
         BZ    @RF01538                                            1538
         TM    ICBI(@12),B'10000000'                               1538
         BNO   @RF01538                                            1538
         TM    ICBMSCA(@12),B'00000010'                            1538
         BNZ   @RF01538                                            1538
*     /***************************************************************/
*     /*                                                             */
*     /* IF NON ZERO THEN MSS IS ACTIVE. ISSUE INITIALIZE AND        */
*     /* ASSOCIATE                                                   */
*     /*                                                             */
*     /***************************************************************/
*                                                                  1539
*     DO;                           /*                       @Y30LPXA*/
*                                                                  1539
*       /*************************************************************/
*       /*                                                           */
*       /* SET UP HOST ID AND FLAGS FOR ASSOCIATE AND INIT.          */
*       /*                                                           */
*       /*************************************************************/
*                                                                  1540
*       R15=ADDR(HOST);             /* POINT TO WORK AREA    @Y30LPXA*/
         LA    R15,HOST                                            1540
*       GEN(STIDP 0(R15));          /* STORE PROCESSOR ID    @Y30LPXA*/
*                                                                  1541
         STIDP 0(R15)
*       /*************************************************************/
*       /*                                                           */
*       /* FLAGS SPECIFY THAT BOTH INTERFACES OF THIS MP PAIR ARE TO */
*       /* BE INITIALIZED                                            */
*       /*                                                           */
*       /*************************************************************/
*                                                                  1542
*       AFLAG='4000'X;              /* INITIALIZE FLAGS FOR MSS    1542
*                                                            @ZM30463*/
         LH    AFLAG,@CH03846                                      1542
*/* ******************************************************* @Y30LB02 */
*/* MACMEAN  PURGE/ASSIGN/INITIALIZE/READY    MACRO         @Y30LB02 */
*/* VS1-4/VS2-3 VERSION-- 06/09/74 LEVEL 00                 @Y30LB02 */
*/* THIS IS THE OUTPUT FOR THE EXECUTE FORM.                @Y30LB02 */
*/* THE LIST FORM OF THIS MACRO SHOULD BE                   @Y30LB02 */
*/* INVOKED FIRST IN ORDER TO SET UP NECESSARY              @Y30LB02 */
*/* DECLARES.  IF THE COMPLETE ARGUMENT IS                  @Y30LB02 */
*/* SPECIFIED THE REQ BLOCK WILL BE ZEROED.                 @Y30LB02 */
*/* ******************************************************* @Y30LB02 */
*                                                                  1543
*       RFY                                                        1543
*        (PAIRR1) RSTD;             /* RESTRICT R1           @Y30LB02*/
*       PAIRR1=ADDR(PURINIT);       /* SET PAIRR1 TO REQ BLOCK     1544
*                                                            @Y30LB02*/
         LA    PAIRR1,PURINIT                                      1544
*       AIRLL='08'X;                /* SET LENGTH FIELD      @Y30LB02*/
         LA    @12,8                                               1545
         ST    @12,AIRLL                                           1545
*       AIROP='10'X;                /* INITL OPCODE          @Y30LB02*/
         MVI   AIROP,X'10'                                         1546
*       AIRFLAG=(AFLAG);            /* FILL IN FLAGS FIELD   @Y30LB02*/
         STH   AFLAG,AIRFLAG                                       1547
*       SVC(126);                   /* ISSUE SVC INST.       @Y30LB02*/
         SVC   126                                                 1548
*       RFY                                                        1549
*        (PAIRR1) UNRSTD;           /* UNRESTRICT R1         @Y30LB02
*                                      INITIALIZE DEVICE     @Y30LPXA*/
*                                                                  1549
*       /*************************************************************/
*       /*                                                           */
*       /* INTERFACE HAS BEEN INITIALIZED, ISSUE ASSOCIATE FLAGS     */
*       /* SPECIFY THAT BOTH PROCESSORS OF THIS MP PAIR ARE TO BE    */
*       /* ASSOCIATED. ANY VOLUMES MOUNTED FOR THE ORGINATING CPU    */
*       /* WILL BE MOUNTED FOR THE NEW CPU, ANY VOLUMES MOUNTED FOR  */
*       /* NEW CPU, AND NOT MOUNTED FOR ORGINATING CPU WILL BE       */
*       /* DEMOUNTED                                                 */
*       /*                                                           */
*       /*************************************************************/
*                                                                  1550
*       AFLAG='8000'X;              /* SET UP FLAGS FOR ASSOCIATE  1550
*                                                            @Y30LPXA*/
         L     AFLAG,@CF03850                                      1550
*/*  ******************************************************* @Y30LB02*/
*/*       MACMEAN  MSSC ASSOCIATE MACRO                      @Y30LB02*/
*/*  VS1-4/VS2-3 VERSION-- 06/09/74 LEVEL 00                 @Y30LB02*/
*/*  THIS IS THE OUTPUT FOR THE EXECUTE FORM.                @Y30LB02*/
*/*  THE LIST FORM OF THIS MACRO SHOULD BE                   @Y30LB02*/
*/*  INVOKED FIRST IN ORDER TO SET UP NECESSARY              @Y30LB02*/
*/*  DECLARES.  IF THE COMPLETE ARGUMENT IS                  @Y30LB02*/
*/*  SPECIFIED THE REQ BLOCK WILL BE ZEROED.                 @Y30LB02*/
*/*  ******************************************************* @Y30LB02*/
*                                                                  1551
*       RFY                                                        1551
*        (ASDAR1) RSTD;             /* RESTRICT REG 1        @Y30LB02*/
*       ASDAR1=ADDR(DISCPU);        /* R1 POINTER TO REQUEST BLOCK 1552
*                                                            @Y30LB02*/
         LA    ASDAR1,DISCPU                                       1552
*       ASDALEN='10'X;              /* LENGTH OF ASSOC REQUEST     1553
*                                                            @Y30LB02*/
         LA    @12,16                                              1553
         ST    @12,ASDALEN                                         1553
*       ASDAOPC='2C'X;              /* ASSOCIATE OPCODE      @Y30LB02*/
         MVI   ASDAOPC,X'2C'                                       1554
*       ASDAFLG=(AFLAG);            /* VALUE OF FLAGS PARAMETER    1555
*                                                            @Y30LB02*/
         STH   AFLAG,ASDAFLG                                       1555
*       ASDACPU=(HOSTID);           /* HOSTID                @Y30LB02*/
         MVC   ASDACPU(5),HOSTID                                   1556
*       SVC(126);                   /* INVOKE THE SVC        @Y30LB02*/
         SVC   126                                                 1557
*       RFY                                                        1558
*         ASDAR1 UNRSTD;            /* UNRESTRICT REG 1      @Y30LB02
*                                                            @Y30LPXA*/
*                                                                  1558
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK FOR SUCESSFUL RETURN CODE, ELSE ISSUE MESSAGE       */
*       /* INFORMING OPERATOR OF PROBLEM                             */
*       /*                                                           */
*       /*************************************************************/
*                                                                  1559
*       IF RETCODE^=0 THEN          /* SUCESSFUL?            @Y30LPXA*/
         LTR   RETCODE,RETCODE                                     1559
         BZ    @RF01559                                            1559
*         DO;                                                      1560
*           ERCODE=R0;              /* SAVE REASON CODE      @Y30LPXA*/
         ST    R0,ERCODE                                           1561
*           SS1FAIL='1'B;           /* SET ERROR FLAG        @Y30LPXA*/
         OI    SS1FAIL,B'00010000'                                 1562
*         END;                                                     1563
*       ELSE                                                       1564
*         DO;                                                      1564
*                                                                  1564
         B     @RC01559                                            1564
@RF01559 DS    0H                                                  1565
*           /*********************************************************/
*           /*                                                       */
*           /* ASSOCIATE WAS SUCESSFUL, INFORM MSS THAT NEW CPU IS   */
*           /* READY TO ACCEPT MESSAGES FLAGS SPECIFY THAT BOTH      */
*           /* INTERFACES OF THIS MP PAIR ARE READY TO ACCEPT        */
*           /* MESSAGES FROM MSS                                     */
*           /*                                                       */
*           /*********************************************************/
*                                                                  1565
*           AFLAG='0000'X;          /* SET FLAG BITS         @Y30LPXA*/
         SLR   AFLAG,AFLAG                                         1565
*/* ******************************************************* @Y30LB02 */
*/* MACMEAN  PURGE/ASSIGN/INITIALIZE/READY    MACRO         @Y30LB02 */
*/* VS1-4/VS2-3 VERSION-- 06/09/74 LEVEL 00                 @Y30LB02 */
*/* THIS IS THE OUTPUT FOR THE EXECUTE FORM.                @Y30LB02 */
*/* THE LIST FORM OF THIS MACRO SHOULD BE                   @Y30LB02 */
*/* INVOKED FIRST IN ORDER TO SET UP NECESSARY              @Y30LB02 */
*/* DECLARES.  IF THE COMPLETE ARGUMENT IS                  @Y30LB02 */
*/* SPECIFIED THE REQ BLOCK WILL BE ZEROED.                 @Y30LB02 */
*/* ******************************************************* @Y30LB02 */
*                                                                  1566
*           RFY                                                    1566
*            (PAIRR1) RSTD;         /* RESTRICT R1           @Y30LB02*/
*           PAIRR1=ADDR(PURINIT);   /* SET PAIRR1 TO REQ BLOCK     1567
*                                                            @Y30LB02*/
         LA    PAIRR1,PURINIT                                      1567
*           AIRLL='08'X;            /* SET LENGTH FIELD      @Y30LB02*/
         LA    @12,8                                               1568
         ST    @12,AIRLL                                           1568
*           AIROP='20'X;            /* RDY OPCODE            @Y30LB02*/
         MVI   AIROP,X'20'                                         1569
*           SVC(126);               /* ISSUE SVC INST.       @Y30LB02*/
         SVC   126                                                 1570
*           RFY                                                    1571
*            (PAIRR1) UNRSTD;       /* UNRESTRICT R1         @Y30LB02*/
*           IF RETCODE^=0 THEN      /* SUCESSFUL?            @Y30LPXA*/
         LTR   RETCODE,RETCODE                                     1572
         BZ    @RF01572                                            1572
*             DO;                   /*                       @Y30LPXA*/
*               ERCODE=R0;          /* SAVE REASON CODE      @Y30LPXA*/
         ST    R0,ERCODE                                           1574
*               SS1FAIL='1'B;       /* SET ERROR FLAG                */
         OI    SS1FAIL,B'00010000'                                 1575
*             END;                                                 1576
*         END;                                                     1577
*     END;                                                         1578
*   END;                            /* END OF PROCESSING     @Y30LPXA*/
@EL00016 DS    0H                                                  1579
@EF00016 DS    0H                                                  1579
@ER00016 LM    @14,@12,@SA00016                                    1579
         BR    @14                                                 1579
*DISASSOC:                                                         1580
*   PROC;                           /*                       @Y30LPXA*/
DISASSOC STM   @14,@12,@SA00017                                    1580
*/*** DISASSOC ***************************************************** */
*/* THE DISASSOC ROUTINE WILL VERIFY THAT MSS IS INCLUDED IN THE     */
*/* SYSTEM AND IF SO WILL NOTIFY THE DEVICE THAT A PROCESSOR IS NO   */
*/* LONGER OPERATING IN MP MODE. A PURGE WILL BE ISSUED FOR THE CPU  */
*/* WHICH HAS JUST GONE OFFLINE TO FREE ANY VOLUMES WHICH MAY BE     */
*/* MOUNTED AND RECORDED IN THE DEVICES TABLES. THE FUNCTION IS ALSO */
*/* PERFORMED WHEN CHANNEL RECONFIGURATION HARDWARE IS DEACTIVATED   */
*/*********************************************************  @Y30LPXA*/
*                                                                  1581
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK IF MSS IS ACTIVE AND IF SO ISSUE DISASSOCIATE AND PURGE */
*   /* FOR OFFLINE CPU                                               */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1581
*   IF(CVTICB^=0&ICBI='1'B)         /* MSS SYSGENED AND ACTIVE     1581
*                                                            @G24LP2L*/
*       &ICBMSCA='0'B THEN                                         1581
         L     @12,CVTPTR                                          1581
         L     @12,CVTEXT2(,@12)                                   1581
         L     @12,CVTICB(,@12)                                    1581
         LTR   @12,@12                                             1581
         BZ    @RF01581                                            1581
         TM    ICBI(@12),B'10000000'                               1581
         BNO   @RF01581                                            1581
         TM    ICBMSCA(@12),B'00000010'                            1581
         BNZ   @RF01581                                            1581
*     DO;                           /* AND THE MSC IS NOT ASYMMETRIC
*                                                            @G24LP2L*/
*                                                                  1582
*       /*************************************************************/
*       /*                                                           */
*       /* MSS IS ACTIVE. ISSUE DISASSOCIATE AND PURGE FOR CPU THAT  */
*       /* HAS JUST GONE OFFLINE.                                    */
*       /*                                                           */
*       /*************************************************************/
*                                                                  1583
*       R15=ADDR(HOST);             /* POINT TO WORK AREA    @Y30LPXA*/
         LA    R15,HOST                                            1583
*       GEN(STIDP  0(R15));         /* STORE PROCESSOR ID    @Y30LPXA*/
*                                                                  1584
         STIDP  0(R15)
*       /*************************************************************/
*       /*                                                           */
*       /* SET UP FLAG BYTE FOR INTERFACE. FLAGS SPECIFY THAT MSS IS */
*       /* TO BE DISASSOCIATED, INTERFACE OF OFFLINE CPU WILL BE     */
*       /* DEINITIALIZED, AND THE SPECIFIED CPU WILL BECOME PRIMARY  */
*       /* HOST IF MP SYSTEM HAD RESPONSIBILITY                      */
*       /*                                                           */
*       /*************************************************************/
*                                                                  1585
*       AFLAG='0400'X;              /* SET UP FLAGS FOR DISASSOC   1585
*                                                            @ZM30463*/
*                                                                  1585
         LA    AFLAG,1024                                          1585
*       /*************************************************************/
*       /*                                                           */
*       /* ISSUE DISASSOCIATE FOR OFFLINE CPU                        */
*       /*                                                           */
*       /*************************************************************/
*                                                                  1586
*/*  ******************************************************* @Y30LB02*/
*/*       MACMEAN  MSSC ASSOCIATE MACRO                      @Y30LB02*/
*/*  VS1-4/VS2-3 VERSION-- 06/09/74 LEVEL 00                 @Y30LB02*/
*/*  THIS IS THE OUTPUT FOR THE EXECUTE FORM.                @Y30LB02*/
*/*  THE LIST FORM OF THIS MACRO SHOULD BE                   @Y30LB02*/
*/*  INVOKED FIRST IN ORDER TO SET UP NECESSARY              @Y30LB02*/
*/*  DECLARES.  IF THE COMPLETE ARGUMENT IS                  @Y30LB02*/
*/*  SPECIFIED THE REQ BLOCK WILL BE ZEROED.                 @Y30LB02*/
*/*  ******************************************************* @Y30LB02*/
*                                                                  1586
*       RFY                                                        1586
*        (ASDAR1) RSTD;             /* RESTRICT REG 1        @Y30LB02*/
*       ASDAR1=ADDR(DISCPU);        /* R1 POINTER TO REQUEST BLOCK 1587
*                                                            @Y30LB02*/
         LA    ASDAR1,DISCPU                                       1587
*       ASDALEN='10'X;              /* LENGTH OF ASSOC REQUEST     1588
*                                                            @Y30LB02*/
         LA    @12,16                                              1588
         ST    @12,ASDALEN                                         1588
*       ASDAOPC='2C'X;              /* ASSOCIATE OPCODE      @Y30LB02*/
         MVI   ASDAOPC,X'2C'                                       1589
*       ASDAFLG=(AFLAG);            /* VALUE OF FLAGS PARAMETER    1590
*                                                            @Y30LB02*/
         STH   AFLAG,ASDAFLG                                       1590
*       ASDACPU=(HOSTID);           /* HOSTID                @Y30LB02*/
         MVC   ASDACPU(5),HOSTID                                   1591
*       SVC(126);                   /* INVOKE THE SVC        @Y30LB02*/
         SVC   126                                                 1592
*       RFY                                                        1593
*         ASDAR1 UNRSTD;            /* UNRESTRICT REG 1      @Y30LB02
*                                                            @Y30LPXA*/
*                                                                  1593
*       /*************************************************************/
*       /*                                                           */
*       /* CPU HAS BEEN DISASSOCIATED, ISSUE PURGE FOR ALL VOLUMES ON*/
*       /* OFFLINE CPU FLAGS SPECIFY THAT ALL VOLUMES ARE TO BE      */
*       /* DEMOUNTED FOR THE OTHER PROCESSOR OF THIS MP PAIR.        */
*       /*                                                           */
*       /*************************************************************/
*                                                                  1594
*       AFLAG='8000'X;              /* SET FLAGS FOR MACRO CALL    1594
*                                                            @Y30LPXA*/
         L     AFLAG,@CF03850                                      1594
*/*  ******************************************************* @Y30LB02*/
*/*  MACMEAN  PURGE/ASSIGN/INITIALIZE/READY    MACRO         @Y30LB02*/
*/*  VS1-4/VS2-3 VERSION-- 06/09/74 LEVEL 00                 @Y30LB02*/
*/*  THIS IS THE OUTPUT FOR THE EXECUTE FORM.                @Y30LB02*/
*/*  THE LIST FORM OF THIS MACRO SHOULD BE                   @Y30LB02*/
*/*  INVOKED FIRST IN ORDER TO SET UP NECESSARY              @Y30LB02*/
*/*  DECLARES.  IF THE COMPLETE ARGUMENT IS                  @Y30LB02*/
*/*  SPECIFIED THE REQ BLOCK WILL BE ZEROED.                 @Y30LB02*/
*/*  ******************************************************* @Y30LB02*/
*                                                                  1595
*       RFY                                                        1595
*        (PAIRR1) RSTD;             /* RESTRICT R1           @Y30LB02*/
*       PAIRR1=ADDR(PURCPU);        /* SET PAIRR1 TO REQ BLOCK     1596
*                                                            @Y30LB02*/
         LA    PAIRR1,PURCPU                                       1596
*       PURGLL='0D'X;               /* SET LENGTH FIELD      @Y30LB02*/
         LA    @12,13                                              1597
         ST    @12,PURGLL                                          1597
*       PURGOP='14'X;               /* PURG OPCODE           @Y30LB02*/
         MVI   PURGOP,X'14'                                        1598
*       PURGFLG=(AFLAG);            /* FILL IN FLAGS FIELD   @Y30LB02*/
         STH   AFLAG,PURGFLG                                       1599
*       PURGHOST=(HOSTID);          /* FILL IN HOSTID FIELD  @Y30LB02*/
         MVC   PURGHOST(5),HOSTID                                  1600
*       SVC(126);                   /* ISSUE SVC INST.       @Y30LB02*/
         SVC   126                                                 1601
*       RFY                                                        1602
*        (PAIRR1) UNRSTD;           /* UNRESTRICT R1         @Y30LB02*/
*                                                                  1602
*       /*************************************************************/
*       /*                                                           */
*       /* ISSUE PURGE FOR OFFLINE CPU                       @ZM30463*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1603
*     END;                                                         1603
*   END;                                                           1604
@EL00017 DS    0H                                                  1604
@EF00017 DS    0H                                                  1604
@ER00017 LM    @14,@12,@SA00017                                    1604
         BR    @14                                                 1604
*                                                                  1605
*/* ****** FRRRTN ************************************************   */
*/* FRRRTN WILL GAIN CONTROL IN THE EVENT OF A SYSTEM FAILURE WHILE  */
*/* HOLDING THE RESTART RESOURCE WORD.  ROUTINE WILL SIMPLY FREE     */
*/* RESTART RESOURCE AND CONTINUE ABEND                              */
*/*****************************************************************  */
*                                                                  1605
*FRRRTN:                                                           1605
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               1605
*                                                                  1605
FRRRTN   DS    0H                                                  1606
*   /*****************************************************************/
*   /*                                                               */
*   /* ZERO RESTART RESOURCE                                         */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1606
*   CVTRSTWD=0;                     /* ZERO RESTART WORD             */
         L     @12,CVTPTR                                          1606
         SLR   @06,@06                                             1606
         ST    @06,CVTRSTWD(,@12)                                  1606
*   DO;                             /* SETRP RECORD(NO)RC(0)         */
*     RESPECIFY                                                    1608
*      (GPR00P,                                                    1608
*       GPR01P,                                                    1608
*       GPR14P,                                                    1608
*       GPR15P) RSTD;                                              1608
*     GPR01P->SDWARCDE=0;           /* SAVE RC VALUE                 */
         MVI   SDWARCDE(GPR01P),X'00'                              1609
*     GPR01P->SDWARCRD='0'B;        /* TURN OFF RECORD INDICATOR     */
         NI    SDWARCRD(GPR01P),B'01111111'                        1610
*     RESPECIFY                                                    1611
*      (GPR00P,                                                    1611
*       GPR01P,                                                    1611
*       GPR14P,                                                    1611
*       GPR15P) UNRSTD;                                            1611
*   END;                            /* CONTINUE TERM                 */
*   END;                            /* **** END OF FRR ROUTINE       */
@EL00018 DS    0H                                                  1613
@EF00018 DS    0H                                                  1613
@ER00018 BR    @14                                                 1613
*ESTAERTN:                                                         1614
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               1614
*                                                                  1614
ESTAERTN DS    0H                                                  1615
*/******* ESTAERTN ************************************************  */
*/* ESTAERTN ROUTINE WILL RECEIVE CONTROL IN THE EVENT OF A SYSTEM   */
*/* ERROR OR HARDWARE ERROR. ROUTINE WILL RESTORE ADDRESSABILITY     */
*/* FOR CODE BY RELOADING REGISTERS THAT WERE SAVED UPON INITIAL     */
*/* ENTRY. A LINK WILL BE MADE TO CLEAN UP ROUTINE AND UPON RETURN   */
*/* WILL RETURN TO RTM.                                              */
*/*****************************************************************  */
*                                                                  1615
*   /*****************************************************************/
*   /*                                                               */
*   /* ISSUE MACRO TO RESTABLISH ADDRESSABILITY                      */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1615
*   DO;                             /* ENTESTAE (R5,R8,R9,R7)SAVEAREA
*                                      (REGSAVEA)ERREXIT(NORTCA)PARMR
*                                      EG(R15)                       */
*                                                                  1615
*     /***************************************************************/
*     /*                                                             */
*     /* ENTRY CODE FOR ESTAE ROUTINE. IF RTCA ALLOCATED THEN RESTORE*/
*     /* CODE AND DATA REGS FROM START OF USERS PARM LIST, AND       */
*     /* ESTABLISH ADDR TO ESTAE SAVE AREA IF REQUIRED. IF NO RTCA   */
*     /* AVAILABLE THEN BRANCH TO ERROR CODE AFTER ESTABLISHING      */
*     /* ADDRESSABILITY                                              */
*     /*                                                             */
*     /***************************************************************/
*                                                                  1616
*     GEN(USING *,GPR15P);                                         1616
         USING *,GPR15P
*     GEN(CH    GPR00F,*+34);       /* CHECK IF RTCA ALLOC FAILED    */
         CH    GPR00F,*+34
*     GEN(BNE   *+32);              /* NO,SAVE RTM REGS              */
         BNE   *+32
*     GEN(DROP  GPR15P);            /* DROP LOCAL ADDR               */
         DROP  GPR15P
*     GEN(LR    R15,GPR02P);        /* PTR TO USER PARM LIST         */
         LR    R15,GPR02P
*     GEN(L     R5,00(R15));                                       1621
         L     R5,00(R15)
*     GEN(L     R8,04(R15));                                       1622
         L     R8,04(R15)
*     GEN(L     R9,08(R15));                                       1623
         L     R9,08(R15)
*     GEN(L     R7,12(R15));                                       1624
         L     R7,12(R15)
*     GEN(LA    GPR13P,REGSAVEA);   /* SET PTR TO ESTAE SA           */
         LA    GPR13P,REGSAVEA
*     GEN(B     NORTCA);            /* BRANCH TO ERROR EXIT          */
         B     NORTCA
*     GEN(DC    H'12');             /* NO RTCA AVAIL RC              */
         DC    H'12'
*     GEN(STM   GPR14P,GPR12F,12(GPR13P));/* GOOD R13, SAVE RTM'S  1628
*                                      REGS                          */
         STM   GPR14P,GPR12F,12(GPR13P)
*     GEN(L     R15,0(GPR01P));     /* PTR TO USER PARM LIST         */
         L     R15,0(GPR01P)
*     GEN(L     R5,00(R15));                                       1630
         L     R5,00(R15)
*     GEN(L     R8,04(R15));                                       1631
         L     R8,04(R15)
*     GEN(L     R9,08(R15));                                       1632
         L     R9,08(R15)
*     GEN(L     R7,12(R15));                                       1633
         L     R7,12(R15)
*     GEN(ST    GPR13P,REGSAVEA+4); /* SET PTR TO RTM SA             */
         ST    GPR13P,REGSAVEA+4
*     GEN(LA    GPR13P,REGSAVEA);   /* SET PTR TO ESTAE SA           */
         LA    GPR13P,REGSAVEA
*   END;                            /* ENTESTAE (R5,R8,R9,R7)SAVEAREA
*                                      (REGSAVEA)ERREXIT(NORTCA)PARMR
*                                      EG(R15)                       */
*                                                                  1636
*   /*****************************************************************/
*   /*                                                               */
*   /* ADDRESSABILITY HAS BEEN REESTABLISHED, LINK TO CLEANUP ROUTINE*/
*   /* AND UPON RETURN RETURN TO RTM SAVE POINTER TO SDWA ACROSS CALL*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1637
*   RFY                                                            1637
*    (R1,                                                          1637
*     R2) RSTD;                     /* RESTRICT REG                  */
*   R2=R1;                          /* COPY REGISTER ONE             */
         LR    R2,R1                                               1638
*   CALL IEECLEAN(ADDR(WORKAREA));  /* LINK TO CLEANUP               */
         LA    @12,WORKAREA                                        1639
         ST    @12,@TF00001                                        1639
         LA    @12,@TF00001                                        1639
         ST    @12,@AL00001                                        1639
         L     @15,@CV03522                                        1639
         LA    @01,@AL00001                                        1639
         BALR  @14,@15                                             1639
*   R1=R2;                          /* RESTORE REG ONE               */
         LR    R1,R2                                               1640
*   RFY                                                            1641
*    (R1,                                                          1641
*     R2) UNRSTD;                   /* RELEASE REG                   */
*                                                                  1641
*   /*****************************************************************/
*   /*                                                               */
*   /* PICK UP POINTER TO ESTAE SAVE AREA                            */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1642
*   GEN(L R13,4(R13));              /* RESTORE SAVAREA POINTER       */
*                                                                  1642
         L R13,4(R13)
*   /*****************************************************************/
*   /*                                                               */
*   /* PLACE RECORDING INFORMATION IN SDWA FOR ID.                   */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1643
*   RFY                                                            1643
*    (SDWAPTR) RSTD;                /* RESTRICT SDWA POINTER         */
*   SDWAMODN='IEEVCPU';             /* MODULE NAME                   */
         MVI   SDWAMODN+7(SDWAPTR),C' '                            1644
         MVC   SDWAMODN(7,SDWAPTR),@CC03867                        1644
*   SDWACSCT='IEEVCPU';             /* CSECT NAME                    */
         MVI   SDWACSCT+7(SDWAPTR),C' '                            1645
         MVC   SDWACSCT(7,SDWAPTR),@CC03867                        1645
*   SDWAVRA=WORKAREA;               /* MOVE COMMON WORK AREA TO    1646
*                                      RECORD                        */
         MVC   SDWAVRA(108,SDWAPTR),WORKAREA                       1646
*   SDWAURAL=LENGTH(WORKAREA);      /* LENGTH OF WORKAREA            */
         MVI   SDWAURAL(SDWAPTR),X'74'                             1647
*   SDWAHEX='1'B;                   /* SET HEX FLAG                  */
         OI    SDWAHEX(SDWAPTR),B'10000000'                        1648
*   RFY                                                            1649
*    (SDWAPTR) UNRSTD;              /* RELEASE REGISTER              */
*   DO;                             /* SETRP DUMP(NO)RECORD(YES)RC(0)
*                                      REGS(14,12)                   */
*     RESPECIFY                                                    1651
*      (GPR00P,                                                    1651
*       GPR01P,                                                    1651
*       GPR14P,                                                    1651
*       GPR15P) RSTD;                                              1651
*     GPR01P->SDWARCDE=0;           /* SAVE RC VALUE                 */
         MVI   SDWARCDE(GPR01P),X'00'                              1652
*     GPR01P->SDWARCRD='1'B;        /* TURN ON RECORD INDICATOR      */
         OI    SDWARCRD(GPR01P),B'10000000'                        1653
*     GPR01P->SDWAREQ='0'B;         /* TURN OFF DUMP INDICATOR       */
         NI    SDWAREQ(GPR01P),B'01111111'                         1654
*     GEN(RETURN (14,12));                                         1655
         RETURN (14,12)
*     RESPECIFY                                                    1656
*      (GPR00P,                                                    1656
*       GPR01P,                                                    1656
*       GPR14P,                                                    1656
*       GPR15P) UNRSTD;                                            1656
*   END;                                                           1657
*NORTCA:                                                           1658
*                                                                  1658
*   /*****************************************************************/
*   /*                                                               */
*   /* CALL MAY BE MADE TO CLEANUP ROUTINE EVEN WITHOUT SDWA         */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1658
*   CALL IEECLEAN(ADDR(WORKAREA));  /* CALL CLEANUP ROUTINE          */
NORTCA   LA    @12,WORKAREA                                        1658
         ST    @12,@TF00001                                        1658
         LA    @12,@TF00001                                        1658
         ST    @12,@AL00001                                        1658
         L     @15,@CV03522                                        1658
         LA    @01,@AL00001                                        1658
         BALR  @14,@15                                             1658
*   RFY                                                            1659
*    (R15) RSTD;                    /* RESTRICT REG 15               */
*   R15=0;                          /* ZERO REG 15                   */
         SLR   R15,R15                                             1660
*   RFY                                                            1661
*    (R15) UNRSTD;                  /* RELEASE REG 15                */
*   END;                            /* *** END OF ESTAE ROUTINE      */
@EL00019 DS    0H                                                  1662
@EF00019 DS    0H                                                  1662
@ER00019 BR    @14                                                 1662
*IEAVSPSA:                                                         1663
*   PROC(FREEPTR) OPTIONS(NOSAVE(1,15),NOSAVEAREA);                1663
*                                                                  1663
IEAVSPSA ST    @14,12(,@13)                                        1663
         ST    @00,20(,@13)                                        1663
         STM   @02,@12,28(@13)                                     1663
         MVC   @PC00020(4),0(@01)                                  1663
*/********************************************************************/
*/*                                                                  */
*/*                                                                  */
*/********************************************************************/
*/*                                                                  */
*/* STATUS:   CHANGE LEVEL=001  12/12/74                             */
*/*                                                                  */
*/* FUNCTION:  1) FOR GETMAIN REQUESTS, TO GET A SA/WA AND VECTOR    */
*/*               TABLE AND INITIALIZE IT                            */
*/*            2) FOR FREEMAIN REQUESTS, TO FREE A SA/WA AND VECTOR  */
*/*               TABLE                                              */
*/*            3) FOR FORMAT REQUESTS, TO FORMAT THE SA/WA VECTOR    */
*/*               TABLE                                              */
*/*                                                                  */
*/* ENTRY POINT: IEAVSPSA                                            */
*/*                                                                  */
*/* INPUT:    REGISTER 1  CONTAINS: 1)ADDRESS TO FREEMAIN, OR        */
*/*                                 2)ZERO IF REQUEST FOR GETMAIN    */
*/*                                 3)COMPLEMENT FOR FORMAT          */
*/*           REGISTER 13 POINTS TO A REGISTER SAVEAREA              */
*/*           REGISTER 14 CONTAINS THE RETURN ADDRESS                */
*/*           REGISTER 15 CONTAINS THE ENTRY POINT ADDRESS           */
*/*                                                                  */
*/* OUTPUT:   REGISTER 1  CONTAINS 1)ADDRESS OF VECTOR TABLE         */
*/*                                2)ZERO - ON RETURN FROM FREEMAIN  */
*/*                                         REQUEST                  */
*/*           REGISTER 15 CONTAINS 1)A RETURN CODE OF ZERO, IF NO    */
*/*                                  ERROR                           */
*/*                                2)A RETURN CODE OF FOUR FOR ERRORS*/
*/*                                   FROM AT LEAST ONE OF THESE     */
*/*                                   SOURCES:                       */
*/*                                  - ISSUING A GETMAIN             */
*/*                                  - ISSUING A FREEMAIN            */
*/*                                  - ISSUING A SETLOCK TO OBTAIN OR*/
*/*                                    FREE SALLOC                   */
*/*           REGISTER 14 CONTAINS THE RETURN ADDRESS                */
*/*           REGISTER 13 POINTS TO A REGISTER SAVEAREA              */
*/*                                                                  */
*/* EXTERNAL REFERENCES: NONE.                                       */
*/*                                                                  */
*/* EXITS:    RETURN TO CALLER VIA A BR 14                           */
*/*                                                                  */
*/* ERROR CODES:                                                     */
*/*           REGISTER 15 CONTAINS THE RETURN CODE                   */
*/*                                                                  */
*/* TABLES/WORK AREAS: IHAWSAVT                                      */
*/* NOTE: THE ROUTINE THAT INCLUDES THIS ROUTINE MUST CONTAIN        */
*/*       MAPPING MACROS FOR THE CVT (MARCO: CVT) AND THE PSA        */
*/*       (MACRO: IHAPSA).                                           */
*/*                                                                  */
*/* ATTRIBUTES: SERIALLY REUSABLE                                    */
*/*                                                                  */
*/* RESOURCES:                                                       */
*/*           NONE.                                                  */
*/*                                                                  */
*/* SVCS:     NONE.  BRANCH ENTRIES TO GETMAIN,FREEMAIN              */
*/*                                                                  */
*/* MESSAGES: NONE.                                                  */
*/*                                                                  */
*/* NOTES:                                                           */
*/*    THIS ROUTINE INCLUDES THE MAPPING MACRO 'IHAWSAVT' AND        */
*/*    SPECIFIES THE MAPPING OF THE GLOBAL WORK/SAVE AREAS, EVEN     */
*/*    THOUGH THIS ROUTINE BUILDS THE WORK/SAVE AREAS FOR A CPU.     */
*/*    THIS IS BECAUSE THIS ROUTINE USES 'GETMAIN' TO OBTAIN THE     */
*/*    SPACE FOR THE WORK/SAVE AREA IT IS BUILDING BUT 'GETMAIN'     */
*/*    ITSELF USES THE GLOBAL WORK/SAVE AREAS.                       */
*/*    THE MAPPING MACRO FOR THE CPU RELATED WORK/SAVE AREA IS NOT   */
*/*    USED IN BUILDING OR INITIALIZING THAT WORK/SAVE AREA BY THIS  */
*/*    THIS ROUTINE, THUS THE MAPPING OF THE CPU RELATED WORK/SAVE   */
*/*    AREA IS NOT NEEDED BY THIS ROUTINE BUT THE MAPPING OF THE     */
*/*    GLOBAL WORK/SAVE AREA IS NEEDED.                              */
*/*                                                                  */
*/********************************************************************/
*                                                                  1664
*                                                                  1664
*/* **************************************************************** */
*/*                                                                  */
*/*            WORK/SAVE AREA VECTOR TABLES (WSAVT)                  */
*/*                                                                  */
*/*  OS/VS2 RELEASE 4, 07/22/75, LEVEL=2                             */
*/*                                                                  */
*/*  METHOD OF ACCESS                                                */
*/*      PL/S - INCLUDE IHAASXB TO DEFINE ASXBSPSA FOR LOCAL WSAVT.  */
*/*             INCLUDE CVT TO DEFINE CVTSPSA FOR GLOBAL WSAVT.      */
*/*             INCLUDE IHALCCA TO DEFINE LCCACPUS FOR CPU WSAVT.    */
*/*                                                                  */
*/*             ALL 3 WSAVT'S ARE MAPPED UNLESS MACRO VARIABLE(S)    */
*/*             ARE SET TO NO.  CODING %WSALOCAL='NO' BEFORE INCLUDE */
*/*             MEANS THAT A MAPPING OF LOCAL WSAVT WILL NOT BE      */
*/*             PRODUCED.  %WSAGLOBL='NO' SUPPRESSES GLOBAL WSAVT    */
*/*             MAPPING.  %WSACPU='NO' SUPPRESSES CPU WSAVT MAPPING. */
*/*                                                                  */
*/*      BAL -  THERE ARE 4 KEYWORD PARAMETERS AS FOLLOWS -          */
*/*                                                                  */
*/*             1. CLASS=LOCAL/GLOBAL/CPU WITH A DEFAULT OF LOCAL.   */
*/*                THIS PARAMETER DETERMINES WHICH WSAVT MAPPING IS  */
*/*                PRODUCED.                                         */
*/*                                                                  */
*/*             2. DSECT=YES/NO WITH A DEFAULT OF YES.  IF YES, A    */
*/*                DSECT IS PRODUCED FOR MAPPING REQUESTED BY CLASS  */
*/*                PARAMETER.  THE DSECT NAMES ARE -                 */
*/*                     WSAL - LOCAL WSAVT                           */
*/*                     WSAG - GLOBAL WSAVT                          */
*/*                     WSAC - CPU WSAVT                             */
*/*                                                                  */
*/*             3. FUNC=INIT.  IF THIS PARAMETER IS SPECIFIED, AN    */
*/*                INITIALIZED TABLE OF HALF-WORD LENGTH VALUES      */
*/*                DESCRIBING THE NUMBER OF ENTRIES AND LENGTH OF    */
*/*                EACH ENTRY IN WSAVT SPECIFIED BY CLASS PARAMETER  */
*/*                IS PRODUCED.                                      */
*/*                                                                  */
*/*             4. ACR=YES/NO WITH A DEFAULT OF YES.  IF CLASS=CPU   */
*/*                AND DSECT=NO, ACR=YES CREATES A WORK/SAVE AREA    */
*/*                FOR ACR, AND ACR=NO CREATES A RESERVED 8-BYTE     */
*/*                AREA BECAUSE ACR IS NOT IN THE SYSTEM.            */
*/*                                                                  */
*/*             DSECT=NO MUST BE SPECIFIED IF FUNC=INIT IS SPECIFIED.*/
*/*                                                                  */
*/*             IF DSECT=NO IS SPECIFIED AND FUNC=INIT IS NOT        */
*/*             SPECIFIED, THE MAPPING OF WSAVT WILL BE FOLLOWED BY  */
*/*             MAPPING OF ACTUAL WORK/SAVE AREAS.                   */
*/*                                                                  */
*/* **************************************************************** */
*                                                                  1664
*   DECLARE                                                        1664
*     1 WSAG BASED(CVTSPSA) BDY(DWORD),/* GLOBAL WORK/SAVE AREA    1664
*                                      VECTOR TABLE                  */
*      2 WSAGPGIO PTR(31),          /* ADDRESS OF PAGE I/O ERROR SAVE
*                                      AREA (80 BYTES)               */
*      2 WSAGGMFM PTR(31),          /* ADDRESS OF GETMAIN/ FREEMAIN
*                                      SAVE AREA (1168 BYTES)      1664
*                                      (MDC301)              @Z30EN9A*/
*      2 WSAGRSM PTR(31),           /* ADDRESS OF REAL STORAGE     1664
*                                      MANAGEMENT (RSM) SAVE AREA  1664
*                                      (1024 BYTES)                  */
*      2 WSAGSSRS PTR(31),          /* ADDRESS OF SUSPEND/RESET FOR
*                                      RSM SAVE AREA (80 BYTES)      */
*      2 WSAGEMS0 PTR(31),          /* ADDRESS OF MEMORY SWITCH SAVE
*                                      AREA (56 BYTES)               */
*      2 WSAGSTAT PTR(31),          /* ADDRESS OF STATUS SAVE AREA 1664
*                                      (72 BYTES)                    */
*      2 WSAGOPTM PTR(31),          /* ADDRESS OF SYSTEM RESOURCES 1664
*                                      MANAGER (SRM) SAVE AREA (400
*                                      BYTES) MDC017                 */
*      2 WSAGMEMT PTR(31),          /* ADDRESS OF MEMORY TERMINATION
*                                      SAVE AREA (80 BYTES)          */
*      2 WSAGNQDQ PTR(31),          /* ADDRESS OF ENQ/DEQ SAVE AREA
*                                      (296 BYTES) MDC011            */
*      2 WSAGREST PTR(31),          /* ADDRESS OF WORK/SAVE AREA FOR
*                                      STATUS SAVING BY STOP AND   1664
*                                      RESTART SUBROUTINE (168 BYTES)
*                                      MDC018                        */
*      2 WSAGSCHE PTR(31);          /* ADDRESS OF SCHEDULE ROUTINE 1664
*                                      (IEAVESC0) SAVE AREA FOR    1664
*                                      SYSEVENT BRANCH ENTRY       1664
*                                      INTERFACE (72 BYTES) MDC014   */
*   DCL                                                            1665
*     REGSAPTR PTR(31) REG(13);     /* PTR. TO REGISTER SAVE AREAS   */
*   DCL                                                            1666
*     PARMX FIXED(31) REG(1);       /* INPUT PARM            @ZM30488*/
*   DCL                                                            1667
*     PARM POINTER(31) REG(1);      /* INPUT AND OUTPUT PARM         */
*   DCL                                                            1668
*     RTCODE FIXED(31) REG(15);     /* RETURN CODE                   */
*   DCL                                                            1669
*     TBLPTR PTR(31) REG(1);        /* PTR TO VECTOR TABLE           */
*   DCL                                                            1670
*     LNGREG FIXED(31) REG(0);      /* LENGTH TO GET OR FREE         */
*   DCL                                                            1671
*     LOCKRC FIXED(31) REG(15);     /* RETURN CODE FROM SETLOCK      */
*   DCL                                                            1672
*     GMREG FIXED(31) REG(3);       /* PARMS FOR GETMAIN             */
*   DCL                                                            1673
*     1 LGTHTBL BASED(CVTWSAC),     /* CPU SA/WA SIZES               */
*     (2 NUM,                       /* NUMBER OF ENTRIES             */
*      2 LGTH,                      /* VECTOR TBL + SAVEAREAS        */
*      2 FSIZE) FIXED(15);          /* SIZE OF FIRST SA/WA           */
*   DCL                                                            1674
*     SVPTR BASED(P) PTR(31);       /* VECTOR TABLE                  */
*   DCL                                                            1675
*     P PTR(31);                    /* POINT TO VECTOR ENTRIES       */
*   DCL                                                            1676
*     SAPTR PTR(31);                /* PTR TO SAVEAREAS              */
*   DCL                                                            1677
*     NSIZEPTR PTR(31);             /* POINTER TO SIZE ENTRIES       */
*   DCL                                                            1678
*     1 GMTBL FIXED(31),            /* GET/FREEMAIN PARMS            */
*     (2 RSVD,                      /* RESERVED BYTE                 */
*      2 STKEY,                     /* STORAGE PROTECT KEY           */
*      2 SBPOOL,                    /* SUBPOOL REQUESTED             */
*      2 FLAGS) FIXED(8);           /* TYPE OF GET/FREEMAIN          */
*   DCL                                                            1679
*     HOLDRC FIXED(31);             /* RETAINER OF RETURN CODE       */
*   DCL                                                            1680
*     CDGM FIXED(8) CONSTANT(0);    /* X'00' INDICATOR OF CONDITIONAL
*                                      GETMAIN                       */
*   DCL                                                            1681
*     CDFM FIXED(8) CONSTANT(1);    /* X'01' INDICATOR OF CONDITIONAL
*                                      FREEMAIN                      */
*   DCL                                                            1682
*     LUPONE FIXED(8) CONSTANT(1);  /* LOOP CONTROL CONSTANT         */
*   DCL                                                            1683
*     ZZERO FIXED(8) CONSTANT(0);   /* ZERO RETURN CODE              */
*   DCL                                                            1684
*     FFOUR FIXED(8) CONSTANT(4);   /* RETURN CODE FOUR              */
*   DCL                                                            1685
*     SQAPOOL FIXED(8) CONSTANT(245);/* SUBPOOL 245                  */
*   DCL                                                            1686
*     KEYZERO FIXED(8) CONSTANT(0); /* KEY                           */
*   DCL                                                            1687
*     INCSIZE FIXED(8) CONSTANT(2); /* INCREMENT VALUE               */
*   DCL                                                            1688
*     GETID FIXED(8) CONSTANT(0);   /* R1=0 ON GETMAIN REQUEST       */
*   DCL                                                            1689
*     LOOP FIXED(31);               /* LOOP INDEX                    */
*   DCL                                                            1690
*     R3SAVAR PTR(31);              /* SAVE AREA FOR REG. 3 ACROSS 1690
*                                      GET/FREEMAIN'S                */
*   DCL                                                            1691
*     SAVAREA PTR(31);              /* SAVE AREA FOR POINTER TO    1691
*                                      REGISTER SAVE AREAS           */
*   DCL                                                            1692
*     1 SETLOKSA BDY(WORD),         /* SETLOCK REG. SAVE AREA        */
*      2 * FIXED(31),               /* SAVE AREA FOR REG. 11         */
*      2 * FIXED(31),               /* SAVE AREA FOR REG. 12         */
*      2 * FIXED(31),               /* SAVE AREA FOR REG. 13         */
*      2 * FIXED(31),               /* SAVE AREA FOR REG. 14         */
*      2 * FIXED(31);               /* FIFTH WORD OF SAVE AREA       */
*   DCL                                                            1693
*     NWSASIZE FIXED(15) BASED(NSIZEPTR);                          1693
*   DCL                                                            1694
*     1 NP0FMTWS FIXED(15),         /* FLAGS USED BY IEAVSPSA      1694
*                                                            @OZ05329*/
*      2 FRMTONLY BIT(1);           /* FORMAT ONLY - NO GETMAIN    1694
*                                                            @OZ05329*/
*   RFY                                                            1695
*    (PARM,                                                        1695
*     RTCODE) RSTD;                 /* THESE REG'S ARE RSTD THRUOUT
*                                      THIS MODULE                   */
*                                                                  1695
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR FORMAT REQUEST                              @OZ05329*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1696
*   IF PARMX<0 THEN                 /* REGISTER NEGATIVE     @ZM30488*/
         LTR   PARMX,PARMX                                         1696
         BNM   @RF01696                                            1696
*     DO;                                                          1697
*       TBLPTR=-PARMX;              /* CORRECT ADDRESS       @ZM30488*/
         LCR   @14,PARMX                                           1698
         LR    TBLPTR,@14                                          1698
*       FRMTONLY='1'B;              /* INDICATE FORMAT REQUEST     1699
*                                                            @OZ05329*/
         OI    FRMTONLY,B'10000000'                                1699
*       GOTO WSTFORMT;              /* GO FORMAT TABLE       @ZM30488*/
         B     WSTFORMT                                            1700
*     END;                                                         1701
*   RFY                                                            1702
*    (REGSAPTR,                                                    1702
*     LOCKRC) RSTD;                                                1702
@RF01696 DS    0H                                                  1703
*   SAVAREA=REGSAPTR;               /* PRESERVE REG. 13              */
         LR    SAVAREA,REGSAPTR                                    1703
*   REGSAPTR=ADDR(SETLOKSA);        /* PUT ADDR. OF 5 WORD SAVE AREA
*                                      FOR SETLOCK IN REG. 13        */
         LA    REGSAPTR,SETLOKSA                                   1704
*/* TRY TO GET SALLOC LOCK, MAKE SETLOCK SAVE REG'S 11-14 IN SAVE    */
*/* AREA POINTED TO BY REG. 13,  RETURN CODE WILL BE IN REG. 15      */
*                                                                  1705
*GLOCK:                                                            1705
*   GEN REFS(FLC,PSALITA);                                         1705
GLOCK    DS    0H                                                  1705
         SETLOCK   OBTAIN,TYPE=SALLOC,MODE=UNCOND,REGS=SAVE,          XX
               RELATED=('SALLOC LOCK, THIS SETLOCK IS ISSUED IN THIS  XX
               MACRO WHICH IS INCLUDED IN VARIOUS MODULES, THE LOCK   XX
               IS RELEASED AT THE LABEL: FLOCK, IN THIS MACRO')
*   REGSAPTR=SAVAREA;               /* RESTORE REGISTER 13           */
         LR    REGSAPTR,SAVAREA                                    1706
*   RFY                                                            1707
*    (REGSAPTR) UNRSTD;                                            1707
*   RFY                                                            1708
*    (LNGREG) RSTD;                                                1708
*   IF LOCKRC=ZZERO×LOCKRC=FFOUR THEN/* WAS LOCK SET?                */
         LTR   LOCKRC,LOCKRC                                       1709
         BZ    @RT01709                                            1709
         CH    LOCKRC,@CH00076                                     1709
         BNE   @RF01709                                            1709
@RT01709 DS    0H                                                  1710
*LOCKSET:                                                          1710
*     DO;                           /* YES PROCEED FOR GM/FM         */
LOCKSET  DS    0H                                                  1711
*       RFY                                                        1711
*        (LOCKRC) UNRSTD;                                          1711
*       LNGREG=LGTH                 /* LENGTH IN REGISTER 0          */
*           *8;                     /* LENGTH IN TABLE IS NUMBER OF
*                                      DOUBLE WORDS                  */
         L     @14,CVTPTR                                          1712
         L     @14,CVTWSAC(,@14)                                   1712
         LH    LNGREG,LGTH(,@14)                                   1712
         SLA   LNGREG,3                                            1712
*       SBPOOL=SQAPOOL;             /* PUT SUBPOOL IN TABLE          */
         MVI   SBPOOL,X'F5'                                        1713
*       STKEY=KEYZERO;              /* PROTECT KEY REQUESTED         */
         MVI   STKEY,X'00'                                         1714
*       IF PARM=GETID THEN          /* GETMAIN OR FREEMAIN           */
         LTR   PARM,PARM                                           1715
         BNZ   @RF01715                                            1715
*/********************************************************************/
*/*                                                                  */
*/*                   GETMAIN PATH                                   */
*/*  REGISTER ONE CONTAINS ZERO ON INPUT FOR A GETMAIN REQUEST.      */
*/*  IF R1 IS ZERO, THEN SPACE IS OBTAINED FOR A SA/WA AND VECTOR    */
*/*  TABLE.  AFTER A SUCCESSFUL RETURN FROM GETMAIN, THE TABLE       */
*/*  IS INITIALIZED.                                                 */
*/*                                                                  */
*/********************************************************************/
*                                                                  1716
*GMAIN:                                                            1716
*         DO;                       /* GETMAIN PATH                  */
GMAIN    DS    0H                                                  1717
*           FLAGS=CDGM;             /* CONDITIONAL GETMAIN           */
         MVI   FLAGS,X'00'                                         1717
*           RFY                                                    1718
*            (GMREG,                                               1718
*             TBLPTR) RSTD;                                        1718
*           R3SAVAR=GMREG;          /* SAVE CONTENTS OF REG. 3       */
         LR    R3SAVAR,GMREG                                       1719
*           GMREG=GMTBL;            /* PARMS IN REG. 3               */
         L     GMREG,GMTBL                                         1720
*/* GETMAIN VECTOR TABLE AND SAVEAREAS FROM SUBPOOL 245              */
*                                                                  1721
*SGTWSA:                                                           1721
*           GEN REFS(CVTSPSA,CVTGLMN,CVTPTR,CVTMAP,WSAGGMFM,WSAG); 1721
SGTWSA   DS    0H                                                  1721
         GETMAIN RC,LV=(0),BRANCH=(YES,GLOBAL),KEY=(3),SP=(3),        XX
               RELATED=('SUPERVISOR ROUTINE WORK/SAVE AREAS FOR A CPU.XX
               THIS GETMAIN IS ISSUED IN THIS MACRO WHICH IS INCLUDED XX
               IN VARIOUS MODULES.  THE CORRESPONDING FREEMAIN IS AT  XX
               LABEL: SFRWSA, IN THIS MACRO')
*           GMREG=R3SAVAR;          /* RESTORE REG. 3, BRANCH ENTRY
*                                      TO GETMAIN DESTROYS REG. 3    */
         LR    GMREG,R3SAVAR                                       1722
*           IF RTCODE^=ZZERO        /* ERROR IN GETMAIN              */
*             THEN                  /* YES                           */
         LTR   RTCODE,RTCODE                                       1723
         BZ    @RF01723                                            1723
*             HOLDRC=FFOUR;         /* RETAIN RETURN CODE            */
         LA    HOLDRC,4                                            1724
*           ELSE                                                   1725
*WSTFORMT:                                                         1725
*             DO;                   /* INITIALIZE VECTOR TABLE     1725
*                                                            @ZM30488*/
         B     @RC01723                                            1725
@RF01723 DS    0H                                                  1725
WSTFORMT DS    0H                                                  1726
*               HOLDRC=ZZERO;       /* RETAIN RETURN CODE            */
         SLR   HOLDRC,HOLDRC                                       1726
*               P=TBLPTR;           /* POINT TO START OF TABLE       */
         LR    P,TBLPTR                                            1727
*               SAPTR=TBLPTR+(NUM*FFOUR);/* GET PTR TO SAVEAREAS     */
         L     @14,CVTPTR                                          1728
         L     @14,CVTWSAC(,@14)                                   1728
         LH    SAPTR,NUM(,@14)                                     1728
         SLA   SAPTR,2                                             1728
         ALR   SAPTR,TBLPTR                                        1728
*/* ROUND ADDR. OF FIRST WORK/SAVE AREA UP TO AN 8-BYTE MULT.  ALL   */
*/* WORK/SAVE AREAS MUST BEGIN ON DOUBLE WORD BOUNDARIES.  ALL WORK/ */
*/* SAVE AREAS ARE MULTIPLES OF 8 BYTES IN SIZE.  THUS IF THE FIRST  */
*/* WORK/SAVE AREA IS ON A DOUBLE WORD BOUNDARY, THEY ALL WILL BE.   */
*                                                                  1729
*               SAPTR=((SAPTR+7)×7)&&7;                            1729
         LA    @06,7                                               1729
         LR    @04,SAPTR                                           1729
         ALR   @04,@06                                             1729
         OR    @04,@06                                             1729
         XR    @04,@06                                             1729
         LR    SAPTR,@04                                           1729
*               RFY                                                1730
*                (TBLPTR) UNRSTD;                                  1730
*               NSIZEPTR=ADDR(FSIZE);/* PICK UP ADDR. OF FIELD     1731
*                                      CONTAINING FIRST WORK/SAVE  1731
*                                      AREA SIZE                     */
         LA    @14,FSIZE(,@14)                                     1731
         ST    @14,NSIZEPTR                                        1731
*INTZE:                                                            1732
*               DO LOOP=LUPONE TO NUM;/* DO FOR EACH ENTRY IN VECTOR
*                                      TABLE                         */
INTZE    LA    @14,1                                               1732
         B     @DE01732                                            1732
@DL01732 DS    0H                                                  1733
*                 SVPTR=SAPTR;      /* SET PTR TO SAVEAREA           */
         ST    SAPTR,SVPTR(,P)                                     1733
*                 SAPTR=SAPTR+NWSASIZE;/* INCREMENT PTR BY SIZE OF 1734
*                                      SAVEAREA                      */
         L     @06,NSIZEPTR                                        1734
         AH    SAPTR,NWSASIZE(,@06)                                1734
*                 P=P+LENGTH(SVPTR);/* POINT TO NEXT VECTOR TABLE  1735
*                                      ENTRY                         */
         AH    P,@CH00076                                          1735
*                 NSIZEPTR=NSIZEPTR /* POINT TO NEXT SIZE            */
*                     +LENGTH(NWSASIZE);                           1736
         AL    @06,@CF00177                                        1736
         ST    @06,NSIZEPTR                                        1736
*               END INTZE;                                         1737
         AL    @14,@CF00067                                        1737
@DE01732 ST    @14,LOOP                                            1737
         L     @06,CVTPTR                                          1737
         L     @06,CVTWSAC(,@06)                                   1737
         CH    @14,NUM(,@06)                                       1737
         BNH   @DL01732                                            1737
*             END;                  /* END PROCESSING FROM SUCCESSFUL
*                                      GETMAIN                       */
*         END GMAIN;                                               1739
*       ELSE                                                       1740
*                                                                  1740
*/********************************************************************/
*/*                                                                  */
*/*                  FREEMAIN PATH                                   */
*/*  REGISTER ONE CONTAINS THE ADDRESS OF THE AREA TO BE FREE'D.     */
*/*  THIS REQUEST IS ONLY FROM VARY CPU OFFLINE, OR IEAVNIP0         */
*/*                                                                  */
*/********************************************************************/
*                                                                  1740
*FMAIN:                                                            1740
*         DO;                       /* FREEMAIN PATH                 */
         B     @RC01715                                            1740
@RF01715 DS    0H                                                  1740
FMAIN    DS    0H                                                  1741
*           RFY                                                    1741
*            (GMREG,                                               1741
*             LNGREG) RSTD;                                        1741
*           FLAGS=CDFM;             /* CONDITIONAL FREEMAIN          */
         MVI   FLAGS,X'01'                                         1742
*           R3SAVAR=GMREG;          /* PRESERVE CONTENTS OF REG. 3   */
         LR    R3SAVAR,GMREG                                       1743
*           GMREG=GMTBL;            /* PARMS IN REG. 3               */
*                                                                  1744
         L     GMREG,GMTBL                                         1744
*           /*********************************************************/
*           /*                                                       */
*           /* FREEMAIN AREA PROVIDED BY CALLER (VARY CPU OFFLINE OR */
*           /* NIP)                                                  */
*           /*                                                       */
*           /*********************************************************/
*                                                                  1745
*SFRWSA:                                                           1745
*           GEN REFS(CVTSPSA,CVTGLMN,CVTPTR,CVTMAP,WSAGGMFM,WSAG); 1745
SFRWSA   DS    0H                                                  1745
         FREEMAIN      RC,LV=(0),BRANCH=(YES,GLOBAL),                 XX
               KEY=(3),A=(1),SP=(3),                                  XX
               RELATED=('SUPERVISOR ROUTINE WORK/SAVE AREAS FOR A CPU.XX
               THIS FREEMAIN IS ISSUED IN THIS MACRO WHICH IS INCLUDEDXX
               IN VARIOUS MODULES.  THE CORRESPONDING GETMAIN IS AT   XX
               LABEL: SGTWSA, IN THIS MACRO')
*           GMREG=R3SAVAR;          /* RESTORE REG. 3, BRANCH ENTRY
*                                      TO FREEMAIN DESTROYS REG. 3   */
         LR    GMREG,R3SAVAR                                       1746
*           IF RTCODE^=ZZERO        /* ERROR                         */
*             THEN                  /* YES                           */
         LTR   RTCODE,RTCODE                                       1747
         BZ    @RF01747                                            1747
*             HOLDRC=FFOUR;         /* SET RETURN CODE               */
         LA    HOLDRC,4                                            1748
*           ELSE                                                   1749
*             HOLDRC=ZZERO;         /* SAVE 0 RETURN CODE            */
         B     @RC01747                                            1749
@RF01747 SLR   HOLDRC,HOLDRC                                       1749
*           RFY                                                    1750
*            (LNGREG,                                              1750
*             TBLPTR) UNRSTD;                                      1750
@RC01747 DS    0H                                                  1751
*           PARM=ZZERO;             /* INDICATOR FOR FREEMAIN        */
         SLR   PARM,PARM                                           1751
*         END FMAIN;                                               1752
*       IF FRMTONLY='0'B THEN       /* RELEASE LOCK IF NECESSARY   1753
*                                                            @OZ05329*/
@RC01715 TM    FRMTONLY,B'10000000'                                1753
         BNZ   @RF01753                                            1753
*         DO;                                                      1754
*           RFY                                                    1755
*            (LOCKRC,                                              1755
*             REGSAPTR) RSTD;                                      1755
*           SAVAREA=REGSAPTR;       /* PRESERVE REGISTER 13          */
         LR    SAVAREA,REGSAPTR                                    1756
*           REGSAPTR=ADDR(SETLOKSA);/* PUT ADDR. OF 5 WORD SAVE AREA
*                                      FOR SETLOCK IN REG. 13        */
         LA    REGSAPTR,SETLOKSA                                   1757
*/* RELEASE SALLOC LOCK, MAKE SETLOCK SAVE REG'S 11-14 IN SAVE AREA  */
*/* POINTED TO BY REG. 13, RETURN CODE WILL BE IN REG. 15            */
*                                                                  1758
*FLOCK:                                                            1758
*           GEN REFS(FLC,PSALITA);                                 1758
FLOCK    DS    0H                                                  1758
         SETLOCK RELEASE,TYPE=SALLOC,REGS=SAVE,                       **
               RELATED=('SALLOC LOCK, THIS SETLOCK IS ISSUED IN THIS  XX
               MACRO WHICH IS INCLUDED IN VARIOUS MODULES, THE LOCK   XX
               IS OBTAINED AT THE LABEL: GLOCK, IN THIS MACRO')
*           REGSAPTR=SAVAREA;       /* RESTORE REGISTER 13           */
         LR    REGSAPTR,SAVAREA                                    1759
*           RFY                                                    1760
*            (REGSAPTR) UNRSTD;                                    1760
*           IF(LOCKRC=ZZERO)×(LOCKRC=FFOUR)/* LOCK NOT RELEASED?     */
*             THEN                                                 1761
         LTR   LOCKRC,LOCKRC                                       1761
         BZ    @RT01761                                            1761
         CH    LOCKRC,@CH00076                                     1761
         BNE   @RF01761                                            1761
@RT01761 DS    0H                                                  1762
*             RTCODE=HOLDRC;        /* RETURN CODE INDICATOR         */
         LR    RTCODE,HOLDRC                                       1762
*           ELSE                                                   1763
*             RTCODE=FFOUR;         /* 0 RETURN FROM SETLOCK SET   1763
*                                      RETURN CODE TO THAT FROM    1763
*                                      GET/FREEMAIN                  */
         B     @RC01761                                            1763
@RF01761 LA    RTCODE,4                                            1763
*           RFY                                                    1764
*            (LOCKRC) UNRSTD;                                      1764
@RC01761 DS    0H                                                  1765
*         END;                                                     1765
*       ELSE                        /* TURN FORMAT INDICATOR OFF     */
*         FRMTONLY='0'B;            /* CLEAR INDICATOR               */
         B     @RC01753                                            1766
@RF01753 NI    FRMTONLY,B'01111111'                                1766
*     END LOCKSET;                                                 1767
*   ELSE                            /* SETLOCK ERROR                 */
*     RTCODE=FFOUR;                 /* RETURN CODE INDICATOR         */
         B     @RC01709                                            1768
@RF01709 LA    RTCODE,4                                            1768
*   RFY                                                            1769
*    (PARM,                                                        1769
*     RTCODE) UNRSTD;                                              1769
*                                                                  1770
*/*IEAVSPSA: CHART (AMODE,SEQ,IBM68,AREF)                            */
*/*IEAVSPSA: E ENTER                                                 */
*/* N ON ENTRY IF REG. 1 IS ZERO, THE REQUEST IS TO ALLOCATE         */
*/* N A CPU RELATED WORK/SAVE AREA.  IF REG. 1 IS NON-ZERO,          */
*/* N THE REQUEST IS TO FREE A CPU RELATED WORK/SAVE AREA AND THE    */
*/* N VIRT. ADDRESS OF THE AREA TO BE FREED IS IN REG. 1             */
*/* P SAVE REGS EXCEPT REG. 1 AND REG. 15                            */
*/* P SAVE REGISTER 13                                               */
*/* P PUT ADDR. OF 5 WORD SAVEAREA FOR SETLOCK IN REG. 13            */
*/* L SETLOCK TO OBTAIN 'SALLOC' LOCK                                */
*/* P RESTORE REG. 13                                                */
*/* D (YES,,NO,P2A1) WAS LOCK OBTAINED ?                             */
*/* P PUT SIZE OF AREA TO BE GOTTEN/FREED IN REG. 0                  */
*/* P INDICATE SUBPOOL 245 AND KEY 0 IN GET/FREEMAIN WORKAREA        */
*/* D (YES,,NO,FMAIN) IS THIS A GETMAIN REQUEST ?                    */
*/*GMAIN: P SET FLAGS IN GETMAIN WORKAREA FOR CONDITIONAL GETMAIN    */
*/* P SAVE CONTENTS OF REGISTER 3                                    */
*/* N BRANCH ENTRY TO GET/FREEMAIN DESTROYS REG. 3                   */
*/* P PUT GETMAIN PARAMETERS IN REG. 3                               */
*/*SGTWSA: L BRANCH TO GETMAIN TO ALLOC. WORK/SAVE AREA              */
*/* N VIRT. ADDR. OF GOTTEN AREA IS IN REG. 1                        */
*/* P RESTORE CONTENTS OF REGISTER 3                                 */
*/* D (YES,,NO,P2A2) GETMAIN SUCCESSFUL ?                            */
*/* P SET UP A CODE OF ZERO, TO BE RETURNED BY THIS MODULE           */
*/* P CALC. VIRT. ADDR. OF FIRST SAVEAREA IN THE GOTTEN SPACE        */
*/* P ROUND THIS ADDR. UP TO A DOUBLE WORD BOUNDARY                  */
*/* P PICK UP ADDR. OF FIELD CONTAINING FIRST WORK/SAVE AREA SIZE    */
*/* P PICK UP NUMBER OF SAVE AREAS TO BE BUILT                       */
*/* P INITIALIZE A COUNTER OF SAVE AREAS BUILT TO 1                  */
*/*INTZE: D (YES,P2B1,NO,) ALL SAVE AREAS BUILT ?                    */
*/* P SET CURR. VECTOR TABLE ENTRY TO POINT TO CURR. SAVE AREA       */
*/* P UPDATE POINTER TO NEXT SAVE AREA                               */
*/* P UPDATE POINTER TO NEXT VECTOR TABLE ENTRY                      */
*/* P (,INTZE) INCREMENT COUNTER BY 1                                */
*/*P2A1: P SET UP A CODE OF 4, TO BE RETURNED BY THIS MODULE         */
*/* P (,P2J5) PUT RETURN CODE FOR THIS MODULE IN REG. 15             */
*/*P2A2: P (,P2B1) SET UP A CODE OF 4, TO BE RETURNED BY THIS MODULE */
*/*FMAIN: P SET FLAGS IN FREEMAIN WORKAREA FOR CONDITIONAL FREEMAIN  */
*/* P SAVE CONTENTS OF REGISTER 3                                    */
*/* N BRANCH ENTRY TO GET/FREEMAIN DESTROYS REG. 3                   */
*/* P PUT FREEMAIN PARAMETERS IN REG. 3                              */
*/* N REG. 1 ALREADY CONTAINS THE VIRT. ADDR. OF AREA TO BE FREED    */
*/*SFRWSA: L BRANCH TO FREEMAIN TO FREE WORK/SAVE AREA               */
*/* P RESTORE CONTENTS OF REGISTER 3                                 */
*/* D (YES,,NO,P2A3) FREEMAIN SUCCESSFUL ?                           */
*/* P SET UP A CODE OF 0, TO BE RETURNED BY THIS MODULE              */
*/*P2B1: P SAVE REG. 13                                              */
*/* P PUT ADDR. OF 5 WORD SAVEAREA FOR SETLOCK IN REG. 13            */
*/*FLOCK: L SETLOCK TO RELEASE 'SALLOC' LOCK                         */
*/* P RESTORE REG. 13                                                */
*/* D (YES,,NO,P2A4) WAS LOCK RELEASED ?                             */
*/* P PUT RETURN CODE FOR THIS MODULE IN REG. 15                     */
*/*P2J5: P RESTORE REGS EXCEPT REG. 1 AND REG. 15                    */
*/* R RETURN TO CALLER                                               */
*/*P2A3: P (,P2B1) SET UP A CODE OF 4, TO BE RETURNED BY THIS MODULE */
*/*P2A4: P (,P2J5) SET RETURN CODE FOR THIS MODULE (REG. 15) TO 4    */
*/*IEAVSPSA: END                                                     */
*                                                                  1770
*   END IEAVSPSA;                                                  1770
*                                                                  1770
@EL00020 DS    0H                                                  1770
@EF00020 DS    0H                                                  1770
@ER00020 L     @14,12(,@13)                                        1770
         L     @00,20(,@13)                                        1770
         LM    @02,@12,28(@13)                                     1770
         BR    @14                                                 1770
*/* ******************************************************************/
*/*             IEAVTSIN-------PROLOGUE                              */
*/*                                                                  */
*/*  MODULE NAME-IEAVTSIN                                            */
*/*  DESCRIPTIVE NAME-FRR STACK INITIALIZATION INTERNAL PROCEDURE    */
*/*  LOAD MODULE NAME - IEAVNIP0                                     */
*/*  COPYRIGHT - N/A                                                 */
*/*  STATUS - NEW FOR OS/VS2 RELEASE 2                               */
*/*                                                                  */
*/*  FUNCTION - INITIALIZES THE FRR                                  */
*/*             STACKS DURING SYSTEM INITIALIZATION(NIP) AND FOR     */
*/*             VARY CPU(ONLINE), SO THAT SETFRR RECOVERY CAN BE     */
*/*             DEFINED.  THE FRR STACK INITIALIZATION IS IN TWO     */
*/*             PARTS:                                               */
*/*             1. INSURING THAT THE FRR STACKS ARE ADDRESSABLE OUT  */
*/*                OF THE PSA.                                       */
*/*             2. INITIALIZING EACH FRR STACK SO THAT THE SETFRR    */
*/*                MACRO WILL OPERATE PROPERLY.                      */
*/*                                                                  */
*/*       I. THE RECOVERY STACK VECTOR TABLE(RSVT) IN THE PSA        */
*/*          IS  INITIALIZED TO POINT TO THE RESPECTIVE FRR STACKS   */
*/*          PSACSTK - POINTS TO THE CURRENT FRR STACK AND IS        */
*/*                    INITIALIZED TO POINT TO THE NORMAL            */
*/*                    FRR STACK                                     */
*/*          PSASSTK - INITIALIZED TO POINT TO THE SVC-I/O-DISPATCHER*/
*/*                    FRR STACK                                     */
*/*          PSANSTK - INITIALIZED TO POINT TO THE NORMAL FRR STACK  */
*/*                                                                  */
*/*          PSAMSTK - INITIALIZED TO POINT TO THE MACHINE           */
*/*                     CHECK FRR STACK                              */
*/*          PSAPSTK - INITIALIZED TO POINT TO THE PROGRAM  CHECK    */
*/*                     FRR STACK                                    */
*/*          PSAESTK1 - INITIALIZED TO POINT TO THE EXTERNAL FLIH    */
*/*                     FRR STACK(NON-RECURSIVE ENTRIES)             */
*/*          PSAESTK2 - INITIALIZED TO POINT TO THE EXTERNAL FLIH    */
*/*                     FRR STACK(FIRST LEVEL RECURSIONS)            */
*/*          PSAESTK3 - INITIALIZED TO POINT TO THE EXTERNAL FLIH    */
*/*                     FRR STACK(SECOND LEVEL RECURSIONS)           */
*/*          PSARSTK - INITIALIZED TO POINT TO THE RESTART FLIH      */
*/*                    FRR STACK                                     */
*/*       II. THE SUPERVISOR CONTROL FRR STACK(S) INITIALIZATION     */
*/*           IS PERFORMED AS FOLLOWS:                               */
*/*           A. THE ENTIRE STACK IS ZEROED                          */
*/*           B. THE STACK HEADER(4 WORDS) IS INITIALIZED TO APPEAR  */
*/*              AS FOLLOWS:                                         */
*/*              1ST WORD -POINTS TO THE FIRST FRR ENTRY IN THE STACK*/
*/*              2ND WORD-POINTS TO THE LAST FRR ENTRY IN THE STACK  */
*/*              3RD WORD-CONTAINS THE LENGTH OF EACH FRR ENTRY      */
*/*              4TH WORD-CONTAINS THE SAME POINTER AS THE 1ST WORD  */
*/*           C. THE FIRST STACK ENTRY IS INITALIZED TO POINT TO THE */
*/*              SUPERVISOR CONTROL FRR(IEAVSCRU)                    */
*/*              CVTSPFRR FIELD OF THE CVT CONTAINS THE ADDRESS OF   */
*/*              THE SUPER FRR                                       */
*/*                                                                  */
*/*       III. THE NORMAL FRR STACK INITIALIZATION IS PERFORMED AS   */
*/*            FOLLOWS:                                              */
*/*           A. THE ENTIRE FRR STACK IS ZEROED                      */
*/*           B. THE STACK HEADER(4 WORDS) IS INITIALIZED AS FOLLOWS */
*/*              1ST WORD-CONTAINS THE ADDRESS OF THE FIRST FRR ENTRY*/
*/*                       MINUS 32 BYTES                             */
*/*              2ND WORD-CONTAINS THE ADDRESS OF THE LAST FRR ENTRY */
*/*                       IN THE STACK                               */
*/*              3RD WORD-CONTAINS THE LENGTH VALUE OF AN FRR ENTRY  */
*/*              4TH WORD-CONTAINS THE SAME POINTER AS THE 1ST WORD  */
*/*                                                                  */
*/*  NOTES                                                           */
*/*    CHARACTER CODE DEPENDENCIES - N/A                             */
*/*    RESTRICTIONS -1.CALLER MUST INCLUDE THE PSA,CVT,FRR STACK     */
*/*                (IHAFRRS) MAPPINGS AND INCLUDE THE IHAYSTAK MACRO */
*/*                      PRIOR TO CALLING IEAVTSIN                   */
*/*                     PRIOR TO INCLUDING IHAYSTAK SET THE MACRO    */
*/*                     TIME VARIABLE %STKLENS='YES'                 */
*/*                     THE PSA MAPPING MUST BE BASED ON PSAPTR      */
*/*                  2. IEAVTSIN IS AN INTERNAL PROCEDURE IN IEAVNIP0*/
*/*                      AND VARY CPU(ONLINE)                        */
*/*                    AS SUCH IEAVTSIN ASSUMES ITS CALLERS          */
*/*                     ATTRIBUTES AND DECLARATIONS                  */
*/*                  3. ON EXIT FROM IEAVTSIN THE PSA IS RESTORED TO */
*/*                    BASING THAT EXISTED WHEN THE PSA WAS DECLARED */
*/*                    IN THE CALLERS PROCEDURE                      */
*/*                                                                  */
*/*  MODULE TYPE                                                     */
*/*    PROCESSOR   - PLS2                                            */
*/*    MODULE SIZE   - 300 BYTES                                     */
*/*    ATTRIBUTES -     REENTRANT,DISABLED WITH DAT ACTIVE,KEY0      */
*/*                                                                  */
*/*  ENTRY POINT - IEAVTSIN                                          */
*/*    PURPOSE - ENTRY BY NIP0 AND VARY CPU(ONLINE) SO THAT THE FRR  */
*/*              STACKS CAN BE INITIALIZED                           */
*/*    LINKAGE - STANDARD REGISTER LINKAGE                           */
*/*              CALLERS REGISTERS ARE SAVED ON ENTRY AND RESTORED   */
*/*              ON EXIT FROM IEAVTSIN                               */
*/*    INPUT DATA - REGISTER 1 POINTS TO THE PSA TO BE INITIALIZED   */
*/*                 REGISTER 13 POINTS TO A 72 BYTE REGISTER SAVE    */
*/*                 AREA                                             */
*/*                 IT IS ASSUMED BY IEAVTSIN THAT PSACSTK IS        */
*/*                 INITIALIZED TO POINT TO A PREVIOUSLY ALLOCATED   */
*/*                 AREA                                             */
*/*                 8300 BYTES IN LENGTH TO CONTAIN THE FRR          */
*/*                 STACKS AND RTCAS                                 */
*/*    ENQ/LOCK CONDITIONS - ASSUMES THAT OF CALLING ROUTINE         */
*/*    REGISTERS SAVED - ALL                                         */
*/*    STATIC REGS - REGISTER 1 WILL ALWAYS POINT TO THE PSA TO BE   */
*/*                  INITIALIZED                                     */
*/*    REGISTERS RESTORED - ALL                                      */
*/*                                                                  */
*/*  EXIT - NORMAL                                                   */
*/*    CONDITIONS - STANDARD RETURN LINKAGE                          */
*/*    OUTPUT DATA - RSVT,FRR STACKS AND GLOBAL RTCAS ARE INITIALIZED*/
*/*    ENQ/LOCK CONDITIONS - SAME AS ON ENTRY                        */
*/*    RETURN CODES - NONE                                           */
*/*                                                                  */
*/*  EXIT ERROR - NONE                                               */
*/*                                                                  */
*/*  EXTERNAL REFERENCES                                             */
*/*    ROUTINES - NONE                                               */
*/*    DATASETS - NONE                                               */
*/*    DATA AREAS -PSA,CVT,FRR STACKS,VECTOR TABLE OF LENGTHS OF     */
*/*               FRR STACKS(MAPPED BY IHAYSTAK)                     */
*/*    CONTROL BLOCKS - NONE                                         */
*/*    TABLES - NONE                                                 */
*/*    MACROS - NONE                                                 */
*/*                                                                  */
*/*  MAPPING MACROS USED - NONE                                      */
*/*                                                                  */
*/*  MESSAGES - NONE                                                 */
*/*                                                                  */
*/* ******************************************************************/
*/*                                                                  */
*/*                                                                  */
*                                                                  1771
*IEAVTSIN:                                                         1771
*   PROC OPTIONS(SAVE,NOSAVEAREA);                                 1771
*                                                                  1771
IEAVTSIN STM   @14,@12,12(@13)                                     1771
*/*                                                                  */
*                                                                  1772
*   DECLARE                                                        1772
*     1 STKADDR CHAR(4) BDY(WORD) DEF(PSACSTK),/* THE ADDRESS OF THE
*                                      STACK TO BE INITIALIZED       */
*      2 * BIT(29),                 /* RESERVED                      */
*      2 STKLW3BT BIT(3);           /* LOW ORDER 3 BITS OF THE FRR 1772
*                                      ADDRESS                       */
*   DECLARE                                                        1773
*     WORDLEN FIXED(31) CONSTANT(4);/* NUMBER OF BYTES IN A FULLWORD */
*   DECLARE                                                        1774
*     LOW3BITS BIT(3) CONSTANT('000'B);/* LOW ORDER 3 BITS OF A    1774
*                                      DOUBLE WORD ADDRESS           */
*   DECLARE                                                        1775
*     FRRWALEN PTR(8) CONSTANT(200);/* LENGTH OF FRR WORK AREA     1775
*                                      ASSOCIATED WITH EACH RTCA     */
*/*                                                                  */
*/*                                                                  */
*/* ******************************************************************/
*/*                                                                  */
*/*       DEFINE THE RTCA PORTION OF THE RECOVERY STACK              */
*/*       AREA                                                       */
*/*                                                                  */
*/* ******************************************************************/
*/*                                                                  */
*                                                                  1776
*   DCL                                                            1776
*     NGRTCA CHAR(584) BDY(DWORD)   /* THE GLOBAL RTCA               */
*         BASED(PSARSTK+FRRSFENT+(YSTAK(RSVTINDX)/* ASSOCIATED       */
*         *FRRSESZE)+LENGTH(GRTCA)+FRRWALEN);/* WITH THE NORMAL STACK*/
*   DCL                                                            1777
*     GRTCA CHAR(584) BDY(DWORD) BASED(PSACSTK+FRRSFENT+(YSTAK(RSVTINDX
*         )*FRRSESZE));             /* THE RTCA PORTION OF THE     1777
*                                      RECOVERY FRR STACK AREA       */
*/*                                                                  */
*/*                                                                  */
*                                                                  1778
*   DECLARE                                                        1778
*     RSVTINDX PTR(31) REG(2) RESTRICTED,/* INDEX USED WITH THE RSVT */
*     FRREINDX PTR(31) REG(3) RESTRICTED,/* INDEX USED WITH THE FRR
*                                      ENTRY                         */
*     PSAREG PTR(31) REG(1);        /* POINTER TO PSA TO BE        1778
*                                      INITIALIZED                   */
*/*                                                                  */
*/*                                                                  */
*/* ******************************************************************/
*/*                                                                  */
*/*   HOOK UP CONTROL BLOCKS                                         */
*/*                                                                  */
*/* ******************************************************************/
*/*                                                                  */
*                                                                  1779
*   RESPECIFY                                                      1779
*    (PSAREG) RESTRICTED;           /* RESTRICT REGISTER 1           */
*   RESPECIFY                                                      1780
*    (PSA) BASED(PSAREG);           /* PSA ORIGIN-REGISTER 1         */
*   RESPECIFY                                                      1781
*    (CVTMAP) BASED(FLCCVT);        /* CVT ORIGIN IN PSA             */
*   RESPECIFY                                                      1782
*    (FRRS) BASED(PSACSTK);         /* ORIGIN OF FRR STACKS IN PSA   */
*   RESPECIFY                                                      1783
*    (FRRSENTR) BASED(PSACSTK+((FRREINDX-YSTAKBEG)*FRRSESZE)+FRRSFENT);
*                                   /* ORIGIN OF RESPECTIVE FRR    1784
*                                      STACKS IN PSA                 */
*/*                                                                  */
*/* ******************************************************************/
*/*                                                                  */
*/*     FRR STACK HEADER AND RSVT INITIALIZATION                     */
*/*                                                                  */
*/* ******************************************************************/
*/*                                                                  */
*                                                                  1784
*   DO RSVTINDX=YSTAKBEG TO DIM(YSTAK);/* BEGIN INITIALIZATION       */
         LA    RSVTINDX,1                                          1784
@DL01784 DS    0H                                                  1785
*     IF RSVTINDX=DIM(YSTAK) THEN   /* CHECK FOR THE NORMAL STACK  1785
*                                      POINTS TO A NON DOUBLEWORD  1785
*                                      THEN LEAVE IT ALONE           */
         CH    RSVTINDX,@CH00036                                   1785
         BNE   @RF01785                                            1785
*       DO;                                                        1786
*         PSANSTK=ADDR(PSASTAK);    /* POINT TO NORMAL STACK OUT OF
*                                      THE PSA RSVT                  */
         LA    @12,PSASTAK(,PSAREG)                                1787
         ST    @12,PSANSTK(,PSAREG)                                1787
*         PSACSTK=PSANSTK;          /* MAKE NORMAL STAK CURRENT      */
         ST    @12,PSACSTK(,PSAREG)                                1788
*         FRRSEMP=(PSACSTK+FRRSFENT)-FRRSESZE;/* INITIALIZE EMPTY  1789
*                                      POINTER IN HEADER             */
         LR    @06,@12                                             1789
         SH    @06,@CH03999                                        1789
         ST    @06,FRRSEMP(,@12)                                   1789
*       END;                                                       1790
*     ELSE                          /* OTHERWISE DO THE FOLLOWING    */
*       DO;                         /* FOR SUPER FRR STACKS          */
         B     @RC01785                                            1791
@RF01785 DS    0H                                                  1792
*         IF STKLW3BT=LOW3BITS THEN /* IF THE FRR STACK ADDRESS    1792
*                                      POINTS TO A DOUBLE WORD THEN
*                                      IT MUST BE ALLIGNED TO A    1792
*                                      DOUBLE WORD                   */
         TM    STKLW3BT(PSAREG),B'00000111'                        1792
         BNZ   @RF01792                                            1792
*           PSACSTK=PSACSTK+WORDLEN;/* THE FRR STACK ADDRESS TO A NON
*                                      DOUBLEWORD                    */
         LA    @12,4                                               1793
         AL    @12,PSACSTK(,PSAREG)                                1793
         ST    @12,PSACSTK(,PSAREG)                                1793
*         ELSE                                                     1794
*           ;                       /* IF THE FRR STACK ADDRESS    1794
*                                      POINTS TO A NON DOUBLEWORD  1794
*                                      THEN LEAVE IT ALONE           */
@RF01792 DS    0H                                                  1795
*         PSARSVT(2*RSVTINDX+1)=PSACSTK;/* SET POINTER TO SUPER STACK
*                                      IN PSA RSVT                   */
         LR    @12,RSVTINDX                                        1795
         SLA   @12,3                                               1795
         L     @06,PSACSTK(,PSAREG)                                1795
         ST    @06,PSARSVT(@12,PSAREG)                             1795
*         PSARSVT(2*RSVTINDX+YSTAKTWO)=YSTAKZRO;/* ZERO THE POINTER
*                                      TO THE SAVED STACK IN PSA RSVT*/
         SLR   @06,@06                                             1796
         ST    @06,PSARSVT+4(@12,PSAREG)                           1796
*         FRRSEMP=PSACSTK+FRRSFENT; /* SET EMPTY STACK POINTER IN  1797
*                                      HEADER OF STACK               */
         L     @12,PSACSTK(,PSAREG)                                1797
         LA    @06,84                                              1797
         ALR   @06,@12                                             1797
         ST    @06,FRRSEMP(,@12)                                   1797
*       END;                                                       1798
*     FRRSCURR=FRRSEMP;             /* SET CURRENT STACK POINTER IN
*                                      STACK HEADER                  */
@RC01785 L     @12,PSACSTK(,PSAREG)                                1799
         MVC   FRRSCURR(4,@12),FRRSEMP(@12)                        1799
*     FRRSLAST=PSACSTK+FRRSFENT+((YSTAK(RSVTINDX)*FRRSESZE)-FRRSESZE);
         LA    @06,84                                              1800
         ALR   @06,@12                                             1800
         LA    @04,32                                              1800
         LR    @15,RSVTINDX                                        1800
         SLA   @15,2                                               1800
         L     @00,YSTAK-4(@15)                                    1800
         SLA   @00,5                                               1800
         SLR   @00,@04                                             1800
         ALR   @06,@00                                             1800
         ST    @06,FRRSLAST(,@12)                                  1800
*                                   /* SET POINTER TO LAST ENTRY IN
*                                      STACK                         */
*     FRRSELEN=FRRSESZE;            /* SET ENTRY LENGTH IN STACK   1801
*                                      HEADER                        */
         ST    @04,FRRSELEN(,@12)                                  1801
*     FRRSRTMW=''B;                 /* ZERO RTM1WA                   */
         XC    FRRSRTMW(68,@12),FRRSRTMW(@12)                      1802
*/*                                                                  */
*/* ******************************************************************/
*/*                                                                  */
*/*       INDIVIDUAL ENTRY INITIALIZATION FOR THE FRR STACK          */
*/*                                                                  */
*/* ******************************************************************/
*/*                                                                  */
*                                                                  1803
*     DO FRREINDX=YSTAKBEG TO YSTAK(RSVTINDX);/* INITIALIZE FRR    1803
*                                      ENTRIES                       */
         LA    FRREINDX,1                                          1803
         B     @DE01803                                            1803
@DL01803 DS    0H                                                  1804
*       FRRSENTR=''B;               /* ZERO THE ENTRY                */
         LR    @12,FRREINDX                                        1804
         BCTR  @12,0                                               1804
         SLA   @12,5                                               1804
         AL    @12,PSACSTK(,PSAREG)                                1804
         AH    @12,@CH02097                                        1804
         XC    FRRSENTR(32,@12),FRRSENTR(@12)                      1804
*       IF(RSVTINDX<DIM(YSTAK))&(FRREINDX=YSTAKBEG) THEN/* IF THIS IS
*                                      THE FIRST ENTRY IN A SUPER  1805
*                                      STACK DO FOLLOWING            */
         CH    RSVTINDX,@CH00036                                   1805
         BNL   @RF01805                                            1805
         CH    FRREINDX,@CH00067                                   1805
         BNE   @RF01805                                            1805
*         DO;                                                      1806
*           FRRSFRRA=CVTSPFRR;      /* INITIALIZE THE SUPER FRR    1807
*                                      ADDRESS                       */
         L     @06,FLCCVT(,PSAREG)                                 1807
         MVC   FRRSFRRA(4,@12),CVTSPFRR(@06)                       1807
*         END;                                                     1808
*       ELSE                                                       1809
*         ;                         /* OTHERWISE CONTINUE            */
@RF01805 DS    0H                                                  1810
*     END;                          /* CONTINUE IF MORE FRR ENTRIES
*                                      TO INITIALIZE                 */
*                                                                  1810
         AL    FRREINDX,@CF00067                                   1810
@DE01803 LR    @12,RSVTINDX                                        1810
         SLA   @12,2                                               1810
         C     FRREINDX,YSTAK-4(@12)                               1810
         BNH   @DL01803                                            1810
*     /***************************************************************/
*     /*                                                             */
*     /* ZERO RTCA ASSOCIATED WITH FRR STACK                         */
*     /*                                                             */
*     /***************************************************************/
*                                                                  1811
*     IF RSVTINDX<DIM(YSTAK) THEN   /* IF A SUPER STACK IS BEING   1811
*                                      INITIALIZED ZERO RTCA         */
         CH    RSVTINDX,@CH00036                                   1811
         BNL   @RF01811                                            1811
*       DO;                                                        1812
*         GRTCA(1:256)=''B;                                        1813
         LA    @12,84                                              1813
         AL    @12,PSACSTK(,PSAREG)                                1813
         LR    @06,RSVTINDX                                        1813
         SLA   @06,2                                               1813
         L     @06,YSTAK-4(@06)                                    1813
         SLA   @06,5                                               1813
         ALR   @12,@06                                             1813
         XC    GRTCA(256,@12),GRTCA(@12)                           1813
*         GRTCA((256+1):(256+256))=''B;                            1814
         XC    GRTCA+256(256,@12),GRTCA+256(@12)                   1814
*         GRTCA((256+256+1):LENGTH(GRTCA))=''B;                    1815
         XC    GRTCA+512(72,@12),GRTCA+512(@12)                    1815
*       END;                                                       1816
*     ELSE                          /* IF THE NORMAL STACK IS BEING
*                                      INITIALIZED ZERO ITS RTCA     */
*       DO;                                                        1817
         B     @RC01811                                            1817
@RF01811 DS    0H                                                  1818
*         NGRTCA(1:256)=''B;                                       1818
         LA    @12,84                                              1818
         AL    @12,PSARSTK(,PSAREG)                                1818
         LR    @06,RSVTINDX                                        1818
         SLA   @06,2                                               1818
         L     @06,YSTAK-4(@06)                                    1818
         SLA   @06,5                                               1818
         ALR   @12,@06                                             1818
         AH    @12,@CH04002                                        1818
         XC    NGRTCA(256,@12),NGRTCA(@12)                         1818
*         NGRTCA((256+1):(256+256))=''B;                           1819
         XC    NGRTCA+256(256,@12),NGRTCA+256(@12)                 1819
*         NGRTCA((256+256+1):LENGTH(GRTCA))=''B;                   1820
         XC    NGRTCA+512(72,@12),NGRTCA+512(@12)                  1820
*       END;                                                       1821
*                                                                  1821
*     /***************************************************************/
*     /*                                                             */
*     /*                                                             */
*     /***************************************************************/
*                                                                  1822
*     PSACSTK=ADDR(GRTCA)+LENGTH(GRTCA)+FRRWALEN;/* UPDATE FOR NEXT
*                                      STACK                         */
@RC01811 LA    @12,84                                              1822
         AL    @12,PSACSTK(,PSAREG)                                1822
         LR    @06,RSVTINDX                                        1822
         SLA   @06,2                                               1822
         L     @06,YSTAK-4(@06)                                    1822
         SLA   @06,5                                               1822
         ALR   @12,@06                                             1822
         AH    @12,@CH04002                                        1822
         ST    @12,PSACSTK(,PSAREG)                                1822
*   END;                            /* CONTINUE IF MORE STACKS TO  1823
*                                      INITIALIZE                    */
         AL    RSVTINDX,@CF00067                                   1823
         CH    RSVTINDX,@CH00036                                   1823
         BNH   @DL01784                                            1823
*   PSACSTK=PSANSTK;                /* SET CURRENT TO NORMAL         */
         L     @12,PSANSTK(,PSAREG)                                1824
         ST    @12,PSACSTK(,PSAREG)                                1824
*   FRRSEMP=FRRSEMP-ADDR(PSA);      /*                       @YM02619*/
         L     @06,FRRSEMP(,@12)                                   1825
         SLR   @06,PSAREG                                          1825
         ST    @06,FRRSEMP(,@12)                                   1825
*   FRRSLAST=FRRSLAST-ADDR(PSA);    /*                       @YM02619*/
         L     @04,FRRSLAST(,@12)                                  1826
         SLR   @04,PSAREG                                          1826
         ST    @04,FRRSLAST(,@12)                                  1826
*   FRRSCURR=FRRSEMP;               /*                       @YM02619*/
         ST    @06,FRRSCURR(,@12)                                  1827
*   PSACSTK=ADDR(PSASTAK)-ADDR(PSA);/*                       @YM02619*/
         LA    @12,3072                                            1828
         ST    @12,PSACSTK(,PSAREG)                                1828
*   PSANSTK=PSACSTK;                /*                       @YM02619*/
         ST    @12,PSANSTK(,PSAREG)                                1829
*   RESPECIFY                                                      1830
*    (PSAREG) UNRESTRICTED;         /* RELEASE REGISTER 1            */
*   RESPECIFY                                                      1831
*     PSA;                          /* REESTABLISH ORIGINAL BASE FOR
*                                      THE PSA                       */
*   END IEAVTSIN;                   /* END IEAVTSIN PROCEDURE        */
@EL00021 DS    0H                                                  1832
@EF00021 DS    0H                                                  1832
@ER00021 LM    @14,@12,12(@13)                                     1832
         BR    @14                                                 1832
*                                                                  1833
*/********************************************************************/
*/*                                                                  */
*/*SEGMENT-                                                          */
*/*          CHECKIO                                                 */
*/*                                                                  */
*/*FUNCTION-                                                         */
*/*          IF THE PROCESSOR HAS NO CHANNELS ONLINE THEN INDICATE   */
*/*          IT NOLONGER HAS I/O ABILITY.                            */
*/*                                                                  */
*/*OPERATION-                                                        */
*/*          TENTATIVELY INDICATE THAT THE PROCESSOR NO LONGER HAS   */
*/*          I/O ABILITY                                             */
*/*                                                                  */
*/*          SEARCH THRU ALL THE ENTRIES OF THE CHANNEL ACTIVITY     */
*/*          TABLE AND IF A CHANNEL IS FOUND TO STILL BE ONLINE      */
*/*          THEN INDICATE THAT THIS PROCESSOR HAS I/O ABILITY       */
*/*                                                                  */
*/*CHANGE ACTIVITY-                                                  */
*/*      @G47AN2O-                                                   */
*/*          158 ATTACHED PROCESSOR SUPPORT                          */
*/*                                                                  */
*/********************************************************************/
*                                                                  1833
*CHECKIO:                                                          1833
*   PROCEDURE;                                                     1833
CHECKIO  STM   @14,@12,12(@13)                                     1833
*   PCCAIO=NOIO;                    /* TENTATIVELY: NO I/O ABILITY   */
         L     @12,PCCAPTR                                         1834
         NI    PCCAIO(@12),B'10111111'                             1834
*   CATPTR=ADDR(PCCACAT);           /* ADDR OF FIRST CAT ENTRY       */
         LA    CATPTR,PCCACAT(,@12)                                1835
*   DO I=0 TO 15                    /* CHECK ALL CATS                */
*         WHILE(PCCAIO=NOIO);       /* NO I/O ABILITY                */
         SLR   I,I                                                 1836
@DL01836 L     @12,PCCAPTR                                         1836
         TM    PCCAIO(@12),B'01000000'                             1836
         BNZ   @DC01836                                            1836
*     IF CATNOP='0'B                /* FOUND A CHANNEL ONLINE        */
*       THEN                                                       1837
         TM    CATNOP(CATPTR),B'01000000'                          1837
         BNZ   @RF01837                                            1837
*       PCCAIO=HASIO;               /* PROCESSOR HAS I/O ABILITY     */
         OI    PCCAIO(@12),B'01000000'                             1838
*     ELSE                                                         1839
*       CATPTR=CATPTR+              /* INCREMENT TO NEXT CAT         */
*           LENGTH(CAT);                                           1839
         B     @RC01837                                            1839
@RF01837 AH    CATPTR,@CH00036                                     1839
*   END;                                                           1840
@RC01837 AL    I,@CF00067                                          1840
         CH    I,@CH00344                                          1840
         BNH   @DL01836                                            1840
@DC01836 DS    0H                                                  1841
*   END CHECKIO;                                                   1841
@EL00022 DS    0H                                                  1841
@EF00022 DS    0H                                                  1841
@ER00022 LM    @14,@12,12(@13)                                     1841
         BR    @14                                                 1841
*                                                                  1842
*/********************************************************************/
*/*                                                                  */
*/*DEFINE-                                                           */
*/*          EPILOGUE                                                */
*/*                                                                  */
*/********************************************************************/
*                                                                  1842
*   DECLARE                         /* GENERAL PURPOSE REGISTERS     */
*     GPR00F FIXED(31) REG(0),                                     1842
*     GPR12F FIXED(31) REG(12),                                    1842
*     GPR15F FIXED(31) REG(15),                                    1842
*     GPR00P PTR(31) REG(0),                                       1842
*     GPR01P PTR(31) REG(1),                                       1842
*     GPR02P PTR(31) REG(2),                                       1842
*     GPR13P PTR(31) REG(13),                                      1842
*     GPR14P PTR(31) REG(14),                                      1842
*     GPR15P PTR(31) REG(15);                                      1842
*   DCL                                                            1843
*     1 I004 DEF(ILIST) BDY(WORD),  /* LIST FOR GETMAIN              */
*      2 I00401 PTR(31),            /* LENGTH                        */
*      2 I00402 CHAR(1),            /* HIARCHY                       */
*      2 I00403 PTR(24),            /* ADDR OF ADDR LIST             */
*      2 I00404 CHAR(1),            /* TYPE OF REQUEST               */
*      2 I00405 PTR(8);             /* SUBPOOL VALUE                 */
*   DCL                                                            1844
*     1 I005 DEF(ILIST) BDY(WORD),  /* LIST FOR FREEMAIN             */
*       3 I00501 PTR(8),            /* RESERVED                      */
*       3 I00502 PTR(24),           /* LENGTH                        */
*       3 I00503 PTR(8),            /* RESERVED                      */
*       3 I00504 PTR(24),           /* ADDR OF ADDR LIST             */
*       3 I00505 BIT(8),            /* TYPE OF FREEMAIN              */
*       3 I00506 PTR(8);            /* SUBPOOL VALUE                 */
*   DCL                                                            1845
*     1 I006 DEF(ILIST),            /* DEFINE LIST                   */
*      2 I00601 CHAR(1),            /* EP/DE FLAG                    */
*      2 I00602 PTR(24),            /* EP/DE PTR                     */
*      2 I00603 CHAR(1),            /* ERRET FLAG                    */
*      2 I00604 PTR(24),            /* DCB PTR                       */
*      2 I00605 PTR(31);            /* ERRET PTR                     */
*   DCL                                                            1846
*     1 I056 DEF(ILIST) BDY(WORD) CHAR(32767),/* LIST FOR ENQ        */
*       3 I05601 PTR(31),           /* TCB OR ECB ADDRESS            */
*       3 I05602(*) CHAR(12) BDY(WORD),/* ARRAY OF RESOURCE ELEMENTS */
*         5 I05603 BIT(8),          /* BIT FLAGS 1                   */
*         5 I05604 PTR(8),          /* MINOR RESOURCE NAME LENGTH    */
*         5 I05605 BIT(8),          /* BIT FLAGS 2                   */
*         5 I05655 CHAR(1),         /* CONTROL PGM USE               */
*         5 I05606 PTR(31),         /* MAJOR RESOURCE NAME ADDR      */
*         5 I05607 PTR(31);         /* MINOR RESOURCE NAME ADDR      */
*   DECLARE                                                        1847
*     ILIST CHAR(16) BDY(DWORD);    /* STANDARD LIST                 */
*   DECLARE                         /* COMMON VARIABLES              */
*     I256C CHAR(256) BASED,                                       1848
*     I031F FIXED(31) BASED,                                       1848
*     I031P PTR(31) BASED,                                         1848
*     I015F FIXED(15) BASED,                                       1848
*     I015P PTR(15) BASED,                                         1848
*     I008P PTR(8) BASED,                                          1848
*     I001C CHAR(1) BASED;                                         1848
*   DECLARE                                                        1849
*     IOPTLIST(3) PTR(31) BDY(WORD);/* OPTION LIST ARRAY             */
*   END IEEVCPU                                                    1850
*                                                                  1850
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.     */
*/*%INCLUDE SYSUT5  (FL1     )                                       */
*/*%INCLUDE SYSUT5  (MAINLINE)                                       */
*/*%INCLUDE SYSLIB  (CVT     )                                       */
*/*%INCLUDE SYSLIB  (IEECHAIN)                                       */
*/*%INCLUDE SYSLIB  (IHAPCCAT)                                       */
*/*%INCLUDE SYSLIB  (IHAPCCA )                                       */
*/*%INCLUDE SYSLIB  (IHALCCAT)                                       */
*/*%INCLUDE SYSLIB  (IHALCCA )                                       */
*/*%INCLUDE SYSLIB  (IECDCAT )                                       */
*/*%INCLUDE SYSLIB  (IHARVT  )                                       */
*/*%INCLUDE SYSLIB  (IHACSD  )                                       */
*/*%INCLUDE SYSLIB  (IHAASCB )                                       */
*/*%INCLUDE SYSLIB  (IHAASVT )                                       */
*/*%INCLUDE SYSLIB  (IHAPSA  )                                       */
*/*%INCLUDE SYSLIB  (IHAYSTAK)                                       */
*/*%INCLUDE SYSLIB  (IHAFRRS )                                       */
*/*%INCLUDE SYSLIB  (IHASDWA )                                       */
*/*%INCLUDE SYSLIB  (IEFUCBOB)                                       */
*/*%INCLUDE SYSLIB  (IEECUCM )                                       */
*/*%INCLUDE SYSLIB  (IHAESTA )                                       */
*/*%INCLUDE SYSLIB  (IEFZB431)                                       */
*/*%INCLUDE SYSLIB  (IECDIRT )                                       */
*/*%INCLUDE SYSLIB  (IECDIOCM)                                       */
*/*%INCLUDE SYSLIB  (IECDIOCX)                                       */
*/*%INCLUDE SYSLIB  (IEZSSC  )                                       */
*/*%INCLUDE SYSUT5  (SYNTXCHK)                                       */
*/*%INCLUDE SYSUT5  (AUTHCHK )                                       */
*/*%INCLUDE SYSUT5  (OFFLINE )                                       */
*/*%INCLUDE SYSUT5  (CHKCHNL )                                       */
*/*%INCLUDE SYSUT5  (CPUSRCH )                                       */
*/*%INCLUDE SYSUT5  (AFFINSRC)                                       */
*/*%INCLUDE SYSUT5  (DEVPREP )                                       */
*/*%INCLUDE SYSUT5  (PATHMAP )                                       */
*/*%INCLUDE SYSUT5  (TMRCNSL )                                       */
*/*%INCLUDE SYSUT5  (CHANNEL )                                       */
*/*%INCLUDE SYSUT5  (DSPTCHK )                                       */
*/*%INCLUDE SYSUT5  (GTFOFF  )                                       */
*/*%INCLUDE SYSUT5  (GTFOFF  )                                       */
*/*%INCLUDE SYSUT5  (FREEMCEL)                                       */
*/*%INCLUDE SYSUT5  (FREEMCEL)                                       */
*/*%INCLUDE SYSUT5  (ONLINE  )                                       */
*/*%INCLUDE SYSUT5  (CHANON  )                                       */
*/*%INCLUDE SYSUT5  (PREPARE )                                       */
*/*%INCLUDE SYSUT5  (RMSEXIT )                                       */
*/*%INCLUDE SYSUT5  (RTMEXIT )                                       */
*/*%INCLUDE SYSUT5  (GTFEXIT )                                       */
*/*%INCLUDE SYSUT5  (TRCKRST )                                       */
*/*%INCLUDE SYSUT5  (PAGEFIX )                                       */
*/*%INCLUDE SYSUT5  (PATHVAL )                                       */
*/*%INCLUDE SYSUT5  (DEVCHK  )                                       */
*/*%INCLUDE SYSUT5  (UCBMARK )                                       */
*/*%INCLUDE SYSUT5  (PSAFREE )                                       */
*/*%INCLUDE SYSUT5  (CONVERT )                                       */
*/*%INCLUDE SYSUT5  (UCBRCRDR)                                       */
*/*%INCLUDE SYSUT5  (IEEVIOQ )                                       */
*/*%INCLUDE SYSUT5  (PSACCA  )                                       */
*/*%INCLUDE SYSUT5  (PSASETUP)                                       */
*/*%INCLUDE SYSUT5  (CCASETUP)                                       */
*/*%INCLUDE SYSUT5  (GETCORE )                                       */
*/*%INCLUDE SYSUT5  (FREECORE)                                       */
*/*%INCLUDE SYSUT5  (SAVARSUB)                                       */
*/*%INCLUDE SYSUT5  (AINIT   )                                       */
*/*%INCLUDE SYSUT5  (DISASSOC)                                       */
*/*%INCLUDE SYSUT5  (FRRRTN  )                                       */
*/*%INCLUDE SYSUT5  (ESTAERTN)                                       */
*/*%INCLUDE SYSLIB  (IEAVSPSA)                                       */
*/*%INCLUDE SYSLIB  (IHAWSAVT)                                       */
*/*%INCLUDE SYSLIB  (IEAVTSIN)                                       */
*                                                                  1850
*       ;                                                          1850
@DATA    DS    0H
@CH00074 DC    H'3'
@CH00076 DC    H'4'
@CH00036 DC    H'8'
@CH01603 DC    H'10'
@CH00055 DC    H'16'
@CH00228 DC    H'20'
@CH02097 DC    H'84'
@CH03789 DC    H'183'
@CH03790 DC    H'240'
@CH01762 DC    H'512'
@CH03961 DC    H'584'
@CH04002 DC    H'784'
@CH03997 DC    H'1552'
@CH03995 DC    H'4096'
@CH03741 DC    H'5000'
@CH02073 DC    H'9324'
@CH03999 DC    H'-52'
@CH03589 DC    XL2'E000'
@CH03658 DC    XL2'FFFF'
@CH03846 DC    XL2'4000'
@CH03594 DC    XL1'0'
         DC    C'0'
         DS    0F
@AL00311 DC    A(@CF00067)             LIST WITH   1 ARGUMENT(S)
@AL00531 EQU   *                       LIST WITH   1 ARGUMENT(S)
@AL00621 DC    A(@CF00177)             LIST WITH   1 ARGUMENT(S)
@DATD    DSECT
         DS    0F
@SA00001 DS    18F
@PC00001 DS    1F
@PC00009 DS    2F
@SA00004 DS    15F
@SA00002 DS    15F
@SA00003 DS    15F
@SA00010 DS    15F
@SA00007 DS    18F
@SA00011 DS    15F
@SA00017 DS    15F
@SA00015 DS    15F
@SA00008 DS    15F
@SA00012 DS    14F
@SA00016 DS    15F
@SA00006 DS    15F
@SA00013 DS    15F
@SA00005 DS    15F
@PC00020 DS    1F
@AL00001 DS    2A
@TF00001 DS    F
IEEVCPU  CSECT
         DS    0F
@CF00275 DC    F'0'
@CF00067 DC    F'1'
@CH00067 EQU   @CF00067+2
@CF00177 DC    F'2'
@CF00344 DC    F'15'
@CH00344 EQU   @CF00344+2
@CF03679 DC    F'150'
@CF04020 DC    F'-4'
@CF03528 DC    XL4'FFFFFFFF'
@CF03706 DC    XL4'FFFFFFF8'
@CF03729 DC    XL4'0000E5C1'
@CF03772 DC    XL4'80000000'
@CF03850 DC    XL4'8000'
@DATD    DSECT
         DS    0D
UCBLKPTR DS    A
PCCAPTR  DS    A
LCCAPTR  DS    A
UCBPTR   DS    A
LOOPCNT  DS    F
RETADD   DS    A
ESTAPTR  DS    A
VMVREQBP DS    A
PATHADDR DS    A
ENQECB   DS    FL4
         ORG   ENQECB
WAITBIT  DS    BL1
POSTBIT  EQU   ENQECB+0
         ORG   ENQECB+4
DEVADDR  DS    F
TEMPWORK DS    FL4
         ORG   TEMPWORK
@NM00126 DS    BL4
         ORG   @NM00126
@NM00127 DS    BL1
CCBIT1   EQU   @NM00126+0
CCBIT2   EQU   @NM00126+0
         ORG   TEMPWORK+3
STOP     EQU   TEMPWORK+3
OPINT    EQU   TEMPWORK+3
CKSTOP   EQU   TEMPWORK+3
NTRDY    EQU   TEMPWORK+3
@NM00128 EQU   TEMPWORK+3
RECCK    EQU   TEMPWORK+3
         ORG   TEMPWORK+4
NSIZEPTR DS    A
GMTBL    DS    FL4
         ORG   GMTBL
RSVD     DS    FL1
STKEY    DS    FL1
SBPOOL   DS    FL1
FLAGS    DS    FL1
         ORG   GMTBL+4
LOOP     DS    F
CSDCNTL  DS    F
CSDWORK  DS    F
WRKMASK  DS    F
SYSSTAT  DS    H
NP0FMTWS DS    FL2
         ORG   NP0FMTWS
FRMTONLY DS    BL1
         ORG   NP0FMTWS+2
WORKAREA DS    CL116
         ORG   WORKAREA
ESTAPRM  DS    CL20
         ORG   ESTAPRM
CODEREG1 DS    AL4
CODEREG2 DS    AL4
CODEREG3 DS    AL4
DATAREG1 DS    AL4
DATAEND  DS    AL4
         ORG   WORKAREA+20
CSCBPTR  DS    AL4
BEGINPTR DS    AL4
ENTRYPTR DS    AL4
PARMPTR  DS    AL4
COREPTR  DS    AL4
CPUPSA   DS    AL4
HEXCHNAD DS    FL2
         ORG   HEXCHNAD
@NM00001 DS    BL1
HEXCHN1  DS    BL1
         ORG   WORKAREA+46
CHNMASK  DS    FL2
HEXCPUAD DS    FL2
         ORG   HEXCPUAD
@NM00002 DS    BL1
HEXCPU1  DS    BL1
         ORG   WORKAREA+50
CPUMSK   DS    FL2
GETLENG  DS    FL2
SUBPOOL  DS    BL1
DEVSTAT  DS    BL1
         ORG   DEVSTAT
HIER     DS    BL1
CONSLE   EQU   DEVSTAT+0
DEVON    EQU   DEVSTAT+0
DEVOFF   EQU   DEVSTAT+0
CHNGEFLG EQU   DEVSTAT+0
         ORG   WORKAREA+56
CONSLID  DS    BL1
DDD      DS    CL3
ERCODE   DS    CL4
CATCOPY  DS    BL1
         ORG   CATCOPY+0
@NM00003 DS    BL1
CHANBIT  EQU   CATCOPY+0
         ORG   WORKAREA+80
AFFINJOB DS    FL2
         DS    CL2
OLDPCCA  DS    AL4
OLDLCCA  DS    AL4
CHNPPTR  DS    AL4
QUITPTR  DS    AL4
PGFXECB  DS    FL4
         ORG   PGFXECB
@NM00004 DS    CL1
         ORG   @NM00004
@NM00005 DS    BL1
POSTED   EQU   @NM00004+0
         ORG   PGFXECB+1
PGFXCODE DS    CL3
         ORG   WORKAREA+104
FOOTPRNT DS    CL5
         ORG   FOOTPRNT
CHNIND   DS    BL1
RECONENQ EQU   FOOTPRNT+0
ONLINE   EQU   FOOTPRNT+0
UNCOND   EQU   FOOTPRNT+0
CSDENQ   EQU   FOOTPRNT+0
CLOCKSW  EQU   FOOTPRNT+0
UCBENQ   EQU   FOOTPRNT+0
CNSLSW   EQU   FOOTPRNT+0
UCBALTER DS    BL1
UCBDONE  EQU   FOOTPRNT+1
CHNLSMRK EQU   FOOTPRNT+1
DEVSUBGO EQU   FOOTPRNT+1
IONOTQT  EQU   FOOTPRNT+1
CHOFFOK  EQU   FOOTPRNT+1
CHONLINE EQU   FOOTPRNT+1
CNSLEXIT EQU   FOOTPRNT+1
CNSLDONE DS    BL1
CPUONOK  EQU   FOOTPRNT+2
CHONOK   EQU   FOOTPRNT+2
REPLYP   EQU   FOOTPRNT+2
CPUOFFOK EQU   FOOTPRNT+2
UNKNSTAT EQU   FOOTPRNT+2
COPYCAT  EQU   FOOTPRNT+2
JOBSHED  EQU   FOOTPRNT+2
NOCHAIN  DS    BL1
DEVNOTON EQU   FOOTPRNT+3
ONLINMSG EQU   FOOTPRNT+3
CPUISON  EQU   FOOTPRNT+3
CHISON   EQU   FOOTPRNT+3
OLDCAT   EQU   FOOTPRNT+3
CRH      EQU   FOOTPRNT+3
CPUCRH   EQU   FOOTPRNT+3
KEEPCHAN DS    BL1
KPCHANFL EQU   FOOTPRNT+4
NOPCCA   EQU   FOOTPRNT+4
SS1FAIL  EQU   FOOTPRNT+4
PSACCAOK EQU   FOOTPRNT+4
SKIPWTO  EQU   FOOTPRNT+4
PROCSTRT EQU   FOOTPRNT+4
         ORG   WORKAREA+112
ERRORIND DS    FL4
         ORG   ERRORIND
UNAUTH   DS    BL1
INVLDSTX EQU   ERRORIND+0
OFFALRDY EQU   ERRORIND+0
LASTCPU  EQU   ERRORIND+0
AFFINSWT EQU   ERRORIND+0
CPFAILED EQU   ERRORIND+0
LASTPATH EQU   ERRORIND+0
NOCORE   EQU   ERRORIND+0
NOCLOCK  DS    BL1
NOCNSOLE EQU   ERRORIND+1
OPERCNCL EQU   ERRORIND+1
CPUNRESP EQU   ERRORIND+1
CHCPUOFF EQU   ERRORIND+1
SYSFAIL  EQU   ERRORIND+1
MCHECK   EQU   ERRORIND+1
CHNTOPER EQU   ERRORIND+1
ESTAERR  DS    BL1
UNIPROC  EQU   ERRORIND+2
ERROR    EQU   ERRORIND+2
EXITERR  EQU   ERRORIND+2
PATHRSVD EQU   ERRORIND+2
SMFRCER  EQU   ERRORIND+2
ERRORFLG EQU   ERRORIND+2
CHINV    EQU   ERRORIND+2
CRHFAIL  DS    BL1
CRHNCPU  EQU   ERRORIND+3
CRHNCHN  EQU   ERRORIND+3
NOKPCHAN EQU   ERRORIND+3
         ORG   WORKAREA+116
SAVEPSW  DS    CL8
DEVSUBP  DS    CL12
         ORG   DEVSUBP
DEVSUBUB DS    FL4
DEVSUBFC DS    BL1
DEVSUBCP DS    BL1
DEVSUBCH DS    BL1
@NM00121 DS    BL1
LINKPTR  DS    AL4
         ORG   DEVSUBP+12
PATHPARM DS    CL8
         ORG   PATHPARM
PATHFC   DS    BL1
PATHUCB  DS    AL3
PATHCPU  DS    FL2
PATHCHN  DS    FL2
         ORG   PATHPARM+8
CSWTBLK  DS    CL32
         ORG   CSWTBLK
CSWTID   DS    CL8
CSWTFC   DS    CL1
@NM00122 DS    CL3
CSWTUC   DS    CL4
@NM00123 DS    CL16
         ORG   CSWTBLK+32
WTORPL2  DS    CL55
         DS    CL1
WTORPL1  DS    CL85
         DS    CL3
WTOECB   DS    CL4
REPLY    DS    CL8
ESTLIST  DS    CL16
PARMAREA DS    CL109
VMVPARMS DS    CL52
         DS    CL3
DISCPU   DS    CL16
         ORG   DISCPU
ASDALEN  DS    FL4
ASDAOPC  DS    CL1
ASDA001  DS    CL1
ASDAFLG  DS    BL2
         ORG   ASDAFLG
ASASSOC  DS    BL1
ASDASSOC EQU   ASDAFLG+0
@NM00129 EQU   ASDAFLG+0
ASDEINT  EQU   ASDAFLG+0
ASDMNT   EQU   ASDAFLG+0
@NM00130 EQU   ASDAFLG+0
         ORG   DISCPU+8
ASDACPU  DS    CL5
ASDA002  DS    CL3
         ORG   DISCPU+16
PURINIT  DS    CL8
         ORG   PURINIT
AIRLL    DS    FL4
AIROP    DS    FL1
@NM00131 DS    CL1
AIRFLAG  DS    BL2
         ORG   AIRFLAG
AIRRESV  DS    BL1
AIRCPUS  EQU   AIRFLAG+0
@NM00132 EQU   AIRFLAG+0
         ORG   PURINIT+8
PURCPU   DS    CL13
         ORG   PURCPU
PURGLL   DS    FL4
PURGOP   DS    FL1
@NM00133 DS    CL1
PURGFLG  DS    BL2
         ORG   PURGFLG
PURGMPP  DS    BL1
@NM00134 EQU   PURGFLG+0
         ORG   PURCPU+8
PURGHOST DS    CL5
         ORG   PURCPU+13
         DS    CL7
HOST     DS    CL8
         ORG   HOST
@NM00135 DS    CL1
HOSTID   DS    CL5
         ORG   HOST+8
SETLOKSA DS    CL20
         ORG   SETLOKSA
@NM00136 DS    FL4
@NM00137 DS    FL4
@NM00138 DS    FL4
@NM00139 DS    FL4
@NM00140 DS    FL4
         ORG   SETLOKSA+20
         DS    CL4
ILIST    DS    CL16
REGSAVEA DS    18F
IOPTLIST DS    3A
         ORG   *+1-(*-@DATD)/(*-@DATD) INSURE DSECT DATA
@ENDDATD EQU   *
IEEVCPU  CSECT
         DS    0F
@SIZDATD DC    AL1(0)
         DC    AL3(@ENDDATD-@DATD)
@CV03520 DC    V(IEEVWKUP)
@CV03521 DC    V(IEEVTCH)
@CV03522 DC    V(IEECLEAN)
@CV03523 DC    V(IEEVQUIT)
@CV03524 DC    V(IEEVACR)
@CV03525 DC    V(WTORT)
         DS    0D
SEC1     DC    XL4'00000064'
SEC5     DC    XL4'00000200'
ONEMEG   DC    XL4'00100000'
@CC03611 DC    C'),OFFLINE,KEEPCHAN '
@CC03613 DC    C'),KEEPCHAN,OFFLINE '
@CC03607 DC    C'),OFFLINE,UNCOND '
@CC03609 DC    C'),UNCOND,OFFLINE '
@CC03605 DC    C'),OFFLINE '
@CC03601 DC    C'),ONLINE '
@CC03671 DC    C'IGC0407B'
@CC03768 DC    C'IEFAB49C'
@CC03867 DC    C'IEEVCPU'
@CC03682 DC    C'EXTEND'
@CC03683 DC    C'CANCEL'
@CC03616 DC    C'CPU('
@CC03618 DC    C'0168'
@CC03809 DC    C'PSA '
@CC03811 DC    C'PCCA'
@CC03812 DC    C'LCCA'
@CC03591 DC    C'CH('
@CC03639 DC    C'YES'
@CC03640 DC    C'NO '
@CC03641 EQU   @CC03640
@CB03735 DC    X'00080000'
RCNENQQ  DC    CL8'SYSZVARY'
RCNENQR  DC    CL3'CPU'
UCBENQQ  DC    CL8'SYSIEFSD'
UCBENQR  DC    CL2'Q4'
JOBSCDQ  DC    CL8'SYSZCSD '
JOBSCDR  DC    CL8'CSDCPUJS'
WTOR1    DS    CL85
         ORG   WTOR1
WTOR101  DC    AL1(4)
WTOR102  DC    AL3(@CF00275)
WTOR103  DC    AL4(@CF00275)
WTOR104  DC    H'73'
WTOR105  DC    B'1000000000000000'
WTOR106  DC    CL69'IEE718D SHOULD CPU BE UNAVAILABLE FOR JOB SCHEDULINC
               G? REPLY YES OR NO'
WTOR107  DC    B'0100000000000000'
WTOR108  DC    B'1000000000000000'
         ORG   WTOR1+85
         DS    CL3
WTOR2    DS    CL55
         ORG   WTOR2
WTOR201  DC    AL1(6)
WTOR202  DC    AL3(@CF00275)
WTOR203  DC    AL4(@CF00275)
WTOR204  DC    H'43'
WTOR205  DC    B'1000000000000000'
WTOR206  DC    CL39'IEE717D DDD BUSY REPLY EXTEND OR CANCEL'
WTOR207  DC    B'0100000000000000'
WTOR208  DC    B'1000000000000000'
         ORG   WTOR2+55
PATCH    DC    X'00'
         DC    XL119'0'
         DS    CL1
YSTAK    DC    F'16'
         DC    F'4'
         DC    F'16'
         DC    F'16'
         DC    F'4'
         DC    F'4'
         DC    F'16'
         DC    F'16'
@00      EQU   00                      EQUATES FOR REGISTERS 0-15
@01      EQU   01
@02      EQU   02
@03      EQU   03
@04      EQU   04
@05      EQU   05
@06      EQU   06
@07      EQU   07
@08      EQU   08
@09      EQU   09
@10      EQU   10
@11      EQU   11
@12      EQU   12
@13      EQU   13
@14      EQU   14
@15      EQU   15
SAVAREA  EQU   @10
R3SAVAR  EQU   @10
HOLDRC   EQU   @11
SAPTR    EQU   @10
P        EQU   @12
AFLAG    EQU   @02
TEMPMASK EQU   @02
CHARPTR  EQU   @02
I        EQU   @02
PSAPTR   EQU   @12
ASCBPTR  EQU   @02
CATPTR   EQU   @10
CHNADDR  EQU   @03
RCRDRPTR EQU   @10
R0       EQU   @00
R1       EQU   @01
R2       EQU   @02
R5       EQU   @05
R6       EQU   @06
R7       EQU   @07
R8       EQU   @08
R9       EQU   @09
R10      EQU   @10
R11      EQU   @11
R12      EQU   @12
R14      EQU   @14
R15      EQU   @15
RETCODE  EQU   @15
SDWAPTR  EQU   @01
ASDAR1   EQU   @01
PAIRR1   EQU   @01
GPR01P   EQU   @01
GPR15P   EQU   @15
GPR15F   EQU   @15
GPR00P   EQU   @00
GPR14P   EQU   @14
REGSAPTR EQU   @13
PARMX    EQU   @01
PARM     EQU   @01
RTCODE   EQU   @15
TBLPTR   EQU   @01
LNGREG   EQU   @00
LOCKRC   EQU   @15
GMREG    EQU   @03
RSVTINDX EQU   @02
FRREINDX EQU   @03
PSAREG   EQU   @01
COMMPTR  EQU   @06
GPR00F   EQU   @00
GPR02P   EQU   @02
GPR12F   EQU   @12
GPR13P   EQU   @13
R13      EQU   @13
R3       EQU   @03
R4       EQU   @04
CVTPTR   EQU   16
FRREPTR  EQU   16
FRRSPTR  EQU   16
IRTPTR   EQU   16
UCMEILPT EQU   16
UCMEXTPT EQU   16
UCMUEWPT EQU   16
UCBRECRD EQU   0
NEXTPTR  EQU   UCBRECRD
CAUSEFLD EQU   UCBRECRD+4
HIERONLY EQU   CAUSEFLD
CONSLFLG EQU   CAUSEFLD
MKDEVON  EQU   CAUSEFLD
MKDEVOFF EQU   CAUSEFLD
ALTERUCB EQU   CAUSEFLD
UCBADDR  EQU   UCBRECRD+5
WKUPARMS EQU   0
PSAADDR  EQU   WKUPARMS+72
XREGS    EQU   WKUPARMS+76
VIRTADDR EQU   WKUPARMS+84
CPUMASK  EQU   WKUPARMS+88
CPUADD   EQU   WKUPARMS+90
@NM00008 EQU   WKUPARMS+108
INPROC   EQU   @NM00008
COMPLT   EQU   @NM00008
CATCHK   EQU   @NM00008
BACKVOFF EQU   @NM00008
CORCHAIN EQU   0
FRWRDPTR EQU   CORCHAIN
SPNUM    EQU   CORCHAIN+4
LNGTH    EQU   CORCHAIN+6
QTPRMS   EQU   0
QTCPUAD  EQU   QTPRMS+72
QTCPUMSK EQU   QTPRMS+74
QTFLGS   EQU   QTPRMS+76
QTCOMP   EQU   QTFLGS
COMBUF   EQU   0
UCBTAB   EQU   0
UCMPRFXP EQU   0
CVTMAP   EQU   0
CVT      EQU   CVTMAP
CVTILK2  EQU   CVTMAP+40
CVTDAR   EQU   CVTMAP+72
CVTFLGS1 EQU   CVTDAR
CVTBRET  EQU   CVTMAP+82
CVTCUCB  EQU   CVTMAP+100
CVTDCB   EQU   CVTMAP+116
CVTIOQET EQU   CVTMAP+120
CVTIXAVL EQU   CVTMAP+124
CVTIERLC EQU   CVTMAP+144
CVTHEAD  EQU   CVTMAP+160
CVTSV76C EQU   CVTHEAD
CVTOPTA  EQU   CVTMAP+182
CVTOPTB  EQU   CVTMAP+183
CVTRMS   EQU   CVTMAP+224
CVTGTF   EQU   CVTMAP+236
CVTGTFST EQU   CVTGTF
CVTGTFS  EQU   CVTGTFST
CVTSTATE EQU   CVTGTFST
CVTTMODE EQU   CVTGTFST
CVTFORM  EQU   CVTGTFST
CVTAQAVT EQU   CVTMAP+240
CVTTCMFG EQU   CVTAQAVT
CVTVOLM2 EQU   CVTMAP+244
CVTTATA  EQU   CVTVOLM2
CVTTSKS  EQU   CVTTATA
CVTVOLF2 EQU   CVTTSKS
CVTTAT   EQU   CVTTATA+1
CVTATER  EQU   CVTMAP+248
CVTEXT1  EQU   CVTMAP+252
CVTPURG  EQU   CVTMAP+260
CVTQMSG  EQU   CVTMAP+268
CVTDMSR  EQU   CVTMAP+272
CVTRSV37 EQU   CVTDMSR
CVTDMSRF EQU   CVTRSV37
CVTERPV  EQU   CVTMAP+316
CVTINTLA EQU   CVTMAP+320
CVTAPF   EQU   CVTMAP+324
CVTEXT2  EQU   CVTMAP+328
CVTHJES  EQU   CVTMAP+332
CVTPGSIA EQU   CVTMAP+348
CVTA1F1  EQU   CVTMAP+356
CVTSYSK  EQU   CVTMAP+357
CVTVOLM1 EQU   CVTMAP+380
CVTVOLF1 EQU   CVTVOLM1
CVTATMCT EQU   CVTMAP+388
CVTXTNT1 EQU   0
CVTXTNT2 EQU   0
CVTDSSV  EQU   CVTXTNT2
CVTFLGBT EQU   CVTXTNT2+5
CVTQID   EQU   CVTXTNT2+24
CVTICB   EQU   CVTXTNT2+48
CVTRV400 EQU   CVTXTNT2+52
CVTRV409 EQU   CVTXTNT2+53
CVTATCVT EQU   CVTXTNT2+64
CVTRV429 EQU   CVTXTNT2+84
CVTRV438 EQU   CVTXTNT2+85
CVTRV457 EQU   CVTXTNT2+112
CVTRV466 EQU   CVTXTNT2+113
CVTFIX   EQU   0
CVTRELNO EQU   CVTFIX+252
CHAIN    EQU   0
CHFLG    EQU   CHAIN+4
CHSTS    EQU   CHFLG+2
CHACT    EQU   CHFLG+3
CHIFY    EQU   CHACT
CHKEY    EQU   CHAIN+8
CHPARM   EQU   CHKEY
CHPKE    EQU   CHAIN+28
CHUCMP   EQU   CHAIN+29
CHTJID   EQU   CHAIN+30
CHPROCSN EQU   CHAIN+32
CHACT1   EQU   CHPROCSN+3
CHASM    EQU   CHAIN+40
CHCIBP   EQU   CHASM+4
CHRGNSZ  EQU   CHASM+8
CHSTEP   EQU   CHASM+24
CHSWT    EQU   CHSTEP
CHSHORT  EQU   CHASM+32
PCCAVT   EQU   0
PCCAT00P EQU   PCCAVT
PCCA     EQU   0
PCCAPCCA EQU   PCCA
PCCACPID EQU   PCCA+4
PCCACPUA EQU   PCCA+16
PCCACAFM EQU   PCCA+18
PCCAPSAV EQU   PCCA+24
PCCAPSAR EQU   PCCA+28
PCCATMST EQU   PCCA+128
PCCATMFL EQU   PCCATMST
PCCATODE EQU   PCCATMST+1
PCCACCE  EQU   PCCATMST+2
PCCAINTE EQU   PCCATMST+3
PCCAEMSB EQU   PCCA+136
PCCAEMSI EQU   PCCAEMSB
PCCARISP EQU   PCCAEMSI
PCCAEMS2 EQU   PCCAEMSI+1
PCCAEMS3 EQU   PCCAEMSI+2
PCCARMSB EQU   PCCAEMSI+3
PCCACHAN EQU   PCCA+224
PCCAWERP EQU   PCCA+280
PCCACHPF EQU   PCCAWERP+4
PCCACHBL EQU   PCCAWERP+5
PCCACHVA EQU   PCCAWERP+6
PCCACHTS EQU   PCCAWERP+7
PCCACHS1 EQU   PCCA+288
PCCACHS2 EQU   PCCA+289
PCCACHRB EQU   PCCA+290
PCCACHF1 EQU   PCCA+308
PCCACHF2 EQU   PCCA+309
PCCACHF3 EQU   PCCA+310
PCCACHF4 EQU   PCCA+311
PCCAATTR EQU   PCCA+376
PCCACPUM EQU   PCCAATTR
PCCAIO   EQU   PCCAATTR
PCCACAT  EQU   PCCA+384
LCCAVT   EQU   0
LCCAT00P EQU   LCCAVT
LCCA     EQU   0
LCCALCCA EQU   LCCA
LCCACPUA EQU   LCCA+4
LCCAMCR1 EQU   LCCA+152
LCCAIHRC EQU   LCCA+520
LCCAIHR1 EQU   LCCAIHRC
LCCAIHR2 EQU   LCCAIHRC+1
LCCAIHR3 EQU   LCCAIHRC+2
LCCAIHR4 EQU   LCCAIHRC+3
LCCASPIN EQU   LCCA+524
LCCASPN1 EQU   LCCASPIN
LCCASPN2 EQU   LCCASPIN+1
LCCASPN3 EQU   LCCASPIN+2
LCCASPN4 EQU   LCCASPIN+3
LCCACPUS EQU   LCCA+536
LCCADSF1 EQU   LCCA+540
LCCAVCPU EQU   LCCADSF1
LCCATIMR EQU   LCCADSF1
LCCADSF2 EQU   LCCA+541
LCCASPSA EQU   LCCA+544
LCCACRFL EQU   LCCA+692
LCCAVARY EQU   LCCACRFL
LCCACREX EQU   LCCA+693
LCCALKFG EQU   LCCA+694
LCCASRBF EQU   LCCA+720
LCCAIRT  EQU   LCCA+736
CAT      EQU   0
CATENTRY EQU   CAT
CATFLG   EQU   CATENTRY
CATNOP   EQU   CATFLG
CATNGEN  EQU   CATFLG
CATNID   EQU   CATFLG
CATFLA   EQU   CAT+1
CATSIOCT EQU   CAT+2
CATCHID  EQU   CAT+4
RVT      EQU   0
RVTPBUCR EQU   RVT+60
CSD      EQU   0
CSDCPUJS EQU   CSD+4
CSDCHAD  EQU   CSD+6
CSDCPUAL EQU   CSD+8
CSDCPUOL EQU   CSD+10
CSDSCWRD EQU   CSD+12
CSDSCFL1 EQU   CSDSCWRD
CSDSCFL2 EQU   CSDSCWRD+1
CSDSCFL3 EQU   CSDSCWRD+2
CSDSCFL4 EQU   CSDSCWRD+3
CSDFLAGS EQU   CSD+23
CSDMP    EQU   CSDFLAGS
CSDMASK  EQU   CSD+128
ASCB     EQU   0
ASCBSUPC EQU   ASCB+16
ASCBRSM  EQU   ASCB+52
ASCBRSMF EQU   ASCBRSM
ASCBFW1  EQU   ASCB+100
ASCBAFFN EQU   ASCBFW1
ASCBRCTF EQU   ASCBFW1+2
ASCBFLG1 EQU   ASCBFW1+3
ASCBDSP1 EQU   ASCB+114
ASCBFLG2 EQU   ASCB+115
ASCBLKGP EQU   ASCB+128
ASCBSRQ  EQU   ASCB+180
ASCBSRQ1 EQU   ASCBSRQ
ASCBSRQ2 EQU   ASCBSRQ+1
ASCBSRQ3 EQU   ASCBSRQ+2
ASCBSRQ4 EQU   ASCBSRQ+3
ASVT     EQU   0
ASVTMAXU EQU   ASVT+516
ASVTFRST EQU   ASVT+524
ASVTENTY EQU   ASVT+528
ASVTAVAL EQU   ASVTENTY
PSA      EQU   0
FLCRNPSW EQU   PSA
FLCROPSW EQU   PSA+8
FLCICCW2 EQU   PSA+16
FLCCVT   EQU   FLCICCW2
FLCTRACE EQU   PSA+84
PSAEEPSW EQU   PSA+132
PSAESPSW EQU   PSA+136
FLCSVILC EQU   PSAESPSW+1
PSAEPPSW EQU   PSA+140
FLCPIILC EQU   PSAEPPSW+1
FLCPICOD EQU   PSAEPPSW+2
PSAPICOD EQU   FLCPICOD+1
FLCTEA   EQU   PSAEPPSW+4
FLCPER   EQU   PSA+152
FLCMCLA  EQU   PSA+168
FLCCHNID EQU   FLCMCLA
FLCCHTM  EQU   FLCCHNID
FLCIOEL  EQU   FLCMCLA+4
FLCIOA   EQU   FLCMCLA+16
PSAMEDC  EQU   FLCMCLA+76
FLCFSA   EQU   FLCMCLA+80
PSAPSA   EQU   PSA+512
PSACPUPA EQU   PSA+516
PSACPULA EQU   PSA+518
PSAPCCAV EQU   PSA+520
PSAPCCAR EQU   PSA+524
PSALCCAV EQU   PSA+528
PSALCCAR EQU   PSA+532
PSATNEW  EQU   PSA+536
PSATOLD  EQU   PSA+540
PSAANEW  EQU   PSA+544
PSAAOLD  EQU   PSA+548
PSASUPER EQU   PSA+552
PSASUP1  EQU   PSASUPER
PSASUP2  EQU   PSASUPER+1
PSASUP3  EQU   PSASUPER+2
PSASUP4  EQU   PSASUPER+3
PSACLHT  EQU   PSA+640
PSALKSA  EQU   PSA+696
PSAHLHI  EQU   PSA+760
PSALITA  EQU   PSA+764
PSAWKRAP EQU   PSA+784
PSAWKVAP EQU   PSA+788
PSACPUSA EQU   PSA+794
PSASTOR  EQU   PSA+796
PSADSSFL EQU   PSA+836
PSADSSF1 EQU   PSADSSFL
PSADSSF3 EQU   PSADSSFL+2
PSADSSF4 EQU   PSADSSFL+3
PSARSVT  EQU   PSA+896
PSALSFCC EQU   PSA+1012
PSACDAL  EQU   PSA+1040
PSASTAK  EQU   PSA+3072
FRRS     EQU   0
FRRSHEAD EQU   FRRS
FRRSEMP  EQU   FRRSHEAD
FRRSLAST EQU   FRRSHEAD+4
FRRSELEN EQU   FRRSHEAD+8
FRRSCURR EQU   FRRSHEAD+12
FRRSRTMW EQU   FRRS+16
FRRSENTR EQU   0
FRRSFRRA EQU   FRRSENTR
FRRSFLGS EQU   FRRSENTR+4
FRRSFLG1 EQU   FRRSFLGS
FRRSPARM EQU   FRRSENTR+8
SDWA     EQU   0
SDWAFIOB EQU   SDWA+4
SDWAABCC EQU   SDWAFIOB
SDWACMPF EQU   SDWAABCC
SDWAREQ  EQU   SDWACMPF
SDWACTL1 EQU   SDWA+8
SDWACMKA EQU   SDWACTL1
SDWAMWPA EQU   SDWACTL1+1
SDWAPMKA EQU   SDWACTL1+4
SDWACTL2 EQU   SDWA+16
SDWACMKP EQU   SDWACTL2
SDWAMWPP EQU   SDWACTL2+1
SDWAPMKP EQU   SDWACTL2+4
SDWAGRSV EQU   SDWA+24
SDWANAME EQU   SDWA+88
SDWAEC1  EQU   SDWA+104
SDWAEMK1 EQU   SDWAEC1
SDWAMWP1 EQU   SDWAEC1+1
SDWAINT1 EQU   SDWAEC1+2
SDWANXT1 EQU   SDWAEC1+4
SDWAAEC1 EQU   SDWA+112
SDWAILC1 EQU   SDWAAEC1+1
SDWAINC1 EQU   SDWAAEC1+2
SDWAICD1 EQU   SDWAINC1+1
SDWAEC2  EQU   SDWA+120
SDWAEMK2 EQU   SDWAEC2
SDWAMWP2 EQU   SDWAEC2+1
SDWAINT2 EQU   SDWAEC2+2
SDWANXT2 EQU   SDWAEC2+4
SDWAAEC2 EQU   SDWA+128
SDWAILC2 EQU   SDWAAEC2+1
SDWAINC2 EQU   SDWAAEC2+2
SDWAICD2 EQU   SDWAINC2+1
SDWASRSV EQU   SDWA+136
SDWAIDNT EQU   SDWA+200
SDWAMCH  EQU   SDWA+204
SDWASTCK EQU   SDWAMCH
SDWAMCHI EQU   SDWAMCH+8
SDWAMCHS EQU   SDWAMCHI
SDWAMCHD EQU   SDWAMCHI+1
SDWARSR1 EQU   SDWAMCH+12
SDWARSR2 EQU   SDWAMCH+13
SDWAFLGS EQU   SDWA+232
SDWAERRA EQU   SDWAFLGS
SDWAERRB EQU   SDWAFLGS+1
SDWAERRC EQU   SDWAFLGS+2
SDWAERRD EQU   SDWAFLGS+3
SDWAIOFS EQU   SDWA+238
SDWACPUA EQU   SDWA+248
SDWAPARQ EQU   SDWA+252
SDWARCDE EQU   SDWAPARQ
SDWAACF2 EQU   SDWAPARQ+1
SDWARCRD EQU   SDWAACF2
SDWAACF3 EQU   SDWAPARQ+2
SDWAACF4 EQU   SDWAPARQ+3
SDWALKWA EQU   SDWA+256
SDWALKWS EQU   SDWALKWA
SDWARECP EQU   SDWA+292
SDWAMODN EQU   SDWARECP
SDWACSCT EQU   SDWARECP+8
SDWASNPA EQU   SDWA+320
SDWADUMP EQU   SDWASNPA
SDWADPFS EQU   SDWADUMP+1
SDWADDAT EQU   SDWASNPA+4
SDWASDAT EQU   SDWADDAT
SDWAPDAT EQU   SDWADDAT+2
SDWADPSA EQU   SDWA+328
SDWADPSL EQU   SDWADPSA
SDWARA   EQU   SDWA+400
SDWADPVA EQU   SDWARA+2
SDWAHEX  EQU   SDWADPVA
SDWAURAL EQU   SDWARA+3
SDWAVRA  EQU   SDWARA+4
UCB      EQU   0
UCBOB    EQU   0
UCBJBNR  EQU   UCBOB
UCBFL5   EQU   UCBOB+1
UCBAF    EQU   UCBFL5
UCBNALOC EQU   UCBFL5
UCBSTAT  EQU   UCBOB+3
UCBONLI  EQU   UCBSTAT
UCBCHGS  EQU   UCBSTAT
UCBRESV  EQU   UCBSTAT
UCBALOC  EQU   UCBSTAT
UCBSYSR  EQU   UCBSTAT
UCBCHAN  EQU   UCBOB+4
UCBCHA   EQU   UCBCHAN
UCBSFLS  EQU   UCBOB+6
UCBFLA   EQU   UCBSFLS
UCBFL1   EQU   UCBFLA
UCBBSY   EQU   UCBFL1
UCBNRY   EQU   UCBFL1
UCBPST   EQU   UCBFL1
UCBPSNS  EQU   UCBFL1
UCBCUB   EQU   UCBFL1
UCBACTV  EQU   UCBFL1
UCBFLB   EQU   UCBSFLS+1
UCBIORST EQU   UCBFLB
UCBCRHRV EQU   UCBFLB
UCBVALPH EQU   UCBFLB
UCBCHM   EQU   UCBOB+8
UCBCHM1  EQU   UCBCHM
UCBPTH0  EQU   UCBCHM1
UCBPTH1  EQU   UCBCHM1
UCBCPU   EQU   UCBOB+11
UCBWGT   EQU   UCBOB+12
UCBMTPXP EQU   UCBWGT
UCBVORSN EQU   UCBWGT
UCBVHRSN EQU   UCBWGT
UCBNAME  EQU   UCBOB+13
UCBTYP   EQU   UCBOB+16
UCBTBYT1 EQU   UCBTYP
UCB1FEA5 EQU   UCBTBYT1
UCB1FEA6 EQU   UCBTBYT1
UCBTBYT2 EQU   UCBTYP+1
UCB2OPT2 EQU   UCBTBYT2
UCBDUDN1 EQU   UCB2OPT2
UCB2OPT3 EQU   UCBTBYT2
UCBDUDN2 EQU   UCB2OPT3
UCB2OPT4 EQU   UCBTBYT2
UCBRWTAU EQU   UCB2OPT4
UCB2OPT6 EQU   UCBTBYT2
UCB2OPT7 EQU   UCBTBYT2
UCBTBYT3 EQU   UCBTYP+2
UCBDVCLS EQU   UCBTBYT3
UCB3TAPE EQU   UCBDVCLS
UCB3COMM EQU   UCBDVCLS
UCB3DACC EQU   UCBDVCLS
UCBTBYT4 EQU   UCBTYP+3
UCBEXTPT EQU   UCBOB+20
UCBFLC   EQU   UCBEXTPT
UCBDEV   EQU   UCBOB+24
UCBCMEXT EQU   0
UCBATI   EQU   UCBCMEXT+3
@NM00098 EQU   UCBATI
UCBFLP1  EQU   UCBCMEXT+5
UCBERLOG EQU   UCBFLP1
UCBCCWOF EQU   UCBCMEXT+8
UCBMIHBY EQU   UCBCMEXT+16
UCBMT    EQU   0
UCBOCR   EQU   0
UCB3540X EQU   0
UCBDKBYT EQU   UCB3540X+6
UCB3800X EQU   0
UCBOPTNS EQU   UCB3800X
UCBACTIV EQU   UCB3800X+3
UCBMDRBF EQU   UCB3800X+36
UCBUCS   EQU   0
UCBUCSOP EQU   UCBUCS+4
UCBFCBOP EQU   UCBUCS+5
UCBBGN   EQU   0
UCM2EXT  EQU   0
UCM2STA  EQU   UCM2EXT+8
UCM2SFLG EQU   UCM2STA
UCM2FEXT EQU   UCM2EXT+12
UCMPRFX  EQU   0
UCMMCENT EQU   UCMPRFX
UCMSAVE0 EQU   UCMPRFX+4
UCMSFLGS EQU   UCMPRFX+84
UCMSFLG1 EQU   UCMSFLGS
UCMSFLG2 EQU   UCMSFLGS+1
UCMXSA   EQU   UCMPRFX+104
UCMSDS1  EQU   UCMPRFX+156
UCM      EQU   0
UCMDECB  EQU   UCM+12
UCMRPYI  EQU   UCM+32
UCMPXB   EQU   UCM+68
UCMMODE  EQU   UCMPXB
UCMVDATA EQU   UCM+72
UCMRSV42 EQU   UCM+300
UCMRSV51 EQU   UCM+301
UCMEIL   EQU   0
UCMRECBA EQU   UCMEIL+24
UCMLIST  EQU   0
UCMSTS   EQU   UCMLIST+24
UCMATR   EQU   UCMLIST+25
UCMXA    EQU   UCMLIST+26
UCMID    EQU   UCMXA
UCMAUTH  EQU   UCMLIST+40
UCMAUTHA EQU   UCMAUTH
UCMDISP  EQU   UCMLIST+42
UCMDISP1 EQU   UCMDISP
UCMDISP2 EQU   UCMDISP+1
UCMMSG   EQU   UCMLIST+60
UCMMSG1  EQU   UCMMSG
UCMDEVC  EQU   UCMLIST+63
UCMRCT   EQU   UCMLIST+68
UCMSDS5  EQU   UCMRCT
UCMFEXTP EQU   UCMLIST+72
UCMEXIT  EQU   0
UCMFEXTA EQU   0
UCMFPPTR EQU   UCMFEXTA+4
UCMFMGFS EQU   UCMFEXTA+8
UCMFFLG1 EQU   UCMFMGFS
UCMFECBL EQU   UCMFEXTA+28
UCMFRECB EQU   UCMFECBL+4
UCMFRBYT EQU   UCMFRECB
UCMPEXTA EQU   0
UCMPDM1  EQU   UCMPEXTA+4
UCMEFEXT EQU   0
UCMEFLG1 EQU   UCMEFEXT
UCMEFPEX EQU   UCMEFEXT+4
ESTA     EQU   0
ESTAEXT  EQU   ESTA
ESTAFLG1 EQU   ESTAEXT
ESTAIO   EQU   ESTAFLG1
ESTAFGRS EQU   ESTA+12
ESTAFLG2 EQU   ESTAFGRS
VMVRQBLK EQU   0
VMVFNMAP EQU   VMVRQBLK
VMVOPTB1 EQU   VMVFNMAP
VMVUNLOD EQU   VMVOPTB1
VMVUCB   EQU   VMVOPTB1
VMVOPTB2 EQU   VMVFNMAP+1
VMVOPTB3 EQU   VMVFNMAP+2
VMVUCBP  EQU   VMVRQBLK+9
VMVMINFO EQU   VMVRQBLK+40
VMVACTON EQU   VMVMINFO
VMVUSER  EQU   VMVRQBLK+48
IRT      EQU   0
IRTENTRY EQU   IRT
IRTFLA   EQU   IRTENTRY
IRTFLB   EQU   IRTENTRY+1
IRTENVR  EQU   IRTENTRY+2
IRTCHMSK EQU   IRT+32
IOCOM    EQU   0
IOCCTBL  EQU   IOCOM+12
IOCOMEX  EQU   IOCOM+64
IOCX     EQU   0
IOX      EQU   IOCX
IOXCHMSK EQU   IOCX+2
IOXCRHA  EQU   IOCX+12
IOXCRHD  EQU   IOCX+16
IOXSTIDC EQU   IOCX+20
ICB2SSCB EQU   0
ICBOPT   EQU   ICB2SSCB+48
ICBFLG   EQU   ICB2SSCB+52
ICBFG1   EQU   ICBFLG
ICBI     EQU   ICBFG1
ICBMSCA  EQU   ICBFG1
ICBTRACE EQU   ICB2SSCB+112
CONVCHAR EQU   0
WSAG     EQU   0
WSAGGMFM EQU   WSAG+4
LGTHTBL  EQU   0
NUM      EQU   LGTHTBL
LGTH     EQU   LGTHTBL+2
FSIZE    EQU   LGTHTBL+4
SVPTR    EQU   0
NWSASIZE EQU   0
NGRTCA   EQU   0
GRTCA    EQU   0
I001C    EQU   0
I008P    EQU   0
I015F    EQU   0
I015P    EQU   0
I031F    EQU   0
I031P    EQU   0
I256C    EQU   0
UCMEPEXT EQU   0
UCM2PTR  EQU   0
CSCB     EQU   0
HEXRSLT  EQU   0
BITMASK  EQU   0
FREEPTR  EQU   0
IOCOMPTR EQU   CVTIXAVL
IOCXPTR  EQU   IOCOMEX
RVTPTR   EQU   CVTRMS
UCMBASPT EQU   CVTCUCB
UCMMCSPT EQU   UCMPRFXP
UCMDVEPT EQU   UCMMCENT
CVTS01   EQU   CVTPGSIA
CVTLPDIA EQU   CVTS01+12
CVTDIRST EQU   CVTLPDIA
CVTSLIDA EQU   CVTS01+24
CVTCTLFG EQU   CVTS01+50
CVTASVT  EQU   CVTS01+208
CVTCSD   EQU   CVTS01+312
CVTGLMN  EQU   CVTS01+332
CVTSPSA  EQU   CVTS01+336
CVTWSAC  EQU   CVTS01+348
CVTRSTWD EQU   CVTS01+368
CVTIPCDS EQU   CVTS01+404
CVTIPCRI EQU   CVTS01+408
CVTIPCRP EQU   CVTS01+412
CVTPCCAT EQU   CVTS01+416
CVTLCCAT EQU   CVTS01+420
CVTRV210 EQU   CVTS01+424
CVTRV219 EQU   CVTS01+425
CVTRV228 EQU   CVTS01+426
CVTRV237 EQU   CVTS01+427
CVTMFRTR EQU   CVTS01+452
CVTRV262 EQU   CVTS01+468
CVTRV271 EQU   CVTS01+469
CVTRV280 EQU   CVTS01+470
CVTRV289 EQU   CVTS01+471
CVTSPFRR EQU   CVTS01+512
CVTVACR  EQU   CVTS01+544
CVTQUIT  EQU   CVTS01+548
CVTVPSA  EQU   CVTS01+560
CVTGSDA  EQU   CVTS01+600
CVTCRCA  EQU   CVTS01+612
CVTCDAL  EQU   CVTS01+684
ASVTPTR  EQU   CVTASVT
CHAINS01 EQU   CHASM
CHBUF    EQU   CHAINS01
CHTYPE   EQU   CHAINS01+124
CHTRSTAT EQU   CHAINS01+125
CHINC    EQU   CHAINS01+132
CHCSYSO  EQU   CHAINS01+134
FLC      EQU   PSA
PSARSVTE EQU   PSARSVT
PSACSTK  EQU   PSARSVTE
PSANSTK  EQU   PSARSVTE+4
PSASSTK  EQU   PSARSVTE+8
PSARSTK  EQU   PSARSVTE+56
UCBOBS01 EQU   UCBDEV
UCBSTAB  EQU   UCBOBS01+10
UCBBSVL  EQU   UCBSTAB
UCBPRSRS EQU   UCBSTAB
UCBDMCT  EQU   UCBOBS01+11
UCBFL4   EQU   UCBOBS01+13
UCBBASE  EQU   UCBOBS01+16
UCBOBS02 EQU   UCBDEV
UCBTFL1  EQU   UCBOBS02+19
UCBXTN   EQU   UCBOBS02+20
UCBVOPT  EQU   UCBXTN
UCBOBS03 EQU   UCBDEV
UCBXTADR EQU   UCBOBS03
UCBOBS04 EQU   UCBDEV
UCBBTA   EQU   UCBOBS04+12
UCBOBS06 EQU   UCBDEV
UCBAOF   EQU   UCBOBS06
UCBAOF1  EQU   UCBAOF
UCBAOF2  EQU   UCBAOF+1
@NM00097 EQU   UCBOBS06+3
UCBIRB   EQU   UCBOBS06+4
UCBGRAF  EQU   UCBIRB
UCBLDNCA EQU   UCBOBS06+8
UCBRDYQ  EQU   UCBLDNCA
UCBIRLN  EQU   UCBRDYQ
UCBLDNCB EQU   UCBRDYQ+1
UCBCTLNK EQU   UCBOBS06+12
UCBOBS07 EQU   UCBDEV
UCBOBS08 EQU   UCBDEV
UCBCTCAD EQU   UCBOBS08
UCBCTCF1 EQU   UCBOBS08+4
UCBOBS09 EQU   UCBDEV
UCMIECBA EQU   UCMRECBA+4
@NM00117 EQU   FLCRNPSW
RNPSW    EQU   @NM00117
@NM00119 EQU   RNPSW+1
RNWAIT   EQU   @NM00119
RNPSWAD  EQU   @NM00117+4
@NM00124 EQU   WTORPL2+11
WTORDDD  EQU   @NM00124+9
I056     EQU   ILIST
I05601   EQU   I056
I05602   EQU   I056+4
I05603   EQU   I05602
I05604   EQU   I05602+1
I05605   EQU   I05602+2
I05606   EQU   I05602+4
I05607   EQU   I05602+8
I006     EQU   ILIST
I00601   EQU   I006
I00602   EQU   I006+1
I00603   EQU   I006+4
I00604   EQU   I006+5
I004     EQU   ILIST
I00401   EQU   I004
I00403   EQU   I004+5
I00404   EQU   I004+8
I00405   EQU   I004+9
I005     EQU   ILIST
I00502   EQU   I005+1
I00504   EQU   I005+5
I00505   EQU   I005+8
I00506   EQU   I005+9
STKADDR  EQU   PSACSTK
STKLW3BT EQU   STKADDR+3
CSDAL    EQU   CSDCPUAL
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS
@NM00141 EQU   STKADDR
I00503   EQU   I005+4
I00501   EQU   I005
I00402   EQU   I004+4
I00605   EQU   I006+8
I05655   EQU   I05602+3
@NM00125 EQU   @NM00124
@NM00120 EQU   @NM00119
@NM00118 EQU   RNPSW
UCMIECBP EQU   UCMIECBA+1
UCMIECBF EQU   UCMIECBA
UCBRV066 EQU   UCBOBS09+4
UCBIOSBA EQU   UCBOBS09
UCBRV042 EQU   UCBOBS08+5
UCBRV082 EQU   UCBCTCF1
UCBRV081 EQU   UCBCTCF1
UCBRV080 EQU   UCBCTCF1
UCBRV079 EQU   UCBCTCF1
UCBRV078 EQU   UCBCTCF1
UCBRV077 EQU   UCBCTCF1
UCBRV076 EQU   UCBCTCF1
UCBCTC80 EQU   UCBCTCF1
UCBCTCAL EQU   UCBCTCAD
UCBICNCB EQU   UCBOBS07+4
UCBRV040 EQU   UCBOBS07
UCBCTLNA EQU   UCBCTLNK+1
UCBRLN   EQU   UCBCTLNK
UCBRDYQA EQU   UCBLDNCB
UCBINRLN EQU   UCBIRLN
UCBIRBA  EQU   UCBIRB+1
UCBRV039 EQU   UCBGRAF
UCBDWNR  EQU   UCBGRAF
UCBRPND  EQU   UCBGRAF
UCBUPM   EQU   UCBGRAF
UCBBTAM  EQU   UCBGRAF
UCBDRNO  EQU   UCBGRAF
UCBDRO   EQU   UCBGRAF
UCBOIP   EQU   UCBGRAF
UCBATRCD EQU   @NM00097
UCBSKPFG EQU   @NM00097
UCBRIPND EQU   @NM00097
UCBRTIAC EQU   @NM00097
UCBRSV79 EQU   @NM00097
UCBRSV78 EQU   @NM00097
UCBRSV77 EQU   @NM00097
UCBOLTEP EQU   @NM00097
UCBATNCT EQU   UCBOBS06+2
UCBRSV76 EQU   UCBAOF2
UCBRSV75 EQU   UCBAOF2
UCBRSV74 EQU   UCBAOF2
UCBRSV73 EQU   UCBAOF2
UCBRSV72 EQU   UCBAOF2
UCBRSV71 EQU   UCBAOF2
UCBRSV70 EQU   UCBAOF2
UCBRSV69 EQU   UCBAOF2
UCBRSV68 EQU   UCBAOF1
UCBRSV67 EQU   UCBAOF1
UCBRSV66 EQU   UCBAOF1
UCBRSV65 EQU   UCBAOF1
UCBRSV64 EQU   UCBAOF1
UCBOFNL  EQU   UCBAOF1
UCBOFSP  EQU   UCBAOF1
UCBOFMCR EQU   UCBAOF1
UCBBTB   EQU   UCBBTA+1
UCBDI    EQU   UCBBTA
UCBSNS   EQU   UCBOBS04+8
UCBTEB   EQU   UCBOBS04+4
UCBGCB   EQU   UCBOBS04+3
UCBOPEN  EQU   UCBOBS04+2
UCBSTART EQU   UCBOBS04
UCBXTNB  EQU   UCBXTN+1
UCBRSV22 EQU   UCBVOPT
UCBRSV21 EQU   UCBVOPT
UCBRSV20 EQU   UCBVOPT
UCBESVE  EQU   UCBVOPT
UCBERPC  EQU   UCBVOPT
UCBESVC  EQU   UCBVOPT
UCBEVA   EQU   UCBVOPT
UCBESV   EQU   UCBVOPT
UCBRV009 EQU   UCBTFL1
UCBRV008 EQU   UCBTFL1
UCBRV007 EQU   UCBTFL1
UCBRV006 EQU   UCBTFL1
UCBRV005 EQU   UCBTFL1
UCBDQDSP EQU   UCBTFL1
UCBNSLTP EQU   UCBTFL1
UCBNLTP  EQU   UCBTFL1
UCBRES1B EQU   UCBOBS02+18
UCBFSER  EQU   UCBOBS02+12
@NM00096 EQU   UCBOBS02+4
UCBFSEQ  EQU   UCBOBS02+2
UCBFSCT  EQU   UCBOBS02
UCBNEXP  EQU   UCBOBS01+20
UCBRES1A EQU   UCBOBS01+15
UCBUSER  EQU   UCBOBS01+14
UCBFL47  EQU   UCBFL4
UCBMAT   EQU   UCBFL4
UCBHOLD  EQU   UCBFL4
UCBATTN  EQU   UCBFL4
UCBDSS   EQU   UCBFL4
UCBRESVP EQU   UCBFL4
UCBWDAV  EQU   UCBFL4
UCBDAVV  EQU   UCBFL4
UCBSQC   EQU   UCBOBS01+12
UCBDATP  EQU   UCBOBS01+12
UCBDMC   EQU   UCBDMCT
UCBMOUNT EQU   UCBDMCT
UCBBNUL  EQU   UCBSTAB
UCBSHAR  EQU   UCBSTAB
UCBBSTR  EQU   UCBSTAB
UCBBPUB  EQU   UCBSTAB
UCBBPRV  EQU   UCBSTAB
UCBBALB  EQU   UCBPRSRS
UCBPGFL  EQU   UCBSTAB
UCBDVSHR EQU   UCBBSVL
UCBVOLI  EQU   UCBOBS01+4
UCBVTOC  EQU   UCBOBS01
PSARSAV  EQU   PSARSVTE+60
PSAESAV3 EQU   PSARSVTE+52
PSAESTK3 EQU   PSARSVTE+48
PSAESAV2 EQU   PSARSVTE+44
PSAESTK2 EQU   PSARSVTE+40
PSAESAV1 EQU   PSARSVTE+36
PSAESTK1 EQU   PSARSVTE+32
PSAPSAV  EQU   PSARSVTE+28
PSAPSTK  EQU   PSARSVTE+24
PSAMSAV  EQU   PSARSVTE+20
PSAMSTK  EQU   PSARSVTE+16
PSASSAV  EQU   PSARSVTE+12
CHLAST   EQU   CHAINS01+136
CHSPA    EQU   CHAINS01+135
CHUSERID EQU   CHCSYSO
CHJB     EQU   CHCSYSO
CHDUMP   EQU   CHCSYSO
CHQUE    EQU   CHCSYSO
CHHOLD   EQU   CHCSYSO
CHOUT    EQU   CHCSYSO
CHINN    EQU   CHCSYSO
CHALL    EQU   CHCSYSO
CHPEND   EQU   CHAINS01+128
CHARID   EQU   CHAINS01+127
CHCNID   EQU   CHAINS01+126
@NM00015 EQU   CHTRSTAT
CHTSL    EQU   CHTRSTAT
CHTS     EQU   CHTRSTAT
CHINITL  EQU   CHTRSTAT
CHINIT   EQU   CHTRSTAT
CHJOBSL  EQU   CHTRSTAT
CHJOBS   EQU   CHTRSTAT
CHDEF    EQU   CHTYPE
CHHIAR   EQU   CHTYPE
CHARSV29 EQU   CHTYPE
CHARSV28 EQU   CHTYPE
CHARSV27 EQU   CHTYPE
CHARSV26 EQU   CHTYPE
CHARSV25 EQU   CHTYPE
CHDSTAT  EQU   CHTYPE
CVTRV628 EQU   CVTS01+728
CVTRV627 EQU   CVTS01+724
CVTRV626 EQU   CVTS01+720
CVTRV625 EQU   CVTS01+716
CVTRV624 EQU   CVTS01+712
CVTRV623 EQU   CVTS01+708
CVTRV622 EQU   CVTS01+704
CVTRV621 EQU   CVTS01+700
CVTIHASU EQU   CVTS01+696
CVTSUSP  EQU   CVTS01+692
CVTT6SVC EQU   CVTS01+688
CVTTCTL  EQU   CVTS01+680
CVTRSUME EQU   CVTS01+676
CVTJTERM EQU   CVTS01+672
CVTASMRM EQU   CVTS01+668
CVTTCASP EQU   CVTS01+664
CVT0PT03 EQU   CVTS01+660
CVT0PT0E EQU   CVTS01+656
CVTRV609 EQU   CVTS01+652
CVTCGK   EQU   CVTS01+648
CVTRAC   EQU   CVTS01+644
CVTHSM   EQU   CVTS01+640
CVTRV605 EQU   CVTS01+636
CVTRV604 EQU   CVTS01+632
CVTEFF02 EQU   CVTS01+628
CVTCBBR  EQU   CVTS01+624
CVTSSCR  EQU   CVTS01+620
CVTEVENT EQU   CVTS01+616
CVTTPIO  EQU   CVTS01+608
CVTADV   EQU   CVTS01+604
CVTGSDAB EQU   CVTGSDA
CVTQV3   EQU   CVTS01+596
CVTQV2   EQU   CVTS01+592
CVTQV1   EQU   CVTS01+588
CVTRPT   EQU   CVTS01+584
CVTSSRB  EQU   CVTS01+580
CVTCSDRL EQU   CVTS01+576
CVTEXP1  EQU   CVTS01+572
CVTRMPMT EQU   CVTS01+568
CVTRMPTT EQU   CVTS01+564
CVTVSTOP EQU   CVTS01+556
CVTGTFR8 EQU   CVTS01+552
CVTWTCB  EQU   CVTS01+540
CVTSTPRS EQU   CVTS01+536
CVT0PT02 EQU   CVTS01+532
CVTDARCM EQU   CVTS01+528
CVTIRECM EQU   CVTS01+524
CVTJRECM EQU   CVTS01+520
CVTVEMS0 EQU   CVTS01+516
CVTRLSTG EQU   CVTS01+508
CVT0TC0A EQU   CVTS01+504
CVTGMBR  EQU   CVTS01+500
CVTLFRM  EQU   CVTS01+496
CVTRMBR  EQU   CVTS01+492
CVTVIOP  EQU   CVTS01+488
CVTRV307 EQU   CVTS01+486
CVTRV306 EQU   CVTS01+484
CVTRV305 EQU   CVTS01+482
CVTRV304 EQU   CVTS01+480
CVTRV303 EQU   CVTS01+478
CVTRV302 EQU   CVTS01+476
CVTTRCA  EQU   CVTS01+472
CVTRV297 EQU   CVTRV289
CVTRV296 EQU   CVTRV289
CVTRV295 EQU   CVTRV289
CVTRV294 EQU   CVTRV289
CVTRV293 EQU   CVTRV289
CVTRV292 EQU   CVTRV289
CVTRV291 EQU   CVTRV289
CVTRV290 EQU   CVTRV289
CVTRV288 EQU   CVTRV280
CVTRV287 EQU   CVTRV280
CVTRV286 EQU   CVTRV280
CVTRV285 EQU   CVTRV280
CVTRV284 EQU   CVTRV280
CVTRV283 EQU   CVTRV280
CVTRV282 EQU   CVTRV280
CVTRV281 EQU   CVTRV280
CVTRV279 EQU   CVTRV271
CVTRV278 EQU   CVTRV271
CVTRV277 EQU   CVTRV271
CVTRV276 EQU   CVTRV271
CVTRV275 EQU   CVTRV271
CVTRV274 EQU   CVTRV271
CVTRV273 EQU   CVTRV271
CVTRV272 EQU   CVTRV271
CVTRV270 EQU   CVTRV262
CVTRV269 EQU   CVTRV262
CVTRV268 EQU   CVTRV262
CVTRV267 EQU   CVTRV262
CVTRV266 EQU   CVTRV262
CVTRV265 EQU   CVTRV262
CVTRV264 EQU   CVTRV262
CVTRV263 EQU   CVTRV262
CVTVFP   EQU   CVTS01+464
CVTVSI   EQU   CVTS01+460
CVTVPSIB EQU   CVTS01+456
CVTMFACT EQU   CVTMFRTR
CVTMFCTL EQU   CVTS01+448
CVTPVBP  EQU   CVTS01+444
CVTPWI   EQU   CVTS01+440
CVTRV254 EQU   CVTS01+438
CVTRV253 EQU   CVTS01+436
CVTRV252 EQU   CVTS01+434
CVTRV251 EQU   CVTS01+433
CVTRV250 EQU   CVTS01+432
CVTRV249 EQU   CVTS01+431
CVTRV248 EQU   CVTS01+430
CVTRV247 EQU   CVTS01+429
CVTRV246 EQU   CVTS01+428
CVTRV245 EQU   CVTRV237
CVTRV244 EQU   CVTRV237
CVTRV243 EQU   CVTRV237
CVTRV242 EQU   CVTRV237
CVTRV241 EQU   CVTRV237
CVTRV240 EQU   CVTRV237
CVTRV239 EQU   CVTRV237
CVTRV238 EQU   CVTRV237
CVTRV236 EQU   CVTRV228
CVTRV235 EQU   CVTRV228
CVTRV234 EQU   CVTRV228
CVTRV233 EQU   CVTRV228
CVTRV232 EQU   CVTRV228
CVTRV231 EQU   CVTRV228
CVTRV230 EQU   CVTRV228
CVTRV229 EQU   CVTRV228
CVTRV227 EQU   CVTRV219
CVTRV226 EQU   CVTRV219
CVTRV225 EQU   CVTRV219
CVTRV224 EQU   CVTRV219
CVTRV223 EQU   CVTRV219
CVTRV222 EQU   CVTRV219
CVTRV221 EQU   CVTRV219
CVTRV220 EQU   CVTRV219
CVTRV218 EQU   CVTRV210
CVTRV217 EQU   CVTRV210
CVTRV216 EQU   CVTRV210
CVTRV215 EQU   CVTRV210
CVTRV214 EQU   CVTRV210
CVTRV213 EQU   CVTRV210
CVTRV212 EQU   CVTRV210
CVTRV211 EQU   CVTRV210
CVTAIDVT EQU   CVTS01+400
CVTSSAP  EQU   CVTS01+396
CVTEHCIR EQU   CVTS01+392
CVTEHDEF EQU   CVTS01+388
CVTDAIR  EQU   CVTS01+384
CVTPERFM EQU   CVTS01+380
CVT044R2 EQU   CVTS01+376
CVTFETCH EQU   CVTS01+372
CVTSPOST EQU   CVTS01+364
CVTIOBP  EQU   CVTS01+360
CVTASMVT EQU   CVTS01+356
CVTRECRQ EQU   CVTS01+352
CVTRV149 EQU   CVTS01+344
CVTWSAL  EQU   CVTS01+340
CVTVEAC0 EQU   CVTS01+328
CVT062R1 EQU   CVTS01+324
CVTRPOST EQU   CVTS01+320
CVTDQIQE EQU   CVTS01+316
CVTLKRMA EQU   CVTS01+308
CVTRSPIE EQU   CVTS01+304
CVTRENQ  EQU   CVTS01+300
CVTLQCB  EQU   CVTS01+296
CVTFQCB  EQU   CVTS01+292
CVTQCS01 EQU   CVTS01+288
CVTAPFT  EQU   CVTS01+284
CVTPARRL EQU   CVTS01+280
CVTVWAIT EQU   CVTS01+276
CVTGSPL  EQU   CVTS01+272
CVTLSMQ  EQU   CVTS01+268
CVTGSMQ  EQU   CVTS01+264
CVTEXPRO EQU   CVTS01+260
CVTOPCTP EQU   CVTS01+256
CVTSIC   EQU   CVTS01+252
CVTTPIOS EQU   CVTS01+248
CVTRTMS  EQU   CVTS01+244
CVTSDBF  EQU   CVTS01+240
CVTSCBP  EQU   CVTS01+236
CVTSDMP  EQU   CVTS01+232
CVTSV60  EQU   CVTS01+228
CVTRTMCT EQU   CVTS01+224
CVTASCBL EQU   CVTS01+220
CVTASCBH EQU   CVTS01+216
CVTGDA   EQU   CVTS01+212
CVTVVMDI EQU   CVTS01+204
CVTAQTOP EQU   CVTS01+200
CVTIOSCS EQU   CVTS01+196
CVTSDRM  EQU   CVTS01+192
CVTOPTE  EQU   CVTS01+188
CVTSTXU  EQU   CVTS01+184
CVTQUIS  EQU   CVTS01+180
CVTPARS  EQU   CVTS01+176
CVTS1EE  EQU   CVTS01+172
CVTFRAS  EQU   CVTS01+168
CVTQSAS  EQU   CVTS01+164
CVTCRAS  EQU   CVTS01+160
CVTCRMN  EQU   CVTS01+156
CVTDELCP EQU   CVTS01+152
CVTFRECL EQU   CVTS01+148
CVTGETCL EQU   CVTS01+144
CVTBLDCP EQU   CVTS01+140
CVTAUTHL EQU   CVTS01+136
CVTSCAN  EQU   CVTS01+132
CVTRV144 EQU   CVTS01+130
CVTMAXMP EQU   CVTS01+128
CVTSTCK  EQU   CVTS01+124
CVTRV139 EQU   CVTS01+123
CVTDSSAC EQU   CVTS01+122
CVTRV513 EQU   CVTS01+121
CVTIOSPL EQU   CVTS01+120
CVTPTGT  EQU   CVTS01+116
CVTCSPIE EQU   CVTS01+112
CVTSMFEX EQU   CVTS01+108
CVTOLT0A EQU   CVTS01+104
CVTSRBRT EQU   CVTS01+100
CVTPUTL  EQU   CVTS01+96
CVTASCRL EQU   CVTS01+92
CVTASCRF EQU   CVTS01+88
CVTRV326 EQU   CVTS01+84
CVTRV325 EQU   CVTS01+80
CVTRV324 EQU   CVTS01+76
CVT0VL01 EQU   CVTS01+72
CVTSHRVM EQU   CVTS01+68
CVTRV332 EQU   CVTS01+64
CVTTAS   EQU   CVTS01+60
CVTRSCN  EQU   CVTS01+56
CVTTRAC2 EQU   CVTS01+54
CVTTRACE EQU   CVTS01+52
CVTAPG   EQU   CVTS01+51
CVTSDTRC EQU   CVTCTLFG
CVTGTRCE EQU   CVTCTLFG
CVTNOMP  EQU   CVTCTLFG
CVTRSV79 EQU   CVTCTLFG
CVTDSTAT EQU   CVTCTLFG
CVTRSV78 EQU   CVTCTLFG
CVTRV333 EQU   CVTCTLFG
CVTRV323 EQU   CVTCTLFG
CVTSPVLK EQU   CVTS01+49
CVTRSV77 EQU   CVTS01+48
CVTRV331 EQU   CVTS01+44
CVTRV330 EQU   CVTS01+40
CVTRV329 EQU   CVTS01+36
CVTRV328 EQU   CVTS01+32
CVTRV322 EQU   CVTS01+28
CVTSLID  EQU   CVTSLIDA+1
CVTSYLK  EQU   CVTSLIDA
CVTRV321 EQU   CVTS01+20
CVTRV320 EQU   CVTS01+16
CVTLPDIR EQU   CVTLPDIA+1
CVTRSV69 EQU   CVTDIRST
CVTRSV68 EQU   CVTDIRST
CVTRSV67 EQU   CVTDIRST
CVTRSV66 EQU   CVTDIRST
CVTRSV65 EQU   CVTDIRST
CVTRSV64 EQU   CVTDIRST
CVTRSV63 EQU   CVTDIRST
CVTDICOM EQU   CVTDIRST
CVTPVTP  EQU   CVTS01+8
CVTLPDSR EQU   CVTS01+4
CVTGETL  EQU   CVTS01
WSAGSCHE EQU   WSAG+40
WSAGREST EQU   WSAG+36
WSAGNQDQ EQU   WSAG+32
WSAGMEMT EQU   WSAG+28
WSAGOPTM EQU   WSAG+24
WSAGSTAT EQU   WSAG+20
WSAGEMS0 EQU   WSAG+16
WSAGSSRS EQU   WSAG+12
WSAGRSM  EQU   WSAG+8
WSAGPGIO EQU   WSAG
ICBCPUID EQU   ICB2SSCB+496
ICBLORD  EQU   ICBTRACE+256
ICBOTRC  EQU   ICBTRACE
ICBFAB   EQU   ICB2SSCB+108
ICBMSSC  EQU   ICB2SSCB+104
ICBRSVP  EQU   ICB2SSCB+100
ICBAEAP  EQU   ICB2SSCB+96
ICBSIOBP EQU   ICB2SSCB+92
ICBIATNA EQU   ICB2SSCB+88
ICBIPRGA EQU   ICB2SSCB+84
ICBSRBP  EQU   ICB2SSCB+80
ICBVVICB EQU   ICB2SSCB+76
ICBVVIC  EQU   ICB2SSCB+72
ICBSIOP  EQU   ICB2SSCB+68
ICBMEP   EQU   ICB2SSCB+64
ICBIORCI EQU   ICB2SSCB+60
ICB2ACTP EQU   ICB2SSCB+56
ICBSAMP  EQU   ICBFLG+2
ICBFG2   EQU   ICBFLG+1
@NM00116 EQU   ICBFG1
ICBMSCMP EQU   ICBFG1
ICBS     EQU   ICBFG1
ICBB     EQU   ICBFG1
ICBV     EQU   ICBFG1
ICBR     EQU   ICBFG1
ICBNVT   EQU   ICBOPT
ICBVN02P EQU   ICB2SSCB+44
ICBTCB   EQU   ICB2SSCB+40
ICBQHEAD EQU   ICB2SSCB+36
ICBAUCB  EQU   ICB2SSCB+32
ICBPUCB  EQU   ICB2SSCB+28
ICBCOMQ  EQU   ICB2SSCB+24
ICBIOR   EQU   ICB2SSCB+20
ICBCOM   EQU   ICB2SSCB+16
ICBACTV  EQU   ICB2SSCB+12
ICBECB   EQU   ICB2SSCB+8
ICBSSNAM EQU   ICB2SSCB
IOXEND   EQU   IOCX+32
IOXPSIF  EQU   IOCX+28
IOXPSIX  EQU   IOCX+24
IOXTCQSC EQU   IOCX+8
@NM00115 EQU   IOCX+6
IOXLCHCT EQU   IOCX+5
IOXHICH  EQU   IOCX+4
IOXOFSET EQU   IOX
IOCOEND  EQU   IOCOM+128
IOCPATCH EQU   IOCOM+124
IOCUCBBM EQU   IOCOM+120
IOCQCNT  EQU   IOCOM+116
IOCIOSDQ EQU   IOCOM+112
IOCIOSEQ EQU   IOCOM+108
IOCSVCF  EQU   IOCOM+104
IOCTCCW  EQU   IOCOM+100
IOCRSVTB EQU   IOCOM+96
IOCMFCNT EQU   IOCOM+92
IOCMFHK  EQU   IOCOM+88
IOCGENA  EQU   IOCOM+84
IOCCCH   EQU   IOCOM+80
IOCASYNQ EQU   IOCOM+76
IOCLCHTB EQU   IOCOM+72
IOCATTBL EQU   IOCOM+68
IOCSYNCH EQU   IOCOM+56
IOCCATLK EQU   IOCOM+48
IOCPRGID EQU   IOCOM+44
IOCIOSCP EQU   IOCOM+40
IOCORMGT EQU   IOCOM+36
IOCVOID  EQU   IOCOM+32
IOCSTIO  EQU   IOCOM+28
IOCSCOMP EQU   IOCOM+24
IOCHD160 EQU   IOCOM+20
IOCINT   EQU   IOCOM+16
IOCHIO   EQU   IOCOM+8
IOCPST   EQU   IOCOM+4
IOCPGCT  EQU   IOCOM+2
IOCVOICT EQU   IOCOM
IRTEND   EQU   IRT+128
IRTRSV0B EQU   IRT+124
IRTCHNSV EQU   IRT+120
IRTSNSCT EQU   IRT+116
IRTLCHAD EQU   IRT+112
IRTSTSSV EQU   IRT+108
IRTINTSV EQU   IRT+104
IRTCCHSV EQU   IRT+100
IRTATTSV EQU   IRT+96
IRTFRRWA EQU   IRT+92
IRTNSRB  EQU   IRT+88
IRTCSME  EQU   IRT+84
IRTPRGSV EQU   IRT+80
IRTPCISV EQU   IRT+76
IRTSENSV EQU   IRT+72
IRTDIESV EQU   IRT+68
IRTRSTSV EQU   IRT+64
IRTSTASV EQU   IRT+60
IRTSIOSV EQU   IRT+56
IRTDDSV  EQU   IRT+52
IRTTCHSV EQU   IRT+48
IRTRTNSV EQU   IRT+40
IRTRSV01 EQU   IRT+36
IRTPSTSV EQU   IRT+28
IRTNIOQ  EQU   IRT+24
IRTCHNL  EQU   IRT+20
IRTIOQ   EQU   IRT+16
IRTLCH   EQU   IRT+12
IRTUCB   EQU   IRT+8
@NM00114 EQU   IRT+7
IRTCMRST EQU   IRT+6
IRTCCH   EQU   IRT+5
IRTSYMSK EQU   IRT+4
@NM00113 EQU   IRTENTRY+3
IRTCSINT EQU   IRTENVR
IRTPINT  EQU   IRTENVR
IRTHIO   EQU   IRTENVR
IRTRSTI  EQU   IRTENVR
IRTCRHIN EQU   IRTENVR
IRTSHTP  EQU   IRTENVR
IRTSLIHA EQU   IRTENVR
IRTCHENT EQU   IRTENVR
@NM00112 EQU   IRTFLB
IRTCCHWA EQU   IRTFLB
IRT12GT  EQU   IRTFLB
IRTSMGR  EQU   IRTFLB
IRTCHBSY EQU   IRTFLB
IRTPCISW EQU   IRTFLB
IRTSKRST EQU   IRTFLB
IRTNRST  EQU   IRTFLB
IRTSSIGP EQU   IRTFLA
IRTSLISN EQU   IRTFLA
IRTIOQA  EQU   IRTFLA
IRTALCK  EQU   IRTFLA
IRTCLCK  EQU   IRTFLA
IRTSLCK  EQU   IRTFLA
IRTLLCK  EQU   IRTFLA
IRTULCK  EQU   IRTFLA
@NM00111 EQU   VMVUSER
VMVPROCD EQU   VMVUSER
VMVVUNTP EQU   VMVRQBLK+44
@NM00110 EQU   VMVMINFO+1
@NM00109 EQU   VMVACTON
VMVRTAIN EQU   VMVACTON
VMVDSMT  EQU   VMVACTON
VMVKEEP  EQU   VMVACTON
VMVRETCD EQU   VMVRQBLK+36
VMVJSNMP EQU   VMVRQBLK+32
VMVDSNMP EQU   VMVRQBLK+28
VMVJBNMP EQU   VMVRQBLK+24
VMVMVLSR EQU   VMVRQBLK+18
VMVUVLSR EQU   VMVRQBLK+12
@NM00108 EQU   VMVRQBLK+8
VMVNREQP EQU   VMVRQBLK+4
VMVOPTB4 EQU   VMVFNMAP+3
@NM00107 EQU   VMVOPTB3
VMVNUMSG EQU   VMVOPTB3
VMVCUVOL EQU   VMVOPTB3
VMVDUPVL EQU   VMVOPTB3
VMVNSPVT EQU   VMVOPTB2
VMVNSLTP EQU   VMVOPTB2
VMVSLTAP EQU   VMVOPTB2
VMVNLTAP EQU   VMVOPTB2
VMVALTAP EQU   VMVOPTB2
VMVSTRG  EQU   VMVOPTB2
VMVPUBLC EQU   VMVOPTB2
VMVPRIVT EQU   VMVOPTB2
VMVVDEND EQU   VMVOPTB1
VMVVRLBL EQU   VMVOPTB1
VMVDWTOR EQU   VMVOPTB1
VMVMTMSG EQU   VMVOPTB1
VMVMOUNT EQU   VMVOPTB1
VMVREWND EQU   VMVOPTB1
ESTARSVI EQU   ESTAFGRS+1
@NM00106 EQU   ESTAFLG2
ESTABRNT EQU   ESTAFLG2
@NM00105 EQU   ESTAFLG2
ESTAEREC EQU   ESTAFLG2
ESTATERM EQU   ESTAFLG2
@NM00104 EQU   ESTAFLG2
ESTAOWNR EQU   ESTA+8
ESTAPARM EQU   ESTA+4
ESTAEXIT EQU   ESTAEXT+1
ESTAHALT EQU   ESTAIO
ESTANOIO EQU   ESTAIO
ESTASYNC EQU   ESTAFLG1
@NM00103 EQU   ESTAFLG1
ESTAESTA EQU   ESTAFLG1
@NM00102 EQU   ESTAFLG1
ESTASTAR EQU   ESTAFLG1
ESTASTAI EQU   ESTAFLG1
UCMEFRV1 EQU   UCMEFEXT+8
UCMEFSA1 EQU   UCMEFEXT+3
UCMEFATT EQU   UCMEFEXT+2
UCMEFLG2 EQU   UCMEFEXT+1
UCMEFLGH EQU   UCMEFLG1
UCMEFLGG EQU   UCMEFLG1
UCMEFLGF EQU   UCMEFLG1
UCMEFLGE EQU   UCMEFLG1
UCMEFLGD EQU   UCMEFLG1
UCMEFLGC EQU   UCMEFLG1
UCMEFLGB EQU   UCMEFLG1
UCMEFLGA EQU   UCMEFLG1
UCMPEDUM EQU   UCMPEXTA+60
UCMPELST EQU   UCMPEXTA+56
UCMPELEN EQU   UCMPEXTA+52
UCMPE1ST EQU   UCMPEXTA+48
UCMPRSV2 EQU   UCMPEXTA+20
UCMPRSV1 EQU   UCMPDM1+12
UCMPNCC  EQU   UCMPDM1+8
UCMPNMCC EQU   UCMPDM1+4
UCMPWQE  EQU   UCMPDM1
UCMPUCMP EQU   UCMPEXTA
UCMFELST EQU   UCMFEXTA+48
UCMFELEN EQU   UCMFEXTA+44
UCMFE1ST EQU   UCMFEXTA+40
UCMFATCN EQU   UCMFEXTA+36
UCMFRAD  EQU   UCMFRECB+1
UCMFRB0  EQU   UCMFRBYT
UCMFXECB EQU   UCMFECBL
UCMFRSV3 EQU   UCMFEXTA+20
UCMF80WQ EQU   UCMFEXTA+18
UCMF60WQ EQU   UCMFEXTA+16
UCMFRSV2 EQU   UCMFMGFS+4
UCMFRSV1 EQU   UCMFMGFS+2
UCMFFLG2 EQU   UCMFMGFS+1
UCMFBR07 EQU   UCMFFLG1
UCMFBR06 EQU   UCMFFLG1
UCMFBR05 EQU   UCMFFLG1
UCMFBR04 EQU   UCMFFLG1
UCMFBR03 EQU   UCMFFLG1
UCMFMSGN EQU   UCMFFLG1
UCMFMSGA EQU   UCMFFLG1
UCMFMSGE EQU   UCMFFLG1
UCMFUCMF EQU   UCMFEXTA
UCMDESCD EQU   UCMEXIT+132
UCMROUTC EQU   UCMEXIT+128
UCMMSTXT EQU   UCMEXIT
UCMRSV64 EQU   UCMLIST+76
UCMRCTA  EQU   UCMRCT+1
UCMRSV31 EQU   UCMSDS5
UCMSDS5G EQU   UCMSDS5
UCMSDS5F EQU   UCMSDS5
UCMRSV30 EQU   UCMSDS5
UCMRSV29 EQU   UCMSDS5
UCMSDS5C EQU   UCMSDS5
UCMSDS5B EQU   UCMSDS5
UCMSDS5A EQU   UCMSDS5
UCMMLAST EQU   UCMLIST+64
UCMVHRSN EQU   UCMDEVC
UCMDEVG  EQU   UCMDEVC
UCMDEVF  EQU   UCMDEVC
UCMDEVE  EQU   UCMDEVC
UCMDEVD  EQU   UCMDEVC
UCMDEVCC EQU   UCMDEVC
UCMDEVB  EQU   UCMDEVC
UCMDEVA  EQU   UCMDEVC
UCMXOR   EQU   UCMLIST+62
UCMMSG2  EQU   UCMMSG+1
UCMRSV27 EQU   UCMMSG1
UCMRSV26 EQU   UCMMSG1
UCMMSGF  EQU   UCMMSG1
UCMRSV71 EQU   UCMMSG1
UCMMSGD  EQU   UCMMSG1
UCMRSV70 EQU   UCMMSG1
UCMMSGB  EQU   UCMMSG1
UCMMSGA  EQU   UCMMSG1
UCMCOMPC EQU   UCMLIST+56
UCMWLAST EQU   UCMLIST+52
UCMOAOEN EQU   UCMLIST+48
UCMALTEN EQU   UCMLIST+44
UCMRV007 EQU   UCMDISP2
UCMRV006 EQU   UCMDISP2
UCMRV005 EQU   UCMDISP2
UCMRV004 EQU   UCMDISP2
UCMRV003 EQU   UCMDISP2
UCMDISPK EQU   UCMDISP2
UCMDISPJ EQU   UCMDISP2
UCMDISPI EQU   UCMDISP2
UCMDISPH EQU   UCMDISP1
UCMDISPG EQU   UCMDISP1
UCMDISPF EQU   UCMDISP1
UCMDISPE EQU   UCMDISP1
UCMDISPD EQU   UCMDISP1
UCMDISPC EQU   UCMDISP1
UCMDISPB EQU   UCMDISP1
UCMDISPA EQU   UCMDISP1
UCMAUTHB EQU   UCMAUTH+1
UCMRSV23 EQU   UCMAUTHA
UCMRSV22 EQU   UCMAUTHA
UCMRSV21 EQU   UCMAUTHA
UCMRSV20 EQU   UCMAUTHA
UCMRSV19 EQU   UCMAUTHA
UCMAUTH3 EQU   UCMAUTHA
UCMAUTH2 EQU   UCMAUTHA
UCMAUTH1 EQU   UCMAUTHA
UCMOUTQ  EQU   UCMLIST+36
UCMRSV18 EQU   UCMLIST+34
UCMRTCD  EQU   UCMLIST+32
UCMXB    EQU   UCMLIST+28
@NM00101 EQU   UCMXA+1
UCMRSV17 EQU   UCMATR
UCMRSV16 EQU   UCMATR
UCMAT04  EQU   UCMATR
UCMLF    EQU   UCMATR
UCMUF    EQU   UCMATR
UCMXF    EQU   UCMATR
UCMIF    EQU   UCMATR
UCMOF    EQU   UCMATR
UCMTC    EQU   UCMSTS
UCMTD    EQU   UCMSTS
UCMTB    EQU   UCMSTS
UCMTA    EQU   UCMSTS
UCMCF    EQU   UCMSTS
UCMBF    EQU   UCMSTS
UCMPF    EQU   UCMSTS
UCMAF    EQU   UCMSTS
UCMNAME  EQU   UCMLIST+16
UCMUCB   EQU   UCMLIST+12
UCMDCB   EQU   UCMLIST+8
UCMSBR   EQU   UCMLIST+4
UCMECB   EQU   UCMLIST
UCMDECBA EQU   UCMEIL+20
UCMOECBA EQU   UCMEIL+16
UCMAECBA EQU   UCMEIL+12
UCMXECBA EQU   UCMEIL+8
UCMNIPTR EQU   UCMEIL+4
UCMRSV15 EQU   UCMEIL+3
UCMRTCT  EQU   UCMEIL+2
UCMRPYL  EQU   UCMEIL+1
@NM00100 EQU   UCMEIL
UCMRSV62 EQU   UCM+304
UCMRSV60 EQU   UCM+302
UCMRSV59 EQU   UCMRSV51
UCMRSV58 EQU   UCMRSV51
UCMRSV57 EQU   UCMRSV51
UCMRSV56 EQU   UCMRSV51
UCMRSV55 EQU   UCMRSV51
UCMRSV54 EQU   UCMRSV51
UCMRSV53 EQU   UCMRSV51
UCMRSV52 EQU   UCMRSV51
UCMRSV50 EQU   UCMRSV42
UCMRSV49 EQU   UCMRSV42
UCMRSV48 EQU   UCMRSV42
UCMRSV47 EQU   UCMRSV42
UCMRSV46 EQU   UCMRSV42
UCMRSV45 EQU   UCMRSV42
UCMRSV44 EQU   UCMRSV42
UCMRSV43 EQU   UCMRSV42
UCMJES3T EQU   UCM+296
UCMWAKUP EQU   UCM+292
UCMFRRAD EQU   UCM+288
UCMSWCH  EQU   UCM+284
UCMASCB  EQU   UCM+280
UCMWQECP EQU   UCM+276
UCMORECP EQU   UCM+272
UCMOECBT EQU   UCM+268
UCMOECBH EQU   UCM+264
UCMWECBT EQU   UCM+260
UCMWECBH EQU   UCM+256
UCMMBEND EQU   UCM+252
UCMCTID  EQU   UCM+250
UCMRSV61 EQU   UCM+248
UCMRP2AD EQU   UCM+244
UCMBFEXT EQU   UCM+240
UCMWQLM1 EQU   UCM+238
UCMRV001 EQU   UCM+237
UCMRQLM1 EQU   UCM+236
UCMMBPTR EQU   UCM+232
UCMMQNXT EQU   UCM+228
UCMMQEND EQU   UCM+224
UCMMQPTR EQU   UCM+220
UCMTRECB EQU   UCM+216
UCMMNECB EQU   UCM+212
UCMMNTR  EQU   UCM+208
UCMR9SV  EQU   UCM+204
UCMSAVE4 EQU   UCM+140
UCMRSV77 EQU   UCM+84
UCMVEL   EQU   UCMVDATA+8
UCMVEZ   EQU   UCMVDATA+4
UCMVEA   EQU   UCMVDATA
UCMRSV76 EQU   UCM+71
UCMRSV67 EQU   UCM+70
UCMRSV75 EQU   UCM+69
UCMFIX   EQU   UCMMODE
UCMMCS   EQU   UCMMODE
UCMOGCE  EQU   UCMMODE
UCMAMFA  EQU   UCMMODE
UCMRSV14 EQU   UCMMODE
UCMTPUTA EQU   UCMMODE
UCMRSV66 EQU   UCMMODE
UCMRSV11 EQU   UCMMODE
UCMPXA   EQU   UCM+64
UCMWQEND EQU   UCM+60
UCMWQNR  EQU   UCM+58
UCMRQNR  EQU   UCM+56
UCMWQECB EQU   UCM+52
UCMRQECB EQU   UCM+48
UCMWQLM  EQU   UCM+46
UCMRQLM  EQU   UCM+45
@NM00099 EQU   UCMRPYI
UCMRPYQ  EQU   UCM+28
UCMWTOQ  EQU   UCM+24
UCMLSTP  EQU   UCM+20
UCMARECB EQU   UCM+16
UCMLECB  EQU   UCMDECB
UCMOECB  EQU   UCM+8
UCMAECB  EQU   UCM+4
UCMXECB  EQU   UCM
UCMRSV65 EQU   UCMPRFX+158
UCMSDS2  EQU   UCMPRFX+157
UCMRSV09 EQU   UCMSDS1
UCMRSV08 EQU   UCMSDS1
UCMRSV07 EQU   UCMSDS1
UCMRSV06 EQU   UCMSDS1
UCMRSV05 EQU   UCMSDS1
UCMRSV04 EQU   UCMSDS1
UCMSDS1B EQU   UCMSDS1
UCMSDS1A EQU   UCMSDS1
UCMRSV72 EQU   UCMPRFX+152
UCMLOGAD EQU   UCMPRFX+148
UCMNPECB EQU   UCMPRFX+144
UCMRSV69 EQU   UCMPRFX+140
UCMSWSA2 EQU   UCMPRFX+136
UCMSWSA1 EQU   UCMPRFX+132
UCMQRTN  EQU   UCMPRFX+128
UCM6WD   EQU   UCMXSA+20
UCM5WD   EQU   UCMXSA+16
UCM4WD   EQU   UCMXSA+12
UCM3WD   EQU   UCMXSA+8
UCM2WD   EQU   UCMXSA+4
UCM1WD   EQU   UCMXSA
UCMRSV03 EQU   UCMPRFX+102
UCMHRDRT EQU   UCMPRFX+100
UCMUEXIT EQU   UCMPRFX+97
UCMXCT   EQU   UCMPRFX+96
UCMHCUCM EQU   UCMPRFX+92
UCMCMID  EQU   UCMPRFX+88
UCMOWTOR EQU   UCMPRFX+86
UCMSYSP  EQU   UCMSFLG2
UCMSYSO  EQU   UCMSFLG2
UCMSYSN  EQU   UCMSFLG2
UCMSYSM  EQU   UCMSFLG2
UCMSYSL  EQU   UCMSFLG2
UCMSYSK  EQU   UCMSFLG2
UCMSYSJ  EQU   UCMSFLG2
UCMSYSI  EQU   UCMSFLG2
UCMRSV35 EQU   UCMSFLG1
UCMSYSG  EQU   UCMSFLG1
UCMSYSF  EQU   UCMSFLG1
UCMSYSE  EQU   UCMSFLG1
UCMSYSD  EQU   UCMSFLG1
UCMSYSC  EQU   UCMSFLG1
UCMSYSB  EQU   UCMSFLG1
UCMRSV01 EQU   UCMSFLG1
UCMWTOX  EQU   UCMPRFX+80
UCMDOME  EQU   UCMPRFX+76
UCMSVR0  EQU   UCMSAVE0+68
UCMSVQ0  EQU   UCMSAVE0+64
UCMSVP0  EQU   UCMSAVE0+60
UCMSVO0  EQU   UCMSAVE0+56
UCMSVN0  EQU   UCMSAVE0+52
UCMSVM0  EQU   UCMSAVE0+48
UCMSVL0  EQU   UCMSAVE0+44
UCMSVK0  EQU   UCMSAVE0+40
UCMSVJ0  EQU   UCMSAVE0+36
UCMSVI0  EQU   UCMSAVE0+32
UCMSVH0  EQU   UCMSAVE0+28
UCMSVG0  EQU   UCMSAVE0+24
UCMSVF0  EQU   UCMSAVE0+20
UCMSVE0  EQU   UCMSAVE0+16
UCMSVD0  EQU   UCMSAVE0+12
UCMSVC0  EQU   UCMSAVE0+8
UCMSVB0  EQU   UCMSAVE0+4
UCMSVA0  EQU   UCMSAVE0
UCMRSV74 EQU   UCM2EXT+20
UCMRSV73 EQU   UCM2EXT+16
UCM2STAA EQU   UCM2STA+1
UCMRV008 EQU   UCM2SFLG
UCMRSV34 EQU   UCM2SFLG
UCMRSV33 EQU   UCM2SFLG
UCM2WTOI EQU   UCM2SFLG
UCM2DSTR EQU   UCM2SFLG
UCM2DTAK EQU   UCM2SFLG
UCM2SENT EQU   UCM2SFLG
UCM2SDWA EQU   UCM2SFLG
UCM2PST  EQU   UCM2EXT+4
UCM2RID  EQU   UCM2EXT+2
UCM2WID  EQU   UCM2EXT
UCBERADR EQU   UCBUCS+12
UCBFCBID EQU   UCBUCS+8
UCBERCNT EQU   UCBUCS+7
UCBRSV51 EQU   UCBUCS+6
UCBFCBPE EQU   UCBFCBOP
UCBRSV49 EQU   UCBFCBOP
UCBRSV48 EQU   UCBFCBOP
UCBRSV47 EQU   UCBFCBOP
UCBRSV46 EQU   UCBFCBOP
UCBRSV45 EQU   UCBFCBOP
UCBRSV44 EQU   UCBFCBOP
UCBFCBO1 EQU   UCBFCBOP
UCBUCSPE EQU   UCBUCSOP
UCBRSV43 EQU   UCBUCSOP
UCBRSV42 EQU   UCBUCSOP
UCBRSV41 EQU   UCBUCSOP
UCBRSV40 EQU   UCBUCSOP
UCBRSV39 EQU   UCBUCSOP
UCBUCSO2 EQU   UCBUCSOP
UCBUCSO1 EQU   UCBUCSOP
UCBUCSID EQU   UCBUCS
UCBMDRBA EQU   UCBMDRBF+1
UCBRV075 EQU   UCBMDRBF
UCBRV074 EQU   UCB3800X+32
UCBIMAGE EQU   UCB3800X+28
UCBFCBNM EQU   UCB3800X+24
UCBCHAR4 EQU   UCB3800X+20
UCBCHAR3 EQU   UCB3800X+16
UCBCHAR2 EQU   UCB3800X+12
UCBCHAR1 EQU   UCB3800X+8
UCBCGMID EQU   UCB3800X+4
UCBBRSTA EQU   UCBACTIV
UCBRV063 EQU   UCBACTIV
UCBRV062 EQU   UCBACTIV
UCBRV061 EQU   UCBACTIV
UCBRV060 EQU   UCBACTIV
UCBRV059 EQU   UCBACTIV
UCBRV058 EQU   UCBACTIV
UCBRV057 EQU   UCBACTIV
UCBRV050 EQU   UCB3800X+2
UCBCGMNO EQU   UCB3800X+1
UCBRV083 EQU   UCBOPTNS
UCBBRSTR EQU   UCBOPTNS
UCBRV056 EQU   UCBOPTNS
UCBRV055 EQU   UCBOPTNS
UCBRV054 EQU   UCBOPTNS
UCBRV053 EQU   UCBOPTNS
UCBRV052 EQU   UCBOPTNS
UCBRV051 EQU   UCBOPTNS
UCBRV073 EQU   UCB3540X+7
UCBRV072 EQU   UCBDKBYT
UCBRV071 EQU   UCBDKBYT
UCBRV070 EQU   UCBDKBYT
UCBRV069 EQU   UCBDKBYT
UCBRV068 EQU   UCBDKBYT
UCBRV067 EQU   UCBDKBYT
UCBVLVER EQU   UCBDKBYT
UCBDKAMX EQU   UCBDKBYT
UCBVLSER EQU   UCB3540X
UCBRDATA EQU   UCBOCR+4
UCBFRID  EQU   UCBOCR
UCBCLN   EQU   UCBMT+14
UCBERG   EQU   UCBMT+12
UCBMS    EQU   UCBMT+11
UCBNB    EQU   UCBMT+10
UCBPW    EQU   UCBMT+9
UCBPR    EQU   UCBMT+8
UCBSIO   EQU   UCBMT+6
UCBTW    EQU   UCBMT+5
UCBTR    EQU   UCBMT+4
UCBTWT   EQU   UCBMT+3
UCBTRT   EQU   UCBMT+2
UCBCTD   EQU   UCBMT
UCBWTOID EQU   UCBCMEXT+17
UCBMIHTI EQU   UCBMIHBY
UCBMIHT2 EQU   UCBMIHBY
UCBMIHT1 EQU   UCBMIHBY
UCBMIHPB EQU   UCBMIHBY
UCBMIHSF EQU   UCBMIHBY
UCBASID  EQU   UCBCMEXT+14
UCBMFCNT EQU   UCBCMEXT+12
UCBPMSK  EQU   UCBCMEXT+10
UCBRV041 EQU   UCBCMEXT+6
UCBRV036 EQU   UCBFLP1
UCBRV035 EQU   UCBFLP1
UCBSWAPF EQU   UCBFLP1
UCBINHIO EQU   UCBFLP1
UCBNSWAP EQU   UCBFLP1
UCBSHRUP EQU   UCBFLP1
UCBNSRCH EQU   UCBFLP1
UCBSNSCT EQU   UCBCMEXT+4
UCBHPDV  EQU   @NM00098
UCBHALI  EQU   @NM00098
UCBRSV09 EQU   @NM00098
UCBRSV08 EQU   @NM00098
UCBRSV07 EQU   @NM00098
UCBRSV06 EQU   @NM00098
UCBRSV05 EQU   @NM00098
UCBRSV04 EQU   @NM00098
UCBDTI   EQU   UCBCMEXT+2
UCBSTI   EQU   UCBCMEXT+1
UCBETI   EQU   UCBCMEXT
UCBEXTP  EQU   UCBEXTPT+1
UCBDDRSW EQU   UCBFLC
UCBTICBT EQU   UCBFLC
UCBIVRR  EQU   UCBFLC
UCBIVRS  EQU   UCBFLC
UCBITF   EQU   UCBFLC
UCBUDE   EQU   UCBFLC
UCBWAA   EQU   UCBFLC
UCBATTP  EQU   UCBFLC
UCBUNTYP EQU   UCBTBYT4
UCBRSV11 EQU   UCBDVCLS
UCBRSV10 EQU   UCBDVCLS
UCB3CHAR EQU   UCBDVCLS
UCB3UREC EQU   UCBDVCLS
UCB3DISP EQU   UCBDVCLS
UCBDVPWR EQU   UCB2OPT7
UCBVLPWR EQU   UCB2OPT6
UCB2OPT5 EQU   UCBTBYT2
UCBRVDEV EQU   UCBRWTAU
UCBRPS   EQU   UCBDUDN2
UCBRR    EQU   UCBDUDN1
UCB2OPT1 EQU   UCBTBYT2
UCB2OPT0 EQU   UCBTBYT2
UCB1FEA7 EQU   UCBTBYT1
UCBD6250 EQU   UCB1FEA6
UCBD1600 EQU   UCB1FEA5
UCB1FEA4 EQU   UCBTBYT1
UCB1FEA3 EQU   UCBTBYT1
UCB1FEA2 EQU   UCBTBYT1
UCB1FEA1 EQU   UCBTBYT1
UCB1FEA0 EQU   UCBTBYT1
UCBRV029 EQU   UCBWGT
UCBREW   EQU   UCBWGT
UCBPUB   EQU   UCBWGT
UCBOUT   EQU   UCBWGT
UCBIN    EQU   UCBWGT
UCBLCI   EQU   UCBOB+10
UCBCNT   EQU   UCBOB+9
UCBRV017 EQU   UCBCHM1
UCBRV016 EQU   UCBCHM1
UCBRV015 EQU   UCBCHM1
UCBRV014 EQU   UCBCHM1
UCBSPB   EQU   UCBPTH1
UCBPPB   EQU   UCBPTH1
UCBSPA   EQU   UCBPTH0
UCBPPA   EQU   UCBPTH0
UCBSIGP  EQU   UCBFLB
UCBCRHSN EQU   UCBFLB
UCBRESVH EQU   UCBFLB
UCBSPST  EQU   UCBFLB
UCBASNS  EQU   UCBFLB
UCBQISCE EQU   UCBFL1
UCBSAP   EQU   UCBFL1
UCBNOTRC EQU   UCBCUB
UCBUSING EQU   UCBPST
UCBNOTRD EQU   UCBNRY
UCBBUSYD EQU   UCBBSY
UCBUA    EQU   UCBCHAN+1
UCBDADI  EQU   UCBSTAT
UCBPRES  EQU   UCBSTAT
UCBUNLD  EQU   UCBSTAT
UCBID    EQU   UCBOB+2
UCBALTPH EQU   UCBFL5
UCBALTCU EQU   UCBFL5
UCBENVRD EQU   UCBFL5
UCBVSDR  EQU   UCBFL5
UCBSASK  EQU   UCBFL5
UCBAMV   EQU   UCBAF
UCBDCC   EQU   UCBFL5
UCBMONT  EQU   UCBJBNR
UCBRV011 EQU   UCBJBNR
UCBMMSGP EQU   UCBJBNR
UCBOLDSM EQU   UCBJBNR
UCBRV003 EQU   UCBJBNR
UCBDUC   EQU   UCBJBNR
UCBJES3  EQU   UCBJBNR
UCBVRDEV EQU   UCBJBNR
UCBCMSEG EQU   UCBOB
UCBPFXND EQU   UCB+512
UCBIOQ   EQU   UCB+508
UCBLOCK  EQU   UCB+504
UCBPXST  EQU   UCB+504
@NM00095 EQU   UCB
@NM00094 EQU   SDWA+512
@NM00093 EQU   SDWADPVA
SDWAEBC  EQU   SDWADPVA
SDWAVRAL EQU   SDWARA
@NM00092 EQU   SDWA+396
SDWACOMP EQU   SDWA+392
SDWARCPL EQU   SDWA+364
@NM00091 EQU   SDWADPSA+32
SDWATO4  EQU   SDWADPSL+28
SDWAFRM4 EQU   SDWADPSL+24
SDWATO3  EQU   SDWADPSL+20
SDWAFRM3 EQU   SDWADPSL+16
SDWATO2  EQU   SDWADPSL+12
SDWAFRM2 EQU   SDWADPSL+8
SDWATO1  EQU   SDWADPSL+4
SDWAFRM1 EQU   SDWADPSL
@NM00090 EQU   SDWADDAT+3
@NM00089 EQU   SDWAPDAT
SDWAUSPL EQU   SDWAPDAT
SDWADPSW EQU   SDWAPDAT
SDWATJPA EQU   SDWAPDAT
SDWATLPA EQU   SDWAPDAT
SDWADREG EQU   SDWAPDAT
SDWADSAH EQU   SDWAPDAT
SDWADSAS EQU   SDWAPDAT
@NM00088 EQU   SDWADDAT+1
@NM00087 EQU   SDWASDAT
SDWAQQS  EQU   SDWASDAT
SDWACBS  EQU   SDWASDAT
SDWAGTF  EQU   SDWASDAT
SDWASWA  EQU   SDWASDAT
SDWALSQA EQU   SDWASDAT
SDWASQA  EQU   SDWASDAT
SDWANUC  EQU   SDWASDAT
@NM00086 EQU   SDWADUMP+2
@NM00085 EQU   SDWADPFS
SDWASLST EQU   SDWADPFS
@NM00084 EQU   SDWADPFS
SDWADLST EQU   SDWADPFS
SDWADPT  EQU   SDWADPFS
SDWADPID EQU   SDWADUMP
SDWADPLA EQU   SDWA+316
SDWAREXN EQU   SDWARECP+16
@NM00083 EQU   SDWA+290
SDWAASID EQU   SDWA+288
SDWATALW EQU   SDWALKWS+28
SDWATDLW EQU   SDWALKWS+24
SDWATNLW EQU   SDWALKWS+20
SDWAAPLW EQU   SDWALKWS+16
SDWAIPLW EQU   SDWALKWS+12
SDWAILLW EQU   SDWALKWS+8
SDWAIULW EQU   SDWALKWS+4
SDWAICLW EQU   SDWALKWS
SDWAFLLK EQU   SDWAACF4
SDWACMS  EQU   SDWAACF4
SDWAOPTM EQU   SDWAACF4
SDWATADB EQU   SDWAACF4
SDWATDNB EQU   SDWAACF4
SDWATNCB EQU   SDWAACF4
SDWAILCH EQU   SDWAACF4
SDWAIUCB EQU   SDWAACF4
SDWAICAT EQU   SDWAACF3
SDWAIPRG EQU   SDWAACF3
SDWASALL EQU   SDWAACF3
SDWAASMP EQU   SDWAACF3
SDWADISP EQU   SDWAACF3
@NM00082 EQU   SDWAACF3
@NM00081 EQU   SDWAACF2
SDWAFREE EQU   SDWAACF2
SDWAUPRG EQU   SDWAACF2
@NM00080 EQU   SDWAACF2
SDWASPIN EQU   SDWAACF2
@NM00079 EQU   SDWAACF2
SDWALCPU EQU   SDWACPUA+2
@NM00078 EQU   SDWACPUA
SDWARECA EQU   SDWA+244
SDWARTYA EQU   SDWA+240
@NM00077 EQU   SDWA+239
@NM00076 EQU   SDWAIOFS
SDWANIOP EQU   SDWAIOFS
SDWANOIO EQU   SDWAIOFS
SDWAIOHT EQU   SDWAIOFS
SDWAIOQR EQU   SDWAIOFS
SDWAFMID EQU   SDWA+236
@NM00075 EQU   SDWAERRD
SDWAMCIV EQU   SDWAERRD
SDWARPIV EQU   SDWAERRD
SDWAMABD EQU   SDWAERRD
SDWACTS  EQU   SDWAERRD
SDWASTAE EQU   SDWAERRD
SDWANRBE EQU   SDWAERRD
SDWACLUP EQU   SDWAERRD
@NM00074 EQU   SDWAERRC
SDWAEAS  EQU   SDWAERRC
SDWAPERC EQU   SDWAERRC
SDWAIRB  EQU   SDWAERRC
SDWASTAI EQU   SDWAERRC
SDWASTAF EQU   SDWAERRC
SDWASRBM EQU   SDWAERRB
SDWALDIS EQU   SDWAERRB
SDWAENRB EQU   SDWAERRB
SDWATYP1 EQU   SDWAERRB
@NM00073 EQU   SDWAERRB
SDWAPGIO EQU   SDWAERRA
SDWATEXC EQU   SDWAERRA
SDWASVCE EQU   SDWAERRA
SDWAABTM EQU   SDWAERRA
SDWASVCD EQU   SDWAERRA
SDWARKEY EQU   SDWAERRA
SDWAPCHK EQU   SDWAERRA
SDWAMCHK EQU   SDWAERRA
SDWATIME EQU   SDWAMCH+20
SDWARFSA EQU   SDWAMCH+16
@NM00072 EQU   SDWAMCH+14
SDWAVEQR EQU   SDWARSR2
SDWAPGFX EQU   SDWARSR2
SDWAFLSQ EQU   SDWARSR2
SDWAFSQA EQU   SDWARSR2
SDWANUCL EQU   SDWARSR2
SDWASPER EQU   SDWARSR2
SDWAINTC EQU   SDWARSR2
SDWAOFLN EQU   SDWARSR2
SDWACHNG EQU   SDWARSR1
SDWAMSER EQU   SDWARSR1
@NM00071 EQU   SDWARSR1
SDWACPID EQU   SDWAMCH+10
SDWATERR EQU   SDWAMCHD
SDWAFPRX EQU   SDWAMCHD
SDWAINSF EQU   SDWAMCHD
SDWAACR  EQU   SDWAMCHD
SDWASCK  EQU   SDWAMCHD
SDWAPSWU EQU   SDWAMCHD
SDWAREGU EQU   SDWAMCHD
SDWASKYF EQU   SDWAMCHD
@NM00070 EQU   SDWAMCHS
SDWARSRF EQU   SDWAMCHS
SDWARSRC EQU   SDWAMCHS
SDWAINVP EQU   SDWAMCHS
SDWATSVL EQU   SDWAMCHS
SDWARCDF EQU   SDWAMCHS
SDWASRVL EQU   SDWAMCHS
SDWASCKE EQU   SDWASTCK+4
SDWASCKB EQU   SDWASTCK
SDWALNTH EQU   SDWAIDNT+1
SDWASPID EQU   SDWAIDNT
SDWASR15 EQU   SDWASRSV+60
SDWASR14 EQU   SDWASRSV+56
SDWASR13 EQU   SDWASRSV+52
SDWASR12 EQU   SDWASRSV+48
SDWASR11 EQU   SDWASRSV+44
SDWASR10 EQU   SDWASRSV+40
SDWASR09 EQU   SDWASRSV+36
SDWASR08 EQU   SDWASRSV+32
SDWASR07 EQU   SDWASRSV+28
SDWASR06 EQU   SDWASRSV+24
SDWASR05 EQU   SDWASRSV+20
SDWASR04 EQU   SDWASRSV+16
SDWASR03 EQU   SDWASRSV+12
SDWASR02 EQU   SDWASRSV+8
SDWASR01 EQU   SDWASRSV+4
SDWASR00 EQU   SDWASRSV
SDWATRN2 EQU   SDWAAEC2+4
SDWAIPC2 EQU   SDWAICD2
SDWAIMC2 EQU   SDWAICD2
SDWAIPR2 EQU   SDWAICD2
@NM00069 EQU   SDWAINC2
@NM00068 EQU   SDWAILC2
SDWAIL2  EQU   SDWAILC2
@NM00067 EQU   SDWAILC2
@NM00066 EQU   SDWAAEC2
SDWAADD2 EQU   SDWANXT2+1
@NM00065 EQU   SDWANXT2
@NM00064 EQU   SDWAEC2+3
SDWASGN2 EQU   SDWAINT2
SDWAEXP2 EQU   SDWAINT2
SDWADEC2 EQU   SDWAINT2
SDWAFPO2 EQU   SDWAINT2
SDWACC2  EQU   SDWAINT2
@NM00063 EQU   SDWAINT2
SDWAPGM2 EQU   SDWAMWP2
SDWAWAT2 EQU   SDWAMWP2
SDWAMCK2 EQU   SDWAMWP2
SDWAECT2 EQU   SDWAMWP2
SDWAKEY2 EQU   SDWAMWP2
SDWAEXT2 EQU   SDWAEMK2
SDWAIO2  EQU   SDWAEMK2
SDWATRM2 EQU   SDWAEMK2
@NM00062 EQU   SDWAEMK2
SDWAPER2 EQU   SDWAEMK2
@NM00061 EQU   SDWAEMK2
SDWATRAN EQU   SDWAAEC1+4
SDWAIPC1 EQU   SDWAICD1
SDWAIMC1 EQU   SDWAICD1
SDWAIPR1 EQU   SDWAICD1
@NM00060 EQU   SDWAINC1
@NM00059 EQU   SDWAILC1
SDWAIL1  EQU   SDWAILC1
@NM00058 EQU   SDWAILC1
@NM00057 EQU   SDWAAEC1
SDWAADD1 EQU   SDWANXT1+1
@NM00056 EQU   SDWANXT1
@NM00055 EQU   SDWAEC1+3
SDWASGN1 EQU   SDWAINT1
SDWAEXP1 EQU   SDWAINT1
SDWADEC1 EQU   SDWAINT1
SDWAFPO1 EQU   SDWAINT1
SDWACC1  EQU   SDWAINT1
@NM00054 EQU   SDWAINT1
SDWAPGM1 EQU   SDWAMWP1
SDWAWAT1 EQU   SDWAMWP1
SDWAMCK1 EQU   SDWAMWP1
SDWAECT1 EQU   SDWAMWP1
SDWAKEY1 EQU   SDWAMWP1
SDWAEXT1 EQU   SDWAEMK1
SDWAIO1  EQU   SDWAEMK1
SDWATRM1 EQU   SDWAEMK1
@NM00053 EQU   SDWAEMK1
SDWAPER1 EQU   SDWAEMK1
@NM00052 EQU   SDWAEMK1
SDWAIOBR EQU   SDWA+100
SDWAEPA  EQU   SDWA+96
@NM00051 EQU   SDWANAME+4
SDWARBAD EQU   SDWANAME
SDWAGR15 EQU   SDWAGRSV+60
SDWAGR14 EQU   SDWAGRSV+56
SDWAGR13 EQU   SDWAGRSV+52
SDWAGR12 EQU   SDWAGRSV+48
SDWAGR11 EQU   SDWAGRSV+44
SDWAGR10 EQU   SDWAGRSV+40
SDWAGR09 EQU   SDWAGRSV+36
SDWAGR08 EQU   SDWAGRSV+32
SDWAGR07 EQU   SDWAGRSV+28
SDWAGR06 EQU   SDWAGRSV+24
SDWAGR05 EQU   SDWAGRSV+20
SDWAGR04 EQU   SDWAGRSV+16
SDWAGR03 EQU   SDWAGRSV+12
SDWAGR02 EQU   SDWAGRSV+8
SDWAGR01 EQU   SDWAGRSV+4
SDWAGR00 EQU   SDWAGRSV
SDWANXTP EQU   SDWACTL2+5
SDWASGP  EQU   SDWAPMKP
SDWAEUP  EQU   SDWAPMKP
SDWADOP  EQU   SDWAPMKP
SDWAFPP  EQU   SDWAPMKP
SDWACCP  EQU   SDWAPMKP
SDWAILP  EQU   SDWAPMKP
SDWAINTP EQU   SDWACTL2+2
SDWASPVP EQU   SDWAMWPP
SDWAWATP EQU   SDWAMWPP
SDWAMCKP EQU   SDWAMWPP
@NM00050 EQU   SDWAMWPP
SDWAKEYP EQU   SDWAMWPP
SDWAEXTP EQU   SDWACMKP
SDWAIOP  EQU   SDWACMKP
SDWANXTA EQU   SDWACTL1+5
SDWASGA  EQU   SDWAPMKA
SDWAEUA  EQU   SDWAPMKA
SDWADOA  EQU   SDWAPMKA
SDWAFPA  EQU   SDWAPMKA
SDWACCA  EQU   SDWAPMKA
SDWAILA  EQU   SDWAPMKA
SDWAINTA EQU   SDWACTL1+2
SDWASPVA EQU   SDWAMWPA
SDWAWATA EQU   SDWAMWPA
SDWAMCKA EQU   SDWAMWPA
@NM00049 EQU   SDWAMWPA
SDWAKEYA EQU   SDWAMWPA
SDWAEXTA EQU   SDWACMKA
SDWAIOA  EQU   SDWACMKA
SDWACMPC EQU   SDWAABCC+1
@NM00048 EQU   SDWACMPF
SDWASTCC EQU   SDWACMPF
@NM00047 EQU   SDWACMPF
SDWASTEP EQU   SDWACMPF
SDWAPARM EQU   SDWA
@NM00046 EQU   FRRSFLGS+1
@NM00045 EQU   FRRSFLG1
FRRSNEST EQU   FRRSFLG1
FRRSRCUR EQU   FRRSFLG1
FRRSENTS EQU   FRRS+84
@NM00044 EQU   PSA+3668
@NM00043 EQU   PSA+1048
PSAUSEND EQU   PSA+1048
PSARV062 EQU   PSA+1044
PSAWTCOD EQU   PSA+1036
PSAATCVT EQU   PSA+1032
PSAPCPSW EQU   PSA+1024
PSAPIR2  EQU   PSA+1020
PSARV059 EQU   PSA+1018
PSASVC13 EQU   PSA+1016
PSASFACC EQU   PSA+1008
PSASTOP  EQU   PSA+992
PSASTART EQU   PSA+976
PSARSPSW EQU   PSA+968
PSASRPSW EQU   PSA+960
PSARV045 EQU   PSA+892
PSARV044 EQU   PSA+888
PSARV043 EQU   PSA+884
PSARV042 EQU   PSA+880
PSARV041 EQU   PSA+876
PSARV040 EQU   PSA+872
PSARV025 EQU   PSA+868
PSADSSED EQU   PSA+868
PSADSSPR EQU   PSA+864
PSADSSFW EQU   PSA+860
PSADSS14 EQU   PSA+856
PSADSSPP EQU   PSA+848
PSADSSRP EQU   PSA+840
PSADSS05 EQU   PSADSSF4
PSADSS10 EQU   PSADSSF4
PSADSSVE EQU   PSADSSF4
PSADSSDE EQU   PSADSSF4
PSADSSC0 EQU   PSADSSF4
PSADSSIE EQU   PSADSSF4
PSADSS12 EQU   PSADSSF4
PSADSSRC EQU   PSADSSF4
PSARV057 EQU   PSADSSF3
PSARV056 EQU   PSADSSF3
PSARV055 EQU   PSADSSF3
PSADSSMC EQU   PSADSSF3
PSADSSRW EQU   PSADSSF3
PSADSSNM EQU   PSADSSF3
PSADSSES EQU   PSADSSF3
PSADSSGP EQU   PSADSSF3
PSADSSF2 EQU   PSADSSFL+1
PSADSSPI EQU   PSADSSF1
PSADSSOI EQU   PSADSSF1
PSADSSSP EQU   PSADSSF1
PSADSSTP EQU   PSADSSF1
PSADSSDW EQU   PSADSSF1
PSADSSDD EQU   PSADSSF1
PSADSSDM EQU   PSADSSF1
PSADSSMV EQU   PSADSSF1
PSADSSTS EQU   PSA+816
PSADSSWK EQU   PSA+812
PSADSSR3 EQU   PSA+808
PSADSSR2 EQU   PSA+804
PSADSSRS EQU   PSA+800
PSAVSTAP EQU   PSA+792
PSAMCHIC EQU   PSA+783
PSAACTCD EQU   PSA+782
PSASYMSK EQU   PSA+781
PSAMCHFL EQU   PSA+780
PSACR0   EQU   PSA+776
PSAPSWSV EQU   PSA+768
PSACLHS  EQU   PSAHLHI
PSALKR15 EQU   PSALKSA+60
PSALKR14 EQU   PSALKSA+56
PSALKR13 EQU   PSALKSA+52
PSALKR12 EQU   PSALKSA+48
PSALKR11 EQU   PSALKSA+44
PSALKR10 EQU   PSALKSA+40
PSALKR9  EQU   PSALKSA+36
PSALKR8  EQU   PSALKSA+32
PSALKR7  EQU   PSALKSA+28
PSALKR6  EQU   PSALKSA+24
PSALKR5  EQU   PSALKSA+20
PSALKR4  EQU   PSALKSA+16
PSALKR3  EQU   PSALKSA+12
PSALKR2  EQU   PSALKSA+8
PSALKR1  EQU   PSALKSA+4
PSALKR0  EQU   PSALKSA
PSARV023 EQU   PSACLHT+52
PSALOCAL EQU   PSACLHT+48
PSACMSL  EQU   PSACLHT+44
PSAOPTL  EQU   PSACLHT+40
PSATPACL EQU   PSACLHT+36
PSATPDNL EQU   PSACLHT+32
PSATPNCL EQU   PSACLHT+28
PSAIOSLL EQU   PSACLHT+24
PSAIOSUL EQU   PSACLHT+20
PSAIOSCL EQU   PSACLHT+16
PSAIOSSL EQU   PSACLHT+12
PSASALCL EQU   PSACLHT+8
PSAASML  EQU   PSACLHT+4
PSADISPL EQU   PSACLHT
PSASRSA  EQU   PSA+636
PSARV050 EQU   PSA+634
PSADSSGO EQU   PSA+633
PSARECUR EQU   PSA+632
PSAHLHIS EQU   PSA+628
PSAIPCSA EQU   PSA+624
@NM00042 EQU   PSA+621
PSAIPCDM EQU   PSA+620
PSAIPCD  EQU   PSA+616
@NM00041 EQU   PSA+613
PSAIPCRM EQU   PSA+612
PSAIPCR  EQU   PSA+608
PSAMCHEX EQU   PSA+600
PSAMPSW  EQU   PSA+592
PSAEXPS2 EQU   PSA+584
PSAEXPS1 EQU   PSA+576
PSAPIREG EQU   PSA+572
PSARSREG EQU   PSA+568
PSAGPREG EQU   PSA+556
PSARV022 EQU   PSASUP4
PSARV021 EQU   PSASUP4
PSARV020 EQU   PSASUP4
PSARV019 EQU   PSASUP4
PSARV018 EQU   PSASUP4
PSARV017 EQU   PSASUP4
PSARV016 EQU   PSASUP4
PSARV015 EQU   PSASUP4
PSARV014 EQU   PSASUP3
PSAULCMS EQU   PSASUP3
PSARV012 EQU   PSASUP3
PSAESTA  EQU   PSASUP3
PSASPR   EQU   PSASUP3
PSAPSREG EQU   PSASUP3
PSAPI2   EQU   PSASUP3
PSAIOSUP EQU   PSASUP3
PSALCR   EQU   PSASUP2
PSARTM   EQU   PSASUP2
PSAACR   EQU   PSASUP2
PSAIPCE2 EQU   PSASUP2
PSAIPCES EQU   PSASUP2
PSAIPCEC EQU   PSASUP2
PSAGTF   EQU   PSASUP2
PSAIPCRI EQU   PSASUP2
PSATYPE6 EQU   PSASUP1
PSATCTL  EQU   PSASUP1
PSADISP  EQU   PSASUP1
PSALOCK  EQU   PSASUP1
PSAPI    EQU   PSASUP1
PSAEXT   EQU   PSASUP1
PSASVC   EQU   PSASUP1
PSAIO    EQU   PSASUP1
FLCHDEND EQU   PSA+512
FLCCRSAV EQU   FLCMCLA+280
FLCGRSAV EQU   FLCMCLA+216
FLCFPSAV EQU   FLCMCLA+184
FLCFLA   EQU   FLCMCLA+88
FLCRGNCD EQU   FLCMCLA+84
FLCFSAA  EQU   FLCFSA+1
@NM00040 EQU   FLCFSA
@NM00039 EQU   FLCMCLA+77
PSAMDISC EQU   PSAMEDC
PSAMINTR EQU   PSAMEDC
PSAMINST EQU   PSAMEDC
PSAMCCF  EQU   PSAMEDC
PSAMCNOP EQU   PSAMEDC
PSAMEXSR EQU   PSAMEDC
PSAMCOPR EQU   PSAMEDC
@NM00038 EQU   PSAMEDC
@NM00037 EQU   FLCMCLA+72
FLCMCIC  EQU   FLCMCLA+64
@NM00036 EQU   FLCMCLA+20
FLCIOAA  EQU   FLCIOA+1
@NM00035 EQU   FLCIOA
@NM00034 EQU   FLCMCLA+15
@NM00033 EQU   FLCMCLA+14
@NM00032 EQU   FLCMCLA+12
FLCLCL   EQU   FLCMCLA+8
FLCIOELA EQU   FLCIOEL+1
@NM00031 EQU   FLCIOEL
FLCCHIL  EQU   FLCCHNID+2
FLCCHMOD EQU   FLCCHTM
FLCCHTYP EQU   FLCCHTM
@NM00030 EQU   PSA+160
FLCMTRCD EQU   PSA+157
@NM00029 EQU   PSA+156
FLCPERA  EQU   FLCPER+1
@NM00028 EQU   FLCPER
@NM00027 EQU   PSA+151
FLCPERCD EQU   PSA+150
FLCMCNUM EQU   PSA+149
@NM00026 EQU   PSA+148
FLCTEAA  EQU   FLCTEA+1
@NM00025 EQU   FLCTEA
PSAPIPC  EQU   PSAPICOD
PSAPIMC  EQU   PSAPICOD
PSAPIPER EQU   PSAPICOD
PSARV049 EQU   FLCPICOD
FLCPILCB EQU   FLCPIILC
@NM00024 EQU   FLCPIILC
@NM00023 EQU   PSAEPPSW
FLCSVCN  EQU   PSAESPSW+2
FLCSILCB EQU   FLCSVILC
@NM00022 EQU   FLCSVILC
@NM00021 EQU   PSAESPSW
FLCEICOD EQU   PSAEEPSW+2
PSASPAD  EQU   PSAEEPSW
@NM00020 EQU   PSA+128
FLCINPSW EQU   PSA+120
FLCMNPSW EQU   PSA+112
FLCPNPSW EQU   PSA+104
FLCSNPSW EQU   PSA+96
FLCENPSW EQU   PSA+88
FLCTIMER EQU   PSA+80
FLCCVT2  EQU   PSA+76
FLCCAW   EQU   PSA+72
FLCCSW   EQU   PSA+64
FLCIOPSW EQU   PSA+56
FLCMOPSW EQU   PSA+48
FLCPOPSW EQU   PSA+40
FLCSOPSW EQU   PSA+32
FLCEOPSW EQU   PSA+24
@NM00019 EQU   FLCICCW2+4
FLCICCW1 EQU   FLCROPSW
FLCIPPSW EQU   FLCRNPSW
ASVTEND  EQU   ASVT+528
ASVTAVAI EQU   ASVTFRST
ASVTRS00 EQU   ASVT+520
ASVTASVT EQU   ASVT+512
ASVTBEGN EQU   ASVT+512
@NM00018 EQU   ASVT
ASCBEND  EQU   ASCB+208
ASCBSRBT EQU   ASCB+200
ASCBSWTL EQU   ASCB+196
ASCBRS14 EQU   ASCB+195
ASCBSMCT EQU   ASCB+194
ASCBRS12 EQU   ASCB+192
ASCBPCTT EQU   ASCB+188
ASCBVGTT EQU   ASCB+184
ASCBRV43 EQU   ASCBSRQ4
ASCBRV42 EQU   ASCBSRQ4
ASCBRV41 EQU   ASCBSRQ4
ASCBRV40 EQU   ASCBSRQ4
ASCBRV39 EQU   ASCBSRQ4
ASCBRV38 EQU   ASCBSRQ4
ASCBRV37 EQU   ASCBSRQ4
ASCBRV36 EQU   ASCBSRQ4
ASCBRV35 EQU   ASCBSRQ3
ASCBRV34 EQU   ASCBSRQ3
ASCBRV33 EQU   ASCBSRQ3
ASCBRV32 EQU   ASCBSRQ3
ASCBRV31 EQU   ASCBSRQ3
ASCBRV30 EQU   ASCBSRQ3
ASCBRV29 EQU   ASCBSRQ3
ASCBRV28 EQU   ASCBSRQ3
ASCBRV27 EQU   ASCBSRQ2
ASCBRV26 EQU   ASCBSRQ2
ASCBRV25 EQU   ASCBSRQ2
ASCBRV24 EQU   ASCBSRQ2
ASCBRV23 EQU   ASCBSRQ2
ASCBRV22 EQU   ASCBSRQ2
ASCBRV21 EQU   ASCBSRQ2
ASCBRV20 EQU   ASCBSRQ2
ASCBRV19 EQU   ASCBSRQ1
ASCBRV18 EQU   ASCBSRQ1
ASCBRV17 EQU   ASCBSRQ1
ASCBRV16 EQU   ASCBSRQ1
ASCBRV15 EQU   ASCBSRQ1
ASCBRV14 EQU   ASCBSRQ1
ASCBRV13 EQU   ASCBSRQ1
ASCBSTA  EQU   ASCBSRQ1
ASCBJBNS EQU   ASCB+176
ASCBJBNI EQU   ASCB+172
ASCBMCC  EQU   ASCB+168
ASCBRTWA EQU   ASCB+164
ASCBIQEA EQU   ASCB+160
ASCBXMPQ EQU   ASCB+156
ASCBRS01 EQU   ASCB+154
ASCBFMCT EQU   ASCB+152
ASCBOUXB EQU   ASCB+148
ASCBOUCB EQU   ASCB+144
ASCBMECB EQU   ASCB+140
ASCBQECB EQU   ASCB+136
ASCBLSQH EQU   ASCBLKGP+4
ASCBLOCK EQU   ASCBLKGP
ASCBTCBS EQU   ASCB+124
ASCBNVSC EQU   ASCB+122
ASCBVSC  EQU   ASCB+120
ASCBSRBS EQU   ASCB+118
ASCBSSRB EQU   ASCB+116
ASCBRV06 EQU   ASCBFLG2
ASCBRV05 EQU   ASCBFLG2
ASCBRV04 EQU   ASCBFLG2
ASCBSNQS EQU   ASCBFLG2
ASCBS2S  EQU   ASCBFLG2
ASCBCEXT EQU   ASCBFLG2
ASCBPXMT EQU   ASCBFLG2
ASCBXMPT EQU   ASCBFLG2
ASCBRF07 EQU   ASCBDSP1
ASCBRF06 EQU   ASCBDSP1
ASCBRF05 EQU   ASCBDSP1
ASCBRF04 EQU   ASCBDSP1
ASCBRF03 EQU   ASCBDSP1
ASCBRF02 EQU   ASCBDSP1
ASCBFAIL EQU   ASCBDSP1
ASCBNOQ  EQU   ASCBDSP1
ASCBSWCT EQU   ASCB+112
ASCBASXB EQU   ASCB+108
ASCBTMCH EQU   ASCB+104
ASCBNSWP EQU   ASCBFLG1
ASCBTYP1 EQU   ASCBFLG1
ASCBSTND EQU   ASCBFLG1
ASCBABNT EQU   ASCBFLG1
ASCBTERM EQU   ASCBFLG1
ASCBS3S  EQU   ASCBFLG1
ASCBCMSH EQU   ASCBFLG1
ASCBTOFF EQU   ASCBFLG1
ASCBRF01 EQU   ASCBRCTF
ASCBTMLW EQU   ASCBRCTF
ASCBOUT  EQU   ASCBRCTF
ASCBWAIT EQU   ASCBRCTF
ASCBRV08 EQU   ASCBRCTF
ASCBFQU  EQU   ASCBRCTF
ASCBFRS  EQU   ASCBRCTF
ASCBTMNO EQU   ASCBRCTF
ASCBDUMP EQU   ASCB+96
ASCBRV44 EQU   ASCB+92
ASCBUBET EQU   ASCB+88
ASCBECB  EQU   ASCB+84
ASCBJSTL EQU   ASCB+80
ASCBEWST EQU   ASCB+72
ASCBEJST EQU   ASCB+64
ASCBTSB  EQU   ASCB+60
ASCBCSCB EQU   ASCB+56
ASCBRSMA EQU   ASCBRSM+1
ASCBRV54 EQU   ASCBRSMF
ASCBRV53 EQU   ASCBRSMF
ASCBRV52 EQU   ASCBRSMF
ASCBRV51 EQU   ASCBRSMF
ASCBVEQR EQU   ASCBRSMF
ASCBN2LP EQU   ASCBRSMF
ASCB1LPU EQU   ASCBRSMF
ASCB2LPU EQU   ASCBRSMF
ASCBLDA  EQU   ASCB+48
ASCBSTOR EQU   ASCB+44
ASCBDP   EQU   ASCB+43
ASCBRV07 EQU   ASCB+42
ASCBIOSM EQU   ASCB+40
ASCBSEQN EQU   ASCB+38
ASCBASID EQU   ASCB+36
ASCBCPUS EQU   ASCB+32
ASCBSPL  EQU   ASCB+28
ASCBIOSP EQU   ASCB+24
ASCBSYNC EQU   ASCBSUPC+4
ASCBSVRB EQU   ASCBSUPC
ASCBCMSF EQU   ASCB+12
ASCBBWDP EQU   ASCB+8
ASCBFWDP EQU   ASCB+4
ASCBASCB EQU   ASCB
ASCBEGIN EQU   ASCB
@NM00017 EQU   CSD+160
CSDUCNT  EQU   CSD+124
CSDTCNT  EQU   CSD+120
CSDGDTOD EQU   CSD+116
CSDGDINT EQU   CSD+112
CSDGDCC  EQU   CSD+108
CSDDDRCT EQU   CSD+106
CSDRV044 EQU   CSD+104
CSDMAFF  EQU   CSD+24
CSDRV038 EQU   CSDFLAGS
CSDRV037 EQU   CSDFLAGS
CSDRV036 EQU   CSDFLAGS
CSDRV035 EQU   CSDFLAGS
CSDRV034 EQU   CSDFLAGS
CSDRV033 EQU   CSDFLAGS
CSDRV032 EQU   CSDFLAGS
CSDACR   EQU   CSD+22
CSDMF1CP EQU   CSD+20
CSDRV043 EQU   CSD+16
CSDRV030 EQU   CSDSCFL4
CSDRV029 EQU   CSDSCFL4
CSDRV028 EQU   CSDSCFL4
CSDRV027 EQU   CSDSCFL4
CSDRV026 EQU   CSDSCFL4
CSDRV025 EQU   CSDSCFL4
CSDRV024 EQU   CSDSCFL4
CSDRV023 EQU   CSDSCFL4
CSDRV022 EQU   CSDSCFL3
CSDRV021 EQU   CSDSCFL3
CSDRV020 EQU   CSDSCFL3
CSDRV019 EQU   CSDSCFL3
CSDRV018 EQU   CSDSCFL3
CSDRV017 EQU   CSDSCFL3
CSDRV016 EQU   CSDSCFL3
CSDRV015 EQU   CSDSCFL3
CSDRV014 EQU   CSDSCFL2
CSDRV013 EQU   CSDSCFL2
CSDRV012 EQU   CSDSCFL2
CSDRV011 EQU   CSDSCFL2
CSDRV010 EQU   CSDSCFL2
CSDRV009 EQU   CSDSCFL2
CSDRV008 EQU   CSDSCFL2
CSDRV007 EQU   CSDSCFL2
CSDRV006 EQU   CSDSCFL1
CSDRV005 EQU   CSDSCFL1
CSDRV004 EQU   CSDSCFL1
CSDRV003 EQU   CSDSCFL1
CSDRV002 EQU   CSDSCFL1
CSDRV001 EQU   CSDSCFL1
CSDSYSND EQU   CSDSCFL1
CSDRV042 EQU   CSDSCFL1
CSDSAFF  EQU   CSDCPUAL
CSDCSD   EQU   CSD
RVTMIH2  EQU   RVT+108
RVTMIH   EQU   RVT+104
RVTCCHCR EQU   RVT+100
RVTCCHDA EQU   RVT+96
RVTMSGLN EQU   RVT+92
RVTMSGPT EQU   RVT+88
RVTLRBPT EQU   RVT+84
RVTRWAPT EQU   RVT+80
RVT01MMM EQU   RVT+76
RVT00MMM EQU   RVT+72
RVTPEXIT EQU   RVT+68
RVTPKREF EQU   RVT+64
RVTPXMFA EQU   RVT+56
RVTPTAIM EQU   RVT+52
RVTPTCON EQU   RVT+48
RVTPTREC EQU   RVT+44
RVTPTSIG EQU   RVT+40
RVTPTERM EQU   RVT+36
RVTPMKTA EQU   RVT+32
RVTPMMSG EQU   RVT+28
RVTPMTHA EQU   RVT+24
RVTPMPFX EQU   RVT+20
RVTPMSCA EQU   RVT+16
RVTPMHCA EQU   RVT+12
RVTPMFRS EQU   RVT+8
RVTPMRTM EQU   RVT+4
RVTPMCIH EQU   RVT
CATEND   EQU   CAT+8
CATFLARS EQU   CATFLA
CATSOL   EQU   CATFLA
CATMCRST EQU   CATFLA
CATCCRST EQU   CATFLA
CATIORST EQU   CATFLA
CATBSY   EQU   CATFLA
CATDSABL EQU   CATFLG
CATFLG6  EQU   CATFLG
CATFLG5  EQU   CATFLG
CATNCPU  EQU   CATFLG
CATRES1  EQU   CATFLG
LCCAR125 EQU   LCCA+964
LCCAR124 EQU   LCCA+960
LCCASGPR EQU   LCCA+896
LCCADRT2 EQU   LCCA+888
LCCADRT1 EQU   LCCA+880
LCCAR103 EQU   LCCA+876
LCCAESS2 EQU   LCCA+872
LCCASPLJ EQU   LCCA+868
LCCASMQJ EQU   LCCA+864
LCCAASID EQU   LCCA+732
LCCARV89 EQU   LCCA+728
LCCAPGTA EQU   LCCASRBF+2
LCCASAFN EQU   LCCASRBF
LCCAECSA EQU   LCCA+716
LCCAICR0 EQU   LCCA+712
LCCALWTM EQU   LCCA+704
LCCARV78 EQU   LCCA+700
LCCAPINV EQU   LCCA+696
LCCARV88 EQU   LCCA+695
LCCARV87 EQU   LCCALKFG
LCCARV86 EQU   LCCALKFG
LCCARV85 EQU   LCCALKFG
LCCARV84 EQU   LCCALKFG
LCCALKRD EQU   LCCALKFG
LCCALKAQ EQU   LCCALKFG
LCCALKSA EQU   LCCALKFG
LCCALKDP EQU   LCCALKFG
LCCACRST EQU   LCCACREX
LCCACRDP EQU   LCCACREX
LCCACRLM EQU   LCCACREX
LCCACRIN EQU   LCCACREX
LCCACRRT EQU   LCCACREX
LCCACRLE EQU   LCCACREX
LCCACRRM EQU   LCCACREX
LCCACREF EQU   LCCACREX
LCCARV73 EQU   LCCACRFL
LCCARV72 EQU   LCCACRFL
LCCARV71 EQU   LCCACRFL
LCCARV70 EQU   LCCACRFL
LCCARV69 EQU   LCCACRFL
LCCACLMS EQU   LCCACRFL
LCCACRTM EQU   LCCACRFL
LCCALCR0 EQU   LCCA+688
LCCACRLC EQU   LCCA+684
LCCARCPU EQU   LCCA+680
LCCADCPU EQU   LCCA+676
LCCASRBJ EQU   LCCA+672
LCCADSSR EQU   LCCA+668
LCCADSSC EQU   LCCA+660
LCCADSS3 EQU   LCCA+648
LCCADSS2 EQU   LCCA+636
LCCADSS1 EQU   LCCA+624
LCCAWTIM EQU   LCCA+616
LCCAITOD EQU   LCCA+608
LCCADTOD EQU   LCCA+600
LCCASTOD EQU   LCCA+592
LCCARIR5 EQU   LCCASPSA+44
LCCARIR4 EQU   LCCASPSA+40
LCCARIR3 EQU   LCCASPSA+36
LCCARIR2 EQU   LCCASPSA+32
LCCARPR5 EQU   LCCASPSA+28
LCCARPR4 EQU   LCCASPSA+24
LCCARPR3 EQU   LCCASPSA+20
LCCARPR2 EQU   LCCASPSA+16
LCCADSR5 EQU   LCCASPSA+12
LCCADSR4 EQU   LCCASPSA+8
LCCADSR3 EQU   LCCASPSA+4
LCCADSR2 EQU   LCCASPSA
LCCARV68 EQU   LCCA+543
LCCAPSMK EQU   LCCA+542
LCCARV67 EQU   LCCADSF2
LCCARV66 EQU   LCCADSF2
LCCARV65 EQU   LCCADSF2
LCCARV64 EQU   LCCADSF2
LCCADSRW EQU   LCCADSF2
LCCADSPL EQU   LCCADSF2
LCCAGSRB EQU   LCCADSF2
LCCASRBM EQU   LCCADSF2
LCCARV61 EQU   LCCADSF1
LCCARV60 EQU   LCCADSF1
LCCARV59 EQU   LCCADSF1
LCCARV58 EQU   LCCADSF1
LCCADSS  EQU   LCCADSF1
LCCAACR  EQU   LCCADSF1
LCCAASCP EQU   LCCA+532
LCCAESSA EQU   LCCA+528
LCCARV55 EQU   LCCASPN4
LCCARV54 EQU   LCCASPN4
LCCARV53 EQU   LCCASPN4
LCCARV52 EQU   LCCASPN4
LCCARV51 EQU   LCCASPN4
LCCARV50 EQU   LCCASPN4
LCCARV49 EQU   LCCASPN4
LCCARV48 EQU   LCCASPN4
LCCARV47 EQU   LCCASPN3
LCCARV46 EQU   LCCASPN3
LCCARV45 EQU   LCCASPN3
LCCARV44 EQU   LCCASPN3
LCCARV43 EQU   LCCASPN3
LCCARV42 EQU   LCCASPN3
LCCARV41 EQU   LCCASPN3
LCCARV40 EQU   LCCASPN3
LCCARV39 EQU   LCCASPN2
LCCARV38 EQU   LCCASPN2
LCCARV37 EQU   LCCASPN2
LCCARV36 EQU   LCCASPN2
LCCARV35 EQU   LCCASPN2
LCCARV34 EQU   LCCASPN2
LCCARV33 EQU   LCCASPN2
LCCARV32 EQU   LCCASPN2
LCCARV31 EQU   LCCASPN1
LCCARV30 EQU   LCCASPN1
LCCAMFIO EQU   LCCASPN1
LCCARSTR EQU   LCCASPN1
LCCATSPN EQU   LCCASPN1
LCCALOCK EQU   LCCASPN1
LCCASIGP EQU   LCCASPN1
LCCAPTLB EQU   LCCASPN1
LCCARV27 EQU   LCCAIHR4
LCCARV26 EQU   LCCAIHR4
LCCARV25 EQU   LCCAIHR4
LCCARV24 EQU   LCCAIHR4
LCCARV23 EQU   LCCAIHR4
LCCARV22 EQU   LCCAIHR4
LCCARV21 EQU   LCCAIHR4
LCCARV20 EQU   LCCAIHR4
LCCARV19 EQU   LCCAIHR3
LCCARV18 EQU   LCCAIHR3
LCCARV17 EQU   LCCAIHR3
LCCARV16 EQU   LCCAIHR3
LCCARV15 EQU   LCCAIHR3
LCCARV14 EQU   LCCAIHR3
LCCARV13 EQU   LCCAIHR3
LCCARV12 EQU   LCCAIHR3
LCCARV11 EQU   LCCAIHR2
LCCARV10 EQU   LCCAIHR2
LCCARV09 EQU   LCCAIHR2
LCCARV08 EQU   LCCAIHR2
LCCARV07 EQU   LCCAIHR2
LCCARV06 EQU   LCCAIHR2
LCCARV05 EQU   LCCAIHR2
LCCARV04 EQU   LCCAIHR2
LCCARV03 EQU   LCCAIHR1
LCCARV02 EQU   LCCAIHR1
LCCARV01 EQU   LCCAIHR1
LCCAPPIE EQU   LCCAIHR1
LCCAPSG1 EQU   LCCAIHR1
LCCAPDAT EQU   LCCAIHR1
LCCAXRC2 EQU   LCCAIHR1
LCCAXRC1 EQU   LCCAIHR1
LCCAIOPS EQU   LCCA+512
LCCAGPGR EQU   LCCA+448
LCCAR133 EQU   LCCA+444
LCCAR132 EQU   LCCA+440
LCCAR131 EQU   LCCA+436
LCCAR130 EQU   LCCA+432
LCCAR129 EQU   LCCA+428
LCCAR128 EQU   LCCA+424
LCCAR127 EQU   LCCA+420
LCCAR126 EQU   LCCA+416
LCCARSGR EQU   LCCA+352
LCCAXGR3 EQU   LCCA+288
LCCAXGR2 EQU   LCCA+224
LCCAXGR1 EQU   LCCA+160
LCCACR0  EQU   LCCA+156
LCCAPVAD EQU   LCCA+148
LCCAPINT EQU   LCCA+144
LCCAPPSW EQU   LCCA+136
LCCAPGR2 EQU   LCCA+72
LCCAPGR1 EQU   LCCA+8
LCCARV77 EQU   LCCA+6
@NM00016 EQU   PCCA+512
PCCARV36 EQU   PCCA+380
PCCARV35 EQU   PCCA+378
PCCARV01 EQU   PCCA+377
PCCAR105 EQU   PCCAATTR
PCCAR104 EQU   PCCAATTR
PCCAR103 EQU   PCCAATTR
PCCAR102 EQU   PCCAATTR
PCCAR101 EQU   PCCAATTR
PCCAR100 EQU   PCCAATTR
PCCARV63 EQU   PCCA+372
PCCARV62 EQU   PCCA+368
PCCARV61 EQU   PCCA+364
PCCARV60 EQU   PCCA+360
PCCARV59 EQU   PCCA+356
PCCARV58 EQU   PCCA+352
PCCARV57 EQU   PCCA+348
PCCARV56 EQU   PCCA+344
PCCARV55 EQU   PCCA+340
PCCARV54 EQU   PCCA+336
PCCALOGA EQU   PCCA+332
PCCACHID EQU   PCCA+324
PCCACHSV EQU   PCCA+312
PCCARV79 EQU   PCCACHF4
PCCARV78 EQU   PCCACHF4
PCCARV77 EQU   PCCACHF4
PCCARV76 EQU   PCCACHF4
PCCARV75 EQU   PCCACHF4
PCCARV74 EQU   PCCACHF4
PCCARV73 EQU   PCCACHF4
PCCARV72 EQU   PCCACHF4
PCCARV71 EQU   PCCACHF3
PCCARV70 EQU   PCCACHF3
PCCARV69 EQU   PCCACHF3
PCCARV68 EQU   PCCACHF3
PCCARV67 EQU   PCCACHF3
PCCARV66 EQU   PCCACHF3
PCCASLCK EQU   PCCACHF3
PCCAISRB EQU   PCCACHF3
PCCACF28 EQU   PCCACHF2
PCCACF27 EQU   PCCACHF2
PCCACF26 EQU   PCCACHF2
PCCACF25 EQU   PCCACHF2
PCCACF24 EQU   PCCACHF2
PCCACF23 EQU   PCCACHF2
PCCACF22 EQU   PCCACHF2
PCCACF21 EQU   PCCACHF2
PCCACF18 EQU   PCCACHF1
PCCACF17 EQU   PCCACHF1
PCCACF16 EQU   PCCACHF1
PCCACF15 EQU   PCCACHF1
PCCACF14 EQU   PCCACHF1
PCCACF13 EQU   PCCACHF1
PCCACF12 EQU   PCCACHF1
PCCACF11 EQU   PCCACHF1
PCCARV05 EQU   PCCA+307
PCCACHPB EQU   PCCA+306
PCCALGP2 EQU   PCCA+305
PCCALGP1 EQU   PCCA+304
PCCACELL EQU   PCCA+302
PCCALOGL EQU   PCCA+300
PCCACHW2 EQU   PCCA+296
PCCACHW1 EQU   PCCA+292
PCCAIOSI EQU   PCCA+291
PCCACNRB EQU   PCCACHRB
PCCACCVB EQU   PCCACHRB
PCCACSNB EQU   PCCACHRB
PCCARV52 EQU   PCCACHRB
PCCACHIB EQU   PCCACHRB
PCCACTIB EQU   PCCACHRB
PCCACINB EQU   PCCACHRB
PCCACSIB EQU   PCCACHRB
PCCARV51 EQU   PCCACHS2
PCCARV50 EQU   PCCACHS2
PCCACCRA EQU   PCCACHS2
PCCACURC EQU   PCCACHS2
PCCACNLG EQU   PCCACHS2
PCCACMOD EQU   PCCACHS2
PCCACALT EQU   PCCACHS2
PCCACIOR EQU   PCCACHS2
PCCARV47 EQU   PCCACHS1
PCCACUCB EQU   PCCACHS1
PCCACIBC EQU   PCCACHS1
PCCACAND EQU   PCCACHS1
PCCACNLS EQU   PCCACHS1
PCCACFRR EQU   PCCACHS1
PCCACNRE EQU   PCCACHS1
PCCACCMP EQU   PCCACHS1
PCCACSEQ EQU   PCCACHTS
PCCACDIN EQU   PCCACHTS
PCCARV44 EQU   PCCACHTS
PCCARV43 EQU   PCCACHTS
PCCACTEC EQU   PCCACHTS
PCCACDAV EQU   PCCACHVA
PCCACCHV EQU   PCCACHVA
PCCACCMD EQU   PCCACHVA
PCCACUNS EQU   PCCACHVA
PCCACSQV EQU   PCCACHVA
PCCARV42 EQU   PCCACHVA
PCCARV41 EQU   PCCACHVA
PCCACITF EQU   PCCACHVA
PCCARV40 EQU   PCCACHBL
PCCARV39 EQU   PCCACHBL
PCCARV38 EQU   PCCACHBL
PCCACCUE EQU   PCCACHBL
PCCACSTG EQU   PCCACHBL
PCCACSCU EQU   PCCACHBL
PCCACCHA EQU   PCCACHBL
PCCACCPU EQU   PCCACHBL
PCCACNOR EQU   PCCACHPF
PCCACCNT EQU   PCCACHPF
PCCACSNS EQU   PCCACHPF
PCCARV37 EQU   PCCACHPF
PCCACHIO EQU   PCCACHPF
PCCACTIO EQU   PCCACHPF
PCCACINT EQU   PCCACHPF
PCCACSIO EQU   PCCACHPF
PCCACHUB EQU   PCCAWERP
PCCAR106 EQU   PCCA+228
PCCAR113 EQU   PCCA+226
PCCASRBL EQU   PCCA+225
PCCAR112 EQU   PCCACHAN
PCCAR111 EQU   PCCACHAN
PCCAR110 EQU   PCCACHAN
PCCAR109 EQU   PCCACHAN
PCCAR108 EQU   PCCACHAN
PCCAR107 EQU   PCCACHAN
PCCAEXDM EQU   PCCACHAN
PCCAIRST EQU   PCCACHAN
PCCASRB  EQU   PCCA+180
PCCACCHM EQU   PCCA+176
PCCAELBA EQU   PCCA+172
PCCAELAD EQU   PCCA+168
PCCALRBR EQU   PCCA+164
PCCALRBV EQU   PCCA+160
PCCAPWAR EQU   PCCA+156
PCCAPWAV EQU   PCCA+152
PCCAEMSA EQU   PCCAEMSB+12
PCCAEMSE EQU   PCCAEMSB+8
PCCAEMSP EQU   PCCAEMSB+4
PCCARMS  EQU   PCCARMSB
PCCARV34 EQU   PCCARMSB
PCCARV33 EQU   PCCARMSB
PCCARV32 EQU   PCCARMSB
PCCARV31 EQU   PCCARMSB
PCCARV30 EQU   PCCARMSB
PCCARV29 EQU   PCCARMSB
PCCARV28 EQU   PCCARMSB
PCCARV27 EQU   PCCAEMS3
PCCARV26 EQU   PCCAEMS3
PCCARV25 EQU   PCCAEMS3
PCCARV24 EQU   PCCAEMS3
PCCARV23 EQU   PCCAEMS3
PCCARV22 EQU   PCCAEMS3
PCCARV21 EQU   PCCAEMS3
PCCARV20 EQU   PCCAEMS3
PCCARV19 EQU   PCCAEMS2
PCCARV18 EQU   PCCAEMS2
PCCARV17 EQU   PCCAEMS2
PCCARV16 EQU   PCCAEMS2
PCCARV15 EQU   PCCAEMS2
PCCARV14 EQU   PCCAEMS2
PCCARV13 EQU   PCCAEMS2
PCCARV12 EQU   PCCAEMS2
PCCARV11 EQU   PCCARISP
PCCARV10 EQU   PCCARISP
PCCARV09 EQU   PCCARISP
PCCARV08 EQU   PCCARISP
PCCARV07 EQU   PCCARISP
PCCARV06 EQU   PCCARISP
PCCASERL EQU   PCCARISP
PCCAPARL EQU   PCCARISP
PCCARPB  EQU   PCCA+132
PCCACTIN EQU   PCCAINTE
PCCANFIN EQU   PCCAINTE
PCCANUIN EQU   PCCAINTE
PCCACTCC EQU   PCCACCE
PCCANFCC EQU   PCCACCE
PCCANUCC EQU   PCCACCE
PCCACTTD EQU   PCCATODE
PCCANFTD EQU   PCCATODE
PCCANUTD EQU   PCCATODE
PCCARV04 EQU   PCCATMFL
PCCARV03 EQU   PCCATMFL
PCCARV02 EQU   PCCATMFL
PCCAMINT EQU   PCCATMFL
PCCAMCC  EQU   PCCATMFL
PCCAVKIL EQU   PCCATMFL
PCCASYNC EQU   PCCATMFL
PCCAINIT EQU   PCCATMFL
PCCARV9E EQU   PCCA+124
PCCARV9D EQU   PCCA+120
PCCARV9C EQU   PCCA+116
PCCARV9B EQU   PCCA+112
PCCARV9A EQU   PCCA+108
PCCARV99 EQU   PCCA+104
PCCARV98 EQU   PCCA+100
PCCARV97 EQU   PCCA+96
PCCARV96 EQU   PCCA+92
PCCARV95 EQU   PCCA+88
PCCARV94 EQU   PCCA+84
PCCARV93 EQU   PCCA+80
PCCARV92 EQU   PCCA+76
PCCARV91 EQU   PCCA+72
PCCARV90 EQU   PCCA+68
PCCARV89 EQU   PCCA+64
PCCARV88 EQU   PCCA+60
PCCARV87 EQU   PCCA+56
PCCARV86 EQU   PCCA+52
PCCARV85 EQU   PCCA+48
PCCARV84 EQU   PCCA+44
PCCARV83 EQU   PCCA+40
PCCARV82 EQU   PCCA+36
PCCARV81 EQU   PCCA+32
PCCATQEP EQU   PCCA+20
CHSAVWD2 EQU   CHSHORT+100
CHSAVWD1 EQU   CHSHORT+96
CHJSCBVS EQU   CHSHORT+92
CHUSCVS  EQU   CHSHORT+88
@NM00014 EQU   CHSHORT+84
@NM00013 EQU   CHSHORT+80
CHSQA    EQU   CHSHORT+44
CHQPA    EQU   CHSHORT+8
CHJCL    EQU   CHSHORT+4
CHSPC    EQU   CHSHORT
CHSPB    EQU   CHSTEP+4
CHTCB    EQU   CHSTEP+1
CHARSV23 EQU   CHSWT
CHARSV22 EQU   CHSWT
CHARSV21 EQU   CHSWT
CHAC     EQU   CHSWT
CHPSF    EQU   CHSWT
CHPSD    EQU   CHSWT
CHJCT    EQU   CHSWT
CHARSV20 EQU   CHSWT
CHCECB   EQU   CHASM+20
CHECB    EQU   CHASM+16
CHRGNAD  EQU   CHASM+12
CHARSV18 EQU   CHRGNSZ+1
CHRPRTY  EQU   CHRGNSZ
@NM00012 EQU   CHCIBP
CHEND    EQU   CHCIBP
CHECBP   EQU   CHASM
CHDER    EQU   CHPROCSN+4
CHARSV10 EQU   CHACT1
CHARSV09 EQU   CHACT1
CHARSV08 EQU   CHACT1
CHARSV07 EQU   CHACT1
CHARSV06 EQU   CHACT1
CHARSV05 EQU   CHACT1
CHARSV04 EQU   CHACT1
CHRDWTR  EQU   CHACT1
CHARSV30 EQU   CHPROCSN+2
CHQID    EQU   CHPROCSN
CHASID   EQU   CHTJID
CHTRKID  EQU   CHPKE
CHCIBCTR EQU   CHAIN+27
CHUNIT   EQU   CHAIN+24
CHCLS    EQU   CHAIN+16
CHPCOI   EQU   CHPARM
CHAFORCE EQU   CHIFY
CHAIFX   EQU   CHACT
CHCLD    EQU   CHACT
CHCL     EQU   CHACT
CHDSI    EQU   CHACT
CHDISC   EQU   CHACT
CHTERM   EQU   CHACT
CHSWAP   EQU   CHACT
CHABTERM EQU   CHSTS
CHFC     EQU   CHSTS
CHDL     EQU   CHSTS
CHAD     EQU   CHSTS
CHQSPC   EQU   CHSTS
CHSOUT   EQU   CHSTS
CHSYS    EQU   CHSTS
CHAP     EQU   CHSTS
CHSZE    EQU   CHFLG+1
CHVCD    EQU   CHFLG
CHPTR    EQU   CHAIN
CVTLEVL  EQU   CVTRELNO+2
CVTNUMB  EQU   CVTRELNO
CVTMDL   EQU   CVTFIX+250
@NM00011 EQU   CVTFIX+248
@NM00010 EQU   CVTFIX
CVTRV482 EQU   CVTXTNT2+128
CVTRV481 EQU   CVTXTNT2+124
CVTRV480 EQU   CVTXTNT2+120
CVTRV479 EQU   CVTXTNT2+118
CVTRV478 EQU   CVTXTNT2+117
CVTRV477 EQU   CVTXTNT2+116
CVTRV476 EQU   CVTXTNT2+115
CVTRV475 EQU   CVTXTNT2+114
CVTRV474 EQU   CVTRV466
CVTRV473 EQU   CVTRV466
CVTRV472 EQU   CVTRV466
CVTRV471 EQU   CVTRV466
CVTRV470 EQU   CVTRV466
CVTRV469 EQU   CVTRV466
CVTRV468 EQU   CVTRV466
CVTRV467 EQU   CVTRV466
CVTRV465 EQU   CVTRV457
CVTRV464 EQU   CVTRV457
CVTRV463 EQU   CVTRV457
CVTRV462 EQU   CVTRV457
CVTRV461 EQU   CVTRV457
CVTRV460 EQU   CVTRV457
CVTRV459 EQU   CVTRV457
CVTRV458 EQU   CVTRV457
CVTRV456 EQU   CVTXTNT2+108
CVTRV455 EQU   CVTXTNT2+104
CVTRV454 EQU   CVTXTNT2+100
CVTRV453 EQU   CVTXTNT2+96
CVTRV452 EQU   CVTXTNT2+94
CVTRV451 EQU   CVTXTNT2+92
CVTRV450 EQU   CVTXTNT2+90
CVTRV449 EQU   CVTXTNT2+88
CVTRV448 EQU   CVTXTNT2+87
CVTRV447 EQU   CVTXTNT2+86
CVTRV446 EQU   CVTRV438
CVTRV445 EQU   CVTRV438
CVTRV444 EQU   CVTRV438
CVTRV443 EQU   CVTRV438
CVTRV442 EQU   CVTRV438
CVTRV441 EQU   CVTRV438
CVTRV440 EQU   CVTRV438
CVTRV439 EQU   CVTRV438
CVTRV437 EQU   CVTRV429
CVTRV436 EQU   CVTRV429
CVTRV435 EQU   CVTRV429
CVTRV434 EQU   CVTRV429
CVTRV433 EQU   CVTRV429
CVTRV432 EQU   CVTRV429
CVTRV431 EQU   CVTRV429
CVTRV430 EQU   CVTRV429
CVTRV428 EQU   CVTXTNT2+80
CVTRV427 EQU   CVTXTNT2+76
CVTRV426 EQU   CVTXTNT2+72
CVTRV425 EQU   CVTXTNT2+68
CVTATACT EQU   CVTATCVT
CVTRV423 EQU   CVTXTNT2+62
CVTRV422 EQU   CVTXTNT2+60
CVTRV421 EQU   CVTXTNT2+58
CVTRV420 EQU   CVTXTNT2+56
CVTRV419 EQU   CVTXTNT2+55
CVTRV418 EQU   CVTXTNT2+54
CVTRV417 EQU   CVTRV409
CVTRV416 EQU   CVTRV409
CVTRV415 EQU   CVTRV409
CVTRV414 EQU   CVTRV409
CVTRV413 EQU   CVTRV409
CVTRV412 EQU   CVTRV409
CVTRV411 EQU   CVTRV409
CVTRV410 EQU   CVTRV409
CVTRV408 EQU   CVTRV400
CVTRV407 EQU   CVTRV400
CVTRV406 EQU   CVTRV400
CVTRV405 EQU   CVTRV400
CVTRV404 EQU   CVTRV400
CVTRV403 EQU   CVTRV400
CVTRV402 EQU   CVTRV400
CVTRV401 EQU   CVTRV400
CVTSKTA  EQU   CVTXTNT2+44
CVTCCVT  EQU   CVTXTNT2+40
CVTRSV98 EQU   CVTXTNT2+36
CVTRSV97 EQU   CVTXTNT2+34
CVTRSV96 EQU   CVTXTNT2+32
CVTOLTEP EQU   CVTXTNT2+28
CVTQIDA  EQU   CVTQID+1
CVTRSV95 EQU   CVTQID
CVTRSV94 EQU   CVTXTNT2+20
CVTRSV93 EQU   CVTXTNT2+16
CVTRSV92 EQU   CVTXTNT2+12
CVTDEBVR EQU   CVTXTNT2+8
CVTRSV91 EQU   CVTXTNT2+6
CVTRSV9H EQU   CVTFLGBT
CVTRSV9G EQU   CVTFLGBT
CVTRSV9F EQU   CVTFLGBT
CVTRSV9E EQU   CVTFLGBT
CVTRSV9D EQU   CVTFLGBT
CVTRSV9C EQU   CVTFLGBT
CVTVME   EQU   CVTFLGBT
CVTNPE   EQU   CVTFLGBT
CVTNUCLS EQU   CVTXTNT2+4
CVTDSSVA EQU   CVTDSSV+1
CVTRSV89 EQU   CVTDSSV
CVTRSV88 EQU   CVTXTNT1+8
CVTRSV87 EQU   CVTXTNT1+4
CVTFACHN EQU   CVTXTNT1
CVTRV488 EQU   CVTMAP+412
CVTRV487 EQU   CVTMAP+408
CVTRV486 EQU   CVTMAP+404
CVTRV485 EQU   CVTMAP+400
CVTACTAP EQU   CVTMAP+396
CVTAUTH  EQU   CVTMAP+392
CVTATMCA EQU   CVTATMCT+1
CVTATMST EQU   CVTATMCT
CVTRSV61 EQU   CVTMAP+384
CVTVOLT1 EQU   CVTVOLM1+1
CVTVOLI1 EQU   CVTVOLF1
CVTSTOA  EQU   CVTMAP+376
CVTRSV58 EQU   CVTMAP+374
CVTRSV57 EQU   CVTMAP+372
CVTDDCE  EQU   CVTMAP+368
CVTPNWFR EQU   CVTMAP+364
CVTSMF   EQU   CVTMAP+360
CVTSULK  EQU   CVTMAP+358
CVTSLKO  EQU   CVTSYSK
CVTSLKP  EQU   CVTSYSK
CVTSLKQ  EQU   CVTSYSK
CVTSLKR  EQU   CVTSYSK
CVTRSV56 EQU   CVTSYSK
CVTRSV55 EQU   CVTSYSK
CVTRSV54 EQU   CVTSYSK
CVTRSV53 EQU   CVTSYSK
CVTRSV52 EQU   CVTA1F1
CVTRSV51 EQU   CVTA1F1
CVTRSV50 EQU   CVTA1F1
CVTRSV49 EQU   CVTA1F1
CVTRSV48 EQU   CVTA1F1
CVTRSV47 EQU   CVTA1F1
CVTSRSW  EQU   CVTA1F1
CVTPFSW  EQU   CVTA1F1
CVTPCVT  EQU   CVTMAP+352
CVTRSV46 EQU   CVTMAP+344
CVTRSV45 EQU   CVTMAP+340
CVTRSV44 EQU   CVTMAP+338
CVTRSV43 EQU   CVTMAP+336
CVTHJESA EQU   CVTHJES+1
CVTRSV42 EQU   CVTHJES
CVTEXT2A EQU   CVTEXT2+1
CVTRSV41 EQU   CVTEXT2
CVTAPFA  EQU   CVTAPF+1
CVTRSV40 EQU   CVTAPF
CVTRV518 EQU   CVTINTLA
CVTRV517 EQU   CVTERPV
CVTEORM  EQU   CVTMAP+312
CVTMCHPR EQU   CVTMAP+308
CVTTZ    EQU   CVTMAP+304
CVTJEPS  EQU   CVTMAP+300
CVTJESCT EQU   CVTMAP+296
CVTMODE  EQU   CVTMAP+292
CVTPTRV  EQU   CVTMAP+288
CVTREAL  EQU   CVTMAP+284
CVTRSV39 EQU   CVTMAP+280
CVTRSV38 EQU   CVTMAP+276
CVTDMSRA EQU   CVTDMSR+1
CVTRV634 EQU   CVTDMSRF
CVTRV633 EQU   CVTDMSRF
CVTRV632 EQU   CVTDMSRF
CVTRV631 EQU   CVTDMSRF
CVTRV630 EQU   CVTDMSRF
CVTRV629 EQU   CVTDMSRF
CVTUDUMP EQU   CVTDMSRF
CVTSDUMP EQU   CVTDMSRF
CVTQMSGA EQU   CVTQMSG+1
CVTRSV36 EQU   CVTQMSG
CVTAMFF  EQU   CVTMAP+264
CVTPURGA EQU   CVTPURG+1
CVTRSV35 EQU   CVTPURG
CVTCBSP  EQU   CVTMAP+256
CVTATERA EQU   CVTATER+1
CVTSYST  EQU   CVTATER
CVTVOLT2 EQU   CVTTAT
CVTVOLI2 EQU   CVTVOLF2
CVTAQAVB EQU   CVTAQAVT+1
CVTRSV34 EQU   CVTTCMFG
CVTRSV33 EQU   CVTTCMFG
CVTRSV32 EQU   CVTTCMFG
CVTRSV31 EQU   CVTTCMFG
CVTRSV30 EQU   CVTTCMFG
CVTRSV29 EQU   CVTTCMFG
CVTLDEV  EQU   CVTTCMFG
CVTTCRDY EQU   CVTTCMFG
CVTGTFA  EQU   CVTGTF+1
CVTRSV27 EQU   CVTGTFST
CVTRNIO  EQU   CVTGTFST
CVTUSR   EQU   CVTGTFST
CVTRV318 EQU   CVTFORM
CVTRV317 EQU   CVTTMODE
CVTRV316 EQU   CVTSTATE
CVTRV315 EQU   CVTGTFS
CVTGTFAV EQU   CVTGTFS
CVT0SCR1 EQU   CVTMAP+232
CVTRV515 EQU   CVTMAP+228
CVTPATCH EQU   CVTMAP+220
CVTTSCE  EQU   CVTMAP+216
CVTLNKSC EQU   CVTMAP+214
CVTQABST EQU   CVTMAP+212
CVTMDLDS EQU   CVTMAP+208
CVTUSER  EQU   CVTMAP+204
CVTABEND EQU   CVTMAP+200
CVTSMCA  EQU   CVTMAP+196
CVTRSV18 EQU   CVTMAP+192
CVTQLPAQ EQU   CVTMAP+188
CVTQCDSR EQU   CVTMAP+184
CVTRSV17 EQU   CVTOPTB
CVTRSV16 EQU   CVTOPTB
CVTFP    EQU   CVTOPTB
CVTAPTHR EQU   CVTOPTB
CVTNLOG  EQU   CVTOPTB
CVTTOD   EQU   CVTOPTB
CVTCTIMS EQU   CVTOPTB
CVTPROT  EQU   CVTOPTB
CVTXPFP  EQU   CVTOPTA
CVTASCII EQU   CVTOPTA
CVTRSV13 EQU   CVTOPTA
CVTRSV12 EQU   CVTOPTA
CVTNIP   EQU   CVTOPTA
CVTDDR   EQU   CVTOPTA
CVTAPR   EQU   CVTOPTA
CVTCCH   EQU   CVTOPTA
CVTSNCTR EQU   CVTMAP+180
CVTQMWR  EQU   CVTMAP+176
CVTQOCR  EQU   CVTMAP+172
CVT1EF00 EQU   CVTMAP+168
CVTMZ00  EQU   CVTMAP+164
CVTSV76Q EQU   CVTSV76C
CVTRSV11 EQU   CVTMAP+156
CVT0PT01 EQU   CVTMAP+152
CVTMSER  EQU   CVTMAP+148
CVTRV516 EQU   CVTIERLC
CVTILCH  EQU   CVTMAP+140
CVT0DS   EQU   CVTMAP+136
CVTFBOSV EQU   CVTMAP+132
CVTNUCB  EQU   CVTMAP+128
CVTSV76M EQU   CVTIOQET
CVTDCBA  EQU   CVTMAP+117
CVTMVS2  EQU   CVTDCB
CVT6DAT  EQU   CVTDCB
CVT4MPS  EQU   CVTDCB
CVTRSV09 EQU   CVTDCB
CVT4MS1  EQU   CVTDCB
CVT2SPS  EQU   CVTDCB
CVT1SSS  EQU   CVTDCB
CVTRSV08 EQU   CVTDCB
CVTSTB   EQU   CVTMAP+112
CVTQTD00 EQU   CVTMAP+108
CVTQTE00 EQU   CVTMAP+104
CVTSJQ   EQU   CVTMAP+96
CVTPBLDL EQU   CVTMAP+92
CVTTPC   EQU   CVTMAP+88
CVTSVDCB EQU   CVTMAP+84
CVTEXIT  EQU   CVTMAP+80
CVT0FN00 EQU   CVTMAP+76
CVTDARA  EQU   CVTDAR+1
CVTRSV07 EQU   CVTFLGS1
CVTRSV06 EQU   CVTFLGS1
CVTRSV05 EQU   CVTFLGS1
CVTRSV04 EQU   CVTFLGS1
CVTRSV03 EQU   CVTFLGS1
CVTRSV02 EQU   CVTFLGS1
CVTRSV01 EQU   CVTFLGS1
CVTDMPLK EQU   CVTFLGS1
CVTXITP  EQU   CVTMAP+68
CVTZDTAB EQU   CVTMAP+64
CVTMSLT  EQU   CVTMAP+60
CVTDATE  EQU   CVTMAP+56
CVTBTERM EQU   CVTMAP+52
CVTSYSAD EQU   CVTMAP+48
CVTXTLER EQU   CVTMAP+44
CVTILK1  EQU   CVTMAP+36
CVTPRLTV EQU   CVTMAP+32
CVTPCNVT EQU   CVTMAP+28
CVT0VL00 EQU   CVTMAP+24
CVTXAPG  EQU   CVTMAP+20
CVTBUF   EQU   CVTMAP+16
CVTJOB   EQU   CVTMAP+12
CVTLINK  EQU   CVTMAP+8
CVT0EF00 EQU   CVTMAP+4
CVTTCBP  EQU   CVTMAP
@NM00009 EQU   QTPRMS
@NM00007 EQU   WKUPARMS+92
@NM00006 EQU   WKUPARMS
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS
@RT00126 EQU   MAINEXT
@RF00137 EQU   @RC00135
@RT00146 EQU   SYNTEXIT
@RF00152 EQU   SYNTERR
@RF00162 EQU   SYNTERR
@RF00170 EQU   SYNTERR
@RT00179 EQU   SYTXCHCK
@RT00194 EQU   SYNTERR
@RT00213 EQU   REJOFF
@RT00217 EQU   REJOFF
@RT00240 EQU   MAINEXIT
@RT00247 EQU   MAINEXIT
@RT00253 EQU   MAINEXIT
@RT00318 EQU   AFFREPLY
@RC00320 EQU   @RC00304
@RT00383 EQU   ENDLOOP
@RT00386 EQU   ENDLOOP
@RT00388 EQU   ENDLOOP
@RT00400 EQU   ENDLOOP
@RF00404 EQU   ENDLOOP
@RT00470 EQU   DEVPEXIT
@RT00543 EQU   CONWTOR
@RF00545 EQU   CNSLWAIT
@RT00564 EQU   DSPTCHK
@RT00613 EQU   CHANEXIT
@RT00632 EQU   CHNLWTOR
@RF00634 EQU   TIMELOOP
@RT00698 EQU   DSPTMSG
@RF00710 EQU   @RC00707
OFFEXIT  EQU   @EL00002
@RC00651 EQU   @EL00002
@RF00787 EQU   @RC00759
CHONEXIT EQU   @RC00757
@RT00851 EQU   GETPSA
@RT00885 EQU   PREPEXIT
@RT00898 EQU   PREPEXIT
@RT00915 EQU   PREPEXIT
@RT00966 EQU   ONEXIT
@RT01009 EQU   CKCOMPLT
@RT01015 EQU   TRCKCONT
@RT01026 EQU   TRCKEXIT
@RT01051 EQU   ONEXIT
@RF01059 EQU   @EL00003
@RF01076 EQU   @EL00004
@RT01089 EQU   PATHSKIP
@RT01092 EQU   PATHSKIP
@RT01094 EQU   PATHSKIP
@RT01096 EQU   PATHSKIP
@RT01119 EQU   DEVLOOP
@RT01122 EQU   DEVLOOP
@RT01124 EQU   DEVLOOP
@RT01126 EQU   DEVLOOP
@RT01128 EQU   DEVLOOP
@RT01142 EQU   DEVLOOP
@RF01153 EQU   @RC01149
PSAFREXT EQU   @EL00008
@RT01262 EQU   UCBRDEXT
@RT01269 EQU   UCBRDEXT
@RT01285 EQU   IOQLOOP
@RT01290 EQU   IOQLOOP
@RF01298 EQU   @RC01288
@RT01305 EQU   IOQLOOP
IOQEXIT  EQU   @EL00011
@RT01433 EQU   CPUERROR
PSAEXIT  EQU   @EL00012
@RT01502 EQU   GETCOREX
@RF01538 EQU   @EL00016
@RC01559 EQU   @EL00016
@RF01572 EQU   @EL00016
@RF01581 EQU   @EL00017
@RC01723 EQU   @RC01715
@RC01709 EQU   @EL00020
@RT00276 EQU   OFFEXIT
@RT00286 EQU   OFFEXIT
@RT00337 EQU   OFFEXIT
@RT00481 EQU   OFFEXIT
@RT00562 EQU   OFFEXIT
@RT00649 EQU   OFFEXIT
@RF00662 EQU   @RC00651
CHNSON   EQU   @RC00651
@RT01238 EQU   PSAFREXT
@RT01329 EQU   PSAEXIT
@RT01339 EQU   PSAEXIT
@RT01422 EQU   PSAEXIT
@RT01470 EQU   PSAEXIT
@RC01753 EQU   @RC01709
@RT00657 EQU   CHNSON
@ENDDATA EQU   *
         END   IEEVCPU,(C'PLS0959',0701,78196)

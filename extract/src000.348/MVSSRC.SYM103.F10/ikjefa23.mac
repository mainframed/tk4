         TITLE 'I K J E F A 2 3  --  CHANGE PROCEDURE NAME ROUTINE     *
                        '
IKJEFA23 CSECT ,                                                   0001
@MAINENT DS    0H                                                  0001
         USING *,@15                                               0001
         B     @PROLOG                                             0001
         DC    AL1(16)                                             0001
         DC    C'IKJEFA23  74.024'                                 0001
         DROP  @15
@PROLOG  STM   @14,@12,12(@13)                                     0001
         BALR  @12,0                                               0001
@PSTART  DS    0H                                                  0001
         USING @PSTART,@12                                         0001
         L     @00,@SIZDATD                                        0001
         GETMAIN R,LV=(0)
         LR    @11,@01                                             0001
         USING @DATD,@11                                           0001
         ST    @13,@SA00001+4                                      0001
         LM    @00,@01,20(@13)                                     0001
         ST    @11,8(,@13)                                         0001
         LR    @13,@11                                             0001
*         CTRLTABP = R1;              /* ADDR OF THE CHANGE        0021
*                                        CONTROL TABLE               */
         LR    CTRLTABP,R1                                         0021
*         RFY R1 UNRSTD;              /* RELEASE PARAMETER REG       */
*         HEDBPTR = HEADADDR;         /* ASSIGN PTR TO USER HEADER   */
         SLR   HEDBPTR,HEDBPTR                                     0023
         ICM   HEDBPTR,7,HEADADDR(CTRLTABP)                        0023
*         SRCHIND = 0;                /* INIT THE SEARCH INDICATOR   */
         MVI   SRCHIND(CTRLTABP),X'00'                             0024
*         CFLAGS = '0000'X;           /* INITIALIZE ALL FLAGS        */
         MVC   CFLAGS(2),@CB00179                                  0025
*         DLPROC = DPROCNM;           /* TRANSFER THE DATALIST     0026
*                                        PROCNAME TO ITS WORK AREA   */
         L     @10,DATALPTR(,CTRLTABP)                             0026
         MVC   DLPROC(8),DPROCNM(@10)                              0026
*         NEWUNAM = UNITNAM;          /* PUT UNIT INTO WORK VARIABLE */
         MVC   NEWUNAM(8),UNITNAM(@10)                             0027
*         NEWRSIZ = SIZE;             /* PUT SIZE INTO WORK VARIABLE */
         SLR   @07,@07                                             0028
         ICM   @07,3,SIZE(@10)                                     0028
         STH   @07,NEWRSIZ                                         0028
*         /* PROCSIZE MUST NOT BE GREATER THAN THE MAXIMUM REGION    */
*         /* SIZE SPECIFIED FOR THIS USER.                           */
*         /* FIRST CHECK FOR 'NOLIM' MAXSIZE.                        */
*         IF UADSMAXC ^= 0            /* MAXSIZE = 'NOLIM',          */
*          & NEWRSIZ > UADSMAXC       /* PROC SIZE GREATER THAN MAXS?*/
*           THEN                      /* YES,                        */
         SLR   @10,@10                                             0029
         ICM   @10,3,UADSMAXC(HEDBPTR)                             0029
         LTR   @10,@10                                             0029
         BZ    @RF00029                                            0029
         CLC   NEWRSIZ(2),UADSMAXC(HEDBPTR)                        0029
         BNH   @RF00029                                            0029
*             DO;                                                  0030
*             NEWRSIZ = UADSMAXC;     /* REDUCE IT TO MAXSIZE        */
         SLR   @10,@10                                             0031
         ICM   @10,3,UADSMAXC(HEDBPTR)                             0031
         STH   @10,NEWRSIZ                                         0031
*             STGFLG = '1'B;          /* THE USER WILL BE INFORMED OF
*                                        THIS CONDITION IF PROCESSING
*                                        IS COMPLETED NORMALLY       */
         OI    STGFLG,B'10000000'                                  0032
*             END;                                                 0033
*         /* PARTIAL BUILDING OF GETSPACE/FREESPACE PARAMETER LIST.  */
*         /* IT WILL BE COMPLETED AT EACH POINT OF CALL.             */
*         READBUFF = HEADADDR;        /* PTR TO USERID TREE BUFFER   */
@RF00029 SLR   @04,@04                                             0034
         ICM   @04,7,HEADADDR(CTRLTABP)                            0034
         ST    @04,READBUFF                                        0034
*         NUMBLOKS = BLKCNT;          /* NO. OF BLOCKS IN BUFFER     */
*                                                                  0035
         SLR   @04,@04                                             0035
         IC    @04,BLKCNT(,CTRLTABP)                               0035
         STH   @04,NUMBLOKS                                        0035
*         /* SAVE THE ADDR OF THE 1ST PROCNAME OFFSET BLOCK IN THE   */
*         /* TOTAL CHAIN. IT WILL BE NEEDED LATER.                   */
*         DPOBPTR = HEDBPTR+UADSPWD1; /* REF THE FIRST PASSWORD OBLK */
         LR    DPOBPTR,HEDBPTR                                     0036
         AL    DPOBPTR,UADSPWD1(,HEDBPTR)                          0036
*         DNOBPTR = HEDBPTR+UADSPSUB; /* REF THE FIRST ACCTNMBR OBLK */
         LR    DNOBPTR,HEDBPTR                                     0037
         AL    DNOBPTR,UADSPSUB(,DPOBPTR)                          0037
*         DROBPTR = HEDBPTR+UADSASUB; /* REF THE FIRST PROCNAME OBLK */
         LR    DROBPTR,HEDBPTR                                     0038
         AL    DROBPTR,UADSASUB(,DNOBPTR)                          0038
*         FRSTDROB = DROBPTR;         /* SAVE THIS ADDRESS           */
         LR    FRSTDROB,DROBPTR                                    0039
*         /* GET ALL THREE POINTERS FROM THE CONTROL TABLE.          */
*         DPOBPTR = PASSADDR;         /* GET PASSWORD OBLK ADDR      */
         L     DPOBPTR,PASSADDR(,CTRLTABP)                         0040
*         DNOBPTR = ACCTADDR;         /* GET ACCTNMBR OBLK ADDR      */
         L     DNOBPTR,ACCTADDR(,CTRLTABP)                         0041
*         DROBPTR = PROCADDR;         /* GET PROCNAME OBLK ADDR      */
         L     DROBPTR,PROCADDR(,CTRLTABP)                         0042
*SVPTRS:  /* SAVE CURRENT CONTROL BLOCK POINTERS                     */
*         OPWSAVE = DPOBPTR;          /* SAVE PTR TO PASSWD OBLK     */
SVPTRS   ST    DPOBPTR,OPWSAVE                                     0043
*         OACSAVE = DNOBPTR;          /* SAVE PTR TO ACTNO OBLK      */
         ST    DNOBPTR,OACSAVE                                     0044
*         OPRSAVE = DROBPTR;          /* SAVE PTR TO PROCNAME OBLK   */
         LR    OPRSAVE,DROBPTR                                     0045
*         /* CHECK WHETHER THE COMMAND SPECIFIES A PROCNAME OR AN    */
*         /* '*' IN THE PROCNAME POSITION OF THE NODELIST. THE '*'   */
*         /* CASE WILL BE HANDLED BY A SEPARATE SECTION OF CODE.     */
*         IF PROCNM(1) = '*'                                       0046
*           THEN                      /* YES, PROCNAME = '*'         */
         L     @08,NODELPTR(,CTRLTABP)                             0046
         CLI   PROCNM(@08),C'*'                                    0046
         BE    @RT00046                                            0046
*             GOTO CHALLPR;           /* GO HANDLE THIS CASE         */
*         UADSRPTR = HEDBPTR+UADSRDAT;/* REFERENCE THE DATA FIELD    */
         L     @02,UADSRDAT(,DROBPTR)                              0048
         LR    UADSRPTR,HEDBPTR                                    0048
         ALR   UADSRPTR,@02                                        0048
*         NDFPTR = UADSRPTR;          /* SAVE THE ABOVE ADDRESS      */
         ST    UADSRPTR,NDFPTR                                     0049
*         RDATSAVE = UADSRDAT;        /* SAVE THE OFFSET             */
         ST    @02,RDATSAVE                                        0050
*         ODFPTR = NDFPTR;            /* SAVE THE ABOVE ADDRESS      */
         L     @02,NDFPTR                                          0051
         LR    ODFPTR,@02                                          0051
*         /* CHECK WHETHER THE INPUT COMMAND SPECIFIES A DATALIST.   */
*         /* THE COMMAND MUST SPECIFY EITHER A DATALIST (NEW PROCNM) */
*         /* OR DATA ITEMS (SIZE OR UNIT), OR BOTH.                  */
*         IF DLPROC(1) ^= '00'X       /* NEW PROCNAME SPECIFIED?     */
*           THEN                      /* YES,                        */
         CLI   DLPROC,X'00'                                        0052
         BNE   @RT00052                                            0052
*             GOTO NPRLS;             /* GO SEARCH FOR THE NEW PROC-
*                                        NAME IN THE LOCAL CHAIN     */
*         /* CHECK WHETHER THE DATA FIELD IS SHARED (CTR>1). IF IT   */
*         /* IS, THEN THE NEW DATA MUST BE COMPARED TO THE EXISTING  */
*         /* DATA. IF THEY ARE NOT EQUAL, A NEW DATA FIELD MUST BE   */
*         /* CREATED.                                                */
*         IF UADSRCTR > 1             /* IS THE DATA FIELD SHARED?   */
*           THEN                      /* YES,                        */
         CLI   UADSRCTR(UADSRPTR),1                                0054
         BH    @RT00054                                            0054
*             GOTO CHKODF;            /* GO COMPARE THE DATA         */
*         CALL PRDFCH;                /* GO INSERT NEW DATA ITEMS    */
         BAL   @14,PRDFCH                                          0056
*CHKCSN1: /* IT IS POSSIBLE THAT THIS PROCNAME EXISTS IN ANOTHER     */
*         /* CHAIN AND NOW HAS THE SAME DATAFIELD BECAUSE OF THE     */
*         /* CHANGES. IF SO, THE NODELIST PROCNAME DATAFIELD WILL    */
*         /* BE FREED AND ITS OFFSET BLOCK WILL POINT TO THE COUSIN  */
*         /* DATAFIELD. THE COUSIN USE COUNTER WILL BE INCREMENTED   */
*         /* BY 1.                                                   */
*         DROBPTR = FRSTDROB;         /* REF 1ST PROC OBLK IN THE  0057
*                                        TOTAL CHAIN                 */
CHKCSN1  LR    DROBPTR,FRSTDROB                                    0057
*         /* IF NO PROCNAME IS BEING CHANGED, THEN THE NODELIST      */
*         /* PROCNAME MUST BE MOVED TO THE FIELD THAT WILL BE USED   */
*         /* FOR COMPARISON IN THE SEARCH.                           */
*         IF DLPROC(1) = '00'X                                     0058
*           THEN                      /* NO, NO NEW PROCNAME,        */
         CLI   DLPROC,X'00'                                        0058
         BNE   @RF00058                                            0058
*             DLPROC = PROCNM;        /* TRANSFER NODELIST PROCNAME  */
         L     @10,NODELPTR(,CTRLTABP)                             0059
         MVC   DLPROC(8),PROCNM(@10)                               0059
*CHKCSN2: /* SEARCH THE TOTAL CHAIN FOR THE NODELIST PROCNAME.       */
*         CALL DLPRTS;                /* GO TO SUBRTNE FOR SEARCH    */
@RF00058 DS    0H                                                  0060
CHKCSN2  BAL   @14,DLPRTS                                          0060
*         /* CHECK THE PTR SET BY THE SUBRTNE. THE NODELIST PROC     */
*         /* WILL OF COURSE BE FOUND IN THE CHAIN WHERE THE CHANGES  */
*         /* HAVE BEEN MADE. IGNORE THAT OFFSET BLOCK & CONTINUE.    */
*         IF NPRSAVE = OPRSAVE        /* PTR = NODELST PROC PTR?     */
*           THEN                      /* YES, IGNORE IT,             */
         CR    NPRSAVE,OPRSAVE                                     0061
         BNE   @RF00061                                            0061
*CHKCSN3:     /* ARE THERE MORE PROCNAMES IN THE TOTAL CHAIN?        */
*             IF UADSRNEX = 0                                      0062
*               THEN                  /* NO,                         */
CHKCSN3  SLR   @10,@10                                             0062
         ICM   @10,7,UADSRNEX(DROBPTR)                             0062
         LTR   @10,@10                                             0062
         BZ    @RT00062                                            0062
*                 GOTO PRNEXT;        /* GO CHECK WHERE PROCESSING 0063
*                                        IS TO CONTINUE              */
*               ELSE                  /* YES,                        */
*                 DO;                                              0064
*                   DROBPTR =         /* REF THE NEXT PROC OBLK      */
*                     HEDBPTR+UADSRNEX;                            0065
         ALR   @10,HEDBPTR                                         0065
         LR    DROBPTR,@10                                         0065
*                   GOTO CHKCSN2;     /* CONTINUE THE SEARCH         */
         B     CHKCSN2                                             0066
*                 END;                                             0067
*         /* IF THE PTR WAS SET TO 0, THEN THE END OF THE TOTAL      */
*         /* CHAIN WAS REACHED WITHOUT FINDING THE NODELIST PROCNAME */
*         IF NPRSAVE = 0              /* NOT FOUND?                  */
*          × ODFPTR = NDFPTR          /* OR POINTING TO SAME DATFLD? */
*           THEN                      /* YES, ONE OF THE ABOVE,      */
@RF00061 LTR   NPRSAVE,NPRSAVE                                     0068
         BZ    @RT00068                                            0068
         L     @10,NDFPTR                                          0068
         CR    ODFPTR,@10                                          0068
         BE    @RT00068                                            0068
*             GOTO PRNEXT;            /* GO CHECK WHERE TO CONTINUE  */
*         /* THE PROCNAME WAS FOUND IN A COUSIN CHAIN. COPY ITS      */
*         /* DATAFLD INTO THE MODEL DATAFLD AND THEN COMPARE IT TO   */
*         /* THE NODELIST PROCNAME DATAFLD.                          */
*         DROBDMDL = DROBD;           /* COPY COUSIN DATAFLD         */
         MVC   DROBDMDL(24),DROBD(UADSRPTR)                        0070
*         UADSRPTR = ODFPTR;          /* REF NODELST PROC DATAFLD    */
         LR    UADSRPTR,ODFPTR                                     0071
*         /* ONLY THE SIZE AND UNIT NAME HAVE TO BE COMPARED.        */
*         IF UADSRSIZ ^= TEMPRSIZ     /* IS SIZE DIFFERENT?          */
*          × UADSUNAM ^= TEMPUNAM     /* OR UNIT NAME DIFFERENT?     */
*           THEN                      /* YES, THEREFORE DATAFLDS ARE
*                                        NOT THE SAME                */
         CLC   UADSRSIZ(2,UADSRPTR),TEMPRSIZ                       0072
         BNE   @RT00072                                            0072
         CLC   UADSUNAM(8,UADSRPTR),TEMPUNAM                       0072
         BNE   @RT00072                                            0072
*             GOTO CHKCSN3;           /* CONTINUE THE PROCESS UNTIL
*                                        END OF TOT CHAIN IS REACHED */
*         /* AN IDENTICAL DATAFLD WAS FOUND. IT WILL BE USED.        */
*         UADSRPTR = NDFPTR;          /* REF THE COUSIN DATAFLD      */
         LR    UADSRPTR,@10                                        0074
*         /* GO CHECK THE USE COUNTER AND, IF NOT GREATER THAN 255,  */
*         /* INCREMENT IT BY ONE.                                    */
*         CALL CTRCHK;                /*                             */
         BAL   @14,CTRCHK                                          0075
*         DROBPTR = OPRSAVE;          /* REF THE NODELST PROC OBLK   */
         LR    DROBPTR,OPRSAVE                                     0076
*         AREAOFST = UADSRDAT;        /* PUT OFFSET TO DATAFLD INTO
*                                        FREESPACE RTNE PARMLIST     */
         L     @10,UADSRDAT(,DROBPTR)                              0077
         ST    @10,AREAOFST                                        0077
*         AREALNTH = 24;              /* SAME WITH LNGTH TO BE FREED */
         MVC   AREALNTH(2),@CH00062                                0078
*         CALL IKJFRSP;               /* GO FREE THE DATAFLD         */
         BAL   @14,IKJFRSP                                         0079
*         UADSRDAT = RDATSAVE;        /* TRANSFER OFFSET TO COUSIN 0080
*                                        DATAFLD INTO NODELST PROC 0080
*                                        OFFSET BLOCK                */
         L     @10,RDATSAVE                                        0080
         ST    @10,UADSRDAT(,DROBPTR)                              0080
*         GOTO PRNEXT;                /* GO CHECK WHERE PROCESSING 0081
*                                        IS TO CONTINUE              */
         B     PRNEXT                                              0081
*CHKODF:  /* THE NLPROC DATA FIELD IS SHARED WITH COUSINS, BUT SINCE */
*         /* NO DATALIST WAS ENTERED, THE FIELD CAN BE USED IF THE   */
*         /* COMMAND DATA ITEMS ARE NOT DIFFERENT FROM THE EXISTING  */
*         /* DATA. IF THEY ARE, THEN A NEW DATA FIELD MUST BE BUILT. */
*         CALL CMPRND;                /* GO COMPARE THE NEW DATA     */
CHKODF   BAL   @14,CMPRND                                          0082
*         /* IS THE NEW DATA EQUAL TO THE EXISTING DATA?             */
*         IF PRDFLG = '1'B                                         0083
*           THEN                      /* YES,                        */
         TM    PRDFLG,B'00000010'                                  0083
         BO    @RT00083                                            0083
*             GOTO PRNEXT;            /* GO CHECK WHERE PROCESSING 0084
*                                        IS TO CONTINUE              */
*NPRDF:   /* GO CREATE A NEW DATA FIELD.                             */
*         CALL NEWPRDF;                                            0085
NPRDF    BAL   @14,NEWPRDF                                         0085
*         CALL PRDFCH;                /* GO INSERT NEW DATA ITEMS, IF
*                                        ANY WERE ENTERED            */
         BAL   @14,PRDFCH                                          0086
*         /* DOES THE COMMAND SPECIFY A NEW PROCNAME?                */
*         IF DLPROC(1) = '00'X                                     0087
*           THEN                      /* NO,                         */
         CLI   DLPROC,X'00'                                        0087
         BNE   @RF00087                                            0087
*             DO;                                                  0088
*               ODFPTR = UADSRPTR;    /* TRANSFER PTR FOR LATER USE  */
         LR    ODFPTR,UADSRPTR                                     0089
*               GOTO CHKCSN1;         /* GO CHECK FOR COUSIN WITH  0090
*                                        EQUAL DATA                  */
         B     CHKCSN1                                             0090
*             END;                                                 0091
*         UADSRNAM = DLPROC;          /* INSERT THE NEW PROCNAME     */
@RF00087 MVC   UADSRNAM(8,UADSRPTR),DLPROC                         0092
*PRNEXT:  /* AT LEAST ONE PROCNAME HAS NOW BEEN PROCESSED AND THIS   */
*         /* USERID TREE HAS BEEN CHANGED (THE COPY ONLY). DETERMINE */
*         /* WHERE PROCESSING IS TO CONTINUE.                        */
*         TRCHGE = '1'B;              /* 1- THIS TREE HAS BEEN CHNGD */
PRNEXT   OI    TRCHGE(CTRLTABP),B'10000000'                        0093
*         /* CHECK WHETHER MORE ACCTNMBRS HAVE TO BE PROCESSED UNDER */
*         /* THE CURRENTLY REFERENCED PASSWORD. THIS IS POSSIBLE     */
*         /* ONLY IF THE NODELIST ACCTNMBR = '*'.                    */
*         DNOBPTR = OACSAVE;          /* REF ORIGINAL ACCTNMBR AGAIN */
         L     DNOBPTR,OACSAVE                                     0094
*         /* NODELIST ACCTNMBR = '*'?                                */
*         IF ACCTNO(1:2) = '* '                                    0095
*           THEN                      /* YES,                        */
         L     @10,NODELPTR(,CTRLTABP)                             0095
         CLC   ACCTNO(2,@10),@CC00205                              0095
         BNE   @RF00095                                            0095
*             /* CHECK THE CHAIN FLAG IN THE OFFSET BLOCK            */
*             IF AFLG01 = '0'B        /* MORE ACTNMBRS IN LOC CHAIN? */
*               THEN                  /* YES,                        */
         TM    AFLG01(DNOBPTR),B'10000000'                         0096
         BNZ   @RF00096                                            0096
*                 DO;                                              0097
*                   ACCTADDR =        /* PUT PTR TO NEXT ACCTNMBR..  */
*                     HEDBPTR+UADSANEX;/* OBLK INTO CTRLTAB          */
         LR    @10,HEDBPTR                                         0098
         SLR   @04,@04                                             0098
         ICM   @04,7,UADSANEX(DNOBPTR)                             0098
         ALR   @10,@04                                             0098
         ST    @10,ACCTADDR(,CTRLTABP)                             0098
*                   SRCHIND = 2;      /* SIGNAL IKJEFA20 TO REENTER
*                                        THE PROCNAME SEARCH LOOP    */
         MVI   SRCHIND(CTRLTABP),X'02'                             0099
*                   RETURN;           /* RETURN TO IKJEFA20          */
@EL00001 L     @13,4(,@13)                                         0100
@EF00001 L     @00,@SIZDATD                                        0100
         LR    @01,@11                                             0100
         FREEMAIN R,LV=(0),A=(1)
@ER00001 LM    @14,@12,12(@13)                                     0100
         BR    @14                                                 0100
*                 END;                                             0101
*PRNEXT2: /* CHECK WHETHER MORE PASSWORDS HAVE TO BE PROCESSED FOR   */
*         /* THIS USERID. IF YES, THEN SIGNAL IKJEFA20 TO SEARCH FOR */
*         /* THE NODELIST PROCNAME AND/OR ACCTNMBR UNDER THE NEXT    */
*         /* PASSWORD. IF AN ACCTNMBR WAS SPECIFIED, IT WILL HAVE TO */
*         /* BE FOUND FIRST.                                         */
*         DPOBPTR = OPWSAVE;          /* REF ORIGINAL PASSWD AGAIN   */
@RF00096 DS    0H                                                  0102
@RF00095 DS    0H                                                  0102
PRNEXT2  L     DPOBPTR,OPWSAVE                                     0102
*         /* NODELIST PASSWORD = '*'?                                */
*         IF PASSWD(1) = '*'                                       0103
*           THEN                      /* YES,                        */
         L     @10,NODELPTR(,CTRLTABP)                             0103
         CLI   PASSWD(@10),C'*'                                    0103
         BNE   @RF00103                                            0103
*             /* CHECK THE CHAIN FLAG IN THE PASSWORD OFFSET BLOCK.  */
*             IF PFLG01 = '0'B        /* MORE PASSWORDS?             */
*               THEN                  /* YES,                        */
         TM    PFLG01(DPOBPTR),B'10000000'                         0104
         BNZ   @RF00104                                            0104
*                 DO;                                              0105
*                   PASSADDR =        /* PUT PTR TO THE NEXT PASSWD  */
*                     HEDBPTR+UADSPNEX;/* OBLK INTO THE CHANGE     0106
*                                        CONTROL TABLE               */
         LR    @10,HEDBPTR                                         0106
         SLR   @07,@07                                             0106
         ICM   @07,7,UADSPNEX(DPOBPTR)                             0106
         ALR   @10,@07                                             0106
         ST    @10,PASSADDR(,CTRLTABP)                             0106
*                   SRCHIND = 1;      /* SIGNAL IKJEFA20 TO REENTER
*                                        THE ACCTNMBR SEARCH LOOP    */
         MVI   SRCHIND(CTRLTABP),X'01'                             0107
*                   RETURN;           /* RETURN TO IKJEFA20          */
         B     @EL00001                                            0108
*                 END;                                             0109
*         /* NO, THEREFORE NO MORE CHANGES ARE NECESSARY FOR THIS    */
*         /* USERID TREE.                                            */
*         GOTO CHGEOK;                /* SET INDICATORS & RETURN     */
         B     CHGEOK                                              0110
*NPRLS:   /* GO SEARCH FOR THE NEW PROCNAME IN THIS LOCAL CHAIN.     */
*         DROBPTR = HEDBPTR+UADSASUB; /* REF 1ST OBLK IN LOC CHAIN   */
NPRLS    LR    DROBPTR,HEDBPTR                                     0111
         AL    DROBPTR,UADSASUB(,DNOBPTR)                          0111
*         CALL DLPRLS;                                             0112
         BAL   @14,DLPRLS                                          0112
*         /* DOES THE NEW PROCNAME EXIST IN THIS LOCAL CHAIN?        */
*         IF NPRSAVE ^= 0                                          0113
*           THEN                      /* YES,                        */
         LTR   NPRSAVE,NPRSAVE                                     0113
         BNZ   @RT00113                                            0113
*             GOTO PRCHGE1;           /* GO MAKE REQUIRED CHANGES    */
*         /* THIS SECTION OF CODE WILL SEARCH FOR A PROCNAME         */
*         /* IN THE TOTAL LATERAL CHAIN (ALL PROCS IN THE TREE).     */
*         DROBPTR = FRSTDROB;         /* REF 1ST OBLK IN TOTAL CHAIN */
         LR    DROBPTR,FRSTDROB                                    0115
*         CALL DLPRTS;                /* GO TO THE SEARCH RTNE       */
         BAL   @14,DLPRTS                                          0116
*         /* DOES THE PROCNAME EXIST IN THE TOTAL CHAIN?             */
*         IF NPRSAVE = 0                                           0117
*           THEN                      /* NO,                         */
         LTR   NPRSAVE,NPRSAVE                                     0117
         BZ    @RT00117                                            0117
*             GOTO PRCHGE6;           /* GO CHECK OLD PROC DATAFLD   */
*           ELSE                      /* YES,                        */
*             DO;                                                  0119
*               FLDFLG3 = '1'B;       /* 1- COUSIN EXISTS            */
         OI    FLDFLG3,B'00000100'                                 0120
*               GOTO CHKDLDF;         /* GO CHECK ITS DATA FIELD TO
*                                        SEE IF IT CAN BE USED       */
         B     CHKDLDF                                             0121
*             END;                                                 0122
*PRCHGE1: /* THE NEW (DATALIST) PROCNAME EXISTS IN THE LOCAL CHAIN.  */
*         /* ITS OFFSET BLOCK AND, IF POSSIBLE, ITS DATA FIELD WILL  */
*         /* BE PRUNED FROM THE TREE.                                */
*         UADSRPTR = ODFPTR;          /* REF THE OLD PROC DATA FLD  */
PRCHGE1  LR    UADSRPTR,ODFPTR                                     0123
*         /* CHECK THE USE CTR OF THE OLD PROCNAME. IF THE FIELD IS  */
*         /* SHARED WITH COUSINS, THEN IT CANNOT BE USED.            */
*         IF UADSRCTR > 1                                          0124
*           THEN                      /* YES, IT IS SHARED AND CANNOT
*                                        BE USED                     */
         CLI   UADSRCTR(UADSRPTR),1                                0124
         BH    @RT00124                                            0124
*             GOTO PRCHGE2;           /* GO CHECK WHETHER THE NEW DF
*                                        CAN BE USED                 */
*         /* NO, IT IS NOT SHARED AND WILL BE USED                   */
*         DROBPTR = NPRSAVE;          /* REF THE NEW PROC DATA FLD   */
         LR    DROBPTR,NPRSAVE                                     0126
*         UADSRPTR = NDFPTR;          /* REF THE DATA FIELD          */
         L     UADSRPTR,NDFPTR                                     0127
*         /* CHECK THE USE COUNTER IN THE NEW DATA FIELD. IF THE     */
*         /* FIELD IS BEING SHARED WITH COUSINS, THEN IT CANNOT BE   */
*         /* PRUNED FROM THE TREE.                                   */
*         IF UADSRCTR > 1             /* IS DATA FIELD BEING SHARED? */
*           THEN                      /* YES,                        */
         CLI   UADSRCTR(UADSRPTR),1                                0128
         BNH   @RF00128                                            0128
*             DO;                                                  0129
*               UADSRCTR = UADSRCTR-1;/* DECREMENT THE USE COUNTER   */
         SLR   @15,@15                                             0130
         IC    @15,UADSRCTR(,UADSRPTR)                             0130
         BCTR  @15,0                                               0130
         STC   @15,UADSRCTR(,UADSRPTR)                             0130
*               GOTO FREEOB;          /* GO FREE THE OFFSET BLOCK    */
         B     FREEOB                                              0131
*             END;                                                 0132
*         AREAOFST = UADSRDAT;        /* OFFSET TO AREA TO BE FREED  */
@RF00128 L     @15,UADSRDAT(,DROBPTR)                              0133
         ST    @15,AREAOFST                                        0133
*         AREALNTH = 24;              /* NUMBER OF BYTES TO BE FREED */
         MVC   AREALNTH(2),@CH00062                                0134
*         CALL IKJFRSP;               /* GO FREE THE DATA FIELD      */
         BAL   @14,IKJFRSP                                         0135
*FREEOB:  /* PRUNE THE OFFSET BLOCK AND CHANGE THE AFFECTED          */
*         /* OFFSETS AND CHAIN FLAGS.                                */
*         CSNSAVE = UADSRNEX;         /* SAVE OFFSET TO NEXT OFFSET
*                                        BLOCK, WHICH CAN BE A BROTHER
*                                        OR COUSIN                   */
FREEOB   SLR   @15,@15                                             0136
         ICM   @15,7,UADSRNEX(DROBPTR)                             0136
         ST    @15,CSNSAVE                                         0136
*         /* SAVE THE CHAIN FLAG                                     */
*         IF FLGR01 = '1'B            /* CHAIN FLAG = 1?             */
*           THEN                      /* YES,                        */
         TM    FLGR01(DROBPTR),B'10000000'                         0137
         BNO   @RF00137                                            0137
*             FLGSAVE = '1'B;         /* SAVE FLAG = 1               */
         OI    FLGSAVE,B'00100000'                                 0138
*           ELSE                      /* NO,                         */
*             FLGSAVE = '0'B;         /* SAVE FLAG = 0               */
         B     @RC00137                                            0139
@RF00137 NI    FLGSAVE,B'11011111'                                 0139
*         PRUNOFS = NPRSAVE-HEDBPTR;  /* RECALCULATE THE OFFSET TO 0140
*                                        THE OBLK TO BE PRUNED       */
@RC00137 LR    @03,NPRSAVE                                         0140
         SLR   @03,HEDBPTR                                         0140
         ST    @03,PRUNOFS                                         0140
*         AREAOFST = PRUNOFS;         /* OFFSET TO OBLK TO BE FREED  */
         ST    @03,AREAOFST                                        0141
*         AREALNTH = 12;              /* NUMBER OF BYTES TO BE FREED */
         MVC   AREALNTH(2),@CH00055                                0142
*         CALL IKJFRSP;               /* GO FREE THE OFFSET BLOCK    */
         BAL   @14,IKJFRSP                                         0143
*         DROBPTR = HEDBPTR+UADSASUB; /* REF THE FIRST PROC OFFSET 0144
*                                        BLOCK IN THIS LOCAL CHAIN   */
         LR    DROBPTR,HEDBPTR                                     0144
         AL    DROBPTR,UADSASUB(,DNOBPTR)                          0144
*         /* IF THE PRUNED OFFSET BLOCK WAS THE FIRST ONE IN THE     */
*         /* LOCAL CHAIN, THEN THE OFFSET TO THE PROC OFFSET BLOCK   */
*         /* IN THE ACCTNMBR OFFSET BLOCK MUST BE CHANGED. ALSO, IF  */
*         /* THIS WAS NOT THE FIRST PROCNAME IN THE TOTAL CHAIN, THE */
*         /* COUSIN OFFSET BLOCK MUST BE FOUND AND CHANGED.          */
*         IF DROBPTR = NPRSAVE        /* WAS THE PRUNED OB THE FIRST
*                                        ONE IN THE LOCAL CHAIN?     */
*           THEN                      /* YES,                        */
         CR    DROBPTR,NPRSAVE                                     0145
         BNE   @RF00145                                            0145
*             DO;                                                  0146
*               UADSASUB = CSNSAVE;   /* PUT THE OFFSET TO THE NEXT
*                                        OB INTO THE ACCTNMBR OB     */
         L     @04,CSNSAVE                                         0147
         ST    @04,UADSASUB(,DNOBPTR)                              0147
*               GO TO FNDCSN;         /* GO SEARCH FOR THE COUSIN IN
*                                        THE PREVIOUS CHAIN          */
         B     FNDCSN                                              0148
*             END;                                                 0149
*         /* NO, FIND THE BROTHER WHICH POINTS TO THE PRUNED OB      */
*FNDPRBR: /* SEARCH FOR THE BROTHER OFFSET BLOCK THAT POINTS TO THE  */
*         /* PRUNED OFFSET BLOCK. TO DO THIS, FIND THE BLOCK THAT    */
*         /* CONTAINS THE KNOWN OFFSET TO THE PRUNED BLOCK.          */
*         IF PRUNOFS ^= UADSRNEX      /* DOES THIS OB CONTAIN THE  0150
*                                        OFFSET TO THE PRUNED OB?    */
*           THEN                      /* NO,                         */
@RF00145 DS    0H                                                  0150
FNDPRBR  SLR   @07,@07                                             0150
         ICM   @07,7,UADSRNEX(DROBPTR)                             0150
         C     @07,PRUNOFS                                         0150
         BE    @RF00150                                            0150
*             DO;                                                  0151
*               DROBPTR = HEDBPTR     /* REF THE NEXT OB             */
*                 +UADSRNEX;                                       0152
         ALR   @07,HEDBPTR                                         0152
         LR    DROBPTR,@07                                         0152
*               GOTO FNDPRBR;         /* CONTINUE THE SEARCH         */
         B     FNDPRBR                                             0153
*             END;                                                 0154
*         UADSRNEX = CSNSAVE;         /* PUT THE OFFSET TO THE NEXT
*                                        OB INTO THIS OB             */
@RF00150 MVC   UADSRNEX(3,DROBPTR),CSNSAVE+1                       0155
*         /* PUT THE CHAIN FLAG FROM THE PRUNED OBLK INTO THIS OBLK  */
*         IF FLGSAVE = '1'B           /* WAS FLAG = 1?               */
*           THEN                      /* YES,                        */
         TM    FLGSAVE,B'00100000'                                 0156
         BNO   @RF00156                                            0156
*             FLGR01 = '1'B;          /* SET CHAIN FLAG TO 1         */
         OI    FLGR01(DROBPTR),B'10000000'                         0157
*           ELSE                      /* NO,                         */
*             FLGR01 = '0'B;          /* SET CHAIN FLAG TO 0         */
         B     @RC00156                                            0158
@RF00156 NI    FLGR01(DROBPTR),B'01111111'                         0158
*         /* CHECK THIS CONTROL FLAG. IF IT IS ON, THEN A NEW DATA   */
*         /* FIELD MUST BE CREATED.                                  */
*         IF FLDFLG2 = '1'B                                        0159
*           THEN                      /* YES,                        */
@RC00156 TM    FLDFLG2,B'00001000'                                 0159
         BO    @RT00159                                            0159
*             GOTO NPRDF;             /* GO CREATE A NEW DATA FIELD  */
*PRDFCH2: /* DETERMINE WHICH DATA FIELD IS BEING USED AND THEN SET   */
*         /* APPROPRIATE POINTERS.                                   */
*         IF FLDFLG = '1'B                                         0161
*           THEN                      /* DLPROC DATA FIELD IS USED   */
PRDFCH2  TM    FLDFLG,B'00010000'                                  0161
         BNO   @RF00161                                            0161
*             DO;                                                  0162
*               UADSRPTR = NDFPTR;    /* ADDR OF DLPROC DATA FIELD   */
         L     @07,NDFPTR                                          0163
         LR    UADSRPTR,@07                                        0163
*               ODFPTR = NDFPTR;      /* SWITCH PTRS FOR LATER USE   */
         LR    ODFPTR,@07                                          0164
*             END;                                                 0165
*           ELSE                      /* NLPROC DATA FIELD IS USED   */
*             DO;                                                  0166
         B     @RC00161                                            0166
@RF00161 DS    0H                                                  0167
*               UADSRPTR = ODFPTR;    /* REF NLPROC DATA FIELD       */
         LR    UADSRPTR,ODFPTR                                     0167
*               UADSRNAM = DLPROC;    /* INSERT THE NEW PROCNAME     */
         MVC   UADSRNAM(8,UADSRPTR),DLPROC                         0168
*             END;                                                 0169
*         CALL PRDFCH;                /* GO INSERT NEW DATA ITEMS, 0170
*                                        IF ANY WERE ENTERED         */
@RC00161 BAL   @14,PRDFCH                                          0170
*         /* GO CHECK WHETHER AN IDENTICAL COUSIN DATA FIELD EXISTS  */
*         /* IN ANOTHER PART OF THE TOTAL CHAIN. IF SO, THEN THE     */
*         /* COUSIN DATA FIELD MUST BE USED.                         */
*         GOTO CHKCSN1;                                            0171
         B     CHKCSN1                                             0171
*FNDCSN:  /* THIS SECTION OF CODE WILL SEARCH FOR THE PROCNAME OFF-  */
*         /* SET BLOCK WHICH CONTAINS THE OFFSET TO THE PRUNED OFF-  */
*         /* SET BLOCK. THE SEARCH IS MADE IN THE TOTAL CHAIN SINCE  */
*         /* THE PRUNED BLOCK WAS THE FIRST IN ITS LOCAL CHAIN.      */
*         /* IF THE PRUNED OFFSET BLOCK WAS THE 1ST IN THE TOTAL     */
*         /* CHAIN, THEN NO SEARCH IS NECESSARY.                     */
*         IF NPRSAVE = FRSTDROB       /*                             */
*           THEN                      /* YES, 1ST IN TOTAL CHAIN,    */
FNDCSN   CR    NPRSAVE,FRSTDROB                                    0172
         BNE   @RF00172                                            0172
*             DO;                                                  0173
*               /* RESET ADDR OF 1ST OFFSET BLOCK IN THE TOTAL CHAIN */
*               FRSTDROB = HEDBPTR+UADSASUB;                       0174
         LR    FRSTDROB,HEDBPTR                                    0174
         AL    FRSTDROB,UADSASUB(,DNOBPTR)                         0174
*               GOTO PRDFCH2;         /* GO CHANGE DATFLD            */
         B     PRDFCH2                                             0175
*             END;                                                 0176
*         DROBPTR = FRSTDROB;         /* REF 1ST OBLK IN TOTAL CHAIN */
@RF00172 LR    DROBPTR,FRSTDROB                                    0177
*FNDCSN2: /* CHECK WHETHER THIS OFFSET BLOCK POINTS TO THE PRUNED OB */
*         DO WHILE PRUNOFS ^= UADSRNEX;                            0178
FNDCSN2  B     @DE00178                                            0178
@DL00178 DS    0H                                                  0179
*           DROBPTR = HEDBPTR+UADSRNEX;/* REF THE NEXT OB            */
         LR    @07,HEDBPTR                                         0179
         SLR   @04,@04                                             0179
         ICM   @04,7,UADSRNEX(DROBPTR)                             0179
         ALR   @07,@04                                             0179
         LR    DROBPTR,@07                                         0179
*             END;                                                 0180
@DE00178 L     @07,PRUNOFS                                         0180
         SLR   @04,@04                                             0180
         ICM   @04,7,UADSRNEX(DROBPTR)                             0180
         CR    @07,@04                                             0180
         BNE   @DL00178                                            0180
*         UADSRNEX = CSNSAVE;         /* PUT THE OFFSET TO THE NEXT
*                                        OB INTO THIS OB             */
         MVC   UADSRNEX(3,DROBPTR),CSNSAVE+1                       0181
*         GOTO PRDFCH2;                                            0182
         B     PRDFCH2                                             0182
*PRCHGE2: /* THE DATA FIELD OF THE NODELIST (OLD) PROCNAME CANNOT    */
*         /* BE USED. IF THE USE CTR OF THE DATALIST (NEW) PROCNAME  */
*         /* DATA FIELD IS 1, THEN THIS FIELD WILL BE USED. IF NOT,  */
*         /* THEN A COMPARISON OF DATA IS NECESSARY.                 */
*         UADSRPTR = NDFPTR;          /* REF THE DLPROC DATA FIELD   */
PRCHGE2  L     @03,NDFPTR                                          0183
         LR    UADSRPTR,@03                                        0183
*         /* IS THIS DATA FIELD SHARED WITH COUSINS?                 */
*         IF UADSRCTR > 1                                          0184
*           THEN                      /* YES,                        */
         CLI   UADSRCTR(UADSRPTR),1                                0184
         BH    @RT00184                                            0184
*             GOTO CHKDLDF;           /* GO COMPARE THE DATA         */
*         /* THIS FIELD IS NOT SHARED AND CAN THEREFORE BE USED.     */
*         UADSRPTR = ODFPTR;          /* REF THE NLPROC DATA FIELD   */
         LR    UADSRPTR,ODFPTR                                     0186
*         NDFPTR -> DROBD = DROBD;    /* COPY THE NLPROC DF INTO THE
*                                        DLPROC DATA FLD             */
         L     @15,NDFPTR                                          0187
         MVC   DROBD(24,@15),DROBD(UADSRPTR)                       0187
*         UADSRCTR = UADSRCTR-1;      /* DECREMENT THE NLPROC USECTR */
         SLR   @14,@14                                             0188
         IC    @14,UADSRCTR(,UADSRPTR)                             0188
         BCTR  @14,0                                               0188
         STC   @14,UADSRCTR(,UADSRPTR)                             0188
*         UADSRPTR = NDFPTR;          /* REF THE NEW DATA FIELD      */
         LR    UADSRPTR,@15                                        0189
*         UADSRCTR = 1;                                            0190
         MVI   UADSRCTR(UADSRPTR),X'01'                            0190
*         UADSRNAM = DLPROC;          /* INSERT NEW PROCNAME         */
         MVC   UADSRNAM(8,UADSRPTR),DLPROC                         0191
*         DROBPTR = NPRSAVE;          /* REF THE DLPROC OBLK         */
         LR    DROBPTR,NPRSAVE                                     0192
*PRCHGE3: RDATSAVE = UADSRDAT;        /* SAVE OFFSET TO DATA FIELD   */
PRCHGE3  L     @15,UADSRDAT(,DROBPTR)                              0193
         ST    @15,RDATSAVE                                        0193
*         DROBPTR = OPRSAVE;          /* REF OLD OFFSET BLOCK        */
         LR    DROBPTR,OPRSAVE                                     0194
*         UADSRDAT = RDATSAVE;        /* PUT THE OFFSET TO THE DLPROC
*                                        DATA FIELD INTO THIS OBLK   */
         ST    @15,UADSRDAT(,DROBPTR)                              0195
*         DROBPTR = NPRSAVE;          /* THE DLPROC OBLK WILL BE   0196
*                                        PRUNED FROM THE TREE        */
         LR    DROBPTR,NPRSAVE                                     0196
*         FLDFLG = '1'B;              /* 1- INDICATES THAT THE DLPROC
*                                        DATA FIELD IS BEING USED    */
         OI    FLDFLG,B'00010000'                                  0197
*         GOTO FREEOB;                /* GO PRUNE THE OBLK           */
         B     FREEOB                                              0198
*CHKDLDF: /* BUILD A WORKING MODEL OF THE NODELIST PROC DATA FIELD.  */
*         /* CHANGE DATA ITEMS THAT WERE SPECIFIED IN THE COMMAND    */
*         /* AND THEN COMPARE THIS MODEL TO THE DATALIST PROC DATA   */
*         /* FIELD, EXCLUDING THE USE COUNTER.                       */
*         UADSRPTR = ODFPTR;          /* REF THE NLPROC DATA FLD     */
CHKDLDF  LR    UADSRPTR,ODFPTR                                     0199
*         DROBDMDL = DROBD;           /* COPY IT INTO MODEL DATA FLD */
         MVC   DROBDMDL(24),DROBD(UADSRPTR)                        0200
*         TEMPRSIZ = NEWRSIZ;         /* INSERT THE NEW PROCSIZE     */
         SLR   @03,@03                                             0201
         ICM   @03,3,NEWRSIZ                                       0201
         STH   @03,TEMPRSIZ                                        0201
*         TEMPUNAM = NEWUNAM;         /* INSERT THE NEW UNIT NAME    */
         MVC   TEMPUNAM(8),NEWUNAM                                 0202
*         UADSRPTR = NDFPTR;          /* REF THE DLPROC DATA FLD     */
         L     UADSRPTR,NDFPTR                                     0203
*         /* CHECK THE LOOP CONTROL FLAG. '1' INDICATES THAT THE     */
*         /* DATALIST PROCNAME EXISTS IN A COUSIN CHAIN, BUT NOT     */
*         /* IN THE SAME LOCAL CHAIN.                                */
*         IF FLDFLG3 = '1'B                                        0204
*           THEN                      /* DLPROC EXISTS IN COUSIN..   */
         TM    FLDFLG3,B'00000100'                                 0204
         BO    @RT00204                                            0204
*             GOTO PRCHGE4;           /* CHAIN, GO COMPARE DATAFLDS  */
*         /* COMPARE THE MODEL TO THE DATALIST PROCNAME DATAFLD.     */
*         /* ONLY THE SIZE AND UNIT NAME HAVE TO BE COMPARED.        */
*         IF UADSRSIZ = TEMPRSIZ      /* IS SIZE THE SAME?           */
*          & UADSUNAM = TEMPUNAM      /* AND UNIT NAME EQUAL?        */
*           THEN                      /* THEY ARE EQUAL              */
         CLC   UADSRSIZ(2,UADSRPTR),TEMPRSIZ                       0206
         BNE   @RF00206                                            0206
         CLC   UADSUNAM(8,UADSRPTR),TEMPUNAM                       0206
         BNE   @RF00206                                            0206
*             DO;                                                  0207
*               UADSRPTR = ODFPTR;    /* REF THE NLPROC DATA FIELD   */
         LR    UADSRPTR,ODFPTR                                     0208
*               UADSRCTR = UADSRCTR-1;/* DECREMENT THE USE CTR       */
         SLR   @15,@15                                             0209
         IC    @15,UADSRCTR(,UADSRPTR)                             0209
         BCTR  @15,0                                               0209
         STC   @15,UADSRCTR(,UADSRPTR)                             0209
*               DROBPTR = NPRSAVE;    /* REF THE DLPROC OBLK         */
         LR    DROBPTR,NPRSAVE                                     0210
*               GOTO PRCHGE3;         /* GO MAKE NECESSARY CHANGES   */
         B     PRCHGE3                                             0211
*             END;                                                 0212
*         /* THE DATALIST PROCNAME DATA FIELD CANNOT BE USED. A NEW  */
*         /* DATA FIELD MUST BE CREATED.                             */
*         DROBPTR = OPRSAVE;          /* REF THE NLPROC OBLK         */
@RF00206 LR    DROBPTR,OPRSAVE                                     0213
*         UADSRPTR = ODFPTR;          /* REF THE NLPROC DATA FIELD   */
         LR    UADSRPTR,ODFPTR                                     0214
*         FLDFLG2 = '1'B;             /* 1 - CREATE NEW DATA FIELD   */
         OI    FLDFLG2,B'00001000'                                 0215
*         GOTO FREEOB;                /* GO PRUNE THE DLPROC OBLK    */
         B     FREEOB                                              0216
*PRCHGE4: /* COMPARE THE MODEL TO THE DATALIST PROCNAME DATA FIELD.  */
*         /* ONLY THE SIZE AND UNIT NAME HAVE TO BE COMPARED.        */
*         FLDFLG3 = '0'B;             /* FIRST RESET CONTROL FLAG    */
PRCHGE4  NI    FLDFLG3,B'11111011'                                 0217
*         IF UADSRSIZ ^= TEMPRSIZ     /* IS SIZE DIFFERENT?          */
*          × UADSUNAM ^= TEMPUNAM     /* OR UNIT NAME DIFFERENT?     */
*           THEN                      /* YES, THEREFORE DATAFLDS ARE
*                                        NOT THE SAME                */
         CLC   UADSRSIZ(2,UADSRPTR),TEMPRSIZ                       0218
         BNE   @RT00218                                            0218
         CLC   UADSUNAM(8,UADSRPTR),TEMPUNAM                       0218
         BNE   @RT00218                                            0218
*             GOTO PRCHGE6;           /* CHECK WHETHER THE NLPROC DATA
*                                        FIELD CAN BE USED           */
*         /* THE DATALIST PROCNAME DATA FIELD, EXISTING IN A COUSIN  */
*         /* CHAIN, WILL BE USED.                                    */
*         DROBPTR = OPRSAVE;          /* REF THE NLPROC OBLK         */
         LR    DROBPTR,OPRSAVE                                     0220
*         UADSRDAT = RDATSAVE;        /* INSERT OFFSET TO COUSIN DF  */
         L     @10,RDATSAVE                                        0221
         ST    @10,UADSRDAT(,DROBPTR)                              0221
*         UADSRPTR = NDFPTR;          /* REF THE DLPROC DATA FIELD   */
         L     UADSRPTR,NDFPTR                                     0222
*         /* GO CHECK THE USE COUNTER AND, IF NOT GREATER THAN 255,  */
*         /* INCREMENT IT BY ONE.                                    */
*         CALL CTRCHK;                /*                             */
         BAL   @14,CTRCHK                                          0223
*         UADSRPTR = ODFPTR;          /* REF THE NLPROC DATA FIELD   */
         LR    UADSRPTR,ODFPTR                                     0224
*         /* IF THE USE COUNTER IN THE NODELIST PROC DATA FIELD IS   */
*         /* 1 (NOT SHARED), THEN THIS FIELD WILL BE PRUNED.         */
*         IF UADSRCTR = 1                                          0225
*           THEN                      /* FIELD IS NOT SHARED,        */
         CLI   UADSRCTR(UADSRPTR),1                                0225
         BE    @RT00225                                            0225
*             GO TO PRCHGE5;          /* GO PRUNE IT FROM THE TREE   */
*         UADSRCTR = UADSRCTR-1;      /* DECREMENT THE USE CTR       */
         SLR   @10,@10                                             0227
         IC    @10,UADSRCTR(,UADSRPTR)                             0227
         BCTR  @10,0                                               0227
         STC   @10,UADSRCTR(,UADSRPTR)                             0227
*         GOTO PRNEXT;                /* GO CHECK WHERE PROCESSING 0228
*                                        IS TO CONTINUE              */
         B     PRNEXT                                              0228
*PRCHGE5: /* PRUNE THE NODELIST PROCNAME DATA FIELD FROM THE TREE.   */
*         AREAOFST = ODFPTR-HEDBPTR;  /* CALCULATE OFFSET TO THE   0229
*                                        NLPROC DATA FIELD           */
PRCHGE5  LR    @10,ODFPTR                                          0229
         SLR   @10,HEDBPTR                                         0229
         ST    @10,AREAOFST                                        0229
*         AREALNTH = 24;              /* NUMBER OF BYTES TO BE FREED */
         MVC   AREALNTH(2),@CH00062                                0230
*         CALL IKJFRSP;               /* FREE THIS DATA FIELD        */
         BAL   @14,IKJFRSP                                         0231
*         GOTO PRNEXT;                /* GO CHECK WHERE PROCESSING 0232
*                                        IS TO CONTINUE              */
         B     PRNEXT                                              0232
*PRCHGE6: /* THE DATALIST PROCNAME DOES NOT EXIST IN THIS TREE, OR   */
*         /* ITS DATA FIELD CANNOT BE USED.                          */
*         UADSRPTR = ODFPTR;          /* REF THE NLPROC DATA FIELD   */
PRCHGE6  LR    UADSRPTR,ODFPTR                                     0233
*         /* CHECK THE USE COUNTER. IF IT IS 1, THEN THIS FIELD WILL */
*         /* BE USED. IF THE FIELD IS SHARED, THEN IT CANNOT BE      */
*         /* USED AND A NEW DATA FIELD MUST BE CREATED.              */
*         IF UADSRCTR > 1                                          0234
*           THEN                      /* THIS DATA FLD IS SHARED     */
         CLI   UADSRCTR(UADSRPTR),1                                0234
         BNH   @RF00234                                            0234
*             DO;                                                  0235
*               DROBPTR = OPRSAVE;    /* REF THE NLPROC OBLK         */
         LR    DROBPTR,OPRSAVE                                     0236
*               CALL NEWPRDF;         /* GO CREATE A NEW DATA FLD    */
         BAL   @14,NEWPRDF                                         0237
*             END;                                                 0238
*         /* IT IS NOT SHARED AND WILL BE USED                       */
*         UADSRNAM = DLPROC;          /* INSERT THE NEW PROCNAME     */
@RF00234 MVC   UADSRNAM(8,UADSRPTR),DLPROC                         0239
*         CALL PRDFCH;                /* GO INSERT NEW DATA ITEMS, IF
*                                        SPECIFIED IN THE COMMAND    */
         BAL   @14,PRDFCH                                          0240
*         GOTO PRNEXT;                /* GO CHECK WHERE PROCESSING 0241
*                                        IS TO CONTINUE              */
         B     PRNEXT                                              0241
*CHALLPR: /* AN '*' WAS ENTERED IN THE PROCNAME POSITION OF THE      */
*         /* NODELIST. IF THE PASSWORD AND ACCTNMBR ARE ALSO '*',    */
*         /* THEN THE REQUESTED CHANGE APPLIES TO ALL PROCNAMES IN   */
*         /* THE USERID TREE. IF EITHER A PASSWORD OR AN ACCTNMBR    */
*         /* WAS SPECIFIED, THEN THE CHANGE APPLIES ONLY TO SPECIFIC */
*         /* LOCAL CHAINS.                                           */
*         DROBPTR = HEDBPTR+UADSASUB; /* REF THE 1ST PROC OBLK UNDER
*                                        THE CURRENTLY REFERENCED  0242
*                                        ACCTNMBR                    */
CHALLPR  LR    DROBPTR,HEDBPTR                                     0242
         AL    DROBPTR,UADSASUB(,DNOBPTR)                          0242
*         /* IF NO NEW PROCNAME IS SPECIFIED, THEN ONLY DATA FIELDS  */
*         /* HAVE TO BE CHANGED.                                     */
*         IF DPROCNM(1) = '00'X                                    0243
*           THEN                      /* NO NEW PROCNAME SPECIFIED   */
         L     @07,DATALPTR(,CTRLTABP)                             0243
         CLI   DPROCNM(@07),X'00'                                  0243
         BE    @RT00243                                            0243
*             GOTO ALLPRDF;           /* GO CHANGE DATA FIELDS       */
*                                                                  0244
*         LASTOB = DROBPTR;           /* SAVE ADDR FOR LATER USE     */
         LR    LASTOB,DROBPTR                                      0245
*         CALL DLPRLS;                /* SEARCH THIS LOCAL CHAIN FOR
*                                        THE NEW PROCNAME            */
         BAL   @14,DLPRLS                                          0246
*         /* DOES THE NEW PROCNAME ALREADY EXIST IN THIS CHAIN?      */
*         IF NPRSAVE ^= 0                                          0247
*           THEN                      /* YES,                        */
         SLR   @04,@04                                             0247
         CR    NPRSAVE,@04                                         0247
         BNE   @RT00247                                            0247
*             GOTO NPRFND;            /* GO CHECK THE DATA           */
*         OPRSAVE = 0;                /* FOR LATER USE: NEW PROC NOT
*                                        FOUND IN THIS CHAIN         */
         LR    OPRSAVE,@04                                         0249
*TSPREP:  /* PREPARE TO SEARCH THE TOTAL CHAIN FOR THE NEW PROC.     */
*         DROBPTR = FRSTDROB;         /* REF 1ST OBLK IN TOTAL CHAIN */
TSPREP   LR    DROBPTR,FRSTDROB                                    0250
*PROCTS:  /* SEARCH THE TOTAL CHAIN FOR THE NEW PROCNAME             */
*         CALL DLPRTS;                /* GO TO SEARCH SUBRTNE        */
PROCTS   BAL   @14,DLPRTS                                          0251
*         /* DOES THE NEW PROCNAME EXIST IN THIS TREE?               */
*         IF NPRSAVE = 0                                           0252
*           THEN                      /* NO,                         */
         LTR   NPRSAVE,NPRSAVE                                     0252
         BZ    @RT00252                                            0252
*             GOTO PRNFND;            /* GO MAKE APPROPRIATE CHANGES */
*         /* THE NEW PROCNAME WAS FOUND. CHECK WHETHER IT IS THE     */
*         /* SAME ONE ALREADY FOUND IN THE LOCAL CHAIN. IF SO,       */
*         /* IGNORE IT AND CONTINUE THE SEARCH.                      */
*         IF NPRSAVE = OPRSAVE                                     0254
*           THEN                      /* IT IS THE SAME,             */
         CR    NPRSAVE,OPRSAVE                                     0254
         BE    @RT00254                                            0254
*             GOTO PROCTS2;           /* CONTINUE THE SEARCH         */
*         /* IT IS NOT THE SAME. COMPARE ITS DATA TO THE NEW DATA,   */
*         /* IF ANY, TO SEE IF ITS DATA FIELD CAN BE USED.           */
*         CALL CMPRND;                /* GO TO COMPARE SUBRTNE       */
         BAL   @14,CMPRND                                          0256
*         /* CAN THIS DATA FIELD BE USED?                            */
*         IF PRDFLG = '1'B                                         0257
*           THEN                      /* YES,                        */
         TM    PRDFLG,B'00000010'                                  0257
         BO    @RT00257                                            0257
*             GOTO CSNDOK;            /* GO MAKE APPROPRIATE CHANGES */
*PROCTS2: /* ARE THERE MORE PROCNAMES IN THIS TOTAL CHAIN? IF SO,    */
*         /* THEN CONTINUE THE SEARCH.                               */
*         IF UADSRNEX = 0                                          0259
*           THEN                      /* NO, END OF TOTAL CHAIN      */
PROCTS2  SLR   @08,@08                                             0259
         ICM   @08,7,UADSRNEX(DROBPTR)                             0259
         LTR   @08,@08                                             0259
         BZ    @RT00259                                            0259
*             GOTO PRNFND;            /* GO MAKE CHANGES             */
*         DROBPTR = HEDBPTR+UADSRNEX; /* REF THE NEXT PROC OBLK      */
         ALR   @08,HEDBPTR                                         0261
         LR    DROBPTR,@08                                         0261
*         GOTO PROCTS;                /* GO CONTINUE THE SEARCH      */
         B     PROCTS                                              0262
*NPRFND:  /* THE NEW PROCNAME EXISTS IN THIS LOCAL CHAIN. COMPARE    */
*         /* ITS DATA TO THE NEW DATA, IF ANY. IF NOT EQUAL, THEN    */
*         /* SEARCH THE TOTAL CHAIN TO SEE IF THIS PROCNAME, WITH    */
*         /* EQUAL DATA, EXISTS SOMEWHERE ELSE IN THIS TREE.         */
*         OPRSAVE = NPRSAVE;          /* TRANSFER PTR FOR LATER USE  */
NPRFND   LR    OPRSAVE,NPRSAVE                                     0263
*         CALL CMPRND;                /* GO TO COMPARE SUBRTNE       */
         BAL   @14,CMPRND                                          0264
*         /* IS THE DATA EQUAL?                                      */
*         IF PRDFLG = '0'B                                         0265
*           THEN                      /* NO,                         */
         TM    PRDFLG,B'00000010'                                  0265
         BZ    @RT00265                                            0265
*             GOTO TSPREP;            /* GO SEARCH THE TOTAL CHAIN   */
*         /* THIS DATA FIELD WILL BE USED.                           */
*RCHNPR:  /* THIS SECTION WILL CHANGE ONE PROCNAME CHAIN. THE FIRST  */
*         /* OFFSET BLOCK WILL BE RETAINED AND ALL OTHERS WILL BE    */
*         /* PRUNED FROM THE TREE. THEIR DATA FIELDS WILL ALSO BE    */
*         /* FREED IF THEY ARE NOT SHARED.                           */
*         DROBPTR = LASTOB;           /* REF 1ST OBLK IN THIS CHAIN  */
RCHNPR   LR    DROBPTR,LASTOB                                      0267
*         /* IS THE NEW PROC OFFSET BLOCK THE 1ST IN THE CHAIN?      */
*         IF NPRSAVE = LASTOB                                      0268
*           THEN                      /* YES,                        */
         CR    NPRSAVE,LASTOB                                      0268
         BE    @RT00268                                            0268
*             GOTO CSNDOK2;           /* GO CHECK WHERE TO CONTINUE  */
*         /* THE NEW PROC OFFSET BLOCK IS NOT THE FIRST IN THE LOCAL */
*         /* CHAIN. TRANSFER THE OFFSET TO ITS DATA FIELD TO THE     */
*         /* FIRST OFFSET BLOCK AND VICE VERSA. THIS WILL GREATLY    */
*         /* FACILITATE THE PRUNING OF THE OFFSET BLOCKS.            */
*         ADATSAVE = UADSRDAT;        /* SAVE OFFSET TO DATAFLD      */
         L     ADATSAVE,UADSRDAT(,DROBPTR)                         0270
*         DROBPTR = NPRSAVE;          /* REF THE NEW PROC OBLK       */
         LR    DROBPTR,NPRSAVE                                     0271
*         RDATSAVE = UADSRDAT;        /* SAVE OFFSET TO ITS DATAFLD  */
         L     @15,UADSRDAT(,DROBPTR)                              0272
         ST    @15,RDATSAVE                                        0272
*         UADSRDAT = ADATSAVE;        /* TRANSFER DATAFLD OFFSET     */
         ST    ADATSAVE,UADSRDAT(,DROBPTR)                         0273
*         DROBPTR = LASTOB;           /* REF THE 1ST OBLK AGAIN      */
         LR    DROBPTR,LASTOB                                      0274
*         UADSRDAT = RDATSAVE;        /* TRANSFER DATAFLD OFFSET     */
         ST    @15,UADSRDAT(,DROBPTR)                              0275
*         RNEXSAVE = UADSRNEX;        /* SAVE OFFSET TO NEXT OBLK    */
         SLR   RNEXSAVE,RNEXSAVE                                   0276
         ICM   RNEXSAVE,7,UADSRNEX(DROBPTR)                        0276
*RCHNPR2: /* BEGINNING OF THE PRUNING LOOP.                          */
*         DROBPTR = HEDBPTR+RNEXSAVE; /* REF THE NEXT PROC OBLK      */
RCHNPR2  LR    DROBPTR,HEDBPTR                                     0277
         ALR   DROBPTR,RNEXSAVE                                    0277
*         /* SAVE THE CHAIN FLAG OF THIS OFFSET BLOCK.               */
*         IF FLGR01 = '1'B                                         0278
*           THEN                                                   0278
         TM    FLGR01(DROBPTR),B'10000000'                         0278
         BNO   @RF00278                                            0278
*             FLGSAVE = '1'B;                                      0279
         OI    FLGSAVE,B'00100000'                                 0279
*           ELSE                                                   0280
*             FLGSAVE = '0'B;                                      0280
         B     @RC00278                                            0280
@RF00278 NI    FLGSAVE,B'11011111'                                 0280
*         RNEXSAVE = UADSRNEX;        /* SAVE OFFSET TO NEXT OBLK    */
@RC00278 SLR   RNEXSAVE,RNEXSAVE                                   0281
         ICM   RNEXSAVE,7,UADSRNEX(DROBPTR)                        0281
*         UADSRPTR = HEDBPTR+UADSRDAT;/* REF THIS DATA FIELD         */
         LR    UADSRPTR,HEDBPTR                                    0282
         AL    UADSRPTR,UADSRDAT(,DROBPTR)                         0282
*         /* IF THE DATA FIELD IS NOT SHARED, THEN FREE IT.          */
*         IF UADSRCTR > 1                                          0283
*           THEN                      /* IT IS SHARED                */
         CLI   UADSRCTR(UADSRPTR),1                                0283
         BNH   @RF00283                                            0283
*             DO;                                                  0284
*               UADSRCTR = UADSRCTR-1;/* DECREMENT THE USE COUNTER   */
         SLR   @15,@15                                             0285
         IC    @15,UADSRCTR(,UADSRPTR)                             0285
         BCTR  @15,0                                               0285
         STC   @15,UADSRCTR(,UADSRPTR)                             0285
*               GOTO RCHNPR3;         /* BYPASS DATAFLD PRUNING      */
         B     RCHNPR3                                             0286
*             END;                                                 0287
*         /* PRUNE THE PROCNAME DATA FIELD FROM THE TREE.            */
*         AREAOFST = UADSRDAT;        /* OFFSET TO AREA TO BE FREED  */
@RF00283 L     @04,UADSRDAT(,DROBPTR)                              0288
         ST    @04,AREAOFST                                        0288
*         AREALNTH = 24;              /* LENGTH TO BE FREED          */
         MVC   AREALNTH(2),@CH00062                                0289
*         CALL IKJFRSP;               /* GO FREE THE DATAFLD         */
         BAL   @14,IKJFRSP                                         0290
*RCHNPR3: /* PRUNE THE PROCNAME OFFSET BLOCK FROM THE TREE.          */
*         AREAOFST = DROBPTR-HEDBPTR; /* OFFSET TO AREA TO BE FREED  */
RCHNPR3  LR    @04,DROBPTR                                         0291
         SLR   @04,HEDBPTR                                         0291
         ST    @04,AREAOFST                                        0291
*         AREALNTH = 12;              /* LENGTH TO BE FREED          */
         MVC   AREALNTH(2),@CH00055                                0292
*         CALL IKJFRSP;               /* GO FREE THE OFFSET BLOCK    */
         BAL   @14,IKJFRSP                                         0293
*         /* CHECK THE CHAIN FLAG OF THE OFFSET BLOCK JUST PRUNED.   */
*         /* '1' INDICATES END OF LOCAL CHAIN & END OF PRUNING.      */
*         IF FLGSAVE = '0'B                                        0294
*           THEN                      /* NO, NOT END OF CHAIN,       */
         TM    FLGSAVE,B'00100000'                                 0294
         BZ    @RT00294                                            0294
*             GOTO RCHNPR2;           /* CONTINUE PRUNING            */
*         /* ALL OFFSET BLOCKS IN THIS CHAIN, EXCEPT THE FIRST,      */
*         /* HAVE NOW BEEN PRUNED.                                   */
*         DROBPTR = LASTOB;           /* REF 1ST OBLK AGAIN          */
         LR    DROBPTR,LASTOB                                      0296
*         FLGR01 = '1'B;              /* SET ITS CHAIN FLAG TO '1'   */
         OI    FLGR01(DROBPTR),B'10000000'                         0297
*         UADSRNEX = RNEXSAVE;        /* INSERT OFFSET TO THE BEGIN-
*                                        NING OF THE NEXT CHAIN      */
         STCM  RNEXSAVE,7,UADSRNEX(DROBPTR)                        0298
*         GOTO PRNEXT3;               /* GO CHECK WHERE PROCESSING 0299
*                                        IS TO CONTINUE              */
         B     PRNEXT3                                             0299
*CSNDOK:  /* A COUSIN WAS FOUND WHOSE DATA FIELD CAN BE USED.        */
*         /* GO CHECK THE USE COUNTER AND, IF NOT GREATER THAN 255,  */
*         /* INCREMENT IT BY ONE.                                    */
*         CALL CTRCHK;                                             0300
CSNDOK   BAL   @14,CTRCHK                                          0300
*         DROBPTR = LASTOB;           /* REF 1ST OBLK IN THIS CHAIN  */
         LR    DROBPTR,LASTOB                                      0301
*         UADSRPTR = HEDBPTR+UADSRDAT;/* REF ITS DATA FIELD          */
         LR    UADSRPTR,HEDBPTR                                    0302
         AL    UADSRPTR,UADSRDAT(,DROBPTR)                         0302
*         /* CAN ITS DATA FIELD BE FREED?                            */
*         IF UADSRCTR > 1                                          0303
*           THEN                      /* NO,                         */
         CLI   UADSRCTR(UADSRPTR),1                                0303
         BNH   @RF00303                                            0303
*             UADSRCTR = UADSRCTR-1;  /* DECREMENT ITS USE CTR       */
         SLR   @02,@02                                             0304
         IC    @02,UADSRCTR(,UADSRPTR)                             0304
         BCTR  @02,0                                               0304
         STC   @02,UADSRCTR(,UADSRPTR)                             0304
*           ELSE                      /* YES,                        */
*             DO;                                                  0305
         B     @RC00303                                            0305
@RF00303 DS    0H                                                  0306
*               AREAOFST = UADSRDAT;  /* OFFSET TO AREA TO BE FREED  */
         L     @04,UADSRDAT(,DROBPTR)                              0306
         ST    @04,AREAOFST                                        0306
*               AREALNTH = 24;        /* LENGTH TO BE FREED          */
         MVC   AREALNTH(2),@CH00062                                0307
*               CALL IKJFRSP;         /* GO FREE THIS DATA FIELD     */
         BAL   @14,IKJFRSP                                         0308
*             END;                                                 0309
*         UADSRDAT = RDATSAVE;        /* INSERT OFFSET TO THE COUSIN
*                                        DATA FIELD                  */
@RC00303 L     @04,RDATSAVE                                        0310
         ST    @04,UADSRDAT(,DROBPTR)                              0310
*CSNDOK2: /* IF THIS IS THE ONLY OFFSET BLOCK IN THIS LOCAL CHAIN,   */
*         /* THEN NO FURTHER CHANGES ARE NECESSARY.                  */
*         IF FLGR01 ='1'B                                          0311
*           THEN                      /* YES, END OF CHAIN           */
CSNDOK2  TM    FLGR01(DROBPTR),B'10000000'                         0311
         BO    @RT00311                                            0311
*             GOTO PRNEXT3;           /* GO CHECK WHERE PROCESSING 0312
*                                        IS TO CONTINUE              */
*         RNEXSAVE = UADSRNEX;        /* SAVE OFFSET TO BROTHER      */
         SLR   RNEXSAVE,RNEXSAVE                                   0313
         ICM   RNEXSAVE,7,UADSRNEX(DROBPTR)                        0313
*         GOTO RCHNPR2;               /* GO PRUNE ALL OTHER OFFSET 0314
*                                        BLOCKS IN THIS CHAIN        */
         B     RCHNPR2                                             0314
*PRNFND:  /* NO PROCNAME WITH THE REQUIRED DATA EXISTS IN THIS       */
*         /* TREE. CHECK WHETHER AN EXISTING DATA FIELD IN THIS      */
*         /* LOCAL CHAIN CAN BE USED.                                */
*         /* DOES THE NEW PROCNAME EXIST IN THIS CHAIN (WITH DIF-    */
*         /* FERENT DATA)?                                           */
*         IF OPRSAVE = 0                                           0315
*           THEN                      /* NO,                         */
PRNFND   LTR   OPRSAVE,OPRSAVE                                     0315
         BZ    @RT00315                                            0315
*             GOTO PRNFND2;           /* GO REF THE 1ST OBLK         */
*         DROBPTR = OPRSAVE;          /* REF THE NEW PROC OBLK       */
         LR    DROBPTR,OPRSAVE                                     0317
*         UADSRPTR = HEDBPTR+UADSRDAT;/* REF ITS DATA FIELD          */
         LR    UADSRPTR,HEDBPTR                                    0318
         AL    UADSRPTR,UADSRDAT(,DROBPTR)                         0318
*         /* CAN THIS DATA FIELD BE USED?                            */
*         IF UADSRCTR > 1                                          0319
*           THEN                      /* NO,                         */
         CLI   UADSRCTR(UADSRPTR),1                                0319
         BNH   @RF00319                                            0319
*             CALL NEWPRDF;           /* GO CREATE A NEW DATAFLD     */
         BAL   @14,NEWPRDF                                         0320
*         CALL PRDFCH;                /* INSERT NEW DATA, IF ANY     */
@RF00319 BAL   @14,PRDFCH                                          0321
*         NPRSAVE = OPRSAVE;          /* TRANSFER FOR LATER USE      */
         LR    NPRSAVE,OPRSAVE                                     0322
*         UADSRNAM = DLPROC;          /* INSERT THE NEW PROCNAME     */
         MVC   UADSRNAM(8,UADSRPTR),DLPROC                         0323
*         GOTO RCHNPR;                /* GO TO PRUNING SECTION       */
         B     RCHNPR                                              0324
*PRNFND2: /* USE THE 1ST PROC OFFSET BLOCK IN THIS CHAIN AND         */
*         /* PRUNE ALL OTHERS.                                       */
*         DROBPTR = LASTOB;           /* REF 1ST OBLK IN THIS CHAIN  */
PRNFND2  LR    DROBPTR,LASTOB                                      0325
*         UADSRPTR = HEDBPTR+UADSRDAT;/* REF ITS DATA FIELD          */
         LR    UADSRPTR,HEDBPTR                                    0326
         AL    UADSRPTR,UADSRDAT(,DROBPTR)                         0326
*         /* CAN THIS DATA FIELD BE USED?                            */
*         IF UADSRCTR > 1                                          0327
*           THEN                      /* NO,                         */
         CLI   UADSRCTR(UADSRPTR),1                                0327
         BNH   @RF00327                                            0327
*             CALL NEWPRDF;           /* GO CREATE A NEW DATAFLD     */
         BAL   @14,NEWPRDF                                         0328
*         UADSRSIZ = 0;               /* INSERT DEFAULT VALUE        */
@RF00327 SLR   @02,@02                                             0329
         STH   @02,UADSRSIZ(,UADSRPTR)                             0329
*         UADSUNAM = ' ';             /* INSERT DEFAULT VALUE        */
         MVI   UADSUNAM+1(UADSRPTR),C' '                           0330
         MVC   UADSUNAM+2(6,UADSRPTR),UADSUNAM+1(UADSRPTR)         0330
         MVI   UADSUNAM(UADSRPTR),C' '                             0330
*         CALL PRDFCH;                /* GO INSERT NEW DATA, IF ANY  */
         BAL   @14,PRDFCH                                          0331
*         UADSRNAM = DLPROC;          /* INSERT THE NEW PROCNAME     */
         MVC   UADSRNAM(8,UADSRPTR),DLPROC                         0332
*         GOTO CSNDOK2;               /* GO CHECK FOR BROTHERS       */
         B     CSNDOK2                                             0333
*ALLPRDF: /* CHANGE ALL DATA FIELDS IN A LOCAL CHAIN.                */
*         UADSRPTR = HEDBPTR+UADSRDAT;/* REF THE PROC DATAFLD        */
ALLPRDF  LR    UADSRPTR,HEDBPTR                                    0334
         AL    UADSRPTR,UADSRDAT(,DROBPTR)                         0334
*         CALL CMPRND;                /* GO COMPARE THE EXISTING DATA
*                                        TO THE NEW DATA             */
         BAL   @14,CMPRND                                          0335
*         /* IS THE EXISTING DATA EQUAL TO THE NEW DATA? IF NOT,     */
*         /* THEN THE TOTAL CHAIN MUST BE SEARCHED TO SEE WHETHER    */
*         /* THIS SAME PROCNAME, WITH THE CORRECT DATA, ALREADY      */
*         /* EXISTS IN ANOTHER CHAIN.                                */
*         IF PRDFLG = '0'B                                         0336
*           THEN                      /* NO, DATA IS NOT EQUAL,      */
         TM    PRDFLG,B'00000010'                                  0336
         BZ    @RT00336                                            0336
*             GOTO SRCHND;            /* GO SEARCH THE TOTAL CHAIN   */
*NEXTDF:  /* CHECK FOR MORE PROCNAMES IN THIS CHAIN.                 */
*         IF FLGR01 = '1'B                                         0338
*           THEN                      /* END OF LOCAL CHAIN          */
NEXTDF   TM    FLGR01(DROBPTR),B'10000000'                         0338
         BO    @RT00338                                            0338
*             GOTO PRNEXT3;           /* GO CHECK WHERE PROCESSING IS
*                                        TO CONTINUE                 */
*         DROBPTR = HEDBPTR+UADSRNEX; /* REF THE NEXT PROCNAME OBLK  */
         LR    @07,HEDBPTR                                         0340
         SLR   @04,@04                                             0340
         ICM   @04,7,UADSRNEX(DROBPTR)                             0340
         ALR   @07,@04                                             0340
         LR    DROBPTR,@07                                         0340
*         GOTO ALLPRDF;               /* GO PROCESS THIS PROCNAME    */
         B     ALLPRDF                                             0341
*SRCHND:  /* SEARCH THE TOTAL CHAIN TO SEE WHETHER THIS PROCNAME,    */
*         /* WITH THE REQUIRED DATA, ALREADY EXISTS IN ANOTHER CHAIN */
*         OPRSAVE = DROBPTR;          /* SAVE ADDR OF THIS OBLK      */
SRCHND   LR    OPRSAVE,DROBPTR                                     0342
*         ODFPTR = UADSRPTR;          /* SAVE ADDR OF THIS DATAFLD   */
         LR    ODFPTR,UADSRPTR                                     0343
*         DLPROC = UADSRNAM;          /* TRANSFER THE PROCNAME TO  0344
*                                        ANOTHER VARIABLE            */
         MVC   DLPROC(8),UADSRNAM(UADSRPTR)                        0344
*         DROBPTR = FRSTDROB;         /* REF 1ST OBLK IN TOTAL CHAIN */
         LR    DROBPTR,FRSTDROB                                    0345
*SRCHND2: /* GO TO THE SEARCH SUBROUTINE TO PERFORM THE SEARCH.      */
*         CALL DLPRTS;                                             0346
SRCHND2  BAL   @14,DLPRTS                                          0346
*         /* WAS THE PROCNAME FOUND?                                 */
*         IF NPRSAVE = 0                                           0347
*           THEN                      /* NO,                         */
         LTR   NPRSAVE,NPRSAVE                                     0347
         BZ    @RT00347                                            0347
*             GOTO CHGDF;             /* GO MAKE APPROPRIATE CHANGES */
*         /* IT WAS FOUND. DOES IT POINT TO THE SAME DATA FIELD? IF  */
*         /* YES, IGNORE IT AND CONTINUE THE SEARCH.                 */
*         IF ODFPTR = NDFPTR                                       0349
*           THEN                      /* YES,                        */
         C     ODFPTR,NDFPTR                                       0349
         BNE   @RF00349                                            0349
*SRCHND3:     /* ARE THERE MORE PROCNAMES IN THE TOTAL CHAIN?        */
*             IF UADSRNEX ^= 0                                     0350
*               THEN                  /* YES,                        */
SRCHND3  SLR   @07,@07                                             0350
         ICM   @07,7,UADSRNEX(DROBPTR)                             0350
         LTR   @07,@07                                             0350
         BZ    @RF00350                                            0350
*                 DO;                                              0351
*                   DROBPTR =         /* REF THE NEXT PROCNAME OBLK  */
*                     HEDBPTR+UADSRNEX;                            0352
         ALR   @07,HEDBPTR                                         0352
         LR    DROBPTR,@07                                         0352
*                   GOTO SRCHND2;     /* GO CONTINUE THE SEARCH      */
         B     SRCHND2                                             0353
*                 END;                                             0354
*               ELSE                  /* NO, THEREFORE A USABLE DATA
*                                        FIELD WAS NOT FOUND         */
*                 GOTO CHGDF;         /* GO MAKE APPROPRIATE CHANGES */
*         /* IT POINTS TO A DIFFERENT DATA FIELD. COMPARE THE DATA.  */
*         /* BUILD A MODEL OF THE CURRENT DATA FIELD AND INSERT THE  */
*         /* NEW DATA ITEM(S) FROM THE COMMAND. THEN COMPARE THE     */
*         /* COUSIN DATA FIELD TO THIS MODEL.                        */
*         UADSRPTR = ODFPTR;          /* REF CURRENT PROC DATAFLD    */
@RF00349 LR    UADSRPTR,ODFPTR                                     0356
*         DROBDMDL = DROBD;           /* COPY IT INTO MODEL          */
         MVC   DROBDMDL(24),DROBD(UADSRPTR)                        0357
*         UADSRPTR = ADDR(DROBDMDL);  /* SET PTR TO MODEL            */
         LA    UADSRPTR,DROBDMDL                                   0358
*         CALL PRDFCH;                /* GO INSERT NEW DATA ITEMS    */
         BAL   @14,PRDFCH                                          0359
*         UADSRPTR = NDFPTR;          /* REF COUSIN DATA FIELD       */
         L     UADSRPTR,NDFPTR                                     0360
*         /* ONLY THE SIZE AND UNIT NAME HAVE TO BE COMPARED.        */
*         IF UADSRSIZ ^= TEMPRSIZ     /* IS SIZE DIFFERENT?          */
*          × UADSUNAM ^= TEMPUNAM     /* OR UNIT NAME DIFFERENT?     */
*           THEN                      /* YES, THEREFORE COUSIN DATA
*                                        FIELD CANNOT BE USED        */
         CLC   UADSRSIZ(2,UADSRPTR),TEMPRSIZ                       0361
         BNE   @RT00361                                            0361
         CLC   UADSUNAM(8,UADSRPTR),TEMPUNAM                       0361
         BNE   @RT00361                                            0361
*             GOTO SRCHND3;           /* CONTINUE THE PROCESS UNTIL
*                                        END OF TOT CHAIN IS REACHED */
*         /* A USABLE DATA FIELD WAS FOUND.                          */
*         /* GO CHECK THE USE COUNTER AND, IF NOT GREATER THAN 255,  */
*         /* INCREMENT IT BY ONE.                                    */
*         CALL CTRCHK;                /*                             */
         BAL   @14,CTRCHK                                          0363
*         DROBPTR = OPRSAVE;          /* REF THE ORIGINAL OBLK AGAIN */
         LR    DROBPTR,OPRSAVE                                     0364
*         UADSRPTR = ODFPTR;          /* REF ITS DATAFLD             */
         LR    UADSRPTR,ODFPTR                                     0365
*         /* CAN ITS DATA FIELD BE FREED?                            */
*         IF UADSRCTR = 1                                          0366
*           THEN                      /* YES,                        */
         CLI   UADSRCTR(UADSRPTR),1                                0366
         BNE   @RF00366                                            0366
*             DO;                                                  0367
*               AREAOFST = UADSRDAT;  /* OFFSET TO AREA TO BE FREED  */
         L     @07,UADSRDAT(,DROBPTR)                              0368
         ST    @07,AREAOFST                                        0368
*               AREALNTH = 24;        /* LENGTH TO BE FREED          */
         MVC   AREALNTH(2),@CH00062                                0369
*               CALL IKJFRSP;         /* GO FREE THE DATAFLD         */
         BAL   @14,IKJFRSP                                         0370
*             END;                                                 0371
*           ELSE                      /* NO,                         */
*             UADSRCTR = UADSRCTR-1;  /* DECREMENT THE USE CTR       */
         B     @RC00366                                            0372
@RF00366 SLR   @07,@07                                             0372
         IC    @07,UADSRCTR(,UADSRPTR)                             0372
         BCTR  @07,0                                               0372
         STC   @07,UADSRCTR(,UADSRPTR)                             0372
*         UADSRDAT = RDATSAVE;        /* INSERT OFFSET TO COUSIN   0373
*                                        DATA FIELD                  */
@RC00366 L     @07,RDATSAVE                                        0373
         ST    @07,UADSRDAT(,DROBPTR)                              0373
*         GOTO NEXTDF;                /* GO CONTINUE WITH THE NEXT 0374
*                                        PROCNAME IN THE LOCAL CHAIN */
         B     NEXTDF                                              0374
*CHGDF:   /* NO USABLE DATA FIELD WAS FOUND. CHANGE THE EXISTING     */
*         /* DATA FIELD IF IT IS NOT SHARED. IF IT IS SHARED, THEN   */
*         /* CREATE A NEW ONE.                                       */
*         DROBPTR = OPRSAVE;          /* REF THE OBLK IN QUESTION    */
CHGDF    LR    DROBPTR,OPRSAVE                                     0375
*         UADSRPTR = ODFPTR;          /* REF ITS DATAFLD             */
         LR    UADSRPTR,ODFPTR                                     0376
*         /* IS IT SHARED?                                           */
*         IF UADSRCTR > 1                                          0377
*           THEN                      /* YES,                        */
         CLI   UADSRCTR(UADSRPTR),1                                0377
         BNH   @RF00377                                            0377
*             CALL NEWPRDF;           /* CREATE A NEW PROC DATAFLD   */
         BAL   @14,NEWPRDF                                         0378
*         CALL PRDFCH;                /* INSERT THE NEW DATA         */
@RF00377 BAL   @14,PRDFCH                                          0379
*         GOTO NEXTDF;                /* GO CONTINUE WITH THE NEXT 0380
*                                        PROCNAME IN THE LOCAL CHAIN */
         B     NEXTDF                                              0380
*PRNEXT3: /* A LOCAL PROCNAME CHAIN HAS BEEN CHANGED. DETERMINE      */
*         /* WHERE PROCESSING IS TO CONTINUE.                        */
*         DNOBPTR = OACSAVE;          /* REF ORIGINAL ACTNO AGAIN    */
PRNEXT3  L     DNOBPTR,OACSAVE                                     0381
*         /* ARE THERE MORE ACCTNMBRS TO BE PROCESSED UNDER THE      */
*         /* CURRENT PASSWORD? THIS IS POSSIBLE ONLY IF THE NODELIST */
*         /* ACCTNMBR = '*'.                                         */
*         IF ACCTNO(1:2) = '* '                                    0382
*           THEN                      /* YES,                        */
         L     @04,NODELPTR(,CTRLTABP)                             0382
         CLC   ACCTNO(2,@04),@CC00205                              0382
         BNE   @RF00382                                            0382
*             /* CHECK THE CHAIN FLAG IN THE ACCTNMBR OFFSET BLOCK.  */
*             IF AFLG01 = '0'B        /* MORE ACCTNMBRS?             */
*               THEN                  /* YES,                        */
         TM    AFLG01(DNOBPTR),B'10000000'                         0383
         BNZ   @RF00383                                            0383
*                 DO;                                              0384
*                   DNOBPTR =         /* REF THE NEXT BROTHER OBLK   */
*                     HEDBPTR+UADSANEX;                            0385
         LR    @04,HEDBPTR                                         0385
         SLR   @15,@15                                             0385
         ICM   @15,7,UADSANEX(DNOBPTR)                             0385
         ALR   @04,@15                                             0385
         LR    DNOBPTR,@04                                         0385
*                   OACSAVE = DNOBPTR;/* SAVE THIS ADDR              */
         ST    DNOBPTR,OACSAVE                                     0386
*                   GOTO CHALLPR;     /* PROCESS NEXT PROC CHAIN     */
         B     CHALLPR                                             0387
*                 END;                                             0388
*               ELSE                  /* NO MORE ACTNOS FOR THIS PWD */
*                 GOTO PRNEXT4;       /* GO CHECK PASSWORDS          */
*           ELSE                      /* ACCTNMBR WAS SPECIFIED,     */
*             DO;                                                  0390
@RF00382 DS    0H                                                  0391
*               TRCHGE = '1'B;        /* 1- THIS TREE HAS BEEN CHGD  */
         OI    TRCHGE(CTRLTABP),B'10000000'                        0391
*               GOTO PRNEXT2;         /* GO CHECK FOR MORE PASSWRDS  */
         B     PRNEXT2                                             0392
*             END;                                                 0393
*PRNEXT4: /* THE END OF A LOCAL ACCTNMBR CHAIN HAS BEEN REACHED,     */
*         /* CHECK FOR MORE PASSWORDS.                               */
*         DPOBPTR = OPWSAVE;          /* REF CURRENT PASSWD OBLK     */
PRNEXT4  L     DPOBPTR,OPWSAVE                                     0394
*         /* NODELIST PASSWORD = '*'?                                */
*         IF PASSWD(1) = '*'                                       0395
*           THEN                      /* YES,                        */
         L     @07,NODELPTR(,CTRLTABP)                             0395
         CLI   PASSWD(@07),C'*'                                    0395
         BNE   @RF00395                                            0395
*             /* CHECK THE CHAIN FLAG IN THE PASSWORD OFFSET BLOCK.  */
*             IF PFLG01 = '0'B        /* MORE PASSWORDS?             */
*               THEN                  /* YES,                        */
         TM    PFLG01(DPOBPTR),B'10000000'                         0396
         BNZ   @RF00396                                            0396
*                 DO;                                              0397
*                   DPOBPTR =         /* REF NEXT PASSWORD BROTHER   */
*                     HEDBPTR+UADSPNEX;                            0398
         LR    @04,HEDBPTR                                         0398
         SLR   @15,@15                                             0398
         ICM   @15,7,UADSPNEX(DPOBPTR)                             0398
         ALR   @04,@15                                             0398
         LR    DPOBPTR,@04                                         0398
*                   DNOBPTR =         /* REF FIRST ACCTNO OBLK       */
*                     HEDBPTR+UADSPSUB;                            0399
         LR    DNOBPTR,HEDBPTR                                     0399
         AL    DNOBPTR,UADSPSUB(,DPOBPTR)                          0399
*                   DROBPTR =         /* REF FIRST PROCEDURE OBLK    */
*                     HEDBPTR+UADSASUB;                            0400
         LR    DROBPTR,HEDBPTR                                     0400
         AL    DROBPTR,UADSASUB(,DNOBPTR)                          0400
*                   GOTO SVPTRS;      /* CONTINUE WITH NEXT PASSWORD */
         B     SVPTRS                                              0401
*                 END;                                             0402
*         /* NO, THEREFORE NO MORE CHANGES ARE NECESSARY FOR THIS    */
*         /* USERID TREE.                                            */
*         GOTO CHGEOK;                /* GO SET INDICATORS & RETURN  */
         B     CHGEOK                                              0403
*CHGEOK:  /* THIS TREE HAS BEEN CHANGED SUCCESSFULLY. SET APPROPRI-  */
*         /* ATE INDICATORS AND RETURN TO CHANGE (IKJEFA20).         */
*         SRCHIND = 0;                /* NO FURTHER SEARCH REQUIRED  */
CHGEOK   MVI   SRCHIND(CTRLTABP),X'00'                             0404
*         /* CHECK WHETHER SIZE WAS REDUCED TO MAXSIZE. IF SO,       */
*         /* IKJEFA20 WILL INFORM THE USER OF THIS ACTION.           */
*         IF STGFLG = '1'B                                         0405
*           THEN                      /* YES, MSG IS NECESSARY       */
         TM    STGFLG,B'10000000'                                  0405
         BNO   @RF00405                                            0405
*             MSGNMBR = 14;           /* SET MSG NUMBER FOR IKJEFA20 */
         MVI   MSGNMBR(CTRLTABP),X'0E'                             0406
*           ELSE                      /* NO,                         */
*             MSGNMBR = 0;            /* INDIC SUCCESSFUL COMPLETION */
         B     @RC00405                                            0407
@RF00405 MVI   MSGNMBR(CTRLTABP),X'00'                             0407
*WORKEND: /* THIS ROUTINE HAS COMPLETED PROCESSING. RETURN TO        */
*         /* CHANGE (IKJEFA20) WITH EITHER A REQUEST TO WRITE THIS   */
*         /* TREE BACK INTO THE UADS, OR A REQUEST TO PERFORM        */
*         /* ANOTHER SEARCH, OR A REQUEST TO ISSUE AN ERROR MESSAGE. */
*         RETURN;                                                  0408
         B     @EL00001                                            0408
*DLPRLS:  /***********************************************************/
*         /* THIS SUBROUTINE WILL SEARCH FOR A GIVEN PROCNAME IN A   */
*         /* LOCAL LATERAL CHAIN. IF FOUND, A POINTER WILL RECEIVE   */
*         /* THE ADDRESS OF ITS OFFSET BLOCK. IF NOT FOUND, THE      */
*         /* POINTER WILL BE SET TO ZERO.                            */
*         /***********************************************************/
*         PROC;                                                    0409
DLPRLS   STM   @14,@01,12(@13)                                     0409
         STM   @04,@12,36(@13)                                     0409
*DLPRLS1: /* BEGINNING OF THE SEARCH LOOP.                           */
*         UADSRPTR = HEDBPTR+UADSRDAT;/* REF THE PROC DATA FIELD     */
DLPRLS1  LR    UADSRPTR,HEDBPTR                                    0410
         AL    UADSRPTR,UADSRDAT(,DROBPTR)                         0410
*         /* COMPARE THE GIVEN PROCNAME TO THE UADS PROCNAME.        */
*         IF DLPROC = UADSRNAM                                     0411
*           THEN                      /* YES, THEY ARE EQUAL         */
         CLC   DLPROC(8),UADSRNAM(UADSRPTR)                        0411
         BNE   @RF00411                                            0411
*             DO;                                                  0412
*               NPRSAVE = DROBPTR;    /* SAVE ADDR OF THIS OBLK      */
         LR    NPRSAVE,DROBPTR                                     0413
*               NDFPTR = UADSRPTR;    /* SAVE ADDR OF THIS DATA FLD  */
         ST    UADSRPTR,NDFPTR                                     0414
*              RETURN;                /* GO BACK TO POINT OF CALL    */
@EL00002 DS    0H                                                  0415
@EF00002 DS    0H                                                  0415
@ER00002 LM    @14,@01,12(@13)                                     0415
         LM    @04,@12,36(@13)                                     0415
         BR    @14                                                 0415
*             END;                                                 0416
*         /* ARE THERE MORE BROTHERS IN THIS LOCAL CHAIN?            */
*         IF FLGR01 = '0'B                                         0417
*           THEN                      /* YES,                        */
@RF00411 TM    FLGR01(DROBPTR),B'10000000'                         0417
         BNZ   @RF00417                                            0417
*             DO;                                                  0418
*               DROBPTR = HEDBPTR     /* REF THE NEXT PROCNAME IN..  */
*                 +UADSRNEX;          /* THIS LOCAL CHAIN            */
         LR    @10,HEDBPTR                                         0419
         SLR   @07,@07                                             0419
         ICM   @07,7,UADSRNEX(DROBPTR)                             0419
         ALR   @10,@07                                             0419
         LR    DROBPTR,@10                                         0419
*               GOTO DLPRLS1;         /* CONTINUE THE SEARCH         */
         B     DLPRLS1                                             0420
*             END;                                                 0421
*         /* THE PROCNAME DOES NOT EXIST IN THIS LOCAL CHAIN.        */
*         NPRSAVE = 0;                /* 0- PROCNAME NOT FOUND       */
@RF00417 SLR   NPRSAVE,NPRSAVE                                     0422
*         END DLPRLS;                 /* GO BACK TO POINT OF CALL    */
         B     @EL00002                                            0423
*NEWPRDF: /***********************************************************/
*         /* THIS SUBROUTINE WILL GET SPACE FOR A NEW PROCNAME DATA  */
*         /* FIELD AND THEN INSERT THE APPROPRIATE DATA.             */
*         /***********************************************************/
*         PROC;                                                    0424
NEWPRDF  STM   @14,@03,@SA00003                                    0424
         STM   @05,@12,@SA00003+24                                 0424
*         UADSRCTR = UADSRCTR-1;      /* DECREMENT THE USE COUNTER IN
*                                        THE EXISTING FIELD          */
         SLR   @10,@10                                             0425
         IC    @10,UADSRCTR(,UADSRPTR)                             0425
         BCTR  @10,0                                               0425
         STC   @10,UADSRCTR(,UADSRPTR)                             0425
*         AREALNTH = 24;              /* NUMBER OF BYTES NECESSARY 0426
*                                        FOR THE NEW DATA FIELD      */
         MVC   AREALNTH(2),@CH00062                                0426
*         RFY R1 RSTD;                                             0427
*         R1 = ADDR(GETFREE);         /* PTR TO GETSPACE PARMLIST    */
         LA    R1,GETFREE                                          0428
*         CALL IKJEFA53;              /* GET THE REQUIRED SPACE      */
         L     @15,@CV00094                                        0429
         BALR  @14,@15                                             0429
*         RFY R1 UNRSTD;                                           0430
*         RFY R15 RSTD;               /* RESTRICT THE RETURN CODE REG*/
*         RETCODE = R15;              /* SAVE THE RETURN CODE        */
         ST    R15,RETCODE(,CTRLTABP)                              0432
*         RFY R15 UNRSTD;             /* RELEASE THE RETURN CODE REG */
*         /* CHECK THE GETSPACE RETURN CODE.                         */
*         IF RETCODE ^= 0             /* GETSPACE SUCCESSFUL?        */
*           THEN                      /* NO,                         */
         L     @10,RETCODE(,CTRLTABP)                              0434
         LTR   @10,@10                                             0434
         BZ    @RF00434                                            0434
*             DO;                                                  0435
*               SRCHIND = 0;          /* 0- PROCESSING OF THIS USERID
*                                        IS COMPLETED                */
         MVI   SRCHIND(CTRLTABP),X'00'                             0436
*               MSGNMBR = 23;         /* SET ERROR MSG NUMBER        */
         MVI   MSGNMBR(CTRLTABP),X'17'                             0437
*               RETURN TO WORKEND;    /* CHANGE CP WILL ISSUE THE  0438
*                                        ERROR MSG & CONTINUE WITH 0438
*                                        THE NEXT USERID, IF ANY     */
         LA    @14,WORKEND                                         0438
         LM    @15,@03,@SA00003+4                                  0438
         LM    @05,@12,@SA00003+24                                 0438
         BR    @14                                                 0438
*             END;                                                 0439
*         NEWDFPTR = HEDBPTR+AREAOFST;/* CALCULATE ADDR OF THE NEW 0440
*                                        DATA FIELD                  */
@RF00434 L     @10,AREAOFST                                        0440
         LR    NEWDFPTR,HEDBPTR                                    0440
         ALR   NEWDFPTR,@10                                        0440
*         NEWDFPTR->DROBD =           /* COPY THE EXISTING DATAFIELD */
*           UADSRPTR->DROBD;          /* INTO THE NEW DATA FIELD     */
         MVC   DROBD(24,NEWDFPTR),DROBD(UADSRPTR)                  0441
*         UADSRDAT = AREAOFST;        /* PUT THE NEW OFFSET INTO THE
*                                        OFFSET BLOCK                */
         ST    @10,UADSRDAT(,DROBPTR)                              0442
*         UADSRPTR = NEWDFPTR;        /* THE ORIGINAL DATA FIELD IS
*                                        NOW UNHOOKED FROM THIS LOCAL
*                                        PROC CHAIN                  */
         LR    UADSRPTR,NEWDFPTR                                   0443
*         UADSRCTR = 1;               /* SET USE CTR TO 1            */
         MVI   UADSRCTR(UADSRPTR),X'01'                            0444
*         END NEWPRDF;                /* RETURN TO POINT OF CALL     */
@EL00003 DS    0H                                                  0445
@EF00003 DS    0H                                                  0445
@ER00003 LM    @14,@03,@SA00003                                    0445
         LM    @05,@12,@SA00003+24                                 0445
         BR    @14                                                 0445
*PRDFCH:  /***********************************************************/
*         /* THIS SUBROUTINE WILL PUT THE NEW PROCSIZE AND/OR THE    */
*         /* NEW UNIT NAME INTO THE PROCNAME DATA FIELD.             */
*         /***********************************************************/
*         PROC;                                                    0446
PRDFCH   STM   @14,@12,12(@13)                                     0446
*         /* IS A PROCSIZE SPECIFIED IN THE COMMAND?                 */
*         IF SIZESW = '1'B                                         0447
*           THEN                      /* YES,                        */
         TM    SIZESW(CTRLTABP),B'01000000'                        0447
         BNO   @RF00447                                            0447
*             UADSRSIZ = NEWRSIZ;     /* INSERT THE NEW PROCSIZE     */
         SLR   @10,@10                                             0448
         ICM   @10,3,NEWRSIZ                                       0448
         STH   @10,UADSRSIZ(,UADSRPTR)                             0448
*         /* IS A UNIT NAME SPECIFIED IN THE COMMAND?                */
*         IF UNITSW = '1'B                                         0449
*           THEN                      /* YES,                        */
@RF00447 TM    UNITSW(CTRLTABP),B'00100000'                        0449
         BNO   @RF00449                                            0449
*             UADSUNAM = NEWUNAM;     /* INSERT THE NEW UNIT NAME    */
         MVC   UADSUNAM(8,UADSRPTR),NEWUNAM                        0450
*         END PRDFCH;                 /* GO BACK TO POINT OF CALL    */
@EL00004 DS    0H                                                  0451
@EF00004 DS    0H                                                  0451
@ER00004 LM    @14,@12,12(@13)                                     0451
         BR    @14                                                 0451
*CMPRND:  /***********************************************************/
*         /* THIS SUBROUTINE WILL COMPARE THE NEW PROCSIZE, OR THE   */
*         /* NEW UNIT NAME, OR BOTH, TO THE EXISTING VALUES IN A     */
*         /* PROCNAME DATA FIELD AND SET A FLAG INDICATING EQUAL OR  */
*         /* NOT EQUAL.                                              */
*         /***********************************************************/
*         PROC;                                                    0452
CMPRND   STM   @14,@03,12(@13)                                     0452
         STM   @05,@12,40(@13)                                     0452
*         PRDFLG = '0'B;              /* INIT THIS CONTROL FLAG      */
         NI    PRDFLG,B'11111101'                                  0453
*         UADSRPTR = HEDBPTR+UADSRDAT;/* REF THE PROCNAME DATAFLD    */
         LR    UADSRPTR,HEDBPTR                                    0454
         AL    UADSRPTR,UADSRDAT(,DROBPTR)                         0454
*         /* DOES THE COMMAND SPECIFY A PROCSIZE?                    */
*         IF SIZESW = '1'B                                         0455
*           THEN                      /* YES,                        */
         TM    SIZESW(CTRLTABP),B'01000000'                        0455
         BNO   @RF00455                                            0455
*             /* COMPARE IT TO THE EXISTING PROCSIZE.                */
*             IF NEWRSIZ ^= UADSRSIZ                               0456
*               THEN                  /* THEY ARE NOT EQUAL          */
         CLC   NEWRSIZ(2),UADSRSIZ(UADSRPTR)                       0456
         BNE   @RT00456                                            0456
*                 RETURN;             /* LEAVE FLAG AT '0' & RETURN  */
*         /* DOES THE COMMAND SPECIFY A UNIT NAME?                   */
*         IF UNITSW = '1'B                                         0458
*           THEN                      /* YES,                        */
@RF00455 TM    UNITSW(CTRLTABP),B'00100000'                        0458
         BNO   @RF00458                                            0458
*             /* COMPARE IT TO THE EXISTING UNIT NAME.               */
*             IF NEWUNAM ^= UADSUNAM                               0459
*               THEN                  /* THEY ARE NOT EQUAL          */
         CLC   NEWUNAM(8),UADSUNAM(UADSRPTR)                       0459
         BNE   @RT00459                                            0459
*                 RETURN;             /* LEAVE FLAG AT '0' & RETURN  */
*         PRDFLG = '1'B;              /* 1- EQUAL, OR NO NEW DATA  0461
*                                        SPECIFIED IN THE COMMAND    */
@RF00458 OI    PRDFLG,B'00000010'                                  0461
*         END CMPRND;                 /* RETURN TO POINT OF CALL     */
@EL00005 DS    0H                                                  0462
@EF00005 DS    0H                                                  0462
@ER00005 LM    @14,@03,12(@13)                                     0462
         LM    @05,@12,40(@13)                                     0462
         BR    @14                                                 0462
*DLPRTS:  /***********************************************************/
*         /* THIS SUBROUTINE WILL SEARCH FOR A PROCNAME IN THE       */
*         /* TOTAL LATERAL CHAIN (ALL PROCS IN THE TREE).            */
*         /***********************************************************/
*         PROC;                                                    0463
DLPRTS   STM   @14,@01,12(@13)                                     0463
         STM   @05,@12,40(@13)                                     0463
*DLPRTS2: /* BEGINNING OF THE SEARCH LOOP.                           */
*         UADSRPTR = HEDBPTR+UADSRDAT;/* REF THE PROCNAME DATA FIELD */
DLPRTS2  L     @10,UADSRDAT(,DROBPTR)                              0464
         LR    UADSRPTR,HEDBPTR                                    0464
         ALR   UADSRPTR,@10                                        0464
*         /* IS THIS THE DESIRED PROCNAME?                           */
*         IF DLPROC = UADSRNAM                                     0465
*           THEN                      /* YES,                        */
         CLC   DLPROC(8),UADSRNAM(UADSRPTR)                        0465
         BNE   @RF00465                                            0465
*             DO;                                                  0466
*               RDATSAVE = UADSRDAT;  /* SAVE OFFSET TO ITS DATAFLD  */
         ST    @10,RDATSAVE                                        0467
*               NPRSAVE = DROBPTR;    /* SAVE ADDR OF THIS OFFSET BK */
         LR    NPRSAVE,DROBPTR                                     0468
*               NDFPTR = UADSRPTR;    /* SAVE ADDR OF THIS DATA FLD  */
         ST    UADSRPTR,NDFPTR                                     0469
*               RETURN;               /* RETURN TO POINT OF CALL     */
@EL00006 DS    0H                                                  0470
@EF00006 DS    0H                                                  0470
@ER00006 LM    @14,@01,12(@13)                                     0470
         LM    @05,@12,40(@13)                                     0470
         BR    @14                                                 0470
*             END;                                                 0471
*         /* ARE THERE MORE PROCNAMES? CHECK THE PTR TO THE NEXT     */
*         /* PROCNAME OFFSET BLOCK. ZERO INDICATES END OF TOTAL      */
*         /* LATERAL CHAIN.                                          */
*         IF UADSRNEX ^= 0                                         0472
*           THEN                      /* THERE ARE MORE PROCNAMES    */
@RF00465 SLR   @10,@10                                             0472
         ICM   @10,7,UADSRNEX(DROBPTR)                             0472
         LTR   @10,@10                                             0472
         BZ    @RF00472                                            0472
*             DO;                                                  0473
*               DROBPTR = HEDBPTR     /* REF THE NEXT PROCNAME OFF-  */
*                 +UADSRNEX;          /* SET BLOCK                   */
         ALR   @10,HEDBPTR                                         0474
         LR    DROBPTR,@10                                         0474
*               GOTO DLPRTS2;         /* CONTINUE THE SEARCH         */
         B     DLPRTS2                                             0475
*             END;                                                 0476
*           ELSE                      /* THE PROCNAME DOES NOT EXIST
*                                        IN THIS TREE                */
*             NPRSAVE = 0;            /* 0- PROCNAME NOT FOUND       */
@RF00472 SLR   NPRSAVE,NPRSAVE                                     0477
*         END DLPRTS;                 /* RETURN TO POINT OF CALL     */
         B     @EL00006                                            0478
*CTRCHK:  /***********************************************************/
*         /* THIS SUBROUTINE WILL CHECK THE USE COUNTER IN THE PROC- */
*         /* NAME DATA FIELD. IT CANNOT EXCEED 255. IF IT DOES,      */
*         /* CONTROL RETURNS TO IKJEFA20 WITH MSGNMBR IN CTRLTAB     */
*         /* SET TO 30. IF THE COUNTER IS < 255, IT IS INCREMENTED.  */
*         /***********************************************************/
*         PROC;                                                    0479
CTRCHK   STM   @14,@12,12(@13)                                     0479
*         /* IS THE USE CTR 255 (MAXIMUM)?                           */
*         IF UADSRCTR = 255                                        0480
*           THEN                      /* CTR LIMIT HAS BEEN REACHED  */
         CLI   UADSRCTR(UADSRPTR),255                              0480
         BNE   @RF00480                                            0480
*             DO;                                                  0481
*               MSGNMBR = 30;         /* SET MSGNO IN CTRLTAB        */
         MVI   MSGNMBR(CTRLTABP),X'1E'                             0482
*               RETURN TO WORKEND;    /* RETURN TO IKJEFA20          */
         LA    @14,WORKEND                                         0483
         LM    @15,@12,16(@13)                                     0483
         BR    @14                                                 0483
*             END;                                                 0484
*         UADSRCTR = UADSRCTR+1;      /* INCREMENT THE USE COUNTER   */
@RF00480 LA    @10,1                                               0485
         SLR   @15,@15                                             0485
         IC    @15,UADSRCTR(,UADSRPTR)                             0485
         ALR   @10,@15                                             0485
         STC   @10,UADSRCTR(,UADSRPTR)                             0485
*         END CTRCHK;                 /* RETURN TO POINT OF CALL     */
@EL00007 DS    0H                                                  0486
@EF00007 DS    0H                                                  0486
@ER00007 LM    @14,@12,12(@13)                                     0486
         BR    @14                                                 0486
*IKJFRSP: /***********************************************************/
*         /* THIS SUBROUTINE WILL INTERFACE WITH THE FREESPACE       */
*         /* ROUTINE (IKJEFA54) AND CHECK ITS RETURN CODE. IF        */
*         /* FREESPACE WAS SUCCESSFUL, CONTROL WILL BE PASSED BACK   */
*         /* TO THE POINT OF CALL. IF NOT, CONTROL WILL BE RETURNED  */
*         /* TO THE CHANGE CP (IKJEFA20) WHICH WILL ISSUE THE        */
*         /* APPROPRIATE ERROR MESSAGE.                              */
*         /***********************************************************/
*         PROC;                                                    0487
IKJFRSP  STM   @14,@12,@SA00008                                    0487
*         RFY R1 RSTD;                                             0488
*         R1 = ADDR(GETFREE);         /* PTR TO FREESPACE PARMLIST   */
         LA    R1,GETFREE                                          0489
*         CALL IKJEFA54;              /* GO TO THE FREESPACE ROUTINE */
         L     @15,@CV00095                                        0490
         BALR  @14,@15                                             0490
*         RFY R1 UNRSTD;                                           0491
*         RFY R15 RSTD;               /* RESTRICT THE RETURN CODE REG*/
*         RETCODE = R15;              /* SAVE THE RETURN CODE        */
         ST    R15,RETCODE(,CTRLTABP)                              0493
*         RFY R15 UNRSTD;             /* RELEASE THE RETURN CODE REG */
*         /* CHECK THE FREESPACE RETURN CODE.                        */
*         IF RETCODE ^= 0                                          0495
*           THEN                      /* FREESPACE UNSUCCESSFUL      */
         L     @10,RETCODE(,CTRLTABP)                              0495
         LTR   @10,@10                                             0495
         BZ    @RF00495                                            0495
*             DO;                                                  0496
*               SRCHIND = 0;          /* 0- PROCESSING OF THIS USERID
*                                        IS COMPLETED                */
         MVI   SRCHIND(CTRLTABP),X'00'                             0497
*               MSGNMBR = 24;         /* SET ERROR MSG NUMBER        */
         MVI   MSGNMBR(CTRLTABP),X'18'                             0498
*               RETURN TO WORKEND;    /* CHANGE CP WILL ISSUE THE  0499
*                                        ERROR MSG & CONTINUE WITH 0499
*                                        THE NEXT USERID, IF ANY     */
         LA    @14,WORKEND                                         0499
         LM    @15,@12,@SA00008+4                                  0499
         BR    @14                                                 0499
*             END;                                                 0500
*         END IKJFRSP;                /* GO BACK TO POINT OF CALL    */
@EL00008 DS    0H                                                  0501
@EF00008 DS    0H                                                  0501
@ER00008 LM    @14,@12,@SA00008                                    0501
         BR    @14                                                 0501
*         END IKJEFA23                                             0502
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.      *
*/*%INCLUDE SYSLIB  (IKJEFUAD)                                        *
*;                                                                 0502
@DATA    DS    0H
@CH00055 DC    H'12'
@CH00062 DC    H'24'
@DATD    DSECT
         DS    0F
@SA00001 DS    18F
@SA00003 DS    0F
@SA00008 DS    0F
         DS    15F
IKJEFA23 CSECT
         DS    0F
@DATD    DSECT
         DS    0D
OPWSAVE  DS    A
OACSAVE  DS    A
RDATSAVE DS    A
NDFPTR   DS    A
CSNSAVE  DS    A
PRUNOFS  DS    A
SAVE14   DS    A
NEWRSIZ  DS    H
DLPROC   DS    CL8
NEWUNAM  DS    CL8
         DS    CL2
GETFREE  DS    CL12
         ORG   GETFREE
READBUFF DS    AL4
NUMBLOKS DS    AL2
AREALNTH DS    AL2
AREAOFST DS    AL4
         ORG   GETFREE+12
CFLAGS   DS    CL2
         ORG   CFLAGS
STGFLG   DS    BL1
@NM00023 EQU   CFLAGS+0
FLGSAVE  EQU   CFLAGS+0
FLDFLG   EQU   CFLAGS+0
FLDFLG2  EQU   CFLAGS+0
FLDFLG3  EQU   CFLAGS+0
PRDFLG   EQU   CFLAGS+0
         ORG   CFLAGS+2
         DS    CL2
DROBDMDL DS    CL24
         ORG   DROBDMDL
@NM00024 DS    CL4
@NM00025 DS    CL8
@NM00026 DS    BL2
TEMPRSIZ DS    AL2
TEMPUNAM DS    CL8
         ORG   DROBDMDL+24
DECSIZE  DS    CL8
IKJEFA23 CSECT
         DS    0F
@SIZDATD DC    AL1(1)
         DC    AL3(@ENDDATD-@DATD)
@CV00094 DC    V(IKJEFA53)
@CV00095 DC    V(IKJEFA54)
         DS    0D
@CC00205 DC    C'* '
@CB00179 DC    X'0000'
IKJEFA23 CSECT
         DS   0H
PATCHLOC DC ((@DATA-@PSTART)/20)X'00'
@DATD    DSECT
         ORG   *+1-(*-@DATD)/(*-@DATD) INSURE DSECT DATA
@ENDDATD EQU   *
IKJEFA23 CSECT
@00      EQU   00                      EQUATES FOR REGISTERS 0-15
@01      EQU   01
@02      EQU   02
@03      EQU   03
@04      EQU   04
@05      EQU   05
@06      EQU   06
@07      EQU   07
@08      EQU   08
@09      EQU   09
@10      EQU   10
@11      EQU   11
@12      EQU   12
@13      EQU   13
@14      EQU   14
@15      EQU   15
FRSTDROB EQU   @10
NEWDFPTR EQU   @02
LASTOB   EQU   @07
ODFPTR   EQU   @08
ADATSAVE EQU   @04
RNEXSAVE EQU   @02
NPRSAVE  EQU   @02
OPRSAVE  EQU   @09
CTRLTABP EQU   @05
UADSRPTR EQU   @04
DROBPTR  EQU   @03
DNOBPTR  EQU   @07
DPOBPTR  EQU   @02
HEDBPTR  EQU   @06
R1       EQU   @01
R15      EQU   @15
LNGTHREG EQU   @02
DHED     EQU   0
UADSMHDR EQU   DHED
UADSBN01 EQU   UADSMHDR+12
UADSMAXC EQU   UADSMHDR+14
UADSATTR EQU   DHED+16
UADSPWD1 EQU   DHED+24
DPOB     EQU   0
PFLG01   EQU   DPOB
UADSPNEX EQU   DPOB+1
UADSPSUB EQU   DPOB+4
DNOB     EQU   0
AFLG01   EQU   DNOB
UADSANEX EQU   DNOB+1
UADSASUB EQU   DNOB+4
DROB     EQU   0
FLGR01   EQU   DROB
UADSRNEX EQU   DROB+1
UADSRDAT EQU   DROB+8
DROBD    EQU   0
UADSRCTR EQU   DROBD
UADSRNAM EQU   DROBD+4
UADSRSIZ EQU   DROBD+14
UADSUNAM EQU   DROBD+16
CTRLTAB  EQU   0
DATALPTR EQU   CTRLTAB+8
NODELPTR EQU   CTRLTAB+12
BLKCNT   EQU   CTRLTAB+16
HEADADDR EQU   CTRLTAB+17
PASSADDR EQU   CTRLTAB+20
ACCTADDR EQU   CTRLTAB+24
PROCADDR EQU   CTRLTAB+28
RETCODE  EQU   CTRLTAB+32
SRCHIND  EQU   CTRLTAB+37
MSGNMBR  EQU   CTRLTAB+38
TRCHGE   EQU   CTRLTAB+39
SIZESW   EQU   CTRLTAB+39
UNITSW   EQU   CTRLTAB+39
NLSTTAB  EQU   0
PASSWD   EQU   NLSTTAB+9
ACCTNO   EQU   NLSTTAB+18
PROCNM   EQU   NLSTTAB+58
DLSTTAB  EQU   0
DPROCNM  EQU   DLSTTAB+58
SIZE     EQU   DLSTTAB+66
UNITNAM  EQU   DLSTTAB+68
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS
@NM00022 EQU   DLSTTAB+76
@NM00021 EQU   DLSTTAB+18
@NM00020 EQU   DLSTTAB+17
@NM00019 EQU   DLSTTAB+9
@NM00018 EQU   DLSTTAB+1
@NM00017 EQU   DLSTTAB
@NM00016 EQU   NLSTTAB+17
@NM00015 EQU   NLSTTAB+1
@NM00014 EQU   NLSTTAB
@NM00013 EQU   CTRLTAB+36
@NM00012 EQU   CTRLTAB+4
@NM00011 EQU   CTRLTAB
@NM00010 EQU   DROBD+12
@NM00009 EQU   DROBD+1
@NM00008 EQU   DROB+4
@NM00007 EQU   DROB
UADSADAT EQU   DNOB+8
@NM00006 EQU   DNOB
UADSPDAT EQU   DPOB+8
@NM00005 EQU   DPOB
@NM00004 EQU   DHED+40
UADSDEST EQU   DHED+32
UADSPERP EQU   DHED+28
UADSUPTP EQU   DHED+20
UADSINST EQU   DHED+18
@NM00003 EQU   UADSATTR
USATR03  EQU   UADSATTR
USATR02  EQU   UADSATTR
USATR01  EQU   UADSATTR
USATR00  EQU   UADSATTR
@NM00002 EQU   UADSBN01+1
UADSEXPF EQU   UADSBN01+1
UADSNUSP EQU   UADSBN01+1
@NM00001 EQU   UADSBN01
UADSUSER EQU   UADSMHDR+4
UADSFSQP EQU   UADSMHDR+2
UADSBLNG EQU   UADSMHDR
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS
@RT00046 EQU   CHALLPR
@RT00052 EQU   NPRLS
@RT00054 EQU   CHKODF
@RT00062 EQU   PRNEXT
@RT00068 EQU   PRNEXT
@RT00072 EQU   CHKCSN3
@RT00083 EQU   PRNEXT
@RF00104 EQU   CHGEOK
@RF00103 EQU   CHGEOK
@RT00113 EQU   PRCHGE1
@RT00117 EQU   PRCHGE6
@RT00124 EQU   PRCHGE2
@RT00159 EQU   NPRDF
@RT00184 EQU   CHKDLDF
@RT00204 EQU   PRCHGE4
@RT00218 EQU   PRCHGE6
@RT00225 EQU   PRCHGE5
@RT00243 EQU   ALLPRDF
@RT00247 EQU   NPRFND
@RT00252 EQU   PRNFND
@RT00254 EQU   PROCTS2
@RT00257 EQU   CSNDOK
@RT00259 EQU   PRNFND
@RT00265 EQU   TSPREP
@RT00268 EQU   CSNDOK2
@RT00294 EQU   RCHNPR2
@RT00311 EQU   PRNEXT3
@RT00315 EQU   PRNFND2
@RT00336 EQU   SRCHND
@RT00338 EQU   PRNEXT3
@RT00347 EQU   CHGDF
@RF00350 EQU   CHGDF
@RT00361 EQU   SRCHND3
@RF00383 EQU   PRNEXT4
@RF00396 EQU   CHGEOK
@RF00395 EQU   CHGEOK
@RC00405 EQU   @EL00001
WORKEND  EQU   @EL00001
@RF00449 EQU   @EL00004
@RT00456 EQU   @EL00005
@RT00459 EQU   @EL00005
@RF00495 EQU   @EL00008
@PB00008 EQU   @EL00001
@PB00007 EQU   @PB00008
@PB00006 EQU   @PB00007
@PB00005 EQU   @PB00006
@PB00004 EQU   @PB00005
@PB00003 EQU   @PB00004
@PB00002 EQU   @PB00003
@ENDDATA EQU   *
         END   IKJEFA23

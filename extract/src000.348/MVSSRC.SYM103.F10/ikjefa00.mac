         TITLE 'IKJEFA00  --  ACCOUNT EXECUTOR ROUTINE                 *
                        '
IKJEFA00 CSECT ,                                                   0001
@MAINENT DS    0H                                                  0001
         USING *,@15                                               0001
         B     @PROLOG                                             0001
         DC    AL1(16)                                             0001
         DC    C'IKJEFA00  74.038'                                 0001
         DROP  @15
@PROLOG  STM   @14,@12,12(@13)                                     0001
         BALR  @12,0                                               0001
@PSTART  DS    0H                                                  0001
         USING @PSTART,@12                                         0001
         L     @00,@SIZDATD                                        0001
         GETMAIN R,LV=(0)
         LR    @11,@01                                             0001
         USING @DATD,@11                                           0001
         ST    @13,@SA00001+4                                      0001
         LM    @00,@01,20(@13)                                     0001
         ST    @11,8(,@13)                                         0001
         LR    @13,@11                                             0001
*          CPPLPTR = R1;              /* SET PTR TO TMP PARM LIST    */
         LR    CPPLPTR,R1                                          0059
*          RFY R1 UNRSTD;             /* RELEASE INPUT POINTER       */
*          ACCTECB = 0;               /* CLEAR ACCOUNT ECB           */
         SLR   @10,@10                                             0061
         ST    @10,ACCTECB                                         0061
*          ACCTLF = 0;                /* CLEAR CONTROL FLAG AREA     */
         STH   @10,ACCTLF                                          0062
*          ECTPTR = CPPLECT;          /* PTR TO ECT                  */
         L     @09,CPPLECT(,CPPLPTR)                               0063
         LR    ECTPTR,@09                                          0063
*          /* BUILD PARAMETER LIST FOR SEND INTERFACE ROUTINE        */
*          SNDPPL(1:16) = CPPL;       /* INITIALIZE SEND PARM LIST   */
         MVC   SNDPPL(16),CPPL(CPPLPTR)                            0064
*          SPLUDL = 0;                /* CLEAR PTR TO UDL            */
         ST    @10,SPLUDL                                          0065
*          SPLECB = ADDR(ACCTECB);    /* SET PTR TO ACCOUNT ECB      */
         LA    @03,ACCTECB                                         0066
         ST    @03,SPLECB                                          0066
*          /* SET UP PARAMETER LIST BASE VALUES                      */
*          BASUPTP = CPPLUPT;         /* SET UP CURRENT UPT LOC      */
         L     @15,CPPLUPT(,CPPLPTR)                               0067
         ST    @15,BASUPTP                                         0067
*          BASECTP = CPPLECT;         /* SET UP CURRENT ECT LOC      */
         ST    @09,BASECTP                                         0068
*          ACCTECBP = ADDR(ACCTECB);  /* SET UP ACCOUNT ECB LOC      */
         ST    @03,ACCTECBP                                        0069
*          UIDLPTR = 0;               /* CLEAR RESPONSE AREA PTR     */
         ST    @10,UIDLPTR                                         0070
*          /* SET POINTERS TO SERVICE ROUTINE PARAMETER BLOCKS       */
*          IOPLPTR = ADDR(IOPL1);     /* SET PTR TO IO PARM LIST     */
         LA    IOPLPTR,IOPL1                                       0071
*          IOPL(1:12) = ACCTPL;       /* SET PL BASE PTRS            */
         MVC   IOPL(12,IOPLPTR),ACCTPL                             0072
*          /* SET BASE PTRS IN COMMAND SCAN PCL                      */
*          CSPLPTR = ADDR(CSPL1);     /* SET PTR TO COMMAND SCAN PL  */
         LA    CSPLPTR,CSPL1                                       0073
*          CSPL(1:12)=ACCTPL;         /* SET PARM LIST PTRS          */
         MVC   CSPL(12,CSPLPTR),ACCTPL                             0074
*          CSPLFLG = ADDR(CSFLGWD);   /* SET PTR TO INDICATOR AREA   */
         LA    @10,CSFLGWD                                         0075
         ST    @10,CSPLFLG(,CSPLPTR)                               0075
*          CSPLOA = ADDR(CSOA1);      /* SET PTR TO RESPONSE AREA    */
         LA    @10,CSOA1                                           0076
         ST    @10,CSPLOA(,CSPLPTR)                                0076
*          CSOAPTR = CSPLOA;          /* SET RESPONSE AREA BASE PTR  */
         LR    CSOAPTR,@10                                         0077
*          /* INITIALIZE DAIR PARAMETER LIST,PARM BLOCK              */
*          DAPLPTR  =  ADDR(DAPL1);   /* SET PARM LIST PTR           */
         LA    @10,DAPL1                                           0078
         ST    @10,DAPLPTR                                         0078
*          DAPL(1:12) = ACCTPL;       /* SET UPT,ECT,ECB PTRS        */
         MVC   DAPL(12,@10),ACCTPL                                 0079
*          DAPLPSCB  =  CPPLPSCB;     /* SET PSCB PTR                */
         L     @09,CPPLPSCB(,CPPLPTR)                              0080
         ST    @09,DAPLPSCB(,@10)                                  0080
*          DAPLDAPB  =  ADDR(DAPB2C1);/* SET DAIR PARM BLOCK PTR     */
         LA    @09,DAPB2C1                                         0081
         ST    @09,DAPLDAPB(,@10)                                  0081
*          DAPB2C(1:4) = '002C0000'X; /* SET NOT-IN-USE CODE PB      */
         L     @10,DAPB2PTR(,@10)                                  0082
         MVC   DAPB2C(4,@10),@CB00329                              0082
*          /* INITIALIZE DAIRFAIL PARAMETER LIST                     */
*          DARCPTR = ADDR(RTNCODE);   /* SET POINTER TO RETURN CODE  */
         LA    @10,RTNCODE                                         0083
         ST    @10,DARCPTR                                         0083
*          DAWRENT = ADDR(ZERO);      /* SET POINTER TO ZERO ADDRESS */
         LA    @10,ZERO                                            0084
         ST    @10,DAWRENT                                         0084
*          DAIDENT = ADDR(IDENT);     /* SET POINTER TO IDENTIFIER   */
         LA    @10,IDENT                                           0085
         ST    @10,DAIDENT                                         0085
*          /* INITIALIZE PARM LIST FOR STACK ROUTINE                 */
*          STPLPTR = ADDR(STPL1);     /* SET PTR TO STACK PL         */
         LA    STPLPTR,STPL1                                       0086
*          STPL(1:12) = ACCTPL;       /* INITIALIZE PARM LIST PTRS   */
         MVC   STPL(12,STPLPTR),ACCTPL                             0087
*          STPLSTPB = ADDR(STACL1);   /* SET PTR TO PARM BLOCK       */
         LA    @10,STACL1                                          0088
         ST    @10,STPLSTPB(,STPLPTR)                              0088
*          /* BUILD PARAMETER LIST FOR HELP                          */
*          HLPPPL = CPPL;             /* INITIALIZE HELP PARM LIST   */
         MVC   HLPPPL(16),CPPL(CPPLPTR)                            0089
*          /* MOVE MODEL PARAMETER LISTS INTO DYNAMIC STORAGE        */
*          CMDID = CMDIDMDL;          /* SET PARM LIST PTR           */
         MVC   CMDID(8),CMDIDMDL                                   0090
*          CPLS(1:MCPLLNG) = MCPLS(1:MCPLLNG);                     0091
         L     @10,MCPLLNG                                         0091
         BCTR  @10,0                                               0091
         EX    @10,@SM00395                                        0091
*          GEN (STM  R13,R12,8(R13)); /* INITIALIZE ACCOUNT SAVE AREA*/
         STM  R13,R12,8(R13)
*/********************************************************************/
*/*    INITIALIZE THE PARAMETER LIST FOR STAE.                       */
*/*    SET UP THE STAE ENVIORNMENT.                                  */
*/*    CHECK THE RETURN CODE FROM STAE, IF AN ERROR OCCURED GO TO    */
*/*      SYSTEM ERROR TERMINATION.                                   */
*/********************************************************************/
*          /* CALL STAE                                              */
*          GEN (STAE  PARAM=(R13),MF=(E,STAEL))                    0093
*             REFS(R13) FLOWS(STAEXIN);                            0093
         STAE  PARAM=(R13),MF=(E,STAEL)
*          RFY R15 RSTD;              /* RESTRICT RETURN CODE REG    */
*          RTNCODE = R15;             /* RESERVE RETURN CODE         */
         ST    R15,RTNCODE                                         0095
*          RFY R15 UNRSTD;            /* RELEASE RETURN CODE REG     */
*          IF RTNCODE ^= 0            /* CHK IF STAE SUCCESSFUL      */
*            THEN                     /* NO,                         */
         L     @10,RTNCODE                                         0097
         LTR   @10,@10                                             0097
         BZ    @RF00097                                            0097
*              DO;                                                 0098
*              IF RTNCODE = 4         /* CHK FOR LACK OF SPACE       */
*                THEN                 /* YES,                        */
         CH    @10,@CH00144                                        0099
         BE    @RT00099                                            0099
*                  GOTO  NOSPAZ;      /* GO TO ISSUE NO SPACE MSG    */
*              MSGNO = 7;             /* SET MESSAGE INDEX           */
         LA    MSGNO,7                                             0101
*              CALL SYSERRD;          /* TO ISSUE SYSTEM ERROR MSG   */
         BAL   @14,SYSERRD                                         0102
*              GOTO DOEND;            /* TERMINATE                   */
         B     DOEND                                               0103
*              END;                                                0104
*/********************************************************************/
*/*    SET FLAG INDICATING STAE IS ACTIVE.                           */
*/*    ESTABLISH AUTHORITY AND VALIDITY OF ACCOUNT COMMAND ENTRY.    */
*/*    IF THE USER IS NOT AUTHORIZED TO USE THE ACCOUNT COMMAND,     */
*/*      ISSUE A MESSAGE TO THAT EFFECT AND TERMINATE.               */
*/********************************************************************/
*          STASET = '1'B;             /* SET STAE READY FLAG         */
@RF00097 OI    STASET,B'00010000'                                  0105
*          IF PSCBACCT = '0'B         /* CHK IF USER IS ACCOUNT USER */
*            THEN                     /* NO,                         */
         L     @10,PSCBPTR(,CPPLPTR)                               0106
         TM    PSCBACCT(@10),B'01000000'                           0106
         BNZ   @RF00106                                            0106
*              DO;                                                 0107
*              TMSGTIN1 = PSCBUSER;   /* SET USER NAME IMAGE         */
         MVI   TMSGTIN1+7,C' '                                     0108
         MVC   TMSGTIN1+8(32),TMSGTIN1+7                           0108
         MVC   TMSGTIN1(7),PSCBUSER(@10)                           0108
*              TMSGTIL1 = PSCBUSRL+4; /* SET LENGTH OF SEGMENT       */
         LA    @07,4                                               0109
         SLR   @04,@04                                             0109
         IC    @04,PSCBUSRL(,@10)                                  0109
         ALR   @07,@04                                             0109
         STH   @07,TMSGTIL1                                        0109
*              GENERR = '1'B;         /* SET GENERAL ERROR FLAG      */
         OI    GENERR,B'00000010'                                  0110
*              MSGNO = 2;             /* SET MESSAGE INDEX           */
         LA    MSGNO,2                                             0111
*              CALL  MSGFNDR;         /* GO TO LOCATE MESSAGE TEXT   */
         BAL   @14,MSGFNDR                                         0112
*              TMSGNP12 = ADDR(TMSGTIX1); /* SET SEGMENT POINTER     */
         LA    @10,TMSGTIX1                                        0113
         ST    @10,TMSGNP12                                        0113
*              TMSGTIO1 = 37;         /* SET INSERT OFFSET           */
         MVC   TMSGTIO1(2),@CH00336                                0114
*              CALL  DOPUTL;          /* GO TO ISSUE PUTLINE         */
         BAL   @14,DOPUTL                                          0115
*              GOTO  DOEND;           /* GO TO EXIT                  */
         B     DOEND                                               0116
*              END;                                                0117
*/********************************************************************/
*/*    INITIALIZE THE ACCOUNT MODE MESSAGE.                          */
*/*    IF ACCOUNT IS RUNNING IN THE FOREGROUND, SET UP THE STAX      */
*/*      ENVIORNMENT.                                                */
*/*      CHECK THE RETURN CODE FROM STAX, IF AN ERROR OCCURED GO TO  */
*/*      SYSTEM ERROR TERMINATION, OTHERWIZE SET FLAG INDICATING STAX*/
*/*      IS ACTIVE.                                                  */
*/********************************************************************/
*          MOFFNO=ADDR(ANDXL);         /* FORM PTR TO MODE MESSAGE   */
@RF00106 L     MOFFNO,@CV00165                                     0118
*          MSGPTR = MOFFNC + ADDR(ANDXL); /* FORM PTR TO TEXT        */
         L     MSGPTR,@CV00165                                     0119
         AH    MSGPTR,MOFFNC(,MOFFNO)                              0119
*          TMSGMDS(1:8) = MSGMODL1(1:8);/* SET NUM OF SEG. & PTR.    */
         MVC   TMSGMDS(8),MSGMODL1(MSGPTR)                         0120
*          IOPLIOPB = ADDR(PGPBM);     /* SET POINTER TO PUTGET PB   */
         LA    @10,PGPBM                                           0121
         ST    @10,IOPLIOPB(,IOPLPTR)                              0121
*          PGPBOBUF = ADDR(TMSGMDS);   /* SET PTR TO MODE MESSAGE    */
         LA    @10,TMSGMDS                                         0122
         ST    @10,PGPBOBUF                                        0122
*          GEN (STAX  STAXXIN,USADDR=(R13),MF=(E,STAXL))           0123
*             FLOWS(STAXXIN);         /* CREATE STAX CALL            */
         STAX  STAXXIN,USADDR=(R13),MF=(E,STAXL)
*          RFY R15 RSTD;              /* RESTRICT RETURN CODE REG    */
*          RTNCODE = R15;             /* RESERVE RETURN CODE         */
         ST    R15,RTNCODE                                         0125
*          RFY R15 UNRSTD;            /* RELEASE RETURN CODE REG     */
*          IF RTNCODE ^= 0            /* CHK IF STAX SUCCESSFUL      */
*            THEN                     /* NO,                         */
         L     @10,RTNCODE                                         0127
         LTR   @10,@10                                             0127
         BZ    @RF00127                                            0127
*              DO;                                                 0128
*              MSGNO = 8;             /* SET MESSAGE INDEX           */
         LA    MSGNO,8                                             0129
*              CALL SYSERRD;          /* TO ISSUE SYSTEM ERROR MSG   */
         BAL   @14,SYSERRD                                         0130
*              GOTO DOEND;            /* TERMINATE                   */
         B     DOEND                                               0131
*              END;                                                0132
*          STXSET = '1'B;             /* SET STAX READY FLAG         */
@RF00127 OI    STXSET,B'00100000'                                  0133
*/********************************************************************/
*/*    CHECK THE VALIDITY OF THE ACCOUNT COMMAND.                    */
*/*    IF ANY DATA HAS BEEN ENTERED WITH THE COMMAND, ISSUE A MESSAGE*/
*/*      INDICATING THAT THE DATA WILL BE IGNORED.                   */
*/********************************************************************/
*          BUFFPTR = CPPLCBUF;        /* SET PTR TO ACCOUNT INPUT    */
         L     @10,CPPLCBUF(,CPPLPTR)                              0134
         ST    @10,BUFFPTR                                         0134
*          IF ECTNOPD = '0'B          /* CHK IF ANY OPERANDS ENTERED */
*            THEN                     /* YES,                        */
         TM    ECTNOPD(ECTPTR),B'10000000'                         0135
         BNZ   @RF00135                                            0135
*              DO;                                                 0136
*              MSGNO = 4;             /* SET MESSAGE INDEX           */
         LA    MSGNO,4                                             0137
*              CALL  MSGFNDR;         /* GO TO LOCATE MESSAGE TEXT   */
         BAL   @14,MSGFNDR                                         0138
*              TMSGTIO1 = 10;         /* SET TEXT OFFSET             */
         MVC   TMSGTIO1(2),@CH00338                                0139
*              TMSGTIL1 = ICBFLN-ICBFOF;/* SET DATA LENGTH           */
         L     @10,BUFFPTR                                         0140
         LH    @09,ICBFLN(,@10)                                    0140
         SH    @09,ICBFOF(,@10)                                    0140
         STH   @09,TMSGTIL1                                        0140
*              IF TMSGTIL1 > 44       /* CHK EXCESSIVE ENTRY LENGTH  */
*                THEN                 /* YES,                        */
         LA    @10,44                                              0141
         CR    @09,@10                                             0141
         BNH   @RF00141                                            0141
*                  TMSGTIL1 = 44;     /* SET SEGMENT LENGTH          */
         STH   @10,TMSGTIL1                                        0142
*                ELSE                                              0143
*                  TMSGNNO1 = 2;      /* EXCLUDE ETC SEGMENT         */
         B     @RC00141                                            0143
@RF00141 MVC   TMSGNNO1(4),@CF00073                                0143
*              TMSGTIN1(1:TMSGTIL1) = /* MOVE INPUT DATA TO BUFFER   */
*                ICBFDA(ICBFOF+1:TMSGTIL1);                        0144
@RC00141 LH    @10,TMSGTIL1                                        0144
         BCTR  @10,0                                               0144
         L     @09,BUFFPTR                                         0144
         LH    @07,ICBFOF(,@09)                                    0144
         ALR   @09,@07                                             0144
         EX    @10,@SM00400                                        0144
*              TMSGNP12 = ADDR(TMSGTIX1); /* SET PTR TO INSERT BUFFER*/
         LA    @10,TMSGTIX1                                        0145
         ST    @10,TMSGNP12                                        0145
*              CALL  DOPUTL;          /* GO TO ISSUE PUTLINE         */
         BAL   @14,DOPUTL                                          0146
*              END;                                                0147
*          GOTO GETCMD;               /* SKIP FREEMAIN FOR COMMAND   */
         B     GETCMD                                              0148
*/********************************************************************/
*/* READY: FREE THE PREVIOUS COMMAND BUFFER.                         */
*/*    CHECK THE ECB POSTED BY THE ACCOUNT SUBCOMMANDS, IF AN ERROR  */
*/*      HAS OCCURED, IF SO CLEAR THE INPUT STACK AND REISSUE THE    */
*/*      MODE MESSAGE.                                               */
*/********************************************************************/
*READY:    /* EXECUTE FREEMAIN                                       */
*          GEN (FREEMAIN  A=BUFFPTR,MF=(E,FMLST))                  0149
*              REFS(BUFFPTR,BUFFLEN);                              0149
READY    FREEMAIN  A=BUFFPTR,MF=(E,FMLST)
*          IF ERRTN ^= '000'B         /* CHK FOR ERROR OCCURRED FLAG */
*            THEN                     /* YES,                        */
         TM    ERRTN,B'00001110'                                   0150
         BNZ   @RT00150                                            0150
*              GOTO DOEND;            /* GO TO TERMINATION           */
*          IF ECBCODE ^= '0'B         /* CHK FOR SUBCOMMAND ERROR    */
*            THEN                     /* YES,                        */
         ICM   @10,7,ECBCODE                                       0152
         BZ    @RF00152                                            0152
*              DO;                                                 0153
*              PGPBOBUF = ADDR(TMSGMDS); /* SET PTR TO MODE MESSAGE  */
         LA    @10,TMSGMDS                                         0154
         ST    @10,PGPBOBUF                                        0154
*              CALL  CLRSTAC;         /* GO TO CLEAR INPUT STACK     */
         BAL   @14,CLRSTAC                                         0155
*              END;                                                0156
*/********************************************************************/
*/*    CHECK IF A COMMAND HAS BEEN ENTERED FROM THE ATTENTION ROUTINE*/
*/*      IF SO RESET THE ATTENTION FLAG AND SKIP THE PUTGET.         */
*/*      IF NOT ISSUE PUTGET TO GET THE NEXT COMMAND. IF A SECOND    */
*/*      LEVEL MESSAGE IS WAITING DELETE IT AND REISSUE THE PUTGET.  */
*/*    SAVE THE POINTER TO THE COMMAND BUFFER AND SET UP FOR COMMAND */
*/*      SCAN.                                                       */
*/********************************************************************/
*          ACCTECB = '0'B;            /* RESET ECB                   */
@RF00152 SLR   @10,@10                                             0157
         ST    @10,ACCTECB                                         0157
*GETCMD:   IF ATNCMD = '0'B           /* IS ATTENTION FLAG SET       */
*              THEN                   /* NO,                         */
GETCMD   TM    ATNCMD,B'10000000'                                  0158
         BNZ   @RF00158                                            0158
*                DO;                                               0159
*                CALL  DOPTGT;        /* GO TO ISSUE PUTGET          */
         BAL   @14,DOPTGT                                          0160
*                IF RTNCODE = 12 &    /* CHK FOR 2ND LEVEL MESSAGES  */
*                 ECTMSG1 = '0'B      /*  AND MSG DELETE FLAG NOT SET*/
*                  THEN               /* YES,                        */
         CLC   RTNCODE(4),@CF00109                                 0161
         BNE   @RF00161                                            0161
         TM    ECTMSG1(ECTPTR),B'10000000'                         0161
         BNZ   @RF00161                                            0161
*                    DO;                                           0162
*                    ECTMSG1 = '1'B;  /* SET MESSAGE DELETE FLAG     */
         OI    ECTMSG1(ECTPTR),B'10000000'                         0163
*                    CALL DOPTGT;     /* GO TO REISSUE PUTGET        */
         BAL   @14,DOPTGT                                          0164
*                    END;                                          0165
*                BUFFPTR = PGPBIBUF;  /* SAVE INPUT POINTER          */
@RF00161 L     @10,PGPBPTR(,IOPLPTR)                               0166
         L     @10,PGPBIBUF(,@10)                                  0166
         ST    @10,BUFFPTR                                         0166
*                END;                                              0167
*              ELSE                   /* INPUT RECEIVED FROM ATT EXIT*/
*                DO;                                               0168
         B     @RC00158                                            0168
@RF00158 DS    0H                                                  0169
*PUTGATTN:       BUFFPTR = ATTNBUFP;  /* POINT TO ATTENTION INPUT    */
PUTGATTN L     @10,ATTNBUFP                                        0169
         ST    @10,BUFFPTR                                         0169
*                PGPBOBUF = 0;        /* DO NOT REISSUE MODE MESSAGE */
         SLR   @10,@10                                             0170
         ST    @10,PGPBOBUF                                        0170
*                ATNCMD = '0'B;       /* RESET FLAG                  */
         NI    ATNCMD,B'01111111'                                  0171
*                CALL  CLRSTAC;       /* GO TO CLEAR INPUT STACK     */
         BAL   @14,CLRSTAC                                         0172
*                END;                                              0173
*          BUFFLEN = ICBFLN;          /* SAVE LENGTH FOR FREEMAIN    */
@RC00158 L     @10,BUFFPTR                                         0174
         LH    @09,ICBFLN(,@10)                                    0174
         ST    @09,BUFFLEN                                         0174
*          CSPLCBUF = BUFFPTR;        /* POINT TO COMMAND FOR SCAN   */
         ST    @10,CSPLCBUF(,CSPLPTR)                              0175
*          BUFPTR = BUFFPTR;          /* POINT TO COMMAND FOR SUB-CMD*/
         ST    @10,BUFPTR                                          0176
*/********************************************************************/
*/*    CALL COMMAND SCAN TO VALIDATE THE COMMAND BUFFER AND CHECK    */
*/*      THE RETURN CODE. IF AN ERROR OCCURED CHECK IF NO CORE WAS   */
*/*      AVAILABLE ISSUE THE MESSAGE OTHERWISE  GO TO SYSTEM ERROR   */
*/*      TERMINATION.                                                */
*/*    IF A NULL LINE WAS ENTERED GO GET A NEW COMMAND.              */
*/*    IF AN INVALID COMMAND WAS ENTERED ISSUE THE MESSAGE AND THEN  */
*/*      GO GET A NEW COMMAND.                                       */
*/********************************************************************/
*          /* LINK TO COMMAND SCAN                                   */
*          GEN (LINK  EP=IKJSCAN,MF=(E,CSPL1),SF=(E,LNKCPL));      0177
         LINK  EP=IKJSCAN,MF=(E,CSPL1),SF=(E,LNKCPL)
*          RFY R15 RSTD;              /* RESTRICT RETURN CODE REG    */
*          RTNCODE = R15;             /* RESERVE RETURN CODE         */
         ST    R15,RTNCODE                                         0179
*          RFY R15 UNRSTD;            /* RELEASE RETURN CODE REG     */
*          IF RTNCODE ^= 0            /* CHK FOR BAD RETURN CODE     */
*            THEN                     /* YES,                        */
         L     @10,RTNCODE                                         0181
         LTR   @10,@10                                             0181
         BZ    @RF00181                                            0181
*              DO;                                                 0182
*              IF RTNCODE = 8         /* CHK FOR GETMAIN FAILURE     */
*                THEN                 /* YES,                        */
         CH    @10,@CH00077                                        0183
         BE    @RT00183                                            0183
*                  GOTO  NOSPAZ;      /* GO TO ISSUE NOSPACE MSG     */
*              MSGNO = 5;             /* BAD RETURN CODE FROM SCAN   */
         LA    MSGNO,5                                             0185
*              CALL SYSERRD;          /* TO ISSUE SYSTEM ERROR MSG   */
         BAL   @14,SYSERRD                                         0186
*              GOTO DOEND;            /* TERMINATE                   */
         B     DOEND                                               0187
*              END;                                                0188
*          IF CSOANOC = '1'B          /* CHK FOR NULL LINE           */
*            THEN                     /* YES,                        */
@RF00181 TM    CSOANOC(CSOAPTR),B'00010000'                        0189
         BNO   @RF00189                                            0189
*              DO;                                                 0190
*              PGPBOBUF = ADDR(TMSGMDS); /* SET PTR TO MODE MESSAGE  */
         LA    @10,TMSGMDS                                         0191
         ST    @10,PGPBOBUF                                        0191
*              GOTO  READY;           /* GO TO GET NEW COMMAND       */
         B     READY                                               0192
*              END;                                                0193
*          IF CSOABAD = '1'B          /* CHK FOR INVALID CMD FLAG    */
*            THEN                     /* YES,                        */
@RF00189 TM    CSOABAD(CSOAPTR),B'00001000'                        0194
         BNO   @RF00194                                            0194
*              DO;                                                 0195
*              MSGNO = 10;            /* SET MESSAGE INDEX           */
         LA    MSGNO,10                                            0196
*              CALL  MSGFNDR;         /* GO TO LOCATE MESSAGE TEXT   */
         BAL   @14,MSGFNDR                                         0197
*              CALL  DOPUTL;          /* GO TO ISSUE PUTLINE         */
         BAL   @14,DOPUTL                                          0198
*              GOTO READY;            /* GO TO ISSUE MESSAGE         */
         B     READY                                               0199
*              END;                                                0200
*/********************************************************************/
*/*    IDENTIFY THE COMMAND ENTERED AND INITIALIZE THE LINK LIST     */
*/*      TO REQUEST THAT COMMAND.                                    */
*/*    IF ADD, CHANGE, DELETE, LIST OR LISTIDS WAS ENTERED GO TO     */
*/*      ISSUE THE LINK SVC.                                         */
*/*    IF END WAS ENTERED GO TO TERMINATION.                         */
*/*    IF SYNC WAS ENTERED LINK TO IKJRBBCR AND ON RETURN GO GET A   */
*/*      NEW COMMAND.                                                */
*/********************************************************************/
*          IF CMDLOC(1:CSOALNM) = ADDDEF(1:CSOALNM) /* CHK FOR ADD   */
*            THEN                     /* YES,                        */
@RF00194 L     @10,CSOACNM(,CSOAPTR)                               0201
         LH    @09,CSOALNM(,CSOAPTR)                               0201
         BCTR  @09,0                                               0201
         EX    @09,@SC00404                                        0201
         BNE   @RF00201                                            0201
*              DO;                                                 0202
*              ECTSCMD = ADDDEF;      /* IDENTIFY ADD                */
         MVC   ECTSCMD(8,ECTPTR),ADDDEF                            0203
*              CMDNU = '1';           /* MODIFY LIST FORM OF LINK    */
         MVI   CMDNU,C'1'                                          0204
*              GO TO LINK;                                         0205
         B     LINK                                                0205
*              END;                                                0206
*          IF CMDLOC(1:CSOALNM) = CHGDEF(1:CSOALNM) /* CHK FOR CHANGE*/
*            THEN                     /* YES,                        */
@RF00201 L     @10,CSOACNM(,CSOAPTR)                               0207
         LH    @09,CSOALNM(,CSOAPTR)                               0207
         BCTR  @09,0                                               0207
         EX    @09,@SC00406                                        0207
         BNE   @RF00207                                            0207
*              DO;                                                 0208
*              ECTSCMD = CHGDEF;      /* IDENTIFY CHANGE             */
         MVC   ECTSCMD(8,ECTPTR),CHGDEF                            0209
*              CMDNU = '2';           /* MODIFY LIST FORM OF LINK    */
         MVI   CMDNU,C'2'                                          0210
*              GO TO LINK;                                         0211
         B     LINK                                                0211
*              END;                                                0212
*          IF CMDLOC(1:CSOALNM) = DELDEF(1:CSOALNM) /* CHK FOR DELETE*/
*            THEN                     /* YES,                        */
@RF00207 L     @10,CSOACNM(,CSOAPTR)                               0213
         LH    @09,CSOALNM(,CSOAPTR)                               0213
         BCTR  @09,0                                               0213
         EX    @09,@SC00408                                        0213
         BNE   @RF00213                                            0213
*              DO;                                                 0214
*              ECTSCMD = DELDEF;      /* IDENTIFY DELETE             */
         MVC   ECTSCMD(8,ECTPTR),DELDEF                            0215
*              CMDNU = '3';           /* MODIFY LIST FORM OF LINK    */
         MVI   CMDNU,C'3'                                          0216
*              GO TO LINK;                                         0217
         B     LINK                                                0217
*              END;                                                0218
*          IF CMDLOC(1:CSOALNM) = ENDDEF(1:CSOALNM) /* CHK FOR END   */
*            THEN                     /* YES,                        */
@RF00213 L     @10,CSOACNM(,CSOAPTR)                               0219
         LH    @09,CSOALNM(,CSOAPTR)                               0219
         BCTR  @09,0                                               0219
         EX    @09,@SC00410                                        0219
         BE    @RT00219                                            0219
*              GOTO  DOEND;           /* GO TO CALL END              */
*          IF CMDLOC(1:CSOALNM) = LSTDEF(1:CSOALNM) /* CHK FOR LIST  */
*            THEN                     /* YES,                        */
         EX    @09,@SC00412                                        0221
         BNE   @RF00221                                            0221
*              DO;                                                 0222
*              ECTSCMD = LSTDEF;      /* IDENTIFY LIST               */
         MVC   ECTSCMD(8,ECTPTR),LSTDEF                            0223
*              CMDNU = '4';           /* MODIFY LIST FORM OF LINK    */
         MVI   CMDNU,C'4'                                          0224
*              GO TO LINK;                                         0225
         B     LINK                                                0225
*              END;                                                0226
*          IF CMDLOC(1:CSOALNM) = LSTIDEF(1:CSOALNM) /* CHK FOR LISTI*/
*            THEN                     /* YES,                        */
@RF00221 L     @10,CSOACNM(,CSOAPTR)                               0227
         LH    @09,CSOALNM(,CSOAPTR)                               0227
         BCTR  @09,0                                               0227
         EX    @09,@SC00414                                        0227
         BNE   @RF00227                                            0227
*              DO;                                                 0228
*              UIDLPTR = 1;           /* SET LISTIDS FLAG            */
         MVC   UIDLPTR(4),@CF00032                                 0229
*              ECTSCMD = LSTIDEF;     /* IDENTIFY LISTIDS            */
         MVC   ECTSCMD(8,ECTPTR),LSTIDEF                           0230
*              CMDNU = '4';           /* MODIFY LIST FORM OF LINK    */
         MVI   CMDNU,C'4'                                          0231
*              GO TO LINK;                                         0232
         B     LINK                                                0232
*              END;                                                0233
*          IF CMDLOC(1:CSOALNM) = SYNDEF(1:CSOALNM) /* CHK FOR SYNC  */
*            THEN                     /* YES,                        */
@RF00227 L     @10,CSOACNM(,CSOAPTR)                               0234
         LH    @09,CSOALNM(,CSOAPTR)                               0234
         BCTR  @09,0                                               0234
         EX    @09,@SC00416                                        0234
         BNE   @RF00234                                            0234
*              DO;                                                 0235
*              ECTSCMD = SYNDEF;      /* IDENTIFY SYNC               */
         MVC   ECTSCMD(8,ECTPTR),SYNDEF                            0236
*              GEN (LINK  EP=IKJRBBCR,MF=(E,SNDPPL),SF=(E,LNKCPL));
         LINK  EP=IKJRBBCR,MF=(E,SNDPPL),SF=(E,LNKCPL)
*              GOTO  READY;           /* GO TO GET NEXT COMMAND      */
         B     READY                                               0238
*              END;                                                0239
*/********************************************************************/
*/*    IF HELP WAS REQUESTED SET HELP ACTIVE FLAG AND ATTACH HELP.   */
*/*    CHECK THE RETURN CODE FROM ATTACH, IF IT IS NOT 0 GO TO SYSTEM*/
*/*      ERROR TERMINATION.                                          */
*/*    WAIT FOR HELP TO COMPLETE AND THEN FREE THE HELP DATA SET,    */
*/*      DETACH HELP, RESET THE HELP ACTIVE FLAG AND GO GET A NEW    */
*/*      COMMAND.                                                    */
*/********************************************************************/
*          IF CMDLOC(1:CSOALNM) = HLPDEF(1:CSOALNM) /* CHK FOR HELP  */
*            THEN                     /* YES,                        */
@RF00234 L     @10,CSOACNM(,CSOAPTR)                               0240
         LH    @09,CSOALNM(,CSOAPTR)                               0240
         BCTR  @09,0                                               0240
         EX    @09,@SC00418                                        0240
         BNE   @RF00240                                            0240
*              DO;                                                 0241
*              HWTCTL = '0'B;         /* CLEAR WAIT CONTROL FLAGS    */
         NI    HWTCTL,B'00111111'                                  0242
*              ECTSCMD = HLPDEF;      /* IDENTIFY HELP               */
         MVC   ECTSCMD(8,ECTPTR),HLPDEF                            0243
*              HLPCBUF = CSPLCBUF;    /* SET PTR TO COMMAND BUFFER   */
         L     @10,CSPLCBUF(,CSPLPTR)                              0244
         ST    @10,HLPCBUF                                         0244
*              RFY (R1,R15) RSTD;     /* RESTRICT REGS. FOR ATTACH   */
*              R1 = ADDR(HLPPPL);     /* POINT TO HELP PARM LIST     */
         LA    R1,HLPPPL                                           0246
*              R15 = ADDR(HLPCPL);    /* POINT TO ATTACH LIST FORM   */
         LA    R15,HLPCPL                                          0247
*              HLPNOW = '1'B;         /* SET HELP-IN-PROCESS FLAG    */
         OI    HLPNOW,B'01000000'                                  0248
*              /* ATTACH HELP                                        */
*   GEN (ATTACH STAI=(STAEXIN,(R13)),ECB=HLPECB,MF=(E,(1)),SF=(E,(15)))
*              REFS(HLPECB,HLPTCB,HLPPPL) FLOWS(STAXXIN);          0249
         ATTACH STAI=(STAEXIN,(R13)),ECB=HLPECB,MF=(E,(1)),SF=(E,(15))
*              HLPTCB = R1;           /* SAVE HELP TCB ADDRESS       */
         ST    R1,HLPTCB                                           0250
*              RTNCODE = R15;         /* RESERVE RETURN CODE         */
         ST    R15,RTNCODE                                         0251
*              RFY (R1,R15) UNRSTD;   /* RELEASE TCB AND RETURN CODE */
*              IF RTNCODE ^= 0        /* CHK FOR NONZERO CODE        */
*                THEN                 /* YES, ERROR                  */
         L     @10,RTNCODE                                         0253
         LTR   @10,@10                                             0253
         BZ    @RF00253                                            0253
*                  DO;                                             0254
*                  MSGNO = 13;        /* SET MESSAGE INDEX           */
         LA    MSGNO,13                                            0255
*                  CALL SYSERRD;      /* TO ISSUE SYSTEM ERROR MSG   */
         BAL   @14,SYSERRD                                         0256
*                  GOTO DOEND;        /* TERMINATE                   */
         B     DOEND                                               0257
*                  END;                                            0258
*              GEN (WAIT  ECB=HLPECB);/* WAIT FOR HELP TO COMPLETE   */
@RF00253 DS    0H                                                  0259
         WAIT  ECB=HLPECB
*              IF HLPNOW = '1'B       /* DID STAX EXIT DETACH HELP?  */
*                THEN                 /* NO,                         */
         TM    HLPNOW,B'01000000'                                  0260
         BNO   @RF00260                                            0260
*                  DO;                                             0261
*                  DA2CTCB = HLPTCB;  /* SET TCB PTR IN DAIR PB      */
         L     @10,DAPLPTR                                         0262
         L     @10,DAPB2PTR(,@10)                                  0262
         L     @09,HLPTCB                                          0262
         ST    @09,DA2CTCB(,@10)                                   0262
*                  CALL DODAR2C;      /* FREE HELP DATA SET          */
         BAL   @14,DODAR2C                                         0263
*                  GEN (DETACH HLPTCB);/* DETACH HELP                */
         DETACH HLPTCB
*                  HLPNOW = '0'B;     /* SET HELP NOT ACTIVE FLAG    */
         NI    HLPNOW,B'10111111'                                  0265
*                  END;                                            0266
*              GOTO  READY;           /* GO TO GET SUBCOMMAND        */
         B     READY                                               0267
*              END;                                                0268
*/********************************************************************/
*/*    AT THIS POINT NO MATCH HAS BEEN FOUND FOR THE COMMAND ENTERED.*/
*/*    ISSUE A MESSAGE TO THE USER THAT THE COMMAND IS INVALID AND   */
*/*      GO TO GET A NEW COMMAND.                                    */
*/********************************************************************/
*          MSGNO = 3;                 /* SET MESSAGE INDEX           */
@RF00240 LA    MSGNO,3                                             0269
*          CALL  MSGFNDR;             /* GO TO LOCATE MESSAGE TEXT   */
         BAL   @14,MSGFNDR                                         0270
*          TMSGTIO1 = 29;             /* SET TEXT OFFSET             */
         MVC   TMSGTIO1(2),@CH00355                                0271
*          TMSGTIL1 = CSOALNM+4;      /* SET NAME SEGMENT LENGTH     */
         LH    @10,CSOALNM(,CSOAPTR)                               0272
         LA    @09,4                                               0272
         ALR   @09,@10                                             0272
         STH   @09,TMSGTIL1                                        0272
*          TMSGTIN1(1:CSOALNM) = CMDLOC;/* INSERT CMD NAME           */
         BCTR  @10,0                                               0273
         L     @09,CSOACNM(,CSOAPTR)                               0273
         EX    @10,@SM00423                                        0273
*          TMSGNP12 = ADDR(TMSGTIX1); /* SET PTR TO ACTIVE INSERT    */
         LA    @10,TMSGTIX1                                        0274
         ST    @10,TMSGNP12                                        0274
*          CALL  DOPUTL;              /* GO TO ISSUE PUTLINE         */
         BAL   @14,DOPUTL                                          0275
*          GOTO  READY;               /* GO TO GET NEXT SUBCOMMAND   */
         B     READY                                               0276
*/********************************************************************/
*/* LINK: LINK TO THE ACCOUNT SUBCOMMAND.                            */
*/*    IF NO USERID'S WERE MODIFIED GO GET A NEW COMMAND.            */
*/*    IF ANY USERID HAS BEEN MODIFIED SET THE SEND ACTIVE FLAG      */
*/*      AND ATTACH SEND TO UPDATE THE BROADCAST DATA SET.           */
*/*    CHECK THE RETURN CODE FROM ATTACH, IF IT IS NOT 0 GO TO SYSTEM*/
*/*      ERROR TERMINATION.                                          */
*/*    WAIT FOR SEND TO COMPLETE AND THEN FREE THE BROADCAST DATA    */
*/*      SET, DETACH SEND AND RESET THE SEND ACTIVE FLAG.            */
*/********************************************************************/
*          /* LINK TO ACCOUNT SUBCOMMAND                             */
*LINK:     GEN (LINK  ,EPLOC=CMDID,MF=(E,ACCTPL),SF=(E,LNKCPL));   0277
LINK     LINK  ,EPLOC=CMDID,MF=(E,ACCTPL),SF=(E,LNKCPL)
*          IF UIDLPTR = 0             /* CHK IF ANY USERID LIST PTR  */
*            THEN                     /* NO,                         */
         L     @10,UIDLPTR                                         0278
         LTR   @10,@10                                             0278
         BZ    @RT00278                                            0278
*              GOTO  READY;           /* SKIP LINKAGE TO SEND        */
*          SPLUDL = UIDLPTR;          /* INIT UIDL POINTER FOR SEND  */
         ST    @10,SPLUDL                                          0280
*          SWTCTL = '0'B;             /* CLEAR WAIT CONTROL FLAGS    */
         NI    SWTCTL,B'00111111'                                  0281
*          ECTSCMD = SNDDEF;          /* IDENTIFY SEND               */
         MVC   ECTSCMD(8,ECTPTR),SNDDEF                            0282
*          RFY (R1,R15) RSTD;         /* RESTRICT REGS. FOR ATTACH   */
*          R1 = ADDR(SNDPPL);         /* POINT TO SEND PARM LIST     */
         LA    R1,SNDPPL                                           0284
*          R15 = ADDR(SNDCPL);        /* POINT TO ATTACH LIST FORM   */
         LA    R15,SNDCPL                                          0285
*          SNDNOW = '1'B;             /* SET SEND-IN-PROCESS FLAG    */
         OI    SNDNOW,B'10000000'                                  0286
*          /* ATTACH SEND FOR UPDATE BROADCAST DATA SET ROUTINE      */
*   GEN (ATTACH STAI=(STAEXIN,(R13)),ECB=SNDECB,MF=(E,(1)),SF=(E,(15)))
*          REFS(SNDECB,SNDTCB,SNDPPL) FLOWS(STAXXIN);              0287
         ATTACH STAI=(STAEXIN,(R13)),ECB=SNDECB,MF=(E,(1)),SF=(E,(15))
*          SNDTCB = R1;               /* SAVE SEND TCB ADDRESS       */
         ST    R1,SNDTCB                                           0288
*          RTNCODE = R15;             /* RESERVE RETURN CODE         */
         ST    R15,RTNCODE                                         0289
*          RFY (R1,R15) UNRSTD;       /* RELEASE TCB AND RETURN CODE */
*          IF RTNCODE ^= 0            /* CHK FOR NONZERO CODE        */
*            THEN                     /* YES, ERROR                  */
         L     @10,RTNCODE                                         0291
         LTR   @10,@10                                             0291
         BZ    @RF00291                                            0291
*              DO;                                                 0292
*              MSGNO = 13;            /* SET MESSAGE INDEX           */
         LA    MSGNO,13                                            0293
*              CALL SYSERRD;          /* TO ISSUE SYSTEM ERROR MSG   */
         BAL   @14,SYSERRD                                         0294
*              GOTO DOEND;            /* TERMINATE                   */
         B     DOEND                                               0295
*              END;                                                0296
*          GEN (WAIT  ECB=SNDECB);    /* WAIT FOR SEND TO COMPLETE   */
@RF00291 DS    0H                                                  0297
         WAIT  ECB=SNDECB
*          DA2CTCB  =  SNDTCB;        /* SET TCB ADDRESS FOR DAIR    */
         L     @10,DAPLPTR                                         0298
         L     @10,DAPB2PTR(,@10)                                  0298
         L     @09,SNDTCB                                          0298
         ST    @09,DA2CTCB(,@10)                                   0298
*          CALL DODAR2C;              /* GO TO CALL DAIR TO FREE   0299
*                                          BROADCAST DATA SET        */
         BAL   @14,DODAR2C                                         0299
*          GEN (DETACH SNDTCB);       /* DETACH SEND                 */
         DETACH SNDTCB
*          SNDNOW = '0'B;             /* CLEAR SEND-IN-PROCESS FLAG  */
         NI    SNDNOW,B'01111111'                                  0301
*/********************************************************************/
*/*    FREE CORE GOTTEN FOR THE UDLS AND GO GET A NEW COMMAND.       */
*/********************************************************************/
*          DO WHILE UIDLPTR ^= 0;     /* TEST POINTER TO NEXT UIDL   */
         B     @DE00302                                            0302
@DL00302 DS    0H                                                  0303
*            FREEUID(1) = UIDLPTR;    /* AREA TO BE FREED            */
         L     @10,UIDLPTR                                         0303
         ST    @10,FREEUID                                         0303
*            FREEUID(2) = (UIDLCT*8)+8; /*DETERMINE LENGTH OF UIDL   */
         SLR   @09,@09                                             0304
         ICM   @09,3,UIDLCT(@10)                                   0304
         SLA   @09,3                                               0304
         AH    @09,@CH00077                                        0304
         ST    @09,FREEUID+4                                       0304
*            UIDLPTR = UIDLNEX;       /* UPDATE UDL ITEM PTR         */
         L     @10,UIDLNEX(,@10)                                   0305
         ST    @10,UIDLPTR                                         0305
*            /* ISSUE FREEMAIN                                       */
*            GEN (FREEMAIN  A=FREEUID,MF=(E,FMLST))                0306
*                REFS(FREEUID);                                    0306
         FREEMAIN  A=FREEUID,MF=(E,FMLST)
*          END;                                                    0307
@DE00302 L     @10,UIDLPTR                                         0307
         LTR   @10,@10                                             0307
         BNZ   @DL00302                                            0307
*          GOTO  READY;                /* GO TO GET COMMAND          */
         B     READY                                               0308
*/********************************************************************/
*/* NOSPAZ: AT THIS POINT A CONDITIONAL GETMAIN HAS FAILED.          */
*/*    SET THE GENERAL ERROR FLAG AND ISSUE THE 'NOT ENOUGH CORE'    */
*/*      MESSAGE.                                                    */
*/********************************************************************/
*NOSPAZ:   MSGNO = 6;                 /* SET MESSAGE INDEX           */
NOSPAZ   LA    MSGNO,6                                             0309
*          CALL  MSGFNDR;             /* GO TO LOCATE MESSAGE TEXT   */
         BAL   @14,MSGFNDR                                         0310
*          CALL  DOPUTL;              /* GO TO ISSUE PUTLINE         */
         BAL   @14,DOPUTL                                          0311
*          GENERR = '1'B;             /* SET GENERAL ERROR FLAG      */
         OI    GENERR,B'00000010'                                  0312
*/********************************************************************/
*/* DOEND: AT THIS POINT AN END COMMAND HAS BEEN RECEIVED OR AN      */
*/*      ERROR HAS BEEN DETECTED THAT HAS FORCED TERMINATION.        */
*/*    IF STAX IS ACTIVE CANCEL IT.                                  */
*/*    IF STAE IS ACTIVE CANCEL IT.                                  */
*/*    IF ANY ERROR OCCURED SET THE RETURN CODE TO 12, OTHERWISE SET */
*/*      THE RETURN CODE TO 0.                                       */
*/*    RETURN TO CALLER.                                             */
*/********************************************************************/
*DOEND:    IF STXSET = '1'B           /* IS STAX ACTIVE              */
*            THEN                     /* YES,                        */
DOEND    TM    STXSET,B'00100000'                                  0313
         BNO   @RF00313                                            0313
*              GEN (STAX);            /* CANCEL ACCOUNT STAX         */
         STAX
*          IF STASET = '1'B           /* IS STAE ACTIVE              */
*            THEN                     /* YES,                        */
@RF00313 TM    STASET,B'00010000'                                  0315
         BNO   @RF00315                                            0315
*              GEN (STAE  0);         /* CANCEL ACCOUNT STAE         */
         STAE  0
*          IF ERRTN ^= '000'B         /* CHK FOR ERROR OCCURRED FLAG */
*            THEN                     /* YES,                        */
@RF00315 TM    ERRTN,B'00001110'                                   0317
         BZ    @RF00317                                            0317
*              DO;                                                 0318
*              CALL  CLRSTAC;         /* GO TO CLEAR INPUT STACK     */
         BAL   @14,CLRSTAC                                         0319
*              RETURN CODE(12);       /* SET ERROR RETURN CODE       */
         L     @13,4(,@13)                                         0320
         L     @00,@SIZDATD                                        0320
         LR    @01,@11                                             0320
         FREEMAIN R,LV=(0),A=(1)
         LA    @15,12                                              0320
         L     @14,12(,@13)                                        0320
         LM    @00,@12,20(@13)                                     0320
         BR    @14                                                 0320
*              END;                                                0321
*          RETURN CODE(0);            /* RETURN TO CALLER            */
@RF00317 L     @13,4(,@13)                                         0322
         L     @00,@SIZDATD                                        0322
         LR    @01,@11                                             0322
         FREEMAIN R,LV=(0),A=(1)
         SLR   @15,@15                                             0322
         L     @14,12(,@13)                                        0322
         LM    @00,@12,20(@13)                                     0322
         BR    @14                                                 0322
*/* END OF ACCOUNT CP                                                */
*/********************************************************************/
*/* MSGFNDR: ENTRY TO RETRIEVE MESSAGE TEXT.                         */
*/*    MOVE FIRST LEVEL OF MESSAGE INTO DYNAMIC STORAGE.             */
*/*    IF THERE IS A SECOND LEVEL MESSAGE POINTER IN THE MESSAGE,    */
*/*      MOVE THE SECOND LEVEL INTO DYNAMIC STORAGE ALSO.            */
*/*    RETURN TO CALLER.                                             */
*/********************************************************************/
*MSGFNDR:  PROC ;                                                  0323
@EL00001 L     @13,4(,@13)                                         0323
@EF00001 L     @00,@SIZDATD                                        0323
         LR    @01,@11                                             0323
         FREEMAIN R,LV=(0),A=(1)
@ER00001 LM    @14,@12,12(@13)                                     0323
         BR    @14                                                 0323
@PB00001 DS    0H                                                  0323
MSGFNDR  STM   @14,@12,12(@13)                                     0323
*          MOFFNO=(MSGNO*2)+ADDR(ANDXL)-2;  /* FORM PTR TO OFFSET    */
         LR    MOFFNO,MSGNO                                        0324
         ALR   MOFFNO,MOFFNO                                       0324
         L     @10,@CV00165                                        0324
         ALR   MOFFNO,@10                                          0324
         BCTR  MOFFNO,0                                            0324
         BCTR  MOFFNO,0                                            0324
*          MSGPTR = MOFFNC + ADDR(ANDXL); /* FORM PTR TO TEXT        */
         L     MSGPTR,@CV00165                                     0325
         AH    MSGPTR,MOFFNC(,MOFFNO)                              0325
*          MSGLNG = (SEG1*4)+8;       /* LENGTH =(NO. OF SEG X 4) + 8*/
         LA    @10,8                                               0326
         L     MSGLNG,SEG1(,MSGPTR)                                0326
         SLA   MSGLNG,2                                            0326
         ALR   MSGLNG,@10                                          0326
*          TMSGNS1(1:MSGLNG) = MSGMODL1;/* COPY FIRST LEVEL MSG      */
         LR    @15,MSGLNG                                          0327
         BCTR  @15,0                                               0327
         EX    @15,@SM00425                                        0327
*          IF MODX1 ^= 0              /* IS THERE A SECOND LEVEL?    */
*            THEN                     /* YES,                        */
         L     @02,MODX1(,MSGPTR)                                  0328
         LTR   @02,@02                                             0328
         BZ    @RF00328                                            0328
*              DO;                                                 0329
*              MSGLNG = (SEG2*4)+8;   /* LENGTH =(NO. OF SEG X 4) + 8*/
         L     @15,MODX1(,MSGPTR)                                  0330
         L     MSGLNG,SEG2(,@15)                                   0330
         SLA   MSGLNG,2                                            0330
         ALR   MSGLNG,@10                                          0330
*              TMSGNS2(1:MSGLNG) = MSGMODL2;/* COPY SECOND LEVEL MSG */
         LR    @10,MSGLNG                                          0331
         BCTR  @10,0                                               0331
         EX    @10,@SM00427                                        0331
*              TMSGNPTR = ADDR(TMSGNS2);/* SET PTR TO SECOND LEVEL   */
         LA    @10,TMSGNS2                                         0332
         ST    @10,TMSGNPTR                                        0332
*              END;                                                0333
*          END  MSGFNDR;              /* RETURN TO CALLER            */
@EL00002 DS    0H                                                  0334
@EF00002 DS    0H                                                  0334
@ER00002 LM    @14,@12,12(@13)                                     0334
         BR    @14                                                 0334
*/********************************************************************/
*/* CLRSTAC: ENTRY TO CLEAR THE INPUT STACK.                         */
*/*    ISSUE THE STACK SVC TO CLEAR THE INPUT STACK AND RETURN TO    */
*/*      CALLER.                                                     */
*/********************************************************************/
*CLRSTAC:  PROC ;                                                  0335
CLRSTAC  STM   @14,@12,@SA00003                                    0335
*          GEN (TCLEARQ INPUT);       /* CLEAR TERMINAL INPUT QUEUE  */
         TCLEARQ INPUT
*          GEN (STACK ,MF=(E,STPL1)); /* CLEAR STACK                 */
         STACK ,MF=(E,STPL1)
*          END  CLRSTAC;              /* RETURN TO CALLER            */
@EL00003 DS    0H                                                  0338
@EF00003 DS    0H                                                  0338
@ER00003 LM    @14,@12,@SA00003                                    0338
         BR    @14                                                 0338
*/********************************************************************/
*/* DODAR2C: ENTRY TO FREE DYNAMICALLY ALLOCATED DATA SETS.          */
*/*    LINK TO DAIR TO DEALLOCATE THE DATA SET.                      */
*/*    CHECK THE RETURN CODE FROM DAIR, IF IT IS NOT 0 LINK TO       */
*/*      DAIRFAIL TO ISSUE THE ERROR MESSAGE.                        */
*/*    RETURN TO CALLER.                                             */
*/********************************************************************/
*DODAR2C:  PROC ;                                                  0339
DODAR2C  STM   @14,@12,@SA00004                                    0339
*          /* LINK TO DAIR                                           */
*          GEN (LINK  EP=IKJDAIR,MF=(E,DAPL1),SF=(E,LNKCPL))       0340
*            REFS(DAPL1,LNKCPL);                                   0340
         LINK  EP=IKJDAIR,MF=(E,DAPL1),SF=(E,LNKCPL)
*          RFY R15 RSTD;              /* RESTRICT RETURN CODE REG    */
*          RTNCODE  =  R15;           /* RESERVE RETURN CODE         */
         ST    R15,RTNCODE                                         0342
*          RFY R15 UNRSTD;            /* RELEASE RETURN CODE REG     */
*          IF RTNCODE ^= 0            /* CHECK FOR FAILURE CODE      */
*            THEN                     /* YES,                        */
         L     @10,RTNCODE                                         0344
         LTR   @10,@10                                             0344
         BZ    @RF00344                                            0344
*              DO;                                                 0345
*              GENERR='1'B;           /* WILL CAUSE RETURN CODE TO BE
*                                        SET TO 12 BEFORE RETURN     */
         OI    GENERR,B'00000010'                                  0346
*              GEN (LINK  EP=IKJEFF18,MF=(E,DAIRFPPL),SF=(E,LNKCPL))
*                REFS(DAIRFPPL,LNKCPL);                            0347
         LINK  EP=IKJEFF18,MF=(E,DAIRFPPL),SF=(E,LNKCPL)
*              END;                                                0348
*          END  DODAR2C;              /* RETURN TO CALLER            */
@EL00004 DS    0H                                                  0349
@EF00004 DS    0H                                                  0349
@ER00004 LM    @14,@12,@SA00004                                    0349
         BR    @14                                                 0349
*/********************************************************************/
*/* DOPUTL: ENTRY TO ISSUE PUTLINE SVC.                              */
*/*    IF ACCOUNT IS ACTIVE IN THE BACKGROUND SET THE GENERAL ERROR  */
*/*      FLAG.                                                       */
*/*    ISSUE PUTLINE TO ISSUE AN ERROR MESSAGE.                      */
*/*    CHECK THE RETURN CODE, IF THE RETURN CODE FROM PUTLINE IS     */
*/*      GREATER THAN EIGHT SET THE PUTLINE FAILED FLAG. IF THE      */
*/*      RETURN CODE IS 16 ISSUE THE 'NOT ENOUGH CORE' MESSAGE,      */
*/*      OTHERWISE ISSUE THE 'COMMAND SYSTEM ERROR' MESSAGE.         */
*/*    RETURN TO CALLER.                                             */
*/********************************************************************/
*DOPUTL:   PROC ;                                                  0350
DOPUTL   STM   @14,@12,@SA00005                                    0350
*          IF ECTBKGRD='1'B           /* IS ACCOUNT IN BACKGROUND    */
*            THEN                     /* YES,                        */
         TM    ECTBKGRD(ECTPTR),B'00000010'                        0351
         BNO   @RF00351                                            0351
*              GENERR='1'B;           /* WILL CAUSE RETURN CODE TO BE
*                                        SET TO 12 BEFORE RETURN     */
         OI    GENERR,B'00000010'                                  0352
*          IOPLIOPB = ADDR(PLPB);     /* POINT TO PUTLINE PARM BLOCK */
@RF00351 LA    @10,PLPB                                            0353
         ST    @10,IOPLIOPB(,IOPLPTR)                              0353
*          PTPBOPUT = ADDR(TMSGNS1);  /* POINT TO MESSAGE            */
         L     @10,PTPBPTR(,IOPLPTR)                               0354
         LA    @07,TMSGNS1                                         0354
         ST    @07,PTPBOPUT(,@10)                                  0354
*          GEN (PUTLINE  ,MF=(E,IOPL1))                            0355
*            REFS(IOPL1);                                          0355
         PUTLINE  ,MF=(E,IOPL1)
*          RFY R15 RSTD;              /* RESTRICT RETURN CODE REG    */
*          RTNCODE = R15;             /* RESERVE RETURN CODE         */
         ST    R15,RTNCODE                                         0357
*          RFY R15 UNRSTD;            /* RELEASE RETURN CODE REG     */
*          IF RTNCODE > 8             /* CHK FOR SUCESSFUL PUTLINE   */
*            THEN                     /* NO,                         */
         L     @10,RTNCODE                                         0359
         CH    @10,@CH00077                                        0359
         BNH   @RF00359                                            0359
*              DO;                                                 0360
*              IF PLFAIL = '0'B       /* CHK FOR PREVIOUS FAILURE    */
*                THEN                 /* NO,                         */
         TM    PLFAIL,B'00001000'                                  0361
         BNZ   @RF00361                                            0361
*                  DO;                                             0362
*                  PLFAIL = '1'B;     /* SET PUTLINE FAILURE FLAG    */
         OI    PLFAIL,B'00001000'                                  0363
*                  IF RTNCODE = 16    /* INSUFFICIENT SPACE?         */
*                    THEN             /* YES,                        */
         CH    @10,@CH00163                                        0364
         BNE   @RF00364                                            0364
*                      RETURN TO  NOSPAZ; /* GO ISSUE NO SPACE MSG   */
         LA    @14,NOSPAZ                                          0365
         LM    @15,@12,@SA00005+4                                  0365
         BR    @14                                                 0365
*                  MSGNO = 11;        /* SET MESSAGE INDEX           */
@RF00364 LA    MSGNO,11                                            0366
*                  CALL SYSERRD;      /* TO ISSUE SYSTEM ERROR MSG   */
         BAL   @14,SYSERRD                                         0367
*                  RETURN TO DOEND;   /* TERMINATE                   */
         LA    @14,DOEND                                           0368
         LM    @15,@12,@SA00005+4                                  0368
         BR    @14                                                 0368
*                  END;                                            0369
*              END;                                                0370
@RF00361 DS    0H                                                  0371
*          PLFAIL = '0'B;             /* CLEAR PUTLINE FAILURE FLAG  */
@RF00359 NI    PLFAIL,B'11110111'                                  0371
*          IOPLIOPB = ADDR(PGPBM);    /* RESET POINTER TO PUTGET PB  */
         LA    @10,PGPBM                                           0372
         ST    @10,IOPLIOPB(,IOPLPTR)                              0372
*          PGPBOBUF = ADDR(TMSGMDS);  /* SET PTR TO MODE MESSAGE     */
         LA    @10,TMSGMDS                                         0373
         ST    @10,PGPBOBUF                                        0373
*          END  DOPUTL;               /* RETURN TO CALLER            */
@EL00005 DS    0H                                                  0374
@EF00005 DS    0H                                                  0374
@ER00005 LM    @14,@12,@SA00005                                    0374
         BR    @14                                                 0374
*/********************************************************************/
*/* DOPTGT: ENTRY TO ISSUE THE ACCOUNT MODE MESSAGE AND RETRIEVE     */
*/*      A COMMAND.                                                  */
*/*    ISSUE PUTGET.                                                 */
*/*    CHECK THE RETURN CODE, IF THE RETURN CODE FROM PUTGET IS      */
*/*      GREATER THAN 16 SET THE PUTGET FAILED FLAG. IF THE          */
*/*      RETURN CODE IS 28 ISSUE THE 'NOT ENOUGH CORE' MESSAGE,      */
*/*      OTHERWISE ISSUE THE 'COMMAND SYSTEM ERROR' MESSAGE.         */
*/*    RETURN TO CALLER.                                             */
*/********************************************************************/
*DOPTGT:   PROC ;                                                  0375
DOPTGT   STM   @14,@12,@SA00006                                    0375
*          GEN (PUTGET  MF=(E,IOPL1)) /* ISSUE PUTGET                */
*            REFS(IOPL1);                                          0376
         PUTGET  MF=(E,IOPL1)
*          RFY R15 RSTD;              /* RESTRICT RETURN CODE REG    */
*          RTNCODE = R15;             /* RESERVE RETURN CODE         */
         ST    R15,RTNCODE                                         0378
*          RFY R15 UNRSTD;            /* RELEASE RETURN CODE REG     */
*          IF RTNCODE = 8             /* CHK FOR ATTENTION INTERUPT  */
*            THEN                     /* YES,                        */
         L     @10,RTNCODE                                         0380
         CH    @10,@CH00077                                        0380
         BNE   @RF00380                                            0380
*              DO;                                                 0381
*              ATTENTN = '0'B;        /* RESET ECB FOR ATTENTION     */
         NI    ATTENTN,B'10111111'                                 0382
*              RETURN TO PUTGATTN;    /* RETURN TO PROCESS ATTENTION
*                                        INPUT                       */
         LA    @14,PUTGATTN                                        0383
         LM    @15,@12,@SA00006+4                                  0383
         BR    @14                                                 0383
*              END;                                                0384
*          IF RTNCODE > 16            /* CHK FOR PUTGET FAILURE      */
*            THEN                     /* YES,                        */
@RF00380 L     @10,RTNCODE                                         0385
         CH    @10,@CH00163                                        0385
         BNH   @RF00385                                            0385
*              DO;                                                 0386
*              IF PGFAIL = '0'B       /* CHK FOR PREVIOUS FAILURE    */
*                THEN                 /* NO,                         */
         TM    PGFAIL,B'00000100'                                  0387
         BNZ   @RF00387                                            0387
*                  DO;                                             0388
*                  PGFAIL = '1'B;     /* SET PUTGET FAILURE FLAG     */
         OI    PGFAIL,B'00000100'                                  0389
*                  IF RTNCODE = 28    /* CHK FOR INSUFFICIENT SPACE  */
*                    THEN             /* YES,                        */
         CH    @10,@CH00285                                        0390
         BNE   @RF00390                                            0390
*                      RETURN TO  NOSPAZ; /* GO ISSUE NO SPACE MSG   */
         LA    @14,NOSPAZ                                          0391
         LM    @15,@12,@SA00006+4                                  0391
         BR    @14                                                 0391
*                  MSGNO = 12;        /* SET MESSAGE INDEX           */
@RF00390 LA    MSGNO,12                                            0392
*                  CALL SYSERRD;      /* TO ISSUE SYSTEM ERROR MSG   */
         BAL   @14,SYSERRD                                         0393
*                  RETURN TO DOEND;   /* TERMINATE                   */
         LA    @14,DOEND                                           0394
         LM    @15,@12,@SA00006+4                                  0394
         BR    @14                                                 0394
*                  END;                                            0395
*              END;                                                0396
*            ELSE                                                  0397
*              PGFAIL = '0'B;         /* CLEAR PUTGET FAILURE FLAG   */
         B     @RC00385                                            0397
@RF00385 NI    PGFAIL,B'11111011'                                  0397
*          PGPBOBUF = 0;              /* DO NOT REISSUE MODE MESSAGE */
@RC00385 SLR   @10,@10                                             0398
         ST    @10,PGPBOBUF                                        0398
*          END  DOPTGT;                                            0399
@EL00006 DS    0H                                                  0399
@EF00006 DS    0H                                                  0399
@ER00006 LM    @14,@12,@SA00006                                    0399
         BR    @14                                                 0399
*/********************************************************************/
*/* SYSERRD: AT THIS POINT AN UNUSUAL ERROR HAS BEEN DETECTED BY A   */
*/*      SERVICE ROUTINE. THE RETURN CODE WAS SAVED IN 'RTNCODE'.    */
*/*    SET THE GENERAL ERROR FLAG AND CONVERT THE RETURN CODE TO     */
*/*      PRINTABLE DECIMAL CHARACTERS.                               */
*/*    ISSUE THE 'COMMAND SYSTEM ERROR' MESSAGE AND RETURN.          */
*/********************************************************************/
*SYSERRD:  PROC;                                                   0400
SYSERRD  STM   @14,@12,@SA00007                                    0400
*          GENERR = '1'B;             /* SET GENERAL ERROR FLAG      */
         OI    GENERR,B'00000010'                                  0401
*          CALL MSGFNDR;              /* GO TO LOCATE MESSAGE        */
         BAL   @14,MSGFNDR                                         0402
*          CVD  (RTNCODE,DBLWORD);    /* CONVERT CODE TO DECIMAL     */
         L     @10,RTNCODE                                         0403
         CVD   @10,DBLWORD                                         0403
*          UNPK (TMSGTIN1(1:2),DBLWORD(6:8)); /* UNPACK INTO MESSAGE */
         UNPK  TMSGTIN1(2),DBLWORD+5(3)                            0404
*          TMSGTIN1(2) = TMSGTIN1(2)'F0'X; /* REMOVE SIGN           */
         OI    TMSGTIN1+1,X'F0'                                    0405
*          TMSGNP23 = ADDR(TMSGTIX1); /* SET MESSAGE POINTER         */
         LA    @10,TMSGTIX1                                        0406
         ST    @10,TMSGNP23                                        0406
*          TMSGTIL1 = 6;              /* SET LENGTH OF SEGMENT       */
         MVC   TMSGTIL1(2),@CH00223                                0407
*          TMSGTIO1 = 23;             /* SET INSERT OFFSET           */
         MVC   TMSGTIO1(2),@CH00381                                0408
*          CALL  DOPUTL;              /* GO TO ISSUE MESSAGE         */
         BAL   @14,DOPUTL                                          0409
*          END SYSERRD;                                            0410
@EL00007 DS    0H                                                  0410
@EF00007 DS    0H                                                  0410
@ER00007 LM    @14,@12,@SA00007                                    0410
         BR    @14                                                 0410
*/********************************************************************/
*/* STAXXIN: ENTRY POINT FOR ATTENTION INTERUPT HANDLING.            */
*/*    RESTORE ACCOUNT'S REGISTERS FROM THE STAX PARAMETER LIST.     */
*/*    IF A NULL LINE WAS ENTERED RETURN TO PROCESSING.              */
*/*    ISSUE PUTGET TO RETRIEVE THE INPUT LINE                       */
*/*    IF SEND IS NOT ACTIVE ISSUE STATUS TO TERMINATE ANY ATTACHED  */
*/*      ACTIVITY AND DETACH HELP IF IT IS ACTIVE.                   */
*/*    POST THE ACCOUNT ECB AND SET THE ATTENTION COMMAND FLAG.      */
*/*    RETURN TO THE ATTENTION HANDLER.                              */
*/********************************************************************/
*STAXXIN:  PROC OPTIONS(NOSAVEAREA);                               0411
STAXXIN  STM   @14,@12,12(@13)                                     0411
*          RFY (R1,R2,R13) RSTD;      /* RESTRICT STAX INPUT POINTER */
*          R2 = STXUSR13;             /* GET SAVE AREA POINTER       */
         L     R2,STXUSR13(,R1)                                    0413
*          GEN (LM  R2,R12,28(R2));   /* RELOAD ACCOUNT'S REGISTERS  */
         LM  R2,R12,28(R2)
*          RFY (R1,R2) UNRSTD;                                     0415
*          STAXSAVE = R13;            /* SAVE STAX SAVE AREA PTR     */
         LR    STAXSAVE,R13                                        0416
*          R13 = ADDR(SAVEARA);       /* USE NEW SAVE AREA           */
         LA    R13,SAVEARA                                         0417
*          IOPLIOPB = ADDR(PGPBA);    /* SET PTR TO PARAMETER BLOCK  */
         LA    @10,PGPBA                                           0418
         ST    @10,IOPLIOPB(,IOPLPTR)                              0418
*          ATTENTN='0'B;              /* RESET ATTENTION FLAG        */
         NI    ATTENTN,B'10111111'                                 0419
*          CALL  DOPTGT;              /* GO TO ISSUE PUTGET          */
         BAL   @14,DOPTGT                                          0420
*          IOPLIOPB = ADDR(PGPBM);    /* RESET PTR TO PUTGET PB      */
         LA    @10,PGPBM                                           0421
         ST    @10,IOPLIOPB(,IOPLPTR)                              0421
*          IF INPLEN = 4              /* IS BUFFER LENGTH EQUAL TO 4?*/
*            THEN                     /* YES, MUST BE NULL LINE      */
         L     @10,ATTNBUFP                                        0422
         CLC   INPLEN(2,@10),@CH00144                              0422
         BE    @RT00422                                            0422
*              GOTO STAXEND;          /* RETURN TO STAX              */
*          IF SNDNOW = '0'B           /* CHK SEND ACTIVE FLAG        */
*            THEN                     /* NO,                         */
         TM    SNDNOW,B'10000000'                                  0424
         BNZ   @RF00424                                            0424
*              GEN (STATUS STOP);     /* EXECUTE STOP EXCEPT FOR SEND*/
         STATUS STOP
*          IF HLPNOW = '1'B           /* CHK FOR ACTIVE HELP FLAG    */
*            THEN                     /* YES,                        */
@RF00424 TM    HLPNOW,B'01000000'                                  0426
         BNO   @RF00426                                            0426
*              DO;                                                 0427
*              DA2CTCB = HLPTCB;      /* SET TCB PTR IN DAIR PB      */
         L     @10,DAPLPTR                                         0428
         L     @10,DAPB2PTR(,@10)                                  0428
         L     @06,HLPTCB                                          0428
         ST    @06,DA2CTCB(,@10)                                   0428
*              CALL DODAR2C;          /* FREE HELP DATA SET          */
         BAL   @14,DODAR2C                                         0429
*              GEN (DETACH HLPTCB);   /* DETACH HELP                 */
         DETACH HLPTCB
*              HLPNOW = '0'B;         /* SET HELP NOT ACTIVE FLAG    */
         NI    HLPNOW,B'10111111'                                  0431
*              END;                                                0432
*          ATTENTN = '1'B;            /* POST ECB FOR ATTENTION      */
@RF00426 OI    ATTENTN,B'01000000'                                 0433
*          ATNCMD = '1'B;             /* SET ATTENTION COMMAND FLAG  */
         OI    ATNCMD,B'10000000'                                  0434
*STAXEND:  R13 = STAXSAVE;            /* RESTORE STAX SAVE AREA PTR  */
STAXEND  LR    R13,STAXSAVE                                        0435
*          RETURN CODE(0);            /* RETURN TO ATTENTION HANDLER */
         SLR   @15,@15                                             0436
         L     @14,12(,@13)                                        0436
         LM    @00,@12,20(@13)                                     0436
         BR    @14                                                 0436
*          END  STAXXIN;                                           0437
*/********************************************************************/
*/* STAEXIN: ENTRY POINT FOR STAE EXIT.                              */
*/*    RESTORE ACCOUNT'S REGISTERS FROM THE STAE WORK AREA.          */
*/*    BUILD THE 'ENDED DUE TO ERROR' MESSAGE, CONVERT THE ABEND     */
*/*      CODE TO DECIMAL AND ISSUE THE MESSAGE.                      */
*/*    CLEAR THE INPUT STACK, POST THE ACCOUNT ECB AND RETURN TO     */
*/*      STAE WITH NO RETRY SCHEDULED.                               */
*/********************************************************************/
*STAEXIN:  PROC OPTIONS(DONTSAVE(15,0),NOSAVEAREA);                0438
STAEXIN  ST    @14,12(,@13)                                        0438
         STM   @01,@12,24(@13)                                     0438
*          /* ESTABLISH ENTRY ADDRESSABILITY                         */
*          RFY (R1,R2,R13) RSTD;      /* RESTRICT STAE REGISTERS     */
*          R2 = STAUSR13;             /* GET SAVE AREA POINTER       */
         L     R2,STAUSR13(,R1)                                    0440
*          GEN (LM  R2,R12,28(R2));   /* RELOAD ACCOUNT'S REGISTERS  */
         LM  R2,R12,28(R2)
*          RFY R2 UNRSTD;             /* RELEASE WORK REGISTERS      */
*          RTNCODE = SABND;           /* PRESERVE ABEND RETURN CODE  */
         L     @10,SABND(,R1)                                      0443
         ST    @10,RTNCODE                                         0443
*          ECTRTCD = RTNCODE;         /* RESERVE ABEND CODE          */
         STCM  @10,7,ECTRTCD(ECTPTR)                               0444
*          ECTRCDF = '80'X;           /* SET ABEND CODE FLAG         */
         MVI   ECTRCDF(ECTPTR),X'80'                               0445
*          IF STANOW = '1'B           /* CHK IF ABEND RE-ENTRY       */
*            ECTATRM = '1'B          /* CHK FOR ECT QUIT FLAG       */
*            THEN                     /* YES,                        */
         TM    STANOW,B'00000001'                                  0446
         BO    @RT00446                                            0446
         TM    ECTATRM(ECTPTR),B'00100000'                         0446
         BNO   @RF00446                                            0446
@RT00446 DS    0H                                                  0447
*              RETURN CODE(0);        /* GO TO IMMEDIATE EXIT        */
         SLR   @15,@15                                             0447
@EL00009 DS    0H                                                  0447
@EF00009 DS    0H                                                  0447
@ER00009 L     @14,12(,@13)                                        0447
         LM    @01,@12,24(@13)                                     0447
         BR    @14                                                 0447
*          STANOW = '1'B;             /* SET ABEND ACTIVE FLAG       */
@RF00446 OI    STANOW,B'00000001'                                  0448
*          STAESAVE = R13;            /* SAVE STAE SAVE AREA PTR     */
         LR    STAESAVE,R13                                        0449
*          R13 = STAUSR13;            /* USE INPUT PARM FOR SAVE PTR */
         L     R13,STAUSR13(,R1)                                   0450
*          RFY R1 UNRSTD;             /* RELEASE STAE REGISTERS      */
*          MSGNO = 9;                 /* SET MESSAGE INDEX FOR ABEND */
         LA    MSGNO,9                                             0452
*          CALL  MSGFNDR;             /* GO TO LOCATE MESSAGE TEXT   */
         BAL   @14,MSGFNDR                                         0453
*          TMSGNP12 = ADDR(TMSGTIX1); /* SET PTR TO 1ST TEXT SEGMENT */
         LA    @10,TMSGTIX1                                        0454
         ST    @10,TMSGNP12                                        0454
*          TMSGNP22 = ADDR(TMSGTIX2); /* SET PTR TO 2ND TEXT SEGMENT */
         LA    @10,TMSGTIX2                                        0455
         ST    @10,TMSGNP22                                        0455
*          IF ECTSCMD(1) = ' '        /* CHK FOR BLANK IN SUBCOMMAND */
*            THEN                     /* YES,                        */
         CLI   ECTSCMD(ECTPTR),C' '                                0456
         BNE   @RF00456                                            0456
*              TMSGTIN1 = ECTPCMD;    /* SET UP COMMAND NAME         */
         MVI   TMSGTIN1+8,C' '                                     0457
         MVC   TMSGTIN1+9(31),TMSGTIN1+8                           0457
         MVC   TMSGTIN1(8),ECTPCMD(ECTPTR)                         0457
*            ELSE                                                  0458
*              TMSGTIN1 = ECTSCMD;    /* SET UP SUBCOMMAND NAME      */
         B     @RC00456                                            0458
@RF00456 MVI   TMSGTIN1+8,C' '                                     0458
         MVC   TMSGTIN1+9(31),TMSGTIN1+8                           0458
         MVC   TMSGTIN1(8),ECTSCMD(ECTPTR)                         0458
*          DO TSTLNG = 8              /* INITIALIZE SCAN LENGTH      */
*            WHILE TMSGTIN1(TSTLNG)   /* CHK FOR BLANK               */
*            = ' ' BY -1;                                          0459
@RC00456 LA    TSTLNG,8                                            0459
         B     @DE00459                                            0459
@DL00459 DS    0H                                                  0460
*          END;                                                    0460
         BCTR  TSTLNG,0                                            0460
@DE00459 LA    @10,TMSGTIN1-1(TSTLNG)                              0460
         CLI   0(@10),C' '                                         0460
         BE    @DL00459                                            0460
*          TMSGTIL1 = TSTLNG+4;       /* SET TEXT SEGMENT LENGTH     */
         LA    @10,4                                               0461
         ALR   @10,TSTLNG                                          0461
         STH   @10,TMSGTIL1                                        0461
*          TMSGTIO1 = 10;             /* SET TEXT OFFSET             */
         MVC   TMSGTIO1(2),@CH00338                                0462
*          UNPK (TMSGTIN2(1:5),ABENDCD);/* UNPACK THE ABEND CODE     */
         UNPK  TMSGTIN2(5),ABENDCD(3)                              0463
*          GEN (TR    TMSGTIN2(3),HEXTBL-240); /* CONVERT CODE TO BCD*/
         TR    TMSGTIN2(3),HEXTBL-240
*          TMSGTIL2 = 7;              /* SET TEXT SEGMENT LENGTH     */
         MVC   TMSGTIL2(2),@CH00114                                0465
*          TMSGTIO2 = 33;             /* SET TEXT OFFSET             */
         MVC   TMSGTIO2(2),@CH00394                                0466
*          CALL  DOPUTL;              /* GO TO ISSUE PUTLINE         */
         BAL   @14,DOPUTL                                          0467
*          CALL  CLRSTAC;             /* GO TO CLEAR INPUT STACK     */
         BAL   @14,CLRSTAC                                         0468
*          GEN (POST ACCTECB,20)      /* POST ACCOUNT ECB            */
*               SETS(ACCTECB);                                     0469
         POST ACCTECB,20
*          R13 = STAESAVE;            /* RESTORE STAE SAVE AREA PTR  */
         LR    R13,STAESAVE                                        0470
*          RETURN CODE(0);            /* RETURN TO STAE ROUTINE      */
         SLR   @15,@15                                             0471
         L     @14,12(,@13)                                        0471
         LM    @01,@12,24(@13)                                     0471
         BR    @14                                                 0471
*          END  STAEXIN;                                           0472
*          END  IKJEFA00                                           0473
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.      *
*/*%INCLUDE SYSLIB  (IKJCPPL )                                        *
*/*%INCLUDE SYSLIB  (IKJCSOA )                                        *
*/*%INCLUDE SYSLIB  (IKJCSPL )                                        *
*/*%INCLUDE SYSLIB  (IKJDAPL )                                        *
*/*%INCLUDE SYSLIB  (IKJDAP2C)                                        *
*/*%INCLUDE SYSLIB  (IKJECT  )                                        *
*/*%INCLUDE SYSLIB  (IKJIOPL )                                        *
*/*%INCLUDE SYSLIB  (IKJPGPB )                                        *
*/*%INCLUDE SYSLIB  (IKJPSCB )                                        *
*/*%INCLUDE SYSLIB  (IKJPTPB )                                        *
*/*%INCLUDE SYSLIB  (IKJSTPL )                                        *
*/*%INCLUDE SYSLIB  (IKJEFUDL)                                        *
*;                                                                 0473
@DATA    DS    0H
@CH00144 DC    H'4'
@CH00223 DC    H'6'
@CH00114 DC    H'7'
@CH00077 DC    H'8'
@CH00338 DC    H'10'
@CH00163 DC    H'16'
@CH00381 DC    H'23'
@CH00285 DC    H'28'
@CH00355 DC    H'29'
@CH00394 DC    H'33'
@CH00336 DC    H'37'
@SM00395 MVC   CPLS(0),MCPLS
@SM00400 MVC   TMSGTIN1(0),ICBFDA(@09)
@SC00404 CLC   CMDLOC(0,@10),ADDDEF
@SC00406 CLC   CMDLOC(0,@10),CHGDEF
@SC00408 CLC   CMDLOC(0,@10),DELDEF
@SC00410 CLC   CMDLOC(0,@10),ENDDEF
@SC00412 CLC   CMDLOC(0,@10),LSTDEF
@SC00414 CLC   CMDLOC(0,@10),LSTIDEF
@SC00416 CLC   CMDLOC(0,@10),SYNDEF
@SC00418 CLC   CMDLOC(0,@10),HLPDEF
@SM00423 MVC   TMSGTIN1(0),CMDLOC(@09)
@SM00425 MVC   TMSGNS1(0),MSGMODL1(MSGPTR)
@SM00427 MVC   TMSGNS2(0),MSGMODL2(@15)
@DATD    DSECT
         DS    0F
@SA00001 DS    18F
@SA00007 DS    15F
@SA00005 DS    15F
@SA00003 DS    15F
@SA00006 DS    15F
@SA00004 DS    15F
IKJEFA00 CSECT
         DS    0F
@CF00032 DC    F'1'
@CF00073 DC    F'2'
@CF00109 DC    F'12'
@DATD    DSECT
         DS    0D
ACCTECB  DS    AL4
         ORG   ACCTECB
@NM00016 DS    AL1
         ORG   @NM00016
@NM00017 DS    BL1
ATTENTN  EQU   @NM00016+0
         ORG   ACCTECB+1
ECBCODE  DS    AL3
         ORG   ACCTECB+4
BUFFPTR  DS    A
BUFFLEN  DS    A
RTNCODE  DS    F
HLPTCB   DS    A
HLPECB   DS    FL4
         ORG   HLPECB
HWTCTL   DS    BL1
         ORG   HLPECB+4
SNDTCB   DS    A
SNDECB   DS    FL4
         ORG   SNDECB
SWTCTL   DS    BL1
         ORG   SNDECB+4
ACCTLF   DS    AL2
         ORG   ACCTLF
SNDNOW   DS    BL1
HLPNOW   EQU   ACCTLF+0
STXSET   EQU   ACCTLF+0
STASET   EQU   ACCTLF+0
ERRTN    EQU   ACCTLF+0
         ORG   ERRTN
PLFAIL   EQU   ERRTN+0
PGFAIL   EQU   ERRTN+0
GENERR   EQU   ERRTN+0
         ORG   ACCTLF+0
STANOW   EQU   ACCTLF+0
         DS    CL1
ATNCMD   DS    BL1
         ORG   ACCTLF+2
         DS    CL2
ACCTPL   DS    CL20
         ORG   ACCTPL
BASUPTP  DS    AL4
BASECTP  DS    AL4
ACCTECBP DS    AL4
BUFPTR   DS    AL4
UIDLPTR  DS    AL4
         ORG   ACCTPL+20
CSOA1    DS    CL8
CSPL1    DS    CL24
DAPB2C1  DS    CL16
DAPL1    DS    CL20
IOPL1    DS    CL16
STPL1    DS    CL16
CSFLGWD  DS    BL4
CMDID    DS    CL8
         ORG   CMDID
@NM00019 DS    CL6
CMDNU    DS    CL1
@NM00020 DS    CL1
         ORG   CMDID+8
SAVEARA  DS    CL72
HLPPPL   DS    CL16
         ORG   HLPPPL
HLPCBUF  DS    AL4
@NM00022 DS    3A
         ORG   HLPPPL+16
SNDPPL   DS    CL24
         ORG   SNDPPL
@NM00023 DS    4A
SPLUDL   DS    AL4
SPLECB   DS    AL4
         ORG   SNDPPL+24
DAIRFPPL DS    CL20
         ORG   DAIRFPPL
DAPLPTR  DS    AL4
DARCPTR  DS    AL4
DAWRENT  DS    AL4
DAIDENT  DS    AL4
@NM00024 DS    AL4
         ORG   DAIRFPPL+20
TMSGMDS  DS    CL8
         ORG   TMSGMDS
@NM00025 DS    2A
         ORG   TMSGMDS+8
TMSGNS1  DS    CL40
         ORG   TMSGNS1
TMSGNPTR DS    AL4
TMSGNNO1 DS    AL4
@NM00026 DS    AL4
TMSGNP12 DS    AL4
@NM00027 DS    6A
         ORG   TMSGNS1+40
TMSGNS2  DS    CL40
         ORG   TMSGNS2
@NM00028 DS    3A
TMSGNP22 DS    AL4
TMSGNP23 DS    AL4
@NM00029 DS    5A
         ORG   TMSGNS2+40
TMSGTIX1 DS    CL44
         ORG   TMSGTIX1
TMSGTIL1 DS    AL2
TMSGTIO1 DS    AL2
TMSGTIN1 DS    CL40
         ORG   TMSGTIX1+44
TMSGTIX2 DS    CL12
         ORG   TMSGTIX2
TMSGTIL2 DS    AL2
TMSGTIO2 DS    AL2
TMSGTIN2 DS    CL8
         ORG   TMSGTIX2+12
         DS    CL4
DBLWORD  DS    CL8
FREEUID  DS    2A
IKJEFA00 CSECT
         DS    0F
@SIZDATD DC    AL1(1)
         DC    AL3(@ENDDATD-@DATD)
@CV00165 DC    V(ANDXL)
         DS    0D
ZERO     DC    A(0)
IDENT    DC    AL2(1)
@CB00329 DC    X'002C0000'
ACCDEF   DC    CL8'ACCOUNT'
ADDDEF   DC    CL8'ADD'
CHGDEF   DC    CL8'CHANGE'
DELDEF   DC    CL8'DELETE'
ENDDEF   DC    CL8'END'
HLPDEF   DC    CL8'HELP'
LSTDEF   DC    CL8'LIST'
LSTIDEF  DC    CL8'LISTIDS'
SNDDEF   DC    CL8'SEND'
SYNDEF   DC    CL8'SYNC'
CMDIDMDL DC    CL8'IKJEFA00'
HEXTBL   DC    CL16'0123456789ABCDEF'
@DATD    DSECT
IKJEFA00 CSECT
MCPLS    DS    0F
         ATTACH   EP=HELP,STAI=(STAEXIN),PURGE=NONE,SHSPV=78,SF=L
         ATTACH   EP=IKJEES40,STAI=(STAEXIN),PURGE=NONE,SHSPV=78,SF=L
         FREEMAIN V,SP=1,MF=L
         LINK     ,SF=L                            FOR DYNAMIC LINKING
         PUTGET   OUTPUT=(0,SINGLE,ATTN),MF=L      FOR PUTGET ATTEN.
         PUTGET   OUTPUT=(0,SINGLE,MODE),MF=L      FOR PUTGET MODE MSG
         PUTLINE  OUTPUT=(0,,MULTLVL),MF=L         FOR PUTLINE
         STACK    DELETE=ALL,MF=L                  TO CLEAR STACK
         STAE     STAEXIN,PURGE=NONE,MF=L          FOR ABEND EXIT
         STAX     STAXXIN,OBUF=(ACCDEF,7),MF=L FOR ATTEN.
MCPLLNG  DC    A(*-MCPLS)             LENGTH OF MODEL PARAMETER LISTS
@DATD    DSECT                        RE-ESTABLISH AUTOMATIC DSECT
CPLS     DS    0F
HLPCPL   ATTACH  ,SF=L                FOR ATTACH OF HELP
SNDCPL   ATTACH  ,SF=L                FOR ATTACH OF SEND
FMLST    FREEMAIN  ,MF=L              FOR FREEMAIN
LNKCPL   LINK     ,SF=L               FOR DYNAMIC LINKING
PGPBA    PUTGET   ,MF=L               FOR PUTGET ATTENTION
PGPBM    PUTGET   ,MF=L               FOR PUTGET MODE
PLPB     PUTLINE  ,MF=L               FOR PUTLINE
STACL1   STACK ,MF=L                  FOR STACK CALL TO DELETE ALL
STAEL    STAE  STAEXIN,MF=L           FOR ABEND EXIT
STAXL    STAX  STAXXIN,MF=L           FOR ATTENTION EXIT
IKJEFA00 CSECT
         DS   0H
PATCHLOC DC ((@DATA-@PSTART)/20)X'00'
@DATD    DSECT
         ORG   *+1-(*-@DATD)/(*-@DATD) INSURE DSECT DATA
@ENDDATD EQU   *
IKJEFA00 CSECT
@00      EQU   00                      EQUATES FOR REGISTERS 0-15
@01      EQU   01
@02      EQU   02
@03      EQU   03
@04      EQU   04
@05      EQU   05
@06      EQU   06
@07      EQU   07
@08      EQU   08
@09      EQU   09
@10      EQU   10
@11      EQU   11
@12      EQU   12
@13      EQU   13
@14      EQU   14
@15      EQU   15
MSGPTR   EQU   @03
MSGLNG   EQU   @02
MOFFNO   EQU   @07
MSGNO    EQU   @02
STAXSAVE EQU   @07
STAESAVE EQU   @04
TSTLNG   EQU   @02
STPLPTR  EQU   @07
IOPLPTR  EQU   @06
ECTPTR   EQU   @05
CSPLPTR  EQU   @08
CSOAPTR  EQU   @04
CPPLPTR  EQU   @02
R1       EQU   @01
R2       EQU   @02
R13      EQU   @13
R15      EQU   @15
R12      EQU   @12
CPPL     EQU   0
CPPLCBUF EQU   CPPL
CPPLUPT  EQU   CPPL+4
CPPLPSCB EQU   CPPL+8
CPPLECT  EQU   CPPL+12
CSOA     EQU   0
CSOACNM  EQU   CSOA
CSOALNM  EQU   CSOA+4
CSOAFLG  EQU   CSOA+6
CSOANOC  EQU   CSOAFLG
CSOABAD  EQU   CSOAFLG
CSPL     EQU   0
CSPLFLG  EQU   CSPL+12
CSPLOA   EQU   CSPL+16
CSPLCBUF EQU   CSPL+20
DAPL     EQU   0
DAPLPSCB EQU   DAPL+12
DAPLDAPB EQU   DAPL+16
DAPB2C   EQU   0
DA2CTCB  EQU   DAPB2C+4
ECT      EQU   0
ECTRCDF  EQU   ECT
ECTRTCD  EQU   ECT+1
ECTMSGF  EQU   ECT+8
ECTPCMD  EQU   ECT+12
ECTSCMD  EQU   ECT+20
ECTSWS   EQU   ECT+28
ECTNOPD  EQU   ECTSWS
ECTATRM  EQU   ECTSWS
ECTBKGRD EQU   ECTSWS
IOPL     EQU   0
IOPLIOPB EQU   IOPL+12
PGPB     EQU   0
PGPBIBUF EQU   PGPB+12
PSCB     EQU   0
PSCBUSER EQU   PSCB
PSCBUSRL EQU   PSCB+7
PSCBATR1 EQU   PSCB+16
PSCBACCT EQU   PSCBATR1
PTPB     EQU   0
PTPBOPUT EQU   PTPB+4
STPL     EQU   0
STPLSTPB EQU   STPL+12
DUIDL    EQU   0
UIDLNEX  EQU   DUIDL
UIDLSWS  EQU   DUIDL+4
UIDLCT   EQU   DUIDL+6
CMDLOC   EQU   0
@NM00018 EQU   0
ICBFLN   EQU   @NM00018
ICBFOF   EQU   @NM00018+2
ICBFDA   EQU   @NM00018+4
INPLEN   EQU   0
STAEWA   EQU   0
STAUSR13 EQU   STAEWA
SABND    EQU   STAEWA+4
STAXWA   EQU   0
STXUSR13 EQU   STAXWA+8
MOFFNC   EQU   0
MSGMODL1 EQU   0
MODX1    EQU   MSGMODL1
SEG1     EQU   MSGMODL1+4
MSGMODL2 EQU   0
SEG2     EQU   MSGMODL2+4
DAPB2PTR EQU   DAPLDAPB
PGPBPTR  EQU   IOPLIOPB
PSCBPTR  EQU   CPPLPSCB
PTPBPTR  EQU   IOPLIOPB
ATTNBUFP EQU   PGPBA+12
ECTMSG1  EQU   ECTMSGF
PGPBOBUF EQU   PGPBM+4
ABENDCD  EQU   RTNCODE+1
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS
@NM00030 EQU   MSGMODL2
@NM00021 EQU   STAXWA
UIDUSER  EQU   DUIDL+8
@NM00015 EQU   UIDLSWS
UIDCHG   EQU   UIDLSWS
UIDDEL   EQU   UIDLSWS
UIDADD   EQU   UIDLSWS
STPLECB  EQU   STPL+8
STPLECT  EQU   STPL+4
STPLUPT  EQU   STPL
PTPBFLN  EQU   PTPB+8
@NM00014 EQU   PTPB
PSCBU    EQU   PSCB+64
PSCBRSZ  EQU   PSCB+60
PSCBLINE EQU   PSCB+59
PSCBCHAR EQU   PSCB+58
PSCBUPTL EQU   PSCB+56
PSCBUPT  EQU   PSCB+52
PSCBRLGB EQU   PSCB+48
PSCBDEST EQU   PSCB+40
@NM00013 EQU   PSCB+36
@NM00012 EQU   PSCB+32
@NM00011 EQU   PSCB+28
PSCBLTI2 EQU   PSCB+24
PSCBLTIM EQU   PSCB+20
PSCBATR2 EQU   PSCB+18
@NM00010 EQU   PSCBATR1
@NM00009 EQU   PSCBATR1
@NM00008 EQU   PSCBATR1
PSCBATTN EQU   PSCBATR1
PSCBVMNT EQU   PSCBATR1
PSCBJCL  EQU   PSCBATR1
PSCBCTRL EQU   PSCBATR1
PSCBGPNM EQU   PSCB+8
@NM00007 EQU   PGPB
IOPLECB  EQU   IOPL+8
IOPLECT  EQU   IOPL+4
IOPLUPT  EQU   IOPL
ECTBKPB  EQU   ECT+36
ECTUSER  EQU   ECT+32
ECTDDNUM EQU   ECT+29
@NM00006 EQU   ECTSWS
ECTNNOT  EQU   ECTSWS
ECTNMAL  EQU   ECTSWS
ECTLOGF  EQU   ECTSWS
@NM00005 EQU   ECTSWS
ECTSMSG  EQU   ECT+9
ECTIOWA  EQU   ECT+4
DA2CDDN  EQU   DAPB2C+8
DA2CFLG  EQU   DAPB2C+2
DA2CCD   EQU   DAPB2C
DAPLECB  EQU   DAPL+8
DAPLECT  EQU   DAPL+4
DAPLUPT  EQU   DAPL
CSPLECB  EQU   CSPL+8
CSPLECT  EQU   CSPL+4
CSPLUPT  EQU   CSPL
@NM00004 EQU   CSOA+7
@NM00003 EQU   CSOAFLG
@NM00002 EQU   CSOAFLG
@NM00001 EQU   CSOAFLG
CSOAQM   EQU   CSOAFLG
CSOAVNP  EQU   CSOAFLG
CSOAVWP  EQU   CSOAFLG
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS
@RT00099 EQU   NOSPAZ
@RF00135 EQU   GETCMD
@RT00150 EQU   DOEND
@RT00183 EQU   NOSPAZ
@RT00219 EQU   DOEND
@RF00260 EQU   READY
@RT00278 EQU   READY
@RF00328 EQU   @EL00002
@RF00344 EQU   @EL00004
@RF00387 EQU   @RC00385
@RT00422 EQU   STAXEND
@PB00009 EQU   @EL00001
@PB00008 EQU   @PB00009
@PB00007 EQU   @PB00008
@PB00006 EQU   @PB00007
@PB00005 EQU   @PB00006
@PB00004 EQU   @PB00005
@PB00003 EQU   @PB00004
@PB00002 EQU   @PB00003
@ENDDATA EQU   *
         END   IKJEFA00

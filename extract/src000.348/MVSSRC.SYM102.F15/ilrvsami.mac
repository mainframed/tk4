         TITLE 'ILRVSAMI, VSAM INTERFACE                               *
                        '
ILRVSAMI CSECT ,                                                   0001
@MAINENT DS    0H                                                  0001
         USING *,@15                                               0001
         B     @PROLOG                                             0001
         DC    AL1(16)                                             0001
         DC    C'ILRVSAMI  76.087'                                 0001
         DROP  @15
@PROLOG  STM   @14,@12,12(@13)                                     0001
         BALR  @10,0                                               0001
@PSTART  LA    @06,4095(,@10)                                      0001
         USING @PSTART,@10                                         0001
         USING @PSTART+4095,@06                                    0001
         EJECT
*                                                                  0059
*/*ILRVSAMI: CHART (AREF,SEQ)                                        */
*/*HEADER                                                          0059
*/*            ILRVSAMI - VSAM INTERFACE ROUTINE                     */
*/*ILRVSAMI: E ENTRY                                                 */
*/*         P  SAVE CALLER'S REGISTERS                               */
*/*         S  ILRGMA: GET A WORKAREA                                */
*/*         D  (YES,%VSM01,NO,) RETURN CODE ZERO?                    */
*/*          D  (YES,%VSM01,NO,) RETURN CODE ZERO?                   */
*/*         P  SET RETURN CODE TO 28                                 */
*/*         R  RETURN                                                */
*/*%VSM01:  P  SAVE PTR TO WORKAREA                                  */
*/*         P  GET PTR TO PARMLIST FROM INPUT REG 1                  */
*/*         P  GET PTR TO EPATH FROM PARM LIST                       */
*/*         P  RECORD ENTRY IN EPATH                                 */
*/*         P  RECORD PTR TO WORKAREA IN EPATH                       */
*/*         P  GET ADDRESS OF SUBROUTINE BASED ON OP-CODE            */
*/*         N  01=GETASPCT, 02=PUTASPCT, 03&04=RETERASE              */
*/*         S  CALL: SUBROUTINE                                      */
*/*         D  (YES,%VSM02,NO,) ZERO RETURN CODE?                    */
*/*         S  ABEND: 086                                            */
*/*%VSM02:  P  ZERO THE PTR TO WORKAREA IN EPATH                     */
*/*         P  SAVE RETURN CODE IN REGISTER                          */
*/*         S  ILRGMA: FREE THE WORKAREA                             */
*/*         P  ZERO ENTRY INFO IN EPATH                              */
*/*         P  LOAD REG 15 WITH RETURN CODE                          */
*/*         R  RETURN TO CALLER                                      */
*/*ILRVSAMI: END                                                     */
*                                                                  0059
         EJECT
*                                                                  0059
*   /*****************************************************************/
*   /*                                                               */
*   /* BEGIN ILRGMA MACRO EXPANSION                                  */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0059
*   DO;                             /* ILRGMA GET                  0059
*                                      CELL(SWK)WORKREGS(R11,R12)    */
*     DECLARE                       /* ASMVT VECTOR TO ILRPEX        */
*       ILRPEX ENTRY BASED(ASMPEX) VALRG(0);                       0060
*     DECLARE                       /* MAP FOR CELL CONTROL WORDS    */
*       1 GMACELL BASED BDY(WORD),                                 0061
*        2 GMANEXT PTR(31);         /* PTR NEXT FREE CELL            */
*     RESPECIFY                                                    0062
*      (R0,                                                        0062
*       R1,                                                        0062
*       R11,                                                       0062
*       R12,                                                       0062
*       R14,                                                       0062
*       R15) RESTRICTED;                                           0062
*     RESPECIFY                                                    0063
*       ASMPOOLS BASED(R11);                                       0063
*     RESPECIFY                                                    0064
*       GMACELL BASED(R14);                                        0064
*     R11=ADDR(ASMSWKPC);                                          0065
         LA    R11,ASMSWKPC(,ASMVTPTR)                             0065
*     LM(R14,R15,ASMCPAVQ);         /* GET ADDR OF 1ST CELL          */
         LM    R14,R15,ASMCPAVQ(R11)                               0066
*GMA00010:                                                         0067
*     IF R14^=0 THEN                /* TEST CELL POOL                */
GMA00010 LTR   R14,R14                                             0067
         BZ    @RF00067                                            0067
*       DO;                         /* CELL AVAILABLE, REMOVE CELL   */
*         R0=GMANEXT;                                              0069
         L     R0,GMANEXT(,R14)                                    0069
*         R1=R15-1;                                                0070
         LR    R1,R15                                              0070
         BCTR  R1,0                                                0070
*         CDS(R14,R0,ASMCPAVQ);                                    0071
         CDS   R14,R0,ASMCPAVQ(R11)                                0071
*         BC(7,GMA00010);                                          0072
         BC    7,GMA00010                                          0072
*         R1=R14;                                                  0073
         LR    R1,R14                                              0073
*       END;                                                       0074
*     ELSE                                                         0075
*       DO;                         /* CELL POOL EMPTY               */
         B     @RC00067                                            0075
@RF00067 DS    0H                                                  0076
*         R1=R11;                   /* PREPARE TO CALL PEX           */
         LR    R1,R11                                              0076
*         CALL ILRPEX;              /* EXTEND THE POOL               */
         L     @15,ASMPEX(,ASMVTPTR)                               0077
         BALR  @14,@15                                             0077
*       END;                                                       0078
*     RESPECIFY                                                    0079
*      (R0,                                                        0079
*       R1,                                                        0079
*       R11,                                                       0079
*       R12,                                                       0079
*       R14,                                                       0079
*       R15) UNRESTRICTED;                                         0079
@RC00067 DS    0H                                                  0080
*   END;                            /* ILRGMA GET                  0080
*                                      CELL(SWK)WORKREGS(R11,R12)    */
*                                                                  0080
*   /*****************************************************************/
*   /*                                                               */
*   /* END ILRGMA MACRO EXPANSION                                    */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0081
         EJECT
*                                                                  0081
*/********************************************************************/
*/* IF ILRGMA WAS UNSUCCESSFUL, RETURN TO CALLER INDICATING WE COULD */
*/* NOT OBTAIN STORAGE.                                              */
*/* IF ILRGMA IS SUCCESSFUL, ESTABLISH ADDRESSABILITY TO THE WORK    */
*/* AREA AND INITIALIZE WORKAREA FIELDS.                             */
*/********************************************************************/
*                                                                  0081
*   RFY                                                            0081
*     R1 RSTD;                                                     0081
*   IF R1=ZERO                      /* DID WE OBTAIN A WORKAREA?     */
*     THEN                          /* NO, RETURN TO CALLER          */
         LTR   R1,R1                                               0082
         BNZ   @RF00082                                            0082
*     RETURN CODE(STORAGE);         /* INDICATING WE COULD NOT OBTAIN
*                                      STORAGE                       */
         LA    @15,28                                              0083
         L     @14,12(,@13)                                        0083
         LM    @00,@12,20(@13)                                     0083
         BR    @14                                                 0083
*   ELSE                                                           0084
*     DO;                           /* YES, ESTABLISH WORKAREA     0084
*                                      ADDRESSABILITY                */
@RF00082 DS    0H                                                  0085
*       RFY                                                        0085
*         R8 RSTD;                                                 0085
*       R8=R1;                      /* GET ADDR OF RPL BUILD AREA    */
         LR    R8,R1                                               0086
*       R9=R8+LENGTH(IFGRPL);       /* GET ADDRESS OF WORKAREA       */
         LA    R9,76                                               0087
         ALR   R9,R8                                               0087
*       RFY                                                        0088
*         R8 UNRSTD;                                               0088
*       GENERATE REFS(R1,R13) SETS(R1,R8,R9,R13,RPLPTR);           0089
         USING @DATD,R9
         ST    R8,RPLPTR                  SAVE PTR TO RPL BUILD AREA
         LA    R8,SAVEREGA                GET ADDRESS OF SAVEAREA
         ST    R13,4(R8)                  STORE BACKWARD POINTER
         ST    R8,8(R13)                  STORE FORWARD POINTER
         L     R1,24(R13)                 GET PTR TO INPUT PARM LIST
         LR    R13,R8                     SET R13 TO OUR SAVEAREA
*     END;                                                         0090
*   PARMPTR=R1;                     /* SAVE PTR TO INPUT PARMLIST    */
         ST    R1,PARMPTR                                          0091
*   EPAPTR=EPATHPTR;                /* SAVE PTR TO EPATH             */
         L     @12,PARMPTR                                         0092
         L     @11,EPATHPTR(,@12)                                  0092
         ST    @11,EPAPTR                                          0092
*   EPAVSAMI=ON;                    /* RECORD ENTRY                  */
         OI    EPAVSAMI(@11),B'10000000'                           0093
*   EPAVWKA=RPLPTR;                 /* REC PTR TO BEGINNING OF WKA   */
         L     @08,RPLPTR                                          0094
         ST    @08,EPAVWKA(,@11)                                   0094
*   ASMVTWPT=ASMVTPTR;              /* SAVE PTR TO ASMVT             */
         ST    ASMVTPTR,ASMVTWPT                                   0095
*   EPARTYRG=ADDR(SAVREGSA);        /* RECORD REG SAVEAREA ADDR      */
         LA    @07,SAVREGSA                                        0096
         ST    @07,EPARTYRG(,@11)                                  0096
*   RFY                                                            0097
*    (R1,                                                          0097
*     ASMVTPTR) UNRSTD;                                            0097
*   RFY                                                            0098
*     ASMVT BASED(ASMVTWPT);                                       0098
*   FBCODE=ZERO;                    /* ZERO SHOWCB FEEDBACK FIELD    */
         SLR   @11,@11                                             0099
         ST    @11,FBCODE                                          0099
*   RETCODE=ZERO;                   /* ZERO INTERNAL RETURN CODE     */
         ST    @11,RETCODE                                         0100
*   RETASPCT=ZERO;                  /* ZERO PTR TO RETRIEVED ASPCT   */
         ST    @11,RETASPCT                                        0101
*   RFY                                                            0102
*     IFGRPL BASED(RPLPTR);                                        0102
*   RPL=RPL&&RPL;                   /* ZERO THE RPL BUILD AREA       */
         XC    RPL(76,@08),RPL(@08)                                0103
         EJECT
*                                                                  0104
*/********************************************************************/
*/* CALL THE APPROPRIATE SUBROUTINE BASED ON THE CALLER'S REQUEST    */
*/* OPCODE IN THE PARAMETER LIST. IF THE SUBROUTINE WAS UNSUCCESSFUL */
*/* ISSUE AN 086 ABEND FOR RECORDING.                                */
*/* RETURN THE WORKAREA TO ITS POOL AND RETURN TO CALLER.            */
*/********************************************************************/
*                                                                  0104
*   OPCPTR=PTRS(OPCODE);            /* GET PTR TO INTERNAL SUBROUTINE
*                                      BASED ON THE INPUT REQUEST  0104
*                                      OP-CODE. 01 = GETASPCT 02 = 0104
*                                      PUTASPCT 03 & 04 = RETERASE   */
         SLR   @11,@11                                             0104
         IC    @11,OPCODE(,@12)                                    0104
         SLA   @11,2                                               0104
         L     OPCPTR,PTRS-4(@11)                                  0104
*   CALL ROUTINE;                   /* CALL THE APPROPRIATE        0105
*                                      SUBROUTINE TO PROCESS THE   0105
*                                      REQUEST                       */
         LR    @15,OPCPTR                                          0105
         BALR  @14,@15                                             0105
*   RFY                                                            0106
*     R15 RSTD;                                                    0106
*   IF R15^=ZERO                    /* WAS SUBROUTINE SUCCESSFUL?    */
*     THEN                                                         0107
         LTR   R15,R15                                             0107
         BZ    @RF00107                                            0107
*     DO;                           /* NO                            */
*       IF R15=TWENTY               /* I/O ERROR?                    */
*         THEN                                                     0109
         C     R15,@CF00120                                        0109
         BNE   @RF00109                                            0109
*         DO;                       /* YES, RECORD ERROR             */
*           STM(R0,R14,SAVREGSA);   /* SAVE REGS FOR RECOVERY        */
         STM   R0,R14,SAVREGSA                                     0111
*           GEN(ABEND X'86',,,SYSTEM);/* RECORD THE ERROR            */
         ABEND X'86',,,SYSTEM
*         END;                                                     0113
*       IF OPCODE=REL               /* IS THIS A RELEASE REQ?        */
*         THEN                                                     0114
@RF00109 L     @14,PARMPTR                                         0114
         CLI   OPCODE(@14),4                                       0114
         BNE   @RF00114                                            0114
*         IF RETASPCT^=ZERO         /* WAS THE BASE RETRIEVED?       */
*           THEN                    /* YES                           */
         L     @14,RETASPCT                                        0115
         LTR   @14,@14                                             0115
         BZ    @RF00115                                            0115
*           R15=PARTIAL;            /* SET PARTIAL RETRIEVAL RC      */
         LA    R15,48                                              0116
*     END;                                                         0117
@RF00115 DS    0H                                                  0117
@RF00114 DS    0H                                                  0118
*   EPARPLB=OFF;                    /* RESET RPL BUILT FLAG          */
@RF00107 L     @14,EPAPTR                                          0118
         NI    EPARPLB(@14),B'11111110'                            0118
*   EPARTYRG=ZERO;                  /* ZERO REG SAVEAREA PTR         */
         SLR   @12,@12                                             0119
         ST    @12,EPARTYRG(,@14)                                  0119
*   EPAVWKA=ZERO;                   /* ZERO RECOVERY'S PTR TO WKA    */
         ST    @12,EPAVWKA(,@14)                                   0120
*   EPAVSAMI=OFF;                   /* ZERO ENTRY FLAG               */
         NI    EPAVSAMI(@14),B'01111111'                           0121
*   GENERATE REFS(R13,R15) SETS(R13);                              0122
         L     R13,4(R13)                 GET ADDR OF CALLERS SAVEAREA
         MVC   16(4,R13),RETCODE          STORE RET CODE IN CALLERS R15
         MVC   24(4,R13),RETASPCT         STORE PTR TO RET ASPCT
         L     R1,RPLPTR                  GET PTR TO BEGINNING OF WKA
*   RFY                                                            0123
*     R15 UNRSTD;                                                  0123
         EJECT
*                                                                  0124
*   /*****************************************************************/
*   /*                                                               */
*   /* BEGIN ILRGMA MACRO EXPANSION                                  */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0124
*   DO;                             /* ILRGMA FREE                 0124
*                                      CELL(SWK)WORKREGS(R11,R12)    */
*     RESPECIFY                                                    0125
*      (R0,                                                        0125
*       R1,                                                        0125
*       R11,                                                       0125
*       R12,                                                       0125
*       R14,                                                       0125
*       R15) RESTRICTED;                                           0125
*     RESPECIFY                                                    0126
*       ASMPOOLS BASED(R11);                                       0126
*     RESPECIFY                                                    0127
*       GMACELL BASED(R1);                                         0127
*     R11=ADDR(ASMSWKPC);                                          0128
         L     R11,ASMVTWPT                                        0128
         LA    R11,ASMSWKPC(,R11)                                  0128
*     R14=ASMCPAVL;                                                0129
         L     R14,ASMCPAVL(,R11)                                  0129
*GMA00022:                                                         0130
*     GMANEXT=R14;                  /* PUT ADDR CURRENT FIRST IN   0130
*                                      INPUT CELL                    */
GMA00022 ST    R14,GMANEXT(,R1)                                    0130
*     CS(R14,R1,ASMCPAVL);          /* ADD INPUT CELL TO POOL        */
         CS    R14,@01,ASMCPAVL(R11)                               0131
*     BC(7,GMA00022);                                              0132
         BC    7,GMA00022                                          0132
*     RESPECIFY                                                    0133
*      (R0,                                                        0133
*       R1,                                                        0133
*       R11,                                                       0133
*       R12,                                                       0133
*       R14,                                                       0133
*       R15) UNRESTRICTED;                                         0133
*   END;                            /* ILRGMA FREE                 0134
*                                      CELL(SWK)WORKREGS(R11,R12)    */
*                                                                  0134
*   /*****************************************************************/
*   /*                                                               */
*   /* END ILRGMA MACRO EXPANSION                                    */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0135
*                                   /* RETURN THE WORKAREA           */
*   RETURN;                         /* RETURN TO CALLER              */
@EL00001 DS    0H                                                  0135
@EF00001 DS    0H                                                  0135
@ER00001 LM    @14,@12,12(@13)                                     0135
         BR    @14                                                 0135
         EJECT
*                                                                  0136
*/********************************************************************/
*/*                                                                  */
*/*  GETASPCT: RETRIEVE AN ASPCT                                     */
*/*                                                                  */
*/*  INPUT:    THE INPUT PARAMETER LIST                              */
*/*              WORD 1 = 01 OP-CODE                                 */
*/*              WORD 2 = PTR TO 8-BYTE 'S' SYMBOL                   */
*/*              WORD 3 = PTR TO THE EPATH                           */
*/*                                                                  */
*/*  PROCESS:  SAVE THE RETURN ADDRESS. COPY THE 'S' SYMBOL TO THE   */
*/*            WORKAREA KEY. CALL GETONE TO RETRIEVE THE ASPCT BASE  */
*/*            FROM STGINDEX. IF THERE ARE NO EXTENSIONS, RETURN TO  */
*/*            MAINLINE.                                             */
*/*            SAVE THE NUMBER OF LPME EXTENSIONS AND ASST           */
*/*            EXTENSIONS. ZERO THESE COUNTS AND THE POINTERS TO THE */
*/*            ASST EXTENSIONS IN THE RETRIEVED ASPCT BASE. RECORD   */
*/*            POINTER TO RETRIEVED BASE. INCREMENT THE WORKAREA KEY */
*/*            FOR AN ASST EXTENSION. CALL GETONE TO RETRIEVE AN     */
*/*            ASST EXTENSION. ZERO THE POINTERS TO THE LPME EXT.    */
*/*            IN THE ASST EXT. STORE THE POINTER TO THE ASST EXT.   */
*/*            IN THE BASE. NOW LOOP THROUGH RETRIEVING THE LPME     */
*/*            EXT. FOR THIS ASST EXT. GETONE IS CALLED FOR EACH     */
*/*            LPME EXT. THE LPME EXT. ARE ANCHORED IN THE ASST EXT. */
*/*            ONCE WE HAVE RETRIEVED ALL THE LPME EXT. FOR THIS     */
*/*            ASST EXT. WE LOOP BACK AND RETRIEVE THE NEXT ASST     */
*/*            EXT. ONCE ALL EXT. HAVE BEEN RETRIEVED, RETURN TO     */
*/*            MAINLINE.                                             */
*/*            IF ONE OF THE EXTENSIONS COULD NOT BE RETRIEVED, ALL  */
*/*            THE STORAGE USED FOR THE ASPCT BASE AND THOSE         */
*/*            EXTENSIONS RETRIEVED, IS FREED, AND THE POINTER       */
*/*            TO THE RETRIEVED ASPCT IS ZEROED.                     */
*/*                                                                  */
*/*  OUTPUT:   THE ASPCT BASE AND ALL OF ITS EXTENSIONS HAVE BEEN    */
*/*            RETRIEVED FROM SYS1.STGINDEX AND ARE RECHAINED IN     */
*/*            2K PAGEABLE BUFFERS.                                  */
*/*                                                                  */
*/********************************************************************/
*/*GETASPCT: CHART (AREF,SEQ)                                        */
*/*HEADER                                                          0136
*/* GETASPCT: GET AN ASPCT FROM SYS1.STGINDEX                        */
*/*GETASPCT: E ENTRY                                                 */
*/*         P  SAVE THE RETURN ADDRESS                               */
*/*         P  SET THE WKA KEY FOR ASPCT BASE                        */
*/*         S  GETONE: GET THE ASPCT BASE FROM STGINDEX              */
*/*         D  (YES,%VSM04,NO,) ZERO RETURN CODE?                    */
*/*         P  SAVE THE RETURN CODE                                  */
*/*         D  (YES,,NO,%VSM03) STORAGE OBTAINED?                    */
*/*         L  SETLOCK: UNCOND OBTAIN LOCAL LOCK                     */
*/*         P  ZERO THE EPATH PTR TO I/O BUFFER                      */
*/*         P  LOAD REGISTERS FOR FREEMAIN                           */
*/*         S  FREEMAIN: FREE THE BUFFER USED FOR BASE               */
*/*         L  SETLOCK: UNCOND RELEASE LOCAL LOCK                    */
*/*%VSM03:  R  RETURN TO MAINLINE                                    */
*/*%VSM04:  D  (YES,,NO,%VSM03) ANY EXTENSIONS?                      */
*/*         P  SAVE THE NUMBER OF LPME EXTENSIONS (ASPLEXCT)         */
*/*         P  SAVE THE NUMBER OF ASST EXTENSIONS (ASPAEXCT)         */
*/*         P  ZERO THE LPME EXT COUNT IN ASPCT (ASPLEXCT)           */
*/*         P  ZERO THE ASST EXT COUNT IN ASPCT (ASPAEXCT)           */
*/*         P  ZERO THE ASST EXT PTRS IN ASPCT (ASPASSTP)            */
*/*         P  RECORD PTR TO BUFFER IN EPATH                         */
*/*         P  ZERO THE EPATH PTR TO THE I/O BUFFER                  */
*/*%VSM05:  P  SET WKA KEY TO ASST EXTENSION                         */
*/*         S  GETONE: GET AN ASST EXT FROM STGINDEX                 */
*/*         D  (YES,%VSM08,NO,) ZERO RETURN CODE?                    */
*/*         L  SETLOCK: UNCOND OBTAIN LOCAL LOCK                     */
*/*         D  (YES,,NO,%VSM06) STORAGE OBTAINED?                    */
*/*         P  ZERO INDIVIDUAL BUFFER PTR IN EPATH                   */
*/*         P  LOAD REGISTERS FOR FREEMAIN                           */
*/*         S  FREEMAIN: FREE THE I/O BUFFER                         */
*/*%VSM06:  P  ZERO PTR TO BUFFER IN EPATH                           */
*/*         P  LOAD REG 1 WITH PTR TO BASE BUFFER                    */
*/*         P  SET REG 0 TO LENGTH OF BUFFER                         */
*/*         S  ILRAFS00: FREE THE BUFFERS                            */
*/*         P  SAVE THE RETURN CODE                                  */
*/*         L  SETLOCK: UNCOND RELEASE LOCAL LOCK                    */
*/*         D  (YES,%VSM07,NO,) ZERO RETURN CODE?                    */
*/*         S  ABEND: 087                                            */
*/*%VSM07:  P  LOAD INTERNAL RETURN CODE                             */
*/*         R  RETURN TO MAINLINE                                    */
*/*%VSM08:  P  ZERO THE PTRS TO THE LPME EXTS                        */
*/*         P  STORE PTR TO ASST EXT IN BASE                         */
*/*         P  ZERO THE I/O BUFFER PTR IN EPATH                      */
*/*         P  INCREMENT ASST EXT COUNTER IN BASE                    */
*/*         P  DECREMENT INTERNAL ASST COUNTER                       */
*/*%VSM09:  P  SET THE WORKAREA KEY FOR LPME EXT                     */
*/*         S  GETONE : GET AN LPME EXT FROM STGINDEX                */
*/*         D  (YES,%VSM09A,NO,) ZERO RETURN CODE?                   */
*/*         L  SETLOCK: UNCOND OBTAIN LOCAL LOCK                     */
*/*         D  (YES,,NO,%VSM06) STORAGE OBTAINED?                    */
*/*         P  STORE PTR TO LPME EXT IN ASST EXT                     */
*/*         P  INCREMENT THE LPME EXT COUNT IN BASE                  */
*/*         P  (,%VSM06) ZERO EPATH PTR TO I/O BUFFER                */
*/*%VSM09A: P  STORE PTR TO LPME EXT IN ASST EXT                     */
*/*         P  ZERO EPATH PTR TO I/O BUFFER                          */
*/*         P  INCREMENT LPME EXT COUNTER IN BASE                    */
*/*         P  DECREMENT INTERNAL LPME COUNTER                       */
*/*         D  (YES,%VSM10,NO,) INTERNAL LPME COUNTER = 0?           */
*/*         P  INCREMENT ASST EXT ARRAY SUBSCRIPT                    */
*/*         D  (YES,,NO,%VSM09) REACHED END OF ARRAY?                */
*/*         P  RESET TO BEGINNING OF ARRAY                           */
*/*%VSM10:  D  (YES,%VSM11,NO,) INTERNAL ASST COUNTER = 0?           */
*/*         P  INCREMENT BASE ARRAY POINTER                          */
*/*         D  (YES,,NO,%VSM05) REACHED END OF ARRAY?                */
*/*%VSM11:  R  RETURN TO MAINLINE                                    */
*/*GETASPCT: END                                                     */
*                                                                  0136
         EJECT
*GETASPCT:                                                         0136
*   PROCEDURE OPTIONS(NOSAVE,NOSAVEAREA);                          0136
GETASPCT DS    0H                                                  0137
*   RFY                                                            0137
*     R14 RSTD;                                                    0137
*   RETADDR1=R14;                   /* SAVE THE RETURN ADDRESS       */
         ST    R14,RETADDR1                                        0138
*   RFY                                                            0139
*     R14 UNRSTD;                                                  0139
*                                                                  0139
*/********************************************************************/
*/* BUILD THE RETRIEVAL KEY FOR VSAM, AND CALL GETONE TO RETRIEVE    */
*/* THE ASPCT BASE.                                                  */
*/********************************************************************/
*                                                                  0140
*   WKAKEY=SSYM;                    /* COPY THE 'S' SYMBOL TO THE    */
         L     @12,PARMPTR                                         0140
         L     @12,SSYMPTR(,@12)                                   0140
         MVC   WKAKEY(8),SSYM(@12)                                 0140
*   EXTNUMB=ZERO;                   /* WORKAREA KEY FOR VSAM         */
         SLR   @12,@12                                             0141
         ST    @12,EXTNUMB                                         0141
*   EPARPLB=OFF;                    /* SET RPL BUILT FLAG OFF        */
         L     @12,EPAPTR                                          0142
         NI    EPARPLB(@12),B'11111110'                            0142
*   CALL GETONE;                    /* RETRIEVE ASPCT BASE           */
         BAL   @14,GETONE                                          0143
         EJECT
*                                                                  0144
*/********************************************************************/
*/* IF THE BASE RETRIEVAL WAS SUCCESSFUL AND THERE ARE EXTENSIONS,   */
*/* ZERO THE BASE POINTERS TO ASST EXTENSIONS AND SETUP FOR          */
*/* EXTENSION RETRIEVAL.                                             */
*/********************************************************************/
*                                                                  0144
*   RFY                                                            0144
*     R15 RSTD;                                                    0144
*   IF R15=ZERO                     /* SUCCESSFUL RETRIEVAL?         */
*     THEN                                                         0145
         SLR   @14,@14                                             0145
         CR    R15,@14                                             0145
         BNE   @RF00145                                            0145
*     DO;                           /* YES                           */
*       RFY                                                        0147
*         R15 UNRSTD;                                              0147
*       ASPCTPTR=BUFFER;            /* SAVE PTR TO ASPCT BASE        */
         L     @12,BUFFER                                          0148
         ST    @12,ASPCTPTR                                        0148
*       RETASPCT=BUFFER;            /* ANCHOR ASPCT BASE             */
         ST    @12,RETASPCT                                        0149
*       IF ASPAEXCT^=ZERO           /* ARE THERE ANY EXTENSIONS?     */
*         THEN                                                     0150
         LH    @11,ASPAEXCT(,@12)                                  0150
         CR    @11,@14                                             0150
         BE    @RF00150                                            0150
*         DO;                       /* YES                           */
*           BASE=ONE;               /* INIT BASE SUBSCRIPT           */
         LA    @08,1                                               0152
         ST    @08,BASE                                            0152
*           ASST=TWO;               /* INIT ASST SUBSCRIPT           */
         MVC   ASST(4),@CF00114                                    0153
*           LPMEXT=ASPLEXCT;        /* GET NUMBER OF LPME EXT'S      */
         LH    @07,ASPLEXCT(,@12)                                  0154
         ST    @07,LPMEXT                                          0154
*           ASSTEXT=ASPAEXCT;       /* GET NUMBER OF ASST EXT'S      */
         ST    @11,ASSTEXT                                         0155
*           ASPAEXCT=ZERO;          /* ZERO THE COUNT OF ASST EXT'S
*                                      ANCHORED IN ASPCT BASE        */
         STH   @14,ASPAEXCT(,@12)                                  0156
*           ASPLEXCT=ZERO;          /* ZERO THE COUNT OF LPME EXT'S
*                                      ANCHORED IN ASST EXT'S        */
         STH   @14,ASPLEXCT(,@12)                                  0157
*           DO I=1 TO 4 BY 1;       /* ZERO THE OLD POINTER TO       */
         LR    I,@08                                               0158
@DL00158 DS    0H                                                  0159
*             ASPASSTP(I)=ZERO;     /* ASST EXTENSIONS               */
         LR    @12,I                                               0159
         SLA   @12,2                                               0159
         SLR   @11,@11                                             0159
         L     @08,ASPCTPTR                                        0159
         ST    @11,ASPASSTP-4(@12,@08)                             0159
*           END;                                                   0160
         AL    I,@CF00098                                          0160
         C     I,@CF00063                                          0160
         BNH   @DL00158                                            0160
*           EPABASP=ZERO;           /* ZERO RECOVERY'S PTR TO I/O  0161
*                                      BUFFER                        */
         L     @12,EPAPTR                                          0161
         SLR   @11,@11                                             0161
         ST    @11,EPABASP(,@12)                                   0161
*           EPARASP=BUFFER;         /* RECORD PTR TO ASPCT BASE      */
         L     @11,BUFFER                                          0162
         ST    @11,EPARASP(,@12)                                   0162
         EJECT
*                                                                  0163
*/********************************************************************/
*/*                                                                  */
*/*  PROCESS ASST EXTENSIONS                                         */
*/*                                                                  */
*/********************************************************************/
*                                                                  0163
*           DO WHILE ASSTEXT^=ZERO; /* LOOP UNTIL WE HAVE RETRIEVED
*                                      ALL ASST EXTENSIONS           */
         B     @DE00163                                            0163
@DL00163 DS    0H                                                  0164
*             EXTNUMB=EXTNUMB+ONE;  /* INCREMENT THE VSAM KEY        */
         LA    @12,1                                               0164
         AL    @12,EXTNUMB                                         0164
         ST    @12,EXTNUMB                                         0164
*             CALL GETONE;          /* RETRIEVE AN ASST EXTENSION    */
         BAL   @14,GETONE                                          0165
*             RFY                                                  0166
*               R15 RSTD;                                          0166
*             IF R15=ZERO           /* SUCCESSFUL RETRIEVAL?         */
*               THEN                                               0167
         LTR   R15,R15                                             0167
         BNZ   @RF00167                                            0167
*               DO;                 /* YES                           */
*                 RFY                                              0169
*                   R15 UNRSTD;                                    0169
*                 ASPEXPTR=BUFFER;  /* SAVE PTR TO ASST EXTENSION    */
         L     @12,BUFFER                                          0170
         ST    @12,ASPEXPTR                                        0170
*                 DO I=1 TO ASPNASST BY 1;/* ZERO THE OLD POINTER TO */
         LA    I,1                                                 0171
@DL00171 DS    0H                                                  0172
*                   ASPSECTA(I)=ZERO;/* THE LPME EXTENSIONS          */
         LR    @12,I                                               0172
         SLA   @12,2                                               0172
         SLR   @11,@11                                             0172
         L     @08,ASPEXPTR                                        0172
         ST    @11,ASPSECTA-4(@12,@08)                             0172
*                 END;                                             0173
         AL    I,@CF00098                                          0173
         C     I,@CF00150                                          0173
         BNH   @DL00171                                            0173
*                 EPABASP=ZERO;     /* ZERO RECOVERY'S POINTER TO I/O
*                                      BUFFER                        */
         L     @12,EPAPTR                                          0174
         SLR   @11,@11                                             0174
         ST    @11,EPABASP(,@12)                                   0174
*                 ASPASSTP(BASE)=BUFFER;/* ANCHOR ASST EXT IN BASE   */
         L     @12,ASPCTPTR                                        0175
         L     @11,BASE                                            0175
         LR    @08,@11                                             0175
         SLA   @08,2                                               0175
         L     @07,BUFFER                                          0175
         ST    @07,ASPASSTP-4(@08,@12)                             0175
*                 ASPAEXCT=ASPAEXCT+ONE;/* INCREMENT THE ASST EXT  0176
*                                      COUNT IN BASE                 */
         LA    @08,1                                               0176
         LH    @07,ASPAEXCT(,@12)                                  0176
         ALR   @07,@08                                             0176
         STH   @07,ASPAEXCT(,@12)                                  0176
*                 ASSTEXT=ASSTEXT-ONE;/* DECREMENT THE INTERNAL ASST
*                                      EXTENSION COUNT               */
         L     @12,ASSTEXT                                         0177
         BCTR  @12,0                                               0177
         ST    @12,ASSTEXT                                         0177
*                 IF LPMEXT>=ASPNLPME/* MORE THAN ONE ASST EXT?      */
*                   THEN            /* YES                           */
         L     @12,LPMEXT                                          0178
         C     @12,@CF00150                                        0178
         BL    @RF00178                                            0178
*                   IF BASE=ONE     /* IS THIS THE FIRST ASST EXT    */
*                     THEN          /* YES                           */
         CR    @11,@08                                             0179
         BNE   @RF00179                                            0179
*                     LPMECNTL=ASPNLPME-ONE;/* ALLOW FOR LPME'S IN 0180
*                                      THE BASE                      */
         MVC   LPMECNTL(4),@CF01539                                0180
*                   ELSE            /* NO IT'S NOT FIRST ASST EXT    */
*                     LPMECNTL=ASPNLPME;/* SET LPME LOOP CONTROL FOR
*                                      MAXIMUM NUMBER LPME EXTS      */
         B     @RC00179                                            0181
@RF00179 MVC   LPMECNTL(4),@CF00150                                0181
*                 ELSE              /* NO, ONLY ONE ASST EXT         */
*                   LPMECNTL=LPMEXT;/* SET LOOP CONTROL FOR NUMBER OF
*                                      LPME EXTENSIONS               */
         B     @RC00178                                            0182
@RF00178 L     @12,LPMEXT                                          0182
         ST    @12,LPMECNTL                                        0182
*                 LPMEXT=LPMEXT-LPMECNTL;/* DECREMENT LPME EXT COUNT
*                                      BY NUMBER PROCESSED THIS TIME
*                                      THRU LOOP                     */
@RC00178 L     @12,LPMEXT                                          0183
         SL    @12,LPMECNTL                                        0183
         ST    @12,LPMEXT                                          0183
*                 BASE=BASE+ONE;    /* INCREMENT BASE SUBSCRIPT      */
         LA    @12,1                                               0184
         AL    @12,BASE                                            0184
         ST    @12,BASE                                            0184
         EJECT
*                                                                  0185
*/********************************************************************/
*/*                                                                  */
*/*  PROCESS LPME EXTENSIONS                                         */
*/*                                                                  */
*/********************************************************************/
*                                                                  0185
*                 DO WHILE LPMECNTL^=ZERO;/* LOOP THRU RETRIEVING ALL
*                                      LPME EXTENSIONS FOR THIS ASST
*                                      EXTENSION                     */
         B     @DE00185                                            0185
@DL00185 DS    0H                                                  0186
*                   EXTNUMB=EXTNUMB+ONE;/* INCREMENT THE VSAM KEY    */
         LA    @12,1                                               0186
         AL    @12,EXTNUMB                                         0186
         ST    @12,EXTNUMB                                         0186
*                   CALL GETONE;    /* RETRIEVE AN LPME EXTENSION    */
         BAL   @14,GETONE                                          0187
*                   RFY                                            0188
*                     R15 RSTD;                                    0188
*                   IF R15=ZERO     /* SUCCESSFUL RETRIEVAL?         */
*                     THEN                                         0189
         SLR   @14,@14                                             0189
         CR    R15,@14                                             0189
         BNE   @RF00189                                            0189
*                     DO;           /* YES                           */
*                       RFY                                        0191
*                         R15 UNRSTD;                              0191
*                       EPABASP=ZERO;/* ZERO RECOVERY'S POINTER TO 0192
*                                      I/O BUFFER                    */
         L     @12,EPAPTR                                          0192
         ST    @14,EPABASP(,@12)                                   0192
*                       ASPASSTE(ASST)=BUFFER;/* ANCHOR THE LPME   0193
*                                      EXTENSION IN ASST EXTENSION   */
         L     @12,ASST                                            0193
         LR    @11,@12                                             0193
         SLA   @11,2                                               0193
         L     @08,BUFFER                                          0193
         L     @07,ASPEXPTR                                        0193
         ST    @08,ASPASSTE-4(@11,@07)                             0193
*                       ASPLEXCT=ASPLEXCT+ONE;/* INCREMENT LPME EXT
*                                      COUNT IN ASPCT BASE           */
         L     @11,ASPCTPTR                                        0194
         LA    @08,1                                               0194
         LH    @07,ASPLEXCT(,@11)                                  0194
         ALR   @07,@08                                             0194
         STH   @07,ASPLEXCT(,@11)                                  0194
*                       LPMECNTL=LPMECNTL-ONE;/* DECREMENT INTERNAL
*                                      LPME LOOP CONTROL             */
         L     @11,LPMECNTL                                        0195
         BCTR  @11,0                                               0195
         ST    @11,LPMECNTL                                        0195
*                       ASST=ASST+ONE;/* INCREMENT ASST SUBSCRIPT    */
         ALR   @12,@08                                             0196
         ST    @12,ASST                                            0196
*                     END;                                         0197
         EJECT
*                                                                  0198
*/********************************************************************/
*/* PROCESS AN ERROR RETURN FROM GETONE FOR LPME EXTENSIONS.         */
*/********************************************************************/
*                                                                  0198
*                   ELSE                                           0198
*                     DO;                                          0198
         B     @RC00189                                            0198
@RF00189 DS    0H                                                  0199
*                       RFY                                        0199
*                         R15 RSTD;                                0199
*                       RETCODE=R15;/* SAVE THE RETURN CODE          */
         ST    R15,RETCODE                                         0200
*                       RFY                                        0201
*                         R15 UNRSTD;                              0201
*                       RFY                                        0202
*                         R8 RSTD;                                 0202
*                       R8=R13;     /* SAVE SAVEAREA POINTER GET   0203
*                                      LOCAL LOCK FOR ILRAFS00       */
         LR    R8,R13                                              0203
*                       GENERATE SETS(R11,R12,R13,R14);            0204
GET1     SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,RELATED=(VIO,           *
               ILRVSAMI(REL2))
*                       R13=R8;     /* RESTORE SAVEAREA POINTER      */
         LR    R13,R8                                              0205
*                       RFY                                        0206
*                         R8 UNRSTD;                               0206
*                       IF RETCODE^=STORAGE/* WAS AN I/O BUFFER    0207
*                                      OBTAINED?                     */
*                         THEN                                     0207
         CLC   RETCODE(4),@CF00122                                 0207
         BE    @RF00207                                            0207
*                         DO;       /* YES                           */
*                           EPABASP=ZERO;/* ZERO RECOVERY'S POINTER
*                                      TO I/O BUFFER                 */
         L     @12,EPAPTR                                          0209
         SLR   @11,@11                                             0209
         ST    @11,EPABASP(,@12)                                   0209
*                           ASPASSTE(ASST)=BUFFER;/* ANCHOR BUFFER IN
*                                      ASST EXT ILRAFS00 WILL BE USED
*                                      TO FREE THE BUFFER AND THE  0210
*                                      REST OF THE RETRIEVED CHAIN   */
         L     @12,ASST                                            0210
         SLA   @12,2                                               0210
         L     @11,BUFFER                                          0210
         L     @08,ASPEXPTR                                        0210
         ST    @11,ASPASSTE-4(@12,@08)                             0210
*                           ASPLEXCT=ASPLEXCT+ONE;/* INCREMENT LPME
*                                      EXT COUNT IN BASE             */
         L     @12,ASPCTPTR                                        0211
         LA    @11,1                                               0211
         AH    @11,ASPLEXCT(,@12)                                  0211
         STH   @11,ASPLEXCT(,@12)                                  0211
*                         END;                                     0212
*                       ELSE                                       0213
*                         ;                                        0213
@RF00207 DS    0H                                                  0214
*                       LPMECNTL=ZERO;/* FORCE LPME LOOP EXIT        */
         SLR   @12,@12                                             0214
         ST    @12,LPMECNTL                                        0214
*                       ASSTEXT=ZERO;/* FORCE ASST LOOP EXIT         */
         ST    @12,ASSTEXT                                         0215
*                     END;                                         0216
*                 END;              /* PHYSICAL END OF DO WHILE LOOP
*                                      FOR LPME EXTENSIONS           */
@RC00189 DS    0H                                                  0217
@DE00185 L     @12,LPMECNTL                                        0217
         LTR   @12,@12                                             0217
         BNZ   @DL00185                                            0217
*                 ASST=ONE;         /* RESET ASST SUBSCRIPT          */
         MVC   ASST(4),@CF00098                                    0218
*               END;                /* END PROCESSING FOR RETURN CODE
*                                      ZERO FROM GETONE FOR ASST   0219
*                                      EXTENSIONS                    */
         EJECT
*                                                                  0220
*/********************************************************************/
*/*  PROCESS NON-ZERO RETURN FROM GETONE  FOR ASST EXTENSIONS        */
*/********************************************************************/
*                                                                  0220
*             ELSE                                                 0220
*               DO;                                                0220
         B     @RC00167                                            0220
@RF00167 DS    0H                                                  0221
*                 RFY                                              0221
*                   R15 RSTD;                                      0221
*                 RETCODE=R15;      /* SAVE THE RETURN CODE          */
         ST    R15,RETCODE                                         0222
*                 RFY                                              0223
*                   R15 UNRSTD;                                    0223
*                 RFY                                              0224
*                   R8 RSTD;                                       0224
*                 R8=R13;           /* SAVE SAVEAREA POINTER GET   0225
*                                      LOCAL LOCK FOR ILRAFS00       */
         LR    R8,R13                                              0225
*                 GENERATE SETS(R11,R12,R13,R14);                  0226
GET2     SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,RELATED=(VIO,           *
               ILRVSAMI(REL2))
*                 R13=R8;           /* RESTORE SAVEAREA POINTER      */
         LR    R13,R8                                              0227
*                 RFY                                              0228
*                   R8 UNRSTD;                                     0228
*                 IF RETCODE^=STORAGE/* DID WE OBTAIN I/O BUFFER?    */
*                   THEN                                           0229
         CLC   RETCODE(4),@CF00122                                 0229
         BE    @RF00229                                            0229
*                   DO;             /* YES                           */
*                     EPABASP=ZERO; /* ZERO RECOVERY'S POINTER TO I/O
*                                      BUFFER                        */
         L     @12,EPAPTR                                          0231
         SLR   @11,@11                                             0231
         ST    @11,EPABASP(,@12)                                   0231
*                     RFY                                          0232
*                      (R0,                                        0232
*                       R1,                                        0232
*                       R3,                                        0232
*                       R4,                                        0232
*                       R7) RSTD;                                  0232
*                     R0=TWOK;      /* SET LENGTH FOR 2K I/O BUF     */
         LA    R0,2048                                             0233
*                     R1=BUFFER;    /* GET ADDR OF BUFFER TO FREE    */
         L     R1,BUFFER                                           0234
*                     R4=PSATOLD;   /* GET PTR TO CURRENT TCB        */
         L     R4,PSATOLD                                          0235
*                     R7=PSAAOLD;   /* GET PTR TO CURRENT ASCB       */
         L     R7,PSAAOLD                                          0236
*                     GENERATE REFS(R0,R1,R4,R7) SETS(R3);         0237
               FREEMAIN RC,SP=230,A=(1),LV=(0),BRANCH=YES
*                     RFY                                          0238
*                      (R0,                                        0238
*                       R1,                                        0238
*                       R3,                                        0238
*                       R4,                                        0238
*                       R7) UNRSTD;                                0238
*                   END;                                           0239
*                 ELSE                                             0240
*                   ;                                              0240
@RF00229 DS    0H                                                  0241
*                 ASSTEXT=ZERO;     /* FORCE EXIT FROM ASST LOOP     */
         SLR   @12,@12                                             0241
         ST    @12,ASSTEXT                                         0241
*               END;                                               0242
*           END;                    /* PHYSICAL END OF DO WHILE LOOP
*                                      FOR ASST EXTENSIONS           */
@RC00167 DS    0H                                                  0243
@DE00163 L     @12,ASSTEXT                                         0243
         LTR   @12,@12                                             0243
         BNZ   @DL00163                                            0243
*         END;                      /* END OF EXTENSION PROCESSING   */
*     END;                          /* END FOR THEN DO GROUP FOR A 0245
*                                      ZERO RETURN CODE FROM GETONE
*                                      FOR THE ASPCT BASE            */
         EJECT
*                                                                  0246
*/********************************************************************/
*/* PROCESS A NON-ZERO RETURN CODE FROM GETONE FOR THE ASPCT BASE    */
*/********************************************************************/
*                                                                  0246
*   ELSE                                                           0246
*     DO;                                                          0246
         B     @RC00145                                            0246
@RF00145 DS    0H                                                  0247
*       RFY                                                        0247
*         R15 RSTD;                                                0247
*       RETCODE=R15;                /* SAVE THE RETURN CODE          */
         ST    R15,RETCODE                                         0248
*       RFY                                                        0249
*         R15 UNRSTD;                                              0249
*       IF RETCODE^=STORAGE         /* DID WE OBTAIN I/O BUFFER?     */
*         THEN                                                     0250
         L     @12,RETCODE                                         0250
         C     @12,@CF00122                                        0250
         BE    @RF00250                                            0250
*         DO;                       /* YES                           */
*           RFY                                                    0252
*            (R0,                                                  0252
*             R1,                                                  0252
*             R3,                                                  0252
*             R4,                                                  0252
*             R7,                                                  0252
*             R8) RSTD;                                            0252
*           R8=R13;                 /* SAVE SAVEAREA POINTER GET   0253
*                                      LOCAL LOCK                    */
         LR    R8,R13                                              0253
*           GENERATE SETS(R3,R11,R12,R13,R14) REFS(EPAPTR);        0254
GET3     SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,RELATED=(VIO,           *
               ILRVSAMI(REL1))
*
         LR    R13,R8                     RESTORE SAVEAREA POINTER
         L     R4,EPAPTR                  GET ADDRESS OF EPATH
         SLR   R7,R7
         ST    R7,EPABASP(R4)             ZERO RECOVERYS POINTER TO
*                                         THE I/O BUFFER
         LA    R0,2048                    SET LENGTH FOR 2K BUFFER
         L     R1,BUFFER                  GET ADDR OF I/O BUFFER
         L     R4,PSATOLD                 GET PTR TO CURRENT TCB
         L     R7,PSAAOLD                 GET PTR TO CURRENT ASCB
         FREEMAIN RC,SP=230,A=(1),LV=(0),BRANCH=YES
*
REL1     SETLOCK RELEASE,TYPE=LOCAL,RELATED=(VIO,ILRVSAMI(GET3))
*           R13=R8;                 /* RESTORE SAVEAREA POINTER      */
         LR    R13,R8                                              0255
*           RFY                                                    0256
*            (R0,                                                  0256
*             R1,                                                  0256
*             R3,                                                  0256
*             R4,                                                  0256
*             R7,                                                  0256
*             R8) UNRSTD;                                          0256
*         END;                                                     0257
*     END;                                                         0258
@RF00250 DS    0H                                                  0259
         EJECT
*                                                                  0259
*/********************************************************************/
*/*  IF WE ENCOUNTERED ANY PROBLEMS WHILE TRYING TO RETRIEVE AN      */
*/*  ASPCT BASE AND ITS ASST AND LPME EXTENSIONS, THIS SECTION WILL  */
*/*  FREE ALL THE 2K I/O BUFFERS OBTAINED                            */
*/********************************************************************/
*                                                                  0259
*   IF RETCODE^=ZERO&RETASPCT^=ZERO /* WAS A NON-ZERO RETURN CODE  0259
*                                      SAVED AND WERE THERE        0259
*                                      EXTENSIONS?                   */
*     THEN                                                         0259
@RC00145 SLR   @12,@12                                             0259
         C     @12,RETCODE                                         0259
         BE    @RF00259                                            0259
         L     @11,RETASPCT                                        0259
         CR    @11,@12                                             0259
         BE    @RF00259                                            0259
*     DO;                           /* YES                           */
*       RFY                                                        0261
*        (R0,                                                      0261
*         R1) RSTD;                                                0261
*       EPARASP=ZERO;               /* ZERO RECOVERY'S POINTER TO THE
*                                      I/O BUFFER CHAIN              */
         L     @08,EPAPTR                                          0262
         ST    @12,EPARASP(,@08)                                   0262
*       R1=RETASPCT;                /* GET ADDR OF ASPCT BASE        */
         LR    R1,@11                                              0263
*       R0=TWOK;                    /* SET LENGTH FOR 2K BUFFERS     */
         LA    R0,2048                                             0264
*       CALL ILRAFS00;              /* FREE THE I/O BUFFER CHAIN     */
         BAL   @14,ILRAFS00                                        0265
*       RFY                                                        0266
*        (R8,                                                      0266
*         R15) RSTD;                                               0266
*       R8=R13;                     /* SAVE SAVEAREA POINTER RELEASE
*                                      THE LOCAL LOCK WHICH WAS    0267
*                                      OBTAINED DURING THE ERROR   0267
*                                      PROCESSING FOR ASST OR LPME 0267
*                                      EXTENSIONS                    */
         LR    R8,R13                                              0267
*       GENERATE SETS(R11,R12,R13,R14);                            0268
REL2     SETLOCK RELEASE,TYPE=LOCAL,RELATED=(VIO,ILRVSAMI(GET1))
*       R13=R8;                     /* RESTORE SAVEAREA POINTER      */
         LR    R13,R8                                              0269
*       RFY                                                        0270
*         R8 UNRSTD;                                               0270
*       IF R15^=ZERO                /* WAS ILRAFS00 SUCCESSFUL?      */
*         THEN                                                     0271
         LTR   R15,R15                                             0271
         BZ    @RF00271                                            0271
*         DO;                       /* NO, RECORD THE ERROR          */
*           STM(R0,R14,SAVREGSA);   /* SAVE REGS FOR RECOVERY        */
         STM   R0,R14,SAVREGSA                                     0273
*           GEN(ABEND X'87',,,SYSTEM);                             0274
         ABEND X'87',,,SYSTEM
*         END;                                                     0275
*       RETASPCT=ZERO;              /* ZERO PTR TO ASPCT BASE        */
@RF00271 SLR   @14,@14                                             0276
         ST    @14,RETASPCT                                        0276
*     END;                                                         0277
*   RFY                                                            0278
*     R14 RSTD;                                                    0278
@RF00259 DS    0H                                                  0279
*   R14=RETADDR1;                   /* GET RETURN ADDRESS            */
         L     R14,RETADDR1                                        0279
*   R15=RETCODE;                    /* LOAD INTERNAL RETURN CODE     */
         L     R15,RETCODE                                         0280
*   RETURN;                         /* RETURN TO MAINLINE            */
@EL00002 DS    0H                                                  0281
@EF00002 DS    0H                                                  0281
@ER00002 BR    @14                                                 0281
*   RFY                                                            0282
*    (R0,                                                          0282
*     R1,                                                          0282
*     R14,                                                         0282
*     R15) UNRSTD;                                                 0282
*   END;                            /* END GETASPCT                  */
         EJECT
*                                                                  0284
*/********************************************************************/
*/*                                                                  */
*/*  PUTASPCT: WRITE AN ASPCT OUT TO SYS1.STGINDEX                   */
*/*                                                                  */
*/*  INPUT:    THE INPUT PARAMETER LIST                              */
*/*              WORD 1 = 02 OP-CODE                                 */
*/*              WORD 2 = PTR TO THE ASPCT BASE                      */
*/*              WORD 3 = PTR TO THE EPATH                           */
*/*                                                                  */
*/*  PROCESS:  SAVE THE RETURN ADDRESS. COPY THE KEY FROM THE ASPCT  */
*/*            BASE TO THE WORKAREA KEY. CALL PUTONE TO WRITE THE    */
*/*            ASPCT BASE OUT TO SYS1.STGINDEX. IF THERE ARE NO      */
*/*            EXTENSIONS, ZERO THE EPATH POINTER TO THE I/O BUFFER  */
*/*            AND FREEMAIN THE I/O BUFFER. RETURN TO MAINLINE.      */
*/*            SAVE THE NUMBER OF LPME AND ASST EXTENSIONS. GET THE  */
*/*            POINTER TO AN ASST EXTENSION. COPY THE KEY TO THE     */
*/*            WORKAREA KEY. CALL PUTONEA TO WRITE THE ASST EXTENSION*/
*/*            OUT. NOW GET THE POINTER TO THE LPME EXTENSION. LOOP  */
*/*            THROUGH ALL LPME EXTENSIONS FOR THIS ASST EXTENSION,  */
*/*            CALLING PUTONEA TO WRITE EACH EXTENSION OUT. ONCE     */
*/*            WE HAVE WRITTEN ALL THE LPME EXTENSIONS FOR THIS ASST */
*/*            EXTENSION, LOOP BACK AND GET THE NEXT ASST EXTENSION. */
*/*            ONCE ALL EXTENSIONS HAVE BEEN WRITTEN, FREEMAIN THE   */
*/*            I/O BUFFER AND RETURN TO MAINLINE.                    */
*/*            IF ANY OF THE WRITES FAIL, ALL RECORDS ALREADY WRITTEN*/
*/*            ARE ERASED FROM SYS1.STGINDEX                         */
*/*                                                                  */
*/*  OUTPUT:   THE ASPCT BASE AND ALL OF ITS EXTENSIONS HAVE BEEN    */
*/*            WRITTEN OUT TO SYS1.STGINDEX                          */
*/*                                                                  */
*/********************************************************************/
*/*PUTASPCT: CHART (AREF,SEQ)                                        */
*/*HEADER                                                          0284
*/* PUTASPCT: WRITE AN ASPCT OUT TO SYS1.STGINDEX                    */
*/*PUTASPCT: E ENTRY                                                 */
*/*         P  SAVE THE RETURN ADDRESS                               */
*/*         P  SET WORKAREA KEY FOR ASPCT BASE                       */
*/*         P  LOAD REG 1 WITH PTR TO BASE                           */
*/*         S  PUTONE: WRITE BASE TO STGINDEX                        */
*/*         D  (YES,%VSM13,NO,) ZERO RETURN CODE?                    */
*/*         P  SAVE THE RETURN CODE                                  */
*/*         D  (YES,,NO,%VSM12) STORAGE OBTAINED?                    */
*/*         L  SETLOCK: UNCOND OBTAIN LOCAL LOCK                     */
*/*         P  ZERO THE EPATH PTR TO I/O BUFFER                      */
*/*         P  LOAD REGISTERS FOR FREEMAIN                           */
*/*         S  FREEMAIN: FREE THE BUFFER                             */
*/*         L  SETLOCK: UNCOND RELEASE LOCAL LOCK                    */
*/*%VSM12:  D  (YES,,NO,%VSM12A) INTERNAL RETURN CODE 24?            */
*/*         P  SET RETURN CODE TO 20                                 */
*/*         P  SET STGINDEX FULL FLAG                                */
*/*%VSM12A: R  RETURN TO MAINLINE                                    */
*/*%VSM13:  D  (YES,%VSM14,NO,) ANY EXTENSIONS?                      */
*/*         L  SETLOCK: UNCOND OBTAIN LOCAL LOCK                     */
*/*         P  ZERO EPATH PTR TO I/O BUFFER                          */
*/*         P  LOAD REGISTERS FOR FREEMAIN                           */
*/*         S  FREEMAIN: FREE THE I/O BUFFER                         */
*/*         L  SETLOCK: UNCOND RELEASE LOCAL LOCK                    */
*/*         R  RETURN TO MAINLINE                                    */
*/*%VSM14:  P  SAVE THE LPME EXT COUNTER (ASPLEXCT)                  */
*/*         P  SAVE THE ASST EXT COUNTER (ASPAEXCT)                  */
*/*%VSM15:  P  GET PTR TO AN ASST EXT FROM BASE (ASPASSTP)           */
*/*         P  SET WORKAREA KEY FOR ASST EXTENSION                   */
*/*         P  LOAD REG 1 WITH PTR TO ASST EXTENSION                 */
*/*         S  PUTONEA: WRITE ASST EXT TO STGINDEX                   */
*/*         D  (YES,,NO,%VSM19) ZERO RETURN CODE?                    */
*/*         P  DECREMENT THE ASST EXT COUNTER                        */
*/*%VSM16:  P  LOAD REG 1 WITH PTR TO LPME EXT FROM ASST EXT         */
*/*         P  SET WORKAREA KEY FOR LPME EXTENSION                   */
*/*         S  PUTONEA: WRITE LPME EXT TO STGINDEX                   */
*/*         D  (YES,,NO,%VSM19) ZERO RETURN CODE?                    */
*/*         P  DECREMENT THE LPME EXT COUNTER                        */
*/*         D  (YES,%VSM17,NO,) LPME EXT COUNTER = 0?                */
*/*         P  INCREMENT THE ASST ARRAY SUBSCRIPT                    */
*/*         D  (YES,,NO,%VSM16) REACHED END OF ARRAY?                */
*/*         P  RESET SUBSCRIPT TO BEGINNING OF ARRAY                 */
*/*%VSM17:  D  (YES,%VSM18,NO,) ASST EXT COUNTER = 0?                */
*/*         P  INCREMENT THE BASE ARRAY SUBSCRIPT                    */
*/*         D  (YES,,NO,%VSM15) REACHED END OF ARRAY?                */
*/*%VSM18:  L  SETLOCK: UNCOND OBTAIN LOCAL LOCK                     */
*/*         P  LOAD REGISTERS FOR FREEMAIN                           */
*/*         P  ZERO PTR TO BUFFER IN EPATH                           */
*/*         S  FREEMAIN: FREE THE BUFFER                             */
*/*         L  SETLOCK: UNCOND RELEASE LOCAL LOCK                    */
*/*         P  LOAD INTERNAL RETURN CODE                             */
*/*         D  (YES,,NO,%VSM18A) INTERNAL RETURN CODE 24?            */
*/*         P  SET THE STGINDEX FULL FLAG                            */
*/*         P  SET RETURN CODE TO 20                                 */
*/*%VSM18A: R  RETURN TO MAINLINE                                    */
*/*%VSM19:  P  CALCULATE THE NUMBER OF ASST EXT WRITTEN              */
*/*         P  CALCULATE THE NUMBER OF LPME EXT WRITTEN              */
*/*         P  SET WORKAREA KEY FOR BASE                             */
*/*         P  LOAD REG FOR ERASE                                    */
*/*         S  ERASE: THE ASPCT BASE                                 */
*/*%VSM20:  D  (YES,%VSM21,NO,) ASST EXT COUNT ZERO?                 */
*/*         P  SET WORKAREA KEY                                      */
*/*         P  LOAD REG FOR ERASE                                    */
*/*         S  ERASE: AN ASST EXTENSION                              */
*/*         P  (,%VSM20) DECREMENT THE ASST COUNT                    */
*/*%VSM21:  P  RESET WKA KEY FOR BASE                                */
*/*         P  INCREMENT KEY BY ONE                                  */
*/*%VSM22:  D  (YES,%VSM18,NO,) LPME EXT COUNT ZERO?                 */
*/*         P  INCREMENT THE WKA KEY                                 */
*/*         P  LOAD REG FOR ERASE                                    */
*/*         S  ERASE: AN LPME EXTENSION                              */
*/*         P  DECREMENT THE LPME EXT COUNT                          */
*/*         P  INCREMENT ARRAY COUNTER                               */
*/*         D  (YES,,NO,%VSM22) REACHED END OF AN ASST ARRAY?        */
*/*         P  RESET ARRAY COUNTER                                   */
*/*         P  (,%VSM22) INCREMENT WKA KEY                           */
*/*PUTASPCT: END                                                     */
*                                                                  0284
         EJECT
*PUTASPCT:                                                         0284
*   PROCEDURE OPTIONS(NOSAVE,NOSAVEAREA);                          0284
PUTASPCT DS    0H                                                  0285
*   RFY                                                            0285
*     R14 RSTD;                                                    0285
*   RETADDR1=R14;                   /* SAVE THE RETURN ADDRESS       */
         ST    R14,RETADDR1                                        0286
*   RFY                                                            0287
*     R14 UNRSTD;                                                  0287
*                                                                  0287
*/****************************************************************** */
*/* BUILD THE WRITE KEY FOR VSAM, AND CALL PUTONE TO WRITE THE       */
*/* ASPCT BASE OUT TO SYS1.STGINDEX.                                 */
*/****************************************************************** */
*                                                                  0288
*   ASPCTPTR=BASEPTR;               /* GET PTR TO ASPCT BASE FROM  0288
*                                      INPUT PARM LIST               */
         L     @12,PARMPTR                                         0288
         L     @12,BASEPTR(,@12)                                   0288
         ST    @12,ASPCTPTR                                        0288
*   WKAVKEY=ASPBKEY;                /* SET WORKAREA VSAM KEY TO THE
*                                      VSAM KEY IN ASPCT BASE        */
         MVC   WKAVKEY(12),ASPBKEY(@12)                            0289
*   RETCODE=ZERO;                   /* INIT INTERNAL RETURN CODE TO
*                                      ZERO                          */
         SLR   @11,@11                                             0290
         ST    @11,RETCODE                                         0290
*   BACKOUT=OFF;                    /* INIT ERROR FLAG AS OFF        */
         NI    BACKOUT,B'01111111'                                 0291
*   EPARPLB=OFF;                    /* SET RPL BUILT FLAG OFF        */
         L     @11,EPAPTR                                          0292
         NI    EPARPLB(@11),B'11111110'                            0292
*   RFY                                                            0293
*     R1 RSTD;                                                     0293
*   R1=ASPCTPTR;                    /* GET PTR TO ASPCT BASE         */
         LR    R1,@12                                              0294
*   CALL PUTONE;                    /* WRITE THE ASPCT BASE OUT TO 0295
*                                      SYS1.STGINDEX                 */
         BAL   @14,PUTONE                                          0295
         EJECT
*                                                                  0296
*/****************************************************************** */
*/* IF THE BASE WAS SUCCESSFULLY WRITTEN, AND THERE ARE              */
*/* EXTENSIONS.                                                      */
*/****************************************************************** */
*                                                                  0296
*   RFY                                                            0296
*     R15 RSTD;                                                    0296
*   IF R15=ZERO                     /* WAS WRITE SUCCESSFUL?         */
*     THEN                                                         0297
         SLR   @14,@14                                             0297
         CR    R15,@14                                             0297
         BNE   @RF00297                                            0297
*     DO;                           /* YES                           */
*       RFY                                                        0299
*        (R1,                                                      0299
*         R15) UNRSTD;                                             0299
*       IF ASPAEXCT^=ZERO           /* ARE THERE ANY EXTENSIONS?     */
*         THEN                                                     0300
         L     @12,ASPCTPTR                                        0300
         LH    @11,ASPAEXCT(,@12)                                  0300
         CR    @11,@14                                             0300
         BE    @RF00300                                            0300
*         DO;                       /* YES                           */
         EJECT
*                                                                  0302
*/********************************************************************/
*/*                                                                  */
*/*      PROCESS  EXTENSIONS                                         */
*/*                                                                  */
*/********************************************************************/
*                                                                  0302
*           LPMEXT=ASPLEXCT;        /* GET NUMBER OF LPME EXTS       */
         LH    @12,ASPLEXCT(,@12)                                  0302
         ST    @12,LPMEXT                                          0302
*           ASSTEXT=ASPAEXCT;       /* GET NUMBER OF ASST EXTS       */
         ST    @11,ASSTEXT                                         0303
*           ASSTCNTL=ASSTEXT;       /* SET ASST LOOP CONTROLLER      */
         ST    @11,ASSTCNTL                                        0304
*           BASE=ONE;               /* INIT BASE ARRAY SUBSCRIPT     */
         MVC   BASE(4),@CF00098                                    0305
*           ASST=TWO;               /* INIT ASST ARRAY SUBSCRIPT     */
         MVC   ASST(4),@CF00114                                    0306
*/********************************************************************/
*/*  PROCESS  ASST  EXTENSIONS                                       */
*/********************************************************************/
*                                                                  0307
*           DO WHILE ASSTCNTL^=ZERO;/* LOOP UNTIL ALL ASST EXTENSIONS
*                                      ARE PROCESSED                 */
         B     @DE00307                                            0307
@DL00307 DS    0H                                                  0308
*             ASPEXPTR=ASPASSTP(BASE);/* GET PTR TO ASST EXTENSION   */
         L     @12,ASPCTPTR                                        0308
         L     @11,BASE                                            0308
         SLA   @11,2                                               0308
         L     @11,ASPASSTP-4(@11,@12)                             0308
         ST    @11,ASPEXPTR                                        0308
*             ASPESSYM=ASPSSYM;     /* MOVE 'S' SYM TO ASST EXTENSION*/
         MVC   ASPESSYM(8,@11),ASPSSYM(@12)                        0309
*             WKAVKEY=ASPEXKEY;     /* COPY VSAM KEY TO WORKAREA     */
         MVC   WKAVKEY(12),ASPEXKEY(@11)                           0310
*             RFY                                                  0311
*               R1 RSTD;                                           0311
*             R1=ASPEXPTR;          /* GET PTR TO ASST EXTENSION     */
         LR    R1,@11                                              0312
*             CALL PUTONEA;         /* WRITE THE ASST EXTENSION OUT
*                                      TO SYS1.STGINDEX              */
         BAL   @14,PUTONEA                                         0313
*             RFY                                                  0314
*               R15 RSTD;                                          0314
*             IF R15=ZERO           /* WAS WRITE SUCCESSFUL?         */
*               THEN                                               0315
         LTR   R15,R15                                             0315
         BNZ   @RF00315                                            0315
*               DO;                 /* YES                           */
*                 RFY                                              0317
*                  (R1,                                            0317
*                   R15) UNRSTD;                                   0317
*                 ASSTCNTL=ASSTCNTL-ONE;/* DECREMENT LOOP CONTROLLER */
         L     @12,ASSTCNTL                                        0318
         BCTR  @12,0                                               0318
         ST    @12,ASSTCNTL                                        0318
*                 ASSTEXT=ASSTEXT-ONE;/* DECREMENT ASST EXT COUNT    */
         L     @12,ASSTEXT                                         0319
         BCTR  @12,0                                               0319
         ST    @12,ASSTEXT                                         0319
*                 IF LPMEXT>=ASPNLPME/* MORE THAN ONE ASST EXT?      */
*                   THEN            /* YES                           */
         L     @12,LPMEXT                                          0320
         C     @12,@CF00150                                        0320
         BL    @RF00320                                            0320
*                   IF BASE=ONE     /* IS THIS FIRST ASST EXT        */
*                     THEN          /* YES,ALLOW FOR LPMES IN BASE   */
         CLC   BASE(4),@CF00098                                    0321
         BNE   @RF00321                                            0321
*                     LPMECNTL=ASPNLPME-ONE;                       0322
         MVC   LPMECNTL(4),@CF01539                                0322
*                   ELSE            /* NO, SET FOR FULL ASST EXT     */
*                     LPMECNTL=ASPNLPME;                           0323
         B     @RC00321                                            0323
@RF00321 MVC   LPMECNTL(4),@CF00150                                0323
*                 ELSE              /* NO, ONLY PARTIAL ASST EXT     */
*                   LPMECNTL=LPMEXT;                               0324
         B     @RC00320                                            0324
@RF00320 L     @12,LPMEXT                                          0324
         ST    @12,LPMECNTL                                        0324
*                 BASE=BASE+ONE;    /* INCREMENT BASE SUBSCRIPT      */
@RC00320 LA    @12,1                                               0325
         AL    @12,BASE                                            0325
         ST    @12,BASE                                            0325
         EJECT
*                                                                  0326
*/********************************************************************/
*/*  PROCESS  LPME  EXTENSIONS                                       */
*/********************************************************************/
*                                                                  0326
*                 DO WHILE LPMECNTL^=ZERO;/* LOOP UNTIL ALL LPME'S 0326
*                                      HAVE BEEN PROCESSED FOR THIS
*                                      ASST EXTENSION                */
         B     @DE00326                                            0326
@DL00326 DS    0H                                                  0327
*                   ASPASSTE(ASST)->ASPESSYM=ASPSSYM;/* MOVE 'S' SYM
*                                      TO LPME EXTENSION             */
         L     @12,ASST                                            0327
         SLA   @12,2                                               0327
         L     @11,ASPEXPTR                                        0327
         L     @12,ASPASSTE-4(@12,@11)                             0327
         L     @11,ASPCTPTR                                        0327
         MVC   ASPESSYM(8,@12),ASPSSYM(@11)                        0327
*                   WKAVKEY=ASPASSTE(ASST)->ASPEXKEY;/* COPY VSAM KEY
*                                      FROM LPME EXT TO WORKAREA     */
         MVC   WKAVKEY(12),ASPEXKEY(@12)                           0328
*                   RFY                                            0329
*                     R1 RSTD;                                     0329
*                   R1=ASPASSTE(ASST);/* GET PTR TO LPME EXTENSION   */
         LR    R1,@12                                              0330
*                   CALL PUTONEA;   /* WRITE THE LPME EXTENSION OUT
*                                      TO SYS1.STGINDEX              */
         BAL   @14,PUTONEA                                         0331
*                   RFY                                            0332
*                     R15 RSTD;                                    0332
*                   IF R15=ZERO     /* WRITE SUCCESSFUL?             */
*                     THEN                                         0333
         LTR   R15,R15                                             0333
         BNZ   @RF00333                                            0333
*                     DO;           /* YES                           */
*                       RFY                                        0335
*                        (R1,                                      0335
*                         R15) UNRSTD;                             0335
*                       LPMECNTL=LPMECNTL-ONE;/* DECREMENT LOOP    0336
*                                      CONTROLLER                    */
         L     @12,LPMECNTL                                        0336
         BCTR  @12,0                                               0336
         ST    @12,LPMECNTL                                        0336
*                       LPMEXT=LPMEXT-ONE;/* DECREMENT LPME EXT COUNT*/
         L     @12,LPMEXT                                          0337
         BCTR  @12,0                                               0337
         ST    @12,LPMEXT                                          0337
*                       ASST=ASST+ONE;/* INCREMENT ASST SUBSCRIPT    */
         LA    @12,1                                               0338
         L     @11,ASST                                            0338
         ALR   @11,@12                                             0338
         ST    @11,ASST                                            0338
*                       IF ASST>ASPNASST/* REACHED END OF ARRAY?     */
*                         THEN      /* YES                           */
         C     @11,@CF00150                                        0339
         BNH   @RF00339                                            0339
*                         ASST=ONE; /* RESET FOR NEXT ARRAY          */
         ST    @12,ASST                                            0340
*                     END;                                         0341
         EJECT
*                                                                  0342
*/********************************************************************/
*/* PROCESS A NON-ZERO RETURN CODE FROM PUTONEA FOR LPME EXTENSIONS  */
*/********************************************************************/
*                                                                  0342
*                   ELSE                                           0342
*                     DO;                                          0342
         B     @RC00333                                            0342
@RF00333 DS    0H                                                  0343
*                       RFY                                        0343
*                         R15 RSTD;                                0343
*                       RETCODE=R15;/* SAVE THE RETURN CODE          */
         ST    R15,RETCODE                                         0344
*                       RFY                                        0345
*                         R15 UNRSTD;                              0345
*                       LPMECNTL=ZERO;/* FORCE LPME LOOP EXIT        */
         SLR   @12,@12                                             0346
         ST    @12,LPMECNTL                                        0346
*                       ASSTCNTL=ZERO;/* FORCE ASST LOOP EXIT        */
         ST    @12,ASSTCNTL                                        0347
*                       BACKOUT=ON; /* INDICATE WE HAD AN ERROR AND
*                                      BACKOUT PROCESSING REQ        */
         OI    BACKOUT,B'10000000'                                 0348
*                     END;                                         0349
*                 END;              /* END PROCESSING OF LPME EXTS   */
@RC00333 DS    0H                                                  0350
@DE00326 L     @12,LPMECNTL                                        0350
         LTR   @12,@12                                             0350
         BNZ   @DL00326                                            0350
*               END;                                               0351
         EJECT
*                                                                  0352
*/********************************************************************/
*/* PROCESS A NON-ZERO RETURN CODE FROM PUTONEA FOR ASST EXTENSIONS  */
*/********************************************************************/
*                                                                  0352
*             ELSE                                                 0352
*               DO;                                                0352
         B     @RC00315                                            0352
@RF00315 DS    0H                                                  0353
*                 RFY                                              0353
*                   R15 RSTD;                                      0353
*                 RETCODE=R15;      /* SAVE THE RETURN CODE          */
         ST    R15,RETCODE                                         0354
*                 RFY                                              0355
*                   R15 UNRSTD;                                    0355
*                 ASSTCNTL=ZERO;    /* FORCE ASST LOOP EXIT          */
         SLR   @12,@12                                             0356
         ST    @12,ASSTCNTL                                        0356
*                 BACKOUT=ON;       /* INDICATE WE HAD AN ERROR AND
*                                      BACKOUT PROCESSING REQ        */
         OI    BACKOUT,B'10000000'                                 0357
*               END;                                               0358
*           END;                    /* END ASST EXT PROCESSING       */
@RC00315 DS    0H                                                  0359
@DE00307 L     @12,ASSTCNTL                                        0359
         LTR   @12,@12                                             0359
         BNZ   @DL00307                                            0359
*         END;                      /* END EXTENSION PROCESSING      */
*     END;                                                         0361
         EJECT
*                                                                  0362
*/********************************************************************/
*/* PROCESS A NON-ZERO RETURN CODE FROM PUTONE FOR ASPCT BASE        */
*/********************************************************************/
*                                                                  0362
*   ELSE                                                           0362
*     DO;                                                          0362
         B     @RC00297                                            0362
@RF00297 DS    0H                                                  0363
*       RFY                                                        0363
*         R15 RSTD;                                                0363
*       RETCODE=R15;                /* SAVE THE RETURN CODE          */
         ST    R15,RETCODE                                         0364
*       IF EPARPLB=ON THEN                                         0365
         L     @14,EPAPTR                                          0365
         TM    EPARPLB(@14),B'00000001'                            0365
         BNO   @RF00365                                            0365
*         BACKOUT=ON;               /* INDICATE WE HAD AN ERROR AND
*                                      BACKOUT PROCESSING REQ        */
         OI    BACKOUT,B'10000000'                                 0366
*       RFY                                                        0367
*         R15 UNRSTD;                                              0367
@RF00365 DS    0H                                                  0368
*     END;                                                         0368
         EJECT
*                                                                  0369
*/********************************************************************/
*/*                                                                  */
*/* THIS SECTION WILL PERFORM ALL NECESSARY BACKOUT LOGIC. IF WE     */
*/* COULD NOT WRITE AN ASPCT BASE AND ALL ITS EXTENSIONS OUT, WE     */
*/* HAVE TO ERASE THOSE RECORDS WHICH WERE WRITTEN OUT TO AVOID      */
*/* LOSING SLOTS ON SYS1.STGINDEX.                                   */
*/*                                                                  */
*/********************************************************************/
*                                                                  0369
*   IF BACKOUT=ON                   /* WAS THERE AN ERROR?           */
*     THEN                                                         0369
@RC00297 TM    BACKOUT,B'10000000'                                 0369
         BNO   @RF00369                                            0369
*     DO;                           /* YES                           */
*       RFY                                                        0371
*        (R5,                                                      0371
*         R7) RSTD;                                                0371
*       R5=RPLPTR;                  /* OBTAIN RPL ADDR               */
         L     R5,RPLPTR                                           0372
*       R7=ADDR(RECADDR);           /* ADDR AREA TO STORE ADDR OF  0373
*                                      RECORD LOCATED                */
         LA    R7,RECADDR                                          0373
*       GEN(MODCB RPL=(5),OPTCD=(LOC,UPD),AREALEN=4,AREA=(7));/*   0374
*                                      CHANGE MVE AND NUP OPTIONS TO
*                                      LOC AND UPD                   */
         MODCB RPL=(5),OPTCD=(LOC,UPD),AREALEN=4,AREA=(7)
*       DO WHILE EXTNUMB>=ZERO;     /* WORK BACKWARDS ERASING ALL  0375
*                                      EXTENSIONS WRITTEN OUT        */
         B     @DE00375                                            0375
@DL00375 DS    0H                                                  0376
*         GEN(GET RPL=(5));         /* GET THE RECORD                */
         GET RPL=(5)
*         GEN(ERASE RPL=(5));       /* ERASE THE RECORD              */
         ERASE RPL=(5)
*         EXTNUMB=EXTNUMB-ONE;      /* DECREMENT KEY                 */
         L     @12,EXTNUMB                                         0378
         BCTR  @12,0                                               0378
         ST    @12,EXTNUMB                                         0378
*       END;                                                       0379
@DE00375 L     @12,EXTNUMB                                         0379
         LTR   @12,@12                                             0379
         BNM   @DL00375                                            0379
*       RFY                                                        0380
*        (R5,                                                      0380
*         R7) UNRSTD;                                              0380
*     END;                                                         0381
*   ELSE                                                           0382
*     ;                                                            0382
@RF00369 DS    0H                                                  0383
         EJECT
*   IF BUFFER^=ZERO                 /* WAS AN I/O BUFFER OBTAINED?   */
*     THEN                                                         0383
         L     @12,BUFFER                                          0383
         LTR   @12,@12                                             0383
         BZ    @RF00383                                            0383
*     DO;                           /* YES, FREE BUFFER STORAGE      */
*       RFY                                                        0385
*        (R0,                                                      0385
*         R1,                                                      0385
*         R3,                                                      0385
*         R4,                                                      0385
*         R7,                                                      0385
*         R8) RSTD;                                                0385
*       R8=R13;                     /* SAVE SAVEAREA POINTER OBTAIN
*                                      THE LOCAL LOCK                */
         LR    R8,R13                                              0386
*       GENERATE SETS(R3,R11,R12,R13,R14) REFS(EPAPTR);            0387
GET5     SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,RELATED=(VIO,           *
               ILRVSAMI(REL4))
         LR    R13,R8                     RESTORE SAVEAREA POINTER
         L     R4,EPAPTR                  GET ADDRESS OF EPATH
         SLR   R7,R7
         ST    R7,EPABASP(R4)             ZERO RECOVERY POINTER TO
*                                         THE I/O BUFFER
         LA    R0,2048                    SET BUFFER LENGTH OF 2K
         L     R1,BUFFER                  SET FREEMAIN ADDRESS
         L     R4,PSATOLD                 GET CURRENT TCB ADDRESS
         L     R7,PSAAOLD                 GET CURRENT ASCB ADDRESS
         FREEMAIN RC,A=(1),LV=(0),SP=230,BRANCH=YES
*
REL4     SETLOCK RELEASE,TYPE=LOCAL,RELATED=(VIO,ILRVSAMI(GET5))
*       R13=R8;                     /* RESTORE SAVEAREA POINTER      */
         LR    R13,R8                                              0388
*       RFY                                                        0389
*        (R0,                                                      0389
*         R1,                                                      0389
*         R3,                                                      0389
*         R4,                                                      0389
*         R7,                                                      0389
*         R8) UNRSTD;                                              0389
*     END;                                                         0390
*   ELSE                                                           0391
*     ;                                                            0391
@RF00383 DS    0H                                                  0392
*   IF RETCODE=NOROOM               /* IS STGINDEX FULL?             */
*     THEN                                                         0392
         CLC   RETCODE(4),@CF00141                                 0392
         BNE   @RF00392                                            0392
*     DO;                           /* YES                           */
*       ASMNOSAV=ON;                /* INDICATE SAVING OF VIO ASPCTS
*                                      IS SUSPENDED UNTIL SLOTS ARE
*                                      RELEASED ON SYS1.STGINDEX     */
         L     @12,ASMVTWPT                                        0394
         OI    ASMNOSAV(@12),B'01000000'                           0394
*       RETCODE=TWENTY;                                            0395
         MVC   RETCODE(4),@CF00120                                 0395
*     END;                                                         0396
*   RFY                                                            0397
*    (R14,                                                         0397
*     R15) RSTD;                                                   0397
@RF00392 DS    0H                                                  0398
*   R15=RETCODE;                    /* LOAD INTERNAL RETURN CODE     */
         L     R15,RETCODE                                         0398
*   R14=RETADDR1;                   /* GET RETURN ADDRESS            */
         L     R14,RETADDR1                                        0399
*   END PUTASPCT;                                                  0400
@EL00003 DS    0H                                                  0400
@EF00003 DS    0H                                                  0400
@ER00003 BR    @14                                                 0400
*   RFY                                                            0401
*    (R14,                                                         0401
*     R15) UNRSTD;                                                 0401
         EJECT
*                                                                  0402
*/********************************************************************/
*/*                                                                  */
*/*  RETERASE: RETRIEVE AND ERASE AN ASPCT                           */
*/*                                                                  */
*/*  INPUT:    THE INPUT PARAMETER LIST                              */
*/*              WORD 1 = 03 OR 04 OP-CODE                           */
*/*              WORD 2 = PTR TO 8-BYTE 'S' SYMBOL                   */
*/*              WORD 3 = PTR TO THE EPATH                           */
*/*                                                                  */
*/*  PROCESS:  SAVE THE RETURN ADDRESS. COPY THE 'S' SYMBOL TO THE   */
*/*            WORKAREA KEY. CALL GETONE TO RETRIEVE THE ASPCT BASE. */
*/*            ISSUE AN ERASE OF THE ASPCT BASE. IF THERE ARE NO     */
*/*            EXTENSIONS RETURN TO MAINLINE.                        */
*/*            SAVE THE NUMBER OF LPME AND ASST EXTENSIONS. ZERO     */
*/*            THESE COUNTS AND THE POINTERS TO THE ASST EXTENSIONS  */
*/*            IN THE ASPCT BASE. RECORD THE POINTER TO THE ASPCT    */
*/*            BASE IN THE EPATH. INCREMENT THE WORKAREA KEY FOR AN  */
*/*            ASST EXTENSION. CALL GETONE TO RETRIEVE AN ASST EXT.  */
*/*            ZERO THE POINTERS TO THE LPME EXTENSIONS IN THE ASST  */
*/*            EXT. STORE POINTER TO ASST EXT. IN THE BASE. ISSUE AN */
*/*            ERASE OF THE ASST EXT. NOW LOOP THROUGH RETRIEVING AND*/
*/*            ERASING THE LPME EXTS FOR THIS ASST EXT. GETONE IS    */
*/*            USED TO RETRIEVE EACH LPME EXT. POINTERS TO THE LPME  */
*/*            EXTS ARE STORED IN THE ASST EXT. ONCE ALL LPME EXT.   */
*/*            HAVE BEEN READ FOR THIS ASST EXT. LOOP BACK AND       */
*/*            RETRIEVE THE NEXT ASST EXT. ONCE ALL EXTENSIONS HAVE  */
*/*            BEEN RETRIEVED AND ERASED, RETURN TO MAINLINE.        */
*/*            IF EITHER A GET OR AN ERASE REQUEST FAIL, AND THIS IS */
*/*            A 03 REQUEST, THE STORAGE USED FOR THE RETRIEVED ASPCT*/
*/*            BASE AND THOSE EXTENSIONS WHICH HAVE BEEN RETRIEVED   */
*/*            IS FREED.                                             */
*/*            IF EITHER A GET OR AN ERASE REQUEST FAIL, AND THIS IS */
*/*            A 04 REQUEST, THE REMAINING EXTENSIONS ARE ERASED FROM*/
*/*            SYS1.STGINDEX, AND WHATEVER WAS RETRIEVED IS RETURNED */
*/*            TO THE CALLER.                                        */
*/*                                                                  */
*/*  OUTPUT:   THE ASPCT BASE AND ALL ITS EXTENSIONS HAS BEEN        */
*/*            RETRIEVED AND THEN ERASED FROM SYS1.STGINDEX.         */
*/*                                                                  */
*/********************************************************************/
*/*RETERASE: CHART (AREF,SEQ)                                        */
*/*HEADER                                                          0402
*/* RETERASE: RETRIEVED & ERASE ASPCT'S FROM SYS1.STGINDEX           */
*/*RETERASE: E ENTRY                                                 */
*/*         P  SAVE THE RETURN ADDRESS                               */
*/*         P  SET WORKAREA KEY FOR BASE                             */
*/*         S  GETONE: RETRIEVE THE BASE                             */
*/*         D  (YES,%VSM23A,NO,) ZERO RETURN CODE?                   */
*/*         P  SAVE THE RETURN CODE                                  */
*/*         D  (YES,,NO,%VSM23) STORAGE OBTAINED?                    */
*/*         L  SETLOCK: UNCOND OBTAIN LOCAL LOCK                     */
*/*         P  ZERO THE EPATH PTR TO I/O BUFFER                      */
*/*         P  LOAD REGISTERS FOR FREEMAIN                           */
*/*         S  FREEMAIN: FREE THE BASE BUFFER                        */
*/*         L  SETLOCK: UNCOND RELEASE LOCAL LOCK                    */
*/*%VSM23:  P  LOAD REG 15 WITH INTERNAL RETURN CODE                 */
*/*         R  RETURN TO MAINLINE                                    */
*/*%VSM23A: P ZERO RETRY COUNTER                                     */
*/*%VSM24:  P  LOAD REG FOR ERASE                                    */
*/*         S  ERASE: THE BASE ASPCT                                 */
*/*         D  (YES,%VSM25,NO,) ZERO RETURN CODE?                    */
*/*         S  SHOWCB: LOOK AT ERROR                                 */
*/*         D  (YES,,NO,%VSM24A) RETRY POSSIBLE?                     */
*/*         P  INCREMENT THE RETRY COUNTER                           */
*/*         D  (YES,,NO,%VSM24) REACHED MAXIMUM RETRY?               */
*/*%VSM24A: P  SET INTERNAL RETURN CODE TO 4                         */
*/*%VSM25:  D  (YES,%VSM26,NO,) ANY EXTENSIONS?                      */
*/*         P  ZERO THE EPATH PTR TO I/O BUFFER                      */
*/*         P  LOAD REG 15 WITH INTERNAL RETURN CODE                 */
*/*         R  RETURN TO MAINLINE                                    */
*/*%VSM26:  P  SAVE THE ASST EXT COUNTER (ASPAEXCT)                  */
*/*         P  ZERO THE ASST EXT COUNTER IN BASE                     */
*/*         P  SAVE THE LPME EXT COUNTER (ASPLEXCT)                  */
*/*         P  ZERO THE LPME EXT COUNTER IN BASE                     */
*/*         P  ZERO THE ASST PTR ARRAY IN BASE                       */
*/*         P  RECORD PTR TO BUFFER IN EPATH                         */
*/*         P  ZERO EPATH PTR TO I/O BUFFER                          */
*/*%VSM27:  P  SET WORKAREA KEY FOR ASST EXT                         */
*/*         S  GETONE : RETRIEVE AN ASST EXTENSION                   */
*/*         D  (YES,%VSM34,NO,) ZERO RETURN CODE?                    */
*/*         D  (YES,%VSM30,NO,) IS THIS A RLG REQUEST?               */
*/*         L  SETLOCK: UNCOND OBTAIN LOCAL LOCK                     */
*/*         D  (YES,,NO,%VSM28) STORAGE OBTAINED?                    */
*/*         P  ZERO EPATH PTR TO I/O BUFFER                          */
*/*         P  LOAD REGISTERS FOR FREEMAIN                           */
*/*         S  FREEMAIN: FREE THE ASST BUFFER                        */
*/*%VSM28:  P  ZERO BUFFER PTR IN EPATH                              */
*/*         P  LOAD REG 1 WITH PTR TO BUFFER BASE                    */
*/*         P  SET REG 0 TO LENGTH OF BUFFER                         */
*/*         S  ILRAFS00: FREE THE BUFFERS                            */
*/*         P  SAVE THE RETURN CODE                                  */
*/*         L  SETLOCK: UNCOND RELEASE LOCAL LOCK                    */
*/*         D  (YES,%VSM29,NO,) ZERO RETURN CODE?                    */
*/*         S  ABEND: 087                                            */
*/*%VSM29:  P  LOAD REG 15 WITH INTERNAL RETURN CODE                 */
*/*         R  RETURN TO MAINLINE                                    */
*/*%VSM30:  D  (YES,,NO,%VSM31) STORAGE OBTAINED?                    */
*/*         P  (,%VSM34) MAKE BUFFER LOOK LIKE ASST EXT              */
*/*%VSM31:  P  LOAD REG FOR ERASE                                    */
*/*         S  ERASE: AN ASST EXTENSION                              */
*/*         P  DECREMENT ASST EXT COUNTER                            */
*/*         P  SET ARRAY COUNTER                                     */
*/*%VSM32:  P  INCREMENT THE WKA KEY                                 */
*/*         P  LOAD REG FOR ERASE                                    */
*/*         S  ERASE: AN LPME EXTENSION                              */
*/*         P  DECREMENT LPME EXT COUNTER                            */
*/*         P  INCREMENT THE ARRAY COUNTER                           */
*/*         D  (YES,,NO,%VSM33) LPME EXT COUNT ZERO?                 */
*/*         P  SET RETURN CODE TO 20                                 */
*/*         R  RETURN TO MAINLINE                                    */
*/*%VSM33:  D  (YES,,NO,%VSM32) REACHED END OF ARRAY?                */
*/*         P  (,%VSM31) INCREMENT THE WORKAREA KEY                  */
*/*%VSM34:  P  ZERO THE ASST EXT ARRAY                               */
*/*         P  STORE PTR TO ASST EXT IN BASE ARRAY                   */
*/*         P  ZERO THE EPATH PTR TO I/O BUFFER                      */
*/*         P  INCREMENT ASST EXT COUNTER IN BASE                    */
*/*         P  DECREMENT ASST EXT COUNTER                            */
*/*         P  ZERO RETRY COUNTER                                    */
*/*%VSM35:  P  LOAD REG FOR ERASE                                    */
*/*         S  ERASE: AN ASST EXTENSION                              */
*/*         D  (YES,%VSM36,NO,) ZERO RETURN CODE?                    */
*/*         S  SHOWCB: DETERMINE ERROR                               */
*/*         D  (YES,,NO,%VSM35A) RETRY POSSIBLE?                     */
*/*         P  INCREMENT THE RETRY COUNTER                           */
*/*         D  (YES,,NO,%VSM35) REACHED MAXIMUM RETRY?               */
*/*%VSM35A: P  SET INTERNAL RETURN CODE TO 4                         */
*/*%VSM36:  P  SET WKA KEY FOR LPME EXT                              */
*/*         S  GETONE : RETRIEVE AN LPME EXTENSION                   */
*/*         D  (YES,%VSM41,NO,) ZERO RETURN CODE?                    */
*/*         L  SETLOCK: UNCOND OBTAIN LOCAL LOCK                     */
*/*         D  (YES,%VSM39,NO,) IS THIS A RLG REQUEST?               */
*/*         D  (YES,,NO,%VSM37) STORAGE OBTAINED?                    */
*/*         P  STORE PTR TO LPME EXT IN ASST ARRAY                   */
*/*         P  ZERO THE EPATH PTR TO I/O BUFFER                      */
*/*         P  INCREMENT LPME EXT COUNTER IN BASE                    */
*/*%VSM37:  P  ZERO PTR TO BUFFER IN EPATH                           */
*/*         P  LOAD REG 1 WITH PTR TO BASE BUFFER                    */
*/*         P  SET REG 0 TO LENGTH OF BUFFER                         */
*/*         S  ILRAFS00: FREE THE BUFFERS                            */
*/*         P  SAVE THE RETURN CODE                                  */
*/*         L  SETLOCK: UNCOND RELEASE LOCAL LOCK                    */
*/*         D  (YES,%VSM38,NO,) ZERO RETURN CODE?                    */
*/*         S  ABEND: 087                                            */
*/*%VSM38:  P  LOAD REG 15 WITH INTERNAL RETURN CODE                 */
*/*         R  RETURN TO MAINLINE                                    */
*/*%VSM39:  D  (YES,,NO,%VSM40) STORAGE OBTAINED?                    */
*/*         P  ZERO THE EPATH PTR TO I/O BUFFER                      */
*/*         P  LOAD REGISTERS FOR FREEMAIN                           */
*/*         S  FREEMAIN: FREE THE LPME BUFFER                        */
*/*%VSM40:  L  SETLOCK: UNCOND RELEASE LOCAL LOCK                    */
*/*         P  DECREMENT LPME EXT COUNTER                            */
*/*         D  (YES,%VSM45,NO,%VSM44) LPME EXT COUNTER ZERO?         */
*/*%VSM41:  P  STORE PTR TO LPME BUFFER IN ASST ARRAY                */
*/*         P  ZERO THE EPATH PTR TO I/O BUFFER                      */
*/*         P  INCREMENT LPME EXT COUNTER IN BASE                    */
*/*         P  DECREMENT THE LPME EXT COUNTER                        */
*/*         P  ZERO THE RETRY COUNTER                                */
*/*%VSM42:  P  LOAD REG FOR ERASE                                    */
*/*         S  ERASE: AN LPME EXTENSION                              */
*/*         D  (YES,%VSM43,NO,) ZERO RETURN CODE?                    */
*/*         S  SHOWCB: DETERMINE ERROR                               */
*/*         D  (YES,,NO,%VSM42A) RETRY POSSIBLE?                     */
*/*         P  INCREMENT THE RETRY COUNTER                           */
*/*         D  (YES,,NO,%VSM42) REACHED MAXIMUM RETRY?               */
*/*%VSM42A: P  SET INTERNAL RETURN CODE TO 4                         */
*/*%VSM43:  D  (YES,%VSM45,NO,) LPME EXT COUNTER ZERO?               */
*/*         P  INCREMENT THE ASST EXT ARRAY SUBSCRIPT                */
*/*%VSM44:  D  (YES,,NO,%VSM36) REACHED END OF ASST EXT ARRAY?       */
*/*         P  RESET ASST EXT ARRAY SUBSCRIPT                        */
*/*%VSM45:  D  (YES,%VSM46,NO,) ASST EXT COUNTER ZERO?               */
*/*         P  INCREMENT THE BASE ARRAY SUBSCRIPT                    */
*/*         D  (YES,,NO,%VSM27) REACHED END OF BASE ARRAY?           */
*/*%VSM46:  P  LOAD REG 15 WITH INTERNAL RETURN CODE                 */
*/*         R  RETURN TO MAINLINE                                    */
*/*RETERASE: END                                                     */
*                                                                  0402
         EJECT
*RETERASE:                                                         0402
*   PROCEDURE OPTIONS(NOSAVE,NOSAVEAREA);                          0402
RETERASE DS    0H                                                  0403
*   RFY                                                            0403
*     R14 RSTD;                                                    0403
*   RETADDR1=R14;                   /* SAVE THE RETURN ADDRESS       */
         ST    R14,RETADDR1                                        0404
*   RFY                                                            0405
*     R14 UNRSTD;                                                  0405
*   WKAKEY=SSYM;                    /* COPY THE 'S' SYMBOL TO WKA    */
         L     @12,PARMPTR                                         0406
         L     @12,SSYMPTR(,@12)                                   0406
         MVC   WKAKEY(8),SSYM(@12)                                 0406
*   EXTNUMB=ZERO;                   /* SET LAST PART OF VSAM KEY FOR
*                                      AN ASPCT BASE                 */
         SLR   @12,@12                                             0407
         ST    @12,EXTNUMB                                         0407
*   RETCODE=ZERO;                   /* INIT INTERNAL RETURN CODE     */
         ST    @12,RETCODE                                         0408
*   MAXEXTN=ZERO;                   /* CLEAR MAXIMUM EXTENSION NUMBER*/
         ST    @12,MAXEXTN                                         0409
*   PARTIALF=OFF;                   /* RESET THE PARTIAL RETRIEVED 0410
*                                      FLAG                          */
         NI    PARTIALF,B'10111111'                                0410
*   EPARPLB=OFF;                    /* SET RPL BUILT FLAG OFF        */
         L     @12,EPAPTR                                          0411
         NI    EPARPLB(@12),B'11111110'                            0411
*   BACKOUT=OFF;                    /* SET BACKOUT ERROR FLAG OFF    */
         NI    BACKOUT,B'01111111'                                 0412
*   CALL GETONE;                    /* RETRIEVE THE ASPCT BASE       */
         BAL   @14,GETONE                                          0413
*   RFY                                                            0414
*     R15 RSTD;                                                    0414
*   IF R15=ZERO                     /* WAS RETRIEVAL SUCCESSFUL?     */
*     THEN                                                         0415
         LTR   R15,R15                                             0415
         BNZ   @RF00415                                            0415
*     DO;                           /* YES                           */
*       RFY                                                        0417
*         R15 UNRSTD;                                              0417
*       ASPCTPTR=BUFFER;            /* SAVE PTR TO ASPCT BASE        */
         L     @12,BUFFER                                          0418
         ST    @12,ASPCTPTR                                        0418
*       RETASPCT=BUFFER;            /* ANCHOR PTR TO ASPCT BASE      */
         ST    @12,RETASPCT                                        0419
*       CALL ERASES;                /* ERASE THE BASE RECORD FROM  0420
*                                      SYS1.STGINDEX                 */
         BAL   @14,ERASES                                          0420
         EJECT
*                                                                  0421
*/********************************************************************/
*/*                                                                  */
*/*  PROCESS  ALL  ASST  AND  LPME  EXTENSIONS                       */
*/*                                                                  */
*/********************************************************************/
*                                                                  0421
*       IF ASPAEXCT^=ZERO           /* ARE THERE ANY EXTENSIONS?     */
*         THEN                                                     0421
         SLR   @12,@12                                             0421
         L     @11,ASPCTPTR                                        0421
         LH    @08,ASPAEXCT(,@11)                                  0421
         CR    @08,@12                                             0421
         BE    @RF00421                                            0421
*         DO;                       /* YES CALCULATE MAXIMUM       0422
*                                      EXTENSION NUMBER              */
*           MAXEXTN=ASPAEXCT+ASPLEXCT;                             0423
         LH    @07,ASPLEXCT(,@11)                                  0423
         LR    @15,@08                                             0423
         ALR   @15,@07                                             0423
         ST    @15,MAXEXTN                                         0423
*           ASSTEXT=ASPAEXCT;       /* GET THE NUMBER OF ASST EXTS   */
         ST    @08,ASSTEXT                                         0424
*           LPMEXT=ASPLEXCT;        /* GET THE NUMBER OF LPME EXTS   */
         ST    @07,LPMEXT                                          0425
*           ASPAEXCT=ZERO;          /* ZERO THE ASST EXT COUNT IN  0426
*                                      ASPCT BASE                    */
         STH   @12,ASPAEXCT(,@11)                                  0426
*           ASPLEXCT=ZERO;          /* ZERO THE LPME EXT COUNT IN  0427
*                                      ASPCT BASE                    */
         STH   @12,ASPLEXCT(,@11)                                  0427
*           BASE=ONE;               /* INIT BASE ARRAY SUBSCRIPT     */
         LA    @12,1                                               0428
         ST    @12,BASE                                            0428
*           ASST=TWO;               /* INIT ASST ARRAY SUBSCRIPT     */
         MVC   ASST(4),@CF00114                                    0429
*           DO I=1 TO 4 BY 1;       /* ZERO THE OLD POINTERS TO      */
         LR    I,@12                                               0430
@DL00430 DS    0H                                                  0431
*             ASPASSTP(I)=ZERO;     /* THE ASST EXTENSIONS           */
         LR    @12,I                                               0431
         SLA   @12,2                                               0431
         SLR   @11,@11                                             0431
         L     @08,ASPCTPTR                                        0431
         ST    @11,ASPASSTP-4(@12,@08)                             0431
*           END;                                                   0432
         AL    I,@CF00098                                          0432
         C     I,@CF00063                                          0432
         BNH   @DL00430                                            0432
*           EPABASP=ZERO;           /* ZERO RECOVERY'S POINTER TO THE
*                                      I/O BUFFER                    */
         L     @12,EPAPTR                                          0433
         SLR   @11,@11                                             0433
         ST    @11,EPABASP(,@12)                                   0433
*           EPARASP=BUFFER;         /* RECORD PTR TO ASPCT BASE      */
         L     @11,BUFFER                                          0434
         ST    @11,EPARASP(,@12)                                   0434
         EJECT
*                                                                  0435
*/********************************************************************/
*/*  PROCESS  ASST  EXTENSIONS                                       */
*/********************************************************************/
*                                                                  0435
*           DO WHILE ASSTEXT^=ZERO; /* LOOP UNTIL ALL ASST EXTS HAVE
*                                      BEEN RETRIEVED AND ERASED     */
         B     @DE00435                                            0435
@DL00435 DS    0H                                                  0436
*             EXTNUMB=EXTNUMB+ONE;  /* INCREMENT THE VSAM KEY        */
         LA    @12,1                                               0436
         AL    @12,EXTNUMB                                         0436
         ST    @12,EXTNUMB                                         0436
*             CALL GETONE;          /* RETRIEVE AN ASST EXTENSION    */
         BAL   @14,GETONE                                          0437
*             RFY                                                  0438
*               R15 RSTD;                                          0438
*             IF R15=ZERO           /* RETRIEVAL SUCCESSFUL?         */
*               THEN                /* YES                           */
         LTR   R15,R15                                             0439
         BNZ   @RF00439                                            0439
*               ASPEXPTR=BUFFER;    /* SAVE PTR TO ASST EXTENSION    */
         L     @14,BUFFER                                          0440
         ST    @14,ASPEXPTR                                        0440
         EJECT
*                                                                  0441
*/********************************************************************/
*/*  PROCESS A NON-ZERO RETURN CODE FROM GETONE  FOR ASST EXTENSIONS */
*/********************************************************************/
*                                                                  0441
*             ELSE                                                 0441
*               DO;                                                0441
         B     @RC00439                                            0441
@RF00439 DS    0H                                                  0442
*                 RETCODE=R15;      /* SAVE THE RETURN CODE          */
         ST    R15,RETCODE                                         0442
*                 RFY                                              0443
*                   R15 UNRSTD;                                    0443
*                 IF OPCODE^=REL    /* IS THIS REQUEST FOR RELEASE   */
*                   THEN                                           0444
         L     @12,PARMPTR                                         0444
         CLI   OPCODE(@12),4                                       0444
         BE    @RF00444                                            0444
*                   DO;             /* NO                            */
*/********************************************************************/
*/* PROCESS FAILURE FOR A NON-RELEASE REQUEST                        */
*/********************************************************************/
*                                                                  0446
*                     RFY                                          0446
*                       R8 RSTD;                                   0446
*                     R8=R13;       /* SAVE SAVEAREA POINTER OBTAIN
*                                      THE LOCAL LOCK                */
         LR    R8,R13                                              0447
*                     GENERATE SETS(R11,R12,R13,R14);              0448
GET6     SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,RELATED=(VIO,           *
               ILRVSAMI(REL5))
*                     R13=R8;       /* RESTORE SAVEAREA POINTER      */
         LR    R13,R8                                              0449
*                     RFY                                          0450
*                       R8 UNRSTD;                                 0450
*                     IF RETCODE^=STORAGE/* WAS AN I/O BUFFER      0451
*                                      OBTAINED?                     */
*                       THEN                                       0451
         CLC   RETCODE(4),@CF00122                                 0451
         BE    @RF00451                                            0451
*                       DO;         /* YES                           */
*                         EPABASP=ZERO;/* ZERO RECOVERY'S POINTER TO */
         L     @12,EPAPTR                                          0453
         SLR   @11,@11                                             0453
         ST    @11,EPABASP(,@12)                                   0453
*                         RFY                                      0454
*                          (R0,                                    0454
*                           R1,                                    0454
*                           R3,                                    0454
*                           R4,                                    0454
*                           R7) RSTD;/* I/O BUFFER                   */
*                         R0=TWOK;  /* SET LENGTH FOR 2K             */
         LA    R0,2048                                             0455
*                         R1=BUFFER;/* GET BUFFER ADDRESS            */
         L     R1,BUFFER                                           0456
*                         R4=PSATOLD;/* GET PTR TO CURRENT TCB       */
         L     R4,PSATOLD                                          0457
*                         R7=PSAAOLD;/* GET PTR TO CURRENT ASCB FREE
*                                      THE I/O BUFFER                */
         L     R7,PSAAOLD                                          0458
*                         GENERATE REFS(R0,R1,R4,R7) SETS(R3);     0459
                    FREEMAIN RC,A=(1),LV=(0),SP=230,BRANCH=YES
*                         RFY                                      0460
*                          (R3,                                    0460
*                           R4,                                    0460
*                           R7) UNRSTD;                            0460
*                       END;                                       0461
*                     ELSE                                         0462
*                       ;                                          0462
@RF00451 DS    0H                                                  0463
*                     EPARASP=ZERO; /* ZERO RECOVERYS PTR            */
         SLR   @12,@12                                             0463
         L     @11,EPAPTR                                          0463
         ST    @12,EPARASP(,@11)                                   0463
*                     RETASPCT=ZERO;/* ZERO PTR TO RETRIEVED ASPCT   */
         ST    @12,RETASPCT                                        0464
*                     R0=TWOK;      /* SET LENGTH FOR 2K             */
         LA    R0,2048                                             0465
*                     R1=ASPCTPTR;  /* GET PTR TO ASPCT BASE         */
         L     R1,ASPCTPTR                                         0466
*                     CALL ILRAFS00;/* FREE THE RETRIEVED ASPCT BASE
*                                      AND THOSE EXTS RETRIEVED      */
         BAL   @14,ILRAFS00                                        0467
*                     RFY                                          0468
*                       R15 RSTD;                                  0468
*                     RFY                                          0469
*                      (R0,                                        0469
*                       R1) UNRSTD;                                0469
*                     RFY                                          0470
*                       R8 RSTD;                                   0470
*                     R8=R13;       /* SAVE SAVEAREA POINTER RELEASE
*                                      THE LOCAL LOCK                */
         LR    R8,R13                                              0471
*                     GENERATE SETS(R11,R12,R13,R14);              0472
REL5           SETLOCK RELEASE,TYPE=LOCAL,RELATED=(VIO,ILRVSAMI(GET6))
*                     R13=R8;       /* RESTORE SAVEAREA POINTER      */
         LR    R13,R8                                              0473
*                     RFY                                          0474
*                       R8 UNRSTD;                                 0474
*                     IF R15^=ZERO  /* WAS ILRAFS00 SUCCESSFUL?      */
*                       THEN                                       0475
         LTR   R15,R15                                             0475
         BZ    @RF00475                                            0475
*                       DO;         /* NO                            */
*                         STM(R0,R14,SAVREGSA);/* SAVE REGS FOR    0477
*                                      RECOVERY                      */
         STM   R0,R14,SAVREGSA                                     0477
*                         GEN(ABEND X'87',,,SYSTEM);/* RECORD THE  0478
*                                      FREEMAIN ERROR                */
         ABEND X'87',,,SYSTEM
*                       END;                                       0479
*                     BACKOUT=ON;   /* SET BACKOUT ERROR FLAG ON     */
@RF00475 OI    BACKOUT,B'10000000'                                 0480
*                     ASSTEXT=ZERO; /* FORCE ASST LOOP EXIT          */
         SLR   @14,@14                                             0481
         ST    @14,ASSTEXT                                         0481
*                     RFY                                          0482
*                       R15 UNRSTD;                                0482
*                   END;                                           0483
         EJECT
*                                                                  0484
*/********************************************************************/
*/* PROCESS FAILURE FOR A RELEASE REQUEST                            */
*/********************************************************************/
*                                                                  0484
*                 ELSE                                             0484
*                   DO;                                            0484
         B     @RC00444                                            0484
@RF00444 DS    0H                                                  0485
*                     IF RETCODE^=STORAGE/* WAS AN I/O BUFFER      0485
*                                      OBTAINED?                     */
*                       THEN                                       0485
         CLC   RETCODE(4),@CF00122                                 0485
         BE    @RF00485                                            0485
*                       DO;         /* YES                           */
*                                                                  0486
*                         /*******************************************/
*                         /*                                         */
*                         /* THIS NEXT SECTION WILL MAKE THE I/O     */
*                         /* BUFFER LOOK LIKE AN ASST EXTENSION.     */
*                         /*                                         */
*                         /*******************************************/
*                                                                  0487
*                         ASPEXPTR=BUFFER;/* SAVE POINTER TO BUFFER  */
         L     @12,BUFFER                                          0487
         ST    @12,ASPEXPTR                                        0487
*                         ASPEIDNT='ASST';/* SET ASST EXT IDENTIFIER */
         MVC   ASPEIDNT(4,@12),@CC01507                            0488
*                         ASPESSYM=ASPSSYM;/* COPY 'S' SYMBOL FROM 0489
*                                      BASE                          */
         L     @11,ASPCTPTR                                        0489
         MVC   ASPESSYM(8,@12),ASPSSYM(@11)                        0489
*                         ASPEXTNM=EXTNUMB;/* SET THE EXTENSION    0490
*                                      NUMBER                        */
         L     @08,EXTNUMB                                         0490
         ST    @08,ASPEXTNM(,@12)                                  0490
*                         ASPASSTN=ASPAEXCT+ONE;/* SET ASST EXT    0491
*                                      NUMBER                        */
         LA    @08,1                                               0491
         AH    @08,ASPAEXCT(,@11)                                  0491
         STC   @08,ASPASSTN(,@12)                                  0491
*                         RETCODE=ZERO;/* RESET INTERNAL RETURN CODE */
         SLR   @12,@12                                             0492
         ST    @12,RETCODE                                         0492
*                       END;                                       0493
         EJECT
*                                                                  0494
*/********************************************************************/
*/* THIS NEXT SECTION WILL ERASE ALL THE LPME EXTENSIONS             */
*/* ASSOCIATED WITH THIS ASST EXTENSION.                             */
*/********************************************************************/
*                                                                  0494
*                     ELSE                                         0494
*                       DO;         /* NO, AN I/O BUFFER WAS NOT   0494
*                                      OBTAINED                      */
         B     @RC00485                                            0494
@RF00485 DS    0H                                                  0495
*                         RFY                                      0495
*                          (R5,                                    0495
*                           R7) RSTD;                              0495
*                         R5=RPLPTR;/* OBTAIN RPL ADDR               */
         L     R5,RPLPTR                                           0496
*                         R7=ADDR(RECADDR);/* ADDR OF AREA TO STORE
*                                      ADDR OF RECORD LOCATED        */
         LA    R7,RECADDR                                          0497
*                         GEN                                      0498
*(MODCB RPL=(5),OPTCD=(LOC),AREALEN=4,AREA=(7));/* CHANGE MVE OPTION
*                                      TO LOCATE                     */
         MODCB RPL=(5),OPTCD=(LOC),AREALEN=4,AREA=(7)
*                         GEN(GET RPL=(5));/* GET THE EXTENSION      */
         GET RPL=(5)
*                         GEN(ERASE RPL=(5));/* ERASE THE ASST     0500
*                                      EXTENSION                     */
         ERASE RPL=(5)
*                         RFY                                      0501
*                          (R5,                                    0501
*                           R7) UNRSTD;                            0501
*                         ASSTEXT=ASSTEXT-ONE;/* DECREMENT ASST EXT
*                                      COUNT                         */
         L     @12,ASSTEXT                                         0502
         BCTR  @12,0                                               0502
         ST    @12,ASSTEXT                                         0502
*                         IF ASPASSTP(1)=ZERO/* WAS THIS FIRST ASST
*                                      EXT?                          */
*                           THEN    /* YES                           */
         L     @12,ASPCTPTR                                        0503
         L     @12,ASPASSTP(,@12)                                  0503
         LTR   @12,@12                                             0503
         BNZ   @RF00503                                            0503
*                           ASST=TWO;/* INIT LOOP CONTROLLER         */
         MVC   ASST(4),@CF00114                                    0504
*                         ELSE      /* NO                            */
*                           ASST=ONE;/* INIT LOOP CONTROLLER         */
         B     @RC00503                                            0505
@RF00503 MVC   ASST(4),@CF00098                                    0505
*                         DO WHILE ASST<=ASPNLPME;/* LOOP ERASING THE
*                                      LPME EXTS FOR THIS ASST EXT   */
@RC00503 B     @DE00506                                            0506
@DL00506 DS    0H                                                  0507
*                           EXTNUMB=EXTNUMB+ONE;/* INCREMENT KEY FOR
*                                      LPME                          */
         LA    @12,1                                               0507
         AL    @12,EXTNUMB                                         0507
         ST    @12,EXTNUMB                                         0507
*                           RFY                                    0508
*                             R5 RSTD;                             0508
*                           R5=RPLPTR;/* OBTAIN RPL ADDR             */
         L     R5,RPLPTR                                           0509
*                           GEN(GET RPL=(5));/* RETRIEVE THE RECORD  */
         GET RPL=(5)
*                           GEN(ERASE RPL=(5));/* ERASE LPME RECORD  */
         ERASE RPL=(5)
*                           RFY                                    0512
*                             R5 UNRSTD;                           0512
*                           LPMEXT=LPMEXT-ONE;/* DECREMENT LPME EXT
*                                      COUNT                         */
         L     @12,LPMEXT                                          0513
         BCTR  @12,0                                               0513
         ST    @12,LPMEXT                                          0513
*                           IF LPMEXT>ZERO/* ANYMORE LPME EXTS?      */
*                             THEN  /* YES, INCREMENT ASST ARRAY     */
         LTR   @12,@12                                             0514
         BNP   @RF00514                                            0514
*                             ASST=ASST+ONE;                       0515
         LA    @12,1                                               0515
         AL    @12,ASST                                            0515
         ST    @12,ASST                                            0515
*                           ELSE    /* NO, FORCE LOOP EXIT           */
*                             ASST=ASPNLPME+ONE;                   0516
         B     @RC00514                                            0516
@RF00514 MVC   ASST(4),@CF01541                                    0516
*                         END;                                     0517
@RC00514 DS    0H                                                  0517
@DE00506 L     @12,ASST                                            0517
         C     @12,@CF00150                                        0517
         BNH   @DL00506                                            0517
*                         RFY                                      0518
*                           R5 RSTD;                               0518
*                         R5=RPLPTR;/* OBTAIN THE RPL ADDR           */
         L     R5,RPLPTR                                           0519
*                         GEN(MODCB RPL=(5),OPTCD=(MVE),AREALEN=2048);
         MODCB RPL=(5),OPTCD=(MVE),AREALEN=2048
*                                   /* CHANGE LOC OPTION BACK TO MOVE*/
*                         RFY                                      0521
*                           R5 UNRSTD;                             0521
*                         PARTIALF=ON;/* INDICATE PARTIAL RETRIEVAL  */
         OI    PARTIALF,B'01000000'                                0522
*                       END;                                       0523
*                   END;            /* FAILURE FOR RELEASE REQUEST   */
@RC00485 DS    0H                                                  0525
*               END;                /* NON-ZERO RETURN CODE FOR ASST
*                                      EXTENSIONS                    */
@RC00444 DS    0H                                                  0526
         EJECT
*                                                                  0526
*/********************************************************************/
*/*  ADD  THE  ASST  EXTENSION  INTO  CHAIN                          */
*/********************************************************************/
*                                                                  0526
*             IF RETCODE=ZERO       /* IS THERE AN ASST EXTENSION    */
*               THEN                                               0526
@RC00439 L     @12,RETCODE                                         0526
         LTR   @12,@12                                             0526
         BNZ   @RF00526                                            0526
*               DO;                 /* YES                           */
*                 DO I=1 TO ASPNASST BY 1;/* ZERO THE OLD PTRS TO  0528
*                                      LPME                          */
         LA    I,1                                                 0528
@DL00528 DS    0H                                                  0529
*                   ASPASSTE(I)=ZERO;/* EXTENSIONS                   */
         LR    @12,I                                               0529
         SLA   @12,2                                               0529
         SLR   @11,@11                                             0529
         L     @08,ASPEXPTR                                        0529
         ST    @11,ASPASSTE-4(@12,@08)                             0529
*                 END;                                             0530
         AL    I,@CF00098                                          0530
         C     I,@CF00150                                          0530
         BNH   @DL00528                                            0530
*                 EPABASP=ZERO;     /* ZERO RECOVERY'S POINTER TO THE
*                                      I/O BUFFER                    */
         L     @12,EPAPTR                                          0531
         SLR   @11,@11                                             0531
         ST    @11,EPABASP(,@12)                                   0531
*                 ASPASSTP(BASE)=BUFFER;/* ANCHOR ASST EXT IN BASE   */
         L     @12,ASPCTPTR                                        0532
         L     @11,BASE                                            0532
         SLA   @11,2                                               0532
         L     @08,BUFFER                                          0532
         ST    @08,ASPASSTP-4(@11,@12)                             0532
*                 ASPAEXCT=ASPAEXCT+ONE;/* INCREMENT ASST EXTENSION
*                                      COUNT IN ASPCT BASE           */
         LA    @11,1                                               0533
         AH    @11,ASPAEXCT(,@12)                                  0533
         STH   @11,ASPAEXCT(,@12)                                  0533
*                 ASSTEXT=ASSTEXT-ONE;/* DECREMENT ASST EXT COUNT    */
         L     @12,ASSTEXT                                         0534
         BCTR  @12,0                                               0534
         ST    @12,ASSTEXT                                         0534
*                 CALL ERASES;      /* ERASE THE ASST EXTENSION FROM
*                                      SYS1.STGINDEX                 */
         BAL   @14,ERASES                                          0535
*                 IF LPMEXT>=ASPNLPME/* MORE THAN ONE ASST EXT       */
*                   THEN            /* YES                           */
         L     @12,LPMEXT                                          0536
         C     @12,@CF00150                                        0536
         BL    @RF00536                                            0536
*                   IF BASE=ONE     /* FIRST ASST EXT?               */
*                     THEN          /* YES, ALLOW FOR LPMES IN BASE  */
         CLC   BASE(4),@CF00098                                    0537
         BNE   @RF00537                                            0537
*                     LPMECNTL=ASPNLPME-ONE;                       0538
         MVC   LPMECNTL(4),@CF01539                                0538
*                   ELSE            /* NO, SET FOR FULL ASST EXT     */
*                     LPMECNTL=ASPNLPME;                           0539
         B     @RC00537                                            0539
@RF00537 MVC   LPMECNTL(4),@CF00150                                0539
*                 ELSE              /* NO,SET FOR NUMBER REMAINING   */
*                   LPMECNTL=LPMEXT;                               0540
         B     @RC00536                                            0540
@RF00536 L     @12,LPMEXT                                          0540
         ST    @12,LPMECNTL                                        0540
*                 LPMEXT=LPMEXT-LPMECNTL;/* DECREMENT FOR THIS LOOP  */
@RC00536 L     @12,LPMEXT                                          0541
         SL    @12,LPMECNTL                                        0541
         ST    @12,LPMEXT                                          0541
*                 BASE=BASE+ONE;    /* INCREMENT BASE SUBSCRIPT      */
         LA    @12,1                                               0542
         AL    @12,BASE                                            0542
         ST    @12,BASE                                            0542
         EJECT
*                                                                  0543
*/********************************************************************/
*/*  PROCESS  LPME  EXTENSIONS                                       */
*/********************************************************************/
*                                                                  0543
*                 DO WHILE LPMECNTL^=ZERO;/* LOOP UNTIL ALL LPME   0543
*                                      EXTENSIONS HAVE BEEN RETRIEVED
*                                      FOR THIS ASST EXTENSION       */
         B     @DE00543                                            0543
@DL00543 DS    0H                                                  0544
*                   EXTNUMB=EXTNUMB+ONE;/* INCREMENT THE VSAM KEY    */
         LA    @12,1                                               0544
         AL    @12,EXTNUMB                                         0544
         ST    @12,EXTNUMB                                         0544
*                   CALL GETONE;    /* RETRIEVE AN LPME EXTENSION  0545
*                                      FROM SYS1.STGINDEX            */
         BAL   @14,GETONE                                          0545
*                   RFY                                            0546
*                     R15 RSTD;                                    0546
*                   IF R15=ZERO     /* RETRIEVAL SUCCESSFUL?         */
*                     THEN                                         0547
         SLR   @14,@14                                             0547
         CR    R15,@14                                             0547
         BNE   @RF00547                                            0547
*                     DO;           /* YES                           */
*                       RFY                                        0549
*                         R15 UNRSTD;                              0549
*                       EPABASP=ZERO;/* ZERO RECOVERY'S POINTER TO 0550
*                                      THE I/O BUFFER                */
         L     @12,EPAPTR                                          0550
         ST    @14,EPABASP(,@12)                                   0550
*                       ASPASSTE(ASST)=BUFFER;/* ANCHOR THE LPME   0551
*                                      EXTENSION IN THE ASST       0551
*                                      EXTENSION                     */
         L     @12,ASST                                            0551
         LR    @11,@12                                             0551
         SLA   @11,2                                               0551
         L     @08,BUFFER                                          0551
         L     @07,ASPEXPTR                                        0551
         ST    @08,ASPASSTE-4(@11,@07)                             0551
*                       ASPLEXCT=ASPLEXCT+ONE;/* INCREMENT LPME    0552
*                                      EXTENSION COUNT IN ASPCT BASE */
         L     @11,ASPCTPTR                                        0552
         LA    @08,1                                               0552
         LH    @07,ASPLEXCT(,@11)                                  0552
         ALR   @07,@08                                             0552
         STH   @07,ASPLEXCT(,@11)                                  0552
*                       ASST=ASST+ONE;/* INCREMENT ASST SUBSCRIPT    */
         ALR   @12,@08                                             0553
         ST    @12,ASST                                            0553
*                       LPMECNTL=LPMECNTL-ONE;/* DECREMENT LPME EXT
*                                      COUNT                         */
         L     @12,LPMECNTL                                        0554
         BCTR  @12,0                                               0554
         ST    @12,LPMECNTL                                        0554
*                       CALL ERASES;/* ERASE THE LPME EXTENSION FROM
*                                      SYS1.STGINDEX                 */
         BAL   @14,ERASES                                          0555
*                     END;                                         0556
         EJECT
*                                                                  0557
*/********************************************************************/
*/* PROCESS A NON-ZERO RETURN CODE FROM GETONE  FOR LPME EXTENSIONS  */
*/********************************************************************/
*                                                                  0557
*                   ELSE                                           0557
*                     DO;                                          0557
         B     @RC00547                                            0557
@RF00547 DS    0H                                                  0558
*                       RFY                                        0558
*                         R15 RSTD;                                0558
*                       RETCODE=R15;/* SAVE THE RETURN CODE          */
         ST    R15,RETCODE                                         0559
*                       RFY                                        0560
*                         R15 UNRSTD;                              0560
*                       RFY                                        0561
*                         R8 RSTD;                                 0561
*                       R8=R13;     /* SAVE SAVEAREA POINTER OBTAIN
*                                      THE LOCAL LOCK                */
         LR    R8,R13                                              0562
*                       GENERATE SETS(R11,R12,R13,R14);            0563
GET7     SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,RELATED=(VIO,           *
               ILRVSAMI(REL6))
*                       R13=R8;     /* RESTORE SAVEAREA POINTER      */
         LR    R13,R8                                              0564
*                       RFY                                        0565
*                         R8 UNRSTD;                               0565
*                       IF OPCODE^=REL/* IS THIS A RELEASE REQUEST?  */
*                         THEN                                     0566
         L     @12,PARMPTR                                         0566
         CLI   OPCODE(@12),4                                       0566
         BE    @RF00566                                            0566
*                         DO;       /* NO                            */
*/********************************************************************/
*/*  PROCESS FAILURE FOR A NON-RELEASE REQUEST                       */
*/********************************************************************/
*                                                                  0568
*                           IF RETCODE^=STORAGE/* I/O BUFFER       0568
*                                      OBTAINED?                     */
*                             THEN                                 0568
         CLC   RETCODE(4),@CF00122                                 0568
         BE    @RF00568                                            0568
*                             DO;   /* YES                           */
*                               EPABASP=ZERO;/* ZERO RECOVERY'S    0570
*                                      POINTER TO THE I/O BUFFER   0570
*                                      ANCHOR BUFFER IN ASST EXT     */
         L     @12,EPAPTR                                          0570
         SLR   @11,@11                                             0570
         ST    @11,EPABASP(,@12)                                   0570
*                               ASPASSTE(ASST)=BUFFER;/* INCREMENT 0571
*                                      LPME EXT COUNT                */
         L     @12,ASST                                            0571
         SLA   @12,2                                               0571
         L     @11,BUFFER                                          0571
         L     @08,ASPEXPTR                                        0571
         ST    @11,ASPASSTE-4(@12,@08)                             0571
*                               ASPLEXCT=ASPLEXCT+ONE;             0572
         L     @12,ASPCTPTR                                        0572
         LA    @11,1                                               0572
         AH    @11,ASPLEXCT(,@12)                                  0572
         STH   @11,ASPLEXCT(,@12)                                  0572
*                             END;                                 0573
*                           ELSE                                   0574
*                             ;                                    0574
@RF00568 DS    0H                                                  0575
*                           RFY                                    0575
*                            (R0,                                  0575
*                             R1) RSTD;                            0575
*                           EPARASP=ZERO;/* ZERO RECOVERYS PTR TO  0576
*                                      ASPCT CHAIN                   */
         SLR   @12,@12                                             0576
         L     @11,EPAPTR                                          0576
         ST    @12,EPARASP(,@11)                                   0576
*                           RETASPCT=ZERO;/* ZERO PTR TO RETRIEVED 0577
*                                      ASPCT                         */
         ST    @12,RETASPCT                                        0577
*                           R1=ASPCTPTR;/* GET PTR TO ASPCT BASE     */
         L     R1,ASPCTPTR                                         0578
*                           R0=TWOK;/* SET LENGTH TO 2K              */
         LA    R0,2048                                             0579
*                           CALL ILRAFS00;/* FREE THE ASPCT BASE AND
*                                      ALL EXTENSIONS RETRIEVED THUS
*                                      FAR                           */
         BAL   @14,ILRAFS00                                        0580
*                           RFY                                    0581
*                             R15 RSTD;                            0581
*                           RFY                                    0582
*                            (R0,                                  0582
*                             R1) UNRSTD;                          0582
*                           RFY                                    0583
*                             R8 RSTD;                             0583
*                           R8=R13; /* SAVE SAVEAREA POINTER RELEASE
*                                      THE LOCAL LOCK                */
         LR    R8,R13                                              0584
*                           GENERATE SETS(R11,R12,R13,R14);        0585
REL6           SETLOCK RELEASE,TYPE=LOCAL,RELATED=(VIO,ILRVSAMI(GET7))
*                           R13=R8; /* RESTORE SAVEAREA POINTER      */
         LR    R13,R8                                              0586
*                           RFY                                    0587
*                             R8 UNRSTD;                           0587
*                           IF R15^=ZERO/* WAS ILRAFS00 SUCCESSFUL?  */
*                             THEN                                 0588
         LTR   R15,R15                                             0588
         BZ    @RF00588                                            0588
*                             DO;   /* NO, RECORD FREEMAIN ERROR     */
*                               STM(R0,R14,SAVREGSA);/* SAVE REGS FOR
*                                      RECOVERY                      */
         STM   R0,R14,SAVREGSA                                     0590
*                               GEN(ABEND X'87',,,SYSTEM);         0591
         ABEND X'87',,,SYSTEM
*                             END;                                 0592
*                           ELSE                                   0593
*                             ;                                    0593
@RF00588 DS    0H                                                  0594
*                           RFY                                    0594
*                             R15 UNRSTD;                          0594
*                           BACKOUT=ON;/* SET BACKOUT ERROR FLAG ON  */
         OI    BACKOUT,B'10000000'                                 0595
*                           ASSTEXT=ZERO;/* FORCE ASST LOOP EXIT     */
         SLR   @12,@12                                             0596
         ST    @12,ASSTEXT                                         0596
*                           LPMECNTL=ZERO;/* FORCE LPME LOOP EXIT    */
         ST    @12,LPMECNTL                                        0597
*                         END;                                     0598
*                                                                  0598
*/********************************************************************/
*/*  PROCESS FAILURE FOR A RELEASE REQUEST                           */
*/********************************************************************/
*                                                                  0599
*                       ELSE                                       0599
*                         DO;                                      0599
         B     @RC00566                                            0599
@RF00566 DS    0H                                                  0600
*                           IF RETCODE^=STORAGE/* I/O BUFFER       0600
*                                      OBTAINED?                     */
*                             THEN                                 0600
         CLC   RETCODE(4),@CF00122                                 0600
         BE    @RF00600                                            0600
*                             DO;   /* YES                           */
*                               EPABASP=ZERO;/* ZERO RECOVERY'S    0602
*                                      POINTER TO THE I/O BUFFER     */
         L     @12,EPAPTR                                          0602
         SLR   @11,@11                                             0602
         ST    @11,EPABASP(,@12)                                   0602
*                               RFY                                0603
*                                (R0,                              0603
*                                 R1,                              0603
*                                 R3,                              0603
*                                 R4,                              0603
*                                 R7) RSTD;                        0603
*                               R0=TWOK;/* SET LENGTH OF 2K          */
         LA    R0,2048                                             0604
*                               R1=BUFFER;/* GET BUFFER ADDRESS      */
         L     R1,BUFFER                                           0605
*                               R4=PSATOLD;/* GET PTR TO CURRENT TCB */
         L     R4,PSATOLD                                          0606
*                               R7=PSAAOLD;/* GET PTR TO CURRENT ASCB*/
         L     R7,PSAAOLD                                          0607
*                               GENERATE REFS(R0,R1,R4,R7) SETS(R3);
                    FREEMAIN RC,A=(1),LV=(0),SP=230,BRANCH=YES
*                             END;                                 0609
*                           ELSE                                   0610
*                             ;                                    0610
@RF00600 DS    0H                                                  0611
*                           RFY                                    0611
*                            (R0,                                  0611
*                             R1,                                  0611
*                             R3,                                  0611
*                             R4,                                  0611
*                             R7) UNRSTD;                          0611
*                           RFY                                    0612
*                             R8 RSTD;                             0612
*                           R8=R13; /* SAVE SAVEAREA POINTER RELEASE
*                                      THE LOCAL LOCK                */
         LR    R8,R13                                              0613
*                           GENERATE SETS(R11,R12,R13,R14);        0614
REL7           SETLOCK RELEASE,TYPE=LOCAL,RELATED=(VIO,ILRVSAMI(GET7))
*                           R13=R8; /* RESTORE SAVEAREA POINTER      */
         LR    R13,R8                                              0615
*                           RFY                                    0616
*                             R8 UNRSTD;                           0616
*                           RFY                                    0617
*                            (R5,                                  0617
*                             R7) RSTD;                            0617
*                           R5=RPLPTR;/* OBTAIN THE RPL ADDR         */
         L     R5,RPLPTR                                           0618
*                           R7=ADDR(RECADDR);/* ADDR OF AREA TO STORE
*                                      ADDR OF RECORD LOCATED        */
         LA    R7,RECADDR                                          0619
*                           GEN                                    0620
*(MODCB RPL=(5),OPTCD=(LOC),AREALEN=4,AREA=(7));/* CHANGE MVE OPTION
*                                      TO LOCATE                     */
         MODCB RPL=(5),OPTCD=(LOC),AREALEN=4,AREA=(7)
*                           GEN(GET RPL=(5));/* RETRIEVE THE RECORD  */
         GET RPL=(5)
*                           GEN(ERASE RPL=(5));/* ERASE THE RECORD   */
         ERASE RPL=(5)
*                           GEN(MODCB RPL=(5),OPTCD=(MVE),AREALEN=2048)
*                               ;   /* CHANGE LOC OPTION BACK TO MOVE*/
         MODCB RPL=(5),OPTCD=(MVE),AREALEN=2048
*                           RFY                                    0624
*                            (R5,                                  0624
*                             R7) UNRSTD;                          0624
*                           LPMECNTL=LPMECNTL-ONE;/* DECREMENT LPME
*                                      EXT COUNT                     */
         L     @12,LPMECNTL                                        0625
         BCTR  @12,0                                               0625
         ST    @12,LPMECNTL                                        0625
*                           DO WHILE LPMECNTL^=ZERO;/* LOOP        0626
*                                      RETRIEVING AND ERASING THE  0626
*                                      REMAINING LPME EXTS FOR THIS
*                                      ASST EXT                      */
         B     @DE00626                                            0626
@DL00626 DS    0H                                                  0627
*                             EXTNUMB=EXTNUMB+ONE;/* INCREMENT THE 0627
*                                      VSAM KEY                      */
         LA    @12,1                                               0627
         AL    @12,EXTNUMB                                         0627
         ST    @12,EXTNUMB                                         0627
*                             CALL GETONE;/* RETRIEVE AN LPME EXT    */
         BAL   @14,GETONE                                          0628
*                             RFY                                  0629
*                               R15 RSTD;                          0629
*                             IF R15=ZERO/* WAS RETRIEVAL SUCCESSFUL?*/
*                               THEN                               0630
         SLR   @14,@14                                             0630
         CR    R15,@14                                             0630
         BNE   @RF00630                                            0630
*                               DO; /* YES                           */
*                                 EPABASP=ZERO;/* ZERO RECOVERYS   0632
*                                      POINTER TO THE I/O BUFFER     */
         L     @12,EPAPTR                                          0632
         ST    @14,EPABASP(,@12)                                   0632
*                                 ASPASSTE(ASST)=BUFFER;/* ANCHOR  0633
*                                      LPME EXT IN THE ASST EXTENSION*/
         L     @14,ASST                                            0633
         LR    @12,@14                                             0633
         SLA   @12,2                                               0633
         L     @11,BUFFER                                          0633
         L     @08,ASPEXPTR                                        0633
         ST    @11,ASPASSTE-4(@12,@08)                             0633
*                                 ASPLEXCT=ASPLEXCT+ONE;/* INCREMENT
*                                      LPME EXT COUNT IN ASPCT BASE  */
         L     @12,ASPCTPTR                                        0634
         LA    @11,1                                               0634
         LH    @08,ASPLEXCT(,@12)                                  0634
         ALR   @08,@11                                             0634
         STH   @08,ASPLEXCT(,@12)                                  0634
*                                 ASST=ASST+ONE;/* INCREMENT ASST  0635
*                                      SUBSCRIPT                     */
         ALR   @14,@11                                             0635
         ST    @14,ASST                                            0635
*                                 CALL ERASES;/* ERASE LPME EXT      */
         BAL   @14,ERASES                                          0636
*                               END;                               0637
*                             ELSE                                 0638
*                               DO; /* NO, RETRIEVAL FAILED          */
         B     @RC00630                                            0638
@RF00630 DS    0H                                                  0639
*                                 IF R15^=STORAGE/* WAS A BUFFER   0639
*                                      OBTAINED?                     */
*                                   THEN                           0639
         C     R15,@CF00122                                        0639
         BE    @RF00639                                            0639
*                                   DO;/* YES, FREEMAIN THE BUFFER   */
*                                    RFY                           0641
*                                     (R0,                         0641
*                                      R1,                         0641
*                                      R3,                         0641
*                                      R4,                         0641
*                                      R7,                         0641
*                                      R8) RSTD;                   0641
*                                    R8=R13;                       0642
         LR    R8,R13                                              0642
*                                    GENERATE SETS(R3,R11,R12,R13,R14);
GET11    SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,RELATED=(VIO,           *
               ILRVSAMI(REL11))
         LR    R13,R8
         LA    R0,2048                   SET 2K BUFFER LENGTH
         L     R1,BUFFER                  GET BUFFER ADDRESS
         L     R4,PSATOLD                 GET CURRENT TCB ADDRESS
         L     R7,PSAAOLD                 GET CURRENT ASCB ADDRESS
         FREEMAIN RC,A=(1),LV=(0),SP=230,BRANCH=YES
*
REL11    SETLOCK RELEASE,TYPE=LOCAL,RELATED=(VIO,ILRVSAMI(GET11))
*                                    R13=R8;/* RESTORE SAVEAREA    0644
*                                      POINTER                       */
         LR    R13,R8                                              0644
*                                    RFY                           0645
*                                     (R0,                         0645
*                                      R1,                         0645
*                                      R3,                         0645
*                                      R4,                         0645
*                                      R7,                         0645
*                                      R8,                         0645
*                                      R15) UNRSTD;                0645
*                                   END;                           0646
*                                 RFY                              0647
*                                  (R5,                            0647
*                                   R7) RSTD;                      0647
@RF00639 DS    0H                                                  0648
*                                 R5=RPLPTR;/* OBTAIN RPL ADDR       */
         L     R5,RPLPTR                                           0648
*                                 R7=ADDR(RECADDR);/* ADDR OF AREA TO
*                                      STORE ADDR OF RECORD LOCATED  */
         LA    R7,RECADDR                                          0649
*                                 GEN                              0650
*(MODCB RPL=(5),OPTCD=(LOC),AREALEN=4,AREA=(7));/* CHANGE MVE OPTION
*                                      TO LOCATE                     */
         MODCB RPL=(5),OPTCD=(LOC),AREALEN=4,AREA=(7)
*                                 GEN(GET RPL=(5));/* RETRIEVE THE 0651
*                                      RECORD                        */
         GET RPL=(5)
*                                 GEN(ERASE RPL=(5));/* ERASE THE  0652
*                                      RECORD                        */
         ERASE RPL=(5)
*                                 GEN                              0653
*(MODCB RPL=(5),OPTCD=(MVE),AREALEN=2048);/* CHANGE LOC OPTION BACK
*                                      TO MOVE                       */
         MODCB RPL=(5),OPTCD=(MVE),AREALEN=2048
*                                 RFY                              0654
*                                  (R5,                            0654
*                                   R7) UNRSTD;                    0654
*                               END;                               0655
*                             LPMECNTL=LPMECNTL-ONE;/* DECREMENT LPME
*                                      EXT COUNT                     */
@RC00630 L     @12,LPMECNTL                                        0656
         BCTR  @12,0                                               0656
         ST    @12,LPMECNTL                                        0656
*                           END;                                   0657
@DE00626 SLR   @12,@12                                             0657
         C     @12,LPMECNTL                                        0657
         BNE   @DL00626                                            0657
*                           PARTIALF=ON;/* INDICATE PARTIAL RETRIEVAL*/
         OI    PARTIALF,B'01000000'                                0658
*                           RETCODE=ZERO;                          0659
         ST    @12,RETCODE                                         0659
*                         END;                                     0660
         EJECT
*                       IF ASST>ASPNLPME/* REACHED END OF ASST ARRAY */
*                         THEN      /* YES                           */
@RC00566 L     @12,ASST                                            0661
         C     @12,@CF00150                                        0661
         BNH   @RF00661                                            0661
*                         ASST=ONE; /* RESET FOR NEXT ARRAY          */
         MVC   ASST(4),@CF00098                                    0662
*                       ELSE                                       0663
*                         ;                                        0663
@RF00661 DS    0H                                                  0664
*                     END;          /* END DO GROUP FOR NON-ZERO   0664
*                                      RETURN CODE FOR LPME EXTS     */
*                 END;              /* END DO WHILE LOOP FOR LPME  0665
*                                      EXTENSIONS                    */
@RC00547 DS    0H                                                  0665
@DE00543 L     @12,LPMECNTL                                        0665
         LTR   @12,@12                                             0665
         BNZ   @DL00543                                            0665
*                 ASST=ONE;         /* RESET ASST SUBSCRIPT          */
         MVC   ASST(4),@CF00098                                    0666
*               END;                /* END DO GROUP FOR ASST       0667
*                                      EXTENSIONS                    */
*             ELSE                  /* NO,CHECK FOR REL PROCESSING   */
*               IF PARTIALF=ON      /* REL PROCESSING?               */
*                 THEN              /* YES                           */
         B     @RC00526                                            0668
@RF00526 TM    PARTIALF,B'01000000'                                0668
         BNO   @RF00668                                            0668
*                 RETCODE=ZERO;     /* RESET INT RETURN CODE         */
         SLR   @12,@12                                             0669
         ST    @12,RETCODE                                         0669
*               ELSE                                               0670
*                 ;                                                0670
@RF00668 DS    0H                                                  0671
*           END;                    /* END DO WHILE LOOP FOR ASST  0671
*                                      EXTENSIONS                    */
@RC00526 DS    0H                                                  0671
@DE00435 L     @12,ASSTEXT                                         0671
         LTR   @12,@12                                             0671
         BNZ   @DL00435                                            0671
*         END;                      /* END DO GROUP FOR EXTENSION  0672
*                                      PROCESSING                    */
*       ELSE                                                       0673
*         DO;                       /* THERE ARE NO EXTENSIONS       */
         B     @RC00421                                            0673
@RF00421 DS    0H                                                  0674
*           EPABASP=ZERO;           /* ZERO RECOVERY'S POINTER TO THE
*                                      I/O BUFFER                    */
         L     @12,EPAPTR                                          0674
         SLR   @11,@11                                             0674
         ST    @11,EPABASP(,@12)                                   0674
*           EPARASP=BUFFER;         /* RECORD PTR TO ASPCT BASE      */
         L     @11,BUFFER                                          0675
         ST    @11,EPARASP(,@12)                                   0675
*         END;                                                     0676
*     END;                          /* ZERO RETURN CODE PROCESSING 0677
*                                      FOR ASPCT BASE                */
         EJECT
*                                                                  0678
*/********************************************************************/
*/* PROCESS A NON-ZERO RETURN CODE FROM GETONE FOR ASPCT BASE        */
*/********************************************************************/
*                                                                  0678
*   ELSE                                                           0678
*     DO;                                                          0678
         B     @RC00415                                            0678
@RF00415 DS    0H                                                  0679
*       RFY                                                        0679
*         R15 RSTD;                                                0679
*       RETCODE=R15;                /* SAVE THE RETURN CODE          */
         ST    R15,RETCODE                                         0680
*       RFY                                                        0681
*         R15 UNRSTD;                                              0681
*       IF RETCODE^=STORAGE         /* I/O BUFFER OBTAINED?          */
*         THEN                                                     0682
         L     @12,RETCODE                                         0682
         C     @12,@CF00122                                        0682
         BE    @RF00682                                            0682
*         DO;                       /* YES                           */
*           RFY                                                    0684
*            (R0,                                                  0684
*             R1,                                                  0684
*             R3,                                                  0684
*             R4,                                                  0684
*             R7,                                                  0684
*             R8) RSTD;                                            0684
*           R8=R13;                 /* SAVE SAVEAREA POINTER OBTAIN
*                                      THE LOCAL LOCK                */
         LR    R8,R13                                              0685
*           GENERATE SETS(R3,R11,R12,R13,R14) REFS(EPAPTR);        0686
GET8     SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,RELATED=(VIO,           *
               ILRVSAMI(REL8))
         LR    R13,R8                     RESTORE SAVEAREA POINTER
         L     R4,EPAPTR                  GET PTR TO EPATH
         SLR   R7,R7
         ST    R7,EPABASP(R4)             ZERO RECOVERYS POINTER TO
*                                         THE I/O BUFFER
         LA    R0,2048                    SET LENGTH FOR 2K
         L     R1,BUFFER                  GET BUFFER ADDRESS
         L     R4,PSATOLD                 GET PTR TO CURRENT TCB
         L     R7,PSAAOLD                 GET PTR TO CURRENT ASCB
         FREEMAIN RC,A=(1),LV=(0),SP=230,BRANCH=YES
*
REL8     SETLOCK RELEASE,TYPE=LOCAL,RELATED=(VIO,ILRVSAMI(GET8))
*           R13=R8;                 /* RESTORE SAVEAREA POINTER      */
         LR    R13,R8                                              0687
*           RFY                                                    0688
*            (R0,                                                  0688
*             R1,                                                  0688
*             R3,                                                  0688
*             R4,                                                  0688
*             R7,                                                  0688
*             R8) UNRSTD;                                          0688
*         END;                                                     0689
*       IF EPARPLB=ON THEN                                         0690
@RF00682 L     @12,EPAPTR                                          0690
         TM    EPARPLB(@12),B'00000001'                            0690
         BNO   @RF00690                                            0690
*         BACKOUT=ON;               /* SET BACKOUT ERROR FLAG ON     */
         OI    BACKOUT,B'10000000'                                 0691
*     END;                                                         0692
@RF00690 DS    0H                                                  0693
         EJECT
*                                                                  0693
*/********************************************************************/
*/* IF WE HAVE HAD ANY TROUBLE RETRIEVING THE EXTENSIONS THE BACKOUT */
*/* FLAG WILL HAVE BEEN TURNED ON. THIS SECTION WILL ERASE THE       */
*/* REMAINING ASST AND LPME EXTENSIONS FROM SYS1.STGINDEX.           */
*/********************************************************************/
*                                                                  0693
*   IF BACKOUT=ON                   /* ANY ERRORS RETRIEVING?        */
*     THEN                                                         0693
@RC00415 TM    BACKOUT,B'10000000'                                 0693
         BNO   @RF00693                                            0693
*     DO;                           /* YES                           */
*       RFY                                                        0695
*        (R5,                                                      0695
*         R7) RSTD;                                                0695
*       R5=RPLPTR;                  /* OBTAIN THE RPL ADDR           */
         L     R5,RPLPTR                                           0696
*       R7=ADDR(RECADDR);           /* ADDR AREA TO STORE ADDR OF  0697
*                                      RECORD LOCATED                */
         LA    R7,RECADDR                                          0697
*       GEN(MODCB RPL=(5),OPTCD=(LOC),AREALEN=4,AREA=(7));/* CHANGE
*                                      MVE OPTION TO LOCATE          */
         MODCB RPL=(5),OPTCD=(LOC),AREALEN=4,AREA=(7)
*       DO WHILE EXTNUMB<=MAXEXTN;                                 0699
         B     @DE00699                                            0699
@DL00699 DS    0H                                                  0700
*         GEN(GET RPL=(5));         /* RETRIEVE THE RECORD           */
         GET RPL=(5)
*         GEN(ERASE RPL=(5));       /* ERASE THE EXTENSION           */
         ERASE RPL=(5)
*         EXTNUMB=EXTNUMB+ONE;      /* INCREMENT VSAM KEY            */
         LA    @12,1                                               0702
         AL    @12,EXTNUMB                                         0702
         ST    @12,EXTNUMB                                         0702
*       END;                                                       0703
@DE00699 L     @12,EXTNUMB                                         0703
         C     @12,MAXEXTN                                         0703
         BNH   @DL00699                                            0703
*       RFY                                                        0704
*        (R5,                                                      0704
*         R7) UNRSTD;                                              0704
*     END;                                                         0705
*   RFY                                                            0706
*    (R14,                                                         0706
*     R15) RSTD;                                                   0706
@RF00693 DS    0H                                                  0707
*   R14=RETADDR1;                   /* GET RETURN ADDRESS            */
         L     R14,RETADDR1                                        0707
*   R15=RETCODE;                    /* LOAD RETURN CODE              */
         L     R15,RETCODE                                         0708
*   RETURN;                         /* RETURN TO MAINLINE            */
@EL00004 DS    0H                                                  0709
@EF00004 DS    0H                                                  0709
@ER00004 BR    @14                                                 0709
*   RFY                                                            0710
*    (R14,                                                         0710
*     R15) UNRSTD;                                                 0710
         EJECT
*                                                                  0711
*/********************************************************************/
*/* THIS NEXT SECTION WILL ESTABLISH A RETRY LOOP, AND ISSUE AN      */
*/* ERASE FOR THE RECORD KEY IN THE RPL. IF THE ERASE IS SUCCESSFUL, */
*/* LOOP EXIT IS FORCED. IF THE ERASE IS UNSUCCESSFUL, THE RETURN    */
*/* CODE IS CHECKED FOR EITHER A PHYSICAL OR LOGICAL ERROR. IF IT IS */
*/* A PHYSICAL ERROR LOOP EXIT IS FORCED AND THE RETURN CODE IS SET  */
*/* TO FOUR. IF IT IS A LOGICAL ERROR, A SHOWCB IS ISSUED TO         */
*/* DETERMINE IF RETRY IS POSSIBLE. IF RETRY IS NOT POSSIBLE THE     */
*/* RETURN CODE IS SET TO FOUR AND LOOP EXIT IS FORCED.              */
*/********************************************************************/
*                                                                  0711
*ERASES:                                                           0711
*   PROCEDURE OPTIONS(NOSAVE,NOSAVEAREA);                          0711
ERASES   DS    0H                                                  0712
*   RFY                                                            0712
*     R14 RSTD;                                                    0712
*   RETADDR2=R14;                   /* SAVE THE RETURN ADDRESS       */
         ST    R14,RETADDR2                                        0713
*   RFY                                                            0714
*     R14 UNRSTD;                                                  0714
*   RETRY=ZERO;                     /* INIT LOOP CONTROLLER          */
         SLR   RETRY,RETRY                                         0715
*   DO WHILE RETRY<MAXIMUM;                                        0716
         B     @DE00716                                            0716
@DL00716 DS    0H                                                  0717
*     RFY                                                          0717
*       R1 RSTD;                                                   0717
*     R1=RPLPTR;                    /* OBTAIN RPL ADDR               */
         L     R1,RPLPTR                                           0718
*     GEN(ERASE RPL=(1));           /* ERASE THE RECORD FROM       0719
*                                      SYS1.STGINDEX                 */
         ERASE RPL=(1)
*     RFY                                                          0720
*       R1 UNRSTD;                                                 0720
*     RFY                                                          0721
*       R15 RSTD;                                                  0721
*     IF R15^=ZERO                  /* ERASE SUCCESSFUL?             */
*       THEN                        /* NO                            */
         LTR   R15,R15                                             0722
         BZ    @RF00722                                            0722
*       IF R15=PHYSICAL             /* WAS IT A PHYSICAL ERROR       */
*         THEN                                                     0723
         C     R15,@CF00093                                        0723
         BNE   @RF00723                                            0723
*         DO;                       /* YES                           */
*           RETRY=MAXIMUM;          /* FORCE LOOP EXIT               */
         LA    RETRY,5                                             0725
*           RFY                                                    0726
*             R15 UNRSTD;                                          0726
*         END;                                                     0727
*       ELSE                                                       0728
*         DO;                       /* NO, IT WAS A LOGICAL ERROR    */
         B     @RC00723                                            0728
@RF00723 DS    0H                                                  0729
*           RFY                                                    0729
*            (R0,                                                  0729
*             R1,                                                  0729
*             R7) RSTD;                                            0729
*           FBCODE=ZERO;            /* ZERO FEEDBACK CODE AREA       */
         SLR   @12,@12                                             0730
         ST    @12,FBCODE                                          0730
*           R0=RPLPTR;              /* GET ADDRESS OF RPL            */
         L     R0,RPLPTR                                           0731
*           R7=ADDR(FBCODE);        /* GET ADDR OF RETURN AREA       */
         LA    R7,FBCODE                                           0732
*           GENERATE SETS(FBCODE);                                 0733
*                                      /* DETERMINE TYPE OF ERROR    */
               SHOWCB RPL=(R0),AREA=(R7),LENGTH=4,FIELDS=(FDBK),       *
               MF=(G,BSHOWCB,SHOWSIZE)
*           RFY                                                    0734
*            (R0,                                                  0734
*             R1,                                                  0734
*             R7) UNRSTD;                                          0734
*                                                                  0734
*           /*********************************************************/
*           /*                                                       */
*           /* WAS VSAM UNABLE TO OBTAIN STORAGE, OR IS THE MAXIMUM  */
*           /* NUMBER OF REQUESTS STARTED ALREADY?                   */
*           /*                                                       */
*           /*********************************************************/
*                                                                  0735
*           IF FBCODE=SPACEFBCODE=TOOMANY THEN/* YES, RETRY         */
         L     @12,FBCODE                                          0735
         C     @12,@CF00137                                        0735
         BE    @RT00735                                            0735
         C     @12,@CF00139                                        0735
         BNE   @RF00735                                            0735
@RT00735 DS    0H                                                  0736
*             RETRY=RETRY+ONE;      /* INCREMENT LOOP CONTROLLER     */
         AL    RETRY,@CF00098                                      0736
*           ELSE                    /* NO, NO RETRY                  */
*             RETRY=MAXIMUM;        /* FORCE LOOP EXIT               */
         B     @RC00735                                            0737
@RF00735 LA    RETRY,5                                             0737
*         END;                                                     0738
*     ELSE                          /* YES, ERASE WAS SUCCESSFUL     */
*       RETRY=MAXIMUM;              /* FORCE LOOP EXIT               */
         B     @RC00722                                            0739
@RF00722 LA    RETRY,5                                             0739
*   END;                            /* END DO WHILE LOOP FOR RETRY   */
@RC00722 DS    0H                                                  0740
@DE00716 C     RETRY,@CF00131                                      0740
         BL    @DL00716                                            0740
*   RFY                                                            0741
*     R14 RSTD;                                                    0741
*   R14=RETADDR2;                   /* GET RETURN ADDRESS            */
         L     R14,RETADDR2                                        0742
*   END ERASES;                                                    0743
@EL00005 DS    0H                                                  0743
@EF00005 DS    0H                                                  0743
@ER00005 BR    @14                                                 0743
*   END RETERASE;                                                  0744
*   RFY                                                            0745
*    (R14,                                                         0745
*     R15) UNRSTD;                                                 0745
         EJECT
*                                                                  0746
*/********************************************************************/
*/*                                                                  */
*/*  GETONE:   RETRIEVE A RECORD FROM SYS1.STGINDEX                  */
*/*                                                                  */
*/*  INPUT:    POINTER TO THE EPATH                                  */
*/*            POINTER TO AREA IN WHICH TO BUILD THE RPL             */
*/*            WORKAREA KEY SET FOR THE RECORD                       */
*/*                                                                  */
*/*  PROCESS:  SAVE THE RETURN ADDRESS. GETMAIN A 2K BUFFER TO READ  */
*/*            THE RECORD INTO. RECORD THE BUFFER ADDRESS IN THE     */
*/*            EPATH. IF THIS REQUEST IS FOR AN ASPCT BASE, ISSUE A  */
*/*            GENCB TO BUILD THE RPL. ISSUE A GET TO RETRIEVE THE   */
*/*            RECORD FROM SYS1.STGINDEX. IF THERE IS A NON-ZERO     */
*/*            RETURN FROM GET, ISSUE A SHOWCB TO DETERMINE TYPE OF  */
*/*            ERROR. SET THE RETURN CODE TO 08 IF ERROR WAS RECORD  */
*/*            COULD NOT BE FOUND, 20 FOR I/O ERRORS. RETURN TO      */
*/*            CALLER.                                               */
*/*                                                                  */
*/*  OUTPUT:   REGISTER 1 = PTR TO RETRIEVED RECORD                  */
*/*            REGISTER 15 = RETURN CODE                             */
*/*                          00 = SUCCESSFUL                         */
*/*                          08 = RECORD NOT FOUND                   */
*/*                          20 = I/O ERROR ON SYS1.STGINDEX         */
*/*                                                                  */
*/********************************************************************/
*/*GETONE: CHART (AREF,SEQ)                                          */
*/*HEADER                                                          0746
*/* GETONE: READ A RECORD IN FROM SYS1.STGINDEX                      */
*/*GETONE:  E  ENTRY                                                 */
*/*         P  SAVE THE RETURN ADDRESS                               */
*/*         P  LOAD REGISTERS FOR GENCB                              */
*/*         S  GENCB: BUILD THE RPL                                  */
*/*         D  (YES,GETONE ,NO,) ZERO RETURN CODE?                   */
*/*         P  SET INTERNAL RETURN CODE TO 20                        */
*/*         P  SET REG 1 TO ZERO                                     */
*/*         R  RETURN CODE 20                                        */
*/*GETONE : E  ENTRY                                                 */
*/*         L  SETLOCK: UNCOND OBTAIN LOCAL LOCK                     */
*/*         P  LOAD REGISTERS FOR GETMAIN                            */
*/*         S  GETMAIN: GET A BUFFER FROM SP230                      */
*/*         P  SAVE THE RETURN CODE                                  */
*/*         P  SAVE PTR TO BUFFER                                    */
*/*         L  SETLOCK: UNCOND RELEASE LOCAL LOCK                    */
*/*         D  (YES,%VSM47,NO,) DID WE OBTAIN STORAGE?               */
*/*         P  SET REG 1 TO ZERO                                     */
*/*         P  SET INTERNAL RETURN CODE TO 28                        */
*/*         R  RETURN CODE 28                                        */
*/*%VSM47:  P  RECORD BUFFER ADDRESS IN EPATH                        */
*/*         P  ZERO RETRY COUNTER                                    */
*/*%VSM49:  P  LOAD REG FOR GET                                      */
*/*         S  GET: RETRIEVE RECORD FROM STGINDEX                    */
*/*         D  (YES,,NO,%VSM50) ZERO RETURN CODE?                    */
*/*         P  LOAD REG 1 WITH PTR TO BUFFER                         */
*/*         R  RETURN CODE 0                                         */
*/*%VSM50:  S  SHOWCB: DETERMINE ERROR                               */
*/*         D  (YES,,NO,%VSM51) RECORD NOT FOUND?                    */
*/*         P  SET INTERNAL RETURN CODE TO 08                        */
*/*         P  LOAD REG 1 WITH PTR TO I/O BUFFER                     */
*/*         R  RETURN CODE 08                                        */
*/*%VSM51:  D  (YES,,NO,%VSM51A) RETRY POSSIBLE?                     */
*/*         P  INCREMENT THE RETRY COUNTER                           */
*/*         D  (YES,,NO,%VSM49) REACHED MAXIMUM RETRY                */
*/*%VSM51A: P  SET INTERNAL RETURN CODE TO 20                        */
*/*         P  LOAD REG 1 WITH PTR TO I/O BUFFER                     */
*/*         R  RETURN CODE 20                                        */
*/*GETONE:  END                                                      */
*                                                                  0746
         EJECT
*GETONE:                                                           0746
*   PROCEDURE OPTIONS(NOSAVE,NOSAVEAREA);                          0746
GETONE   DS    0H                                                  0747
*   RFY                                                            0747
*    (R0,                                                          0747
*     R1,                                                          0747
*     R3,                                                          0747
*     R4,                                                          0747
*     R7,                                                          0747
*     R8,                                                          0747
*     R14,                                                         0747
*     R15) RSTD;                                                   0747
*   RETADDR2=R14;                   /* SAVE THE RETURN ADDRESS       */
         ST    R14,RETADDR2                                        0748
*   RFY                                                            0749
*     R14 UNRSTD;                                                  0749
*   R8=R13;                         /* SAVE SAVEAREA POINTER OBTAIN
*                                      THE LOCAL LOCK                */
         LR    R8,R13                                              0750
*   GENERATE SETS(R1,R3,R11,R12,R13,R14) REFS(BUFFER,RETCODE1);    0751
GET9     SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,RELATED=(VIO,           *
               ILRVSAMI(REL9))
         LR    R13,R8                     RESTORE SAVEAREA POINTER
         LA    R0,2048                    SET LENGTH FOR 2K BUFFER
         L     R4,PSATOLD                 GET ADDRESS OF CURRENT TCB
         L     R7,PSAAOLD                 GET ADDRESS OF CURRENT ASCB
         GETMAIN RC,LV=(0),SP=230,BRANCH=YES
         ST    R1,BUFFER                  SAVE PTR TO GETMAIN AREA
         LR    R8,R13                     SAVE SAVEAREA POINTER
REL9     SETLOCK RELEASE,TYPE=LOCAL,RELATED=(VIO,ILRVSAMI(GET9))
*   R13=R8;                         /* RESTORE SAVEAREA POINTER      */
         LR    R13,R8                                              0752
*   RFY                                                            0753
*    (R0,                                                          0753
*     R1,                                                          0753
*     R3,                                                          0753
*     R4,                                                          0753
*     R7,                                                          0753
*     R8) UNRSTD;                                                  0753
*   IF R15^=ZERO                    /* WAS GETMAIN SUCCESSFUL?       */
*     THEN                                                         0754
         SLR   @14,@14                                             0754
         CR    R15,@14                                             0754
         BE    @RF00754                                            0754
*     DO;                           /* NO, RETURN TO CALLER          */
*       BUFFER=ZERO;                /* CLEAR THE BUFFER POINTER      */
         ST    @14,BUFFER                                          0756
*       RFY                                                        0757
*         R14 RSTD;                                                0757
*       R14=RETADDR2;               /* GET RETURN ADDRESS            */
         L     R14,RETADDR2                                        0758
*       RETURN CODE(STORAGE);       /* RETURN INDICATING WE COULD NOT
*                                      OBTAIN STORAGE                */
         LA    @15,28                                              0759
@EL00006 DS    0H                                                  0759
@EF00006 DS    0H                                                  0759
@ER00006 BR    @14                                                 0759
*       RFY                                                        0760
*        (R14,                                                     0760
*         R15) UNRSTD;                                             0760
*     END;                                                         0761
*   EPABASP=BUFFER;                 /* RECORD THE POINTER TO THE I/O
*                                      BUFFER FOR RECOVERY           */
@RF00754 L     @12,BUFFER                                          0762
         L     @11,EPAPTR                                          0762
         ST    @12,EPABASP(,@11)                                   0762
*   IF EPARPLB=OFF                  /* HAS THE RPL BEEN BUILT?       */
*     THEN                                                         0763
         TM    EPARPLB(@11),B'00000001'                            0763
         BNZ   @RF00763                                            0763
*     DO;                           /* NO                            */
*       RFY                                                        0765
*        (R0,                                                      0765
*         R1,                                                      0765
*         R4,                                                      0765
*         R7,                                                      0765
*         R11,                                                     0765
*         R12) RSTD;                                               0765
*       R7=ASMSTGXA;                /* GET ADDRESS OF SYS1.STGINDEX
*                                      ACB FROM ASMVT                */
         L     @08,ASMVTWPT                                        0766
         L     R7,ASMSTGXA(,@08)                                   0766
*       R4=BUFFER;                  /* GET ADDRESS OF I/O BUFFER     */
         L     @08,BUFFER                                          0767
         LR    R4,@08                                              0767
*       R11=LENGTH(IFGRPL);         /* SET LENGTH OF AN RPL          */
         LA    R11,76                                              0768
*       R0=ADDR(WKAVKEY);           /* GET ADDRESS OF VSAM KEY       */
         LA    R0,WKAVKEY                                          0769
*       R12=RPLPTR;                 /* GET ADDRESS OF THE RPL BUILD
*                                      AREA                          */
         L     R12,RPLPTR                                          0770
*       IF OPCODE=ONE THEN                                         0771
         L     @08,PARMPTR                                         0771
         CLI   OPCODE(@08),1                                       0771
         BNE   @RF00771                                            0771
*         DO;                       /* AN ACTIVATE REQUEST           */
*           GENERATE REFS(R0,R1,R4,R7,R11,R12);                    0773
         GENCB BLK=RPL,AM=VSAM,ACB=(R7),ARG=(R0),COPIES=1,AREALEN=2048,*
               LENGTH=(R11),AREA=(R4),OPTCD=(KEY,DIR,SYN,KEQ,FKS,MVE,  *
               NUP),RECLEN=2041,WAREA=(R12),MF=(G,BLDGENCB,GENBSIZE)
*         END;                                                     0774
*       ELSE                                                       0775
*         DO;                       /* SAVE OR RELEASE REQUEST       */
         B     @RC00771                                            0775
@RF00771 DS    0H                                                  0776
*           GENERATE REFS(R0,R1,R4,R7,R11,R12);                    0776
         GENCB BLK=RPL,AM=VSAM,ACB=(R7),ARG=(R0),COPIES=1,AREALEN=2048,*
               LENGTH=(R11),AREA=(R4),OPTCD=(KEY,DIR,SYN,KEQ,FKS,MVE,  *
               UPD),RECLEN=2041,WAREA=(R12),MF=(G,BLDGENCB)
*         END;                                                     0777
*       RFY                                                        0778
*        (R0,                                                      0778
*         R1,                                                      0778
*         R4,                                                      0778
*         R7,                                                      0778
*         R11,                                                     0778
*         R12) UNRSTD;                                             0778
@RC00771 DS    0H                                                  0779
*       RFY                                                        0779
*         R15 RSTD;                                                0779
*       IF R15^=ZERO                /* WAS THE RPL BUILT?            */
*         THEN                                                     0780
         LTR   R15,R15                                             0780
         BZ    @RF00780                                            0780
*         DO;                       /* NO                            */
*           RFY                                                    0782
*             R14 RSTD;                                            0782
*           R14=RETADDR2;           /* GET RETURN ADDRESS            */
         L     R14,RETADDR2                                        0783
*           RETURN CODE(TWENTY);    /* RETURN INDICATING WE HAD A  0784
*                                      VSAM ERROR                    */
         LA    @15,20                                              0784
         BR    @14                                                 0784
*           RFY                                                    0785
*            (R14,                                                 0785
*             R15) UNRSTD;                                         0785
*         END;                                                     0786
*       EPARPLB=ON;                 /* SET RPL BUILT FLAG            */
@RF00780 L     @12,EPAPTR                                          0787
         OI    EPARPLB(@12),B'00000001'                            0787
*     END;                                                         0788
*   ELSE                            /* YES THE RPL WAS BUILT         */
*     RPLAREA=BUFFER;               /* SET NEW BUFFER ADDRESS        */
         B     @RC00763                                            0789
@RF00763 L     @12,BUFFER                                          0789
         L     @11,RPLPTR                                          0789
         ST    @12,RPLAREA(,@11)                                   0789
         EJECT
*                                                                  0790
*/********************************************************************/
*/*  RETRIEVE THE RECORD FROM SYS1.STGINDEX                          */
*/********************************************************************/
*                                                                  0790
*   RETRY=ZERO;                     /* INIT LOOP CONTROLLER          */
@RC00763 SLR   RETRY,RETRY                                         0790
*   DO WHILE RETRY<MAXIMUM;                                        0791
         B     @DE00791                                            0791
@DL00791 DS    0H                                                  0792
*     RFY                                                          0792
*       R1 RSTD;                                                   0792
*     R1=RPLPTR;                    /* OBTAIN RPL ADDR               */
         L     R1,RPLPTR                                           0793
*     GEN(GET RPL=(1));             /* RETRIEVE THE RECORD           */
         GET RPL=(1)
*     RFY                                                          0795
*       R1 UNRSTD;                                                 0795
*     RFY                                                          0796
*       R15 RSTD;                                                  0796
*     IF R15^=ZERO                  /* RETRIEVAL SUCCESSFUL?         */
*       THEN                        /* NO                            */
         LTR   R15,R15                                             0797
         BZ    @RF00797                                            0797
*       IF R15=PHYSICAL             /* WAS THERE A PHYSICAL ERROR    */
*         THEN                                                     0798
         C     R15,@CF00093                                        0798
         BNE   @RF00798                                            0798
*         DO;                       /* YES, NO RETRY POSSIBLE        */
*           RETRY=MAXIMUM;          /* FORCE LOOP EXIT               */
         LA    RETRY,5                                             0800
*           R15=TWENTY;             /* SET RETURN CODE FOR I/O ERROR */
         LA    R15,20                                              0801
*         END;                                                     0802
*       ELSE                                                       0803
*         DO;                       /* NO, IT WAS A LOGICAL ERROR    */
         B     @RC00798                                            0803
@RF00798 DS    0H                                                  0804
*           RFY                                                    0804
*            (R0,                                                  0804
*             R1,                                                  0804
*             R7) RSTD;                                            0804
*           FBCODE=ZERO;            /* ZERO FEEDBACK CODE AREA       */
         SLR   @14,@14                                             0805
         ST    @14,FBCODE                                          0805
*           R0=RPLPTR;              /* GET ADDRESS OF RPL            */
         L     R0,RPLPTR                                           0806
*           R7=ADDR(FBCODE);        /* GET ADDR OF RETURN AREA       */
         LA    R7,FBCODE                                           0807
*           GENERATE SETS(FBCODE);                                 0808
*                                      /* GET THE FEEDBACK CODE      */
               SHOWCB RPL=(R0),AREA=(R7),LENGTH=4,FIELDS=(FDBK),       *
               MF=(G,BSHOWCB)
*           RFY                                                    0809
*            (R0,                                                  0809
*             R1,                                                  0809
*             R7) UNRSTD;           /* WAS ERROR CAUSED BY         0809
*                                      INSUFFICIENT STORAGE OR WEW 0809
*                                      THE MAXIMUM NUMBER OF REQUESTS
*                                      OUTSTANDING                   */
*           IF FBCODE=SPACEFBCODE=TOOMANY THEN                    0810
         L     @14,FBCODE                                          0810
         C     @14,@CF00137                                        0810
         BE    @RT00810                                            0810
         C     @14,@CF00139                                        0810
         BNE   @RF00810                                            0810
@RT00810 DS    0H                                                  0811
*             DO;                   /* YES, RETRY                    */
*               RETRY=RETRY+ONE;    /* INCREMENT RETRY COUNTER       */
         AL    RETRY,@CF00098                                      0812
*               R15=TWENTY;         /* SET I/O ERROR RC              */
         LA    R15,20                                              0813
*             END;                                                 0814
*           ELSE                                                   0815
*             DO;                   /* NO, NON-RETRIABLE ERROR       */
         B     @RC00810                                            0815
@RF00810 DS    0H                                                  0816
*               RETRY=MAXIMUM;      /* FORCE LOOP EXIT               */
         LA    RETRY,5                                             0816
*               IF FBCODE=NOTFOUND  /* RECORD NOT FOUND?             */
*                 THEN              /* YES, SET NOT FOUND RC         */
         CLC   FBCODE(4),@CF00143                                  0817
         BNE   @RF00817                                            0817
*                 R15=KEYNGOOD;                                    0818
         LA    R15,8                                               0818
*               ELSE                /* NO, SET I/O ERROR RC          */
*                 R15=TWENTY;                                      0819
         B     @RC00817                                            0819
@RF00817 LA    R15,20                                              0819
*               RFY                                                0820
*                 R15 UNRSTD;       /* ERROR                         */
@RC00817 DS    0H                                                  0821
*             END;                                                 0821
*         END;                                                     0822
*     ELSE                          /* YES, RETRIEVAL SUCCESSFUL     */
*       RETRY=MAXIMUM;              /* FORCE LOOP EXIT               */
         B     @RC00797                                            0823
@RF00797 LA    RETRY,5                                             0823
*   END;                            /* END RETRY LOOP                */
@RC00797 DS    0H                                                  0824
@DE00791 C     RETRY,@CF00131                                      0824
         BL    @DL00791                                            0824
*   RFY                                                            0825
*     R14 RSTD;                                                    0825
*   R14=RETADDR2;                   /* GET RETURN ADDRESS            */
         L     R14,RETADDR2                                        0826
*   RFY                                                            0827
*     R14 UNRSTD;                                                  0827
*   END GETONE;                                                    0828
         B     @EL00006                                            0828
         EJECT
*                                                                  0829
*/********************************************************************/
*/*                                                                  */
*/*  PUTONE:   WRITE A RECORD TO SYS1.STGINDEX                       */
*/*                                                                  */
*/*  INPUT:    POINTER TO THE EPATH                                  */
*/*            POINTER TO AREA IN WHICH TO BUILD THE RPL             */
*/*            POINTER TO RECORD TO BE WRITTEN                       */
*/*            WORKAREA KEY SET FOR THE RECORD                       */
*/*                                                                  */
*/*  PROCESS:  SAVE THE RETURN ADDRESS. ISSUE A GETMAIN FOR THE 2K   */
*/*            I/O BUFFER. RECORD POINTER TO BUFFER IN THE EPATH.    */
*/*            ISSUE A GENCB TO BUILD THE RPL. EXTENSION PROCESSING  */
*/*            WILL ENTER HERE AT A SECONDARY ENTRY POINT PUTONEA.   */
*/*            COPY THE RECORD TO BE WRITTEN OUT TO THE BUFFER. ISSUE*/
*/*            A PUT TO WRITE THE RECORD TO SYS1.STGINDEX. IF THERE  */
*/*            IS A NON-ZERO RETURN CODE FROM PUT, ISSUE A SHOWCB TO */
*/*            DETERMINE TYPE OF ERROR. IF SYS1.STGINDEX IS FULL, SET*/
*/*            THE RETURN CODE TO 24, OR 20 FOR I/O ERRORS. RETURN   */
*/*            TO PUTASPCT.                                          */
*/*                                                                  */
*/*  OUTPUT:   THE RECORD IS WRITTEN TO SYS1.STGINDEX                */
*/*                                                                  */
*/********************************************************************/
*/*PUTONE: CHART (AREF,SEQ)                                          */
*/*HEADER                                                          0829
*/* PUTONE: WRITE A RECORD TO SYS1.STGINDEX                          */
*/*PUTONE:  E  ENTRY                                                 */
*/*         P  SAVE THE RETURN ADDRESS                               */
*/*         L  SETLOCK: UNCOND OBTAIN LOCAL LOCK                     */
*/*         P  LOAD REGISTERS FOR GETMAIN                            */
*/*         S  GETMAIN: GET A BUFFER FROM SP230                      */
*/*         P  SAVE THE RETURN CODE                                  */
*/*         P  SAVE PTR TO BUFFER                                    */
*/*         L  SETLOCK: UNCOND RELEASE LOCAL LOCK                    */
*/*         D  (YES,%VSM52,NO,) DID WE OBTAIN STORAGE?               */
*/*         P  SET INTERNAL RETURN CODE TO 28                        */
*/*         R  RETURN CODE 28                                        */
*/*%VSM52:  P  RECORD PTR TO BUFFER IN EPATH                         */
*/*         P  LOAD REGISTERS FOR GENCB                              */
*/*         S  GENCB: BUILD THE RPL                                  */
*/*         D  (YES,PUTONEA,NO,) ZERO RETURN CODE?                   */
*/*         P  SET INTERNAL RETURN CODE TO 20                        */
*/*         R  RETURN CODE 20                                        */
*/*PUTONEA: E  ENTRY                                                 */
*/*         P  COPY ASPCT TO BUFFER                                  */
*/*         P  ZERO THE RETRY COUNTER                                */
*/*%VSM53:  P  LOAD REG FOR PUT                                      */
*/*         S  PUT: WRITE RECORD TO STGINDEX                         */
*/*         D  (YES,,NO,%VSM54) ZERO RETURN CODE?                    */
*/*         R  RETURN CODE 0                                         */
*/*%VSM54:  S  SHOWCB: DETERMINE ERROR                               */
*/*         D  (YES,,NO,%VSM54A) RETRY POSSIBLE?                     */
*/*         P  INCREMENT THE RETRY COUNTER                           */
*/*         D  (YES,,NO,%VSM53) REACHED MAXIMUM RETRY?               */
*/*%VSM54A: D  (YES,,NO,%VSM55) STGINDEX FULL?                       */
*/*         P  (,%VSM56) SET RETURN CODE TO 24                       */
*/*%VSM55:  P  SET RETURN CODE TO 20                                 */
*/*%VSM56:  R  RETURN TO CALLER                                      */
*/*PUTONE: END                                                       */
*                                                                  0829
         EJECT
*PUTONE:                                                           0829
*   PROCEDURE OPTIONS(NOSAVE,NOSAVEAREA);                          0829
PUTONE   DS    0H                                                  0830
*   RFY                                                            0830
*     R14 RSTD;                                                    0830
*   RETADDR2=R14;                   /* SAVE THE RETURN ADDRESS       */
         ST    R14,RETADDR2                                        0831
*   RFY                                                            0832
*     R14 UNRSTD;                                                  0832
*   RFY                                                            0833
*    (R0,                                                          0833
*     R1,                                                          0833
*     R3,                                                          0833
*     R4,                                                          0833
*     R7,                                                          0833
*     R8,                                                          0833
*     R15) RSTD;                                                   0833
*   R8=R13;                         /* SAVE SAVEAREA ADDRESS OBTAIN
*                                      THE LOCAL LOCK                */
         LR    R8,R13                                              0834
*   GENERATE SETS(R1,R3,R4,R7,BUFFER,RETCODE1);                    0835
GET10    SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,RELATED=(VIO,           *
               ILRVSAMI(REL10))
         LR    R13,R8                     RESTORE SAVEAREA POINTER
         LA    R0,2048                    SET LENGTH FOR 2K BUFFER
         L     R4,PSATOLD                 GET ADDRESS OF CURRENT TCB
         L     R7,PSAAOLD                 GET ADDRESS OF CURRENT ASCB
         GETMAIN RC,LV=(0),SP=230,BRANCH=YES
         ST    R1,BUFFER                  SAVE THE BUFFER ADDRESS
REL10    SETLOCK RELEASE,TYPE=LOCAL,RELATED=(VIO,ILRVSAMI(GET10))
*   R13=R8;                         /* RESTORE SAVEAREA POINTER      */
         LR    R13,R8                                              0836
*   RFY                                                            0837
*    (R0,                                                          0837
*     R1,                                                          0837
*     R3,                                                          0837
*     R4,                                                          0837
*     R7,                                                          0837
*     R8) UNRSTD;                                                  0837
*   IF R15^=ZERO                    /* WAS GETMAIN SUCCESSFUL?       */
*     THEN                                                         0838
         SLR   @14,@14                                             0838
         CR    R15,@14                                             0838
         BE    @RF00838                                            0838
*     DO;                           /* NO                            */
*       BUFFER=ZERO;                /* CLEAR THE BUFFER POINTER      */
         ST    @14,BUFFER                                          0840
*       RFY                                                        0841
*         R14 RSTD;                                                0841
*       R14=RETADDR2;               /* GET RETURN ADDRESS            */
         L     R14,RETADDR2                                        0842
*       RETURN CODE(STORAGE);       /* RETURN INDICATING WE COULD    */
         LA    @15,28                                              0843
@EL00007 DS    0H                                                  0843
@EF00007 DS    0H                                                  0843
@ER00007 BR    @14                                                 0843
*       RFY                                                        0844
*        (R14,                                                     0844
*         R15) UNRSTD;              /* NOT OBTAIN STORAGE            */
*     END;                                                         0845
*   EPABASP=BUFFER;                 /* RECORD PTR TO I/O BUFFER      */
@RF00838 L     @12,BUFFER                                          0846
         L     @11,EPAPTR                                          0846
         ST    @12,EPABASP(,@11)                                   0846
         EJECT
*                                                                  0847
*/********************************************************************/
*/*  BUILD A VSAM REQUEST PARAMETER LIST                             */
*/********************************************************************/
*                                                                  0847
*   RFY                                                            0847
*    (R0,                                                          0847
*     R1,                                                          0847
*     R4,                                                          0847
*     R7,                                                          0847
*     R11,                                                         0847
*     R12) RSTD;                                                   0847
*   R0=ADDR(WKAVKEY);               /* GET ADDRESS OF VSAM KEY       */
         LA    R0,WKAVKEY                                          0848
*   R4=BUFFER;                      /* GET PTR TO I/O BUFFER         */
         L     @08,BUFFER                                          0849
         LR    R4,@08                                              0849
*   R7=ASMSTGXA;                    /* GET PTR TO STGINDEX ACB       */
         L     @08,ASMVTWPT                                        0850
         L     R7,ASMSTGXA(,@08)                                   0850
*   R11=LENGTH(IFGRPL);             /* SET LENGTH OF AN RPL          */
         LA    R11,76                                              0851
*   R12=RPLPTR;                     /* GET PTR TO RPL BUILD AREA     */
         L     R12,RPLPTR                                          0852
*   GENERATE REFS(R0,R1,R4,R7,R11,R12);                            0853
         GENCB BLK=RPL,AM=VSAM,ACB=(R7),ARG=(R0),COPIES=1,AREALEN=2048,*
               LENGTH=(R11),AREA=(R4),OPTCD=(KEY,DIR,SYN,KEQ,FKS,MVE,  *
               NUP),RECLEN=2041,WAREA=(R12),MF=(G,BLDGENCB)
*   RFY                                                            0854
*    (R0,                                                          0854
*     R1,                                                          0854
*     R4,                                                          0854
*     R7,                                                          0854
*     R11,                                                         0854
*     R12) UNRSTD;                                                 0854
*   RFY                                                            0855
*     R15 RSTD;                                                    0855
*   IF R15^=ZERO                    /* GENCB SUCCESSFUL?             */
*     THEN                                                         0856
         LTR   R15,R15                                             0856
         BZ    @RF00856                                            0856
*     DO;                           /* NO                            */
*       RFY                                                        0858
*         R14 RSTD;                                                0858
*       R14=RETADDR2;               /* GET RETURN ADDRESS            */
         L     R14,RETADDR2                                        0859
*       RETURN CODE(TWENTY);        /* RETURN INDICATING VSAM        */
         LA    @15,20                                              0860
         BR    @14                                                 0860
*       RFY                                                        0861
*        (R14,                                                     0861
*         R15) UNRSTD;              /* ERROR                         */
*     END;                                                         0862
*   EPARPLB=ON;                     /* SET RPL BUILT FLAG            */
@RF00856 L     @12,EPAPTR                                          0863
         OI    EPARPLB(@12),B'00000001'                            0863
*   RFY                                                            0864
*     R1 RSTD;                                                     0864
*   R1=ASPCTPTR;                    /* GET PTR TO ASPCT BASE         */
         L     R1,ASPCTPTR                                         0865
*   GOTO AROUND;                    /* BRANCH AROUND EXTENSION     0866
*                                      PROCESSING ENTRY POINT        */
         B     AROUND                                              0866
*PUTONEA:                                                          0867
*   ENTRY;                                                         0867
PUTONEA  DS    0H                                                  0868
*   RFY                                                            0868
*     R14 RSTD;                                                    0868
*   RETADDR2=R14;                   /* SAVE THE RETURN ADDRESS       */
         ST    R14,RETADDR2                                        0869
*   RETCODE1=ZERO;                  /* INIT INTERNAL RETURN CODE     */
         SLR   @15,@15                                             0870
         ST    @15,RETCODE1                                        0870
*AROUND:                                                           0871
*   ;                                                              0871
AROUND   DS    0H                                                  0872
*   RFY                                                            0872
*    (R0,                                                          0872
*     R1,                                                          0872
*     R14,                                                         0872
*     R15) RSTD;                    /* COPY THE ASPCT BASE OR        */
*   R0=BUFFER;                      /* EXTENSION TO THE I/O BUFFER   */
         L     R0,BUFFER                                           0873
*   R14=R1;                                                        0874
         LR    R14,R1                                              0874
*   R1=LENGTH(ASPCT);                                              0875
         LA    R1,1088                                             0875
*   R15=R1;                                                        0876
         LR    R15,R1                                              0876
*   MVCL(R0,R14);                                                  0877
         MVCL  R0,R14                                              0877
*   RFY                                                            0878
*    (R0,                                                          0878
*     R1,                                                          0878
*     R14,                                                         0878
*     R15) UNRSTD;                                                 0878
*   RETRY=ZERO;                     /* INIT LOOP CONTROLLER          */
         SLR   RETRY,RETRY                                         0879
*   DO WHILE RETRY<MAXIMUM;                                        0880
         B     @DE00880                                            0880
@DL00880 DS    0H                                                  0881
*     RFY                                                          0881
*       R1 RSTD;                                                   0881
*     R1=RPLPTR;                    /* OBTAIN RPL ADDR               */
         L     R1,RPLPTR                                           0882
*     GEN(PUT RPL=(1));             /* WRITE THE BUFFER OUT TO     0883
*                                      SYS1.STGINDEX                 */
         PUT RPL=(1)
*     RFY                                                          0884
*       R1 UNRSTD;                                                 0884
*     RFY                                                          0885
*       R15 RSTD;                                                  0885
*     IF R15^=ZERO                  /* WAS WRITE SUCCESSFUL?         */
*       THEN                        /* NO                            */
         LTR   R15,R15                                             0886
         BZ    @RF00886                                            0886
*       IF R15=PHYSICAL             /* WAS IT A PHYSICAL ERROR       */
*         THEN                                                     0887
         C     R15,@CF00093                                        0887
         BNE   @RF00887                                            0887
*         DO;                       /* YES                           */
*           RETRY=MAXIMUM;          /* FORCE LOOP EXIT               */
         LA    RETRY,5                                             0889
*           RETCODE1=TWENTY;        /* SET RETURN CODE FOR I/O       */
         MVC   RETCODE1(4),@CF00120                                0890
*           RFY                                                    0891
*             R15 UNRSTD;           /* ERROR                         */
*         END;                                                     0892
*       ELSE                                                       0893
*         DO;                       /* NO, IT WAS A LOGICAL ERROR    */
         B     @RC00887                                            0893
@RF00887 DS    0H                                                  0894
*           RFY                                                    0894
*            (R0,                                                  0894
*             R1,                                                  0894
*             R7) RSTD;                                            0894
*           FBCODE=ZERO;            /* ZERO FEEDBACK CODE AREA       */
         SLR   @12,@12                                             0895
         ST    @12,FBCODE                                          0895
*           R0=RPLPTR;              /* GET ADDRESS OF RPL            */
         L     R0,RPLPTR                                           0896
*           R7=ADDR(FBCODE);        /* GET ADDR OF RETURN AREA       */
         LA    R7,FBCODE                                           0897
*           GENERATE SETS(FBCODE);                                 0898
               SHOWCB RPL=(R0),AREA=(R7),LENGTH=4,FIELDS=(FDBK),       *
               MF=(G,BSHOWCB)
*           RFY                                                    0899
*            (R0,                                                  0899
*             R1,                                                  0899
*             R7) UNRSTD;                                          0899
*           IF FBCODE=FULL          /* STGINDEX FULL?                */
*             THEN                                                 0900
         CLC   FBCODE(4),@CF00122                                  0900
         BNE   @RF00900                                            0900
*             DO;                   /* YES                           */
*               RETRY=MAXIMUM;      /* FORCE LOOP EXIT               */
         LA    RETRY,5                                             0902
*               RETCODE1=NOROOM;    /* SET RETURN CODE FOR STGINDEX
*                                      FULL                          */
         MVC   RETCODE1(4),@CF00141                                0903
*             END;                                                 0904
*           ELSE                    /* NO, WASN'T THERE ENOUGH     0905
*                                      STORAGE AVAILABLE OR WERE THE
*                                      MAXIMUM NUMBER OF REQUESTS  0905
*                                      GOING ALREADY?                */
*             IF FBCODE=SPACEFBCODE=TOOMANY THEN                  0905
         B     @RC00900                                            0905
@RF00900 L     @12,FBCODE                                          0905
         C     @12,@CF00137                                        0905
         BE    @RT00905                                            0905
         C     @12,@CF00139                                        0905
         BNE   @RF00905                                            0905
@RT00905 DS    0H                                                  0906
*               DO;                 /* YES, RETRY                    */
*                 RETRY=RETRY+ONE;                                 0907
         AL    RETRY,@CF00098                                      0907
*                 RETCODE1=TWENTY;                                 0908
         MVC   RETCODE1(4),@CF00120                                0908
*               END;                                               0909
*             ELSE                                                 0910
*               DO;                 /* NO, EXIT                      */
         B     @RC00905                                            0910
@RF00905 DS    0H                                                  0911
*                 RETRY=MAXIMUM;    /* FORCE LOOP EXIT               */
         LA    RETRY,5                                             0911
*                 RETCODE1=TWENTY;  /* SET RETURN CODE FOR I/O ERROR */
         MVC   RETCODE1(4),@CF00120                                0912
*               END;                                               0913
*         END;                                                     0914
*     ELSE                                                         0915
*       DO;                         /* NO, SUCCESSFUL WRITE          */
         B     @RC00886                                            0915
@RF00886 DS    0H                                                  0916
*         RETRY=MAXIMUM;            /* FORCE LOOP EXIT               */
         LA    RETRY,5                                             0916
*         RETCODE1=ZERO;            /* SET ZERO RETURN CODE          */
         SLR   @12,@12                                             0917
         ST    @12,RETCODE1                                        0917
*       END;                                                       0918
*   END;                                                           0919
@RC00886 DS    0H                                                  0919
@DE00880 C     RETRY,@CF00131                                      0919
         BL    @DL00880                                            0919
*   RFY                                                            0920
*    (R14,                                                         0920
*     R15) RSTD;                                                   0920
*   R14=RETADDR2;                   /* GET THE RETURN ADDRESS        */
         L     R14,RETADDR2                                        0921
*   R15=RETCODE1;                   /* LOAD THE RETURN CODE          */
         L     R15,RETCODE1                                        0922
*   RFY                                                            0923
*    (R14,                                                         0923
*     R15) UNRSTD;                                                 0923
*   END PUTONE;                                                    0924
         B     @EL00007                                            0924
         EJECT
*                                                                  0925
*/*  MACCOMP Y-4SC1CW/PZD81                                          */
*/*  MACSTAT Y-475082/415304                                         */
*/********************************************************************/
*/*                                                                  */
*/*  NAME:  ILRAFS00                                                 */
*/*                                                                  */
*/*  STATUS:  OS/VS2 RELEASE 4.1, LEVEL 0                            */
*/*                                                                  */
*/*  ENTRY POINT:  ILRAFS00                                          */
*/*                                                                  */
*/*  FUNCTION:  THIS SUBROUTINE FREES AN ASPCT.                      */
*/*                                                                  */
*/*  INPUT:  ADDRESS OF ASPCT IN REGISTER 1.                         */
*/*          LENGTH OF ASPCT IN REGISTER 0.                          */
*/*                                                                  */
*/*  PROCESS:  TWO LOOPS, ONE TO FREE ASST EXTENSIONS AND ONE TO     */
*/*            FREE LPME EXTENSIONS, ARE EXECUTED.  EACH USES THE    */
*/*            SUBROUTINE AFSFREE TO INVOKE FREEMAIN.  A FINAL CALL  */
*/*            TO AFSFREE FREES THE BASE ASPCT EXTN.                 */
*/*                                                                  */
*/*  OUTPUT:  RETURN CODE IN REGISTER 15.                            */
*/*             00 = NORMAL RETURN                                   */
*/*             44 = FREEMAIN FAILURE                                */
*/*                                                                  */
*/*  EXIT-NORMAL:  RETURN TO CALLER WITH RETURN CODE (SEE OUTPUT)    */
*/*                                                                  */
*/*  EXIT-ERROR:  NONE                                               */
*/*                                                                  */
*/*  EXTERNAL REFERENCES:  FREEMAIN                                  */
*/*                                                                  */
*/*  REGISTERS CLOBBERED:  0 AND 1, 14 AND 15                        */
*/*                                                                  */
*/*  MAPPING MACROS USED:  ILRASPCT                                  */
*/*                                                                  */
*/*  NOTES:  DUE TO PLS OPTIMIZATION, RESTRICT ALL NECESSARY         */
*/*          REGISTERS AROUND THIS ROUTINE.                          */
*/*          INVOKING ROUTINE MUST HOLD THE LOCAL LOCK, OR HAVE      */
*/*          SPECIFIED %AFSSVC=YES.                                  */
*/*          ALL LABELS AND DATA AREAS CREATED BY THIS ROUTINE BEGIN */
*/*          WITH THE THREE CHARACTERS 'AFS'.  THE CALLING MODULE    */
*/*          MUST INCLUDE SUFFICIENT WORKSPACE FOR THIS ROUTINE'S    */
*/*          DATA AREAS.  THIS AMOUNT IS COMPILER DEPENDENT WITH A   */
*/*          MAXIMUM REQUIREMENT OF 46 BYTES.  THIS ROUTINE ALSO     */
*/*          REQUIRES THAT THE CALLING MODULE DECLARES REGISTERS     */
*/*          R0-R15.  THE MAPPING MACRO LISTED ABOVE MUST BE         */
*/*          INCLUDED.  THE BASE POINTER FOR THE ASPCT IS NOT        */
*/*          REQUIRED BY THIS SUBROUTINE.                            */
*/*                                                                  */
*/*  METHOD OF ACCESS:                                               */
*/*          %AFSSVC='YES' IF THE INVOKING ROUTINE MUST USE AN SVC   */
*/*          %AFSSVC='NO' IF BRANCH ENTRY REQUIRED                   */
*/*          %INCLUDE SYSLIB(ILRAFS00)                               */
*/********************************************************************/
*/*ILRAFS00: CHART (AREF)                                            */
*/*HEADER                                                          0925
*/*            ILRAFS00 - FREE ASPCT STORAGE                         */
*/*ILRAFS00: E ENTRY                                                 */
*/*         P  SAVE THE RETURN ADDRESS                               */
*/*         P  SAVE PTR TO ASPCT BASE                                */
*/*         P  SAVE THE LENGTH OF ASPCT                              */
*/*         D  (YES,,NO,%AFS01A) SPECIFIED LENGTH THAT OF ASPCT?     */
*/*         P  (,%AFS01B) SET SUBPOOL ID TO 255                      */
*/*%AFS01A: P  SET SUBPOOL ID TO 230                                 */
*/*%AFS01B: D  (YES,,NO,%AFS06) ARE THERE ANY EXTENSIONS?            */
*/*         P  INITIALIZE BASE ARRAY SUBSCRIPT TO ONE                */
*/*         P  INITIALIZE ASST EXT ARRAY SUBSCRIPT TO TWO            */
*/*%AFS01:  P  GET PTR TO ASST EXTENSION                             */
*/*%AFS02:  P  GET PTR TO LPME EXTENSION                             */
*/*%AFS02A: S  AFSFREE: FREE AN LPME EXTENSION                       */
*/*         D  (YES,%AFS03,NO,) RETURN CODE ZERO?                    */
*/*         P  INCREMENT THE ASST EXT ARRAY SUBSCRIPT                */
*/*         D  (YES,%AFS04,NO,) REACHED END OF ASST EXT ARRAY?       */
*/*         D  (YES,,NO,%AFS04) ANYMORE LPME EXTENSIONS?             */
*/*         P  SET PTR TO LPME EXTENSION                             */
*/*         D  (YES,%AFS02A,NO,%AFS04) IS THIS AN LPME EXTENSION?    */
*/*%AFS03:  P  INCREMENT THE ASST EXT ARRAY SUBSCRIPT                */
*/*         D  (YES,%AFS04,NO,) REACHED END OF ASST EXT ARRAY?       */
*/*         D  (YES,%AFS02,NO,) ANYMORE LPME EXTENSIONS?             */
*/*%AFS04:  P  SET WORK PTR TO ASST EXT                              */
*/*         S  AFSFREE: FREE AN ASST EXTENSION                       */
*/*         D  (YES,%AFS05,NO,) RETURN CODE ZERO?                    */
*/*         P  INCREMENT THE BASE ARRAY SUBSCRIPT                    */
*/*         D  (YES,%AFS06,NO,) REACHED END OF BASE ARRAY?           */
*/*         D  (YES,,NO,%AFS06) ANYMORE ASST EXTENSIONS?             */
*/*         P  GET PTR TO ASST EXTENSION                             */
*/*         D  (YES,,NO,%AFS06) IS THIS AN ASST EXTENSION            */
*/*         P  (,%AFS02) RESET ASST EXT ARRAY SUBSCRIPT TO ONE       */
*/*%AFS05:  P  INCREMENT THE BASE ARRAY SUBSCRIPT                    */
*/*         D  (YES,%AFS06,NO,) REACHED END OF BASE ARRAY            */
*/*         D  (YES,,NO,%AFS06) ANYMORE ASST EXTENSIONS?             */
*/*         P  (,%AFS01) RESET ASST EXT ARRAY SUBSCRIPT TO ONE       */
*/*%AFS06:  P  SET THE WORK PTR TO ASPCT BASE                        */
*/*         S  AFSFREE: FREE THE ASPCT BASE                          */
*/*         R  RETURN TO CALLER                                      */
*                                                                  0925
         EJECT
*ILRAFS00:                                                         0925
*   PROCEDURE OPTIONS(NOSAVE,NOSAVEAREA);                          0925
*                                                                  0925
ILRAFS00 DS    0H                                                  0926
*/*A-000000-999999                                           @Z40WPWH*/
*                                                                  0926
*   DECLARE                                                        0926
*     AFSASPCT PTR(31),             /* PTR TO ASPCT BASE             */
*     AFSEXPTR PTR(31),             /* PTR TO ASPCT EXTENSIONS       */
*     AFSLNGTH FIXED(31),           /* FREEMAIN LENGTH               */
*     AFSWORK PTR(31),              /* FREEMAIN ADDRESS              */
*     AFSRET1 FIXED(31),            /* INTERNAL RETURN CODE          */
*     AFSRET2 FIXED(31),            /* INTERNAL RETURN CODE          */
*     AFSA FIXED(31),               /* ASST EXT ARRAY SUBSCRIPT      */
*     AFSSPID FIXED(31),            /* SUBPOOL ID FOR FREEMAIN       */
*     AFSB FIXED(15),               /* BASE ARRAY SUBSCRIPT          */
*     AFSZERO FIXED(31) CONSTANT(0),                               0926
*     AFSSP230 FIXED(31) CONSTANT(230),                            0926
*     AFSSP255 FIXED(31) CONSTANT(255),                            0926
*     AFS257 FIXED(31) CONSTANT(257),                              0926
*     AFSONE FIXED(15) CONSTANT(1),                                0926
*     AFS44 FIXED(31) CONSTANT(44),                                0926
*     AFSTWO FIXED(15) CONSTANT(2),                                0926
*     AFSFIVE FIXED(15) CONSTANT(5),                               0926
*     AFSREG3 FIXED(31),            /* REGISTER 3 SAVEAREA           */
*     AFSREG4 FIXED(31),            /* REGISTER 4 SAVEAREA           */
*     AFSREG7 FIXED(31);            /* REGISTER 7 SAVEAREA           */
*   RFY                                                            0927
*    (R0,                                                          0927
*     R1,                                                          0927
*     R3,                                                          0927
*     R4,                                                          0927
*     R7,                                                          0927
*     R14) RSTD;                                                   0927
*   AFSRET1=R14;                    /* SAVE THE RETURN ADDRESS       */
         ST    R14,AFSRET1                                         0928
*   AFSASPCT=R1;                    /* SAVE PTR TO ASPCT BASE        */
         ST    R1,AFSASPCT                                         0929
*   AFSLNGTH=R0;                    /* SAVE INPUT LENGTH             */
         ST    R0,AFSLNGTH                                         0930
*   AFSREG3=R3;                     /* SAVE CALLER'S REG 3           */
         ST    R3,AFSREG3                                          0931
*   AFSREG4=R4;                     /* SAVE CALLER'S REG 4           */
         ST    R4,AFSREG4                                          0932
*   AFSREG7=R7;                     /* SAVE CALLER'S REG 7           */
         ST    R7,AFSREG7                                          0933
*   RFY                                                            0934
*    (R0,                                                          0934
*     R1,                                                          0934
*     R3,                                                          0934
*     R4,                                                          0934
*     R7,                                                          0934
*     R14) UNRSTD;                                                 0934
*   IF AFSLNGTH=LENGTH(ASPCT)       /* CHECK WHICH SUBPOOL TO USE    */
*     THEN                          /* ACTIVE ASPCT                  */
         L     @12,AFSLNGTH                                        0935
         C     @12,@CF01555                                        0935
         BNE   @RF00935                                            0935
*     AFSSPID=AFSSP255;             /* SET SUBPOOL FOR LSQA          */
         MVC   AFSSPID(4),@CF01539                                 0936
*   ELSE                            /* I/O BUFFERS                   */
*     AFSSPID=AFSSP230;             /* SET SUBPOOL FOR USER KEY      */
         B     @RC00935                                            0937
@RF00935 MVC   AFSSPID(4),@CF01537                                 0937
         EJECT
*                                                                  0938
*/********************************************************************/
*/*                                                                  */
*/*  A TEST IS NOW MADE FOR EXTENSIONS. IF THERE ARE EXTENSIONS,     */
*/*  THEY ARE FREED FIRST. FIRST ALL LPME EXTENSIONS FOR A PARTICULAR*/
*/*  ASST EXTENSION ARE FREED, THEN THAT ASST EXTENSION IS FREED.    */
*/*  THIS PROCESS IS REPEATED UNTIL ALL EXTENSIONS ARE FREED.        */
*/*                                                                  */
*/********************************************************************/
*                                                                  0938
*   IF AFSASPCT->ASPAEXCT^=AFSZERO  /* ARE THERE ANY EXTENSIONS?     */
*     THEN                                                         0938
@RC00935 L     @12,AFSASPCT                                        0938
         LH    @11,ASPAEXCT(,@12)                                  0938
         LTR   @11,@11                                             0938
         BZ    @RF00938                                            0938
*     DO;                           /* YES                           */
*       AFSB=AFSONE;                /* SET BASE SUBSCRIPT FOR FIRST
*                                      ASST EXTENSION                */
         LA    @07,1                                               0940
         STH   @07,AFSB                                            0940
*       AFSA=AFSTWO;                /* SET ASST SUBSCRIPT FOR FIRST
*                                      LPME EXTENSION OFF FIRST ASST
*                                      EXTENSION. GET PTR TO FIRST 0941
*                                      ASST EXT                      */
         LA    AFSA,2                                              0941
*       AFSEXPTR=AFSASPCT->ASPASSTP(AFSB);                         0942
         SLA   @07,2                                               0942
         L     AFSEXPTR,ASPASSTP-4(@07,@12)                        0942
*       DO WHILE AFSEXPTR^=AFSZERO; /* LOOP UNTIL WE HAVE PROCESSED
*                                      ALL ASST EXTENSIONS GET PTR TO
*                                      LPME EXT                      */
         B     @DE00943                                            0943
@DL00943 DS    0H                                                  0944
*         AFSWORK=AFSEXPTR->ASPASSTE(AFSA);                        0944
         LR    @07,AFSA                                            0944
         SLA   @07,2                                               0944
         L     AFSWORK,ASPASSTE-4(@07,AFSEXPTR)                    0944
*         DO WHILE AFSWORK^=AFSZERO;/* LOOP UNTIL WE HAVE PROCESSED
*                                      ALL LPME EXTENSIONS FOR A   0945
*                                      PARTICULAR ASST EXTENSION     */
         B     @DE00945                                            0945
@DL00945 DS    0H                                                  0946
*           CALL AFSFREE;           /* FREE AN LPME EXTENSION        */
         BAL   @14,AFSFREE                                         0946
*           RFY                                                    0947
*             R15 RSTD;                                            0947
*           IF R15=AFSZERO          /* SUCCESSFUL FREEMAIN?          */
*             THEN                                                 0948
         LTR   R15,R15                                             0948
         BNZ   @RF00948                                            0948
*             DO;                   /* YES                           */
*               RFY                                                0950
*                 R15 UNRSTD;                                      0950
*               AFSA=AFSA+AFSONE;   /* INCREMENT ASST SUBSCRIPT      */
         AL    AFSA,@CF00098                                       0951
*               IF AFSA<AFS257      /* REACHED END OF ARRAY          */
*                 THEN              /* NO, GET PTR TO NEXT LPME EX   */
         C     AFSA,@CF01541                                       0952
         BNL   @RF00952                                            0952
*                 AFSWORK=AFSEXPTR->ASPASSTE(AFSA);                0953
         LR    @07,AFSA                                            0953
         SLA   @07,2                                               0953
         L     AFSWORK,ASPASSTE-4(@07,AFSEXPTR)                    0953
*               ELSE                /* YES, FORCE EXIT FROM LOOP     */
*                 AFSWORK=AFSZERO;                                 0954
         B     @RC00952                                            0954
@RF00952 SLR   AFSWORK,AFSWORK                                     0954
*             END;                  /* THIS IS THE LOGICAL END OF THE
*                                      DO WHILE LOOP FOR LPME      0955
*                                      EXTENSIONS. PHYSICAL END IS 0955
*                                      AFTER THE ERROR CODE PROCESS
*                                      ING FOR A NON-ZERO RETURN FROM
*                                      AFSFREE.                      */
         EJECT
*                                                                  0956
*/********************************************************************/
*/* THIS SECTION WILL PROCESS A NON-ZERO RETURN CODE FROM AFSFREE    */
*/* FOR LPME EXTENSIONS. PROCESSING CONSISTS OF GETTING THE POINTER  */
*/* TO THE NEXT LPME EXTENSION, AND VERIFYING THAT IT IS AN LPME     */
*/* EXTENSION. IF IT IS WE WILL CONTINUE FREEING LPME EXTENSIONS,    */
*/* IF NOT, WE WILL FORCE AN EXIT FROM THE LOOP.                     */
*/********************************************************************/
*                                                                  0956
*           ELSE                                                   0956
*             DO;                   /* NON-ZERO RETURN FROM AFSFREE  */
         B     @RC00948                                            0956
@RF00948 DS    0H                                                  0957
*               AFSA=AFSA+AFSONE;   /* INCREMENT ASST SUBSCRIPT      */
         AL    AFSA,@CF00098                                       0957
*               IF AFSA<AFS257      /* REACHED END OF ASST ARRAY?    */
*                 THEN                                             0958
         C     AFSA,@CF01541                                       0958
         BNL   @RF00958                                            0958
*                 DO;               /* NO GET PTR TO NEXT LPME EXT   */
*                   AFSWORK=AFSEXPTR->ASPASSTE(AFSA);/* IS THIS A  0960
*                                      VALID LPME EXT?               */
         LR    @07,AFSA                                            0960
         SLA   @07,2                                               0960
         L     AFSWORK,ASPASSTE-4(@07,AFSEXPTR)                    0960
*                   IF AFSWORK->ASPEIDNT^='LPME' THEN/* NO           */
         CLC   ASPEIDNT(4,AFSWORK),@CC01550                        0961
         BE    @RF00961                                            0961
*                     AFSWORK=AFSZERO;/* FORCE LOOP EXIT             */
         SLR   AFSWORK,AFSWORK                                     0962
*                 END;                                             0963
*               ELSE                /* YES, REACHED END OF ARRAY     */
*                 AFSWORK=AFSZERO;  /* FORCE LOOP EXIT               */
         B     @RC00958                                            0964
@RF00958 SLR   AFSWORK,AFSWORK                                     0964
*             END;                                                 0965
@RC00958 DS    0H                                                  0966
*         END;                      /* THIS IS THE PHYSICAL END OF 0966
*                                      THE DO WHILE LOOP FOR LPME  0966
*                                      EXTENSIONS.                   */
@RC00948 DS    0H                                                  0966
@DE00945 LTR   AFSWORK,AFSWORK                                     0966
         BNZ   @DL00945                                            0966
         EJECT
*                                                                  0967
*/********************************************************************/
*/* THIS SECTION PROCESSES THE ASST EXTENSIONS                       */
*/********************************************************************/
*                                                                  0967
*         AFSWORK=AFSEXPTR;         /* SET FREEMAIN POINTER TO AN  0967
*                                      ASST EXTENSION                */
         LR    AFSWORK,AFSEXPTR                                    0967
*         CALL AFSFREE;             /* FREE THE ASST EXTENSION       */
         BAL   @14,AFSFREE                                         0968
*         RFY                                                      0969
*           R15 RSTD;                                              0969
*         IF R15=AFSZERO            /* FREEMAIN SUCCESSFUL?          */
*           THEN                                                   0970
         LTR   R15,R15                                             0970
         BNZ   @RF00970                                            0970
*           DO;                     /* YES                           */
*             RFY                                                  0972
*               R15 UNRSTD;                                        0972
*             AFSB=AFSB+AFSONE;     /* INCREMENT BASE SUBSCRIPT      */
         LA    @12,1                                               0973
         LH    @08,AFSB                                            0973
         ALR   @08,@12                                             0973
         STH   @08,AFSB                                            0973
*             IF AFSB<AFSFIVE       /* REACHED END OF ARRAY?         */
*               THEN                                               0974
         C     @08,@CF00131                                        0974
         BNL   @RF00974                                            0974
*               DO;                 /* NO GET PTR TO NEXT ASST EXT   */
*                 AFSEXPTR=AFSASPCT->ASPASSTP(AFSB);               0976
         LH    @07,AFSB                                            0976
         SLA   @07,2                                               0976
         L     @01,AFSASPCT                                        0976
         L     AFSEXPTR,ASPASSTP-4(@07,@01)                        0976
*                 AFSA=AFSONE;      /* RESET ASST SUBSCRIPT          */
         LR    AFSA,@12                                            0977
*               END;                                               0978
*             ELSE                  /* YES, REACHED END OF ARRAY     */
*               AFSEXPTR=AFSZERO;   /* FORCE LOOP EXIT               */
         B     @RC00974                                            0979
@RF00974 SLR   AFSEXPTR,AFSEXPTR                                   0979
*           END;                    /* THIS THE LOGICAL END OF THE DO
*                                      WHILE LOOP FOR ASST         0980
*                                      EXTENSIONS. PHYSICAL END IS 0980
*                                      AFTER THE ERROR CODE PROCESS
*                                      ING FOR A NON-ZERO RETURN FROM
*                                      AFSFREE                       */
         EJECT
*                                                                  0981
*/********************************************************************/
*/* THIS SECTION WILL PROCESS A NON-ZERO RETURN CODE FROM AFSFREE    */
*/* FOR ASST EXTENSIONS. PROCESSING CONSISTS OF GETTING THE POINTER  */
*/* TO THE NEXT ASST EXTENSION, AND VERIFYING THAT IT IS AN ASST     */
*/* EXTENSION. IF IT IS WE WILL CONTINUE FREEING ASST EXTENSIONS,    */
*/* IF NOT, WE WILL FORCE AN EXIT FROM THE LOOP.                     */
*/********************************************************************/
*                                                                  0981
*         ELSE                                                     0981
*           DO;                     /* NON-ZERO RETURN CODE FROM   0981
*                                      AFSFREE                       */
         B     @RC00970                                            0981
@RF00970 DS    0H                                                  0982
*             AFSB=AFSB+AFSONE;     /* INCREMENT BASE SUBSCRIPT      */
         LA    @12,1                                               0982
         LH    @08,AFSB                                            0982
         ALR   @08,@12                                             0982
         STH   @08,AFSB                                            0982
*             IF AFSB<AFSFIVE       /* REACHED END OF ARRAY          */
*               THEN                                               0983
         C     @08,@CF00131                                        0983
         BNL   @RF00983                                            0983
*               DO;                 /* GET PTR TO NEXT ASST          */
*                 AFSEXPTR=AFSASPCT->ASPASSTP(AFSB);/* VALID ASST  0985
*                                      EXTENSION?                    */
         LH    @07,AFSB                                            0985
         SLA   @07,2                                               0985
         L     @01,AFSASPCT                                        0985
         L     AFSEXPTR,ASPASSTP-4(@07,@01)                        0985
*                 IF AFSEXPTR->ASPEIDNT='ASST' THEN/* YES            */
         CLC   ASPEIDNT(4,AFSEXPTR),@CC01507                       0986
         BNE   @RF00986                                            0986
*                   AFSA=AFSONE;    /* RESET ASST SUBSCRIPT          */
         LR    AFSA,@12                                            0987
*                 ELSE              /* NO                            */
*                   AFSEXPTR=AFSZERO;/* FORCE LOOP EXIT              */
         B     @RC00986                                            0988
@RF00986 SLR   AFSEXPTR,AFSEXPTR                                   0988
*               END;                                               0989
*             ELSE                  /* YES, REACHED END OF ARRAY     */
*               AFSEXPTR=AFSZERO;   /* FORCE LOOP EXIT               */
         B     @RC00983                                            0990
@RF00983 SLR   AFSEXPTR,AFSEXPTR                                   0990
*           END;                                                   0991
@RC00983 DS    0H                                                  0992
*       END;                        /* PHYSICAL END OF DO WHILE LOOP
*                                      FOR ASST EXTENSIONS           */
@RC00970 DS    0H                                                  0992
@DE00943 LTR   AFSEXPTR,AFSEXPTR                                   0992
         BNZ   @DL00943                                            0992
*     END;                                                         0993
         EJECT
*                                                                  0994
*/********************************************************************/
*/* THIS SECTION FREES THE ASPCT BASE                                */
*/********************************************************************/
*                                                                  0994
*   AFSWORK=AFSASPCT;               /* GET PTR TO THE ASPCT BASE     */
@RF00938 L     AFSWORK,AFSASPCT                                    0994
*   CALL AFSFREE;                   /* FREE THE BASE                 */
         BAL   @14,AFSFREE                                         0995
         EJECT
*   RFY                                                            0996
*    (R3,                                                          0996
*     R4,                                                          0996
*     R7,                                                          0996
*     R14) RSTD;                                                   0996
*   R3=AFSREG3;                     /* RESTORE CALLER'S REG 3        */
         L     R3,AFSREG3                                          0997
*   R4=AFSREG4;                     /* RESTORE CALLER'S REG 4        */
         L     R4,AFSREG4                                          0998
*   R7=AFSREG7;                     /* RESTORE CALLER'S REG 7        */
         L     R7,AFSREG7                                          0999
*   R14=AFSRET1;                    /* GET RETURN ADDRESS            */
         L     R14,AFSRET1                                         1000
*   RETURN;                         /* RETURN TO CALLER              */
@EL00008 DS    0H                                                  1001
@EF00008 DS    0H                                                  1001
@ER00008 BR    @14                                                 1001
*   RFY                                                            1002
*    (R3,                                                          1002
*     R4,                                                          1002
*     R7,                                                          1002
*     R14) UNRSTD;                                                 1002
         EJECT
*                                                                  1003
*/********************************************************************/
*/*                                                                  */
*/*  AFSFREE:  FREE ASPCT EXTN OF STORAGE                            */
*/*                                                                  */
*/*  INPUT:  ADDRESS OF EXTN IN REGISTER 1                           */
*/*                                                                  */
*/*  PROCESS:  SET UP REGS, ISSUE FREEMAIN MACRO TO FREE ASPCT EXTN. */
*/*                                                                  */
*/*  OUTPUT:  RETURN CODE IN REGISTER 15                             */
*/*             00 - NORMAL RETURN                                   */
*/*             44 - FREEMAIN RETURNED ERROR CODE                    */
*/*                                                                  */
*/********************************************************************/
*/*AFSFREE: CHART (AREF)                                             */
*/*HEADER                                                          1003
*/*  ILRAFS00                                                      1003
*/* AFSFREE - FREEMAIN THE ASPCT                                     */
*/*AFSFREE: E  ENTRY                                                 */
*/*         P  SAVE THE RETURN ADDRESS                               */
*/*         N  THIS NEXT TEST AND RESULTING LEGS OF CODE, IS A MACRO */
*/*         N  PASS TEST AND EXPANSION.                              */
*/*         D  (YES,,NO,%AFS07) SVC OK?                              */
*/*         P  LOAD REG 14 WITH SUBPOOL ID                           */
*/*         P  LOAD REG 0 WITH LENGTH                                */
*/*         P  LOAD REG 1 WITH ADDRESS OF AREA TO BE FREED           */
*/*         S  (,%AFS08) FREEMAIN: FREE THE ASPCT                    */
*/*%AFS07:  P  LOAD REG 0 WITH LENTH                                 */
*/*         P  LOAD REG 1 WITH ADDRESS OF AREA TO BE FREED           */
*/*         P  LOAD REG 4 WITH CURRENT TCB ADDRESS                   */
*/*         P  LOAD REG 7 WITH CURRENT ASCB ADDRESS                  */
*/*         P  LOAD REG 3 WITH SUBPOOL ID                            */
*/*         S  IEAVGM00: FREE THE ASPCT                              */
*/*%AFS08:  D  (YES,%AFS09,NO,) ZERO RETURN CODE?                    */
*/*         P  SAVE FREEMAINS RETURN CODE                            */
*/*         P  SET RETURN CODE TO 68                                 */
*/*%AFS09:  R  RETURN TO MAINLINE                                    */
*                                                                  1003
         EJECT
*AFSFREE:                           /* FREEMAIN AN EXTN OF ASPCT     */
*   PROCEDURE OPTIONS(NOSAVE,NOSAVEAREA);                          1003
AFSFREE  DS    0H                                                  1004
*   RFY                                                            1004
*     R14 RSTD;                                                    1004
*   AFSRET2=R14;                    /* SAVE THE RETURN ADDRESS       */
         ST    R14,AFSRET2                                         1005
*   RFY                                                            1006
*    (R0,                                                          1006
*     R1,                                                          1006
*     R3,                                                          1006
*     R4,                                                          1006
*     R7) RSTD;                                                    1006
*   R0=AFSLNGTH;                    /* GET THE LENGTH OF AREA TO BE
*                                      FREED                         */
         L     R0,AFSLNGTH                                         1007
*   R1=AFSWORK;                     /* GET ADDRESS OF AREA TO FREE   */
         LR    R1,AFSWORK                                          1008
*   R4=PSATOLD;                     /* GET CURRENT TCB ADDRESS       */
         L     R4,PSATOLD                                          1009
*   R7=PSAAOLD;                     /* GET CURRENT ASCB ADDRESS      */
         L     R7,PSAAOLD                                          1010
*   R3=AFSSPID;                     /* GET SUBPOOL ID                */
         L     R3,AFSSPID                                          1011
*   GENERATE REFS(R0,R1,R3,R4,R7,CVTCRMN,CVTMAP);                  1012
         FREEMAIN RC,A=(1),LV=(0),SP=(3),BRANCH=YES
*   RFY                                                            1013
*    (R0,                                                          1013
*     R1,                                                          1013
*     R3,                                                          1013
*     R4,                                                          1013
*     R7,                                                          1013
*     R14) UNRSTD;                                                 1013
*   RFY                                                            1014
*    (R14,                                                         1014
*     R15) RSTD;                                                   1014
*   IF R15^=AFSZERO                 /* FREEMAIN SUCCESSFUL?          */
*     THEN                          /* NO                            */
         LTR   R15,R15                                             1015
         BZ    @RF01015                                            1015
*     R15=AFS44;                    /* SET RETURN CODE TO 44         */
         LA    R15,44                                              1016
*   R14=AFSRET2;                    /* GET RETURN ADDRESS            */
@RF01015 L     R14,AFSRET2                                         1017
*   RFY                                                            1018
*    (R14,                                                         1018
*     R15) UNRSTD;                                                 1018
*   END AFSFREE;                                                   1019
@EL00009 DS    0H                                                  1019
@EF00009 DS    0H                                                  1019
@ER00009 BR    @14                                                 1019
*   END ILRAFS00;                                                  1020
*   END ILRVSAMI                                                   1021
*                                                                  1021
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.     */
*/*%INCLUDE SYSLIB  (ILRASPCT)                                       */
*/*%INCLUDE SYSLIB  (ILRASMVT)                                       */
*/*%INCLUDE SYSLIB  (ILREPATH)                                       */
*/*%INCLUDE SYSLIB  (CVT     )                                       */
*/*%INCLUDE SYSLIB  (IHAPSA  )                                       */
*/*%INCLUDE SYSLIB  (IFGRPL  )                                       */
*/*%INCLUDE SYSLIB  (ILRAFS00)                                       */
*                                                                  1021
*       ;                                                          1021
@DATA    DS    0H
@DATD    DSECT
         DS    0F
ILRVSAMI CSECT
         DS    0F
@CF00098 DC    F'1'
@CF00114 DC    F'2'
@CF00063 DC    F'4'
@CF00131 DC    F'5'
@CF00093 DC    F'12'
@CF00143 DC    F'16'
@CF00120 DC    F'20'
@CF00141 DC    F'24'
@CF00122 DC    F'28'
@CF00137 DC    F'40'
@CF00139 DC    F'64'
@CF01537 DC    F'230'
@CF01539 DC    F'255'
@CF00150 DC    F'256'
@CF01541 DC    F'257'
@CF01555 DC    F'1088'
@DATD    DSECT
         DS    0D
ASPCTPTR DS    A
ASPEXPTR DS    A
LPMEPTR  DS    A
ASMVTWPT DS    A
EPAPTR   DS    A
PARMPTR  DS    A
RETCODE  DS    F
RETCODE1 DS    F
RETADDR1 DS    F
RETADDR2 DS    F
LPMEXT   DS    F
LPMECNTL DS    F
ASSTEXT  DS    F
ASSTCNTL DS    F
BASE     DS    F
ASST     DS    F
MAXEXTN  DS    F
RETASPCT DS    A
BUFFER   DS    A
RPLPTR   DS    A
FBCODE   DS    F
AFSASPCT DS    A
AFSLNGTH DS    F
AFSRET1  DS    F
AFSRET2  DS    F
AFSSPID  DS    F
AFSREG3  DS    F
AFSREG4  DS    F
AFSREG7  DS    F
AFSB     DS    H
         DS    CL2
WKAVKEY  DS    CL12
         ORG   WKAVKEY
WKAKEY   DS    CL8
EXTNUMB  DS    FL4
         ORG   WKAVKEY+12
FLAGS    DS    BL1
         ORG   FLAGS
BACKOUT  DS    BL1
PARTIALF EQU   FLAGS+0
@NM00003 EQU   FLAGS+0
         ORG   FLAGS+1
         DS    CL3
SAVEREGA DS    CL72
         ORG   SAVEREGA
@NM00004 DS    CL12
SAVREGSA DS    CL60
         ORG   SAVEREGA+72
ILRVSAMI CSECT
         NOPR  ((@ENDDATD-@DATD)/513*16)
         DS    0F
@SIZDATD DC    AL1(0)
         DC    AL3(@ENDDATD-@DATD)
         DS    0D
@CC01507 DC    C'ASST'
@CC01550 DC    C'LPME'
VSMPATCH DS    CL160
PTRS     DC    AL4(GETASPCT)
         DC    AL4(PUTASPCT)
         DC    AL4(RETERASE)
         DC    AL4(RETERASE)
@DATD    DSECT
         DS    0F
BLDGENCB DS    CL(GENBSIZE)               PARM LIST FOR GENCB OF RPL
         DS    0F
BSHOWCB  DS    CL(SHOWSIZE)               PARM LIST FOR SHOWCB OF RPL
@DATD    DSECT
         ORG   *+1-(*-@DATD)/(*-@DATD) INSURE DSECT DATA
@ENDDATD EQU   *
ILRVSAMI CSECT
@00      EQU   00                      EQUATES FOR REGISTERS 0-15
@01      EQU   01
@02      EQU   02
@03      EQU   03
@04      EQU   04
@05      EQU   05
@06      EQU   06
@07      EQU   07
@08      EQU   08
@09      EQU   09
@10      EQU   10
@11      EQU   11
@12      EQU   12
@13      EQU   13
@14      EQU   14
@15      EQU   15
AFSA     EQU   @11
AFSWORK  EQU   @12
AFSEXPTR EQU   @08
I        EQU   @02
RETRY    EQU   @03
OPCPTR   EQU   @02
R0       EQU   @00
R1       EQU   @01
R3       EQU   @03
R4       EQU   @04
R5       EQU   @05
R6       EQU   @06
R7       EQU   @07
R8       EQU   @08
R9       EQU   @09
R10      EQU   @10
R11      EQU   @11
R12      EQU   @12
R13      EQU   @13
R14      EQU   @14
R15      EQU   @15
ASMVTPTR EQU   @03
R2       EQU   @02
PSA      EQU   0
FLCRNPSW EQU   PSA
FLCROPSW EQU   PSA+8
FLCICCW2 EQU   PSA+16
FLCCVT   EQU   FLCICCW2
PSAEEPSW EQU   PSA+132
PSAESPSW EQU   PSA+136
FLCSVILC EQU   PSAESPSW+1
PSAEPPSW EQU   PSA+140
FLCPIILC EQU   PSAEPPSW+1
FLCPICOD EQU   PSAEPPSW+2
PSAPICOD EQU   FLCPICOD+1
FLCTEA   EQU   PSAEPPSW+4
FLCPER   EQU   PSA+152
FLCMCLA  EQU   PSA+168
FLCIOEL  EQU   FLCMCLA+4
FLCIOA   EQU   FLCMCLA+16
FLCFSA   EQU   FLCMCLA+80
PSATOLD  EQU   PSA+540
PSAAOLD  EQU   PSA+548
PSASUPER EQU   PSA+552
PSASUP1  EQU   PSASUPER
PSASUP2  EQU   PSASUPER+1
PSASUP3  EQU   PSASUPER+2
PSASUP4  EQU   PSASUPER+3
PSACLHT  EQU   PSA+640
PSALKSA  EQU   PSA+696
PSAHLHI  EQU   PSA+760
PSADSSFL EQU   PSA+836
PSADSSF1 EQU   PSADSSFL
PSADSSF3 EQU   PSADSSFL+2
PSADSSF4 EQU   PSADSSFL+3
PSARSVT  EQU   PSA+896
ROUTINE  EQU   0
PARMLIST EQU   0
@NM00001 EQU   PARMLIST
OPCODE   EQU   @NM00001
BASEPTR  EQU   PARMLIST+4
SSYMPTR  EQU   BASEPTR
EPATHPTR EQU   PARMLIST+8
SSYM     EQU   0
IFGRPL   EQU   0
RPLCOMN  EQU   IFGRPL
RPLIDWD  EQU   RPLCOMN
RPLLEN   EQU   RPLIDWD+3
RPLECB   EQU   RPLCOMN+8
RPLFDBWD EQU   RPLCOMN+12
RPLFDBK  EQU   RPLFDBWD+1
RPLRTNCD EQU   RPLFDBK
RPLCNDCD EQU   RPLFDBK+1
RPLCMPON EQU   RPLCNDCD
RPLFDB2  EQU   RPLCMPON
RPLERRCD EQU   RPLCNDCD+1
RPLFDB3  EQU   RPLERRCD
RPLKEYLE EQU   RPLCOMN+16
RPLAREA  EQU   RPLCOMN+32
RPLARG   EQU   RPLCOMN+36
RPLOPTCD EQU   RPLCOMN+40
RPLOPT1  EQU   RPLOPTCD
RPLECBSW EQU   RPLOPT1
RPLOPT2  EQU   RPLOPTCD+1
RPLADR   EQU   RPLOPT2
RPLOPT3  EQU   RPLOPTCD+2
RPLNXTRP EQU   RPLCOMN+44
RPLOPTC2 EQU   RPLCOMN+56
RPLOPT5  EQU   RPLOPTC2
RPLWRTYP EQU   RPLOPT5
RPLOPT6  EQU   RPLOPTC2+1
RPLUNTYP EQU   RPLOPT6
RPLOPT7  EQU   RPLOPTC2+2
RPLCNOPT EQU   RPLOPT7
RPLOPT8  EQU   RPLOPTC2+3
RPLRBAR  EQU   RPLCOMN+60
RPLAIXID EQU   RPLRBAR+2
RPLEXTDS EQU   RPLCOMN+68
RPLEXTD1 EQU   RPLEXTDS
ASPCT    EQU   0
ASPHDR   EQU   ASPCT
ASPBKEY  EQU   ASPHDR+8
ASPSSYM  EQU   ASPBKEY
ASPFLAG  EQU   ASPHDR+28
ASPLEXCT EQU   ASPHDR+44
ASPAEXCT EQU   ASPHDR+46
ASPASSTP EQU   ASPCT+48
ASPEXTSN EQU   0
ASPEHDR  EQU   ASPEXTSN
ASPEIDNT EQU   ASPEHDR
ASPEXKEY EQU   ASPEHDR+8
ASPESSYM EQU   ASPEXKEY
ASPEXTNM EQU   ASPEXKEY+8
ASPASSTN EQU   ASPEHDR+20
ASPSECTA EQU   ASPEXTSN+64
ASPLPME  EQU   0
ASPLPFLG EQU   ASPLPME
ASPVLSID EQU   ASPLPME+1
ASMVT    EQU   0
ASMFLAG1 EQU   ASMVT
ASMFLAG2 EQU   ASMVT+1
ASMNOSAV EQU   ASMFLAG2
ASMSTAGQ EQU   ASMVT+32
ASMPCCWQ EQU   ASMVT+64
ASMSTGXA EQU   ASMVT+136
ASMLSAI  EQU   ASMVT+144
ASMGOSQS EQU   ASMVT+152
ASMPEX   EQU   ASMVT+224
ASMSWKPC EQU   ASMVT+328
ASMWKSA1 EQU   ASMVT+368
ASMWKSA2 EQU   ASMVT+448
ASMWKSA3 EQU   ASMVT+528
ASMWKSA4 EQU   ASMVT+608
ASMWKSA5 EQU   ASMVT+688
ASMPOOLS EQU   0
ASMCPAVQ EQU   ASMPOOLS+8
ASMCPAVL EQU   ASMCPAVQ
ASMCPRSQ EQU   ASMPOOLS+16
EPATH    EQU   0
EPAVSAM  EQU   EPATH
EPAVWKA  EQU   EPAVSAM+4
EPATMWKA EQU   EPAVWKA
EPAAASP  EQU   EPAVSAM+8
EPABASP  EQU   EPAVSAM+12
EPARASP  EQU   EPAVSAM+16
EPARTYRG EQU   EPAVSAM+20
EPABKSLT EQU   EPARTYRG
EPAFLAG1 EQU   EPAVSAM+24
EPAVSAMI EQU   EPAFLAG1
EPAGRPOP EQU   EPAFLAG1
EPARPLB  EQU   EPAFLAG1
EPAFLAG2 EQU   EPAVSAM+25
CVTMAP   EQU   0
CVTDAR   EQU   CVTMAP+72
CVTFLGS1 EQU   CVTDAR
CVTDCB   EQU   CVTMAP+116
CVTIERLC EQU   CVTMAP+144
CVTOPTA  EQU   CVTMAP+182
CVTOPTB  EQU   CVTMAP+183
CVTGTF   EQU   CVTMAP+236
CVTGTFST EQU   CVTGTF
CVTGTFS  EQU   CVTGTFST
CVTSTATE EQU   CVTGTFST
CVTTMODE EQU   CVTGTFST
CVTFORM  EQU   CVTGTFST
CVTAQAVT EQU   CVTMAP+240
CVTTCMFG EQU   CVTAQAVT
CVTVOLM2 EQU   CVTMAP+244
CVTTATA  EQU   CVTVOLM2
CVTTSKS  EQU   CVTTATA
CVTVOLF2 EQU   CVTTSKS
CVTTAT   EQU   CVTTATA+1
CVTATER  EQU   CVTMAP+248
CVTEXT1  EQU   CVTMAP+252
CVTPURG  EQU   CVTMAP+260
CVTQMSG  EQU   CVTMAP+268
CVTDMSR  EQU   CVTMAP+272
CVTRSV37 EQU   CVTDMSR
CVTDMSRF EQU   CVTRSV37
CVTERPV  EQU   CVTMAP+316
CVTINTLA EQU   CVTMAP+320
CVTAPF   EQU   CVTMAP+324
CVTEXT2  EQU   CVTMAP+328
CVTHJES  EQU   CVTMAP+332
CVTPGSIA EQU   CVTMAP+348
CVTA1F1  EQU   CVTMAP+356
CVTSYSK  EQU   CVTMAP+357
CVTVOLM1 EQU   CVTMAP+380
CVTVOLF1 EQU   CVTVOLM1
CVTATMCT EQU   CVTMAP+388
CVTXTNT1 EQU   0
CVTXTNT2 EQU   0
CVTDSSV  EQU   CVTXTNT2
CVTFLGBT EQU   CVTXTNT2+5
CVTQID   EQU   CVTXTNT2+24
CVTRV400 EQU   CVTXTNT2+52
CVTRV409 EQU   CVTXTNT2+53
CVTATCVT EQU   CVTXTNT2+64
CVTRV429 EQU   CVTXTNT2+84
CVTRV438 EQU   CVTXTNT2+85
CVTRV457 EQU   CVTXTNT2+112
CVTRV466 EQU   CVTXTNT2+113
CVTFIX   EQU   0
CVTRELNO EQU   CVTFIX+252
ILRPEX   EQU   0
GMACELL  EQU   0
GMANEXT  EQU   GMACELL
CVTPTR   EQU   FLCCVT
RECADDR  EQU   FBCODE
RPL      EQU   IFGRPL
ASPASST  EQU   ASPSECTA
ASPASSTE EQU   ASPASST
ASM1WKSV EQU   ASMWKSA1
ASM1RGSV EQU   ASM1WKSV
ASM1WRKA EQU   ASM1WKSV+60
ASM2WKSV EQU   ASMWKSA2
ASM2WRKA EQU   ASM2WKSV+52
ASM2FLGS EQU   ASM2WRKA+12
ASM3WKSV EQU   ASMWKSA3
ASM4WKSV EQU   ASMWKSA4
ASM4RGSV EQU   ASM4WKSV
ASM5WKSV EQU   ASMWKSA5
ASM5RGSV EQU   ASM5WKSV
CVTS01   EQU   CVTPGSIA
CVTLPDIA EQU   CVTS01+12
CVTDIRST EQU   CVTLPDIA
CVTSLIDA EQU   CVTS01+24
CVTCTLFG EQU   CVTS01+50
CVTCRMN  EQU   CVTS01+156
CVTRV210 EQU   CVTS01+424
CVTRV219 EQU   CVTS01+425
CVTRV228 EQU   CVTS01+426
CVTRV237 EQU   CVTS01+427
CVTMFRTR EQU   CVTS01+452
CVTRV262 EQU   CVTS01+468
CVTRV271 EQU   CVTS01+469
CVTRV280 EQU   CVTS01+470
CVTRV289 EQU   CVTS01+471
CVTGSDA  EQU   CVTS01+600
PSARSVTE EQU   PSARSVT
ASPLPMEE EQU   ASPSECTA
FLC      EQU   PSA
*                                      START UNREFERENCED COMPONENTS
PSARSAV  EQU   PSARSVTE+60
PSARSTK  EQU   PSARSVTE+56
PSAESAV3 EQU   PSARSVTE+52
PSAESTK3 EQU   PSARSVTE+48
PSAESAV2 EQU   PSARSVTE+44
PSAESTK2 EQU   PSARSVTE+40
PSAESAV1 EQU   PSARSVTE+36
PSAESTK1 EQU   PSARSVTE+32
PSAPSAV  EQU   PSARSVTE+28
PSAPSTK  EQU   PSARSVTE+24
PSAMSAV  EQU   PSARSVTE+20
PSAMSTK  EQU   PSARSVTE+16
PSASSAV  EQU   PSARSVTE+12
PSASSTK  EQU   PSARSVTE+8
PSANSTK  EQU   PSARSVTE+4
PSACSTK  EQU   PSARSVTE
CVTRV628 EQU   CVTS01+728
CVTRV627 EQU   CVTS01+724
CVTRV626 EQU   CVTS01+720
CVTRV625 EQU   CVTS01+716
CVTRV624 EQU   CVTS01+712
CVTRV623 EQU   CVTS01+708
CVTRV622 EQU   CVTS01+704
CVTRV621 EQU   CVTS01+700
CVTIHASU EQU   CVTS01+696
CVTSUSP  EQU   CVTS01+692
CVTT6SVC EQU   CVTS01+688
CVTCDAL  EQU   CVTS01+684
CVTTCTL  EQU   CVTS01+680
CVTRSUME EQU   CVTS01+676
CVTJTERM EQU   CVTS01+672
CVTASMRM EQU   CVTS01+668
CVTTCASP EQU   CVTS01+664
CVT0PT03 EQU   CVTS01+660
CVT0PT0E EQU   CVTS01+656
CVTRV609 EQU   CVTS01+652
CVTCGK   EQU   CVTS01+648
CVTRAC   EQU   CVTS01+644
CVTRV606 EQU   CVTS01+640
CVTRV605 EQU   CVTS01+636
CVTRV604 EQU   CVTS01+632
CVTEFF02 EQU   CVTS01+628
CVTCBBR  EQU   CVTS01+624
CVTSSCR  EQU   CVTS01+620
CVTEVENT EQU   CVTS01+616
CVTCRCA  EQU   CVTS01+612
CVTTPIO  EQU   CVTS01+608
CVTADV   EQU   CVTS01+604
CVTGSDAB EQU   CVTGSDA
CVTQV3   EQU   CVTS01+596
CVTQV2   EQU   CVTS01+592
CVTQV1   EQU   CVTS01+588
CVTRPT   EQU   CVTS01+584
CVTSSRB  EQU   CVTS01+580
CVTCSDRL EQU   CVTS01+576
CVTEXP1  EQU   CVTS01+572
CVTRMPMT EQU   CVTS01+568
CVTRMPTT EQU   CVTS01+564
CVTVPSA  EQU   CVTS01+560
CVTVSTOP EQU   CVTS01+556
CVTGTFR8 EQU   CVTS01+552
CVTQUIT  EQU   CVTS01+548
CVTVACR  EQU   CVTS01+544
CVTWTCB  EQU   CVTS01+540
CVTSTPRS EQU   CVTS01+536
CVT0PT02 EQU   CVTS01+532
CVTDARCM EQU   CVTS01+528
CVTIRECM EQU   CVTS01+524
CVTJRECM EQU   CVTS01+520
CVTVEMS0 EQU   CVTS01+516
CVTSPFRR EQU   CVTS01+512
CVTRLSTG EQU   CVTS01+508
CVT0TC0A EQU   CVTS01+504
CVTGMBR  EQU   CVTS01+500
CVTLFRM  EQU   CVTS01+496
CVTRMBR  EQU   CVTS01+492
CVTVIOP  EQU   CVTS01+488
CVTRV307 EQU   CVTS01+486
CVTRV306 EQU   CVTS01+484
CVTRV305 EQU   CVTS01+482
CVTRV304 EQU   CVTS01+480
CVTRV303 EQU   CVTS01+478
CVTRV302 EQU   CVTS01+476
CVTTRCA  EQU   CVTS01+472
CVTRV297 EQU   CVTRV289
CVTRV296 EQU   CVTRV289
CVTRV295 EQU   CVTRV289
CVTRV294 EQU   CVTRV289
CVTRV293 EQU   CVTRV289
CVTRV292 EQU   CVTRV289
CVTRV291 EQU   CVTRV289
CVTRV290 EQU   CVTRV289
CVTRV288 EQU   CVTRV280
CVTRV287 EQU   CVTRV280
CVTRV286 EQU   CVTRV280
CVTRV285 EQU   CVTRV280
CVTRV284 EQU   CVTRV280
CVTRV283 EQU   CVTRV280
CVTRV282 EQU   CVTRV280
CVTRV281 EQU   CVTRV280
CVTRV279 EQU   CVTRV271
CVTRV278 EQU   CVTRV271
CVTRV277 EQU   CVTRV271
CVTRV276 EQU   CVTRV271
CVTRV275 EQU   CVTRV271
CVTRV274 EQU   CVTRV271
CVTRV273 EQU   CVTRV271
CVTRV272 EQU   CVTRV271
CVTRV270 EQU   CVTRV262
CVTRV269 EQU   CVTRV262
CVTRV268 EQU   CVTRV262
CVTRV267 EQU   CVTRV262
CVTRV266 EQU   CVTRV262
CVTRV265 EQU   CVTRV262
CVTRV264 EQU   CVTRV262
CVTRV263 EQU   CVTRV262
CVTVFP   EQU   CVTS01+464
CVTVSI   EQU   CVTS01+460
CVTVPSIB EQU   CVTS01+456
CVTMFACT EQU   CVTMFRTR
CVTMFCTL EQU   CVTS01+448
CVTPVBP  EQU   CVTS01+444
CVTPWI   EQU   CVTS01+440
CVTRV254 EQU   CVTS01+438
CVTRV253 EQU   CVTS01+436
CVTRV252 EQU   CVTS01+434
CVTRV251 EQU   CVTS01+433
CVTRV250 EQU   CVTS01+432
CVTRV249 EQU   CVTS01+431
CVTRV248 EQU   CVTS01+430
CVTRV247 EQU   CVTS01+429
CVTRV246 EQU   CVTS01+428
CVTRV245 EQU   CVTRV237
CVTRV244 EQU   CVTRV237
CVTRV243 EQU   CVTRV237
CVTRV242 EQU   CVTRV237
CVTRV241 EQU   CVTRV237
CVTRV240 EQU   CVTRV237
CVTRV239 EQU   CVTRV237
CVTRV238 EQU   CVTRV237
CVTRV236 EQU   CVTRV228
CVTRV235 EQU   CVTRV228
CVTRV234 EQU   CVTRV228
CVTRV233 EQU   CVTRV228
CVTRV232 EQU   CVTRV228
CVTRV231 EQU   CVTRV228
CVTRV230 EQU   CVTRV228
CVTRV229 EQU   CVTRV228
CVTRV227 EQU   CVTRV219
CVTRV226 EQU   CVTRV219
CVTRV225 EQU   CVTRV219
CVTRV224 EQU   CVTRV219
CVTRV223 EQU   CVTRV219
CVTRV222 EQU   CVTRV219
CVTRV221 EQU   CVTRV219
CVTRV220 EQU   CVTRV219
CVTRV218 EQU   CVTRV210
CVTRV217 EQU   CVTRV210
CVTRV216 EQU   CVTRV210
CVTRV215 EQU   CVTRV210
CVTRV214 EQU   CVTRV210
CVTRV213 EQU   CVTRV210
CVTRV212 EQU   CVTRV210
CVTRV211 EQU   CVTRV210
CVTLCCAT EQU   CVTS01+420
CVTPCCAT EQU   CVTS01+416
CVTIPCRP EQU   CVTS01+412
CVTIPCRI EQU   CVTS01+408
CVTIPCDS EQU   CVTS01+404
CVTAIDVT EQU   CVTS01+400
CVTSSAP  EQU   CVTS01+396
CVTEHCIR EQU   CVTS01+392
CVTEHDEF EQU   CVTS01+388
CVTDAIR  EQU   CVTS01+384
CVTPERFM EQU   CVTS01+380
CVT044R2 EQU   CVTS01+376
CVTFETCH EQU   CVTS01+372
CVTRSTWD EQU   CVTS01+368
CVTSPOST EQU   CVTS01+364
CVTIOBP  EQU   CVTS01+360
CVTASMVT EQU   CVTS01+356
CVTRECRQ EQU   CVTS01+352
CVTWSAC  EQU   CVTS01+348
CVTRV149 EQU   CVTS01+344
CVTWSAL  EQU   CVTS01+340
CVTSPSA  EQU   CVTS01+336
CVTGLMN  EQU   CVTS01+332
CVTVEAC0 EQU   CVTS01+328
CVT062R1 EQU   CVTS01+324
CVTRPOST EQU   CVTS01+320
CVTDQIQE EQU   CVTS01+316
CVTCSD   EQU   CVTS01+312
CVTLKRMA EQU   CVTS01+308
CVTRSPIE EQU   CVTS01+304
CVTRENQ  EQU   CVTS01+300
CVTLQCB  EQU   CVTS01+296
CVTFQCB  EQU   CVTS01+292
CVTQCS01 EQU   CVTS01+288
CVTAPFT  EQU   CVTS01+284
CVTPARRL EQU   CVTS01+280
CVTVWAIT EQU   CVTS01+276
CVTGSPL  EQU   CVTS01+272
CVTLSMQ  EQU   CVTS01+268
CVTGSMQ  EQU   CVTS01+264
CVTEXPRO EQU   CVTS01+260
CVTOPCTP EQU   CVTS01+256
CVTSIC   EQU   CVTS01+252
CVTTPIOS EQU   CVTS01+248
CVTRTMS  EQU   CVTS01+244
CVTSDBF  EQU   CVTS01+240
CVTSCBP  EQU   CVTS01+236
CVTSDMP  EQU   CVTS01+232
CVTSV60  EQU   CVTS01+228
CVTRTMCT EQU   CVTS01+224
CVTASCBL EQU   CVTS01+220
CVTASCBH EQU   CVTS01+216
CVTGDA   EQU   CVTS01+212
CVTASVT  EQU   CVTS01+208
CVTVVMDI EQU   CVTS01+204
CVTAQTOP EQU   CVTS01+200
CVTIOSCS EQU   CVTS01+196
CVTSDRM  EQU   CVTS01+192
CVTOPTE  EQU   CVTS01+188
CVTSTXU  EQU   CVTS01+184
CVTQUIS  EQU   CVTS01+180
CVTPARS  EQU   CVTS01+176
CVTS1EE  EQU   CVTS01+172
CVTFRAS  EQU   CVTS01+168
CVTQSAS  EQU   CVTS01+164
CVTCRAS  EQU   CVTS01+160
CVTDELCP EQU   CVTS01+152
CVTFRECL EQU   CVTS01+148
CVTGETCL EQU   CVTS01+144
CVTBLDCP EQU   CVTS01+140
CVTAUTHL EQU   CVTS01+136
CVTSCAN  EQU   CVTS01+132
CVTRV144 EQU   CVTS01+130
CVTMAXMP EQU   CVTS01+128
CVTSTCK  EQU   CVTS01+124
CVTRV139 EQU   CVTS01+123
CVTDSSAC EQU   CVTS01+122
CVTRV513 EQU   CVTS01+121
CVTIOSPL EQU   CVTS01+120
CVTPTGT  EQU   CVTS01+116
CVTCSPIE EQU   CVTS01+112
CVTSMFEX EQU   CVTS01+108
CVTOLT0A EQU   CVTS01+104
CVTSRBRT EQU   CVTS01+100
CVTPUTL  EQU   CVTS01+96
CVTASCRL EQU   CVTS01+92
CVTASCRF EQU   CVTS01+88
CVTRV326 EQU   CVTS01+84
CVTRV325 EQU   CVTS01+80
CVTRV324 EQU   CVTS01+76
CVT0VL01 EQU   CVTS01+72
CVTSHRVM EQU   CVTS01+68
CVTRV332 EQU   CVTS01+64
CVTTAS   EQU   CVTS01+60
CVTRSCN  EQU   CVTS01+56
CVTTRAC2 EQU   CVTS01+54
CVTTRACE EQU   CVTS01+52
CVTAPG   EQU   CVTS01+51
CVTSDTRC EQU   CVTCTLFG
CVTGTRCE EQU   CVTCTLFG
CVTNOMP  EQU   CVTCTLFG
CVTRSV79 EQU   CVTCTLFG
CVTDSTAT EQU   CVTCTLFG
CVTRSV78 EQU   CVTCTLFG
CVTRV333 EQU   CVTCTLFG
CVTRV323 EQU   CVTCTLFG
CVTSPVLK EQU   CVTS01+49
CVTRSV77 EQU   CVTS01+48
CVTRV331 EQU   CVTS01+44
CVTRV330 EQU   CVTS01+40
CVTRV329 EQU   CVTS01+36
CVTRV328 EQU   CVTS01+32
CVTRV322 EQU   CVTS01+28
CVTSLID  EQU   CVTSLIDA+1
CVTSYLK  EQU   CVTSLIDA
CVTRV321 EQU   CVTS01+20
CVTRV320 EQU   CVTS01+16
CVTLPDIR EQU   CVTLPDIA+1
CVTRSV69 EQU   CVTDIRST
CVTRSV68 EQU   CVTDIRST
CVTRSV67 EQU   CVTDIRST
CVTRSV66 EQU   CVTDIRST
CVTRSV65 EQU   CVTDIRST
CVTRSV64 EQU   CVTDIRST
CVTRSV63 EQU   CVTDIRST
CVTDICOM EQU   CVTDIRST
CVTPVTP  EQU   CVTS01+8
CVTLPDSR EQU   CVTS01+4
CVTGETL  EQU   CVTS01
ASM5FLGS EQU   ASM5WKSV+64
ASM5AIA  EQU   ASM5WKSV+60
ASM5GCTR EQU   ASM5WKSV+56
ASM5SR14 EQU   ASM5WKSV+52
@NM00017 EQU   ASM5RGSV+4
ASM5RG2  EQU   ASM5RGSV
@NM00016 EQU   ASM4RGSV+4
ASM4RG2  EQU   ASM4RGSV
ASM3SR13 EQU   ASM3WKSV+28
ASM3R14B EQU   ASM3WKSV+24
ASM3R14A EQU   ASM3WKSV+20
ASM3GRPA EQU   ASM3WKSV+16
ASM3TMPA EQU   ASM3WKSV+12
ASM3PIOP EQU   ASM3WKSV+8
ASM3GENQ EQU   ASM3WKSV+4
ASM3SWPQ EQU   ASM3WKSV
ASM2SR14 EQU   ASM2WRKA+16
@NM00015 EQU   ASM2WRKA+13
ASM2WFLG EQU   ASM2FLGS
ASM2RFLG EQU   ASM2FLGS
ASM2DUPQ EQU   ASM2WRKA+8
ASM2CAQ  EQU   ASM2WRKA+4
ASM2PAQ  EQU   ASM2WRKA
ASM2RGSV EQU   ASM2WKSV
ASM1NXTA EQU   ASM1WRKA+4
ASM1ASCB EQU   ASM1WRKA
ASM1RG15 EQU   ASM1RGSV+56
@NM00014 EQU   ASM1RGSV+4
ASM1RG1  EQU   ASM1RGSV
CVTLEVL  EQU   CVTRELNO+2
CVTNUMB  EQU   CVTRELNO
CVTMDL   EQU   CVTFIX+250
@NM00021 EQU   CVTFIX+248
@NM00020 EQU   CVTFIX
CVTRV482 EQU   CVTXTNT2+128
CVTRV481 EQU   CVTXTNT2+124
CVTRV480 EQU   CVTXTNT2+120
CVTRV479 EQU   CVTXTNT2+118
CVTRV478 EQU   CVTXTNT2+117
CVTRV477 EQU   CVTXTNT2+116
CVTRV476 EQU   CVTXTNT2+115
CVTRV475 EQU   CVTXTNT2+114
CVTRV474 EQU   CVTRV466
CVTRV473 EQU   CVTRV466
CVTRV472 EQU   CVTRV466
CVTRV471 EQU   CVTRV466
CVTRV470 EQU   CVTRV466
CVTRV469 EQU   CVTRV466
CVTRV468 EQU   CVTRV466
CVTRV467 EQU   CVTRV466
CVTRV465 EQU   CVTRV457
CVTRV464 EQU   CVTRV457
CVTRV463 EQU   CVTRV457
CVTRV462 EQU   CVTRV457
CVTRV461 EQU   CVTRV457
CVTRV460 EQU   CVTRV457
CVTRV459 EQU   CVTRV457
CVTRV458 EQU   CVTRV457
CVTRV456 EQU   CVTXTNT2+108
CVTRV455 EQU   CVTXTNT2+104
CVTRV454 EQU   CVTXTNT2+100
CVTRV453 EQU   CVTXTNT2+96
CVTRV452 EQU   CVTXTNT2+94
CVTRV451 EQU   CVTXTNT2+92
CVTRV450 EQU   CVTXTNT2+90
CVTRV449 EQU   CVTXTNT2+88
CVTRV448 EQU   CVTXTNT2+87
CVTRV447 EQU   CVTXTNT2+86
CVTRV446 EQU   CVTRV438
CVTRV445 EQU   CVTRV438
CVTRV444 EQU   CVTRV438
CVTRV443 EQU   CVTRV438
CVTRV442 EQU   CVTRV438
CVTRV441 EQU   CVTRV438
CVTRV440 EQU   CVTRV438
CVTRV439 EQU   CVTRV438
CVTRV437 EQU   CVTRV429
CVTRV436 EQU   CVTRV429
CVTRV435 EQU   CVTRV429
CVTRV434 EQU   CVTRV429
CVTRV433 EQU   CVTRV429
CVTRV432 EQU   CVTRV429
CVTRV431 EQU   CVTRV429
CVTRV430 EQU   CVTRV429
CVTRV428 EQU   CVTXTNT2+80
CVTRV427 EQU   CVTXTNT2+76
CVTRV426 EQU   CVTXTNT2+72
CVTRV425 EQU   CVTXTNT2+68
CVTATACT EQU   CVTATCVT
CVTRV423 EQU   CVTXTNT2+62
CVTRV422 EQU   CVTXTNT2+60
CVTRV421 EQU   CVTXTNT2+58
CVTRV420 EQU   CVTXTNT2+56
CVTRV419 EQU   CVTXTNT2+55
CVTRV418 EQU   CVTXTNT2+54
CVTRV417 EQU   CVTRV409
CVTRV416 EQU   CVTRV409
CVTRV415 EQU   CVTRV409
CVTRV414 EQU   CVTRV409
CVTRV413 EQU   CVTRV409
CVTRV412 EQU   CVTRV409
CVTRV411 EQU   CVTRV409
CVTRV410 EQU   CVTRV409
CVTRV408 EQU   CVTRV400
CVTRV407 EQU   CVTRV400
CVTRV406 EQU   CVTRV400
CVTRV405 EQU   CVTRV400
CVTRV404 EQU   CVTRV400
CVTRV403 EQU   CVTRV400
CVTRV402 EQU   CVTRV400
CVTRV401 EQU   CVTRV400
CVTICB   EQU   CVTXTNT2+48
CVTSKTA  EQU   CVTXTNT2+44
CVTRSV99 EQU   CVTXTNT2+40
CVTRSV98 EQU   CVTXTNT2+36
CVTRSV97 EQU   CVTXTNT2+34
CVTRSV96 EQU   CVTXTNT2+32
CVTOLTEP EQU   CVTXTNT2+28
CVTQIDA  EQU   CVTQID+1
CVTRSV95 EQU   CVTQID
CVTRSV94 EQU   CVTXTNT2+20
CVTRSV93 EQU   CVTXTNT2+16
CVTRSV92 EQU   CVTXTNT2+12
CVTDEBVR EQU   CVTXTNT2+8
CVTRSV91 EQU   CVTXTNT2+6
CVTRSV9H EQU   CVTFLGBT
CVTRSV9G EQU   CVTFLGBT
CVTRSV9F EQU   CVTFLGBT
CVTRSV9E EQU   CVTFLGBT
CVTRSV9D EQU   CVTFLGBT
CVTRSV9C EQU   CVTFLGBT
CVTVME   EQU   CVTFLGBT
CVTNPE   EQU   CVTFLGBT
CVTNUCLS EQU   CVTXTNT2+4
CVTDSSVA EQU   CVTDSSV+1
CVTRSV89 EQU   CVTDSSV
CVTRSV88 EQU   CVTXTNT1+8
CVTRSV87 EQU   CVTXTNT1+4
CVTFACHN EQU   CVTXTNT1
CVTRV488 EQU   CVTMAP+412
CVTRV487 EQU   CVTMAP+408
CVTRV486 EQU   CVTMAP+404
CVTRV485 EQU   CVTMAP+400
CVTACTAP EQU   CVTMAP+396
CVTAUTH  EQU   CVTMAP+392
CVTATMCA EQU   CVTATMCT+1
CVTATMST EQU   CVTATMCT
CVTRSV61 EQU   CVTMAP+384
CVTVOLT1 EQU   CVTVOLM1+1
CVTVOLI1 EQU   CVTVOLF1
CVTSTOA  EQU   CVTMAP+376
CVTRSV58 EQU   CVTMAP+374
CVTRSV57 EQU   CVTMAP+372
CVTDDCE  EQU   CVTMAP+368
CVTPNWFR EQU   CVTMAP+364
CVTSMF   EQU   CVTMAP+360
CVTSULK  EQU   CVTMAP+358
CVTSLKO  EQU   CVTSYSK
CVTSLKP  EQU   CVTSYSK
CVTSLKQ  EQU   CVTSYSK
CVTSLKR  EQU   CVTSYSK
CVTRSV56 EQU   CVTSYSK
CVTRSV55 EQU   CVTSYSK
CVTRSV54 EQU   CVTSYSK
CVTRSV53 EQU   CVTSYSK
CVTRSV52 EQU   CVTA1F1
CVTRSV51 EQU   CVTA1F1
CVTRSV50 EQU   CVTA1F1
CVTRSV49 EQU   CVTA1F1
CVTRSV48 EQU   CVTA1F1
CVTRSV47 EQU   CVTA1F1
CVTSRSW  EQU   CVTA1F1
CVTPFSW  EQU   CVTA1F1
CVTPCVT  EQU   CVTMAP+352
CVTRSV46 EQU   CVTMAP+344
CVTRSV45 EQU   CVTMAP+340
CVTRSV44 EQU   CVTMAP+338
CVTRSV43 EQU   CVTMAP+336
CVTHJESA EQU   CVTHJES+1
CVTRSV42 EQU   CVTHJES
CVTEXT2A EQU   CVTEXT2+1
CVTRSV41 EQU   CVTEXT2
CVTAPFA  EQU   CVTAPF+1
CVTRSV40 EQU   CVTAPF
CVTRV518 EQU   CVTINTLA
CVTRV517 EQU   CVTERPV
CVTEORM  EQU   CVTMAP+312
CVTMCHPR EQU   CVTMAP+308
CVTTZ    EQU   CVTMAP+304
CVTJEPS  EQU   CVTMAP+300
CVTJESCT EQU   CVTMAP+296
CVTMODE  EQU   CVTMAP+292
CVTPTRV  EQU   CVTMAP+288
CVTREAL  EQU   CVTMAP+284
CVTRSV39 EQU   CVTMAP+280
CVTRSV38 EQU   CVTMAP+276
CVTDMSRA EQU   CVTDMSR+1
CVTRV634 EQU   CVTDMSRF
CVTRV633 EQU   CVTDMSRF
CVTRV632 EQU   CVTDMSRF
CVTRV631 EQU   CVTDMSRF
CVTRV630 EQU   CVTDMSRF
CVTRV629 EQU   CVTDMSRF
CVTUDUMP EQU   CVTDMSRF
CVTSDUMP EQU   CVTDMSRF
CVTQMSGA EQU   CVTQMSG+1
CVTRSV36 EQU   CVTQMSG
CVTAMFF  EQU   CVTMAP+264
CVTPURGA EQU   CVTPURG+1
CVTRSV35 EQU   CVTPURG
CVTCBSP  EQU   CVTMAP+256
CVTATERA EQU   CVTATER+1
CVTSYST  EQU   CVTATER
CVTVOLT2 EQU   CVTTAT
CVTVOLI2 EQU   CVTVOLF2
CVTAQAVB EQU   CVTAQAVT+1
CVTRSV34 EQU   CVTTCMFG
CVTRSV33 EQU   CVTTCMFG
CVTRSV32 EQU   CVTTCMFG
CVTRSV31 EQU   CVTTCMFG
CVTRSV30 EQU   CVTTCMFG
CVTRSV29 EQU   CVTTCMFG
CVTRSV28 EQU   CVTTCMFG
CVTTCRDY EQU   CVTTCMFG
CVTGTFA  EQU   CVTGTF+1
CVTRSV27 EQU   CVTGTFST
CVTRNIO  EQU   CVTGTFST
CVTUSR   EQU   CVTGTFST
CVTRV318 EQU   CVTFORM
CVTRV317 EQU   CVTTMODE
CVTRV316 EQU   CVTSTATE
CVTRV315 EQU   CVTGTFS
CVTGTFAV EQU   CVTGTFS
CVT0SCR1 EQU   CVTMAP+232
CVTRV515 EQU   CVTMAP+228
CVTRMS   EQU   CVTMAP+224
CVTPATCH EQU   CVTMAP+220
CVTTSCE  EQU   CVTMAP+216
CVTLNKSC EQU   CVTMAP+214
CVTQABST EQU   CVTMAP+212
CVTMDLDS EQU   CVTMAP+208
CVTUSER  EQU   CVTMAP+204
CVTABEND EQU   CVTMAP+200
CVTSMCA  EQU   CVTMAP+196
CVTRSV18 EQU   CVTMAP+192
CVTQLPAQ EQU   CVTMAP+188
CVTQCDSR EQU   CVTMAP+184
CVTRSV17 EQU   CVTOPTB
CVTRSV16 EQU   CVTOPTB
CVTFP    EQU   CVTOPTB
CVTAPTHR EQU   CVTOPTB
CVTNLOG  EQU   CVTOPTB
CVTTOD   EQU   CVTOPTB
CVTCTIMS EQU   CVTOPTB
CVTPROT  EQU   CVTOPTB
CVTXPFP  EQU   CVTOPTA
CVTASCII EQU   CVTOPTA
CVTRSV13 EQU   CVTOPTA
CVTRSV12 EQU   CVTOPTA
CVTNIP   EQU   CVTOPTA
CVTDDR   EQU   CVTOPTA
CVTAPR   EQU   CVTOPTA
CVTCCH   EQU   CVTOPTA
CVTSNCTR EQU   CVTMAP+180
CVTQMWR  EQU   CVTMAP+176
CVTQOCR  EQU   CVTMAP+172
CVT1EF00 EQU   CVTMAP+168
CVTMZ00  EQU   CVTMAP+164
CVTHEAD  EQU   CVTMAP+160
CVTRSV11 EQU   CVTMAP+156
CVT0PT01 EQU   CVTMAP+152
CVTMSER  EQU   CVTMAP+148
CVTRV516 EQU   CVTIERLC
CVTILCH  EQU   CVTMAP+140
CVT0DS   EQU   CVTMAP+136
CVTFBOSV EQU   CVTMAP+132
CVTNUCB  EQU   CVTMAP+128
CVTIXAVL EQU   CVTMAP+124
CVTIOQET EQU   CVTMAP+120
CVTDCBA  EQU   CVTMAP+117
CVTMVS2  EQU   CVTDCB
CVT6DAT  EQU   CVTDCB
CVT4MPS  EQU   CVTDCB
CVTRSV09 EQU   CVTDCB
CVT4MS1  EQU   CVTDCB
CVT2SPS  EQU   CVTDCB
CVT1SSS  EQU   CVTDCB
CVTRSV08 EQU   CVTDCB
CVTSTB   EQU   CVTMAP+112
CVTQTD00 EQU   CVTMAP+108
CVTQTE00 EQU   CVTMAP+104
CVTCUCB  EQU   CVTMAP+100
CVTSJQ   EQU   CVTMAP+96
CVTPBLDL EQU   CVTMAP+92
CVTTPC   EQU   CVTMAP+88
CVTSVDCB EQU   CVTMAP+84
CVTBRET  EQU   CVTMAP+82
CVTEXIT  EQU   CVTMAP+80
CVT0FN00 EQU   CVTMAP+76
CVTDARA  EQU   CVTDAR+1
CVTRSV07 EQU   CVTFLGS1
CVTRSV06 EQU   CVTFLGS1
CVTRSV05 EQU   CVTFLGS1
CVTRSV04 EQU   CVTFLGS1
CVTRSV03 EQU   CVTFLGS1
CVTRSV02 EQU   CVTFLGS1
CVTRSV01 EQU   CVTFLGS1
CVTDMPLK EQU   CVTFLGS1
CVTXITP  EQU   CVTMAP+68
CVTZDTAB EQU   CVTMAP+64
CVTMSLT  EQU   CVTMAP+60
CVTDATE  EQU   CVTMAP+56
CVTBTERM EQU   CVTMAP+52
CVTSYSAD EQU   CVTMAP+48
CVTXTLER EQU   CVTMAP+44
CVTILK2  EQU   CVTMAP+40
CVTILK1  EQU   CVTMAP+36
CVTPRLTV EQU   CVTMAP+32
CVTPCNVT EQU   CVTMAP+28
CVT0VL00 EQU   CVTMAP+24
CVTXAPG  EQU   CVTMAP+20
CVTBUF   EQU   CVTMAP+16
CVTJOB   EQU   CVTMAP+12
CVTLINK  EQU   CVTMAP+8
CVT0EF00 EQU   CVTMAP+4
CVTTCBP  EQU   CVTMAP
CVT      EQU   CVTMAP
@NM00019 EQU   EPATH+26
@NM00018 EQU   EPAFLAG2
EPARECUR EQU   EPAFLAG2
EPATMI   EQU   EPAFLAG2
EPAMAST  EQU   EPAFLAG2
EPABUILD EQU   EPAFLAG2
EPACOLD  EQU   EPAFLAG2
EPAWARM  EQU   EPAFLAG2
EPATMXIT EQU   EPAFLAG2
EPAUNSAV EQU   EPAFLAG1
EPAASGN  EQU   EPAFLAG1
EPAACASR EQU   EPAFLAG1
EPAACT   EQU   EPAGRPOP
EPASAVE  EQU   EPAGRPOP
EPARLG   EQU   EPAGRPOP
EPATMISV EQU   EPABKSLT
EPATMACB EQU   EPARASP
EPATMIBA EQU   EPABASP
EPADSLST EQU   EPAAASP
EPASWKA  EQU   EPATMWKA
EPAOWKA  EQU   EPAVSAM
ASMCPRES EQU   ASMCPRSQ+4
ASMCPTAK EQU   ASMCPRSQ
ASMCPCNT EQU   ASMCPAVQ+4
ASMCPEXT EQU   ASMPOOLS+6
ASMCPSIZ EQU   ASMPOOLS+4
ASMCPID  EQU   ASMPOOLS
ASMRSV12 EQU   ASMVT+1000
ASMSAVE  EQU   ASMVT+928
ASMWKSA7 EQU   ASMVT+848
ASMWKSA6 EQU   ASMVT+768
ASMACEPC EQU   ASMVT+344
ASMBWKPC EQU   ASMVT+312
ASMIOEPC EQU   ASMVT+296
ASMRSV10 EQU   ASMVT+280
ASMPVACE EQU   ASMVT+276
ASMPIOFR EQU   ASMVT+272
ASMPVACQ EQU   ASMVT+268
ASMPMSGS EQU   ASMVT+264
ASMPMSG0 EQU   ASMVT+260
ASMPFRLG EQU   ASMVT+256
ASMPRLG  EQU   ASMVT+252
ASMPACT  EQU   ASMVT+248
ASMPSAV  EQU   ASMVT+244
ASMPCMP  EQU   ASMVT+240
ASMPCMPA EQU   ASMVT+236
ASMPCMPN EQU   ASMVT+232
ASMPCMPD EQU   ASMVT+228
ASMVRMTR EQU   ASMVT+220
ASMPSRBC EQU   ASMVT+216
ASMPSRMT EQU   ASMVT+212
ASMPSWPD EQU   ASMVT+208
ASMPTM   EQU   ASMVT+204
ASMPFRSW EQU   ASMVT+200
ASMPFRSL EQU   ASMVT+196
ASMPQIOE EQU   ASMVT+192
ASMRSV8  EQU   ASMVT+184
ASMTASCB EQU   ASMVT+180
ASMRLGWQ EQU   ASMVT+176
ASMRLGRQ EQU   ASMVT+172
ASMTMECB EQU   ASMVT+168
ASMTCBPT EQU   ASMVT+164
ASMREQCT EQU   ASMVT+160
ASMGOSWK EQU   ASMGOSQS+4
ASMGOSWT EQU   ASMGOSQS
ASMLSAIH EQU   ASMLSAI+4
ASMLSAIL EQU   ASMLSAI
ASMCINV  EQU   ASMVT+140
ASMLGVT  EQU   ASMVT+132
ASMSLOTV EQU   ASMVT+128
ASMERRS  EQU   ASMVT+124
ASMNVSC  EQU   ASMVT+120
ASMVSC   EQU   ASMVT+116
ASMSLOTS EQU   ASMVT+112
ASMBKSLT EQU   ASMVT+108
ASMRSV7  EQU   ASMVT+92
ASMPSRB  EQU   ASMVT+88
ASMSRBCT EQU   ASMVT+84
ASMIOCNT EQU   ASMVT+80
ASMBURST EQU   ASMVT+76
ASMPCCWN EQU   ASMVT+72
ASMPCCWC EQU   ASMPCCWQ+4
ASMPCCWA EQU   ASMPCCWQ
ASMRSV6  EQU   ASMVT+48
ASMIORQC EQU   ASMVT+44
ASMIORQR EQU   ASMVT+40
ASMSTAGL EQU   ASMSTAGQ+4
ASMSTAGF EQU   ASMSTAGQ
ASMRSV5  EQU   ASMVT+28
ASMMSGBF EQU   ASMVT+24
ASMEREC  EQU   ASMVT+20
ASMTRPAG EQU   ASMVT+16
ASMGOS   EQU   ASMVT+12
ASMPART  EQU   ASMVT+8
ASMSART  EQU   ASMVT+4
ASMRSV4  EQU   ASMVT+2
ASMWARM  EQU   ASMFLAG2
ASMQUICK EQU   ASMFLAG2
ASMNOTPT EQU   ASMFLAG2
ASMNOTMR EQU   ASMFLAG2
ASMCALLQ EQU   ASMFLAG2
ASMPLPAS EQU   ASMFLAG1
ASMCOMMF EQU   ASMFLAG1
ASMPLPAF EQU   ASMFLAG1
ASMNODPX EQU   ASMFLAG1
ASMRSV1  EQU   ASMFLAG1
ASMNOLCL EQU   ASMFLAG1
ASMNOCWQ EQU   ASMFLAG1
ASMDUPLX EQU   ASMFLAG1
ASPSLOT  EQU   ASPVLSID+1
ASPPRTNN EQU   ASPVLSID
@NM00013 EQU   ASPLPFLG
ASPLSVRP EQU   ASPLPFLG
ASPLIOER EQU   ASPLPFLG
ASPLOPIN EQU   ASPLPFLG
ASPLSAVE EQU   ASPLPFLG
ASPLVALD EQU   ASPLPFLG
@NM00012 EQU   ASPEXTSN+1088
@NM00011 EQU   ASPEHDR+24
ASPASSTI EQU   ASPEHDR+22
@NM00010 EQU   ASPEHDR+21
@NM00009 EQU   ASPEHDR+4
@NM00008 EQU   ASPCT+1088
ASPLPMES EQU   ASPCT+64
ASPSAVCT EQU   ASPHDR+40
ASPBKSLT EQU   ASPHDR+36
ASPMAXPN EQU   ASPHDR+32
@NM00007 EQU   ASPHDR+29
@NM00006 EQU   ASPFLAG
ASPSAVRP EQU   ASPFLAG
ASPSAVED EQU   ASPFLAG
ASPLGE   EQU   ASPHDR+24
ASPASCB  EQU   ASPHDR+20
@NM00005 EQU   ASPBKEY+8
ASPLGID  EQU   ASPHDR+4
ASPIDENT EQU   ASPHDR
RPLERMSA EQU   RPLCOMN+72
RPLEMLEN EQU   RPLCOMN+70
RPLACTIV EQU   RPLCOMN+69
RPLBRANC EQU   RPLEXTD1
RPLNIB   EQU   RPLEXTD1
@NM00049 EQU   RPLEXTD1
RPLEXIT  EQU   RPLEXTD1
RPLNEXIT EQU   RPLEXTD1
RPLEXSCH EQU   RPLEXTD1
RPLDDDD  EQU   RPLRBAR+4
@NM00048 EQU   RPLRBAR+3
@NM00047 EQU   RPLAIXID
RPLAXPKP EQU   RPLAIXID
RPLAIXPC EQU   RPLRBAR
RPLRSV88 EQU   RPLOPT8
RPLUNCON EQU   RPLOPT8
RPLACTV  EQU   RPLOPT8
RPLSESS  EQU   RPLOPT8
RPLPEND  EQU   RPLOPT8
RPLODPRM EQU   RPLOPT8
RPLODACP EQU   RPLOPT8
RPLODACQ EQU   RPLOPT8
RPLRSV78 EQU   RPLOPT7
RPLRSV77 EQU   RPLOPT7
RPLRLSOP EQU   RPLOPT7
RPLTPOST EQU   RPLOPT7
RPLQOPT  EQU   RPLOPT7
RPLCNIMM EQU   RPLCNOPT
RPLCNANY EQU   RPLCNOPT
RPLCNALL EQU   RPLCNOPT
RPLRSV68 EQU   RPLOPT6
RPLRSV67 EQU   RPLOPT6
RPLLOCK  EQU   RPLOPT6
RPLNCOND EQU   RPLOPT6
RPLCOND  EQU   RPLOPT6
RPLEOT   EQU   RPLUNTYP
RPLEOM   EQU   RPLUNTYP
RPLEOB   EQU   RPLUNTYP
RPLWROPT EQU   RPLOPT5
RPLNODE  EQU   RPLOPT5
RPLERACE EQU   RPLWRTYP
RPLEAU   EQU   RPLWRTYP
RPLNERAS EQU   RPLWRTYP
RPLPSOPT EQU   RPLOPT5
RPLSSNIN EQU   RPLOPT5
RPLDLGIN EQU   RPLOPT5
RPLBUFL  EQU   RPLCOMN+52
RPLRLEN  EQU   RPLCOMN+48
RPLCHAIN EQU   RPLNXTRP
RPLOPT4  EQU   RPLOPTCD+3
RPLALIGN EQU   RPLOPT3
RPLFMT   EQU   RPLOPT3
RPLFLD   EQU   RPLOPT3
RPLVFY   EQU   RPLOPT3
RPLBLK   EQU   RPLOPT3
RPLSFORM EQU   RPLOPT3
RPLEODS  EQU   RPLOPT3
RPLNSP   EQU   RPLOPT2
RPLUPD   EQU   RPLOPT2
@NM00046 EQU   RPLOPT2
RPLLRD   EQU   RPLOPT2
RPLBWD   EQU   RPLOPT2
RPLCNV   EQU   RPLOPT2
RPLADD   EQU   RPLADR
RPLKEY   EQU   RPLOPT2
RPLECBIN EQU   RPLECBSW
RPLGEN   EQU   RPLOPT1
RPLKGE   EQU   RPLOPT1
RPLASY   EQU   RPLOPT1
RPLSKP   EQU   RPLOPT1
RPLSEQ   EQU   RPLOPT1
RPLDIR   EQU   RPLOPT1
RPLLOC   EQU   RPLOPT1
RPLDAF   EQU   RPLARG+2
RPLSAF   EQU   RPLARG
RPLTCBPT EQU   RPLCOMN+28
RPLDACB  EQU   RPLCOMN+24
RPLCCHAR EQU   RPLCOMN+20
RPLSTRID EQU   RPLCOMN+18
RPLKEYL  EQU   RPLKEYLE
RPLRDSOH EQU   RPLFDB3
RPLRLG   EQU   RPLFDB3
RPLLGFRC EQU   RPLFDB3
RPLREOT  EQU   RPLFDB3
RPLREOM  EQU   RPLFDB3
RPLREOB  EQU   RPLFDB3
RPLSV32  EQU   RPLFDB3
RPLUINPT EQU   RPLFDB3
RPLSTSAV EQU   RPLFDB2
RPLCUERR EQU   RPLFDB2
RPLDLGFL EQU   RPLFDB2
RPLIOERR EQU   RPLFDB2
RPLDVUNS EQU   RPLFDB2
RPLATND  EQU   RPLFDB2
RPLRVID  EQU   RPLFDB2
RPLERLK  EQU   RPLFDB2
RPLERREG EQU   RPLRTNCD
RPLSTAT  EQU   RPLFDBWD
RPLPOST  EQU   RPLECB
RPLWAIT  EQU   RPLECB
RPLPLHPT EQU   RPLCOMN+4
RPLLEN2  EQU   RPLLEN
RPLREQ   EQU   RPLIDWD+2
RPLSTYP  EQU   RPLIDWD+1
RPLID    EQU   RPLIDWD
@NM00002 EQU   @NM00001+1
@NM00045 EQU   PSA+3668
PSASTAK  EQU   PSA+3072
@NM00044 EQU   PSA+1048
PSAUSEND EQU   PSA+1048
PSARV062 EQU   PSA+1044
PSACDAL  EQU   PSA+1040
PSAWTCOD EQU   PSA+1036
PSAATCVT EQU   PSA+1032
PSAPCPSW EQU   PSA+1024
PSAPIR2  EQU   PSA+1020
PSARV059 EQU   PSA+1018
PSASVC13 EQU   PSA+1016
PSALSFCC EQU   PSA+1012
PSASFACC EQU   PSA+1008
PSASTOP  EQU   PSA+992
PSASTART EQU   PSA+976
PSARSPSW EQU   PSA+968
PSASRPSW EQU   PSA+960
PSARV045 EQU   PSA+892
PSARV044 EQU   PSA+888
PSARV043 EQU   PSA+884
PSARV042 EQU   PSA+880
PSARV041 EQU   PSA+876
PSARV040 EQU   PSA+872
PSARV025 EQU   PSA+868
PSADSSED EQU   PSA+868
PSADSSPR EQU   PSA+864
PSADSSFW EQU   PSA+860
PSADSS14 EQU   PSA+856
PSADSSPP EQU   PSA+848
PSADSSRP EQU   PSA+840
PSADSS05 EQU   PSADSSF4
PSADSS10 EQU   PSADSSF4
PSADSSVE EQU   PSADSSF4
PSADSSDE EQU   PSADSSF4
PSADSSC0 EQU   PSADSSF4
PSADSSIE EQU   PSADSSF4
PSADSS12 EQU   PSADSSF4
PSADSSRC EQU   PSADSSF4
PSARV057 EQU   PSADSSF3
PSARV056 EQU   PSADSSF3
PSARV055 EQU   PSADSSF3
PSADSSMC EQU   PSADSSF3
PSADSSRW EQU   PSADSSF3
PSADSSNM EQU   PSADSSF3
PSADSSES EQU   PSADSSF3
PSADSSGP EQU   PSADSSF3
PSADSSF2 EQU   PSADSSFL+1
PSADSSPI EQU   PSADSSF1
PSADSSOI EQU   PSADSSF1
PSADSSSP EQU   PSADSSF1
PSADSSTP EQU   PSADSSF1
PSADSSDW EQU   PSADSSF1
PSADSSDD EQU   PSADSSF1
PSADSSDM EQU   PSADSSF1
PSADSSMV EQU   PSADSSF1
PSADSSTS EQU   PSA+816
PSADSSWK EQU   PSA+812
PSADSSR3 EQU   PSA+808
PSADSSR2 EQU   PSA+804
PSADSSRS EQU   PSA+800
PSASTOR  EQU   PSA+796
PSACPUSA EQU   PSA+794
PSAVSTAP EQU   PSA+792
PSAWKVAP EQU   PSA+788
PSAWKRAP EQU   PSA+784
PSAMCHIC EQU   PSA+783
PSARV061 EQU   PSA+782
PSASYMSK EQU   PSA+781
PSAMCHFL EQU   PSA+780
PSACR0   EQU   PSA+776
PSAPSWSV EQU   PSA+768
PSALITA  EQU   PSA+764
PSACLHS  EQU   PSAHLHI
PSALKR15 EQU   PSALKSA+60
PSALKR14 EQU   PSALKSA+56
PSALKR13 EQU   PSALKSA+52
PSALKR12 EQU   PSALKSA+48
PSALKR11 EQU   PSALKSA+44
PSALKR10 EQU   PSALKSA+40
PSALKR9  EQU   PSALKSA+36
PSALKR8  EQU   PSALKSA+32
PSALKR7  EQU   PSALKSA+28
PSALKR6  EQU   PSALKSA+24
PSALKR5  EQU   PSALKSA+20
PSALKR4  EQU   PSALKSA+16
PSALKR3  EQU   PSALKSA+12
PSALKR2  EQU   PSALKSA+8
PSALKR1  EQU   PSALKSA+4
PSALKR0  EQU   PSALKSA
PSARV023 EQU   PSACLHT+52
PSALOCAL EQU   PSACLHT+48
PSACMSL  EQU   PSACLHT+44
PSAOPTL  EQU   PSACLHT+40
PSATPACL EQU   PSACLHT+36
PSATPDNL EQU   PSACLHT+32
PSATPNCL EQU   PSACLHT+28
PSAIOSLL EQU   PSACLHT+24
PSAIOSUL EQU   PSACLHT+20
PSAIOSCL EQU   PSACLHT+16
PSAIOSSL EQU   PSACLHT+12
PSASALCL EQU   PSACLHT+8
PSAASML  EQU   PSACLHT+4
PSADISPL EQU   PSACLHT
PSASRSA  EQU   PSA+636
PSARV050 EQU   PSA+634
PSADSSGO EQU   PSA+633
PSARECUR EQU   PSA+632
PSAHLHIS EQU   PSA+628
PSAIPCSA EQU   PSA+624
@NM00043 EQU   PSA+621
PSAIPCDM EQU   PSA+620
PSAIPCD  EQU   PSA+616
@NM00042 EQU   PSA+613
PSAIPCRM EQU   PSA+612
PSAIPCR  EQU   PSA+608
PSAMCHEX EQU   PSA+600
PSAMPSW  EQU   PSA+592
PSAEXPS2 EQU   PSA+584
PSAEXPS1 EQU   PSA+576
PSAPIREG EQU   PSA+572
PSARSREG EQU   PSA+568
PSAGPREG EQU   PSA+556
PSARV022 EQU   PSASUP4
PSARV021 EQU   PSASUP4
PSARV020 EQU   PSASUP4
PSARV019 EQU   PSASUP4
PSARV018 EQU   PSASUP4
PSARV017 EQU   PSASUP4
PSARV016 EQU   PSASUP4
PSARV015 EQU   PSASUP4
PSARV014 EQU   PSASUP3
PSARV013 EQU   PSASUP3
PSARV012 EQU   PSASUP3
PSAESTA  EQU   PSASUP3
PSASPR   EQU   PSASUP3
PSAPSREG EQU   PSASUP3
PSAPI2   EQU   PSASUP3
PSAIOSUP EQU   PSASUP3
PSALCR   EQU   PSASUP2
PSARTM   EQU   PSASUP2
PSAACR   EQU   PSASUP2
PSAIPCE2 EQU   PSASUP2
PSAIPCES EQU   PSASUP2
PSAIPCEC EQU   PSASUP2
PSAGTF   EQU   PSASUP2
PSAIPCRI EQU   PSASUP2
PSATYPE6 EQU   PSASUP1
PSATCTL  EQU   PSASUP1
PSADISP  EQU   PSASUP1
PSALOCK  EQU   PSASUP1
PSAPI    EQU   PSASUP1
PSAEXT   EQU   PSASUP1
PSASVC   EQU   PSASUP1
PSAIO    EQU   PSASUP1
PSAANEW  EQU   PSA+544
PSATNEW  EQU   PSA+536
PSALCCAR EQU   PSA+532
PSALCCAV EQU   PSA+528
PSAPCCAR EQU   PSA+524
PSAPCCAV EQU   PSA+520
PSACPULA EQU   PSA+518
PSACPUPA EQU   PSA+516
PSAPSA   EQU   PSA+512
FLCHDEND EQU   PSA+512
FLCCRSAV EQU   FLCMCLA+280
FLCGRSAV EQU   FLCMCLA+216
FLCFPSAV EQU   FLCMCLA+184
FLCFLA   EQU   FLCMCLA+88
FLCRGNCD EQU   FLCMCLA+84
FLCFSAA  EQU   FLCFSA+1
@NM00041 EQU   FLCFSA
@NM00040 EQU   FLCMCLA+72
FLCMCIC  EQU   FLCMCLA+64
@NM00039 EQU   FLCMCLA+20
FLCIOAA  EQU   FLCIOA+1
@NM00038 EQU   FLCIOA
@NM00037 EQU   FLCMCLA+15
@NM00036 EQU   FLCMCLA+14
@NM00035 EQU   FLCMCLA+12
FLCLCL   EQU   FLCMCLA+8
FLCIOELA EQU   FLCIOEL+1
@NM00034 EQU   FLCIOEL
FLCCHNID EQU   FLCMCLA
@NM00033 EQU   PSA+160
FLCMTRCD EQU   PSA+157
@NM00032 EQU   PSA+156
FLCPERA  EQU   FLCPER+1
@NM00031 EQU   FLCPER
@NM00030 EQU   PSA+151
FLCPERCD EQU   PSA+150
FLCMCNUM EQU   PSA+149
@NM00029 EQU   PSA+148
FLCTEAA  EQU   FLCTEA+1
@NM00028 EQU   FLCTEA
PSAPIPC  EQU   PSAPICOD
PSAPIMC  EQU   PSAPICOD
PSAPIPER EQU   PSAPICOD
PSARV049 EQU   FLCPICOD
FLCPILCB EQU   FLCPIILC
@NM00027 EQU   FLCPIILC
@NM00026 EQU   PSAEPPSW
FLCSVCN  EQU   PSAESPSW+2
FLCSILCB EQU   FLCSVILC
@NM00025 EQU   FLCSVILC
@NM00024 EQU   PSAESPSW
FLCEICOD EQU   PSAEEPSW+2
PSASPAD  EQU   PSAEEPSW
@NM00023 EQU   PSA+128
FLCINPSW EQU   PSA+120
FLCMNPSW EQU   PSA+112
FLCPNPSW EQU   PSA+104
FLCSNPSW EQU   PSA+96
FLCENPSW EQU   PSA+88
FLCTRACE EQU   PSA+84
FLCTIMER EQU   PSA+80
FLCCVT2  EQU   PSA+76
FLCCAW   EQU   PSA+72
FLCCSW   EQU   PSA+64
FLCIOPSW EQU   PSA+56
FLCMOPSW EQU   PSA+48
FLCPOPSW EQU   PSA+40
FLCSOPSW EQU   PSA+32
FLCEOPSW EQU   PSA+24
@NM00022 EQU   FLCICCW2+4
FLCICCW1 EQU   FLCROPSW
FLCIPPSW EQU   FLCRNPSW
*                                      END UNREFERENCED COMPONENTS
@RC00179 EQU   @RC00178
@RF00150 EQU   @RC00145
@RC00321 EQU   @RC00320
@RF00339 EQU   @RC00333
@RF00300 EQU   @RC00297
@RC00537 EQU   @RC00536
@RC00421 EQU   @RC00415
@RC00723 EQU   @RC00722
@RC00735 EQU   @RC00722
@RC00798 EQU   @RC00797
@RC00810 EQU   @RC00797
@RC00887 EQU   @RC00886
@RC00905 EQU   @RC00886
@RC00900 EQU   @RC00886
@RC00952 EQU   @RC00948
@RF00961 EQU   @RC00958
@RC00974 EQU   @RC00970
@RC00986 EQU   @RC00983
@ENDDATA EQU   *
         END   ILRVSAMI,(C'PLS1506',0701,76087)

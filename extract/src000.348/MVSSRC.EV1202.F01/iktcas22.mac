         TITLE '*** IKTCAS22 - TERMINAL HANDLING ***'
IKTCAS22 CSECT ,                                                   0001
@MAINENT DS    0H                                                  0001
         USING *,@15                                               0001
         B     @PROLOG                                             0001
         DC    AL1(16)                                             0001
         DC    C'IKTCAS22  78.336'                                 0001
         DROP  @15
@PROLOG  STM   @14,@12,12(@13)                                     0001
         BALR  @12,0                                               0001
@PSTART  DS    0H                                                  0001
         USING @PSTART,@12                                         0001
         ST    @13,@SA00001+4                                      0001
         LA    @14,@SA00001                                        0001
         ST    @14,8(,@13)                                         0001
         LR    @13,@14                                             0001
*   R1=WEVRPL;                      /* GET ADDRESS OF RPL FOR CLSDST
*                                                            @ZA32361*/
         L     @14,WEVRPL(,R10)                                    0033
         LR    R1,@14                                              0033
*   LOGWEPTR=R1-LENGTH(WESTD);      /* COMPUTE ADDRESS OF LOGON WORK
*                                      ELEMENT FROM A(RPL)   @ZA32361*/
         LR    LOGWEPTR,R1                                         0034
         SL    LOGWEPTR,@CF00518                                   0034
*   LOGWEPTR->WEUASCB=WEUASCB;      /* COPY ASCB ADDRESS TO LOGON  0035
*                                      WORK ELEMENT          @ZA32361*/
         L     @04,WEUASCB(,R10)                                   0035
         ST    @04,WEUASCB(,LOGWEPTR)                              0035
*   LOGWEPTR->WEUECB=WEUECB;        /* COPY ECB ADDRESS TO LOGON WORK
*                                      ELEMENT               @ZA32361*/
         L     @04,WEUECB(,R10)                                    0036
         ST    @04,WEUECB(,LOGWEPTR)                               0036
*   LBUFPTR=ADDR(LOGWEPTR->WELBUF->LBUFFER);/* GET ADDRESS OF LOGON
*                                      BUFFER IN LOGON WORK ELEMENT
*                                                            @ZA32361*/
         L     LBUFPTR,WELBUF(,LOGWEPTR)                           0037
         LA    LBUFPTR,LBUFFER(,LBUFPTR)                           0037
*   R15=ADDR(IKTCASCX);             /* GET CLSDST EXIT ADDRESS     0038
*                                                            @ZA32361*/
         L     R15,@CV00508                                        0038
*   IF WECODE1F=FCVITT THEN         /* IS THIS TERM TRANSFER REQ     */
         CLI   WECODE1F(R10),X'21'                                 0039
         BNE   @RF00039                                            0039
*     DO;                           /* YES ISSUE CLSDST PASS         */
*       R0=LBUFPTR;                 /* GET LOGON BUFFER ADDRESS    0041
*                                                            @ZA32361*/
         LR    R0,LBUFPTR                                          0041
*       WSCLSPAS='1'B;              /* SET PASS INDICATOR            */
*       WSCLSREL='0'B;              /* SET RELEASE BIT OFF           */
         AL    @14,@CF00519                                        0043
         OI    WSCLSPAS(@14),B'00010000'                           0043
         NI    WSCLSREL(@14),B'11011111'                           0043
*       GEN REFS(R0,R1,R15);                                       0044
*                                  /* ISSUE CLSDST PASS     @ZA32361*/
         CLSDST RPL=(1),AAREA=(0),EXIT=(15),OPTCD=(ASY,PASS)  @ZA32361
*     END;                                                         0045
*   ELSE                                                           0046
*     DO;                           /* NOT TERM PASS THEN RELEASE    */
         B     @RC00039                                            0046
@RF00039 DS    0H                                                  0047
*       WSCLSREL='1'B;              /* SET RELEASE BIT ON            */
*       WSCLSPAS='0'B;              /* SET PASS BIT OFF              */
         LA    @14,112                                             0048
         AL    @14,WEVRPL(,R10)                                    0048
         OI    WSCLSREL(@14),B'00100000'                           0048
         NI    WSCLSPAS(@14),B'11101111'                           0048
*       GEN;                                                       0049
         CLSDST RPL=(1),EXIT=(15),OPTCD=(ASY,RELEASE)         @ZA32361
*     END;                                                         0050
*   IF R5=0 THEN                    /* IS REG 5 0? IF SO,    @ZA19531*/
@RC00039 LTR   R5,R5                                               0051
         BNZ   @RF00051                                            0051
*     DO;                           /* FREE THE LOGON WORK ELEMENT 0052
*                                                            @ZA19531*/
*       R0=WELEN;                   /* GET WORK ELEMENT LENGTH     0053
*                                                            @ZA32361*/
         LH    R0,WELEN(,R10)                                      0053
*       WA1=R10;                    /* GET WORK ELEMENT ADDRESS    0054
*                                                            @ZM42700*/
         ST    R10,WA1                                             0054
*       GEN REFS(R0,WA1) SETS(R1);                                 0055
*                                     /* FREE WORK ELEMENT  @ZM42700*/
         FREEMAIN E,LV=(0),A=WA1,SP=231  FREEMAIN FOR LOGON W.E.
*     END;                          /*                       @ZA19531*/
*   ELSE                                                           0057
*     ;                             /* DO NOT FREE W.E.      @ZA19531*/
@RF00051 DS    0H                                                  0058
*   END IKTCAS22                                                   0058
*                                                                  0058
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.     */
*/*%INCLUDE SYSLIB  (IFGRPL  )                                       */
*/*%INCLUDE SYSLIB  (IFGRPLVT)                                       */
*/*%INCLUDE SYSLIB  (ISTRPLFB)                                       */
*/*%INCLUDE SYSLIB  (IKTWESTD)                                       */
*                                                                  0058
*       ;                                                          0058
@EL00001 L     @13,4(,@13)                                         0058
@EF00001 DS    0H                                                  0058
@ER00001 LM    @14,@12,12(@13)                                     0058
         BR    @14                                                 0058
@DATA    DS    0H
         DS    0F
@SA00001 DS    18F
         DS    0F
@CF00518 DC    F'76'
@CF00519 DC    F'112'
@CV00508 DC    V(IKTCASCX)
         DS    0D
WA1      DS    F
PATCH    DC    13F'0'
@00      EQU   00                      EQUATES FOR REGISTERS 0-15
@01      EQU   01
@02      EQU   02
@03      EQU   03
@04      EQU   04
@05      EQU   05
@06      EQU   06
@07      EQU   07
@08      EQU   08
@09      EQU   09
@10      EQU   10
@11      EQU   11
@12      EQU   12
@13      EQU   13
@14      EQU   14
@15      EQU   15
LBUFPTR  EQU   @07
LOGWEPTR EQU   @06
R0       EQU   @00
R1       EQU   @01
R5       EQU   @05
R10      EQU   @10
TWAPTR   EQU   @11
R15      EQU   @15
R12      EQU   @12
R13      EQU   @13
R14      EQU   @14
IFGRPL   EQU   0
RPLCOMN  EQU   IFGRPL
RPLIDWD  EQU   RPLCOMN
RPLLEN   EQU   RPLIDWD+3
RPLECB   EQU   RPLCOMN+8
RPLEXITP EQU   RPLECB
RPLFDBWD EQU   RPLCOMN+12
RPLFDBK  EQU   RPLFDBWD+1
RPLRTNCD EQU   RPLFDBK
RPLCNDCD EQU   RPLFDBK+1
RPLCMPON EQU   RPLCNDCD
RPLFDB2  EQU   RPLCMPON
RPLERRCD EQU   RPLCNDCD+1
RPLFDB3  EQU   RPLERRCD
RPLKEYLE EQU   RPLCOMN+16
RPLARG   EQU   RPLCOMN+36
RPLOPTCD EQU   RPLCOMN+40
RPLOPT1  EQU   RPLOPTCD
RPLECBSW EQU   RPLOPT1
RPLOPT2  EQU   RPLOPTCD+1
RPLADR   EQU   RPLOPT2
RPLOPT3  EQU   RPLOPTCD+2
RPLOPT4  EQU   RPLOPTCD+3
RPLNXTRP EQU   RPLCOMN+44
RPLOPTC2 EQU   RPLCOMN+56
RPLOPT5  EQU   RPLOPTC2
RPLWRTYP EQU   RPLOPT5
RPLOPT6  EQU   RPLOPTC2+1
RPLUNTYP EQU   RPLOPT6
RPLOPT7  EQU   RPLOPTC2+2
RPLCNOPT EQU   RPLOPT7
RPLOPT8  EQU   RPLOPTC2+3
RPLRBAR  EQU   RPLCOMN+60
RPLAIXID EQU   RPLRBAR+2
RPLEXTDS EQU   RPLCOMN+68
RPLEXTD1 EQU   RPLEXTDS
RPLVTEXT EQU   IFGRPL+76
RPLFDBK2 EQU   RPLVTEXT+12
RPLSSNSI EQU   RPLFDBK2
RPLDSB   EQU   RPLSSNSI
RPLDSB1  EQU   RPLDSB
RPLSSEI  EQU   RPLDSB1
RPLDSB2  EQU   RPLDSB+1
RPLUSNSI EQU   RPLFDBK2+2
RPLOPTC3 EQU   RPLVTEXT+20
RPLOPT9  EQU   RPLOPTC3
RPLOPT10 EQU   RPLOPTC3+1
RPLOPT11 EQU   RPLOPTC3+2
RPLOPT12 EQU   RPLOPTC3+3
RPLOSENS EQU   RPLVTEXT+24
RPLSSNSO EQU   RPLOSENS
RPLSSEO  EQU   RPLSSNSO
RPLOF16  EQU   0
RPLRH3   EQU   RPLOF16
RPLSRTYP EQU   RPLOF16+1
RPLSTYPE EQU   RPLSRTYP
RPLRTYPE EQU   RPLSRTYP
RPLCHN   EQU   RPLOF16+2
RPLVTFL1 EQU   RPLOF16+3
RPLVTFL2 EQU   RPLOF16+4
RPLPOSTV EQU   RPLVTFL2
RPLRESP  EQU   RPLVTFL2
RPLCNTRL EQU   RPLOF16+5
RPLCNTDF EQU   RPLCNTRL
RPLCNTDC EQU   RPLCNTRL+1
RPLCNTSC EQU   RPLCNTRL+2
RPLOF60  EQU   0
RPLOBSQ  EQU   RPLOF60+4
RPLIBSQ  EQU   RPLOF60+5
WESTD    EQU   0
WECODE1  EQU   WESTD
WECODE1F EQU   WECODE1+1
WECODE2  EQU   WESTD+2
WECODE2F EQU   WECODE2+1
WERC     EQU   WESTD+8
WELEN    EQU   WESTD+10
WEUASCB  EQU   WESTD+12
WEVNIB   EQU   WESTD+16
WEUECB   EQU   WEVNIB
WEVRPL   EQU   WESTD+20
WELBUF   EQU   WESTD+24
WETERM   EQU   WESTD+28
WETMFLG  EQU   WESTD+32
WORKSPAC EQU   0
WSFLG1   EQU   WORKSPAC
WSCLSREL EQU   WSFLG1
WSCLSPAS EQU   WSFLG1
LOGBUFF  EQU   0
LBUFFER  EQU   LOGBUFF+4
ISTRPL   EQU   0
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS
LOGLEN   EQU   LOGBUFF
@NM00029 EQU   WORKSPAC+8
@NM00028 EQU   WORKSPAC+4
@NM00027 EQU   WORKSPAC+1
@NM00026 EQU   WSFLG1
WSSYNCH  EQU   WSFLG1
WSRETRYB EQU   WSFLG1
WSOPNDST EQU   WSFLG1
WSALLOCD EQU   WSFLG1
WEALTC   EQU   WESTD+75
WEALTR   EQU   WESTD+74
WEPRMC   EQU   WESTD+73
WEPRMR   EQU   WESTD+72
WEBIND   EQU   WESTD+36
@NM00025 EQU   WESTD+35
WERUSZO  EQU   WESTD+34
WERUSZI  EQU   WESTD+33
@NM00024 EQU   WETMFLG
WENOSW   EQU   WETMFLG
WEFLG1   EQU   WETMFLG
WETMBF   EQU   WETERM+2
WESUBT   EQU   WETERM+1
WETMTP   EQU   WETERM
WERC2    EQU   WERC+1
WERC1    EQU   WERC
WENEXT   EQU   WESTD+4
WECD2MIF EQU   WECODE2F
WECD2MAF EQU   WECODE2F
WECODE2T EQU   WECODE2
WECDMIF  EQU   WECODE1F
WECDMAF  EQU   WECODE1F
WECODE1T EQU   WECODE1
RPLSEQNO EQU   RPLOF60+6
@NM00023 EQU   RPLIBSQ
RPLIINV  EQU   RPLIBSQ
RPLINEG  EQU   RPLIBSQ
RPLIPOS  EQU   RPLIBSQ
RPLIIGN  EQU   RPLIBSQ
RPLIRSET EQU   RPLIBSQ
RPLITST  EQU   RPLIBSQ
RPLISET  EQU   RPLIBSQ
@NM00022 EQU   RPLOBSQ
RPLOINV  EQU   RPLOBSQ
RPLONEG  EQU   RPLOBSQ
RPLOPOS  EQU   RPLOBSQ
RPLOIGN  EQU   RPLOBSQ
RPLORSET EQU   RPLOBSQ
RPLOTST  EQU   RPLOBSQ
RPLOSET  EQU   RPLOBSQ
RPLIBSQV EQU   RPLOF60+2
RPLOBSQV EQU   RPLOF60
@NM00021 EQU   RPLCNTSC
RPLRSHUT EQU   RPLCNTSC
RPLRQR   EQU   RPLCNTSC
RPLSHUTC EQU   RPLCNTSC
RPLSHUTD EQU   RPLCNTSC
RPLSTSN  EQU   RPLCNTSC
RPLCLEAR EQU   RPLCNTSC
RPLSDT   EQU   RPLCNTSC
RPLBIS   EQU   RPLCNTDC
RPLSBI   EQU   RPLCNTDC
RPLTUNBD EQU   RPLCNTDC
RPLTBIND EQU   RPLCNTDC
RPLSIGNL EQU   RPLCNTDC
RPLLUS   EQU   RPLCNTDC
RPLRTR   EQU   RPLCNTDC
RPLBID   EQU   RPLCNTDC
@NM00020 EQU   RPLCNTDF
RPLQI    EQU   RPLCNTDF
RPLRELQ  EQU   RPLCNTDF
RPLCHASE EQU   RPLCNTDF
RPLQEC   EQU   RPLCNTDF
RPLQC    EQU   RPLCNTDF
RPLCNCEL EQU   RPLCNTDF
RPLDATA  EQU   RPLCNTDF
RPLRRN   EQU   RPLRESP
RPLNFME  EQU   RPLRESP
RPLEX    EQU   RPLRESP
RPLQRI   EQU   RPLRESP
@NM00019 EQU   RPLPOSTV
RPLSCHED EQU   RPLPOSTV
@NM00018 EQU   RPLVTFL1
RPLTLGAC EQU   RPLVTFL1
RPLTNDSP EQU   RPLVTFL1
RPLAUTUS EQU   RPLVTFL1
RPLVTUSE EQU   RPLVTFL1
@NM00017 EQU   RPLVTFL1
@NM00016 EQU   RPLCHN
RPLONLY  EQU   RPLCHN
RPLLAST  EQU   RPLCHN
RPLMIDLE EQU   RPLCHN
RPLFIRST EQU   RPLCHN
@NM00015 EQU   RPLRTYPE
RPLDFASY EQU   RPLRTYPE
RPLNFSYN EQU   RPLRTYPE
RPLRRESP EQU   RPLRTYPE
@NM00014 EQU   RPLSTYPE
RPLSRESP EQU   RPLSTYPE
@NM00013 EQU   RPLRH3
RPLCSI   EQU   RPLRH3
RPLCHREQ EQU   RPLRH3
RPLCMD   EQU   RPLRH3
RPLEB    EQU   RPLRH3
RPLBB    EQU   RPLRH3
RPLSIGDA EQU   RPLVTEXT+32
RPLSAV13 EQU   RPLVTEXT+28
RPLUSNSO EQU   RPLOSENS+2
RPLSSMO  EQU   RPLSSNSO+1
@NM00012 EQU   RPLSSEO
RPLRRO   EQU   RPLSSEO
RPLFIO   EQU   RPLSSEO
RPLSTATO EQU   RPLSSEO
RPLCPMO  EQU   RPLSSEO
@NM00011 EQU   RPLSSEO
RPLFMHDR EQU   RPLOPT12
@NM00010 EQU   RPLOPT12
@NM00009 EQU   RPLOPT12
@NM00008 EQU   RPLOPT12
RPLNIBTK EQU   RPLOPT12
RPLTRUNC EQU   RPLOPT12
RPLKEEP  EQU   RPLOPT12
@NM00007 EQU   RPLOPT12
RPLRSVE8 EQU   RPLOPT11
RPLRSVE7 EQU   RPLOPT11
RPLRSVE6 EQU   RPLOPT11
RPLRSVE5 EQU   RPLOPT11
RPLRSVE4 EQU   RPLOPT11
RPLSTOP  EQU   RPLOPT11
RPLSTART EQU   RPLOPT11
RPLQUIES EQU   RPLOPT11
RPLRSVI6 EQU   RPLOPT10
RPLRSVI5 EQU   RPLOPT10
RPLRSVI4 EQU   RPLOPT10
RPLRSVI3 EQU   RPLOPT10
RPLTSKY  EQU   RPLOPT10
RPLSPARM EQU   RPLOPT10
RPLDSPLY EQU   RPLOPT10
RPLBSCID EQU   RPLOPT10
RPLTOPL  EQU   RPLOPT9
RPLCIDE  EQU   RPLOPT9
RPLRNNM  EQU   RPLOPT9
RPLAPPST EQU   RPLOPT9
RPLCOUNT EQU   RPLOPT9
RPLTERMS EQU   RPLOPT9
RPLDEVCH EQU   RPLOPT9
RPLLOGON EQU   RPLOPT9
RPLUSFLD EQU   RPLVTEXT+16
RPLESR2  EQU   RPLUSNSI+1
RPLESR1  EQU   RPLUSNSI
RPLSSMI  EQU   RPLDSB2
@NM00006 EQU   RPLSSEI
RPLRRI   EQU   RPLSSEI
RPLFII   EQU   RPLSSEI
RPLSTATI EQU   RPLSSEI
RPLCPMI  EQU   RPLSSEI
RPLPATHI EQU   RPLSSEI
RPLARCLN EQU   RPLVTEXT+8
RPLAARLN EQU   RPLVTEXT+4
RPLAAREA EQU   RPLVTEXT
RPLERMSA EQU   RPLCOMN+72
RPLEMLEN EQU   RPLCOMN+70
RPLACTIV EQU   RPLCOMN+69
RPLBRANC EQU   RPLEXTD1
RPLNIB   EQU   RPLEXTD1
RPLTCRYP EQU   RPLEXTD1
@NM00005 EQU   RPLEXTD1
RPLEXIT  EQU   RPLEXTD1
RPLNEXIT EQU   RPLEXTD1
RPLEXSCH EQU   RPLEXTD1
RPLDDDD  EQU   RPLRBAR+4
@NM00004 EQU   RPLRBAR+3
@NM00003 EQU   RPLAIXID
RPLAXPKP EQU   RPLAIXID
RPLAIXPC EQU   RPLRBAR
RPLRSV88 EQU   RPLOPT8
RPLUNCON EQU   RPLOPT8
RPLACTV  EQU   RPLOPT8
RPLSESS  EQU   RPLOPT8
RPLPEND  EQU   RPLOPT8
RPLODPRM EQU   RPLOPT8
RPLODACP EQU   RPLOPT8
RPLODACQ EQU   RPLOPT8
RPLRSV78 EQU   RPLOPT7
RPLTCRNO EQU   RPLOPT7
RPLRLSOP EQU   RPLOPT7
RPLTPOST EQU   RPLOPT7
RPLQOPT  EQU   RPLOPT7
RPLCNIMM EQU   RPLCNOPT
RPLCNANY EQU   RPLCNOPT
RPLCNALL EQU   RPLCNOPT
RPLRSV68 EQU   RPLOPT6
RPLRSV67 EQU   RPLOPT6
RPLLOCK  EQU   RPLOPT6
RPLNCOND EQU   RPLOPT6
RPLCOND  EQU   RPLOPT6
RPLEOT   EQU   RPLUNTYP
RPLEOM   EQU   RPLUNTYP
RPLEOB   EQU   RPLUNTYP
RPLWROPT EQU   RPLOPT5
RPLNODE  EQU   RPLOPT5
RPLERACE EQU   RPLWRTYP
RPLEAU   EQU   RPLWRTYP
RPLNERAS EQU   RPLWRTYP
RPLPSOPT EQU   RPLOPT5
@NM00002 EQU   RPLOPT5
RPLDLGIN EQU   RPLOPT5
RPLBUFL  EQU   RPLCOMN+52
RPLRLEN  EQU   RPLCOMN+48
RPLCHAIN EQU   RPLNXTRP
@NM00001 EQU   RPLOPT4
RPLMKFRM EQU   RPLOPT4
RPLENDTR EQU   RPLOPT4
RPLALIGN EQU   RPLOPT3
RPLFMT   EQU   RPLOPT3
RPLFLD   EQU   RPLOPT3
RPLVFY   EQU   RPLOPT3
RPLBLK   EQU   RPLOPT3
RPLSFORM EQU   RPLOPT3
RPLEODS  EQU   RPLOPT3
RPLNSP   EQU   RPLOPT2
RPLUPD   EQU   RPLOPT2
RPLWAITX EQU   RPLOPT2
RPLLRD   EQU   RPLOPT2
RPLBWD   EQU   RPLOPT2
RPLCNV   EQU   RPLOPT2
RPLADD   EQU   RPLADR
RPLKEY   EQU   RPLOPT2
RPLECBIN EQU   RPLECBSW
RPLGEN   EQU   RPLOPT1
RPLKGE   EQU   RPLOPT1
RPLASY   EQU   RPLOPT1
RPLSKP   EQU   RPLOPT1
RPLSEQ   EQU   RPLOPT1
RPLDIR   EQU   RPLOPT1
RPLLOC   EQU   RPLOPT1
RPLDAF   EQU   RPLARG+2
RPLSAF   EQU   RPLARG
RPLAREA  EQU   RPLCOMN+32
RPLTCBPT EQU   RPLCOMN+28
RPLDACB  EQU   RPLCOMN+24
RPLCCHAR EQU   RPLCOMN+20
RPLSTRID EQU   RPLCOMN+18
RPLKEYL  EQU   RPLKEYLE
RPLRDSOH EQU   RPLFDB3
RPLRLG   EQU   RPLFDB3
RPLLGFRC EQU   RPLFDB3
RPLREOT  EQU   RPLFDB3
RPLREOM  EQU   RPLFDB3
RPLREOB  EQU   RPLFDB3
RPLSV32  EQU   RPLFDB3
RPLUINPT EQU   RPLFDB3
RPLSTSAV EQU   RPLFDB2
RPLCUERR EQU   RPLFDB2
RPLDLGFL EQU   RPLFDB2
RPLIOERR EQU   RPLFDB2
RPLDVUNS EQU   RPLFDB2
RPLATND  EQU   RPLFDB2
RPLRVID  EQU   RPLFDB2
RPLERLK  EQU   RPLFDB2
RPLERREG EQU   RPLRTNCD
RPLSTAT  EQU   RPLFDBWD
RPLPOST  EQU   RPLEXITP
RPLWAIT  EQU   RPLEXITP
RPLPLHPT EQU   RPLCOMN+4
RPLLEN2  EQU   RPLLEN
RPLREQ   EQU   RPLIDWD+2
RPLSTYP  EQU   RPLIDWD+1
RPLID    EQU   RPLIDWD
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS
@ENDDATA EQU   *
         END   IKTCAS22,(C'PLS0958',0702,78336)

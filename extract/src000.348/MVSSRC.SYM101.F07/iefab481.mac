         TITLE 'IEFAB481 - ELIMINATE GROUPS FROM EDL/ALG TABLES        *
                        '
IEFAB481 CSECT ,                                                01S0001
@MAINENT DS    0H                                               01S0001
         USING *,@15                                            01S0001
         B     @PROLOG                                          01S0001
         DC    AL1(16)                                          01S0001
         DC    C'IEFAB481  74.211'                              01S0001
         DROP  @15
@PROLOG  STM   @14,@12,12(@13)                                  01S0001
         BALR  @12,0                                            01S0001
@PSTART  DS    0H                                               01S0001
         USING @PSTART,@12                                      01S0001
         L     @00,@SIZDATD                                     01S0001
         MODESET EXTKEY=SCHED,SAVEKEY=(2)
         GSPACE   R,LV=(0)
         LR    @11,@01                                          01S0001
         USING @DATD,@11                                        01S0001
         ST    @13,@SA00001+4                                   01S0001
         STC   @02,@OLDKEY                                      01S0001
         MODESET KEYADDR=(2)
         LM    @00,@02,20(@13)                                  01S0001
         ST    @11,8(,@13)                                      01S0001
         LR    @13,@11                                          01S0001
         MODESET EXTKEY=ZERO
         MVC   @PC00001(8),0(@01)                               01S0001
         MODESET EXTKEY=SCHED
*SIOTAFID = ZERO;                      /*TURN OFF MULTI INDICATOR    */
         L     @10,@PC00001                                     01S0023
         L     @10,SIOTPTR(,@10)                                01S0023
         SLR   @03,@03                                          01S0023
         STH   @03,SIOTAFID(,@10)                               01S0023
*EDLPTR = EDLFGENP;                    /*POINT TO FIRST GEN IN EDL   */
         L     @10,SIOTEDLP(,@10)                               01S0024
         L     EDLPTR,EDLFGENP(,@10)                            01S0024
*DO GENCTR = ONE TO EDLGENNO;          /*SCAN ALL GENS IN THE EDL    */
         LA    GENCTR,1                                         01S0025
         B     @DE00025                                         01S0025
@DL00025 DS    0H                                               01S0026
*  IF EDLDEVT = DEVTYPE THEN           /*IS THIS THE GEN ALLOC'D ?   */
         L     @10,@PC00001+4                                   01S0026
         CLC   EDLDEVT(4,EDLPTR),DEVTYPE(@10)                   01S0026
         BNE   @RF00026                                         01S0026
*    DO;                               /*YES, UPDATE THE ALG TABLES  */
*      VUPTR = SVOLUNAD;               /*POINT TO SIOTS FIRST VOLUNIT*/
         L     @10,@PC00001                                     01S0028
         L     @10,SIOTPTR(,@10)                                01S0028
         L     VUPTR,SVOLUNAD(,@10)                             01S0028
*      DO VUCTR = ONE TO SVOLUNNO;     /*PROCESS ALL VOLUNIT ENTRIES */
         LA    VUCTR,1                                          01S0029
         B     @DE00029                                         01S0029
@DL00029 DS    0H                                               01S0030
*        GRPLISTP = CVRGRPPT;          /*POINT TO FIRST ALG GROUP ENT*/
         L     @10,VOLALGTP(,VUPTR)                             01S0030
         L     GRPLISTP,CVRGRPPT(,@10)                          01S0030
*        ECOUNT = ZERO;                /*INITIALIZE COUNT TO 0       */
         SLR   ECOUNT,ECOUNT                                    01S0031
*        DO GRPCTR = ONE TO CVRNGRP;   /*SCAN ALL ALG GROUP ENTRIES  */
         LA    GRPCTR,1                                         01S0032
         B     @DE00032                                         01S0032
@DL00032 DS    0H                                               01S0033
*          IF EDLGRID = CVRGRPID THEN  /*IS GROUP THE FIRST ELIGIBLE?*/
         L     @10,EDLGRPTR(,EDLPTR)                            01S0033
         L     @10,EDLGRID(,@10)                                01S0033
         CH    @10,CVRGRPID(,GRPLISTP)                          01S0033
         BNE   @RF00033                                         01S0033
*            DO;                       /*YES, ..                     */
*              ECOUNT = EDLGRPNO;      /*SET COUNT OF ELIGIBLE GROUPS*/
         L     ECOUNT,EDLGRPNO(,EDLPTR)                         01S0035
*            END;                                               01S0036
*          ELSE;                       /*GROUP IS NOT THE FIRST ELIG */
@RF00033 DS    0H                                               01S0038
*          IF ECOUNT > ZERO THEN       /*IS THIS AN ELIGIBLE GROUP ? */
         LTR   ECOUNT,ECOUNT                                    01S0038
         BNP   @RF00038                                         01S0038
*            DO;                       /*YES, ..                     */
*              ECOUNT = ECOUNT - ONE;  /*DECREMENT THE COUNT OF ELIG */
         BCTR  ECOUNT,0                                         01S0040
*            END;                                               01S0041
*          ELSE                        /*GROUP IS NOT IN GEN ALLOC'D */
*            DO;                                                01S0042
         B     @RC00038                                         01S0042
@RF00038 DS    0H                                               01S0043
*              CVRGSKP = ON;           /*MARK THE GROUP INELIGIBLE   */
         OI    CVRGSKP(GRPLISTP),B'10000000'                    01S0043
*            END;                                               01S0044
*          GRPLISTP=GRPLISTP+LENGTH(CVRGPLST); /*PT TO NEXT GROUP ENT*/
@RC00038 AH    GRPLISTP,@CH00088                                01S0045
*        END;                                                   01S0046
         AH    GRPCTR,@CH00050                                  01S0046
@DE00032 L     @10,VOLALGTP(,VUPTR)                             01S0046
         CH    GRPCTR,CVRNGRP(,@10)                             01S0046
         BNH   @DL00032                                         01S0046
*        VUPTR = VUPTR + LENGTH(VOLUNTAB); /*PT TO NEXT VOLUNIT ENTRY*/
         AH    VUPTR,@CH00367                                   01S0047
*      END;                                                     01S0048
         AH    VUCTR,@CH00050                                   01S0048
@DE00029 L     @10,@PC00001                                     01S0048
         L     @10,SIOTPTR(,@10)                                01S0048
         CH    VUCTR,SVOLUNNO(,@10)                             01S0048
         BNH   @DL00029                                         01S0048
*    END;                                                       01S0049
*  ELSE                                /*NOT THE GENERIC ALLOCATED   */
*    DO;                                                        01S0050
         B     @RC00026                                         01S0050
@RF00026 DS    0H                                               01S0051
*      EINDEVTP = ON;                  /*MARK GEN INELIGIBLE IN EDL  */
         OI    EINDEVTP(EDLPTR),B'10000000'                     01S0051
*    END;                                                       01S0052
*  EDLPTR = EDLNXTNT;                  /*PTR TO NEXT GEN IN THE EDL  */
@RC00026 L     EDLPTR,EDLNXTNT(,EDLPTR)                         01S0053
*END;                                                           01S0054
         AH    GENCTR,@CH00050                                  01S0054
@DE00025 L     @10,@PC00001                                     01S0054
         L     @10,SIOTPTR(,@10)                                01S0054
         L     @10,SIOTEDLP(,@10)                               01S0054
         C     GENCTR,EDLGENNO(,@10)                            01S0054
         BNH   @DL00025                                         01S0054
*RETURN CODE (ZERO);                   /*RETURN TO CALLER            */
         IC    @02,@OLDKEY                                      01S0055
         L     @13,4(,@13)                                      01S0055
         L     @00,@SIZDATD                                     01S0055
         LR    @01,@11                                          01S0055
         FSPACE   R,LV=(0),A=(1)
         MODESET KEYADDR=(2)
         SLR   @15,@15                                          01S0055
         L     @14,12(,@13)                                     01S0055
         LM    @00,@12,20(@13)                                  01S0055
         BR    @14                                              01S0055
*END IEFAB481                                                   01S0056
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.      *
*/*%INCLUDE SYSLIB  (A481SPEC)                                        *
*/*%INCLUDE SYSLIB  (A481DATA)                                        *
*/*%INCLUDE SYSLIB  (IEFZB422)                                        *
*/*%INCLUDE SYSLIB  (IEFZB423)                                        *
*/*%INCLUDE SYSLIB  (IEFZB426)                                        *
*/*%INCLUDE SYSLIB  (IEFASIOT)                                        *
*;                                                              01S0056
@DATA    DS    0H
@CH00050 DC    H'1'
@CH00088 DC    H'16'
@CH00367 DC    H'28'
@DATD    DSECT
         DS    0F
@SA00001 DS    18F
@PC00001 DS    2F
IEFAB481 CSECT
         DS    0F
@DATD    DSECT
         DS    0D
EDLGNTP  DS    A
EDLUCBLP DS    A
ALGTABP  DS    A
@OLDKEY  DS    AL1
IEFAB481 CSECT
         DS    0F
@SIZDATD DC    AL1(230)
         DC    AL3(@ENDDATD-@DATD)
         DS    0D
IEFAB481 CSECT
         DS   0H
PATCHLOC DC ((@DATA-@PSTART)/20)X'00'
@DATD    DSECT
         ORG   *+1-(*-@DATD)/(*-@DATD) INSURE DSECT DATA
@ENDDATD EQU   *
IEFAB481 CSECT
@00      EQU   00                      EQUATES FOR REGISTERS 0-15
@01      EQU   01
@02      EQU   02
@03      EQU   03
@04      EQU   04
@05      EQU   05
@06      EQU   06
@07      EQU   07
@08      EQU   08
@09      EQU   09
@10      EQU   10
@11      EQU   11
@12      EQU   12
@13      EQU   13
@14      EQU   14
@15      EQU   15
VUCTR    EQU   @08
GRPCTR   EQU   @07
GENCTR   EQU   @06
ECOUNT   EQU   @05
VUPTR    EQU   @03
GRPLISTP EQU   @04
EDLPTR   EQU   @02
IEFEDL   EQU   0
EDLHDR   EQU   IEFEDL
EDLGENNO EQU   EDLHDR+4
EDLFGENP EQU   EDLHDR+8
EDLUVFLG EQU   EDLHDR+16
EDLENTRY EQU   0
EDLNXTNT EQU   EDLENTRY
EDLDEVT  EQU   EDLENTRY+4
EDLGRPNO EQU   EDLENTRY+8
EDLGRPTR EQU   EDLENTRY+12
EDLDTFLG EQU   EDLENTRY+20
EINDEVTP EQU   EDLDTFLG
EDLGNTRY EQU   0
EDLGRID  EQU   EDLGNTRY+12
EDLGRFLG EQU   EDLGNTRY+16
EDLUCBL  EQU   0
EDLINDIC EQU   EDLUCBL+2
VOLUNTAB EQU   0
VOLSTAT  EQU   VOLUNTAB+6
VOLSTATA EQU   VOLSTAT
VOLSTATB EQU   VOLSTAT+1
VOLSTATC EQU   VOLSTAT+2
VOLSTATD EQU   VOLSTAT+3
VOLALGTP EQU   VOLUNTAB+12
ALGPTRS  EQU   0
CVRPARM  EQU   0
CVRFLG1  EQU   CVRPARM+8
CVRRQLST EQU   0
CVRMIN   EQU   CVRRQLST+10
CVRFLG2  EQU   CVRRQLST+16
CVRNGRP  EQU   CVRRQLST+18
CVRGRPPT EQU   CVRRQLST+20
CVRGPLST EQU   0
CVRGCPTR EQU   CVRGPLST
CVRGRPID EQU   CVRGPLST+4
CVRFLG3  EQU   CVRGPLST+12
CVRGSKP  EQU   CVRFLG3
GRPCOUNT EQU   0
INDMSIOT EQU   0
SCTUSADD EQU   INDMSIOT+20
SIOTAFID EQU   INDMSIOT+26
SIOTBYT1 EQU   INDMSIOT+43
SIOTBYT3 EQU   INDMSIOT+46
SIOTTSTC EQU   INDMSIOT+47
SIOTBYT0 EQU   INDMSIOT+52
SCTSDISP EQU   INDMSIOT+55
SCTSBYT1 EQU   INDMSIOT+56
SCTSBYT2 EQU   INDMSIOT+57
SCTSBYT3 EQU   INDMSIOT+58
SCTSBYT4 EQU   INDMSIOT+59
SCTUTYPE EQU   INDMSIOT+60
SIOTDEVT EQU   SCTUTYPE
SIOUBYT3 EQU   SIOTDEVT+2
SIOTALTD EQU   INDMSIOT+92
SIOTBYT2 EQU   INDMSIOT+103
SIOTEDLP EQU   INDMSIOT+136
SVOLUNAD EQU   INDMSIOT+140
SVOLUNNO EQU   INDMSIOT+168
SIOTPTR  EQU   0
DEVTYPE  EQU   0
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS
SIODDSNL EQU   INDMSIOT+173
SIOVDSNL EQU   INDMSIOT+172
SIOVDSNT EQU   INDMSIOT+170
SIOTVMVP EQU   INDMSIOT+164
SIOTJFX  EQU   INDMSIOT+160
SJFCBPTR EQU   INDMSIOT+156
SIOTNPTR EQU   INDMSIOT+152
SIOTETIO EQU   INDMSIOT+148
SIOTATE  EQU   INDMSIOT+144
SIOTEDLS EQU   INDMSIOT+132
SIOTRSNC EQU   INDMSIOT+130
SCTANAME EQU   INDMSIOT+122
@NM00027 EQU   INDMSIOT+108
SIOTSSNM EQU   INDMSIOT+104
SIODDQCR EQU   SIOTBYT2
SIOVDQCR EQU   SIOTBYT2
SIOTCVOL EQU   SIOTBYT2
SIOTCNEW EQU   SIOTBYT2
SIOTCALC EQU   SIOTBYT2
SIOTGALL EQU   SIOTBYT2
SIOTDSPD EQU   SIOTBYT2
SIOTDMND EQU   SIOTBYT2
SIOTOPUC EQU   INDMSIOT+99
SIOTOUTR EQU   INDMSIOT+97
SIOTOUTC EQU   INDMSIOT+96
@NM00026 EQU   INDMSIOT+93
SIOTAUNC EQU   SIOTALTD
SIOTACAT EQU   SIOTALTD
SIOTADEL EQU   SIOTALTD
SIOTAKEP EQU   SIOTALTD
SIOTNPRV EQU   SIOTALTD
SIOJCATS EQU   SIOTALTD
@NM00025 EQU   SIOTALTD
@NM00024 EQU   SIOTALTD
@NM00023 EQU   INDMSIOT+91
SIOTNDSB EQU   INDMSIOT+88
@NM00022 EQU   INDMSIOT+84
SIOTDPCD EQU   INDMSIOT+82
@NM00021 EQU   INDMSIOT+81
SCTOUTPN EQU   INDMSIOT+80
SCTOUTNO EQU   INDMSIOT+76
SCTOUTNM EQU   INDMSIOT+68
SIOUCBAD EQU   SCTUTYPE+5
SIOUCNVT EQU   SCTUTYPE+4
SIOUBYT4 EQU   SIOTDEVT+3
@NM00020 EQU   SIOUBYT3
SIO3UREC EQU   SIOUBYT3
SIO3DISP EQU   SIOUBYT3
SIO3DACC EQU   SIOUBYT3
SIO3COMM EQU   SIOUBYT3
SIO3TAPE EQU   SIOUBYT3
SIOUBYT2 EQU   SIOTDEVT+1
SIOUBYT1 EQU   SIOTDEVT
SIOTOMN  EQU   SCTSBYT4
SIOTIPDI EQU   SCTSBYT4
SIOTVAFF EQU   SCTSBYT4
SIOTSTEP EQU   SCTSBYT4
SIOTASCI EQU   SCTSBYT4
@NM00019 EQU   SCTSBYT4
SIOTGDGA EQU   SCTSBYT4
SCTSGDGS EQU   SCTSBYT4
SCTSOLD  EQU   SCTSBYT3
SCTSMOD  EQU   SCTSBYT3
SCTSNEW  EQU   SCTSBYT3
SCTSYSOU EQU   SCTSBYT3
SCTVREF  EQU   SCTSBYT3
@NM00018 EQU   SCTSBYT3
SCTSYSNE EQU   SCTSBYT3
SCTDSNRF EQU   SCTSBYT3
SCTRECVD EQU   SCTSBYT2
SCTDEFER EQU   SCTSBYT2
SCTLABEL EQU   SCTSBYT2
SCTUNLBD EQU   SCTSBYT2
SCTJOBLB EQU   SCTSBYT2
SCTVOLAF EQU   SCTSBYT2
SIOTCATL EQU   SCTSBYT2
SIOCLUNL EQU   SCTSBYT2
SIOTJSCT EQU   SCTSBYT1
SCTUNAFF EQU   SCTSBYT1
SCTPARLM EQU   SCTSBYT1
SIOTQDSN EQU   SCTSBYT1
SIOTGDSN EQU   SCTSBYT1
SIOTCCAT EQU   SCTSBYT1
SCTSYSIN EQU   SCTSBYT1
SCTDUMMY EQU   SCTSBYT1
SIOTUNCT EQU   SCTSDISP
SIOTCTLG EQU   SCTSDISP
SIOTDLET EQU   SCTSDISP
SIOTKEEP EQU   SCTSDISP
SIOTPASS EQU   SCTSDISP
SIOTPRIV EQU   SCTSDISP
S3400DSP EQU   SCTSDISP
@NM00017 EQU   SCTSDISP
SIOTVLCT EQU   INDMSIOT+54
SCTNMBUT EQU   INDMSIOT+53
SIOTRTRY EQU   SIOTBYT0
SIOTPUPV EQU   SIOTBYT0
SIOTNOPV EQU   SIOTBYT0
SIOTGIGN EQU   SIOTBYT0
SPVTAMSG EQU   SIOTBYT0
SIOTFUDA EQU   SIOTBYT0
SIOTDYAL EQU   SIOTBYT0
SIOTSSDS EQU   SIOTBYT0
SIOTGIID EQU   INDMSIOT+50
SCTVOLCT EQU   INDMSIOT+49
SCTSPOOL EQU   INDMSIOT+48
SIOTQNAM EQU   SIOTTSTC
@NM00016 EQU   SIOTTSTC
SIOTTERM EQU   SIOTTSTC
@NM00015 EQU   SIOTTSTC
@NM00014 EQU   SIOTBYT3
SIOTJES3 EQU   SIOTBYT3
SIOCDEVT EQU   SIOTBYT3
SIOALIAS EQU   SIOTBYT3
SCTDDINO EQU   INDMSIOT+44
SIOTDDNT EQU   SIOTBYT1
SIOTALCD EQU   SIOTBYT1
SIODADSM EQU   SIOTBYT1
SIOTDADR EQU   SIOTBYT1
SIODUNAL EQU   SIOTBYT1
SIOVAMDS EQU   SIOTBYT1
SIOTHOLD EQU   SIOTBYT1
SIOTOCKP EQU   SIOTBYT1
SIOPSCNT EQU   INDMSIOT+42
SIOTREFN EQU   INDMSIOT+40
SIOTOTUN EQU   INDMSIOT+39
SIOTVRSB EQU   INDMSIOT+36
@NM00013 EQU   INDMSIOT+35
SCTPJFCB EQU   INDMSIOT+32
@NM00012 EQU   INDMSIOT+31
SCTPSIOT EQU   INDMSIOT+28
@NM00011 EQU   INDMSIOT+24
SIODSNTE EQU   INDMSIOT+22
SIOTUNAF EQU   SCTUSADD
SIOTDEST EQU   INDMSIOT+12
SCTDDNAM EQU   INDMSIOT+4
SIOTTYPE EQU   INDMSIOT+3
SIOTDSKA EQU   INDMSIOT
GRPWPTR  EQU   GRPCOUNT+12
GRPIDENT EQU   GRPCOUNT+10
GRPEXCS  EQU   GRPCOUNT+8
GRPTOTAL EQU   GRPCOUNT+6
GRPOFFLN EQU   GRPCOUNT+4
GRPALLCT EQU   GRPCOUNT+2
GRPAVAIL EQU   GRPCOUNT
@NM00010 EQU   CVRGPLST+13
@NM00009 EQU   CVRFLG3
CVRFORCI EQU   CVRFLG3
CVRBOUND EQU   CVRGPLST+10
CVRGALL  EQU   CVRGPLST+8
CVRGRPAL EQU   CVRGPLST+6
@NM00008 EQU   CVRRQLST+26
CVRWUCBP EQU   CVRRQLST+24
@NM00007 EQU   CVRFLG2+1
CVRDUPLI EQU   CVRFLG2+1
CVRWMOVE EQU   CVRFLG2
CVRIGNOR EQU   CVRFLG2
CVRMULTI EQU   CVRFLG2
CVRSCRTH EQU   CVRFLG2
CVRFULL  EQU   CVRFLG2
CVRREACH EQU   CVRFLG2
CVRRUSED EQU   CVRFLG2
CVRSKFLG EQU   CVRFLG2
CVRGNEXT EQU   CVRRQLST+12
CVRPTS   EQU   CVRMIN
CVRNEED  EQU   CVRRQLST+8
CVRALLCT EQU   CVRRQLST+6
CVRREQ1  EQU   CVRRQLST+4
CVRVUPTR EQU   CVRRQLST
@NM00006 EQU   CVRPARM+9
@NM00005 EQU   CVRFLG1
CVRFCALL EQU   CVRFLG1
CVROFFLG EQU   CVRFLG1
CVRALFLG EQU   CVRFLG1
CVRAVFLG EQU   CVRFLG1
CVRGRPLK EQU   CVRPARM+6
CVRNREQ  EQU   CVRPARM+4
CVRRQPTR EQU   CVRPARM
ALGGCNTP EQU   ALGPTRS+12
ALGGLSTP EQU   ALGPTRS+8
ALGRQLTP EQU   ALGPTRS+4
ALGPARMP EQU   ALGPTRS
VUGRID   EQU   VOLUNTAB+24
VUUCBP   EQU   VOLUNTAB+20
VOLSIOTP EQU   VOLUNTAB+16
VOLUNTID EQU   VOLUNTAB+10
VURCVYPR EQU   VOLSTATD
VUVLUNIQ EQU   VOLSTATD
VUDMUNIQ EQU   VOLSTATD
VUUNALSW EQU   VOLSTATD
VUDMNDAL EQU   VOLSTATD
VUDMNDOF EQU   VOLSTATD
VUREALOC EQU   VOLSTATD
VUMUGDON EQU   VOLSTATD
@NM00004 EQU   VOLSTATC
@NM00003 EQU   VOLSTATC
@NM00002 EQU   VOLSTATC
VOLURREQ EQU   VOLSTATC
VOLGRREQ EQU   VOLSTATC
VOLDAREQ EQU   VOLSTATC
VOLCOREQ EQU   VOLSTATC
VOLTAREQ EQU   VOLSTATC
VUAFFWRK EQU   VOLSTATB
VUVINELG EQU   VOLSTATB
VUDADSME EQU   VOLSTATB
VUDNALOC EQU   VOLSTATB
VUPROCED EQU   VOLSTATB
VDEVREQD EQU   VOLSTATB
VOLMNTD  EQU   VOLSTATB
VOLALOC  EQU   VOLSTATB
VOLDEFER EQU   VOLSTATA
VUDADSM  EQU   VOLSTATA
VOLRESVE EQU   VOLSTATA
VOLNSHR  EQU   VOLSTATA
VOLSTG   EQU   VOLSTATA
VOLSPEC  EQU   VOLSTATA
VOLPRV   EQU   VOLSTATA
VOLPUB   EQU   VOLSTATA
VOLID    EQU   VOLUNTAB
EDLNOJES EQU   EDLINDIC
EDLVOLAF EQU   EDLINDIC
EDLENQ   EQU   EDLINDIC
EDLDADSM EQU   EDLINDIC
EDLALCD  EQU   EDLINDIC
EDLUCBAD EQU   EDLUCBL
EDLJINEL EQU   EDLGRFLG
EDLLISTP EQU   EDLGNTRY+8
EDLUCBNO EQU   EDLGNTRY+4
EDLNXGRP EQU   EDLGNTRY
@NM00001 EQU   EDLENTRY+18
EDLNSCNT EQU   EDLENTRY+16
EDLMGENS EQU   EDLUVFLG
EDLVAM   EQU   EDLUVFLG
EDLGMTP  EQU   EDLHDR+12
EDLLUV   EQU   EDLHDR
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS
@ENDDATA EQU   *
         END   IEFAB481,(C'PLS0414',0603,74211)

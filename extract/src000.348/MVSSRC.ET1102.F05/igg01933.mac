         TITLE 'IGG01933 - ERROR RECOVERY MODULE FOR OPEN EXECUTORS'
IGG01933 CSECT
         SPACE 3
*CHANGE-ACTIVITY = AS FOLLOWS:                                   S21903
******************** MICROFICHE FLAGS *********************** SUPT CODE
*A370720,557000                                                  X01004
*A237000                                                         Y01004
*A438992,521600                                                  X02004
*A109000,126600,136000,145000,152490,213000,311000,438900,538200 A44886
*A540000,541000,549000                                           A44886
*C081000,122000-123000,125000,127000-129000,146000,148000        A44886
*C150000-151000,152210,152290,168000-175000,176100-176500,182000 A44886
*C198000,208000,334000,392000,394000,396500-417000,504000-521809 A44886
*D079000,121000,133000,152070-152140,152560-152630,164000,176900 A44886
*D203000-207000,311060-311840,386700-390200,476000-501900        A44886
*D521818-521989,530000,536000-537000,538500,543000,558000-558500 A44886
*A002000,003000                                                  S21903
*C104000,341000,420000-438000,446000,448000-454000,              S21903
*C463000,465000-466000,469000,471000,523000-529000,              S21903
*C544000-550000,552000,564000-566000,567000-570000               S21903
*C104000,106000,109800,126300,127600,134000,136300,311030-333000,Y05330
*C408000,449000,525000,529000                                    Y05330
*D335000-340000,396000,523000,538700                             Y05330
*A473500                                                         Y01948
*C420000,455000,473000,503000                                    Y01948
*C447000,464000,475000                                          SA64378
*A109500                                                        SA64380
*C127600,136300,315030,408000                                   SA64380
*C317730-318630                                                @YA04911
*A112200                                                       @SA75443
*C139000,212000,237070,237210,316530,370080,370320             @SA75443
*              TCAM 10.0 CHANGES                               @G36XRNP
*A439000,521900                                                @G36XRNP
*C520100                                                       @G36XRNP
*                                                              @G36XRNP
         SPACE 3
***********************************************************************
*                                                                     *
*MODULE-NAME = IGG01933 (TCAM,INIT)                            @G36XRNP
*                                                                S21903
*DESCRIPTIVE-NAME = ERROR RECOVERY MODULE FOR OPEN EXECUTORS     S21903
*                                                                S21903
*COPYRIGHTS = 'NONE'                                             S21903
*                                                                S21903
*STATUS - CHANGE LEVEL 10.0                                    @G36XRNP
*                                                                     *
*FUNCTION/OPERATION - THIS EXECUTOR HANDLES ALL SERIOUS ERRORS        *
*   DETECTED DURING THE OPENING OF A TCAM APPLICATION PROGRAM,        *
*   A MESSAGE QUEUES DATA SET, OR A LINE GROUP.  DEPENDING UPON       *
*   WHAT PARAMETERS ARE PASSED BY THE EXECUTOR FINDING THE ERROR,     *
*   A MESSAGE OF THE FORMAT 'IED008I TCAM OPEN ERROR XXX - Y IN       *
*   DCB ZZZZZZZZ', WHERE XXX IS THE ERROR CODE, Y IS THE SPECIFIC     *
*   REASON CODE, AND ZZZZZZZZ IS THE NAME OF THE DCB IN ERROR, IS     *
*   PUT TO THE SYSTEM CONSOLE.  IF A TCAM ERROR EXIT IS NOT PROVIDED  *
*   BY THE USER, TCAM WILL ABEND WITH A SPECIFIC ABEND CODE.  IF      *
*   A VALID ERROR EXIT IS PROVIDED, THIS EXECUTOR WILL PASS TO        *
*   THE USER'S ERROR HANDLING ROUTINE AN ERROR CODE IN REGISTER 0     *
*   AND AN OPTION CODE IN REGISTER 1 TO PERMIT THE USER TO DECIDE     *
*   WHICH OF THE AVAILABLE OPTIONS HE WISHES TO USE.  IF SUPPLIED     *
*   A RETURN CODE IN REGISTER 15, THIS EXECUTOR MAY ABEND THE         *
*   USER'S TCAM JOB, IGNORE THE DATA SET THAT IS IN ERROR, OR         *
*   CONTINUE PROCESSING WITH LIMITED CAPABILITIES.  SHOULD THE        *
*   USER SPECIFY AN OPTION THAT IS NOT AVAILABLE FOR THE ERROR        *
*   IN QUESTION, THIS EXECUTOR WILL PUT OUT THE ERROR MESSAGE         *
*   AGAIN AND GIVE CONTROL TO THE USER WITH THE SAME PREVIOUS         *
*   OPTIONS SPECIFIED.  THIS LOOPING WILL CONTINUE UNTIL A VALID      *
*   RETURN CODE IS GIVEN                                              *
*                                                                     *
*ENTRY POINTS - THIS EXECUTOR IS ENTERED AT IGG01933 VIA AN XCTL      *
*   FROM ANY OF THE TCAM OPEN EXECUTORS.                              *
*NOTES = SEE BELOW                                             @G36XRNP
*                                                              @G36XRNP
*   DEPENDENCIES = NONE                                        @G36XRNP
*                                                              @G36XRNP
*   RESTRICTIONS = NONE                                        @G36XRNP
*                                                              @G36XRNP
*   REGISTER CONVENTIONS = SEE REGISTER EQUATES                @G36XRNP
*                                                              @G36XRNP
*   PATCH LABEL = NONE                                         @G36XRNP
*                                                              @G36XRNP
*MODULE TYPE = PROCEDURE                                       @G36XRNP
*                                                              @G36XRNP
*   PROCESSOR = ASSEMBLER                                      @G36XRNP
*                                                              @G36XRNP
*   MODULE SIZE = 1024                                         @G36XRNP
*                                                              @G36XRNP
*   ATTRIBUTES= REENTRANT,ENABLED,PRIVILIGED                   @G36XRNP
*                                                              @G36XRNP
*ENTRY POINT = FIRST EXECUTABLE INSTRUCTION                    @G36XRNP
*                                                              @G36XRNP
*   PURPOSE = SEE FUNCTION                                     @G36XRNP
*                                                              @G36XRNP
*   LINKAGE = XCTL FROM TCAM OPEN EXECUTORS                    @G36XRNP
*                                                              @G36XRNP
*INPUT - THE REGISTERS 5,6,7, AND 8 ARE THE INPUT AS FOLLOWS          *
*                                                                     *
*    5 - THE ADDRESS OF THE WTG TABLE PREFIX                     Y02027
*                                                                     *
*    6 - THE ADDRESS OF THE BEGINNING OF THE WHERE-TO-GO TABLE        *
*                                                                     *
*    7 - THE ADDRESS OF THE COPY OF THE CURRENT DCB              Y02027
*                                                                     *
*    8 - THE ADDRESS OF THE CURRENT ENTRY IN THE WHERE-TO-GO          *
*        TABLE                                                        *
*                                                                     *
*OUTPUT - THE OUTPUT DEPENDS UPON WHAT RETURN CODE IS SUPPLIED        *
*   BY THE USER                                                       *
*                                                                     *
*    1)  A RETURN CODE OF 2 OR GREATER                                *
*                                                                     *
*   REGISTERS 7 AND 8 WILL BE DESTROYED BY THE ABEND SVC              *
*                                                                     *
*    2)  A RETURN CODE OF 1                                           *
*                                                                     *
*   REGISTERS 7 AND 8 WILL BE POSITIONED AT THE ENTRY IN THE          *
*   WHERE-TO-GO TABLE PREFIX AND THE WHERE-TO-GO TABLE           Y02027
*   FOR THE EXECUTOR THAT DETECTED THE ERROR.                    Y02027
*                                                                     *
*     3) A RETURN CODE OF 0                                           *
*                                                                     *
*   REGISTERS7 AND 8 WILL BE POSITIONED AT THE CURRENT ENTRIES        *
*   IN THE WHERE-TO-GO TABLE PREFIX AND THE WTG TABLE FOR THE    Y02027
*   NEXT EXECUTOR THAT IS TO BE GIVEN CONTROL                         *
*                                                                     *
*EXIT NORMAL =                                                 @G36XRNP
*   THE EXITS TAKEN DEPEND UPON THE SETTING OF REGISTERS 7 & 8        *
*   THIS ROUTINE EXITS VIA AN XCTL TO THE MODULE IDENTIFIED BY        *
*   THE NEXT NON-ZERO ENTRY IN THE WHERE-TO-GO TABLE OR IT MAY        *
*   XCTL TO THE EXECUTOR THAT FOUND THE ORIGINAL ERROR                *
*                                                              @G36XRNP
*EXIT ERROR = NONE                                             @G36XRNP
*                                                                     *
*EXTERNAL REFERENCES = SEE BELOW                               @G36XRNP
*                                                              @G36XRNP
*   ROUTINE = NONE                                             @G36XRNP
*                                                              @G36XRNP
*   DATA AREAS = OPEN/CLOSE DATA AREA                          @G36XRNP
*                                                              @G36XRNP
*   CONTROL BLOCKS = AVT                                       @G36XRNP
*                    CVT                                       @G36XRNP
*                    DCB                                       @G36XRNP
*                    TCB                                       @G36XRNP
*                    TIOT                                      @G36XRNP
*                                                              @G36XRNP
*   TABLES/WORKAREAS - THE WHERE-TO-GO TABLE CONTAINS THE ID AND      *
*   TTR OF THE OPEN EXECUTOR TO BE GIVEN CONTROL.  THE WHERE-    Y02027
*   TO-GO TABLE PREFIX CONTAINS THE ADDRESS OF A COPY OF EACH    Y02027
*   DCB SPECIFIED IN THE OPEN MACRO INSTRUCTION.    THE AVT           *
*   IS A RESIDENT VECTOR LIST USED TO LOCATE CERTAIN PARAMETERS       *
*   WHICH ARE NEEDED IN PASSING ERROR INDICATORS                      *
*                                                                     *
*   MACROS = ABEND                                             @G36XRNP
*            DEBCHK                                            @G36XRNP
*            FREEMAIN                                          @G36XRNP
*            GETMAIN                                           @G36XRNP
*            MODESET                                           @G36XRNP
*            SYNCH                                             @G36XRNP
*            WTO                                               @G36XRNP
*            XCTL                                              @G36XRNP
*                                                              @G36XRNP
***********************************************************************
         EJECT
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *  Y02027
*                                                             *  Y02027
*                    REGISTER EQUATES                         *  Y02027
*                                                             *  Y02027
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *  Y02027
RE       EQU   0                        WORK REGISTER
RF       EQU   1                        WORK REGISTER
RDCB     EQU   2                        ADDRESS OF THE CURRENT DCB
RTIOT    EQU   3                        TIOT ADDRESS             A44886
RCORE    EQU   4                        ADDRESS OF THE DCB OPEN
*                                         WORK AREA
RPAR     EQU   5                        ADDRESS OF THE BEGINNING OF
*                                         THE DCB PARAMETER LIST
RWTG     EQU   6                        ADDRESS OF THE BEGINNING OF
*                                         THE WHERE-TO-GO TABLE
RPARC    EQU   7                        ADDRESS OF THE CURRENT ENTRY
*                                         IN THE DCB PARAMETER LIST
RWTGC    EQU   8                        ADDRESS OF THE CURRENT ENTRY
*                                         IN THE WHERE-TO-GO TABLE
RAVT     EQU   9                        ADDRESS OF THE AVT
RTCB     EQU   10                       CURRENT TCB ADDRESS      A44886
RDEB     EQU   11                       ADDRESS OF THE CURRENT DEB
RBASE    EQU   12                       BASE OF THIS ROUTINE
RC       EQU   13                       WORK REGISTER
RD       EQU   14                       WORK REGISTER
RJ       EQU   15                       WORK REGISTER
*
         USING IHADCB,RDCB              DCB DSECT
         USING FORCORE,RCORE            OPEN WORK AREA DSECT
         USING IEDQAVTD,RAVT            AVT DSECT
*
         USING *,RJ                                              Y05330
         BAL   RBASE,RESTART            ESTABLISH ADDRESSABILITY Y05330
         DROP  RJ                                                Y05330
         USING *,RBASE
         DC    C'IGG019'                MODULE NAME              Y05330
         EJECT
AMIDCNST DC    C'33'                    ERRORID                  Y05330
         IEDHJN ,                                                Y05330
RESTART  EQU   *                                                 Y05330
         MODESET  EXTKEY=SUPR           GET INTO KEY 0           Y02027
         SPACE 2                                                 Y02027
         L     RCORE,FOUR(0,RWTGC)      OPEN WORKAREA ADDRESS
         L     RDCB,DXUDCBAD            GET THE CURRENT DCB ADDR Y02027
         L     RTCB,CVT                 CVT ADDRESS              A44886
         L     RTCB,0(RTCB)             ADDRESS OF CURRENT AND   A44886
*                                         NEXT TCBS              A44886
         L     RTCB,FOUR(RTCB)          ADDRESS OF CURRENT TCB   A44886
         L     RTIOT,TIOTPTR(RTCB)      ADDRESS OF TASK'S TIOT   A44886
         MVC   DXCCW9(3),ABEND          SET CODE WORKAREA       SA64380
         ICM   RF,ALL,DXCCW10           IS ENTRY FROM AN         Y05330
*                                         APPLICATION PROGRAM OPEN
*                                         EXECUTOR
         BNZ   APPLPROG                 YES, BRANCH
         MVC   DXCCW10+THREE(ONE),AVTOPERT SAVE ERROR CODE     @SA75443
         EJECT
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
*                                                                 *
*        THIS SECTION OF CODE WRITES THE ERROR MESSAGE FOR        *
*        ANY ERRORS DETECTED IN THE OPEN EXECUTORS                *
*                                                                 *
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
WRITE    EQU   *
         LR    RF,RTIOT                 COPY TIOT ADDRESS        A44886
         AH    RF,DCBTIOT               ADD THE DD OFFSET TO THE A44886
*                                         BEGINNING OF THE TABLE
         MVC   MESGERR3(EIGHT),FOUR(RF) MOVE THE DDNAME INTO     A44886
*                                         THE ERROR MESSAGE
         MVI   MESGERR0,LINEABND        MOVE LINE ABEND CODE     Y05330
*                                         INTO THE MESSAGE
         MVI   DXCCW9+ONE,LINEABCD      SET LINE ABEND CODE IN  SA64380
*                                         CASE OF ABEND          A44886
         TM    DCBDSORG+ONE,LINEDCB+RNDCB LINE GROUP OR 3705 DCB S22024
         BNZ   WRITE02                  YES, BRANCH              S22024
         MVI   MESGERR0,MSGABEND        MOVE MESSAGE QUEUES      Y05330
*                                         ABEND CODE INTO THE
*                                         ERROR MESSAGE
         MVI   DXCCW9+ONE,MSGQABCD      SET MESSAGE CODE        SA64380
*                                         CODE IN CASE OF ABEND  A44886
WRITE02  EQU   *
         SR    RF,RF                    CLEAR AN INDEX REGISTER
         IC    RF,DXCCW10+THREE         PICK UP THE ERROR CODE @SA75443
         LA    RJ,ERORCHAR-1(RF)        LOAD THE ADDRESS OF THE
*                                         ERROR CHARACTERS
         MVC   MESGERR1(ONE),0(RJ)      MOVE THE ERROR CHARACTERS
*                                         INTO THE MESSAGE
         SLL   RF,THREE                 MULTIPLY THE ERROR INDICATOR
*                                         BY EIGHT
         LA    RD,ERORWORD-EIGHT(RF)    LOAD THE ADDRESS OF THE  A44886
*                                         ERROR WORD TABLE
         MVC   MESGERR2(SEVEN),0(RD)    MOVE THE IDENTIFYING WORDA44886
         MVI   MESGERR2+SEVEN,BLANK     ADD TRAILING BLANK       A44886
*                                         INTO THE ERROR MESSAGE
         LA    RF,MESSAGE               PRIME REG 1 WITH THE     Y02027
*                                         ADDR OF THE MESSAGE    Y02027
         SPACE 2
PREERR   EQU   *
         SVC   WTO                      ISSUE THE WTO SVC
*
         EJECT
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
*                                                                 *
*        THIS SECTION OF CODE VERIFIES THE VALIDITY OF AN         *
*        ERROR EXIT, GIVES CONTROL TO THE USING PROGRAM           *
*        AND INTERROGATES A USER SUPPLIED RETURN CODE             *
*        TO DETERMINE WHAT IS TO BE DONE REGARDING THE            *
*        ERROR THAT HAS JUST BEEN ENCOUNTERED.                    *
*                                                                 *
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
         L     RF,DCBEXLST              LOAD THE ADDRESS OF THE
*                                         EXIT LIST ADDRESSES
         LA    RF,0(RF)                 CLEAR THE HIGH ORDER BYTE
         LA    RJ,ONE                   GET COMPARISON VALUE     A44886
         CR    RF,RJ                    VALID EXIT LIST ADDRESS  A44886
         BNH   SETSTEP                  NO, BRANCH               A44886
TESTCAM  EQU   *
         CLI   0(RF),LTCAMEXT           TCAM EXIT LIST ADDRESS   A44886
         BE    SETLOCK                  YES, BRANCH              A44886
         CLI   0(RF),TCAMEXIT           IS THIS THE TCAM EXIT LIST
*                                         ADDRESS
         BE    SETLOCK                  YES, BRANCH
         TM    0(RF),LASTENT            IS THIS THE LAST ENTRY IN
*                                         THE EXIT LIST ADDRESSES
         BO    SETSTEP                  YES, BRANCH              A44886
         LA    RF,FOUR(RF)              INCREMENT THE EXIT LIST
*                                         POINTER
         B     TESTCAM                  TEST THE NEXT ADDRESS
         EJECT
SETLOCK  EQU   *
         L     RJ,0(RF)                 LOAD THE EXIT LIST ADDRESS
         NI    DCBOFLGS,LOCKON          TURN ON THE DCBLOCK BIT TO
*                                         INHIBIT ANY I/O SUPPORT
*                                         FUNCTIONS FROM PROCESSING
*                                         THIS PARTICULAR DCB
         L     RF,0(RTCB)               LOAD THE ADDRESS OF THE  A44886
*                                         SUPERVISOR REQUEST BLOCK
*                                         FROM THE TCB
         STM   RDCB,RC,XTNDSAV(RF)      SAVE IGG01933'S REGISTERSA44886
*                                         IN THE EXTENDED SAVE AREA
*                                         OF THE SVRB
         SR    RF,RF                    CLEAR A REGISTER TO HOLD
*                                         THE ERROR TYPE
         IC    RF,SEVEN(RD)             PICK UP OPTION BYTE      A44886
         SR    RE,RE                    CLEAR A REGISTER FOR THE
*                                         ERROR CODE
         IC    RE,DXCCW10+THREE         PUT THE ERROR CODE INTO@SA75443
*                                         REGISTER 0
         L     RD,0(RTCB)               PICK UP SVRB ADDRESS     A44886
*                                         FROM THE TCB           A44886
         LM    RDCB,RD,GENSAV(RD)       LOAD THE USER'S REGISTERS
*                                         FROM THE GENERAL SAVE
*                                         AREA OF THE SVRB
         MODESET EXTKEY=TCAM            TAKE ABEND EXIT IN KEY 6 Y02027
         SPACE 2
         BALR  RD,RJ                    TAKE ABEND EXIT          Y02027
         SPACE 2
         MODESET EXTKEY=SUPR            RETURN TO KEY 0          Y02027
         EJECT
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
*                                                                 *
*        THIS SECTION OF CODE INTERROGATES THE USER SUPPLIED      *
*        RETURN CODE TO DETERMINE WHAT ACTION IS TO BE            *
*        TAKEN REGARDING THE ERROR WE HAVE JUST ENCOUNTERED       *
*                                                                 *
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
         L     RF,CVT                   LOAD THE ADDRESS OF THE CVT
         L     RF,0(RF)                 LOAD THE ADDRESS OF THE
*                                         TCB POINTER
         L     RF,4(RF)                 LOAD THE ADDRESS OF THE
*                                         CURRENT TCB
         L     RF,0(RF)                 LOAD THE ADDRESS OF THE
*                                         SVRB
         LM    RDCB,RC,XTNDSAV(RF)      RESTORE  1933'S REGISTERS
*                                         REGISTERS FROM THE SVRB
         OI    DCBOFLGS,LOCKOFF         RESTORE THE FORMER VALUE OF
*                                         THE LOCK BIT
         CLI   DXCCW10+THREE,ONE        DEB FAILURE FOR LINE   @SA75443
         BE    NODEBCHK                 YES, SKIP DEBCHK         Y01004
         CLI   DXCCW10+THREE,FOURTEN    DEB FAILURE FOR DISK   @SA75443
         BE    NODEBCHK                 YES, SKIP DEBCHK         Y01004
         LR    RCORE,RJ                 SAVE USER'S RETURN CODE  Y01004
         SPACE 2
         DEBCHK (RDCB),TYPE=VERIFY,AM=TCAM VALIDATE DEB          Y01004
         SPACE 2
         LR    RJ,RCORE                 RESTORE RETURN CODE      Y01004
         L     RCORE,FOUR(RWTGC)        ADDR OF OPEN WORK AREA   Y01004
NODEBCHK EQU   *                                                 Y01004
         LA    RF,TWO                   LOAD A COMPARISON VALUE
         CR    RJ,RF                    IS THE RETURN CODE A VALUE
*                                         GREATER THAN 2
         BH    USRABEND                 YES, THEN IT IS THE USER'S
*                                         ABEND CODE
         SLL   RJ,TWO                   MULTIPLY THE RETURN CODE BY
*                                         FOUR
         B     DECTABLE(RJ)             BRANCH TO THE ERROR TABLE
*                                         AS INDEXED BY THE
*                                         RETURN CODE
         EJECT
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
*                                                                 *
*                  XCTL TO THE NEXT OPEN EXECUTOR                 *
*                                                                 *
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
ENDLOAD  EQU   *
         L     RCORE,FOUR(RWTGC)        LOAD THE ADDRESS OF THE
*                                         OPEN WORK AREA
RELOOP   EQU   *
         LA    RWTGC,EIGHT(RWTGC)       INCREMENT THE POINTER TO
*                                         THE NEXT ENTRY IN THE
*                                         WHERE-TO-GO TABLE
         LA    RPARC,FOUR(RPARC)        INCREMENT THE POINTER TO
*                                         THE NEXT ENTRY IN THE DCB
*                                         PARAMETER LIST
         CLC   ZERO(TWO,RWTGC),OPIDCNST HAVE WE REACHED THE END  Y02027
*                                       OF THE WTG TABLE         Y02027
         BNE   RELOOP                   NO, BRANCH               Y02027
*
         LR    RPARC,RPAR               RESET THE POINTER TO THE
*                                         FIRST ENTRY IN THE DCB
*                                         PARAMETER LIST
         LA    RWTGC,WTGFIRST(RWTG)     RESET THE POINTER TO THE
*                                         FIRST ENTRY IN THE WHERE-
*                                         TO-GO TABLE
ZCHECK   EQU   *
         CLI   0(RWTGC),END             HAVE ALL THE EXECUTORS
*                                         PROCESSED THIS DCB
         BNE   CHKSYS                   NO, BRANCH               Y02027
         LA    RWTGC,EIGHT(RWTGC)       GET THE ADDRESS OF THE
*                                         NEXT ENTRY IN THE
*                                         WHERE-TO-GO TABLE
         LA    RPARC,FOUR(RPARC)        GET THE ADDRESS OF THE
*                                         NEXT ENTRY IN THE DCB
*                                         PARAMETER LIST
         B     ZCHECK                   BRANCH
         EJECT                                                   Y02027
CHKSYS   EQU   *                                                 Y02027
         CLC   ZERO(TWO,RWTGC),OPIDCNST HAVE ALL DCB'S BEEN      Y02027
*                                       PROCESSED                Y02027
         BNE   XCTLRTNE                 NO, BRANCH               Y02027
         SPACE 1
*                                       RETURN TO KEY 5 BEFORE   Y02027
         MODESET EXTKEY=DATAMGT         RETURNING TO SYSTEM OPEN Y02027
         SPACE 1
XCTLRTNE EQU   *
         LA    RJ,DXCCW12               LOAD THE ADDRESS OF THE
*                                         LAST DOUBLE WORD IN THE
*                                         OPEN WORK AREA
         MVC   SIX(TWO,RWTG),0(RWTGC)   MOVE THE ID OF THE NEXT
*                                         EXECUTOR INTO THE WHERE-
*                                         TO-GO PARAMETER LIST
         MVC   FOURTEN(THREE,RWTG),TWO(RWTGC)  MOVE THE TTR AND
*                                         LENGTH OF THE EXECUTOR
*                                         INTO THE PARAMETER LIST
         XCTL  DE=(RWTG),SF=(E,(15))    TRANSFER CONTROL
         EJECT
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
*                                                                 *
*        THIS SECTION OF CODE WILL BRANCH TO THE ERROR            *
*        RECOVERY ROUTINE INDICATED BY THE USER'S RETURN CODE     *
*                                                                 *
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
DECTABLE EQU   *
         B     RETURN0                  IGNORE THIS DATA SET
         B     RETURN1                  CONTINUE PROCESSING THIS
*                                         DCB, BUT UNDERSTAND THAT
*                                         IT HAS A LIMITED CAPABILITY
SETSTEP  EQU   *                                                 Y05330
         ICM   RJ,AD,DXCCW9             GET ABEND CODE          SA64380
         L     RCORE,FOUR(ZERO,RWTGC)   OPEN WORK AREA ADDR      Y02027
         ICM   RE,ALL,DXCCW10           APPL PGM ABENDING        Y02027
         BNZ   APPL                     YES, BRANCH              Y02027
         SR    RE,RE                    CLEAR FOR INSERT         Y02027
O        IC    RE,DXCCW10+THREE         GET ERROR CODE FOR 040 @SA75443
*                                       AND 041 ABENDS           Y02027
         B     USRABEND                 ISSUE ABEND              Y02027
APPL     EQU   *                                                 Y02027
         SLL   RE,MOVE24                SHIFT ERROR BYTE TO    @YA04911
*                                        CLEAR REGISTER AND    @YA04911
         SRL   RE,MOVE24+TWO            SHIFT BACK, DIVIDING   @YA04911
*                                        BY 4.                 @YA04911
USRABEND EQU   *                                                 Y05330
         SPACE 1
         MODESET EXTKEY=DATAMGT         ABEND IN KEY OF          Y02027
*                                       COMMON OPEN              Y02027
         SPACE 1
         LR    RF,RJ                    MOVE CODE TO REG ONE     Y05330
         ICM   RF,HI,STEPCODE           GET THE DUMP/STEP CODE   Y05330
         ABEND (1)                      ISSUE ABEND              Y02027
         EJECT
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
*                                                                 *
*        THE USER HAS INDICATED THAT HE IS ABLE TO OPERATE        *
*        WITHOUT THIS DATA SET, SO THE DCB WILL BE FLAGGED        *
*        TO PREVENT ANY FURTHER PROCESSING BY ANY OPEN EXECUTORS  *
*                                                                 *
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
RETURN0  EQU   *
         MVI   0(RWTGC),END             ZERO THE MODULE ID FOR THIS
*                                         DCB TO INDICATE THAT NO
*                                         FURTHER PRCOESSING IS TO
*                                         BE DONE
         NI    DCBOFLGS,NOTOPEN         TURN OFF THE BIT WHICH
*                                         INDICATES THAT THIS DCB
*                                         WAS SUCCESSFULLY OPENED
*                                         AND TURN OFF THE BUSY BIT
*                                         TO PREVENT PROCESSING BY
*                                         ANY I/O SUPPORT FUNCTIONS
         B     ENDLOAD                  GO TO ROUTINE END
         EJECT
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
*                                                                 *
*        THIS SECTION OF CODE USES THE MODULE IDENTIFIER          *
*        TO GENERATE AN INDEX INTO THE BRANCH TABLE WHICH         *
*        BRANCHES TO THE ERROR ROUTINES FOR EACH MODULE           *
*                                                                 *
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
RETURN1  EQU   *
         CLI   DXCCW10+THREE,EXERR02    IS THIS A MIXED DEVICES@SA75443
*                                         ERROR
         BE    SETTR01                  YES, BRANCH
         CLI   DXCCW10+THREE,EXERR19    IS THIS UNOPENED DATA  @SA75443
*                                         SET ERROR
         BNE   WRITE                    NO, BRANCH
         MVC   0(FIVE,RWTGC),LINE2      SET THE ID AND TTR FOR THE
*                                         NEXT MODULE TO RECEIVE
*                                         CONTROL FOR THIS DCB
         LA    RE,TWOK                  LENGTH OF IGG01936       X01004
         STCM  RE,THREE,XCLENGTH(RWTG)  SET LENGTH IN WTG TABLE  X01004
         NI    RLDSET(RWTG),RLD         MORE THAN ONE TEXT RECORDX01004
         B     LOADWORK                 SET THE WORK AREA ADDRESS
SETTR01  EQU   *
         MVC   0(FIVE,RWTGC),LINE1      SET THE ID AND TTR FOR THE
*                                         NEXT MODULE TO RECEIVE
*                                         CONTROL FOR THIS DCB
LOADWORK EQU   *
         L     RCORE,FOUR(RWTGC)        LOAD THE ADDRESS OF THE
*                                         OPEN WORK AREA
         MVC   0(TWO,RCORE),AMIDCNST    SET THE ERROR IDENTIFIER IN
*                                         THE OPEN WORK AREA
         B     XCTLRTNE                 GO TO THE XCTL ROUTINE
         EJECT
APPLPROG EQU   *
         MVC   APERR3(EIGHT),0(RTIOT)   MOVE JOBNAME TO WORKAREA
         LR    RD,RTIOT                 COPY THE TIOT ADDRESS    A44886
         AH    RD,DCBTIOT               ADD THE DD OFFSET TO THE A44886
*                                       BEGINNING OF THE TABLE
         MVC   APERR2(EIGHT),FOUR(RD)   MOVE THE DDNAME INTO     A44886
*                                       ERROR MESSAGE WORKAREA
         SRL   RF,TWO                   DIVIDE ERROR CODE BY FOURA44886
         STC   RF,APERR1                SAVE THE ERROR VALUE     A44886
         OI    APERR1,ZONE              CONVERT TO EBCDIC        A44886
         MVI   DXCCW9+ONE,APLABEND      SET A.P. ABEND          SA64380
*                                         CODE IN CASE OF ABEND  A44886
         LA    RF,APERR                 PRIME REG 1 WITH THE     Y02027
*                                         ADDR OF THE MESSAGE    Y02027
         B     PREERR                   GO PERFORM WTO SVC
         EJECT
ERORCHAR EQU   *                        TABLE OF ERROR CHARACTERSY01948
         DC    C'1'                     TCAM ERROR NUMBER 01     S21903
         DC    C'2'                     TCAM ERROR NUMBER 02     S21903
         DC    C'3'                     TCAM ERROR NUMBER 03     S21903
         DC    C'4'                     TCAM ERROR NUMBER 04     S21903
         DC    C'5'                     TCAM ERROR NUMBER 05     S21903
         DC    C'6'                     TCAM ERROR NUMBER 06     S21903
         DC    C'7'                     TCAM ERROR NUMBER 07     S21903
         DC    C'8'                     TCAM ERROR NUMBER 08     S21903
         DC    C'9'                     TCAM ERROR NUMBER 09     S21903
         DC    C'1'                     TCAM ERROR NUMBER 10     S21903
         DC    C'2'                     TCAM ERROR NUMBER 11     S21903
         DC    C'3'                     TCAM ERROR NUMBER 12     S21903
         DC    C'4'                     TCAM ERROR NUMBER 13     S21903
         DC    C'5'                     TCAM ERROR NUMBER 14     S21903
         DC    C'6'                     TCAM ERROR NUMBER 15     S21903
         DC    C'7'                     TCAM ERROR NUMBER 16     S21903
         DC    C'A'                     TCAM ERROR NUMBER 17     S21903
         DC    C'B'                     TCAM ERROR NUMBER 18     S21903
         DC    C'C'                     TCAM ERROR NUMBER 19
         DC    C'D'                     TCAM ERROR NUMBER 20
         DC    C'E'                     TCAM ERROR NUMBER 21
         DC    C'F'                     TCAM ERROR NUMBER 22
         DC    C'G'                     TCAM ERROR NUMBER 23
         DC    C'H'                     TCAM ERROR NUMBER 24     A44886
         DC    C'J'                     TCAM ERROR NUMBER 25     S22024
         DC    C'K'                     TCAM ERROR NUMBER 26     S22024
         DC    C'L'                     TCAM ERROR NUMBER 27     S22024
         DC    C'M'                     TCAM ERROR NUMBER 28     S22024
         DC    C'N'                     TCAM ERROR NUMBER 29     S22024
         DC    C'O'                     TCAM ERROR NUMBER 30     S22024
         DC    C'I'                     OS ASSEMBLY NOT ALLOWED  X02004
         DC    C'P'                     INVOKER NOT IN KEY 6     Y02027
         DC    C'Q'                     NO CORE FOR IOSB       @G36XRNP
         EJECT
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
*                                                                 *
*        THIS IS THE FORMAT OF THE OPEN ERROR MESSAGE             *
*                                                                 *
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
         CNOP  0,4
MESSAGE  DC    AL2(MESGEND-*)           LENGTH OF MESSAGE        S21903
         DC    X'8000'                  MCSFLAGS FIELD          SA64378
         DC    C'IED008I TCAM OPEN ERROR '  MESSAGE TEXT         S21903
         DC    C'04'                    ABEND CODE               Y05330
MESGERR0 DC    C'0 - '                  ABEND CODE               Y05330
MESGERR1 DC    C'0'                     ERROR CHARACTER          S21903
         DC    C' '                     TRAILING BLANK           S21903
MESGERR2 DC    CL8' '                   ERROR WORD               S21903
         DC    C' IN DCB '              DCB                      S21903
MESGERR3 DC    CL8'0'                   DDNAME                   S21903
MESGEND  EQU   *                        END OF OPEN ERROR MSG.   Y01948
         DC    X'1000'                  DESCRIPTOR CODES
         DC    X'0020'                  ROUTING CODES
         EJECT
***********************************************************************
*    THIS IS THE FORMAT OF THE APPL PROG OPEN ERROR MESSAGE           *
***********************************************************************
         CNOP  0,4
APERR    DC    AL2(APEND-*)             MESSAGE LENGTH           S21903
         DC    X'8000'                  MCSFLAGS FIELD          SA64378
         DC    C'IED015I TCAM AP OPEN ERROR'  TEXT               S21903
         DC    C' '                     TRAILING BLANK           S21903
APERR0   DC    C'043 - '                ABEND CODE
APERR1   DC    C'0'                     REASON CODE
         DC    C' '                     TRAILING BLANK           S21903
APERR2   DC    CL8' '                   DDNAME
         DC    C' '                     TRAILING BLANK           S21903
APERR3   DC    CL8' '                   JOBNAME
APEND    EQU   *                        END OF APPLICATION PGM.  Y01948
*                                       OPEN ERROR MESSAGE       Y01948
         DC    X'1000'                  DESCRIPTOR CODE
         DC    X'4120'                  ROUTING CODE            SA64378
         EJECT
ERORWORD EQU   *                        TABLE OF ERROR WORDS     Y01948
         DC    C'DEBCORE',X'03'         NO CORE FOR A DEB        A44886
         DC    C'DEVLINE',X'07'         NON-COMPATIBLE DEVICES   A44886
         DC    C'NOTPDEV',X'03'         UNDEFINED DEVICE CLASS   A44886
         DC    C'CTLUNIT',X'03'         UNSUPPORTED CONTROL UNIT A44886
         DC    C'BRIXUCB',X'03'         INVALID BRANCH INDEX     A44886
         DC    C'DEVCHAR',X'03'         DEVICE TYPE ERROR        A44886
         DC    C'LCBCORE',X'03'         NO CORE FOR LCBS         A44886
         DC    C'SCBCORE',X'03'         NO CORE FOR SCBS         A44886
         DC    C'BSCINER',X'03'         BISC INTERFACE ERROR     A44886
         DC    C'DISKAVT',X'03'         INCORRECT LENGTH AVT     A44886
         DC    C'KEYLNGR',X'03'         NO CPBS FOR DISK QUEUING A44886
         DC    C'DEVUCBS',X'03'         UNLIKE MSG QUEUE DEVICES A44886
         DC    C'QUEUING',X'03'         UNSUPPORTED QUEUING TYPE A44886
         DC    C'MDEBCOR',X'03'         NO MESSAGE QUEUE DEB     A44886
         DC    C'MIOBCOR',X'03'         NO MESSAGE QUEUE IOB     A44886
         DC    C'NOFORMT',X'03'         MSG QUEUE NOT FORMATTED  A44886
         DC    C'NVALUCB',X'03'         NO VALID UCB ADDRESS     A44886
         DC    C'HPSZLRG',X'03'         UNIT SIZE TOO SMALL      A44886
         DC    C'NODATST',X'07'         NO OPENED DATA SET       A44886
         DC    C'NOLINES',X'03'         NO OPENED LINES          A44886
         DC    C'RELINE0',X'03'         INVALID RELATIVE LINE NO A44886
         DC    C'CHARERR',X'03'         CONFLICTING CHAR'ISTICS  A44886
         DC    C'DSPAREA',X'03'         NO CORE FOR SQS LOADLIST A44886
         DC    C'INVLIST',X'03'         NO INVITATION LIST/LINE  A44886
         DC    C'NCPTERM',X'03'         NCP TRM NOT SPECIFIED  @G36XRNP
         DC    C'NVALRLN',X'03'         RLN OTHER THAN 1 FOR 3705S22024
         DC    C'NVALNCP',X'03'         NCP AND MCP CONFLICT     S22024
         DC    C'RSTCORE',X'03'         NO CORE FOR RSID TABLE   S22024
         DC    C'PLCBCOR',X'03'         NO CORE FOR PLCBS        S22024
         DC    C'RRTLMOD',X'03'         RSID TABLE NOT FOUND     S22024
         DC    C'OS MCP ',X'03'         OS MCP ERROR MESSAGE     X02004
         DC    C'NOTKEY6',X'03'         INVOKER NOT IN KEY 6     Y02027
         DC    C'IOSBCOR',X'03'         NO CORE FOR IOSB FOR   @G36XRNP
*                                       NCP I/O DRIVER         @G36XRNP
         EJECT
OPIDCNST DC    C'0S'                    ID FOR COMMON OPEN       Y02027
STEPCODE DC    X'80'                    STEP CODE                Y05330
ABEND    DC    X'040000'                ABEND CODE               Y05330
MSGABEND EQU   C'1'                     MESSAGE ABEND CODE       Y05330
LINEABND EQU   C'0'                     LINE ABEND CODE          Y05330
LINEABCD EQU   X'00'                    LINE CODE                Y05330
MSGQABCD EQU   X'10'                    MESSAGE CODE             Y05330
APLABEND EQU   X'30'                    APL PROGRAM ABEND        Y05330
ALL      EQU   15                       ICM/STCM MASK            Y05330
AD       EQU   7                        ICM/STCM MASK            Y05330
HI       EQU   8                        ICM/STCM MASK            Y05330
END      EQU   X'00'                    END VALUE                S22024
MSGQABND EQU   X'01'                    MSG ABEND                S22024
EXERR02  EQU   X'02'                    ZERO TWO                 S22024
LOCKOFF  EQU   X'02'                    ZERO TWO                 S22024
TCAMEXIT EQU   X'0E'                    TCAMEXIT                 S22024
DCBERR   EQU   X'10'                    DCB ERROR                S22024
MODEBYTE EQU   X'20'                    MODEBYTE                 S22024
BLANK    EQU   X'40'                    BLANK                    S22024
LINEDCB  EQU   X'40'                    LINE DCB                 S22024
RNDCB    EQU   X'04'                    DSORG FOR 3705 DCB       S22024
LASTENT  EQU   X'80'                    LAST ENTRY               S22024
LTCAMEXT EQU   X'8E'                    VALUE                    S22024
NOTOPEN  EQU   X'EE'                    NOT OPEN                 S22024
ZONE     EQU   X'F0'                    ZONE                     S22024
LOCKON   EQU   X'FD'                    LOCK                     S22024
SUBPOOL  EQU   X'FE'                    SUBPOOL                  S22024
MOVE24   EQU   24                       SHIFT LENGTH             Y02027
ZERO     EQU   0                        NUMERIC CONSTANT         Y02027
ONE      EQU   1                        NUMERIC CONSTANT         S21903
TWO      EQU   2                        NUMERIC CONSTANT         S21903
THREE    EQU   3                        NUMERIC CONSTANT         S21903
FOUR     EQU   4                        NUMERIC CONSTANT         S21903
FIVE     EQU   5                        NUMERIC CONSTANT         S21903
SIX      EQU   6                        NUMERIC CONSTANT         S21903
SEVEN    EQU   7                        NUMERIC CONSTANT         S21903
EIGHT    EQU   8                        NUMERIC CONSTANT         S21903
TIOTPTR  EQU   12                       TIOT POINTER             S22024
FOURTEN  EQU   14                       NUMERIC CONSTANT         S22024
CVT      EQU   16                       NUMERIC CONSTANT         S22024
EXERR19  EQU   19                       NUMERIC CONSTANT         S22024
WTGFIRST EQU   32                       NUMERIC CONSTANT         S22024
WTO      EQU   35                       NUMERIC CONSTANT         S22024
GENSAV   EQU   40                       NUMERIC CONSTANT         S22024
TWOK     EQU   2048                     AOS/1 PAGE SIZE          X01004
XCLENGTH EQU   25                       MODULE LENGTH OFFSET     X01004
RLDSET   EQU   22                       RLD OFFSET               X01004
RLD      EQU   X'FE'                    RLD ON FLAG              X01004
BUFFERL  EQU   64                       NUMERIC CONSTANT         S22024
XTNDSAV  EQU   96                       NUMERIC CONSTANT         S22024
NENT     EQU   2                        NUMERIC CONSTANT         S22024
LENGTH   EQU   NENT*6+6                 LENGTH                   S22024
NODBWDS  EQU   (LENGTH+7)/8             LENGTH                   S22024
ORGIDTTR EQU   1024-NODBWDS*8           ADDRESS                  S22024
         ORG   IGG01933+ORGIDTTR        ORG TO START OF TTRTABLE S21903
LINE1    DC    C'35'                    IGG01935                 S21903
         DC    XL4'0'                   TTR AND LENGTH           S21903
LINE2    DC    C'36'                    IGG01936
         DC    XL4'00'                    TTR AND LENGTH
IDEND    DC    XL2'0'                   END OF TTRTABLE          S21903
         CNOP  4,8                                               S21903
LOADID   DC    C'019'                   OPEN ID FOR TTRTABLE     S21903
         DC    YL1(X'80'-NODBWDS)       OFFSET TO TTRTABLE       S21903
         EJECT
         TAVTD
         EJECT
FORCORE  DSECT
         IECDSECT
         EJECT
         DCBD DSORG=TQ
         END

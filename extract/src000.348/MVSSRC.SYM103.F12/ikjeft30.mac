         TITLE 'IKJEFT30, STACK SERVICE ROUTINE - EXEC VERSION         *
                        '
IKJEFT30 CSECT ,                                                   0001
IKJSTCK  DS    0H                                                  0001
         ENTRY IKJSTCK
@MAINENT DS    0H                                                  0001
         USING *,@15                                               0001
         B     @PROLOG                                             0001
         DC    AL2(@EP00001-@MAINENT)
         DC    AL1(16)                                             0001
         DC    C'IKJEFT30  76.260'                                 0001
         DROP  @15
@PROLOG  STM   @14,@12,12(@13)                                     0001
         BALR  @12,0                                               0001
@PSTART  LA    @11,4095(,@12)                                      0001
         USING @PSTART,@12                                         0001
         USING @PSTART+4095,@11                                    0001
         L     @00,@SIZDATD                                        0001
         GETMAIN  R,LV=(0)
         LR    @10,@01                                             0001
         USING @DATD,@10                                           0001
         ST    @13,@SA00001+4                                      0001
         LM    @15,@01,16(@13)                                     0001
         ST    @10,8(,@13)                                         0001
         LR    @13,@10                                             0001
         AH    @15,4(,@15)                                         0001
         BR    @15                                                 0001
@EP00001 MVC   @PC00001(16),0(@01)                                 0001
*                                                                  0053
*   /*****************************************************************/
*   /*                                                               */
*   /* stART EXECUTABLE CODE IF THE POINTER TO THE SERVICE ROUTINES  */
*   /* I/O WORKAREAS IS ZERO THEN THIS IS THE FIRST TIME STACK HAS   */
*   /* BEEN CALLED FOR THE CURRENT TASK , THEREFORE STORAGE MUST BE  */
*   /* OBTAINED AND THE INTERNAL TABLES ESTABLISHED                  */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0053
*   FRELST=''B;                     /* CLEAR FREEMAIN LIST FORM      */
         XC    FRELST(10),FRELST                                   0053
*   GETLST=''B;                     /* CLEAR GETMAIN LIST FORM       */
         XC    GETLST(10),GETLST                                   0054
*   SWS=''B;                        /* CLEAR SWITCHES                */
         MVI   SWS,X'00'                                           0055
*   IF IOSRLPTR=0 THEN              /* IF THIS IS FIRST ENTRY        */
         L     @03,@PC00001+4                                      0056
         L     @03,IOSRLPTR(,@03)                                  0056
         LTR   @03,@03                                             0056
         BNZ   @RF00056                                            0056
*     DO;                                                          0057
*       SPOOL=SP78;                 /* INDICATE SHARED SUBPOOL       */
         MVI   SPOOL,X'4E'                                         0058
*       LEN=IOSRLSIZ+STAKSIZE;      /* LENGTH = LENGTH OF STACK +  0059
*                                      LENGTH OF IOSRL               */
         MVC   LEN(3),@CF00551+1                                   0059
*       RFY                                                        0060
*        (R0,                                                      0060
*         R1) RSTD;                 /* RESTRICT REGS                 */
*       R0=LNGTH;                   /* PLACE GETMAIN PARM IN REG 0   */
         L     R0,LNGTH                                            0061
*       GEN(GETMAIN R,LV=(0));                                     0062
         GETMAIN R,LV=(0)
*       IOSRLPTR=R1;                /* SAVE ADDR OF OBTAND    STORAGE*/
         L     @03,@PC00001+4                                      0063
         ST    R1,IOSRLPTR(,@03)                                   0063
*       RFY                                                        0064
*        (R0,                                                      0064
*         R1) UNRSTD;               /* RELEASE REGS                  */
*       IOSBELM=IOSRLPTR+IOSRLSIZ;  /* FILL IN PTR TO STACK          */
         L     @03,@PC00001+4                                      0065
         L     @03,IOSRLPTR(,@03)                                  0065
         LA    @15,16                                              0065
         ALR   @15,@03                                             0065
         ST    @15,IOSBELM(,@03)                                   0065
*       IOSTELM=IOSBELM-ASTAKELM;   /* THIS CAUSES THE POINTER TO THE
*                                      TOP ELEMENT TO BE ONE WORD  0066
*                                      LESS THAN THE ACTUAL BOTTOM OF
*                                      STACK SO THAT THE ADD LOGIC 0066
*                                      LATER WILL FILL IN THE FIRST
*                                      ELEMENT AT THE PROPER ADDRESS */
         SL    @15,@CF00068                                        0066
         ST    @15,IOSTELM(,@03)                                   0066
*       IOSNELM=0;                  /* INITIALIZE NUMBER OF ELMS=0   */
         SLR   @15,@15                                             0067
         STH   @15,IOSNELM(,@03)                                   0067
*       IOSTLEN=STAKSIZE;           /* INITIALIZE TOTAL STACK LENGH  */
         MVC   IOSTLEN(2,@03),@CH00070                             0068
*     END;                                                         0069
*                                                                  0069
*   /*****************************************************************/
*   /*                                                               */
*   /* DETERMINE FUNCTION -- ADD / DELETE OR CLOSE                   */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0070
*   OPENL(1:OPENLEN)=OPENLOC(1:OPENLEN);/* GET LIST FORM OF OPEN     */
@RF00056 L     @03,OPENLEN                                         0070
         BCTR  @03,0                                               0070
         EX    @03,@SM00776                                        0070
*   IF SPBCLOS=YES THEN             /* IF CLOSE REQUESTED            */
         L     @03,@PC00001+12                                     0071
         TM    SPBCLOS(@03),B'00000001'                            0071
         BNO   @RF00071                                            0071
*     DO;                           /* THEN CALL CLOSE ROUTINE       */
*       IF INSDATA=YES THEN         /* IF DATASET ELEMENT            */
         L     @03,@PC00001+4                                      0073
         L     @03,IOSRLPTR(,@03)                                  0073
         L     @03,IOSTELM(,@03)                                   0073
         TM    INSDATA(@03),B'10000000'                            0073
         BNO   @RF00073                                            0073
*         CALL CLOSERTN;            /* FORCE A RETURN CODE OF ZERO   */
         BAL   @14,CLOSERTN                                        0074
*       RETURN CODE(0);             /* EXIT 1 OF 4                   */
@RF00073 L     @13,4(,@13)                                         0075
         L     @00,@SIZDATD                                        0075
         LR    @01,@10                                             0075
         FREEMAIN R,LV=(0),A=(1)
         SLR   @15,@15                                             0075
         L     @14,12(,@13)                                        0075
         LM    @00,@12,20(@13)                                     0075
         BR    @14                                                 0075
*     END;                          /*                               */
*   ISTCKPTR=IOSBELM;               /* POINT TO BOTTOM OF STACK      */
@RF00071 L     @03,@PC00001+4                                      0077
         L     @03,IOSRLPTR(,@03)                                  0077
         L     @15,IOSBELM(,@03)                                   0077
         LR    ISTCKPTR,@15                                        0077
*   IF SPBADD=NO THEN               /* IF FUNCTION ^= BRANCH         */
         L     @08,@PC00001+12                                     0078
         TM    SPBADD(@08),B'10000000'                             0078
         BZ    @RT00078                                            0078
*     GOTO DELETE;                  /* TO DELETE SECTION             */
*                                                                  0080
*   /*****************************************************************/
*   /*                                                               */
*   /* ADD FUNCTION                                                  */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0080
*   RFY                                                            0080
*     LSDPTR BASED(ADDR(SPBADLSD)); /* SET LSD POINTER               */
*   IF IOSTELM=IOSBELM+IOSTLEN-ASTAKELM THEN/* IF THE CURRENT STACK
*                                      IS FULL THEN OBTAIN A LARGER
*                                      STACK, MOVE CONTENTS OF OLD 0081
*                                      STACK TO NEW AREA AND FREE OLD
*                                      AREA                          */
         LH    @08,IOSTLEN(,@03)                                   0081
         ALR   @15,@08                                             0081
         SL    @15,@CF00068                                        0081
         C     @15,IOSTELM(,@03)                                   0081
         BNE   @RF00081                                            0081
*     DO;                                                          0082
         ST    @08,@TF00001                                        0082
*       SPOOL=SP78;                 /* INDICATE SHARED SUBPOOL       */
         MVI   SPOOL,X'4E'                                         0083
*       LEN=IOSTLEN+STAKSIZE;       /* LENGTH FOR NEW STACK          */
         L     @03,@TF00001                                        0084
         LA    @03,32(,@03)                                        0084
         STCM  @03,7,LEN                                           0084
*       RFY                                                        0085
*        (R0,                                                      0085
*         R1) RSTD;                 /* RESTRICT REGS                 */
*       R0=LNGTH;                   /* PLACE GETMAIN PARM IN REG     */
         L     R0,LNGTH                                            0086
*       GEN(GETMAIN  R,LV=(0));                                    0087
         GETMAIN  R,LV=(0)
*       TEMP31=R1;                  /* SAVE POINTER TO OBTAINED    0088
*                                      STORAGE                       */
         LR    TEMP31,R1                                           0088
*       RFY                                                        0089
*        (R0,                                                      0089
*         R1) UNRSTD;               /* RELEASE REGS                  */
*       IOSNELM=((IOSTELM-IOSBELM)/ASTAKELM)+1;/* CALCULATE THE    0090
*                                      NUMBER OF WORDS TO MOVE       */
         L     @03,@PC00001+4                                      0090
         L     @03,IOSRLPTR(,@03)                                  0090
         L     @00,IOSTELM(,@03)                                   0090
         SL    @00,IOSBELM(,@03)                                   0090
         SRDA  @00,32                                              0090
         D     @00,@CF00068                                        0090
         AL    @01,@CF00040                                        0090
         STH   @01,IOSNELM(,@03)                                   0090
*       RFY                                                        0091
*        (R2,                                                      0091
*         R3,                                                      0091
*         R4,                                                      0091
*         R5) RSTD;                 /* RESTRICT REGS FOR MVCL@Z00868 */
*       R2=ADDR(DUMYSTAK);          /* POINT TO NEW AREA      @Z00868*/
         ST    @03,@TF00001                                        0092
         LR    R2,TEMP31                                           0092
*       R4=ADDR(STCK);              /* POINT TO OLD AREA      @Z00868*/
         LR    R4,ISTCKPTR                                         0093
*       R3=IOSTLEN+STAKSIZE;        /* LENGTH OF NEW CORE     @Z00868*/
         L     @01,@TF00001                                        0094
         LH    @15,IOSTLEN(,@01)                                   0094
         LA    R3,32                                               0094
         ALR   R3,@15                                              0094
*       R5=IOSTLEN;                 /* LENGTH OF OLD CORE     @Z00868*/
         LR    R5,@15                                              0095
*       MVCL(R2,R4);                /* ISSUE MOVE LONG        @Z00868*/
         MVCL  R2,R4                                               0096
*       RFY                                                        0097
*        (R2,                                                      0097
*         R3,                                                      0097
*         R4,                                                      0097
*         R5);                      /* RESTORE REGS           @Z00868*/
*                                                                  0097
*       /*************************************************************/
*       /*                                                           */
*       /* AT THIS POINT TEMP31 IS POINTING TO THE NEW STACK AND     */
*       /* ISTCKPTR IS POINTING TO THE OLD STACK. THE FOLLOWING      */
*       /* SEQUENCE OF INSTRUCTIONS IS GEARED TO PREVENT FUTURE FREE */
*       /* MAIN ABENDS FROM OCCURING IF AN ATTENTION INTERRUPT OCCURS*/
*       /* DURING THEIR EXECUTION                                    */
*       /*                                                           */
*       /*************************************************************/
*                                                                  0098
*       IOSBELM=TEMP31;             /* POINT TO NEW BOTTOM ELEMENT   */
         L     @03,@PC00001+4                                      0098
         L     @03,IOSRLPTR(,@03)                                  0098
         ST    TEMP31,IOSBELM(,@03)                                0098
*       IOSTELM=TEMP31+IOSTLEN-ASTAKELM;/* POINT TO TOP ELEMENT      */
         LH    @15,IOSTLEN(,@03)                                   0099
         LR    @14,TEMP31                                          0099
         ALR   @14,@15                                             0099
         SL    @14,@CF00068                                        0099
         ST    @14,IOSTELM(,@03)                                   0099
*       LEN=IOSTLEN;                /* SAVE LENGTH OF OLD STACK      */
         STCM  @15,7,LEN                                           0100
*       IOSTLEN=LEN+STAKSIZE;       /* CALC NEW STACK LENGTH         */
         AL    @15,@CF00070                                        0101
         STH   @15,IOSTLEN(,@03)                                   0101
*       RFY                                                        0102
*        (R0,                                                      0102
*         R1) RSTD;                 /* RESTRICT REGS                 */
*       R0=LNGTH;                   /* SET UP FREEMAIN PARAMETERS    */
         L     R0,LNGTH                                            0103
*       R1=ISTCKPTR;                                               0104
         LR    R1,ISTCKPTR                                         0104
*       GEN(FREEMAIN  R,LV=(0),A=(1));                             0105
         FREEMAIN  R,LV=(0),A=(1)
*       RFY                                                        0106
*        (R0,                                                      0106
*         R1) UNRSTD;               /* RELEASE REGS                  */
*       ISTCKPTR=TEMP31;            /* UPDATE THE INTERNAL POINTER TO
*                                      STACK                         */
         LR    ISTCKPTR,TEMP31                                     0107
*     END;                          /* END OF FULL STACK PROCESSING  */
*   IF SPBSTOR=YES THEN             /* IF STORAGE ELEMENT            */
@RF00081 L     @03,@PC00001+12                                     0109
         TM    SPBSTOR(@03),B'01000000'                            0109
         BNO   @RF00109                                            0109
*     DO;                                                          0110
*       IF LSDRCLEN=0 THEN          /* IF VARIABLE LEN RCRDS         */
         LA    @03,SPBADLSD(,@03)                                  0111
         L     @03,LSDPTR(,@03)                                    0111
         LH    @15,LSDRCLEN(,@03)                                  0111
         LTR   @15,@15                                             0111
         BNZ   @RF00111                                            0111
*         DO;                                                      0112
*           LNGTH=LSDADATA+LSDTOTLN;/* ESTABLISH END OF LIST         */
         LH    @09,LSDTOTLN(,@03)                                  0113
         AL    @09,LSDADATA(,@03)                                  0113
         ST    @09,LNGTH                                           0113
*           TEMP31=LSDANEXT;        /* POINT TO BEGIN OF LIST        */
         L     TEMP31,LSDANEXT(,@03)                               0114
*           DO WHILE TEMP31^=LNGTH;                                0115
         B     @DE00115                                            0115
@DL00115 DS    0H                                                  0116
*             IF RECLEN<MINSIZE THEN/* IF RECORD LENGTH IS TOO SMALL */
         ICM   @09,12,RECLEN(TEMP31)                               0116
         SRA   @09,16                                              0116
         C     @09,@CF00068                                        0116
         BL    @RT00116                                            0116
*               GOTO INVALID;                                      0117
*             TEMP31=TEMP31+RECLEN; /* POINT TO NEXT RECRD           */
         ALR   TEMP31,@09                                          0118
*             IF TEMP31>LNGTH THEN  /* IF LIST NOT BIG               */
         C     TEMP31,LNGTH                                        0119
         BH    @RT00119                                            0119
*               GOTO INVALID;       /* ENOUGH                        */
*           END;                                                   0121
@DE00115 C     TEMP31,LNGTH                                        0121
         BNE   @DL00115                                            0121
*         END;                                                     0122
*     END;                          /* END VALIDITY CHECKING         */
@RF00111 DS    0H                                                  0124
*   IOSTELM=IOSTELM+ASTAKELM;       /* INCREMENT COUNT OF ELEMNTS    */
@RF00109 L     @03,@PC00001+4                                      0124
         L     @03,IOSRLPTR(,@03)                                  0124
         LA    @15,4                                               0124
         AL    @15,IOSTELM(,@03)                                   0124
         ST    @15,IOSTELM(,@03)                                   0124
*   INSCODE=SPBCODE;                /* PLACE CODE IN STACK           */
         L     @14,@PC00001+12                                     0125
         IC    @09,SPBCODE(,@14)                                   0125
         STC   @09,INSCODE(,@15)                                   0125
*   IF IOSBELM->INSOTDD=YES THEN    /* IF IN BACKGROUND ,INSURE      */
         L     @03,IOSBELM(,@03)                                   0126
         TM    INSOTDD(@03),B'00010000'                            0126
         BNO   @RF00126                                            0126
*     INSOTDD=YES;                  /* OTDD BIT IS PROPAGATED        */
         OI    INSOTDD(@15),B'00010000'                            0127
*   IF SPBSTOR=YES&SPBINDD=NO&SPBOTDD=NO THEN/* ADD STORAGE          */
@RF00126 L     @03,@PC00001+12                                     0128
         TM    SPBSTOR(@03),B'01000000'                            0128
         BNO   @RF00128                                            0128
         TM    SPBINDD(@03),B'00110000'                            0128
         BNZ   @RF00128                                            0128
*     INSADLSD=SPBADLSD;            /* SET INSADLSD TO ADDR OF LSD   */
         L     @15,@PC00001+4                                      0129
         L     @01,IOSRLPTR(,@15)                                  0129
         L     @01,IOSTELM(,@01)                                   0129
         MVC   INSADLSD(3,@01),SPBADLSD+1(@03)                     0129
*   ELSE                            /* ZERO ELEMENT IMPLIES TERMINAL */
*     DO;                           /* ADD A DATASET ELEMENT         */
         B     @RC00128                                            0130
@RF00128 DS    0H                                                  0131
*       IF IOSBELM->INSINDD=YES THEN/* IF IN BACKGROUND , INSURE     */
         L     @03,@PC00001+4                                      0131
         L     @03,IOSRLPTR(,@03)                                  0131
         L     @01,IOSBELM(,@03)                                   0131
         TM    INSINDD(@01),B'00100000'                            0131
         BNO   @RF00131                                            0131
*         INSINDD=YES;              /* INSDD IS PROPAGATED           */
         L     @03,IOSTELM(,@03)                                   0132
         OI    INSINDD(@03),B'00100000'                            0132
*       IF SPBINDD=YES×SPBOTDD=YES THEN/* ARE DDS SUPPLIED           */
@RF00131 L     @03,@PC00001+12                                     0133
         TM    SPBINDD(@03),B'00110000'                            0133
         BZ    @RF00133                                            0133
*         DO;                       /* IF SO, CALL OPENRTN TO SET    */
*           RFY                                                    0135
*             R15 RSTD;             /* RESTRICT REG 15               */
*           CALL OPENRTN;           /* UP IODSD THEN CLEAR FLAGS     */
         BAL   @14,OPENRTN                                         0136
*           IF R15^=0 THEN          /* SET RETURN CODE AND REMOVE    */
         LTR   R15,R15                                             0137
         BZ    @RF00137                                            0137
*             DO;                   /* ELEMENT OFF OF THE STACK      */
*               RETCODE=R15;        /* SET ERROR CODE                */
         LR    RETCODE,R15                                         0139
*               RFY                                                0140
*                 R15 UNRSTD;       /* RELEASE REG 15                */
*               CALL CLOSERTN;      /* CALL CLOSE TO FREE IODSD      */
         BAL   @14,CLOSERTN                                        0141
*               IOSTELM=IOSTELM-ASTAKELM;/* BACK DOWN POINTER        */
         L     @15,@PC00001+4                                      0142
         L     @15,IOSRLPTR(,@15)                                  0142
         L     @14,IOSTELM(,@15)                                   0142
         SL    @14,@CF00068                                        0142
         ST    @14,IOSTELM(,@15)                                   0142
*               RETURN CODE(RETCODE);/* EXIT 2 OF 4                  */
         L     @13,4(,@13)                                         0143
         L     @00,@SIZDATD                                        0143
         LR    @01,@10                                             0143
         FREEMAIN R,LV=(0),A=(1)
         LR    @15,@03                                             0143
         L     @14,12(,@13)                                        0143
         LM    @00,@12,20(@13)                                     0143
         BR    @14                                                 0143
*             END;                  /* IF OPEN SUCCESSFUL, COPY      */
*         END;                      /* END DATASET FUNCTION          */
*       ELSE                                                       0146
*         INSADLSD=0;               /* SET TERMINAL SOURCE           */
         B     @RC00133                                            0146
@RF00133 L     @03,@PC00001+4                                      0146
         L     @03,IOSRLPTR(,@03)                                  0146
         L     @03,IOSTELM(,@03)                                   0146
         SLR   @15,@15                                             0146
         STCM  @15,7,INSADLSD(@03)                                 0146
*     END;                                                         0147
*   GOTO NORMEND;                   /* END OF ADD FUNCTION           */
         B     NORMEND                                             0148
*                                                                  0149
*   /*****************************************************************/
*   /*                                                               */
*   /* D E L E T E F U N C T I O N                                   */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0149
*DELETE:                                                           0149
*   RFY                                                            0149
*     LSDPTR BASED(ADDR(INSTACK));  /* POINT TO CURRENT LSD          */
DELETE   DS    0H                                                  0150
*   IF SPBFLUSH=YES THEN            /* IF THE TMP IS FLUSHING        */
         L     @03,@PC00001+12                                     0150
         TM    SPBFLUSH(@03),B'00001000'                           0150
         BNO   @RF00150                                            0150
*     GEN(STAX DEFER=NO);           /* MAKE SURE ATTN ARE ALLOWED    */
         STAX DEFER=NO
*   IF IOSTELM=IOSBELM THEN         /* IF ONLY 1 ELM EXIT            */
@RF00150 L     @03,@PC00001+4                                      0152
         L     @03,IOSRLPTR(,@03)                                  0152
         L     @15,IOSTELM(,@03)                                   0152
         C     @15,IOSBELM(,@03)                                   0152
         BE    @RT00152                                            0152
*     GOTO NORMEND;                 /* EXIT GRACEFULLY               */
*   IF SPBDLCUR=YES THEN            /* DELETE CURRENT BIT ON?        */
         L     @03,@PC00001+12                                     0154
         TM    SPBDLCUR(@03),B'01000000'                           0154
         BNO   @RF00154                                            0154
*     DO;                           /* IF SO CALL UNSTACK TO FREE    */
*       IF INSEXEC=YES&CMAIN=YES THEN/* CMAIN CLIST ?                */
         TM    INSEXEC(@15),B'00001000'                            0156
         BNO   @RF00156                                            0156
         L     @03,LSDPTR(,@15)                                    0156
         L     @03,LSDEXEC(,@03)                                   0156
         TM    CMAIN(@03),B'00000100'                              0156
         BO    @RT00156                                            0156
*         GOTO NORMEND;             /* DO NOT DELETE                 */
*       CALL UNSTACK;               /* RELATED CORE OR DCBS          */
@RF00156 BAL   @14,UNSTACK                                         0158
*       GO TO UPDATPTR;             /* GO UPDATE TOP ELEM POINTER    */
         B     UPDATPTR                                            0159
*     END;                                                         0160
*   IF SPBDLPRC=NO&SPBDLALL=NO THEN                                0161
@RF00154 L     @03,@PC00001+12                                     0161
         TM    SPBDLPRC(@03),B'00110000'                           0161
         BNZ   @RF00161                                            0161
*     DO;                           /* INVALID PARAMETERS            */
*INVALID:                                                          0163
*       RETCODE=INVALINP;           /* INVALID RC SET                */
INVALID  LA    RETCODE,4                                           0163
*       RETURN CODE(RETCODE);       /* EXIT 3 OF 4                   */
         L     @13,4(,@13)                                         0164
         L     @00,@SIZDATD                                        0164
         LR    @01,@10                                             0164
         FREEMAIN R,LV=(0),A=(1)
         LR    @15,@03                                             0164
         L     @14,12(,@13)                                        0164
         LM    @00,@12,20(@13)                                     0164
         BR    @14                                                 0164
*     END;                                                         0165
*                                                                  0165
*   /*****************************************************************/
*   /*                                                               */
*   /* THE FOLLOWING DO LOOP DELETES EACH ELEM OF THE STACK STARTING */
*   /* FROM THE TOP DOWN TO THE BOTTOM FOR A DELETE ALL FUNCTION OR  */
*   /* DOWN TO AND INCLUDING THE HIGHEST PROC ELEMENT FOR A DELETE   */
*   /* PROC OR TO THE BOTTOM ELEMENT FOR A DELETE PROC IF NO PROC    */
*   /* ELEMENT EXISTS ON THE STACK                                   */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0166
*   DO IOSTELM=IOSTELM TO IOSBELM+ASTAKELM BY-ASTAKELM;            0166
@RF00161 L     @03,@PC00001+4                                      0166
         L     @03,IOSRLPTR(,@03)                                  0166
         L     @03,IOSTELM(,@03)                                   0166
         B     @DE00166                                            0166
@DL00166 DS    0H                                                  0167
*     IF INSEXEC=YES&               /* AN EXEC CLIST ?               */
*         (CMAIN=YES×               /* MAIN OPTION ?                 */
*         (NOFLUSH=YES&             /* OR NOFLUSH AND CERTAIN OPTION */
*         (SPBDLALL=YES&SPBFLUSH=NO))) THEN/* DEL ALL W/ SUPERFL     */
         L     @03,@PC00001+4                                      0167
         L     @03,IOSRLPTR(,@03)                                  0167
         L     @03,IOSTELM(,@03)                                   0167
         TM    INSEXEC(@03),B'00001000'                            0167
         BNO   @RF00167                                            0167
         L     @03,LSDPTR(,@03)                                    0167
         L     @03,LSDEXEC(,@03)                                   0167
         TM    CMAIN(@03),B'00000100'                              0167
         BO    @RT00167                                            0167
         TM    NOFLUSH(@03),B'00100000'                            0167
         BNO   @RF00167                                            0167
         L     @03,@PC00001+12                                     0167
         TM    SPBDLALL(@03),B'00010000'                           0167
         BNO   @RF00167                                            0167
         TM    SPBFLUSH(@03),B'00001000'                           0167
         BZ    @RT00167                                            0167
*       GO TO NORMEND;              /* IF NOFLUSHING ALLOWD          */
*     CALL UNSTACK;                 /* FREE ANY RELATED CORE         */
@RF00167 BAL   @14,UNSTACK                                         0169
*     IF SPBDLPRC=YES THEN                                         0170
         L     @03,@PC00001+12                                     0170
         TM    SPBDLPRC(@03),B'00100000'                           0170
         BNO   @RF00170                                            0170
*       DO;                         /* DELETE PROC FUNCTION REQUSTD  */
*         IF INSPROC=YES THEN                                      0172
         L     @03,@PC00001+4                                      0172
         L     @03,IOSRLPTR(,@03)                                  0172
         L     @03,IOSTELM(,@03)                                   0172
         TM    INSPROC(@03),B'00000010'                            0172
         BNO   @RF00172                                            0172
*           DO;                     /* CURRENT ELEM PROC ELEM ?      */
*UPDATPTR:                                                         0174
*             IOSTELM=IOSTELM-ASTAKELM;/* DECREMENT PTR TO TOP BY 1
*                                      EL                            */
UPDATPTR L     @03,@PC00001+4                                      0174
         L     @03,IOSRLPTR(,@03)                                  0174
         L     @15,IOSTELM(,@03)                                   0174
         SL    @15,@CF00068                                        0174
         ST    @15,IOSTELM(,@03)                                   0174
*             GOTO NORMEND;                                        0175
         B     NORMEND                                             0175
*           END;                                                   0176
*       END;                        /* END DELETE PROC FUNCTION      */
@RF00172 DS    0H                                                  0178
*   END;                            /* END OF UNSTACK LOOP           */
@RF00170 L     @15,@PC00001+4                                      0178
         L     @01,IOSRLPTR(,@15)                                  0178
         L     @03,@CF00766                                        0178
         AL    @03,IOSTELM(,@01)                                   0178
         L     @15,@PC00001+4                                      0178
         L     @01,IOSRLPTR(,@15)                                  0178
         ST    @03,IOSTELM(,@01)                                   0178
@DE00166 L     @15,@PC00001+4                                      0178
         L     @01,IOSRLPTR(,@15)                                  0178
         LA    @00,4                                               0178
         AL    @00,IOSBELM(,@01)                                   0178
         CR    @03,@00                                             0178
         BNL   @DL00166                                            0178
*NORMEND:                                                          0179
*   RETCODE=0;                                                     0179
NORMEND  SLR   RETCODE,RETCODE                                     0179
*   RETURN CODE(RETCODE);           /* EXIT 4 OF 4                   */
         L     @13,4(,@13)                                         0180
         L     @00,@SIZDATD                                        0180
         LR    @01,@10                                             0180
         FREEMAIN R,LV=(0),A=(1)
         LR    @15,@03                                             0180
         L     @14,12(,@13)                                        0180
         LM    @00,@12,20(@13)                                     0180
         BR    @14                                                 0180
*UNSTACK:                                                          0181
*   PROC;                                                          0181
@EL00001 L     @13,4(,@13)                                         0181
@EF00001 L     @00,@SIZDATD                                        0181
         LR    @01,@10                                             0181
         FREEMAIN R,LV=(0),A=(1)
@ER00001 LM    @14,@12,12(@13)                                     0181
         BR    @14                                                 0181
UNSTACK  STM   @14,@12,@SA00002                                    0181
*   IF INSEXEC=YES&INSDATA=YES THEN /* TERMIN DELIM ?                */
         L     @03,@PC00001+4                                      0182
         L     @03,IOSRLPTR(,@03)                                  0182
         L     @03,IOSTELM(,@03)                                   0182
         TM    INSEXEC(@03),B'10001000'                            0182
         BNO   @RF00182                                            0182
*     INSCODE=EXINSAVE;             /* RESTORE OPTIONS               */
         L     @01,LSDPTR(,@03)                                    0183
         L     @01,LSDEXEC(,@01)                                   0183
         SLR   @00,@00                                             0183
         IC    @00,EXINSAVE(,@01)                                  0183
         STC   @00,INSCODE(,@03)                                   0183
*   IF INSSTOR=YES THEN                                            0184
@RF00182 L     @03,@PC00001+4                                      0184
         L     @03,IOSRLPTR(,@03)                                  0184
         L     @03,IOSTELM(,@03)                                   0184
         TM    INSSTOR(@03),B'01000000'                            0184
         BNO   @RF00184                                            0184
*     DO;                           /* IS TOP ELM AN IN-STORAGE LST  */
*       DO;                         /* FREEMAIN (E) A(FREEADDR)    0186
*                                      SP(SP78) MF(M,FRELST)         */
*         FRELST05='00'X;           /* SET TYPE                      */
         MVI   FRELST05,X'00'                                      0187
*         FRELST04=ADDR(FREEADDR);  /* ADDR OF ADDR LIST             */
         LA    @15,FREEADDR                                        0188
         STCM  @15,7,FRELST04                                      0188
*         FRELST06=SP78;            /* SUBPOOL VALUE                 */
         MVI   FRELST06,X'4E'                                      0189
*       END;                        /* FREEMAIN (E) A(FREEADDR)    0190
*                                      SP(SP78) MF(M,FRELST)         */
*       IF INSEXEC=YES THEN         /* IF AN EXEC STACK              */
         TM    INSEXEC(@03),B'00001000'                            0191
         BNO   @RF00191                                            0191
*         DO;                       /* SET UP TO FREE ALL EXEC BLOCKS*/
*           RFY                                                    0193
*             SVTAB BASED(SVTABFST);/* RESET VTAB BASE               */
*           IF SVTABFST^=0 THEN     /* IF A VALUE TABLE PRESENT      */
         SLR   @15,@15                                             0194
         L     @03,LSDPTR(,@03)                                    0194
         L     @03,LSDEXEC(,@03)                                   0194
         L     @14,SVTABFST(,@03)                                  0194
         CR    @14,@15                                             0194
         BE    @RF00194                                            0194
*             DO;                   /* FREE VALUE TABLE              */
         ST    @03,@TF00001                                        0195
*               FREEADDR=SVTABFST;  /* STORAGE ADDRESS               */
         ST    @14,FREEADDR                                        0196
*               FREELEN=SVTABLNG;   /* LENGTH ×F AREA TO FREE        */
         L     FREELEN,SVTABLNG(,@14)                              0197
*               SVTABFST=0;         /* CLEAR                         */
         L     @14,@TF00001                                        0198
         ST    @15,SVTABFST(,@14)                                  0198
*               DO;                 /* FREEMAIN LV(FREELEN)        0199
*                                      MF(E,FRELST)                  */
*                 RESPECIFY                                        0200
*                  (GPR01P) RESTRICTED;                            0200
*                 FRELST02=FREELEN; /* LENGTH                        */
         STCM  FREELEN,7,FRELST02                                  0201
*                 GPR01P=ADDR(FRELST);/* REG1 POINTS TO LIST         */
         LA    GPR01P,FRELST                                       0202
*                 SVC(5);           /* STANDARD-FORM OF GETMAIN      */
         SVC   5                                                   0203
*                 RESPECIFY                                        0204
*                  (GPR01P) UNRESTRICTED;                          0204
*               END;                /* FREEMAIN LV(FREELEN)        0205
*                                      MF(E,FRELST)                  */
*             END;                                                 0206
*           DO WHILE FILEDCBS^=0;   /* FREE FILE BLOCKS IF ANY       */
@RF00194 B     @DE00207                                            0207
@DL00207 DS    0H                                                  0208
*             OPENADR=ADDR(DCBAREA);/* GET ADDR OF DCB               */
         L     @15,@PC00001+4                                      0208
         L     @01,IOSRLPTR(,@15)                                  0208
         L     @01,IOSTELM(,@01)                                   0208
         L     @01,LSDPTR(,@01)                                    0208
         L     @01,LSDEXEC(,@01)                                   0208
         L     OPENADR,FILEDCBS(,@01)                              0208
         LA    OPENADR,DCBAREA(,OPENADR)                           0208
*             GEN REFS(OPENADR)(CLOSE ((OPENADR)),MF=(E,CLOSELST));
         CLOSE ((OPENADR)),MF=(E,CLOSELST)
*             FREEADDR=FILEDCBS;    /* GET ADDR TO FREE              */
         L     @03,@PC00001+4                                      0210
         L     @03,IOSRLPTR(,@03)                                  0210
         L     @03,IOSTELM(,@03)                                   0210
         L     @03,LSDPTR(,@03)                                    0210
         L     @03,LSDEXEC(,@03)                                   0210
         L     @15,FILEDCBS(,@03)                                  0210
         ST    @15,FREEADDR                                        0210
*             FILEDCBS=NEXTFILE;    /* GO TO NEXT BLOCK              */
         L     @15,NEXTFILE(,@15)                                  0211
         ST    @15,FILEDCBS(,@03)                                  0211
*             IF DCBOFOPN=NO THEN   /* AS LONG AS DCB IS CLOSED      */
         TM    DCBOFOPN+40(OPENADR),B'00010000'                    0212
         BNZ   @RF00212                                            0212
*               DO;                 /* FREE ALL STORAGE      @ZA09978*/
*                 IF(DCBBUFCB&1)^=1 THEN/* IF BFR POOL       @ZA09978*/
         LA    @03,1                                               0214
         L     @15,DCBBUFCB+16(,OPENADR)                           0214
         NR    @15,@03                                             0214
         CR    @15,@03                                             0214
         BE    @RF00214                                            0214
*                   GEN REFS(OPENADR)(FREEPOOL (OPENADR));/* @ZA09978*/
         FREEPOOL (OPENADR)
*                 DO;               /* FREEMAIN                    0216
*                                      LV(LENGTH(FILEBLOK)+INLEN)  0216
*                                      MF(E,FRELST)                  */
@RF00214 DS    0H                                                  0217
*                   RESPECIFY                                      0217
*                    (GPR01P) RESTRICTED;                          0217
*                   FRELST02=LENGTH(FILEBLOK)+INLEN;/* LENGTH        */
         L     @03,INLEN                                           0218
         LA    @03,20(,@03)                                        0218
         STCM  @03,7,FRELST02                                      0218
*                   GPR01P=ADDR(FRELST);/* REG1 POINTS TO LIST       */
         LA    GPR01P,FRELST                                       0219
*                   SVC(5);         /* STANDARD-FORM OF GETMAIN      */
         SVC   5                                                   0220
*                   RESPECIFY                                      0221
*                    (GPR01P) UNRESTRICTED;                        0221
*                 END;              /* FREEMAIN                    0222
*                                      LV(LENGTH(FILEBLOK)+INLEN)  0222
*                                      MF(E,FRELST)                  */
*               END;                /*                       @ZA09978*/
*           END;                    /*                               */
@RF00212 DS    0H                                                  0224
@DE00207 L     @03,@PC00001+4                                      0224
         L     @03,IOSRLPTR(,@03)                                  0224
         L     @03,IOSTELM(,@03)                                   0224
         L     @03,LSDPTR(,@03)                                    0224
         L     @03,LSDEXEC(,@03)                                   0224
         L     @03,FILEDCBS(,@03)                                  0224
         LTR   @03,@03                                             0224
         BNZ   @DL00207                                            0224
*           RFY                                                    0225
*             SNTAB BASED(SNTABFST);/* RESET SNTAB BASE              */
*           DO WHILE SNTABFST^=0;   /* FREE ALL NAME TABLES          */
         B     @DE00226                                            0226
@DL00226 DS    0H                                                  0227
*             FREEADDR=SNTABFST;    /* GET ADDR OF TABLE             */
         L     @15,@PC00001+4                                      0227
         L     @01,IOSRLPTR(,@15)                                  0227
         L     @01,IOSTELM(,@01)                                   0227
         L     @01,LSDPTR(,@01)                                    0227
         L     @15,LSDEXEC(,@01)                                   0227
         L     @14,SNTABFST(,@15)                                  0227
         ST    @14,FREEADDR                                        0227
*             FREELEN=SNTABLNG;     /* GET LENGTH OF THE TABLE       */
         L     FREELEN,SNTABLNG(,@14)                              0228
*             SNTABFST=SNTABNXT;    /* GET NEXT BLOCK POINTER        */
         L     @14,SNTABNXT(,@14)                                  0229
         ST    @14,SNTABFST(,@15)                                  0229
*             DO;                   /* FREEMAIN LV(FREELEN)        0230
*                                      MF(E,FRELST)                  */
*               RESPECIFY                                          0231
*                (GPR01P) RESTRICTED;                              0231
*               FRELST02=FREELEN;   /* LENGTH                        */
         STCM  FREELEN,7,FRELST02                                  0232
*               GPR01P=ADDR(FRELST);/* REG1 POINTS TO LIST           */
         LA    GPR01P,FRELST                                       0233
*               SVC(5);             /* STANDARD-FORM OF GETMAIN      */
         SVC   5                                                   0234
*               RESPECIFY                                          0235
*                (GPR01P) UNRESTRICTED;                            0235
*             END;                  /* FREEMAIN LV(FREELEN)        0236
*                                      MF(E,FRELST)                  */
*           END;                                                   0237
@DE00226 SLR   @03,@03                                             0237
         L     @15,@PC00001+4                                      0237
         L     @01,IOSRLPTR(,@15)                                  0237
         L     @01,IOSTELM(,@01)                                   0237
         L     @01,LSDPTR(,@01)                                    0237
         L     @15,LSDEXEC(,@01)                                   0237
         C     @03,SNTABFST(,@15)                                  0237
         BNE   @DL00226                                            0237
*           IF EXDLMPTR^=0 THEN     /* IF DLMBLOCKS                  */
         L     @14,EXDLMPTR(,@15)                                  0238
         CR    @14,@03                                             0238
         BE    @RF00238                                            0238
*             DO;                   /* FREE IT                       */
*               FREEADDR=EXDLMPTR;  /* ADDR OF STORAGE               */
         ST    @14,FREEADDR                                        0240
*               FREELEN=LL;         /* LENGTH OF AREA TO FREE        */
         LH    FREELEN,LL(,@14)                                    0241
*               EXDLMPTR=0;         /* BREAK CONNECTION              */
         SLR   @14,@14                                             0242
         ST    @14,EXDLMPTR(,@15)                                  0242
*               DO;                 /* FREEMAIN LV(FREELEN)        0243
*                                      MF(E,FRELST)                  */
*                 RESPECIFY                                        0244
*                  (GPR01P) RESTRICTED;                            0244
*                 FRELST02=FREELEN; /* LENGTH                        */
         STCM  FREELEN,7,FRELST02                                  0245
*                 GPR01P=ADDR(FRELST);/* REG1 POINTS TO LIST         */
         LA    GPR01P,FRELST                                       0246
*                 SVC(5);           /* STANDARD-FORM OF GETMAIN      */
         SVC   5                                                   0247
*                 RESPECIFY                                        0248
*                  (GPR01P) UNRESTRICTED;                          0248
*               END;                /* FREEMAIN LV(FREELEN)        0249
*                                      MF(E,FRELST)                  */
*             END;                                                 0250
*           IF LSDEXEC^=0 THEN      /* IF NOT FREED ALREADY          */
@RF00238 L     @03,@PC00001+4                                      0251
         L     @03,IOSRLPTR(,@03)                                  0251
         L     @03,IOSTELM(,@03)                                   0251
         L     @03,LSDPTR(,@03)                                    0251
         L     @03,LSDEXEC(,@03)                                   0251
         LTR   @03,@03                                             0251
         BZ    @RF00251                                            0251
*             DO;                   /* FREE EXECDATA                 */
*               IF ATTNCMD=YES THEN /* IS ATTN COMMAND IN EFFECT   0253
*                                                            @ZA08099*/
         TM    ATTNCMD(@03),B'00000001'                            0253
         BNO   @RF00253                                            0253
*                 DO;               /* YES, WE MUST DECREMENT      0254
*                                      RCTDCLST USING STAX   @ZA08099*/
*                   STAXD(1:LENSTAX)=STAXC(1:LENSTAX);/* MOVE CSECT
*                                      TO DSECT              @ZA08099*/
         L     @03,LENSTAX                                         0255
         BCTR  @03,0                                               0255
         EX    @03,@SM00780                                        0255
*                   R2=ADDR(STAXD); /*                       @ZA08099*/
         LA    R2,STAXD                                            0256
*                   STXATTOF='1'B;  /* SET FLAG FOR STAX SERVICE RTN
*                                                            @ZA08099*/
         OI    STXATTOF,B'00000100'                                0257
*                   GEN(STAX MF=(E,(R2)));/*                 @ZA08099*/
         STAX MF=(E,(R2))
*                 END;              /*                       @ZA08099*/
*               FREEADDR=LSDEXEC;   /* ADDRESS OF AREA TO FREE       */
@RF00253 L     @03,@PC00001+4                                      0260
         L     @03,IOSRLPTR(,@03)                                  0260
         L     @03,IOSTELM(,@03)                                   0260
         L     @03,LSDPTR(,@03)                                    0260
         L     @15,LSDEXEC(,@03)                                   0260
         ST    @15,FREEADDR                                        0260
*               LSDEXEC=0;          /* BREAK CONNECTION              */
         SLR   @15,@15                                             0261
         ST    @15,LSDEXEC(,@03)                                   0261
*               DO;                 /* FREEMAIN LV(LENGTH(EXECDATA))
*                                      MF(E,FRELST)                  */
*                 RESPECIFY                                        0263
*                  (GPR01P) RESTRICTED;                            0263
*                 FRELST02=LENGTH(EXECDATA);/* LENGTH                */
         MVC   FRELST02(3),@CF00767+1                              0264
*                 GPR01P=ADDR(FRELST);/* REG1 POINTS TO LIST         */
         LA    GPR01P,FRELST                                       0265
*                 SVC(5);           /* STANDARD-FORM OF GETMAIN      */
         SVC   5                                                   0266
*                 RESPECIFY                                        0267
*                  (GPR01P) UNRESTRICTED;                          0267
*               END;                /* FREEMAIN LV(LENGTH(EXECDATA))
*                                      MF(E,FRELST)                  */
*             END;                                                 0269
*           ECDACBLK=LSDADATA;      /* FREE STORAGE BLOCKS           */
@RF00251 L     @03,@PC00001+4                                      0270
         L     @03,IOSRLPTR(,@03)                                  0270
         L     @03,IOSTELM(,@03)                                   0270
         L     @03,LSDPTR(,@03)                                    0270
         L     ECDACBLK,LSDADATA(,@03)                             0270
*           DO WHILE COMPRNXT^=0;   /* FREE EXTRA STORAGE BLOCKS     */
         B     @DE00271                                            0271
@DL00271 DS    0H                                                  0272
*             FREEADDR=COMPRNXT;    /* GET ADDRESS OF STORAGE BLOCK  */
         L     @05,COMPRNXT-1(,ECDACBLK)                           0272
         LA    @05,0(,@05)                                         0272
         ST    @05,FREEADDR                                        0272
*             FREELEN=COMPRNXT->COMPRLNG;/* GET LENGTH TO FREE       */
         L     FREELEN,COMPRLNG(,@05)                              0273
*             COMPRNXT=COMPRNXT->COMPRNXT;/* GET NEXT BLOCK POINTER  */
         L     @05,COMPRNXT-1(,@05)                                0274
         LA    @05,0(,@05)                                         0274
         STCM  @05,7,COMPRNXT(ECDACBLK)                            0274
*             DO;                   /* FREEMAIN LV(FREELEN)        0275
*                                      MF(E,FRELST)                  */
*               RESPECIFY                                          0276
*                (GPR01P) RESTRICTED;                              0276
*               FRELST02=FREELEN;   /* LENGTH                        */
         STCM  FREELEN,7,FRELST02                                  0277
*               GPR01P=ADDR(FRELST);/* REG1 POINTS TO LIST           */
         LA    GPR01P,FRELST                                       0278
*               SVC(5);             /* STANDARD-FORM OF GETMAIN      */
         SVC   5                                                   0279
*               RESPECIFY                                          0280
*                (GPR01P) UNRESTRICTED;                            0280
*             END;                  /* FREEMAIN LV(FREELEN)        0281
*                                      MF(E,FRELST)                  */
*           END;                    /*                               */
@DE00271 L     @05,COMPRNXT-1(,ECDACBLK)                           0282
         LA    @05,0(,@05)                                         0282
         LTR   @05,@05                                             0282
         BNZ   @DL00271                                            0282
*         END;                      /* DONE EXTRA STORAGE            */
*       FREEADDR=LSDADATA;          /* FREE INSTORAGE LIST           */
@RF00191 L     @15,@PC00001+4                                      0284
         L     @01,IOSRLPTR(,@15)                                  0284
         L     @01,IOSTELM(,@01)                                   0284
         L     @15,LSDPTR(,@01)                                    0284
         L     @14,LSDADATA(,@15)                                  0284
         ST    @14,FREEADDR                                        0284
*       FREELEN=LSDTOTLN;           /* LENGTH OF INSTORAGE LIST      */
         LH    FREELEN,LSDTOTLN(,@15)                              0285
*       DO;                         /* FREEMAIN LV(FREELEN)        0286
*                                      MF(E,FRELST)                  */
*         RESPECIFY                                                0287
*          (GPR01P) RESTRICTED;                                    0287
*         FRELST02=FREELEN;         /* LENGTH                        */
         STCM  FREELEN,7,FRELST02                                  0288
*         GPR01P=ADDR(FRELST);      /* REG1 POINTS TO LIST           */
         LA    GPR01P,FRELST                                       0289
*         SVC(5);                   /* STANDARD-FORM OF GETMAIN      */
         SVC   5                                                   0290
*         RESPECIFY                                                0291
*          (GPR01P) UNRESTRICTED;                                  0291
*       END;                        /* FREEMAIN LV(FREELEN)        0292
*                                      MF(E,FRELST)                  */
*       FREEADDR=LSDPTR;            /* FREE LSD                      */
         L     @03,@PC00001+4                                      0293
         L     @03,IOSRLPTR(,@03)                                  0293
         L     @03,IOSTELM(,@03)                                   0293
         L     @03,LSDPTR(,@03)                                    0293
         ST    @03,FREEADDR                                        0293
*       DO;                         /* FREEMAIN LV(LSDSIZE)        0294
*                                      MF(E,FRELST)                  */
*         RESPECIFY                                                0295
*          (GPR01P) RESTRICTED;                                    0295
*         FRELST02=LSDSIZE;         /* LENGTH                        */
         MVC   FRELST02(3),@CF00185+1                              0296
*         GPR01P=ADDR(FRELST);      /* REG1 POINTS TO LIST           */
         LA    GPR01P,FRELST                                       0297
*         SVC(5);                   /* STANDARD-FORM OF GETMAIN      */
         SVC   5                                                   0298
*         RESPECIFY                                                0299
*          (GPR01P) UNRESTRICTED;                                  0299
*       END;                        /* FREEMAIN LV(LSDSIZE)        0300
*                                      MF(E,FRELST)                  */
*     END;                          /* END OF STORAGE ELEMENT        */
*   IF INSDATA=YES THEN             /* IF DATASET ELEMENT, CALL      */
@RF00184 L     @03,@PC00001+4                                      0302
         L     @03,IOSRLPTR(,@03)                                  0302
         L     @03,IOSTELM(,@03)                                   0302
         TM    INSDATA(@03),B'10000000'                            0302
         BNO   @RF00302                                            0302
*     CALL CLOSERTN;                /* CLOSE ROUTINE                 */
         BAL   @14,CLOSERTN                                        0303
*   END UNSTACK;                    /* END OF UNSTACK                */
@EL00002 DS    0H                                                  0304
@EF00002 DS    0H                                                  0304
@ER00002 LM    @14,@12,@SA00002                                    0304
         BR    @14                                                 0304
*OPENRTN:                                                          0305
*   PROC;                                                          0305
OPENRTN  STM   @14,@12,@SA00003                                    0305
*   RFY                                                            0306
*     INSTACK BASED(IOSTELM+ASTAKELM);/* RESET BASE                  */
*   IOSTELM=IOSTELM-ASTAKELM;       /* BACK DOWN                     */
         L     @08,@PC00001+4                                      0307
         L     @08,IOSRLPTR(,@08)                                  0307
         L     @03,IOSTELM(,@08)                                   0307
         SL    @03,@CF00068                                        0307
         ST    @03,IOSTELM(,@08)                                   0307
*   RETURNCD=0;                     /* SET RETRUN CODE TO 0          */
         SLR   RETURNCD,RETURNCD                                   0308
*   LEN=INLEN+OTLEN+LENGTH(DSDFLAGS);/* GET LENGTH OF IODSD REQ      */
         L     @08,INLEN                                           0309
         AL    @08,OTLEN                                           0309
         LA    @08,16(,@08)                                        0309
         STCM  @08,7,LEN                                           0309
*   SPOOL=SP78;                     /* SET SHARED SUBPOOL            */
         MVI   SPOOL,X'4E'                                         0310
*   RFY                                                            0311
*    (R0,                                                          0311
*     R1) RSTD;                     /* RESTRICT REGS                 */
*   R0=LNGTH;                       /* LOAD REG ZERO FOR GETMAIN     */
         L     R0,LNGTH                                            0312
*   GEN(GETMAIN R,LV=(0));          /* ISSUE GETMAIN                 */
         GETMAIN R,LV=(0)
*   IODSDPTR=R1;                    /* SET BASE FOR IODSD            */
         L     @08,@PC00001+4                                      0314
         L     @08,IOSRLPTR(,@08)                                  0314
         L     @08,IOSTELM(,@08)                                   0314
         STCM  R1,7,IODSDPTR+4(@08)                                0314
*   RFY                                                            0315
*    (R0,                                                          0315
*     R1) UNRSTD;                   /* RELEASE REGS                  */
*   DSDFLAGS=''B;                   /* CLEAR ALL FLAG BITS           */
         L     @08,@PC00001+4                                      0316
         L     @08,IOSRLPTR(,@08)                                  0316
         L     @08,IOSTELM(,@08)                                   0316
         L     @08,IODSDPTR+3(,@08)                                0316
         LA    @08,0(,@08)                                         0316
         XC    DSDFLAGS(16,@08),DSDFLAGS(@08)                      0316
*   DSDOPTS=SPBCODE;                /* SET OPTION BYTE               */
         L     @03,@PC00001+12                                     0317
         IC    @15,SPBCODE(,@03)                                   0317
         STC   @15,DSDOPTS(,@08)                                   0317
*   IF SPBCNTL=YES THEN             /* IF CONTROLS IN DATASET        */
         TM    SPBCNTL(@03),B'00000010'                            0318
         BNO   @RF00318                                            0318
*     DSDCNTL=YES;                  /* SET CNTL BIT                  */
         OI    DSDCNTL(@08),B'01000000'                            0319
*   IF SPBSEQ=YES THEN              /* IF SEQ NUMBERS DESIRED        */
@RF00318 L     @08,@PC00001+12                                     0320
         TM    SPBSEQ(@08),B'00000100'                             0320
         BNO   @RF00320                                            0320
*     DSDSEQ=YES;                   /* SET TO ALLOW SEQ NUMBERS      */
         L     @08,@PC00001+4                                      0321
         L     @08,IOSRLPTR(,@08)                                  0321
         L     @08,IOSTELM(,@08)                                   0321
         L     @08,IODSDPTR+3(,@08)                                0321
         OI    DSDSEQ(@08),B'10000000'                             0321
*   IF IOSBELM->IODSDPTR^=0&IOSBELM->INSPROM=NO THEN/* NOPROMPT      */
@RF00320 L     @08,@PC00001+4                                      0322
         L     @08,IOSRLPTR(,@08)                                  0322
         L     @03,IOSBELM(,@08)                                   0322
         L     @15,IODSDPTR-1(,@03)                                0322
         LA    @15,0(,@15)                                         0322
         LTR   @15,@15                                             0322
         BZ    @RF00322                                            0322
         TM    INSPROM(@03),B'00000100'                            0322
         BNZ   @RF00322                                            0322
*     INSPROM=NO;                   /* INSURE NOPROMPT               */
         L     @08,IOSTELM(,@08)                                   0323
         NI    INSPROM+4(@08),B'11111011'                          0323
*   DSDLINES=56;                    /* NUMBER OF LINES TO A PAGE     */
@RF00322 L     @08,@PC00001+4                                      0324
         L     @08,IOSRLPTR(,@08)                                  0324
         L     @08,IOSTELM(,@08)                                   0324
         L     @08,IODSDPTR+3(,@08)                                0324
         LA    @08,0(,@08)                                         0324
         MVI   DSDLINES(@08),X'38'                                 0324
*   IF SPBINDD=YES THEN             /* IF AN INPUT DCB IS REQ        */
         L     @03,@PC00001+12                                     0325
         TM    SPBINDD(@03),B'00100000'                            0325
         BNO   @RF00325                                            0325
*     IF SPBMBR=NO THEN             /* IF NOT MBR PROCESSING         */
         TM    SPBMBR(@03),B'00001000'                             0326
         BNZ   @RF00326                                            0326
*       DO;                         /* MOVE ONE IN AND OPEN IT       */
*         DSDQSAM=YES;              /* TELL RBBMC TO USE QSAM        */
         OI    DSDQSAM(@08),B'00100000'                            0328
*         INDCB(1:INLEN)=INLST(1:INLEN);/*                           */
         LA    @15,16                                              0329
         LR    @14,@08                                             0329
         ALR   @14,@15                                             0329
         L     @07,INLEN                                           0329
         BCTR  @07,0                                               0329
         EX    @07,@SM00786                                        0329
*         OPENADR=ADDR(INDCB);      /* SET OPEN PARAMETERS           */
         ALR   @08,@15                                             0330
         LR    OPENADR,@08                                         0330
*         DCBDDNAM=INDDNAME;        /* PUT PASSED DDNAME IN DCB      */
         L     @08,SPBINDDN(,@03)                                  0331
         MVC   DCBDDNAM+40(8,OPENADR),INDDNAME(@08)                0331
*         GEN REFS(OPENADR)(OPEN ((OPENADR),(INPUT)),MF=(E,OPENL));
         OPEN ((OPENADR),(INPUT)),MF=(E,OPENL)
*         IF DCBOFOPN=NO THEN       /* IF OPEN UNSUCCESSFUL          */
         TM    DCBOFOPN+40(OPENADR),B'00010000'                    0333
         BNZ   @RF00333                                            0333
*           RETURNCD=BADINOPN;      /* SET RETURNCODE TO 8           */
         LA    RETURNCD,8                                          0334
*         ELSE                      /* IF OK SET MINIMUM             */
*           DO;                     /* BUFFER SIZE                   */
         B     @RC00333                                            0335
@RF00333 DS    0H                                                  0336
*             IF DCBRECL=U THEN     /* FOR UNDEFINED RECORDS         */
         TM    DCBRECL+28(OPENADR),B'11000000'                     0336
         BNO   @RF00336                                            0336
*               DSDMINBF=DCBBLKSI;  /* MIN BFR = BLKSI               */
         L     @08,@PC00001+4                                      0337
         L     @08,IOSRLPTR(,@08)                                  0337
         L     @08,IOSTELM(,@08)                                   0337
         L     @08,IODSDPTR+3(,@08)                                0337
         LH    @03,DCBBLKSI+52(,OPENADR)                           0337
         STH   @03,DSDMINBF(,@08)                                  0337
*             ELSE                  /* OTHERWISE MINIMUB BFR         */
*               DSDMINBF=DCBLRECL;  /* IS DCBLRECL                   */
         B     @RC00336                                            0338
@RF00336 L     @08,@PC00001+4                                      0338
         L     @08,IOSRLPTR(,@08)                                  0338
         L     @08,IOSTELM(,@08)                                   0338
         L     @08,IODSDPTR+3(,@08)                                0338
         LH    @03,DCBLRECL+72(,OPENADR)                           0338
         STH   @03,DSDMINBF(,@08)                                  0338
*           END;                                                   0339
*       END;                                                       0340
*     ELSE                                                         0341
*       DO;                                                        0341
         B     @RC00326                                            0341
@RF00326 DS    0H                                                  0342
*         RFY                                                      0342
*           R15 RSTD;               /* RESTRICT REG                  */
*         DO;                       /* GETMAIN (EC)                0343
*                                      LV(LENGTH(BPAMBLK)+POLEN)   0343
*                                      A(DSDBPAM) SP(78) MF(E,GETLST)
*                                      RTCD(R15)                     */
*           RESPECIFY                                              0344
*            (GPR01P,                                              0344
*             GPR15F) RESTRICTED;                                  0344
*           GETLST04='20'X;         /* TYPE                          */
         MVI   GETLST04,X'20'                                      0345
*           GETLST01=LENGTH(BPAMBLK)+POLEN;/* LENGTH                 */
         LA    @14,156                                             0346
         AL    @14,POLEN                                           0346
         ST    @14,GETLST01                                        0346
*           GETLST03=ADDR(DSDBPAM); /* ADDR OF ADDR LIST             */
         L     @14,@PC00001+4                                      0347
         L     @14,IOSRLPTR(,@14)                                  0347
         L     @14,IOSTELM(,@14)                                   0347
         L     @14,IODSDPTR+3(,@14)                                0347
         LA    @14,0(,@14)                                         0347
         LA    @14,DSDBPAM(,@14)                                   0347
         STCM  @14,7,GETLST03                                      0347
*           GETLST05=78;            /* SUBPOOL VALUE                 */
         MVI   GETLST05,X'4E'                                      0348
*           GPR01P=ADDR(GETLST);    /* REG1 POINTS TO LIST           */
         LA    GPR01P,GETLST                                       0349
*           SVC(4);                 /* STANDARD-FORM OF GETMAIN      */
         SVC   4                                                   0350
*           R15=GPR15F;             /* SET RETURN CODE               */
*           RESPECIFY                                              0352
*            (GPR01P,                                              0352
*             GPR15F) UNRESTRICTED;                                0352
*         END;                      /* GETMAIN (EC)                0353
*                                      LV(LENGTH(BPAMBLK)+POLEN)   0353
*                                      A(DSDBPAM) SP(78) MF(E,GETLST)
*                                      RTCD(R15)                     */
*         IF R15^=0 THEN            /* IF GETMAIN FAILED             */
         LTR   R15,R15                                             0354
         BZ    @RF00354                                            0354
*           DO;                     /*                               */
*             RFY                                                  0356
*               R15 UNRSTD;         /* RELEASE REG                   */
*             NOBPAM=YES;           /* NO BPAM BLOCK                 */
*             NOBFRS=YES;           /* AND NO BUFFERS                */
         OI    NOBPAM,B'01100000'                                  0358
*             RETURNCD=GETFAIL;     /* GETMIAN FAIL                  */
         LA    RETURNCD,20                                         0359
*           END;                    /*                               */
*         ELSE                      /* OTHERWISE                     */
*           DO;                     /* CONTINUE                      */
         B     @RC00354                                            0361
@RF00354 DS    0H                                                  0362
*             DSDFRST=YES;          /* TELL RBBMC TO CHECK FRST      */
         L     @08,@PC00001+4                                      0362
         L     @08,IOSRLPTR(,@08)                                  0362
         L     @08,IOSTELM(,@08)                                   0362
         L     @08,IODSDPTR+3(,@08)                                0362
         LA    @08,0(,@08)                                         0362
         OI    DSDFRST(@08),B'00010000'                            0362
*             BPAMDCB(1:POLEN)=PODCB(1:POLEN);/* GET BPAM DCB        */
         L     @08,DSDBPAM(,@08)                                   0363
         L     @03,POLEN                                           0363
         BCTR  @03,0                                               0363
         EX    @03,@SM00788                                        0363
*             OPENADR=ADDR(BPAMDCB);/* GET ADDR OF DCB               */
         LA    OPENADR,BPAMDCB(,@08)                               0364
*             DCBDDNAM=INDDNAME;    /* GET DD NAME                   */
         L     @08,@PC00001+12                                     0365
         L     @08,SPBINDDN(,@08)                                  0365
         MVC   DCBDDNAM+40(8,OPENADR),INDDNAME(@08)                0365
*             DCBEXLSA=ADDR(EXITPARM);/* SET UP FOR OPEN EXIT        */
         LA    @08,EXITPARM                                        0366
         STCM  @08,7,DCBEXLSA+28(OPENADR)                          0366
*             EXITPARM=DCBEXIT;     /*                               */
         MVI   EXITPARM,X'85'                                      0367
*             EXITADDR=ADDR(BPAMEXIT);/*                             */
         LA    @08,BPAMEXIT                                        0368
         STCM  @08,7,EXITADDR                                      0368
*             GEN FLOWS(BPAMEXIT)                                  0369
*                 (OPEN ((OPENADR),(INPUT)),MF=(E,OPENL));         0369
         OPEN ((OPENADR),(INPUT)),MF=(E,OPENL)
*             IF NOBFRS=YES THEN    /* IF BUFFER GETMAIN FAILED      */
         TM    NOBFRS,B'00100000'                                  0370
         BNO   @RF00370                                            0370
*               RETURNCD=GETFAIL;   /* ERROR CODE                    */
         LA    RETURNCD,20                                         0371
*             ELSE                  /* OTHERWISE                     */
*               IF DCBOFOPN=NO THEN /* IF DCB DID NOT OPEN           */
         B     @RC00370                                            0372
@RF00370 TM    DCBOFOPN+40(OPENADR),B'00010000'                    0372
         BNZ   @RF00372                                            0372
*                 RETURNCD=BADINOPN;/* SET PROPER RETURN CODE        */
         LA    RETURNCD,8                                          0373
*               ELSE                /* IF DCB DID OPEN               */
*                 DO;               /* SET UP TO DO FIND             */
         B     @RC00372                                            0374
@RF00372 DS    0H                                                  0375
*                   IF DCBRECL=U THEN/* FOR FORMAT U, USE BLOCKSIZE  */
         TM    DCBRECL+28(OPENADR),B'11000000'                     0375
         BNO   @RF00375                                            0375
*                     DSDMINBF=DCBBLKSI;/*                           */
         L     @08,@PC00001+4                                      0376
         L     @08,IOSRLPTR(,@08)                                  0376
         L     @08,IOSTELM(,@08)                                   0376
         L     @08,IODSDPTR+3(,@08)                                0376
         LH    @03,DCBBLKSI+52(,OPENADR)                           0376
         STH   @03,DSDMINBF(,@08)                                  0376
*                   ELSE            /* OTHERWISE                     */
*                     DSDMINBF=DCBLRECL;/* USE LRECL                 */
         B     @RC00375                                            0377
@RF00375 L     @08,@PC00001+4                                      0377
         L     @08,IOSRLPTR(,@08)                                  0377
         L     @08,IOSTELM(,@08)                                   0377
         L     @08,IODSDPTR+3(,@08)                                0377
         LH    @03,DCBLRECL+72(,OPENADR)                           0377
         STH   @03,DSDMINBF(,@08)                                  0377
*                   RFY                                            0378
*                    (R4,                                          0378
*                     R15) RSTD;    /* RESTRICT REG 4 AND 15         */
@RC00375 DS    0H                                                  0379
*                   R4=SPBMBRNM;    /* POINT TO MEMBER NAME          */
         L     @14,@PC00001+12                                     0379
         L     R4,SPBMBRNM(,@14)                                   0379
*                   GEN(FIND (OPENADR),(R4),D);/* FIND MEMBER GIVEN  */
         FIND (OPENADR),(R4),D
*                   RFY                                            0381
*                    (R4) UNRSTD;   /* RELEASE REG 4                 */
*                   IF R15^=0 THEN  /* IF MEMBER NOT FOUND           */
         LTR   R15,R15                                             0382
         BZ    @RF00382                                            0382
*                     RETURNCD=NOMEMBER;/* SET ERROR CODE            */
         LA    RETURNCD,16                                         0383
*                   ELSE            /* IF MEMBER FOUND               */
*                     DO;           /* PRIME BUFFERS                 */
         B     @RC00382                                            0384
@RF00382 DS    0H                                                  0385
*                       RFY                                        0385
*                         R15 UNRSTD;/* RELEASE REG                  */
*                       RFY                                        0386
*                        (R4,                                      0386
*                         R5) RSTD; /* RESTRICT REGS                 */
*                       DO I=1 TO DECBMAX;/* GET THE SWOW ON THE ROAD*/
         LA    I,1                                                 0387
         B     @DE00387                                            0387
@DL00387 DS    0H                                                  0388
*                         IF I=1 THEN/* FOR FIRST READ               */
         C     I,@CF00040                                          0388
         BNE   @RF00388                                            0388
*                           R5=CURBLK(1);/* POINT TO GOTTEN BLOCK    */
         L     @08,@PC00001+4                                      0389
         L     @08,IOSRLPTR(,@08)                                  0389
         L     @08,IOSTELM(,@08)                                   0389
         L     @08,IODSDPTR+3(,@08)                                0389
         L     @08,DSDBPAM(,@08)                                   0389
         L     R5,CURBLK(,@08)                                     0389
*                         ELSE      /* OTHERWISE                     */
*                           R5=R5+DCBBLKSI;/* INCREMENT BY BLOCK SIZE*/
         B     @RC00388                                            0390
@RF00388 AH    R5,DCBBLKSI+52(,OPENADR)                            0390
*                         R4=ADDR(CURDECB(I));/* GET ADDR OF DECB TO
*                                      USE                           */
@RC00388 LR    @08,I                                               0391
         MH    @08,@CH00238                                        0391
         L     @15,@PC00001+4                                      0391
         L     @01,IOSRLPTR(,@15)                                  0391
         L     @01,IOSTELM(,@01)                                   0391
         L     @01,IODSDPTR+3(,@01)                                0391
         L     @15,DSDBPAM(,@01)                                   0391
         LA    R4,CURDECB-20(@08,@15)                              0391
*                         CURDECB(I)=RDM(1:READLEN);/* COPY READ LIST
*                                      FORM                          */
         ALR   @08,@15                                             0392
         MVI   CURDECB-19(@08),C' '                                0392
         MVC   CURDECB-18(18,@08),CURDECB-19(@08)                  0392
         L     @14,READLEN                                         0392
         BCTR  @14,0                                               0392
         EX    @14,@SM00790                                        0392
*                         CURBLK(I)=R5;/* SAVE I/O BUFFER POINTER    */
         LR    @08,I                                               0393
         SLA   @08,2                                               0393
         ST    R5,CURBLK-4(@08,@15)                                0393
*                         GEN(READ (R4),SF,(OPENADR),(R5),MF=E);/* 0394
*                                      START I/O                     */
         READ (R4),SF,(OPENADR),(R5),MF=E
*                       END;        /*                               */
         AL    I,@CF00040                                          0395
@DE00387 L     @08,@PC00001+4                                      0395
         L     @08,IOSRLPTR(,@08)                                  0395
         L     @08,IOSTELM(,@08)                                   0395
         L     @08,IODSDPTR+3(,@08)                                0395
         L     @08,DSDBPAM(,@08)                                   0395
         CH    I,DECBMAX(,@08)                                     0395
         BNH   @DL00387                                            0395
*                       RFY                                        0396
*                        (R4,                                      0396
*                         R5) UNRSTD;/* RELEASE REGS                 */
*                       DECBINDX=1; /* INIT INDEX                    */
         L     @08,@PC00001+4                                      0397
         L     @08,IOSRLPTR(,@08)                                  0397
         L     @08,IOSTELM(,@08)                                   0397
         L     @08,IODSDPTR+3(,@08)                                0397
         L     @08,DSDBPAM(,@08)                                   0397
         MVC   DECBINDX(2,@08),@CH00040                            0397
*                     END;                                         0398
*                 END;                                             0399
*           END;                                                   0400
*       END;                                                       0401
*   ELSE                            /*                               */
*     DO;                           /* IF IN BACKGROUND, SET MINBF   */
         B     @RC00325                                            0402
@RF00325 DS    0H                                                  0403
*       IF INSINDD=YES THEN         /*                               */
         L     @08,@PC00001+4                                      0403
         L     @08,IOSRLPTR(,@08)                                  0403
         LA    @03,4                                               0403
         AL    @03,IOSTELM(,@08)                                   0403
         TM    INSINDD(@03),B'00100000'                            0403
         BNO   @RF00403                                            0403
*         DO;                       /*                               */
         ST    @08,@TF00001                                        0404
*           RFY                                                    0405
*             INSTACK BASED(IOSBELM);/* SET BASE                     */
*           TEMP31=DSDMINBF;        /* GET BOTTOM MINBF              */
         L     @01,@TF00001                                        0406
         L     @01,IOSBELM(,@01)                                   0406
         L     @01,IODSDPTR-1(,@01)                                0406
         LH    TEMP31,DSDMINBF(,@01)                               0406
*           RFY                                                    0407
*             INSTACK BASED(IOSTELM+ASTAKELM);/* RESET BASE          */
*           DSDMINBF=TEMP31;        /* SET DSDMINBF                  */
         L     @03,IODSDPTR-1(,@03)                                0408
         STH   TEMP31,DSDMINBF(,@03)                               0408
*         END;                                                     0409
*     END;                                                         0410
@RF00403 DS    0H                                                  0411
*   IF SPBOTDD=YES&RETURNCD=0 THEN  /* IF OUTPUT DCB REQ AND         */
@RC00325 L     @08,@PC00001+12                                     0411
         TM    SPBOTDD(@08),B'00010000'                            0411
         BNO   @RF00411                                            0411
         LTR   RETURNCD,RETURNCD                                   0411
         BNZ   @RF00411                                            0411
*     DO;                           /* INPUT SUCCESSFUL              */
*       DSDQSAM=YES;                /* INDICATE QSAM DCB     @ZA12377*/
         L     @03,@PC00001+4                                      0413
         L     @03,IOSRLPTR(,@03)                                  0413
         L     @03,IOSTELM(,@03)                                   0413
         L     @03,IODSDPTR+3(,@03)                                0413
         LA    @03,0(,@03)                                         0413
         OI    DSDQSAM(@03),B'00100000'                            0413
*       OTDCB(1:OTLEN)=OTLST(1:OTLEN);/* MOVE IN AN OUTPUT DCB       */
         LA    @15,16                                              0414
         AL    @03,INLEN                                           0414
         LR    @14,@03                                             0414
         ALR   @14,@15                                             0414
         L     @07,OTLEN                                           0414
         BCTR  @07,0                                               0414
         EX    @07,@SM00792                                        0414
*       OPENADR=ADDR(OTDCB);        /* A DDNAME , THEN ISSUE         */
         ALR   @03,@15                                             0415
         LR    OPENADR,@03                                         0415
*       DCBDDNAM=OTDDNAME;          /* THE OPEN                      */
         L     @08,SPBOTDDN(,@08)                                  0416
         MVC   DCBDDNAM+40(8,OPENADR),OTDDNAME(@08)                0416
*       DCBEXLSA=ADDR(EXITPARM);    /* PUT PUT EXITPARM IN DCB       */
         LA    @08,EXITPARM                                        0417
         STCM  @08,7,DCBEXLSA+28(OPENADR)                          0417
*       EXITPARM=DCBEXIT;           /* FILL EXIT PARMS               */
         MVI   EXITPARM,X'85'                                      0418
*       EXITADDR=ADDR(OPENEXIT);    /*                               */
         LA    @08,OPENEXIT                                        0419
         STCM  @08,7,EXITADDR                                      0419
*       GEN FLOWS(OPENEXIT) REFS(OPENADR)                          0420
*           (OPEN ((OPENADR),(OUTPUT)),MF=(E,OPENL));              0420
         OPEN ((OPENADR),(OUTPUT)),MF=(E,OPENL)
*       IF DCBOFOPN=NO THEN         /* IF OPEN UNSUCCESSFUL          */
         TM    DCBOFOPN+40(OPENADR),B'00010000'                    0421
         BNZ   @RF00421                                            0421
*         RETURNCD=BADOTOPN;        /* SET RETURNCD TO 12            */
         LA    RETURNCD,12                                         0422
*     END;                                                         0423
@RF00421 DS    0H                                                  0424
*   IOSTELM=IOSTELM+ASTAKELM;       /* RESTORE                       */
@RF00411 L     @08,@PC00001+4                                      0424
         L     @08,IOSRLPTR(,@08)                                  0424
         LA    @03,4                                               0424
         AL    @03,IOSTELM(,@08)                                   0424
         ST    @03,IOSTELM(,@08)                                   0424
*   RFY                                                            0425
*     INSTACK BASED(IOSTELM);                                      0425
*   RETURN CODE(RETURNCD);          /* RETURN TO MAINLINE            */
         LR    @15,RETURNCD                                        0426
         L     @14,@SA00003                                        0426
         LM    @00,@12,@SA00003+8                                  0426
         BR    @14                                                 0426
*   END OPENRTN;                                                   0427
*CLOSERTN:                                                         0428
*   PROC;                                                          0428
CLOSERTN STM   @14,@12,@SA00004                                    0428
*   IF INSINDD=YES×INSOTDD=YES THEN /* IF AN IODSD IS PRESENT        */
         L     @03,@PC00001+4                                      0429
         L     @03,IOSRLPTR(,@03)                                  0429
         L     @03,IOSTELM(,@03)                                   0429
         TM    INSINDD(@03),B'00110000'                            0429
         BZ    @RF00429                                            0429
*     DO;                           /* GET READY TO CLOSE DCBS       */
*       FREE=YES;                   /* AND FREE STORAGE              */
         OI    FREE,B'10000000'                                    0431
*       IF DSDQSAM=YES THEN         /* IF USING QSAM DCB THEN        */
         L     @03,IODSDPTR-1(,@03)                                0432
         LA    @03,0(,@03)                                         0432
         TM    DSDQSAM(@03),B'00100000'                            0432
         BNO   @RF00432                                            0432
*         OPENADR=ADDR(INDCB);      /* SET UP FOR INPUT DCB          */
         AL    @03,@CF00185                                        0433
         LR    OPENADR,@03                                         0433
*       ELSE                        /* IF USING BPAM DCB             */
*         OPENADR=ADDR(BPAMDCB);    /* POINT TO BPAM DCB             */
         B     @RC00432                                            0434
@RF00432 L     @15,@PC00001+4                                      0434
         L     @01,IOSRLPTR(,@15)                                  0434
         L     @01,IOSTELM(,@01)                                   0434
         L     @01,IODSDPTR-1(,@01)                                0434
         L     OPENADR,DSDBPAM(,@01)                               0434
         LA    OPENADR,BPAMDCB(,OPENADR)                           0434
*       IF DSDOPTS(3)=YES&NOBPAM=NO THEN/* FREE CORE AND CLOSE DCB   */
@RC00432 L     @03,@PC00001+4                                      0435
         L     @03,IOSRLPTR(,@03)                                  0435
         L     @03,IOSTELM(,@03)                                   0435
         L     @03,IODSDPTR-1(,@03)                                0435
         LA    @03,0(,@03)                                         0435
         TM    DSDOPTS(@03),B'00100000'                            0435
         BNO   @RF00435                                            0435
         TM    NOBPAM,B'01000000'                                  0435
         BNZ   @RF00435                                            0435
*         DO;                       /* THEN TRY TO CLOSE             */
*           IF NOBFRS=NO&DSDQSAM=NO THEN/* BPAM DCB IN USE           */
         TM    NOBFRS,B'00100000'                                  0437
         BNZ   @RF00437                                            0437
         TM    DSDQSAM(@03),B'00100000'                            0437
         BNZ   @RF00437                                            0437
*             DO;                   /* FREEMAIN (E)                0438
*                                      LV(DECBMAX*DCBBLKSI)        0438
*                                      A(CURBLK(1)) SP(78)           */
*               RESPECIFY                                          0439
*                (GPR01P) RESTRICTED;                              0439
*               I005=I005&&I005;    /* INIT LIST                     */
         XC    I005(10),I005                                       0440
*               I00505='00'X;       /* SET TYPE                      */
         MVI   I00505,X'00'                                        0441
*               I00502=DECBMAX*DCBBLKSI;/* LENGTH                    */
         L     @03,DSDBPAM(,@03)                                   0442
         LH    @00,DECBMAX(,@03)                                   0442
         MH    @00,DCBBLKSI+52(,OPENADR)                           0442
         STCM  @00,7,I00502                                        0442
*               I00504=ADDR(CURBLK(1));/* ADDR OF ADDR LIST          */
         LA    @03,CURBLK(,@03)                                    0443
         STCM  @03,7,I00504                                        0443
*               I00506=78;          /* SUBPOOL VALUE                 */
         MVI   I00506,X'4E'                                        0444
*               GPR01P=ADDR(I005);  /* REG1 POINTS TO LIST           */
         LA    GPR01P,I005                                         0445
*               SVC(5);             /* STANDARD-FORM OF GETMAIN      */
         SVC   5                                                   0446
*               RESPECIFY                                          0447
*                (GPR01P) UNRESTRICTED;                            0447
*             END;                  /* FREEMAIN (E)                0448
*                                      LV(DECBMAX*DCBBLKSI)        0448
*                                      A(CURBLK(1)) SP(78)           */
*           GEN REFS(OPENADR)(CLOSE ((OPENADR)),MF=(E,CLOSELST));  0449
@RF00437 DS    0H                                                  0449
         CLOSE ((OPENADR)),MF=(E,CLOSELST)
*           IF DCBOFOPN=YES THEN    /* IF CLOSE FAILED, DO NOT       */
         TM    DCBOFOPN+40(OPENADR),B'00010000'                    0450
         BNO   @RF00450                                            0450
*             FREE=NO;              /* FREE STORAGE - THIS WILL      */
         NI    FREE,B'01111111'                                    0451
*           ELSE                    /* CLOSE OK,FREE BUF POOL@ZA09978*/
*             IF(DCBBUFCB&1)^=1 THEN/* IF PRESENT            @ZA09978*/
         B     @RC00450                                            0452
@RF00450 LA    @03,1                                               0452
         L     @15,DCBBUFCB+16(,OPENADR)                           0452
         NR    @15,@03                                             0452
         CR    @15,@03                                             0452
         BE    @RF00452                                            0452
*               GEN REFS(OPENADR)(FREEPOOL (OPENADR));/*     @ZA09978*/
         FREEPOOL (OPENADR)
*         END;                      /* PREVENT A C03 ABEND AT TASK   */
@RF00452 DS    0H                                                  0454
@RC00450 DS    0H                                                  0455
*       OPENADR=ADDR(OTDCB);        /* TERMINATION                   */
@RF00435 L     @15,@PC00001+4                                      0455
         L     @01,IOSRLPTR(,@15)                                  0455
         L     @01,IOSTELM(,@01)                                   0455
         L     @15,IODSDPTR-1(,@01)                                0455
         LA    @15,0(,@15)                                         0455
         LR    OPENADR,@15                                         0455
         AL    OPENADR,INLEN                                       0455
         AL    OPENADR,@CF00185                                    0455
*       IF DSDOPTS(4)=YES&DCBOFOPN=YES THEN/* IF OUTPUT DCB PRESENT  */
         TM    DSDOPTS(@15),B'00010000'                            0456
         BNO   @RF00456                                            0456
         TM    DCBOFOPN+40(OPENADR),B'00010000'                    0456
         BNO   @RF00456                                            0456
*         DO;                       /* TRY TO CLOSE IT               */
*           GEN REFS(OPENADR)(CLOSE ((OPENADR)),MF=(E,CLOSELST));  0458
         CLOSE ((OPENADR)),MF=(E,CLOSELST)
*           IF DCBOFOPN=YES THEN    /* IF CLOSE UNSUCCESSFUL         */
         TM    DCBOFOPN+40(OPENADR),B'00010000'                    0459
         BNO   @RF00459                                            0459
*             FREE=NO;              /* DO NOT FREE STORAGE           */
         NI    FREE,B'01111111'                                    0460
*           ELSE                    /* CLOSE OK,FREE BUF POOL@ZA09978*/
*             IF(DCBBUFCB&1)^=1 THEN/* IF PRESENT            @ZA09978*/
         B     @RC00459                                            0461
@RF00459 LA    @03,1                                               0461
         L     @15,DCBBUFCB+16(,OPENADR)                           0461
         NR    @15,@03                                             0461
         CR    @15,@03                                             0461
         BE    @RF00461                                            0461
*               GEN REFS(OPENADR)(FREEPOOL (OPENADR));/*     @ZA09978*/
         FREEPOOL (OPENADR)
*         END;                                                     0463
@RF00461 DS    0H                                                  0463
@RC00459 DS    0H                                                  0464
*       IF FREE=YES THEN            /* IF OK TO FREE, SET UP         */
@RF00456 TM    FREE,B'10000000'                                    0464
         BNO   @RF00464                                            0464
*         DO;                       /* FOR FREEMAIN                  */
*           IF NOBPAM=NO&DSDQSAM=NO THEN/* BPAM DCB IN USE           */
         TM    NOBPAM,B'01000000'                                  0466
         BNZ   @RF00466                                            0466
         L     @03,@PC00001+4                                      0466
         L     @03,IOSRLPTR(,@03)                                  0466
         L     @03,IOSTELM(,@03)                                   0466
         L     @03,IODSDPTR-1(,@03)                                0466
         LA    @03,0(,@03)                                         0466
         TM    DSDQSAM(@03),B'00100000'                            0466
         BNZ   @RF00466                                            0466
*             DO;                   /* FREEMAIN (E)                0467
*                                      LV(LENGTH(BPAMBLK)+POLEN)   0467
*                                      A(DSDBPAM) SP(SP78)           */
*               RESPECIFY                                          0468
*                (GPR01P) RESTRICTED;                              0468
*               I005=I005&&I005;    /* INIT LIST                     */
         XC    I005(10),I005                                       0469
*               I00505='00'X;       /* SET TYPE                      */
         MVI   I00505,X'00'                                        0470
*               I00502=LENGTH(BPAMBLK)+POLEN;/* LENGTH               */
         L     @15,POLEN                                           0471
         LA    @15,156(,@15)                                       0471
         STCM  @15,7,I00502                                        0471
*               I00504=ADDR(DSDBPAM);/* ADDR OF ADDR LIST            */
         LA    @03,DSDBPAM(,@03)                                   0472
         STCM  @03,7,I00504                                        0472
*               I00506=SP78;        /* SUBPOOL VALUE                 */
         MVI   I00506,X'4E'                                        0473
*               GPR01P=ADDR(I005);  /* REG1 POINTS TO LIST           */
         LA    GPR01P,I005                                         0474
*               SVC(5);             /* STANDARD-FORM OF GETMAIN      */
         SVC   5                                                   0475
*               RESPECIFY                                          0476
*                (GPR01P) UNRESTRICTED;                            0476
*             END;                  /* FREEMAIN (E)                0477
*                                      LV(LENGTH(BPAMBLK)+POLEN)   0477
*                                      A(DSDBPAM) SP(SP78)           */
*           LEN=INLEN+OTLEN+LENGTH(DSDFLAGS);/* GET LENGTH           */
@RF00466 L     @03,INLEN                                           0478
         AL    @03,OTLEN                                           0478
         LA    @03,16(,@03)                                        0478
         STCM  @03,7,LEN                                           0478
*           SPOOL=SP78;             /* SET FOR SHARED SUBPOOL        */
         MVI   SPOOL,X'4E'                                         0479
*           RFY                                                    0480
*            (R0,                                                  0480
*             R1) RSTD;             /* RESTRICT REGS                 */
*           R0=LNGTH;               /* LOAD REG ZERO FOR FREEMAIN    */
         L     R0,LNGTH                                            0481
*           R1=IODSDPTR;            /* LOAD REG ONE WITH ADDR        */
         L     @03,@PC00001+4                                      0482
         L     @03,IOSRLPTR(,@03)                                  0482
         L     @03,IOSTELM(,@03)                                   0482
         L     R1,IODSDPTR-1(,@03)                                 0482
         LA    R1,0(,R1)                                           0482
*           GEN REFS(R0,R1)(FREEMAIN R,LV=(0),A=(1));/* ISSUE      0483
*                                      FREEMAIN                      */
         FREEMAIN R,LV=(0),A=(1)
*           RFY                                                    0484
*            (R0,                                                  0484
*             R1) UNRSTD;           /* RELEASE REGS                  */
*         END;                      /* END OF CLOSE PROCESSING       */
*     END;                          /*                               */
*   END CLOSERTN;                                                  0487
@EL00004 DS    0H                                                  0487
@EF00004 DS    0H                                                  0487
@ER00004 LM    @14,@12,@SA00004                                    0487
         BR    @14                                                 0487
*                                                                  0488
*   /*****************************************************************/
*   /*                                                               */
*   /* THE OPEN EXIT CANNOT SAVE REGISTERS IN REG 13 SAVEAREA SO THIS*/
*   /* ROUTINE USES ITS OWN SAVEAREA CALLED MYSAVAREA. THE PURPOSE OF*/
*   /* THIS EXIT IS TO DEFAULT OR CORRECT DCB PARAMETERS ON THE      */
*   /* OUTPUT DCB                                                    */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0488
*OPENEXIT:                                                         0488
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0488
OPENEXIT DS    0H                                                  0489
*   GEN SETS(MYSAVREA)(STM  @14,@12,MYSAVREA+12);/* SAVE REGISTERS   */
         STM  @14,@12,MYSAVREA+12
*   IF DCBRECL=NOTDEF THEN          /* IF DCBRECL IS NOT DEFINED     */
         LA    @03,28                                              0490
         ALR   @03,OPENADR                                         0490
         TM    DCBRECL(@03),B'11000000'                            0490
         BNZ   @RF00490                                            0490
*     DO;                           /* DEFAULT TO RECFM=VA           */
*       DCBRECL=V;                  /*                               */
         NI    DCBRECL(@03),B'01111111'                            0492
         OI    DCBRECL(@03),B'01000000'                            0492
*       DCBRECCC=A;                 /*                               */
         NI    DCBRECCC(@03),B'11111101'                           0493
         OI    DCBRECCC(@03),B'00000100'                           0493
*     END;                                                         0494
*   IF DCBRECL=V×DCBRECL=U THEN     /* FOR RECFM=V OR U              */
@RF00490 TM    DCBRECL+28(OPENADR),B'01000000'                     0495
         BNO   @GL00012                                            0495
         TM    DCBRECL+28(OPENADR),B'10000000'                     0495
         BZ    @RT00495                                            0495
@GL00012 TM    DCBRECL+28(OPENADR),B'11000000'                     0495
         BNO   @RF00495                                            0495
@RT00495 DS    0H                                                  0496
*     DO;                           /* CHECK BLKSIZE                 */
*       IF DCBBLKSI=0 THEN          /* IF BLKSIZE = 0 AND LRECL = 0  */
         SLR   @03,@03                                             0497
         LA    @15,52                                              0497
         ALR   @15,OPENADR                                         0497
         CH    @03,DCBBLKSI(,@15)                                  0497
         BNE   @RF00497                                            0497
*         IF DCBLRECL=0 THEN        /* DEFAULT TO RECFM = VBA        */
         LA    @14,72                                              0498
         ALR   @14,OPENADR                                         0498
         CH    @03,DCBLRECL(,@14)                                  0498
         BNE   @RF00498                                            0498
*           DO;                     /*                               */
*             DCBRECL=V;            /*                               */
         LA    @03,28                                              0500
         ALR   @03,OPENADR                                         0500
         NI    DCBRECL(@03),B'01111111'                            0500
         OI    DCBRECL(@03),B'01000000'                            0500
*             DCBRECBR=B;           /*                               */
         OI    DCBRECBR(@03),B'00010000'                           0501
*             DCBRECCC=A;           /*                               */
         NI    DCBRECCC(@03),B'11111101'                           0502
         OI    DCBRECCC(@03),B'00000100'                           0502
*             DCBBLKSI=DEFBLKSI;    /* SET BLKSI TO 3556             */
         MVC   DCBBLKSI(2,@15),@CH00283                            0503
*             DCBLRECL=DEFLRECL;    /* SET LRECL TO 148              */
         MVC   DCBLRECL(2,@14),@CH00285                            0504
*           END;                    /*                               */
*         ELSE                                                     0506
*           DCBBLKSI=DCBLRECL+4;    /* SET BLKSI TO LREC + 4         */
         B     @RC00498                                            0506
@RF00498 LA    @03,4                                               0506
         AH    @03,DCBLRECL+72(,OPENADR)                           0506
         STH   @03,DCBBLKSI+52(,OPENADR)                           0506
*       ELSE                        /* IF BLKSI NOT = 0 AND          */
*         IF DCBLRECL=0 THEN        /* AND LRECL IS 0 SET LRECL      */
         B     @RC00497                                            0507
@RF00497 LA    @03,72                                              0507
         ALR   @03,OPENADR                                         0507
         LH    @15,DCBLRECL(,@03)                                  0507
         LTR   @15,@15                                             0507
         BNZ   @RF00507                                            0507
*           DCBLRECL=DCBBLKSI-4;    /* TO BLKSI-4                    */
         LH    @15,DCBBLKSI+52(,OPENADR)                           0508
         SL    @15,@CF00068                                        0508
         STH   @15,DCBLRECL(,@03)                                  0508
*         ELSE                      /* OTHERWISE COMPUTE CORRECTIONS */
*           DO;                     /* IF MORE THAN ONE LRECL CAN FIT*/
         B     @RC00507                                            0509
@RF00507 DS    0H                                                  0510
*             IF DCBBLKSI/DCBLRECL>1 THEN/* SET RECFM TO XBX         */
         LH    @00,DCBBLKSI+52(,OPENADR)                           0510
         SRDA  @00,32                                              0510
         LH    @03,DCBLRECL+72(,OPENADR)                           0510
         DR    @00,@03                                             0510
         C     @01,@CF00040                                        0510
         BNH   @RF00510                                            0510
*               DCBRECBR=B;         /* COMPUTE PROPER BLKSIZE        */
         OI    DCBRECBR+28(OPENADR),B'00010000'                    0511
*             DCBBLKSI=(MAX((DCBBLKSI/DCBLRECL),1)*DCBLRECL)+4;    0512
@RF00510 LA    @03,52                                              0512
         ALR   @03,OPENADR                                         0512
         LH    @15,DCBLRECL+72(,OPENADR)                           0512
         LH    @00,DCBBLKSI(,@03)                                  0512
         SRDA  @00,32                                              0512
         DR    @00,@15                                             0512
         LA    @00,1                                               0512
         CR    @01,@00                                             0512
         BNL   *+6
         LR    @01,@00                                             0512
         MR    @00,@15                                             0512
         AL    @01,@CF00068                                        0512
         STH   @01,DCBBLKSI(,@03)                                  0512
*           END;                                                   0513
*       IF DCBRECL=U THEN           /* FOR FORMAT U                  */
@RC00507 DS    0H                                                  0514
@RC00497 TM    DCBRECL+28(OPENADR),B'11000000'                     0514
         BNO   @RF00514                                            0514
*         DCBLRECL=0;               /* ZERO LRECL                    */
         SLR   @03,@03                                             0515
         STH   @03,DCBLRECL+72(,OPENADR)                           0515
*     END;                          /* END RECFM V OR U              */
@RF00514 DS    0H                                                  0517
*   IF DCBRECL=F&DCBRECBR^=B THEN   /* FOR UNBLOCKED RECFM=F         */
@RF00495 LA    @03,28                                              0517
         ALR   @03,OPENADR                                         0517
         TM    DCBRECL(@03),B'10000000'                            0517
         BNO   @RF00517                                            0517
         TM    DCBRECL(@03),B'01000000'                            0517
         BNZ   @RF00517                                            0517
         TM    DCBRECBR(@03),B'00010000'                           0517
         BO    @RF00517                                            0517
*     DO;                           /* IF DCBLRECL AND DCBBLK = 0    */
*       IF DCBBLKSI=0 THEN          /* FORCE DEFAULT OF RECFM= VBA   */
         SLR   @15,@15                                             0519
         LA    @14,52                                              0519
         ALR   @14,OPENADR                                         0519
         CH    @15,DCBBLKSI(,@14)                                  0519
         BNE   @RF00519                                            0519
*         IF DCBLRECL=0 THEN        /*                               */
         LA    @09,72                                              0520
         ALR   @09,OPENADR                                         0520
         CH    @15,DCBLRECL(,@09)                                  0520
         BNE   @RF00520                                            0520
*           DO;                     /*                               */
*             DCBRECL=V;            /*                               */
         NI    DCBRECL(@03),B'01111111'                            0522
         OI    DCBRECL(@03),B'01000000'                            0522
*             DCBRECBR=B;           /*                               */
         OI    DCBRECBR(@03),B'00010000'                           0523
*             DCBRECCC=A;           /*                               */
         NI    DCBRECCC(@03),B'11111101'                           0524
         OI    DCBRECCC(@03),B'00000100'                           0524
*             DCBBLKSI=DEFBLKSI;    /* SET BLKSIZE TO 3556           */
         MVC   DCBBLKSI(2,@14),@CH00283                            0525
*             DCBLRECL=DEFLRECL;    /* SET LRECL TO 148              */
         MVC   DCBLRECL(2,@09),@CH00285                            0526
*           END;                    /*                               */
*         ELSE                      /* OTHER WISE MAKE BLK = LRECL   */
*           DCBBLKSI=DCBLRECL;                                     0528
         B     @RC00520                                            0528
@RF00520 LH    @03,DCBLRECL+72(,OPENADR)                           0528
         STH   @03,DCBBLKSI+52(,OPENADR)                           0528
*       ELSE                        /* OR LRECL = BLK                */
*         DCBLRECL=DCBBLKSI;                                       0529
         B     @RC00519                                            0529
@RF00519 LH    @03,DCBBLKSI+52(,OPENADR)                           0529
         STH   @03,DCBLRECL+72(,OPENADR)                           0529
*     END;                          /* IF BLOCKED FIXED              */
@RC00519 DS    0H                                                  0531
*   IF DCBRECL=F&DCBRECBR=B THEN    /* AND DCBLRECL AND DCBBLKSI = 0 */
@RF00517 LA    @03,28                                              0531
         ALR   @03,OPENADR                                         0531
         TM    DCBRECL(@03),B'10000000'                            0531
         BNO   @RF00531                                            0531
         TM    DCBRECL(@03),B'01000000'                            0531
         BNZ   @RF00531                                            0531
         TM    DCBRECBR(@03),B'00010000'                           0531
         BNO   @RF00531                                            0531
*     DO;                           /* SET DEFAULTS OF RECFM= VBA    */
*       IF DCBBLKSI=0 THEN          /*                               */
         SLR   @15,@15                                             0533
         LA    @14,52                                              0533
         ALR   @14,OPENADR                                         0533
         CH    @15,DCBBLKSI(,@14)                                  0533
         BNE   @RF00533                                            0533
*         IF DCBLRECL=0 THEN        /*                               */
         LA    @09,72                                              0534
         ALR   @09,OPENADR                                         0534
         CH    @15,DCBLRECL(,@09)                                  0534
         BNE   @RF00534                                            0534
*           DO;                     /*                               */
*             DCBRECL=V;            /*                               */
         NI    DCBRECL(@03),B'01111111'                            0536
         OI    DCBRECL(@03),B'01000000'                            0536
*             DCBRECBR=B;           /*                               */
         OI    DCBRECBR(@03),B'00010000'                           0537
*             DCBRECCC=A;           /*                               */
         NI    DCBRECCC(@03),B'11111101'                           0538
         OI    DCBRECCC(@03),B'00000100'                           0538
*             DCBBLKSI=DEFBLKSI;    /* SET DEFAULT BLKSI OF 3556     */
         MVC   DCBBLKSI(2,@14),@CH00283                            0539
*             DCBLRECL=DEFLRECL;    /* SET LRECL TO 148              */
         MVC   DCBLRECL(2,@09),@CH00285                            0540
*           END;                    /*                               */
*         ELSE                      /*                               */
*           DCBBLKSI=DCBLRECL;      /* IF BLK = 0, COPY LRECL        */
         B     @RC00534                                            0542
@RF00534 LH    @03,DCBLRECL+72(,OPENADR)                           0542
         STH   @03,DCBBLKSI+52(,OPENADR)                           0542
*       ELSE                                                       0543
*         IF DCBLRECL=0 THEN        /* IF LRECL= 0, COPY BLK         */
         B     @RC00533                                            0543
@RF00533 LA    @03,72                                              0543
         ALR   @03,OPENADR                                         0543
         LH    @15,DCBLRECL(,@03)                                  0543
         LTR   @15,@15                                             0543
         BNZ   @RF00543                                            0543
*           DCBLRECL=DCBBLKSI;      /* IF NEITHER IS ZERO,           */
         LH    @15,DCBBLKSI+52(,OPENADR)                           0544
         STH   @15,DCBLRECL(,@03)                                  0544
*         ELSE                      /* COMPUTE BLKSIZE               */
*           DCBBLKSI=MAX((DCBBLKSI/DCBLRECL),1)*DCBLRECL;          0545
         B     @RC00543                                            0545
@RF00543 LA    @03,52                                              0545
         ALR   @03,OPENADR                                         0545
         LH    @15,DCBLRECL+72(,OPENADR)                           0545
         LH    @00,DCBBLKSI(,@03)                                  0545
         SRDA  @00,32                                              0545
         DR    @00,@15                                             0545
         LA    @00,1                                               0545
         CR    @01,@00                                             0545
         BNL   *+6
         LR    @01,@00                                             0545
         MR    @00,@15                                             0545
         STH   @01,DCBBLKSI(,@03)                                  0545
*     END;                                                         0546
@RC00543 DS    0H                                                  0546
@RC00533 DS    0H                                                  0547
*   GEN REFS(MYSAVREA)(LM    @14,@12,MYSAVREA+12);/* RESTORE       0547
*                                      REGISTERS                     */
@RF00531 DS    0H                                                  0547
         LM    @14,@12,MYSAVREA+12
*   END OPENEXIT;                   /* END OF OPEN EXIT- RETURN TO 0548
*                                      DATA MANAGEMENT               */
@EL00005 DS    0H                                                  0548
@EF00005 DS    0H                                                  0548
@ER00005 BR    @14                                                 0548
*BPAMEXIT:                                                         0549
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0549
BPAMEXIT DS    0H                                                  0550
*   GEN SETS(MYSAVREA)(STM @14,@12,MYSAVREA+12);                   0550
         STM @14,@12,MYSAVREA+12
*   RFY                                                            0551
*     INSTACK BASED(IOSTELM+ASTAKELM);                             0551
*   IF DCBBLKSI^=0 THEN             /* AS LONG AS BLKSI NOT ZERO     */
         LH    @03,DCBBLKSI+52(,OPENADR)                           0552
         LTR   @03,@03                                             0552
         BZ    @RF00552                                            0552
*     DO;                           /* PROCESS                       */
*       DECBMAX=MIN(6,MAX(1,26000/DCBBLKSI));/* GET NUMBER OF BUFFERS*/
         L     @15,@PC00001+4                                      0554
         L     @01,IOSRLPTR(,@15)                                  0554
         L     @01,IOSTELM(,@01)                                   0554
         L     @01,IODSDPTR+3(,@01)                                0554
         L     @15,DSDBPAM(,@01)                                   0554
         L     @00,@CF00752                                        0554
         SRDA  @00,32                                              0554
         DR    @00,@03                                             0554
         LA    @14,1                                               0554
         CR    @01,@14                                             0554
         BNL   *+6
         LR    @01,@14                                             0554
         LA    @14,6                                               0554
         CR    @01,@14                                             0554
         BNH   *+6
         LR    @01,@14                                             0554
         STH   @01,DECBMAX(,@15)                                   0554
*       RFY                                                        0555
*         R15 RSTD;                 /* RESTRICT REG                  */
*       DO;                         /* GETMAIN (EC)                0556
*                                      LV(DECBMAX*DCBBLKSI)        0556
*                                      A(CURBLK(1)) SP(78)         0556
*                                      MF(E,GETLST) RTCD(R15)        */
         ST    @15,@TF00001                                        0556
*         RESPECIFY                                                0557
*          (GPR01P,                                                0557
*           GPR15F) RESTRICTED;                                    0557
*         GETLST04='20'X;           /* TYPE                          */
         ST    @01,@TF00002                                        0558
         MVI   GETLST04,X'20'                                      0558
*         GETLST01=DECBMAX*DCBBLKSI;/* LENGTH                        */
         LR    @05,@03                                             0559
         M     @04,@TF00002                                        0559
         ST    @05,GETLST01                                        0559
*         GETLST03=ADDR(CURBLK(1)); /* ADDR OF ADDR LIST             */
         L     @14,@TF00001                                        0560
         LA    @14,CURBLK(,@14)                                    0560
         STCM  @14,7,GETLST03                                      0560
*         GETLST05=78;              /* SUBPOOL VALUE                 */
         MVI   GETLST05,X'4E'                                      0561
*         GPR01P=ADDR(GETLST);      /* REG1 POINTS TO LIST           */
         LA    GPR01P,GETLST                                       0562
*         SVC(4);                   /* STANDARD-FORM OF GETMAIN      */
         SVC   4                                                   0563
*         R15=GPR15F;               /* SET RETURN CODE               */
*         RESPECIFY                                                0565
*          (GPR01P,                                                0565
*           GPR15F) UNRESTRICTED;                                  0565
*       END;                        /* GETMAIN (EC)                0566
*                                      LV(DECBMAX*DCBBLKSI)        0566
*                                      A(CURBLK(1)) SP(78)         0566
*                                      MF(E,GETLST) RTCD(R15)        */
*       IF R15^=0 THEN              /* BAD GETMAIN                   */
         LTR   R15,R15                                             0567
         BZ    @RF00567                                            0567
*         NOBFRS=YES;                                              0568
         OI    NOBFRS,B'00100000'                                  0568
*       RFY                                                        0569
*         R15 UNRSTD;               /* RELEASE REG                   */
@RF00567 DS    0H                                                  0570
*     END;                                                         0570
*   RFY                                                            0571
*     INSTACK BASED(IOSTELM);       /* RESET BASE                    */
@RF00552 DS    0H                                                  0572
*   GEN REFS(MYSAVREA)(LM @14,@12,MYSAVREA+12);                    0572
         LM @14,@12,MYSAVREA+12
*   END BPAMEXIT;                                                  0573
@EL00006 DS    0H                                                  0573
@EF00006 DS    0H                                                  0573
@ER00006 BR    @14                                                 0573
*   DECLARE                         /* GENERAL PURPOSE REGISTERS     */
*     GPR15F FIXED(31) REG(15),                                    0574
*     GPR01P PTR(31) REG(1);                                       0574
*   DCL                                                            0575
*     1 I005 DEF(ILIST) BDY(WORD),  /* LIST FOR FREEMAIN             */
*       3 I00501 PTR(8),            /* RESERVED                      */
*       3 I00502 PTR(24),           /* LENGTH                        */
*       3 I00503 PTR(8),            /* RESERVED                      */
*       3 I00504 PTR(24),           /* ADDR OF ADDR LIST             */
*       3 I00505 BIT(8),            /* TYPE OF FREEMAIN              */
*       3 I00506 PTR(8);            /* SUBPOOL VALUE                 */
*   DECLARE                                                        0576
*     ILIST CHAR(10) BDY(DWORD);    /* STANDARD LIST                 */
*   DECLARE                         /* COMMON VARIABLES              */
*     I256C CHAR(256) BASED,                                       0577
*     I031F FIXED(31) BASED,                                       0577
*     I031P PTR(31) BASED,                                         0577
*     I015F FIXED(15) BASED,                                       0577
*     I015P PTR(15) BASED,                                         0577
*     I008P PTR(8) BASED,                                          0577
*     I001C CHAR(1) BASED;                                         0577
*   END IKJEFT30                                                   0578
*                                                                  0578
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.     */
*/*%INCLUDE SYSLIB  (IKJEXEC )                                       */
*/*%INCLUDE SYSLIB  (IKJECT  )                                       */
*/*%INCLUDE SYSLIB  (IKJLSD  )                                       */
*/*%INCLUDE SYSLIB  (IHADCBDF)                                       */
*/*%INCLUDE SYSLIB  (IHADCB  )                                       */
*                                                                  0578
*       ;                                                          0578
@DATA    DS    0H
@CH00238 DC    H'20'
@CH00285 DC    H'137'
@CH00283 DC    H'3155'
@SM00776 MVC   OPENL(0),OPENLOC
@SM00780 MVC   STAXD(0),STAXC
@SM00786 MVC   INDCB(0,@14),INLST
@SM00788 MVC   BPAMDCB(0,@08),PODCB
@SM00790 MVC   CURDECB-20(0,@08),RDM
@SM00792 MVC   OTDCB(0,@14),OTLST
@DATD    DSECT
         DS    0F
@SA00001 DS    18F
@PC00001 DS    4F
@SA00004 DS    15F
@SA00003 DS    15F
@SA00002 DS    15F
@TF00001 DS    F
@TF00002 DS    F
IKJEFT30 CSECT
         DS    0F
@CF00040 DC    F'1'
@CH00040 EQU   @CF00040+2
@CF00068 DC    F'4'
@CF00185 DC    F'16'
@CF00070 DC    F'32'
@CH00070 EQU   @CF00070+2
@CF00551 DC    F'48'
@CF00767 DC    F'64'
@CF00752 DC    F'26000'
@CF00766 DC    F'-4'
@DATD    DSECT
         DS    0D
SNTABPTR DS    A
SNTELPTR DS    A
SVTABPTR DS    A
ECTPTR   DS    A
LNGTH    DS    AL4
         ORG   LNGTH
SPOOL    DS    AL1
LEN      DS    AL3
         ORG   LNGTH+4
FREEADDR DS    A
DCBPTR   DS    A
SWS      DS    CL1
         ORG   SWS
FREE     DS    BL1
NOBPAM   EQU   SWS+0
NOBFRS   EQU   SWS+0
         ORG   SWS+1
         DS    CL3
@NM00018 DS    CL4
         ORG   @NM00018
EXITPARM DS    BL1
EXITADDR DS    AL3
         ORG   @NM00018+4
FRELST   DS    CL10
         ORG   FRELST
FRELST01 DS    AL1
FRELST02 DS    AL3
FRELST03 DS    AL1
FRELST04 DS    AL3
FRELST05 DS    BL1
FRELST06 DS    AL1
         ORG   FRELST+10
         DS    CL2
GETLST   DS    CL10
         ORG   GETLST
GETLST01 DS    AL4
GETLST02 DS    CL1
GETLST03 DS    AL3
GETLST04 DS    CL1
GETLST05 DS    AL1
         ORG   GETLST+10
         DS    CL6
ILIST    DS    CL10
         DS    CL2
MYSAVREA DS    18F
IKJEFT30 CSECT
         DS    0F
@SIZDATD DC    AL1(1)
         DC    AL3(@ENDDATD-@DATD)
         DS    0D
PATCH    DC    8A(0)
IKJEFT30 CSECT
INLST DCB DDNAME=SYSIN,DSORG=PS,MACRF=GL
              ENTRY INLEN
INLEN DC  A(INLEN-INLST)
OTLST DCB DDNAME=SYSIN,DSORG=PS,MACRF=PM
OTLEN DC  A(OTLEN-OTLST)
PODCB DCB DDNAME=A,MACRF=R,DSORG=PO,NCP=6
POLEN DC A(POLEN-PODCB)
RDM   READ DUMMY,SF,MF=L
READLEN DC A(READLEN-RDM)
IKJEFT30 CSECT
*                                                         /*@ZA08099*/
STAXC    STAX MF=L                                          @ZA08099
LENSTAX   DC  A(*-STAXC)      LENGTH OF MACRO               @ZA08099
@DATD    DSECT
*                                                         /*@ZA08099*/
STAXD    STAX MF=L                                          @ZA08099
@DATD    DSECT
OPENL OPEN (,),MF=L
CLOSELST CLOSE (,),MF=L
IKJEFT30 CSECT
OPENLOC OPEN (,),MF=L
        CLOSE (,),MF=L
OPENLEN DC A(OPENLEN-OPENLOC)
@DATD    DSECT
         ORG   *+1-(*-@DATD)/(*-@DATD) INSURE DSECT DATA
@ENDDATD EQU   *
IKJEFT30 CSECT
@00      EQU   00                      EQUATES FOR REGISTERS 0-15
@01      EQU   01
@02      EQU   02
@03      EQU   03
@04      EQU   04
@05      EQU   05
@06      EQU   06
@07      EQU   07
@08      EQU   08
@09      EQU   09
@10      EQU   10
@11      EQU   11
@12      EQU   12
@13      EQU   13
@14      EQU   14
@15      EQU   15
I        EQU   @03
FREELEN  EQU   @03
RETURNCD EQU   @09
RETCODE  EQU   @03
ECDACBLK EQU   @04
TEMP31   EQU   @08
ISTCKPTR EQU   @09
R0       EQU   @00
R1       EQU   @01
R15      EQU   @15
OPENADR  EQU   @02
R2       EQU   @02
R3       EQU   @03
R4       EQU   @04
R5       EQU   @05
GPR01P   EQU   @01
GPR15F   EQU   @15
EXECDATA EQU   0
SNTABFST EQU   EXECDATA
SVTABFST EQU   EXECDATA+4
@NM00001 EQU   EXECDATA+16
EXINSAVE EQU   @NM00001
EXDATFLG EQU   EXECDATA+32
@NM00002 EQU   EXDATFLG
NOFLUSH  EQU   @NM00002
CMAIN    EQU   @NM00002
ATTNCMD  EQU   @NM00002
EXDLMPTR EQU   EXECDATA+40
FILEDCBS EQU   EXECDATA+56
COMPROC  EQU   0
COMPRPTR EQU   COMPROC
COMPRNXT EQU   COMPRPTR+1
COMPRLNG EQU   COMPROC+4
SNTAB    EQU   0
SNTABNXT EQU   SNTAB
SNTABLNG EQU   SNTAB+4
SNTELEM  EQU   0
SNTVLPTR EQU   SNTELEM
SNTFLAGS EQU   SNTELEM+4
SVTAB    EQU   0
SVTABLNG EQU   SVTAB+4
SVTELEM  EQU   0
ECT      EQU   0
ECTIOWA  EQU   ECT+4
ECTSWS   EQU   ECT+28
ECTSWS2  EQU   ECT+40
ECTSWS21 EQU   ECTSWS2
LSDPTR   EQU   0
LSD      EQU   0
LSDADATA EQU   LSD
LSDRCLEN EQU   LSD+4
LSDTOTLN EQU   LSD+6
LSDANEXT EQU   LSD+8
LSDEXEC  EQU   LSD+12
IOSRL    EQU   0
IOSTELM  EQU   IOSRL
IOSBELM  EQU   IOSRL+4
IOSTLEN  EQU   IOSRL+8
IOSNELM  EQU   IOSRL+10
INSTACK  EQU   0
INSCODE  EQU   INSTACK
INSDATA  EQU   INSCODE
INSSTOR  EQU   INSCODE
INSINDD  EQU   INSCODE
INSOTDD  EQU   INSCODE
INSEXEC  EQU   INSCODE
INSPROM  EQU   INSCODE
INSPROC  EQU   INSCODE
INSADLSD EQU   INSTACK+1
DUMYSTAK EQU   0
RECLEN   EQU   0
STCK     EQU   0
INDCB    EQU   0
DSDFLAGS EQU   0
DSDSEQ   EQU   DSDFLAGS
DSDCNTL  EQU   DSDFLAGS
DSDQSAM  EQU   DSDFLAGS
DSDFRST  EQU   DSDFLAGS
DSDOPTS  EQU   DSDFLAGS+1
DSDLINES EQU   DSDFLAGS+3
DSDMINBF EQU   DSDFLAGS+4
DSDBPAM  EQU   DSDFLAGS+12
OTDCB    EQU   0
INDDNAME EQU   0
OTDDNAME EQU   0
LL       EQU   0
FILEBLOK EQU   0
NEXTFILE EQU   FILEBLOK
DCBAREA  EQU   FILEBLOK+20
BPAMBLK  EQU   0
@NM00022 EQU   BPAMBLK+8
DECBINDX EQU   @NM00022
DECBMAX  EQU   @NM00022+2
CURBLK   EQU   BPAMBLK+12
CURDECB  EQU   BPAMBLK+36
IOBPTR   EQU   CURDECB+16
BPAMDCB  EQU   BPAMBLK+156
@NM00025 EQU   0
IHADCB   EQU   0
IHADCS00 EQU   0
DCBFDAD  EQU   IHADCS00+5
IHADCS01 EQU   0
DCBDVTBL EQU   IHADCS01
IHADCS11 EQU   0
DCBRELB  EQU   IHADCS11
DCBREL   EQU   DCBRELB+1
DCBBUFCB EQU   IHADCS11+4
DCBDSORG EQU   IHADCS11+10
DCBDSRG1 EQU   DCBDSORG
DCBDSRG2 EQU   DCBDSORG+1
DCBIOBAD EQU   IHADCS11+12
DCBODEB  EQU   DCBIOBAD
DCBLNP   EQU   DCBODEB
DCBQSLM  EQU   DCBLNP
DCBIOBAA EQU   DCBODEB+1
IHADCS50 EQU   0
DCBSVCXL EQU   IHADCS50
DCBEODAD EQU   IHADCS50+4
DCBBFALN EQU   DCBEODAD
DCBHIARC EQU   DCBBFALN
DCBBFTEK EQU   DCBHIARC
DCBBFT   EQU   DCBBFTEK
DCBEXLST EQU   IHADCS50+8
DCBRECFM EQU   DCBEXLST
DCBRECLA EQU   DCBRECFM
DCBRECL  EQU   DCBRECLA
DCBRECBR EQU   DCBRECFM
DCBRECCC EQU   DCBRECFM
DCBEXLSA EQU   DCBEXLST+1
IHADCS24 EQU   0
DCBDDNAM EQU   IHADCS24
DCBOFLGS EQU   IHADCS24+8
DCBOFLWR EQU   DCBOFLGS
DCBOFOPN EQU   DCBOFLGS
DCBIFLG  EQU   IHADCS24+9
DCBIBPCT EQU   DCBIFLG
DCBMACR  EQU   IHADCS24+10
DCBMACR1 EQU   DCBMACR
DCBMRFE  EQU   DCBMACR1
DCBMRGET EQU   DCBMRFE
DCBMRAPG EQU   DCBMACR1
DCBMRRD  EQU   DCBMRAPG
DCBMRCI  EQU   DCBMACR1
DCBMRMVG EQU   DCBMRCI
DCBMRLCG EQU   DCBMACR1
DCBMRABC EQU   DCBMACR1
DCBMRPT1 EQU   DCBMRABC
DCBMRSBG EQU   DCBMRPT1
DCBMRCRL EQU   DCBMACR1
DCBMRCHK EQU   DCBMRCRL
DCBMRRDX EQU   DCBMRCHK
DCBMRDMG EQU   DCBMACR1
DCBMACR2 EQU   DCBMACR+1
DCBMRPUT EQU   DCBMACR2
DCBMRWRT EQU   DCBMACR2
DCBMRMVP EQU   DCBMACR2
DCBMR5WD EQU   DCBMACR2
DCBMRLDM EQU   DCBMR5WD
DCBMRLCP EQU   DCBMRLDM
DCBMR4WD EQU   DCBMACR2
DCBMRPT2 EQU   DCBMR4WD
DCBMRTMD EQU   DCBMRPT2
DCBMR3WD EQU   DCBMACR2
DCBMRCTL EQU   DCBMR3WD
DCBMRSTK EQU   DCBMRCTL
DCBMR1WD EQU   DCBMACR2
DCBMRSWA EQU   DCBMR1WD
DCBMRDMD EQU   DCBMRSWA
IHADCS25 EQU   0
DCBMACRF EQU   IHADCS25+2
DCBMACF1 EQU   DCBMACRF
DCBMFFE  EQU   DCBMACF1
DCBMFGET EQU   DCBMFFE
DCBMFAPG EQU   DCBMACF1
DCBMFRD  EQU   DCBMFAPG
DCBMFCI  EQU   DCBMACF1
DCBMFMVG EQU   DCBMFCI
DCBMFLCG EQU   DCBMACF1
DCBMFABC EQU   DCBMACF1
DCBMFPT1 EQU   DCBMFABC
DCBMFSBG EQU   DCBMFPT1
DCBMFCRL EQU   DCBMACF1
DCBMFCHK EQU   DCBMFCRL
DCBMFDMG EQU   DCBMACF1
DCBMACF2 EQU   DCBMACRF+1
DCBMFPUT EQU   DCBMACF2
DCBMFWRT EQU   DCBMACF2
DCBMFMVP EQU   DCBMACF2
DCBMF5WD EQU   DCBMACF2
DCBMFLDM EQU   DCBMF5WD
DCBMFLCP EQU   DCBMFLDM
DCBMF4WD EQU   DCBMACF2
DCBMFPT2 EQU   DCBMF4WD
DCBMFTMD EQU   DCBMFPT2
DCBMF3WD EQU   DCBMACF2
DCBMFCTL EQU   DCBMF3WD
DCBMFSTK EQU   DCBMFCTL
DCBMF1WD EQU   DCBMACF2
DCBMFSWA EQU   DCBMF1WD
DCBMFDMD EQU   DCBMFSWA
DCBDEBAD EQU   IHADCS25+4
DCBIFLGS EQU   DCBDEBAD
DCBIFPCT EQU   DCBIFLGS
IHADCS26 EQU   0
DCBWRITE EQU   IHADCS26
DCBREAD  EQU   DCBWRITE
DCBWRITA EQU   DCBREAD+1
IHADCS27 EQU   0
DCBGET   EQU   IHADCS27
DCBPUT   EQU   DCBGET
DCBGETA  EQU   DCBPUT+1
IHADCS36 EQU   0
DCBGERR  EQU   IHADCS36
DCBPERR  EQU   DCBGERR
DCBCHECK EQU   DCBPERR
DCBOPTCD EQU   DCBCHECK
DCBOPTH  EQU   DCBOPTCD
DCBOPTO  EQU   DCBOPTH
DCBOPTZ  EQU   DCBOPTCD
DCBGERRA EQU   DCBCHECK+1
DCBPERRA EQU   DCBGERRA
DCBSYNAD EQU   IHADCS36+4
DCBCIND1 EQU   IHADCS36+8
DCBCIND2 EQU   IHADCS36+9
DCBBLKSI EQU   IHADCS36+10
DCBIOBA  EQU   IHADCS36+16
DCBCICB  EQU   DCBIOBA
IHADCS52 EQU   0
DCBDIRCT EQU   IHADCS52
DCBQSWS  EQU   DCBDIRCT
DCBUSASI EQU   DCBQSWS
DCBQADFS EQU   DCBUSASI
DCBBUFOF EQU   DCBDIRCT+1
IHADCS37 EQU   0
DCBFLAG1 EQU   IHADCS37
IHADCS38 EQU   0
DCBEOBR  EQU   IHADCS38
DCBLRECL EQU   IHADCS38+10
DCBPOINT EQU   IHADCS38+12
DCBCNTRL EQU   DCBPOINT
IHADCS40 EQU   0
DCBEOBAD EQU   IHADCS40
DCBCCCW  EQU   IHADCS40+4
DCBRECAD EQU   DCBCCCW
DCBRECBT EQU   DCBRECAD
DCBRCREL EQU   DCBRECBT
@NM00052 EQU   IHADCS40+12
DCBEROPT EQU   @NM00052
I001C    EQU   0
I008P    EQU   0
I015F    EQU   0
I015P    EQU   0
I031F    EQU   0
I031P    EQU   0
I256C    EQU   0
UPTX     EQU   0
ECX      EQU   0
ECB      EQU   0
STPB     EQU   0
SPBOPCOD EQU   STPB
SPBADD   EQU   SPBOPCOD
SPBDLCUR EQU   SPBOPCOD
SPBDLPRC EQU   SPBOPCOD
SPBDLALL EQU   SPBOPCOD
SPBCODE  EQU   STPB+1
SPBSTOR  EQU   SPBCODE
SPBINDD  EQU   SPBCODE
SPBOTDD  EQU   SPBCODE
SPBFLUSH EQU   SPBCODE
SPBRESVD EQU   STPB+2
SPBMBR   EQU   SPBRESVD+1
SPBSEQ   EQU   SPBRESVD+1
SPBCNTL  EQU   SPBRESVD+1
SPBCLOS  EQU   SPBRESVD+1
SPBADLSD EQU   STPB+4
SPBINDDN EQU   STPB+8
SPBOTDDN EQU   STPB+12
SPBMBRNM EQU   STPB+16
IOSRLPTR EQU   ECTIOWA
STAXPARM EQU   STAXD
@NM00014 EQU   STAXPARM+16
STXATTOF EQU   @NM00014
IODSDPTR EQU   INSADLSD
I005     EQU   ILIST
I00502   EQU   I005+1
I00504   EQU   I005+5
I00505   EQU   I005+8
I00506   EQU   I005+9
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS
I00503   EQU   I005+4
I00501   EQU   I005
@NM00017 EQU   STAXPARM+17
@NM00016 EQU   @NM00014
@NM00015 EQU   @NM00014
@NM00013 EQU   STAXPARM
@NM00011 EQU   SPBRESVD
SPBLIST  EQU   SPBCODE
SPBPROC  EQU   SPBCODE
SPBPROM  EQU   SPBCODE
SPBTERM  EQU   SPBCODE
SPBRSVRD EQU   SPBOPCOD
ECBCOMPC EQU   ECB
ECBCBIT  EQU   ECB
ECBWBIT  EQU   ECB
DCBEOB   EQU   IHADCS40+20
DCBPRECL EQU   IHADCS40+18
@NM00055 EQU   IHADCS40+16
@NM00054 EQU   @NM00052+1
@NM00053 EQU   DCBEROPT
DCBERABE EQU   DCBEROPT
DCBERSKP EQU   DCBEROPT
DCBERACC EQU   DCBEROPT
@NM00051 EQU   IHADCS40+10
@NM00050 EQU   IHADCS40+9
@NM00049 EQU   IHADCS40+8
DCBRECA  EQU   DCBRECAD+1
@NM00048 EQU   DCBRECBT
DCBRCFGT EQU   DCBRCREL
DCBRCTRU EQU   DCBRCREL
DCBLCCW  EQU   DCBEOBAD
DCBNOTE  EQU   DCBCNTRL
@NM00047 EQU   IHADCS38+8
DCBEOBW  EQU   IHADCS38+4
DCBEOBRA EQU   DCBEOBR+1
DCBNCP   EQU   DCBEOBR
@NM00046 EQU   DCBFLAG1
DCBSTFLS EQU   DCBFLAG1
DCBSTQCK EQU   DCBFLAG1
DCBDIRCQ EQU   DCBBUFOF
DCBQSTRU EQU   DCBUSASI
@NM00045 EQU   DCBUSASI
DCBQADF3 EQU   DCBQADFS
DCBQADF2 EQU   DCBQADFS
DCBQADF1 EQU   DCBQADFS
DCBBLBP  EQU   DCBUSASI
@NM00044 EQU   DCBUSASI
DCBCICBA EQU   DCBCICB+1
@NM00043 EQU   DCBCICB
DCBOFFSW EQU   IHADCS36+15
DCBOFFSR EQU   IHADCS36+14
DCBWCPL  EQU   IHADCS36+13
DCBWCPO  EQU   IHADCS36+12
DCBCNQSM EQU   DCBCIND2
DCBCNFEO EQU   DCBCIND2
DCBCNCHS EQU   DCBCIND2
DCBCNBFP EQU   DCBCIND2
DCBCNIOE EQU   DCBCIND2
DCBCNCLO EQU   DCBCIND2
DCBCNWRO EQU   DCBCIND2
DCBCNSTO EQU   DCBCIND2
DCBCNEXB EQU   DCBCIND1
@NM00042 EQU   DCBCIND1
DCBCNBRM EQU   DCBCIND1
@NM00041 EQU   DCBCIND1
DCBCNEVA EQU   DCBCIND1
DCBCNEVB EQU   DCBCIND1
DCBCNSRD EQU   DCBCIND1
DCBCNTOV EQU   DCBCIND1
DCBSYNA  EQU   DCBSYNAD+1
DCBIOBL  EQU   DCBSYNAD
DCBCHCKA EQU   DCBPERRA
DCBOPTJ  EQU   DCBOPTCD
DCBOPTT  EQU   DCBOPTCD
DCBSRCHD EQU   DCBOPTZ
DCBOPTQ  EQU   DCBOPTCD
DCBBCKPT EQU   DCBOPTO
DCBOPTC  EQU   DCBOPTCD
DCBOPTU  EQU   DCBOPTCD
DCBOPTW  EQU   DCBOPTCD
DCBPUTA  EQU   DCBGETA
@NM00040 EQU   DCBPUT
DCBREADA EQU   DCBWRITA
@NM00039 EQU   DCBREAD
DCBDEBA  EQU   DCBDEBAD+1
@NM00038 EQU   DCBIFLGS
DCBIFIOE EQU   DCBIFLGS
DCBCH12  EQU   DCBIFPCT
DCBCH9   EQU   DCBIFPCT
DCBIFEC  EQU   DCBIFLGS
DCBMFSTI EQU   DCBMFDMD
DCBMFAWR EQU   DCBMFSTK
DCBMFUIP EQU   DCBMFTMD
DCBMFIDW EQU   DCBMFLCP
DCBMFWRK EQU   DCBMFMVP
DCBMFRDQ EQU   DCBMFWRT
DCBMFGTQ EQU   DCBMFPUT
DCBMFSTL EQU   DCBMACF2
DCBMFCK  EQU   DCBMFDMG
DCBMFRDX EQU   DCBMFCHK
DCBMFDBF EQU   DCBMFSBG
DCBMFRDI EQU   DCBMFLCG
DCBMFRDK EQU   DCBMFMVG
DCBMFWRQ EQU   DCBMFRD
DCBMFPTQ EQU   DCBMFGET
DCBMFECP EQU   DCBMACF1
DCBTIOT  EQU   IHADCS25
DCBMRSTI EQU   DCBMRDMD
DCBMRAWR EQU   DCBMRSTK
DCBMRUIP EQU   DCBMRTMD
DCBMRIDW EQU   DCBMRLCP
DCBMRWRK EQU   DCBMRMVP
DCBMRRDQ EQU   DCBMRWRT
DCBMRGTQ EQU   DCBMRPUT
DCBMRSTL EQU   DCBMACR2
DCBMRCK  EQU   DCBMRDMG
DCBPGFXA EQU   DCBMRRDX
DCBMRDBF EQU   DCBMRSBG
DCBMRRDI EQU   DCBMRLCG
DCBMRRDK EQU   DCBMRMVG
DCBMRWRQ EQU   DCBMRRD
DCBMRPTQ EQU   DCBMRGET
DCBMRECP EQU   DCBMACR1
@NM00037 EQU   DCBIFLG
DCBIBIOE EQU   DCBIFLG
DCBICH12 EQU   DCBIBPCT
DCBICH9  EQU   DCBIBPCT
DCBIBEC  EQU   DCBIFLG
DCBOFIOF EQU   DCBOFLGS
DCBOFUEX EQU   DCBOFLGS
DCBOFTM  EQU   DCBOFLGS
DCBOFPPC EQU   DCBOFLGS
DCBOFEOV EQU   DCBOFLGS
DCBOFLRB EQU   DCBOFLGS
DCBOFIOD EQU   DCBOFLWR
DCBRECKL EQU   DCBRECFM
DCBRECSB EQU   DCBRECFM
DCBRECTO EQU   DCBRECLA
DCBEODA  EQU   DCBEODAD+1
DCBBFA   EQU   DCBBFTEK
DCBH0    EQU   DCBBFTEK
DCBBFTKD EQU   DCBBFTEK
DCBBFTE  EQU   DCBBFT
DCBBFTKR EQU   DCBBFT
DCBBFTS  EQU   DCBBFT
DCBH1    EQU   DCBBFTEK
DCBSVCXA EQU   DCBSVCXL+1
@NM00036 EQU   DCBSVCXL
DCBODEBA EQU   DCBIOBAA
@NM00035 EQU   DCBQSLM
DCBUPDBT EQU   DCBQSLM
DCBUPDCM EQU   DCBQSLM
DCB1DVDS EQU   DCBQSLM
@NM00034 EQU   DCBDSRG2
DCBDSGTR EQU   DCBDSRG2
DCBACBM  EQU   DCBDSRG2
@NM00033 EQU   DCBDSRG2
DCBDSGTQ EQU   DCBDSRG2
DCBDSGTX EQU   DCBDSRG2
DCBDSGGS EQU   DCBDSRG2
DCBDSGU  EQU   DCBDSRG1
DCBDSGPO EQU   DCBDSRG1
@NM00032 EQU   DCBDSRG1
@NM00031 EQU   DCBDSRG1
DCBDSGCX EQU   DCBDSRG1
DCBDSGDA EQU   DCBDSRG1
DCBDSGPS EQU   DCBDSRG1
DCBDSGIS EQU   DCBDSRG1
DCBBUFL  EQU   IHADCS11+8
DCBBUFCA EQU   DCBBUFCB+1
DCBBUFNO EQU   DCBBUFCB
DCBDEVT  EQU   DCBREL
DCBKEYLE EQU   DCBRELB
DCBTRBAL EQU   IHADCS01+6
@NM00030 EQU   IHADCS01+5
@NM00029 EQU   IHADCS01+4
DCBDVTBA EQU   DCBDVTBL+1
@NM00028 EQU   DCBDVTBL
DCBKEYCN EQU   IHADCS00+4
DCBRELAD EQU   IHADCS00
@NM00027 EQU   IHADCB
RESIDCNT EQU   @NM00025+14
@NM00026 EQU   @NM00025
@NM00024 EQU   CURDECB+8
DECBBLK  EQU   CURDECB+6
@NM00023 EQU   CURDECB
EOBLK    EQU   BPAMBLK+4
NEXTREC  EQU   BPAMBLK
MINBFLEN EQU   FILEBLOK+18
FLGS     EQU   FILEBLOK+16
FILENAME EQU   FILEBLOK+8
CURREC   EQU   FILEBLOK+4
IODADLSD EQU   DSDFLAGS+8
@NM00021 EQU   DSDFLAGS+6
@NM00020 EQU   DSDFLAGS+2
@NM00019 EQU   DSDFLAGS
INSLIST  EQU   INSCODE
@NM00012 EQU   IOSRL+12
@NM00010 EQU   ECT+52
@NM00009 EQU   ECT+48
@NM00008 EQU   ECT+44
@NM00007 EQU   ECTSWS2+1
@NM00006 EQU   ECTSWS21
ECTTABND EQU   ECTSWS21
ECTDEFCS EQU   ECTSWS21
ECTBKPB  EQU   ECT+36
ECTUSER  EQU   ECT+32
ECTDDNUM EQU   ECT+29
ECTATTN  EQU   ECTSWS
ECTBKGRD EQU   ECTSWS
ECTNNOT  EQU   ECTSWS
ECTNMAL  EQU   ECTSWS
ECTLOGF  EQU   ECTSWS
ECTATRM  EQU   ECTSWS
@NM00005 EQU   ECTSWS
ECTNOPD  EQU   ECTSWS
ECTSCMD  EQU   ECT+20
ECTPCMD  EQU   ECT+12
ECTSMSG  EQU   ECT+9
ECTMSGF  EQU   ECT+8
ECTRTCD  EQU   ECT+1
ECTRCDF  EQU   ECT
SVTDATA  EQU   SVTELEM+4
SVTORIG  EQU   SVTELEM+2
SVTLNG   EQU   SVTELEM
SVTELFST EQU   SVTAB+16
SVTABFRE EQU   SVTAB+12
SVTABUSE EQU   SVTAB+8
SVTABNXT EQU   SVTAB
SNTDATA  EQU   SNTELEM+8
SNTLNG   EQU   SNTELEM+6
@NM00004 EQU   SNTFLAGS+1
SNTGLOB  EQU   SNTFLAGS+1
SNTLAST  EQU   SNTFLAGS
SNTEVAL  EQU   SNTFLAGS
SNTNAUTH EQU   SNTFLAGS
SNTNOSCN EQU   SNTFLAGS
SNTLABEL EQU   SNTFLAGS
SNTKEYW  EQU   SNTFLAGS
SNTKEY   EQU   SNTFLAGS
SNTPOSIT EQU   SNTFLAGS
SNTGVAL  EQU   SNTVLPTR
SNTELFST EQU   SNTAB+12
SNTABUSE EQU   SNTAB+8
COMRCDS  EQU   COMPROC+12
COMPRUSE EQU   COMPROC+8
COMPRID  EQU   COMPRPTR
@NM00003 EQU   EXECDATA+60
RETPTR2  EQU   EXECDATA+52
ATACTEND EQU   EXECDATA+48
ATACTSTR EQU   EXECDATA+44
GEXECCNT EQU   EXECDATA+36
NOLASTCC EQU   @NM00002+1
ATINCNTL EQU   @NM00002+1
NOMSG    EQU   @NM00002
ERINCNTL EQU   @NM00002
SYMLST   EQU   @NM00002
ERRCMD   EQU   @NM00002
CONLST   EQU   @NM00002
RETPTR   EQU   EXECDATA+28
ERACTEND EQU   EXECDATA+24
ERACTSTR EQU   EXECDATA+20
LASTTSO  EQU   EXECDATA+12
GEXECDAT EQU   EXECDATA+8
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS
@RT00078 EQU   DELETE
@RT00116 EQU   INVALID
@RT00119 EQU   INVALID
@RC00128 EQU   NORMEND
@RC00133 EQU   NORMEND
@RT00152 EQU   NORMEND
@RT00156 EQU   NORMEND
@RT00167 EQU   NORMEND
@RF00302 EQU   @EL00002
@RC00326 EQU   @RC00325
@RC00354 EQU   @RC00325
@RC00372 EQU   @RC00325
@RC00370 EQU   @RC00325
@RC00382 EQU   @RC00325
@RF00429 EQU   @EL00004
@RF00464 EQU   @EL00004
@RC00498 EQU   @RC00497
@RC00520 EQU   @RC00519
@RC00534 EQU   @RC00533
@RF00137 EQU   @RC00133
@RC00333 EQU   @RC00326
@RC00336 EQU   @RC00326
@ENDDATA EQU   *
         END   IKJEFT30,(C'PLS1751',0701,76260)

         TITLE 'IEFAB4EF - PCCB ROUTINE                                *
                        '
IEFAB4EF CSECT ,                                                01S0001
@MAINENT DS    0H                                               01S0001
         USING *,@15                                            01S0001
         B     @PROLOG                                          01S0001
         DC    AL1(16)                                          01S0001
         DC    C'IEFAB4EF  74.361'                              01S0001
         DROP  @15
@PROLOG  STM   @14,@12,12(@13)                                  01S0001
         BALR  @12,0                                            01S0001
@PSTART  DS    0H                                               01S0001
         USING @PSTART,@12                                      01S0001
         L     @00,@SIZDATD                                     01S0001
         MODESET EXTKEY=SCHED,SAVEKEY=(2)
         GSPACE   R,LV=(0)
         LR    @11,@01                                          01S0001
         USING @DATD,@11                                        01S0001
         ST    @13,@SA00001+4                                   01S0001
         STC   @02,@OLDKEY                                      01S0001
         MODESET KEYADDR=(2)
         LM    @00,@02,20(@13)                                  01S0001
         ST    @11,8(,@13)                                      01S0001
         LR    @13,@11                                          01S0001
         MODESET EXTKEY=ZERO
         MVC   @PC00001(36),0(@01)                              01S0001
         MODESET EXTKEY=SCHED
JSCBDISP EQU 188
JSCBAOS1 EQU  72
*                                                               01S0021
JSCBAOS2 EQU 192
*   /*****************************************************************/
*   /*                                                               */
*   /* END OF JSCB                                                   */
*   /*                                                               */
*   /*****************************************************************/
*                                                               01S0022
*   NQCORE(1:NQLENGTH)=PCNQLIST(1:NQLENGTH);/* ENQ LIST TO DSECT     */
         L     @10,NQLENGTH                                     01S0022
         BCTR  @10,0                                            01S0022
         EX    @10,@SM00290                                     01S0022
*   GEN REFS(NQCORE);                                           01S0023
*                                                               01S0023
*                                  /* EXCLUSIVE ENQ ON PCCB CHAIN   */
         ENQ MF=(E,NQCORE)
*/* A 019200-019410,020200,038550,040100-040400,             @ZA00870*/
*/*   086505-086510,099050-100360,100618-100718,105879-116405@ZA00870*/
*/*   123100-123200,129200-129300                            @ZA00870*/
*/* D 105879-116310,100373,100377,099100-100310,116720       @ZA00870*/
*/* C 038500,040000                                          @ZA00870*/
*                                                               01S0024
*   PCCBPTR=JSCBPCC;                /* ACTIVE JSCB'S PCCB CHAIN      */
         L     @10,@PC00001+8                                   01S0024
         L     @10,JSCBPTR(,@10)                                01S0024
         L     PCCBPTR,JSCBPCC(,@10)                            01S0024
*   LCLRTN=0;                       /* INITIALIZE LOCAL RTN AREA     */
         SLR   @08,@08                                          01S0025
         ST    @08,LCLRTN                                       01S0025
*   CREATNEW=OFF;                   /* LOOP CONTROL                  */
         NI    CREATNEW,B'01111111'                             01S0026
*   LENTH=LENGTH(IEFPCCB);          /* LENGTH OF A PCCB              */
         MVC   LENTH(3),@CF00289+1                              01S0027
*   SBPOOL=JSCBSWSP;                /* SWA SUBPOOL FOR PCCBS         */
         MVC   SBPOOL(1),JSCBSWSP(@10)                          01S0028
*   IF PCCFREAL=ON THEN             /* FREE ALL PCCBS REQUEST        */
         L     @10,@PC00001                                     01S0029
         TM    PCCFREAL(@10),B'00010000'                        01S0029
         BNO   @RF00029                                         01S0029
*     DO;                                                       01S0030
*       DO WHILE(PCCBPTR^=0);                                   01S0031
         B     @DE00031                                         01S0031
@DL00031 DS    0H                                               01S0032
*         LENREG=SPLEN;             /* SUBPOOL AND LENGTH OF PCCB    */
         L     LENREG,SPLEN                                     01S0032
*         ADDREG=PCCBPTR;           /* ADDRESS OF PCCB TO FREE       */
         LR    ADDREG,PCCBPTR                                   01S0033
*         PCCBPTR=PCCNEXTP;         /* LOCATE NEXT PCCB IF ANY       */
         L     PCCBPTR,PCCNEXTP(,PCCBPTR)                       01S0034
*         GEN(FREEMAIN R,LV=(LENREG),A=(ADDREG));/* FREE A PCCB      */
         FREEMAIN R,LV=(LENREG),A=(ADDREG)
*       END;                                                    01S0036
@DE00031 SLR   @10,@10                                          01S0036
         CR    PCCBPTR,@10                                      01S0036
         BNE   @DL00031                                         01S0036
*       DO;                         /* MODESET KEYADDR(0)            */
*         SPKA(0);                  /* SET PSW KEY                   */
         SPKA  0(@10)                                           01S0038
*       END;                        /* MODESET KEYADDR(0) KEY 0 TO
*                                      ALTER JSCB                    */
*       JSCBPCC=0;                  /* NO PCCBS CHAINED TO JSCB      */
         L     @08,@PC00001+8                                   01S0040
         L     @08,JSCBPTR(,@08)                                01S0040
         ST    @10,JSCBPCC(,@08)                                01S0040
*       DO;                         /* MODESET EXTKEY(SCHED)         */
*         SPKA(16);                 /* SET PSW KEY                   */
         LA    @10,16                                           01S0042
         SPKA  0(@10)                                           01S0042
*       END;                        /* MODESET EXTKEY(SCHED) BACK TO
*                                      KEY 1                         */
*     END;                                                      01S0044
*   IF PCCMAKE=ON THEN              /* ATTEMPT OLD PCCB LOCATE       */
@RF00029 L     @10,@PC00001                                     01S0045
         TM    PCCMAKE(@10),B'10000000'                         01S0045
         BNO   @RF00045                                         01S0045
*     DO;                           /* LOCATE/CREATE PCCB            */
*                                                               02S0047
*/********************************************************************/
*/* SEGMENT NAME - FINDPCCB                                          */
*/*                                                                  */
*/* DESCRIPTIVE NAME - PCCB LOCATE/CREATE                            */
*/*                                                                  */
*/* FUNCTION - RETURN A POINTER TO PCCB FOUND/CREATED,CHAINED        */
*/*                                                                  */
*/*  OPERATION - THE FIRST PCCB POINTER BEING ZERO CAUSES CREATION OF*/
*/*              A PCCB. OTHERWISE, THE PCCB CHAIN IS SEARCHED FOR A */
*/*              MATCH OF THE DSNAME IN THE PCCB AND THE ONE PASSED  */
*/*              INTO THE MODULE:                                    */
*/*                 MATCH:INCLUDE 'CHEKPCCB' FOR FURTHER PROCESSING, */
*/*                       IF NOT A STEPCAT REQUEST.          @ZA00870*/
*/*                                                                  */
*/*                 NO MATCH:  CREATE AND CHAIN NEW PCCB WITH REASON */
*/*                            CODE OF 0 (NEW PCCB, UNIQUE DSNAME).  */
*/*                                                                  */
*/*              A GETMAIN ERROR CAUSES RETURN TO CALLER WITH RETURN */
*/*              AND REASON CODES.                                   */
*/*                                                                  */
*/*              INITIALIZE FIELDS IN THE CREATED PCCB.              */
*/*                                                                  */
*/* ENTRY - IF 'MAKE PCCB' IS SPECIFIED BY THE CALLER.               */
*/*                                                                  */
*/*   PURPOSE - FIND/CREATE PCCB                                     */
*/*                                                                  */
*/*   INPUT DATA - FIRST PCCB POINTER ( FROM ACTIVE JSCB), AND       */
*/*                OTHER DATA INPUT TO THE MODULE.                   */
*/*                                                                  */
*/* EXIT - IN LINE                                                   */
*/*                                                                  */
*/*   CONDITION - FOUND/CREATED PCCB                                 */
*/*                                                                  */
*/*   OUTPUT DATA - PCCB POINTER, REASON CODE 0 - SUCCESS            */
*/*                 REASON CODE 2 - ?GETSTORG ROUTINE FAILURE.       */
*/*                 REASON CODE 4 - 'MAKEPCCB' REQUEST FOR A @ZA00870*/
*/*                                 STEPCAT AND A PCCB       @ZA00870*/
*/*                                 ALREADY EXISTS FOR THE   @ZA00870*/
*/*                                 CATALOG.                 @ZA00870*/
*/*                                                                  */
*/*   RETURN CODE - 0 SUCCESS                                        */
*/*                 4 STEPCAT ERROR                          @ZA00870*/
*/*                 8 ?GETSTORG FAILURE                              */
*/********************************************************************/
*                                                               02S0047
*       ACBPTR=ACBP;                /* LOCAL COPY OF PARAMETERS      */
         L     @10,@PC00001+20                                  02S0047
         L     @10,ACBP(,@10)                                   02S0047
         ST    @10,ACBPTR                                       02S0047
*       NEEDPCCB=OFF;               /* ASSUME NO PCCB NEEDED@ZA00870 */
         NI    NEEDPCCB,B'01111111'                             02S0048
*       ALIAS=OFF;                  /* ASSUME NOT ALIAS      @ZA00870*/
         NI    ALIAS,B'01111111'                                02S0049
*       IF DDNAMEP^=0 THEN          /* IF A DDNAME WAS PASSED,       */
         L     @10,@PC00001+24                                  02S0050
         L     @10,DDNAMEP(,@10)                                02S0050
         LTR   @10,@10                                          02S0050
         BZ    @RF00050                                         02S0050
*         DDNAME=DDNAM;             /* COPY THE DD NAME              */
         MVC   DDNAME(8),DDNAM(@10)                             02S0051
*       ELSE                        /* DDNAME NOT PASSED             */
*         DDNAME=DDNAME&&DDNAME;    /* CLEAR LOCAL COPY              */
         B     @RC00050                                         02S0052
@RF00050 XC    DDNAME(8),DDNAME                                 02S0052
*       IF VSERPTR^=0 THEN          /* COPY VOLUME SERIAL IF PASSED  */
@RC00050 L     @10,@PC00001+32                                  02S0053
         L     @10,VSERPTR(,@10)                                02S0053
         LTR   @10,@10                                          02S0053
         BZ    @RF00053                                         02S0053
*         VSERCOPY=VSERPARM;        /* FOR CVOL PROCESSING           */
         MVC   VSERCOPY(6),VSERPARM(@10)                        02S0054
*       ELSE                        /* OR, IF NOT PASSED, CLEAR      */
*         VSERCOPY=VSERCOPY&&VSERCOPY;/* LOCAL COPY AREA             */
         B     @RC00053                                         02S0055
@RF00053 XC    VSERCOPY(6),VSERCOPY                             02S0055
*       IF PCCBPTR=0 THEN           /* CREATE FIRST PCCB USING THE   */
@RC00053 LTR   PCCBPTR,PCCBPTR                                  02S0056
         BNZ   @RF00056                                         02S0056
*         DO;                       /* ?GETSTORG MACRO               */
*                                                               02S0057
*           /*********************************************************/
*           /*                                                       */
*           /* ?GETSTORG (JSCBSWSP,LENGTH(IEFPCCB),NXPCTEMP);        */
*           /*                                                       */
*           /*********************************************************/
*                                                               02S0058
*                                                               02S0058
*           /*********************************************************/
*           /*                                                       */
*           /* DEFINITIONS OF GETMAIN PARMS                          */
*           /*                                                       */
*           /*********************************************************/
*                                                               02S0058
*           DCL                                                 02S0058
*             GTSTR0 FIXED(31) REG(0),/* GTMN PARM REG               */
*             GTSTR1 FIXED(31) REG(1),/* GTMN PARM REG               */
*             GTSTR2 PTR(31) REG(2),/* GTMN PARM REG                 */
*             GTSTR15 FIXED(31) REG(15),/* GTMN RET COD              */
*             GTSTRTCD FIXED(31);   /* GETMAIN RTN CODE              */
*           DCL                                                 02S0059
*             GTSTR3 FIXED(31) REG(3),/* CLEARING REG                */
*             GTSTR4 FIXED(31) REG(4),/* CLEARING REG                */
*             GTSTR5 FIXED(31) REG(5),/* CLEARING REG                */
*             GTSTR6 FIXED(31) REG(6),/* CLEARING REG                */
*             GTSTR7 FIXED(31) REG(7),/* CLEARING REG                */
*             GTSTR8 FIXED(31) REG(8),/* CLEARING REG                */
*             GTSTZERO FIXED(31) INIT(0),                       02S0059
*             GTST253 FIXED(31) CONSTANT(253);                  02S0059
*           RFY                                                 02S0060
*            (GTSTR0,                                           02S0060
*             GTSTR1,                                           02S0060
*             GTSTR2) RSTD;         /* SAVE RGS                      */
*           GTSTR0=LENGTH(IEFPCCB); /* SET AMOUNT                    */
         LA    GTSTR0,176                                       02S0061
*           GTSTR2=JSCBSWSP;        /* SET SUBPOOL                   */
         L     @08,@PC00001+8                                   02S0062
         L     @08,JSCBPTR(,@08)                                02S0062
         SLR   GTSTR2,GTSTR2                                    02S0062
         IC    GTSTR2,JSCBSWSP(,@08)                            02S0062
*           GENERATE CODE;                                      02S0063
             GETMAIN RC,LV=(0),SP=(2)  DO GETMAIN
*           GTSTRTCD=GTSTR15;       /* SAVE GETMAIN RET COD          */
         LR    GTSTRTCD,GTSTR15                                 02S0064
*           NXPCTEMP=GTSTR1;        /* ADDR OF GOTN STORG            */
         ST    GTSTR1,NXPCTEMP                                  02S0065
*           RFY                                                 02S0066
*            (GTSTR0,                                           02S0066
*             GTSTR1,                                           02S0066
*             GTSTR2) UNRSTD;       /* RLSE                          */
*           IF GTSTRTCD=0 THEN      /* GETMAIN SUCCESSFUL?           */
         LTR   GTSTRTCD,GTSTRTCD                                02S0067
         BNZ   @RF00067                                         02S0067
*             DO;                   /* YES, CLEAR STORAGE.           */
*               RFY                                             02S0069
*                (GTSTR2,                                       02S0069
*                 GTSTR4,                                       02S0069
*                 GTSTR5,                                       02S0069
*                 GTSTR6,                                       02S0069
*                 GTSTR7,                                       02S0069
*                 GTSTR8) RSTD;                                 02S0069
*               GTSTR4=NXPCTEMP;    /* STORG PTR                     */
         L     @03,NXPCTEMP                                     02S0070
         LR    GTSTR4,@03                                       02S0070
*               GTSTR5=LENGTH(IEFPCCB);/* STORG AMNT                 */
         LA    GTSTR5,176                                       02S0071
*               GTSTR7='00000000'X; /* PAD CHAR & LNTH               */
         SLR   GTSTR7,GTSTR7                                    02S0072
*               IF JSCBSWSP=GTST253 THEN                        02S0073
         L     @03,@PC00001+8                                   02S0073
         L     @03,JSCBPTR(,@03)                                02S0073
         CLI   JSCBSWSP(@03),253                                02S0073
         BNE   @RF00073                                         02S0073
*                 GEN(MODESET KEYADDR=GTSTZERO,SAVEKEY=(2),WORKREG=8);
         MODESET KEYADDR=GTSTZERO,SAVEKEY=(2),WORKREG=8
*               GEN REFS(GTSTR4,GTSTR6);                        02S0075
@RF00073 DS    0H                                               02S0075
                  MVCL  GTSTR4,GTSTR6 CLEAR GOTTEN STORG
*               IF JSCBSWSP=GTST253 THEN                        02S0076
         L     @03,@PC00001+8                                   02S0076
         L     @03,JSCBPTR(,@03)                                02S0076
         CLI   JSCBSWSP(@03),253                                02S0076
         BNE   @RF00076                                         02S0076
*                 GEN(MODESET KEYADDR=(2));                     02S0077
         MODESET KEYADDR=(2)
*               RFY                                             02S0078
*                (GTSTR2,                                       02S0078
*                 GTSTR4,                                       02S0078
*                 GTSTR5,                                       02S0078
*                 GTSTR6,                                       02S0078
*                 GTSTR7,                                       02S0078
*                 GTSTR8) UNRSTD;                               02S0078
@RF00076 DS    0H                                               02S0079
*             END;                  /* STORAGE CLEARING COMPLETED    */
*           ELSE                                                02S0080
*             NXPCTEMP=0;           /* CLEAR RETURN ADDR.            */
         B     @RC00067                                         02S0080
@RF00067 SLR   @08,@08                                          02S0080
         ST    @08,NXPCTEMP                                     02S0080
*           GTSTR15=GTSTRTCD;       /* GTMN RETURN CODE              */
@RC00067 LR    GTSTR15,GTSTRTCD                                 02S0081
*                                   /* RESTORE LIST PRINT STATUS     */
*           IF RTCDREG=0 THEN       /* MAP PCCB IF RETURN OK         */
         SLR   @14,@14                                          02S0082
         CR    RTCDREG,@14                                      02S0082
         BNE   @RF00082                                         02S0082
*             DO;                                               02S0083
*               PCCBPTR=NXPCTEMP;                               02S0084
         L     PCCBPTR,NXPCTEMP                                 02S0084
*               DO;                 /* MODESET KEYADDR(0)            */
*                 SPKA(0);          /* SET PSW KEY                   */
         SPKA  0(@14)                                           02S0086
*               END;                /* MODESET KEYADDR(0) KEY 0 TO
*                                      ALTER JSCB                    */
*               JSCBPCC=PCCBPTR;    /* FIRST PCCB POINTER IN JSCB    */
         L     @10,@PC00001+8                                   02S0088
         L     @10,JSCBPTR(,@10)                                02S0088
         ST    PCCBPTR,JSCBPCC(,@10)                            02S0088
*               DO;                 /* MODESET EXTKEY(SCHED)         */
*                 SPKA(16);         /* SET PSW KEY                   */
         LA    @10,16                                           02S0090
         SPKA  0(@10)                                           02S0090
*               END;                /* MODESET EXTKEY(SCHED) BACK TO
*                                      KEY 1                         */
*             END;                                              02S0092
*           ELSE                    /* ERROR FROM ?GETSTORG          */
*             RTCD=GETERROR;        /* RETURN CODE - 8               */
         B     @RC00082                                         02S0093
@RF00082 MVC   RTCD(2),@CH00058                                 02S0093
*           CREATNEW=ON;            /* PROCESSING CONTROL            */
@RC00082 OI    CREATNEW,B'10000000'                             02S0094
*         END;                                                  02S0095
*       ELSE                        /* SEARCH THE PCCB CHAIN FOR     */
*         DO WHILE(PCCDSNAM^=CTGDSN&/* DSNAME MATCH OR CHAIN-END     */
*               CREATNEW=OFF);                                  02S0096
         B     @RC00056                                         02S0096
@RF00056 B     @DE00096                                         02S0096
@DL00096 DS    0H                                               02S0097
*           IF PCCNEXTP=0 THEN      /* LAST PCCB IN CHAIN. CREATE    */
         L     @10,PCCNEXTP(,PCCBPTR)                           02S0097
         LTR   @10,@10                                          02S0097
         BNZ   @RF00097                                         02S0097
*             DO;                   /* AND CHAIN A NEW PCCB          */
*                                                               02S0098
*               /*****************************************************/
*               /*                                                   */
*               /* ?GETSTORG (JSCBSWSP,LENGTH(IEFPCCB),PCCNEXTP);    */
*               /*                                                   */
*               /*****************************************************/
*                                                               02S0099
*               RFY                                             02S0099
*                (GTSTR0,                                       02S0099
*                 GTSTR1,                                       02S0099
*                 GTSTR2) RSTD;     /* SAVE RGS                      */
*               GTSTR0=LENGTH(IEFPCCB);/* SET AMOUNT                 */
         LA    GTSTR0,176                                       02S0100
*               GTSTR2=JSCBSWSP;    /* SET SUBPOOL                   */
         L     @08,@PC00001+8                                   02S0101
         L     @08,JSCBPTR(,@08)                                02S0101
         SLR   GTSTR2,GTSTR2                                    02S0101
         IC    GTSTR2,JSCBSWSP(,@08)                            02S0101
*               GENERATE CODE;                                  02S0102
                   GETMAIN RC,LV=(0),SP=(2)  DO GETMAIN
*               GTSTRTCD=GTSTR15;   /* SAVE GETMAIN RET COD          */
         LR    GTSTRTCD,GTSTR15                                 02S0103
*               PCCNEXTP=GTSTR1;    /* ADDR OF GOTN STORG            */
         ST    GTSTR1,PCCNEXTP(,PCCBPTR)                        02S0104
*               RFY                                             02S0105
*                (GTSTR0,                                       02S0105
*                 GTSTR1,                                       02S0105
*                 GTSTR2) UNRSTD;   /* RLSE                          */
*               IF GTSTRTCD=0 THEN  /* GETMAIN SUCCESSFUL?           */
         LTR   GTSTRTCD,GTSTRTCD                                02S0106
         BNZ   @RF00106                                         02S0106
*                 DO;               /* YES, CLEAR STORAGE.           */
*                   RFY                                         02S0108
*                    (GTSTR2,                                   02S0108
*                     GTSTR4,                                   02S0108
*                     GTSTR5,                                   02S0108
*                     GTSTR6,                                   02S0108
*                     GTSTR7,                                   02S0108
*                     GTSTR8) RSTD;                             02S0108
*                   GTSTR4=PCCNEXTP;/* STORG PTR                     */
         L     @03,PCCNEXTP(,PCCBPTR)                           02S0109
         LR    GTSTR4,@03                                       02S0109
*                   GTSTR5=LENGTH(IEFPCCB);/* STORG AMNT             */
         LA    GTSTR5,176                                       02S0110
*                   GTSTR7='00000000'X;/* PAD CHAR & LNTH            */
         SLR   GTSTR7,GTSTR7                                    02S0111
*                   IF JSCBSWSP=GTST253 THEN                    02S0112
         L     @03,@PC00001+8                                   02S0112
         L     @03,JSCBPTR(,@03)                                02S0112
         CLI   JSCBSWSP(@03),253                                02S0112
         BNE   @RF00112                                         02S0112
*                     GEN                                       02S0113
*(MODESET KEYADDR=GTSTZERO,SAVEKEY=(2),WORKREG=8);              02S0113
         MODESET KEYADDR=GTSTZERO,SAVEKEY=(2),WORKREG=8
*                   GEN REFS(GTSTR4,GTSTR6);                    02S0114
@RF00112 DS    0H                                               02S0114
                        MVCL  GTSTR4,GTSTR6 CLEAR GOTTEN STORG
*                   IF JSCBSWSP=GTST253 THEN                    02S0115
         L     @03,@PC00001+8                                   02S0115
         L     @03,JSCBPTR(,@03)                                02S0115
         CLI   JSCBSWSP(@03),253                                02S0115
         BNE   @RF00115                                         02S0115
*                     GEN(MODESET KEYADDR=(2));                 02S0116
         MODESET KEYADDR=(2)
*                   RFY                                         02S0117
*                    (GTSTR2,                                   02S0117
*                     GTSTR4,                                   02S0117
*                     GTSTR5,                                   02S0117
*                     GTSTR6,                                   02S0117
*                     GTSTR7,                                   02S0117
*                     GTSTR8) UNRSTD;                           02S0117
@RF00115 DS    0H                                               02S0118
*                 END;              /* STORAGE CLEARING COMPLETED    */
*               ELSE                                            02S0119
*                 PCCNEXTP=0;       /* CLEAR RETURN ADDR.            */
         B     @RC00106                                         02S0119
@RF00106 SLR   @08,@08                                          02S0119
         ST    @08,PCCNEXTP(,PCCBPTR)                           02S0119
*               GTSTR15=GTSTRTCD;   /* GTMN RETURN CODE              */
@RC00106 LR    GTSTR15,GTSTRTCD                                 02S0120
*                                   /* RESTORE LIST PRINT STATUS     */
*               IF RTCDREG=0 THEN   /* ?GETSTORG OK                  */
         LTR   RTCDREG,RTCDREG                                  02S0121
         BNZ   @RF00121                                         02S0121
*                 PCCNEXTP->PCCPREVP=PCCBPTR;/* BACK CHAIN POINTER   */
         L     @10,PCCNEXTP(,PCCBPTR)                           02S0122
         ST    PCCBPTR,PCCPREVP(,@10)                           02S0122
*               ELSE                /* ERROR                         */
*                 RTCD=GETERROR;    /* RETURN CODE - 8               */
         B     @RC00121                                         02S0123
@RF00121 MVC   RTCD(2),@CH00058                                 02S0123
*               CREATNEW=ON;        /* LOOP EXIT                     */
@RC00121 OI    CREATNEW,B'10000000'                             02S0124
*             END;                                              02S0125
*           PCCBPTR=PCCNEXTP;       /* MAP NEXT OR FOUND PCCB        */
@RF00097 L     PCCBPTR,PCCNEXTP(,PCCBPTR)                       02S0126
*         END;                                                  02S0127
@DE00096 L     @10,@PC00001+12                                  02S0127
         L     @10,CTGDSNP(,@10)                                02S0127
         CLC   PCCDSNAM(44,PCCBPTR),CTGDSN(@10)                 02S0127
         BE    @DC00096                                         02S0127
         TM    CREATNEW,B'10000000'                             02S0127
         BZ    @DL00096                                         02S0127
@DC00096 DS    0H                                               02S0128
*       IF CREATNEW=OFF THEN        /* NO PCCB CREATED AND   @ZA00870*/
@RC00056 TM    CREATNEW,B'10000000'                             02S0128
         BNZ   @RF00128                                         02S0128
*         IF PCCSTPCT=OFF THEN      /* NOT A STEPCAT         @ZA00870*/
         L     @10,@PC00001                                     02S0129
         TM    PCCSTPCT(@10),B'00100000'                        02S0129
         BNZ   @RF00129                                         02S0129
*           DO;                     /* CHECK FOR ALIAS       @ZA00870*/
*                                                               03S0131
*/********************************************************************/
*/*                                                                  */
*/*  SEGMENT NAME - CHEKPCCB (ADDED FOR APAR OZ00870)        @ZA00870*/
*/*                                                                  */
*/*  DESCRIPTIVE NAME - PCCB CONTENTS VERIFICATION                   */
*/*                                                                  */
*/*  FUNCTION - INSURE A PCCB EXISTS FOR CATALOG ALIAS' AND THAT     */
*/*             PCCBS THAT REPRESENT A CATALOG ARE USABLE BY         */
*/*             CATALOG MANAGEMENT(IE. ALLOCATED OPEN AND ACTIVE).   */
*/*                                                                  */
*/*    OPERATION - 1. IF A DDNAME POINTER IS PASSED, THIS MEANS ALL  */
*/*                   PCCBS FOR THIS CATALOG ARE NOT ALLOCATED AND   */
*/*                   CLOSED.  THE PCCB CHAIN IS SCANNED AND ALL     */
*/*                   PCCBS FOR THIS CATALOG ARE UPDATED WITH THE    */
*/*                   ACB POINTER, DDNAME PASSED AND MADE ACTIVE.    */
*/*                                                                  */
*/*                2. IF A DDNAME POINTER IS NOT PASSED, THE CATALOG */
*/*                   MAY OR MAY NOT BE OPEN, THE PCCB CHAIN IS      */
*/*                   SCANNED TO GET THE ACB POINTER, DDNAME AND     */
*/*                   VOLSER FOR CVOLS FROM AN EXISTING PCCB. THIS   */
*/*                   ACB POINTER, DDNAME AND VOLSER FOR CVOLS       */
*/*                   WILL BE USED AS INPUT IF A NEW PCCB IS NEEDED. */
*/*                                                                  */
*/*                3. IF ABOVE 1 OR 2 INDICATE A PCCB IS REQUIRED,   */
*/*                   (PCCB IS NEEDED IF NO PCCB EXISTS WITH THE     */
*/*                   ALIAS NAME PASSED) STORAGE IS OBTAINED AND     */
*/*                   THE NEW PCCB IS ADDED TO THE END OF THE PCCB   */
*/*                   CHAIN.                                         */
*/*                NOTE:  ACB POINTERS FOR CVOLS ARE ZERO.           */
*/*                                                                  */
*/* ENTRY - IF PCCB(S) EXIST WITH THE SPECIFIED CATALOG DS NAME      */
*/*                                                                  */
*/*   INPUT - FIRST PCCB WITH THE SPECIFIED CATALOG DATASET NAME,    */
*/*           AND OTHER PARAMETERS INPUT TO THE MODULE.              */
*/*                                                                  */
*/* EXIT - WHEN PROCESSING PCCB(S) IS COMPLETE.                      */
*/*                                                                  */
*/* OUTPUT DATA - NO ERROR DETECTED:                                 */
*/*               NEW ALIAS PCCB CREATED   - REASON CODE 2           */
*/*               NO PCCB CREATED - REASON CODE 1                    */
*/*                                                                  */
*/*             - ERROR CONDITION:                                   */
*/*               ?GETSTORG ERROR          - REASON CODE 2           */
*/*                                                                  */
*/*   RETURN CODES - PROCESSING SUCCESSFUL - 0,                      */
*/*                  PROCESSING ERROR      - 4,                      */
*/*                  ?GETSTORG ERROR       - 8.                      */
*/*                                                                  */
*/********************************************************************/
*                                                               03S0131
*             CHKDDNP=DDNAMEP;      /* COPY INPUT DDNAM PTR@ZA00870  */
         L     @10,@PC00001+24                                  03S0131
         L     CHKDDNP,DDNAMEP(,@10)                            03S0131
*             NEEDPCCB=ON;          /* INDIC. PCCB NEEDED    @ZA00870*/
         OI    NEEDPCCB,B'10000000'                             03S0132
*             ALIAS=ON;             /* IF A PCCB IS CREATED IT HAS TO
*                                      BE AN ALIAS           @ZA00870*/
         OI    ALIAS,B'10000000'                                03S0133
*             DO WHILE PCCBPTR^=0;  /* SCAN ALL PCCBS        @ZA00870*/
         B     @DE00134                                         03S0134
@DL00134 DS    0H                                               03S0135
*               IF CTGDSN=PCCDSNAM THEN/* REAL NAME PCCB ON CHAIN?
*                                                            @ZA00870*/
         L     @10,@PC00001+12                                  03S0135
         L     @10,CTGDSNP(,@10)                                03S0135
         CLC   CTGDSN(44,@10),PCCDSNAM(PCCBPTR)                 03S0135
         BNE   @RF00135                                         03S0135
*                 DO;               /* YES, SEE IF PCCB NEEDED. 03S0136
*                                                            @ZA00870*/
*                   IF CHKDDNP^=0 THEN/* INPUT DDNAME        @ZA00870*/
         SLR   @10,@10                                          03S0137
         CR    CHKDDNP,@10                                      03S0137
         BE    @RF00137                                         03S0137
*                     DO;           /* YES, UPDATE ALL PCCBS WITH
*                                      SAME REAL CATLG NAME@ZA00870  */
*                       PCCTCL=OFF; /* TURN OFF TEMP CLOSE   @ZA00870*/
         NI    PCCTCL(PCCBPTR),B'11110111'                      03S0139
*                       PCCACBP=ACBPTR;/* PUT IN ACB PTR     @ZA00870*/
         L     @08,ACBPTR                                       03S0140
         ST    @08,PCCACBP(,PCCBPTR)                            03S0140
*                       PCCDDNAM=DDNAME;/* GET INPUT DDNAME  @ZA00870*/
         MVC   PCCDDNAM(8,PCCBPTR),DDNAME                       03S0141
*                       PCCACTIV=ON;/* MAKE IT ACTIVE        @ZA00870*/
         OI    PCCACTIV(PCCBPTR),B'00100000'                    03S0142
*                       IF CTGCONP^=0 THEN/* ANY ALIAS?      @ZA00870*/
         L     @08,@PC00001+16                                  03S0143
         L     @08,CTGCONP(,@08)                                03S0143
         CR    @08,@10                                          03S0143
         BE    @RF00143                                         03S0143
*                         IF CTGCON=PCCTGCON THEN/* YES, IS THIS PCCB
*                                      FOR INPUTED ALIAS?    @ZA00870*/
         CLC   CTGCON(44,@08),PCCTGCON(PCCBPTR)                 03S0144
         BNE   @RF00144                                         03S0144
*                           NEEDPCCB=OFF;/* YES,DON'T NEED A PCCB
*                                                            @ZA00870*/
         NI    NEEDPCCB,B'01111111'                             03S0145
*                         ELSE                                  03S0146
*                           ;       /* NOT SAME ALIAS, PCCB NEEDED
*                                                            @ZA00870*/
@RF00144 DS    0H                                               03S0147
*                       ELSE        /* NO INPUT ALIAS, ALREADY A PCCB
*                                      FOR CATALOG           @ZA00870*/
*                         NEEDPCCB=OFF;/* SO NO PCCB NEEDED  @ZA00870*/
         B     @RC00143                                         03S0147
@RF00143 NI    NEEDPCCB,B'01111111'                             03S0147
*                     END;          /* NO CATALOG JUST OPENED BY
*                                      CALLER                @ZA00870*/
*                   ELSE            /* ZERO DDNAME PTR       @ZA00870*/
*                     DO;           /* NO ALLOC OR OPEN BY CALLER
*                                                            @ZA00870*/
         B     @RC00137                                         03S0149
@RF00137 DS    0H                                               03S0150
*                       IF CTGCONP^=0 THEN/* INPUT ALIAS?    @ZA00870*/
         L     @10,@PC00001+16                                  03S0150
         L     @10,CTGCONP(,@10)                                03S0150
         LTR   @10,@10                                          03S0150
         BZ    @RF00150                                         03S0150
*                         IF CTGCON^=PCCTGCON THEN/* YES, THIS PCCB
*                                      FOR INPUTED ALIAS?    @ZA00870*/
         CLC   CTGCON(44,@10),PCCTGCON(PCCBPTR)                 03S0151
         BE    @RF00151                                         03S0151
*                           DO;     /* NO,GET ACB & DDNAME THEY MAY
*                                      BE ZERO               @ZA00870*/
*                             IF PCOSCVOL=ON THEN/* CVOL?    @ZA00870*/
         TM    PCOSCVOL(PCCBPTR),B'00010000'                    03S0153
         BNO   @RF00153                                         03S0153
*                               VSERCOPY=PCVOLSER;/* YES,SAVE VOLSER
*                                                            @ZA00870*/
         MVC   VSERCOPY(6),PCVOLSER(PCCBPTR)                    03S0154
*                             ACBPTR=PCCACBP;/* ACBPTR FOR FINDPCCB
*                                                            @ZA00870*/
@RF00153 L     @10,PCCACBP(,PCCBPTR)                            03S0155
         ST    @10,ACBPTR                                       03S0155
*                             DDNAME=PCCDDNAM;/* DDN FOR FINDPCCB
*                                                            @ZA00870*/
         MVC   DDNAME(8),PCCDDNAM(PCCBPTR)                      03S0156
*                           END;    /* END UNEQUAL PCCB      @ZA00870*/
*                         ELSE      /* ALIAS' SAME           @ZA00870*/
*                           NEEDPCCB=OFF;/* DON'T NEED PCCB  @ZA00870*/
         B     @RC00151                                         03S0158
@RF00151 NI    NEEDPCCB,B'01111111'                             03S0158
*                       ELSE        /* NO ALIAS SO ALREADY HAVE PCCB
*                                      FOR CATALOG           @ZA00870*/
*                         NEEDPCCB=OFF;/* DON'T NEED ANOTHER PCCB
*                                                            @ZA00870*/
         B     @RC00150                                         03S0159
@RF00150 NI    NEEDPCCB,B'01111111'                             03S0159
*                     END;          /* END ZERO DDNAMEPTR    @ZA00870*/
@RC00150 DS    0H                                               03S0161
*                 END;              /* END EQUAL REAL NAMES  @ZA00870*/
@RC00137 DS    0H                                               03S0162
*               LASTPCCB=PCCBPTR;   /* SAVE LAST PCCBPTR     @ZA00870*/
@RF00135 ST    PCCBPTR,LASTPCCB                                 03S0162
*               PCCBPTR=PCCNEXTP;   /* GET NEXT PCCB         @ZA00870*/
         L     PCCBPTR,PCCNEXTP(,PCCBPTR)                       03S0163
*             END;                  /* END PCCB SCAN         @ZA00870*/
@DE00134 LTR   PCCBPTR,PCCBPTR                                  03S0164
         BNZ   @DL00134                                         03S0164
*             IF NEEDPCCB=ON THEN   /* ALIAS PCCB NEEDED?    @ZA00870*/
         TM    NEEDPCCB,B'10000000'                             03S0165
         BNO   @RF00165                                         03S0165
*               DO;                 /* YES, GET AND CHAIN TO END
*                                                            @ZA00870*/
*                 PCCBPTR=LASTPCCB; /* GET LAST PCCB         @ZA00870*/
         L     PCCBPTR,LASTPCCB                                 03S0167
*                 RSNCD=ALIASCRT;   /* ALIAS PCCB CREATED    @ZA00870*/
*                                                               03S0168
         MVC   RSNCD(2),@CH00089                                03S0168
*                 /***************************************************/
*                 /*                                                 */
*                 /* ?GETSTORG (JSCBSWSP,LENGTH(IEFPCCB),PCCNEXTP);  */
*                 /*                                                 */
*                 /***************************************************/
*                                                               03S0169
*                 RFY                                           03S0169
*                  (GTSTR0,                                     03S0169
*                   GTSTR1,                                     03S0169
*                   GTSTR2) RSTD;   /* SAVE RGS                      */
*                 GTSTR0=LENGTH(IEFPCCB);/* SET AMOUNT               */
         LA    GTSTR0,176                                       03S0170
*                 GTSTR2=JSCBSWSP;  /* SET SUBPOOL                   */
         L     @08,@PC00001+8                                   03S0171
         L     @08,JSCBPTR(,@08)                                03S0171
         SLR   GTSTR2,GTSTR2                                    03S0171
         IC    GTSTR2,JSCBSWSP(,@08)                            03S0171
*                 GENERATE CODE;                                03S0172
                       GETMAIN RC,LV=(0),SP=(2)  DO GETMAIN
*                 GTSTRTCD=GTSTR15; /* SAVE GETMAIN RET COD          */
         LR    GTSTRTCD,GTSTR15                                 03S0173
*                 PCCNEXTP=GTSTR1;  /* ADDR OF GOTN STORG            */
         ST    GTSTR1,PCCNEXTP(,PCCBPTR)                        03S0174
*                 RFY                                           03S0175
*                  (GTSTR0,                                     03S0175
*                   GTSTR1,                                     03S0175
*                   GTSTR2) UNRSTD; /* RLSE                          */
*                 IF GTSTRTCD=0 THEN/* GETMAIN SUCCESSFUL?           */
         LTR   GTSTRTCD,GTSTRTCD                                03S0176
         BNZ   @RF00176                                         03S0176
*                   DO;             /* YES, CLEAR STORAGE.           */
*                     RFY                                       03S0178
*                      (GTSTR2,                                 03S0178
*                       GTSTR4,                                 03S0178
*                       GTSTR5,                                 03S0178
*                       GTSTR6,                                 03S0178
*                       GTSTR7,                                 03S0178
*                       GTSTR8) RSTD;                           03S0178
*                     GTSTR4=PCCNEXTP;/* STORG PTR                   */
         L     @03,PCCNEXTP(,PCCBPTR)                           03S0179
         LR    GTSTR4,@03                                       03S0179
*                     GTSTR5=LENGTH(IEFPCCB);/* STORG AMNT           */
         LA    GTSTR5,176                                       03S0180
*                     GTSTR7='00000000'X;/* PAD CHAR & LNTH          */
         SLR   GTSTR7,GTSTR7                                    03S0181
*                     IF JSCBSWSP=GTST253 THEN                  03S0182
         L     @03,@PC00001+8                                   03S0182
         L     @03,JSCBPTR(,@03)                                03S0182
         CLI   JSCBSWSP(@03),253                                03S0182
         BNE   @RF00182                                         03S0182
*                       GEN                                     03S0183
*(MODESET KEYADDR=GTSTZERO,SAVEKEY=(2),WORKREG=8);              03S0183
         MODESET KEYADDR=GTSTZERO,SAVEKEY=(2),WORKREG=8
*                     GEN REFS(GTSTR4,GTSTR6);                  03S0184
@RF00182 DS    0H                                               03S0184
                            MVCL  GTSTR4,GTSTR6 CLEAR GOTTEN STORG
*                     IF JSCBSWSP=GTST253 THEN                  03S0185
         L     @03,@PC00001+8                                   03S0185
         L     @03,JSCBPTR(,@03)                                03S0185
         CLI   JSCBSWSP(@03),253                                03S0185
         BNE   @RF00185                                         03S0185
*                       GEN(MODESET KEYADDR=(2));               03S0186
         MODESET KEYADDR=(2)
*                     RFY                                       03S0187
*                      (GTSTR2,                                 03S0187
*                       GTSTR4,                                 03S0187
*                       GTSTR5,                                 03S0187
*                       GTSTR6,                                 03S0187
*                       GTSTR7,                                 03S0187
*                       GTSTR8) UNRSTD;                         03S0187
@RF00185 DS    0H                                               03S0188
*                   END;            /* STORAGE CLEARING COMPLETED    */
*                 ELSE                                          03S0189
*                   PCCNEXTP=0;     /* CLEAR RETURN ADDR.            */
         B     @RC00176                                         03S0189
@RF00176 SLR   @08,@08                                          03S0189
         ST    @08,PCCNEXTP(,PCCBPTR)                           03S0189
*                 GTSTR15=GTSTRTCD; /* GTMN RETURN CODE              */
@RC00176 LR    GTSTR15,GTSTRTCD                                 03S0190
*                                   /* RESTORE LIST PRINT STATUS     */
*                 IF RTCDREG^=0 THEN/* NO STORAGE,           @ZA00870*/
         LTR   RTCDREG,RTCDREG                                  03S0191
         BZ    @RF00191                                         03S0191
*                   RTCD=GETERROR;  /* RETURN CODE - 8       @ZA00870*/
         MVC   RTCD(2),@CH00058                                 03S0192
*                 ELSE              /* GETSTORG OK?          @ZA00870*/
*                   DO;             /* CHAIN NEW PCCB        @ZA00870*/
         B     @RC00191                                         03S0193
@RF00191 DS    0H                                               03S0194
*                     PCCBPTR=PCCNEXTP;/* NEW PCCB PTR       @ZA00870*/
         L     PCCBPTR,PCCNEXTP(,PCCBPTR)                       03S0194
*                     PCCPREVP=LASTPCCB;/* BACK CHAIN PCCB   @ZA00870*/
         L     @10,LASTPCCB                                     03S0195
         ST    @10,PCCPREVP(,PCCBPTR)                           03S0195
*                   END;            /* END GETSOTRG OK       @ZA00870*/
*               END;                /* END ALIAS PCCB CREATE @ZA00870*/
*             ELSE                  /* NO PCCB CREATED.      @ZA00870*/
*               RSNCD=OLDPCCB;      /* AN OLD ONE WILL DO    @ZA00870*/
         B     @RC00165                                         03S0198
@RF00165 MVC   RSNCD(2),@CH00080                                03S0198
*           END;                    /* END PCCB CHECK        @ZA00870*/
*         ELSE                      /* STEPCAT AND PCCB      @ZA00870*/
*           DO;                     /* EXISTS,               @ZA00870*/
         B     @RC00129                                         02S0200
@RF00129 DS    0H                                               02S0201
*             RTCD=DUPERROR;        /* ERROR                 @ZA00870*/
         LA    @10,4                                            02S0201
         STH   @10,RTCD                                         02S0201
*             RSNCD=ACBERROR;       /* DUPLICATE STEPCAT     @ZA00870*/
         STH   @10,RSNCD                                        02S0202
*           END;                                                02S0203
*       ELSE                                                    02S0204
*         ;                         /* NON-ALIAS PCCB        @ZA00870*/
@RF00128 DS    0H                                               02S0205
*       IF RTCD=0&(CREATNEW=ONNEEDPCCB=ON) THEN/* PCCB GOTTEN  02S0205
*                                                            @ZA00870*/
@RC00128 LH    @10,RTCD                                         02S0205
         LTR   @10,@10                                          02S0205
         BNZ   @RF00205                                         02S0205
         TM    CREATNEW,B'10000000'                             02S0205
         BO    @RT00205                                         02S0205
         TM    NEEDPCCB,B'10000000'                             02S0205
         BNO   @RF00205                                         02S0205
@RT00205 DS    0H                                               02S0206
*         DO;                       /* FILL IN PCCB.         @ZA00870*/
*           PCCACTIV=ON;            /* INDICATE PCCB ACTIVE          */
         OI    PCCACTIV(PCCBPTR),B'00100000'                    02S0207
*           PCCDSNAM=CTGDSN;        /* CATALOG DATA SET NAME         */
         L     @10,@PC00001+12                                  02S0208
         L     @10,CTGDSNP(,@10)                                02S0208
         MVC   PCCDSNAM(44,PCCBPTR),CTGDSN(@10)                 02S0208
*           IF CTGCONP^=0 THEN      /* CATALOG CONNECTOR NAME WAS    */
         L     @10,@PC00001+16                                  02S0209
         L     @10,CTGCONP(,@10)                                02S0209
         LTR   @10,@10                                          02S0209
         BZ    @RF00209                                         02S0209
*             PCCTGCON=CTGCON;      /* PLACE IT IN THE PCCB AND      */
         MVC   PCCTGCON(44,PCCBPTR),CTGCON(@10)                 02S0210
*           IF ALIAS=ON THEN        /* CHEKPCCB CREATED AN ALIAS
*                                                            @ZA00870*/
@RF00209 TM    ALIAS,B'10000000'                                02S0211
         BNO   @RF00211                                         02S0211
*             PCCALIAS=ON;          /* MARK PCCB AS ALIAS    @ZA00870*/
         OI    PCCALIAS(PCCBPTR),B'01000000'                    02S0212
*           IF PCCSTPCT=ON THEN     /* CATALOG IS A STEPCAT,         */
@RF00211 L     @10,@PC00001                                     02S0213
         TM    PCCSTPCT(@10),B'00100000'                        02S0213
         BNO   @RF00213                                         02S0213
*             PCCSTEPC=ON;          /* INDICATE 'STEPCAT' IN PCCB    */
         OI    PCCSTEPC(PCCBPTR),B'10000000'                    02S0214
*           PCCDDNAM=DDNAME;        /* PLACE DD NAME IN PCCB         */
@RF00213 MVC   PCCDDNAM(8,PCCBPTR),DDNAME                       02S0215
*           IF PCCVOL=ON THEN       /* CATALOG IS A CVOL             */
         L     @10,@PC00001                                     02S0216
         TM    PCCVOL(@10),B'00001000'                          02S0216
         BNO   @RF00216                                         02S0216
*             DO;                                               02S0217
*               PCOSCVOL=ON;        /* INDICATE SAME AND PLACE THE   */
         OI    PCOSCVOL(PCCBPTR),B'00010000'                    02S0218
*               PCVOLSER=VSERCOPY;  /* VOLUME SERIAL IN THE PCCB     */
         MVC   PCVOLSER(6,PCCBPTR),VSERCOPY                     02S0219
*             END;                                              02S0220
*           ELSE                    /* USER (VSAM) CATALOG           */
*             PCCACBP=ACBPTR;       /* PLACE ACB POINTER IN PCCB     */
         B     @RC00216                                         02S0221
@RF00216 L     @10,ACBPTR                                       02S0221
         ST    @10,PCCACBP(,PCCBPTR)                            02S0221
*           PCCACRO=BLOKNAME;       /* PUT 'PCCB' INTO NEW PCCB      */
@RC00216 MVC   PCCACRO(4,PCCBPTR),@CC00098                      02S0222
*         END;                                                  02S0223
*       ELSE                                                    02S0224
*         IF RTCD=GETERROR THEN     /* ?GETSTORG ERROR               */
         B     @RC00205                                         02S0224
@RF00205 CLC   RTCD(2),@CH00058                                 02S0224
         BNE   @RF00224                                         02S0224
*           RSNCD=GETBAD;           /* REASON CODE - 2               */
         MVC   RSNCD(2),@CH00089                                02S0225
*     END;                          /* END FIND PCCB ROUTINE         */
*   ELSE                                                        01S0227
*     IF PCCFREE=ON&PCC2FREE^=0&    /* FREE A PCCB AND THE PCCB-TO-  */
*         PCC2FREE->PCCACRO=BLOKNAME THEN/* FREE IS A PCCB           */
         B     @RC00045                                         01S0227
@RF00045 L     @10,@PC00001                                     01S0227
         TM    PCCFREE(@10),B'01000000'                         01S0227
         BNO   @RF00227                                         01S0227
         SLR   @10,@10                                          01S0227
         L     @15,@PC00001+28                                  01S0227
         L     @15,PCC2FREE(,@15)                               01S0227
         CR    @15,@10                                          01S0227
         BE    @RF00227                                         01S0227
         CLC   PCCACRO(4,@15),@CC00098                          01S0227
         BNE   @RF00227                                         01S0227
*       DO;                         /* 'UNCHAIN' THE PCCB            */
*         PCCBPTR=PCC2FREE;         /* MAP THE 'PCCB TO FREE'        */
         LR    PCCBPTR,@15                                      01S0229
*         IF PCCPREVP=0 THEN        /* FIRST PCCB IN CHAIN, UPDATE   */
         C     @10,PCCPREVP(,PCCBPTR)                           01S0230
         BNE   @RF00230                                         01S0230
*           DO;                                                 01S0231
*             DO;                   /* MODESET KEYADDR(0)            */
*               SPKA(0);            /* SET PSW KEY                   */
         SPKA  0(@10)                                           01S0233
*             END;                  /* MODESET KEYADDR(0) KEY 0 TO
*                                      ALTER JSCB                    */
*             JSCBPCC=PCCNEXTP;     /* FIRST PCCB PTR IN JSCB        */
         L     @10,@PC00001+8                                   01S0235
         L     @10,JSCBPTR(,@10)                                01S0235
         L     @08,PCCNEXTP(,PCCBPTR)                           01S0235
         ST    @08,JSCBPCC(,@10)                                01S0235
*             DO;                   /* MODESET EXTKEY(SCHED)         */
*               SPKA(16);           /* SET PSW KEY                   */
         LA    @10,16                                           01S0237
         SPKA  0(@10)                                           01S0237
*             END;                  /* MODESET EXTKEY(SCHED) BACK TO
*                                      KEY 1                         */
*           END;                                                01S0239
*         ELSE                      /* NOT FIRST PCCB, UPDATE        */
*           PCCPREVP->PCCNEXTP=PCCNEXTP;/* PREVIOUS' 'NEXT PTR'      */
         B     @RC00230                                         01S0240
@RF00230 L     @10,PCCPREVP(,PCCBPTR)                           01S0240
         L     @08,PCCNEXTP(,PCCBPTR)                           01S0240
         ST    @08,PCCNEXTP(,@10)                               01S0240
*         IF PCCNEXTP^=0 THEN       /* THERE IS A 'NEXT' PCCB        */
@RC00230 L     @10,PCCNEXTP(,PCCBPTR)                           01S0241
         LTR   @10,@10                                          01S0241
         BZ    @RF00241                                         01S0241
*           PCCNEXTP->PCCPREVP=PCCPREVP;/* CHAIN NEXT TO PREVIOUS    */
         L     @08,PCCPREVP(,PCCBPTR)                           01S0242
         ST    @08,PCCPREVP(,@10)                               01S0242
*         LENREG=SPLEN;             /* SUBPOOL, LENGTH AND ADDRESS   */
@RF00241 L     LENREG,SPLEN                                     01S0243
*         ADDREG=PCC2FREE;          /* OF PCCB TO BE FREED           */
         L     @10,@PC00001+28                                  01S0244
         L     ADDREG,PCC2FREE(,@10)                            01S0244
*         GEN(FREEMAIN R,LV=(0),A=(1));                         01S0245
         FREEMAIN R,LV=(0),A=(1)
*       END;                                                    01S0246
*   GEN REFS(NQCORE);                                           01S0247
@RF00227 DS    0H                                               01S0247
@RC00045 DS    0H                                               01S0247
*                                  /* DEQUEUE PCCB CHAIN            */
         DEQ MF=(E,NQCORE)
*   RTNINFO=LCLRTN;                 /* PASS RETURN INFO TO CALLER    */
         L     @10,@PC00001+4                                   01S0248
         L     @10,RTNP(,@10)                                   01S0248
         L     @15,LCLRTN                                       01S0248
         ST    @15,RTNINFO(,@10)                                01S0248
*   END IEFAB4EF                                                01S0249
*                                                               01S0249
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.     */
*/*%INCLUDE SYSUT5  (SPEC4EF )                                       */
*/*%INCLUDE SYSUT5  (DCLS4EF )                                       */
*/*%INCLUDE SYSLIB  (IEFZB450)                                       */
*/*%INCLUDE SYSLIB  (IEFPCCB )                                       */
*/*%INCLUDE SYSLIB  (IEZJSCB )                                       */
*/*%INCLUDE SYSUT5  (FINDSPEC)                                       */
*/*%INCLUDE SYSUT5  (FINDPCCB)                                       */
*/*%INCLUDE SYSUT5  (CHEKSPEC)                                       */
*/*%INCLUDE SYSUT5  (CHEKPCCB)                                       */
*                                                               01S0249
*       ;                                                       01S0249
@EL00001 IC    @02,@OLDKEY                                      01S0249
         L     @13,4(,@13)                                      01S0249
@EF00001 L     @00,@SIZDATD                                     01S0249
         LR    @01,@11                                          01S0249
         FSPACE   R,LV=(0),A=(1)
         MODESET KEYADDR=(2)
@ER00001 LM    @14,@12,12(@13)                                  01S0249
         BR    @14                                              01S0249
@DATA    DS    0H
@CH00080 DC    H'1'
@CH00089 DC    H'2'
@CH00058 DC    H'8'
@SM00290 MVC   NQCORE(0),PCNQLIST
@DATD    DSECT
         DS    0F
@SA00001 DS    18F
@PC00001 DS    9F
IEFAB4EF CSECT
         DS    0F
@CF00289 DC    F'176'
@DATD    DSECT
         DS    0D
NXPCTEMP DS    A
ACBPTR   DS    A
LASTPCCB DS    A
LCLRTN   DS    FL4
         ORG   LCLRTN
RTCD     DS    FL2
RSNCD    DS    FL2
         ORG   LCLRTN+4
SPLEN    DS    CL4
         ORG   SPLEN
SBPOOL   DS    FL1
LENTH    DS    FL3
         ORG   SPLEN+4
DDNAME   DS    CL8
VSERCOPY DS    CL6
CREATNEW DS    BL1
ALIAS    DS    BL1
NEEDPCCB DS    BL1
@OLDKEY  DS    AL1
IEFAB4EF CSECT
         DS    0F
@SIZDATD DC    AL1(230)
         DC    AL3(@ENDDATD-@DATD)
         DS    0D
GTSTZERO DC    F'0'
@CC00098 DC    C'PCCB'
QNAME    DC    CL8'SYSZPCCB'
RNAME    DC    CL4'PCCB'
IEFAB4EF CSECT
PCNQLIST ENQ (QNAME,RNAME,S,,SYSTEM),MF=L
NQLENGTH DC A(*-PCNQLIST)
@DATD    DSECT
NQCORE   ENQ (QNAME,RNAME,S,,SYSTEM),MF=L
IEFAB4EF CSECT
         DS   0H
PATCHLOC DC ((@DATA-@PSTART)/20)X'00'
@DATD    DSECT
         ORG   *+1-(*-@DATD)/(*-@DATD) INSURE DSECT DATA
@ENDDATD EQU   *
IEFAB4EF CSECT
@00      EQU   00                      EQUATES FOR REGISTERS 0-15
@01      EQU   01
@02      EQU   02
@03      EQU   03
@04      EQU   04
@05      EQU   05
@06      EQU   06
@07      EQU   07
@08      EQU   08
@09      EQU   09
@10      EQU   10
@11      EQU   11
@12      EQU   12
@13      EQU   13
@14      EQU   14
@15      EQU   15
GTSTRTCD EQU   @10
CHKDDNP  EQU   @02
PCCBPTR  EQU   @09
LENREG   EQU   @00
ADDREG   EQU   @01
RTCDREG  EQU   @15
GTSTR0   EQU   @00
GTSTR1   EQU   @01
GTSTR2   EQU   @02
GTSTR15  EQU   @15
GTSTR4   EQU   @04
GTSTR5   EQU   @05
GTSTR6   EQU   @06
GTSTR7   EQU   @07
GTSTR8   EQU   @08
GTSTR3   EQU   @03
RTNINFO  EQU   0
CTGDSN   EQU   0
CTGCON   EQU   0
DDNAM    EQU   0
VSERPARM EQU   0
IEFPCCB  EQU   0
PCCACRO  EQU   IEFPCCB
PCCNEXTP EQU   IEFPCCB+4
PCCPREVP EQU   IEFPCCB+8
PCCSTATS EQU   IEFPCCB+12
PCCSTAT1 EQU   PCCSTATS
PCCSTEPC EQU   PCCSTAT1
PCCALIAS EQU   PCCSTAT1
PCCACTIV EQU   PCCSTAT1
PCOSCVOL EQU   PCCSTAT1
PCCTCL   EQU   PCCSTAT1
PCCACBP  EQU   IEFPCCB+16
PCCDDNAM EQU   IEFPCCB+20
PCCDSNAM EQU   IEFPCCB+28
PCCTGCON EQU   IEFPCCB+72
PCVOLSER EQU   IEFPCCB+116
IEZJSCB  EQU   0
JSCBSEC1 EQU   IEZJSCB+188
JSCHPCE  EQU   JSCBSEC1+4
JSCBPCC  EQU   JSCBSEC1+16
JSCBDCB  EQU   JSCBSEC1+36
JSCBOPTS EQU   JSCBSEC1+48
JSCBSWT1 EQU   JSCBSEC1+55
JSCBWTP  EQU   JSCBSEC1+64
JSCBWTFG EQU   JSCBWTP
JSCBEND1 EQU   IEZJSCB+260
PCCNTRLS EQU   0
PCCMAKE  EQU   PCCNTRLS
PCCFREE  EQU   PCCNTRLS
PCCSTPCT EQU   PCCNTRLS
PCCFREAL EQU   PCCNTRLS
PCCVOL   EQU   PCCNTRLS
RTNP     EQU   0
JSCBPTR  EQU   0
CTGDSNP  EQU   0
CTGCONP  EQU   0
ACBP     EQU   0
DDNAMEP  EQU   0
PCC2FREE EQU   0
VSERPTR  EQU   0
JSCBSEC2 EQU   JSCBEND1
JSCBSEC3 EQU   JSCBEND1
JSCBJCT  EQU   JSCBSEC3
JSCBJCTA EQU   JSCBJCT+1
JSCBASID EQU   JSCBSEC3+8
JSCBJNL  EQU   JSCBSEC3+28
JSCBJJSB EQU   JSCBJNL
JSCBSUB  EQU   JSCBSEC3+40
JSCSCT   EQU   JSCBSEC3+68
JSCBSWSP EQU   JSCBSEC3+87
JSCRSV35 EQU   JSCBSEC3+96
JSCRSV36 EQU   JSCRSV35
JSCRSV37 EQU   JSCRSV35+2
JSCRSV45 EQU   JSCBSEC3+112
JSCRSV46 EQU   JSCRSV45
JSCRSV47 EQU   JSCRSV45+2
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS
JSCBEND3 EQU   JSCBSEC3+120
JSCRSV52 EQU   JSCBSEC3+116
JSCRSV51 EQU   JSCRSV47+1
JSCRSV50 EQU   JSCRSV47
JSCRSV49 EQU   JSCRSV46+1
JSCRSV48 EQU   JSCRSV46
JSCRSV44 EQU   JSCBSEC3+108
JSCRSV43 EQU   JSCBSEC3+104
JSCRSV42 EQU   JSCBSEC3+100
JSCRSV41 EQU   JSCRSV37+1
JSCRSV40 EQU   JSCRSV37
JSCRSV39 EQU   JSCRSV36+1
JSCRSV38 EQU   JSCRSV36
JSCBUFPT EQU   JSCBSEC3+92
JSCBACT  EQU   JSCBSEC3+88
JSCRSV33 EQU   JSCBSEC3+86
JSCDDNUM EQU   JSCBSEC3+84
JSCRSV53 EQU   JSCBSEC3+82
JSCDDNNO EQU   JSCBSEC3+80
JSCBVATA EQU   JSCBSEC3+76
JSCTMCOR EQU   JSCBSEC3+72
JSCSCTP  EQU   JSCSCT+1
JSCRSV55 EQU   JSCSCT
JSCRSV54 EQU   JSCBSEC3+64
JSCDSABQ EQU   JSCBSEC3+60
JSCBSSIB EQU   JSCBSEC3+56
JSCBFRBA EQU   JSCBSEC3+48
JSCRSV28 EQU   JSCBSEC3+46
JSCBSONO EQU   JSCBSEC3+44
JSCBSUBA EQU   JSCBSUB+1
JSCRSV31 EQU   JSCBSUB
JSCBSMLR EQU   JSCBSEC3+36
JSCBJNLR EQU   JSCBSEC3+32
JSCBJNLA EQU   JSCBJNL+1
JSCBJSBT EQU   JSCBJJSB
JSCBJSBX EQU   JSCBJJSB
JSCBJSBA EQU   JSCBJJSB
JSCBJSBI EQU   JSCBJJSB
@NM00006 EQU   JSCBJJSB
JSCBJNLE EQU   JSCBJJSB
JSCBJNLF EQU   JSCBJJSB
JSCBJNLN EQU   JSCBJJSB
@NM00005 EQU   JSCBSEC3+24
JSCBJRBA EQU   JSCBSEC3+16
JSCBIECB EQU   JSCBSEC3+12
JSCRSV25 EQU   JSCBSEC3+10
JSCBTJID EQU   JSCBASID
JSCBPSCB EQU   JSCBSEC3+4
JSCJCTP  EQU   JSCBJCTA
JSCRSV24 EQU   JSCBJCT
JSCBEND2 EQU   JSCBSEC2
@NM00001 EQU   PCCNTRLS
JSCBCSCB EQU   JSCBSEC1+68
JSCBPMG  EQU   JSCBWTP+2
JSCBWTSP EQU   JSCBWTP+1
JSCRSV23 EQU   JSCBWTFG
JSCRSV22 EQU   JSCBWTFG
JSCRSV21 EQU   JSCBWTFG
JSCRSV20 EQU   JSCBWTFG
JSCRSV19 EQU   JSCBWTFG
JSCRSV18 EQU   JSCBWTFG
JSCBRET  EQU   JSCBWTFG
JSCBIOFG EQU   JSCBWTFG
@NM00004 EQU   JSCBSEC1+60
JSCBQMPI EQU   JSCBSEC1+56
JSCBPMSG EQU   JSCBSWT1
JSCRSV16 EQU   JSCBSWT1
JSCRSV15 EQU   JSCBSWT1
JSCRSV14 EQU   JSCBSWT1
JSCRSV13 EQU   JSCBSWT1
JSCRSV12 EQU   JSCBSWT1
JSCRSV11 EQU   JSCBSWT1
JSCBPASS EQU   JSCBSWT1
JSCBTTTR EQU   JSCBSEC1+52
JSCRSV10 EQU   JSCBSEC1+49
JSCBAUTH EQU   JSCBOPTS
JSCSIOTS EQU   JSCBOPTS
JSCRSV08 EQU   JSCBOPTS
JSCRSV07 EQU   JSCBOPTS
JSCRSV06 EQU   JSCBOPTS
JSCBLONG EQU   JSCBOPTS
JSCRSV05 EQU   JSCBOPTS
JSCRSV04 EQU   JSCBOPTS
JSCBSECB EQU   JSCBSEC1+44
JSCRSV03 EQU   JSCBSEC1+41
JSCBSTEP EQU   JSCBSEC1+40
JSCBDCBA EQU   JSCBDCB+1
JSCRSV02 EQU   JSCBDCB
JSCBID   EQU   JSCBSEC1+32
JSCBDBTB EQU   JSCBSEC1+28
JSCBIJSC EQU   JSCBSEC1+24
JSCBTCBP EQU   JSCBSEC1+20
JSCBTCP  EQU   JSCBSEC1+12
JSCBSHR  EQU   JSCBSEC1+8
JSCHPCEA EQU   JSCHPCE+1
JSCRSV32 EQU   JSCHPCE
JSCRSV01 EQU   JSCBSEC1
@NM00003 EQU   IEZJSCB
PCCRSVD2 EQU   IEFPCCB+128
PCCLACBP EQU   IEFPCCB+124
PCCRSVD1 EQU   IEFPCCB+122
PCCSTAT4 EQU   PCCSTATS+3
PCCSTAT3 EQU   PCCSTATS+2
PCCSTAT2 EQU   PCCSTATS+1
@NM00002 EQU   PCCSTAT1
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS
@RC00143 EQU   @RC00137
@RC00151 EQU   @RC00150
@RC00129 EQU   @RC00128
@RF00224 EQU   @RC00045
@RC00205 EQU   @RC00045
@RC00165 EQU   @RC00129
@RC00191 EQU   @RC00165
@ENDDATA EQU   *
         END   IEFAB4EF,(C'PLS1607',0603,74361)

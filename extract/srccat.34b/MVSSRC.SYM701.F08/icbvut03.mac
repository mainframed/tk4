         TITLE 'ICBVUT03 - NULLIFYC SERVICE AID (JULY 1, 1975) MVS     *
                        '
ICBVUT03 CSECT ,                                                   0001
@MAINENT DS    0H                                                  0001
         USING *,@15                                               0001
         B     @PROLOG                                             0001
         DC    AL1(16)                                             0001
         DC    C'ICBVUT03  76.280'                                 0001
         DROP  @15
@PROLOG  STM   @14,@12,12(@13)                                     0001
         BALR  @12,0                                               0001
@PSTART  DS    0H                                                  0001
         USING @PSTART,@12                                         0001
         ST    @13,@SA00001+4                                      0001
         LA    @14,@SA00001                                        0001
         ST    @14,8(,@13)                                         0001
         LR    @13,@14                                             0001
*   RPLVPTR=RG1;                    /* SET RPLV ADDR         @Z40LB25*/
         LR    RPLVPTR,RG1                                         0091
*   RESPECIFY                                                      0092
*     RG1 UNRSTD;                   /* FREE REG1             @Z40LB25*/
*   VVIPTR=RPLVVICB;                /* ADDR TO MSVCB         @Z40LB25*/
         L     VVIPTR,RPLVVICB(,RPLVPTR)                           0093
*   GROUPPTR=ADDR(GROUPBUF);        /* ADDR GRP BUF          @Z40LB25*/
         LA    GROUPPTR,GROUPBUF                                   0094
*   NGVRPTR=ADDR(NGVRBUF);          /* ADDR NON-GRP BUF      @Z40LB25*/
         LA    NGVRPTR,NGVRBUF                                     0095
*   COPYVPTR=ADDR(COPYBUF);         /* ADDR CVR BUF          @Z40LB25*/
         LA    COPYVPTR,COPYBUF                                    0096
*   BASEVPTR=ADDR(BASEBUF);         /* ADDR BVR BUF          @Z40LB25*/
         LA    BASEVPTR,BASEBUF                                    0097
*   INDEXPTR=ADDR(INDEXBUF);        /* ADDR CIR BUF          @Z40LB25*/
         LA    INDEXPTR,INDEXBUF                                   0098
*   DUPVPTR=ADDR(DUPVBUF);          /* ADDR DUP BUF          @Z40LB25*/
         LA    DUPVPTR,DUPVBUF                                     0099
*   PTRRPLV=RPLVPTR;                /* RPLV PTR PARM         @Z40LB25*/
         ST    RPLVPTR,PTRRPLV                                     0100
*   PTRGROUP=GROUPPTR;              /* GHR PTR PARM          @Z40LB25*/
         ST    GROUPPTR,PTRGROUP                                   0101
*   PTRNGVR=NGVRPTR;                /* NGHR PTR PARM         @Z40LB25*/
         LR    PTRNGVR,NGVRPTR                                     0102
*   PTRCOPYV=COPYVPTR;              /* CVR PTR PARM          @Z40LB25*/
         ST    COPYVPTR,PTRCOPYV                                   0103
*   PTRBASEV=BASEVPTR;              /* BVR PTR PARM          @Z40LB25*/
         ST    BASEVPTR,PTRBASEV                                   0104
*   PTRDUPV=DUPVPTR;                /* DVR PTR PARM          @Z40LB25*/
         ST    DUPVPTR,PTRDUPV                                     0105
*   NULCPTR=ADDR(RPLVUTIL);         /* ADDR TO ICBNULLC      @Z40LB25*/
         LA    NULCPTR,RPLVUTIL(,RPLVPTR)                          0106
*   WORKAREA=WORKAREA&&WORKAREA;    /* ZERO WORK AREA        @Z40LB25*/
         XC    WORKAREA(19),WORKAREA                               0107
*   CIDKY=IDONE;                    /* CVR ID TO 1           @Z40LB25*/
         MVI   CIDKY,X'01'                                         0108
*   DIDKY=IDONE;                    /* DVR ID TO 1           @Z40LB25*/
*                                                                  0109
         MVI   DIDKY,X'01'                                         0109
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR AN MSC ERROR.                               @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0110
*   IF RPLRCODE^=OKZERO             /* CONTINUE?             @Z40LB25*/
*     THEN                          /* NO                    @Z40LB25*/
         LH    @15,RPLRCODE(,RPLVPTR)                              0110
         N     @15,@CF00613                                        0110
         LTR   @15,@15                                             0110
         BZ    @RF00110                                            0110
*     DO;                           /*                       @Z40LB25*/
*       RPLVRETC=RPLVRETC&&RPLVRETC;/* ZERO RETN CODE        @Z40LB25*/
         XC    RPLVRETC(2,RPLVPTR),RPLVRETC(RPLVPTR)               0112
*       RPLRCODE=RPLRCODE&&RPLRCODE;/* ZERO RESN CODE        @Z40LB25*/
         XC    RPLRCODE(2,RPLVPTR),RPLRCODE(RPLVPTR)               0113
*       RETURN;                     /*                       @Z40LB25*/
@EL00001 L     @13,4(,@13)                                         0114
@EF00001 DS    0H                                                  0114
@ER00001 LM    @14,@12,12(@13)                                     0114
         BR    @14                                                 0114
*     END;                          /*                       @Z40LB25*/
*                                                                  0115
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR THE MSVC BEING DISABLED.                    @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0116
*   IF VVIFLG0=ON                   /* MSVC DISABLED?        @Z40LB25*/
*     THEN                          /* YES                   @Z40LB25*/
@RF00110 TM    VVIFLG0(VVIPTR),B'10000000'                         0116
         BNO   @RF00116                                            0116
*     DO;                           /*                       @Z40LB25*/
*       RPLVRETC=RETNCD4;           /* 4 ERROR RETN CODE     @Z40LB25*/
         MVC   RPLVRETC(2,RPLVPTR),@CH00036                        0118
*       RPLRCODE=DISABLED;          /* 213 REASON CODE       @Z40LB25*/
         MVC   RPLRCODE(2,RPLVPTR),@CB00527                        0119
*       RETURN;                     /*                       @Z40LB25*/
         B     @EL00001                                            0120
*     END;                          /*                       @Z40LB25*/
*                                                                  0121
*   /*****************************************************************/
*   /*                                                               */
*   /* JOURNAL THE RPLV AND RESERVE THE INVENTORY.           @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0122
*   CALL HOUSKEEP;                  /* JRNL RPLV &           @Z40LB25
*                                      RESERVE .MSVI         @Z40LB25*/
*                                                                  0122
@RF00116 BAL   @14,HOUSKEEP                                        0122
*   /*****************************************************************/
*   /*                                                               */
*   /* GET THE MSVI RECORD - NONE IS OK.                     @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0123
*   IF NULVOL=ON                    /* ACTIVE?               @Z40LB25*/
*     THEN                          /* YES                   @Z40LB25*/
*                                                                  0123
         TM    NULVOL(NULCPTR),B'10000000'                         0123
         BNO   @RF00123                                            0123
*     /***************************************************************/
*     /*                                                             */
*     /* GET THE BVR - ACTIVE.                               @Z40LB25*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0124
*     DO;                           /*                       @Z40LB25*/
*       BVOLKY=NULVOLID;            /* SET VOLID             @Z40LB25*/
         MVC   BVOLKY(6),NULVOLID(NULCPTR)                         0125
*       RPLVKEY=ADDR(BKEY);         /* SET KEY ADDR          @Z40LB25*/
         LA    @09,BKEY                                            0126
         ST    @09,RPLVKEY(,RPLVPTR)                               0126
*       CALL READUPD1;              /* READ BVR              @Z40LB25*/
         BAL   @14,READUPD1                                        0127
*       IF RPLVRETC^=OKZERO         /* ERROR?                @Z40LB25*/
*         THEN                      /* YES                   @Z40LB25*/
         LH    @09,RPLVRETC(,RPLVPTR)                              0128
         N     @09,@CF00613                                        0128
         LTR   @09,@09                                             0128
         BZ    @RF00128                                            0128
*         DO;                       /* CK ERROR              @Z40LB25*/
*                                                                  0129
*           /*********************************************************/
*           /*                                                       */
*           /* NO RECORD FOUND IS OK.                        @Z40LB25*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  0130
*           IF RPLRCODE=NORECFND    /* NO RECD FND?          @Z40LB25*/
*             THEN                  /* YES                   @Z40LB25*/
         CLC   RPLRCODE(2,RPLVPTR),@CB00523                        0130
         BNE   @RF00130                                            0130
*             DO;                   /* OK                    @Z40LB25*/
*               RPLRCODE=RPLRCODE&&RPLRCODE;/*               @Z40LB25
*                                      ZERO RESN CODE        @Z40LB25*/
         XC    RPLRCODE(2,RPLVPTR),RPLRCODE(RPLVPTR)               0132
*               RPLVRETC=RPLVRETC&&RPLVRETC;/*               @Z40LB25
*                                      ZERO RETN CODE        @Z40LB25*/
         XC    RPLVRETC(2,RPLVPTR),RPLVRETC(RPLVPTR)               0133
*             END;                  /*                       @Z40LB25*/
*           RETURN;                 /*                       @Z40LB25*/
         B     @EL00001                                            0135
*         END;                      /*                       @Z40LB25*/
*       BASEBUF=TEMPBUF;            /* USE CORRECT BUF       @Z40LB25*/
@RF00128 MVC   BASEBUF(224),TEMPBUF                                0137
*     END;                          /*                       @Z40LB25*/
*   ELSE                            /* INACTIVE              @Z40LB25*/
*                                                                  0139
*     /***************************************************************/
*     /*                                                             */
*     /* GET THE BVR OR CVR OR DVR - INACTIVE.               @Z40LB25*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0139
*     DO;                           /*                       @Z40LB25*/
         B     @RC00123                                            0139
@RF00123 DS    0H                                                  0140
*       IVOLKY=NULCSN;              /* SET CSN               @Z40LB25*/
         MVC   IVOLKY(12),NULCSN(NULCPTR)                          0140
*       CALL GETRECUD;              /* GET RECORD            @Z40LB25*/
         BAL   @14,GETRECUD                                        0141
*       IF RPLVRETC^=OKZERO         /* ERROR?                @Z40LB25*/
*         THEN                      /* YES                   @Z40LB25*/
         LH    @09,RPLVRETC(,RPLVPTR)                              0142
         N     @09,@CF00613                                        0142
         LTR   @09,@09                                             0142
         BZ    @RF00142                                            0142
*         DO;                       /* CK ERROR              @Z40LB25*/
*                                                                  0143
*           /*********************************************************/
*           /*                                                       */
*           /* NO RECORD FOUND IS OK.                        @Z40LB25*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  0144
*           IF RPLRCODE=NORECFND    /* NO RECD FND?          @Z40LB25*/
*             THEN                  /* YES                   @Z40LB25*/
         CLC   RPLRCODE(2,RPLVPTR),@CB00523                        0144
         BNE   @RF00144                                            0144
*             DO;                   /* OK                    @Z40LB25*/
*               RPLRCODE=RPLRCODE&&RPLRCODE;/*               @Z40LB25
*                                      ZERO RESN CODE        @Z40LB25*/
         XC    RPLRCODE(2,RPLVPTR),RPLRCODE(RPLVPTR)               0146
*               RPLVRETC=RPLVRETC&&RPLVRETC;/*               @Z40LB25
*                                      ZERO RETN CODE        @Z40LB25*/
         XC    RPLVRETC(2,RPLVPTR),RPLVRETC(RPLVPTR)               0147
*             END;                  /*                       @Z40LB25*/
*           RETURN;                 /*                       @Z40LB25*/
         B     @EL00001                                            0149
*         END;                      /*                       @Z40LB25*/
*     END;                          /*                       @Z40LB25*/
@RF00142 DS    0H                                                  0152
*   BCDVPTR=BASEVPTR;               /* SET COMMON MAP        @Z40LB25
*                                      NEED FOR DELTCIRS     @Z40LB25*/
*                                                                  0152
@RC00123 LR    BCDVPTR,BASEVPTR                                    0152
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR AN ACTIVE BVR WITH NO COPIES.               @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0153
*   IF BASINAC=OFF&BCDBASE=ON&BASNCOPY=ZEROCOPY/*            @Z40LB25*/
*     THEN                          /*                       @Z40LB25*/
         TM    BASINAC(BASEVPTR),B'00000100'                       0153
         BNZ   @RF00153                                            0153
         TM    BCDBASE(BCDVPTR),B'00100000'                        0153
         BNO   @RF00153                                            0153
         CLI   BASNCOPY(BASEVPTR),0                                0153
         BNE   @RF00153                                            0153
*     DO;                           /*                       @Z40LB25*/
*       CALL ELMACTV;               /* ELIM ACT VOL          @Z40LB25*/
         BAL   @14,ELMACTV                                         0155
*       RETURN;                     /*                       @Z40LB25*/
         B     @EL00001                                            0156
*     END;                          /*                       @Z40LB25*/
*                                                                  0157
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR AN INACTIVE BVR WITH NO COPIES OR           @Z40LB25*/
*   /* A CVR OR A DVR.                                       @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0158
*   IF(BASINAC=ON&BCDBASE=ON&BASNCOPY=ZEROCOPY)×BCDDUP=ON×BCDCOPY=ON
*     THEN                          /*                       @Z40LB25*/
@RF00153 TM    BASINAC(BASEVPTR),B'00000100'                       0158
         BNO   @GL00003                                            0158
         TM    BCDBASE(BCDVPTR),B'00100000'                        0158
         BNO   @GL00003                                            0158
         CLI   BASNCOPY(BASEVPTR),0                                0158
         BE    @RT00158                                            0158
@GL00003 TM    BCDDUP(BCDVPTR),B'00010100'                         0158
         BZ    @RF00158                                            0158
@RT00158 DS    0H                                                  0159
*     DO;                           /*                       @Z40LB25*/
*       CALL ELINACV;               /* ELIM INACT VOL        @Z40LB25*/
         BAL   @14,ELINACV                                         0160
*       RETURN;                     /*                       @Z40LB25*/
         B     @EL00001                                            0161
*     END;                          /*                       @Z40LB25*/
*                                                                  0162
*   /*****************************************************************/
*   /*                                                               */
*   /* THE BVR HAS CVR(S). IF THE BVR                        @Z40LB25*/
*   /* WERE TO BE DELETED, THEN CVR(S) WILL                  @Z40LB25*/
*   /* EXIST WHICH HAS NO BVR - A DESIGN VIOLATION.          @Z40LB25*/
*   /* IF THE BVR IS ACTIVE, IT MUST BE MADE                 @Z40LB25*/
*   /* INACTIVE. SET THE REASSIGNED FLAG IN                  @Z40LB25*/
*   /* BVR ON AND WRITE THE BVR. ALSO, DELETE                @Z40LB25*/
*   /* BVR'S CIRS.                                           @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0163
*   CALL REASNBVR;                  /* CSNS REASSIGNED       @Z40LB25*/
@RF00158 BAL   @14,REASNBVR                                        0163
*   RETURN;                         /*                       @Z40LB25*/
         B     @EL00001                                            0164
*                                                                  0165
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - ELMACTV                              @Z40LB25*/
*   /*                                                       @Z40LB25*/
*   /* FUNCTION -                                            @Z40LB25*/
*   /* PROCESS THE ELIMINATION OF AN ACTIVE VOLUME.          @Z40LB25*/
*   /* DELETE THE BVR AND ITS CIRS. IF THE BVR               @Z40LB25*/
*   /* WAS GROUPED, ITS GROUP HEADER IS UPDATED.             @Z40LB25*/
*   /* IF IT WAS GROUPED GENERAL-USE, ITS GROUP              @Z40LB25*/
*   /* VOLUME SERIAL EXTENSION RECORD IS UPDATED.            @Z40LB25*/
*   /* IF THE DELETED BVR HAS A DVR, THIS DVR IS             @Z40LB25*/
*   /* MADE INTO A BVR TO REPLACE THE DELETED BVR.           @Z40LB25*/
*   /*                                                       @Z40LB25*/
*   /* INPUT -                                               @Z40LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Z40LB25*/
*   /* BASE VOLUME RECORD                                    @Z40LB25*/
*   /*                                                       @Z40LB25*/
*   /* OUTPUT -                                              @Z40LB25*/
*   /* MSVC REQUEST PARAMETER - RETURN CODE IF               @Z40LB25*/
*   /* AN ERROR                                              @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0165
*ELMACTV:                           /*                       @Z40LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @Z40LB25*/
*                                                                  0165
ELMACTV  ST    @14,@SA00002                                        0165
*   /*****************************************************************/
*   /*                                                               */
*   /* DELETE THE BVR IN TEMPBUF                             @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0166
*   RPLVTYP=RPLVDEL;                /* DELETE                @Z40LB25*/
         MVI   RPLVTYP(RPLVPTR),X'05'                              0166
*   RESPECIFY                                                      0167
*     RG1 RSTD;                     /* RESTRICT REG 1        @Z40LB25*/
*   RG1=RPLVPTR;                    /* RPLV PTR              @Z40LB25*/
         LR    RG1,RPLVPTR                                         0168
*   CALL ICBVIO00;                  /* DELETE BVR OR CVR     @Z40LB25*/
         L     @15,@CV00537                                        0169
         BALR  @14,@15                                             0169
*   RESPECIFY                                                      0170
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Z40LB25*/
*   IF RPLVRETC^=OKZERO             /* ERROR?                @Z40LB25*/
*     THEN                          /* YES                   @Z40LB25*/
         LH    @09,RPLVRETC(,RPLVPTR)                              0171
         N     @09,@CF00613                                        0171
         LTR   @09,@09                                             0171
         BNZ   @RT00171                                            0171
*     RETURN;                       /*                       @Z40LB25*/
*                                                                  0172
*   /*****************************************************************/
*   /*                                                               */
*   /* DELETE THE CIRS.                                      @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0173
*   CALL DELTCIRS;                  /* DELT CIRS             @Z40LB25*/
*                                                                  0173
         BAL   @14,DELTCIRS                                        0173
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK IF GHR NEEDS PROCESSING.                        @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0174
*   IF BASGRPV=ON                   /* BVR GROUPED?          @Z40LB25*/
*     THEN                          /* YES                   @Z40LB25*/
         TM    BASGRPV(BASEVPTR),B'00100000'                       0174
         BNO   @RF00174                                            0174
*     DO;                           /*                       @Z40LB25*/
*                                                                  0175
*       /*************************************************************/
*       /*                                                           */
*       /* DECREMENT EITHER THE NUMBER OF GENERAL-USE        @Z40LB25*/
*       /* OR THE NUMBER OF RESTRICTED VOLUMES KEPT IN       @Z40LB25*/
*       /* THE GROUP HEADER RECORD. DECREMENT SPACE          @Z40LB25*/
*       /* COUNT IN THE GROUP RECORD.                        @Z40LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0176
*       GROUPKY=BASGROUP;           /* SET GROUP NAME        @Z40LB25*/
         MVC   GROUPKY(8),BASGROUP(BASEVPTR)                       0176
*       RPLVKEY=ADDR(GKEY);         /* SET KEY ADDR          @Z40LB25*/
         LA    @09,GKEY                                            0177
         ST    @09,RPLVKEY(,RPLVPTR)                               0177
*       CALL READUPD1;              /* READ GHR              @Z40LB25*/
         BAL   @14,READUPD1                                        0178
*       IF RPLVRETC^=OKZERO         /* ERROR?                @Z40LB25*/
*         THEN                      /* YES                   @Z40LB25*/
         LH    @09,RPLVRETC(,RPLVPTR)                              0179
         N     @09,@CF00613                                        0179
         LTR   @09,@09                                             0179
         BNZ   @RT00179                                            0179
*         RETURN;                   /*                       @Z40LB25*/
*                                                                  0180
*       /*************************************************************/
*       /*                                                           */
*       /* DECREMENT TYPE OF VOLUME COUNT.                   @Z40LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0181
*       GROUPBUF=TEMPBUF;           /* USE CORRECT BUF       @Z40LB25*/
         MVC   GROUPBUF(164),TEMPBUF                               0181
*       IF BASGENUS=ON              /* GENERAL-USE?          @Z40LB25*/
*         THEN                      /* YES                   @Z40LB25*/
         TM    BASGENUS(BASEVPTR),B'00010000'                      0182
         BNO   @RF00182                                            0182
*         DO;                       /*                       @Z40LB25*/
*           GRONGEN=GRONGEN-DECONE; /* DEC # GEN-USE         @Z40LB25*/
*                                                                  0184
         LH    @09,GRONGEN(,GROUPPTR)                              0184
         BCTR  @09,0                                               0184
         STH   @09,GRONGEN(,GROUPPTR)                              0184
*           /*********************************************************/
*           /*                                                       */
*           /* UPDATE THE GHR.                               @Z40LB25*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  0185
*           ADDSUBGR=OFF;           /* BVR DELETED           @Z40LB25*/
         NI    ADDSUBGR,B'11110111'                                0185
*           CALL ICBVUPGH(PTRGROUP,PTRBASEV,PASSBYTE);/*     @Z40LB25
*                                      UPDATE GHR            @Z40LB25*/
         L     @15,@CV00545                                        0186
         LA    @01,@AL00186                                        0186
         BALR  @14,@15                                             0186
*         END;                      /*                       @Z40LB25*/
*       ELSE                        /* RESTRICTED            @Z40LB25*/
*         IF BASRSTD=ON             /* RESTRICTED?           @Z40LB25*/
*           THEN                    /* YES                   @Z40LB25*/
         B     @RC00182                                            0188
@RF00182 TM    BASRSTD(BASEVPTR),B'00001000'                       0188
         BNO   @RF00188                                            0188
*           GRONRSTD=GRONRSTD-DECONE;/*                      @Z40LB25
*                                      DEC # RESTD VOLS      @Z40LB25*/
         LH    @09,GRONRSTD(,GROUPPTR)                             0189
         BCTR  @09,0                                               0189
         STH   @09,GRONRSTD(,GROUPPTR)                             0189
*     END;                          /*                       @Z40LB25*/
*                                                                  0190
@RF00188 DS    0H                                                  0190
@RC00182 DS    0H                                                  0191
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCESS THE OTHER MSVI RECORDS ASSOCIATED             @Z40LB25*/
*   /* WITH THIS BVR.                                        @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0191
*   CALL PROCBVR;                   /* PROCESS BVR           @Z40LB25*/
@RF00174 BAL   @14,PROCBVR                                         0191
*   RETURN;                         /*                       @Z40LB25*/
@EL00002 DS    0H                                                  0192
@EF00002 DS    0H                                                  0192
@ER00002 L     @14,@SA00002                                        0192
         BR    @14                                                 0192
*   END ELMACTV;                    /*                       @Z40LB25*/
         B     @EL00002                                            0193
*                                                                  0194
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - ELINACV                              @Z40LB25*/
*   /*                                                       @Z40LB25*/
*   /* FUNCTION -                                            @Z40LB25*/
*   /* PROCESS THE ELIMINATION OF AN INACTIVE VOLUME.        @Z40LB25*/
*   /* DELETE THE BVR OR CVR OR DVR AND ITS CIRS.            @Z40LB25*/
*   /* FOR A DELETED GROUPED BVR, UPDATE ITS GROUPED         @Z40LB25*/
*   /* HEADER RECORD. FOR A DELETE NON-GROUPED BVR,          @Z40LB25*/
*   /* UPDATE ITS NON-GROUPED HEADER RECORD. IF THE          @Z40LB25*/
*   /* DELETED BVR HAS A DVR, MAKE THE DVR INTO A BVR        @Z40LB25*/
*   /* FOR THE DELETED BVR. FOR A DELETED CVR, ITS           @Z40LB25*/
*   /* BVR MUST BE UPDATED.                                  @Z40LB25*/
*   /*                                                       @Z40LB25*/
*   /* INPUT -                                               @Z40LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Z40LB25*/
*   /* BASE OR COPY OR DUPLICATE VOLUME RECORD               @Z40LB25*/
*   /*                                                       @Z40LB25*/
*   /* OUTPUT -                                              @Z40LB25*/
*   /* MSVC REQUEST PARAMETER - RETURN CODE IF               @Z40LB25*/
*   /* AN ERROR                                              @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0194
*ELINACV:                           /*                       @Z40LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @Z40LB25*/
*                                                                  0194
ELINACV  ST    @14,@SA00003                                        0194
*   /*****************************************************************/
*   /*                                                               */
*   /* DELETE THE CVR OR BVR OR DVR IN TEMPBUF.              @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0195
*   RPLVTYP=RPLVDEL;                /* DELETE                @Z40LB25*/
         MVI   RPLVTYP(RPLVPTR),X'05'                              0195
*   RESPECIFY                                                      0196
*     RG1 RSTD;                     /* RESTRICT REG 1        @Z40LB25*/
*   RG1=RPLVPTR;                    /* RPLV PTR              @Z40LB25*/
         LR    RG1,RPLVPTR                                         0197
*   CALL ICBVIO00;                  /* DELETE BVR OR CVR     @Z40LB25*/
         L     @15,@CV00537                                        0198
         BALR  @14,@15                                             0198
*   RESPECIFY                                                      0199
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Z40LB25*/
*   IF RPLVRETC^=OKZERO             /* ERROR?                @Z40LB25*/
*     THEN                          /* YES                   @Z40LB25*/
         LH    @09,RPLVRETC(,RPLVPTR)                              0200
         N     @09,@CF00613                                        0200
         LTR   @09,@09                                             0200
         BNZ   @RT00200                                            0200
*     RETURN;                       /*                       @Z40LB25*/
*                                                                  0201
*   /*****************************************************************/
*   /*                                                               */
*   /* DELETE THEIR CIRS.                                    @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0202
*   CALL DELTCIRS;                  /* DELT CIRS             @Z40LB25*/
*                                                                  0202
         BAL   @14,DELTCIRS                                        0202
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR A DVR.                                      @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0203
*   IF BCDDUP=ON                    /* DVR?                  @Z40LB25*/
*     THEN                          /* YES                   @Z40LB25*/
         TM    BCDDUP(BCDVPTR),B'00000100'                         0203
         BO    @RT00203                                            0203
*     RETURN;                       /*                       @Z40LB25*/
*                                                                  0204
*   /*****************************************************************/
*   /*                                                               */
*   /* CKECK FOR A BASE VOLUME RECORD.                       @Z40LB25*/
*   /* UPDATE ITS GHR OR NGHR.                               @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0205
*   IF BCDBASE=ON                   /* BVR?                  @Z40LB25*/
*     THEN                          /* YES                   @Z40LB25*/
         TM    BCDBASE(BCDVPTR),B'00100000'                        0205
         BNO   @RF00205                                            0205
*     DO;                           /*                       @Z40LB25*/
*       IF BASGRPV=ON               /* GROUPED BVR?          @Z40LB25*/
*         THEN                      /* YES                   @Z40LB25*/
         TM    BASGRPV(BASEVPTR),B'00100000'                       0207
         BNO   @RF00207                                            0207
*         DO;                       /*                       @Z40LB25*/
*           GROUPKY=BASGROUP;       /* SET GROUP NAME        @Z40LB25*/
         MVC   GROUPKY(8),BASGROUP(BASEVPTR)                       0209
*           RPLVKEY=ADDR(GKEY);     /* SET KEY ADDR          @Z40LB25*/
         LA    @09,GKEY                                            0210
         ST    @09,RPLVKEY(,RPLVPTR)                               0210
*           CALL READUPD1;          /* READ GHR              @Z40LB25*/
         BAL   @14,READUPD1                                        0211
*           IF RPLVRETC^=OKZERO     /* ERROR?                @Z40LB25*/
*             THEN                  /* YES                   @Z40LB25*/
         LH    @09,RPLVRETC(,RPLVPTR)                              0212
         N     @09,@CF00613                                        0212
         LTR   @09,@09                                             0212
         BNZ   @RT00212                                            0212
*             RETURN;               /*                       @Z40LB25*/
*           GROUPBUF=TEMPBUF;       /* USE CORRECT BUF       @Z40LB25*/
         MVC   GROUPBUF(164),TEMPBUF                               0214
*           GRONINAC=GRONINAC-DECONE;/* DECREM INAC VOLS     @Z40LB25*/
         LH    @09,GRONINAC(,GROUPPTR)                             0215
         BCTR  @09,0                                               0215
         STH   @09,GRONINAC(,GROUPPTR)                             0215
*         END;                      /*                       @Z40LB25*/
*                                                                  0216
*       /*************************************************************/
*       /*                                                           */
*       /* PROCESS THE OTHER MSVI RECORDS ASSOCIATED         @Z40LB25*/
*       /* WITH THIS BVR.                                    @Z40LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0217
*       CALL PROCBVR;               /* PROCESS THE BVR       @Z40LB25*/
@RF00207 BAL   @14,PROCBVR                                         0217
*     END;                          /*                       @Z40LB25*/
*                                                                  0218
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR A DELETED COPY VOLUME RECORD                @Z40LB25*/
*   /* IF PRESENT, THEN UPDATE THE CVR'S BVR TO REFLECT      @Z40LB25*/
*   /* THE DELETION OF THE CVR.                              @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0219
*   IF BCDCOPY=ON                   /* CVR?                  @Z40LB25*/
*     THEN                          /* YES                   @Z40LB25*/
@RF00205 TM    BCDCOPY(BCDVPTR),B'00010000'                        0219
         BNO   @RF00219                                            0219
*     DO;                           /*                       @Z40LB25*/
*       COPYBUF=BASEBUF;            /* CVR TO CVR BUF        @Z40LB25*/
         MVC   COPYBUF(164),BASEBUF                                0221
*       ADDSUB=OFF;                 /* DELETED CVR           @Z40LB25*/
         NI    ADDSUB,B'10111111'                                  0222
*       CALL ICBVUBVR(PTRCOPYV,PTRRPLV,PASSBYTE);/*          @Z40LB25
*                                      UPDATE CVR'S BVR      @Z40LB25*/
         L     @15,@CV00542                                        0223
         LA    @01,@AL00223                                        0223
         BALR  @14,@15                                             0223
*     END;                          /*                       @Z40LB25*/
*   RETURN;                         /*                       @Z40LB25*/
@EL00003 DS    0H                                                  0225
@EF00003 DS    0H                                                  0225
@ER00003 L     @14,@SA00003                                        0225
         BR    @14                                                 0225
*   END ELINACV;                    /*                       @Z40LB25*/
         B     @EL00003                                            0226
*                                                                  0227
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - REASNBVR                             @Z40LB25*/
*   /*                                                       @Z40LB25*/
*   /* FUNCTION -                                            @Z40LB25*/
*   /* A BVR HAS CVR(S), THEREFORE IT CAN NOT BE DELETED.    @Z40LB25*/
*   /* ITS CARTRIDGES WILL BE REASSIGNED, THEREFORE ITS      @Z40LB25*/
*   /* CIRS MUST BE DELETED. THE BVR WILL BE KEPT, BUT       @Z40LB25*/
*   /* IT WILL INDICATE CARTRIDGES ARE REASSIGNED AND        @Z40LB25*/
*   /* BE INACTIVE.                                          @Z40LB25*/
*   /*                                                       @Z40LB25*/
*   /* INPUT -                                               @Z40LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Z40LB25*/
*   /* BASE VOLUME RECORD                                    @Z40LB25*/
*   /*                                                       @Z40LB25*/
*   /* OUTPUT -                                              @Z40LB25*/
*   /* BASE VOLUME RECORD                                    @Z40LB25*/
*   /* MSVC REQUEST PARAMETER - RETURN CODE IF               @Z40LB25*/
*   /* AN ERROR                                              @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0227
*REASNBVR:                          /*                       @Z40LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @Z40LB25*/
*                                                                  0227
REASNBVR ST    @14,@SA00004                                        0227
*   /*****************************************************************/
*   /*                                                               */
*   /* THE BVR MUST BE INACTIVE TO HAVE ITS CARTRIDGES       @Z40LB25*/
*   /* REASSIGNED.                                           @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0228
*   IF BASINAC=OFF                  /* ACTIVE?               @Z40LB25*/
*     THEN                          /* YES                   @Z40LB25*/
         TM    BASINAC(BASEVPTR),B'00000100'                       0228
         BNZ   @RF00228                                            0228
*     DO;                           /*                       @Z40LB25*/
*       CALL DEACTV;                /* DACT VOL              @Z40LB25*/
         BAL   @14,DEACTV                                          0230
*       IF RPLRCODE=IOERROR         /* I/O ERROR?            @Z40LB25*/
*         THEN                      /* YES                   @Z40LB25*/
         CLC   RPLRCODE(2,RPLVPTR),@CB00525                        0231
         BE    @RT00231                                            0231
*         RETURN;                   /*                       @Z40LB25*/
*                                                                  0232
*       /*************************************************************/
*       /*                                                           */
*       /* SAVE THE RETURN/REASON IN CASE THE                @Z40LB25*/
*       /* GHR OR GHSNER COULD NOT BE FOUND.                 @Z40LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0233
*       RETCODE=RPLVRETC;           /* SAVE RETN CODE        @Z40LB25*/
         MVC   RETCODE(2),RPLVRETC(RPLVPTR)                        0233
*       REACODE=RPLRCODE;           /* SAVE RESN CODE        @Z40LB25*/
*                                                                  0234
         MVC   REACODE(2),RPLRCODE(RPLVPTR)                        0234
*       /*************************************************************/
*       /*                                                           */
*       /* REESTABLISH BVR RPL.                              @Z40LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0235
*       BVOLKY=BASSERNO;            /* RESET VOLID           @Z40LB25*/
         MVC   BVOLKY(6),BASSERNO(BASEVPTR)                        0235
*       RPLVKEY=ADDR(BKEY);         /* SET KEY ADDR          @Z40LB25*/
         LA    @03,BKEY                                            0236
         ST    @03,RPLVKEY(,RPLVPTR)                               0236
*       CALL READUPD1;              /* READ BVR              @Z40LB25*/
         BAL   @14,READUPD1                                        0237
*       IF RPLVRETC^=OKZERO         /* ERROR?                @Z40LB25*/
*         THEN                      /* YES                   @Z40LB25*/
         LH    @03,RPLVRETC(,RPLVPTR)                              0238
         N     @03,@CF00613                                        0238
         LTR   @03,@03                                             0238
         BNZ   @RT00238                                            0238
*         RETURN;                   /*                       @Z40LB25*/
*     END;                          /*                       @Z40LB25*/
*                                                                  0240
*   /*****************************************************************/
*   /*                                                               */
*   /* INDICATE THE CARTRIDGES ARE REASSIGNED AND            @Z40LB25*/
*   /* NOT IN THE LIBRARY.                                   @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0241
*   BASREASS=ON;                    /* REASSIGNED            @Z40LB25*/
@RF00228 OI    BASREASS(BASEVPTR),B'00100000'                      0241
*   BASLIB1=NULLIB1F;               /* NULL LIB ID 1         @Z40LB25*/
         MVI   BASLIB1(BASEVPTR),X'FF'                             0242
*   BASLIB2=NULLIB1F;               /* NULL LIB ID 2         @Z40LB25*/
*                                                                  0243
         MVI   BASLIB2(BASEVPTR),X'FF'                             0243
*   /*****************************************************************/
*   /*                                                               */
*   /* WRITE THE BVR.                                        @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0244
*   RPLVBUF=ADDR(BASEBUF);          /* BUFF ADDR             @Z40LB25*/
         LA    @05,BASEBUF                                         0244
         ST    @05,RPLVBUF(,RPLVPTR)                               0244
*   CALL WRITRECD;                  /* WRITE BVR             @Z40LB25*/
         BAL   @14,WRITRECD                                        0245
*   IF RPLVRETC^=OKZERO             /* ERROR?                @Z40LB25*/
*     THEN                          /* YES                   @Z40LB25*/
         LH    @05,RPLVRETC(,RPLVPTR)                              0246
         N     @05,@CF00613                                        0246
         LTR   @05,@05                                             0246
         BNZ   @RT00246                                            0246
*     RETURN;                       /*                       @Z40LB25*/
*                                                                  0247
*   /*****************************************************************/
*   /*                                                               */
*   /* DELETE THE CIRS FOR THE BVR.                          @Z40LB25*/
*   /* ZERO RETURN/REASON CODES ARE RETURNED.                @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0248
*   CALL DELTCIRS;                  /* DELETE CIRS           @Z40LB25*/
*                                                                  0248
         BAL   @14,DELTCIRS                                        0248
*   /*****************************************************************/
*   /*                                                               */
*   /* RESTORE RETURN/REASON CODES IN CASE DEACTV            @Z40LB25*/
*   /* WAS CALLED. DEACTV NOT CALLED - RETCODE AND           @Z40LB25*/
*   /* REACODE ARE ZEROED IN WORKAREA.                       @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0249
*   RPLVRETC=RETCODE;               /* RESET RETN CODE       @Z40LB25*/
         MVC   RPLVRETC(2,RPLVPTR),RETCODE                         0249
*   RPLRCODE=REACODE;               /* RESET RESN CODE       @Z40LB25*/
         MVC   RPLRCODE(2,RPLVPTR),REACODE                         0250
*   RETURN;                         /*                       @Z40LB25*/
@EL00004 DS    0H                                                  0251
@EF00004 DS    0H                                                  0251
@ER00004 L     @14,@SA00004                                        0251
         BR    @14                                                 0251
*   END REASNBVR;                   /*                       @Z40LB25*/
         B     @EL00004                                            0252
*                                                                  0253
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - DEACTV                               @Z40LB25*/
*   /*                                                       @Z40LB25*/
*   /* FUNCTION -                                            @Z40LB25*/
*   /* PROCESS THE DEACTIVATION OF AN ACTIVE VOLUME.         @Z40LB25*/
*   /* IF THE BVR IS GROUPED, UPDATE ITS GROUP HEADER        @Z40LB25*/
*   /* RECORD. IF THE BVR IS GROUPED GENERAL-USE, UPDATE     @Z40LB25*/
*   /* ITS GROUP VOLUME SERIAL EXTENSION RECORD.             @Z40LB25*/
*   /*                                                       @Z40LB25*/
*   /* INPUT -                                               @Z40LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Z40LB25*/
*   /* BASE VOLUME RECORD                                    @Z40LB25*/
*   /*                                                       @Z40LB25*/
*   /* OUTPUT -                                              @Z40LB25*/
*   /* MSVC REQUEST PARAMETER - RETURN CODE IF               @Z40LB25*/
*   /* AN ERROR                                              @Z40LB25*/
*   /* BASE VOLUME RECORD                                    @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0253
*DEACTV:                            /*                       @Z40LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @Z40LB25*/
*                                                                  0253
DEACTV   ST    @14,@SA00005                                        0253
*   /*****************************************************************/
*   /*                                                               */
*   /* MAKE BVR REFLECT INACTIVE VOLUME.                     @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0254
*   BASINAC=ON;                     /* MAKE INACTIVE         @Z40LB25*/
         OI    BASINAC(BASEVPTR),B'00000100'                       0254
*   BASEXPDT=NULEXP4F;              /* NULL EXPIR DATE       @Z40LB25*/
*                                                                  0255
         MVC   BASEXPDT(4,BASEVPTR),@CB00521                       0255
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK IF VOLUME IS GROUPED.                           @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0256
*   IF BASGRPV=ON                   /* GROUPED?              @Z40LB25*/
*     THEN                          /* YES                   @Z40LB25*/
         TM    BASGRPV(BASEVPTR),B'00100000'                       0256
         BNO   @RF00256                                            0256
*     DO;                           /*                       @Z40LB25*/
*                                                                  0257
*       /*************************************************************/
*       /*                                                           */
*       /* GET AND UPDATE THE GROUP HEADER RECORD.           @Z40LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0258
*       GROUPKY=BASGROUP;           /* SET GROUP NAME        @Z40LB25*/
         MVC   GROUPKY(8),BASGROUP(BASEVPTR)                       0258
*       RPLVKEY=ADDR(GKEY);         /* ADDR OF KEY           @Z40LB25*/
         LA    @07,GKEY                                            0259
         ST    @07,RPLVKEY(,RPLVPTR)                               0259
*       CALL READUPD1;              /* READ GHR              @Z40LB25*/
         BAL   @14,READUPD1                                        0260
*       IF RPLVRETC^=OKZERO         /* ERROR?                @Z40LB25*/
*         THEN                      /* YES                   @Z40LB25*/
         LH    @07,RPLVRETC(,RPLVPTR)                              0261
         N     @07,@CF00613                                        0261
         LTR   @07,@07                                             0261
         BNZ   @RT00261                                            0261
*         RETURN;                   /*                       @Z40LB25*/
*       GROUPBUF=TEMPBUF;           /* USE CORRECT BUFF      @Z40LB25*/
         MVC   GROUPBUF(164),TEMPBUF                               0263
*       GRONINAC=GRONINAC+INCONE;   /* INCR # INACT VOLS     @Z40LB25*/
         LA    @07,1                                               0264
         AH    @07,GRONINAC(,GROUPPTR)                             0264
         STH   @07,GRONINAC(,GROUPPTR)                             0264
*       IF BASRSTD=ON               /* RESTRICTED?           @Z40LB25*/
*         THEN                      /* YES                   @Z40LB25*/
         TM    BASRSTD(BASEVPTR),B'00001000'                       0265
         BNO   @RF00265                                            0265
*         GRONRSTD=GRONRSTD-DECONE; /*                       @Z40LB25
*                                      DECR # RSTD VOLS      @Z40LB25*/
         LH    @07,GRONRSTD(,GROUPPTR)                             0266
         BCTR  @07,0                                               0266
         STH   @07,GRONRSTD(,GROUPPTR)                             0266
*       ELSE                        /* CK GEN-USE            @Z40LB25*/
*         IF BASGENUS=ON            /* GENERAL-USE?          @Z40LB25*/
*           THEN                    /* YES                   @Z40LB25*/
         B     @RC00265                                            0267
@RF00265 TM    BASGENUS(BASEVPTR),B'00010000'                      0267
         BNO   @RF00267                                            0267
*           DO;                     /*                       @Z40LB25*/
*             GRONGEN=GRONGEN-DECONE;/*                      @Z40LB25
*                                      DECR # G-USE VOLS     @Z40LB25*/
*                                                                  0269
         LH    @07,GRONGEN(,GROUPPTR)                              0269
         BCTR  @07,0                                               0269
         STH   @07,GRONGEN(,GROUPPTR)                              0269
*             /*******************************************************/
*             /*                                                     */
*             /* PROCESS GROUP HEADER RECORD.                @Z40LB25*/
*             /*                                                     */
*             /*******************************************************/
*                                                                  0270
*             ADDSUBGR=OFF;         /* SUBTRACT              @Z40LB25*/
         NI    ADDSUBGR,B'11110111'                                0270
*             CALL ICBVUPGH(PTRGROUP,PTRBASEV,PASSBYTE);/*   @Z40LB25
*                                      UPDATE THE GHR        @Z40LB25*/
         L     @15,@CV00545                                        0271
         LA    @01,@AL00271                                        0271
         BALR  @14,@15                                             0271
*           END;                    /*                       @Z40LB25*/
*                                                                  0272
*       /*************************************************************/
*       /*                                                           */
*       /* WRITE THE GHR.                                    @Z40LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0273
*       RPLVBUF=ADDR(GROUPBUF);     /* GHR BUF ADDR          @Z40LB25*/
@RF00267 DS    0H                                                  0273
@RC00265 LA    @03,GROUPBUF                                        0273
         ST    @03,RPLVBUF(,RPLVPTR)                               0273
*       CALL WRITRECD;              /* WRITE GHR             @Z40LB25*/
         BAL   @14,WRITRECD                                        0274
*       IF RPLVRETC^=OKZERO         /* ERROR?                @Z40LB25*/
*         THEN                      /* YES                   @Z40LB25*/
         LH    @03,RPLVRETC(,RPLVPTR)                              0275
         N     @03,@CF00613                                        0275
         LTR   @03,@03                                             0275
         BNZ   @RT00275                                            0275
*         RETURN;                   /*                       @Z40LB25*/
*                                                                  0276
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK FOR GENERAL-USE.                            @Z40LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0277
*       IF BASGENUS=ON              /* GENERAL-USE?          @Z40LB25*/
*         THEN                      /* YES                   @Z40LB25*/
*                                                                  0277
         TM    BASGENUS(BASEVPTR),B'00010000'                      0277
         BNO   @RF00277                                            0277
*         /***********************************************************/
*         /*                                                         */
*         /* DELETE A GROUP VOLUME SERIAL NUMBER             @Z40LB25*/
*         /* EXTENSION SLOT.                                 @Z40LB25*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  0278
*         DO;                       /*                       @Z40LB25*/
*           EXPSLOT=OFF;            /* NO EXPIR DATE         @Z40LB25*/
         NI    EXPSLOT,B'01111111'                                 0279
*           ADDSUBSL=OFF;           /* DELETE                @Z40LB25*/
         NI    ADDSUBSL,B'11111101'                                0280
*           CALL ICBVUEXT(PTRGROUP,PTRBASEV,PTRRPLV,PASSBYTE);/*   0281
*                                                            @Z40LB25
*                                      DELETE A SLOT         @Z40LB25*/
         L     @15,@CV00541                                        0281
         LA    @01,@AL00281                                        0281
         BALR  @14,@15                                             0281
*         END;                      /*                       @Z40LB25*/
*     END;                          /*                       @Z40LB25*/
*   RETURN;                         /*                       @Z40LB25*/
@EL00005 DS    0H                                                  0284
@EF00005 DS    0H                                                  0284
@ER00005 L     @14,@SA00005                                        0284
         BR    @14                                                 0284
*   END DEACTV;                     /*                       @Z40LB25*/
         B     @EL00005                                            0285
*                                                                  0286
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - DELTCIRS                             @Z40LB25*/
*   /*                                                       @Z40LB25*/
*   /* FUNCTION -                                            @Z40LB25*/
*   /* ELIMINATE TWO CARTRIDGE INDEX RECORDS (CIR).          @Z40LB25*/
*   /*                                                       @Z40LB25*/
*   /* INPUT -                                               @Z40LB25*/
*   /* BASE OR COPY OR DUPLICATE VOLUME RECORD               @Z40LB25*/
*   /* POINTED TO BY BCDVPTR                                 @Z40LB25*/
*   /*                                                       @Z40LB25*/
*   /* OUTPUT -                                              @Z40LB25*/
*   /* NONE                                                  @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0286
*DELTCIRS:                          /*                       @Z40LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @Z40LB25*/
*                                                                  0286
DELTCIRS ST    @14,@SA00006                                        0286
*   /*****************************************************************/
*   /*                                                               */
*   /* DELETE THE CIR FOR CSN1.                              @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0287
*   IVOLKY=BCDCSN1;                 /* SET CSN1 IN CIR       @Z40LB25*/
         MVC   IVOLKY(12),BCDCSN1(BCDVPTR)                         0287
*   RPLVKEY=ADDR(IKEY);             /* SET CIR KEY ADDR      @Z40LB25*/
         LA    @09,IKEY                                            0288
         ST    @09,RPLVKEY(,RPLVPTR)                               0288
*   RPLVBUF=ADDR(INDEXBUF);         /* SET BUF ADDR          @Z40LB25*/
         LA    @09,INDEXBUF                                        0289
         ST    @09,RPLVBUF(,RPLVPTR)                               0289
*   RPLVBLN=LENGTH(INDEXBUF);       /* SET BUFF LENGTH       @Z40LB25*/
         MVC   RPLVBLN(4,RPLVPTR),@CF00607                         0290
*   CALL DELTRECD;                  /* GET & DELETE CIR      @Z40LB25*/
         BAL   @14,DELTRECD                                        0291
*   RPLVRETC=RPLVRETC&&RPLVRETC;    /* ALL OK -              @Z40LB25*/
         XC    RPLVRETC(2,RPLVPTR),RPLVRETC(RPLVPTR)               0292
*   RPLRCODE=RPLRCODE&&RPLRCODE;    /* CONTINUE              @Z40LB25*/
*                                                                  0293
         XC    RPLRCODE(2,RPLVPTR),RPLRCODE(RPLVPTR)               0293
*   /*****************************************************************/
*   /*                                                               */
*   /* DELETE THE CIR FOR CSN2.                              @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0294
*   IVOLKY=BCDCSN2;                 /* SET CSN2 IN CIR       @Z40LB25*/
         MVC   IVOLKY(12),BCDCSN2(BCDVPTR)                         0294
*   CALL DELTRECD;                  /* GET & DELETE CIR      @Z40LB25*/
         BAL   @14,DELTRECD                                        0295
*   RPLVRETC=RPLVRETC&&RPLVRETC;    /* ALL OK -              @Z40LB25*/
         XC    RPLVRETC(2,RPLVPTR),RPLVRETC(RPLVPTR)               0296
*   RPLRCODE=RPLRCODE&&RPLRCODE;    /* CONTINUE              @Z40LB25*/
         XC    RPLRCODE(2,RPLVPTR),RPLRCODE(RPLVPTR)               0297
*   END DELTCIRS;                   /*                       @Z40LB25*/
@EL00006 DS    0H                                                  0298
@EF00006 DS    0H                                                  0298
@ER00006 L     @14,@SA00006                                        0298
         BR    @14                                                 0298
*                                                                  0299
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - HOUSKEEP                             @Z40LB25*/
*   /*                                                       @Z40LB25*/
*   /* FUNCTION-                                             @Z40LB25*/
*   /* JOURNALS THE RPLV AND RESERVES .MSVI FOR PROCESSING   @Z40LB25*/
*   /* AFTER THE MSC IS DONE.                                @Z40LB25*/
*   /*                                                       @Z40LB25*/
*   /* RESERVE/RELEASE RETURNS ZERO REASON/RETURN CODES.     @Z40LB25*/
*   /* RPLV WILL BE JOURNALLED, BECAUSE CHECK FOR DISABLED   @Z40LB25*/
*   /* WAS MADE BEFORE CALL TO THE MSC. THEREFORE,           @Z40LB25*/
*   /* THIS INCOMPLETELY PROCESSED FUNCTION WILL BE ALLOWED  @Z40LB25*/
*   /* TO COMPLETE EVEN IF THE JOURNAL HAS BEEN DISABLED     @Z40LB25*/
*   /* SINCE THE LAST CHECK. THE JOURNAL ALWAYS HAS          @Z40LB25*/
*   /* SPACE RESERVED FOR SUCH A SITUATION.                  @Z40LB25*/
*   /* INPUT -                                               @Z40LB25*/
*   /*                                                       @Z40LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Z40LB25*/
*   /*                                                       @Z40LB25*/
*   /* OUTPUT -                                              @Z40LB25*/
*   /* MSVC REQUEST PARAMETER - RETURN CODE IF               @Z40LB25*/
*   /* AN ERROR                                              @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0299
*HOUSKEEP:                          /*                       @Z40LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @Z40LB25*/
HOUSKEEP ST    @14,@SA00007                                        0299
*   RESPECIFY                       /*                       @Z40LB25*/
*     RG0 RSTD;                     /* RESTRICT REG 0        @Z40LB25*/
*   RESPECIFY                       /*                       @Z40LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Z40LB25*/
*                                                                  0301
*   /*****************************************************************/
*   /*                                                               */
*   /* RESERVE THE JOURNAL.                                  @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0302
*   RG0=RESEXVJL;                   /* RESERVE JRNL FLAG     @Z40LB25*/
         LA    RG0,17                                              0302
*   RG1=RPLVPTR;                    /* RPLV PTR              @Z40LB25*/
         LR    RG1,RPLVPTR                                         0303
*   CALL ICBVRR00;                  /* RESERVE JOURNNAL      @Z40LB25*/
*                                                                  0304
         L     @15,@CV00538                                        0304
         BALR  @14,@15                                             0304
*   /*****************************************************************/
*   /*                                                               */
*   /* JOURNAL THE RPLV.                                     @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0305
*   RG1=RPLVPTR;                    /* RPLV PTR              @Z40LB25*/
         LR    RG1,RPLVPTR                                         0305
*   CALL ICBVJL00;                  /* JRNL THE RPLV         @Z40LB25*/
*                                                                  0306
         L     @15,@CV00539                                        0306
         BALR  @14,@15                                             0306
*   /*****************************************************************/
*   /*                                                               */
*   /* RELEASE THE JOURNAL.                                  @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0307
*   RG0=DEQJRNL;                    /* RELEASE JRNL FLAG     @Z40LB25*/
         LA    RG0,16                                              0307
*   RG1=RPLVPTR;                    /* RPLV PTR              @Z40LB25*/
         LR    RG1,RPLVPTR                                         0308
*   CALL ICBVRR00;                  /* RELEASE JOURNAL       @Z40LB25*/
         L     @15,@CV00538                                        0309
         BALR  @14,@15                                             0309
*   RPLVFLG=ON;                     /* RPLV IS JRNLED        @Z40LB25*/
*                                                                  0310
         OI    RPLVFLG,B'00000001'                                 0310
*   /*****************************************************************/
*   /*                                                               */
*   /* RESERVE .MSVI.                                        @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0311
*   RG0=RESEXINV;                   /* RESERVE .MSVI FLAG    @Z40LB25*/
         LA    RG0,1                                               0311
*   RG1=RPLVPTR;                    /* RPLV PTR              @Z40LB25*/
         LR    RG1,RPLVPTR                                         0312
*   CALL ICBVRR00;                  /* RESERVE .MSVI         @Z40LB25*/
         L     @15,@CV00538                                        0313
         BALR  @14,@15                                             0313
*   RESPECIFY                       /*                       @Z40LB25*/
*     RG0 UNRSTD;                   /* UNRESTRICT REG 0      @Z40LB25*/
*   RESPECIFY                       /*                       @Z40LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Z40LB25*/
*   RETURN;                         /*                       @Z40LB25*/
@EL00007 DS    0H                                                  0316
@EF00007 DS    0H                                                  0316
@ER00007 L     @14,@SA00007                                        0316
         BR    @14                                                 0316
*   END HOUSKEEP;                   /*                       @Z40LB25*/
*                                                                  0318
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - GETRECUD                             @Z40LB25*/
*   /*                                                       @Z40LB25*/
*   /* FUNCTION - READ A CIR IN THE LOCATE MODE USING        @Z40LB25*/
*   /* THE INPUT CSN, GET THE MSVI RECORD FOR UPDATE         @Z40LB25*/
*   /* FROM ITS KEY IN THE CIR.                              @Z40LB25*/
*   /*                                                       @Z40LB25*/
*   /* INPUT -                                               @Z40LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Z40LB25*/
*   /* IKEY - CIR KEY                                        @Z40LB25*/
*   /*                                                       @Z40LB25*/
*   /* OUTPUT -                                              @Z40LB25*/
*   /* MSVC REQUEST PARAMETER - RETURN CODE IF               @Z40LB25*/
*   /* AN ERROR                                              @Z40LB25*/
*   /* BASE, COPY, OR DUPLICATE VOLUME RECORD                @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0318
*GETRECUD:                          /*                       @Z40LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @Z40LB25*/
GETRECUD ST    @14,@SA00008                                        0318
*   RPLVKEY=ADDR(IKEY);             /* ADDR OF KEY           @Z40LB25*/
         LA    @09,IKEY                                            0319
         ST    @09,RPLVKEY(,RPLVPTR)                               0319
*   RPLVTYP=RPLVREAD;               /* READ                  @Z40LB25*/
         MVI   RPLVTYP(RPLVPTR),X'00'                              0320
*   RPLVDIR=ON;                     /* DIRECT                @Z40LB25*/
*   RPLVLOC=ON;                     /* LOCATE                @Z40LB25*/
         OI    RPLVDIR(RPLVPTR),B'11000000'                        0322
*   RPLVUPD=OFF;                    /* NO UPDATE             @Z40LB25*/
         NI    RPLVUPD(RPLVPTR),B'11111101'                        0323
*   RESPECIFY                       /*                       @Z40LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Z40LB25*/
*   RG1=RPLVPTR;                    /* SET RPLV PTR          @Z40LB25*/
         LR    RG1,RPLVPTR                                         0325
*   CALL ICBVIO00;                  /* READ CIR              @Z40LB25*/
         L     @15,@CV00537                                        0326
         BALR  @14,@15                                             0326
*   IF RPLVRETC^=OKZERO             /* ERROR                 @Z40LB25*/
*     THEN                          /* YES                   @Z40LB25*/
         LH    @09,RPLVRETC(,RPLVPTR)                              0327
         N     @09,@CF00613                                        0327
         LTR   @09,@09                                             0327
         BNZ   @RT00327                                            0327
*     RETURN;                       /*                       @Z40LB25*/
*   INDEXPTR=RPLVBUF;               /* SET MAPPING           @Z40LB25*/
         L     INDEXPTR,RPLVBUF(,RPLVPTR)                          0329
*   BCDKEY=INDRECKY;                /* SET KEY               @Z40LB25*/
         MVC   BCDKEY(13),INDRECKY(INDEXPTR)                       0330
*   RPLVKEY=ADDR(BCDKEY);           /* SET KEY ADDR          @Z40LB25*/
         LA    @09,BCDKEY                                          0331
         ST    @09,RPLVKEY(,RPLVPTR)                               0331
*   RPLVLOC=OFF;                    /* NO LOCATE             @Z40LB25*/
         NI    RPLVLOC(RPLVPTR),B'01111111'                        0332
*   RPLVUPD=ON;                     /* UPDATE                @Z40LB25*/
         OI    RPLVUPD(RPLVPTR),B'00000010'                        0333
*   RPLVBUF=ADDR(BASEBUF);          /* BUF ADDR              @Z40LB25*/
         LA    @09,BASEBUF                                         0334
         ST    @09,RPLVBUF(,RPLVPTR)                               0334
*   RPLVBLN=LENGTH(BASEBUF);        /* BUFF LENGTH           @Z40LB25*/
         MVC   RPLVBLN(4,RPLVPTR),@CF00608                         0335
*   RG1=RPLVPTR;                    /* SET RPLV PTR          @Z40LB25*/
         LR    RG1,RPLVPTR                                         0336
*   CALL ICBVIO00;                  /* READ RECORD           @Z40LB25*/
         L     @15,@CV00537                                        0337
         BALR  @14,@15                                             0337
*   RESPECIFY                       /*                       @Z40LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Z40LB25*/
*   RETURN;                         /*                       @Z40LB25*/
@EL00008 DS    0H                                                  0339
@EF00008 DS    0H                                                  0339
@ER00008 L     @14,@SA00008                                        0339
         BR    @14                                                 0339
*   END GETRECUD;                   /*                       @Z40LB25*/
         B     @EL00008                                            0340
*                                                                  0341
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - DELTRECD                             @Z40LB25*/
*   /*                                                       @Z40LB25*/
*   /* FUNCTION - READ AND DELETE AN MSVI RECORD.            @Z40LB25*/
*   /*                                                       @Z40LB25*/
*   /* INPUT -                                               @Z40LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Z40LB25*/
*   /* KEY OF RECORD IN RPLVKEY                              @Z40LB25*/
*   /* ADDRESS OF RECORD BUFFER IN RPLVBUF                   @Z40LB25*/
*   /* LENGTH OF BUFFER IN RPLVBLN                           @Z40LB25*/
*   /*                                                       @Z40LB25*/
*   /* OUTPUT -                                              @Z40LB25*/
*   /* MSVC REQUEST PARAMETER - RETURN CODE IF               @Z40LB25*/
*   /* AN ERROR                                              @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0341
*DELTRECD:                          /*                       @Z40LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @Z40LB25*/
DELTRECD ST    @14,@SA00009                                        0341
*   RPLVTYP=RPLVREAD;               /* READ                  @Z40LB25*/
         MVI   RPLVTYP(RPLVPTR),X'00'                              0342
*   RPLVLOC=OFF;                    /* NO LOCATE             @Z40LB25*/
         NI    RPLVLOC(RPLVPTR),B'01111111'                        0343
*   RPLVUPD=ON;                     /* UPDATE                @Z40LB25*/
         OI    RPLVUPD(RPLVPTR),B'00000010'                        0344
*   RPLVDIR=ON;                     /* DIRECT                @Z40LB25*/
         OI    RPLVDIR(RPLVPTR),B'01000000'                        0345
*   RESPECIFY                       /*                       @Z40LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Z40LB25*/
*   RG1=RPLVPTR;                    /* RPLV PTR              @Z40LB25*/
         LR    RG1,RPLVPTR                                         0347
*   CALL ICBVIO00;                  /* READ MSVI RECORD      @Z40LB25*/
         L     @15,@CV00537                                        0348
         BALR  @14,@15                                             0348
*   IF RPLVRETC^=OKZERO             /* ERROR?                @Z40LB25*/
*     THEN                          /* YES                   @Z40LB25*/
         LH    @09,RPLVRETC(,RPLVPTR)                              0349
         N     @09,@CF00613                                        0349
         LTR   @09,@09                                             0349
         BNZ   @RT00349                                            0349
*     RETURN;                       /*                       @Z40LB25*/
*   RPLVTYP=RPLVDEL;                /* DELETE                @Z40LB25*/
         MVI   RPLVTYP(RPLVPTR),X'05'                              0351
*   RG1=RPLVPTR;                    /* RPLV PTR              @Z40LB25*/
         LR    RG1,RPLVPTR                                         0352
*   CALL ICBVIO00;                  /* DELETE MSVI RECORD    @Z40LB25*/
         L     @15,@CV00537                                        0353
         BALR  @14,@15                                             0353
*   RESPECIFY                       /*                       @Z40LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Z40LB25*/
*   RETURN;                         /*                       @Z40LB25*/
@EL00009 DS    0H                                                  0355
@EF00009 DS    0H                                                  0355
@ER00009 L     @14,@SA00009                                        0355
         BR    @14                                                 0355
*   END DELTRECD;                   /*                       @Z40LB25*/
         B     @EL00009                                            0356
*                                                                  0357
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - READUPD1                             @Z40LB25*/
*   /*                                                       @Z40LB25*/
*   /* FUNCTION -                                            @Z40LB25*/
*   /* READ AN MSVI RECORD FOR UPDATE INTO BASEBUF1          @Z40LB25*/
*   /*                                                       @Z40LB25*/
*   /* INPUT -                                               @Z40LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Z40LB25*/
*   /* ADDRESS OF KEY TO READ IN RPLVKEY                     @Z40LB25*/
*   /*                                                       @Z40LB25*/
*   /* OUTPUT -                                              @Z40LB25*/
*   /* MSVC REQUEST PARAMETER - RETURN CODE IF               @Z40LB25*/
*   /* AN ERROR                                              @Z40LB25*/
*   /* MSVI RECORD                                           @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0357
*READUPD1:                          /*                       @Z40LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @Z40LB25*/
READUPD1 ST    @14,@SA00010                                        0357
*   RPLVBUF=ADDR(TEMPBUF);          /* ADDR OF BUF           @Z40LB25*/
         LA    @09,TEMPBUF                                         0358
         ST    @09,RPLVBUF(,RPLVPTR)                               0358
*   RPLVBLN=LENGTH(TEMPBUF);        /* BVR BUF LENGTH        @Z40LB25*/
         MVC   RPLVBLN(4,RPLVPTR),@CF00608                         0359
*   RPLVTYP=RPLVREAD;               /* READ                  @Z40LB25*/
         MVI   RPLVTYP(RPLVPTR),X'00'                              0360
*   RPLVDIR=ON;                     /* DIRECT                @Z40LB25*/
         OI    RPLVDIR(RPLVPTR),B'01000000'                        0361
*   RPLVUPD=ON;                     /* UPDATE                @Z40LB25*/
         OI    RPLVUPD(RPLVPTR),B'00000010'                        0362
*   RPLVLOC=OFF;                    /* NO LOCATE             @Z40LB25*/
         NI    RPLVLOC(RPLVPTR),B'01111111'                        0363
*   RESPECIFY                       /*                       @Z40LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Z40LB25*/
*   RG1=RPLVPTR;                    /* SET RPLV PTR          @Z40LB25*/
         LR    RG1,RPLVPTR                                         0365
*   CALL ICBVIO00;                  /* READ BVR              @Z40LB25*/
         L     @15,@CV00537                                        0366
         BALR  @14,@15                                             0366
*   RESPECIFY                       /*                       @Z40LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Z40LB25*/
*   RETURN;                         /*                       @Z40LB25*/
@EL00010 DS    0H                                                  0368
@EF00010 DS    0H                                                  0368
@ER00010 L     @14,@SA00010                                        0368
         BR    @14                                                 0368
*   END READUPD1;                   /*                       @Z40LB25*/
*                                                                  0370
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - WRITRECD                             @Z40LB25*/
*   /*                                                       @Z40LB25*/
*   /* FUNCTION - WRITE AN MSVI RECORD.                      @Z40LB25*/
*   /*                                                       @Z40LB25*/
*   /* INPUT -                                               @Z40LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Z40LB25*/
*   /* MSVI RECORD                                           @Z40LB25*/
*   /*                                                       @Z40LB25*/
*   /* OUTPUT -                                              @Z40LB25*/
*   /* MSVC REQUEST PARAMETER - RETURN CODE IF               @Z40LB25*/
*   /* AN ERROR                                              @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0370
*WRITRECD:                          /*                       @Z40LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @Z40LB25*/
WRITRECD ST    @14,@SA00011                                        0370
*   RPLVTYP=RPLVPUT;                /* WRITE                 @Z40LB25*/
         MVI   RPLVTYP(RPLVPTR),X'01'                              0371
*   RPLVLOC=OFF;                    /* NO LOC                @Z40LB25*/
         NI    RPLVLOC(RPLVPTR),B'01111111'                        0372
*   RESPECIFY                       /*                       @Z40LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Z40LB25*/
*   RG1=RPLVPTR;                    /* SET RPLV PTR          @Z40LB25*/
         LR    RG1,RPLVPTR                                         0374
*   CALL ICBVIO00;                  /* WRITE BVR             @Z40LB25*/
         L     @15,@CV00537                                        0375
         BALR  @14,@15                                             0375
*   RESPECIFY                       /*                       @Z40LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Z40LB25*/
*   RETURN;                         /*                       @Z40LB25*/
@EL00011 DS    0H                                                  0377
@EF00011 DS    0H                                                  0377
@ER00011 L     @14,@SA00011                                        0377
         BR    @14                                                 0377
*   END WRITRECD;                   /*                       @Z40LB25*/
*                                                                  0379
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - PROCBVR                              @Z40LB25*/
*   /*                                                       @Z40LB25*/
*   /* FUNCTION - THE INPUT BVR HAS ALREADY BEEN DELETED.    @Z40LB25*/
*   /* IF THE BVR IS GROUPED, GET THE GHR, UPDATE IT, CHAIN  @Z40LB25*/
*   /* THE BVR OUT OF THE GHR, AND WRITE THE GHR.            @Z40LB25*/
*   /* IF THE BVR WAS GROUPED, ACTIVE AND GENERAL-USE        @Z40LB25*/
*   /* DELETE ITS GROUP VOLUME SERIAL NUMBER EXTENSION       @Z40LB25*/
*   /* SLOT. LOCATE A DVR FOR THE BVR, IF ANY, AND MAKE      @Z40LB25*/
*   /* IT THE BVR. IF NO DVR IS FOUND, THEN DELETE THE       @Z40LB25*/
*   /* BVR FROM THE NGHR CHAIN OF BVRS, IF THE BVR           @Z40LB25*/
*   /* IS NON-GROUPED.                                       @Z40LB25*/
*   /*                                                       @Z40LB25*/
*   /* INPUT -                                               @Z40LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Z40LB25*/
*   /* BASE VOLUME RECORD                                    @Z40LB25*/
*   /*                                                       @Z40LB25*/
*   /* OUTPUT -                                              @Z40LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Z40LB25*/
*   /* BASE VOLUME RECORD                                    @Z40LB25*/
*   /* GROUP HEADER RECORD                                   @Z40LB25*/
*   /* NON-GROUP HEADER RECORD                               @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0379
*PROCBVR:                           /*                       @Z40LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @Z40LB25*/
*                                                                  0379
PROCBVR  ST    @14,@SA00012                                        0379
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR A GROUPED BVR.                              @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0380
*   IF BASGRPV=ON                   /* GROUPED?              @Z40LB25*/
*     THEN                          /* YES                   @Z40LB25*/
         TM    BASGRPV(BASEVPTR),B'00100000'                       0380
         BNO   @RF00380                                            0380
*     DO;                           /*                       @Z40LB25*/
*                                                                  0381
*       /*************************************************************/
*       /*                                                           */
*       /* UPDATE THE GROUP HEADER RECORD.                   @Z40LB25*/
*       /* THE CALLING ROUTINE HAS READ THE GHR FOR UPDATE.  @Z40LB25*/
*       /* CHAIN THE BVR OUT OF THE GHR.                     @Z40LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0382
*       GRPFLG=ON;                  /* SET GROUP FLAG        @Z40LB25*/
         OI    GRPFLG,B'00010000'                                  0382
*       CALL ICBVUCHO(PTRGROUP,PTRBASEV,PTRRPLV,PASSBYTE);/* @Z40LB25
*                                      CHAIN BVR OUT GHR     @Z40LB25*/
         L     @15,@CV00543                                        0383
         LA    @01,@AL00383                                        0383
         BALR  @14,@15                                             0383
*       IF RPLVRETC^=OKZERO         /* CHECK RETURN CODE     @Z40LB25*/
*         THEN                      /* ERROR                 @Z40LB25*/
         LH    @09,RPLVRETC(,RPLVPTR)                              0384
         N     @09,@CF00613                                        0384
         LTR   @09,@09                                             0384
         BNZ   @RT00384                                            0384
*         RETURN;                   /*                       @Z40LB25*/
*                                                                  0385
*       /*************************************************************/
*       /*                                                           */
*       /* REESTABLISH RPLV FOR WRITING THE GHR              @Z40LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0386
*       GROUPKY=BASGROUP;           /* SET THE KEY           @Z40LB25*/
         MVC   GROUPKY(8),BASGROUP(BASEVPTR)                       0386
*       RPLVKEY=ADDR(GKEY);         /* PTR TO KEY            @Z40LB25*/
         LA    @09,GKEY                                            0387
         ST    @09,RPLVKEY(,RPLVPTR)                               0387
*       CALL READUPD1;              /* GET GHR               @Z40LB25*/
         BAL   @14,READUPD1                                        0388
*       IF RPLVRETC^=OKZERO         /* CHECK RETURN CODE     @Z40LB25*/
*         THEN                      /* ERROR                 @Z40LB25*/
         LH    @09,RPLVRETC(,RPLVPTR)                              0389
         N     @09,@CF00613                                        0389
         LTR   @09,@09                                             0389
         BNZ   @RT00389                                            0389
*         RETURN;                   /*                       @Z40LB25*/
*                                                                  0390
*       /*************************************************************/
*       /*                                                           */
*       /* WRITE THE GHR.                                    @Z40LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0391
*       RPLVBUF=ADDR(GROUPBUF);     /* PTR TO GHR            @Z40LB25*/
         LA    @09,GROUPBUF                                        0391
         ST    @09,RPLVBUF(,RPLVPTR)                               0391
*       CALL WRITRECD;              /* WRITE GHR             @Z40LB25*/
         BAL   @14,WRITRECD                                        0392
*       IF RPLVRETC^=OKZERO         /* CHECK RETURN CODE     @Z40LB25*/
*         THEN                      /* ERROR                 @Z40LB25*/
         LH    @09,RPLVRETC(,RPLVPTR)                              0393
         N     @09,@CF00613                                        0393
         LTR   @09,@09                                             0393
         BNZ   @RT00393                                            0393
*         RETURN;                   /*                       @Z40LB25*/
*                                                                  0394
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK FOR ACTIVE GENERAL-USE TO DELETE            @Z40LB25*/
*       /* ITS GHSNER SLOT.                                  @Z40LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0395
*       IF BASINAC=OFF&BASGENUS=ON  /* ACT & GEN-USE?        @Z40LB25*/
*         THEN                      /* YES                   @Z40LB25*/
         TM    BASGENUS(BASEVPTR),B'00010000'                      0395
         BNO   @RF00395                                            0395
         TM    BASINAC(BASEVPTR),B'00000100'                       0395
         BNZ   @RF00395                                            0395
*         DO;                       /*                       @Z40LB25*/
*           ADDSUBSL=OFF;           /* DELETE SLOT           @Z40LB25*/
         NI    ADDSUBSL,B'11111101'                                0397
*           EXPSLOT=OFF;            /* NO UPDT EXPIR DATE    @Z40LB25*/
         NI    EXPSLOT,B'01111111'                                 0398
*           CALL ICBVUEXT(PTRGROUP,PTRBASEV,PTRRPLV,PASSBYTE);/*   0399
*                                      DELETE GHSNER SLOT    @Z40LB25*/
         L     @15,@CV00541                                        0399
         LA    @01,@AL00399                                        0399
         BALR  @14,@15                                             0399
*           IF RPLVRETC^=OKZERO     /* ERROR?                @Z40LB25*/
*             THEN                  /* YES                   @Z40LB25*/
         LH    @09,RPLVRETC(,RPLVPTR)                              0400
         N     @09,@CF00613                                        0400
         LTR   @09,@09                                             0400
         BNZ   @RT00400                                            0400
*             RETURN;               /*                       @Z40LB25*/
*         END;                      /*                       @Z40LB25*/
*     END;                          /*                       @Z40LB25*/
*                                                                  0403
@RF00395 DS    0H                                                  0404
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR A DUP VOLUME RECORD FOR THE DELETED         @Z40LB25*/
*   /* BASE VOLUME RECORD                                    @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0404
*   DVOLKY=BASSERNO;                /* SET VOLID IN KEY      @Z40LB25*/
@RF00380 MVC   DVOLKY(6),BASSERNO(BASEVPTR)                        0404
*   DIDKY=IDONE;                    /* SET KEY               @Z40LB25*/
         MVI   DIDKY,X'01'                                         0405
*   RPLVKEY=ADDR(DKEY);             /* ADDR OF KEY           @Z40LB25*/
         LA    @09,DKEY                                            0406
         ST    @09,RPLVKEY(,RPLVPTR)                               0406
*   RPLVTYP=RPLVREAD;               /* READ OPTION ON        @Z40LB25*/
         MVI   RPLVTYP(RPLVPTR),X'00'                              0407
*   RPLVDIR=ON;                     /* DIRECT                @Z40LB25*/
*   RPLVLOC=OFF;                    /* NO LOCATE             @Z40LB25*/
         OI    RPLVDIR(RPLVPTR),B'01000000'                        0409
         NI    RPLVLOC(RPLVPTR),B'01111111'                        0409
*   RPLVUPD=ON;                     /* SET UPDATE            @Z40LB25*/
         OI    RPLVUPD(RPLVPTR),B'00000010'                        0410
*   RPLVKGE=ON;                     /* READ KEY = OR >       @Z40LB25*/
         OI    RPLVKGE(RPLVPTR),B'00000100'                        0411
*   RPLVBUF=DUPVPTR;                /* BUFFER PTR            @Z40LB25*/
         ST    DUPVPTR,RPLVBUF(,RPLVPTR)                           0412
*   RPLVBLN=LENGTH(DUPVBUF);        /* BUFFER LENGTH         @Z40LB25*/
         MVC   RPLVBLN(4,RPLVPTR),@CF00608                         0413
*   RESPECIFY                                                      0414
*     RG1 RSTD;                     /* RESTRICT REG 1        @Z40LB25*/
*   RG1=RPLVPTR;                    /* SET RPLV PTR          @Z40LB25*/
         LR    RG1,RPLVPTR                                         0415
*   CALL ICBVIO00;                  /* READ FOR DVR          @Z40LB25*/
         L     @15,@CV00537                                        0416
         BALR  @14,@15                                             0416
*   RESPECIFY                                                      0417
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Z40LB25*/
*   RPLVKGE=OFF;                    /* NO > OR =             @Z40LB25*/
         NI    RPLVKGE(RPLVPTR),B'11111011'                        0418
*   IF RPLRCODE=IOERROR             /* CHECK REASON CODE     @Z40LB25*/
*     THEN                          /* YES                   @Z40LB25*/
         CLC   RPLRCODE(2,RPLVPTR),@CB00525                        0419
         BE    @RT00419                                            0419
*     RETURN;                       /*                       @Z40LB25*/
*   IF DKY^=DUPD×DVOLKY^=DUPSERNO   /* DVR FOUND?            @Z40LB25*/
*     THEN                          /* NO                    @Z40LB25*/
         CLC   DKY(5),DUPD(DUPVPTR)                                0421
         BNE   @RT00421                                            0421
         CLC   DVOLKY(6),DUPSERNO(DUPVPTR)                         0421
         BE    @RF00421                                            0421
@RT00421 DS    0H                                                  0422
*     DO;                           /*                       @Z40LB25*/
*       RPLVRETC=RPLVRETC&&RPLVRETC;/* ZERO RETURN CODE      @Z40LB25*/
         XC    RPLVRETC(2,RPLVPTR),RPLVRETC(RPLVPTR)               0423
*       RPLRCODE=RPLRCODE&&RPLRCODE;/* ZERO REASON CODE      @Z40LB25*/
*                                                                  0424
         XC    RPLRCODE(2,RPLVPTR),RPLRCODE(RPLVPTR)               0424
*       /*************************************************************/
*       /*                                                           */
*       /* NO DVR WAS FOUND.                                 @Z40LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0425
*       IF BASGRPV=OFF              /* BVR NOT GRPD?         @Z40LB25*/
*         THEN                      /* YES                   @Z40LB25*/
         TM    BASGRPV(BASEVPTR),B'00100000'                       0425
         BNZ   @RF00425                                            0425
*         DO;                       /*                       @Z40LB25*/
*                                                                  0426
*           /*********************************************************/
*           /*                                                       */
*           /* CHAIN THE BVR OUT OF THE NGHR.                @Z40LB25*/
*           /* CHECK FOR NON-GROUPED.                        @Z40LB25*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  0427
*           GRPFLG=OFF;             /* NON-GROUPED           @Z40LB25*/
         NI    GRPFLG,B'11101111'                                  0427
*           CALL ICBVUCHO(ZEROCORE,PTRBASEV,PTRRPLV,PASSBYTE);/*   0428
*                                                            @Z40LB25
*                                      CHAIN BVR OUT NGHR    @Z40LB25*/
         L     @15,@CV00543                                        0428
         LA    @01,@AL00428                                        0428
         BALR  @14,@15                                             0428
*         END;                      /*                       @Z40LB25*/
*       RETURN;                     /*                       @Z40LB25*/
@EL00012 DS    0H                                                  0430
@EF00012 DS    0H                                                  0430
@ER00012 L     @14,@SA00012                                        0430
         BR    @14                                                 0430
*     END;                          /*                       @Z40LB25*/
*                                                                  0431
*   /*****************************************************************/
*   /*                                                               */
*   /* DVR WAS FOUND.                                        @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0432
*   ELSE                            /* DVR WAS FOUND         @Z40LB25*/
*     DO;                           /*                       @Z40LB25*/
*                                                                  0432
@RF00421 DS    0H                                                  0433
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK FOR A GROUPED BVR.                          @Z40LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0433
*       IF BASGRPV=ON               /* BVR GROUPED?          @Z40LB25*/
*         THEN                      /* YES                   @Z40LB25*/
         TM    BASGRPV(BASEVPTR),B'00100000'                       0433
         BNO   @RF00433                                            0433
*         DO;                       /*                       @Z40LB25*/
*                                                                  0434
*           /*********************************************************/
*           /*                                                       */
*           /* MAKE A DVR INTO A BASE.                       @Z40LB25*/
*           /* ICBVUDBR RETURNS THE POINTER TO THE           @Z40LB25*/
*           /* BVR IT CREATED IN PTRBASEV.                   @Z40LB25*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  0435
*           GRPDV=ON;               /* GROUPED FLAG ON       @Z40LB25*/
         OI    GRPDV,B'10000000'                                   0435
*           CALL ICBVUDBR(PTRDUPV,PTRBASEV,PTRRPLV,PASSBYTE,/*     0436
*                                                            @Z40LB25*/
*               ZEROCORE,ZEROCORE); /*                       @Z40LB25
*                                      MAKE DVR A BVR        @Z40LB25*/
         L     @15,@CV00540                                        0436
         LA    @01,@AL00436                                        0436
         BALR  @14,@15                                             0436
*           IF RPLVRETC^=OKZERO     /* CHECK RETURN CODE     @Z40LB25*/
*             THEN                  /* ERROR                 @Z40LB25*/
         LH    @05,RPLVRETC(,RPLVPTR)                              0437
         N     @05,@CF00613                                        0437
         LTR   @05,@05                                             0437
         BNZ   @RT00437                                            0437
*             RETURN;               /*                       @Z40LB25*/
*                                                                  0438
*           /*********************************************************/
*           /*                                                       */
*           /* CHAIN THE BVR INTO THE NGHR.                  @Z40LB25*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  0439
*           GRPFLG=OFF;             /* NON-GROUPED           @Z40LB25*/
         NI    GRPFLG,B'11101111'                                  0439
*           CALL ICBVUCHI(ZEROCORE,PTRBASEV,PTRRPLV,PASSBYTE);/*   0440
*                                                            @Z40LB25
*                                      CHAIN BVR IN NGHR     @Z40LB25*/
         L     @15,@CV00544                                        0440
         LA    @01,@AL00440                                        0440
         BALR  @14,@15                                             0440
*           IF RPLVRETC^=OKZERO     /* CHECK RETURN CODE     @Z40LB25*/
*             THEN                  /* ERROR                 @Z40LB25*/
         LH    @05,RPLVRETC(,RPLVPTR)                              0441
         N     @05,@CF00613                                        0441
         LTR   @05,@05                                             0441
         BNZ   @RT00441                                            0441
*             RETURN;               /*                       @Z40LB25*/
*         END;                      /*                       @Z40LB25*/
*       ELSE                        /* NOT GROUPED           @Z40LB25*/
*                                                                  0444
*         /***********************************************************/
*         /*                                                         */
*         /* MAKE THE DVR INTO A BVR.                        @Z40LB25*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  0444
*         DO;                       /*                       @Z40LB25*/
         B     @RC00433                                            0444
@RF00433 DS    0H                                                  0445
*           GRPDV=OFF;              /* GROUPED FLAG OFF      @Z40LB25*/
         NI    GRPDV,B'01111111'                                   0445
*           IF BASFIRST=ON          /* 1ST BVR IN CHAIN?     @Z40LB25*/
*             THEN                  /* YES                   @Z40LB25*/
         TM    BASFIRST(BASEVPTR),B'00010000'                      0446
         BNO   @RF00446                                            0446
*             FRSTDV=ON;            /* SET 1ST FLG ON        @Z40LB25*/
         OI    FRSTDV,B'01000000'                                  0447
*           IF BASLAST=ON           /* LAST BVR IN CHAIN?    @Z40LB25*/
*             THEN                  /* YES                   @Z40LB25*/
@RF00446 TM    BASLAST(BASEVPTR),B'00001000'                       0448
         BNO   @RF00448                                            0448
*             LASTDV=ON;            /* SET LAST FLG ON       @Z40LB25*/
         OI    LASTDV,B'00100000'                                  0449
*           CALL ICBVUDBR(PTRDUPV,PTRBASEV,PTRRPLV,PASSBYTE,/*     0450
*                                                            @Z40LB25*/
*               BASPREV,BASNEXTV);  /*                       @Z40LB25
*                                      MAKE DVR A BVR        @Z40LB25*/
@RF00448 MVC   @AL00001(16),@AL00450                               0450
         LA    @03,BASPREV(,BASEVPTR)                              0450
         ST    @03,@AL00001+16                                     0450
         LA    @03,BASNEXTV(,BASEVPTR)                             0450
         ST    @03,@AL00001+20                                     0450
         L     @15,@CV00540                                        0450
         LA    @01,@AL00001                                        0450
         BALR  @14,@15                                             0450
*           IF RPLVRETC^=OKZERO     /* CHECK RETURN CODE     @Z40LB25*/
*             THEN                  /* ERROR                 @Z40LB25*/
         LH    @05,RPLVRETC(,RPLVPTR)                              0451
         N     @05,@CF00613                                        0451
         LTR   @05,@05                                             0451
         BNZ   @RT00451                                            0451
*             RETURN;               /*                       @Z40LB25*/
*         END;                      /*                       @Z40LB25*/
*     END;                          /*                       @Z40LB25*/
*                                                                  0454
@RC00433 DS    0H                                                  0455
*   /*****************************************************************/
*   /*                                                               */
*   /* WRITE THE NEW BVR.                                    @Z40LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0455
*   RPLVTYP=RPLVPUT;                /* WRITE BVR             @Z40LB25*/
         MVI   RPLVTYP(RPLVPTR),X'01'                              0455
*   RPLVBUF=PTRBASEV;               /* PTR TO NEW BVR        @Z40LB25*/
         L     @05,PTRBASEV                                        0456
         ST    @05,RPLVBUF(,RPLVPTR)                               0456
*   RPLVUPD=OFF;                    /* NEW RECORD            @Z40LB25*/
         NI    RPLVUPD(RPLVPTR),B'11111101'                        0457
*   RPLVLOC=OFF;                    /* NO LOCATE             @Z40LB25*/
         NI    RPLVLOC(RPLVPTR),B'01111111'                        0458
*   RPLVBLN=LENGTH(BASEBUF);        /* SET BUF LENGTH        @Z40LB25*/
         LA    @05,224                                             0459
         ST    @05,RPLVBLN(,RPLVPTR)                               0459
*   RPLVRLN=LENGTH(BASEBUF);        /* SET BVR LENGTH        @Z40LB25*/
         ST    @05,RPLVRLN(,RPLVPTR)                               0460
*   CALL WRITRECD;                  /* WRITE BVR             @Z40LB25*/
         BAL   @14,WRITRECD                                        0461
*   RETURN;                         /*                       @Z40LB25*/
         B     @EL00012                                            0462
*   END PROCBVR;                    /*                       @Z40LB25*/
         B     @EL00012                                            0463
*   END ICBVUT03                    /* THE END               @Z40LB25*/
*                                                                  0464
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.     */
*/*%INCLUDE SYSLIB  (IEZVVICB)                                       */
*/*%INCLUDE SYSLIB  (IEZRPLV )                                       */
*/*%INCLUDE SYSLIB  (IEZINDEX)                                       */
*/*%INCLUDE SYSLIB  (IEZGROUP)                                       */
*/*%INCLUDE SYSLIB  (IEZNGVR )                                       */
*/*%INCLUDE SYSLIB  (IEZBCDV )                                       */
*/*%INCLUDE SYSLIB  (IEZBASEV)                                       */
*/*%INCLUDE SYSLIB  (IEZCOPYV)                                       */
*/*%INCLUDE SYSLIB  (IEZDUPV )                                       */
*                                                                  0464
*       ;                                                          0464
@DATA    DS    0H
@CH00036 DC    H'4'
         DS    0F
@AL00186 EQU   *                       LIST WITH   3 ARGUMENT(S)
@AL00271 DC    A(PTRGROUP)             LIST WITH   3 ARGUMENT(S)
         DC    A(PTRBASEV)
         DC    A(PASSBYTE)
@AL00223 DC    A(PTRCOPYV)             LIST WITH   3 ARGUMENT(S)
         DC    A(PTRRPLV)
         DC    A(PASSBYTE)
@AL00281 EQU   *                       LIST WITH   4 ARGUMENT(S)
@AL00383 EQU   *                       LIST WITH   4 ARGUMENT(S)
@AL00399 DC    A(PTRGROUP)             LIST WITH   4 ARGUMENT(S)
         DC    A(PTRBASEV)
         DC    A(PTRRPLV)
         DC    A(PASSBYTE)
@AL00428 EQU   *                       LIST WITH   4 ARGUMENT(S)
@AL00440 DC    A(@CF00080)             LIST WITH   4 ARGUMENT(S)
         DC    A(PTRBASEV)
         DC    A(PTRRPLV)
         DC    A(PASSBYTE)
@AL00436 EQU   *                       LIST WITH   6 ARGUMENT(S)
@AL00450 DC    A(PTRDUPV)              LIST WITH   4 ARGUMENT(S)
         DC    A(PTRBASEV)
         DC    A(PTRRPLV)
         DC    A(PASSBYTE)
         DC    A(@CF00080)
         DC    A(@CF00080)
         DS    0F
@SA00001 DS    18F
@SA00002 DS    1F
@SA00003 DS    1F
@SA00004 DS    1F
@SA00006 DS    1F
@SA00012 DS    1F
@SA00005 DS    1F
@SA00009 DS    0F
@SA00011 DS    0F
@SA00008 DS    0F
@SA00010 DS    0F
@SA00007 DS    0F
         DS    1F
@AL00001 DS    6A
         DS    0F
@CF00080 DC    F'0'
@CF00607 DC    F'36'
@CF00608 DC    F'224'
@CF00613 DC    XL4'0000FFFF'
@CV00537 DC    V(ICBVIO00)
@CV00538 DC    V(ICBVRR00)
@CV00539 DC    V(ICBVJL00)
@CV00540 DC    V(ICBVUDBR)
@CV00541 DC    V(ICBVUEXT)
@CV00542 DC    V(ICBVUBVR)
@CV00543 DC    V(ICBVUCHO)
@CV00544 DC    V(ICBVUCHI)
@CV00545 DC    V(ICBVUPGH)
         DS    0D
PTRRPLV  DS    A
PTRGROUP DS    A
PTRBASEV DS    A
PTRCOPYV DS    A
PTRDUPV  DS    A
@CB00521 DC    X'FFFFFFFF'
@CB00523 DC    X'0208'
@CB00525 DC    X'0209'
@CB00527 DC    X'0213'
GROUPBUF DS    CL164
TEMPBUF  DS    CL224
NGVRBUF  DS    CL40
BASEBUF  DS    CL224
COPYBUF  DS    CL164
INDEXBUF DS    CL36
DUPVBUF  DS    CL224
         DS    CL2
GKEY     DS    CL13
         ORG   GKEY
GKY      DC    CL3'G  '
GROUPKY  DS    CL8
GBLKKY   DC    CL1' '
GIDKY    DC    XL1'00'
         ORG   GKEY+13
         DS    CL3
BKEY     DS    CL13
         ORG   BKEY
BKY      DC    CL5'V    '
BVOLKY   DS    CL6
BBLKKY   DC    CL1' '
BIDKY    DC    XL1'00'
         ORG   BKEY+13
         DS    CL3
DKEY     DS    CL13
         ORG   DKEY
DKY      DC    CL5'D    '
DVOLKY   DS    CL6
DBLKKY   DC    CL1' '
DIDKY    DS    FL1
         ORG   DKEY+13
         DS    CL3
CKEY     DS    CL13
         ORG   CKEY
CKY      DC    CL5'V    '
CVOLKY   DS    CL6
CBLKKY   DC    CL1' '
CIDKY    DS    FL1
         ORG   CKEY+13
         DS    CL3
IKEY     DS    CL13
         ORG   IKEY
IKY      DC    CL1'I'
IVOLKY   DS    CL12
         ORG   IKEY+13
         DS    CL3
NGKEY    DC    CL13'N   HEADER   '
         DS    CL3
WORKAREA DS    CL19
         ORG   WORKAREA
REACODE  DS    CL2
RETCODE  DS    CL2
BCDKEY   DS    CL13
PASSBYTE DS    CL2
         ORG   PASSBYTE
GRPDV    DS    BL1
FRSTDV   EQU   PASSBYTE+0
LASTDV   EQU   PASSBYTE+0
GRPFLG   EQU   PASSBYTE+0
ADDSUBGR EQU   PASSBYTE+0
CSNUMBER EQU   PASSBYTE+0
ADDSUBSL EQU   PASSBYTE+0
RPLVFLG  EQU   PASSBYTE+0
EXPSLOT  DS    BL1
ADDSUB   EQU   PASSBYTE+1
@NM00026 EQU   PASSBYTE+1
         ORG   WORKAREA+19
         DS    CL1
VU3PATCH DS    CL200
         ORG   VU3PATCH
@NM00027 DC    200X'00'
         ORG   VU3PATCH+200
@00      EQU   00                      EQUATES FOR REGISTERS 0-15
@01      EQU   01
@02      EQU   02
@03      EQU   03
@04      EQU   04
@05      EQU   05
@06      EQU   06
@07      EQU   07
@08      EQU   08
@09      EQU   09
@10      EQU   10
@11      EQU   11
@12      EQU   12
@13      EQU   13
@14      EQU   14
@15      EQU   15
PTRNGVR  EQU   @02
NULCPTR  EQU   @07
DUPVPTR  EQU   @08
COPYVPTR EQU   @07
BASEVPTR EQU   @05
BCDVPTR  EQU   @02
NGVRPTR  EQU   @10
GROUPPTR EQU   @06
INDEXPTR EQU   @02
RPLVPTR  EQU   @04
VVIPTR   EQU   @09
RG0      EQU   @00
RG1      EQU   @01
RG14     EQU   @14
NULBR1   EQU   @01
RG10     EQU   @10
RG11     EQU   @11
RG12     EQU   @12
RG13     EQU   @13
RG15     EQU   @15
RG2      EQU   @02
RG3      EQU   @03
RG4      EQU   @04
RG5      EQU   @05
RG6      EQU   @06
RG7      EQU   @07
RG8      EQU   @08
RG9      EQU   @09
VVICB    EQU   0
VVIFLGA  EQU   VVICB+15
VVIFLG0  EQU   VVIFLGA
RPLV     EQU   0
RPLTCBPR EQU   RPLV+8
RPLVVICB EQU   RPLV+12
RPLFLAGA EQU   RPLV+28
RPLRCODE EQU   RPLV+32
RPLVRETC EQU   RPLV+34
RPLVSAM  EQU   RPLV+56
RPLVTYP  EQU   RPLVSAM+2
RPLVBUF  EQU   RPLVSAM+32
RPLVKEY  EQU   RPLVSAM+36
RPLVOPT  EQU   RPLVSAM+40
RPLVLOC  EQU   RPLVOPT
RPLVDIR  EQU   RPLVOPT
RPLVKGE  EQU   RPLVOPT
RPLVUPD  EQU   RPLVOPT+1
RPLVRLN  EQU   RPLVSAM+48
RPLVBLN  EQU   RPLVSAM+52
RPLVUTIL EQU   RPLV+132
INDEX    EQU   0
INDNAME  EQU   INDEX
INDTYPE  EQU   INDEX+13
INDRECKY EQU   INDEX+15
INDPREFX EQU   INDRECKY
INDRECID EQU   INDRECKY+11
GROUP    EQU   0
GRONAME  EQU   GROUP
GROID    EQU   GRONAME+11
GROFLAGA EQU   GROUP+13
GROTYPE  EQU   GROFLAGA
GRONGEN  EQU   GROUP+30
GRONRSTD EQU   GROUP+32
GRONINAC EQU   GROUP+34
GROERRTS EQU   GROUP+56
NGVR     EQU   0
NGVNAME  EQU   NGVR
NGVRTYPE EQU   NGVR+13
BCDV     EQU   0
BCDNAME  EQU   BCDV
BCDPREFX EQU   BCDNAME
BCDID    EQU   BCDNAME+11
BCDFLAGA EQU   BCDV+14
BCDTYPE  EQU   BCDFLAGA
BCDBASE  EQU   BCDTYPE
BCDCOPY  EQU   BCDTYPE
BCDDUP   EQU   BCDTYPE
BCDFLAGB EQU   BCDFLAGA+2
BCDRCVYF EQU   BCDV+20
BCDSATIA EQU   BCDRCVYF
BCDMISCF EQU   BCDRCVYF+2
BCDCSN1  EQU   BCDV+24
BCDLIB1  EQU   BCDV+36
BCDLID1  EQU   BCDLIB1
BCDCSN2  EQU   BCDV+37
BCDLIB2  EQU   BCDV+49
BCDLID2  EQU   BCDLIB2
BASEV    EQU   0
BASNAME  EQU   BASEV
BASSERNO EQU   BASNAME+5
BASID    EQU   BASNAME+11
BASFLAGA EQU   BASEV+14
BASTYPE  EQU   BASFLAGA
BASGRPV  EQU   BASFLAGA+2
BASGENUS EQU   BASFLAGA+2
BASRSTD  EQU   BASFLAGA+2
BASINAC  EQU   BASFLAGA+2
BASREASS EQU   BASFLAGA+3
BASFIRST EQU   BASFLAGA+3
BASLAST  EQU   BASFLAGA+3
BASRCVYF EQU   BASEV+20
BASSATIA EQU   BASRCVYF
BASMISCF EQU   BASRCVYF+2
BASLIB1  EQU   BASEV+36
BASLID1  EQU   BASLIB1
BASLIB2  EQU   BASEV+49
BASLID2  EQU   BASLIB2
BASPREV  EQU   BASEV+50
BASNEXTV EQU   BASEV+56
BASNCOPY EQU   BASEV+62
BASKLCPY EQU   BASEV+76
BASCOPID EQU   BASKLCPY+11
BASEXPDT EQU   BASEV+96
BASGROUP EQU   BASEV+180
COPYV    EQU   0
COPNAME  EQU   COPYV
COPID    EQU   COPNAME+11
COPFLAGA EQU   COPYV+14
COPTYPE  EQU   COPFLAGA
COPRCVYF EQU   COPYV+20
COPSATIA EQU   COPRCVYF
COPMISCF EQU   COPRCVYF+2
COPLIB1  EQU   COPYV+36
COPLID1  EQU   COPLIB1
COPLIB2  EQU   COPYV+49
COPLID2  EQU   COPLIB2
DUPV     EQU   0
DUPNAME  EQU   DUPV
DUPD     EQU   DUPNAME
DUPSERNO EQU   DUPNAME+5
DUPID    EQU   DUPNAME+11
DUPFLAGA EQU   DUPV+14
DUPTYPE  EQU   DUPFLAGA
DUPRCVYF EQU   DUPV+20
DUPLIB1  EQU   DUPV+36
DUPLID1  EQU   DUPLIB1
DUPLIB2  EQU   DUPV+49
DUPLID2  EQU   DUPLIB2
LSTNULLC EQU   0
NULFLAGA EQU   LSTNULLC+6
NULVOL   EQU   NULFLAGA
NULVOLID EQU   LSTNULLC+8
NULCSN   EQU   LSTNULLC+20
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS
NULRES2  EQU   LSTNULLC+32
NULECB   EQU   LSTNULLC+16
NULASID  EQU   LSTNULLC+14
@NM00025 EQU   NULFLAGA
NULCART2 EQU   NULFLAGA
NULCART1 EQU   NULFLAGA
@NM00024 EQU   NULFLAGA
NULSCRC  EQU   NULFLAGA
NULTRAN  EQU   NULFLAGA
NULRES1  EQU   LSTNULLC+5
NULORDER EQU   LSTNULLC+4
NULENGTH EQU   LSTNULLC
@NM00023 EQU   DUPV+50
DUP2BIT2 EQU   DUPLID2
DUP2BIT1 EQU   DUPLID2
DUPRES4  EQU   DUPLIB2
DUPCSN2  EQU   DUPV+37
DUP1BIT2 EQU   DUPLID1
DUP1BIT1 EQU   DUPLID1
DUPRES3  EQU   DUPLIB1
DUPCSN1  EQU   DUPV+24
DUPMISCF EQU   DUPRCVYF+2
DUPSATIA EQU   DUPRCVYF
@NM00022 EQU   DUPV+18
@NM00021 EQU   DUPFLAGA+2
DUPRES2  EQU   DUPTYPE
DUPDUPLR EQU   DUPTYPE
DUPRES1  EQU   DUPTYPE
DUPRES5  EQU   DUPV+13
DUPNO    EQU   DUPID+1
DUPBLANK EQU   DUPID
@NM00020 EQU   COPYV+136
COPFREXT EQU   COPYV+132
COPLEXT  EQU   COPYV+130
COPFRESP EQU   COPYV+128
COPOWNER EQU   COPYV+118
COPDEST  EQU   COPYV+88
COPDESCR EQU   COPYV+58
COPDTREM EQU   COPYV+54
COPDATE  EQU   COPYV+50
COP2BIT2 EQU   COPLID2
COP2BIT1 EQU   COPLID2
COPRES5  EQU   COPLIB2
COPCSN2  EQU   COPYV+37
COP1BIT2 EQU   COPLID1
COP1BIT1 EQU   COPLID1
COPRES4  EQU   COPLIB1
COPCSN1  EQU   COPYV+24
@NM00019 EQU   COPMISCF
COPHOLD  EQU   COPMISCF
COPRES3  EQU   COPSATIA
COPVSMIS EQU   COPSATIA
COPIVCPY EQU   COPSATIA
COPIVCRE EQU   COPSATIA
@NM00018 EQU   COPYV+18
@NM00017 EQU   COPFLAGA+3
COPDLSPF EQU   COPFLAGA+3
COPRONLY EQU   COPFLAGA+3
COPDAERA EQU   COPFLAGA+2
COPEXCL  EQU   COPFLAGA+2
COPBIND  EQU   COPFLAGA+2
COPBKUP  EQU   COPFLAGA+2
COPRSTD  EQU   COPFLAGA+2
COPGENUS EQU   COPFLAGA+2
COPVSAM  EQU   COPFLAGA+2
COPGROUP EQU   COPFLAGA+2
COPRES2  EQU   COPTYPE
COPCOPYV EQU   COPTYPE
COPRES1  EQU   COPTYPE
COPRES6  EQU   COPYV+13
COPNO    EQU   COPID+1
COPBLANK EQU   COPID
COPSERNO EQU   COPNAME+5
COPV     EQU   COPNAME
@NM00016 EQU   BASEV+192
BASXPDT2 EQU   BASEV+188
BASRECOV EQU   BASEV+174
BASDEST  EQU   BASEV+144
BASOWNER EQU   BASEV+134
BASDESCR EQU   BASEV+104
BASDTREM EQU   BASEV+100
BASDLMTD EQU   BASEV+92
BASRES6  EQU   BASEV+89
BASCOPNO EQU   BASCOPID+1
BASCOPBK EQU   BASCOPID
BASCOPSN EQU   BASKLCPY+5
BASCOPV  EQU   BASKLCPY
BASFREXT EQU   BASEV+72
BASLEXT  EQU   BASEV+70
BASFRESP EQU   BASEV+68
@NM00015 EQU   BASEV+65
BASBKLMT EQU   BASEV+64
BASNBKUP EQU   BASEV+63
BAS2BIT2 EQU   BASLID2
BAS2BIT1 EQU   BASLID2
BASRES5  EQU   BASLIB2
BASCSN2  EQU   BASEV+37
BAS1BIT2 EQU   BASLID1
BAS1BIT1 EQU   BASLID1
BASRES4  EQU   BASLIB1
BASCSN1  EQU   BASEV+24
BASRES3  EQU   BASMISCF
BASHOLD  EQU   BASMISCF
BASRES8  EQU   BASSATIA
BASVSMIS EQU   BASSATIA
BASIVCPY EQU   BASSATIA
BASIVCRE EQU   BASSATIA
BASCPUID EQU   BASEV+18
@NM00014 EQU   BASFLAGA+3
BASRONLY EQU   BASFLAGA+3
BASDAERA EQU   BASFLAGA+3
BASEXCL  EQU   BASFLAGA+2
BASBIND  EQU   BASFLAGA+2
BASNOCPY EQU   BASFLAGA+2
BASDLSF  EQU   BASFLAGA+2
BASRES2  EQU   BASTYPE
BASBASVR EQU   BASTYPE
BASRES1  EQU   BASTYPE
BASRES7  EQU   BASEV+13
BASZERO  EQU   BASID+1
BASBLANK EQU   BASID
BASEVKEY EQU   BASNAME
BCD2BIT2 EQU   BCDLID2
BCD2BIT1 EQU   BCDLID2
BCDRES8  EQU   BCDLIB2
BCD1BIT2 EQU   BCDLID1
BCD1BIT1 EQU   BCDLID1
BCDRE10  EQU   BCDLIB1
BCDRES7A EQU   BCDMISCF
BCDHOLD  EQU   BCDMISCF
BCDRES7  EQU   BCDSATIA
BCDVSMIS EQU   BCDSATIA
BCDIVCPY EQU   BCDSATIA
BCDIVCRE EQU   BCDSATIA
BCDCPUID EQU   BCDV+18
BCDRES5  EQU   BCDFLAGB+1
BCDREASS EQU   BCDFLAGB+1
BCDRES4  EQU   BCDFLAGB
BCDRES3  EQU   BCDTYPE
BCDRES2  EQU   BCDTYPE
BCDRES1  EQU   BCDTYPE
BCDRES9  EQU   BCDV+13
BCDINDEX EQU   BCDID+1
BCDBLNK2 EQU   BCDID
BCDSERNO EQU   BCDNAME+5
BCDBLNK1 EQU   BCDPREFX+1
BCDALPHA EQU   BCDPREFX
@NM00013 EQU   NGVR+32
NGVNOVOL EQU   NGVR+30
@NM00012 EQU   NGVR+29
NGVLVOL  EQU   NGVR+23
NGVFVOL  EQU   NGVR+17
@NM00011 EQU   NGVR+15
NGVRES2  EQU   NGVRTYPE+1
NGVHDR   EQU   NGVRTYPE
NGVRES1  EQU   NGVRTYPE
@NM00010 EQU   GROUP+136
GROADDR  EQU   GROUP+106
GROOWNER EQU   GROUP+96
GRORESSP EQU   GROUP+95
GROCONUS EQU   GROUP+94
GRODESCR EQU   GROUP+64
GROERRTM EQU   GROERRTS+4
GROERRDT EQU   GROERRTS
GRORETPD EQU   GROUP+52
GROFREXT EQU   GROUP+48
GROFRESP EQU   GROUP+44
GROSTRSH EQU   GROUP+40
GROSSPD  EQU   GROUP+38
GROPSPD  EQU   GROUP+36
GROPCENT EQU   GROUP+29
GROLSN   EQU   GROUP+23
GROFSN   EQU   GROUP+17
@NM00009 EQU   GROFLAGA+2
GROMSG1  EQU   GROFLAGA+2
GRORETN  EQU   GROFLAGA+2
GRORLSE  EQU   GROFLAGA+2
GRORONLY EQU   GROFLAGA+2
GRODAERA EQU   GROFLAGA+2
GROEXCL  EQU   GROFLAGA+2
GROBIND  EQU   GROFLAGA+2
GRORES1  EQU   GROTYPE
GROGVR   EQU   GROTYPE
GROZERO  EQU   GROID+1
GROBLANK EQU   GROID
GROVVGRP EQU   GRONAME+3
GROG     EQU   GRONAME
@NM00008 EQU   INDEX+28
INDEXREC EQU   INDRECID+1
INDBLNK2 EQU   INDRECID
INDVSRNO EQU   INDRECKY+5
INDBLNK1 EQU   INDPREFX+1
INDALPHA EQU   INDPREFX
INDRES2  EQU   INDTYPE
INDINDEX EQU   INDTYPE
INDRES1  EQU   INDTYPE
INDSERNO EQU   INDNAME+1
INDI     EQU   INDNAME
@NM00007 EQU   RPLVSAM+44
@NM00006 EQU   RPLVOPT
@NM00005 EQU   RPLVOPT
RPLVNEXT EQU   RPLVOPT
@NM00004 EQU   RPLVSAM+28
RPLVACB  EQU   RPLVSAM+24
@NM00003 EQU   RPLVSAM+3
@NM00002 EQU   RPLVSAM
@NM00001 EQU   RPLV+38
RPLRMSCC EQU   RPLV+36
RPLVTLEN EQU   RPLV+30
RPLVRES1 EQU   RPLFLAGA+1
RPLVJRNL EQU   RPLFLAGA
RPLJRCVY EQU   RPLFLAGA
RPLVVOP  EQU   RPLFLAGA
RPLVVIN  EQU   RPLFLAGA
RPLVCOMP EQU   RPLFLAGA
RPLVPROG EQU   RPLFLAGA
RPLVPOST EQU   RPLFLAGA
RPLFTIME EQU   RPLFLAGA
RPLVRSV3 EQU   RPLV+24
RPLVRSV2 EQU   RPLV+20
RPLVRSV1 EQU   RPLV+16
RPLASCBP EQU   RPLTCBPR
RPLVECB  EQU   RPLV+4
RPLVQPTR EQU   RPLV
VVIUNUSD EQU   VVICB+116
VVINUSDC EQU   VVICB+112
VVITPFCH EQU   VVICB+108
VVIDVMEL EQU   VVICB+104
VVIVBSTF EQU   VVICB+100
VVISSOBA EQU   VVICB+96
VVIVSCRA EQU   VVICB+92
VVISTPTB EQU   VVICB+88
VVIDVMTA EQU   VVICB+84
VVIJUCB  EQU   VVICB+80
VVIIUCB  EQU   VVICB+76
VVIRES6  EQU   VVICB+72
VVIRES5  EQU   VVICB+68
VVIRES4  EQU   VVICB+64
VVIUCB   EQU   VVICB+60
VVIVJL   EQU   VVICB+56
VVIVRR   EQU   VVICB+52
VVIQLSPL EQU   VVICB+48
VVIQRPL2 EQU   VVICB+44
VVIQRPL1 EQU   VVICB+40
VVIRES3  EQU   VVICB+36
VVIVQMP  EQU   VVICB+32
VVIECB1  EQU   VVICB+28
VVICATAD EQU   VVICB+24
VVIDCBAD EQU   VVICB+20
VVIACBAD EQU   VVICB+16
VVIFLG7  EQU   VVIFLGA
VVIFLG6  EQU   VVIFLGA
VVIFLG5  EQU   VVIFLGA
VVIFLG4  EQU   VVIFLGA
VVIFLG3  EQU   VVIFLGA
VVIFLG2  EQU   VVIFLGA
VVIFLG1  EQU   VVIFLGA
VVIALCON EQU   VVICB+14
VVICPUID EQU   VVICB+12
VVIUCAT  EQU   VVICB+4
VVICID   EQU   VVICB
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS
@RF00130 EQU   @EL00001
@RF00144 EQU   @EL00001
@RT00171 EQU   @EL00002
@RT00179 EQU   @EL00002
@RT00200 EQU   @EL00003
@RT00203 EQU   @EL00003
@RT00212 EQU   @EL00003
@RF00219 EQU   @EL00003
@RT00231 EQU   @EL00004
@RT00238 EQU   @EL00004
@RT00246 EQU   @EL00004
@RT00261 EQU   @EL00005
@RT00275 EQU   @EL00005
@RF00256 EQU   @EL00005
@RF00277 EQU   @EL00005
@RT00327 EQU   @EL00008
@RT00349 EQU   @EL00009
@RT00384 EQU   @EL00012
@RT00389 EQU   @EL00012
@RT00393 EQU   @EL00012
@RT00400 EQU   @EL00012
@RT00419 EQU   @EL00012
@RF00425 EQU   @EL00012
@RT00437 EQU   @EL00012
@RT00441 EQU   @EL00012
@RT00451 EQU   @EL00012
@ENDDATA EQU   *
         END   ICBVUT03,(C'PLS2137',0603,76280)

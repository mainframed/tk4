TM00     TITLE '********  ICBVTM00:  MSVC TERMINATION PROCESSOR MODULE *
                 *******'
ICBVTM00 CSECT ,                                                   0001
@MAINENT DS    0H                                                  0001
         USING *,@15                                               0001
         B     @PROLOG                                             0001
         DC    AL1(16)                                             0001
         DC    C'ICBVTM00  76.275'                                 0001
         DROP  @15
@PROLOG  STM   @14,@12,12(@13)                                     0001
         BALR  @12,0                                               0001
@PSTART  DS    0H                                                  0001
         USING @PSTART,@12                                         0001
         ST    @13,@SA00001+4                                      0001
         LA    @14,@SA00001                                        0001
         ST    @14,8(,@13)                                         0001
         LR    @13,@14                                             0001
*   RPLVPTR=REG1;                   /*                       @G24LB37*/
         LR    RPLVPTR,REG1                                        0044
*   RFY                                                            0045
*     REG1 UNRESTRICTED;            /*                       @G24LB37*/
*   VVIPTR=RPLVVICB;                /*                       @G24LB37*/
         L     VVIPTR,RPLVVICB(,RPLVPTR)                           0046
*   TRMRBPTR=ADDR(RPLVUTIL);        /*                       @G24LB37*/
         LA    TRMRBPTR,RPLVUTIL(,RPLVPTR)                         0047
*   VTMTBPTR=TRMSTHDR;              /*                       @G24LB37*/
         L     VTMTBPTR,TRMSTHDR(,TRMRBPTR)                        0048
*   RETCODE=ZERO;                   /*                       @G24LB37*/
*                                                                  0049
         SLR   RETCODE,RETCODE                                     0049
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THE MSVI INVENTORY DATA SET IS NOT DISABLED THEN   @G24LB37*/
*   /* THE PROCEXT PROCEDURE IS CALLED TO PROCESS THE STEP   @G24LB37*/
*   /* TABLE DD ENTRIES BY ADDING BACK THE SUBTRACTED SPACE  @G24LB37*/
*   /* WITHIN THE GROUP EXTENSION RECORD.                    @G24LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0050
*   IF VVIFLG0=OFF THEN                                            0050
         TM    VVIFLG0(VVIPTR),B'10000000'                         0050
         BNZ   @RF00050                                            0050
*     CALL PROCEXT;                 /*                       @G24LB37*/
*                                                                  0051
         BAL   @14,PROCEXT                                         0051
*   /*****************************************************************/
*   /*                                                               */
*   /* SET THE FLAG BIT IN THE STEP TABLE HEADER ENTRY       @G24LB37*/
*   /* STPNOFRE TO OFF, INDICATING THE STEP TABLE ENTRY      @G24LB37*/
*   /* CAN BE DELETED.                                       @G24LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0052
*   STPNOFRE=OFF;                   /*                       @G24LB37*/
*                                                                  0052
@RF00050 NI    STPNOFRE(VTMTBPTR),B'10111111'                      0052
*   /*****************************************************************/
*   /*                                                               */
*   /* RETURN TO CALLER. RETURN CODE IS IGNORED BY THE       @G24LB37*/
*   /* CALLER (ICBVCR00).                                    @G24LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0053
*   RETURN;                         /* RETURN TO CALLER      @G24LB37*/
@EL00001 L     @13,4(,@13)                                         0053
@EF00001 DS    0H                                                  0053
@ER00001 LM    @14,@12,12(@13)                                     0053
         BR    @14                                                 0053
*                                                                  0054
*/********************************************************************/
*/*                                                                  */
*/*     PROCEDURE NAME - PROCEXT                             @G24LB37*/
*/*                                                          @G24LB37*/
*/*     FUNCTION - THIS PROCEDURE CALLS READEXT, SPACEUPT,   @G24LB37*/
*/*                AND WRITEXT TO UPDATE THE GROUP EXTENSION @G24LB37*/
*/*                RECORD, AND RETURNS TO ICBVTM00.  BECAUSE @G24LB37*/
*/*                THE VOLUMES APPROXIMATE RUNNING SPACE     @G24LB37*/
*/*                VALUES TO UPDATE CAN BE IN SEVERAL DIF-   @G24LB37*/
*/*                FERENT GVSNE RECORDS AND BECAUSE THE LAST @G24LB37*/
*/*                RECORD READ FOR UPDATE HAS TO BE WRITTEN  @G24LB37*/
*/*                BEFORE THE NEXT RECORD CAN BE READ, THE   @G24LB37*/
*/*                GVSNE TO BE PROCESSED HAS TO BE CONTROL-  @G24LB37*/
*/*                LED.  PROCEXT MUST KEEP TRACK OF WHICH    @G24LB37*/
*/*                RECORD WAS READ AND IF SO, HAS IT BEEN    @G24LB37*/
*/*                WRITTEN.  PROCEXT TO ACCOMPLISH THIS WILL @G24LB37*/
*/*                KEEP TRACK OF THE LAST GVSNE READ AND UP- @G24LB37*/
*/*                DATED IN THE STEP TABLE, BY SAVE AREAS IN @G24LB37*/
*/*                THIS MODULE.  WHEN THE GVSNE IN THE STEP  @G24LB37*/
*/*                TABLE CHANGES THEN PROCEXT WILL WRITE THE @G24LB37*/
*/*                OLD GVSNE RECORD AND READ, FOR THE STEP   @G24LB37*/
*/*                TABLE, THE NEW GVSNE RECORD.              @G24LB37*/
*/*                                                          @G24LB37*/
*/*     INPUT - THE POINTER TO THE STEP TABLE HEADER ENTRY   @G24LB37*/
*/*             TO PROCESS.                                  @G24LB37*/
*/*                                                          @G24LB37*/
*/*     OUTPUT -  THE GVSMTDSP FIELD IN THE GVSNE IS UPDATED @G24LB37*/
*/*               FOR EACH DD ENTRY FOUND IN THE STEP TABLE  @G24LB37*/
*/*               REQUIRING AN UPDATE.                       @G24LB37*/
*/*                                                                  */
*/********************************************************************/
*                                                                  0054
*PROCEXT:                                                          0054
*   PROCEDURE OPTIONS(SAVE(REG14)); /*                       @G24LB37*/
PROCEXT  ST    @14,@SA00002                                        0054
*                                                                  0055
*   /*****************************************************************/
*   /*                                                               */
*   /* INITIALIZE TO THE BEGINNING OF THE STEP TABLE DD      @G24LB37*/
*   /* ENTRIES (STPDDENT). SET THE INTERNAL RESERVE FLAG     @G24LB37*/
*   /* TO ON INDICATING TO READEXT TO CALL ICBVRR00 TO       @G24LB37*/
*   /* RESERVE THE MSVI DATA SET, IF READEXT IS CALLED.      @G24LB37*/
*   /* INITIALIZE THE SAVE AREAS FOR THE GROUP NAME AND      @G24LB37*/
*   /* GROUP INDEX TO NULL VALUES, INDICATING FIRST TIME     @G24LB37*/
*   /* THROUGH. THE RECORD UPDATE FLAG IS TURNED OFF.        @G24LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0055
*   RFY                                                            0055
*     STPDDENT BASED(VTMDDPTR);     /*                       @G24LB37*/
*   VTMDDPTR=STPDDPTR;              /*                       @G24LB37*/
         L     VTMDDPTR,STPDDPTR(,VTMTBPTR)                        0056
*   GVSNEPTR=ADDR(GVSNEBUF);        /*                       @G24LB37*/
         LA    GVSNEPTR,GVSNEBUF                                   0057
*   SAVEAGRP=''B;                   /*                       @G24LB37*/
         XC    SAVEAGRP(12),SAVEAGRP                               0058
*   RESERVEF=ON;                    /*                       @G24LB37*/
*   RECUPDTF=OFF;                   /*                       @G24LB37*/
*                                                                  0060
         OI    RESERVEF,B'10000000'                                0060
         NI    RECUPDTF,B'10111111'                                0060
*   /*****************************************************************/
*   /*                                                               */
*   /* SCAN THE STEP TABLE DD ENTRIES TO LOCATE ANY ENTRIES  @G24LB37*/
*   /* THAT REQUIRE ADDING BACK SPACE IN THE GROUP EXTENSION @G24LB37*/
*   /* RECORDS (GVSNE).                                      @G24LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0061
*   DO WHILE VTMDDPTR^=ZERO;        /*                       @G24LB37*/
*                                                                  0061
         B     @DE00061                                            0061
@DL00061 DS    0H                                                  0062
*     /***************************************************************/
*     /*                                                             */
*     /* IF THE STEP TABLE DD ENTRY FIELD IS NOT ZERO,       @G24LB37*/
*     /* INDICATING SPACE HAS BEEN SUBTRACTED DURING THE     @G24LB37*/
*     /* SELECTION PROCESS AND REQUIRES THE GVSNE FIELD      @G24LB37*/
*     /* GVSMTDSP FIELD TO BE UPDATED, THEN PROCESS THE      @G24LB37*/
*     /* STEP TABLE DD ENTRY.                                @G24LB37*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0062
*     IF STPDDPRM^=ZERO THEN                                       0062
         LH    @03,STPDDPRM(,VTMDDPTR)                             0062
         LTR   @03,@03                                             0062
         BZ    @RF00062                                            0062
*       DO;                         /*                       @G24LB37*/
*                                                                  0064
*         /***********************************************************/
*         /*                                                         */
*         /* IF THE SAVED GROUP NAME AND INDEX ARE NOT EQUAL @G24LB37*/
*         /* TO THE CURRENT GROUP NAME AND INDEX, AND THE    @G24LB37*/
*         /* RECORD UPDATED FLAG IS ON FOR THE CURRENT GROUP @G24LB37*/
*         /* NAME AND INDEX, THEN WRITEXT IS CALLED TO WRITE @G24LB37*/
*         /* THE GROUP EXTENSION RECORD BACK OUT TO THE MSVI @G24LB37*/
*         /* DATA SET.                                       @G24LB37*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  0064
*         IF(SAVEGRPN^=STPDDGPN×SAVEINDX^=STPDDGPI)&RECUPDTF=ON THEN
         CLC   SAVEGRPN(8),STPDDGPN(VTMDDPTR)                      0064
         BNE   @GL00001                                            0064
         CLC   SAVEINDX(1),STPDDGPI(VTMDDPTR)                      0064
         BE    @RF00064                                            0064
@GL00001 TM    RECUPDTF,B'01000000'                                0064
         BNO   @RF00064                                            0064
*           DO;                     /*                       @G24LB37*/
*             CALL WRITEXT;         /*                       @G24LB37*/
*                                                                  0066
         BAL   @14,WRITEXT                                         0066
*             /*******************************************************/
*             /*                                                     */
*             /* UPON RETURN, INITIALIZE THE SAVE AREAS FOR  @G24LB37*/
*             /* THE GROUP NAME AND INDEX TO NULL VALUES.    @G24LB37*/
*             /* SET THE RECORD UPDATED FLAG TO OFF.         @G24LB37*/
*             /*                                                     */
*             /*******************************************************/
*                                                                  0067
*             SAVEAGRP=''B;         /*                       @G24LB37*/
         XC    SAVEAGRP(12),SAVEAGRP                               0067
*             RECUPDTF=OFF;         /*                       @G24LB37*/
         NI    RECUPDTF,B'10111111'                                0068
*           END;                    /*                       @G24LB37*/
*                                                                  0070
*         /***********************************************************/
*         /*                                                         */
*         /* IF THE SAVED GROUP NAME AND GROUP INDEX ARE     @G24LB37*/
*         /* NULL VALUES, THEN THE READEXT PROCEDURE IS      @G24LB37*/
*         /* CALLED TO READ THE GROUP EXTENSION RECORD.      @G24LB37*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  0070
*         IF(SAVEGRPN=NULLAREA&SAVEINDX=NULLAREA(ONE:ONE)) THEN    0070
@RF00064 CLC   SAVEGRPN(8),NULLAREA                                0070
         BNE   @RF00070                                            0070
         CLC   SAVEINDX(1),NULLAREA                                0070
         BNE   @RF00070                                            0070
*           DO;                     /*                       @G24LB37*/
*             CALL READEXT;         /*                       @G24LB37*/
*                                                                  0072
         BAL   @14,READEXT                                         0072
*             /*******************************************************/
*             /*                                                     */
*             /* IF THE RETURN CODE IS ZERO UPON RETURN,     @G24LB37*/
*             /* THEN SET THE NEW VALUES GROUP NAME, INDEX,  @G24LB37*/
*             /* AND SLOT INTO THE APPROPRIATE SAVE AREAS.   @G24LB37*/
*             /*                                                     */
*             /*******************************************************/
*                                                                  0073
*             IF RETCODE=ZERO THEN                                 0073
         LTR   RETCODE,RETCODE                                     0073
         BNZ   @RF00073                                            0073
*               DO;                 /*                       @G24LB37*/
*                 SAVEGRPN=STPDDGPN;/*                       @G24LB37*/
         MVC   SAVEGRPN(8),STPDDGPN(VTMDDPTR)                      0075
*                 SAVEINDX=STPDDGPI;/*                       @G24LB37*/
         MVC   SAVEINDX(1),STPDDGPI(VTMDDPTR)                      0076
*               END;                /*                       @G24LB37*/
*           END;                    /*                       @G24LB37*/
@RF00073 DS    0H                                                  0079
*                                                                  0079
*         /***********************************************************/
*         /*                                                         */
*         /* IF THE RETURN CODE IS ZERO, SPACEUPT IS CALLED  @G24LB37*/
*         /* TO CALCULATE THE AMOUNT OF CYLINDERS THAT       @G24LB37*/
*         /* SHOULD BE IN THE GVSNE FIELD GVSMTDSP AND       @G24LB37*/
*         /* UPDATES THAT SPACE IN THE GVSNE.                @G24LB37*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  0079
*         IF RETCODE=ZERO THEN                                     0079
@RF00070 LTR   RETCODE,RETCODE                                     0079
         BNZ   @RF00079                                            0079
*           DO;                     /*                       @G24LB37*/
*             CALL SPACEUPT;        /*                       @G24LB37*/
*                                                                  0081
         BAL   @14,SPACEUPT                                        0081
*             /*******************************************************/
*             /*                                                     */
*             /* IF SPACEUPT RETURNS A RETURN CODE OF ZERO,  @G24LB37*/
*             /* THEN THE RECORD UPDATE FLAG IS TURNED ON.   @G24LB37*/
*             /* IF THE RETURN CODE IS FOUR, THEN SET THE    @G24LB37*/
*             /* RETURN CODE TO ZERO.                        @G24LB37*/
*             /*                                                     */
*             /*******************************************************/
*                                                                  0082
*             IF RETCODE=ZERO THEN                                 0082
         LTR   RETCODE,RETCODE                                     0082
         BNZ   @RF00082                                            0082
*               RECUPDTF=ON;        /*                       @G24LB37*/
         OI    RECUPDTF,B'01000000'                                0083
*             ELSE                                                 0084
*               RETCODE=ZERO;       /*                       @G24LB37*/
         B     @RC00082                                            0084
@RF00082 SLR   RETCODE,RETCODE                                     0084
*           END;                    /*                       @G24LB37*/
*                                                                  0085
*         /***********************************************************/
*         /*                                                         */
*         /* IF THE RETURN CODE IS NOT ZERO UPON RETURN,     @G24LB37*/
*         /* THEN PROCESS THE NEXT ENTRY, AFTER SETTING THE  @G24LB37*/
*         /* RETURN CODE TO ZERO.                            @G24LB37*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  0086
*         ELSE                                                     0086
*           RETCODE=ZERO;           /*                       @G24LB37*/
         B     @RC00079                                            0086
@RF00079 SLR   RETCODE,RETCODE                                     0086
*       END;                        /*                       @G24LB37*/
@RC00079 DS    0H                                                  0088
*                                                                  0088
*     /***************************************************************/
*     /*                                                             */
*     /* IF THE STPDDPRM FIELD IS ZERO OR THE FIELD          @G24LB37*/
*     /* GVSMTDSP WAS UPDATED, IN THE GVSNE, THEN GO BACK    @G24LB37*/
*     /* TO PROCESS THE NEXT STEP TABLE DD ENTRY.            @G24LB37*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0088
*     VTMDDPTR=STPDDNXT;            /*                       @G24LB37*/
@RF00062 L     VTMDDPTR,STPDDNXT(,VTMDDPTR)                        0088
*   END;                            /*                       @G24LB37*/
*                                                                  0089
@DE00061 LTR   VTMDDPTR,VTMDDPTR                                   0089
         BNZ   @DL00061                                            0089
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THE RECORD UPDATED FLAG IS ON, AND THE SAVE AREA   @G24LB37*/
*   /* FOR THE GROUP NAME IS NOT A NULL VALUE, THEN WRITEXT  @G24LB37*/
*   /* IS CALLED TO WRITE THE LAST EXTENSION RECORD BACK     @G24LB37*/
*   /* OUT TO THE MSVI DATA SET.                             @G24LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0090
*   IF RECUPDTF=ON&SAVEGRPN^=NULLAREA THEN                         0090
         TM    RECUPDTF,B'01000000'                                0090
         BNO   @RF00090                                            0090
         CLC   SAVEGRPN(8),NULLAREA                                0090
         BE    @RF00090                                            0090
*     CALL WRITEXT;                 /*                       @G24LB37*/
*                                                                  0091
         BAL   @14,WRITEXT                                         0091
*   /*****************************************************************/
*   /*                                                               */
*   /* RETURN TO CALLER, RETURN CODE IS IGNORED BY THE MAIN  @G24LB37*/
*   /* ROUTINE ICBVTM00.                                     @G24LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0092
*   RETURN;                         /* RET TO MAIN ROUTINE   @G24LB37*/
@EL00002 DS    0H                                                  0092
@EF00002 DS    0H                                                  0092
@ER00002 L     @14,@SA00002                                        0092
         BR    @14                                                 0092
*   END PROCEXT;                    /* END OF PROCEXT PROC   @G24LB37*/
         B     @EL00002                                            0093
*                                                                  0094
*/********************************************************************/
*/*                                                                  */
*/*     PROCEDURE NAME - READEXT                             @G24LB37*/
*/*                                                          @G24LB37*/
*/*     FUNCTION - THIS PROCEDURE CALLS ICBVRR00 TO RESERVE  @G24LB37*/
*/*                THE MSVI DATA SET IF THIS IS THE FIRST    @G24LB37*/
*/*                TIME CALLED, THEN CALLS ICBVIO00 TO READ  @G24LB37*/
*/*                THE GROUP EXTENSION RECORD, AND RETURNS   @G24LB37*/
*/*                TO THE PROCEXT PROCEDURE.                 @G24LB37*/
*/*                                                          @G24LB37*/
*/*     INPUT - THE POINTER TO THE STEP TABLE DD ENTRY TO    @G24LB37*/
*/*             PROCESS, CONTAINING THE GROUP NAME AND       @G24LB37*/
*/*             GROUP INDEX FIELDS.                          @G24LB37*/
*/*                                                          @G24LB37*/
*/*     OUTPUT -  THE GVSNEPTR FIELD POINTING TO THE GVSNE   @G24LB37*/
*/*               FOR THE DD ENTRY FOUND IN THE STEP TABLE   @G24LB37*/
*/*               REQUIRING AN UPDATE.  RETURN CODE IN       @G24LB37*/
*/*               RETCODE AREA AS FOLLOWS:                   @G24LB37*/
*/*               0 = SUCCESSFUL READ OF GROUP EXT RECORD.   @G24LB37*/
*/*               4 = UNSUCCESSFUL READ OF GROUP EXT RECORD. @G24LB37*/
*/*                                                                  */
*/********************************************************************/
*                                                                  0094
*READEXT:                                                          0094
*   PROCEDURE OPTIONS(SAVE(REG14)); /*                       @G24LB37*/
READEXT  ST    @14,@SA00003                                        0094
*                                                                  0095
*   /*****************************************************************/
*   /*                                                               */
*   /* BEFORE MSVI PROCESSING CAN START, IF THE RESERVE      @G24LB37*/
*   /* FLAG IS ON INDICATING THE FIRST TIME READEXT CALLED,  @G24LB37*/
*   /* THE MSVI DATA SET IS RESERVED FOR EXCLUSIVE USE BOTH  @G24LB37*/
*   /* FROM OTHER JOBS IN THE CPU PLUS JOBS IN OTHER CPU'S,  @G24LB37*/
*   /* BY CALLING ICBVRR00. TURN RESERVE FLAG OFF.           @G24LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0095
*   IF RESERVEF=ON THEN                                            0095
         TM    RESERVEF,B'10000000'                                0095
         BNO   @RF00095                                            0095
*     DO;                           /*                       @G24LB37*/
*       RFY                                                        0097
*        (REG0,                                                    0097
*         REG1) RESTRICTED;         /*                       @G24LB37*/
*       REG0=RESCODE;               /*                       @G24LB37*/
         LA    REG0,1                                              0098
*       REG1=RPLVPTR;               /*                       @G24LB37*/
         LR    REG1,RPLVPTR                                        0099
*       CALL ICBVRR00;              /*                       @G24LB37*/
         L     @15,@CV00220                                        0100
         BALR  @14,@15                                             0100
*       RFY                                                        0101
*        (REG0,                                                    0101
*         REG1) UNRESTRICTED;       /*                       @G24LB37*/
*       RESERVEF=OFF;               /*                       @G24LB37*/
         NI    RESERVEF,B'01111111'                                0102
*     END;                          /*                       @G24LB37*/
*                                                                  0103
*   /*****************************************************************/
*   /*                                                               */
*   /* BUILD THE MSVI KEY TO READ THE GROUP EXTENSION        @G24LB37*/
*   /* RECORD DIRECT.                                        @G24LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0104
*   GROUPNAM=STPDDGPN;              /*                       @G24LB37*/
@RF00095 MVC   GROUPNAM(8),STPDDGPN(VTMDDPTR)                      0104
*   GROUPIND=STPDDGPI;              /*                       @G24LB37*/
*                                                                  0105
         MVC   GROUPIND(1),STPDDGPI(VTMDDPTR)                      0105
*   /*****************************************************************/
*   /*                                                               */
*   /* BUILD THE RPLV TO READ THE GROUP EXTENSION RECORDS    @G24LB37*/
*   /* BY READING DIRECT FOR UPDATE, SINCE ALL INFORMATION   @G24LB37*/
*   /* IS LOCATED IN THE STEP TABLE DD ENTRY.                @G24LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0106
*   RPLVKEY=ADDR(GROUPKEY);         /* ADDRESS OF GROUP KEY  @G24LB37*/
         LA    @15,GROUPKEY                                        0106
         ST    @15,RPLVKEY(,RPLVPTR)                               0106
*   RPLVDIR=ON;                     /* READ DIRECT FLAG ON   @G24LB37*/
         OI    RPLVDIR(RPLVPTR),B'01000000'                        0107
*   RPLVUPD=ON;                     /* READ FOR UPDATE ON    @G24LB37*/
         OI    RPLVUPD(RPLVPTR),B'00000010'                        0108
*   RPLVTYP=RPLVREAD;               /* READ GROUP RECORD     @G24LB37*/
         MVI   RPLVTYP(RPLVPTR),X'00'                              0109
*   RPLVBUF=GVSNEPTR;               /* ADDRESS OF GVSNE      @G24LB37*/
         ST    GVSNEPTR,RPLVBUF(,RPLVPTR)                          0110
*   RPLVBLN=LENGTH(GVSNE);          /* LENGTH OF BUFFER      @G24LB37*/
         MVC   RPLVBLN(4,RPLVPTR),@CF00279                         0111
*   RFY                                                            0112
*     REG1 RESTRICTED;              /*                       @G24LB37*/
*   REG1=RPLVPTR;                   /*                       @G24LB37*/
         LR    REG1,RPLVPTR                                        0113
*   CALL ICBVIO00;                  /* READ GROUP EXT REC    @G24LB37*/
         L     @15,@CV00219                                        0114
         BALR  @14,@15                                             0114
*   RFY                                                            0115
*     REG1 UNRESTRICTED;            /*                       @G24LB37*/
*                                                                  0116
*   /*****************************************************************/
*   /*                                                               */
*   /* ICBVIO00 WILL ISSUE MESSAGES TO THE SPACE MANAGER     @G24LB37*/
*   /* SHOULD AN I/O ERROR OCCUR. IF THE RETURN CODE IS      @G24LB37*/
*   /* NOT A ZERO THEN SET RETURN CODE TO FOUR. IF THE       @G24LB37*/
*   /* RETURN CODE IS ZERO SET THE RETURN CODE TO ZERO.      @G24LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0116
*   IF RPLVRETC^=ZERO THEN                                         0116
         LH    @15,RPLVRETC(,RPLVPTR)                              0116
         N     @15,@CF00286                                        0116
         LTR   @15,@15                                             0116
         BZ    @RF00116                                            0116
*     RETCODE=FOUR;                 /*                       @G24LB37*/
         LA    RETCODE,4                                           0117
*   ELSE                                                           0118
*     RETCODE=ZERO;                 /*                       @G24LB37*/
*                                                                  0118
         B     @RC00116                                            0118
@RF00116 SLR   RETCODE,RETCODE                                     0118
*   /*****************************************************************/
*   /*                                                               */
*   /* RETURN TO CALLER, RETURN CODE IS SET IN RETCODE AREA. @G24LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0119
*   RETURN;                         /* RET TO PROCEXT PROC   @G24LB37*/
@EL00003 DS    0H                                                  0119
@EF00003 DS    0H                                                  0119
@ER00003 L     @14,@SA00003                                        0119
         BR    @14                                                 0119
*   END READEXT;                    /* END OF READEXT PROC   @G24LB37*/
         B     @EL00003                                            0120
*                                                                  0121
*/********************************************************************/
*/*                                                                  */
*/*     PROCEDURE NAME - SPACEUPT                            @G24LB37*/
*/*                                                          @G24LB37*/
*/*     FUNCTION - THIS PROCEDURE CALCULATES THE NUMBER OF   @G24LB37*/
*/*                CYLINDERS TO BE ADDED BACK IN THE RUNNING @G24LB37*/
*/*                FREE SPACE FIELD (WHICH IS APPROXIMATE    @G24LB37*/
*/*                FREE SPACE ON THE VOLUME) IN THE GROUP    @G24LB37*/
*/*                EXTENSION RECORD, AND RETURNS TO THE      @G24LB37*/
*/*                PROCEXT PROCEDURE.                        @G24LB37*/
*/*                                                          @G24LB37*/
*/*     INPUT - THE POINTER TO THE STEP TABLE DD ENTRY TO    @G24LB37*/
*/*             PROCESS, CONTAINING THE GROUP NAME, INDEX,   @G24LB37*/
*/*             SLOT, AND VOLSER FIELDS.                     @G24LB37*/
*/*                                                          @G24LB37*/
*/*     OUTPUT -  THE GVSMTDSP FIELD UPDATED FOR THE GVSNE   @G24LB37*/
*/*               SLOT INDEX FOUND IN THE STEP TABLE         @G24LB37*/
*/*               REQUIRING AN UPDATE.  RETURN CODE IN       @G24LB37*/
*/*               RETCODE AREA AS FOLLOWS:                   @G24LB37*/
*/*               0 = SUCCESSFUL UPDATE OF GROUP EXT RECORD. @G24LB37*/
*/*               4 = UNSUCCESSFUL UPDATE OF GROUP EXTENSION @G24LB37*/
*/*                   RECORD.                                @G24LB37*/
*/*                                                                  */
*/********************************************************************/
*                                                                  0121
*SPACEUPT:                                                         0121
*   PROCEDURE OPTIONS(SAVE(REG14)); /*                       @G24LB37*/
SPACEUPT ST    @14,12(,@13)                                        0121
*                                                                  0122
*   /*****************************************************************/
*   /*                                                               */
*   /* INITIALIZE RETCODE AREA TO ZERO. IF THE VOLSER IN     @G24LB37*/
*   /* THE GVSNE SLOT MATCHES THE ONE IN THE THE STEP TABLE, @G24LB37*/
*   /* THEN PROCESS THE SLOT IN THE GVSNE.                   @G24LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0122
*   RETCODE=ZERO;                   /*                       @G24LB37*/
         SLR   RETCODE,RETCODE                                     0122
*   IF GVSVOLID(STPDDGPS)=STPDDVOL(ONE) THEN                       0123
         SLR   @03,@03                                             0123
         IC    @03,STPDDGPS(,VTMDDPTR)                             0123
         MH    @03,@CH00280                                        0123
         ST    @03,@TF00001                                        0123
         ALR   @03,GVSNEPTR                                        0123
         CLC   GVSVOLID-20(6,@03),STPDDVOL(VTMDDPTR)               0123
         BNE   @RF00123                                            0123
*     DO;                           /*                       @G24LB37*/
*                                                                  0124
*       /*************************************************************/
*       /*                                                           */
*       /* THE FIELD STPDDPRM IN THE STEP TABLE DD ENTRY IS  @G24LB37*/
*       /* ADDED TO THE GVSNE FIELD GVSMTDSP POINTED TO BY   @G24LB37*/
*       /* THE SLOT INDEX PASSED BY THE PROCEXT PROCEDURE,   @G24LB37*/
*       /* AND THAT VALUE IS INSERTED BACK INTO THE GVSMTDSP @G24LB37*/
*       /* FIELD OF THE SAME SLOT.                           @G24LB37*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0125
*       GVSMTDSP(STPDDGPS)=GVSMTDSP(STPDDGPS)+STPDDPRM;/*    @G24LB37*/
*                                                                  0125
         L     @03,@TF00001                                        0125
         LH    @03,GVSMTDSP-20(@03,GVSNEPTR)                       0125
         AH    @03,STPDDPRM(,VTMDDPTR)                             0125
         L     @01,@TF00001                                        0125
         STH   @03,GVSMTDSP-20(@01,GVSNEPTR)                       0125
*       /*************************************************************/
*       /*                                                           */
*       /* BECAUSE OF THE APPROXIMATE AVAILABLE FREE SPACE   @G24LB37*/
*       /* VALUE BEING AN APPROXIMATE VALUE, IT IS POSSIBLE  @G24LB37*/
*       /* THAT THIS UPDATE MAY YIELD A VALUE GREATER THAN   @G24LB37*/
*       /* 403 (MAXIMUM CYLINDERS), WHICH IS A PHYSICAL      @G24LB37*/
*       /* IMPOSSIBILITY. IF THIS SITUATION EXISTS THE       @G24LB37*/
*       /* VALUE IS SET TO 403, WHICH WILL INDICATE THE      @G24LB37*/
*       /* ENTIRE VOLUME CAN BE USED.                        @G24LB37*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0126
*       IF GVSMTDSP(STPDDGPS)>MAXCYLIN THEN                        0126
         LA    @15,403                                             0126
         CR    @03,@15                                             0126
         BNH   @RF00126                                            0126
*         GVSMTDSP(STPDDGPS)=MAXCYLIN;/*                     @G24LB37*/
*                                                                  0127
         L     @03,@TF00001                                        0127
         STH   @15,GVSMTDSP-20(@03,GVSNEPTR)                       0127
*       /*************************************************************/
*       /*                                                           */
*       /* THE LSPACE VALUE IN THE GVSNE IS CHECKED TO MAKE  @G24LB37*/
*       /* SURE THE SPACE ADDED BACK IS NOT GREATER THAN THE @G24LB37*/
*       /* VALUE IN THE FIELD GVSFRESP.                      @G24LB37*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0128
*       IF GVSMTDSP(STPDDGPS)>GVSFRESP(STPDDGPS) THEN              0128
@RF00126 SLR   @03,@03                                             0128
         IC    @03,STPDDGPS(,VTMDDPTR)                             0128
         MH    @03,@CH00280                                        0128
         LH    @15,GVSFRESP-20(@03,GVSNEPTR)                       0128
         CH    @15,GVSMTDSP-20(@03,GVSNEPTR)                       0128
         BNL   @RF00128                                            0128
*         GVSMTDSP(STPDDGPS)=GVSFRESP(STPDDGPS);/*           @G24LB37*/
         STH   @15,GVSMTDSP-20(@03,GVSNEPTR)                       0129
*     END;                          /*                       @G24LB37*/
*                                                                  0131
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THE VOLSER DOES NOT MATCH THEN SET RETURN CODE TO  @G24LB37*/
*   /* FOUR AND DO NOT UPDATE THE SPACE FIELD.               @G24LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0131
*   ELSE                                                           0131
*     RETCODE=FOUR;                 /*                       @G24LB37*/
*                                                                  0131
         B     @RC00123                                            0131
@RF00123 LA    RETCODE,4                                           0131
*   /*****************************************************************/
*   /*                                                               */
*   /* RETURN TO CALLER, RETURN CODE IS SET IN RETCODE AREA. @G24LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0132
*   RETURN;                         /* RET TO PROCEXT PROC   @G24LB37*/
@EL00004 DS    0H                                                  0132
@EF00004 DS    0H                                                  0132
@ER00004 L     @14,12(,@13)                                        0132
         BR    @14                                                 0132
*   END SPACEUPT;                   /* END OF SPACEUPT PROC  @G24LB37*/
         B     @EL00004                                            0133
*                                                                  0134
*/********************************************************************/
*/*                                                                  */
*/*     PROCEDURE NAME - WRITEXT                             @G24LB37*/
*/*                                                          @G24LB37*/
*/*     FUNCTION - THIS PROCEDURE CALLS ICBVIO00 TO WRITE    @G24LB37*/
*/*                THE UPDATED GROUP EXTENSION RECORD, AND   @G24LB37*/
*/*                RETURNS TO THE PROCEXT PROCEDURE.         @G24LB37*/
*/*                                                          @G24LB37*/
*/*     INPUT - THE POINTER TO THE RPLV CONTAINING THE       @G24LB37*/
*/*             GROUP NAME AND GROUP INDEX FIELDS.           @G24LB37*/
*/*                                                          @G24LB37*/
*/*     OUTPUT -  THE GVSNE REQUIRING AN UPDATE IS WRITTEN   @G24LB37*/
*/*               TO THE MSVI DATA SET.  RETURN CODE IN      @G24LB37*/
*/*               RETCODE AREA AS FOLLOWS:                   @G24LB37*/
*/*               0 = SUCCESSFUL WRITE OF GROUP EXT RECORD.  @G24LB37*/
*/*                                                                  */
*/********************************************************************/
*                                                                  0134
*WRITEXT:                                                          0134
*   PROCEDURE OPTIONS(SAVE(REG14)); /*                       @G24LB37*/
WRITEXT  ST    @14,@SA00005                                        0134
*                                                                  0135
*   /*****************************************************************/
*   /*                                                               */
*   /* BUILD THE RPLV TO WRITE THE GROUP EXTENSION RECORD    @G24LB37*/
*   /* BY WRITING DIRECT FOR UPDATE, USING THE RPLV THAT WAS @G24LB37*/
*   /* USED FOR THE READ GROUP EXTENSION RECORD.             @G24LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0135
*   RPLVTYP=RPLVPUT;                /* WRITE GROUP RECORD    @G24LB37*/
         MVI   RPLVTYP(RPLVPTR),X'01'                              0135
*   RFY                                                            0136
*     REG1 RESTRICTED;              /*                       @G24LB37*/
*   REG1=RPLVPTR;                   /*                       @G24LB37*/
         LR    REG1,RPLVPTR                                        0137
*   CALL ICBVIO00;                  /* WRITE GROUP EXT REC   @G24LB37*/
         L     @15,@CV00219                                        0138
         BALR  @14,@15                                             0138
*   RFY                                                            0139
*     REG1 UNRESTRICTED;            /*                       @G24LB37*/
*                                                                  0139
*   /*****************************************************************/
*   /*                                                               */
*   /* ICBVIO00 WILL ISSUE MESSAGES TO THE SPACE MANAGER     @G24LB37*/
*   /* SHOULD AN I/O ERROR OCCUR. SET THE RETURN CODE TO     @G24LB37*/
*   /* ZERO.                                                 @G24LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0140
*   RETCODE=ZERO;                   /*                       @G24LB37*/
*                                                                  0140
         SLR   RETCODE,RETCODE                                     0140
*   /*****************************************************************/
*   /*                                                               */
*   /* RETURN TO CALLER, RETURN CODE IS SET IN RETCODE AREA. @G24LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0141
*   RETURN;                         /* RET TO PROCEXT PROC   @G24LB37*/
@EL00005 DS    0H                                                  0141
@EF00005 DS    0H                                                  0141
@ER00005 L     @14,@SA00005                                        0141
         BR    @14                                                 0141
*   END WRITEXT;                    /* END OF WRITEXT PROC   @G24LB37*/
*   END ICBVTM00                    /* END OF ICBVTM00       @G24LB37*/
*                                                                  0143
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.     */
*/*%INCLUDE SYSLIB  (IEZRPLV )                                       */
*/*%INCLUDE SYSLIB  (IEZVVICB)                                       */
*/*%INCLUDE SYSLIB  (IEZGVSNE)                                       */
*/*%INCLUDE SYSLIB  (IEZSTPTB)                                       */
*                                                                  0143
*       ;                                                          0143
@DATA    DS    0H
@CH00280 DC    H'20'
         DS    0F
@SA00001 DS    18F
@SA00002 DS    1F
@SA00003 DS    0F
@SA00005 DS    0F
         DS    1F
@TF00001 DS    F
         DS    0F
@CF00279 DC    F'988'
@CF00286 DC    XL4'0000FFFF'
@CV00219 DC    V(ICBVIO00)
@CV00220 DC    V(ICBVRR00)
         DS    0D
NULLAREA DC    X'0000000000000000'
VTM00SWS DS    CL2
         ORG   VTM00SWS
FOUNDSW  DS    BL1
@NM00016 EQU   VTM00SWS+0
         ORG   VTM00SWS+2
VTM00FGS DS    CL2
         ORG   VTM00FGS
RESERVEF DS    BL1
RECUPDTF EQU   VTM00FGS+0
@NM00017 EQU   VTM00FGS+0
         ORG   VTM00FGS+2
SAVEAGRP DS    CL12
         ORG   SAVEAGRP
SAVEGRPN DS    CL8
SAVEINDX DS    FL1
@NM00018 DS    CL3
         ORG   SAVEAGRP+12
GROUPKEY DS    CL13
         ORG   GROUPKEY
GROUPG   DC    CL3'G  '
GROUPNAM DS    CL8
GROUPBLK DC    CL1' '
GROUPIND DS    FL1
         ORG   GROUPKEY+13
         DS    CL3
GVSNEBUF DS    CL988
FIXAREA  DS    CL100
         ORG   FIXAREA
@NM00021 DC    100X'00'
         ORG   FIXAREA+100
@00      EQU   00                      EQUATES FOR REGISTERS 0-15
@01      EQU   01
@02      EQU   02
@03      EQU   03
@04      EQU   04
@05      EQU   05
@06      EQU   06
@07      EQU   07
@08      EQU   08
@09      EQU   09
@10      EQU   10
@11      EQU   11
@12      EQU   12
@13      EQU   13
@14      EQU   14
@15      EQU   15
RETCODE  EQU   @02
VTMDDPTR EQU   @04
VTMTBPTR EQU   @07
TRMRBPTR EQU   @02
GVSNEPTR EQU   @06
VVIPTR   EQU   @04
RPLVPTR  EQU   @05
REG0     EQU   @00
REG1     EQU   @01
REG14    EQU   @14
RPLV     EQU   0
RPLTCBPR EQU   RPLV+8
RPLVVICB EQU   RPLV+12
RPLFLAGA EQU   RPLV+28
RPLVRETC EQU   RPLV+34
RPLVSAM  EQU   RPLV+56
RPLVTYP  EQU   RPLVSAM+2
RPLVBUF  EQU   RPLVSAM+32
RPLVKEY  EQU   RPLVSAM+36
RPLVOPT  EQU   RPLVSAM+40
RPLVDIR  EQU   RPLVOPT
RPLVUPD  EQU   RPLVOPT+1
RPLVBLN  EQU   RPLVSAM+52
RPLVUTIL EQU   RPLV+132
VVICB    EQU   0
VVIFLGA  EQU   VVICB+15
VVIFLG0  EQU   VVIFLGA
GVSNE    EQU   0
GVSHDR   EQU   GVSNE
GVSNAME  EQU   GVSHDR
GVSID    EQU   GVSNAME+11
GVSFLAGA EQU   GVSHDR+13
GVSTYPE  EQU   GVSFLAGA
GVSSLOTS EQU   GVSNE+28
GVSVOLID EQU   GVSSLOTS
GVSVOLFL EQU   GVSSLOTS+6
GVSFRESP EQU   GVSSLOTS+10
GVSMTDSP EQU   GVSSLOTS+18
STPTB    EQU   0
STPFLAGS EQU   STPTB+14
STPNOFRE EQU   STPFLAGS
STPDDPTR EQU   STPTB+16
STPDDENT EQU   0
STPDDNXT EQU   STPDDENT
STPDDGPN EQU   STPDDENT+12
STPDDGPI EQU   STPDDENT+20
STPDDGPS EQU   STPDDENT+21
STPDDPRM EQU   STPDDENT+22
STPDDFLG EQU   STPDDENT+24
STPDDVOL EQU   STPDDENT+26
TRMRB    EQU   0
TRMFLAGS EQU   TRMRB+5
TRMSTHDR EQU   TRMRB+12
*                                      START UNREFERENCED COMPONENTS
TRMJOBID EQU   TRMRB+8
@NM00020 EQU   TRMRB+6
@NM00019 EQU   TRMFLAGS
TRMSCHAB EQU   TRMFLAGS
TRMALLOK EQU   TRMFLAGS
TRMRBOPC EQU   TRMRB+4
TRMRBLEN EQU   TRMRB
STPDDNVL EQU   STPDDENT+25
@NM00015 EQU   STPDDFLG
STPDDSPL EQU   STPDDFLG
STPDDEXC EQU   STPDDFLG
STPDDDVT EQU   STPDDENT+8
STPDDNUM EQU   STPDDENT+6
STPDDLEN EQU   STPDDENT+4
STPICCTR EQU   STPTB+15
@NM00014 EQU   STPFLAGS
STPINVAL EQU   STPFLAGS
STPHDRLN EQU   STPTB+12
STPJOBID EQU   STPTB+8
STPPRVTB EQU   STPTB+4
STPNXTTB EQU   STPTB
GVSEXPDT EQU   GVSSLOTS+14
GVSLEXT  EQU   GVSSLOTS+12
@NM00013 EQU   GVSVOLFL+2
GVSMTNSH EQU   GVSVOLFL+2
GVSRCFSI EQU   GVSVOLFL+2
GVSCPUBM EQU   GVSVOLFL
@NM00012 EQU   GVSHDR+20
GVSESIND EQU   GVSHDR+18
@NM00011 EQU   GVSHDR+17
@NM00010 EQU   GVSFLAGA+2
GVSEX    EQU   GVSFLAGA+2
@NM00009 EQU   GVSTYPE
GVSGVSEX EQU   GVSTYPE
@NM00008 EQU   GVSTYPE
GVSNO    EQU   GVSID+1
GVSRES1  EQU   GVSID
GVSVVGRP EQU   GVSNAME+3
GVSG     EQU   GVSNAME
VVIUNUSD EQU   VVICB+116
VVINUSDC EQU   VVICB+112
VVITPFCH EQU   VVICB+108
VVIDVMEL EQU   VVICB+104
VVIVBSTF EQU   VVICB+100
VVISSOBA EQU   VVICB+96
VVIVSCRA EQU   VVICB+92
VVISTPTB EQU   VVICB+88
VVIDVMTA EQU   VVICB+84
VVIJUCB  EQU   VVICB+80
VVIIUCB  EQU   VVICB+76
VVIRES6  EQU   VVICB+72
VVIRES5  EQU   VVICB+68
VVIRES4  EQU   VVICB+64
VVIUCB   EQU   VVICB+60
VVIVJL   EQU   VVICB+56
VVIVRR   EQU   VVICB+52
VVIQLSPL EQU   VVICB+48
VVIQRPL2 EQU   VVICB+44
VVIQRPL1 EQU   VVICB+40
VVIRES3  EQU   VVICB+36
VVIVQMP  EQU   VVICB+32
VVIECB1  EQU   VVICB+28
VVICATAD EQU   VVICB+24
VVIDCBAD EQU   VVICB+20
VVIACBAD EQU   VVICB+16
VVIFLG7  EQU   VVIFLGA
VVIFLG6  EQU   VVIFLGA
VVIFLG5  EQU   VVIFLGA
VVIFLG4  EQU   VVIFLGA
VVIFLG3  EQU   VVIFLGA
VVIFLG2  EQU   VVIFLGA
VVIFLG1  EQU   VVIFLGA
VVIALCON EQU   VVICB+14
VVICPUID EQU   VVICB+12
VVIUCAT  EQU   VVICB+4
VVICID   EQU   VVICB
RPLVRLN  EQU   RPLVSAM+48
@NM00007 EQU   RPLVSAM+44
@NM00006 EQU   RPLVOPT
RPLVKGE  EQU   RPLVOPT
@NM00005 EQU   RPLVOPT
RPLVNEXT EQU   RPLVOPT
RPLVLOC  EQU   RPLVOPT
@NM00004 EQU   RPLVSAM+28
RPLVACB  EQU   RPLVSAM+24
@NM00003 EQU   RPLVSAM+3
@NM00002 EQU   RPLVSAM
@NM00001 EQU   RPLV+38
RPLRMSCC EQU   RPLV+36
RPLRCODE EQU   RPLV+32
RPLVTLEN EQU   RPLV+30
RPLVRES1 EQU   RPLFLAGA+1
RPLVJRNL EQU   RPLFLAGA
RPLJRCVY EQU   RPLFLAGA
RPLVVOP  EQU   RPLFLAGA
RPLVVIN  EQU   RPLFLAGA
RPLVCOMP EQU   RPLFLAGA
RPLVPROG EQU   RPLFLAGA
RPLVPOST EQU   RPLFLAGA
RPLFTIME EQU   RPLFLAGA
RPLVRSV3 EQU   RPLV+24
RPLVRSV2 EQU   RPLV+20
RPLVRSV1 EQU   RPLV+16
RPLASCBP EQU   RPLTCBPR
RPLVECB  EQU   RPLV+4
RPLVQPTR EQU   RPLV
*                                      END UNREFERENCED COMPONENTS
@RC00082 EQU   @RC00079
@RF00090 EQU   @EL00002
@RC00116 EQU   @EL00003
@RC00123 EQU   @EL00004
@RF00128 EQU   @RC00123
@ENDDATA EQU   *
         END   ICBVTM00,(C'PLS0545',0603,76275)

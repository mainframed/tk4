         TITLE 'ICBVUT01 UTILITY MODULE  JUNE 10, 1976                 *
                        '
ICBVUT01 CSECT ,                                                   0001
@MAINENT DS    0H                                                  0001
         USING *,@15                                               0001
         B     @PROLOG                                             0001
         DC    AL2(@EP00001-@MAINENT)
         DC    AL1(16)                                             0001
         DC    C'ICBVUT01  77.062'                                 0001
ICBVUDBR DS    0H                                                  0001
         USING *,@15                                               0001
         B     @PROLOG                                             0001
         DC    AL2(@EP03087-ICBVUDBR)
         ENTRY ICBVUDBR
ICBVUEXT DS    0H                                                  0001
         USING *,@15                                               0001
         B     @PROLOG                                             0001
         DC    AL2(@EP03233-ICBVUEXT)
         ENTRY ICBVUEXT
ICBVUEXP DS    0H                                                  0001
         USING *,@15                                               0001
         B     @PROLOG                                             0001
         DC    AL2(@EP03489-ICBVUEXP)
         ENTRY ICBVUEXP
         DROP  @15
@PROLOG  STM   @14,@12,12(@13)                                     0001
         BALR  @12,0                                               0001
@PSTART  LA    @11,4095(,@12)                                      0001
         LA    @10,4095(,@11)                                      0001
         LA    @09,4095(,@10)                                      0001
         LA    @08,4095(,@09)                                      0001
         LA    @03,4095(,@08)                                      0001
         USING @PSTART,@12                                         0001
         USING @PSTART+4095,@11                                    0001
         USING @PSTART+8190,@10                                    0001
         USING @PSTART+12285,@09                                   0001
         USING @PSTART+16380,@08                                   0001
         USING @PSTART+20475,@03                                   0001
         ST    @13,@SA00001+4                                      0001
         LA    @14,@SA00001                                        0001
         ST    @14,8(,@13)                                         0001
         LR    @13,@14                                             0001
         AH    @15,4(,@15)                                         0001
         BR    @15                                                 0001
@EP00001 DS    0H                                                  0002
*   RPLVPTR=REG1;                   /* ADDR TO REQUEST BLK   @Y30LB26*/
         ST    REG1,RPLVPTR                                        0159
*   RESPECIFY                                                      0160
*     REG1 UNRSTD;                  /* FREE REG1             @Y30LB26*/
*   RVRPTR=ADDR(RPLVUTIL);          /* ADDR TO OP CD         @Y30LB26*/
         L     @05,RPLVPTR                                         0161
         LA    @02,RPLVUTIL(,@05)                                  0161
         ST    @02,RVRPTR                                          0161
*                                                                  0162
*   /*****************************************************************/
*   /*                                                               */
*   /* SET UP ADDRESSABILITY TO MSVC CONTROL BLK             @Y30LB26*/
*   /* AND CHECK TO SEE IF MSVC IS DISABLED                  @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0162
*   VVIPTR=RPLVVICB;                /* ADDR TO VVICB         @Y30LB26*/
         L     VVIPTR,RPLVVICB(,@05)                               0162
*   IF VVIFLG0=ON                   /* INVENTORY DISAB ?     @Y30LB26*/
*     THEN                          /*                       @Y30LB26*/
         TM    VVIFLG0(VVIPTR),B'10000000'                         0163
         BNO   @RF00163                                            0163
*     DO;                           /*                       @Y30LB26*/
*       RPLVRETC=FOUR;              /* SET BAD RET CODE      @Y30LB26*/
         MVC   RPLVRETC(2,@05),@CB00749                            0165
*       RPLRCODE=VVICDISA;          /* INDIC MSVC DISABLED   @Y30LB26*/
         MVC   RPLRCODE(2,@05),@CB00785                            0166
*       RETURN;                     /*                       @Y30LB26*/
@EL00001 L     @13,4(,@13)                                         0167
@EF00001 DS    0H                                                  0167
@ER00001 LM    @14,@12,12(@13)                                     0167
         BR    @14                                                 0167
*     END;                          /*                       @Y30LB26*/
*                                                                  0169
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK TO SEE IF JOURNAL IS DISABLED                   @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0169
*   IF VVIFLG2=ON&RPLJRCVY=OFF      /* JOURNAL DISABLED ?    @Y30LB26*/
*     THEN                          /*                       @Y30LB26*/
@RF00163 TM    VVIFLG2(VVIPTR),B'00100000'                         0169
         BNO   @RF00169                                            0169
         L     @05,RPLVPTR                                         0169
         TM    RPLJRCVY(@05),B'00000010'                           0169
         BNZ   @RF00169                                            0169
*     DO;                           /*                       @Y30LB26*/
*                                                                  0170
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK TO SEE IF READ ONLY ACCESS IS DESIRED       @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0171
*       IF RVROPCD^=READREC         /* READ ONLY OPER ?      @Y30LB26*/
*         THEN                      /*                       @Y30LB26*/
*                                                                  0171
         L     @02,RVRPTR                                          0171
         CLI   RVROPCD(@02),X'87'                                  0171
         BE    @RF00171                                            0171
*         /***********************************************************/
*         /*                                                         */
*         /* IF NOT READ ONLY, HAULT PROCESSING AND          @Y30LB26*/
*         /* SEND REASON CODE                                @Y30LB26*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  0172
*         DO;                       /*                       @Y30LB26*/
*           RPLVRETC=FOUR;          /* SET BAD RET CODE      @Y30LB26*/
         MVC   RPLVRETC(2,@05),@CB00749                            0173
*           RPLRCODE=JRNLDISA;      /* JOURNAL DISABLED      @Y30LB26*/
         MVC   RPLRCODE(2,@05),@CB00787                            0174
*           RETURN;                 /*                       @Y30LB26*/
         B     @EL00001                                            0175
*         END;                      /*                       @Y30LB26*/
*     END;                          /*                       @Y30LB26*/
@RF00171 DS    0H                                                  0178
*                                                                  0178
*   /*****************************************************************/
*   /*                                                               */
*   /* INITILIZE BIT SETTINGS BEFORE ENTRY                   @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0178
*   INTERFLG=BIT8ZERO;              /* CLEAR INTER FLGS      @Y30LB26*/
@RF00169 MVI   INTERFLG,X'00'                                      0178
*   PASSFLAG=BITZERO;               /* CLEAR EXTER ENT FLGS  @Y30LB26*/
*                                                                  0179
         MVC   PASSFLAG(2),@CB00747                                0179
*   /*****************************************************************/
*   /*                                                               */
*   /* INITILIZE KEY IDS THAT COULD HAVE BEEN ALTERED        @Y30LB26*/
*   /* IN A PREVIOUS EXECUTION OF THE PROGRAM                @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0180
*   VBLKKY=BLANK;                   /* CLEAR KEY             @Y30LB26*/
         MVI   VBLKKY,C' '                                         0180
*   VIDKY=FIXZERO;                  /* INIT ID FIELD         @Y30LB26*/
         MVI   VIDKY,X'00'                                         0181
*   GBLKKY=BLANK;                   /* CLEAR GRP KEY         @Y30LB26*/
         MVI   GBLKKY,C' '                                         0182
*   GIDKY=FIXZERO;                  /* INIT GRP ID FIELD     @Y30LB26*/
         MVI   GIDKY,X'00'                                         0183
*   DBLKKY=BLANK;                   /* CLEAR DUP KEY         @Y30LB26*/
         MVI   DBLKKY,C' '                                         0184
*   DIDKY=FIXZERO;                  /* INIT DUP ID FIELD     @Y30LB26*/
         MVI   DIDKY,X'00'                                         0185
*                                                                  0186
*   /*****************************************************************/
*   /*                                                               */
*   /* TEST FOR REMOVE VOLUME RECORD OPERATION CODE          @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0186
*   IF RVROPCD=REMOVOL              /* TEST OP CODE          @Y30LB26*/
*     THEN                          /*                       @Y30LB26*/
         L     @02,RVRPTR                                          0186
         CLI   RVROPCD(@02),X'81'                                  0186
         BNE   @RF00186                                            0186
*                                                                  0187
*     /***************************************************************/
*     /*                                                             */
*     /* CALL ROUTINE AND RETURN TO ICBVCR00                 @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0187
*     DO;                           /*                       @Y30LB26*/
*       CALL REMOVEVR;              /* REMOVE VOLUME REC     @Y30LB26*/
*                                                                  0188
         BAL   @14,REMOVEVR                                        0188
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK RETURN CODE AND IF BAD SEE IF JOURNALED     @VS32198*/
*       /* BEFORE. IF SO INDICATE THIS FACT.                 @VS32198*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0189
*       IF RPLVRETC^=RCZERO THEN    /* CK RETURN             @VS32198*/
         L     @02,RPLVPTR                                         0189
         CLC   RPLVRETC(2,@02),@CB00747                            0189
         BE    @RF00189                                            0189
*         DO;                       /*                       @VS32198*/
*           IF JRNLEDSW=ON THEN     /* JOURNALED BEFORE ?    @VS32198*/
         TM    JRNLEDSW,B'00000001'                                0191
         BNO   @RF00191                                            0191
*             RPLVJRNL=ON;          /* INDIC JRNLED          @VS32198*/
         OI    RPLVJRNL(@02),B'00000001'                           0192
*         END;                      /*                       @VS32198*/
*       RETURN;                     /* RETURN TO CALLER      @Y30LB26*/
         B     @EL00001                                            0194
*     END;                          /*                       @Y30LB26*/
*                                                                  0196
*   /*****************************************************************/
*   /*                                                               */
*   /* TEST FOR CREATE GROUP RECORD OPERATION CODE           @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0196
*   IF RVROPCD=CREGRP               /* TEST OP CODE          @Y30LB26*/
*     THEN                          /*                       @Y30LB26*/
@RF00186 L     @02,RVRPTR                                          0196
         CLI   RVROPCD(@02),X'82'                                  0196
         BNE   @RF00196                                            0196
*                                                                  0197
*     /***************************************************************/
*     /*                                                             */
*     /* CALL ROUTINE AND RETURN TO ICBVCR00                 @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0197
*     DO;                           /*                       @Y30LB26*/
*       CALL CREATEG;               /* GO CREATE GROUP       @Y30LB26*/
*                                                                  0198
         BAL   @14,CREATEG                                         0198
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK RETURN CODE AND IF BAD SEE IF JOURNALED     @VS32198*/
*       /* BEFORE. IF SO INDICATE THIS FACT.                 @VS32198*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0199
*       IF RPLVRETC^=RCZERO THEN    /* CK RETURN             @VS32198*/
         L     @02,RPLVPTR                                         0199
         CLC   RPLVRETC(2,@02),@CB00747                            0199
         BE    @RF00199                                            0199
*         DO;                       /*                       @VS32198*/
*           IF JRNLEDSW=ON THEN     /* JOURNALED BEFORE ?    @VS32198*/
         TM    JRNLEDSW,B'00000001'                                0201
         BNO   @RF00201                                            0201
*             RPLVJRNL=ON;          /* INDIC JRNLED          @VS32198*/
         OI    RPLVJRNL(@02),B'00000001'                           0202
*         END;                      /*                       @VS32198*/
*       RETURN;                     /* RETURN TO ICBVCR00    #Y30LB26*/
         B     @EL00001                                            0204
*     END;                          /*                       @Y30LB26*/
*                                                                  0206
*   /*****************************************************************/
*   /*                                                               */
*   /* TEST FOR MODIFY GROUP RECORD OPERATION CODE           @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0206
*   IF RVROPCD=MODGRP               /* TEST OP CODE          @Y30LB26*/
*     THEN                          /*                       @Y30LB26*/
@RF00196 L     @02,RVRPTR                                          0206
         CLI   RVROPCD(@02),X'83'                                  0206
         BNE   @RF00206                                            0206
*                                                                  0207
*     /***************************************************************/
*     /*                                                             */
*     /* CALL ROUTINE AND RETURN TO ICBVCR00                 @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0207
*     DO;                           /*                       @Y30LB26*/
*       CALL MODIFYG;               /* GO MODIFY GP REC      @Y30LB26*/
*                                                                  0208
         BAL   @14,MODIFYG                                         0208
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK RETURN CODE AND IF BAD SEE IF JOURNALED     @VS32198*/
*       /* BEFORE. IF SO INDICATE THIS FACT.                 @VS32198*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0209
*       IF RPLVRETC^=RCZERO THEN    /* CK RETURN             @VS32198*/
         L     @02,RPLVPTR                                         0209
         CLC   RPLVRETC(2,@02),@CB00747                            0209
         BE    @RF00209                                            0209
*         DO;                       /*                       @VS32198*/
*           IF JRNLEDSW=ON THEN     /* JOURNALED BEFORE ?    @VS32198*/
         TM    JRNLEDSW,B'00000001'                                0211
         BNO   @RF00211                                            0211
*             RPLVJRNL=ON;          /* INDIC JRNLED          @VS32198*/
         OI    RPLVJRNL(@02),B'00000001'                           0212
*         END;                      /*                       @VS32198*/
*       RETURN;                     /*                       #Y30LB26*/
         B     @EL00001                                            0214
*     END;                          /*                       @Y30LB26*/
*                                                                  0216
*   /*****************************************************************/
*   /*                                                               */
*   /* TEST FOR SCRATCH GROUP OPERATION CODE                 @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0216
*   IF RVROPCD=SCRGRP               /* TEST OP CODE          @Y30LB26*/
*     THEN                          /*                       @Y30LB26*/
@RF00206 L     @02,RVRPTR                                          0216
         CLI   RVROPCD(@02),X'84'                                  0216
         BNE   @RF00216                                            0216
*                                                                  0217
*     /***************************************************************/
*     /*                                                             */
*     /* SCRATCH RECORD AND RETURN TO ICBVCR00               @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0217
*     DO;                           /*                       @Y30LB26*/
*       CALL SCRATCHG;              /* GO SCRATCH GROUP      @Y30LB26*/
*                                                                  0218
         BAL   @14,SCRATCHG                                        0218
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK RETURN CODE AND IF BAD SEE IF JOURNALED     @VS32198*/
*       /* BEFORE. IF SO INDICATE THIS FACT.                 @VS32198*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0219
*       IF RPLVRETC^=RCZERO THEN    /* CK RETURN             @VS32198*/
         L     @02,RPLVPTR                                         0219
         CLC   RPLVRETC(2,@02),@CB00747                            0219
         BE    @RF00219                                            0219
*         DO;                       /*                       @VS32198*/
*           IF JRNLEDSW=ON THEN     /* JOURNALED BEFORE ?    @VS32198*/
         TM    JRNLEDSW,B'00000001'                                0221
         BNO   @RF00221                                            0221
*             RPLVJRNL=ON;          /* INDIC JRNLED          @VS32198*/
         OI    RPLVJRNL(@02),B'00000001'                           0222
*         END;                      /*                       @VS32198*/
*       RETURN;                     /*                       #Y30LB26*/
         B     @EL00001                                            0224
*     END;                          /*                       @Y30LB26*/
*                                                                  0226
*   /*****************************************************************/
*   /*                                                               */
*   /* TEST FOR MODIFY BASE VOLUME OP CODE                   @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0226
*   IF RVROPCD=MODVOL               /* TEST OP CODE          @Y30LB26*/
*     THEN                          /*                       @Y30LB26*/
@RF00216 L     @02,RVRPTR                                          0226
         CLI   RVROPCD(@02),X'85'                                  0226
         BNE   @RF00226                                            0226
*                                                                  0227
*     /***************************************************************/
*     /*                                                             */
*     /* MODIFY VOLUME RECORD AND RETURN TO ICBVCR00         @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0227
*     DO;                           /*                       @Y30LB26*/
*       CALL MODIFYV;               /* GO MODIFY VOL REC     @Y30LB26*/
*                                                                  0228
         BAL   @14,MODIFYV                                         0228
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK RETURN CODE AND IF BAD SEE IF JOURNALED     @VS32198*/
*       /* BEFORE. IF SO INDICATE THIS FACT.                 @VS32198*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0229
*       IF RPLVRETC^=RCZERO THEN    /* CK RETURN             @VS32198*/
         L     @02,RPLVPTR                                         0229
         CLC   RPLVRETC(2,@02),@CB00747                            0229
         BE    @RF00229                                            0229
*         DO;                       /*                       @VS32198*/
*           IF JRNLEDSW=ON THEN     /* JOURNALED BEFORE ?    @VS32198*/
         TM    JRNLEDSW,B'00000001'                                0231
         BNO   @RF00231                                            0231
*             RPLVJRNL=ON;          /* INDIC JRNLED          @VS32198*/
         OI    RPLVJRNL(@02),B'00000001'                           0232
*         END;                      /*                       @VS32198*/
*       RETURN;                     /*                       #Y30LB26*/
         B     @EL00001                                            0234
*     END;                          /*                       @Y30LB26*/
*                                                                  0236
*   /*****************************************************************/
*   /*                                                               */
*   /* TEST FOR READ INVENTORY RECORDS OP CODE               @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0236
*   IF RVROPCD=READREC              /* TEST OP CODE          @Y30LB26*/
*     THEN                          /*                       @Y30LB26*/
@RF00226 L     @02,RVRPTR                                          0236
         CLI   RVROPCD(@02),X'87'                                  0236
         BNE   @RF00236                                            0236
*                                                                  0237
*     /***************************************************************/
*     /*                                                             */
*     /* READ RECORD AND RETURN TO ICBVCR00                  @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0237
*     DO;                           /*                       @Y30LB26*/
*       CALL READVVI;               /* GO READ RECORD        @Y30LB26*/
         BAL   @14,READVVI                                         0238
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00001                                            0239
*     END;                          /*                       @Y30LB26*/
*                                                                  0241
*   /*****************************************************************/
*   /*                                                               */
*   /* NO VALID OPERATION CODE WAS FOUND. SET ERROR          @Y30LB26*/
*   /* REASON AND RETURN CODES.                              @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0241
*   RPLRCODE=BADOPCD;               /* INVALID OPERATION     @Y30LB26*/
@RF00236 L     @02,RPLVPTR                                         0241
         MVC   RPLRCODE(2,@02),@CB00793                            0241
*   RPLVRETC=FOUR;                  /* SET BAD RET CODE      @Y30LB26*/
         MVC   RPLVRETC(2,@02),@CB00749                            0242
*   RETURN;                         /* RETURN TO ICBVCR00    @Y30LB26*/
         B     @EL00001                                            0243
*                                                                  0244
*/*  START OF SPECIFICATIONS ****                            @Y30LB26
*                                                                  0244
*    PROCEDURE NAME - CREATEG                                @Y30LB26
*                                                                  0244
*    FUNCTION - TO PLACE A GROUP RECORD IN THE USERCAT.MSVI DATA SET.
*    ANOTHER GROUP RECORD MUST NOT EXIST WITH THE SAME GROUP NAME. 0244
*    THERE MUST NOT BE ANY ILLEGAL CHARACTERS IN THE GROUP NAME. THIS
*    IS CHECKED.                                                   0244
*    THIS PROGRAM PUTS IN THE PRIMARY AND SECONDARY SPACE DEFAULTS,
*    THE NUMBER OF CONCURRENT USERS, AND RESERVED SPACE IN CYLINDERS.
*    ALSO IT OPTIONALLY PUTS IN OWNER, THRESHOLD, RETENTION PERIOD,
*    DESCRIPTION AND ADDRESS, PLUS ANY MOUNT ATTRIBUTES.  THE RPLV IS
*    JOURNALED AFTER THE FIRST SUCCESSFUL UPDATE OF INVENTORY      0244
*    DATA SET.                                                @G24LB37
*                                                                  0244
*                                                                  0244
*      INPUTS - REGISTER 1 CONTAINS THE ADDRESS OF THE RPLV.  IT   0244
*      HAS ALL THE INFORMATION REQUIRED TO CREATE A GROUP          0244
*      RECORD.                                                @Y30LB26
*                                                                  0244
*      '020A'X  GROUP ALREADY EXISTS.                         @Y30LB26
*      '0225'X  GROUP NAME IS INVALID.                        @Y30LB26
*      PLUS ANY RETURN CODES FROM I/O PROCESSOR AND JOURNALING PROGRAM.
*                                                             @Y30LB26
**** END OF SPECIFICATIONS **                                        */
*                                                                  0244
*CREATEG:                                                          0244
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
CREATEG  ST    @14,@SA00002                                        0244
*   DCL                                                            0245
*     TWOBLK CHAR(2) CONSTANT('  ');/* TEST CONSTANT         #Y30LB26*/
*                                                                  0246
*   /*****************************************************************/
*   /*                                                               */
*   /* ADDRESS OF REQUEST BLOCK                              @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0246
*   MGPPTR=ADDR(RPLVUTIL);          /* PTR TO REQUEST BLK    @Y30LB26*/
         L     MGPPTR,RPLVPTR                                      0246
         LA    MGPPTR,RPLVUTIL(,MGPPTR)                            0246
*   STORGRP=STORGRP&&STORGRP;       /* ZERO GROUP REC BUFF   @Y30LB26*/
*                                                                  0247
         XC    STORGRP(224),STORGRP                                0247
*   /*****************************************************************/
*   /*                                                               */
*   /* GO CHECK FOR VALID CHARACTERS IN GROUP NAME           @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0248
*   CALL VALGPNAM;                  /* CK FOR VALID GP NM    @Y30LB26*/
*                                                                  0248
         BAL   @14,VALGPNAM                                        0248
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK RETURN CODE FROM GROUP NAME ROUTINE             @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0249
*   IF RPLVRETC^=RCZERO             /* CK FOR GOOD RET CD    @Y30LB26*/
*     THEN                                                         0249
         L     @07,RPLVPTR                                         0249
         CLC   RPLVRETC(2,@07),@CB00747                            0249
         BNE   @RT00249                                            0249
*     RETURN;                       /* INVAL GRP, RETURN     @Y30LB26*/
*                                                                  0251
*   /*****************************************************************/
*   /*                                                               */
*   /* CALL RESERVE INVENTORY DATA SET.                      @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0251
*   CALL RESERINV;                  /* GO RESERVE INVEN      @Y30LB26*/
         BAL   @14,RESERINV                                        0251
*                                                                  0252
*   /*****************************************************************/
*   /*                                                               */
*   /* INITILIZE FIELDS IN GROUP VOLUME RECORD               @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0252
*   GROUPPTR=ADDR(STORGRP);         /* ADDR TO REC BUFFER    @Y30LB26*/
         LA    @07,STORGRP                                         0252
         ST    @07,GROUPPTR                                        0252
*   GROUPKY=MGPGROUP;               /* NAME GRP BE CREATED   @Y30LB26*/
         MVC   GROUPKY(8),MGPGROUP(MGPPTR)                         0253
*   GRONAME=GKEY;                   /* PUT KEY GROUP REC     @Y30LB26*/
         MVC   GRONAME(13,@07),GKEY                                0254
*   GROGVR=ON;                      /* INDICATE GROUP REC    @Y30LB26*/
         OI    GROGVR(@07),B'10000000'                             0255
*   GROPSPD=MGPRI;                  /* PRI SPACE DEFAULT     @Y30LB26*/
         LH    @02,MGPRI(,MGPPTR)                                  0256
         STH   @02,GROPSPD(,@07)                                   0256
*   GROSSPD=MGPSEC;                 /* SEC SPACE DEFAULT     @Y30LB26*/
         LH    @02,MGPSEC(,MGPPTR)                                 0257
         STH   @02,GROSSPD(,@07)                                   0257
*                                                                  0258
*   /*****************************************************************/
*   /*                                                               */
*   /* OWNER SPECIFIED, FILL IN OWNER FIELD                  @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0258
*   IF MGPFLOWN=ON                  /* CK OWNER SPECIFIED    @Y30LB26*/
*     THEN                                                         0258
         TM    MGPFLOWN(MGPPTR),B'00010000'                        0258
         BNO   @RF00258                                            0258
*     GROOWNER=MGPOWNER;            /* SET OWNER             @Y30LB26*/
         MVC   GROOWNER(10,@07),MGPOWNER(MGPPTR)                   0259
*   ELSE                            /*                       @Y30LB26*/
*     GROOWNER=BLANK;               /* BLANK OWNER           @Y30LB26*/
         B     @RC00258                                            0260
@RF00258 L     @07,GROUPPTR                                        0260
         MVI   GROOWNER+1(@07),C' '                                0260
         MVC   GROOWNER+2(8,@07),GROOWNER+1(@07)                   0260
         MVI   GROOWNER(@07),C' '                                  0260
*                                                                  0261
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THRESHOLD PERCENT SPECIFIED, FILL IN               @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0261
*   IF MGPFLTHO=ON                  /* THRESH PCENT SPEC ?   @Y30LB26*/
*     THEN                                                         0261
@RC00258 TM    MGPFLTHO(MGPPTR),B'00000010'                        0261
         BNO   @RF00261                                            0261
*     GROPCENT=MGPTHOLD;            /* SET PERCENT           @Y30LB26*/
         L     @07,GROUPPTR                                        0262
         MVC   GROPCENT(1,@07),MGPTHOLD(MGPPTR)                    0262
*                                                                  0263
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK RETENTION PERIOD SPECIFIED                      @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0263
*   IF MGPFLRET=ON                  /* RETENTION SPEC ?      @Y30LB26*/
*     THEN                          /*                       @Y30LB26*/
*                                                                  0263
@RF00261 TM    MGPFLRET(MGPPTR),B'00000001'                        0263
         BNO   @RF00263                                            0263
*     /***************************************************************/
*     /*                                                             */
*     /* INDICATE SPECIFIED AND FILLIN PERIOD                @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0264
*     DO;                           /*                       @Y30LB26*/
*       GRORETN=ON;                 /* INDICATE RETN SPEC    @Y30LB26*/
         L     @07,GROUPPTR                                        0265
         OI    GRORETN(@07),B'00000100'                            0265
*       GRORETPD=MGPRETPD;          /* PUT IN RET PERIOD     @Y30LB26*/
         LH    @02,MGPRETPD(,MGPPTR)                               0266
         ST    @02,GRORETPD(,@07)                                  0266
*     END;                          /*                       @Y30LB26*/
*                                                                  0268
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK CONCURRENT USERS SPECIFIED, IF SO FILL IN       @G24LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0268
*   IF MGPFLCON=ON                  /* CONCUR USERS SPEC ?   @G24LB37*/
*     THEN                                                         0268
@RF00263 TM    MGPFLCON(MGPPTR),B'00000001'                        0268
         BNO   @RF00268                                            0268
*     GROCONUS=MGPCONUS;            /* SET CONCUR USERS      @G24LB37*/
         L     @07,GROUPPTR                                        0269
         MVC   GROCONUS(1,@07),MGPCONUS(MGPPTR)                    0269
*                                                                  0270
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK RESERVED SPACE SPECIFIED, IF SO FILL IN         @G24LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0270
*   IF MGPFLRES=ON                  /* RESERVED SP SPEC ?    @G24LB37*/
*     THEN                                                         0270
@RF00268 TM    MGPFLRES(MGPPTR),B'10000000'                        0270
         BNO   @RF00270                                            0270
*     GRORESSP=MGPRESSP;            /* SET RESERVED SPACE    @G24LB37*/
         L     @07,GROUPPTR                                        0271
         MVC   GRORESSP(1,@07),MGPRESSP(MGPPTR)                    0271
*                                                                  0272
*   /*****************************************************************/
*   /*                                                               */
*   /* DESCRIPTION SPECIFIED - FILL IN                       @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0272
*   IF MGPFLDES=ON                  /* DESCRIPTION SPEC ?    @Y30LB26*/
*     THEN                                                         0272
@RF00270 TM    MGPFLDES(MGPPTR),B'10000000'                        0272
         BNO   @RF00272                                            0272
*     GRODESCR=MGPDESCR;            /* PUT VALUE             @Y30LB26*/
         L     @07,GROUPPTR                                        0273
         MVC   GRODESCR(30,@07),MGPDESCR(MGPPTR)                   0273
*   ELSE                            /*                       @Y30LB26*/
*     GRODESCR=BLANK;               /* BLANK DESCRIPTION     @Y30LB26*/
         B     @RC00272                                            0274
@RF00272 L     @07,GROUPPTR                                        0274
         MVI   GRODESCR+1(@07),C' '                                0274
         MVC   GRODESCR+2(28,@07),GRODESCR+1(@07)                  0274
         MVI   GRODESCR(@07),C' '                                  0274
*                                                                  0275
*   /*****************************************************************/
*   /*                                                               */
*   /* ADDRESS SPECIFIED - FILL IN                           @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0275
*   IF MGPFLADD=ON                  /* ADDRESS SPEC ?        @Y30LB26*/
*     THEN                                                         0275
@RC00272 TM    MGPFLADD(MGPPTR),B'01000000'                        0275
         BNO   @RF00275                                            0275
*     GROADDR=MGPADDR;              /* PUT VALUE             @Y30LB26*/
         L     @07,GROUPPTR                                        0276
         MVC   GROADDR(30,@07),MGPADDR(MGPPTR)                     0276
*   ELSE                            /*                       @Y30LB26*/
*     GROADDR=BLANK;                /* BLANK ADDRESS         @Y30LB26*/
         B     @RC00275                                            0277
@RF00275 L     @07,GROUPPTR                                        0277
         MVI   GROADDR+1(@07),C' '                                 0277
         MVC   GROADDR+2(28,@07),GROADDR+1(@07)                    0277
         MVI   GROADDR(@07),C' '                                   0277
*                                                                  0278
*   /*****************************************************************/
*   /*                                                               */
*   /* SET RELEASE ATTRIBUTE                                 @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0278
*   IF MGPRLSE=ON                   /* RELEASE ATTRIBUTE     @Y30LB26*/
*     THEN                                                         0278
@RC00275 TM    MGPRLSE(MGPPTR),B'10000000'                         0278
         BNO   @RF00278                                            0278
*     GRORLSE=ON;                   /*                       @Y30LB26*/
         L     @07,GROUPPTR                                        0279
         OI    GRORLSE(@07),B'00001000'                            0279
*                                                                  0280
*   /*****************************************************************/
*   /*                                                               */
*   /* SET BIND OPTION                                       @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0280
*   IF MGPBIND=ON                   /* BIND OPTION           @Y30LB26*/
*     THEN                                                         0280
@RF00278 TM    MGPBIND(MGPPTR),B'00100000'                         0280
         BNO   @RF00280                                            0280
*     GROBIND=ON;                   /*                       @Y30LB26*/
         L     @07,GROUPPTR                                        0281
         OI    GROBIND(@07),B'10000000'                            0281
*                                                                  0282
*   /*****************************************************************/
*   /*                                                               */
*   /* SET EXCLUSIVE USE FLAG                                @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0282
*   IF MGPEXCL=ON                   /* EXCLUSIVE USE ?       @Y30LB26*/
*     THEN                                                         0282
@RF00280 TM    MGPEXCL(MGPPTR),B'00001000'                         0282
         BNO   @RF00282                                            0282
*     GROEXCL=ON;                   /*                       @Y30LB26*/
         L     @07,GROUPPTR                                        0283
         OI    GROEXCL(@07),B'01000000'                            0283
*                                                                  0284
*   /*****************************************************************/
*   /*                                                               */
*   /* SET READ ONLY FLAG                                    @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0284
*   IF MGPRONLY=ON                  /* READ ONLY ?           @Y30LB26*/
*     THEN                                                         0284
@RF00282 TM    MGPRONLY(MGPPTR),B'00000010'                        0284
         BNO   @RF00284                                            0284
*     GRORONLY=ON;                  /*                       @Y30LB26*/
         L     @07,GROUPPTR                                        0285
         OI    GRORONLY(@07),B'00010000'                           0285
*                                                                  0286
*   /*****************************************************************/
*   /*                                                               */
*   /* SET DASD ERASE FLAG                                   @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0286
*   IF MGPDERAS=ON                  /* DASD ERASE ?          @Y30LB26*/
*     THEN                                                         0286
@RF00284 TM    MGPDERAS(MGPPTR),B'10000000'                        0286
         BNO   @RF00286                                            0286
*     GRODAERA=ON;                  /*                       @Y30LB26*/
         L     @02,GROUPPTR                                        0287
         OI    GRODAERA(@02),B'00100000'                           0287
*                                                                  0288
*   /*****************************************************************/
*   /*                                                               */
*   /* INITILIZE REMAINING FIELDS IN GROUP RECORD            @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0288
*   GROERRTS=BLANK;                 /* BLANK ERROR TIME STP  @Y30LB26*/
@RF00286 L     @02,GROUPPTR                                        0288
         MVI   GROERRTS+1(@02),C' '                                0288
         MVC   GROERRTS+2(6,@02),GROERRTS+1(@02)                   0288
         MVI   GROERRTS(@02),C' '                                  0288
*   GROFSN=BLANK;                   /* FIRST VOL REC         @Y30LB26*/
         MVI   GROFSN+1(@02),C' '                                  0289
         MVC   GROFSN+2(4,@02),GROFSN+1(@02)                       0289
         MVI   GROFSN(@02),C' '                                    0289
*   GROLSN=BLANK;                   /* LAST VOL SER          @Y30LB26*/
         MVI   GROLSN+1(@02),C' '                                  0290
         MVC   GROLSN+2(4,@02),GROLSN+1(@02)                       0290
         MVI   GROLSN(@02),C' '                                    0290
*                                                                  0291
*   /*****************************************************************/
*   /*                                                               */
*   /* SET UP AND WRITE GROUP RECORD                         @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0291
*   RPLVBUF=GROUPPTR;               /* ADDR RECORD TO PUT    @Y30LB26*/
         L     @15,RPLVPTR                                         0291
         ST    @02,RPLVBUF(,@15)                                   0291
*   RPLVRLN=LENGTH(GROUP);          /* LENGTH RECORD         @Y30LB26*/
         MVC   RPLVRLN(4,@15),@CF01146                             0292
*   RPLVBLN=LENGTH(STORGRP);        /* LENGTH BUFFER         @Y30LB26*/
         MVC   RPLVBLN(4,@15),@CF01147                             0293
*   RPLVTYP=RPLVPUT;                /* PUT GROUP RECORD      @Y30LB26*/
         MVI   RPLVTYP(@15),X'01'                                  0294
*   RESPECIFY                                                      0295
*     REG1 RSTD;                    /* RESTRICT REG 1        @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR OF RPLV          @Y30LB26*/
         LR    REG1,@15                                            0296
*   CALL ICBVIO00;                  /* WRITE RECORD          @Y30LB26*/
         L     @15,@CV00671                                        0297
         BALR  @14,@15                                             0297
*   RESPECIFY                                                      0298
*     REG1 UNRSTD;                  /* FREE REG 1            @Y30LB26*/
*                                                                  0298
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK RETURN CODE FROM I/O PROCESSOR                  @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0299
*   IF RPLVRETC^=RCZERO             /* CK RETURN CODE        @Y30LB26*/
*     THEN                          /*                       @Y30LB26*/
         L     @02,RPLVPTR                                         0299
         CLC   RPLVRETC(2,@02),@CB00747                            0299
         BE    @RF00299                                            0299
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         0301
*       RETURN;                     /*                       @Y30LB26*/
@EL00002 DS    0H                                                  0302
@EF00002 DS    0H                                                  0302
@ER00002 L     @14,@SA00002                                        0302
         BR    @14                                                 0302
*     END;                          /*                       @Y30LB26*/
*                                                                  0304
*   /*****************************************************************/
*   /*                                                               */
*   /* SINCE WRITE OF GROUP RECORD SUCCESSFUL,               @Y30LB26*/
*   /* GO JOURNAL REQUEST BLOCK                              @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0304
*   CALL JOURNAL;                   /* JOURNAL REQUEST BLK   @Y30LB26*/
@RF00299 BAL   @14,JOURNAL                                         0304
*   RETURN;                         /*                       @Y30LB26*/
         B     @EL00002                                            0305
*   END CREATEG;                    /*                       @Y30LB26*/
         B     @EL00002                                            0306
*                                                                  0307
*   /*****************************************************************/
*   /*                                                               */
*   /* THIS ROUTINE CHECKS TO SEE IF ALL CHARACTERS IN       @Y30LB26*/
*   /* THE GROUP NAME ARE VALID                              @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0307
*VALGPNAM:                                                         0307
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
*                                                                  0307
VALGPNAM ST    @14,@SA00003                                        0307
*   /*****************************************************************/
*   /*                                                               */
*   /* TRANSLATE & TEST VVGRP TABLE                          @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0308
*   DCL                                                            0308
*     1 TEST1 CHAR(256),            /*                       @Y30LB26*/
*      2 TESTINIT(256) CHAR(1) INIT((64)'01'X,'00'X,/*       @Y30LB26*/
*            (26)'01'X,'00'X,(31)'01'X,(2)'00'X,/*           @Y30LB26*/
*            (68)'01'X,(9)'00'X,(7)'01'X,(9)'00'X,(8)'01'X,/*      0308
*                                                            @Y30LB26*/
*            (8)'00'X,(6)'01'X,(10)'00'X,(6)'01'X);/*        @Y30LB26*/
*                                                                  0309
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK TO SEE IF FIRST CHAR ID BLANK OR IF THERE ARE   @Y30LB26*/
*   /* ANY IMBEDDED BLANKS                                   @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0309
*   DO I=1 TO 8;                    /*                       @Y30LB26*/
         LA    @07,1                                               0309
         STC   @07,I                                               0309
@DL00309 DS    0H                                                  0310
*     IF MGPGROUP(I)=BLANK THEN     /* TEST FOR BLANK        @Y30LB26*/
         ALR   @07,MGPPTR                                          0310
         CLI   MGPGROUP-1(@07),C' '                                0310
         BNE   @RF00310                                            0310
*       DO;                         /*                       @Y30LB26*/
*                                                                  0311
*         /***********************************************************/
*         /*                                                         */
*         /* FIRST CHARACTER CAN NOT BE BLANK                @Y30LB26*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  0312
*         IF I=ONE THEN             /* FIRST CHAR BLK ERROR  @Y30LB26*/
         CLI   I,1                                                 0312
         BNE   @RF00312                                            0312
*           DO;                     /*                       @Y30LB26*/
*             RPLVRETC=FOUR;        /* SET BAD RET CODE      @Y30LB26*/
         L     @07,RPLVPTR                                         0314
         MVC   RPLVRETC(2,@07),@CB00749                            0314
*             RPLRCODE=INVALGP;     /* INVALID GRP NAME      @Y30LB26*/
         MVC   RPLRCODE(2,@07),@CB00823                            0315
*             CALL ERREXIT;         /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         0316
*             RETURN;               /*                       @Y30LB26*/
@EL00003 DS    0H                                                  0317
@EF00003 DS    0H                                                  0317
@ER00003 L     @14,@SA00003                                        0317
         BR    @14                                                 0317
*           END;                    /*                       @Y30LB26*/
*                                                                  0318
*         /***********************************************************/
*         /*                                                         */
*         /* IF NOT THE LAST CHARACTER IN GROUP NAME,        @Y30LB26*/
*         /* CHECK FOR IMBEDDED BLANKS                       @Y30LB26*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  0319
*         IF I<8 THEN               /* INSURE NOT LAST CHAR  @Y30LB26*/
@RF00312 CLI   I,8                                                 0319
         BNL   @RF00319                                            0319
*           DO;                     /*                       @Y30LB26*/
*             IF MGPGROUP(I+1:8)^=BLANK8(I+1:8) THEN/*       @Y30LB26*/
         SLR   @07,@07                                             0321
         IC    @07,I                                               0321
         LA    @02,7                                               0321
         SLR   @02,@07                                             0321
         ST    @07,@TF00001                                        0321
         ALR   @07,MGPPTR                                          0321
         L     @01,@TF00001                                        0321
         LA    @15,BLANK8(@01)                                     0321
         EX    @02,@SC01176                                        0321
         BE    @RF00321                                            0321
*               DO;                 /*                       @Y30LB26*/
*                 RPLVRETC=FOUR;    /* BAD RETURN CODE       @Y30LB26*/
         L     @07,RPLVPTR                                         0323
         MVC   RPLVRETC(2,@07),@CB00749                            0323
*                 RPLRCODE=INVALGP; /* INVAL GRP NAME        @Y30LB26*/
         MVC   RPLRCODE(2,@07),@CB00823                            0324
*                 CALL ERREXIT;     /* RLSE INVENTORY        @Y30LB26*/
         BAL   @14,ERREXIT                                         0325
*                 RETURN;           /*                       @Y30LB26*/
         B     @EL00003                                            0326
*               END;                /*                       @Y30LB26*/
*           END;                    /*                       @Y30LB26*/
@RF00321 DS    0H                                                  0329
*       END;                        /*                       @Y30LB26*/
@RF00319 DS    0H                                                  0330
*   END;                            /*                       @Y30LB26*/
@RF00310 LA    @07,1                                               0330
         SLR   @02,@02                                             0330
         IC    @02,I                                               0330
         ALR   @07,@02                                             0330
         STC   @07,I                                               0330
         C     @07,@CF00036                                        0330
         BNH   @DL00309                                            0330
*   RESPECIFY                                                      0331
*     REG2 RSTD;                    /* RESTRICT REG 15       @Y30LB26*/
*                                                                  0331
*   /*****************************************************************/
*   /*                                                               */
*   /* ZERO REG 2 FOR TRT INSTRUCTION                        @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0332
*   REG2=ZERO;                      /* ZERO REG 2            @Y30LB26*/
*                                                                  0332
         SLR   REG2,REG2                                           0332
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR INVALID SPECIAL CHARACTERS IN GROUP NAME    @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0333
*   TRT(MGPGROUP,TEST1);            /* TEST FOR SPEC CHAR    @Y30LB26*/
         TRT   MGPGROUP(8,MGPPTR),TEST1                            0333
*   IF REG2^=ZERO THEN              /*                       @Y30LB26*/
*                                                                  0334
         LTR   REG2,REG2                                           0334
         BZ    @RF00334                                            0334
*     /***************************************************************/
*     /*                                                             */
*     /* IF INVALID CHARACTERS, SET REASON CODE AND RETURN   @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0335
*     DO;                           /*                       @Y30LB26*/
*       RPLVRETC=FOUR;              /* BAD RET CODE          @Y30LB26*/
         L     @07,RPLVPTR                                         0336
         MVC   RPLVRETC(2,@07),@CB00749                            0336
*       RPLRCODE=INVALGP;           /* INVALID GROUP NAME    @Y30LB26*/
         MVC   RPLRCODE(2,@07),@CB00823                            0337
*       CALL ERREXIT;               /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         0338
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00003                                            0339
*     END;                          /*                       @Y30LB26*/
*   ELSE                            /*                       @Y30LB26*/
*                                                                  0341
*     /***************************************************************/
*     /*                                                             */
*     /* OTHERWISE SET GOOD REASON CODE AND RETURN           @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0341
*     DO;                           /*                       @Y30LB26*/
@RF00334 DS    0H                                                  0342
*       RPLVRETC=RCZERO;            /* GOOD RET CODE         @Y30LB26*/
         L     @07,RPLVPTR                                         0342
         MVC   RPLVRETC(2,@07),@CB00747                            0342
*       RPLRCODE=RCZERO;            /* ALL GOOD CHARACTERS   @Y30LB26*/
         MVC   RPLRCODE(2,@07),@CB00747                            0343
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00003                                            0344
*     END;                          /*                       @Y30LB26*/
*   RESPECIFY                                                      0346
*     REG2 UNRSTD;                  /* FREE REG 15           @Y30LB26*/
*   END VALGPNAM;                   /* END CREATE GRP ROUTIN @Y30LB26*/
*                                                                  0348
*/*  START OF SPECIFICATIONS ****                                  0348
*                                                                  0348
*    PROCEDURE NAME - MODIFYG                                 @Y30LB26
*                                                                  0348
*    FUNCTION - THIS PROGRAM MODIFIES AN EXISTING GROUP RECORD.    0348
*    IT CAN CHANGE BOTH PRIMARY AND SECONDARY DEFAULT SPACE,       0348
*    CHANGE THE GROUP OWNER, UPDATE DESCRIPTION AND ADDRESS        0348
*    FIELD.  THIS PROCEDURE WILL, ALSO, MODIFY THE EXISTING        0348
*    NUMBER OF CONCURRENT ALLOCATIONS AND/OR THE AMOUNT OF         0348
*    RESERVED SPACE FOR A VOLUME WITHIN A GROUP, IF SPECIFIED.     0348
*    WHEN THE NUMBER OF CONCURRENT USERS IS CHANGED FROM           0348
*    ZERO TO A NONZERO VALUE FOR A GROUP OTHER THAN SYSGROUP,      0348
*    MODIFYG CONSIDERS THIS A CONVERSION FOR THAT GROUP FROM       0348
*    EARLIER VERSION OF MSS SUPPORT TO MSS RELEASE 3. IF THE       0348
*    GROUP THRESHOLD IS CHANGED, MODIFYG WILL RECALCULATE          0348
*    THE GROUP SPACE THRESHOLD BY MULTIPLING THE NUMBER OF         0348
*    GENERAL USE VOLUMES IN THE GROUP BY 404 AND THEN MULTIPLING   0348
*    THIS BY THE GROUP THRESHOLD PERCENT.   ALSO IF NULLIFY RETENTION
*    IS SPECIFIED, THE PROGRAM GOES THRU ALL THE BASE VOLUME RECORDS,
*    AND FOR THE GENERAL USE VOLUMES THE EXPIRATION DATE IS NULLIFIED.
*    THE MSS MOUNT ATTRIBUTES CAN BE CHANGED.  THE NULLIFY         0348
*    OPERATIONS OVER-RIDE ANY PARAMETER SPECIFICATION.             0348
*    THE PROGRAM NULLIFIES THE FIELDS SPECIFIED BY THE             0348
*    REQUEST BLOCK.  THE RPLV IS JOURNALED AFTER THE GROUP RECORD IS
*    SUCCESSFULLY WRITTEN.                                    @G24LB37
*                                                                  0348
*    FOR GROUP CONVERSION TO MSS RELEASE 3, MODIFYG READS          0348
*    ALL OF THE GROUP EXTENSION RECORDS FOR THAT GROUP,            0348
*    AND FOR EACH VOLUME SHOWN IN A GROUP EXTENSION RECORD,        0348
*    MOVES THE FREE SPACE FROM THE BASE VOLUME RECORD INTO         0348
*    THE GVSNE, AND TURNS OFF THE HOST NON-SHARE AND INVALID       0348
*    RUNNING COUNT FIELDS, UNLESS THE BASE VOLUME RECORD           0348
*    INDICATED THAT THE VOLUME IS MOUNTED TO SOME HOST OR          0348
*    THAT ITS SPACE IS DOWN LEVEL.                            @G24LB04
*                                                                  0348
*      INPUTS - REGISTER 1 CONTAINS THE ADDRESS OF THE RPLV.  THIS HAS
*      ALL THE INFORMATION NEEDED TO MODIFY THE GROUP RECORD. @Y30LB26
*                                                                  0348
*      OUTPUTS - REASON CODE AND RETURN CODE IN RPLV.         @Y30LB26
*                                                                  0348
*       '021B'X  I/O ERROR OCCURED BUT RPLV WAS JOURNALED.    @Y30LB26
*       ALSO ANY RETURN CODE PUT OUT BY THE I/O PROCESSOR OR THE   0348
*       JOURNALING PROGRAM.                                   @Y30LB26
**** END OF SPECIFICATIONS **                                        */
*                                                                  0348
*MODIFYG:                                                          0348
*   PROC OPTIONS(SAVEAREA);         /*                       #Y30LB26*/
MODIFYG  STM   @14,@12,12(@13)                                     0348
         ST    @13,@SA00004+4                                      0348
         LA    @14,@SA00004                                        0348
         ST    @14,8(,@13)                                         0348
         LR    @13,@14                                             0348
*                                                                  0349
*   /*****************************************************************/
*   /*                                                               */
*   /* CONSTANTS USED IN ARITHMETIC CALCULATIONS             #Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0349
*   DCL                                                            0349
*     CYLS FIXED(15) CONSTANT(404); /* CALC THRS CYLS        @Y30LB26*/
*   DCL                                                            0350
*     HUNDRED FIXED(15) CONSTANT(100);/* DIVISOR             @Y30LB26*/
*                                                                  0351
*   /*****************************************************************/
*   /*                                                               */
*   /* SET UP ADDRESSABILITY TO REQUEST BLOCK                @G24LB04*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0351
*   MGPPTR=ADDR(RPLVUTIL);          /* PTR TO REQUEST BLK    @Y30LB26*/
         L     MGPPTR,RPLVPTR                                      0351
         LA    MGPPTR,RPLVUTIL(,MGPPTR)                            0351
*                                                                  0352
*   /*****************************************************************/
*   /*                                                               */
*   /* RESERVE INVENTORY                                     @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0352
*   CALL RESERINV;                  /* GO RESERVE INVENTY    @Y30LB26*/
         BAL   @14,RESERINV                                        0352
*                                                                  0353
*   /*****************************************************************/
*   /*                                                               */
*   /* READ GROUP RECORD                                     @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0353
*   GROUPKY=MGPGROUP;               /* PUT GROUP NM IN KEY   @Y30LB26*/
         MVC   GROUPKY(8),MGPGROUP(MGPPTR)                         0353
*   RPLVKEY=ADDR(GKEY);             /* SET VSAM RB TO REC    @Y30LB26*/
         L     @07,RPLVPTR                                         0354
         LA    @02,GKEY                                            0354
         ST    @02,RPLVKEY(,@07)                                   0354
*   RPLVBUF=ADDR(STORGRP);          /* ADDR OF BUFFER        @Y30LB26*/
         LA    @02,STORGRP                                         0355
         ST    @02,RPLVBUF(,@07)                                   0355
*   RPLVBLN=LENGTH(STORGRP);        /* LENGTH BUFFER         @Y30LB26*/
         MVC   RPLVBLN(4,@07),@CF01147                             0356
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB26*/
         OI    RPLVDIR(@07),B'01000000'                            0357
*   RPLVTYP=RPLVREAD;               /* READ                  @Y30LB26*/
         MVI   RPLVTYP(@07),X'00'                                  0358
*   RPLVUPD=ON;                     /* READ FOR UPDATE       @Y30LB26*/
         OI    RPLVUPD(@07),B'00000010'                            0359
*   RESPECIFY                                                      0360
*     REG1 RSTD;                    /* RESTRICT REG 1        @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR OF RPLV          @Y30LB26*/
         LR    REG1,@07                                            0361
*   CALL ICBVIO00;                  /* READ DIRECT FOR REC   @Y30LB26*/
         L     @15,@CV00671                                        0362
         BALR  @14,@15                                             0362
*   RESPECIFY                                                      0363
*     REG1 UNRSTD;                  /* FREE REG 1            @Y30LB26*/
*                                                                  0363
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR BAD RETURN CODE                             @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0364
*   IF RPLVRETC^=RCZERO             /* CK RETURN             @Y30LB26*/
*     THEN                          /*                       @Y30LB26*/
*                                                                  0364
         L     @07,RPLVPTR                                         0364
         CLC   RPLVRETC(2,@07),@CB00747                            0364
         BE    @RF00364                                            0364
*     /***************************************************************/
*     /*                                                             */
*     /* IF BAD, SAVE CODES AND RETURN                       @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0365
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         0366
*       RETURN;                     /*                       @Y30LB26*/
@EL00004 L     @13,4(,@13)                                         0367
@EF00004 DS    0H                                                  0367
@ER00004 LM    @14,@12,12(@13)                                     0367
         BR    @14                                                 0367
*     END;                          /*                       @Y30LB26*/
*                                                                  0369
*   /*****************************************************************/
*   /*                                                               */
*   /* SET PTR TO IT                                         @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0369
*   GROUPPTR=ADDR(STORGRP);         /* ADDR WORKING COPY     @Y30LB26*/
@RF00364 LA    @07,STORGRP                                         0369
         ST    @07,GROUPPTR                                        0369
*   REL3CONF=OFF;                   /* NOT CONVERTING TO     @G24LB04
*                                      R3 AS YET             @G24LB04*/
*                                                                  0370
         NI    REL3CONF,B'11111101'                                0370
*   /*****************************************************************/
*   /*                                                               */
*   /* IF CONCURRENT USERS SPECIFIED, FILL IN AND            @G24LB04*/
*   /* CHECK FOR CONVERSION TO MSS RELEASE 3                 @G24LB04*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0371
*   IF MGPFLCON=ON                  /*                       @G24LB04*/
*     THEN                          /* CONCURRENT USERS IS   @G24LB04
*                                      SPECIFIED             @G24LB04*/
         TM    MGPFLCON(MGPPTR),B'00000001'                        0371
         BNO   @RF00371                                            0371
*     DO;                           /*                       @G24LB04*/
*       IF GROCONUS=FIXZERO&GROVVGRP^=SYSGROUP/*             @G24LB04*/
*           &MGPCONUS^=BIT8ZERO     /* PREVIOUS VALUE ZERO?  @G24LB04*/
*         THEN                      /* MUST CONVERT TO MSS   @G24LB04
*                                      RELEASE 3             @G24LB04*/
         CLI   GROCONUS(@07),0                                     0373
         BNE   @RF00373                                            0373
         CLC   GROVVGRP(8,@07),SYSGROUP                            0373
         BE    @RF00373                                            0373
         CLI   MGPCONUS(MGPPTR),0                                  0373
         BE    @RF00373                                            0373
*         REL3CONF=ON;              /* FLAG TO DO LATER      @G24LB04*/
         OI    REL3CONF,B'00000010'                                0374
*       GROCONUS=MGPCONUS;          /* NEW CONCUR USER DEF   @G24LB37*/
@RF00373 L     @07,GROUPPTR                                        0375
         MVC   GROCONUS(1,@07),MGPCONUS(MGPPTR)                    0375
*     END;                          /*                       @G24LB04*/
*                                                                  0377
*   /*****************************************************************/
*   /*                                                               */
*   /* IF OWNER SPECIFIED, MODIFY FIELD                      #Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0377
*   IF MGPFLOWN=ON                  /* CK OWNER SPEC ?       #Y30LB26*/
*     THEN                                                         0377
@RF00371 TM    MGPFLOWN(MGPPTR),B'00010000'                        0377
         BNO   @RF00377                                            0377
*     GROOWNER=MGPOWNER;            /* MOVE IN NEW OWNER     @Y30LB26*/
         L     @07,GROUPPTR                                        0378
         MVC   GROOWNER(10,@07),MGPOWNER(MGPPTR)                   0378
*                                                                  0379
*   /*****************************************************************/
*   /*                                                               */
*   /* IF PRIMARY SPACE CHANGED, CHANGE IT                   @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0379
*   IF MGPFLPRI=ON                  /* CK PRIMARY SP SPEC    @Y30LB26*/
*     THEN                                                         0379
@RF00377 TM    MGPFLPRI(MGPPTR),B'00001000'                        0379
         BNO   @RF00379                                            0379
*     GROPSPD=MGPRI;                /* NEW PRI SPACE DEF     @Y30LB26*/
         LH    @07,MGPRI(,MGPPTR)                                  0380
         L     @02,GROUPPTR                                        0380
         STH   @07,GROPSPD(,@02)                                   0380
*                                                                  0381
*   /*****************************************************************/
*   /*                                                               */
*   /* IF RESERVED SPACE CHANGED, CHANGE IT                  @G24LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0381
*   IF MGPFLRES=ON                  /* RESERVED SPACE        @G24LB04
*                                      SPECIFIED ?           @G24LB04*/
*     THEN                          /*                       @G24LB04*/
@RF00379 TM    MGPFLRES(MGPPTR),B'10000000'                        0381
         BNO   @RF00381                                            0381
*     GRORESSP=MGPRESSP;            /* PERCENT RESERVED      @G24LB37*/
         L     @07,GROUPPTR                                        0382
         MVC   GRORESSP(1,@07),MGPRESSP(MGPPTR)                    0382
*   ELSE                                                           0383
*     IF REL3CONF=ON THEN           /* CONV TO R3 LEVEL?     @G24LB04*/
         B     @RC00381                                            0383
@RF00381 TM    REL3CONF,B'00000010'                                0383
         BNO   @RF00383                                            0383
*       GRORESSP=DEFRESSP;          /* PROVIDE DEFAULT       @G24LB04*/
         L     @07,GROUPPTR                                        0384
         MVI   GRORESSP(@07),X'28'                                 0384
*                                                                  0385
*   /*****************************************************************/
*   /*                                                               */
*   /* UPDATE SECONDARY SPACE DEFAULT IF REQUIRED            #Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0385
*   IF MGPFLSEC=ON                  /* CK SEC SPACE SPEC     @Y30LB26*/
*     THEN                                                         0385
@RF00383 DS    0H                                                  0385
@RC00381 TM    MGPFLSEC(MGPPTR),B'00000100'                        0385
         BNO   @RF00385                                            0385
*     GROSSPD=MGPSEC;               /* NEW SEC SPACE         @Y30LB26*/
         LH    @07,MGPSEC(,MGPPTR)                                 0386
         L     @02,GROUPPTR                                        0386
         STH   @07,GROSSPD(,@02)                                   0386
*                                                                  0387
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK THRESHOLD PERCENT SPECIFIED                     @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0387
*   IF MGPFLTHO=ON                  /* THRESHOLD SPEC        @Y30LB26*/
*     THEN                          /*                       @Y30LB26*/
*                                                                  0387
@RF00385 TM    MGPFLTHO(MGPPTR),B'00000010'                        0387
         BNO   @RF00387                                            0387
*     /***************************************************************/
*     /*                                                             */
*     /* IF SPECIFIED, UPDATE AND CALCULATE THRESHOLD        @Y30LB26*/
*     /* SPACE                                               @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0388
*     DO;                           /*                       @Y30LB26*/
*       GROPCENT=MGPTHOLD;          /* NEW PRECENT           @Y30LB26*/
         L     @07,GROUPPTR                                        0389
         SLR   @02,@02                                             0389
         IC    @02,MGPTHOLD(,MGPPTR)                               0389
         STC   @02,GROPCENT(,@07)                                  0389
*       GROSTRSH=(GRONGEN*CYLS*GROPCENT)/HUNDRED;/*          @Y30LB26*/
         LH    @01,GRONGEN(,@07)                                   0390
         MH    @01,@CH00890                                        0390
         MR    @00,@02                                             0390
         D     @00,@CF00892                                        0390
         ST    @01,GROSTRSH(,@07)                                  0390
*     END;                          /*                       @Y30LB26*/
*                                                                  0392
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK IF RETENTION PERIOD SPECIFIED                   @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0392
*   IF MGPFLRET=ON                  /* CK RETENTION PRD      @Y30LB26*/
*     THEN                          /*                       @Y30LB26*/
*                                                                  0392
@RF00387 TM    MGPFLRET(MGPPTR),B'00000001'                        0392
         BNO   @RF00392                                            0392
*     /***************************************************************/
*     /*                                                             */
*     /* INDICATE RETN CHECKING AND UPDATE FIELD             @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0393
*     DO;                           /*                       @Y30LB26*/
*       GRORETN=ON;                 /* INDICATE RETEN SPEC   @Y30LB26*/
         L     @07,GROUPPTR                                        0394
         OI    GRORETN(@07),B'00000100'                            0394
*       GRORETPD=MGPRETPD;          /* NEW RETEN PERIOD      @Y30LB26*/
         LH    @02,MGPRETPD(,MGPPTR)                               0395
         ST    @02,GRORETPD(,@07)                                  0395
*     END;                          /*                       @Y30LB26*/
*                                                                  0397
*   /*****************************************************************/
*   /*                                                               */
*   /* IF DESCRIPTION UPDATED, FILL IN UPDATE                @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0397
*   IF MGPFLDES=ON                  /* DESCRIPTION SPEC ?    @Y30LB26*/
*     THEN                                                         0397
@RF00392 TM    MGPFLDES(MGPPTR),B'10000000'                        0397
         BNO   @RF00397                                            0397
*     GRODESCR=MGPDESCR;            /* UPDATE DESCRIPTION    @Y30LB26*/
         L     @07,GROUPPTR                                        0398
         MVC   GRODESCR(30,@07),MGPDESCR(MGPPTR)                   0398
*                                                                  0399
*   /*****************************************************************/
*   /*                                                               */
*   /* NEW ADDRESS IF NEEDED                                 @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0399
*   IF MGPFLADD=ON                  /* NEW ADDR SPEC ?       @Y30LB26*/
*     THEN                                                         0399
@RF00397 TM    MGPFLADD(MGPPTR),B'01000000'                        0399
         BNO   @RF00399                                            0399
*     GROADDR=MGPADDR;              /* UPDATE ADDRESS        @Y30LB26*/
         L     @07,GROUPPTR                                        0400
         MVC   GROADDR(30,@07),MGPADDR(MGPPTR)                     0400
*                                                                  0401
*   /*****************************************************************/
*   /*                                                               */
*   /* SET RELEASE FLAG ON                                   @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0401
*   IF MGPRLSE=ON                   /* RELEASE SPEC ?        @Y30LB26*/
*     THEN                                                         0401
@RF00399 TM    MGPRLSE(MGPPTR),B'10000000'                         0401
         BNO   @RF00401                                            0401
*     GRORLSE=ON;                   /* SET TO RELEASE        @Y30LB26*/
         L     @07,GROUPPTR                                        0402
         OI    GRORLSE(@07),B'00001000'                            0402
*                                                                  0403
*   /*****************************************************************/
*   /*                                                               */
*   /* SET RELEASE FLAG OFF                                  @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0403
*   IF MGPNRLSE=ON                  /* NO RELEASE SPEC ?     @Y30LB26*/
*     THEN                                                         0403
@RF00401 TM    MGPNRLSE(MGPPTR),B'01000000'                        0403
         BNO   @RF00403                                            0403
*     GRORLSE=OFF;                  /* SET FOR NO RELEASE    @Y30LB26*/
         L     @07,GROUPPTR                                        0404
         NI    GRORLSE(@07),B'11110111'                            0404
*                                                                  0405
*   /*****************************************************************/
*   /*                                                               */
*   /* SET BIND FLAG ON                                      @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0405
*   IF MGPBIND=ON                   /* BIND SPEC ?           @Y30LB26*/
*     THEN                                                         0405
@RF00403 TM    MGPBIND(MGPPTR),B'00100000'                         0405
         BNO   @RF00405                                            0405
*     GROBIND=ON;                   /* BIND IT               @Y30LB26*/
         L     @07,GROUPPTR                                        0406
         OI    GROBIND(@07),B'10000000'                            0406
*                                                                  0407
*   /*****************************************************************/
*   /*                                                               */
*   /* SET BIND FLAG OFF                                     @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0407
*   IF MGPNBIND=ON                  /* NO BIND ?             @Y30LB26*/
*     THEN                                                         0407
@RF00405 TM    MGPNBIND(MGPPTR),B'00010000'                        0407
         BNO   @RF00407                                            0407
*     GROBIND=OFF;                  /* NO BIND IT            @Y30LB26*/
         L     @07,GROUPPTR                                        0408
         NI    GROBIND(@07),B'01111111'                            0408
*                                                                  0409
*   /*****************************************************************/
*   /*                                                               */
*   /* SET EXCLUSIVE USE FLAG ON                             @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0409
*   IF MGPEXCL=ON                   /* EXCLUSIVE ?           @Y30LB26*/
*     THEN                                                         0409
@RF00407 TM    MGPEXCL(MGPPTR),B'00001000'                         0409
         BNO   @RF00409                                            0409
*     GROEXCL=ON;                   /* SET EXCLUSIVE USE     @Y30LB26*/
         L     @07,GROUPPTR                                        0410
         OI    GROEXCL(@07),B'01000000'                            0410
*                                                                  0411
*   /*****************************************************************/
*   /*                                                               */
*   /* SET EXCLUSIVE USE FLAG OFF                            @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0411
*   IF MGPSHARE=ON                  /* SHARE IT              @Y30LB26*/
*     THEN                                                         0411
@RF00409 TM    MGPSHARE(MGPPTR),B'00000100'                        0411
         BNO   @RF00411                                            0411
*     GROEXCL=OFF;                  /* SHARED                @Y30LB26*/
         L     @07,GROUPPTR                                        0412
         NI    GROEXCL(@07),B'10111111'                            0412
*                                                                  0413
*   /*****************************************************************/
*   /*                                                               */
*   /* SET READ ONLY FLAG ON                                 @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0413
*   IF MGPRONLY=ON                  /* READ ONLY ?           @Y30LB26*/
*     THEN                                                         0413
@RF00411 TM    MGPRONLY(MGPPTR),B'00000010'                        0413
         BNO   @RF00413                                            0413
*     GRORONLY=ON;                  /* IT IS READ ONLY       @Y30LB26*/
         L     @07,GROUPPTR                                        0414
         OI    GRORONLY(@07),B'00010000'                           0414
*                                                                  0415
*   /*****************************************************************/
*   /*                                                               */
*   /* SET READ ONLY FLAG OFF                                @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0415
*   IF MGPRW=ON                     /* READ - WRITE ?        @Y30LB26*/
*     THEN                                                         0415
@RF00413 TM    MGPRW(MGPPTR),B'00000001'                           0415
         BNO   @RF00415                                            0415
*     GRORONLY=OFF;                 /* READ - WRITE BOTH     @Y30LB26*/
         L     @07,GROUPPTR                                        0416
         NI    GRORONLY(@07),B'11101111'                           0416
*                                                                  0417
*   /*****************************************************************/
*   /*                                                               */
*   /* SET DASD ERASE FLAG ON                                @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0417
*   IF MGPDERAS=ON                  /* DASD ERASE ?          @Y30LB26*/
*     THEN                                                         0417
@RF00415 TM    MGPDERAS(MGPPTR),B'10000000'                        0417
         BNO   @RF00417                                            0417
*     GRODAERA=ON;                  /* ERASE IT              @Y30LB26*/
         L     @07,GROUPPTR                                        0418
         OI    GRODAERA(@07),B'00100000'                           0418
*                                                                  0419
*   /*****************************************************************/
*   /*                                                               */
*   /* SET DASD ERASE FLAG OFF                               @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0419
*   IF MGPNDERA=ON                  /* NO DASD ERASE ?       @Y30LB26*/
*     THEN                                                         0419
@RF00417 TM    MGPNDERA(MGPPTR),B'01000000'                        0419
         BNO   @RF00419                                            0419
*     GRODAERA=OFF;                 /* DO NOT ERASE          @Y30LB26*/
         L     @07,GROUPPTR                                        0420
         NI    GRODAERA(@07),B'11011111'                           0420
*                                                                  0421
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK IF NULLIFY THRESHOLD FLAG IS ON                 @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0421
*   IF MGPNTHLD=ON                  /* NULLIFY THRESHOLD ?   @Y30LB26*/
*     THEN                          /*                       @Y30LB26*/
*                                                                  0421
@RF00419 TM    MGPNTHLD(MGPPTR),B'00100000'                        0421
         BNO   @RF00421                                            0421
*     /***************************************************************/
*     /*                                                             */
*     /* IF ON, ZERO PERCENT AND THRESHOLD CYLINDERS         @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0422
*     DO;                           /*                       @Y30LB26*/
*       GROPCENT=ZERO;              /* NULLIFY PERCENT ?     @Y30LB26*/
         L     @07,GROUPPTR                                        0423
         MVI   GROPCENT(@07),X'00'                                 0423
*       GROSTRSH=ZERO;              /* ZERO THRESHOLD CYL    @Y30LB26*/
         SLR   @02,@02                                             0424
         ST    @02,GROSTRSH(,@07)                                  0424
*     END;                          /*                       @Y30LB26*/
*                                                                  0426
*   /*****************************************************************/
*   /*                                                               */
*   /* NULLIFY OWNER FIELD IF ASKED FOR                      @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0426
*   IF MGPNOWNR=ON                  /* NULLIFY OWNER ?       @Y30LB26*/
*     THEN                                                         0426
@RF00421 TM    MGPNOWNR(MGPPTR),B'00010000'                        0426
         BNO   @RF00426                                            0426
*     GROOWNER=BLANK;               /* NULLIFY OWNER         @Y30LB26*/
         L     @07,GROUPPTR                                        0427
         MVI   GROOWNER+1(@07),C' '                                0427
         MVC   GROOWNER+2(8,@07),GROOWNER+1(@07)                   0427
         MVI   GROOWNER(@07),C' '                                  0427
*                                                                  0428
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK IF NULLIFICATION RETENTION PERIOD REQUIRED      @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0428
*   IF MGPNRETP=ON                  /* NULLIFY RET PRD ?     @Y30LB26*/
*     THEN                          /*                       @Y30LB26*/
*                                                                  0428
@RF00426 TM    MGPNRETP(MGPPTR),B'00001000'                        0428
         BNO   @RF00428                                            0428
*     /***************************************************************/
*     /*                                                             */
*     /* SET RET PERIOD CHECK FLAG OFF, ZERO RET PER         @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0429
*     DO;                           /*                       @Y30LB26*/
*       GRORETN=OFF;                /* SET RET PERIOD FLG    @Y30LB26*/
         L     @07,GROUPPTR                                        0430
         NI    GRORETN(@07),B'11111011'                            0430
*       GRORETPD=ZERO;              /* ZERO OUT RET          @Y30LB26*/
         SLR   @02,@02                                             0431
         ST    @02,GRORETPD(,@07)                                  0431
*     END;                          /*                       @Y30LB26*/
*                                                                  0433
*   /*****************************************************************/
*   /*                                                               */
*   /* BLANK DESCRIPTION IF NECESSARY                        @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0433
*   IF MGPNDESC=ON                  /* NULLIFY DESCR ?       @Y30LB26*/
*     THEN                                                         0433
@RF00428 TM    MGPNDESC(MGPPTR),B'00000100'                        0433
         BNO   @RF00433                                            0433
*     GRODESCR=BLANK;               /* BLANK OUT DESCR       @Y30LB26*/
         L     @07,GROUPPTR                                        0434
         MVI   GRODESCR+1(@07),C' '                                0434
         MVC   GRODESCR+2(28,@07),GRODESCR+1(@07)                  0434
         MVI   GRODESCR(@07),C' '                                  0434
*                                                                  0435
*   /*****************************************************************/
*   /*                                                               */
*   /* BLANK ADDRESS                                         @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0435
*   IF MGPNADDR=ON                  /* NULLIFY ADDRESS ?     @Y30LB26*/
*     THEN                                                         0435
@RF00433 TM    MGPNADDR(MGPPTR),B'00000010'                        0435
         BNO   @RF00435                                            0435
*     GROADDR=BLANK;                /* BLANK ADDRESS         @Y30LB26*/
         L     @07,GROUPPTR                                        0436
         MVI   GROADDR+1(@07),C' '                                 0436
         MVC   GROADDR+2(28,@07),GROADDR+1(@07)                    0436
         MVI   GROADDR(@07),C' '                                   0436
*                                                                  0437
*   /*****************************************************************/
*   /*                                                               */
*   /* WRITE GROUP RECORD JUST MODIFIED                      @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0437
*   RPLVTYP=RPLVPUT;                /* PUT GROUP REC         @Y30LB26*/
@RF00435 L     @07,RPLVPTR                                         0437
         MVI   RPLVTYP(@07),X'01'                                  0437
*   RESPECIFY                                                      0438
*     REG1 RSTD;                    /* RESTRICT REG 1        @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR OF RPLV          @Y30LB26*/
         LR    REG1,@07                                            0439
*   CALL ICBVIO00;                  /* WRITE RECORD          @Y30LB26*/
         L     @15,@CV00671                                        0440
         BALR  @14,@15                                             0440
*   RESPECIFY                                                      0441
*     REG1 UNRSTD;                  /* FREE REG 1            @Y30LB26*/
*                                                                  0441
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK RETURN CODE FROM I/O PROCESSOR                  @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0442
*   IF RPLVRETC^=RCZERO             /* CK RETURN CODE        @Y30LB26*/
*     THEN                          /*                       @Y30LB26*/
*                                                                  0442
         L     @07,RPLVPTR                                         0442
         CLC   RPLVRETC(2,@07),@CB00747                            0442
         BE    @RF00442                                            0442
*     /***************************************************************/
*     /*                                                             */
*     /* IF BAD, SAVE CODES AND RETURN                       @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0443
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* SAVE RETURN CODES     @Y30LB26*/
         BAL   @14,ERREXIT                                         0444
*       RETURN;                     /* RETURN TO CALLER      @Y30LB26*/
         B     @EL00004                                            0445
*     END;                          /*                       @Y30LB26*/
*                                                                  0447
*   /*****************************************************************/
*   /*                                                               */
*   /* GO JOURNAL RPLV SINCE MODIFIED GROUP REC WRITTEN      @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0447
*   CALL JOURNAL;                   /* JOURNAL RPLV          @Y30LB26*/
@RF00442 BAL   @14,JOURNAL                                         0447
*   IF RPLVRETC^=RCZERO THEN        /* CK RETURN             @Y30LB26*/
         L     @07,RPLVPTR                                         0448
         CLC   RPLVRETC(2,@07),@CB00747                            0448
         BNE   @RT00448                                            0448
*     RETURN;                       /*                       @Y30LB26*/
*                                                                  0450
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK TO SEE IF EXPIRATION DATE WAS NULLIFIED.        @Y30LB26*/
*   /* IF SO, GO CLEAR EXPIRATION OUT OF ALL BASE RECS       @Y30LB26*/
*   /* IN THAT GROUP........                                 @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0450
*   IF MGPNRETP=ON THEN             /* NULLIFY RETENTION ?   @Y30LB26*/
         TM    MGPNRETP(MGPPTR),B'00001000'                        0450
         BNO   @RF00450                                            0450
*     DO;                           /*                       @Y30LB26*/
*       CALL NULBASRT;              /* GO NULL BASES         @Y30LB26*/
         BAL   @14,NULBASRT                                        0452
*       IF RPLVRETC^=RCZERO THEN    /* CK RETURN             @Y30LB26*/
         L     @02,RPLVPTR                                         0453
         CLC   RPLVRETC(2,@02),@CB00747                            0453
         BNE   @RT00453                                            0453
*         RETURN;                   /*                       @Y30LB26*/
*     END;                          /*                       @Y30LB26*/
*                                                                  0456
*/* NEED TO CONVERT GROUP TO MSS RELEASE THREE ?             @G24LB04*/
*                                                                  0456
*   IF REL3CONF=ON                  /*                       @G24LB04*/
*     THEN                                                         0456
@RF00450 TM    REL3CONF,B'00000010'                                0456
         BNO   @RF00456                                            0456
*     DO;                           /* YES                   @G24LB04*/
*       CALL REL3CONV;              /* EFFECTS CHANGES       @G24LB04*/
         BAL   @14,REL3CONV                                        0458
*       REL3CONF=OFF;               /* TURN OFF SWITCH       @G24LB04*/
         NI    REL3CONF,B'11111101'                                0459
*     END;                          /*                       @G24LB04*/
*   RETURN;                         /* RETURN TO CALLER      @Y30LB26*/
         B     @EL00004                                            0461
*   END MODIFYG;                    /*                       @Y30LB26*/
         B     @EL00004                                            0462
*                                                                  0463
*   /*****************************************************************/
*   /*                                                               */
*   /* ROUTINE CHECKS TO SEE IF THERE ARE ANY VOLUMES        @Y30LB26*/
*   /* THAT NEED TO HAVE THEIR EXPIRATION DATES NULLIFIED    @Y30LB26*/
*   /* ANY ACTIVE OR INACTIVE GENERAL TYPE VOLUMES WILL      @Y30LB26*/
*   /* HAVE THEIR EXPIRATION DATES NULLIFIED                 @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0463
*NULBASRT:                                                         0463
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
*                                                                  0463
NULBASRT ST    @14,@SA00005                                        0463
*   /*****************************************************************/
*   /*                                                               */
*   /* SEE IF ANY VOLUMES IN GROUP                           @Y301B26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0464
*   IF GRONGEN=ZERO&GRONINAC=ZERO THEN/*                     @Y30LB26*/
         SLR   @02,@02                                             0464
         L     @15,GROUPPTR                                        0464
         CH    @02,GRONGEN(,@15)                                   0464
         BNE   @RF00464                                            0464
         CH    @02,GRONINAC(,@15)                                  0464
         BE    @RT00464                                            0464
*     RETURN;                       /*                       @Y30LB26*/
*   VOLKY=GROFSN;                   /* VOL NAME OF FIRST     @Y301B26*/
*                                                                  0466
@RF00464 L     @02,GROUPPTR                                        0466
         MVC   VOLKY(6),GROFSN(@02)                                0466
*   /*****************************************************************/
*   /*                                                               */
*   /* START LOOPING THRU BASE RECORDS IN THIS GROUP         @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0467
*   DO WHILE I=I;                   /* LOOP THRU BASE RECS   @Y30LB26*/
         B     @DE00467                                            0467
@DL00467 DS    0H                                                  0468
*     RPLVKEY=ADDR(VKEY);           /* ADDR OF KEY           @Y30LB26*/
         L     @02,RPLVPTR                                         0468
         LA    @15,VKEY                                            0468
         ST    @15,RPLVKEY(,@02)                                   0468
*     RPLVBUF=ADDR(STORBASE);       /* ADDR BUFFER           @Y30LB26*/
         LA    @15,STORBASE                                        0469
         ST    @15,RPLVBUF(,@02)                                   0469
*     RPLVBLN=LENGTH(STORBASE);     /* LENGTH OF BUFFER      @Y30LB26*/
         MVC   RPLVBLN(4,@02),@CF01147                             0470
*     RPLVKGE=OFF;                  /* SET KEY GTR OR EQU OFF      0471
*                                                            @ZA14732*/
*     RPLVDIR=ON;                   /* READ DIRECT           @Y301B26*/
         OI    RPLVDIR(@02),B'01000000'                            0472
         NI    RPLVKGE(@02),B'11111011'                            0472
*     RPLVTYP=RPLVREAD;             /* READ REC              @Y301B26*/
         MVI   RPLVTYP(@02),X'00'                                  0473
*     RPLVUPD=ON;                   /* FOR UPDATE            @Y301B26*/
         OI    RPLVUPD(@02),B'00000010'                            0474
*     RESPECIFY                                                    0475
*       REG1 RSTD;                  /* RESTRICT              @Y301B26*/
*     REG1=RPLVPTR;                 /* ADDR RPLV             @Y301B26*/
         LR    REG1,@02                                            0476
*     CALL ICBVIO00;                /* READ BASE             @Y301B26*/
         L     @15,@CV00671                                        0477
         BALR  @14,@15                                             0477
*     RESPECIFY                                                    0478
*       REG1 UNRSTD;                /* FREE REG1             @Y301B26*/
*                                                                  0478
*     /***************************************************************/
*     /*                                                             */
*     /* CHECK RETURN CODE FROM I/O PROCESSOR                @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0479
*     IF RPLVRETC^=RCZERO THEN      /* CHECK RETURN          @Y301B26*/
         L     @02,RPLVPTR                                         0479
         CLC   RPLVRETC(2,@02),@CB00747                            0479
         BE    @RF00479                                            0479
*       DO;                         /*                       @Y301B26*/
*         CALL ERREXIT;             /* RELEASE INVENTORY     @Y301B26*/
         BAL   @14,ERREXIT                                         0481
*         RETURN;                   /*                       @Y301B26*/
@EL00005 DS    0H                                                  0482
@EF00005 DS    0H                                                  0482
@ER00005 L     @14,@SA00005                                        0482
         BR    @14                                                 0482
*       END;                        /*                       @Y301B26*/
*     BASEVPTR=ADDR(STORBASE);      /* ADDR OF BASE REC      @Y301B26*/
*                                                                  0484
@RF00479 LA    @02,STORBASE                                        0484
         ST    @02,BASEVPTR                                        0484
*     /***************************************************************/
*     /*                                                             */
*     /* IF BASE VOL IS GENERAL USE, NULLIFY THE             @Y30LB26*/
*     /* EXPIRATION DATE AND WRITE RECORD                    @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0485
*     IF BASGENUS=ON THEN           /* GENERAL USE?          @Y301B26*/
         TM    BASGENUS(@02),B'00010000'                           0485
         BNO   @RF00485                                            0485
*       DO;                         /*                       @Y301B26*/
*         BASEXPDT=NULEXPDT;        /* NULLIFY EXPIRATION    @Y301B26*/
         MVC   BASEXPDT(4,@02),NULEXPDT                            0487
*         RPLVTYP=RPLVPUT;          /* INDICATION            @Y301B26*/
         L     @02,RPLVPTR                                         0488
         MVI   RPLVTYP(@02),X'01'                                  0488
*         RESPECIFY                                                0489
*           REG1 RSTD;              /* RESTRICT              @Y301B26*/
*         REG1=RPLVPTR;             /* ADDR OF PRLV          @Y301B26*/
         LR    REG1,@02                                            0490
*         CALL ICBVIO00;            /* WRITE BASE REC        @Y301B26*/
         L     @15,@CV00671                                        0491
         BALR  @14,@15                                             0491
*         RESPECIFY                                                0492
*           REG1 UNRSTD;            /* FREE REG 1            @Y301B26*/
*                                                                  0492
*         /***********************************************************/
*         /*                                                         */
*         /* CHECK RETURN FROM WRITING RECORD                @Y30LB26*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  0493
*         IF RPLVRETC^=RCZERO THEN  /* CK RETURN             @Y301B26*/
         L     @02,RPLVPTR                                         0493
         CLC   RPLVRETC(2,@02),@CB00747                            0493
         BE    @RF00493                                            0493
*           DO;                     /*                       @Y301B26*/
*             CALL ERREXIT;         /* RELEASE INVENTORY     @Y301B26*/
         BAL   @14,ERREXIT                                         0495
*             RETURN;               /*                       @Y301B26*/
         B     @EL00005                                            0496
*           END;                    /*                       @Y301B26*/
*                                                                  0497
*         /***********************************************************/
*         /*                                                         */
*         /* CALL SLOT ROUTINE TO CLEAR EXPIRATION           @Y30LB26*/
*         /* DATES OUT OF EXTENSION SLOTS                    @Y30LB26*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  0498
*         SLOTEXP=ON;               /* INDICATE EXP ONLY     @Y30LB26*/
@RF00493 OI    SLOTEXP,B'10000000'                                 0498
*         CALL VUEXT;               /* GO SLOT IT            @Y30LB26*/
         BAL   @14,VUEXT                                           0499
*       END;                        /*                       @ZA14732*/
*                                                                  0500
*     /***************************************************************/
*     /*                                                             */
*     /* CHECK TO SEE IF LAST BASE RECORD IN CHAIN           #Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0501
*     IF BASLAST=ON THEN            /* LAST BASE IN CHAIN?   #Y301B26*/
@RF00485 L     @02,BASEVPTR                                        0501
         TM    BASLAST(@02),B'00001000'                            0501
         BNO   @RF00501                                            0501
*       DO;                         /*                       #Y301B26*/
*         RPLVRETC=RCZERO;          /* GOOD RETURN           #Y301B26*/
         L     @02,RPLVPTR                                         0503
         MVC   RPLVRETC(2,@02),@CB00747                            0503
*         RPLRCODE=RCZERO;          /* GOOD REASON           #Y301B26*/
         MVC   RPLRCODE(2,@02),@CB00747                            0504
*         RETURN;                   /*                       #Y301B26*/
         B     @EL00005                                            0505
*       END;                        /*                       #Y301B26*/
*     VOLKY=BASNEXTV;               /* VOLID OF NEXT BASE    #Y301B26*/
@RF00501 L     @02,BASEVPTR                                        0507
         MVC   VOLKY(6),BASNEXTV(@02)                              0507
*   END;                            /*                       @Y301B26*/
@DE00467 CLC   I(1),I                                              0508
         BE    @DL00467                                            0508
*   END NULBASRT;                   /*                       @Y301B26*/
         B     @EL00005                                            0509
*REL3CONV:                                                         0510
*   PROC OPTIONS(SAVE(REG14));      /*                       @G24LB04*/
REL3CONV ST    @14,@SA00006                                        0510
*/*CONVERSION TO MSS RELEASE THREE FROM                      @G24LB04*/
*/*PRIOR MSS SUPPORT                                         @G24LB04*/
*/* THIS PROCEDURE GOES THROUGH ALL OF THE GROUP EXTENSION   @G24LB04*/
*/* RECORDS FOR THE GROUP BEING PROCESSED, AND UPDATES THEM. @G24LB04*/
*/* FOR EACH VOLUME WHICH IS EITHER MOUNTED TO NO PROCESSOR  @G24LB04*/
*/* AND WHICH DOES NOT CURRENTLY HAVE DOWN LEVEL SPACE,      @G24LB04*/
*/* (1) THE PRESENT FREE SPACE VALUE FROM THE BASE VOLUME    @G24LB04*/
*/* RECORD IS INSERTED INTO THE GROUP EXTENSION RECORD SLOT  @G24LB04*/
*/* FOR THAT VOLUME. (2) THE FLAG SHOWING WHETHER THE        @G24LB04*/
*/* RUNNING COUNT OF FREE SPACE IS VALID OR NOT IS SET TO    @G24LB04*/
*/* SHOW VALID. FOR VOLUMES WHICH HAVE DOWN LEVEL SPACE,     @G24LB04*/
*/* OR ARE MOUNTED TO ANY PROCESSOR, THE FLAG SHOWING        @G24LB04*/
*/* RUNNING COUNT OF FREE SPACE IS SET TO SHOW INVALID.      @G24LB04*/
*/* EACH GROUP EXTENSION RECORD IS WRITTEN AFTER IT HAS      @G24LB04*/
*/* BEEN UPDATED.                                            @G24LB04*/
*                                                                  0511
*   IF GRONGEN=ZERO                 /* ANY VOLUMES IN GROUP? @G24LB04*/
*     THEN                                                         0511
         L     @02,GROUPPTR                                        0511
         LH    @15,GRONGEN(,@02)                                   0511
         LTR   @15,@15                                             0511
         BZ    @RT00511                                            0511
*     RETURN;                       /* NOTHING TO DO         @G24LB04*/
*   GVSNEPTR=ADDR(STORGPEX);        /* ADDRESS BUFFER        @G24LB04*/
         LA    GVSNEPTR,STORGPEX                                   0513
*   GROUPKY=GROVVGRP;               /* GROUP ID              @G24LB04*/
         L     @15,GROUPPTR                                        0514
         MVC   GROUPKY(8),GROVVGRP(@15)                            0514
*   GIDKY=FIXZERO;                  /* ZERO KEY              @G24LB04*/
         MVI   GIDKY,X'00'                                         0515
*   DO UNTIL GVSEX=OFF;             /* LOOP THRU GVSNES      @G24LB04*/
@DL00516 DS    0H                                                  0517
*     GIDKY=GIDKY+FIXONE;           /* BEYOND FIRST GROUP    @G24LB04
*                                      RECORD                @G24LB04*/
         LA    @15,1                                               0517
         SLR   @14,@14                                             0517
         IC    @14,GIDKY                                           0517
         ALR   @15,@14                                             0517
         STC   @15,GIDKY                                           0517
*     RPLVKEY=ADDR(GKEY);           /* KEY                   @G24LB04*/
         L     @15,RPLVPTR                                         0518
         LA    @14,GKEY                                            0518
         ST    @14,RPLVKEY(,@15)                                   0518
*     RPLVBUF=ADDR(STORGPEX);       /* WHERE TO PUT GVSNE    @G24LB04*/
         LA    @14,STORGPEX                                        0519
         ST    @14,RPLVBUF(,@15)                                   0519
*     RPLVLOC=OFF;                  /* NOT LOCATE MODE       @G24LB04*/
         NI    RPLVLOC(@15),B'01111111'                            0520
*     RPLVBLN=LENGTH(STORGPEX);     /* BUFFER LENGTH         @G24LB04*/
         MVC   RPLVBLN(4,@15),@CF01148                             0521
*     RPLVDIR=ON;                   /* READ DIRECT           @G24LB04*/
         OI    RPLVDIR(@15),B'01000000'                            0522
*     RPLVTYP=RPLVREAD;             /* READ RECORD           @G24LB04*/
         MVI   RPLVTYP(@15),X'00'                                  0523
*     RPLVKGE=ON;                   /* READ > OR =           @G24LB04
*                                      (THIS GOES TO NEXT)   @G24LB04*/
         OI    RPLVKGE(@15),B'00000100'                            0524
*     RPLVUPD=ON;                   /* FOR UPDATE            @G24LB04*/
         OI    RPLVUPD(@15),B'00000010'                            0525
*     RESPECIFY                                                    0526
*       REG1 RSTD;                  /*                       @G24LB04*/
*     REG1=RPLVPTR;                 /*                       @G24LB04*/
         LR    REG1,@15                                            0527
*     CALL ICBVIO00;                /* READ EXTENSION RECORD @G24LB04*/
         L     @15,@CV00671                                        0528
         BALR  @14,@15                                             0528
*     RESPECIFY                                                    0529
*       REG1 UNRSTD;                /*                       @G24LB04*/
*     IF RPLVRETC^=RCZERO           /*                       @G24LB04*/
*       THEN                                                       0530
         L     @01,RPLVPTR                                         0530
         CLC   RPLVRETC(2,@01),@CB00747                            0530
         BE    @RF00530                                            0530
*       DO;                         /*                       @G24LB04*/
*         CALL ERREXIT;             /*                       @G24LB04*/
         BAL   @14,ERREXIT                                         0532
*         RETURN;                   /*                       @G24LB04*/
@EL00006 DS    0H                                                  0533
@EF00006 DS    0H                                                  0533
@ER00006 L     @14,@SA00006                                        0533
         BR    @14                                                 0533
*       END;                        /*                       @G24LB04*/
*     DO IS=1 TO GVSESIND-1;        /* PROCESS ALL SLOTS     @G24LB04
*                                      IN THIS GROUP         @G24LB04
*                                      EXTENSION RECORD      @G24LB04*/
*                                                                  0535
@RF00530 LA    IS,1                                                0535
         B     @DE00535                                            0535
@DL00535 DS    0H                                                  0536
*       /*************************************************************/
*       /*                                                           */
*       /* READ BASE VOLUME RECORD FOR THIS VOLSER           @G24LB04*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0536
*       VOLKY=GVSVOLID(IS);         /* VOLSER TO KEY         @G24LB04*/
         LR    @05,IS                                              0536
         MH    @05,@CH01149                                        0536
         ALR   @05,GVSNEPTR                                        0536
         MVC   VOLKY(6),GVSVOLID-20(@05)                           0536
*       RPLVKEY=ADDR(VKEY);         /*                       @G24LB04*/
         L     @05,RPLVPTR                                         0537
         LA    @15,VKEY                                            0537
         ST    @15,RPLVKEY(,@05)                                   0537
*       RPLVLOC=ON;                 /* LOCATE MODE           @G24LB04*/
*       RPLVDIR=ON;                 /* DIRECT                @G24LB04*/
         OI    RPLVLOC(@05),B'11000000'                            0539
*       RPLVUPD=OFF;                /* NOT UPDATING          @G24LB04*/
         NI    RPLVUPD(@05),B'11111101'                            0540
*       RPLVTYP=RPLVREAD;           /* SPECIFY READ          @G24LB04*/
         MVI   RPLVTYP(@05),X'00'                                  0541
*       RPLVKGE=OFF;                /* RESET                 @G24LB04*/
         NI    RPLVKGE(@05),B'11111011'                            0542
*       RFY                                                        0543
*         REG1 RSTD;                /*                       @G24LB04*/
*       REG1=RPLVPTR;               /*                       @G24LB04*/
         LR    REG1,@05                                            0544
*       CALL ICBVIO00;              /* READ BASE VOLUME RECORD     0545
*                                                            @G24LB04*/
         L     @15,@CV00671                                        0545
         BALR  @14,@15                                             0545
*       RFY                                                        0546
*         REG1 UNRSTD;              /*                       @G24LB04*/
*       IF RPLVRETC^=ZERO THEN      /* ERROR IN I/O?         @G24LB04*/
         L     @05,RPLVPTR                                         0547
         LH    @05,RPLVRETC(,@05)                                  0547
         N     @05,@CF01186                                        0547
         LTR   @05,@05                                             0547
         BZ    @RF00547                                            0547
*         DO;                       /*                       @G24LB04*/
*           CALL ERREXIT;           /*                       @G24LB04*/
         BAL   @14,ERREXIT                                         0549
*           RETURN;                 /*                       @G24LB04*/
         B     @EL00006                                            0550
*         END;                      /*                       @G24LB04*/
*       BASEVPTR=RPLVBUF;           /*                       @G24LB04*/
@RF00547 L     @05,RPLVPTR                                         0552
         L     @05,RPLVBUF(,@05)                                   0552
         ST    @05,BASEVPTR                                        0552
*       IF BASCPUID=BITZERO         /* VOL NOT MTD TO ANY CPU?     0553
*                                                            @G24LB04*/
*           &BASDLSF=OFF            /* SPACE NOT DOWN LEVEL? @G24LB04*/
*         THEN                                                     0553
         CLC   BASCPUID(2,@05),@CB00747                            0553
         BNE   @RF00553                                            0553
         TM    BASDLSF(@05),B'10000000'                            0553
         BNZ   @RF00553                                            0553
*         DO;                       /*                       @G24LB04*/
*           GVSMTDSP(IS)=BASFRESP;  /* UPDATE FREE SPACE     @G24LB04*/
         LR    @15,IS                                              0555
         MH    @15,@CH01149                                        0555
         LH    @05,BASFRESP(,@05)                                  0555
         N     @05,@CF01186                                        0555
         STH   @05,GVSMTDSP-20(@15,GVSNEPTR)                       0555
*           GVSRCFSI(IS)=OFF;       /* RUNNING COUNT IS OK   @G24LB04*/
*           GVSMTNSH(IS)=OFF;       /* VOL NOT MTD NON-SHR   @G24LB04*/
         ALR   @15,GVSNEPTR                                        0557
         NI    GVSRCFSI-20(@15),B'00111111'                        0557
*         END;                      /*                       @G24LB04*/
*       ELSE                                                       0559
*         GVSRCFSI(IS)=ON;          /* RUNNING COUNT INVALID @G24LB04*/
         B     @RC00553                                            0559
@RF00553 LR    @05,IS                                              0559
         MH    @05,@CH01149                                        0559
         ALR   @05,GVSNEPTR                                        0559
         OI    GVSRCFSI-20(@05),B'10000000'                        0559
*     END;                          /* PROCESSING FOR EACH   @G24LB04
*                                      SLOT                  @G24LB04*/
*                                                                  0560
@RC00553 AL    IS,@CF00041                                         0560
@DE00535 LH    @05,GVSESIND(,GVSNEPTR)                             0560
         BCTR  @05,0                                               0560
         CR    IS,@05                                              0560
         BNH   @DL00535                                            0560
*     /***************************************************************/
*     /*                                                             */
*     /* MUST READ GVSNE RECORD ONCE MORE INTO A DUMMY       @G24LB04*/
*     /* BUFFER BEFORE WRITING IT BECAUSE OTHER RECORDS      @G24LB04*/
*     /* HAVE BEEN READ SINCE THIS ONE.                      @G24LB04*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0561
*     RPLVKEY=ADDR(GVSNAME);        /* KEY                   @G24LB04*/
         L     @15,RPLVPTR                                         0561
         ST    GVSNEPTR,RPLVKEY(,@15)                              0561
*     RPLVBUF=ADDR(DUMGVSNE);       /* NOT REFERENCED-DUMMY  @G24LB04*/
         LA    @14,DUMGVSNE                                        0562
         ST    @14,RPLVBUF(,@15)                                   0562
*     RPLVLOC=OFF;                  /* NOT LOCATE MODE       @G24LB04*/
         NI    RPLVLOC(@15),B'01111111'                            0563
*     RPLVBLN=LENGTH(DUMGVSNE);     /*                       @G24LB04*/
         MVC   RPLVBLN(4,@15),@CF01148                             0564
*     RPLVDIR=ON;                   /* READ DIRECT           @G24LB04*/
         OI    RPLVDIR(@15),B'01000000'                            0565
*     RPLVTYP=RPLVREAD;             /* READ                  @G24LB04*/
         MVI   RPLVTYP(@15),X'00'                                  0566
*     RPLVKGE=OFF;                  /* USE THIS KEY          @G24LB04*/
         NI    RPLVKGE(@15),B'11111011'                            0567
*     RPLVUPD=ON;                   /* READ FOR UPDATE       @G24LB04*/
         OI    RPLVUPD(@15),B'00000010'                            0568
*     RFY                                                          0569
*       REG1 RSTD;                  /*                       @G24LB04*/
*     REG1=RPLVPTR;                 /*                       @G24LB04*/
         LR    REG1,@15                                            0570
*     CALL ICBVIO00;                /* READ GVSNE            @G24LB04*/
         L     @15,@CV00671                                        0571
         BALR  @14,@15                                             0571
*     RFY                                                          0572
*       REG1 UNRSTD;                /*                       @G24LB04*/
*     IF RPLVRETC^=ZERO THEN        /* ERROR?                @G24LB04*/
         L     @01,RPLVPTR                                         0573
         LH    @15,RPLVRETC(,@01)                                  0573
         N     @15,@CF01186                                        0573
         LTR   @15,@15                                             0573
         BZ    @RF00573                                            0573
*       DO;                         /*                       @G24LB04*/
*         CALL ERREXIT;             /*                       @G24LB04*/
         BAL   @14,ERREXIT                                         0575
*         RETURN;                   /*                       @G24LB04*/
         B     @EL00006                                            0576
*       END;                        /*                       @G24LB04*/
*                                                                  0577
*     /***************************************************************/
*     /*                                                             */
*     /* WRITE THE UPDATED GROUP EXTENSION RECORD            @G24LB04*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0578
*     RPLVBUF=ADDR(STORGPEX);       /* WHERE RECORD IS       @G24LB04*/
@RF00573 L     @15,RPLVPTR                                         0578
         LA    @14,STORGPEX                                        0578
         ST    @14,RPLVBUF(,@15)                                   0578
*     RPLVTYP=RPLVPUT;              /* WRITE                 @G24LB04*/
         MVI   RPLVTYP(@15),X'01'                                  0579
*     RFY                                                          0580
*       REG1 RSTD;                  /*                       @G24LB04*/
*     REG1=RPLVPTR;                 /*                       @G24LB04*/
         LR    REG1,@15                                            0581
*     CALL ICBVIO00;                /*                       @G24LB04*/
         L     @15,@CV00671                                        0582
         BALR  @14,@15                                             0582
*     RFY                                                          0583
*       REG1 UNRSTD;                /*                       @G24LB04*/
*     IF RPLVRETC^=RCZERO THEN      /* ERROR IN I/O          @G24LB04*/
         L     @01,RPLVPTR                                         0584
         CLC   RPLVRETC(2,@01),@CB00747                            0584
         BE    @RF00584                                            0584
*       DO;                         /*                       @G24LB04*/
*         CALL ERREXIT;             /*                       @G24LB04*/
         BAL   @14,ERREXIT                                         0586
*         RETURN;                   /*                       @G24LB04*/
         B     @EL00006                                            0587
*       END;                        /*                       @G24LB04*/
*   END;                            /* END LOOP THROUGH GVSNES     0589
*                                                            @G24LB04*/
@RF00584 DS    0H                                                  0589
@DE00516 TM    GVSEX(GVSNEPTR),B'10000000'                         0589
         BNZ   @DL00516                                            0589
*   END REL3CONV;                   /*                       @G24LB04*/
         B     @EL00006                                            0590
*                                                                  0591
*/*  START OF SPECIFICATIONS ****                                  0591
*                                                                  0591
*    PROCEDURE NAME - SCRATCHG                                @Y30LB26
*                                                                  0591
*    FUNCTION - TO SCRATCH A GROUP RECORD FROM USERCAT.MSVI DATA SET.
*    BEFORE DOING THIS, THE NUMBER OF GENERAL USE VOLUMES IN THE GROUP,
*    THE NUMBER OF RESTRICTED USE VOLUMES AND THE NUMBER OF INACTIVE
*    VOLUMES MUST ALL BE ZERO.  THE PROGRAM WILL NOT ALLOW SYSGROUP TO
*    BE SCRATCHED.  THE RPLV IS JOURNALED AFTER THE GROUP RECORD IS
*    SUCCESSFULLY DELETED FROM THE MSVC INVENTORY DATA SET.   @Y30LB26
*                                                                  0591
*      INPUTS - REGISTER 1 CONTAINS THE ADDRESS OF THE RPLV WHICH  0591
*      CONTAINS THE REQUEST BLOCK.                            @Y30LB26
*                                                                  0591
*      OUTPUTS - REASON CODE AND RETURN CODE IN RPLV.         @Y30LB26
*                                                                  0591
*       '021C'X  TRIED TO SCRATCH A GROUP THAT STILL HAS      @Y30LB26
*       VOLUMES ASSIGNED TO IT.                               @Y30LB26
*       '0226'X  CAN NOT SCRATCH SYSGROUP.                    @Y30LB26
*       PLUS ANY REASON CODES FROM THE I/O PROCESSOR OR THE   @Y30LB26
*       JOURNAL PROGRAM.                                      @Y30LB26
**** END OF SPECIFICATIONS **                                        */
*                                                                  0591
*SCRATCHG:                                                         0591
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
SCRATCHG ST    @14,@SA00007                                        0591
*                                                                  0592
*   /*****************************************************************/
*   /*                                                               */
*   /* SET UP ADDRESS TO REQUEST BLOCK                       #Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0592
*   SGPPTR=ADDR(RPLVUTIL);          /* ADDR REQUEST BLK      #Y30LB26*/
*                                                                  0592
         L     @02,RPLVPTR                                         0592
         LA    SGPPTR,RPLVUTIL(,@02)                               0592
*   /*****************************************************************/
*   /*                                                               */
*   /* BE SURE THAT NOT TRYING TO ERASE THE SYSGROUP         #Y30LB26*/
*   /* GROUP, BECAUSE THIS IS NOT ALLOWED.                   #Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0593
*   IF SGPGROUP=SYSGROUP THEN       /* SYSGROUP ?            #Y30LB26*/
         CLC   SGPGROUP(8,SGPPTR),SYSGROUP                         0593
         BNE   @RF00593                                            0593
*     DO;                           /*                       #Y30LB26*/
*       RPLVRETC=FOUR;              /* BAD RET CODE          #Y30LB26*/
         MVC   RPLVRETC(2,@02),@CB00749                            0595
*       RPLRCODE=NOSYSGRP;          /* INDICATE PROBLEM      #Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00829                            0596
*       RETURN;                     /*                       #Y30LB26*/
@EL00007 DS    0H                                                  0597
@EF00007 DS    0H                                                  0597
@ER00007 L     @14,@SA00007                                        0597
         BR    @14                                                 0597
*     END;                          /*                       #Y30LB26*/
*                                                                  0598
*   /*****************************************************************/
*   /*                                                               */
*   /* RESERVE INVENTORY DATA SET                            #Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0599
*   CALL RESERINV;                  /* RESER INVEN           #Y30LB26*/
@RF00593 BAL   @14,RESERINV                                        0599
*                                                                  0600
*   /*****************************************************************/
*   /*                                                               */
*   /* READ GROUP RECORD                                     @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0600
*   GROUPKY=SGPGROUP;               /* GRP NAME IN KEY       @Y30LB26*/
         MVC   GROUPKY(8),SGPGROUP(SGPPTR)                         0600
*   RPLVKEY=ADDR(GKEY);             /* ADDR KEY IN VSAM      @Y30LB26*/
         L     @02,RPLVPTR                                         0601
         LA    @15,GKEY                                            0601
         ST    @15,RPLVKEY(,@02)                                   0601
*   RPLVBUF=ADDR(STORGRP);          /* BUFFER ADDRESS        @Y30LB26*/
         LA    @15,STORGRP                                         0602
         ST    @15,RPLVBUF(,@02)                                   0602
*   RPLVBLN=LENGTH(STORGRP);        /* LENGTH OF BUFFER      @Y30LB26*/
         MVC   RPLVBLN(4,@02),@CF01147                             0603
*   RPLVDIR=ON;                     /* DIRECT READ           @Y30LB26*/
         OI    RPLVDIR(@02),B'01000000'                            0604
*   RPLVTYP=RPLVREAD;               /* READ REC              @Y30LB26*/
         MVI   RPLVTYP(@02),X'00'                                  0605
*   RPLVUPD=ON;                     /* READ FOR UPDATE       @Y30LB26*/
         OI    RPLVUPD(@02),B'00000010'                            0606
*   RESPECIFY                                                      0607
*     REG1 RSTD;                    /* RESTRICT REG 1        @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR RPLV             @Y30LB26*/
         LR    REG1,@02                                            0608
*   CALL ICBVIO00;                  /* READ GRP REC          @Y30LB26*/
         L     @15,@CV00671                                        0609
         BALR  @14,@15                                             0609
*   RESPECIFY                                                      0610
*     REG1 UNRSTD;                  /* FREE REG 1            @Y30LB26*/
*                                                                  0611
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK RETURN CODES FROM I/O PROCESSOR                 @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0611
*   IF RPLVRETC^=RCZERO             /* CK RET CODE           @Y30LB26*/
*     THEN                          /*                       @Y30LB26*/
*                                                                  0611
         L     @02,RPLVPTR                                         0611
         CLC   RPLVRETC(2,@02),@CB00747                            0611
         BE    @RF00611                                            0611
*     /***************************************************************/
*     /*                                                             */
*     /* IF BAD, SAVE CODES AND RETURN TO CALLER             @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0612
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* SAVE REASON CODES     @Y30LB26*/
         BAL   @14,ERREXIT                                         0613
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00007                                            0614
*     END;                          /*                       @Y30LB26*/
*   GROUPPTR=ADDR(STORGRP);         /* ADDR GRP REC          @Y30LB26*/
@RF00611 LA    @02,STORGRP                                         0616
         ST    @02,GROUPPTR                                        0616
*                                                                  0617
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK TO SEE IF ANY VOLUMES IN GROUP AT ALL           @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0617
*   IF GRONGEN^=ZEROGRONRSTD^=ZEROGRONINAC^=ZERO/*         @Y30LB26*/
*     THEN                          /*                       @Y30LB26*/
*                                                                  0617
         SLR   @15,@15                                             0617
         CH    @15,GRONGEN(,@02)                                   0617
         BNE   @RT00617                                            0617
         CH    @15,GRONRSTD(,@02)                                  0617
         BNE   @RT00617                                            0617
         CH    @15,GRONINAC(,@02)                                  0617
         BE    @RF00617                                            0617
@RT00617 DS    0H                                                  0618
*     /***************************************************************/
*     /*                                                             */
*     /* IF NOT EMPTY, SET REASON, RETURN CODES, RETN        @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0618
*     DO;                           /*                       @Y30LB26*/
*       RPLVRETC=FOUR;              /* SET BAD RET CODE      @Y30LB26*/
         L     @02,RPLVPTR                                         0619
         MVC   RPLVRETC(2,@02),@CB00749                            0619
*       RPLRCODE=NOEMPTY;           /* SET REASON CODE       @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00805                            0620
*       CALL ERREXIT;               /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         0621
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00007                                            0622
*     END;                          /*                       @Y30LB26*/
*                                                                  0624
*   /*****************************************************************/
*   /*                                                               */
*   /* DELETE GROUP RECORD                                   @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0624
*   RPLVTYP=RPLVDEL;                /* DELETE GRP REC        @Y30LB26*/
@RF00617 L     @02,RPLVPTR                                         0624
         MVI   RPLVTYP(@02),X'05'                                  0624
*   RESPECIFY                                                      0625
*     REG1 RSTD;                    /* RESTRICT REG 1        @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR OF RPLV          @Y30LB26*/
         LR    REG1,@02                                            0626
*   CALL ICBVIO00;                  /* DELETE GROUP REC      @Y30LB26*/
         L     @15,@CV00671                                        0627
         BALR  @14,@15                                             0627
*   RESPECIFY                                                      0628
*     REG1 UNRSTD;                  /* FREE REG 1            @Y30LB26*/
*                                                                  0628
*   /*****************************************************************/
*   /*                                                               */
*   /* IF UNSUCCESSFUL, SAVE CODES AND RETURN TO CALLER      @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0629
*   IF RPLVRETC^=RCZERO             /* CK RETURN CODE        @Y30LB26*/
*     THEN                          /*                       @Y30LB26*/
         L     @02,RPLVPTR                                         0629
         CLC   RPLVRETC(2,@02),@CB00747                            0629
         BE    @RF00629                                            0629
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         0631
*       RETURN;                     /* RETURN TO CALLER      @Y30LB26*/
         B     @EL00007                                            0632
*     END;                          /*                       @Y30LB26*/
*                                                                  0633
*   /*****************************************************************/
*   /*                                                               */
*   /* GO JOURNAL RPLV SINCE GROUP REC WRITTEN               @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0634
*   CALL JOURNAL;                   /* JOURNAL RPLV          @Y30LB26*/
@RF00629 BAL   @14,JOURNAL                                         0634
*   RETURN;                         /*                       @Y30LB26*/
         B     @EL00007                                            0635
*   END SCRATCHG;                   /* END SCRATCHG INT      @Y30LB26*/
*                                                                  0637
*/*  START OF SPECIFICATIONS ****                                  0637
*                                                                  0637
*    PROCEDURE NAME - REMOVEVR                                @Y30LB26
*                                                                  0637
*    FUNCTION - TO REMOVE VOLUME RECORD FROM THE USERCAT.MSVI DATA SET.
*    THIS PROGRAM WILL REMOVE EITHER A COPY OR A BASE VOLUME RECORD.  A
*    BASE VOLUME RECORD IS NOT REMOVED IF THERE ARE ANY COPIES OF THE
*    VOLUME.  ALSO A VOLUME RECORD IS NOT REMOVED IF EITHER CARTRIDGE
*    IS IN THE MSF.  THIS IS DETERMINED ONCE BY THE UTILITY        0637
*    BEFORE THE PROGRAM IS CALLED AND THEN IS CHECKED              0637
*    AGAIN IN THE LIB ID FIELD OF THE VOLUME RECORD BY             0637
*    THIS PROGRAM. THE CARTRIDGE INDEX RECORDS ARE SCRATCHED       0637
*    IF THEY EXIST AND BELONG TO THE RIGHT VOLUME.  IF THE CARTRIDGES
*    HAVE SINCE BEEN ASSIGNED TO ANOTHER VOLUME, THE CARTRIDGE     0637
*    INDEX RECORDS ARE NOT SCRATCHED AND NO ERROR                  0637
*    CONDITION WILL OCCUR.  THE NEXT FUNCTION PREFORMED            0637
*    IS REMOVAL OF THE VOLUME RECORD.  IF THE VOLUME RECORD WAS A BASE
*    VOLUME RECORD A CHECK IS MADE TO SEE IF THERE IS A DUPLICATE  0637
*    VOLUME RECORD.  IF ANY EXIST, THE OLDEST DUPLICATE BECOMES THE NEW
*    BASE VOLUME RECORD WITH THE SAME KEY AS THE DELETED BASE VOLUME
*    RECORD.  THE RPLV IS JOURNALED AFTER THE FIRST SUCCESSFUL UPDATE
*    OF THE MSS VOLUME INVENTORY.                             @Y30LB26
*                                                                  0637
*      INPUT - REGISTER 1 HAS THE ADDRESS OF THE RPLV.  THE RPLV   0637
*      CONTAINS ALL INFORMATION NEEDED TO REMOVE THE PROPER RECORD FROM
*      USERCAT.MSVI DATA SET.                                 @Y30LB26
*                                                                  0637
*      OUTPUT - REASON CODE AND CONDITION CODE RETURNED IN THE RPLV.
*                                                             @Y30LB26
*                                                                  0637
*      '0219'X  COPY OR BASE WAS NOT SPECIFIED.               @Y30LB26
*      '0216'X  TRYING TO REMOVE BASE RECORD THAT HAS COPIES. @Y30LB26
*      '021A'X  CARTRIDGES ARE IN LIBRARY                     @Y30LB26
*      '021B'X  I/O ERROR OCCURED BUT RPLV WAS JOURNALED.     @Y30LB26
*       PLUS ANY RETURNS FROM  THE I/O PROCESSOR OR THE       @Y30LB26
*       JOURNAL PROGRAM.                                      @Y30LB26
**** END OF SPECIFICATIONS **                                        */
*                                                                  0637
*REMOVEVR:                                                         0637
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
REMOVEVR ST    @14,@SA00008                                        0637
*   DUPFNDFL=OFF;                   /* INIT DUP FND FLAG     @Y30LB26*/
*   BACKUPFL=OFF;                   /* INIT BACKUP FLAG      @Y30LB26*/
         NI    DUPFNDFL,B'11001111'                                0639
*                                                                  0640
*   /*****************************************************************/
*   /*                                                               */
*   /* RESERVE INVENTORY DATA SET                            @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0640
*   CALL RESERINV;                  /* RESERVE INVENTORY     @Y30LB26*/
*                                                                  0640
         BAL   @14,RESERINV                                        0640
*   /*****************************************************************/
*   /*                                                               */
*   /* SET UP ADDRESS TO REQUEST BLK                         @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0641
*   RVRPTR=ADDR(RPLVUTIL);          /* ADDR REQUEST BLK      @Y30LB26*/
         L     @02,RPLVPTR                                         0641
         LA    @02,RPLVUTIL(,@02)                                  0641
         ST    @02,RVRPTR                                          0641
*   VOLKY=RVRVOLID;                 /* VOL NAME BE REMOVED   @Y30LB26*/
*                                                                  0642
         MVC   VOLKY(6),RVRVOLID(@02)                              0642
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK IF BASE VOLUME IS TO BE REMOVED                 @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0643
*   IF RVRBASEV=ON                  /* REMOVE BASE ?         @Y30LB26*/
*     THEN                          /*                       @Y30LB26*/
*                                                                  0643
         TM    RVRBASEV(@02),B'10000000'                           0643
         BNO   @RF00643                                            0643
*     /***************************************************************/
*     /*                                                             */
*     /* CALL SUBROUTINE TO REMOVE BASE VOL RECORD           @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0644
*     DO;                           /*                       @Y30LB26*/
*       CALL REMOVBAS;              /* GO REMOVE BASE VOL    @Y30LB26*/
         BAL   @14,REMOVBAS                                        0645
*       RETURN;                     /*                       @Y30LB26*/
@EL00008 DS    0H                                                  0646
@EF00008 DS    0H                                                  0646
@ER00008 L     @14,@SA00008                                        0646
         BR    @14                                                 0646
*     END;                          /*                       @Y30LB26*/
*                                                                  0648
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK IF COPY VOLUME IS TO BE REMOVED                 @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0648
*   IF RVRCOPYV=ON                  /* REMOVE COPY VOL ?     @Y30LB26*/
*     THEN                          /*                       @Y30LB26*/
*                                                                  0648
@RF00643 L     @02,RVRPTR                                          0648
         TM    RVRCOPYV(@02),B'01000000'                           0648
         BNO   @RF00648                                            0648
*     /***************************************************************/
*     /*                                                             */
*     /* CALL SUBROUTINE TO REMOVE COPY VOL RECORD           @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0649
*     DO;                           /*                       @Y30LB26*/
*       CALL REMOVCPY;              /* GO REMOVE COPY REC    @Y30LB26*/
         BAL   @14,REMOVCPY                                        0650
*       RETURN;                     /* RETURN TO CALLER      @Y30LB26*/
         B     @EL00008                                            0651
*     END;                          /*                       @Y30LB26*/
*   ELSE                            /*                       @Y30LB26*/
*                                                                  0653
*     /***************************************************************/
*     /*                                                             */
*     /* IF NOT ONE OF THESE TWO AN ERROR EXISTS             @Y30LB26*/
*     /* SET REASON AND RETURN CODES AND RETURN.             @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0653
*     DO;                           /*                       @Y30LB26*/
@RF00648 DS    0H                                                  0654
*       RPLVRETC=FOUR;              /* SET BAD RETURN CODE   @Y30LB26*/
         L     @02,RPLVPTR                                         0654
         MVC   RPLVRETC(2,@02),@CB00749                            0654
*       RPLRCODE=REQBLKER;          /* TYPE REC NOT SPEC     @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00797                            0655
*       CALL ERREXIT;               /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         0656
*       RETURN;                     /* RETURN TO MAIN PROC   @Y30LB26*/
         B     @EL00008                                            0657
*     END;                          /*                       @Y30LB26*/
*   END REMOVEVR;                   /*                       @Y30LB26*/
*                                                                  0660
*   /*****************************************************************/
*   /*                                                               */
*   /* SUBROUTINE WHICH REMOVES A BASE VOLUME RECORD         @Y30LB26*/
*   /* AND UPDATES ANY GROUP AND CARTRIDGE RECORDS           @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0660
*REMOVBAS:                                                         0660
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
*                                                                  0660
REMOVBAS ST    @14,@SA00009                                        0660
*   /*****************************************************************/
*   /*                                                               */
*   /* READ BASE VOLUME RECORD                               @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0661
*   RPLVKEY=ADDR(VKEY);             /* GET ADDR OF KEY       @Y30LB26*/
         L     @02,RPLVPTR                                         0661
         LA    @15,VKEY                                            0661
         ST    @15,RPLVKEY(,@02)                                   0661
*   RPLVBUF=ADDR(STORBASE);         /* ADDR OF BUFFER        @Y30LB26*/
         LA    @15,STORBASE                                        0662
         ST    @15,RPLVBUF(,@02)                                   0662
*   RPLVBLN=LENGTH(STORBASE);       /* LENGTH BUFFER         @Y30LB26*/
         MVC   RPLVBLN(4,@02),@CF01147                             0663
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB26*/
         OI    RPLVDIR(@02),B'01000000'                            0664
*   RPLVTYP=RPLVREAD;               /* READ REC              @Y30LB26*/
         MVI   RPLVTYP(@02),X'00'                                  0665
*   RESPECIFY                                                      0666
*     REG1 RSTD;                    /* RESTRICT REG 1        @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR RPLV             @Y30LB26*/
         LR    REG1,@02                                            0667
*   CALL ICBVIO00;                  /* READ BASE VOL REC     @Y30LB26*/
         L     @15,@CV00671                                        0668
         BALR  @14,@15                                             0668
*   RESPECIFY                                                      0669
*     REG1 UNRSTD;                  /* FREE REG 1            @Y30LB26*/
*                                                                  0669
*   /*****************************************************************/
*   /*                                                               */
*   /* IF BAD RETURN CODE, SAVE REASON CODES AND RETURN      @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0670
*   IF RPLVRETC^=RCZERO             /* CK RETURN CODE        @Y30LB26*/
*     THEN                          /*                       @Y30LB26*/
         L     @02,RPLVPTR                                         0670
         CLC   RPLVRETC(2,@02),@CB00747                            0670
         BE    @RF00670                                            0670
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* SAVE RETURN CODES     @Y30LB26*/
         BAL   @14,ERREXIT                                         0672
*       RETURN;                     /*                       @Y30LB26*/
@EL00009 DS    0H                                                  0673
@EF00009 DS    0H                                                  0673
@ER00009 L     @14,@SA00009                                        0673
         BR    @14                                                 0673
*     END;                          /*                       @Y30LB26*/
*   BASEVPTR=ADDR(STORBASE);        /* GET ADDR BASE REC     @Y30LB26*/
@RF00670 LA    @02,STORBASE                                        0675
         ST    @02,BASEVPTR                                        0675
*                                                                  0676
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK TO SEE IF BASE VOL HAS COPIES                   @Y30LB26*/
*   /* AND NOT A PLACE HOLDER                                @ZDR2053*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0676
*   IF BASNCOPY^=ZERO&BASHOLD=OFF   /* BASE HAVE COPIES &    @ZDR2053*/
*     THEN                          /* NOT A PLACE HOLDER    @ZDR2053*/
*                                                                  0676
         CLI   BASNCOPY(@02),0                                     0676
         BE    @RF00676                                            0676
         TM    BASHOLD(@02),B'10000000'                            0676
         BNZ   @RF00676                                            0676
*     /***************************************************************/
*     /*                                                             */
*     /* IF COPIES EXIST, SET REASON CODE AND RETURN         @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0677
*     DO;                           /*                       @Y30LB26*/
*       RPLVRETC=FOUR;              /* SET BAD RETURN CODE   @Y30LB26*/
         L     @02,RPLVPTR                                         0678
         MVC   RPLVRETC(2,@02),@CB00749                            0678
*       RPLRCODE=BASCPYER;          /* INDICATE COPIES       @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00795                            0679
*       CALL ERREXIT;               /* SAVE RETURN CODES     @Y30LB26*/
         BAL   @14,ERREXIT                                         0680
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00009                                            0681
*     END;                          /*                       @Y30LB26*/
*   ELSE                            /*                       @Y30LB26*/
*                                                                  0683
*     /***************************************************************/
*     /*                                                             */
*     /* GO REMOVE BASE VOLUME RECORD                        @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0683
*     DO;                           /*                       @Y30LB26*/
@RF00676 DS    0H                                                  0684
*       CALL DELEVOL;               /* GO DELE VOL REC       @Y30LB26*/
         BAL   @14,DELEVOL                                         0684
*                                                                  0685
*       /*************************************************************/
*       /*                                                           */
*       /* IF BAD RETURN CODE, INVENTORY IS ALREADY          @Y30LB26*/
*       /* RELEASED, SO JUST RETURN.                         @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0685
*       IF RPLVRETC^=RCZERO         /* RECORD DELETED OK ?   @Y30LB26*/
*         THEN                                                     0685
         L     @02,RPLVPTR                                         0685
         CLC   RPLVRETC(2,@02),@CB00747                            0685
         BNE   @RT00685                                            0685
*         RETURN;                   /*                       @Y30LB26*/
*     END;                          /*                       @Y30LB26*/
*                                                                  0688
*   /*****************************************************************/
*   /*                                                               */
*   /* READ FOR A DUPLICATE OF VOLUME JUST ERASED            @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0688
*   DVOLKY=RVRVOLID;                /* REMOVED VOL NAME      @Y30LB26*/
         L     @01,RVRPTR                                          0688
         MVC   DVOLKY(6),RVRVOLID(@01)                             0688
*   RPLVKEY=ADDR(DKEY);             /* GET ADDR OF KEY       @Y30LB26*/
         LA    @15,DKEY                                            0689
         ST    @15,RPLVKEY(,@02)                                   0689
*   RPLVBUF=ADDR(STORDUP);          /* ADDR OF BUFFER        @Y30LB26*/
         LA    @15,STORDUP                                         0690
         ST    @15,RPLVBUF(,@02)                                   0690
*   RPLVBLN=LENGTH(STORDUP);        /* LENGTH OF BUFFER      @Y30LB26*/
         MVC   RPLVBLN(4,@02),@CF01147                             0691
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB26*/
         OI    RPLVDIR(@02),B'01000000'                            0692
*   RPLVTYP=RPLVREAD;               /* READ RECORD           @Y30LB26*/
         MVI   RPLVTYP(@02),X'00'                                  0693
*   RPLVKGE=ON;                     /* READ FOR > OR =       @Y30LB26*/
         OI    RPLVKGE(@02),B'00000100'                            0694
*   RPLVUPD=ON;                     /* READ FOR UPDATE       @Y30LB26*/
         OI    RPLVUPD(@02),B'00000010'                            0695
*   RESPECIFY                                                      0696
*     REG1 RSTD;                    /* RESTRICT REG 1        @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR OF RPLV          @Y30LB26*/
         LR    REG1,@02                                            0697
*   CALL ICBVIO00;                  /* READ FOR DUP REC      @Y30LB26*/
         L     @15,@CV00671                                        0698
         BALR  @14,@15                                             0698
*   RESPECIFY                                                      0699
*     REG1 UNRSTD;                  /* FREE REG 1            @Y30LB26*/
*                                                                  0699
*   /*****************************************************************/
*   /*                                                               */
*   /* CK FOR BAD RETURN CODE                                @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0700
*   IF RPLVRETC^=RCZERO             /* CHECK RET CODE        @Y30LB26*/
*     THEN                          /*                       @Y30LB26*/
         L     @02,RPLVPTR                                         0700
         CLC   RPLVRETC(2,@02),@CB00747                            0700
         BE    @RF00700                                            0700
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         0702
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00009                                            0703
*     END;                          /*                       @Y30LB26*/
*   DUPVPTR=ADDR(STORDUP);          /* PTR TO DUP REC        @Y30LB26*/
*                                                                  0705
@RF00700 LA    @02,STORDUP                                         0705
         ST    @02,DUPVPTR                                         0705
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK THAT IT IS A DUP AND FOR CORRECT VOL            @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0706
*   IF DUPD=DKY&DUPSERNO=RVRVOLID   /* CK DUP, CORRECT VOL   @Y30LB26*/
*     THEN                          /*                       @Y30LB26*/
         CLC   DUPD(5,@02),DKY                                     0706
         BNE   @RF00706                                            0706
         L     @01,RVRPTR                                          0706
         CLC   DUPSERNO(6,@02),RVRVOLID(@01)                       0706
         BNE   @RF00706                                            0706
*     DO;                           /*                       @Y30LB26*/
*                                                                  0707
*       /*************************************************************/
*       /*                                                           */
*       /* IF DUP FOUND, CHECK IF OLD BASE WAS GROUPED       @Y30LB26*/
*       /* OR NOT A PLACE HOLDER                             @ZDR2053*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0708
*       DUPFNDFL=ON;                /* DUPLICATE FOUND       @Y30LB26*/
         OI    DUPFNDFL,B'00010000'                                0708
*       IF BASGRPV=OFF&BASHOLD=OFF THEN/* NOT GROUPED        @ZDR2053
*                                      OR A PLACE HOLDER     @ZDR2053*/
         L     @02,BASEVPTR                                        0709
         TM    BASGRPV(@02),B'00100000'                            0709
         BNZ   @RF00709                                            0709
         TM    BASHOLD(@02),B'10000000'                            0709
         BNZ   @RF00709                                            0709
*         DO;                       /*                       @Y30LB26*/
*                                                                  0710
*           /*********************************************************/
*           /*                                                       */
*           /* IF OLD RECORD NON-GROUPED, SET FLAG SO IT     @Y30LB26*/
*           /* WONT BE CHAINED INTO NON-GROUPED AGAIN        @Y30LB26*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  0711
*           DUPBCHI=OFF;            /* DONT CHAIN IN NON-GRP @Y30LB26*/
*                                                                  0711
         NI    DUPBCHI,B'01111111'                                 0711
*           /*********************************************************/
*           /*                                                       */
*           /* SET INFORMATION NEEDED TO MAKE NEW            @Y30LB26*/
*           /* BASE RECORD FIT IN NON-GROUPED WITHOUT        @Y30LB26*/
*           /* ACTUALLY BEING CHAIN IN                       @Y30LB26*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  0712
*           SAVEPREV=BASPREV;       /* SAVE PREV CHAIN       @Y30LB26*/
         MVC   SAVEPREV(6),BASPREV(@02)                            0712
*           SAVENEXT=BASNEXTV;      /* SAVE NEXT CHAIN       @Y30LB26*/
         MVC   SAVENEXT(6),BASNEXTV(@02)                           0713
*           IF BASFIRST=ON THEN     /* 1ST IN CHAIN          @Y30LB26*/
         TM    BASFIRST(@02),B'00010000'                           0714
         BNO   @RF00714                                            0714
*             FCHNDBR=ON;           /* INDICATE FIRST        @Y30LB26*/
         OI    FCHNDBR,B'01000000'                                 0715
*           IF BASLAST=ON THEN      /* LAST IN CHAIN         @Y30LB26*/
@RF00714 L     @02,BASEVPTR                                        0716
         TM    BASLAST(@02),B'00001000'                            0716
         BNO   @RF00716                                            0716
*             LCHNDBR=ON;           /* INDICATE LAST         @Y30LB26*/
         OI    LCHNDBR,B'00100000'                                 0717
*         END;                      /*                       @Y30LB26*/
*                                                                  0718
*       /*************************************************************/
*       /*                                                           */
*       /* IF WAS GROUPED BEFORE, SET FLAG SO IT             @Y30LB26*/
*       /* WILL BE CHAINED INTO NON-GROUPED                  @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0719
*       ELSE                        /*                       @Y30LB26*/
*         DUPBCHI=ON;               /* CHIAN IN NON-GRP      @Y30LB26*/
         B     @RC00709                                            0719
@RF00709 OI    DUPBCHI,B'10000000'                                 0719
*     END;                          /*                       @Y30LB26*/
@RC00709 DS    0H                                                  0721
*                                                                  0721
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR A PLACE HOLDER                              @ZDR2053*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0721
*   IF BASHOLD=OFF THEN                                            0721
@RF00706 L     @02,BASEVPTR                                        0721
         TM    BASHOLD(@02),B'10000000'                            0721
         BNZ   @RF00721                                            0721
*     DO;                           /*                       @ZDR2053*/
*                                                                  0722
*       /*************************************************************/
*       /*                                                           */
*       /* IF GROUPED RECORD GO PROCESS BASE OUT OF GROUP    @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0723
*       IF BASGRPV=ON THEN          /* THIS GROUPED RECORD   @Y30LB26*/
         TM    BASGRPV(@02),B'00100000'                            0723
         BNO   @RF00723                                            0723
*         DO;                       /*                       @Y30LB26*/
*           CALL PROCGRP;           /* GO UPDATE GRP REC     @Y30LB26*/
*                                                                  0725
         BAL   @14,PROCGRP                                         0725
*           /*********************************************************/
*           /*                                                       */
*           /* CHECK RETURN FROM PROCGRP ROUTINE             @Y30LB26*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  0726
*           IF RPLRCODE^=RCZERO THEN/* CK RETURN             @Y30LB26*/
         L     @02,RPLVPTR                                         0726
         CLC   RPLRCODE(2,@02),@CB00747                            0726
         BNE   @RT00726                                            0726
*             RETURN;               /*                       @Y30LB26*/
*         END;                      /*                       @Y30LB26*/
*       ELSE                        /*                       @Y30LB26*/
*         DO;                       /*                       @Y30LB26*/
*                                                                  0729
         B     @RC00723                                            0729
@RF00723 DS    0H                                                  0730
*           /*********************************************************/
*           /*                                                       */
*           /* IF DUP NOT FOUND, CHAIN OUT OF NON-GROUPED    @Y30LB26*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  0730
*           IF DUPFNDFL=OFF         /* SEE IF DUP FOUND      @Y30LB26*/
*             THEN                  /*                       @Y30LB26*/
         TM    DUPFNDFL,B'00010000'                                0730
         BNZ   @RF00730                                            0730
*             DO;                   /*                       @Y30LB26*/
*               CHICHOGP=OFF;       /* INDICATE NON-GRPED    @Y30LB26*/
         NI    CHICHOGP,B'11101111'                                0732
*               CALL ICBVUCHO(0,BASEVPTR,/*                  @Y30LB26*/
*                   RPLVPTR,PASSFLAG);/* CHAIN OUT NON-GRP   @Y30LB26*/
         L     @15,@CV00675                                        0733
         LA    @01,@AL00733                                        0733
         BALR  @14,@15                                             0733
*               IF RPLVRETC^=RCZERO /* CK RET CODE           @Y30LB26*/
*                 THEN              /*                       @Y30LB26*/
         L     @02,RPLVPTR                                         0734
         CLC   RPLVRETC(2,@02),@CB00747                            0734
         BE    @RF00734                                            0734
*                 DO;               /*                       @Y30LB26*/
*                   CALL ERREXIT;   /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         0736
*                   RETURN;         /*                       @Y30LB26*/
         B     @EL00009                                            0737
*                 END;              /*                       @Y30LB26*/
*             END;                  /*                       @Y30LB26*/
@RF00734 DS    0H                                                  0740
*         END;                      /*                       @Y30LB26*/
@RF00730 DS    0H                                                  0741
*     END;                          /*                       @ZDR2053*/
@RC00723 DS    0H                                                  0742
*                                                                  0742
*   /*****************************************************************/
*   /*                                                               */
*   /* IF DUPLICATE FOUND, CONVERT IT TO BASE                @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0742
*   IF DUPFNDFL=ON THEN             /* DUP REC FOUND         @Y30LB26*/
@RF00721 TM    DUPFNDFL,B'00010000'                                0742
         BNO   @RF00742                                            0742
*     DO;                           /*                       @Y30LB26*/
*       CALL VUDBR;                 /* DUP TO BASE ROUTN     @Y30LB26*/
*                                                                  0744
         BAL   @14,VUDBR                                           0744
*       /*************************************************************/
*       /*                                                           */
*       /* CK RETURN CODE                                    @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0745
*       IF RPLVRETC^=RCZERO THEN    /* CK RET CODE           @Y30LB26*/
         L     @02,RPLVPTR                                         0745
         CLC   RPLVRETC(2,@02),@CB00747                            0745
         BE    @RF00745                                            0745
*         DO;                       /*                       @Y30LB26*/
*           CALL ERREXIT;           /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         0747
*           RETURN;                 /*                       @Y30LB26*/
         B     @EL00009                                            0748
*         END;                      /*                       @Y30LB26*/
*                                                                  0749
*       /*************************************************************/
*       /*                                                           */
*       /* SEE IF CHAINING INTO NON-GROUP CHAIN IS           @Y30LB26*/
*       /* NECESSARY                                         @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0750
*       IF DUPBCHI=ON THEN          /* CHAIN IN NEW BASE     @Y30LB26*/
@RF00745 TM    DUPBCHI,B'10000000'                                 0750
         BNO   @RF00750                                            0750
*         DO;                       /*                       @Y30LB26*/
*           CHICHOGP=OFF;           /* INDICATE NON-GROUPED  @Y30LB26*/
         NI    CHICHOGP,B'11101111'                                0752
*           CALL ICBVUCHI(0,BASEVPTR,RPLVPTR,/*              @Y30LB26*/
*               PASSFLAG);          /*                       @Y30LB26*/
         L     @15,@CV00674                                        0753
         LA    @01,@AL00753                                        0753
         BALR  @14,@15                                             0753
*           IF RPLVRETC^=RCZERO THEN/*                       @Y30LB26*/
         L     @02,RPLVPTR                                         0754
         CLC   RPLVRETC(2,@02),@CB00747                            0754
         BE    @RF00754                                            0754
*             DO;                   /*                       @Y30LB26*/
*               CALL ERREXIT;       /*                       #Y30LB26*/
         BAL   @14,ERREXIT                                         0756
*               RETURN;             /*                       #Y30LB26*/
         B     @EL00009                                            0757
*             END;                  /*                       #Y30LB26*/
*         END;                      /*                       #Y30LB26*/
*                                                                  0759
@RF00754 DS    0H                                                  0760
*       /*************************************************************/
*       /*                                                           */
*       /* WRITE CREATED BASE VOLUME RECORD                  #Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0760
*       RPLVBUF=ADDR(BASEREC);      /* BUFFER ADDRESS        #Y30LB26*/
@RF00750 L     @02,RPLVPTR                                         0760
         LA    @15,BASEREC                                         0760
         ST    @15,RPLVBUF(,@02)                                   0760
*       RPLVRLN=LENGTH(BASEV);      /* LENGTH RECORD         #Y30LB26*/
         LA    @15,224                                             0761
         ST    @15,RPLVRLN(,@02)                                   0761
*       RPLVBLN=LENGTH(BASEV);      /* LENGTH BUFFER         @Y30LB26*/
         ST    @15,RPLVBLN(,@02)                                   0762
*       RPLVLOC=OFF;                /* NO LOCATE             @Y30LB26*/
         NI    RPLVLOC(@02),B'01111111'                            0763
*       RPLVTYP=RPLVPUT;            /* WRITE RECORD          @Y30LB26*/
         MVI   RPLVTYP(@02),X'01'                                  0764
*       RPLVUPD=OFF;                /* NO UPDATE             @Y30LB26*/
         NI    RPLVUPD(@02),B'11111101'                            0765
*       RESPECIFY                                                  0766
*         REG1 RSTD;                /* RESTRICT              @Y30LB26*/
*       REG1=RPLVPTR;               /* ADDR RPLV             @Y30LB26*/
         LR    REG1,@02                                            0767
*       CALL ICBVIO00;              /* WRITE BASE VOL REC    @Y30LB26*/
         L     @15,@CV00671                                        0768
         BALR  @14,@15                                             0768
*       RESPECIFY                                                  0769
*         REG1 UNRSTD;              /* FREE REG 1            @Y30LB26*/
*       IF RPLVRETC^=RCZERO THEN    /* CK RETURN             @Y30LB26*/
         L     @02,RPLVPTR                                         0770
         CLC   RPLVRETC(2,@02),@CB00747                            0770
         BE    @RF00770                                            0770
*         DO;                       /*                       @Y30LB26*/
*           CALL ERREXIT;           /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         0772
*           RETURN;                 /*                       @Y30LB26*/
         B     @EL00009                                            0773
*         END;                      /*                       @Y30LB26*/
*     END;                          /*                       @Y30LB26*/
*   RETURN;                         /*                       @Y30LB26*/
         B     @EL00009                                            0776
*   END REMOVBAS;                   /* END BASE ROUTINE      @Y30LB26*/
         B     @EL00009                                            0777
*                                                                  0778
*   /*****************************************************************/
*   /*                                                               */
*   /* THIS ROUTINE REMOVES THE VOLUME RECORD(BASE OR COPY)  @Y30LB26*/
*   /* AND TAKES CARE OF THE INDEX RECORDS                   @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0778
*DELEVOL:                                                          0778
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
DELEVOL  ST    @14,@SA00010                                        0778
*                                                                  0779
*   /*****************************************************************/
*   /*                                                               */
*   /* CALL ROUTINE TO SEE IF CARTRIDGE INDEX RECORDS ARE    @Y30LB26*/
*   /* IN LIBRARY AND IF THEY ARE AND BELONG TO              @Y30LB26*/
*   /* THE RIGHT VOLUME, ERASE THEM......                    @Y30LB26*/
*   /* NOT DONE FOR PLACE HOLDERS BECAUSE THEY HAVE NO       @ZDR2053*/
*   /* CARTRIDGE INDEX RECORDS                               @ZDR2053*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0779
*   IF RVRBASEV=ON THEN                                            0779
         L     @02,RVRPTR                                          0779
         TM    RVRBASEV(@02),B'10000000'                           0779
         BNO   @RF00779                                            0779
*     BCDVPTR=BASEVPTR;             /* BASE RECORD           @ZA16139*/
         L     BCDVPTR,BASEVPTR                                    0780
*   ELSE                            /*                       @ZA16139*/
*     BCDVPTR=COPYVPTR;             /* COPY RECORD           @ZA16139*/
         B     @RC00779                                            0781
@RF00779 L     BCDVPTR,COPYVPTR                                    0781
*   IF BCDHOLD=ON THEN              /*                       @ZA16139*/
@RC00779 TM    BCDHOLD(BCDVPTR),B'10000000'                        0782
         BO    @RT00782                                            0782
*     ;                             /*                       @ZDR2053*/
*   ELSE                                                           0784
*     DO;                           /*                       @ZDR2053*/
*       CALL CHKCART;               /* SEE IF CART IN LIB    @Y30LB26*/
         BAL   @14,CHKCART                                         0785
*       IF RPLVRETC^=RCZERO THEN    /* CHK CART OK           @Y30LB26*/
         L     @02,RPLVPTR                                         0786
         CLC   RPLVRETC(2,@02),@CB00747                            0786
         BNE   @RT00786                                            0786
*         RETURN;                   /*                       @Y30LB26*/
*     END;                          /*                       @ZDR2053*/
*                                                                  0789
*   /*****************************************************************/
*   /*                                                               */
*   /* READ BASE OR COPY RECORD TO BE DELETED                @Y30LB26*/
*   /* FOR UPDATE SO IT CAN BE DELETED                       @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0789
*   RPLVKEY=ADDR(VKEY);             /* ADDR KEY FOR VOL      @Y30LB26*/
@RT00782 L     @02,RPLVPTR                                         0789
         LA    @15,VKEY                                            0789
         ST    @15,RPLVKEY(,@02)                                   0789
*   RPLVBUF=ADDR(STORBASE);         /* BUFFER ADDR           @Y30LB26*/
         LA    @15,STORBASE                                        0790
         ST    @15,RPLVBUF(,@02)                                   0790
*   RPLVBLN=LENGTH(STORBASE);       /* BUFFER LENGTH         @Y30LB26*/
         MVC   RPLVBLN(4,@02),@CF01147                             0791
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB26*/
         OI    RPLVDIR(@02),B'01000000'                            0792
*   RPLVTYP=RPLVREAD;               /* READ RECORD           @Y30LB26*/
         MVI   RPLVTYP(@02),X'00'                                  0793
*   RPLVUPD=ON;                     /* FOR UPDATE            @Y30LB26*/
         OI    RPLVUPD(@02),B'00000010'                            0794
*   RESPECIFY                                                      0795
*     REG1 RSTD;                    /* RESTRICT REG 1        @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR RPLV             @Y30LB26*/
         LR    REG1,@02                                            0796
*   CALL ICBVIO00;                  /* READ VOL FOR UPDATE   @Y30LB26*/
         L     @15,@CV00671                                        0797
         BALR  @14,@15                                             0797
*   RESPECIFY                                                      0798
*     REG1 UNRSTD;                  /* FREE REG 1            @Y30LB26*/
*                                                                  0798
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK RETURN FROM READING VOL RECORD                  @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0799
*   IF RPLVRETC^=RCZERO             /* CK RET CODES          @Y30LB26*/
*     THEN                          /*                       @Y30LB26*/
         L     @02,RPLVPTR                                         0799
         CLC   RPLVRETC(2,@02),@CB00747                            0799
         BE    @RF00799                                            0799
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         0801
*       RETURN;                     /*                       @Y30LB26*/
@EL00010 DS    0H                                                  0802
@EF00010 DS    0H                                                  0802
@ER00010 L     @14,@SA00010                                        0802
         BR    @14                                                 0802
*     END;                          /*                       @Y30LB26*/
*                                                                  0804
*   /*****************************************************************/
*   /*                                                               */
*   /* DELETE VOL RECORD (BASE OR COPY RECORD)               @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0804
*   RPLVTYP=RPLVDEL;                /* DELETE RECORD         @Y30LB26*/
@RF00799 L     @02,RPLVPTR                                         0804
         MVI   RPLVTYP(@02),X'05'                                  0804
*   RESPECIFY                                                      0805
*     REG1 RSTD;                    /* RESTRICT REG 1        @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR RPLV             @Y30LB26*/
         LR    REG1,@02                                            0806
*   CALL ICBVIO00;                  /* DELETE VOL REC        @Y30LB26*/
         L     @15,@CV00671                                        0807
         BALR  @14,@15                                             0807
*   RESPECIFY                                                      0808
*     REG1 UNRSTD;                  /* FREE REG 1            @Y30LB26*/
*   IF RPLVRETC^=RCZERO             /* DELETED OK ?          @Y30LB26*/
*     THEN                          /*                       @Y30LB26*/
         L     @02,RPLVPTR                                         0809
         CLC   RPLVRETC(2,@02),@CB00747                            0809
         BE    @RF00809                                            0809
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         0811
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00010                                            0812
*     END;                          /*                       @Y30LB26*/
*   ELSE                            /*                       @Y30LB26*/
*     DO;                           /*                       @Y30LB26*/
@RF00809 DS    0H                                                  0815
*       IF JRNLEDSW=OFF THEN        /* NOT JOURNALED?        @Y30LB26*/
         TM    JRNLEDSW,B'00000001'                                0815
         BNZ   @RF00815                                            0815
*         DO;                       /*                       @Y30LB26*/
*           CALL JOURNAL;           /* JOURNAL RPLV          @Y30LB26*/
         BAL   @14,JOURNAL                                         0817
*           IF RPLVRETC^=RCZERO THEN/* CK RETURN             @Y30LB26*/
         L     @02,RPLVPTR                                         0818
         CLC   RPLVRETC(2,@02),@CB00747                            0818
         BNE   @RT00818                                            0818
*             RETURN;               /*                       @Y30LB26*/
*         END;                      /*                       @Y30LB26*/
*     END;                          /*                       @Y30LB26*/
*   RETURN;                         /*                       @Y30LB26*/
         B     @EL00010                                            0822
*   END DELEVOL;                    /* END DELETE VOL RTN    @Y30LB26*/
         B     @EL00010                                            0823
*                                                                  0824
*   /*****************************************************************/
*   /*                                                               */
*   /* ROUTINE REMOVES BASE VOLUME RECORD FROM GROUP CHAIN   @Y30LB26*/
*   /* AND UPDATES APPROPRIATE FIELDS IN THE GROUP RECORD    @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0824
*PROCGRP:                                                          0824
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
PROCGRP  ST    @14,@SA00011                                        0824
*                                                                  0825
*   /*****************************************************************/
*   /*                                                               */
*   /* READ GROUP RECORD                                     @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0825
*   GROUPKY=BASGROUP;               /* GET GROUP IN KEY      @Y30LB26*/
         L     @02,BASEVPTR                                        0825
         MVC   GROUPKY(8),BASGROUP(@02)                            0825
*   RPLVKEY=ADDR(GKEY);             /* ADDR OF KEY           @Y30LB26*/
         L     @02,RPLVPTR                                         0826
         LA    @15,GKEY                                            0826
         ST    @15,RPLVKEY(,@02)                                   0826
*   RPLVBUF=ADDR(STORGRP);          /* ADDR OF BUFFER        @Y30LB26*/
         LA    @15,STORGRP                                         0827
         ST    @15,RPLVBUF(,@02)                                   0827
*   RPLVBLN=LENGTH(STORGRP);        /* LENGTH OF BUFFER      @Y30LB26*/
         MVC   RPLVBLN(4,@02),@CF01147                             0828
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB26*/
         OI    RPLVDIR(@02),B'01000000'                            0829
*   RPLVTYP=RPLVREAD;               /* READ REC              @Y30LB26*/
         MVI   RPLVTYP(@02),X'00'                                  0830
*   RPLVUPD=ON;                     /* FOR UPDATE            @Y30LB26*/
         OI    RPLVUPD(@02),B'00000010'                            0831
*   RPLVKGE=OFF;                    /* NOT FOR > OR =        @Y30LB26*/
         NI    RPLVKGE(@02),B'11111011'                            0832
*   RESPECIFY                                                      0833
*     REG1 RSTD;                    /* RESTRICT REG 1        @Y30LB26*/
*   REG1=RPLVPTR;                   /* GET ADDR OF RPLV      @Y30LB26*/
         LR    REG1,@02                                            0834
*   CALL ICBVIO00;                  /* READ GROUP REC        @Y30LB26*/
         L     @15,@CV00671                                        0835
         BALR  @14,@15                                             0835
*   RESPECIFY                                                      0836
*     REG1 UNRSTD;                  /* FREE REG 1            @Y30LB26*/
*                                                                  0836
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK RETURN CODE FROM I/O PROCESSOR                  @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0837
*   IF RPLVRETC^=RCZERO             /* GET RECORD ?          @Y30LB26*/
*     THEN                          /*                       @Y30LB26*/
         L     @02,RPLVPTR                                         0837
         CLC   RPLVRETC(2,@02),@CB00747                            0837
         BE    @RF00837                                            0837
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         0839
*       RETURN;                     /*                       @Y30LB26*/
@EL00011 DS    0H                                                  0840
@EF00011 DS    0H                                                  0840
@ER00011 L     @14,@SA00011                                        0840
         BR    @14                                                 0840
*     END;                          /*                       @Y30LB26*/
*                                                                  0842
*   /*****************************************************************/
*   /*                                                               */
*   /* SET UP ADDRESSABILITY TO GROUP RECORD                 @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0842
*   GROUPPTR=ADDR(STORGRP);         /* PTR TO GROUP REC      @Y30LB26*/
@RF00837 LA    @02,STORGRP                                         0842
         ST    @02,GROUPPTR                                        0842
*                                                                  0843
*   /*****************************************************************/
*   /*                                                               */
*   /* UPDATE GROUP INACTIVE VOLUMES COUNT                   @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0843
*   GRONINAC=GRONINAC-ONE;          /* ONE LESS INACT VOL    @Y30LB26*/
         LH    @15,GRONINAC(,@02)                                  0843
         BCTR  @15,0                                               0843
         STH   @15,GRONINAC(,@02)                                  0843
*                                                                  0844
*   /*****************************************************************/
*   /*                                                               */
*   /* GO CHAIN VOLUME OUT OF GROUP                          @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0844
*   CHICHOGP=ON;                    /* INDICATE GROUPED      @Y30LB26*/
         OI    CHICHOGP,B'00010000'                                0844
*   CALL ICBVUCHO(GROUPPTR,BASEVPTR,RPLVPTR,PASSFLAG);/*     @Y30LB26*/
         L     @15,@CV00675                                        0845
         LA    @01,@AL00845                                        0845
         BALR  @14,@15                                             0845
*   IF RPLVRETC^=RCZERO             /* CHAINED OK ?          @Y30LB26*/
*     THEN                          /*                       @Y30LB26*/
         L     @02,RPLVPTR                                         0846
         CLC   RPLVRETC(2,@02),@CB00747                            0846
         BE    @RF00846                                            0846
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         0848
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00011                                            0849
*     END;                          /*                       @Y30LB26*/
*                                                                  0851
*   /*****************************************************************/
*   /*                                                               */
*   /* READ GROUP RECORD TO DUMMY FOR UPDATE                 @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0851
*   RPLVKEY=ADDR(GKEY);             /* ADDR OF KEY           @Y30LB26*/
@RF00846 L     @02,RPLVPTR                                         0851
         LA    @15,GKEY                                            0851
         ST    @15,RPLVKEY(,@02)                                   0851
*   RPLVBUF=ADDR(DUMMYREC);         /* ADDR OF BUFFER        @Y30LB26*/
         LA    @15,DUMMYREC                                        0852
         ST    @15,RPLVBUF(,@02)                                   0852
*   RPLVBLN=LENGTH(STORGRP);        /* LENGTH OF BUFFER      @Y30LB26*/
         MVC   RPLVBLN(4,@02),@CF01147                             0853
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB26*/
         OI    RPLVDIR(@02),B'01000000'                            0854
*   RPLVTYP=RPLVREAD;               /* READ REC              @Y30LB26*/
         MVI   RPLVTYP(@02),X'00'                                  0855
*   RPLVUPD=ON;                     /* FOR UPDATE            @Y30LB26*/
         OI    RPLVUPD(@02),B'00000010'                            0856
*   RPLVKGE=OFF;                    /* NOT FOR > OR =        @Y30LB26*/
         NI    RPLVKGE(@02),B'11111011'                            0857
*   RESPECIFY                                                      0858
*     REG1 RSTD;                    /* RESTRICT REG 1        @Y30LB26*/
*   REG1=RPLVPTR;                   /* GET ADDR OF RPLV      @Y30LB26*/
         LR    REG1,@02                                            0859
*   CALL ICBVIO00;                  /* READ GROUP REC        @Y30LB26*/
         L     @15,@CV00671                                        0860
         BALR  @14,@15                                             0860
*   RESPECIFY                                                      0861
*     REG1 UNRSTD;                  /* FREE REG 1            @Y30LB26*/
*                                                                  0861
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK RETURN CODE FROM I/O PROCESSOR                  @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0862
*   IF RPLVRETC^=RCZERO             /* GET RECORD ?          @Y30LB26*/
*     THEN                          /*                       @Y30LB26*/
         L     @02,RPLVPTR                                         0862
         CLC   RPLVRETC(2,@02),@CB00747                            0862
         BE    @RF00862                                            0862
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* SAVE RET CODES        #Y30LB26*/
         BAL   @14,ERREXIT                                         0864
*       RETURN;                     /*                       #Y30LB26*/
         B     @EL00011                                            0865
*     END;                          /*                       @Y30LB26*/
*                                                                  0866
*   /*****************************************************************/
*   /*                                                               */
*   /* PUT OUT UPDATED GROUP RECORD                          @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0867
*   RPLVBUF=ADDR(STORGRP);          /* BUFFER ADDR           @Y30LB26*/
@RF00862 L     @02,RPLVPTR                                         0867
         LA    @15,STORGRP                                         0867
         ST    @15,RPLVBUF(,@02)                                   0867
*   RPLVTYP=RPLVPUT;                /* PUT GROUP REC         @Y30LB26*/
         MVI   RPLVTYP(@02),X'01'                                  0868
*   RESPECIFY                                                      0869
*     REG1 RSTD;                    /* RESTRICT REG 1        @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR RPLV             @Y30LB26*/
         LR    REG1,@02                                            0870
*   CALL ICBVIO00;                  /* WRITE GROUP REC       @Y30LB26*/
         L     @15,@CV00671                                        0871
         BALR  @14,@15                                             0871
*   RESPECIFY                                                      0872
*     REG1 UNRSTD;                  /* FREE REG 1            @Y30LB26*/
*                                                                  0872
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK OUT RETURN CODE                                 @VS32198*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0873
*   IF RPLVRETC^=RCZERO             /* CK RET CODE           @Y30LB26*/
*     THEN                          /*                       @Y30LB26*/
         L     @02,RPLVPTR                                         0873
         CLC   RPLVRETC(2,@02),@CB00747                            0873
         BE    @RF00873                                            0873
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         0875
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00011                                            0876
*     END;                          /*                       @Y30LB26*/
*   RETURN;                         /*                       @Y30LB26*/
         B     @EL00011                                            0878
*   END PROCGRP;                    /* END PROCESS GROUP     @Y30LB26*/
         B     @EL00011                                            0879
*                                                                  0880
*   /*****************************************************************/
*   /*                                                               */
*   /* THIS ROUTINE IS CALLED IF A COPY RECORD IS            @Y30LB26*/
*   /* TO BE REMOVED FROM THE INVENTORY                      @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0880
*REMOVCPY:                                                         0880
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
*                                                                  0880
REMOVCPY ST    @14,@SA00012                                        0880
*   /*****************************************************************/
*   /*                                                               */
*   /* READ COPY RECORD                                      @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0881
*   VIDKY=RVRCPYID;                 /* COPY ID TO KEY        @Y30LB26*/
         L     @02,RVRPTR                                          0881
         MVC   VIDKY(1),RVRCPYID(@02)                              0881
*   RPLVKEY=ADDR(VKEY);             /* KEY ADDR TO VSAM      @Y30LB26*/
         L     @02,RPLVPTR                                         0882
         LA    @15,VKEY                                            0882
         ST    @15,RPLVKEY(,@02)                                   0882
*   RPLVBUF=ADDR(STORCPY);          /* ADDR BUFFER           @Y30LB26*/
         LA    @15,STORCPY                                         0883
         ST    @15,RPLVBUF(,@02)                                   0883
*   RPLVBLN=LENGTH(STORCPY);        /* LENGTH BUFFER         @Y30LB26*/
         MVC   RPLVBLN(4,@02),@CF01147                             0884
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB26*/
         OI    RPLVDIR(@02),B'01000000'                            0885
*   RPLVTYP=RPLVREAD;               /* READ RECORD           @Y30LB26*/
         MVI   RPLVTYP(@02),X'00'                                  0886
*   RPLVUPD=ON;                     /* READ FOR UPDATE       @Y30LB26*/
         OI    RPLVUPD(@02),B'00000010'                            0887
*   RESPECIFY                                                      0888
*     REG1 RSTD;                    /* RESTRICT REG 1        @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR RPLV             @Y30LB26*/
         LR    REG1,@02                                            0889
*   CALL ICBVIO00;                  /* READ COPY RECORD      @Y30LB26*/
         L     @15,@CV00671                                        0890
         BALR  @14,@15                                             0890
*   RESPECIFY                                                      0891
*     REG1 UNRSTD;                  /* FREE REG 1            @Y30LB26*/
*                                                                  0891
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK RETURN CODE                                     @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0892
*   IF RPLVRETC^=RCZERO             /* CK RET CODE           @Y30LB26*/
*     THEN                          /*                       @Y30LB26*/
         L     @02,RPLVPTR                                         0892
         CLC   RPLVRETC(2,@02),@CB00747                            0892
         BE    @RF00892                                            0892
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         0894
*       RETURN;                     /*                       @Y30LB26*/
@EL00012 DS    0H                                                  0895
@EF00012 DS    0H                                                  0895
@ER00012 L     @14,@SA00012                                        0895
         BR    @14                                                 0895
*     END;                          /*                       @Y30LB26*/
*                                                                  0897
*   /*****************************************************************/
*   /*                                                               */
*   /* SET ADDRESSABILITY                                    @ZA16139*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0897
*   COPYVPTR=ADDR(STORCPY);         /* ADDR TO COPY REC      @ZA16139*/
@RF00892 LA    @02,STORCPY                                         0897
         ST    @02,COPYVPTR                                        0897
*                                                                  0898
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR A PLACE HOLDER                              @ZDR2053*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0898
*   IF COPHOLD=ON THEN                                             0898
         TM    COPHOLD(@02),B'10000000'                            0898
         BNO   @RF00898                                            0898
*     DO;                           /*                       @ZDR2053*/
*       CALL DELEVOL;               /* DELETE BASE VOL       @ZDR2053*/
         BAL   @14,DELEVOL                                         0900
*       RETURN;                     /*                       @ZDR2053*/
         B     @EL00012                                            0901
*     END;                          /*                       @ZDR2053*/
*                                                                  0903
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK IF BACKUP COPY                                  @ZA16139*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0903
*   IF COPBKUP=ON                   /* THIS A BACKUP COPY    @Y30LB26*/
*     THEN                                                         0903
@RF00898 L     @02,COPYVPTR                                        0903
         TM    COPBKUP(@02),B'00001000'                            0903
         BNO   @RF00903                                            0903
*     BACKUPFL=ON;                  /* INDICA BACKUP COPY    @Y30LB26*/
*                                                                  0904
         OI    BACKUPFL,B'00100000'                                0904
*   /*****************************************************************/
*   /*                                                               */
*   /* SAVE KEY TO COPY TO CK IF LAST COPY IN BASE REC       @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0905
*   SAVEKEY=VKEY;                   /* SAVE COPY VOL KEY     @Y30LB26*/
@RF00903 MVC   SAVEKEY(13),VKEY                                    0905
*                                                                  0906
*   /*****************************************************************/
*   /*                                                               */
*   /* GO DELETE COPY VOL RECORD                             @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0906
*   CALL DELEVOL;                   /* GO DELETE VOL REC     @Y30LB26*/
*                                                                  0906
         BAL   @14,DELEVOL                                         0906
*   /*****************************************************************/
*   /*                                                               */
*   /* JOURNALING AND REASON CODE TAKEN CARE OF,             @Y30LB26*/
*   /* SO IF BAD RETURN CODE JUST RETURN                     @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0907
*   IF RPLVRETC^=RCZERO             /* CK RET CODE           @Y30LB26*/
*     THEN                                                         0907
         L     @02,RPLVPTR                                         0907
         CLC   RPLVRETC(2,@02),@CB00747                            0907
         BNE   @RT00907                                            0907
*     RETURN;                       /* RETURN TO CALLER      @Y30LB26*/
*                                                                  0909
*   /*****************************************************************/
*   /*                                                               */
*   /* READ BASE VOLUME RECORD TO UPDATE FIELDS              @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0909
*   VIDKY=FIXZERO;                  /* ZERO VOL ID IN KEY    @Y30LB26*/
         MVI   VIDKY,X'00'                                         0909
*   RPLVKEY=ADDR(VKEY);             /* GET ADDR OF KEY       @Y30LB26*/
         LA    @15,VKEY                                            0910
         ST    @15,RPLVKEY(,@02)                                   0910
*   RPLVBUF=ADDR(STORBASE);         /* ADDR OF BUFFER        @Y30LB26*/
         LA    @15,STORBASE                                        0911
         ST    @15,RPLVBUF(,@02)                                   0911
*   RPLVBLN=LENGTH(STORBASE);       /* LENGTH BUFFER         @Y30LB26*/
         MVC   RPLVBLN(4,@02),@CF01147                             0912
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB26*/
         OI    RPLVDIR(@02),B'01000000'                            0913
*   RPLVTYP=RPLVREAD;               /* READ                  @Y30LB26*/
         MVI   RPLVTYP(@02),X'00'                                  0914
*   RPLVKGE=OFF;                    /* NO > OR = READ        @Y30LB26*/
         NI    RPLVKGE(@02),B'11111011'                            0915
*   RPLVUPD=ON;                     /* READ FOR UPDATE       @Y30LB26*/
         OI    RPLVUPD(@02),B'00000010'                            0916
*   RESPECIFY                                                      0917
*     REG1 RSTD;                    /* RESTRICT REG 1        @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR OF RPLV          @Y30LB26*/
         LR    REG1,@02                                            0918
*   CALL ICBVIO00;                  /* READ BASE VOL REC     @Y30LB26*/
         L     @15,@CV00671                                        0919
         BALR  @14,@15                                             0919
*   RESPECIFY                                                      0920
*     REG1 UNRSTD;                  /* FREE REG 1            @Y30LB26*/
*                                                                  0920
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK RETURN CODE FROM I/O PROCESSOR                  @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0921
*   IF RPLVRETC^=RCZERO             /* CK RET CODE           @Y30LB26*/
*     THEN                          /*                       @Y30LB26*/
         L     @02,RPLVPTR                                         0921
         CLC   RPLVRETC(2,@02),@CB00747                            0921
         BE    @RF00921                                            0921
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         0923
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00012                                            0924
*     END;                          /*                       @Y30LB26*/
*                                                                  0926
*   /*****************************************************************/
*   /*                                                               */
*   /* SET UP ADDRESSING AND UPDATE BASE VOL RECORD          @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0926
*   BASEVPTR=ADDR(STORBASE);        /* ADDR BASE REC         @Y30LB26*/
@RF00921 LA    @02,STORBASE                                        0926
         ST    @02,BASEVPTR                                        0926
*   BASNCOPY=BASNCOPY-ONE;          /* DECREASE COPIES ONE   @Y30LB26*/
         SLR   @15,@15                                             0927
         IC    @15,BASNCOPY(,@02)                                  0927
         BCTR  @15,0                                               0927
         STC   @15,BASNCOPY(,@02)                                  0927
*   IF BASNCOPY=FIXZERO THEN        /* NO COPIES ZERO FLD    @Y30LB26*/
         CLI   BASNCOPY(@02),0                                     0928
         BNE   @RF00928                                            0928
*     BASKLCPY=BLANK;               /* BLANK COPY ID         @Y30LB26*/
         MVI   BASKLCPY+1(@02),C' '                                0929
         MVC   BASKLCPY+2(11,@02),BASKLCPY+1(@02)                  0929
         MVI   BASKLCPY(@02),C' '                                  0929
*   IF BACKUPFL=ON                  /* BACKUP COPY ?         @Y30LB26*/
*     THEN                                                         0930
@RF00928 TM    BACKUPFL,B'00100000'                                0930
         BNO   @RF00930                                            0930
*     BASNBKUP=BASNBKUP-ONE;        /* DECRE BACKUPS ONE     @Y30LB26*/
*                                                                  0931
         L     @02,BASEVPTR                                        0931
         SLR   @15,@15                                             0931
         IC    @15,BASNBKUP(,@02)                                  0931
         BCTR  @15,0                                               0931
         STC   @15,BASNBKUP(,@02)                                  0931
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK TO SEE IF COPY DELETED WAS LATEST COPY          @Y30LB26*/
*   /* AND THAT THERE IS STILL A COPY FOR VOLUME             @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0932
*   IF BASKLCPY=SAVEKEY&            /* CPY DELETED LATEST?   @Y30LB26*/
*       BASNCOPY^=FIXZERO THEN      /* ANY COPIES AT ALL ?   @Y30LB26*/
@RF00930 L     @02,BASEVPTR                                        0932
         CLC   BASKLCPY(13,@02),SAVEKEY                            0932
         BNE   @RF00932                                            0932
         CLI   BASNCOPY(@02),0                                     0932
         BE    @RF00932                                            0932
*     DO;                           /*                       @Y30LB26*/
*       CALL FINDLCPY;              /* FIND LATEST COPY      @Y30LB26*/
         BAL   @14,FINDLCPY                                        0934
*       IF RPLVRETC^=RCZERO THEN    /* CK RETURN             @Y30LB26*/
         L     @02,RPLVPTR                                         0935
         CLC   RPLVRETC(2,@02),@CB00747                            0935
         BNE   @RT00935                                            0935
*         RETURN;                   /*                       @Y30LB26*/
*                                                                  0936
*       /*************************************************************/
*       /*                                                           */
*       /* RESET I/O PROCESSOR TO WRITE BASE RECORD          @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0937
*       VOLKY=RVRVOLID;             /* RESET TO CORR VOLUME  @Y30LB26*/
         L     @01,RVRPTR                                          0937
         MVC   VOLKY(6),RVRVOLID(@01)                              0937
*       VIDKY=FIXZERO;              /* ZERO VOL ID IN KEY    @Y30LB26*/
         MVI   VIDKY,X'00'                                         0938
*       RPLVKEY=ADDR(VKEY);         /* GET ADDR OF KEY       @Y30LB26*/
         LA    @15,VKEY                                            0939
         ST    @15,RPLVKEY(,@02)                                   0939
*       RPLVBUF=ADDR(DUMMYREC);     /* ADDR OF BUFFER        @Y30LB26*/
         LA    @15,DUMMYREC                                        0940
         ST    @15,RPLVBUF(,@02)                                   0940
*       RPLVBLN=LENGTH(STORBASE);   /* LENGTH BUFFER         @Y30LB26*/
         MVC   RPLVBLN(4,@02),@CF01147                             0941
*       RPLVLOC=OFF;                /* NOT LOCATE MODE       @Y30LB26*/
*       RPLVDIR=ON;                 /* READ DIRECT           @Y30LB26*/
*       RPLVNEXT=OFF;               /* DO NOT READ NEXT      @Y30LB26*/
         OI    RPLVDIR(@02),B'01000000'                            0944
         NI    RPLVLOC(@02),B'01011111'                            0944
*       RPLVTYP=RPLVREAD;           /* READ                  @Y30LB26*/
         MVI   RPLVTYP(@02),X'00'                                  0945
*       RPLVKGE=OFF;                /* NO > OR = READ        @Y30LB26*/
         NI    RPLVKGE(@02),B'11111011'                            0946
*       RPLVUPD=ON;                 /* READ FOR UPDATE       @Y30LB26*/
         OI    RPLVUPD(@02),B'00000010'                            0947
*       RESPECIFY                                                  0948
*         REG1 RSTD;                /* RESTRICT REG 1        @Y30LB26*/
*       REG1=RPLVPTR;               /* ADDR OF RPLV          @Y30LB26*/
         LR    REG1,@02                                            0949
*       CALL ICBVIO00;              /* READ BASE VOL REC     @Y30LB26*/
         L     @15,@CV00671                                        0950
         BALR  @14,@15                                             0950
*       RESPECIFY                                                  0951
*         REG1 UNRSTD;              /* FREE REG 1            @Y30LB26*/
*                                                                  0951
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK RETURN CODE FROM I/O PROCESSOR              @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0952
*       IF RPLVRETC^=RCZERO         /* CK RET CODE           @Y30LB26*/
*         THEN                      /*                       @Y30LB26*/
         L     @02,RPLVPTR                                         0952
         CLC   RPLVRETC(2,@02),@CB00747                            0952
         BE    @RF00952                                            0952
*         DO;                       /*                       @Y30LB26*/
*           CALL ERREXIT;           /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         0954
*           RETURN;                 /*                       @Y30LB26*/
         B     @EL00012                                            0955
*         END;                      /*                       @Y30LB26*/
*     END;                          /*                       @Y30LB26*/
@RF00952 DS    0H                                                  0958
*                                                                  0958
*   /*****************************************************************/
*   /*                                                               */
*   /* WRITE UPDATED BASE VOLUME RECORD                      @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0958
*   RPLVBUF=BASEVPTR;               /* ADDR REC TO WRITE     @Y30LB26*/
@RF00932 L     @02,RPLVPTR                                         0958
         L     @15,BASEVPTR                                        0958
         ST    @15,RPLVBUF(,@02)                                   0958
*   RPLVTYP=RPLVPUT;                /* PUT BASE RECORD       @Y30LB26*/
         MVI   RPLVTYP(@02),X'01'                                  0959
*   RESPECIFY                                                      0960
*     REG1 RSTD;                    /* REST REG 1            @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR OF RPLV          @Y30LB26*/
         LR    REG1,@02                                            0961
*   CALL ICBVIO00;                  /* WRITE BASE REC        @Y30LB26*/
         L     @15,@CV00671                                        0962
         BALR  @14,@15                                             0962
*   RESPECIFY                                                      0963
*     REG1 UNRSTD;                  /* FREE REG 1            @Y30LB26*/
*   IF RPLVRETC^=RCZERO             /* CK RET CODE           @Y30LB26*/
*     THEN                          /*                       @Y30LB26*/
         L     @02,RPLVPTR                                         0964
         CLC   RPLVRETC(2,@02),@CB00747                            0964
         BE    @RF00964                                            0964
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         0966
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00012                                            0967
*     END;                          /*                       @Y30LB26*/
*   ELSE                            /*                       @Y30LB26*/
*     IF JRNLEDSW=OFF THEN          /* SEE IF JOURNALED      @Y30LB26*/
@RF00964 TM    JRNLEDSW,B'00000001'                                0969
         BNZ   @RF00969                                            0969
*       CALL JOURNAL;               /* JOURNAL RPLV          @Y30LB26*/
         BAL   @14,JOURNAL                                         0970
*   RETURN;                         /*                       @Y30LB26*/
         B     @EL00012                                            0971
*   END REMOVCPY;                   /* END REMOVCPY PROC     @Y30LB26*/
         B     @EL00012                                            0972
*                                                                  0973
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE LOCATES THE LATEST COPY OF A BASE VOLUME    @Y30LB26*/
*   /* RECORD WHEN THE PREVIOUS LATEST COPY HAS BEEN DELETED @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0973
*FINDLCPY:                                                         0973
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
FINDLCPY ST    @14,@SA00013                                        0973
*   VIDKY=FIXONE;                   /* PUT ID TO ONE         @Y30LB26*/
         MVI   VIDKY,X'01'                                         0974
*   LOOPSW=OFF;                     /* INITILIZE LOOP SW     @Y30LB26*/
*                                                                  0975
         NI    LOOPSW,B'01111111'                                  0975
*   /*****************************************************************/
*   /*                                                               */
*   /* START LOOPING THRU COPIES UNTIL RUN OUT               #Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0976
*   DO WHILE I=I;                   /* OUTSIDE LOOP          #Y30LB26*/
         B     @DE00976                                            0976
@DL00976 DS    0H                                                  0977
*     RPLVKEY=ADDR(VKEY);           /* ADDR OF KEY           #Y30LB26*/
         L     @02,RPLVPTR                                         0977
         LA    @15,VKEY                                            0977
         ST    @15,RPLVKEY(,@02)                                   0977
*     RPLVLOC=ON;                   /* LOCATE MODE           #Y30LB26*/
*     RPLVDIR=ON;                   /* DIRECT READ           #Y30LB26*/
         OI    RPLVLOC(@02),B'11000000'                            0979
*     RPLVTYP=RPLVREAD;             /* READ RECORD           #Y30LB26*/
         MVI   RPLVTYP(@02),X'00'                                  0980
*     RPLVUPD=OFF;                  /* NOT FOR UPDATE        #Y30LB26*/
         NI    RPLVUPD(@02),B'11111101'                            0981
*     RPLVKGE=ON;                   /* READ > OR =           #Y30LB26*/
         OI    RPLVKGE(@02),B'00000100'                            0982
*     RESPECIFY                                                    0983
*       REG1 RSTD;                  /* RESTRICI REG 1        #Y30LB26*/
*     REG1=RPLVPTR;                 /* ADDR OF RPLV          #Y30LB26*/
         LR    REG1,@02                                            0984
*     CALL ICBVIO00;                /* READ COPY RECORD      #Y30LB26*/
         L     @15,@CV00671                                        0985
         BALR  @14,@15                                             0985
*     RESPECIFY                                                    0986
*       REG1 UNRSTD;                /* FREE REG 1            #Y30LB26*/
*                                                                  0986
*     /***************************************************************/
*     /*                                                             */
*     /* CHECK RETURN CODE FROM I/O PROCESSOR                #Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0987
*     IF RPLVRETC^=RCZERO THEN      /* CK RETURN             @Y30LB26*/
         L     @02,RPLVPTR                                         0987
         CLC   RPLVRETC(2,@02),@CB00747                            0987
         BE    @RF00987                                            0987
*       DO;                         /*                       #Y30LB26*/
*         IF RPLRCODE=NORECRC THEN  /* RECORD NOT FOUND ?    @Y30LB26*/
         CLC   RPLRCODE(2,@02),@CB00789                            0989
         BNE   @RF00989                                            0989
*           DO;                     /*                       @Y30LB26*/
*             IF LOOPSW=ON THEN     /* FOUND COPY REC ?      @Y30LB26*/
         TM    LOOPSW,B'10000000'                                  0991
         BNO   @RF00991                                            0991
*               DO;                 /*                       @Y30LB26*/
*                 BASKLCPY=SAVEKEY; /* LATEST COPY IN BASE   @Y30LB26*/
         L     @01,BASEVPTR                                        0993
         MVC   BASKLCPY(13,@01),SAVEKEY                            0993
*                 RPLVRETC=RCZERO;  /* GOOD RETURN           @Y30LB26*/
         MVC   RPLVRETC(2,@02),@CB00747                            0994
*                 RPLRCODE=RCZERO;  /* GOOD REASON           @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00747                            0995
*                 RETURN;           /*                       @Y30LB26*/
@EL00013 DS    0H                                                  0996
@EF00013 DS    0H                                                  0996
@ER00013 L     @14,@SA00013                                        0996
         BR    @14                                                 0996
*               END;                /*                       @Y30LB26*/
*             ELSE                  /*                       @Y30LB26*/
*               DO;                 /*                       @Y30LB26*/
@RF00991 DS    0H                                                  0999
*                 CALL ERREXIT;     /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         0999
*                 RETURN;           /*                       @Y30LB26*/
         B     @EL00013                                            1000
*               END;                /*                       @Y30LB26*/
*           END;                    /*                       @Y30LB26*/
*         ELSE                      /*                       @Y30LB26*/
*           DO;                     /*                       @Y30LB26*/
@RF00989 DS    0H                                                  1004
*             CALL ERREXIT;         /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         1004
*             RETURN;               /*                       @Y30LB26*/
         B     @EL00013                                            1005
*           END;                    /*                       @Y30LB26*/
*       END;                        /*                       #Y30LB26*/
*     COPYVPTR=RPLVBUF;             /* ADDR RECORD READ      #Y30LB26*/
*                                                                  1008
@RF00987 L     @02,RPLVPTR                                         1008
         L     @02,RPLVBUF(,@02)                                   1008
         ST    @02,COPYVPTR                                        1008
*     /***************************************************************/
*     /*                                                             */
*     /* CHECK TO BE SURE IT IS STILL A CORRECT VOLUME REC   #Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  1009
*     IF COPV=VKY&COPSERNO=VOLKY THEN/* STILL GOOD ?         #Y30LB26*/
         CLC   COPV(5,@02),VKY                                     1009
         BNE   @RF01009                                            1009
         CLC   COPSERNO(6,@02),VOLKY                               1009
         BNE   @RF01009                                            1009
*       DO;                         /*                       #Y30LB26*/
*         SAVEKEY=COPNAME;          /* SAVE CURRENT VOL KEY  #Y30LB26*/
         MVC   SAVEKEY(13),COPNAME(@02)                            1011
*         VKEY=COPNAME;             /* BUILD KEY READ AGAIN  #Y30LB26*/
         MVC   VKEY(13),COPNAME(@02)                               1012
*         VIDKY=VIDKY+FIXONE;       /* ADD ONE TO GET NEXT   #Y30LB26*/
         LA    @02,1                                               1013
         SLR   @15,@15                                             1013
         IC    @15,VIDKY                                           1013
         ALR   @02,@15                                             1013
         STC   @02,VIDKY                                           1013
*         LOOPSW=ON;                /* INDICATE FOUND 1 COPY #Y30LB26*/
         OI    LOOPSW,B'10000000'                                  1014
*       END;                        /*                       #Y30LB26*/
*     ELSE                          /*                       #Y30LB26*/
*       DO;                         /*                       #Y30LB26*/
         B     @RC01009                                            1016
@RF01009 DS    0H                                                  1017
*         IF LOOPSW=ON THEN         /* SEE IF A COPY FOUND   #Y30LB26*/
         TM    LOOPSW,B'10000000'                                  1017
         BNO   @RF01017                                            1017
*           DO;                     /*                       #Y30LB26*/
*             BASKLCPY=SAVEKEY;     /* GET OLD KEY           #Y30LB26*/
         L     @02,BASEVPTR                                        1019
         MVC   BASKLCPY(13,@02),SAVEKEY                            1019
*             RETURN;               /*                       #Y30LB26*/
         B     @EL00013                                            1020
*           END;                    /*                       #Y30LB26*/
*         ELSE                      /*                       #Y30LB26*/
*           DO;                     /*                       #Y30LB26*/
@RF01017 DS    0H                                                  1023
*             RPLVRETC=FOUR;        /* BAD RET CODE          #Y30LB26*/
         L     @02,RPLVPTR                                         1023
         MVC   RPLVRETC(2,@02),@CB00749                            1023
*             RPLRCODE=NORECRC;     /* NO COPIES FOUND       @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00789                            1024
*             CALL ERREXIT;         /* SAVE RET CODES        #Y30LB26*/
         BAL   @14,ERREXIT                                         1025
*             RETURN;               /*                       #Y30LB26*/
         B     @EL00013                                            1026
*           END;                    /*                       #Y30LB26*/
*       END;                        /*                       #Y30LB26*/
*   END;                            /*                       #Y30LB26*/
@RC01009 DS    0H                                                  1029
@DE00976 CLC   I(1),I                                              1029
         BE    @DL00976                                            1029
*   END FINDLCPY;                   /*                       #Y30LB26*/
         B     @EL00013                                            1030
*                                                                  1031
*   /*****************************************************************/
*   /*                                                               */
*   /* ROUTINE CHECKS IF CARTRIDGE INDEX RECORDS ARE         #Y30LB26*/
*   /* STILL IN THE LIBRARY                                  #Y30LB26*/
*   /* AND IF THEY BELONG TO THE RIGHT VOLUME, IT            #Y30LB26*/
*   /* DELETES THE INDEX RECORDS                             #Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1031
*CHKCART:                                                          1031
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
*                                                                  1031
CHKCART  ST    @14,@SA00014                                        1031
*   /*****************************************************************/
*   /*                                                               */
*   /* SET UP ADDRESSING TO BASE OR COPY RECORD              #Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1032
*   IF RVRBASEV=ON                  /* BASE OR COPY          #Y30LB26*/
*     THEN                                                         1032
         L     @02,RVRPTR                                          1032
         TM    RVRBASEV(@02),B'10000000'                           1032
         BNO   @RF01032                                            1032
*     BCDVPTR=BASEVPTR;             /* COMMON ADDR TO BASE   #Y30LB26*/
         L     BCDVPTR,BASEVPTR                                    1033
*   ELSE                                                           1034
*     BCDVPTR=COPYVPTR;             /* COMMON ADDR TO COPY   #Y30LB26*/
         B     @RC01032                                            1034
@RF01032 L     BCDVPTR,COPYVPTR                                    1034
*                                                                  1035
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK TO SEE IF CARTRIDGES ARE IN LIBRARY             #Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1035
*   IF BCDLIB1^=LIBTESTBCDLIB2^=LIBTEST/* IN LIB            @Y30LB26*/
*     THEN                          /*                       @Y30LB26*/
*                                                                  1035
@RC01032 CLC   BCDLIB1(1,BCDVPTR),LIBTEST                          1035
         BNE   @RT01035                                            1035
         CLC   BCDLIB2(1,BCDVPTR),LIBTEST                          1035
         BE    @RF01035                                            1035
@RT01035 DS    0H                                                  1036
*     /***************************************************************/
*     /*                                                             */
*     /* IF THEY ARE, SET REASON CODE AND RETURN             @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  1036
*     DO;                           /*                       @Y30LB26*/
*       RPLVRETC=FOUR;              /* SET BAD RET CODE      @Y30LB26*/
         L     @02,RPLVPTR                                         1037
         MVC   RPLVRETC(2,@02),@CB00749                            1037
*       RPLRCODE=INLIB;             /* REASON CODE           @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00799                            1038
*       CALL ERREXIT;               /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         1039
*       RETURN;                     /*                       @Y30LB26*/
@EL00014 DS    0H                                                  1040
@EF00014 DS    0H                                                  1040
@ER00014 L     @14,@SA00014                                        1040
         BR    @14                                                 1040
*     END;                          /*                       @Y30LB26*/
*                                                                  1042
*   /*****************************************************************/
*   /*                                                               */
*   /* READ FIRST CARTRIDGE INDEX RECORD                     @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1042
*   CARTKY=BCDCSN1;                 /* CART SERIAL TO KEY    @Y30LB26*/
@RF01035 MVC   CARTKY(12),BCDCSN1(BCDVPTR)                         1042
*   RPLVKEY=ADDR(IKEY);             /* ADDR OF KEY TO VSAM   @Y30LB26*/
         L     @04,RPLVPTR                                         1043
         LA    @02,IKEY                                            1043
         ST    @02,RPLVKEY(,@04)                                   1043
*   RPLVBUF=ADDR(STORINDX);         /* ADDR OF BUFFER        @Y30LB26*/
         LA    @02,STORINDX                                        1044
         ST    @02,RPLVBUF(,@04)                                   1044
*   RPLVBLN=LENGTH(STORINDX);       /* LENGTH BUFFER         @Y30LB26*/
         MVC   RPLVBLN(4,@04),@CF01147                             1045
*   RPLVDIR=ON;                     /* DIRECT READ           @Y30LB26*/
         OI    RPLVDIR(@04),B'01000000'                            1046
*   RPLVTYP=RPLVREAD;               /* READ CART INDX        @Y30LB26*/
         MVI   RPLVTYP(@04),X'00'                                  1047
*   RPLVUPD=ON;                     /* READ FOR UPDATE       @Y30LB26*/
         OI    RPLVUPD(@04),B'00000010'                            1048
*   RESPECIFY                                                      1049
*     REG1 RSTD;                    /* RESTRICT REG 1        @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR RPLV             @Y30LB26*/
         LR    REG1,@04                                            1050
*   CALL ICBVIO00;                  /* READ CART INDEX REC   @Y30LB26*/
         L     @15,@CV00671                                        1051
         BALR  @14,@15                                             1051
*   RESPECIFY                                                      1052
*     REG1 UNRSTD;                  /* FREE REG 1            @Y30LB26*/
*                                                                  1052
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK TO SEE IF CART INDEX REC RETURNED SUCCESS       @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1053
*   IF RPLVRETC=RCZERO              /* CK RET CODE           @Y30LB26*/
*     THEN                          /*                       @Y30LB26*/
         L     @04,RPLVPTR                                         1053
         CLC   RPLVRETC(2,@04),@CB00747                            1053
         BNE   @RF01053                                            1053
*     DO;                           /*                       @Y30LB26*/
*       INDEXPTR=ADDR(STORINDX);    /* ADDR OF INDEX REC     @Y30LB26*/
         LA    INDEXPTR,STORINDX                                   1055
*       IF INDRECKY=VKEY            /* CK BELONGS RIT VOL    @Y30LB26*/
*         THEN                      /*                       @Y30LB26*/
*                                                                  1056
         CLC   INDRECKY(13,INDEXPTR),VKEY                          1056
         BNE   @RF01056                                            1056
*         /***********************************************************/
*         /*                                                         */
*         /* CARTRIDGE BELONGS TO CORRECT VOL,               @Y30LB26*/
*         /* SO DELETE CART INDEX RECORD                     @Y30LB26*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  1057
*         DO;                       /*                       @Y30LB26*/
*           RPLVTYP=RPLVDEL;        /* DELETE CART INDX      @Y30LB26*/
         MVI   RPLVTYP(@04),X'05'                                  1058
*           RESPECIFY                                              1059
*             REG1 RSTD;            /* RESTRICT REG 1        @Y30LB26*/
*           REG1=RPLVPTR;           /* ADDR RPLV             @Y30LB26*/
         LR    REG1,@04                                            1060
*           CALL ICBVIO00;          /* DELETE INDEX REC      @Y30LB26*/
         L     @15,@CV00671                                        1061
         BALR  @14,@15                                             1061
*           RESPECIFY                                              1062
*             REG1 UNRSTD;          /* FREE REG 1            @Y30LB26*/
*                                                                  1062
*           /*********************************************************/
*           /*                                                       */
*           /* SEE IF CART RECORD DELETED SUCCESSFULLY       @Y30LB26*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1063
*           IF RPLVRETC^=RCZERO     /* CK RET CODE           @Y30LB26*/
*             THEN                  /*                       @Y30LB26*/
         L     @04,RPLVPTR                                         1063
         CLC   RPLVRETC(2,@04),@CB00747                            1063
         BE    @RF01063                                            1063
*             DO;                   /*                       @Y30LB26*/
*               CALL ERREXIT;       /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         1065
*               RETURN;             /*                       @Y30LB26*/
         B     @EL00014                                            1066
*             END;                  /*                       @Y30LB26*/
*           ELSE                    /*                       @Y30LB26*/
*             IF JRNLEDSW=OFF THEN  /* NOT JOURNLED ?        @Y30LB26*/
@RF01063 TM    JRNLEDSW,B'00000001'                                1068
         BNZ   @RF01068                                            1068
*               DO;                 /*                       @Y30LB26*/
*                 CALL JOURNAL;     /* JOURNAL RPLV          @Y30LB26*/
         BAL   @14,JOURNAL                                         1070
*                 IF RPLVRETC^=RCZERO THEN/* CK RETURN       @Y30LB26*/
         L     @04,RPLVPTR                                         1071
         CLC   RPLVRETC(2,@04),@CB00747                            1071
         BNE   @RT01071                                            1071
*                   RETURN;         /*                       @Y30LB26*/
*               END;                /*                       @Y30LB26*/
*         END;                      /*                       @Y30LB26*/
*     END;                          /*                       @Y30LB26*/
*   ELSE                            /*                       @Y30LB26*/
*                                                                  1076
*     /***************************************************************/
*     /*                                                             */
*     /* SEE IF ERROR OTHER THAN RECORD NOT FOUND            @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  1076
*     IF RPLRCODE^=NORECRC          /* CK IF REC FOUND       @Y30LB26*/
*       THEN                        /*                       @Y30LB26*/
         B     @RC01053                                            1076
@RF01053 L     @04,RPLVPTR                                         1076
         CLC   RPLRCODE(2,@04),@CB00789                            1076
         BE    @RF01076                                            1076
*       DO;                         /*                       @Y30LB26*/
*         CALL ERREXIT;             /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         1078
*         RETURN;                   /* RETURN TO CALLER      @Y30LB26*/
         B     @EL00014                                            1079
*       END;                        /*                       @Y30LB26*/
*                                                                  1081
*   /*****************************************************************/
*   /*                                                               */
*   /* START SAME THING WITH SECOND CART INDEX RECORD        @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1081
*   CARTKY=BCDCSN2;                 /* INDEX KEY             @Y30LB26*/
@RF01076 DS    0H                                                  1081
@RC01053 MVC   CARTKY(12),BCDCSN2(BCDVPTR)                         1081
*   RPLVKEY=ADDR(IKEY);             /* ADDR KEY TO VSAM      @Y30LB26*/
         L     @02,RPLVPTR                                         1082
         LA    @15,IKEY                                            1082
         ST    @15,RPLVKEY(,@02)                                   1082
*   RPLVBUF=ADDR(STORINDX);         /* ADDR BUFFER           @Y30LB26*/
         LA    @15,STORINDX                                        1083
         ST    @15,RPLVBUF(,@02)                                   1083
*   RPLVBLN=LENGTH(STORINDX);       /* LENGTH BUFFER         @Y30LB26*/
         MVC   RPLVBLN(4,@02),@CF01147                             1084
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB26*/
         OI    RPLVDIR(@02),B'01000000'                            1085
*   RPLVTYP=RPLVREAD;               /* READ RECORD           @Y30LB26*/
         MVI   RPLVTYP(@02),X'00'                                  1086
*   RPLVUPD=ON;                     /* READ FOR UPDATE       @Y30LB26*/
         OI    RPLVUPD(@02),B'00000010'                            1087
*   RESPECIFY                                                      1088
*     REG1 RSTD;                    /* REST REG 1            @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR RPLV             @Y30LB26*/
         LR    REG1,@02                                            1089
*   CALL ICBVIO00;                  /* READ SECOND CART      @Y30LB26*/
         L     @15,@CV00671                                        1090
         BALR  @14,@15                                             1090
*   RESPECIFY                                                      1091
*     REG1 UNRSTD;                  /* FREE REG 1            @Y30LB26*/
*                                                                  1091
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK TO SEE IF RECORD RETURNED SUCCESSFULLY          @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1092
*   IF RPLVRETC=RCZERO              /* TEST RET CODE         @Y30LB26*/
*     THEN                          /*                       @Y30LB26*/
*                                                                  1092
         L     @02,RPLVPTR                                         1092
         CLC   RPLVRETC(2,@02),@CB00747                            1092
         BNE   @RF01092                                            1092
*     /***************************************************************/
*     /*                                                             */
*     /* SET ADDRESSING AND CK TO SEE IF CORRECT OWNER       @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  1093
*     DO;                           /*                       @Y30LB26*/
*       INDEXPTR=ADDR(STORINDX);    /* ADDR REC JUST READ    @Y30LB26*/
         LA    INDEXPTR,STORINDX                                   1094
*       IF INDRECKY=VKEY            /* TEST IF RIT OWNER     @Y30LB26*/
*         THEN                      /*                       @Y30LB26*/
*                                                                  1095
         CLC   INDRECKY(13,INDEXPTR),VKEY                          1095
         BNE   @RF01095                                            1095
*         /***********************************************************/
*         /*                                                         */
*         /* IF BELONGS TO THE CORRECT VOLUME DELETE         @Y30LB26*/
*         /* CARTRIDGE INDEX RECORD                          @Y30LB26*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  1096
*         DO;                       /*                       @Y30LB26*/
*           RPLVTYP=RPLVDEL;        /* DELETE CART INDEX     @Y30LB26*/
         MVI   RPLVTYP(@02),X'05'                                  1097
*           RESPECIFY                                              1098
*             REG1 RSTD;            /* REST REG 1            @Y30LB26*/
*           REG1=RPLVPTR;           /* ADDR RPLV             @Y30LB26*/
         LR    REG1,@02                                            1099
*           CALL ICBVIO00;          /* DELETE INDEX REC      @Y30LB26*/
         L     @15,@CV00671                                        1100
         BALR  @14,@15                                             1100
*           RESPECIFY                                              1101
*             REG1 UNRSTD;          /* FREE REG 1            @Y30LB26*/
*                                                                  1101
*           /*********************************************************/
*           /*                                                       */
*           /* CK TO SEE IF SUCCESSFULLY DELETED             @Y30LB26*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1102
*           IF RPLVRETC^=RCZERO     /* CK RET CODE           @Y30LB26*/
*             THEN                  /*                       @Y30LB26*/
         L     @02,RPLVPTR                                         1102
         CLC   RPLVRETC(2,@02),@CB00747                            1102
         BE    @RF01102                                            1102
*             DO;                   /*                       @Y30LB26*/
*               CALL ERREXIT;       /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         1104
*               RETURN;             /*                       @Y30LB26*/
         B     @EL00014                                            1105
*             END;                  /*                       @Y30LB26*/
*           ELSE                    /*                       @Y30LB26*/
*                                                                  1107
*             /*******************************************************/
*             /*                                                     */
*             /* IF NOT JOURNLED BEFORE, JOURNAL IT          @Y30LB26*/
*             /*                                                     */
*             /*******************************************************/
*                                                                  1107
*             DO;                   /*                       @Y30LB26*/
@RF01102 DS    0H                                                  1108
*               IF JRNLEDSW=OFF THEN/* NOT JOURNLED ?        @Y30LB26*/
         TM    JRNLEDSW,B'00000001'                                1108
         BNZ   @RF01108                                            1108
*                 DO;               /*                       @Y30LB26*/
*                   CALL JOURNAL;   /* JOURNAL RPLV          @Y30LB26*/
         BAL   @14,JOURNAL                                         1110
*                   IF RPLVRETC^=RCZERO THEN/* CK RETURN     @Y30LB26*/
         L     @02,RPLVPTR                                         1111
         CLC   RPLVRETC(2,@02),@CB00747                            1111
         BNE   @RT01111                                            1111
*                     RETURN;       /*                       @Y30LB26*/
*                 END;              /*                       @Y30LB26*/
*             END;                  /*                       @Y30LB26*/
@RF01108 DS    0H                                                  1115
*         END;                      /*                       @Y30LB26*/
*     END;                          /*                       @Y30LB26*/
*   ELSE                            /*                       @Y30LB26*/
*                                                                  1117
*     /***************************************************************/
*     /*                                                             */
*     /* CK TO SEE IF RETURN CODE OTHER THAN                 @Y30LB26*/
*     /* RECORD NOT FOUND                                    @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  1117
*     IF RPLRCODE^=NORECRC          /* CK IF NO REC FOUND    @Y30LB26*/
*       THEN                        /*                       @Y30LB26*/
         B     @RC01092                                            1117
@RF01092 L     @02,RPLVPTR                                         1117
         CLC   RPLRCODE(2,@02),@CB00789                            1117
         BE    @RF01117                                            1117
*       DO;                         /*                       @Y30LB26*/
*         CALL ERREXIT;             /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         1119
*         RETURN;                   /*                       @Y30LB26*/
         B     @EL00014                                            1120
*       END;                        /*                       @Y30LB26*/
*                                                                  1122
*   /*****************************************************************/
*   /*                                                               */
*   /* EVERY THING IS ALRIGHT SO SET GOOD RETURN CODES       @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1122
*   RPLVRETC=RCZERO;                /* GOOD RET CODE         @Y30LB26*/
@RF01117 DS    0H                                                  1122
@RC01092 L     @02,RPLVPTR                                         1122
         MVC   RPLVRETC(2,@02),@CB00747                            1122
*   RPLRCODE=RCZERO;                /* ZERO REASON CODE      @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00747                            1123
*   RETURN;                         /*                       @Y30LB26*/
         B     @EL00014                                            1124
*   END CHKCART;                    /* CHKCART INNER PROC    @Y30LB26*/
         B     @EL00014                                            1125
*                                                                  1126
*/*  START OF SPECIFICATIONS ****                                  1126
*                                                                  1126
*    PROCEDURE NAME - READVVI                                 @Y30LB26
*                                                                  1126
*    FUNCTION - RETRIEVE RECORDS FROM THE USERCAT.MSVI DATA SET.  THIS
*    PROGRAM READS AND RETURNS CERTAIN MSVC RECORDS.  IT DOES NOT  1126
*    UPDATE ANY MSVC RECORDS.  IT WILL READ DIRECT, READ NEXT OR READ
*    CHAIN FOR BASE VOLUME RECORDS.  IT WILL ALSO READ THE FIRST BASE
*    VOLUME RECORD IN THE INVENTORY DATA SET AND THE FIRST BASE VOLUME
*    RECORD IN THE NON-GROUPED BASE CHAIN. WHEN READING NEXT OR READING
*    A CHAIN IT WILL CONTINUE TO READ UNTIL A RECORD IS FOUND THAT 1126
*    MEETS ALL THE TEST PARAMETERS, IF ANY WERE SPECIFIED.  WHEN A 1126
*    RECORD IS FOUND THAT MEETS ALL THE TEST REQUIREMENTS, IT RETURNS
*    TO THE CALLING PROGRAM WITH THE RECORD. THE TESTS MADE FOR    1126
*    THE BASE VOLUME RECORD INCLUDE EXPIRATION DATE, GENERAL OR    1126
*    RESTRICTED USE, ACTIVE OR INACTIVE.  FOR GROUP RECORDS, READ  1126
*    DIRECT AND READ NEXT IS VALID.  IT WILL ALSO READ THE FIRST GROUP
*    RECORD IN THE DATA SET.  THE ONLY CHECK PREFORMED IS THE      1126
*    GROUP THRESHOLD TEST.  WHEN READING NEXT, IT WILL CONTINUE READING
*    GROUP RECORDS UNTIL IT FINDS A RECORD WITH A GROUP THRESHOLD  1126
*    GREATER THAN OR EQUAL TO THE GROUP FREE SPACE.  IT THEN RETURNS
*    TO THE CALLING PROGRAM WITH THE RECORD.  IF ALL GROUP RECORDS 1126
*    ARE READ AND NONE WERE FOUND MEETING THE TEST REQUIREMENTS,   1126
*    A REASON AND CONDITION CODE IS RETURNED TO THE CALLING PROGRAM.
*    IF READING COPY RECORDS, A DATE AND SEQUENCE CHECK CAN BE     1126
*    SPECIFIED WHEN READING DIRECT.  A REQUEST CAN BE HANDLED FOR THE
*    LATEST BACKUP COPY, OLDEST BACKUP COPY OR LATEST COPY.  WHEN  1126
*    READING NEXT, A COPY ID MUST BE PROVIDED.                     1126
*    WHEN READING DUPLICATE VOLUME RECORDS, A READ DIRECT WILL GET THE
*    FIRST DUPLICATE VOLUME RECORD WITH THE GIVEN VOLID.  WHEN     1126
*    READING NEXT, IF NO VOLID IS GIVEN, THE DUPLICATE ID IS IGNORED
*    AND THE FIRST DUPLICATE VOLUME RECORD IS RETURNED.  IF A VOLID IS
*    SPECIFIED ON A READ NEXT, A DUPLICATE ID MUST BE GIVEN.  THE  1126
*    PROGRAM WILL RETURN THE DUPLICATE RECORD WITH THE NEXT HIGHER ID
*    FROM THE GIVEN ID.  THE PROGRAM WILL                          1126
*    CONTINUE READING DUPLICATE RECORDS UNTIL IT RUNS OUT UNLESS A BIT
*    IS SET IN THE REQUEST BLOCK TELLING THAT ONLY THE DUPLICATE   1126
*    RECORDS OF THE SPECIFIED VOLUME ARE TO BE RETURNED.           1126
*                                                                  1126
*    WHEN READING A CARTRIDGE INDEX RECORD, THE CARTRIDGE RECORD IS
*    READ AND THEN THE VOLUME RECORD OF THE VOLUME THAT OWNS THE   1126
*    CARTRIDGE IS READ AND RETURNED TO THE CALLER. IF THE CARTRIDGE
*    RECORD DOES NOT EXIST, A CONDITION AND REASON CODE IS RETURNED.
*    IF THE VOLUME RECORD DOES NOT EXIST, A CONDITION AND REASON CODE
*    IS RETURNED. ALSO FOR THIS ERROR CASE, THE CARTRIDGE INDEX RECORD
*    IS RETURNED IN THE SAME MANNER THAT THE VOLUME RECORD WOULD   1126
*    NORMALLY BE RETURNED.                                   @Z40LB66
*                                                                  1126
*    WHEN READING AN UNKNOWN RECORD, A CARTRIDGE SERIAL NUMBER MUST
*    BE SPECIFIED IN ORDER TO READ THE CARTRIDGE INDEX RECORD.  IF 1126
*    THE CARTRIDGE RECORD DOES NOT EXIST, A CONDITION AND REASON   1126
*    CODE IS RETURNED TO THE USER. IF A VOLUME ID IS SPECIFIED,    1126
*    A CHECK IS MADE TO SEE IF IT MATCHES THE ONE IN THE           1126
*    CARTRIDGE INDEX RECORD.  IF THEY DO MATCH, THE BASE, COPY OR  1126
*    DUPLICATE VOLUME RECORD THAT OWNS THE CARTRIDGE IS READ AND   1126
*    RETURNED TO THE CALLING PROGRAM.  IF THE VOLUME ID DOES NOT   1126
*    MATCH, A REASON AND CONDITION CODE ARE RETURNED. IF THE VOLUME
*    RECORD DOES NOT EXIST, THE CARTRIDGE RECORD AND A REASON AND  1126
*    CONDITION CODE ARE RETURNED.                            @Z40LB66
*                                                                  1126
*    TO READ A CPU ID RECORD, ONLY THE RVVCPURC FLAG NEEDS TO BE   1126
*    SPECIFIED.                                              @Z40LB66
*                                                                  1126
*   TO READ ONLY A COPY VOLUME PLACE HOLDER RECORD RVVCPLHD        1126
*   MUST BE SPECIFIED.  IT IS NOT VALID WITH LATEST OR OLDEST      1126
*   BACKUP OR WITH LATEST COPY.  TO READ ONLY A BASE VOLUME PLACE  1126
*   HOLDER RECORD RVVBPLHD MUST BE SPECIFIED.  IT IS NOT           1126
*   VALID WITH READ CHAIN.  WITH RVVCPLHD OR RVVBPLHD EITHER       1126
*   RVVRDR OR RVVRDNR MUST BE SPECIFIED.  RVVALL IS NOT VALID WITH 1126
*   READ CHAIN.  IF RVVALL IS SPECIFIED WITH RVVCPYRC, THEN ALL COPY
*   VOLUME RECORDS INCLUDING COPY PLACE HOLDERS WILL BE RETURNED.  1126
*   ALSO, IF RVVALL IS SPECIFIED WITH RVVBVRCD, THEN ALL BASE      1126
*   VOLUME AND BASE PLACE HOLDER RECORDS WILL BE RETURNED.    @ZDR2053
*                                                                  1126
*      INPUTS - REGISTER 1 CONTAINS THE ADDRESS OF THE RPLV.  THIS HAS
*      THE REQUEST BLOCK CONTAINING THE PARAMETERS NEEDED TO READ MSVI
*      RECORDS.                                               @Y30LB26
*                                                                  1126
*      OUTPUTS - REASON AND RETURN CODES, PLUS THE RETURNED        1126
*      RECORD, IF ONE WAS FOUND.  THE RPLV CONTAINS THE RECORD     1126
*      ADDRESS, PLUS THE RETURN AND REASON CODES.             @Y30LB26
*                                                                  1126
*     '021E'X  VALID TYPE OF READ WAS NOT SPECIFIED           @Y30LB26
*     '0220'X  READ UNKNOWN WITH NO CSN SPECIFIED             @Y30LB26
*     '0222'X  TYPE RECORD TO READ NOT SPECIFIED              @Y30LB26
*     '0223'X  RECORD(S) FOUND DID NOT MEET TESTS             @Y30LB26
*     '0208'X  REQUESTED RECORD COULD NOT BE FOUND            @Y30LB26
*     '0224'X  BREAK IN BASE VOLUME CHAIN (GRPED - NON-GRPED) @Y30LB26
*     '0229'X  TYPE OF COPY NOT SPECIFIED                     @Y30LB26
*     '021F'X  READ NEXT FOR DUP WITH NO DUP ID SPECIFIED     @Y30LB26
*     '021D'X  VOLID IN THE CARTRIDGE INDEX RECORD DID NOT    @Y30LB26
*      MATCH THE SPECIFIED VOLID                              @Y30LB26
*     '022A'X  UNABLE TO GET BUFFER SPACE TO RETURN RECORD    @Y30LB26
*     '0221'X  READ NEXT COPY WITH NO COPY ID SPECIFIED       @Y30LB26
*     '0230'X  USER PROVIDED BUFFER AREA TOO SHORT FOR        @Y30LB26
*      RECORD BEING RETURNED.                                 @Y30LB26
*     '023C'X VOLUME RECORD DOES NOT EXIST FOR CARTRIDGE      @Z40LB66
*      PLUS ANY REASON CODES FROM THE I/O PROCESSOR           @Y30LB26
**** END OF SPECIFICATIONS **                                        */
*                                                                  1126
*READVVI:                           /*                       #Y30LB26*/
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
*                                                                  1126
READVVI  ST    @14,@SA00015                                        1126
*   /*****************************************************************/
*   /*                                                               */
*   /* SET UP ADDRESSING TO REQUEST BLOCK                    #Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1127
*   RVVIPTR=ADDR(RPLVUTIL);         /* ADDR OF REQUEST BLK   #Y30LB26*/
*                                                                  1127
         L     RVVIPTR,RPLVPTR                                     1127
         LA    RVVIPTR,RPLVUTIL(,RVVIPTR)                          1127
*   /*****************************************************************/
*   /*                                                               */
*   /* INITILIZE LOOP INDICATOR                              #Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1128
*   LOOPSW=OFF;                     /* INIT LOOP SW          #Y30LB26*/
*                                                                  1128
         NI    LOOPSW,B'01111111'                                  1128
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK IF TYPE READ IS FOR BASE                        #Y30LB26*/
*   /* OR A PLACE HOLDER                                     @ZDR2053*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1129
*   IF RVVBVRCD=ON THEN             /* READ BASE?            #Y30LB26*/
         TM    RVVBVRCD(RVVIPTR),B'10000000'                       1129
         BNO   @RF01129                                            1129
*     DO;                           /*                       @Y30LB26*/
*                                                                  1130
*       /*************************************************************/
*       /*                                                           */
*       /* DETERMINE TYPE OF READ TO DO ON BASE REC          @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1131
*       IF RVVRDR=ON THEN           /* READ DIRECT?          @Y30LB26*/
         TM    RVVRDR(RVVIPTR),B'10000000'                         1131
         BNO   @RF01131                                            1131
*         DO;                       /*                       @Y30LB26*/
*           CALL BASEDIR;           /* READ BASE DIRECT      @Y30LB26*/
         BAL   @14,BASEDIR                                         1133
*           RETURN;                 /*                       @Y30LB26*/
@EL00015 DS    0H                                                  1134
@EF00015 DS    0H                                                  1134
@ER00015 L     @14,@SA00015                                        1134
         BR    @14                                                 1134
*         END;                      /*                       @Y30LB26*/
*                                                                  1135
*       /*************************************************************/
*       /*                                                           */
*       /* READ NEXT                                         @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1136
*       IF RVVRDNR=ON THEN          /* READ NEXT?            @Y30LB26*/
@RF01131 TM    RVVRDNR(RVVIPTR),B'01000000'                        1136
         BNO   @RF01136                                            1136
*         DO;                       /*                       @Y30LB26*/
*           CALL BASENREC;          /* READ BASE NEXT        @Y30LB26*/
         BAL   @14,BASENREC                                        1138
*           RETURN;                 /*                       @Y30LB26*/
         B     @EL00015                                            1139
*         END;                      /*                       @Y30LB26*/
*                                                                  1140
*       /*************************************************************/
*       /*                                                           */
*       /* READ CHAIN                                        @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1141
*       IF RVVRDCH=ON&RVVBPLHD=OFF&RVVALL=OFF THEN/*         @ZDR2053
*                                      BASE CHAIN?           @ZDR2053*/
@RF01136 TM    RVVRDCH(RVVIPTR),B'00100000'                        1141
         BNO   @RF01141                                            1141
         TM    RVVBPLHD(RVVIPTR),B'00000001'                       1141
         BNZ   @RF01141                                            1141
         TM    RVVALL(RVVIPTR),B'00000001'                         1141
         BNZ   @RF01141                                            1141
*         DO;                       /*                       @Y30LB26*/
*           CALL BASECHN;           /* READ CHAIN            @Y30LB26*/
         BAL   @14,BASECHN                                         1143
*           RETURN;                 /*                       @Y30LB26*/
         B     @EL00015                                            1144
*         END;                      /*                       @Y30LB26*/
*                                                                  1146
*       /*************************************************************/
*       /*                                                           */
*       /* IF NOT READ DIRECT, NEXT OR CHAIN, SET ERROR CODE @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1146
*       RPLVRETC=FOUR;              /* SET BAD RC            @Y30LB26*/
@RF01141 L     @02,RPLVPTR                                         1146
         MVC   RPLVRETC(2,@02),@CB00749                            1146
*       RPLRCODE=NOTYPRD;           /* TYPE READ NOT SPEC    @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00809                            1147
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00015                                            1148
*     END;                          /*                       @Y30LB26*/
*                                                                  1149
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK IF READ IS FOR GROUP RECORD                     @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1150
*   IF RVVGRPRC=ON THEN             /* READ GROUP?           @Y30LB26*/
@RF01129 TM    RVVGRPRC(RVVIPTR),B'01000000'                       1150
         BNO   @RF01150                                            1150
*     DO;                           /*                       @Y30LB26*/
*                                                                  1151
*       /*************************************************************/
*       /*                                                           */
*       /* READ DIRECT GROUP RECORD                          @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1152
*       IF RVVRDR=ON THEN           /* READ DIRECT?          @Y30LB26*/
         TM    RVVRDR(RVVIPTR),B'10000000'                         1152
         BNO   @RF01152                                            1152
*         DO;                       /*                       @Y30LB26*/
*           CALL GRPDIR;            /* READ GROUP DIRECT     @Y30LB26*/
         BAL   @14,GRPDIR                                          1154
*           RETURN;                 /*                       @Y30LB26*/
         B     @EL00015                                            1155
*         END;                      /*                       @Y30LB26*/
*                                                                  1156
*       /*************************************************************/
*       /*                                                           */
*       /* READ NEXT GROUP RECORD                            @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1157
*       IF RVVRDNR=ON THEN          /* READ NEXT?            @Y30LB26*/
@RF01152 TM    RVVRDNR(RVVIPTR),B'01000000'                        1157
         BNO   @RF01157                                            1157
*         DO;                       /*                       @Y30LB26*/
*           CALL GRPNREC;           /* READ GROUP NEXT       @Y30LB26*/
         BAL   @14,GRPNREC                                         1159
*           RETURN;                 /*                       @Y30LB26*/
         B     @EL00015                                            1160
*         END;                      /*                       @Y30LB26*/
*       RPLVRETC=FOUR;              /* BAD RC                @Y30LB26*/
@RF01157 L     @02,RPLVPTR                                         1162
         MVC   RPLVRETC(2,@02),@CB00749                            1162
*       RPLRCODE=NOTYPRD;           /* TYPE READ NOT SPEC    @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00809                            1163
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00015                                            1164
*     END;                          /*                       @Y30LB26*/
*                                                                  1166
*   /*****************************************************************/
*   /*                                                               */
*   /* READ COPY RECORD OR COPY PLACE HOLDER RECORD          @ZDR2053*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1166
*   IF RVVCPYRC=ON THEN             /* READ COPY?            @Y30LB26*/
@RF01150 TM    RVVCPYRC(RVVIPTR),B'00100000'                       1166
         BNO   @RF01166                                            1166
*     DO;                           /*                       @Y30LB26*/
*                                                                  1167
*       /*************************************************************/
*       /*                                                           */
*       /* READCOPY RECORD DIRECT                            @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1168
*       IF RVVRDR=ON THEN           /* READ DIRECT?          @Y30LB26*/
         TM    RVVRDR(RVVIPTR),B'10000000'                         1168
         BNO   @RF01168                                            1168
*         DO;                       /*                       @Y30LB26*/
*           CALL COPYDIR;           /* READ COPY DIRECT      @Y30LB26*/
         BAL   @14,COPYDIR                                         1170
*           RETURN;                 /*                       @Y30LB26*/
         B     @EL00015                                            1171
*         END;                      /*                       @Y30LB26*/
*                                                                  1172
*       /*************************************************************/
*       /*                                                           */
*       /* READ NEXT COPY RECORD                             @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1173
*       IF RVVRDNR=ON THEN          /* READ NEXT COPY ?      @Y30LB26*/
@RF01168 TM    RVVRDNR(RVVIPTR),B'01000000'                        1173
         BNO   @RF01173                                            1173
*         DO;                       /*                       @Y30LB26*/
*           CALL COPYNREC;          /* READ NEXT COPY        @Y30LB26*/
         BAL   @14,COPYNREC                                        1175
*           RETURN;                 /*                       @Y30LB26*/
         B     @EL00015                                            1176
*         END;                      /*                       @Y30LB26*/
*                                                                  1177
*       /*************************************************************/
*       /*                                                           */
*       /* MUST BE A READ DIRECT OR READ NEXT                @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1178
*       RPLVRETC=FOUR;              /* BAD RETURN CODE       @Y30LB26*/
@RF01173 L     @02,RPLVPTR                                         1178
         MVC   RPLVRETC(2,@02),@CB00749                            1178
*       RPLRCODE=NOTYPRD;           /* NO READ OR NEXT       @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00809                            1179
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00015                                            1180
*     END;                          /*                       @Y30LB26*/
*                                                                  1182
*   /*****************************************************************/
*   /*                                                               */
*   /* READ DUPLICATE RECORD                                 @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1182
*   IF RVVDUPRC=ON THEN             /* READ DUPLICATE?       @Y30LB26*/
@RF01166 TM    RVVDUPRC(RVVIPTR),B'00010000'                       1182
         BNO   @RF01182                                            1182
*     DO;                           /*                       @Y30LB26*/
*                                                                  1183
*       /*************************************************************/
*       /*                                                           */
*       /* READ DIRECT DUP RECORD                            @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1184
*       IF RVVRDR=ON THEN           /* READ DIRECT?          @Y30LB26*/
         TM    RVVRDR(RVVIPTR),B'10000000'                         1184
         BNO   @RF01184                                            1184
*         DO;                       /*                       @Y30LB26*/
*           CALL DUPDIR;            /* READ DUP DIRECT       @Y30LB26*/
         BAL   @14,DUPDIR                                          1186
*           RETURN;                 /*                       @Y30LB26*/
         B     @EL00015                                            1187
*         END;                      /*                       @Y30LB26*/
*                                                                  1188
*       /*************************************************************/
*       /*                                                           */
*       /* REAR NEXT DUP RECORD                              @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1189
*       IF RVVRDNR=ON THEN          /* READ NEXT?            @Y30LB26*/
@RF01184 TM    RVVRDNR(RVVIPTR),B'01000000'                        1189
         BNO   @RF01189                                            1189
*         DO;                       /*                       @Y30LB26*/
*           CALL DUPNREC;           /* READ DUP NEXT         @Y30LB26*/
         BAL   @14,DUPNREC                                         1191
*           RETURN;                 /*                       @Y30LB26*/
         B     @EL00015                                            1192
*         END;                      /*                       @Y30LB26*/
*                                                                  1193
*       /*************************************************************/
*       /*                                                           */
*       /* MUST BE READ DIRECT OR READ NEXT                  @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1194
*       RPLVRETC=FOUR;              /* BAD RC                @Y30LB26*/
@RF01189 L     @02,RPLVPTR                                         1194
         MVC   RPLVRETC(2,@02),@CB00749                            1194
*       RPLRCODE=NOTYPRD;           /* TYPE READ NOT SPEC    @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00809                            1195
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00015                                            1196
*     END;                          /*                       @Y30LB26*/
*                                                                  1198
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK IF READ IS FOR CARTRIDGE INDEX RECORD           @Z40LB66*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1198
*   IF RVVCIRCD=ON THEN                                            1198
@RF01182 TM    RVVCIRCD(RVVIPTR),B'00000100'                       1198
         BNO   @RF01198                                            1198
*     DO;                           /*                       @Z40LB66*/
*                                                                  1199
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK FOR READ NEXT                               @Z40LB66*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1200
*       IF RVVRDNR=ON THEN                                         1200
         TM    RVVRDNR(RVVIPTR),B'01000000'                        1200
         BNO   @RF01200                                            1200
*         DO;                       /*                       @Z40LB66*/
*           CALL CARTNREC;          /*                       @Z40LB66*/
         BAL   @14,CARTNREC                                        1202
*           RETURN;                 /*                       @Z40LB66*/
         B     @EL00015                                            1203
*         END;                      /*                       @Z40LB66*/
*                                                                  1204
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK FOR READ DIRECT                             @Z40LB66*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1205
*       IF RVVRDR=ON THEN                                          1205
@RF01200 TM    RVVRDR(RVVIPTR),B'10000000'                         1205
         BNO   @RF01205                                            1205
*         DO;                       /*                       @Z40LB66*/
*           CALL CARTDIR;           /*                       @Z40LB66*/
         BAL   @14,CARTDIR                                         1207
*           RETURN;                 /*                       @Z40LB66*/
         B     @EL00015                                            1208
*         END;                      /*                       @Z40LB66*/
*                                                                  1209
*       /*************************************************************/
*       /*                                                           */
*       /* MUST BE READ DIRECT OR READ NEXT                  @Z40LB66*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1210
*       RPLVRETC=FOUR;              /* BAD RC                @Z40LB66*/
@RF01205 L     @02,RPLVPTR                                         1210
         MVC   RPLVRETC(2,@02),@CB00749                            1210
*       RPLRCODE=NOTYPRD;           /* TYPE READ NOT SPEC    @Z40LB66*/
         MVC   RPLRCODE(2,@02),@CB00809                            1211
*       RETURN;                     /*                       @Z40LB66*/
         B     @EL00015                                            1212
*     END;                          /*                       @Z40LB66*/
*                                                                  1214
*   /*****************************************************************/
*   /*                                                               */
*   /* READ UNKNOWN RECORD                                   @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1214
*   IF RVVRUNKN=ON THEN             /* READ UNKNOWN?         @Y30LB26*/
@RF01198 TM    RVVRUNKN(RVVIPTR),B'00001000'                       1214
         BNO   @RF01214                                            1214
*     DO;                           /*                       @Y30LB26*/
*                                                                  1215
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK TO SEE IF CART SERIAL SPEC                  @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1216
*       IF RVVSCSN=OFF THEN         /* CARTRIDGE SPECIFIED?  @Y30LB26*/
         TM    RVVSCSN(RVVIPTR),B'00001000'                        1216
         BNZ   @RF01216                                            1216
*         DO;                       /*                       @Y30LB26*/
*           RPLRCODE=NOCART;        /* NO CARTRIDGE GIVEN    @Y30LB26*/
         L     @02,RPLVPTR                                         1218
         MVC   RPLRCODE(2,@02),@CB00813                            1218
*           RPLVRETC=FOUR;          /* BAD RC                @Y30LB26*/
         MVC   RPLVRETC(2,@02),@CB00749                            1219
*           RETURN;                 /*                       @Y30LB26*/
         B     @EL00015                                            1220
*         END;                      /*                       @Y30LB26*/
*       ELSE                        /*                       @Y30LB26*/
*                                                                  1222
*         /***********************************************************/
*         /*                                                         */
*         /* IF SERIAL SPEC, GO READ CART AND VOL RECS       @Y30LB26*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  1222
*         DO;                       /*                       @Y30LB26*/
@RF01216 DS    0H                                                  1223
*           CALL CARTDIR;           /* READ CARTRIDGE        @Z40LB66*/
         BAL   @14,CARTDIR                                         1223
*           RETURN;                 /*                       @Y30LB26*/
         B     @EL00015                                            1224
*         END;                      /*                       @Y30LB26*/
*     END;                          /*                       @Y30LB26*/
*   IF RVVCPURC=ON THEN             /* READ CPU ID RECORD ?  @Z40LB66*/
@RF01214 TM    RVVCPURC(RVVIPTR),B'00000010'                       1227
         BNO   @RF01227                                            1227
*     DO;                           /*                       @Z40LB66*/
*       CALL READCPU;               /*                       @Z40LB66*/
         BAL   @14,READCPU                                         1229
*       RETURN;                     /*                       @Z40LB66*/
         B     @EL00015                                            1230
*     END;                          /*                       @Z40LB66*/
*   ELSE                            /*                       @Y30LB26*/
*                                                                  1232
*     /***************************************************************/
*     /*                                                             */
*     /* TYPE OF RECORD TO READ NOT SPECIFIED                @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  1232
*     DO;                           /*                       @Y30LB26*/
@RF01227 DS    0H                                                  1233
*       RPLVRETC=FOUR;              /* BAD RC                @Y30LB26*/
         L     @02,RPLVPTR                                         1233
         MVC   RPLVRETC(2,@02),@CB00749                            1233
*       RPLRCODE=NORECTYP;          /* REC TYPE NOT GIVEN    @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00817                            1234
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00015                                            1235
*     END;                          /*                       @Y30LB26*/
*   END READVVI;                    /*                       @Y30LB26*/
*                                                                  1238
*   /*****************************************************************/
*   /*                                                               */
*   /* THIS ROUTINE READS A CPU ID RECORD                    @Z40LB66*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1238
*READCPU:                           /*                       @Z40LB66*/
*   PROC OPTIONS(SAVE(REG14));      /*                       @Z40LB66*/
*                                                                  1238
READCPU  ST    @14,@SA00016                                        1238
*   /*****************************************************************/
*   /*                                                               */
*   /* GO RESERVE INVENTORY DATA SET SHARED                  @Z40LB66*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1239
*   CALL RESSHARE;                  /* RESERVE INVENTORY SHR @Z40LB66*/
*                                                                  1239
         BAL   @14,RESSHARE                                        1239
*   /*****************************************************************/
*   /*                                                               */
*   /* SET UP TO READ THE CPU ID RECORD                      @Z40LB66*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1240
*   RPLVKEY=ADDR(CKEY);             /* ADDR OF KEY           @Z40LB66*/
         L     @04,RPLVPTR                                         1240
         LA    @02,CKEY                                            1240
         ST    @02,RPLVKEY(,@04)                                   1240
*   RPLVLOC=ON;                     /* LOCATE MODE           @Z40LB66*/
*   RPLVDIR=ON;                     /* READ DIRECT           @Z40LB66*/
         OI    RPLVLOC(@04),B'11000000'                            1242
*   RPLVTYP=RPLVREAD;               /* READ RECORD           @Z40LB66*/
         MVI   RPLVTYP(@04),X'00'                                  1243
*   RESPECIFY                                                      1244
*     REG1 RESTRICTED;              /* RESTRICT REG1         @Z40LB66*/
*   REG1=RPLVPTR;                   /* ADDR OF RPLV          @Z40LB66*/
         LR    REG1,@04                                            1245
*   CALL ICBVIO00;                  /* READ CPUID RECORD     @Z40LB66*/
         L     @15,@CV00671                                        1246
         BALR  @14,@15                                             1246
*   RESPECIFY                                                      1247
*     REG1 UNRESTRICTED;            /* UNRESTRICT REG1       @Z40LB66*/
*                                                                  1247
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK RETURN CODE FROM I/O PROCESSOR                  @Z40LB66*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1248
*   IF RPLVRETC^=RCZERO THEN        /* CHECK RC              @Z40LB66*/
         L     @04,RPLVPTR                                         1248
         CLC   RPLVRETC(2,@04),@CB00747                            1248
         BE    @RF01248                                            1248
*     DO;                           /*                       @Z40LB66*/
*       CALL ERREXIT;               /* SAVE REASON CODES     @Z40LB66*/
         BAL   @14,ERREXIT                                         1250
*       RETURN;                     /*                       @Z40LB66*/
@EL00016 DS    0H                                                  1251
@EF00016 DS    0H                                                  1251
@ER00016 L     @14,@SA00016                                        1251
         BR    @14                                                 1251
*     END;                          /*                       @Z40LB66*/
*                                                                  1252
*   /*****************************************************************/
*   /*                                                               */
*   /* GET CORE IN SUBPOOL TO MOVE RECORD INTO               @Z40LB66*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1253
*   CALL GETBUF;                    /* GET BUFFER FOR REC    @Z40LB66*/
@RF01248 BAL   @14,GETBUF                                          1253
*   IF RPLVRETC^=RCZERO THEN        /* CK RETURN             @Z40LB66*/
         L     @04,RPLVPTR                                         1254
         CLC   RPLVRETC(2,@04),@CB00747                            1254
         BNE   @RT01254                                            1254
*     RETURN;                       /*                       @Z40LB66*/
*   CPUIDPTR=RPLVBUF;               /* SET BASE TO RECORD    @Z40LB66*/
         L     @02,RPLVPTR                                         1256
         L     CPUIDPTR,RPLVBUF(,@02)                              1256
*   BUFFER=CPUID;                   /* MOVE REC TO BUF       @Z40LB66*/
         L     @01,RVVAREA(,RVVIPTR)                               1257
         MVI   BUFFER+151(@01),C' '                                1257
         MVC   BUFFER+152(104,@01),BUFFER+151(@01)                 1257
         MVC   BUFFER(151,@01),CPUID(CPUIDPTR)                     1257
*   RPLRCODE=RCZERO;                /* GOOD REASON CODE      @Z40LB66*/
         MVC   RPLRCODE(2,@02),@CB00747                            1258
*   RPLVRETC=RCZERO;                /* GOOD RC               @Z40LB66*/
         MVC   RPLVRETC(2,@02),@CB00747                            1259
*   RETURN;                         /*                       @Z40LB66*/
         B     @EL00016                                            1260
*   END READCPU;                    /*                       @Z40LB66*/
         B     @EL00016                                            1261
*                                                                  1262
*   /*****************************************************************/
*   /*                                                               */
*   /* THIS ROUTINE READS A BASE VOLUME RECORD DIRECTLY      @Y30LB26*/
*   /* FROM KEY PASSED IN REQUEST BLOCK                      @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1262
*BASEDIR:                           /*                       @Y30LB26*/
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
*                                                                  1262
BASEDIR  ST    @14,@SA00017                                        1262
*   /*****************************************************************/
*   /*                                                               */
*   /* GO RESERVE INVENTORY DATA SET SHARED                  @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1263
*   CALL RESSHARE;                  /* RESERVE INVENTORY SHR @Y30LB26*/
*                                                                  1263
         BAL   @14,RESSHARE                                        1263
*   /*****************************************************************/
*   /*                                                               */
*   /* SET UP TO READ BASE VOLUME RECORD                     @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1264
*   VOLKY=RVVOLUME;                 /* VOL TO BE READ        @Y30LB26*/
         MVC   VOLKY(6),RVVOLUME(RVVIPTR)                          1264
*   RPLVKEY=ADDR(VKEY);             /* ADDR OF KEY           @Y30LB26*/
         L     @04,RPLVPTR                                         1265
         LA    @02,VKEY                                            1265
         ST    @02,RPLVKEY(,@04)                                   1265
*   RPLVLOC=ON;                     /* LOCATE MODE           @Y30LB26*/
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB26*/
         OI    RPLVLOC(@04),B'11000000'                            1267
*   RPLVTYP=RPLVREAD;               /* READ RECORD           @Y30LB26*/
         MVI   RPLVTYP(@04),X'00'                                  1268
*   RESPECIFY                                                      1269
*     REG1 RESTRICTED;              /* RESTRICT REG1         @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR OF RPLV          @Y30LB26*/
         LR    REG1,@04                                            1270
*   CALL ICBVIO00;                  /* READ BASE RECORD      @Y30LB26*/
         L     @15,@CV00671                                        1271
         BALR  @14,@15                                             1271
*   RESPECIFY                                                      1272
*     REG1 UNRESTRICTED;            /* UNRESTRICT REG1       @Y30LB26*/
*                                                                  1272
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK RETURN CODE FROM I/O PROCESSOR                  @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1273
*   IF RPLVRETC^=RCZERO THEN        /* CHECK RC              @Y30LB26*/
         L     @04,RPLVPTR                                         1273
         CLC   RPLVRETC(2,@04),@CB00747                            1273
         BE    @RF01273                                            1273
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* SAVE REASON CODES     @Y30LB26*/
         BAL   @14,ERREXIT                                         1275
*       RETURN;                     /*                       @Y30LB26*/
@EL00017 DS    0H                                                  1276
@EF00017 DS    0H                                                  1276
@ER00017 L     @14,@SA00017                                        1276
         BR    @14                                                 1276
*     END;                          /*                       @Y30LB26*/
*                                                                  1277
*   /*****************************************************************/
*   /*                                                               */
*   /* SET UP ADDRESSING TO BASE VOL REC                     @Y30LB26*/
*   /* AND MAKE ANY TEST CALLED FOR ON RECORD                @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1278
*   BASEVPTR=RPLVBUF;               /* MAPPING ON RECORD     @Y30LB26*/
@RF01273 L     @04,RPLVPTR                                         1278
         L     @04,RPLVBUF(,@04)                                   1278
         ST    @04,BASEVPTR                                        1278
*   CALL TEST;                      /* TEST RECORD           @Y30LB26*/
         BAL   @14,TEST                                            1279
*   IF RPLVRETC^=RCZERO THEN        /* CHECK RC              @Y30LB26*/
         L     @04,RPLVPTR                                         1280
         CLC   RPLVRETC(2,@04),@CB00747                            1280
         BE    @RF01280                                            1280
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* SAVE CODES            @Y30LB26*/
         BAL   @14,ERREXIT                                         1282
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00017                                            1283
*     END;                          /*                       @Y30LB26*/
*                                                                  1284
*   /*****************************************************************/
*   /*                                                               */
*   /* GET CORE IN SUBPOOL TO MOVE RECORD INTO               @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1285
*   CALL GETBUF;                    /* GET BUFFER FOR REC    @Y30LB26*/
@RF01280 BAL   @14,GETBUF                                          1285
*   IF RPLVRETC^=RCZERO THEN        /* CK RETURN             @Y30LB26*/
         L     @04,RPLVPTR                                         1286
         CLC   RPLVRETC(2,@04),@CB00747                            1286
         BNE   @RT01286                                            1286
*     RETURN;                       /*                       @Y30LB26*/
*   BUFFER=BASEV;                   /* MOVE REC TO BUF       @Y30LB26*/
         L     @02,RVVAREA(,RVVIPTR)                               1288
         MVI   BUFFER+224(@02),C' '                                1288
         MVC   BUFFER+225(31,@02),BUFFER+224(@02)                  1288
         L     @01,BASEVPTR                                        1288
         MVC   BUFFER(224,@02),BASEV(@01)                          1288
*   RPLRCODE=RCZERO;                /* GOOD REASON CODE      @Y30LB26*/
         MVC   RPLRCODE(2,@04),@CB00747                            1289
*   RPLVRETC=RCZERO;                /* GOOD RC               @Y30LB26*/
         MVC   RPLVRETC(2,@04),@CB00747                            1290
*   RETURN;                         /*                       @Y30LB26*/
         B     @EL00017                                            1291
*   END BASEDIR;                    /*                       @Y30LB26*/
         B     @EL00017                                            1292
*                                                                  1293
*   /*****************************************************************/
*   /*                                                               */
*   /* SUBROUTINE READS NEXT BASE VOLUME RECORD              @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1293
*BASENREC:                          /*                       @Y30LB26*/
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
*                                                                  1293
BASENREC ST    @14,@SA00018                                        1293
*   /*****************************************************************/
*   /*                                                               */
*   /* GO RESERVE INVENTORY DATA SET SHARED                  @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1294
*   CALL RESSHARE;                  /* RESERVE INVENTORY SHR @Y30LB26*/
*                                                                  1294
         BAL   @14,RESSHARE                                        1294
*   /*****************************************************************/
*   /*                                                               */
*   /* DETERMINE IF READING FOR FIRST BASE VOLUME            @Y30LB26*/
*   /* RECORD. IF SO SET VOL TO ZERO AND PROCESS             @Y30LB26*/
*   /* LIKE A REGULAR READ NEXT                              @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1295
*   IF RVVSVOL=OFF THEN             /* VOLUME NAME SPECIF    @Y30LB26*/
         TM    RVVSVOL(RVVIPTR),B'00000001'                        1295
         BNZ   @RF01295                                            1295
*     VOLKY=ZEROCHAR;               /* SET VOL KEY ZERO      @Y30LB26*/
         MVC   VOLKY(6),ZEROCHAR                                   1296
*   ELSE                            /*                       @Y30LB26*/
*     VOLKY=RVVOLUME;               /* VOL TO READ           @Y30LB26*/
*                                                                  1297
         B     @RC01295                                            1297
@RF01295 MVC   VOLKY(6),RVVOLUME(RVVIPTR)                          1297
*   /*****************************************************************/
*   /*                                                               */
*   /* START OUTSIDE READ NEXT LOOP                          @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1298
*   DO WHILE I=I;                   /* BIG LOOP              @Y30LB26*/
*                                                                  1298
@RC01295 B     @DE01298                                            1298
@DL01298 DS    0H                                                  1299
*     /***************************************************************/
*     /*                                                             */
*     /* SET KEY TO SKIP AROUND COPIES AND READ NEXT BASE    @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  1299
*     ARITHBAS=VKEY(12:13);         /* MOVE EXIST KEY ID     @Y30LB26*/
         MVC   ARITHBAS(2),VKEY+11                                 1299
*     BASEID=BASEID+256;            /* GET TO NEXT BASE      @Y30LB26*/
         LA    @04,256                                             1300
         LH    @02,BASEID                                          1300
         N     @02,@CF01186                                        1300
         ALR   @04,@02                                             1300
         STH   @04,BASEID                                          1300
*     VKEY(12:13)=ARITHBAS;         /* RESULT BACK TO KEY    @Y30LB26*/
         MVC   VKEY+11(2),ARITHBAS                                 1301
*     RPLVKEY=ADDR(VKEY);           /* ADDR OF KEY           @Y30LB26*/
         L     @04,RPLVPTR                                         1302
         LA    @02,VKEY                                            1302
         ST    @02,RPLVKEY(,@04)                                   1302
*     RPLVLOC=ON;                   /* LOCATE MODE           @Y30LB26*/
*     RPLVDIR=ON;                   /* READ DIRECT           @Y30LB26*/
         OI    RPLVLOC(@04),B'11000000'                            1304
*     RPLVTYP=RPLVREAD;             /* READ RECORD           @Y30LB26*/
         MVI   RPLVTYP(@04),X'00'                                  1305
*     RPLVKGE=ON;                   /* READ >=               @Y30LB26*/
         OI    RPLVKGE(@04),B'00000100'                            1306
*     RESPECIFY                                                    1307
*       REG1 RSTD;                  /* RESTRICT REG1         @Y30LB26*/
*     REG1=RPLVPTR;                 /* ADDR RPLV             @Y30LB26*/
         LR    REG1,@04                                            1308
*     CALL ICBVIO00;                /* READ NEXT BASE        @Y30LB26*/
         L     @15,@CV00671                                        1309
         BALR  @14,@15                                             1309
*     RESPECIFY                                                    1310
*       REG1 UNRSTD;                /* UNRESTRICT REG1       @Y30LB26*/
*                                                                  1310
*     /***************************************************************/
*     /*                                                             */
*     /* CHECK RETURN CODE                                   @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  1311
*     IF RPLVRETC^=RCZERO THEN      /* CHECK RC              @Y30LB26*/
         L     @04,RPLVPTR                                         1311
         CLC   RPLVRETC(2,@04),@CB00747                            1311
         BE    @RF01311                                            1311
*       DO;                         /*                       @Y30LB26*/
*                                                                  1312
*         /***********************************************************/
*         /*                                                         */
*         /* IF RECORDS READ BEFORE, THEN CHECK TYPE         @Y30LB26*/
*         /* OF RETURN FROM I/O PROCESSOR                    @Y30LB26*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  1313
*         IF LOOPSW=ON THEN         /* SEE READ RECS BEFORE  @Y30LB26*/
         TM    LOOPSW,B'10000000'                                  1313
         BNO   @RF01313                                            1313
*           DO;                     /*                       @Y30LB26*/
*                                                                  1314
*             /*******************************************************/
*             /*                                                     */
*             /* IF RECORDS READ AND AT END OF DATA SET,     @Y30LB26*/
*             /* THEN SET RETURN CODE TO TEST NOT MET        @Y30LB26*/
*             /*                                                     */
*             /*******************************************************/
*                                                                  1315
*             IF RPLRCODE=NORECRC THEN/* END OF DATA ?       @Y30LB26*/
         CLC   RPLRCODE(2,@04),@CB00789                            1315
         BNE   @RF01315                                            1315
*               DO;                 /*                       @Y30LB26*/
*                 RPLRCODE=TNOTMET; /* INDIC TEST MADE       @Y30LB26*/
         MVC   RPLRCODE(2,@04),@CB00819                            1317
*                 RPLVRETC=FOUR;    /* INSURE RC FOUR        @Y30LB26*/
         MVC   RPLVRETC(2,@04),@CB00749                            1318
*                 CALL ERREXIT;     /* SAVE RET CODE         @Y30LB26*/
         BAL   @14,ERREXIT                                         1319
*                 RETURN;           /*                       @Y30LB26*/
@EL00018 DS    0H                                                  1320
@EF00018 DS    0H                                                  1320
@ER00018 L     @14,@SA00018                                        1320
         BR    @14                                                 1320
*               END;                /*                       @Y30LB26*/
*                                                                  1321
*             /*******************************************************/
*             /*                                                     */
*             /* IF SOME OTHER RETURN CODE, THEN JUST        @Y30LB26*/
*             /* RETURN WITH IT                              @Y30LB26*/
*             /*                                                     */
*             /*******************************************************/
*                                                                  1322
*             ELSE                  /*                       #Y30LB26*/
*               DO;                 /*                       #Y30LB26*/
@RF01315 DS    0H                                                  1323
*                 CALL ERREXIT;     /* SAVE RET CODES        #Y30LB26*/
         BAL   @14,ERREXIT                                         1323
*                 RETURN;           /*                       #Y30LB26*/
         B     @EL00018                                            1324
*               END;                /*                       #Y30LB26*/
*           END;                    /*                       #Y30LB26*/
*                                                                  1326
*         /***********************************************************/
*         /*                                                         */
*         /* IF NO RECORDS WERE READ THEN JUST RETURN        @Y30LB26*/
*         /* WITH ORIGINAL RETURN CODES FROM I/O PROC        @Y30LB26*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  1327
*         ELSE                      /*                       #Y30LB26*/
*           DO;                     /*                       #Y30LB26*/
@RF01313 DS    0H                                                  1328
*             CALL ERREXIT;         /*                       #Y30LB26*/
         BAL   @14,ERREXIT                                         1328
*             RETURN;               /*                       #Y30LB26*/
         B     @EL00018                                            1329
*           END;                    /*                       #Y30LB26*/
*       END;                        /*                       #Y30LB26*/
*                                                                  1331
*     /***************************************************************/
*     /*                                                             */
*     /* CHECK TO SEE IF STILL A BASE VOLUME RECORD          #Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  1332
*     BASEVPTR=RPLVBUF;             /* ADDR REC JUST READ    #Y30LB26*/
@RF01311 L     @04,RPLVPTR                                         1332
         L     @04,RPLVBUF(,@04)                                   1332
         ST    @04,BASEVPTR                                        1332
*     IF BASEVKEY=VKY&              /*                       #Y30LB26*/
*         BASZERO=FIXZERO THEN      /* BASE VOL?             @Y30LB26*/
         CLC   BASEVKEY(5,@04),VKY                                 1333
         BNE   @RF01333                                            1333
         CLI   BASZERO(@04),0                                      1333
         BNE   @RF01333                                            1333
*       DO;                         /*                       @Y30LB26*/
*                                                                  1334
*         /***********************************************************/
*         /*                                                         */
*         /* GO TEST RECORD SINCE IT IS A BASE VOLUME REC    @Y30LB26*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  1335
*         CALL TEST;                /* TEST BASE REC         @Y30LB26*/
         BAL   @14,TEST                                            1335
*         IF RPLVRETC=RCZERO THEN   /* TEST MET?             @Y30LB26*/
         L     @04,RPLVPTR                                         1336
         CLC   RPLVRETC(2,@04),@CB00747                            1336
         BNE   @RF01336                                            1336
*           DO;                     /*                       @Y30LB26*/
*                                                                  1337
*             /*******************************************************/
*             /*                                                     */
*             /* IF PASSED TEST, GET BUFFER AND MOVE IN REC  @Y30LB26*/
*             /*                                                     */
*             /*******************************************************/
*                                                                  1338
*             CALL GETBUF;          /* GET SUBPOOL BUFFER    @Y30LB26*/
         BAL   @14,GETBUF                                          1338
*             IF RPLVRETC^=RCZERO THEN/* CK RETURN           @Y30LB26*/
         L     @04,RPLVPTR                                         1339
         CLC   RPLVRETC(2,@04),@CB00747                            1339
         BNE   @RT01339                                            1339
*               RETURN;             /*                       @Y30LB26*/
*             BUFFER=BASEV;         /* MOVE REC TO BUFFER    @Y30LB26*/
         L     @02,RVVAREA(,RVVIPTR)                               1341
         MVI   BUFFER+224(@02),C' '                                1341
         MVC   BUFFER+225(31,@02),BUFFER+224(@02)                  1341
         L     @01,BASEVPTR                                        1341
         MVC   BUFFER(224,@02),BASEV(@01)                          1341
*             RPLVRETC=RCZERO;      /* GOOD RC               @Y30LB26*/
         MVC   RPLVRETC(2,@04),@CB00747                            1342
*             RPLRCODE=RCZERO;      /* GOOD REASON CODE      @Y30LB26*/
         MVC   RPLRCODE(2,@04),@CB00747                            1343
*             RETURN;               /*                       @Y30LB26*/
         B     @EL00018                                            1344
*           END;                    /*                       @Y30LB26*/
*         ELSE                      /*                       @Y30LB26*/
*                                                                  1346
*           /*********************************************************/
*           /*                                                       */
*           /* RESET KEY TO VOL JUST READ SO WHEN ADD        @Y30LB26*/
*           /* 256 TO KEY IT IS SET TO READ NEXT BASE VOLUME @Y30LB26*/
*           /* ALSO INDICATE LOOPING HAS OCCURED             @Y30LB26*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1346
*           DO;                     /*                       @Y30LB26*/
@RF01336 DS    0H                                                  1347
*             VKEY=BASNAME;         /* SET TO ADD 256        @Y30LB26*/
         L     @04,BASEVPTR                                        1347
         MVC   VKEY(13),BASNAME(@04)                               1347
*             LOOPSW=ON;            /* INDICATE LOOPING      @Y30LB26*/
         OI    LOOPSW,B'10000000'                                  1348
*           END;                    /*                       @Y30LB26*/
*       END;                        /*                       @Y30LB26*/
*     ELSE                          /*                       @Y30LB26*/
*       DO;                         /*                       @Y30LB26*/
*                                                                  1351
         B     @RC01333                                            1351
@RF01333 DS    0H                                                  1352
*         /***********************************************************/
*         /*                                                         */
*         /* IF THIS IS A COPY VOLUME OR COPY PLACE          @ZA13504*/
*         /* HOLDER, THEN GET NEXT BASE VOLUME RECORD        @ZA13504*/
*         /* FROM INVENTORY.                                 @ZA13504*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  1352
*         IF BASEVKEY=VKY THEN      /* IS THIS A BASE RECORD @ZA13504*/
         L     @04,BASEVPTR                                        1352
         CLC   BASEVKEY(5,@04),VKY                                 1352
         BNE   @RF01352                                            1352
*           DO;                     /* YES                   @ZA13504*/
*             VKEY=BASNAME;         /* SET TO AD 256 TO KEY  @ZA13504*/
         MVC   VKEY(13),BASNAME(@04)                               1354
*             VIDKY=FIXZERO;        /* ZERO KEY              @ZA13504*/
         MVI   VIDKY,X'00'                                         1355
*           END;                    /*                       @ZA13504*/
*         ELSE                      /* NO, NOT BASE RECORD   @ZA13504*/
*           DO;                     /*                       @ZA13504*/
*                                                                  1357
         B     @RC01352                                            1357
@RF01352 DS    0H                                                  1358
*             /*******************************************************/
*             /*                                                     */
*             /* IF LOOPING HAS OCCURED, SET RETURN CODE     @Y30LB26*/
*             /* INDICATING TEST NOT MET RATHER THAN         @Y30LB26*/
*             /* RECORD NOT FOUND                            @Y30LB26*/
*             /*                                                     */
*             /*******************************************************/
*                                                                  1358
*             IF LOOPSW=ON THEN     /* CHECK FOR LOOPING     @Y30LB26*/
         TM    LOOPSW,B'10000000'                                  1358
         BNO   @RF01358                                            1358
*               DO;                 /*                       @Y30LB26*/
*                 RPLVRETC=FOUR;    /* BAD RC                @Y30LB26*/
         L     @02,RPLVPTR                                         1360
         MVC   RPLVRETC(2,@02),@CB00749                            1360
*                 RPLRCODE=TNOTMET; /* TEST NOT MET          @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00819                            1361
*                 CALL ERREXIT;     /* FREE INVENTORY        @Y30LB26*/
         BAL   @14,ERREXIT                                         1362
*                 RETURN;           /*                       @Y30LB26*/
         B     @EL00018                                            1363
*               END;                /*                       @Y30LB26*/
*             ELSE                  /*                       @Y30LB26*/
*                                                                  1365
*               /*****************************************************/
*               /*                                                   */
*               /* IF LOOPING HAS NOT OCCURED,SET RETURN CODE        */
*               /*                                           @Y30LB26*/
*               /* TO INDICATE RECORD WAS NOT FOUND          @Y30LB26*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  1365
*               DO;                 /*                       @Y30LB26*/
@RF01358 DS    0H                                                  1366
*                 RPLVRETC=FOUR;    /* BAD RC                @Y30LB26*/
         L     @02,RPLVPTR                                         1366
         MVC   RPLVRETC(2,@02),@CB00749                            1366
*                 RPLRCODE=NORECRC; /* RECORD NOT FOUND      @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00789                            1367
*                 CALL ERREXIT;     /* FREE INVENTORY        @Y30LB26*/
         BAL   @14,ERREXIT                                         1368
*                 RETURN;           /*                       @Y30LB26*/
         B     @EL00018                                            1369
*               END;                /*                       @Y30LB26*/
*           END;                    /*                       @Y30LB26*/
*       END;                        /*                       @XA15558*/
@RC01352 DS    0H                                                  1373
*   END;                            /*                       @Y30LB26*/
@RC01333 DS    0H                                                  1373
@DE01298 CLC   I(1),I                                              1373
         BE    @DL01298                                            1373
*   END BASENREC;                   /*                       @Y30LB26*/
         B     @EL00018                                            1374
*                                                                  1375
*   /*****************************************************************/
*   /*                                                               */
*   /* THIS SUBROUTINE READS BASE VOLUME RECORDS IN          @Y30LB26*/
*   /* A GIVEN GROUP                                         @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1375
*BASECHN:                           /*                       @Y30LB26*/
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
*                                                                  1375
BASECHN  ST    @14,@SA00019                                        1375
*   /*****************************************************************/
*   /*                                                               */
*   /* GO RESERVE INVENTORY DATA SET SHARED                  @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1376
*   CALL RESSHARE;                  /* RESERVE INVENTORY SHR @Y30LB26*/
*                                                                  1376
         BAL   @14,RESSHARE                                        1376
*   /*****************************************************************/
*   /*                                                               */
*   /* IF VOL NOT SPECIFIED, THEN WANT FIRST                 @Y30LB26*/
*   /* NON-GROUPED BASE VOLUME RECORD, SO                    @Y30LB26*/
*   /* CALL SUBROUTINE TO GET IT                             @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1377
*   IF RVVSVOL=OFF THEN             /* VOL NOT SPECIFIED ?   @Y30LB26*/
         TM    RVVSVOL(RVVIPTR),B'00000001'                        1377
         BNZ   @RF01377                                            1377
*     DO;                           /*                       @Y30LB26*/
*       CALL FSTNGBAS;              /* GO GET FIRST NON-GRP  @Y30LB26*/
         BAL   @14,FSTNGBAS                                        1379
*       IF RPLVRETC=RCZERO THEN     /* GOOD RETURN           @Y30LB26*/
         L     @04,RPLVPTR                                         1380
         CLC   RPLVRETC(2,@04),@CB00747                            1380
         BE    @RT01380                                            1380
*         RETURN;                   /*                       @Y30LB26*/
*       ELSE                        /*                       @Y30LB26*/
*         IF RPLRCODE^=TNOTMET THEN /* CK FOR TEST NOT MET   @Y30LB26*/
         CLC   RPLRCODE(2,@04),@CB00819                            1382
         BNE   @RT01382                                            1382
*           RETURN;                 /*                       @Y30LB26*/
*         ELSE                      /* OTHER REASON          @ZM31062*/
*           DO;                     /*                       @ZM31062*/
*             IF BASLAST=ON THEN    /* LAST VOLUME           @ZM31062*/
         L     @04,BASEVPTR                                        1385
         TM    BASLAST(@04),B'00001000'                            1385
         BNO   @RF01385                                            1385
*               DO;                 /*                       @ZM31062*/
*                 CALL ERREXIT;     /* SAVE REASON CODES     @ZM31062*/
         BAL   @14,ERREXIT                                         1387
*                 RETURN;           /* RETURN TO CALLER      @ZM31062*/
@EL00019 DS    0H                                                  1388
@EF00019 DS    0H                                                  1388
@ER00019 L     @14,@SA00019                                        1388
         BR    @14                                                 1388
*               END;                /*                       @ZM31062*/
*             ELSE                  /*                       @ZM31062*/
*               VOLKY=BASNEXTV;     /* SET PTR FOR NEXT VOL  @ZM31062*/
@RF01385 L     @04,BASEVPTR                                        1390
         MVC   VOLKY(6),BASNEXTV(@04)                              1390
*           END;                    /*                       @ZM31062*/
*     END;                          /*                       @Y30LB26*/
*                                                                  1392
*   /*****************************************************************/
*   /*                                                               */
*   /* PUT VOLUME NAME IN KEY AND START READ CHAIN LOOP      @Y30LB26*/
*   /* SINCE VOLUMN NAME WAS SPECIFIED IN REQUEST BLOCK      @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1393
*   ELSE                            /*                       @Y30LB26*/
*     VOLKY=RVVOLUME;               /* VOL NAME TO READ      @Y30LB26*/
*                                                                  1393
         B     @RC01377                                            1393
@RF01377 MVC   VOLKY(6),RVVOLUME(RVVIPTR)                          1393
*   /*****************************************************************/
*   /*                                                               */
*   /* START GOING THRU EITHER GROUPED OR NON-GROUPED        @Y30LB26*/
*   /* CHAIN                                                 @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1394
*   DO WHILE I=I;                   /* BIG LOOP              @Y30LB26*/
@RC01377 B     @DE01394                                            1394
@DL01394 DS    0H                                                  1395
*     RPLVKEY=ADDR(VKEY);           /* ADDR OF KEY           @Y30LB26*/
         L     @04,RPLVPTR                                         1395
         LA    @02,VKEY                                            1395
         ST    @02,RPLVKEY(,@04)                                   1395
*     RPLVLOC=ON;                   /* LOCATE MODE           @Y30LB26*/
*     RPLVDIR=ON;                   /* READ DIRECT           @Y30LB26*/
         OI    RPLVLOC(@04),B'11000000'                            1397
*     RPLVTYP=RPLVREAD;             /* READ RECORD           @Y30LB26*/
         MVI   RPLVTYP(@04),X'00'                                  1398
*     RESPECIFY                                                    1399
*       REG1 RSTD;                  /* RESTRICT REG1         @Y30LB26*/
*     REG1=RPLVPTR;                 /* ADDR OF RPLV          @Y30LB26*/
         LR    REG1,@04                                            1400
*     CALL ICBVIO00;                /* READ BASE REC         @Y30LB26*/
         L     @15,@CV00671                                        1401
         BALR  @14,@15                                             1401
*     RESPECIFY                                                    1402
*       REG1 UNRSTD;                /* UNRESTRICT REG1       @Y30LB26*/
*                                                                  1402
*     /***************************************************************/
*     /*                                                             */
*     /* CHECK ON RETURN CODE                                @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  1403
*     IF RPLVRETC^=RCZERO THEN      /* CHECK RC              @Y30LB26*/
         L     @04,RPLVPTR                                         1403
         CLC   RPLVRETC(2,@04),@CB00747                            1403
         BE    @RF01403                                            1403
*       DO;                         /*                       @Y30LB26*/
*         CALL ERREXIT;             /* SAVE REASON CODE      @Y30LB26*/
         BAL   @14,ERREXIT                                         1405
*         RETURN;                   /*                       @Y30LB26*/
         B     @EL00019                                            1406
*       END;                        /*                       @Y30LB26*/
*                                                                  1407
*     /***************************************************************/
*     /*                                                             */
*     /* GET ADDRESS OF BASE RECORD, CHECK IF GROUPED CHAIN  @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  1408
*     BASEVPTR=RPLVBUF;             /* ADDR OF RECORD        @Y30LB26*/
@RF01403 L     @04,RPLVPTR                                         1408
         L     @02,RPLVBUF(,@04)                                   1408
         ST    @02,BASEVPTR                                        1408
*     IF RVVGPVOL=ON THEN           /* GROUPED VOL CHAIN?    @Y30LB26*/
         TM    RVVGPVOL(RVVIPTR),B'10000000'                       1409
         BNO   @RF01409                                            1409
*       DO;                         /*                       @Y30LB26*/
*                                                                  1410
*         /***********************************************************/
*         /*                                                         */
*         /* CHECK TO SEE IF GROUP MATCHES ONE GIVEN         @Y30LB26*/
*         /* IN REQUEST BLOCK                                @Y30LB26*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  1411
*         IF BASGROUP^=RVVGROUP THEN/* GROUPS MATCH?         @Y30LB26*/
         CLC   BASGROUP(8,@02),RVVGROUP(RVVIPTR)                   1411
         BE    @RF01411                                            1411
*           DO;                     /*                       @Y30LB26*/
*             RPLVRETC=FOUR;        /* BAD RC                @Y30LB26*/
         MVC   RPLVRETC(2,@04),@CB00749                            1413
*             RPLRCODE=BADCHAIN;    /* BREAK IN CHAIN        @Y30LB26*/
         MVC   RPLRCODE(2,@04),@CB00821                            1414
*             CALL ERREXIT;         /* SAVE REASON CODES     @Y30LB26*/
         BAL   @14,ERREXIT                                         1415
*             RETURN;               /*                       @Y30LB26*/
         B     @EL00019                                            1416
*           END;                    /*                       @Y30LB26*/
*       END;                        /*                       @Y30LB26*/
*     ELSE                          /*                       @Y30LB26*/
*                                                                  1419
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK IF NON-GROUPED VOLUME                       @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1419
*       IF RVVNGVOL=ON THEN         /* NONGROUPED VOLUME?    @Y30LB26*/
         B     @RC01409                                            1419
@RF01409 TM    RVVNGVOL(RVVIPTR),B'01000000'                       1419
         BNO   @RF01419                                            1419
*         DO;                       /*                       @Y30LB26*/
*                                                                  1420
*           /*********************************************************/
*           /*                                                       */
*           /* BE SURE BASE RECORD INDICATES NON-GROUPED     @Y30LB26*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1421
*           IF BASGROUP^=BLANK8 THEN/* CHECK NONGROUPED      @Y30LB26*/
         L     @04,BASEVPTR                                        1421
         CLC   BASGROUP(8,@04),BLANK8                              1421
         BE    @RF01421                                            1421
*             DO;                   /*                       @Y30LB26*/
*               RPLVRETC=FOUR;      /* BAD RC                @Y30LB26*/
         L     @02,RPLVPTR                                         1423
         MVC   RPLVRETC(2,@02),@CB00749                            1423
*               RPLRCODE=BADCHAIN;  /* BROKEN CHAIN          @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00821                            1424
*               CALL ERREXIT;       /* SAVE REASON CODES     @Y30LB26*/
         BAL   @14,ERREXIT                                         1425
*               RETURN;             /*                       @Y30LB26*/
         B     @EL00019                                            1426
*             END;                  /*                       @Y30LB26*/
*         END;                      /*                       @Y30LB26*/
*                                                                  1428
@RF01421 DS    0H                                                  1429
*     /***************************************************************/
*     /*                                                             */
*     /* GO MAKE ANY TEST REQUIRED ON BASE RECORD            @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  1429
*     CALL TEST;                    /* TEST RECORD           @Y30LB26*/
@RF01419 DS    0H                                                  1429
@RC01409 BAL   @14,TEST                                            1429
*     IF RPLVRETC^=RCZERO THEN      /* CHECK RC              @Y30LB26*/
         L     @04,RPLVPTR                                         1430
         CLC   RPLVRETC(2,@04),@CB00747                            1430
         BE    @RF01430                                            1430
*       DO;                         /*                       @Y30LB26*/
*                                                                  1431
*         /***********************************************************/
*         /*                                                         */
*         /* IF TEST NOT MET, INDICATE ATTEMPT MADE          @Y30LB26*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  1432
*         LOOPSW=ON;                /* INDICATE LOOPING      @Y30LB26*/
*                                                                  1432
         OI    LOOPSW,B'10000000'                                  1432
*         /***********************************************************/
*         /*                                                         */
*         /* IF AT END OF CHAIN, SET REASON CODE FOR         @Y30LB26*/
*         /* TEST NOT MET AND RETURN                         @Y30LB26*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  1433
*         IF BASLAST=ON THEN        /* LAST IN CHAIN?        @Y30LB26*/
         L     @02,BASEVPTR                                        1433
         TM    BASLAST(@02),B'00001000'                            1433
         BNO   @RF01433                                            1433
*           DO;                     /*                       @Y30LB26*/
*             RPLRCODE=TNOTMET;     /* TEST NOT MET          @Y30LB26*/
         MVC   RPLRCODE(2,@04),@CB00819                            1435
*             RPLVRETC=FOUR;        /* BAD RC                @Y30LB26*/
         MVC   RPLVRETC(2,@04),@CB00749                            1436
*             CALL ERREXIT;         /* SAVE REASON CODES     @Y30LB26*/
         BAL   @14,ERREXIT                                         1437
*             RETURN;               /*                       @Y30LB26*/
         B     @EL00019                                            1438
*           END;                    /*                       @Y30LB26*/
*         ELSE                      /*                       @Y30LB26*/
*                                                                  1440
*           /*********************************************************/
*           /*                                                       */
*           /* END OF CHAIN NOT REACHED, SO SET KEY          @Y30LB26*/
*           /* TO GET NEXT BASE VOL REC                      @Y30LB26*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1440
*           VOLKY=BASNEXTV;         /* SET READ NEXT IN CHN  @Y30LB26*/
@RF01433 L     @04,BASEVPTR                                        1440
         MVC   VOLKY(6),BASNEXTV(@04)                              1440
*       END;                        /*                       @Y30LB26*/
*     ELSE                          /*                       @Y30LB26*/
*                                                                  1442
*       /*************************************************************/
*       /*                                                           */
*       /* IF TEST MET, GET BUFFER AND RETURN RECORD         @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1442
*       DO;                         /*                       @Y30LB26*/
         B     @RC01430                                            1442
@RF01430 DS    0H                                                  1443
*         CALL GETBUF;              /* GET CORE              @Y30LB26*/
         BAL   @14,GETBUF                                          1443
*         IF RPLVRETC^=RCZERO THEN  /* CK RETURN             @Y30LB26*/
         L     @04,RPLVPTR                                         1444
         CLC   RPLVRETC(2,@04),@CB00747                            1444
         BNE   @RT01444                                            1444
*           RETURN;                 /*                       @Y30LB26*/
*         BUFFER=BASEV;             /* MOVE IN GOOD REC      @Y30LB26*/
         L     @02,RVVAREA(,RVVIPTR)                               1446
         MVI   BUFFER+224(@02),C' '                                1446
         MVC   BUFFER+225(31,@02),BUFFER+224(@02)                  1446
         L     @01,BASEVPTR                                        1446
         MVC   BUFFER(224,@02),BASEV(@01)                          1446
*         RPLVRETC=RCZERO;          /* GOOD RC               @Y30LB26*/
         MVC   RPLVRETC(2,@04),@CB00747                            1447
*         RPLRCODE=RCZERO;          /* GOOD REASON CODE      @Y30LB26*/
         MVC   RPLRCODE(2,@04),@CB00747                            1448
*         RETURN;                   /*                       @Y30LB26*/
         B     @EL00019                                            1449
*       END;                        /*                       @Y30LB26*/
*   END;                            /*                       @Y30LB26*/
@RC01430 DS    0H                                                  1451
@DE01394 CLC   I(1),I                                              1451
         BE    @DL01394                                            1451
*   END BASECHN;                    /*                       @Y30LB26*/
         B     @EL00019                                            1452
*                                                                  1453
*   /*****************************************************************/
*   /*                                                               */
*   /* ROUTINE GETS THE FIRST BASE VOLUME RECORD IN          @Y30LB26*/
*   /* THE NON-GROUPED CATAGORY                              @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1453
*FSTNGBAS:                                                         1453
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
*                                                                  1453
FSTNGBAS ST    @14,@SA00020                                        1453
*   /*****************************************************************/
*   /*                                                               */
*   /* SET UP TO READ THE NON-GROUPED VOL HEADER REC         @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1454
*   RPLVKEY=ADDR(NGHEADER);         /* ADDR NON HEADER KEY   @Y30LB26*/
         L     @04,RPLVPTR                                         1454
         LA    @02,NGHEADER                                        1454
         ST    @02,RPLVKEY(,@04)                                   1454
*   RPLVLOC=ON;                     /* LOCATE ONLY           @Y30LB26*/
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB26*/
         OI    RPLVLOC(@04),B'11000000'                            1456
*   RPLVTYP=RPLVREAD;               /* READ RECORD           @Y30LB26*/
         MVI   RPLVTYP(@04),X'00'                                  1457
*   RPLVUPD=OFF;                    /* READ ONLY ACCESS      @Y30LB26*/
         NI    RPLVUPD(@04),B'11111101'                            1458
*   RESPECIFY                                                      1459
*     REG1 RSTD;                    /* RESTRICT REG 1        @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR OF RPLV          @Y30LB26*/
         LR    REG1,@04                                            1460
*   CALL ICBVIO00;                  /* READ NON-GRP HEAD     @Y30LB26*/
         L     @15,@CV00671                                        1461
         BALR  @14,@15                                             1461
*   RESPECIFY                                                      1462
*     REG1 UNRSTD;                  /* FREE REG 1            @Y30LB26*/
*   IF RPLVRETC^=RCZERO THEN        /* CK RETURN CODE        @Y30LB26*/
         L     @04,RPLVPTR                                         1463
         CLC   RPLVRETC(2,@04),@CB00747                            1463
         BE    @RF01463                                            1463
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* RELEASE INVEN         @Y30LB26*/
         BAL   @14,ERREXIT                                         1465
*       RETURN;                     /*                       @Y30LB26*/
@EL00020 DS    0H                                                  1466
@EF00020 DS    0H                                                  1466
@ER00020 L     @14,@SA00020                                        1466
         BR    @14                                                 1466
*     END;                          /*                       @Y30LB26*/
*                                                                  1467
*   /*****************************************************************/
*   /*                                                               */
*   /* GET ADDRESSING TO RECORD JUST READ                    @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1468
*   NGVRPTR=RPLVBUF;                /* ADDR RECORD           @Y30LB26*/
*                                                                  1468
@RF01463 L     @02,RPLVPTR                                         1468
         L     NGVRPTR,RPLVBUF(,@02)                               1468
*   /*****************************************************************/
*   /*                                                               */
*   /* BE SURE THERE IS AT LEAST ONE NON-GROUPED BASE        @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1469
*   IF NGVNOVOL=ZERO THEN           /* ANY VOLUMES ?         @Y30LB26*/
         LH    @15,NGVNOVOL(,NGVRPTR)                              1469
         LTR   @15,@15                                             1469
         BNZ   @RF01469                                            1469
*     DO;                           /*                       @Y30LB26*/
*       RPLVRETC=FOUR;              /* BAD RET CODE          @Y30LB26*/
         MVC   RPLVRETC(2,@02),@CB00749                            1471
*       RPLRCODE=NORECRC;           /* RECORD NOT FOUND      @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00789                            1472
*       CALL ERREXIT;               /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         1473
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00020                                            1474
*     END;                          /*                       @Y30LB26*/
*   VOLKY=NGVFVOL;                  /* VOL NAME TO KEY       @Y30LB26*/
*                                                                  1476
@RF01469 MVC   VOLKY(6),NGVFVOL(NGVRPTR)                           1476
*   /*****************************************************************/
*   /*                                                               */
*   /* SET UP TO READ THE FIRST NON-GROUPED BASE VOLUME      @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1477
*   RPLVKEY=ADDR(VKEY);             /* ADDR KEY              @Y30LB26*/
         L     @04,RPLVPTR                                         1477
         LA    @02,VKEY                                            1477
         ST    @02,RPLVKEY(,@04)                                   1477
*   RPLVLOC=ON;                     /* NOT LOCATE            @Y30LB26*/
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB26*/
         OI    RPLVLOC(@04),B'11000000'                            1479
*   RPLVTYP=RPLVREAD;               /* READ BASE VOLUME      @Y30LB26*/
         MVI   RPLVTYP(@04),X'00'                                  1480
*   RPLVUPD=OFF;                    /* NOT FOR UPDATE        @Y30LB26*/
         NI    RPLVUPD(@04),B'11111101'                            1481
*   RESPECIFY                                                      1482
*     REG1 RSTD;                    /* RESTRICT REG 1        @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR OF RPLV          @Y30LB26*/
         LR    REG1,@04                                            1483
*   CALL ICBVIO00;                  /* READ BASE VOL REC     @Y30LB26*/
         L     @15,@CV00671                                        1484
         BALR  @14,@15                                             1484
*   RESPECIFY                                                      1485
*     REG1 UNRSTD;                  /* FREE REG 1            @Y30LB26*/
*                                                                  1485
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK ON RETURN FROM I/O                              @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1486
*   IF RPLVRETC^=RCZERO THEN        /* CK RETURN CODE        @Y30LB26*/
         L     @04,RPLVPTR                                         1486
         CLC   RPLVRETC(2,@04),@CB00747                            1486
         BE    @RF01486                                            1486
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* RELEASE INVEN         @Y30LB26*/
         BAL   @14,ERREXIT                                         1488
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00020                                            1489
*     END;                          /*                       @Y30LB26*/
*                                                                  1490
*   /*****************************************************************/
*   /*                                                               */
*   /* GET ADDR OF BASE RECORD AND CALL TEST TO SEE IF       @Y30LB26*/
*   /* RECORD CAN MEET TESTS. IF IT CAN RETURN IT            @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1491
*   BASEVPTR=RPLVBUF;               /* ADDR REC JUST READ    @Y30LB26*/
@RF01486 L     @04,RPLVPTR                                         1491
         L     @04,RPLVBUF(,@04)                                   1491
         ST    @04,BASEVPTR                                        1491
*   CALL TEST;                      /* SEE IF BASE REC MEETS @Y30LB26*/
         BAL   @14,TEST                                            1492
*   IF RPLVRETC^=RCZERO THEN        /* CK RETURN             @Y30LB26*/
*                                                                  1493
         L     @04,RPLVPTR                                         1493
         CLC   RPLVRETC(2,@04),@CB00747                            1493
         BNE   @RT01493                                            1493
*     /***************************************************************/
*     /*                                                             */
*     /* IF RECORD DID NOT MEET TEST,                        @Y30LB26*/
*     /* RETURN TO BASE CHAIN PROCEDURE WHICH WILL CONTINUE  @Y30LB26*/
*     /* UNTIL A RECORD IS FOUND THAT MEETS TEST             @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  1494
*     RETURN;                       /* RETURN TO CALLER      @ZM31062*/
*   ELSE                            /*                       #Y30LB26*/
*                                                                  1495
*     /***************************************************************/
*     /*                                                             */
*     /* IF TEST MET, GET BUFFER AND RETURN RECORD           #Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  1495
*     DO;                           /*                       @Y30LB26*/
*       CALL GETBUF;                /* GET CORE              #Y30LB26*/
         BAL   @14,GETBUF                                          1496
*       IF RPLVRETC^=RCZERO THEN    /* CK RETURN CODE        #Y30LB26*/
         L     @04,RPLVPTR                                         1497
         CLC   RPLVRETC(2,@04),@CB00747                            1497
         BNE   @RT01497                                            1497
*         RETURN;                   /* RETURN TO CALLER      #Y30LB26*/
*       BUFFER=BASEV;               /* MOVE IN GOOD REC      #Y30LB26*/
         L     @02,RVVAREA(,RVVIPTR)                               1499
         MVI   BUFFER+224(@02),C' '                                1499
         MVC   BUFFER+225(31,@02),BUFFER+224(@02)                  1499
         L     @01,BASEVPTR                                        1499
         MVC   BUFFER(224,@02),BASEV(@01)                          1499
*       RPLVRETC=RCZERO;            /* GOOD RC               #Y30LB26*/
         MVC   RPLVRETC(2,@04),@CB00747                            1500
*       RPLRCODE=RCZERO;            /* GOOD REASON CODE      #Y30LB26*/
         MVC   RPLRCODE(2,@04),@CB00747                            1501
*     END;                          /*                       #Y30LB26*/
*   RETURN;                         /*                       #Y30LB26*/
         B     @EL00020                                            1503
*   END FSTNGBAS;                   /*                       #Y30LB26*/
         B     @EL00020                                            1504
*                                                                  1505
*   /*****************************************************************/
*   /*                                                               */
*   /* ROUTINE READS DIRECT FOR GROUP RECORD                 #Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1505
*GRPDIR:                            /*                       #Y30LB26*/
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
*                                                                  1505
GRPDIR   ST    @14,@SA00021                                        1505
*   /*****************************************************************/
*   /*                                                               */
*   /* GO RESERVE INVENTORY DATA SET SHARED                  #Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1506
*   CALL RESSHARE;                  /* RESERVE INVENTORY SHR #Y30LB26*/
*                                                                  1506
         BAL   @14,RESSHARE                                        1506
*   /*****************************************************************/
*   /*                                                               */
*   /* SET UP TO READ DIRECT GROUP RECORD                    #Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1507
*   GROUPKY=RVVGROUP;               /* GROUP NAME            #Y30LB26*/
         MVC   GROUPKY(8),RVVGROUP(RVVIPTR)                        1507
*   RPLVKEY=ADDR(GKEY);             /* ADDR KEY              #Y30LB26*/
         L     @04,RPLVPTR                                         1508
         LA    @02,GKEY                                            1508
         ST    @02,RPLVKEY(,@04)                                   1508
*   RPLVLOC=ON;                     /* LOCATE MODE           #Y30LB26*/
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB26*/
         OI    RPLVLOC(@04),B'11000000'                            1510
*   RPLVTYP=RPLVREAD;               /* DO A READ             @Y30LB26*/
         MVI   RPLVTYP(@04),X'00'                                  1511
*   RESPECIFY                                                      1512
*     REG1 RSTD;                    /* RESTRICT REG1         @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR OF RPLV          @Y30LB26*/
         LR    REG1,@04                                            1513
*   CALL ICBVIO00;                  /* READ GROUP RECORD     @Y30LB26*/
         L     @15,@CV00671                                        1514
         BALR  @14,@15                                             1514
*   RESPECIFY                                                      1515
*     REG1 UNRSTD;                  /* UNRESTRICT REG1       @Y30LB26*/
*                                                                  1515
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK REASON CODE                                     @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1516
*   IF RPLVRETC^=RCZERO THEN        /* CHECK RC              @Y30LB26*/
         L     @04,RPLVPTR                                         1516
         CLC   RPLVRETC(2,@04),@CB00747                            1516
         BE    @RF01516                                            1516
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* SAVE REASPM CPDES     @Y30LB26*/
         BAL   @14,ERREXIT                                         1518
*       RETURN;                     /*                       @Y30LB26*/
@EL00021 DS    0H                                                  1519
@EF00021 DS    0H                                                  1519
@ER00021 L     @14,@SA00021                                        1519
         BR    @14                                                 1519
*     END;                          /*                       @Y30LB26*/
*                                                                  1520
*   /*****************************************************************/
*   /*                                                               */
*   /* IF NO ERROR, SET UP ADDRESSING                        @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1521
*   GROUPPTR=RPLVBUF;               /* ADDR RECORD READ      @Y30LB26*/
*                                                                  1521
@RF01516 L     @04,RPLVPTR                                         1521
         L     @04,RPLVBUF(,@04)                                   1521
         ST    @04,GROUPPTR                                        1521
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THRESHOLD CHECKING IS REQUIRED, DO IT              @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1522
*   IF RVVTHOLD=ON THEN             /* THRESHOLD CHECKING?   @Y30LB26*/
         TM    RVVTHOLD(RVVIPTR),B'01000000'                       1522
         BNO   @RF01522                                            1522
*     DO;                           /*                       @Y30LB26*/
*                                                                  1523
*       /*************************************************************/
*       /*                                                           */
*       /* IF THRESHOLD HAS BEEN PASSED, GET BUFFER          @Y30LB26*/
*       /* AND RETURN RECORD                                 @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1524
*       IF GROFRESP<=GROSTRSH THEN  /* PAST THRESHOLD?       @Y30LB26*/
         L     @02,GROFRESP(,@04)                                  1524
         C     @02,GROSTRSH(,@04)                                  1524
         BH    @RF01524                                            1524
*         DO;                       /*                       @Y30LB26*/
*           CALL GETBUF;            /* GET CORE              @Y30LB26*/
         BAL   @14,GETBUF                                          1526
*           IF RPLVRETC^=RCZERO THEN/* CK RETURN             @Y30LB26*/
         L     @04,RPLVPTR                                         1527
         CLC   RPLVRETC(2,@04),@CB00747                            1527
         BNE   @RT01527                                            1527
*             RETURN;               /*                       @Y30LB26*/
*           BUFFER=GROUP;           /* MOVE IN RECORD        @Y30LB26*/
         L     @02,RVVAREA(,RVVIPTR)                               1529
         MVI   BUFFER+164(@02),C' '                                1529
         MVC   BUFFER+165(91,@02),BUFFER+164(@02)                  1529
         L     @01,GROUPPTR                                        1529
         MVC   BUFFER(164,@02),GROUP(@01)                          1529
*           RPLVRETC=RCZERO;        /* GOOD RC               @Y30LB26*/
         MVC   RPLVRETC(2,@04),@CB00747                            1530
*           RPLRCODE=RCZERO;        /* GOOD REASON CODE      @Y30LB26*/
         MVC   RPLRCODE(2,@04),@CB00747                            1531
*           RETURN;                 /*                       @Y30LB26*/
         B     @EL00021                                            1532
*         END;                      /*                       @Y30LB26*/
*       ELSE                        /*                       @Y30LB26*/
*                                                                  1534
*         /***********************************************************/
*         /*                                                         */
*         /* TEST NOT MET SO GIVE BAD RET CODE AND RETURN    @Y30LB26*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  1534
*         DO;                       /*                       @Y30LB26*/
@RF01524 DS    0H                                                  1535
*           RPLVRETC=FOUR;          /* BAD RC                @Y30LB26*/
         L     @02,RPLVPTR                                         1535
         MVC   RPLVRETC(2,@02),@CB00749                            1535
*           RPLRCODE=TNOTMET;       /* TEST NOT MET          @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00819                            1536
*           CALL ERREXIT;           /* SAVE REASON CODES     @Y30LB26*/
         BAL   @14,ERREXIT                                         1537
*           RETURN;                 /*                       @Y30LB26*/
         B     @EL00021                                            1538
*         END;                      /*                       @Y30LB26*/
*     END;                          /*                       @Y30LB26*/
*                                                                  1540
*   /*****************************************************************/
*   /*                                                               */
*   /* TEST WAS NOT MADE, SO JUST RETURN RECORD              @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1541
*   CALL GETBUF;                    /* GET CORE              @Y30LB26*/
@RF01522 BAL   @14,GETBUF                                          1541
*   IF RPLVRETC^=RCZERO THEN        /* CK RETURN             @Y30LB26*/
         L     @04,RPLVPTR                                         1542
         CLC   RPLVRETC(2,@04),@CB00747                            1542
         BNE   @RT01542                                            1542
*     RETURN;                       /*                       @Y30LB26*/
*   BUFFER=GROUP;                   /* MOVE IN RECORD        @Y30LB26*/
         L     @02,RVVAREA(,RVVIPTR)                               1544
         MVI   BUFFER+164(@02),C' '                                1544
         MVC   BUFFER+165(91,@02),BUFFER+164(@02)                  1544
         L     @01,GROUPPTR                                        1544
         MVC   BUFFER(164,@02),GROUP(@01)                          1544
*   RPLVRETC=RCZERO;                /* GOOD RC               @Y30LB26*/
         MVC   RPLVRETC(2,@04),@CB00747                            1545
*   RPLRCODE=RCZERO;                /* GOOD REASON CODE      @Y30LB26*/
         MVC   RPLRCODE(2,@04),@CB00747                            1546
*   RETURN;                         /*                       @Y30LB26*/
         B     @EL00021                                            1547
*   END GRPDIR;                     /*                       @Y30LB26*/
         B     @EL00021                                            1548
*                                                                  1549
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE READS NEXT FOR GROUP RECORD                 @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1549
*GRPNREC:                           /*                       @Y30LB26*/
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
*                                                                  1549
GRPNREC  ST    @14,@SA00022                                        1549
*   /*****************************************************************/
*   /*                                                               */
*   /* GO RESERVE INVENTORY DATA SET SHARED                  @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1550
*   CALL RESSHARE;                  /* RESERVE INVENTORY SHR @Y30LB26*/
*                                                                  1550
         BAL   @14,RESSHARE                                        1550
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK ON STATUS OF GROUP NAME. IF GIVEN USE IT        @Y30LB26*/
*   /* OTHERWISE, READ FIRST GROUP RECORD                    @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1551
*   IF RVVSGRP=OFF THEN             /* WAS GROUP NAME SPEC   @Y30LB26*/
         TM    RVVSGRP(RVVIPTR),B'10000000'                        1551
         BNZ   @RF01551                                            1551
*     GROUPKY=ZEROCHAR;             /* SET READ FIRST GROUP  @Y30LB26*/
         MVC   GROUPKY(8),ZEROCHAR                                 1552
*   ELSE                            /*                       @Y30LB26*/
*     GROUPKY=RVVGROUP;             /* GROUP NAME            @Y30LB26*/
         B     @RC01551                                            1553
@RF01551 MVC   GROUPKY(8),RVVGROUP(RVVIPTR)                        1553
*   DO WHILE I=I;                   /* BIG LOOP              @Y30LB26*/
*                                                                  1554
@RC01551 B     @DE01554                                            1554
@DL01554 DS    0H                                                  1555
*     /***************************************************************/
*     /*                                                             */
*     /* SET UP TO READ NEXT GROUP RECORD                    @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  1555
*     ARITHGRP=GKEY(12:13);         /* MOVE EXISTING ID      @Y30LB26*/
         MVC   ARITHGRP(2),GKEY+11                                 1555
*     GRPID=GRPID+256;              /* ADD TO GET NEXT GRP   @Y30LB26*/
         LA    @04,256                                             1556
         LH    @02,GRPID                                           1556
         N     @02,@CF01186                                        1556
         ALR   @04,@02                                             1556
         STH   @04,GRPID                                           1556
*     GKEY(12:13)=ARITHGRP;         /* PUT NEW VALUE BACK    @Y30LB26*/
         MVC   GKEY+11(2),ARITHGRP                                 1557
*     RPLVKEY=ADDR(GKEY);           /* ADDR OF KEY           @Y30LB26*/
         L     @04,RPLVPTR                                         1558
         LA    @02,GKEY                                            1558
         ST    @02,RPLVKEY(,@04)                                   1558
*     RPLVLOC=ON;                   /* LOCATE MODE           @Y30LB26*/
*     RPLVDIR=ON;                   /* DIRECT READ           @Y30LB26*/
         OI    RPLVLOC(@04),B'11000000'                            1560
*     RPLVTYP=RPLVREAD;             /* READ RECORD           @Y30LB26*/
         MVI   RPLVTYP(@04),X'00'                                  1561
*     RPLVKGE=ON;                   /* READ >=               @Y30LB26*/
         OI    RPLVKGE(@04),B'00000100'                            1562
*     RESPECIFY                                                    1563
*       REG1 RSTD;                  /* RESTRICT REG1         @Y30LB26*/
*     REG1=RPLVPTR;                 /* ADDR OF RPLV          @Y30LB26*/
         LR    REG1,@04                                            1564
*     CALL ICBVIO00;                /* READ NEXT GROUP       @Y30LB26*/
         L     @15,@CV00671                                        1565
         BALR  @14,@15                                             1565
*     RESPECIFY                                                    1566
*       REG1 UNRSTD;                /* UNRESTRICT REG1       @Y30LB26*/
*                                                                  1566
*     /***************************************************************/
*     /*                                                             */
*     /* CHECK RETURN CODE FROM I/O PROCESSOR                @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  1567
*     IF RPLVRETC^=RCZERO THEN      /* CHECK RC              @Y30LB26*/
         L     @04,RPLVPTR                                         1567
         CLC   RPLVRETC(2,@04),@CB00747                            1567
         BE    @RF01567                                            1567
*       DO;                         /*                       @Y30LB26*/
*         CALL ERREXIT;             /* SAVE REASON CODES     @Y30LB26*/
         BAL   @14,ERREXIT                                         1569
*         RETURN;                   /*                       @Y30LB26*/
@EL00022 DS    0H                                                  1570
@EF00022 DS    0H                                                  1570
@ER00022 L     @14,@SA00022                                        1570
         BR    @14                                                 1570
*       END;                        /*                       @Y30LB26*/
*                                                                  1571
*     /***************************************************************/
*     /*                                                             */
*     /* IF NO ERROR OCCURED, SET ADDRESSING TO RECORD       @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  1572
*     GROUPPTR=RPLVBUF;             /* ADDR RECORD READ      @Y30LB26*/
*                                                                  1572
@RF01567 L     @04,RPLVPTR                                         1572
         L     @04,RPLVBUF(,@04)                                   1572
         ST    @04,GROUPPTR                                        1572
*     /***************************************************************/
*     /*                                                             */
*     /* TEST TO SEE IF STILL A GROUP RECORD                 @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  1573
*     IF GROG=GKY&                  /*                       @Y30LB26*/
*         GROZERO=FIXZERO THEN      /* TEST IS GROUP REC     @Y30LB26*/
*                                                                  1573
         CLC   GROG(3,@04),GKY                                     1573
         BNE   @RF01573                                            1573
         CLI   GROZERO(@04),0                                      1573
         BNE   @RF01573                                            1573
*       /*************************************************************/
*       /*                                                           */
*       /* IF THRESHOLD CHECKING CALLED FOR, DO IT           @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1574
*       DO;                         /*                       @Y30LB26*/
*         IF RVVTHOLD=ON THEN       /* THRESHOLD CHECK?      @Y30LB26*/
         TM    RVVTHOLD(RVVIPTR),B'01000000'                       1575
         BNO   @RF01575                                            1575
*           DO;                     /*                       @Y30LB26*/
*             IF GROFRESP<=GROSTRSH THEN/* PAST THRESHOLD?   @Y30LB26*/
*                                                                  1577
         L     @02,GROFRESP(,@04)                                  1577
         C     @02,GROSTRSH(,@04)                                  1577
         BH    @RF01577                                            1577
*               /*****************************************************/
*               /*                                                   */
*               /* IF GROUP PAST THRESHOLD, GET BUFFER       @Y30LB26*/
*               /* AND RETURN RECORD                         @Y30LB26*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  1578
*               DO;                 /*                       @Y30LB26*/
*                 CALL GETBUF;      /* GET BUFFER            @Y30LB26*/
         BAL   @14,GETBUF                                          1579
*                 IF RPLVRETC^=RCZERO THEN/* CK RETURN       @Y30LB26*/
         L     @04,RPLVPTR                                         1580
         CLC   RPLVRETC(2,@04),@CB00747                            1580
         BNE   @RT01580                                            1580
*                   RETURN;         /*                       @Y30LB26*/
*                 BUFFER=GROUP;     /* MOVE IN RECORD        @Y30LB26*/
         L     @02,RVVAREA(,RVVIPTR)                               1582
         MVI   BUFFER+164(@02),C' '                                1582
         MVC   BUFFER+165(91,@02),BUFFER+164(@02)                  1582
         L     @01,GROUPPTR                                        1582
         MVC   BUFFER(164,@02),GROUP(@01)                          1582
*                 RPLVRETC=RCZERO;  /* GOOD RC               @Y30LB26*/
         MVC   RPLVRETC(2,@04),@CB00747                            1583
*                 RPLRCODE=RCZERO;  /* GOOD REASON CODE      @Y30LB26*/
         MVC   RPLRCODE(2,@04),@CB00747                            1584
*                 RETURN;           /*                       @Y30LB26*/
         B     @EL00022                                            1585
*               END;                /*                       @Y30LB26*/
*             ELSE                  /*                       @Y30LB26*/
*               DO;                 /*                       @Y30LB26*/
@RF01577 DS    0H                                                  1588
*                 LOOPSW=ON;        /* INDICATE LOOPING      @Y30LB26*/
         OI    LOOPSW,B'10000000'                                  1588
*                 GKEY=GRONAME;     /* SET KEY TO ADD 256    @Y30LB26*/
         L     @04,GROUPPTR                                        1589
         MVC   GKEY(13),GRONAME(@04)                               1589
*               END;                /*                       @Y30LB26*/
*           END;                    /*                       @Y30LB26*/
*         ELSE                      /*                       @Y30LB26*/
*                                                                  1592
*           /*********************************************************/
*           /*                                                       */
*           /* NO THRESHOLD CHECKING, SO JUST                @Y30LB26*/
*           /* RETURN GROUP RECORD                           @Y30LB26*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1592
*           DO;                     /*                       @Y30LB26*/
         B     @RC01575                                            1592
@RF01575 DS    0H                                                  1593
*             CALL GETBUF;          /* GET BUFFER            @Y30LB26*/
         BAL   @14,GETBUF                                          1593
*             IF RPLVRETC^=RCZERO THEN/* CK RETURN           @Y30LB26*/
         L     @04,RPLVPTR                                         1594
         CLC   RPLVRETC(2,@04),@CB00747                            1594
         BNE   @RT01594                                            1594
*               RETURN;             /*                       @Y30LB26*/
*             BUFFER=GROUP;         /* MOVE IN RECORD        @Y30LB26*/
         L     @02,RVVAREA(,RVVIPTR)                               1596
         MVI   BUFFER+164(@02),C' '                                1596
         MVC   BUFFER+165(91,@02),BUFFER+164(@02)                  1596
         L     @01,GROUPPTR                                        1596
         MVC   BUFFER(164,@02),GROUP(@01)                          1596
*             RPLVRETC=RCZERO;      /* GOOD RETN CODE        @Y30LB26*/
         MVC   RPLVRETC(2,@04),@CB00747                            1597
*             RPLRCODE=RCZERO;      /* GOOD REASON CODE      @Y30LB26*/
         MVC   RPLRCODE(2,@04),@CB00747                            1598
*             RETURN;               /*                       @Y30LB26*/
         B     @EL00022                                            1599
*           END;                    /*                       @Y30LB26*/
*       END;                        /*                       @Y30LB26*/
*     ELSE                          /*                       @Y30LB26*/
*                                                                  1602
*       /*************************************************************/
*       /*                                                           */
*       /* NO LONGER A GROUP RECORD, SO CHECK TO SEE         @Y30LB26*/
*       /* IF LOOPING HAS OCCURED                            @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1602
*       DO;                         /*                       @Y30LB26*/
         B     @RC01573                                            1602
@RF01573 DS    0H                                                  1603
*         IF LOOPSW=ON THEN         /* CHECK LOOP CONTROL    @Y30LB26*/
*                                                                  1603
         TM    LOOPSW,B'10000000'                                  1603
         BNO   @RF01603                                            1603
*           /*********************************************************/
*           /*                                                       */
*           /* IF LOOPING OCCURED, SET REASON CODE           @Y30LB26*/
*           /* TO INDICATE TEST NOT MET                      @Y30LB26*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1604
*           DO;                     /*                       @Y30LB26*/
*             RPLRCODE=TNOTMET;     /* TEST NOT MEET         @Y30LB26*/
         L     @02,RPLVPTR                                         1605
         MVC   RPLRCODE(2,@02),@CB00819                            1605
*             RPLVRETC=FOUR;        /* BAD RETURN CODE       @Y30LB26*/
         MVC   RPLVRETC(2,@02),@CB00749                            1606
*             CALL ERREXIT;         /* SAVE REASON CODES     @Y30LB26*/
         BAL   @14,ERREXIT                                         1607
*             RETURN;               /*                       @Y30LB26*/
         B     @EL00022                                            1608
*           END;                    /*                       @Y30LB26*/
*         ELSE                      /*                       @Y30LB26*/
*                                                                  1610
*           /*********************************************************/
*           /*                                                       */
*           /* NO LOOPING OCCURED, SO SET REASON CODE        @Y30LB26*/
*           /* INDICATING RECORD WAS NOT FOUND               @Y30LB26*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1610
*           DO;                     /*                       @Y30LB26*/
@RF01603 DS    0H                                                  1611
*             RPLVRETC=FOUR;        /* BAD RETURN CODE       @Y30LB26*/
         L     @02,RPLVPTR                                         1611
         MVC   RPLVRETC(2,@02),@CB00749                            1611
*             RPLRCODE=NORECRC;     /* BAD REASON CODE       @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00789                            1612
*             CALL ERREXIT;         /* SAVE REASON CODES     @Y30LB26*/
         BAL   @14,ERREXIT                                         1613
*             RETURN;               /*                       @Y30LB26*/
         B     @EL00022                                            1614
*           END;                    /*                       @Y30LB26*/
*       END;                        /*                       @Y30LB26*/
*   END;                            /*                       @Y30LB26*/
@RC01573 DS    0H                                                  1617
@DE01554 CLC   I(1),I                                              1617
         BE    @DL01554                                            1617
*   END GRPNREC;                    /*                       @Y30LB26*/
         B     @EL00022                                            1618
*                                                                  1619
*   /*****************************************************************/
*   /*                                                               */
*   /* THIS PROCEDURE DETERMINES THE TYPE OF RECORD ASKED    @Y30LB26*/
*   /* FOR ON A REQUEST TO READ A COPY DIRECT. THE TYPES     @Y30LB26*/
*   /* OF RECORDS ASKED FOR ARE BY DATE AND SEQUENCE NUMBER  @Y30LB26*/
*   /* LATEST COPY, LATEST BACKUP, OLDEST BACKUP             @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1619
*COPYDIR:                                                          1619
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
*                                                                  1619
COPYDIR  ST    @14,@SA00023                                        1619
*   /*****************************************************************/
*   /*                                                               */
*   /* IF DATE WAS SPECIFIED, GO FIND COPY WITH THAT DATE    @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1620
*   IF RVVSDTE=ON THEN              /* DATE SPEC?            @Y30LB26*/
         TM    RVVSDTE(RVVIPTR),B'00100000'                        1620
         BNO   @RF01620                                            1620
*     DO;                           /*                       @Y30LB26*/
*       CALL CPYDATE;               /* GET CPY REC DATE      @Y30LB26*/
         BAL   @14,CPYDATE                                         1622
*       RETURN;                     /*                       @Y30LB26*/
@EL00023 DS    0H                                                  1623
@EF00023 DS    0H                                                  1623
@ER00023 L     @14,@SA00023                                        1623
         BR    @14                                                 1623
*     END;                          /*                       @Y30LB26*/
*                                                                  1624
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK IF LATEST OR OLDEST BACKUP ARE WANTED           @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1625
*   IF(RVVLBKUP=ONRVVOBKUP=ON)&(RVVCPLHD=OFF&RVVALL=OFF)/*  @ZDR2053*/
*     THEN                          /* WANT BACKUPS?         @ZDR2053*/
@RF01620 TM    RVVLBKUP(RVVIPTR),B'11000000'                       1625
         BZ    @RF01625                                            1625
         TM    RVVCPLHD(RVVIPTR),B'00010000'                       1625
         BNZ   @RF01625                                            1625
         TM    RVVALL(RVVIPTR),B'00000001'                         1625
         BNZ   @RF01625                                            1625
*     DO;                           /*                       @Y30LB26*/
*       CALL BACKUP;                /* GET BACKUP            @Y30LB26*/
         BAL   @14,BACKUP                                          1627
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00023                                            1628
*     END;                          /*                       @Y30LB26*/
*                                                                  1629
*   /*****************************************************************/
*   /*                                                               */
*   /* IF LATEST COPY IS ASKED FOR, GO LOOK FOR IT           @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1630
*   IF RVVLCOPY=ON&(RVVCPLHD=OFF&RVVALL=OFF)/* WANT COPY?    @ZDR2053*/
*     THEN                          /*                       @ZDR2053*/
@RF01625 TM    RVVLCOPY(RVVIPTR),B'00100000'                       1630
         BNO   @RF01630                                            1630
         TM    RVVCPLHD(RVVIPTR),B'00010000'                       1630
         BNZ   @RF01630                                            1630
         TM    RVVALL(RVVIPTR),B'00000001'                         1630
         BNZ   @RF01630                                            1630
*     DO;                           /*                       @Y30LB26*/
*       CALL LATECPY;               /* GET LATEST COPY       @Y30LB26*/
         BAL   @14,LATECPY                                         1632
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00023                                            1633
*     END;                          /*                       @Y30LB26*/
*   ELSE                            /*                       @Y30LB26*/
*                                                                  1635
*     /***************************************************************/
*     /*                                                             */
*     /* IF NONE OF THESE, THEN NOT ENOUGH INFO GIVEN        @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  1635
*     DO;                           /*                       @Y30LB26*/
@RF01630 DS    0H                                                  1636
*       RPLRCODE=NOCPYTYP;          /* COPY NOT SPECIFIED    @Y30LB26*/
         L     @02,RPLVPTR                                         1636
         MVC   RPLRCODE(2,@02),@CB00801                            1636
*       RPLVRETC=FOUR;              /* BAD RET CODE          @Y30LB26*/
         MVC   RPLVRETC(2,@02),@CB00749                            1637
*       CALL ERREXIT;               /* SAVE RETURN CODES     @Y30LB26*/
         BAL   @14,ERREXIT                                         1638
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00023                                            1639
*     END;                          /*                       @Y30LB26*/
*   END COPYDIR;                    /*                       @Y30LB26*/
*                                                                  1642
*   /*****************************************************************/
*   /*                                                               */
*   /* THIS PROCEDURE LOCATES A COPY RECORD WITH THE         @Y30LB26*/
*   /* SPECIFIED DATE AND ALSO A SPECIFIED SEQUENCE          @Y30LB26*/
*   /* NUMBER IF ONE WAS GIVEN                               @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1642
*CPYDATE:                                                          1642
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
CPYDATE  ST    @14,@SA00024                                        1642
*   COUNT=ZERO;                     /* INIT COUNTER          @Y30LB26*/
         SLR   COUNT,COUNT                                         1643
*   VOLKY=RVVOLUME;                 /* VOL NAME              @Y30LB26*/
*                                                                  1644
         MVC   VOLKY(6),RVVOLUME(RVVIPTR)                          1644
*   /*****************************************************************/
*   /*                                                               */
*   /* GO RESERVE INVENTORY SHARED                           @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1645
*   CALL RESSHARE;                  /*                       @Y30LB26*/
*                                                                  1645
         BAL   @14,RESSHARE                                        1645
*   /*****************************************************************/
*   /*                                                               */
*   /* START LOOP LOOKING FOR SPECIFIED DATE AND SEQUENCE    @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1646
*   DO WHILE I=I;                   /*                       @Y30LB26*/
         B     @DE01646                                            1646
@DL01646 DS    0H                                                  1647
*     VIDKY=VIDKY+FIXONE;           /* INCREMENT COUNT       @Y30LB26*/
         LA    @07,1                                               1647
         SLR   @04,@04                                             1647
         IC    @04,VIDKY                                           1647
         ALR   @07,@04                                             1647
         STC   @07,VIDKY                                           1647
*     RPLVKEY=ADDR(VKEY);           /* ADDR KEY              @Y30LB26*/
         L     @07,RPLVPTR                                         1648
         LA    @04,VKEY                                            1648
         ST    @04,RPLVKEY(,@07)                                   1648
*     RPLVLOC=ON;                   /* LOCATE MODE           @Y30LB26*/
*     RPLVDIR=ON;                   /* READ DIRECT           @Y30LB26*/
         OI    RPLVLOC(@07),B'11000000'                            1650
*     RPLVTYP=RPLVREAD;             /* READ RECORD           @Y30LB26*/
         MVI   RPLVTYP(@07),X'00'                                  1651
*     RPLVKGE=ON;                   /* READ >OR=             @Y30LB26*/
         OI    RPLVKGE(@07),B'00000100'                            1652
*     RESPECIFY                                                    1653
*       REG1 RSTD;                  /* RESTRICT              @Y30LB26*/
*     REG1=RPLVPTR;                 /* ADDR RPLV             @Y30LB26*/
         LR    REG1,@07                                            1654
*     CALL ICBVIO00;                /* READ                  @Y30LB26*/
         L     @15,@CV00671                                        1655
         BALR  @14,@15                                             1655
*     RESPECIFY                                                    1656
*       REG1 UNRSTD;                /* FREE REG1             @Y30LB26*/
*     IF RPLVRETC^=RCZERO THEN      /* CK RETURN CODE        @Y30LB26*/
         L     @07,RPLVPTR                                         1657
         CLC   RPLVRETC(2,@07),@CB00747                            1657
         BE    @RF01657                                            1657
*       DO;                         /*                       @Y30LB26*/
*         CALL ERREXIT;             /* SAVE RETURN CODES     @Y30LB26*/
         BAL   @14,ERREXIT                                         1659
*         RETURN;                   /*                       @Y30LB26*/
@EL00024 DS    0H                                                  1660
@EF00024 DS    0H                                                  1660
@ER00024 L     @14,@SA00024                                        1660
         BR    @14                                                 1660
*       END;                        /*                       @Y30LB26*/
*     COPYVPTR=RPLVBUF;             /* ADDR REC READ         @Y30LB26*/
*                                                                  1662
@RF01657 L     @07,RPLVPTR                                         1662
         L     @07,RPLVBUF(,@07)                                   1662
         ST    @07,COPYVPTR                                        1662
*     /***************************************************************/
*     /*                                                             */
*     /* CHECK TO SEE IF THIS IS A COPY RECORD & CORRECT ONE @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  1663
*     IF COPV=VKY&COPSERNO=VOLKY THEN/* A COPY RECORD        @Y30LB26*/
         CLC   COPV(5,@07),VKY                                     1663
         BNE   @RF01663                                            1663
         CLC   COPSERNO(6,@07),VOLKY                               1663
         BNE   @RF01663                                            1663
*       DO;                         /*                       @Y30LB26*/
*                                                                  1664
*         /***********************************************************/
*         /*                                                         */
*         /* IS THIS THE SPECIFIED DATE THE COPY WAS MADE    @Y30LB26*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  1665
*         IF COPDATE=RVVCDATE THEN  /* RITE DATE ?           @ZDR2053*/
         CLC   COPDATE(4,@07),RVVCDATE(RVVIPTR)                    1665
         BNE   @RF01665                                            1665
*           DO;                     /*                       @Y30LB26*/
*             COUNT=COUNT+ONE;      /* ADD ONE SEQ CNT       @Y30LB26*/
*                                                                  1667
         AL    COUNT,@CF00041                                      1667
*             /*******************************************************/
*             /*                                                     */
*             /* CHECK TO SEE IF SEQUENCE WAS GIVEN          @Y30LB26*/
*             /*                                                     */
*             /*******************************************************/
*                                                                  1668
*             IF RVVSSEQ=ON THEN    /* CHECK SEQUENCE        @Y30LB26*/
         TM    RVVSSEQ(RVVIPTR),B'00010000'                        1668
         BNO   @RF01668                                            1668
*               DO;                 /*                       @Y30LB26*/
*                                                                  1669
*                 /***************************************************/
*                 /*                                                 */
*                 /* IF SEQUENCE CHECKING, CHECK COUNT       @Y30LB26*/
*                 /*                                                 */
*                 /***************************************************/
*                                                                  1670
*                 IF COUNT=RVVRDSEQ THEN/* CK COUNT          @Y30LB26*/
         SLR   @04,@04                                             1670
         IC    @04,RVVRDSEQ(,RVVIPTR)                              1670
         CR    COUNT,@04                                           1670
         BNE   @RF01670                                            1670
*                   DO;             /*                       @ZDR2053*/
*                                                                  1671
*                     /***********************************************/
*                     /*                                             */
*                     /* CHECK FOR CORRECT RECORD            @ZDR2053*/
*                     /*                                             */
*                     /***********************************************/
*                                                                  1672
*                     IF RVVALL=ON(COPHOLD=ON&RVVCPLHD=ON)/*     1672
*                                                            @ZDR2053*/
*                         (RVVCPLHD=OFF&COPHOLD=OFF)/*       @ZDR2053*/
*                       THEN        /*                       @ZDR2053*/
*                                                                  1672
         TM    RVVALL(RVVIPTR),B'00000001'                         1672
         BO    @RT01672                                            1672
         TM    COPHOLD(@07),B'10000000'                            1672
         BNO   @GL00023                                            1672
         TM    RVVCPLHD(RVVIPTR),B'00010000'                       1672
         BO    @RT01672                                            1672
@GL00023 TM    RVVCPLHD(RVVIPTR),B'00010000'                       1672
         BNZ   @RF01672                                            1672
         L     @07,COPYVPTR                                        1672
         TM    COPHOLD(@07),B'10000000'                            1672
         BNZ   @RF01672                                            1672
@RT01672 DS    0H                                                  1673
*                       /*********************************************/
*                       /*                                           */
*                       /* IF PROPER DATE, SEQUENCE, AND RECORD      */
*                       /*                                   @ZDR2053*/
*                       /* BUFFER AND RETURN RECORD          @Y30LB26*/
*                       /*                                           */
*                       /*********************************************/
*                                                                  1673
*                       DO;         /*                       @Y30LB26*/
*                         CALL GETBUF;/* GET SPACE           @Y30LB26*/
         BAL   @14,GETBUF                                          1674
*                         IF RPLVRETC^=RCZERO THEN/* CK RETURN     1675
*                                                            @Y30LB26*/
         L     @04,RPLVPTR                                         1675
         CLC   RPLVRETC(2,@04),@CB00747                            1675
         BNE   @RT01675                                            1675
*                           RETURN; /*                       @Y30LB26*/
*                         BUFFER=COPYV;/* REC TO BUFF        @Y30LB26*/
         L     @02,RVVAREA(,RVVIPTR)                               1677
         MVI   BUFFER+164(@02),C' '                                1677
         MVC   BUFFER+165(91,@02),BUFFER+164(@02)                  1677
         L     @01,COPYVPTR                                        1677
         MVC   BUFFER(164,@02),COPYV(@01)                          1677
*                         RPLVRETC=RCZERO;/* GOOD RET CODE   @Y30LB26*/
         MVC   RPLVRETC(2,@04),@CB00747                            1678
*                         RPLRCODE=RCZERO;/* GOOD REASON CODE      1679
*                                                            @Y30LB26*/
         MVC   RPLRCODE(2,@04),@CB00747                            1679
*                         RETURN;   /*                       @Y30LB26*/
         B     @EL00024                                            1680
*                       END;        /*                       @Y30LB26*/
*                     ELSE          /*                       @Y30LB26*/
*                                                                  1682
*                       /*********************************************/
*                       /*                                           */
*                       /* SEQUENCE WAS SPECIFIED BUT NOT FOUND      */
*                       /*                                   @Y30LB26*/
*                       /* SO SET UP TO LOOP AND TRY AGAIN   @Y30LB26*/
*                       /*                                           */
*                       /*********************************************/
*                                                                  1682
*                       VKEY=COPNAME;/* LAST KEY READ        @Y30LB26*/
@RF01672 L     @07,COPYVPTR                                        1682
         MVC   VKEY(13),COPNAME(@07)                               1682
*                   END;            /*                       @Y30LB26*/
*                 ELSE                                             1684
*                   VKEY=COPNAME;   /* LAST KEY READ         @ZDR2053*/
         B     @RC01670                                            1684
@RF01670 L     @07,COPYVPTR                                        1684
         MVC   VKEY(13),COPNAME(@07)                               1684
*               END;                /*                       @ZDR2053*/
*             ELSE                  /*                       @Y30LB26*/
*                                                                  1686
*               /*****************************************************/
*               /*                                                   */
*               /* CHECK FOR CORRECT RECORD                  @ZDR2053*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  1686
*               IF RVVALL=ON(COPHOLD=ON&RVVCPLHD=ON)/*     @ZDR2053*/
*                   (RVVCPLHD=OFF&COPHOLD=OFF)/*             @ZDR2053*/
*                 THEN              /*                       @ZDR2053*/
*                                                                  1686
         B     @RC01668                                            1686
@RF01668 TM    RVVALL(RVVIPTR),B'00000001'                         1686
         BO    @RT01686                                            1686
         L     @07,COPYVPTR                                        1686
         TM    COPHOLD(@07),B'10000000'                            1686
         BNO   @GL00027                                            1686
         TM    RVVCPLHD(RVVIPTR),B'00010000'                       1686
         BO    @RT01686                                            1686
@GL00027 TM    RVVCPLHD(RVVIPTR),B'00010000'                       1686
         BNZ   @RF01686                                            1686
         L     @07,COPYVPTR                                        1686
         TM    COPHOLD(@07),B'10000000'                            1686
         BNZ   @RF01686                                            1686
@RT01686 DS    0H                                                  1687
*                 /***************************************************/
*                 /*                                                 */
*                 /* SEQUENCE CHECKING WAS NOT ASKED FOR AND @ZDR2053*/
*                 /* CORRECT DATE WAS LOCATED, SO RETURN RECORD      */
*                 /*                                         @Y30LB26*/
*                 /*                                                 */
*                 /***************************************************/
*                                                                  1687
*                 DO;               /*                       @Y30LB26*/
*                   CALL GETBUF;    /* GET CORE              @Y30LB26*/
         BAL   @14,GETBUF                                          1688
*                   IF RPLVRETC^=RCZERO THEN/* CK RETURN     @Y30LB26*/
         L     @04,RPLVPTR                                         1689
         CLC   RPLVRETC(2,@04),@CB00747                            1689
         BNE   @RT01689                                            1689
*                     RETURN;       /*                       @Y30LB26*/
*                   BUFFER=COPYV;   /* REC TO BUFFER         @Y30LB26*/
         L     @02,RVVAREA(,RVVIPTR)                               1691
         MVI   BUFFER+164(@02),C' '                                1691
         MVC   BUFFER+165(91,@02),BUFFER+164(@02)                  1691
         L     @01,COPYVPTR                                        1691
         MVC   BUFFER(164,@02),COPYV(@01)                          1691
*                   RPLRCODE=RCZERO;/* GOOD RET CODE         @Y30LB26*/
         MVC   RPLRCODE(2,@04),@CB00747                            1692
*                   RPLVRETC=RCZERO;/* GOOD REASON CODE      @Y30LB26*/
         MVC   RPLVRETC(2,@04),@CB00747                            1693
*                   RETURN;         /*                       @Y30LB26*/
         B     @EL00024                                            1694
*                 END;              /*                       @Y30LB26*/
*               ELSE                                               1696
*                 VKEY=COPNAME;     /* LAST KEY READ         @ZDR2053*/
@RF01686 L     @07,COPYVPTR                                        1696
         MVC   VKEY(13),COPNAME(@07)                               1696
*           END;                    /*                       @Y30LB26*/
*         ELSE                      /*                       @Y30LB26*/
*                                                                  1698
*           /*********************************************************/
*           /*                                                       */
*           /* HAVE NOT FOUND THE RIGHT DATE YET, SO         @Y30LB26*/
*           /* SET UP TO LOOP AROUND AND TRY AGAIN           @Y30LB26*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1698
*           VKEY=COPNAME;           /* KEY LAST READ         @Y30LB26*/
         B     @RC01665                                            1698
@RF01665 L     @07,COPYVPTR                                        1698
         MVC   VKEY(13),COPNAME(@07)                               1698
*       END;                        /*                       @Y30LB26*/
*     ELSE                          /*                       @Y30LB26*/
*                                                                  1700
*       /*************************************************************/
*       /*                                                           */
*       /* IS NO LONGER A COPY RECORD, SO SET RECORD NOT     @Y30LB26*/
*       /* FOUND REASON CODE AND RETURN                      @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1700
*       DO;                         /*                       @Y30LB26*/
         B     @RC01663                                            1700
@RF01663 DS    0H                                                  1701
*         RPLVRETC=FOUR;            /* BAD RETURN CODE       @Y30LB26*/
         L     @02,RPLVPTR                                         1701
         MVC   RPLVRETC(2,@02),@CB00749                            1701
*         RPLRCODE=NORECRC;         /* RECORD NOT FOUND      @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00789                            1702
*         CALL ERREXIT;             /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         1703
*         RETURN;                   /*                       @Y30LB26*/
         B     @EL00024                                            1704
*       END;                        /*                       @Y30LB26*/
*   END;                            /*                       @Y30LB26*/
@RC01663 DS    0H                                                  1706
@DE01646 CLC   I(1),I                                              1706
         BE    @DL01646                                            1706
*   END CPYDATE;                    /*                       @Y30LB26*/
         B     @EL00024                                            1707
*                                                                  1708
*   /*****************************************************************/
*   /*                                                               */
*   /* ROUTINE DETERMINES IF LATEST OR OLDEST BACKUP         @Y30LB26*/
*   /* WERE CALLED FOR                                       @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1708
*BACKUP:                                                           1708
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
BACKUP   ST    @14,@SA00025                                        1708
*   VOLKY=RVVOLUME;                 /* BUILD KEY             @Y30LB26*/
*                                                                  1709
         MVC   VOLKY(6),RVVOLUME(RVVIPTR)                          1709
*   /*****************************************************************/
*   /*                                                               */
*   /* IF LATEST BACKUP WAS ASKED FOR, GO GET IT             @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1710
*   IF RVVLBKUP=ON THEN             /* LAST BACKUP?          @Y30LB26*/
         TM    RVVLBKUP(RVVIPTR),B'10000000'                       1710
         BNO   @RF01710                                            1710
*     DO;                           /*                       @Y30LB26*/
*       CALL LATEBKUP;              /* GET LATEST BACKUP     @Y30LB26*/
         BAL   @14,LATEBKUP                                        1712
*       RETURN;                     /*                       @Y30LB26*/
@EL00025 DS    0H                                                  1713
@EF00025 DS    0H                                                  1713
@ER00025 L     @14,@SA00025                                        1713
         BR    @14                                                 1713
*     END;                          /*                       @Y30LB26*/
*   ELSE                            /*                       @Y30LB26*/
*                                                                  1715
*     /***************************************************************/
*     /*                                                             */
*     /* OLDEST BACKUP WAS ASKED FOR, SO GO GET IT           @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  1715
*     DO;                           /*                       @Y30LB26*/
@RF01710 DS    0H                                                  1716
*       CALL OLDBKUP;               /* GET LATEST BACKUP     @Y30LB26*/
         BAL   @14,OLDBKUP                                         1716
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00025                                            1717
*     END;                          /*                       @Y30LB26*/
*   END BACKUP;                     /*                       @Y30LB26*/
*                                                                  1720
*   /*****************************************************************/
*   /*                                                               */
*   /* ROUTINE RETRIEVES LATEST BACKUP COPY                  @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1720
*LATEBKUP:                                                         1720
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
*                                                                  1720
LATEBKUP ST    @14,@SA00026                                        1720
*   /*****************************************************************/
*   /*                                                               */
*   /* GO RESERVE INVENTORY DATA SET SHARED                  @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1721
*   CALL RESSHARE;                  /*                       @Y30LB26*/
*                                                                  1721
         BAL   @14,RESSHARE                                        1721
*   /*****************************************************************/
*   /*                                                               */
*   /* START LOOPING THRU LOOKING FOR LATEST BACKUP          @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1722
*   DO WHILE I=I;                   /* LOOP                  @Y30LB26*/
         B     @DE01722                                            1722
@DL01722 DS    0H                                                  1723
*     VIDKY=VIDKY+FIXONE;           /* UP KEY                @Y30LB26*/
         LA    @04,1                                               1723
         SLR   @02,@02                                             1723
         IC    @02,VIDKY                                           1723
         ALR   @04,@02                                             1723
         STC   @04,VIDKY                                           1723
*     RPLVKEY=ADDR(VKEY);           /* ADDR OF KEY           @Y30LB26*/
         L     @04,RPLVPTR                                         1724
         LA    @02,VKEY                                            1724
         ST    @02,RPLVKEY(,@04)                                   1724
*     RPLVLOC=ON;                   /* LOCATION MODE         @Y30LB26*/
*     RPLVDIR=ON;                   /* READ DIRECT           @Y30LB26*/
         OI    RPLVLOC(@04),B'11000000'                            1726
*     RPLVTYP=RPLVREAD;             /* READ RECORD           @Y30LB26*/
         MVI   RPLVTYP(@04),X'00'                                  1727
*     RPLVKGE=ON;                   /* READ > OR =           @Y30LB26*/
         OI    RPLVKGE(@04),B'00000100'                            1728
*     RESPECIFY                                                    1729
*       REG1 RSTD;                  /* RESTRICT REG1         @Y30LB26*/
*     REG1=RPLVPTR;                 /* ADDR OF RPLV          @Y30LB26*/
         LR    REG1,@04                                            1730
*     CALL ICBVIO00;                /* READ COPY             @Y30LB26*/
         L     @15,@CV00671                                        1731
         BALR  @14,@15                                             1731
*     RESPECIFY                                                    1732
*       REG1 UNRSTD;                /* FILE REG1             @Y30LB26*/
*                                                                  1732
*     /***************************************************************/
*     /*                                                             */
*     /* CHECK RETURN FROM I/O PROCESSOR                     @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  1733
*     IF RPLVRETC^=RCZERO THEN      /* CHECK RETURN CODE     @Y30LB26*/
         L     @04,RPLVPTR                                         1733
         CLC   RPLVRETC(2,@04),@CB00747                            1733
         BE    @RF01733                                            1733
*       DO;                         /*                       @Y30LB26*/
*                                                                  1734
*         /***********************************************************/
*         /*                                                         */
*         /* IF RECORD NOT FOUND, SEE IF ALREADY FOUND       @Y30LB26*/
*         /* GOOD BACKUP COPY                                @Y30LB26*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  1735
*         IF RPLRCODE=NORECRC THEN  /* RECORD NOT FND        @Y30LB26*/
         CLC   RPLRCODE(2,@04),@CB00789                            1735
         BNE   @RF01735                                            1735
*           DO;                     /*                       @Y30LB26*/
*             IF BKUPFND=ON THEN    /* FND GOOD REC YET ?    @Y30LB26*/
*                                                                  1737
         TM    BKUPFND,B'01000000'                                 1737
         BNO   @RF01737                                            1737
*               /*****************************************************/
*               /*                                                   */
*               /* IF A GOOD ONE FOUND, READ IT              @Y30LB26*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  1738
*               DO;                 /*                       @Y30LB26*/
*                 VKEY=SAVEKEY;     /* GET OLD KEY           @Y30LB26*/
         MVC   VKEY(13),SAVEKEY                                    1739
*                 RPLVKEY=ADDR(VKEY);/* ADDR KEY             @Y30LB26*/
         LA    @02,VKEY                                            1740
         ST    @02,RPLVKEY(,@04)                                   1740
*                 RPLVLOC=ON;       /* LOCATION MODE         @Y30LB26*/
*                 RPLVDIR=ON;       /* READ DIRECT           @Y30LB26*/
         OI    RPLVLOC(@04),B'11000000'                            1742
*                 RPLVTYP=RPLVREAD; /* READ RECORD           @Y30LB26*/
         MVI   RPLVTYP(@04),X'00'                                  1743
*                 RPLVKGE=OFF;      /* READ > OR =           @Y30LB26*/
         NI    RPLVKGE(@04),B'11111011'                            1744
*                 RESPECIFY                                        1745
*                   REG1 RSTD;      /* RESTRICT REG1         @Y30LB26*/
*                 REG1=RPLVPTR;     /* ADDR RPLV             @Y30LB26*/
         LR    REG1,@04                                            1746
*                 CALL ICBVIO00;    /* READ BACKUP           @Y30LB26*/
         L     @15,@CV00671                                        1747
         BALR  @14,@15                                             1747
*                 RESPECIFY                                        1748
*                   REG1 UNRSTD;    /* FREE REG1             @Y30LB26*/
*                                                                  1748
*                 /***************************************************/
*                 /*                                                 */
*                 /* CHECK RETURN CODE FROM I/O PROCESSOR    @Y30LB26*/
*                 /*                                                 */
*                 /***************************************************/
*                                                                  1749
*                 IF RPLVRETC^=RCZERO THEN/* CK RETURN CODE  @Y30LB26*/
         L     @04,RPLVPTR                                         1749
         CLC   RPLVRETC(2,@04),@CB00747                            1749
         BE    @RF01749                                            1749
*                   DO;             /*                       @Y30LB26*/
*                     CALL ERREXIT; /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         1751
*                     RETURN;       /*                       @Y30LB26*/
@EL00026 DS    0H                                                  1752
@EF00026 DS    0H                                                  1752
@ER00026 L     @14,@SA00026                                        1752
         BR    @14                                                 1752
*                   END;            /*                       @Y30LB26*/
*                                                                  1753
*                 /***************************************************/
*                 /*                                                 */
*                 /* SET ADDRESS TO RECORD AND GET BUFFER    @Y30LB26*/
*                 /* SPACE AND RETURN RECORD                 @Y30LB26*/
*                 /*                                                 */
*                 /***************************************************/
*                                                                  1754
*                 COPYVPTR=RPLVBUF; /* ADDR OF RECORD        @Y30LB26*/
@RF01749 L     @04,RPLVPTR                                         1754
         L     @04,RPLVBUF(,@04)                                   1754
         ST    @04,COPYVPTR                                        1754
*                 CALL GETBUF;      /* GET BUFFER SPACE      @Y30LB26*/
         BAL   @14,GETBUF                                          1755
*                 IF RPLVRETC^=RCZERO THEN/* CK RETURN       @Y30LB26*/
         L     @04,RPLVPTR                                         1756
         CLC   RPLVRETC(2,@04),@CB00747                            1756
         BNE   @RT01756                                            1756
*                   RETURN;         /*                       @Y30LB26*/
*                 BUFFER=COPYV;     /* MOVE IN RECORD        @Y30LB26*/
         L     @02,RVVAREA(,RVVIPTR)                               1758
         MVI   BUFFER+164(@02),C' '                                1758
         MVC   BUFFER+165(91,@02),BUFFER+164(@02)                  1758
         L     @01,COPYVPTR                                        1758
         MVC   BUFFER(164,@02),COPYV(@01)                          1758
*                 RPLVRETC=RCZERO;  /* GOOD RET CODE         @Y30LB26*/
         MVC   RPLVRETC(2,@04),@CB00747                            1759
*                 RPLRCODE=RCZERO;  /* GOOD REASON CODE      @Y30LB26*/
         MVC   RPLRCODE(2,@04),@CB00747                            1760
*                 RETURN;           /*                       @Y30LB26*/
         B     @EL00026                                            1761
*               END;                /*                       @Y30LB26*/
*                                                                  1762
*             /*******************************************************/
*             /*                                                     */
*             /* IF GOOD RECORD NOT FOUND, GO AHEAD AND      @Y30LB26*/
*             /* RETURN NO RECORD RETURN CODE                @Y30LB26*/
*             /*                                                     */
*             /*******************************************************/
*                                                                  1763
*             ELSE                  /*                       @Y30LB26*/
*               DO;                 /*                       @Y30LB26*/
@RF01737 DS    0H                                                  1764
*                 CALL ERREXIT;     /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         1764
*                 RETURN;           /*                       @Y30LB26*/
         B     @EL00026                                            1765
*               END;                /*                       @Y30LB26*/
*           END;                    /*                       @Y30LB26*/
*                                                                  1767
*         /***********************************************************/
*         /*                                                         */
*         /* IF RETURN FROM I/O IS NOT NO RECORD FOUND       @Y30LB26*/
*         /* THEN GO AHEAD AND RETURN REASON CODE            @Y30LB26*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  1768
*         ELSE                      /*                       @Y30LB26*/
*           DO;                     /*                       @Y30LB26*/
@RF01735 DS    0H                                                  1769
*             CALL ERREXIT;         /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         1769
*             RETURN;               /*                       @Y30LB26*/
         B     @EL00026                                            1770
*           END;                    /*                       @Y30LB26*/
*       END;                        /*                       #Y30LB26*/
*     COPYVPTR=RPLVBUF;             /* ADDR RECORD           #Y30LB26*/
*                                                                  1773
@RF01733 L     @04,RPLVPTR                                         1773
         L     @04,RPLVBUF(,@04)                                   1773
         ST    @04,COPYVPTR                                        1773
*     /***************************************************************/
*     /*                                                             */
*     /* CHECK TO SEE IF IT IS STILL A COPY RECORD           #Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  1774
*     IF COPV=VKY&COPSERNO=VOLKY THEN/* STILL COPY REC       #Y30LB26*/
         CLC   COPV(5,@04),VKY                                     1774
         BNE   @RF01774                                            1774
         CLC   COPSERNO(6,@04),VOLKY                               1774
         BNE   @RF01774                                            1774
*       DO;                         /*                       @Y30LB26*/
*                                                                  1775
*         /***********************************************************/
*         /*                                                         */
*         /* CHECK TO SEE IF IT IS A BACKUP COPY             @Y30LB26*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  1776
*         IF COPBKUP=ON&COPHOLD=OFF THEN/* BACKUP FOUND      @Y30LB26*/
*                                                                  1776
         TM    COPBKUP(@04),B'00001000'                            1776
         BNO   @RF01776                                            1776
         TM    COPHOLD(@04),B'10000000'                            1776
         BNZ   @RF01776                                            1776
*           /*********************************************************/
*           /*                                                       */
*           /* IF BACKUP, SAVE KEY AND INDICATE A BACKUP FOUND       */
*           /*                                               @Y30LB26*/
*           /* AND SET KEY TO GO BACK AND TRY FOR A LATER    @Y30LB26*/
*           /* BACKUP COPY                                   @Y30LB26*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1777
*           DO;                     /*                       @Y30LB26*/
*             SAVEKEY=COPNAME;      /*                       @Y30LB26*/
         MVC   SAVEKEY(13),COPNAME(@04)                            1778
*             BKUPFND=ON;           /* BACKUP FOUND          @Y30LB26*/
         OI    BKUPFND,B'01000000'                                 1779
*             VKEY=COPNAME;         /* LATEST KEY            @Y30LB26*/
         MVC   VKEY(13),COPNAME(@04)                               1780
*           END;                    /*                       @Y30LB26*/
*                                                                  1781
*         /***********************************************************/
*         /*                                                         */
*         /* THIS WAS NOT A BACKUP, SO SET KEY TO GO         @Y30LB26*/
*         /* BACK AND TRY AGAIN                              @Y30LB26*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  1782
*         ELSE                      /*                       @Y30LB26*/
*           VKEY=COPNAME;           /* UPDATE KEY            @Y30LB26*/
         B     @RC01776                                            1782
@RF01776 L     @04,COPYVPTR                                        1782
         MVC   VKEY(13),COPNAME(@04)                               1782
*       END;                        /*                       @Y30LB26*/
*                                                                  1783
*     /***************************************************************/
*     /*                                                             */
*     /* IT IS NO LONGER A COPY RECORD, SO IF A BACKUP       @Y30LB26*/
*     /* WAS FOUND, GO BACK AND READ IT AND RETURN RECORD    @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  1784
*     ELSE                          /*                       @Y30LB26*/
*       DO;                         /*                       @Y30LB26*/
         B     @RC01774                                            1784
@RF01774 DS    0H                                                  1785
*         IF BKUPFND=ON THEN        /* BACKUP FOUND          @Y30LB26*/
         TM    BKUPFND,B'01000000'                                 1785
         BNO   @RF01785                                            1785
*           DO;                     /*                       @Y30LB26*/
*             VKEY=SAVEKEY;         /* GET OLD KEY           @Y30LB26*/
         MVC   VKEY(13),SAVEKEY                                    1787
*             RPLVKEY=ADDR(VKEY);   /* ADDR KEY              @Y30LB26*/
         L     @04,RPLVPTR                                         1788
         LA    @02,VKEY                                            1788
         ST    @02,RPLVKEY(,@04)                                   1788
*             RPLVLOC=ON;           /* LOCATION MODE         @Y30LB26*/
*             RPLVDIR=ON;           /* READ DIRECT           @Y30LB26*/
         OI    RPLVLOC(@04),B'11000000'                            1790
*             RPLVTYP=RPLVREAD;     /* READ RECORD           @Y30LB26*/
         MVI   RPLVTYP(@04),X'00'                                  1791
*             RPLVKGE=OFF;          /* READ > OR =           @Y30LB26*/
         NI    RPLVKGE(@04),B'11111011'                            1792
*             RESPECIFY                                            1793
*               REG1 RSTD;          /* RESTRICT REG1         @Y30LB26*/
*             REG1=RPLVPTR;         /* ADDR RPLV             @Y30LB26*/
         LR    REG1,@04                                            1794
*             CALL ICBVIO00;        /* READ BACKUP           @Y30LB26*/
         L     @15,@CV00671                                        1795
         BALR  @14,@15                                             1795
*             RESPECIFY                                            1796
*               REG1 UNRSTD;        /* FREE REG1             @Y30LB26*/
*                                                                  1796
*             /*******************************************************/
*             /*                                                     */
*             /* CHECK RETURN CODE FROM I/O PROCESSOR        @Y30LB26*/
*             /*                                                     */
*             /*******************************************************/
*                                                                  1797
*             IF RPLVRETC^=RCZERO THEN/* CK RETURN CODE      @Y30LB26*/
         L     @04,RPLVPTR                                         1797
         CLC   RPLVRETC(2,@04),@CB00747                            1797
         BE    @RF01797                                            1797
*               DO;                 /*                       @Y30LB26*/
*                 CALL ERREXIT;     /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         1799
*                 RETURN;           /*                       @Y30LB26*/
         B     @EL00026                                            1800
*               END;                /*                       @Y30LB26*/
*                                                                  1801
*             /*******************************************************/
*             /*                                                     */
*             /* SET ADDRESS TO RECORD AND GET BUFFER SPACE  @Y30LB26*/
*             /* AND RETURN RECORD                           @Y30LB26*/
*             /*                                                     */
*             /*******************************************************/
*                                                                  1802
*             COPYVPTR=RPLVBUF;     /* ADDR OF RECORD        @Y30LB26*/
@RF01797 L     @04,RPLVPTR                                         1802
         L     @04,RPLVBUF(,@04)                                   1802
         ST    @04,COPYVPTR                                        1802
*             CALL GETBUF;          /* GET BUFFER SPACE      @Y30LB26*/
         BAL   @14,GETBUF                                          1803
*             IF RPLVRETC^=RCZERO THEN/* CK RETURN           @Y30LB26*/
         L     @04,RPLVPTR                                         1804
         CLC   RPLVRETC(2,@04),@CB00747                            1804
         BNE   @RT01804                                            1804
*               RETURN;             /*                       @Y30LB26*/
*             BUFFER=COPYV;         /* MOVE IN RECORD        @Y30LB26*/
         L     @02,RVVAREA(,RVVIPTR)                               1806
         MVI   BUFFER+164(@02),C' '                                1806
         MVC   BUFFER+165(91,@02),BUFFER+164(@02)                  1806
         L     @01,COPYVPTR                                        1806
         MVC   BUFFER(164,@02),COPYV(@01)                          1806
*             RPLVRETC=RCZERO;      /* GOOD RET CODE         @Y30LB26*/
         MVC   RPLVRETC(2,@04),@CB00747                            1807
*             RPLRCODE=RCZERO;      /* GOOD REASON CODE      @Y30LB26*/
         MVC   RPLRCODE(2,@04),@CB00747                            1808
*             RETURN;               /*                       @Y30LB26*/
         B     @EL00026                                            1809
*           END;                    /*                       @Y30LB26*/
*                                                                  1810
*         /***********************************************************/
*         /*                                                         */
*         /* NO BACKUP RECORD WAS FOUND, SO SET REASON       @Y30LB26*/
*         /* CODE AND RETURN                                 @Y30LB26*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  1811
*         ELSE                      /*                       @Y30LB26*/
*           DO;                     /*                       @Y30LB26*/
@RF01785 DS    0H                                                  1812
*             RPLVRETC=FOUR;        /* BAD RET CODE          @Y30LB26*/
         L     @02,RPLVPTR                                         1812
         MVC   RPLVRETC(2,@02),@CB00749                            1812
*             RPLRCODE=NORECRC;     /* RECORD NOT FOUND      @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00789                            1813
*             CALL ERREXIT;         /* SAVE RETURN CODES     @Y30LB26*/
         BAL   @14,ERREXIT                                         1814
*             RETURN;               /*                       @Y30LB26*/
         B     @EL00026                                            1815
*           END;                    /*                       @Y30LB26*/
*       END;                        /*                       @Y30LB26*/
*   END;                            /*                       @Y30LB26*/
@RC01774 DS    0H                                                  1818
@DE01722 CLC   I(1),I                                              1818
         BE    @DL01722                                            1818
*   END LATEBKUP;                   /*                       @Y30LB26*/
         B     @EL00026                                            1819
*                                                                  1820
*   /*****************************************************************/
*   /*                                                               */
*   /* THIS ROUTINE RETURNS THE OLDEST BACKUP COPY IF        @Y30LB26*/
*   /* ONE EXISTS                                            @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1820
*OLDBKUP:                                                          1820
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
*                                                                  1820
OLDBKUP  ST    @14,@SA00027                                        1820
*   /*****************************************************************/
*   /*                                                               */
*   /* RESERVE INVENTORY SHARED                              @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1821
*   CALL RESSHARE;                  /*                       @Y30LB26*/
*                                                                  1821
         BAL   @14,RESSHARE                                        1821
*   /*****************************************************************/
*   /*                                                               */
*   /* START LOOP LOOKING FOR OLDEST BACKUP                  @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1822
*   DO WHILE I=I;                   /* LOOP                  @Y30LB26*/
         B     @DE01822                                            1822
@DL01822 DS    0H                                                  1823
*     VIDKY=VIDKY+FIXONE;           /* UPDATE COUNTER        @Y30LB26*/
         LA    @04,1                                               1823
         SLR   @02,@02                                             1823
         IC    @02,VIDKY                                           1823
         ALR   @04,@02                                             1823
         STC   @04,VIDKY                                           1823
*     RPLVKEY=ADDR(VKEY);           /* ADDR KEY              @Y30LB26*/
         L     @04,RPLVPTR                                         1824
         LA    @02,VKEY                                            1824
         ST    @02,RPLVKEY(,@04)                                   1824
*     RPLVLOC=ON;                   /* LOCATION MODE         @Y30LB26*/
*     RPLVDIR=ON;                   /* READ DIRECT           @Y30LB26*/
         OI    RPLVLOC(@04),B'11000000'                            1826
*     RPLVTYP=RPLVREAD;             /* READ RECORD           @Y30LB26*/
         MVI   RPLVTYP(@04),X'00'                                  1827
*     RPLVKGE=ON;                   /* FOR > OR =            @Y30LB26*/
         OI    RPLVKGE(@04),B'00000100'                            1828
*     RESPECIFY                                                    1829
*       REG1 RSTD;                  /* RESTRICT REG1         @Y30LB26*/
*     REG1=RPLVPTR;                 /* ADDR RPLV             @Y30LB26*/
         LR    REG1,@04                                            1830
*     CALL ICBVIO00;                /* READ COPY RECORD      @Y30LB26*/
         L     @15,@CV00671                                        1831
         BALR  @14,@15                                             1831
*     RESPECIFY                                                    1832
*       REG1 UNRSTD;                /* FREE REG1             @Y30LB26*/
*     IF RPLVRETC^=RCZERO THEN      /* CK RETURN CODE        @Y30LB26*/
         L     @04,RPLVPTR                                         1833
         CLC   RPLVRETC(2,@04),@CB00747                            1833
         BE    @RF01833                                            1833
*       DO;                         /*                       @Y30LB26*/
*         CALL ERREXIT;             /* SAVE RETURN CODES     @Y30LB26*/
         BAL   @14,ERREXIT                                         1835
*         RETURN;                   /*                       @Y30LB26*/
@EL00027 DS    0H                                                  1836
@EF00027 DS    0H                                                  1836
@ER00027 L     @14,@SA00027                                        1836
         BR    @14                                                 1836
*       END;                        /*                       @Y30LB26*/
*                                                                  1837
*     /***************************************************************/
*     /*                                                             */
*     /* SET UP ADDRESSING TO RECORD JUST READ AND           @Y30LB26*/
*     /* SEE IF IT IS STILL A COPY RECORD                    @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  1838
*     COPYVPTR=RPLVBUF;             /* ADDR RECORD           @Y30LB26*/
@RF01833 L     @04,RPLVPTR                                         1838
         L     @04,RPLVBUF(,@04)                                   1838
         ST    @04,COPYVPTR                                        1838
*     IF COPV=VKY&COPSERNO=VOLKY THEN/* STILL COPY REC?      @Y30LB26*/
         CLC   COPV(5,@04),VKY                                     1839
         BNE   @RF01839                                            1839
         CLC   COPSERNO(6,@04),VOLKY                               1839
         BNE   @RF01839                                            1839
*       DO;                         /*                       @Y30LB26*/
*                                                                  1840
*         /***********************************************************/
*         /*                                                         */
*         /* IF IT IS A COPY AND A BACKUP, GET BUFFER        @Y30LB26*/
*         /* AND RETURN RECORD                               @Y30LB26*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  1841
*         IF COPBKUP=ON&COPHOLD=OFF THEN/* BACKUP COPY       @Y30LB26*/
         TM    COPBKUP(@04),B'00001000'                            1841
         BNO   @RF01841                                            1841
         TM    COPHOLD(@04),B'10000000'                            1841
         BNZ   @RF01841                                            1841
*           DO;                     /*                       @Y30LB26*/
*             CALL GETBUF;          /* GET CORE              @Y30LB26*/
         BAL   @14,GETBUF                                          1843
*             IF RPLVRETC^=RCZERO THEN/* CK RETURN           @Y30LB26*/
         L     @04,RPLVPTR                                         1844
         CLC   RPLVRETC(2,@04),@CB00747                            1844
         BNE   @RT01844                                            1844
*               RETURN;             /*                       @Y30LB26*/
*             BUFFER=COPYV;         /* MOVE IN RECORD        @Y30LB26*/
         L     @02,RVVAREA(,RVVIPTR)                               1846
         MVI   BUFFER+164(@02),C' '                                1846
         MVC   BUFFER+165(91,@02),BUFFER+164(@02)                  1846
         L     @01,COPYVPTR                                        1846
         MVC   BUFFER(164,@02),COPYV(@01)                          1846
*             RPLRCODE=RCZERO;      /* GOOD REASON CODE      @Y30LB26*/
         MVC   RPLRCODE(2,@04),@CB00747                            1847
*             RPLVRETC=RCZERO;      /* GOOD RETURN CODE      @Y30LB26*/
         MVC   RPLVRETC(2,@04),@CB00747                            1848
*             RETURN;               /*                       @Y30LB26*/
         B     @EL00027                                            1849
*           END;                    /*                       @Y30LB26*/
*                                                                  1850
*         /***********************************************************/
*         /*                                                         */
*         /* THIS IS NOT A BACKUP, SO SET UP KEY AND GO      @Y30LB26*/
*         /* AND TRY ANOTHER COPY RECORD                     @Y30LB26*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  1851
*         ELSE                      /*                       @Y30LB26*/
*           VKEY=COPNAME;           /* READY NEXT READ       @Y30LB26*/
@RF01841 L     @04,COPYVPTR                                        1851
         MVC   VKEY(13),COPNAME(@04)                               1851
*       END;                        /*                       @Y30LB26*/
*                                                                  1852
*     /***************************************************************/
*     /*                                                             */
*     /* NO LONGER COPY RECORDS AND A BACKUP WAS NOT FOUND,  @Y30LB26*/
*     /* SO SET REASON CODE INDICATING RECORD WAS NOT        @Y30LB26*/
*     /* FOUND AND RETURN                                    @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  1853
*     ELSE                          /*                       @Y30LB26*/
*       DO;                         /*                       @Y30LB26*/
         B     @RC01839                                            1853
@RF01839 DS    0H                                                  1854
*         RPLRCODE=NORECRC;         /* NO DUPLICATE          @Y30LB26*/
         L     @02,RPLVPTR                                         1854
         MVC   RPLRCODE(2,@02),@CB00789                            1854
*         RPLVRETC=FOUR;            /* BAD RETURN CODE       @Y30LB26*/
         MVC   RPLVRETC(2,@02),@CB00749                            1855
*         CALL ERREXIT;             /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         1856
*         RETURN;                   /*                       @Y30LB26*/
         B     @EL00027                                            1857
*       END;                        /*                       @Y30LB26*/
*   END;                            /*                       @Y30LB26*/
@RC01839 DS    0H                                                  1859
@DE01822 CLC   I(1),I                                              1859
         BE    @DL01822                                            1859
*   END OLDBKUP;                    /*                       @Y30LB26*/
         B     @EL00027                                            1860
*                                                                  1861
*   /*****************************************************************/
*   /*                                                               */
*   /* ROUTINE READS AND RETURNS THE LATEST COPY             @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1861
*LATECPY:                                                          1861
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
*                                                                  1861
LATECPY  ST    @14,@SA00028                                        1861
*   /*****************************************************************/
*   /*                                                               */
*   /* RESERVE INVENTORY SHARED                              @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1862
*   CALL RESSHARE;                  /*                       @Y30LB26*/
*                                                                  1862
         BAL   @14,RESSHARE                                        1862
*   /*****************************************************************/
*   /*                                                               */
*   /* READ BASE VOLUME RECORD TO GET KEY TO LATEST          @Y30LB26*/
*   /* COPY OF VOLUME                                        @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1863
*   VOLKY=RVVOLUME;                 /* BUILD KEY             @Y30LB26*/
         MVC   VOLKY(6),RVVOLUME(RVVIPTR)                          1863
*   RPLVKEY=ADDR(VKEY);             /* ADDR KEY              @Y30LB26*/
         L     @04,RPLVPTR                                         1864
         LA    @02,VKEY                                            1864
         ST    @02,RPLVKEY(,@04)                                   1864
*   RPLVLOC=ON;                     /* LOCATE MODE           @Y30LB26*/
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB26*/
         OI    RPLVLOC(@04),B'11000000'                            1866
*   RPLVTYP=RPLVREAD;               /* READ RECORD           @Y30LB26*/
         MVI   RPLVTYP(@04),X'00'                                  1867
*   RESPECIFY                                                      1868
*     REG1 RSTD;                    /* RESTRICT REG1         @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR RPLV             @Y30LB26*/
         LR    REG1,@04                                            1869
*   CALL ICBVIO00;                  /* READ BASE REC         @Y30LB26*/
         L     @15,@CV00671                                        1870
         BALR  @14,@15                                             1870
*   RESPECIFY                                                      1871
*     REG1 UNRSTD;                  /* FREE REG1             @Y30LB26*/
*   IF RPLVRETC^=RCZERO THEN        /* CK RETURN CODE        @Y30LB26*/
         L     @04,RPLVPTR                                         1872
         CLC   RPLVRETC(2,@04),@CB00747                            1872
         BE    @RF01872                                            1872
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         1874
*       RETURN;                     /*                       @Y30LB26*/
@EL00028 DS    0H                                                  1875
@EF00028 DS    0H                                                  1875
@ER00028 L     @14,@SA00028                                        1875
         BR    @14                                                 1875
*     END;                          /*                       @Y30LB26*/
*                                                                  1876
*   /*****************************************************************/
*   /*                                                               */
*   /* SET UP ADDRESSING TO RECORD AND GET LATEST COPY KEY   @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1877
*   BASEVPTR=RPLVBUF;               /* ADD REC JUST READ     @Y30LB26*/
*                                                                  1877
@RF01872 L     @04,RPLVPTR                                         1877
         L     @02,RPLVBUF(,@04)                                   1877
         ST    @02,BASEVPTR                                        1877
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK TO SEE IF THERE REALLY IS A COPY THERE          @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1878
*   IF BASNCOPY=ZERO THEN           /* NO COPIES ?           @Y30LB26*/
         CLI   BASNCOPY(@02),0                                     1878
         BNE   @RF01878                                            1878
*     DO;                           /*                       @Y30LB26*/
*       RPLVRETC=FOUR;              /* BAD RETURN CODE       @Y30LB26*/
         MVC   RPLVRETC(2,@04),@CB00749                            1880
*       RPLRCODE=NORECRC;           /* RECORD DOES NOT EXIST @Y30LB26*/
         MVC   RPLRCODE(2,@04),@CB00789                            1881
*       CALL ERREXIT;               /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         1882
*       RETURN;                     /* RETURN TO CALLER      @Y30LB26*/
         B     @EL00028                                            1883
*     END;                          /*                       @Y30LB26*/
*   ELSE                            /*                       @Y30LB26*/
*     VKEY=BASKLCPY;                /* GET KEY LATEST CPY    @Y30LB26*/
@RF01878 L     @04,BASEVPTR                                        1885
         MVC   VKEY(13),BASKLCPY(@04)                              1885
*   RPLVKEY=ADDR(VKEY);             /* ADDR KEY              #Y30LB26*/
         L     @04,RPLVPTR                                         1886
         LA    @02,VKEY                                            1886
         ST    @02,RPLVKEY(,@04)                                   1886
*   RESPECIFY                                                      1887
*     REG1 RSTD;                    /* RESTRICT REG1         @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR OF RPLV          @Y30LB26*/
         LR    REG1,@04                                            1888
*   CALL ICBVIO00;                  /* READ LATEST COPY      @Y30LB26*/
         L     @15,@CV00671                                        1889
         BALR  @14,@15                                             1889
*   RESPECIFY                                                      1890
*     REG1 UNRSTD;                  /* FREE REG 1            @Y30LB26*/
*                                                                  1890
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK RETURN CODE FROM I/O PROCESSOR                  @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1891
*   IF RPLVRETC^=RCZERO THEN        /* CK RETURN CODE        @Y30LB26*/
         L     @04,RPLVPTR                                         1891
         CLC   RPLVRETC(2,@04),@CB00747                            1891
         BE    @RF01891                                            1891
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* SAVE RETURN CODE      @Y30LB26*/
         BAL   @14,ERREXIT                                         1893
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00028                                            1894
*     END;                          /*                       @Y30LB26*/
*                                                                  1895
*   /*****************************************************************/
*   /*                                                               */
*   /* SET UP ADDRESSING TO RECORD AND GET BUFFER            @Y30LB26*/
*   /* PUT RECORD IN BUFFER AND RETURN                       @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1896
*   COPYVPTR=RPLVBUF;               /* ADDR RECORD READ      @Y30LB26*/
@RF01891 L     @04,RPLVPTR                                         1896
         L     @04,RPLVBUF(,@04)                                   1896
         ST    @04,COPYVPTR                                        1896
*   CALL GETBUF;                    /* GET CORE              @Y30LB26*/
         BAL   @14,GETBUF                                          1897
*   IF RPLVRETC^=RCZERO THEN        /* CK RETURN             @Y30LB26*/
         L     @04,RPLVPTR                                         1898
         CLC   RPLVRETC(2,@04),@CB00747                            1898
         BNE   @RT01898                                            1898
*     RETURN;                       /*                       @Y30LB26*/
*   BUFFER=COPYV;                   /* MOVE IN RECORD        @Y30LB26*/
         L     @02,RVVAREA(,RVVIPTR)                               1900
         MVI   BUFFER+164(@02),C' '                                1900
         MVC   BUFFER+165(91,@02),BUFFER+164(@02)                  1900
         L     @01,COPYVPTR                                        1900
         MVC   BUFFER(164,@02),COPYV(@01)                          1900
*   RPLVRETC=RCZERO;                /* GOOD RETURN           @Y30LB26*/
         MVC   RPLVRETC(2,@04),@CB00747                            1901
*   RPLRCODE=RCZERO;                /* GOOD REASON CODE      @Y30LB26*/
         MVC   RPLRCODE(2,@04),@CB00747                            1902
*   RETURN;                         /*                       @Y30LB26*/
         B     @EL00028                                            1903
*   END LATECPY;                    /*                       @Y30LB26*/
         B     @EL00028                                            1904
*                                                                  1905
*   /*****************************************************************/
*   /*                                                               */
*   /* THIS ROUTINE READS NEXT FOR A COPY RECORD             @Y30LB26*/
*   /* A COPYID MUST BE SPECIFIED FOR THIS OPTION            @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1905
*COPYNREC:                                                         1905
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
*                                                                  1905
COPYNREC ST    @14,@SA00029                                        1905
*   /*****************************************************************/
*   /*                                                               */
*   /* INSURE THAT COPYID WAS GIVEN                          @Y30LB26*/
*   /* IF NOT GIVEN, SET BAD REASON CODE AND RETURN          @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1906
*   IF RVVSCPY=OFF THEN             /* COPYID SPECIFIED      @Y30LB26*/
         TM    RVVSCPY(RVVIPTR),B'00000100'                        1906
         BNZ   @RF01906                                            1906
*     DO;                           /*                       @Y30LB26*/
*       RPLVRETC=FOUR;              /* BAD RET CODE          @Y30LB26*/
         L     @02,RPLVPTR                                         1908
         MVC   RPLVRETC(2,@02),@CB00749                            1908
*       RPLRCODE=NOCPYID;           /* MUST SPEC COPY ID     @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00815                            1909
*       RETURN;                     /*                       @Y30LB26*/
@EL00029 DS    0H                                                  1910
@EF00029 DS    0H                                                  1910
@ER00029 L     @14,@SA00029                                        1910
         BR    @14                                                 1910
*     END;                          /*                       @Y30LB26*/
*                                                                  1911
*   /*****************************************************************/
*   /*                                                               */
*   /* RESERVE INVENTORY DATA SET SHARED                     @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1912
*   CALL RESSHARE;                  /*                       @Y30LB26*/
*                                                                  1912
@RF01906 BAL   @14,RESSHARE                                        1912
*   /*****************************************************************/
*   /*                                                               */
*   /* PUT IN COPYID AND VOLUME NAME IN KEY TO READ          @Y30LB26*/
*   /* GREATER THAN OR EQUAL                                 @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1913
*   VIDKY=RVVCPYID;                 /* ID TO KEY             @Y30LB26*/
         MVC   VIDKY(1),RVVCPYID(RVVIPTR)                          1913
*   VOLKY=RVVOLUME;                 /* VOLUME NAME           @Y30LB26*/
*                                                                  1914
         MVC   VOLKY(6),RVVOLUME(RVVIPTR)                          1914
*   /*****************************************************************/
*   /*                                                               */
*   /* LOOP TO FIND THE CORRECT COPY VOLUME RECORD           @ZDR2053*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1915
*   DO WHILE I=I;                   /*                       @ZDR2053*/
         B     @DE01915                                            1915
@DL01915 DS    0H                                                  1916
*     VIDKY=VIDKY+FIXONE;           /* INCREM ID FIELD       @Y30LB26*/
         LA    @04,1                                               1916
         SLR   @02,@02                                             1916
         IC    @02,VIDKY                                           1916
         ALR   @04,@02                                             1916
         STC   @04,VIDKY                                           1916
*     RPLVKEY=ADDR(VKEY);           /* ADDR OF KEY           @Y30LB26*/
         L     @04,RPLVPTR                                         1917
         LA    @02,VKEY                                            1917
         ST    @02,RPLVKEY(,@04)                                   1917
*     RPLVLOC=ON;                   /* LOCATE MODE           @Y30LB26*/
*     RPLVDIR=ON;                   /* READ DIRECT           @Y30LB26*/
         OI    RPLVLOC(@04),B'11000000'                            1919
*     RPLVTYP=RPLVREAD;             /* READ RECORD           @Y30LB26*/
         MVI   RPLVTYP(@04),X'00'                                  1920
*     RPLVKGE=ON;                   /* FOR > OR =            @Y30LB26*/
         OI    RPLVKGE(@04),B'00000100'                            1921
*     RESPECIFY                                                    1922
*       REG1 RSTD;                  /* RESTRICT REG1         @Y30LB26*/
*     REG1=RPLVPTR;                 /* ADDR RPLV             @Y30LB26*/
         LR    REG1,@04                                            1923
*     CALL ICBVIO00;                /* READ COPY             @Y30LB26*/
         L     @15,@CV00671                                        1924
         BALR  @14,@15                                             1924
*     RESPECIFY                                                    1925
*       REG1 UNRSTD;                /* FREE REG1             @Y30LB26*/
*                                                                  1925
*     /***************************************************************/
*     /*                                                             */
*     /* CHECK RETURN CODE FROM I/O PROCESSOR                @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  1926
*     IF RPLVRETC^=RCZERO THEN      /* CK RETURN CODE        @Y30LB26*/
         L     @04,RPLVPTR                                         1926
         CLC   RPLVRETC(2,@04),@CB00747                            1926
         BE    @RF01926                                            1926
*       DO;                         /*                       @Y30LB26*/
*         CALL ERREXIT;             /* SAVE REASON CODE      @Y30LB26*/
         BAL   @14,ERREXIT                                         1928
*         RETURN;                   /*                       @Y30LB26*/
         B     @EL00029                                            1929
*       END;                        /*                       @Y30LB26*/
*                                                                  1930
*     /***************************************************************/
*     /*                                                             */
*     /* GET ADDRESS OF RECORD JUST READ AND CHECK TO SEE IF @Y30LB26*/
*     /* IT IS STILL A COPY RECORD OF CORRECT VOLUME         @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  1931
*     COPYVPTR=RPLVBUF;             /* ADDR RECORD           @Y30LB26*/
@RF01926 L     @04,RPLVPTR                                         1931
         L     @04,RPLVBUF(,@04)                                   1931
         ST    @04,COPYVPTR                                        1931
*     IF COPV=VKY&COPSERNO=VOLKY THEN/* STILL                @ZDR2053*/
         CLC   COPV(5,@04),VKY                                     1932
         BNE   @RF01932                                            1932
         CLC   COPSERNO(6,@04),VOLKY                               1932
         BNE   @RF01932                                            1932
*       DO;                         /*                       @ZDR2053*/
*                                                                  1933
*         /***********************************************************/
*         /*                                                         */
*         /* CHECK FOR THE CORRECT RECORD                    @ZDR2053*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  1934
*         IF RVVALL=ON(COPHOLD=ON&RVVCPLHD=ON)/*           @ZDR2053*/
*             (RVVCPLHD=OFF&COPHOLD=OFF) THEN/*              @ZDR2053*/
*                                                                  1934
         TM    RVVALL(RVVIPTR),B'00000001'                         1934
         BO    @RT01934                                            1934
         TM    COPHOLD(@04),B'10000000'                            1934
         BNO   @GL00036                                            1934
         TM    RVVCPLHD(RVVIPTR),B'00010000'                       1934
         BO    @RT01934                                            1934
@GL00036 TM    RVVCPLHD(RVVIPTR),B'00010000'                       1934
         BNZ   @RF01934                                            1934
         L     @04,COPYVPTR                                        1934
         TM    COPHOLD(@04),B'10000000'                            1934
         BNZ   @RF01934                                            1934
@RT01934 DS    0H                                                  1935
*           /*********************************************************/
*           /*                                                       */
*           /* IF STILL THE CORRECT COPY, GET BUFFER SPACE   @Y30LB26*/
*           /* RETURN RECORD                                 @Y30LB26*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1935
*           DO;                     /*                       @Y30LB26*/
*             CALL GETBUF;          /* GET SPACE             @Y30LB26*/
         BAL   @14,GETBUF                                          1936
*             IF RPLVRETC^=RCZERO THEN/* CK RETURN           @Y30LB26*/
         L     @04,RPLVPTR                                         1937
         CLC   RPLVRETC(2,@04),@CB00747                            1937
         BNE   @RT01937                                            1937
*               RETURN;             /*                       @Y30LB26*/
*             BUFFER=COPYV;         /* MOVE IN RECORD        @Y30LB26*/
         L     @02,RVVAREA(,RVVIPTR)                               1939
         MVI   BUFFER+164(@02),C' '                                1939
         MVC   BUFFER+165(91,@02),BUFFER+164(@02)                  1939
         L     @01,COPYVPTR                                        1939
         MVC   BUFFER(164,@02),COPYV(@01)                          1939
*             RPLVRETC=RCZERO;      /* GOOD RET CODE         @Y30LB26*/
         MVC   RPLVRETC(2,@04),@CB00747                            1940
*             RPLRCODE=RCZERO;      /* GOOD REASON CODE      @Y30LB26*/
         MVC   RPLRCODE(2,@04),@CB00747                            1941
*             RETURN;               /*                       @Y30LB26*/
         B     @EL00029                                            1942
*           END;                    /*                       @Y30LB26*/
*         ELSE                      /*                       @Y30LB26*/
*                                                                  1944
*           /*********************************************************/
*           /*                                                       */
*           /* SET UP TO READ THE NEXT COPY VOLUME RECORD    @ZDR2053*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1944
*           VKEY=COPNAME;           /*                       @ZDR2053*/
@RF01934 L     @04,COPYVPTR                                        1944
         MVC   VKEY(13),COPNAME(@04)                               1944
*       END;                        /*                       @ZDR2053*/
*                                                                  1945
*     /***************************************************************/
*     /*                                                             */
*     /* BAD RETURN CODE AND INDICATE NO RECORD FOUND        @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  1946
*     ELSE                                                         1946
*       DO;                         /*                       @Y30LB26*/
         B     @RC01932                                            1946
@RF01932 DS    0H                                                  1947
*         RPLVRETC=FOUR;            /* BAD RETURN            @Y30LB26*/
         L     @02,RPLVPTR                                         1947
         MVC   RPLVRETC(2,@02),@CB00749                            1947
*         RPLRCODE=NORECRC;         /* NO NEXT COPY          @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00789                            1948
*         CALL ERREXIT;             /* SAVE REASON CODE      @Y30LB26*/
         BAL   @14,ERREXIT                                         1949
*         RETURN;                   /*                       @Y30LB26*/
         B     @EL00029                                            1950
*       END;                        /*                       @Y30LB26*/
*   END;                            /*                       @ZDR2053*/
@RC01932 DS    0H                                                  1952
@DE01915 CLC   I(1),I                                              1952
         BE    @DL01915                                            1952
*   END COPYNREC;                   /*                       @Y30LB26*/
         B     @EL00029                                            1953
*                                                                  1954
*   /*****************************************************************/
*   /*                                                               */
*   /* ROUTINE READS FOR A DUPLICATE VOLUME RECORD. IF       @Y30LB26*/
*   /* THE FIRST DUP RECORD IS DESIRED, A READ NEXT          @Y30LB26*/
*   /* MUST BE SPECIFIED INSTEAD OF A READ DIRECT            @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1954
*DUPDIR:                                                           1954
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
*                                                                  1954
DUPDIR   ST    @14,@SA00030                                        1954
*   /*****************************************************************/
*   /*                                                               */
*   /* RESERVE INVENTORY DATA SET SHARED                     @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1955
*   CALL RESSHARE;                  /*                       @Y30LB26*/
*                                                                  1955
         BAL   @14,RESSHARE                                        1955
*   /*****************************************************************/
*   /*                                                               */
*   /* SET KEY ID TO ONE AND READ FOR GREATER                @Y30LB26*/
*   /* THAN OR EQUAL                                         @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1956
*   DVOLKY=RVVOLUME;                /* GET VOLUME            @Y30LB26*/
         MVC   DVOLKY(6),RVVOLUME(RVVIPTR)                         1956
*   DIDKY=FIXONE;                   /* SET ID TO FIRST REG   @Y30LB26*/
         MVI   DIDKY,X'01'                                         1957
*   RPLVKEY=ADDR(DKEY);             /* ADDR LEU              @Y30LB26*/
         L     @04,RPLVPTR                                         1958
         LA    @02,DKEY                                            1958
         ST    @02,RPLVKEY(,@04)                                   1958
*   RPLVLOC=ON;                     /* LOCATION MODE         @Y30LB26*/
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB26*/
         OI    RPLVLOC(@04),B'11000000'                            1960
*   RPLVTYP=RPLVREAD;               /* READ RECORD           @Y30LB26*/
         MVI   RPLVTYP(@04),X'00'                                  1961
*   RPLVKGE=ON;                     /* READ > OR =           @Y30LB26*/
         OI    RPLVKGE(@04),B'00000100'                            1962
*   RESPECIFY                                                      1963
*     REG1 RSTD;                    /* RESTRICT REG 1        @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR RPLV             @Y30LB26*/
         LR    REG1,@04                                            1964
*   CALL ICBVIO00;                  /* READ FOR DUP          @Y30LB26*/
         L     @15,@CV00671                                        1965
         BALR  @14,@15                                             1965
*   RESPECIFY                                                      1966
*     REG1 UNRSTD;                  /* FREE REG 1            @Y30LB26*/
*                                                                  1966
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR BAD RETURN CODE FROM I/O PROCESSOR          @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1967
*   IF RPLVRETC^=RCZERO THEN        /* CK RETURN CODE        @Y30LB26*/
         L     @04,RPLVPTR                                         1967
         CLC   RPLVRETC(2,@04),@CB00747                            1967
         BE    @RF01967                                            1967
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* SAVE RETURN CODES     @Y30LB26*/
         BAL   @14,ERREXIT                                         1969
*       RETURN;                     /*                       @Y30LB26*/
@EL00030 DS    0H                                                  1970
@EF00030 DS    0H                                                  1970
@ER00030 L     @14,@SA00030                                        1970
         BR    @14                                                 1970
*     END;                          /*                       @Y30LB26*/
*                                                                  1971
*   /*****************************************************************/
*   /*                                                               */
*   /* SET UP ADDRESSING TO DUP RECORD JUST READ             @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1972
*   DUPVPTR=RPLVBUF;                /* ADDR RECORD           @Y30LB26*/
*                                                                  1972
@RF01967 L     @04,RPLVPTR                                         1972
         L     @04,RPLVBUF(,@04)                                   1972
         ST    @04,DUPVPTR                                         1972
*   /*****************************************************************/
*   /*                                                               */
*   /* IF IT IS THE CORRECT DUPLICATE RECORD, GET A BUFFER   @Y30LB26*/
*   /* AND RETURN RECORD                                     @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1973
*   IF DUPD=DKY&DUPSERNO=DVOLKY THEN/*                       @Y30LB26*/
         CLC   DUPD(5,@04),DKY                                     1973
         BNE   @RF01973                                            1973
         CLC   DUPSERNO(6,@04),DVOLKY                              1973
         BNE   @RF01973                                            1973
*     DO;                           /*                       @Y30LB26*/
*       CALL GETBUF;                /* GET SPACE             @Y30LB26*/
         BAL   @14,GETBUF                                          1975
*       IF RPLVRETC^=RCZERO THEN    /* CK RETURN             @Y30LB26*/
         L     @04,RPLVPTR                                         1976
         CLC   RPLVRETC(2,@04),@CB00747                            1976
         BNE   @RT01976                                            1976
*         RETURN;                   /* RETURN TO CALLER      @Y30LB26*/
*       BUFFER=DUPV;                /* MOVE IN REC           @Y30LB26*/
         L     @02,RVVAREA(,RVVIPTR)                               1978
         MVI   BUFFER+65(@02),C' '                                 1978
         MVC   BUFFER+66(190,@02),BUFFER+65(@02)                   1978
         L     @01,DUPVPTR                                         1978
         MVC   BUFFER(65,@02),DUPV(@01)                            1978
*       RPLVRETC=RCZERO;            /* GOOD RETURN CODE      @Y30LB26*/
         MVC   RPLVRETC(2,@04),@CB00747                            1979
*       RPLRCODE=RCZERO;            /* GOOD REASON CODE      @Y30LB26*/
         MVC   RPLRCODE(2,@04),@CB00747                            1980
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00030                                            1981
*     END;                          /*                       @Y30LB26*/
*   ELSE                            /*                       @Y30LB26*/
*                                                                  1983
*     /***************************************************************/
*     /*                                                             */
*     /* IF NO LONGER A DUP RECORD OF THE CORRECT VOLUME     @Y30LB26*/
*     /* SET BAD RETURN CODE AND INDICATE RECORD NOT FOUND   @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  1983
*     DO;                           /*                       @Y30LB26*/
@RF01973 DS    0H                                                  1984
*       RPLVRETC=FOUR;              /* BAD RC                @Y30LB26*/
         L     @02,RPLVPTR                                         1984
         MVC   RPLVRETC(2,@02),@CB00749                            1984
*       RPLRCODE=NORECRC;           /* RECORD NOT FOUND      @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00789                            1985
*       CALL ERREXIT;               /*                       @Y30LB26*/
         BAL   @14,ERREXIT                                         1986
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00030                                            1987
*     END;                          /*                       @Y30LB26*/
*   END DUPDIR;                     /*                       @Y30LB26*/
         B     @EL00030                                            1989
*                                                                  1990
*   /*****************************************************************/
*   /*                                                               */
*   /* ROUTINE READ NEXT FOR DUPLICATE VOL RECORD            @Y30LB26*/
*   /* IF NO VOLID IS GIVEN, IT WILL READ THE FIRST          @Y30LB26*/
*   /* DUPLICATE RECORD IN THE DATA SET                      @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1990
*DUPNREC:                                                          1990
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
*                                                                  1990
DUPNREC  ST    @14,@SA00031                                        1990
*   /*****************************************************************/
*   /*                                                               */
*   /* RESERVE INVENTORY SHARED                              @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1991
*   CALL RESSHARE;                  /*                       @Y30LB26*/
         BAL   @14,RESSHARE                                        1991
*   IF RVVSVOL=OFF THEN             /* VOLID SPECIFIED       @Y30LB26*/
         TM    RVVSVOL(RVVIPTR),B'00000001'                        1992
         BNZ   @RF01992                                            1992
*     DO;                           /*                       @Y30LB26*/
*       DVOLKY=ZEROCHAR;            /* ZERO VOLID            @Y30LB26*/
         MVC   DVOLKY(6),ZEROCHAR                                  1994
*       DIDKY=DIDKY+FIXONE;         /* SET ID FIELD          @Y30LB26*/
         LA    @04,1                                               1995
         SLR   @02,@02                                             1995
         IC    @02,DIDKY                                           1995
         ALR   @04,@02                                             1995
         STC   @04,DIDKY                                           1995
*     END;                          /*                       @Y30LB26*/
*   ELSE                            /*                       @Y30LB26*/
*     DO;                           /*                       @Y30LB26*/
         B     @RC01992                                            1997
@RF01992 DS    0H                                                  1998
*       IF RVVSDUP=OFF THEN         /* DUP ID NOT SPEC       @Y30LB26*/
         TM    RVVSDUP(RVVIPTR),B'00000010'                        1998
         BNZ   @RF01998                                            1998
*         DO;                       /*                       @Y30LB26*/
*           RPLVRETC=FOUR;          /* BAD RETURN CODE       @Y30LB26*/
         L     @02,RPLVPTR                                         2000
         MVC   RPLVRETC(2,@02),@CB00749                            2000
*           RPLRCODE=NODUPID;       /* DUP ID NOT GIVEN      @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00811                            2001
*           CALL ERREXIT;           /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         2002
*           RETURN;                 /*                       @Y30LB26*/
@EL00031 DS    0H                                                  2003
@EF00031 DS    0H                                                  2003
@ER00031 L     @14,@SA00031                                        2003
         BR    @14                                                 2003
*         END;                      /*                       @Y30LB26*/
*       DVOLKY=RVVOLUME;            /* GET VOLID             @Y30LB26*/
@RF01998 MVC   DVOLKY(6),RVVOLUME(RVVIPTR)                         2005
*       DIDKY=RVVDUPID;             /* GET FIRST ID          @Y30LB26*/
         SLR   @04,@04                                             2006
         IC    @04,RVVDUPID(,RVVIPTR)                              2006
         STC   @04,DIDKY                                           2006
*       DIDKY=DIDKY+FIXONE;         /* GET TO NEXT           @Y30LB26*/
         AL    @04,@CF00041                                        2007
         STC   @04,DIDKY                                           2007
*     END;                          /*                       @Y30LB26*/
*   RPLVKEY=ADDR(DKEY);             /* ADDR KEY              @Y30LB26*/
@RC01992 L     @04,RPLVPTR                                         2009
         LA    @02,DKEY                                            2009
         ST    @02,RPLVKEY(,@04)                                   2009
*   RPLVLOC=ON;                     /* LOCATE MODE           @Y30LB26*/
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB26*/
         OI    RPLVLOC(@04),B'11000000'                            2011
*   RPLVTYP=RPLVREAD;               /* READ RECORD           @Y30LB26*/
         MVI   RPLVTYP(@04),X'00'                                  2012
*   RPLVKGE=ON;                     /* READ > OR =           @Y30LB26*/
         OI    RPLVKGE(@04),B'00000100'                            2013
*   RESPECIFY                                                      2014
*     REG1 RSTD;                    /* RESTRICT REG1         @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR RPLV             @Y30LB26*/
         LR    REG1,@04                                            2015
*   CALL ICBVIO00;                  /* READ DUP RECORD       @Y30LB26*/
         L     @15,@CV00671                                        2016
         BALR  @14,@15                                             2016
*   RESPECIFY                                                      2017
*     REG1 UNRSTD;                  /* FREE REG1             @Y30LB26*/
*                                                                  2017
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK RETURN CODE FROM I/O PROCESSOR                  @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2018
*   IF RPLVRETC^=RCZERO THEN        /*                       @Y30LB26*/
         L     @04,RPLVPTR                                         2018
         CLC   RPLVRETC(2,@04),@CB00747                            2018
         BE    @RF02018                                            2018
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /*                       @Y30LB26*/
         BAL   @14,ERREXIT                                         2020
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00031                                            2021
*     END;                          /*                       @Y30LB26*/
*                                                                  2022
*   /*****************************************************************/
*   /*                                                               */
*   /* SET UP ADDRESSING TO RECORD JUST READ                 @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2023
*   DUPVPTR=RPLVBUF;                /* ADDR RECORD           @Y30LB26*/
*                                                                  2023
@RF02018 L     @04,RPLVPTR                                         2023
         L     @04,RPLVBUF(,@04)                                   2023
         ST    @04,DUPVPTR                                         2023
*   /*****************************************************************/
*   /*                                                               */
*   /* SEE IF ONLY RECORD OF SPECIFIED VOLID IS              @Y30LB26*/
*   /* TO BE RETURNED                                        @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2024
*   IF RVVDVOL=ON THEN              /* READ ONLY SPEC VOL    @Y30LB26*/
         TM    RVVDVOL(RVVIPTR),B'00000010'                        2024
         BNO   @RF02024                                            2024
*     DO;                           /*                       @Y30LB26*/
*                                                                  2025
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK TO SEE IF STILL DUP AND OF CORRECT VOLUME   @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  2026
*       IF DUPD=DKY&DUPSERNO=DVOLKY THEN/* DUP RECORD        @Y30LB26*/
         CLC   DUPD(5,@04),DKY                                     2026
         BNE   @RF02026                                            2026
         CLC   DUPSERNO(6,@04),DVOLKY                              2026
         BNE   @RF02026                                            2026
*         DO;                       /*                       @Y30LB26*/
*                                                                  2027
*           /*********************************************************/
*           /*                                                       */
*           /* IF RECORD MEETS TEST, GET BUFFER              @Y30LB26*/
*           /* AND RETURN RECORD                             @Y30LB26*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  2028
*           CALL GETBUF;            /* GET CORE              @Y30LB26*/
         BAL   @14,GETBUF                                          2028
*           IF RPLVRETC^=RCZERO THEN/* CK RETURN             @Y30LB26*/
         L     @04,RPLVPTR                                         2029
         CLC   RPLVRETC(2,@04),@CB00747                            2029
         BNE   @RT02029                                            2029
*             RETURN;               /*                       @Y30LB26*/
*           BUFFER=DUPV;            /* MOVE IN RECORD        @Y30LB26*/
         L     @02,RVVAREA(,RVVIPTR)                               2031
         MVI   BUFFER+65(@02),C' '                                 2031
         MVC   BUFFER+66(190,@02),BUFFER+65(@02)                   2031
         L     @01,DUPVPTR                                         2031
         MVC   BUFFER(65,@02),DUPV(@01)                            2031
*           RPLVRETC=RCZERO;        /* GOOD RETURN CODE      @Y30LB26*/
         MVC   RPLVRETC(2,@04),@CB00747                            2032
*           RPLRCODE=RCZERO;        /* GOOD REASON CODE      @Y30LB26*/
         MVC   RPLRCODE(2,@04),@CB00747                            2033
*           RETURN;                 /*                       @Y30LB26*/
         B     @EL00031                                            2034
*         END;                      /*                       @Y30LB26*/
*       ELSE                        /*                       @Y30LB26*/
*                                                                  2036
*         /***********************************************************/
*         /*                                                         */
*         /* IF NOT CORRECT RECORD, SET BAD RETURN CODE      @Y30LB26*/
*         /* AND INDICATE RECORD NOT FOUND                   @Y30LB26*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  2036
*         DO;                       /*                       @Y30LB26*/
@RF02026 DS    0H                                                  2037
*           RPLVRETC=FOUR;          /* BAD RC                @Y30LB26*/
         L     @02,RPLVPTR                                         2037
         MVC   RPLVRETC(2,@02),@CB00749                            2037
*           RPLRCODE=NORECRC;       /* RECORD NOT FOUND      @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00789                            2038
*           CALL ERREXIT;           /* SAVE RETURN CODE      @Y30LB26*/
         BAL   @14,ERREXIT                                         2039
*           RETURN;                 /*                       @Y30LB26*/
         B     @EL00031                                            2040
*         END;                      /*                       @Y30LB26*/
*     END;                          /*                       @Y30LB26*/
*   ELSE                            /*                       @Y30LB26*/
*                                                                  2043
*     /***************************************************************/
*     /*                                                             */
*     /* IF NOT READING FOR A SPECIFIC VOLUME                @Y30LB26*/
*     /* JUST CHECK TO SEE IF IT IS A DUPLICATE              @Y30LB26*/
*     /* RECORD AND IF IT IS, GET BUFFER SPACE               @Y30LB26*/
*     /* AND RETURN RECORD                                   @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  2043
*     DO;                           /*                       @Y30LB26*/
@RF02024 DS    0H                                                  2044
*       IF DUPD=DKY THEN            /* IS DUP REC            @Y30LB26*/
         L     @04,DUPVPTR                                         2044
         CLC   DUPD(5,@04),DKY                                     2044
         BNE   @RF02044                                            2044
*         DO;                       /*                       @Y30LB26*/
*           CALL GETBUF;            /* GET CORE              @Y30LB26*/
         BAL   @14,GETBUF                                          2046
*           IF RPLVRETC^=RCZERO THEN/* CK RETURN             @Y30LB26*/
         L     @04,RPLVPTR                                         2047
         CLC   RPLVRETC(2,@04),@CB00747                            2047
         BNE   @RT02047                                            2047
*             RETURN;               /*                       @Y30LB26*/
*           BUFFER=DUPV;            /* MOVE IN RECORD        @Y30LB26*/
         L     @02,RVVAREA(,RVVIPTR)                               2049
         MVI   BUFFER+65(@02),C' '                                 2049
         MVC   BUFFER+66(190,@02),BUFFER+65(@02)                   2049
         L     @01,DUPVPTR                                         2049
         MVC   BUFFER(65,@02),DUPV(@01)                            2049
*           RPLVRETC=RCZERO;        /* GOOD RETURN CODE      @Y30LB26*/
         MVC   RPLVRETC(2,@04),@CB00747                            2050
*           RPLRCODE=RCZERO;        /* GOOD REASON CODE      @Y30LB26*/
         MVC   RPLRCODE(2,@04),@CB00747                            2051
*           RETURN;                 /*                       @Y30LB26*/
         B     @EL00031                                            2052
*         END;                      /*                       @Y30LB26*/
*       ELSE                        /*                       @Y30LB26*/
*                                                                  2054
*         /***********************************************************/
*         /*                                                         */
*         /* IF IT IS NOT EVEN A DUPLICATE RECORD            @Y30LB26*/
*         /* SET BAD RETURN CODE AND INDICATE RECORD         @Y30LB26*/
*         /* NOT FOUND                                       @Y30LB26*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  2054
*         DO;                       /*                       @Y30LB26*/
@RF02044 DS    0H                                                  2055
*           RPLVRETC=FOUR;          /* BAD RC                @Y30LB26*/
         L     @02,RPLVPTR                                         2055
         MVC   RPLVRETC(2,@02),@CB00749                            2055
*           RPLRCODE=NORECRC;       /* RECORD NOT FOUND      @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00789                            2056
*           CALL ERREXIT;           /* SAVE RETURN CODE      @Y30LB26*/
         BAL   @14,ERREXIT                                         2057
*           RETURN;                 /*                       @Y30LB26*/
         B     @EL00031                                            2058
*         END;                      /*                       @Y30LB26*/
*     END;                          /*                       @Y30LB26*/
*   END DUPNREC;                    /*                       @Y30LB26*/
         B     @EL00031                                            2061
*                                                                  2062
*   /*****************************************************************/
*   /*                                                               */
*   /* ROUTINE READS A CARTRIDGE INDEX RECORD AND            @Y30LB26*/
*   /* THEN READS THE VOLUME RECORD ASSOCIATED WITH          @Y30LB26*/
*   /* IT THEN MAKES A CHECK TO SEE IF THE VOLUME RECORD     @Y30LB26*/
*   /* ALSO INDICATES IT BELONGS TO THAT CARTRIDGE IF THAT   @Y30LB26*/
*   /* CHECK IS ASKED FOR                                    @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2062
*CARTDIR:                                                          2062
*   PROC OPTIONS(SAVE(REG14));      /*                       @Z40LB66*/
*                                                                  2062
CARTDIR  ST    @14,@SA00032                                        2062
*   /*****************************************************************/
*   /*                                                               */
*   /* RESERVE INVENTORY DATA SET SHARED                     @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2063
*   CALL RESSHARE;                  /*                       @Y30LB26*/
*                                                                  2063
         BAL   @14,RESSHARE                                        2063
*   /*****************************************************************/
*   /*                                                               */
*   /* SET UP KEY AND READ DIRECT FOR INDEX RECORD           @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2064
*   CARTKY=RVVRDCSN;                /* GET CART INDEX        @Y30LB26*/
         MVC   CARTKY(12),RVVRDCSN(RVVIPTR)                        2064
*   RPLVKEY=ADDR(IKEY);             /* ADDR KEY              @Y30LB26*/
         L     @04,RPLVPTR                                         2065
         LA    @02,IKEY                                            2065
         ST    @02,RPLVKEY(,@04)                                   2065
*   RPLVLOC=ON;                     /* LOCATE MODE           @Y30LB26*/
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB26*/
         OI    RPLVLOC(@04),B'11000000'                            2067
*   RPLVTYP=RPLVREAD;               /* READ RECORD           @Y30LB26*/
         MVI   RPLVTYP(@04),X'00'                                  2068
*   RESPECIFY                                                      2069
*     REG1 RSTD;                    /* RESTRICT REG1         @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR OF RPLV          @Y30LB26*/
         LR    REG1,@04                                            2070
*   CALL ICBVIO00;                  /* READ CART INDEX REC   @Y30LB26*/
         L     @15,@CV00671                                        2071
         BALR  @14,@15                                             2071
*   RESPECIFY                                                      2072
*     REG1 UNRSTD;                  /* FREE REG1             @Y30LB26*/
*   IF RPLVRETC^=RCZERO THEN        /* CK REASON CODE        @Y30LB26*/
         L     @04,RPLVPTR                                         2073
         CLC   RPLVRETC(2,@04),@CB00747                            2073
         BE    @RF02073                                            2073
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* SAVE REASON CODES     @Y30LB26*/
         BAL   @14,ERREXIT                                         2075
*       RETURN;                     /*                       @Y30LB26*/
@EL00032 DS    0H                                                  2076
@EF00032 DS    0H                                                  2076
@ER00032 L     @14,@SA00032                                        2076
         BR    @14                                                 2076
*     END;                          /*                       @Y30LB26*/
*                                                                  2077
*   /*****************************************************************/
*   /*                                                               */
*   /* SAVE CONTENTS OF RECORD JUST READ AND SEE IF          @Z40LB66*/
*   /* A VOLID WAS SPECIFIED                                 @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2078
*   INDEXPTR=RPLVBUF;               /* ADDR RECORD           @Z40LB66*/
@RF02073 L     @04,RPLVPTR                                         2078
         L     INDEXPTR,RPLVBUF(,@04)                              2078
*   STORINDX=INDEX;                 /* SAVE RECORD           @Z40LB66*/
         MVI   STORINDX+36,C' '                                    2079
         MVC   STORINDX+37(187),STORINDX+36                        2079
         MVC   STORINDX(36),INDEX(INDEXPTR)                        2079
*   INDEXPTR=ADDR(STORINDX);        /* RESET BASE            @Z40LB66*/
         LA    INDEXPTR,STORINDX                                   2080
*   IF RVVSVOL=ON THEN              /* VOLUME SPECIFIED      @Y30LB26*/
*                                                                  2081
         TM    RVVSVOL(RVVIPTR),B'00000001'                        2081
         BNO   @RF02081                                            2081
*     /***************************************************************/
*     /*                                                             */
*     /* COMPARE VOLID FROM INDEX RECORD WITH THE            @Z40LB66*/
*     /* VOLID GIVEN IN REQUEST BLOCK                        @Z40LB66*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  2082
*     DO;                           /*                       @Y30LB26*/
*       IF INDVSRNO=RVVOLUME THEN   /* VOLUME MATCH          @Z40LB66*/
*                                                                  2083
         CLC   INDVSRNO(6,INDEXPTR),RVVOLUME(RVVIPTR)              2083
         BNE   @RF02083                                            2083
*         /***********************************************************/
*         /*                                                         */
*         /* IF EVERYTHING MATCHES, GO READ AND RETURN REC   @Y30LB26*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  2084
*         DO;                       /*                       @Y30LB26*/
*           CALL READVOL;           /* READ VOLUME RECORD    @Y30LB26*/
         BAL   @14,READVOL                                         2085
*           RETURN;                 /*                       @Y30LB26*/
         B     @EL00032                                            2086
*         END;                      /*                       @Y30LB26*/
*       ELSE                        /*                       @Y30LB26*/
*                                                                  2088
*         /***********************************************************/
*         /*                                                         */
*         /* IF CHECK CALLED FOR BUT NO MATCH THEN SET BAD   @Y30LB26*/
*         /* RET CODE AND INDICATE RECORD NOT FOUND          @Y30LB26*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  2088
*         DO;                       /*                       @Y30LB26*/
@RF02083 DS    0H                                                  2089
*           RPLVRETC=FOUR;          /*                       @Y30LB26*/
         L     @02,RPLVPTR                                         2089
         MVC   RPLVRETC(2,@02),@CB00749                            2089
*           RPLRCODE=NOMATCH;       /*                       @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00807                            2090
*           CALL ERREXIT;           /*                       @Y30LB26*/
         BAL   @14,ERREXIT                                         2091
*           RETURN;                 /*                       @Y30LB26*/
         B     @EL00032                                            2092
*         END;                      /*                       @Y30LB26*/
*     END;                          /*                       @Y30LB26*/
*   ELSE                            /*                       @Y30LB26*/
*                                                                  2095
*     /***************************************************************/
*     /*                                                             */
*     /* IF NO TEST CALLED FOR JUST GO READ                  @Y30LB26*/
*     /* RECORD AND RETURN IT                                @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  2095
*     DO;                           /*                       @Y30LB26*/
@RF02081 DS    0H                                                  2096
*       CALL READVOL;               /* READ VOLUME           @Y30LB26*/
         BAL   @14,READVOL                                         2096
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00032                                            2097
*     END;                          /*                       @Y30LB26*/
*   END CARTDIR;                    /*                       @Z40LB66*/
*                                                                  2100
*   /*****************************************************************/
*   /*                                                               */
*   /* THIS ROUTINE READS THE NEXT CARTRIDGE                 @Z40LB66*/
*   /* INDEX RECORD AND ITS ASSOCIATED VOLUME RECORD         @Z40LB66*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2100
*CARTNREC:                                                         2100
*   PROC OPTIONS(SAVE(REG14));      /*                       @Z40LB66*/
*                                                                  2100
CARTNREC ST    @14,@SA00033                                        2100
*   /*****************************************************************/
*   /*                                                               */
*   /* GO RESERVE INVENTORY DATA SET SHARED                  @Z40LB66*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2101
*   CALL RESSHARE;                  /*                       @Z40LB66*/
*                                                                  2101
         BAL   @14,RESSHARE                                        2101
*   /*****************************************************************/
*   /*                                                               */
*   /* DETERMINE IF READING FOR FIRST CARTRIDGE INDEX        @Z40LB66*/
*   /* RECORD. IF SO, SET CSN TO ZERO AND PROCESS LIKE       @Z40LB66*/
*   /* A REGULAR READ NEXT                                   @Z40LB66*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2102
*   IF RVVSCSN=OFF THEN             /* CSN SPECIFIED ?       @Z40LB66*/
         TM    RVVSCSN(RVVIPTR),B'00001000'                        2102
         BNZ   @RF02102                                            2102
*     CARTKY=ZEROCHAR;              /*                       @Z40LB66*/
         MVC   CARTKY(12),ZEROCHAR                                 2103
*   ELSE                            /*                       @Z40LB66*/
*     DO;                           /*                       @Z40LB66*/
*                                                                  2104
         B     @RC02102                                            2104
@RF02102 DS    0H                                                  2105
*       /*************************************************************/
*       /*                                                           */
*       /* INCREMENT THE KEY BY ONE TO OBTAIN THE            @Z40LB66*/
*       /* NEXT HIGHER KEY                                   @Z40LB66*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  2105
*       CARTKY=RVVRDCSN;            /* CSN TO READ BEYOND    @Z40LB66*/
         MVC   CARTKY(12),RVVRDCSN(RVVIPTR)                        2105
*       ARITHCTG=CARTKY(12);        /* GET LAST DIGIT        @Z40LB66*/
         MVC   ARITHCTG(1),CARTKY+11                               2106
*       CARTID=CARTID+1;            /* INCREMENT IT          @Z40LB66*/
         LA    @04,1                                               2107
         SLR   @02,@02                                             2107
         IC    @02,CARTID                                          2107
         ALR   @04,@02                                             2107
         STC   @04,CARTID                                          2107
*       CARTKY(12)=ARITHCTG;        /* RESTORE TO KEY        @Z40LB66*/
         MVC   CARTKY+11(1),ARITHCTG                               2108
*     END;                          /*                       @Z40LB66*/
*                                                                  2109
*   /*****************************************************************/
*   /*                                                               */
*   /* SET UP TO READ CARTRIDGE RECORD                       @Z40LB66*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2110
*   RPLVKEY=ADDR(IKEY);             /* ADDR OF KEY           @Z40LB66*/
@RC02102 L     @04,RPLVPTR                                         2110
         LA    @02,IKEY                                            2110
         ST    @02,RPLVKEY(,@04)                                   2110
*   RPLVLOC=ON;                     /* LOCATE MODE           @Z40LB66*/
*   RPLVDIR=ON;                     /* READ DIRECT           @Z40LB66*/
         OI    RPLVLOC(@04),B'11000000'                            2112
*   RPLVTYP=RPLVREAD;               /* READ RECORD           @Z40LB66*/
         MVI   RPLVTYP(@04),X'00'                                  2113
*   RPLVKGE=ON;                     /* READ >=               @Z40LB66*/
         OI    RPLVKGE(@04),B'00000100'                            2114
*   RESPECIFY                                                      2115
*     REG1 RSTD;                    /*                       @Z40LB66*/
*   REG1=RPLVPTR;                   /* ADDR RPLV             @Z40LB66*/
         LR    REG1,@04                                            2116
*   CALL ICBVIO00;                  /* READ NEXT CARTRIDGE   @Z40LB66*/
         L     @15,@CV00671                                        2117
         BALR  @14,@15                                             2117
*   RESPECIFY                                                      2118
*     REG1 UNRSTD;                  /*                       @Z40LB66*/
*   IF RPLVRETC^=RCZERO THEN        /* CHECK RETURN CODE     @Z40LB66*/
         L     @04,RPLVPTR                                         2119
         CLC   RPLVRETC(2,@04),@CB00747                            2119
         BE    @RF02119                                            2119
*     DO;                           /*                       @Z40LB66*/
*       CALL ERREXIT;               /* SAVE RETURN CODES     @Z40LB66*/
         BAL   @14,ERREXIT                                         2121
*       RETURN;                     /*                       @Z40LB66*/
@EL00033 DS    0H                                                  2122
@EF00033 DS    0H                                                  2122
@ER00033 L     @14,@SA00033                                        2122
         BR    @14                                                 2122
*     END;                          /*                       @Z40LB66*/
*                                                                  2123
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THIS IS NOT A CARTRIDGE RECORD, RETURN RECORD      @Z40LB66*/
*   /* NOT FOUND INDICATION                                  @Z40LB66*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2124
*   INDEXPTR=RPLVBUF;               /* ADDR RECORD           @Z40LB66*/
@RF02119 L     @04,RPLVPTR                                         2124
         L     INDEXPTR,RPLVBUF(,@04)                              2124
*   IF INDI^=IKY THEN               /* TEST FOR CART REC     @Z40LB66*/
         CLC   INDI(1,INDEXPTR),IKY                                2125
         BE    @RF02125                                            2125
*     DO;                           /*                       @Z40LB66*/
*       RPLVRETC=FOUR;              /* SET RETURN CODE       @Z40LB66*/
         MVC   RPLVRETC(2,@04),@CB00749                            2127
*       RPLRCODE=NORECRC;           /* RECORD NOT FOUND      @Z40LB66*/
         MVC   RPLRCODE(2,@04),@CB00789                            2128
*       CALL ERREXIT;               /* SAVE RETURN CODES     @Z40LB66*/
         BAL   @14,ERREXIT                                         2129
*       RETURN;                     /*                       @Z40LB66*/
         B     @EL00033                                            2130
*     END;                          /*                       @Z40LB66*/
*                                                                  2131
*   /*****************************************************************/
*   /*                                                               */
*   /* SAVE THE CONTENTS OF THE INDEX RECORD AND GO READ     @Z40LB66*/
*   /* THE ASSOCIATED VOLUME RECORD AND RETURN IT            @Z40LB66*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2132
*   STORINDX=INDEX;                 /* SAVE RECORD           @Z40LB66*/
@RF02125 MVI   STORINDX+36,C' '                                    2132
         MVC   STORINDX+37(187),STORINDX+36                        2132
         MVC   STORINDX(36),INDEX(INDEXPTR)                        2132
*   INDEXPTR=ADDR(STORINDX);        /* RESET BASE            @Z40LB66*/
         LA    INDEXPTR,STORINDX                                   2133
*   RPLVKGE=OFF;                    /* RESET FLAG            @Z40LB66*/
         L     @06,RPLVPTR                                         2134
         NI    RPLVKGE(@06),B'11111011'                            2134
*   CALL READVOL;                   /* READ VOLUME RECORD    @Z40LB66*/
         BAL   @14,READVOL                                         2135
*   RETURN;                         /*                       @Z40LB66*/
         B     @EL00033                                            2136
*   END CARTNREC;                   /*                       @Z40LB66*/
*                                                                  2138
*   /*****************************************************************/
*   /*                                                               */
*   /* THIS ROUTINE READS A VOLUME RECORD AND GETS           @Y30LB26*/
*   /* BUFFER SPACE FOR IT. THEN RETURNS THE RECORD          @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2138
*READVOL:                                                          2138
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
*                                                                  2138
READVOL  ST    @14,@SA00034                                        2138
*   /*****************************************************************/
*   /*                                                               */
*   /* SET UP TO READ WHATEVER RECORD KEY WAS IN THE         @Y30LB26*/
*   /* CARTRIDGE INDEX RECORD                                @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2139
*   RPLVKEY=ADDR(INDRECKY);         /* ADDR OF VOLUME KEY    @Z40LB66*/
         L     @06,RPLVPTR                                         2139
         LA    @04,INDRECKY(,INDEXPTR)                             2139
         ST    @04,RPLVKEY(,@06)                                   2139
*   RPLVLOC=ON;                     /* LOCATE MODE           @Y30LB26*/
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB26*/
         OI    RPLVLOC(@06),B'11000000'                            2141
*   RPLVTYP=RPLVREAD;               /* READ RECORD           @Y30LB26*/
         MVI   RPLVTYP(@06),X'00'                                  2142
*   RESPECIFY                                                      2143
*     REG1 RSTD;                    /* RESTRICT REG1         @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR RPLV             @Y30LB26*/
         LR    REG1,@06                                            2144
*   CALL ICBVIO00;                  /* READ VOL RECORD       @Y30LB26*/
         L     @15,@CV00671                                        2145
         BALR  @14,@15                                             2145
*   RESPECIFY                                                      2146
*     REG1 UNRSTD;                  /* FREE REG1             @Y30LB26*/
*                                                                  2146
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK TO SEE IF BAD RETURN CODE FROM I/O PROCESSOR    @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2147
*   IF RPLVRETC^=RCZERO THEN        /* CHECK RETURN CODE     @Y30LB26*/
         L     @06,RPLVPTR                                         2147
         CLC   RPLVRETC(2,@06),@CB00747                            2147
         BE    @RF02147                                            2147
*     DO;                           /*                       @Y30LB26*/
*       RPLVRETC=ZERO;              /* RESET RETURN CODE     @Z40LB66*/
         SLR   @04,@04                                             2149
         STH   @04,RPLVRETC(,@06)                                  2149
*       CALL GETBUF;                /* GET BUFFER TO RETURN  @Z40LB66
*                                      CARTRIDGE RECORD      @Z40LB66*/
         BAL   @14,GETBUF                                          2150
*       IF RPLVRETC^=RCZERO THEN    /* IF NOT SUCCESSFUL,    @Z40LB66*/
         L     @06,RPLVPTR                                         2151
         CLC   RPLVRETC(2,@06),@CB00747                            2151
         BNE   @RT02151                                            2151
*         RETURN;                   /* QUIT                  @Z40LB66*/
*       BUFFER=INDEX;               /* MOVE CART. RECORD     @Z40LB66*/
         L     @04,RVVAREA(,RVVIPTR)                               2153
         MVI   BUFFER+36(@04),C' '                                 2153
         MVC   BUFFER+37(219,@04),BUFFER+36(@04)                   2153
         MVC   BUFFER(36,@04),INDEX(INDEXPTR)                      2153
*       RPLVRETC=FOUR;              /* SET BAD RETURN CODE   @Z40LB66*/
         MVC   RPLVRETC(2,@06),@CB00749                            2154
*       RPLRCODE=NOCTGVOL;          /* NO VOL FOR CART.      @Z40LB66*/
         MVC   RPLRCODE(2,@06),@CB00841                            2155
*       CALL ERREXIT;               /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         2156
*       RETURN;                     /*                       @Y30LB26*/
@EL00034 DS    0H                                                  2157
@EF00034 DS    0H                                                  2157
@ER00034 L     @14,@SA00034                                        2157
         BR    @14                                                 2157
*     END;                          /*                       @Y30LB26*/
*                                                                  2158
*   /*****************************************************************/
*   /*                                                               */
*   /* SET UP ADDRESS TO RECORD JUST READ AND GET BUFFER     @Y30LB26*/
*   /* SPACE TO RETURN RECORD                                @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2159
*   BASEVPTR=RPLVBUF;               /* ADDR RECORD           @Y30LB26*/
@RF02147 L     @04,RPLVPTR                                         2159
         L     @04,RPLVBUF(,@04)                                   2159
         ST    @04,BASEVPTR                                        2159
*   CALL GETBUF;                    /* GET CORE              @Y30LB26*/
         BAL   @14,GETBUF                                          2160
*   IF RPLVRETC^=RCZERO THEN        /* CK RETURN             @Y30LB26*/
         L     @04,RPLVPTR                                         2161
         CLC   RPLVRETC(2,@04),@CB00747                            2161
         BNE   @RT02161                                            2161
*     RETURN;                       /*                       @Y30LB26*/
*   BUFFER=BASEV;                   /* MOVE REC TO BUFFER    @Y30LB26*/
         L     @02,RVVAREA(,RVVIPTR)                               2163
         MVI   BUFFER+224(@02),C' '                                2163
         MVC   BUFFER+225(31,@02),BUFFER+224(@02)                  2163
         L     @01,BASEVPTR                                        2163
         MVC   BUFFER(224,@02),BASEV(@01)                          2163
*   RPLVRETC=RCZERO;                /* GOOD RETURN CODE      @Y30LB26*/
         MVC   RPLVRETC(2,@04),@CB00747                            2164
*   RPLRCODE=RCZERO;                /* GOOD REASON CODE      @Y30LB26*/
         MVC   RPLRCODE(2,@04),@CB00747                            2165
*   RETURN;                         /*                       @Y30LB26*/
         B     @EL00034                                            2166
*   END READVOL;                    /*                       @Y30LB26*/
         B     @EL00034                                            2167
*                                                                  2168
*   /*****************************************************************/
*   /*                                                               */
*   /* ROUTINE RESERVES THE MSVC DATA SET SHARED FOR READING @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2168
*RESSHARE:                                                         2168
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
RESSHARE ST    @14,@SA00035                                        2168
*   RESPECIFY                                                      2169
*     REG1 RSTD;                    /* RESTRICT REG 1        @Y30LB26*/
*   RESPECIFY                                                      2170
*     REG0 RSTD;                    /* RESTRICT              @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR OF RPLV          @Y30LB26*/
         L     REG1,RPLVPTR                                        2171
*   REG0=RESSHINV;                  /* INDICATE RES SHARE    @Y30LB26*/
         LA    REG0,2                                              2172
*   CALL ICBVRR00;                  /* RESERVE IT            @Y30LB26*/
         L     @15,@CV00673                                        2173
         BALR  @14,@15                                             2173
*   RESPECIFY                                                      2174
*     REG0 UNRSTD;                  /* FREE REG 0            @Y30LB26*/
*   RESPECIFY                                                      2175
*     REG1 UNRSTD;                  /* FREE REG 1            @Y30LB26*/
*   RETURN;                         /*                       @Y30LB26*/
@EL00035 DS    0H                                                  2176
@EF00035 DS    0H                                                  2176
@ER00035 L     @14,@SA00035                                        2176
         BR    @14                                                 2176
*   END RESSHARE;                   /* END PROCEDURE         @Y30LB26*/
*                                                                  2178
*   /*****************************************************************/
*   /*                                                               */
*   /* ROUTINE GET BUFFER SPACE FROM SUB-POOL 241            @Y30LB26*/
*   /* SO THAT THE MSVC RECORD CAN BE RETURNED               @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2178
*GETBUF:                                                           2178
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
GETBUF   ST    @14,@SA00036                                        2178
*   RVVARLN=256;                    /* LENGTH OF BUFFER      @Y30LB26*/
*                                                                  2179
         MVC   RVVARLN(2,RVVIPTR),@CH00688                         2179
*   /*****************************************************************/
*   /*                                                               */
*   /* SEE IF USER PROVIDED BUFFER IS LONG ENOUGH            @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2180
*   IF RVVBUFLN<RPLVRLN THEN        /* USER BUF LONG ENOU ?  @Y30LB26*/
         L     @06,RPLVPTR                                         2180
         LH    @04,RVVBUFLN(,RVVIPTR)                              2180
         C     @04,RPLVRLN(,@06)                                   2180
         BNL   @RF02180                                            2180
*     DO;                           /*                       @Y30LB26*/
*       RPLVRETC=FOUR;              /* BAD RET C             @Y30LB26*/
         MVC   RPLVRETC(2,@06),@CB00749                            2182
*       RPLRCODE=BADUSRBF;          /* NOT LONG ENOUGH       @Y30LB26*/
         MVC   RPLRCODE(2,@06),@CB00833                            2183
*       CALL ERREXIT;               /* SAVE RET C            @Y30LB26*/
         BAL   @14,ERREXIT                                         2184
*       RETURN;                     /*                       @Y30LB26*/
@EL00036 DS    0H                                                  2185
@EF00036 DS    0H                                                  2185
@ER00036 L     @14,@SA00036                                        2185
         BR    @14                                                 2185
*     END;                          /*                       @Y30LB26*/
*   RESPECIFY                                                      2187
*    (REG2,                                                        2187
*     REG15) RSTD;                  /* RESTRICT REG 15-REG 2 @Y30LB26*/
@RF02180 DS    0H                                                  2188
*   REG2=ADDR(RVVAREA);             /* ADDR OF BUFFER ADDR   @Y30LB26*/
         LA    REG2,RVVAREA(,RVVIPTR)                              2188
*GETM1:                                                            2189
*   GEN(GETMAIN EC,LV=256,A=(REG2),SP=241);/* GET CORE       @Y30LB26*/
*                                                                  2189
GETM1    GETMAIN EC,LV=256,A=(REG2),SP=241
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK RETURN CODE FROM GETMAIN PROCESS                #Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2190
*   IF REG15^=RCZERO THEN           /* CK RETURN             #Y30LB26*/
         LTR   REG15,REG15                                         2190
         BZ    @RF02190                                            2190
*     DO;                           /*                       #Y30LB26*/
*       RPLVRETC=FOUR;              /* BAD RETURN            #Y30LB26*/
         L     @14,RPLVPTR                                         2192
         MVC   RPLVRETC(2,@14),@CB00749                            2192
*       RPLRCODE=NOBUFFER;          /* INDICATE NO BUF       #Y30LB26*/
         MVC   RPLRCODE(2,@14),@CB00831                            2193
*       CALL ERREXIT;               /* SAVE RETURN CODES     #Y30LB26*/
         BAL   @14,ERREXIT                                         2194
*     END;                          /*                       #Y30LB26*/
*   RESPECIFY                                                      2196
*    (REG2,                                                        2196
*     REG15) UNRSTD;                /* FREE REG 15 - REG 2   @Y30LB26*/
*   RETURN;                         /*                       #Y30LB26*/
         B     @EL00036                                            2197
*   END GETBUF;                     /*                       #Y30LB26*/
         B     @EL00036                                            2198
*                                                                  2199
*   /*****************************************************************/
*   /*                                                               */
*   /* SUBROUTINE MAKES A TEST ON BASE VOL RECORD TO SEE     @Y30LB26*/
*   /* IF IT WILL EXPIR BEFORE A SPECIFIED NUMBER OF DAYS    @Y30LB26*/
*   /* ALSO MAKES A TEST FOR GENERAL - RESTRICTED USE        @Y30LB26*/
*   /* MAKES TEST FOR ACTIVE - INACTIVE VOLUME               @Y30LB26*/
*   /* ALSO TESTS FOR A BASE VOLUME PLACE HOLDER             @ZDR2053*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2199
*TEST:                                                             2199
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
TEST     ST    @14,@SA00037                                        2199
*   DCL                                                            2200
*     EXPIR CHAR(4);                /* ACTUAL EXPIR DATE     @Y30LB26*/
*                                                                  2201
*   /*****************************************************************/
*   /*                                                               */
*   /* TEST FOR PLACEHOLDER FLAG BEING ON IN BASE VOLUME REC @Y30LB26*/
*   /* IF IT IS ON THE RECORD IS NOT REALLY THERE, SO DONT   @Y30LB26*/
*   /* RETURN IT, UNLESS REQUESTED.                          @ZDR2053*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2201
*   IF BASHOLD=ON THEN              /* HOLD RECORD ?         @Y30LB26*/
         L     @04,BASEVPTR                                        2201
         TM    BASHOLD(@04),B'10000000'                            2201
         BNO   @RF02201                                            2201
*     DO;                           /*                       @Y30LB26*/
*       IF RVVBPLHD=OFF&RVVALL=OFF THEN/* READ PLACE HOLD    @ZDR2053*/
         TM    RVVBPLHD(RVVIPTR),B'00000001'                       2203
         BNZ   @RF02203                                            2203
         TM    RVVALL(RVVIPTR),B'00000001'                         2203
         BNZ   @RF02203                                            2203
*         DO;                       /*                       @ZDR2053*/
*           RPLVRETC=FOUR;          /* SET BAD RETURN        #Y30LB26*/
         L     @04,RPLVPTR                                         2205
         MVC   RPLVRETC(2,@04),@CB00749                            2205
*           RPLRCODE=TNOTMET;       /* TEST NOT MET          #Y30LB26*/
         MVC   RPLRCODE(2,@04),@CB00819                            2206
*         END;                      /*                       @ZDR2053*/
*       ELSE                        /* PLACE HOLDER          @ZDR2053*/
*         DO;                       /*                       @ZDR2053*/
         B     @RC02203                                            2208
@RF02203 DS    0H                                                  2209
*           RPLVRETC=RCZERO;        /*                       @ZDR2053*/
         L     @04,RPLVPTR                                         2209
         MVC   RPLVRETC(2,@04),@CB00747                            2209
*           RPLRCODE=RCZERO;        /*                       @ZDR2053*/
         MVC   RPLRCODE(2,@04),@CB00747                            2210
*         END;                      /*                       @ZDR2053*/
*       RETURN;                     /*                       @ZDR2053*/
@EL00037 DS    0H                                                  2212
@EF00037 DS    0H                                                  2212
@ER00037 L     @14,@SA00037                                        2212
         BR    @14                                                 2212
*     END;                          /*                       @ZDR2053*/
*                                                                  2213
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR READING ONLY PLACE HOLDER RECORDS           @ZDR2053*/
*   /* IF MET, DO NOT RETURN THE BASE VOLUME RECORD          @ZDR2053*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2214
*   IF BASHOLD=OFF&RVVBPLHD=ON THEN                                2214
@RF02201 L     @04,BASEVPTR                                        2214
         TM    BASHOLD(@04),B'10000000'                            2214
         BNZ   @RF02214                                            2214
         TM    RVVBPLHD(RVVIPTR),B'00000001'                       2214
         BNO   @RF02214                                            2214
*     DO;                           /*                       @ZDR2053*/
*       RPLVRETC=FOUR;              /* SET BAD RETURN        @ZDR2053*/
         L     @04,RPLVPTR                                         2216
         MVC   RPLVRETC(2,@04),@CB00749                            2216
*       RPLRCODE=TNOTMET;           /* TEST NOT MET          @ZDR2053*/
         MVC   RPLRCODE(2,@04),@CB00819                            2217
*       RETURN;                     /*                       @ZDR2053*/
         B     @EL00037                                            2218
*     END;                          /*                       @ZDR2053*/
*                                                                  2219
*   /*****************************************************************/
*   /*                                                               */
*   /* EXPIRATION DATE CHECK                                 @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2220
*   IF RVVEXPDT=ON THEN             /* EXPIRATION DATE?      @Y30LB26*/
*                                                                  2220
@RF02214 TM    RVVEXPDT(RVVIPTR),B'10000000'                       2220
         BNO   @RF02220                                            2220
*     /***************************************************************/
*     /*                                                             */
*     /* GO CALCULATE ACTUAL EXPIRATION DATE                 @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  2221
*     DO;                           /*                       @Y30LB26*/
*       FOREXP=RVVEXPIR;            /* GET EXPIRATION        @Y30LB26*/
         LH    FOREXP,RVVEXPIR(,RVVIPTR)                           2222
*       CALL VUEXP;                 /* GET EXPIR DATE        @Y30LB26*/
         BAL   @14,VUEXP                                           2223
*       EXPIR=RETDATE;              /* GET RETENTION         @Y30LB26*/
*                                                                  2224
         MVC   EXPIR(4),RETDATE                                    2224
*       /*************************************************************/
*       /*                                                           */
*       /* IF VOLUME DOES NOT EXPIRE IN SPEC NO OF DAYS      @Y30LB26*/
*       /* THEN TEST IS NOT MET                              @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  2225
*       IF EXPIR<BASEXPDT THEN      /* DID NOT MEET TEST     @Y30LB26*/
         L     @04,BASEVPTR                                        2225
         CLC   EXPIR(4),BASEXPDT(@04)                              2225
         BNL   @RF02225                                            2225
*         DO;                       /*                       @Y30LB26*/
*           RPLVRETC=FOUR;          /* SET BAD RETURN CODE   @Y30LB26*/
         L     @04,RPLVPTR                                         2227
         MVC   RPLVRETC(2,@04),@CB00749                            2227
*           RPLRCODE=TNOTMET;       /* SET REASON CODE       @Y30LB26*/
         MVC   RPLRCODE(2,@04),@CB00819                            2228
*           RETURN;                 /* TO MAIN SUB           @Y30LB26*/
         B     @EL00037                                            2229
*         END;                      /*                       @Y30LB26*/
*     END;                          /*                       @Y30LB26*/
*                                                                  2231
@RF02225 DS    0H                                                  2232
*   /*****************************************************************/
*   /*                                                               */
*   /* MAKE TEST FOR GENERAL USE                             @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2232
*   IF RVVGSVOL=ON THEN             /* TEST FOR GEN USE?     @Y30LB26*/
@RF02220 TM    RVVGSVOL(RVVIPTR),B'00100000'                       2232
         BNO   @RF02232                                            2232
*     DO;                           /*                       @Y30LB26*/
*                                                                  2233
*       /*************************************************************/
*       /*                                                           */
*       /* IF NOT GENERAL USE, TEST NOT MET                  @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  2234
*       IF BASGENUS=OFF THEN        /* TEST NOT MET          @Y30LB26*/
         L     @04,BASEVPTR                                        2234
         TM    BASGENUS(@04),B'00010000'                           2234
         BNZ   @RF02234                                            2234
*         DO;                       /*                       @Y30LB26*/
*           RPLVRETC=FOUR;          /* SET BAD RET CODE      @Y30LB26*/
         L     @04,RPLVPTR                                         2236
         MVC   RPLVRETC(2,@04),@CB00749                            2236
*           RPLRCODE=TNOTMET;       /* INDIC NOT MET         @Y30LB26*/
         MVC   RPLRCODE(2,@04),@CB00819                            2237
*           RETURN;                 /*                       @Y30LB26*/
         B     @EL00037                                            2238
*         END;                      /*                       @Y30LB26*/
*     END;                          /*                       @Y30LB26*/
*   ELSE                            /*                       @Y30LB26*/
*                                                                  2241
*     /***************************************************************/
*     /*                                                             */
*     /* TEST FOR RESTRICTED USE                             @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  2241
*     IF RVVRSTD=ON THEN            /* TEST FOR RESTRICTED   @Y30LB26*/
         B     @RC02232                                            2241
@RF02232 TM    RVVRSTD(RVVIPTR),B'00010000'                        2241
         BNO   @RF02241                                            2241
*       DO;                         /*                       @Y30LB26*/
*                                                                  2242
*         /***********************************************************/
*         /*                                                         */
*         /* IF NOT RESTRICTED TEST NOT MET                  @Y30LB26*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  2243
*         IF BASRSTD=OFF THEN       /* TEST NOT MET          @Y30LB26*/
         L     @04,BASEVPTR                                        2243
         TM    BASRSTD(@04),B'00001000'                            2243
         BNZ   @RF02243                                            2243
*           DO;                     /*                       @Y30LB26*/
*             RPLVRETC=FOUR;        /* BAD RET CODE          @Y30LB26*/
         L     @04,RPLVPTR                                         2245
         MVC   RPLVRETC(2,@04),@CB00749                            2245
*             RPLRCODE=TNOTMET;     /* TEST NOT MET          @Y30LB26*/
         MVC   RPLRCODE(2,@04),@CB00819                            2246
*             RETURN;               /*                       @Y30LB26*/
         B     @EL00037                                            2247
*           END;                    /*                       @Y30LB26*/
*       END;                        /*                       @Y30LB26*/
*                                                                  2249
@RF02243 DS    0H                                                  2250
*   /*****************************************************************/
*   /*                                                               */
*   /* MAKE TEST FOR INACTIVE VOLUME                         @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2250
*   IF RVVINACT=ON THEN             /* CHECK FOR INACTIVE    @Y30LB26*/
@RF02241 DS    0H                                                  2250
@RC02232 TM    RVVINACT(RVVIPTR),B'00001000'                       2250
         BNO   @RF02250                                            2250
*     DO;                           /*                       @Y30LB26*/
*                                                                  2251
*       /*************************************************************/
*       /*                                                           */
*       /* IF NOT INACTIVE, TEST NOT MET                     @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  2252
*       IF BASINAC=OFF THEN         /* TEST NOT MET          @Y30LB26*/
         L     @04,BASEVPTR                                        2252
         TM    BASINAC(@04),B'00000100'                            2252
         BNZ   @RF02252                                            2252
*         DO;                       /*                       @Y30LB26*/
*           RPLVRETC=FOUR;          /* BAD RETURN            @Y30LB26*/
         L     @04,RPLVPTR                                         2254
         MVC   RPLVRETC(2,@04),@CB00749                            2254
*           RPLRCODE=TNOTMET;       /* TEST NOT MET          @Y30LB26*/
         MVC   RPLRCODE(2,@04),@CB00819                            2255
*           RETURN;                 /*                       @Y30LB26*/
         B     @EL00037                                            2256
*         END;                      /*                       @Y30LB26*/
*     END;                          /*                       @Y30LB26*/
*                                                                  2258
@RF02252 DS    0H                                                  2259
*   /*****************************************************************/
*   /*                                                               */
*   /* MAKE TEST FOR ACTIVE VOLUME                           @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2259
*   IF RVVACTV=ON THEN              /* TEST ACTIVE           @Y30LB26*/
@RF02250 TM    RVVACTV(RVVIPTR),B'00000100'                        2259
         BNO   @RF02259                                            2259
*     DO;                           /*                       @Y30LB26*/
*       IF BASINAC=ON THEN          /* INACTIVE              @Y30LB26*/
         L     @04,BASEVPTR                                        2261
         TM    BASINAC(@04),B'00000100'                            2261
         BNO   @RF02261                                            2261
*         DO;                       /*                       @Y30LB26*/
*           RPLVRETC=FOUR;          /* BAD RET CODE          @Y30LB26*/
         L     @04,RPLVPTR                                         2263
         MVC   RPLVRETC(2,@04),@CB00749                            2263
*           RPLRCODE=TNOTMET;       /* TEST NOT MET          @Y30LB26*/
         MVC   RPLRCODE(2,@04),@CB00819                            2264
*           RETURN;                 /*                       @Y30LB26*/
         B     @EL00037                                            2265
*         END;                      /*                       @Y30LB26*/
*     END;                          /*                       @Y30LB26*/
@RF02261 DS    0H                                                  2268
*   RPLVRETC=RCZERO;                /* INDIC ALL TEST MET    @Y30LB26*/
@RF02259 L     @04,RPLVPTR                                         2268
         MVC   RPLVRETC(2,@04),@CB00747                            2268
*   RPLRCODE=RCZERO;                /* END                   @Y30LB26*/
         MVC   RPLRCODE(2,@04),@CB00747                            2269
*   RETURN;                         /*                       @Y30LB26*/
         B     @EL00037                                            2270
*   END TEST;                       /*                       @Y30LB26*/
         B     @EL00037                                            2271
*                                                                  2272
*/*  START OF SPECIFICATIONS ****                                  2272
*                                                                  2272
*    PROCEDURE NAME - MODIFYV                                 @Y30LB26
*                                                                  2272
*    FUNCTION - TO MODIFY A BASE VOLUME RECORD IN THE USERCAT.MSVI DATA
*    SET.  IT WILL ALSO CHANGE A COPY RECORD TO A BACKUP AND/OR    2272
*    CLEAR THE INCOMPLETE COPY FLAG IN THE COPY RECORD IF          2272
*    THE USER SPECIFIES THE CARTRIDGE SERIAL NUMBER OF THE COPY TO BE
*    CHANGED.  THE PROGRAM CAN                                     2272
*    NOT CHANGE THE VOLUME ID OF A BASE VOLUME RECORD.  IT CAN TAKE A
*    VOLUME OUT OF A GROUP, IN WHICH CASE THE PROGRAM WILL TAKE IT OUT
*    OF THE GROUP CHAIN AND CHAIN IT INTO THE NON-GROUPED.         2272
*    IF THE VOLUME WAS 'GENERAL' USE IT WILL DECREASE THE          2272
*    GROUP FREE SPACE, THE NUMBER OF FREE EXTENTS AND TAKE THE     2272
*    ENTRY FOR THE VOLUME OUT OF THE VOLUME SERIAL NUMBER EXTENSION
*    RECORD.  IT WILL THEN RECALCULATE THE GROUP SPACE THRESHOLD IF
*    THRESHOLD CHECKING IS BEING DONE FOR THAT GROUP.  IF THE VOLUME IS
*    BEING CHANGED FROM 'RESTRICTED' TO 'GENERAL' USE, THE FREE SPACE
*    AND FREE EXTENTS ARE INCREASED AND A SLOT IN THE GROUPED VOLUME
*    SERIAL NUMBER EXTENT RECORD IS ADDED, BUT NO RECHAINING IS    2272
*    NECESSARY.  THE REVERSE IS DONE IF A VOLUME IS TAKEN FROM     2272
*    'GENERAL' TO 'RESTRICTED' USE WITHIN THE SAME GROUP.  WHEN A  2272
*    VOLUME GOES FROM NON-GROUPED TO GROUPED IT WILL BE TAKEN OUT OF
*    THE NON-GROUPED CHAIN AND PUT INTO THE GROUPED CHAIN.  IF IT IS
*    'GENERAL' USE, THE SPACE FIELDS IN THE GROUP RECORD WILL BE   2272
*    UPDATED AND A SLOT ADDED IN THE GROUPED VOLUME SERIAL NUMBER  2272
*    EXTENT RECORD.  IN ALL CASES THE COUNT IN THE GROUP RECORD IS 2272
*    UPDATED FOR 'GENERAL' OR 'RESTRICTED' USE OR THE NUMBER OF VOLUMES
*    COUNT IF NON-GROUPED.  THE BASE VOLUME RECORD IS UPDATED TO   2272
*    REFLECT ITS NEW STATUS.  THE EXPIRATION DATE IS NULLIFIED IF IT
*    WAS A GROUPED 'GENERAL' USE VOLUME CHANGING TO A NON-GROUPED OR
*    'RESTRICTED'. IF IT IS BECOMING A GROUPED, 'GENERAL' USE VOLUME,
*    THE EXPIRATION DATE IS ADDED OR CALCULATED IF SPECIFIED BY THE
*    USER. FOR ALL VOLUMES THE PROGRAM CAN MODIFY OR NULLIFY THE   2272
*    DESCRIPTION, MAXIMUM NUMBER OF BACKUPS, SET OR CLEAR THE VOLUME
*    LABEL MISMATCH FLAG AND CLEAR THE INCOMPLETE VOLUME CREATION FLAG.
*    THE RPLV IS JOURNALED AFTER THE FIRST SUCCESSFUL UPDATE OF THE
*    MSVC INVENTORY DATA SET.                                 @Y30LB26
*                                                                  2272
*      INPUTS - REGISTER 1 CONTAINS THE ADDRESS OF THE RPLV, WHICH 2272
*      CONTAINS THE REQUEST BLOCK TELLING WHAT OPTIONS ARE TO      2272
*      BE HANDLED.                                            @Y30LB26
*                                                                  2272
*      OUTPUTS - REASON CODE AND CONDITION CODE IN RPLV.      @Y30LB26
*                                                                  2272
*         '0228'X  INCOMPATABLE MSS MOUNTING ATTRIBUTES.      @Y30LB26
*         '0201'X  REQUEST TO MODIFY A COPY RECORD, BUT NO    @Y30LB26
*          CSN WAS GIVEN.                                     @Y30LB26
*         '021B'X  I/O ERROR OCCURED BUT THE RPLV WAS         @Y30LB26
*          JOURNALED.                                         @Y30LB26
*         '0227'X  TO OR FOR SPECIFIED FOR A BASE VOLUME      @Y30LB26
*          RECORD IN A GROUP WITH NO RETENTION CHECKING.      @Y30LB26
*         '0205'X  GROUP NAME SPECIFIED BY USER DOES NOT      @VS32198
*          EXIST IN LIBRARY.                                  @VS32198
*         ANY REASON CODES FROM THE I/O PROCESSOR OR THE      @Y30LB26
*          JOURNAL PROGRAM.                                   @Y30LB26
**** END OF SPECIFICATIONS **                                        */
*                                                                  2272
*MODIFYV:                                                          2272
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
*                                                                  2272
MODIFYV  ST    @14,@SA00038                                        2272
*   /*****************************************************************/
*   /*                                                               */
*   /* GO RESERVE THE INVENTORY DATA SET FOR UPDATE          #Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2273
*   CALL RESERINV;                  /* RESERVE INVENTORY     @Y30LB26*/
*                                                                  2273
         BAL   @14,RESERINV                                        2273
*   /*****************************************************************/
*   /*                                                               */
*   /* SET ADDRESSABILITY TO REQUEST BLOCK                   @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2274
*   MVRPTR=ADDR(RPLVUTIL);          /* ADDR OF REQ BLK       @Y30LB26*/
*                                                                  2274
         L     @02,RPLVPTR                                         2274
         LA    @02,RPLVUTIL(,@02)                                  2274
         ST    @02,MVRPTR                                          2274
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THE REQUEST IS TO CHANGE A COPY RECORD,            @Y30LB26*/
*   /* BRANCH TO SUBROUTINE THAT DOES THIS                   @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2275
*   IF MVRFLCSN=ON THEN             /* CHANGE COPY RECORD ?  @Y30LB26*/
         TM    MVRFLCSN(@02),B'00000100'                           2275
         BNO   @RF02275                                            2275
*     DO;                           /*                       @Y30LB26*/
*       CALL MODCOPY;               /* BRANCH TO DO IT       @Y30LB26*/
         BAL   @14,MODCOPY                                         2277
*       RETURN;                     /* RETURN MAIN PROC      @Y30LB26*/
@EL00038 DS    0H                                                  2278
@EF00038 DS    0H                                                  2278
@ER00038 L     @14,@SA00038                                        2278
         BR    @14                                                 2278
*     END;                          /*                       @Y30LB26*/
*                                                                  2279
*   /*****************************************************************/
*   /*                                                               */
*   /* IF IT IS NOT A REQUEST TO CHANGE A COPY RECORD, THEN  @Y30LB26*/
*   /* SET UP TO READ BASE VOLUME RECORD TO BE UPDATED       @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2280
*   VOLKY=MVRBVOL;                  /* GET VOLUME NAME       @Y30LB26*/
@RF02275 L     @02,MVRPTR                                          2280
         MVC   VOLKY(6),MVRBVOL(@02)                               2280
*   RPLVKEY=ADDR(VKEY);             /* ADDR OF KEY           @Y30LB26*/
         L     @02,RPLVPTR                                         2281
         LA    @15,VKEY                                            2281
         ST    @15,RPLVKEY(,@02)                                   2281
*   RPLVBUF=ADDR(STORBASE);         /* ADDR OF BUFFER        @Y30LB26*/
         LA    @15,STORBASE                                        2282
         ST    @15,RPLVBUF(,@02)                                   2282
*   RPLVBLN=LENGTH(STORBASE);       /* LENGTH OF BUFFER      @Y30LB26*/
         MVC   RPLVBLN(4,@02),@CF01147                             2283
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB26*/
         OI    RPLVDIR(@02),B'01000000'                            2284
*   RPLVTYP=RPLVREAD;               /* READ RECORD           @Y30LB26*/
         MVI   RPLVTYP(@02),X'00'                                  2285
*   RESPECIFY                                                      2286
*     REG1 RSTD;                    /* RESTRICT              @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR OF RPLV          @Y30LB26*/
         LR    REG1,@02                                            2287
*   CALL ICBVIO00;                  /* READ BASE RECORD      @Y30LB26*/
         L     @15,@CV00671                                        2288
         BALR  @14,@15                                             2288
*   RESPECIFY                                                      2289
*     REG1 UNRSTD;                  /* FREE REG 1            @Y30LB26*/
*                                                                  2289
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK RETURN CODE                                     @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2290
*   IF RPLVRETC^=RCZERO THEN        /* CH RET CODE           @Y30LB26*/
         L     @02,RPLVPTR                                         2290
         CLC   RPLVRETC(2,@02),@CB00747                            2290
         BE    @RF02290                                            2290
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         2292
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00038                                            2293
*     END;                          /*                       @Y30LB26*/
*                                                                  2294
*   /*****************************************************************/
*   /*                                                               */
*   /* CKECK TO SEE IF USER SPECIFIED A GROUP NAME. IF SO    @VS32198*/
*   /* READ FOR RECORD TO SEE IF IT IS IN THE INVENTORY.     @VS32198*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2295
*   IF MVRFLGRO=ON THEN             /* GROUP SPEC ?          @VS32198*/
@RF02290 L     @02,MVRPTR                                          2295
         TM    MVRFLGRO(@02),B'01000000'                           2295
         BNO   @RF02295                                            2295
*     DO;                           /*                       @VS32198*/
*       GROUPKY=MVRGROUP;           /* GROUP NAME IN KEY     @VS32198*/
         MVC   GROUPKY(8),MVRGROUP(@02)                            2297
*       RPLVKEY=ADDR(GKEY);         /* ADDR OF KEY           @VS32198*/
         L     @02,RPLVPTR                                         2298
         LA    @15,GKEY                                            2298
         ST    @15,RPLVKEY(,@02)                                   2298
*       RPLVLOC=ON;                 /* LOCATE MODE           @VS32198*/
*       RPLVDIR=ON;                 /* READ DIRECT           @VS32198*/
         OI    RPLVLOC(@02),B'11000000'                            2300
*       RPLVTYP=RPLVREAD;           /* READ RECORD           @VS32198*/
         MVI   RPLVTYP(@02),X'00'                                  2301
*       RPLVUPD=OFF;                /* NOT FOR UPDATE        @VS32198*/
         NI    RPLVUPD(@02),B'11111101'                            2302
*       RESPECIFY                                                  2303
*         REG1 RSTD;                /* RESRTICT REG 1        @VS32198*/
*       REG1=RPLVPTR;               /* ADDR OF RPLV          @VS32198*/
         LR    REG1,@02                                            2304
*       CALL ICBVIO00;              /* READ FOR GROUP REC    @VS32198*/
         L     @15,@CV00671                                        2305
         BALR  @14,@15                                             2305
*       RPLVLOC=OFF;                /* RESET FOR SAFETY      @VS32198*/
         L     @02,RPLVPTR                                         2306
         NI    RPLVLOC(@02),B'01111111'                            2306
*       RESPECIFY                                                  2307
*         REG1 UNRSTD;              /* FREE REG 1            @VS32198*/
*       IF RPLVRETC^=RCZERO THEN    /* CK RETURN             @VS32198*/
         CLC   RPLVRETC(2,@02),@CB00747                            2308
         BE    @RF02308                                            2308
*         DO;                       /*                       @VS32198*/
*           IF RPLRCODE=NORECRC THEN/* RECORD NOT FND ?      @VS32198*/
         CLC   RPLRCODE(2,@02),@CB00789                            2310
         BNE   @RF02310                                            2310
*             RPLRCODE=BADGRP;      /* SET REASON CODE       @VS32198*/
         MVC   RPLRCODE(2,@02),@CB00839                            2311
*           CALL ERREXIT;           /* RET SET UP            @VS32198*/
@RF02310 BAL   @14,ERREXIT                                         2312
*           RETURN;                 /* RETURN ?????          @VS32198*/
         B     @EL00038                                            2313
*         END;                      /*                       @VS32198*/
*     END;                          /*                       @VS32198*/
*                                                                  2315
@RF02308 DS    0H                                                  2316
*   /*****************************************************************/
*   /*                                                               */
*   /* CALL ROUTINE TO CHECK IF TO OR FOR EXPIRATION         #Y30LB26*/
*   /* PARAMETERS WERE SPECIFIED FOR A VOLUME WHERE          #Y30LB26*/
*   /* RETENTION DOES NOT APPLY                              @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2316
*   BASEVPTR=ADDR(STORBASE);        /* SET ADDR TO BASE REC  @Y30LB26*/
@RF02295 LA    @02,STORBASE                                        2316
         ST    @02,BASEVPTR                                        2316
*   CALL EXPCK;                     /* CK RETENTION          @Y30LB26*/
         BAL   @14,EXPCK                                           2317
*   IF RPLVRETC^=RCZERO THEN        /* CK RETURN             @Y30LB26*/
         L     @02,RPLVPTR                                         2318
         CLC   RPLVRETC(2,@02),@CB00747                            2318
         BNE   @RT02318                                            2318
*     RETURN;                       /* RETURN CALLER         @Y30LB26*/
*                                                                  2319
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK TO SEE IF GROUP WAS SPECIFIED                   @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2320
*   IF MVRFLGRO=ON THEN             /* GOING GROUPED         @Y30LB26*/
         L     @02,MVRPTR                                          2320
         TM    MVRFLGRO(@02),B'01000000'                           2320
         BNO   @RF02320                                            2320
*     DO;                           /*                       @Y30LB26*/
*                                                                  2321
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK TO SEE IF WAS NOT GROUPED BEFORE OR         @Y30LB26*/
*       /* IF WAS GROUPED BEFORE, IF IT WAS THE SAME GROUP   @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  2322
*       IF BASGRPV=OFFMVRGROUP^=BASGROUP THEN/* REALY CHAN  @Y30LB26*/
         L     @15,BASEVPTR                                        2322
         TM    BASGRPV(@15),B'00100000'                            2322
         BZ    @RT02322                                            2322
         CLC   MVRGROUP(8,@02),BASGROUP(@15)                       2322
         BE    @RF02322                                            2322
@RT02322 DS    0H                                                  2323
*         DO;                       /*                       @Y30LB26*/
*                                                                  2323
*           /*********************************************************/
*           /*                                                       */
*           /* CHECK TO SEE IF GOING TO BE A GENERAL         @Y30LB26*/
*           /* USE VOLUME IN THE GROUP                       @Y30LB26*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  2324
*           IF MVRGEN=ON THEN       /* GOING GENERAL         @Y30LB26*/
*                                                                  2324
         L     @02,MVRPTR                                          2324
         TM    MVRGEN(@02),B'10000000'                             2324
         BNO   @RF02324                                            2324
*             /*******************************************************/
*             /*                                                     */
*             /* READ RECORD OF GROUP BASE IS GOING INTO     @Y30LB26*/
*             /*                                                     */
*             /*******************************************************/
*                                                                  2325
*             DO;                   /*                       @Y30LB26*/
*               GROUPKY=MVRGROUP;   /* NEW GROUP NAME        @Y30LB26*/
         MVC   GROUPKY(8),MVRGROUP(@02)                            2326
*               RPLVKEY=ADDR(GKEY); /* ADDR KEY TO READ      @Y30LB26*/
         L     @02,RPLVPTR                                         2327
         LA    @15,GKEY                                            2327
         ST    @15,RPLVKEY(,@02)                                   2327
*               RPLVLOC=ON;         /* LOCATE MODE           @Y30LB26*/
*               RPLVDIR=ON;         /* READ DIRECT           @Y30LB26*/
         OI    RPLVLOC(@02),B'11000000'                            2329
*               RPLVTYP=RPLVREAD;   /* READ RECORD           @Y30LB26*/
         MVI   RPLVTYP(@02),X'00'                                  2330
*               RESPECIFY                                          2331
*                 REG1 RSTD;        /* RESTRICT REG 1        @Y30LB26*/
*               REG1=RPLVPTR;       /* ADDR RPLV             @Y30LB26*/
         LR    REG1,@02                                            2332
*               CALL ICBVIO00;      /* READ NEW GROUP REC    @Y30LB26*/
         L     @15,@CV00671                                        2333
         BALR  @14,@15                                             2333
*               RESPECIFY                                          2334
*                 REG1 UNRSTD;      /* FREE REG 1            @Y30LB26*/
*               IF RPLVRETC^=RCZERO THEN/* CK RETURN CODE    @Y30LB26*/
         L     @02,RPLVPTR                                         2335
         CLC   RPLVRETC(2,@02),@CB00747                            2335
         BE    @RF02335                                            2335
*                 DO;               /*                       @Y30LB26*/
*                   CALL ERREXIT;   /* FREE INVENTORY        @Y30LB26*/
         BAL   @14,ERREXIT                                         2337
*                   RETURN;         /*                       @Y30LB26*/
         B     @EL00038                                            2338
*                 END;              /*                       @Y30LB26*/
*                                                                  2339
*               /*****************************************************/
*               /*                                                   */
*               /* SET TO ADDRESS RECORD JUST READ           @Y30LB26*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  2340
*               GROUPPTR=RPLVBUF;   /* ADDR RECORD JUST READ @Y30LB26*/
*                                                                  2340
@RF02335 L     @02,RPLVPTR                                         2340
         L     @02,RPLVBUF(,@02)                                   2340
         ST    @02,GROUPPTR                                        2340
*               /*****************************************************/
*               /*                                                   */
*               /* CHECK MOUNTING ATTRIBUTES                 @Y30LB26*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  2341
*               IF BASBIND=OFF&GROBIND=OFF/* BINDS MATCH?   @Y30LB26*/
*                   BASBIND=ON&GROBIND=ON THEN/* BINDS MATCH?      2341
*                                                            @Y30LB26*/
         L     @01,BASEVPTR                                        2341
         TM    BASBIND(@01),B'00000010'                            2341
         BNZ   @GL00045                                            2341
         TM    GROBIND(@02),B'10000000'                            2341
         BZ    @RT02341                                            2341
@GL00045 L     @02,BASEVPTR                                        2341
         TM    BASBIND(@02),B'00000010'                            2341
         BNO   @RF02341                                            2341
         L     @02,GROUPPTR                                        2341
         TM    GROBIND(@02),B'10000000'                            2341
         BNO   @RF02341                                            2341
@RT02341 DS    0H                                                  2342
*                 DO;               /*                       @Y30LB26*/
*                   IF BASEXCL=OFF&GROEXCL=OFF/* EXCL MATC  @Y30LB26*/
*                       BASEXCL=ON&GROEXCL=ON THEN/* EXCL MAT      2343
*                                                            @Y30LB26*/
         L     @02,BASEVPTR                                        2343
         TM    BASEXCL(@02),B'00000001'                            2343
         BNZ   @GL00048                                            2343
         L     @02,GROUPPTR                                        2343
         TM    GROEXCL(@02),B'01000000'                            2343
         BZ    @RT02343                                            2343
@GL00048 L     @02,BASEVPTR                                        2343
         TM    BASEXCL(@02),B'00000001'                            2343
         BNO   @RF02343                                            2343
         L     @02,GROUPPTR                                        2343
         TM    GROEXCL(@02),B'01000000'                            2343
         BNO   @RF02343                                            2343
@RT02343 DS    0H                                                  2344
*                     DO;           /*                       @Y30LB26*/
*                       IF BASDAERA=OFF&GRODAERA=OFF/* ERA  @Y30LB26*/
*                           BASDAERA=ON&GRODAERA=ON THEN/* ERA     2345
*                                                            @Y30LB26*/
         L     @02,BASEVPTR                                        2345
         TM    BASDAERA(@02),B'10000000'                           2345
         BNZ   @GL00051                                            2345
         L     @02,GROUPPTR                                        2345
         TM    GRODAERA(@02),B'00100000'                           2345
         BZ    @RT02345                                            2345
@GL00051 L     @02,BASEVPTR                                        2345
         TM    BASDAERA(@02),B'10000000'                           2345
         BNO   @RF02345                                            2345
         L     @02,GROUPPTR                                        2345
         TM    GRODAERA(@02),B'00100000'                           2345
         BNO   @RF02345                                            2345
@RT02345 DS    0H                                                  2346
*                         DO;       /*                       @Y30LB26*/
*                           IF BASRONLY=OFF&GRORONLY=OFF/*  @Y30LB26*/
*                               BASRONLY=ON&GRORONLY=ON/*    @Y30LB26*/
*                             THEN                                 2347
         L     @02,BASEVPTR                                        2347
         TM    BASRONLY(@02),B'01000000'                           2347
         BNZ   @GL00054                                            2347
         L     @02,GROUPPTR                                        2347
         TM    GRORONLY(@02),B'00010000'                           2347
         BZ    @RT02347                                            2347
@GL00054 L     @02,BASEVPTR                                        2347
         TM    BASRONLY(@02),B'01000000'                           2347
         BNO   @RF02347                                            2347
         L     @02,GROUPPTR                                        2347
         TM    GRORONLY(@02),B'00010000'                           2347
         BNO   @RF02347                                            2347
@RT02347 DS    0H                                                  2348
*                             I=I;  /* DUMMY INST            @Y30LB26*/
         SLR   @02,@02                                             2348
         IC    @02,I                                               2348
         STC   @02,I                                               2348
*                           ELSE    /*                       @Y30LB26*/
*                             DO;   /*                       @Y30LB26*/
         B     @RC02347                                            2349
@RF02347 DS    0H                                                  2350
*                               RPLVRETC=FOUR;/* BAD RC      @Y30LB26*/
         L     @02,RPLVPTR                                         2350
         MVC   RPLVRETC(2,@02),@CB00749                            2350
*                               RPLRCODE=INCOMSS1;/* INCOM   @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00827                            2351
*                               CALL ERREXIT;/* SAVE STUFF   @Y30LB26*/
         BAL   @14,ERREXIT                                         2352
*                               RETURN;/*                    @Y30LB26*/
         B     @EL00038                                            2353
*                             END;  /*                       @Y30LB26*/
*                         END;      /*                       @Y30LB26*/
*                       ELSE        /*                       @Y30LB26*/
*                         DO;       /*                       @Y30LB26*/
         B     @RC02345                                            2356
@RF02345 DS    0H                                                  2357
*                           RPLVRETC=FOUR;/* BAD RC          @Y30LB26*/
         L     @02,RPLVPTR                                         2357
         MVC   RPLVRETC(2,@02),@CB00749                            2357
*                           RPLRCODE=INCOMSS1;/* INCOM SS    @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00827                            2358
*                           CALL ERREXIT;/* SAVE             @Y30LB26*/
         BAL   @14,ERREXIT                                         2359
*                           RETURN; /*                       @Y30LB26*/
         B     @EL00038                                            2360
*                         END;      /*                       @Y30LB26*/
*                     END;          /*                       @Y30LB26*/
*                   ELSE            /*                       @Y30LB26*/
*                     DO;           /*                       @Y30LB26*/
         B     @RC02343                                            2363
@RF02343 DS    0H                                                  2364
*                       RPLVRETC=FOUR;/* BAD RC              @Y30LB26*/
         L     @02,RPLVPTR                                         2364
         MVC   RPLVRETC(2,@02),@CB00749                            2364
*                       RPLRCODE=INCOMSS1;/* INCOM           @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00827                            2365
*                       CALL ERREXIT;/* SAVE RET             @Y30LB26*/
         BAL   @14,ERREXIT                                         2366
*                       RETURN;     /*                       @Y30LB26*/
         B     @EL00038                                            2367
*                     END;          /*                       @Y30LB26*/
*                 END;              /*                       @Y30LB26*/
*               ELSE                /*                       @Y30LB26*/
*                                                                  2370
*                 /***************************************************/
*                 /*                                                 */
*                 /* IF ATTRIBUTES DONT MATCH, EXIT ERROR    @Y30LB26*/
*                 /*                                                 */
*                 /***************************************************/
*                                                                  2370
*                 DO;               /*                       @Y30LB26*/
         B     @RC02341                                            2370
@RF02341 DS    0H                                                  2371
*                   RPLVRETC=FOUR;  /* SET BAD RC            @Y30LB26*/
         L     @02,RPLVPTR                                         2371
         MVC   RPLVRETC(2,@02),@CB00749                            2371
*                   RPLRCODE=INCOMSS1;/* INCOMPAT SS1 ATT    @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00827                            2372
*                   CALL ERREXIT;   /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         2373
*                   RETURN;         /*                       @Y30LB26*/
         B     @EL00038                                            2374
*                 END;              /*                       @Y30LB26*/
*             END;                  /*                       @Y30LB26*/
*                                                                  2376
@RC02341 DS    0H                                                  2377
*           /*********************************************************/
*           /*                                                       */
*           /* SEE IF RECORD WAS IN GROUP BEFORE             @Y30LB26*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  2377
*           IF BASGRPV=ON THEN      /* VOLUME GROUPED        @Y30LB26*/
*                                                                  2377
@RF02324 L     @02,BASEVPTR                                        2377
         TM    BASGRPV(@02),B'00100000'                            2377
         BNO   @RF02377                                            2377
*             /*******************************************************/
*             /*                                                     */
*             /* GO REMOVE RECORD FROM GROUP CHAIN           @Y30LB26*/
*             /*                                                     */
*             /*******************************************************/
*                                                                  2378
*             DO;                   /*                       @Y30LB26*/
*               CALL GROUPOUT;      /* GET REC OUT OF GROUP  @Y30LB26*/
         BAL   @14,GROUPOUT                                        2379
*               IF RPLVRETC^=RCZERO THEN/* CK RETURN CODE    @Y30LB26*/
         L     @02,RPLVPTR                                         2380
         CLC   RPLVRETC(2,@02),@CB00747                            2380
         BNE   @RT02380                                            2380
*                 RETURN;           /*                       @Y30LB26*/
*             END;                  /*                       @Y30LB26*/
*           ELSE                    /*                       @Y30LB26*/
*                                                                  2383
*             /*******************************************************/
*             /*                                                     */
*             /* GO TAKE RECORD OUT OF NON-GROUP             @Y30LB26*/
*             /*                                                     */
*             /*******************************************************/
*                                                                  2383
*             DO;                   /*                       @Y30LB26*/
         B     @RC02377                                            2383
@RF02377 DS    0H                                                  2384
*               CALL NGRPOUT;       /* GET REC OUT NON-GRP   @Y30LB26*/
         BAL   @14,NGRPOUT                                         2384
*               IF RPLVRETC^=RCZERO THEN/* CK RETURN         @Y30LB26*/
         L     @02,RPLVPTR                                         2385
         CLC   RPLVRETC(2,@02),@CB00747                            2385
         BNE   @RT02385                                            2385
*                 RETURN;           /*                       @Y30LB26*/
*             END;                  /*                       @Y30LB26*/
*                                                                  2387
*           /*********************************************************/
*           /*                                                       */
*           /* GO PUT RECORD INTO GROUP                      @Y30LB26*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  2388
*           CALL GROUPIN;           /* PUT RECORD INTO GRP   @Y30LB26*/
@RC02377 BAL   @14,GROUPIN                                         2388
*           IF RPLVRETC^=RCZERO THEN/* WAS IT SUCCESSFUL     @Y30LB26*/
         L     @02,RPLVPTR                                         2389
         CLC   RPLVRETC(2,@02),@CB00747                            2389
         BNE   @RT02389                                            2389
*             RETURN;               /*                       @Y30LB26*/
*                                                                  2390
*           /*********************************************************/
*           /*                                                       */
*           /* GO UPDATE THE COMMON FIELDS IN THE BASE REC   @Y30LB26*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  2391
*           CALL COMMON;            /* UPD COM FIELD IN BASE @Y30LB26*/
         BAL   @14,COMMON                                          2391
*           RETURN;                 /*                       @Y30LB26*/
         B     @EL00038                                            2392
*         END;                      /*                       @Y30LB26*/
*     END;                          /*                       @Y30LB26*/
*                                                                  2394
@RF02322 DS    0H                                                  2395
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR CHANGE TO NON-GROUPED                       @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2395
*   IF MVRNGRP=ON&BASGRPV=ON THEN   /* GOING NON-GRP?        @Y30LB26*/
@RF02320 L     @02,MVRPTR                                          2395
         TM    MVRNGRP(@02),B'00100000'                            2395
         BNO   @RF02395                                            2395
         L     @02,BASEVPTR                                        2395
         TM    BASGRPV(@02),B'00100000'                            2395
         BNO   @RF02395                                            2395
*     DO;                           /*                       @Y30LB26*/
*                                                                  2396
*       /*************************************************************/
*       /*                                                           */
*       /* GO TAKE RECORD OUT OF GROUP THAT IT IS NOW IN     @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  2397
*       CALL GROUPOUT;              /* GET IT OUT OF GRP     @Y30LB26*/
         BAL   @14,GROUPOUT                                        2397
*       IF RPLVRETC^=RCZERO THEN    /* CK RETURN             @Y30LB26*/
         L     @02,RPLVPTR                                         2398
         CLC   RPLVRETC(2,@02),@CB00747                            2398
         BNE   @RT02398                                            2398
*         RETURN;                   /*                       @Y30LB26*/
*                                                                  2399
*       /*************************************************************/
*       /*                                                           */
*       /* GO PUT RECORD IN NON-GROUP CATAGORY               @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  2400
*       CALL NGROUPIN;              /* PUT IN NON-GRPED      @Y30LB26*/
         BAL   @14,NGROUPIN                                        2400
*       IF RPLVRETC^=RCZERO THEN    /* CK RETURN CODE        @Y30LB26*/
         L     @02,RPLVPTR                                         2401
         CLC   RPLVRETC(2,@02),@CB00747                            2401
         BNE   @RT02401                                            2401
*         RETURN;                   /*                       @Y30LB26*/
*                                                                  2402
*       /*************************************************************/
*       /*                                                           */
*       /* GO UPDATE COMMON FIELDS IN BASE REC               @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  2403
*       CALL COMMON;                /* UPDATE COMMON FIELDS  @Y30LB26*/
         BAL   @14,COMMON                                          2403
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00038                                            2404
*     END;                          /*                       @Y30LB26*/
*                                                                  2405
*   /*****************************************************************/
*   /*                                                               */
*   /* THIS A GROUPED VOLUME ?                               @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2406
*   IF BASGRPV=ON THEN              /* THIS A GRPED VOL?     @Y30LB26*/
@RF02395 L     @02,BASEVPTR                                        2406
         TM    BASGRPV(@02),B'00100000'                            2406
         BNO   @RF02406                                            2406
*     DO;                           /*                       @Y30LB26*/
*                                                                  2407
*       /*************************************************************/
*       /*                                                           */
*       /* WANT TO CHANGE TO GENERAL USE ?                   @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  2408
*       IF MVRGEN=ON THEN           /* WANT GENERAL USE?     @Y30LB26*/
         L     @01,MVRPTR                                          2408
         TM    MVRGEN(@01),B'10000000'                             2408
         BNO   @RF02408                                            2408
*         DO;                       /*                       @Y30LB26*/
*                                                                  2409
*           /*********************************************************/
*           /*                                                       */
*           /* WAS IT RESTRICTED BEFORE ?                    @Y30LB26*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  2410
*           IF BASRSTD=ON THEN      /* WAS RESTRICTED?       @Y30LB26*/
*                                                                  2410
         TM    BASRSTD(@02),B'00001000'                            2410
         BNO   @RF02410                                            2410
*             /*******************************************************/
*             /*                                                     */
*             /* SINCE RESTRICTED BEFORE AND GOING GENERAL   @Y30LB26*/
*             /* GO MAKE INTO A GENERAL VOLUME IN THE        @Y30LB26*/
*             /* SAME GROUP                                  @Y30LB26*/
*             /*                                                     */
*             /*******************************************************/
*                                                                  2411
*             DO;                   /*                       @Y30LB26*/
*               CALL GENERAL;       /* GO FROM RESTRCTED-GEN @Y30LB26*/
         BAL   @14,GENERAL                                         2412
*               IF RPLRCODE^=RCZERO THEN/* RETURN CODE       @Y30LB26*/
         L     @02,RPLVPTR                                         2413
         CLC   RPLRCODE(2,@02),@CB00747                            2413
         BNE   @RT02413                                            2413
*                 RETURN;           /*                       @Y30LB26*/
*                                                                  2414
*               /*****************************************************/
*               /*                                                   */
*               /* GO FILL IN ANY COMMON FIELDS IN BASE VOL  @Y30LB26*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  2415
*               CALL COMMON;        /* UPDATE COMMON FIELDS  @Y30LB26*/
         BAL   @14,COMMON                                          2415
*               RETURN;             /*                       @Y30LB26*/
         B     @EL00038                                            2416
*             END;                  /*                       @Y30LB26*/
*         END;                      /*                       @Y30LB26*/
*                                                                  2418
@RF02410 DS    0H                                                  2419
*       /*************************************************************/
*       /*                                                           */
*       /* IS A CHANGE TO RESTRICTED USE BEING CALLED FOR ?  @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  2419
*       IF MVRRSTD=ON THEN          /* WANT RESTRICTED USE?  @Y30LB26*/
@RF02408 L     @02,MVRPTR                                          2419
         TM    MVRRSTD(@02),B'01000000'                            2419
         BNO   @RF02419                                            2419
*         DO;                       /*                       @Y30LB26*/
*                                                                  2420
*           /*********************************************************/
*           /*                                                       */
*           /* WAS IT A GENERAL USE VOL BEFORE ?             @Y30LB26*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  2421
*           IF BASGENUS=ON THEN     /* WAS GENERAL BEFORE?   @Y30LB26*/
*                                                                  2421
         L     @02,BASEVPTR                                        2421
         TM    BASGENUS(@02),B'00010000'                           2421
         BNO   @RF02421                                            2421
*             /*******************************************************/
*             /*                                                     */
*             /* SINCE WAS GENERAL USE BEFORE AND IS GOING   @Y30LB26*/
*             /* RESTRICTED, GO MAKE RESTRICTED IN THE SAME  @Y30LB26*/
*             /* GROUP THAT IT WAS IN                        @Y30LB26*/
*             /*                                                     */
*             /*******************************************************/
*                                                                  2422
*             DO;                   /*                       @Y30LB26*/
*               CALL RESTRICT;      /* PROCESS AS RESTRCTED  @Y30LB26*/
         BAL   @14,RESTRICT                                        2423
*               IF RPLVRETC^=RCZERO THEN/* CK RETURN CODE    @Y30LB26*/
         L     @02,RPLVPTR                                         2424
         CLC   RPLVRETC(2,@02),@CB00747                            2424
         BNE   @RT02424                                            2424
*                 RETURN;           /*                       @Y30LB26*/
*                                                                  2425
*               /*****************************************************/
*               /*                                                   */
*               /* FILL IN COMMON FIELDS IN BASE REC         @Y30LB26*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  2426
*               CALL COMMON;        /* FIELD IN COM FIELDS   @Y30LB26*/
         BAL   @14,COMMON                                          2426
*               RETURN;             /*                       @Y30LB26*/
         B     @EL00038                                            2427
*             END;                  /*                       @Y30LB26*/
*         END;                      /*                       @Y30LB26*/
@RF02421 DS    0H                                                  2430
*     END;                          /*                       @Y30LB26*/
*                                                                  2430
@RF02419 DS    0H                                                  2431
*   /*****************************************************************/
*   /*                                                               */
*   /* IF VOLUME DID NOT CHANGE GROUPS OR CLASIFICATION,     @Y30LB26*/
*   /* CALL COMMON TO CHANGE ANY OTHER FIELDS SPECIFIED      @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2431
*   CALL COMMON;                    /* UPDATE REMAINING      @Y30LB26*/
@RF02406 BAL   @14,COMMON                                          2431
*   RETURN;                         /*                       @Y30LB26*/
         B     @EL00038                                            2432
*   END MODIFYV;                    /*                       @Y30LB26*/
         B     @EL00038                                            2433
*                                                                  2434
*   /*****************************************************************/
*   /*                                                               */
*   /* THIS ROUTINE READS A CARTRIDGE INDEX RECORD AND GETS  @Y30LB26*/
*   /* ITS OWNER KEY WHICH IS A COPY VOL RECORD AND          @Y30LB26*/
*   /* CHANGES IT TO A BACKUP AND/OR CLEARS THE INCOMPLETE   @Y30LB26*/
*   /* COPY FLAG. IF IT MADE A NEW BACKUP, IT THEN READS     @Y30LB26*/
*   /* THE BASE VOLUME RECORD AND ADDS ONE TO THE NUMBER OF  @Y30LB26*/
*   /* BACKUP COPIES.                                        @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2434
*MODCOPY:                                                          2434
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
MODCOPY  ST    @14,@SA00039                                        2434
*   IF MVRCICPY=OFF&MVRBKUP=OFF THEN/* VALID REQUEST ?       @Y30LB26*/
         L     @02,MVRPTR                                          2435
         TM    MVRCICPY(@02),B'01000000'                           2435
         BNZ   @RF02435                                            2435
         TM    MVRBKUP(@02),B'00010000'                            2435
         BNZ   @RF02435                                            2435
*     DO;                           /*                       #Y30LB26*/
*       RPLVRETC=FOUR;              /* BAD RET CODE          @Y30LB26*/
         L     @02,RPLVPTR                                         2437
         MVC   RPLVRETC(2,@02),@CB00749                            2437
*       RPLRCODE=INVALCPY;          /* CSN MUST BE GIVEN     @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00803                            2438
*       CALL ERREXIT;               /* SAVE REASON CODES     @Y30LB26*/
         BAL   @14,ERREXIT                                         2439
*       RETURN;                     /*                       @Y30LB26*/
@EL00039 DS    0H                                                  2440
@EF00039 DS    0H                                                  2440
@ER00039 L     @14,@SA00039                                        2440
         BR    @14                                                 2440
*     END;                          /*                       @Y30LB26*/
*                                                                  2441
*   /*****************************************************************/
*   /*                                                               */
*   /* GET CARTRIDGE INDEX NUMBER AND READ INDEX RECORD      @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2442
*   CARTKY=MVRCSN;                  /* CART SERIAL NUMBER    #Y30LB26*/
@RF02435 L     @02,MVRPTR                                          2442
         MVC   CARTKY(12),MVRCSN(@02)                              2442
*   RPLVKEY=ADDR(IKEY);             /* ADDR OF KEY           #Y30LB26*/
         L     @02,RPLVPTR                                         2443
         LA    @15,IKEY                                            2443
         ST    @15,RPLVKEY(,@02)                                   2443
*   RPLVLOC=ON;                     /* LOCATE MODE           #Y30LB26*/
*   RPLVDIR=ON;                     /* READ DIRECT           #Y30LB26*/
         OI    RPLVLOC(@02),B'11000000'                            2445
*   RPLVTYP=RPLVREAD;               /* READ RECORD           @Y30LB26*/
         MVI   RPLVTYP(@02),X'00'                                  2446
*   RESPECIFY                                                      2447
*     REG1 RSTD;                    /* RESPRICT REG 1        @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR OF RPLV          @Y30LB26*/
         LR    REG1,@02                                            2448
*   CALL ICBVIO00;                  /* READ INDEX REC        @Y30LB26*/
         L     @15,@CV00671                                        2449
         BALR  @14,@15                                             2449
*   RESPECIFY                                                      2450
*     REG1 UNRSTD;                  /* FREE REG 1            @Y30LB26*/
*                                                                  2450
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK RETURN CODE FROM I/O                            @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2451
*   IF RPLVRETC^=RCZERO THEN        /* CK RETURN             @Y30LB26*/
         L     @02,RPLVPTR                                         2451
         CLC   RPLVRETC(2,@02),@CB00747                            2451
         BE    @RF02451                                            2451
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         2453
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00039                                            2454
*     END;                          /*                       @Y30LB26*/
*                                                                  2455
*   /*****************************************************************/
*   /*                                                               */
*   /* GET ADDRESSING TO INDEX RECORD AND THEN GET ITS OWNER @Y30LB26*/
*   /* KEY                                                   @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2456
*   INDEXPTR=RPLVBUF;               /* ADDR OF RECORD        #Y30LB26*/
*                                                                  2456
@RF02451 L     @02,RPLVPTR                                         2456
         L     INDEXPTR,RPLVBUF(,@02)                              2456
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK TO SEE IF RECORD OWNING THIS INDEX CART         @Y30LB26*/
*   /* IS REALLY A COPY VOLUME RECORD                        @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2457
*   IF INDPREFX^=VKYINDEXREC=BIT8ZERO THEN/* COPY REC ?     @Y30LB26*/
         CLC   INDPREFX(5,INDEXPTR),VKY                            2457
         BNE   @RT02457                                            2457
         CLI   INDEXREC(INDEXPTR),X'00'                            2457
         BNE   @RF02457                                            2457
@RT02457 DS    0H                                                  2458
*     DO;                           /*                       @Y30LB26*/
*       RPLVRETC=FOUR;              /* BAD RET CODE          @Y30LB26*/
         L     @02,RPLVPTR                                         2459
         MVC   RPLVRETC(2,@02),@CB00749                            2459
*       RPLRCODE=INVALCPY;          /* INVALID CSN SPEC      @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00803                            2460
*       CALL ERREXIT;               /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         2461
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00039                                            2462
*     END;                          /*                       @Y30LB26*/
*   VKEY=INDRECKY;                  /* KEY COPY REC          #Y30LB26*/
@RF02457 MVC   VKEY(13),INDRECKY(INDEXPTR)                         2464
*   RPLVKEY=ADDR(VKEY);             /* ADDR OF KEY           #Y30LB26*/
         L     @02,RPLVPTR                                         2465
         LA    @15,VKEY                                            2465
         ST    @15,RPLVKEY(,@02)                                   2465
*   RPLVBUF=ADDR(STORCPY);          /* ADDR OF BUFFER        #Y30LB26*/
         LA    @15,STORCPY                                         2466
         ST    @15,RPLVBUF(,@02)                                   2466
*   RPLVBLN=LENGTH(STORCPY);        /* LENGTH OF BUFFER      #Y30LB26*/
         MVC   RPLVBLN(4,@02),@CF01147                             2467
*   RPLVLOC=OFF;                    /* NOT LOCATE            #Y30LB26*/
         NI    RPLVLOC(@02),B'01111111'                            2468
*   RPLVTYP=RPLVREAD;               /* READ RECORD           #Y30LB26*/
         MVI   RPLVTYP(@02),X'00'                                  2469
*   RPLVUPD=ON;                     /* READ FOR UPDATE       #Y30LB26*/
         OI    RPLVUPD(@02),B'00000010'                            2470
*   RESPECIFY                                                      2471
*     REG1 RSTD;                    /* RESPRICT REG 1        #Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR OF RPLV          #Y30LB26*/
         LR    REG1,@02                                            2472
*   CALL ICBVIO00;                  /* READ INDEX REC        #Y30LB26*/
         L     @15,@CV00671                                        2473
         BALR  @14,@15                                             2473
*   RESPECIFY                                                      2474
*     REG1 UNRSTD;                  /* FREE REG 1            @Y30LB26*/
*                                                                  2474
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK RETURN CODE FROM I/O                            @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2475
*   IF RPLVRETC^=RCZERO THEN        /* CK RETURN             @Y30LB26*/
         L     @02,RPLVPTR                                         2475
         CLC   RPLVRETC(2,@02),@CB00747                            2475
         BE    @RF02475                                            2475
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         2477
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00039                                            2478
*     END;                          /*                       @Y30LB26*/
*                                                                  2479
*   /*****************************************************************/
*   /*                                                               */
*   /* GET ADDRESS OF COPY RECORD JUST READ AND MAKE IT      @Y30LB26*/
*   /* A BACKUP AND/OR CLEAR INCOMPLETE COPY FLAG            @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2480
*   COPYVPTR=ADDR(STORCPY);         /* ADDR COPY RECORD      #Y30LB26*/
@RF02475 LA    @02,STORCPY                                         2480
         ST    @02,COPYVPTR                                        2480
*   IF MVRBKUP=ON THEN              /* WANT TO MAKE BACKUP ? @Y30LB26*/
         L     @01,MVRPTR                                          2481
         TM    MVRBKUP(@01),B'00010000'                            2481
         BNO   @RF02481                                            2481
*     COPBKUP=ON;                   /* MAKE BACKUP           @Y30LB26*/
         OI    COPBKUP(@02),B'00001000'                            2482
*   IF MVRCICPY=ON THEN             /* WANT CLEAR INCOM BKUP @Y30LB26*/
@RF02481 L     @02,MVRPTR                                          2483
         TM    MVRCICPY(@02),B'01000000'                           2483
         BNO   @RF02483                                            2483
*     COPIVCPY=OFF;                 /* CLEAR INCOM COPY FLAG @Y30LB26*/
*                                                                  2484
         L     @02,COPYVPTR                                        2484
         NI    COPIVCPY(@02),B'10111111'                           2484
*   /*****************************************************************/
*   /*                                                               */
*   /* WRITE COPY RECORD                                     #Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2485
*   RPLVTYP=RPLVPUT;                /* INDICATE A WRITE      #Y30LB26*/
@RF02483 L     @02,RPLVPTR                                         2485
         MVI   RPLVTYP(@02),X'01'                                  2485
*   RESPECIFY                                                      2486
*     REG1 RSTD;                    /* RESPRICT REG 1        #Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR OF RPLV          #Y30LB26*/
         LR    REG1,@02                                            2487
*   CALL ICBVIO00;                  /* READ INDEX REC        #Y30LB26*/
         L     @15,@CV00671                                        2488
         BALR  @14,@15                                             2488
*   RESPECIFY                                                      2489
*     REG1 UNRSTD;                  /* FREE REG 1            #Y30LB26*/
*                                                                  2489
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK RETURN CODE FROM I/O                            #Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2490
*   IF RPLVRETC^=RCZERO THEN        /* CK RETURN             #Y30LB26*/
         L     @02,RPLVPTR                                         2490
         CLC   RPLVRETC(2,@02),@CB00747                            2490
         BE    @RF02490                                            2490
*     DO;                           /*                       #Y30LB26*/
*       CALL ERREXIT;               /* SAVE RET CODES        #Y30LB26*/
         BAL   @14,ERREXIT                                         2492
*       RETURN;                     /*                       #Y30LB26*/
         B     @EL00039                                            2493
*     END;                          /*                       #Y30LB26*/
*                                                                  2494
*   /*****************************************************************/
*   /*                                                               */
*   /* IF IT WAS A SUCCESSFUL WRITE, THEN SEE IF JOURNALED   #Y30LB26*/
*   /* BEFORE. IF IT WAS NOT, JOURNAL THE RPLV.              #Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2495
*   IF JRNLEDSW=OFF THEN            /* JOURNALED BEFORE      #Y30LB26*/
@RF02490 TM    JRNLEDSW,B'00000001'                                2495
         BNZ   @RF02495                                            2495
*     DO;                           /*                       #Y30LB26*/
*       CALL JOURNAL;               /*                       #Y30LB26*/
         BAL   @14,JOURNAL                                         2497
*       IF RPLVRETC^=RCZERO THEN    /* CK RETURN             #Y30LB26*/
         L     @02,RPLVPTR                                         2498
         CLC   RPLVRETC(2,@02),@CB00747                            2498
         BE    @RF02498                                            2498
*         DO;                       /*                       #Y30LB26*/
*           CALL ERREXIT;           /* FREE INVENTORY        #Y30LB26*/
         BAL   @14,ERREXIT                                         2500
*           RETURN;                 /*                       #Y30LB26*/
         B     @EL00039                                            2501
*         END;                      /*                       #Y30LB26*/
*     END;                          /*                       #Y30LB26*/
*                                                                  2503
@RF02498 DS    0H                                                  2504
*   /*****************************************************************/
*   /*                                                               */
*   /* IF COPY WAS MADE INTO A BACKUP,                       @Y30LB26*/
*   /* READ THE BASE VOLUME RECORD TO ADD ONE TO NUMBER      #Y30LB26*/
*   /* OF BACKUP COPIES FOR THAT VOLUME                      #Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2504
*   IF MVRBKUP=ON THEN              /* WAS BACKUP REQUEST ?  @Y30LB26*/
@RF02495 L     @02,MVRPTR                                          2504
         TM    MVRBKUP(@02),B'00010000'                            2504
         BNO   @RF02504                                            2504
*     DO;                           /*                       @Y30LB26*/
*       VIDKY=FIXZERO;              /* SET ID TO ZERO        @Y30LB26*/
         MVI   VIDKY,X'00'                                         2506
*       RPLVKEY=ADDR(VKEY);         /* ADDR OF KEY           @Y30LB26*/
         L     @02,RPLVPTR                                         2507
         LA    @15,VKEY                                            2507
         ST    @15,RPLVKEY(,@02)                                   2507
*       RPLVBUF=ADDR(STORBASE);     /* ADDR OF BUFFER        @Y30LB26*/
         LA    @15,STORBASE                                        2508
         ST    @15,RPLVBUF(,@02)                                   2508
*       RPLVBLN=LENGTH(STORBASE);   /* LENGTH BUFFER         @Y30LB26*/
         MVC   RPLVBLN(4,@02),@CF01147                             2509
*       RPLVTYP=RPLVREAD;           /* READ RECORD           @Y30LB26*/
         MVI   RPLVTYP(@02),X'00'                                  2510
*       RPLVUPD=ON;                 /* FOR UPDATE            @Y30LB26*/
         OI    RPLVUPD(@02),B'00000010'                            2511
*       RESPECIFY                                                  2512
*         REG1 RSTD;                /* RESPRICT REG 1        @Y30LB26*/
*       REG1=RPLVPTR;               /* ADDR OF RPLV          @Y30LB26*/
         LR    REG1,@02                                            2513
*       CALL ICBVIO00;              /* READ INDEX REC        @Y30LB26*/
         L     @15,@CV00671                                        2514
         BALR  @14,@15                                             2514
*       RESPECIFY                                                  2515
*         REG1 UNRSTD;              /* FREE REG 1            @Y30LB26*/
*                                                                  2515
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK RETURN CODE FROM I/O                        @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  2516
*       IF RPLVRETC^=RCZERO THEN    /* CK RETURN             @Y30LB26*/
         L     @02,RPLVPTR                                         2516
         CLC   RPLVRETC(2,@02),@CB00747                            2516
         BE    @RF02516                                            2516
*         DO;                       /*                       @Y30LB26*/
*           CALL ERREXIT;           /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         2518
*           RETURN;                 /*                       @Y30LB26*/
         B     @EL00039                                            2519
*         END;                      /*                       @Y30LB26*/
*                                                                  2520
*       /*************************************************************/
*       /*                                                           */
*       /* GET ADDRESS OF BASE VOLUME RECORD AND ADD ONE     @Y30LB26*/
*       /* TO NUMBER OF BACKUP COPIES                        @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  2521
*       BASEVPTR=ADDR(STORBASE);    /* ADDR BASE RECORD      @Y30LB26*/
@RF02516 LA    @02,STORBASE                                        2521
         ST    @02,BASEVPTR                                        2521
*       BASNBKUP=BASNBKUP+ONE;      /* ADD ONE BACKUP        @Y30LB26*/
*                                                                  2522
         LA    @15,1                                               2522
         SLR   @14,@14                                             2522
         IC    @14,BASNBKUP(,@02)                                  2522
         ALR   @15,@14                                             2522
         STC   @15,BASNBKUP(,@02)                                  2522
*       /*************************************************************/
*       /*                                                           */
*       /* WRITE BASE VOLUME RECORD                          @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  2523
*       RPLVTYP=RPLVPUT;            /* PUT RECORD            @Y30LB26*/
         L     @02,RPLVPTR                                         2523
         MVI   RPLVTYP(@02),X'01'                                  2523
*       RESPECIFY                                                  2524
*         REG1 RSTD;                /* RESPRICT REG 1        @Y30LB26*/
*       REG1=RPLVPTR;               /* ADDR OF RPLV          @Y30LB26*/
         LR    REG1,@02                                            2525
*       CALL ICBVIO00;              /* READ INDEX REC        @Y30LB26*/
         L     @15,@CV00671                                        2526
         BALR  @14,@15                                             2526
*       RESPECIFY                                                  2527
*         REG1 UNRSTD;              /* FREE REG 1            @Y30LB26*/
*                                                                  2527
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK RETURN CODE FROM I/O                        @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  2528
*       IF RPLVRETC^=RCZERO THEN    /* CK RETURN             @Y30LB26*/
         L     @02,RPLVPTR                                         2528
         CLC   RPLVRETC(2,@02),@CB00747                            2528
         BE    @RF02528                                            2528
*         DO;                       /*                       @Y30LB26*/
*           CALL ERREXIT;           /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         2530
*           RETURN;                 /*                       @Y30LB26*/
         B     @EL00039                                            2531
*         END;                      /*                       @Y30LB26*/
*                                                                  2532
*       /*************************************************************/
*       /*                                                           */
*       /* IF WAS SUCCESSFUL WRITE, THEN SEE IF JOURNALED    @Y30LB26*/
*       /* BEFORE. IF IT WASNOT, JOURNAL THE RPLV.           @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  2533
*       IF JRNLEDSW=OFF THEN        /* JOURNALED BEFORE      @Y30LB26*/
@RF02528 TM    JRNLEDSW,B'00000001'                                2533
         BNZ   @RF02533                                            2533
*         DO;                       /*                       @Y30LB26*/
*           CALL JOURNAL;           /*                       @Y30LB26*/
         BAL   @14,JOURNAL                                         2535
*           IF RPLVRETC^=RCZERO THEN/* CK RETURN             @Y30LB26*/
         L     @02,RPLVPTR                                         2536
         CLC   RPLVRETC(2,@02),@CB00747                            2536
         BE    @RF02536                                            2536
*             DO;                   /*                       @Y30LB26*/
*               CALL ERREXIT;       /* FREE INVENTORY        @Y30LB26*/
         BAL   @14,ERREXIT                                         2538
*               RETURN;             /*                       @Y30LB26*/
         B     @EL00039                                            2539
*             END;                  /*                       @Y30LB26*/
*         END;                      /*                       @Y30LB26*/
*     END;                          /*                       @Y30LB26*/
*   RETURN;                         /*                       #Y30LB26*/
         B     @EL00039                                            2543
*   END MODCOPY;                    /*                       #Y30LB26*/
         B     @EL00039                                            2544
*                                                                  2545
*   /*****************************************************************/
*   /*                                                               */
*   /* THIS ROUTINE TAKES A BASE VOLUME RECORD OUT OF        #Y30LB26*/
*   /* THE GROUP IT IS IN AND GETS IT READY TO GO            #Y30LB26*/
*   /* EITHER INTO ANOTHER GROUP OR BECOME NON-GROUPED       #Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2545
*GROUPOUT:                                                         2545
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
*                                                                  2545
GROUPOUT ST    @14,@SA00040                                        2545
*   /*****************************************************************/
*   /*                                                               */
*   /* READ THE OLD GROUP RECORD SO CAN GET VOL OUT OF IT    #Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2546
*   GROUPKY=BASGROUP;               /* GROUP NAME            #Y30LB26*/
         L     @02,BASEVPTR                                        2546
         MVC   GROUPKY(8),BASGROUP(@02)                            2546
*   RPLVKEY=ADDR(GKEY);             /* ADDR OF KEY           #Y30LB26*/
         L     @02,RPLVPTR                                         2547
         LA    @15,GKEY                                            2547
         ST    @15,RPLVKEY(,@02)                                   2547
*   RPLVBUF=ADDR(STORGRP);          /* ADDR BUFFER           #Y30LB26*/
         LA    @15,STORGRP                                         2548
         ST    @15,RPLVBUF(,@02)                                   2548
*   RPLVBLN=LENGTH(STORGRP);        /* LENGTH BUFFER         #Y30LB26*/
         MVC   RPLVBLN(4,@02),@CF01147                             2549
*   RPLVLOC=OFF;                    /* NO LOCATE             #Y30LB26*/
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB26*/
         OI    RPLVDIR(@02),B'01000000'                            2551
         NI    RPLVLOC(@02),B'01111111'                            2551
*   RPLVTYP=RPLVREAD;               /* READ GROUP            @Y30LB26*/
         MVI   RPLVTYP(@02),X'00'                                  2552
*   RESPECIFY                                                      2553
*     REG1 RSTD;                    /* RESTRICT 1            @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR PRLV             @Y30LB26*/
         LR    REG1,@02                                            2554
*   CALL ICBVIO00;                  /* READ GROUP REC        @Y30LB26*/
         L     @15,@CV00671                                        2555
         BALR  @14,@15                                             2555
*   RESPECIFY                                                      2556
*     REG1 UNRSTD;                  /* FREE                  @Y30LB26*/
*                                                                  2556
*   /*****************************************************************/
*   /*                                                               */
*   /* RETURN CODE FROM I/O PROCESSOR                        @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2557
*   IF RPLVRETC^=RCZERO THEN        /* CK RETURN             @Y30LB26*/
         L     @02,RPLVPTR                                         2557
         CLC   RPLVRETC(2,@02),@CB00747                            2557
         BE    @RF02557                                            2557
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* FREE INVENTORY        @Y30LB26*/
         BAL   @14,ERREXIT                                         2559
*       RETURN;                     /*                       @Y30LB26*/
@EL00040 DS    0H                                                  2560
@EF00040 DS    0H                                                  2560
@ER00040 L     @14,@SA00040                                        2560
         BR    @14                                                 2560
*     END;                          /*                       @Y30LB26*/
*                                                                  2561
*   /*****************************************************************/
*   /*                                                               */
*   /* GET ADDRESS OF RECORD JUST READ                       @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2562
*   GROUPPTR=ADDR(STORGRP);         /* ADDRESSING TO BUFFER  @Y30LB26*/
*                                                                  2562
@RF02557 LA    @02,STORGRP                                         2562
         ST    @02,GROUPPTR                                        2562
*   /*****************************************************************/
*   /*                                                               */
*   /* IF GENERAL USE BEFORE, DECREASE COUNT BY ONE          @Y30LB26*/
*   /* RESTRICTED, DECREASE RESTRICTED COUNT                 @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2563
*   IF BASGENUS=ON THEN             /* GEN USE?              @Y30LB26*/
         L     @01,BASEVPTR                                        2563
         TM    BASGENUS(@01),B'00010000'                           2563
         BNO   @RF02563                                            2563
*     GRONGEN=GRONGEN-ONE;          /* DECREASE COUNT        @Y30LB26*/
         LH    @15,GRONGEN(,@02)                                   2564
         BCTR  @15,0                                               2564
         STH   @15,GRONGEN(,@02)                                   2564
*   ELSE                            /*                       @Y30LB26*/
*     GRONRSTD=GRONRSTD-ONE;        /* DECREASE RSTED COUNT  @Y30LB26*/
*                                                                  2565
         B     @RC02563                                            2565
@RF02563 L     @02,GROUPPTR                                        2565
         LH    @15,GRONRSTD(,@02)                                  2565
         BCTR  @15,0                                               2565
         STH   @15,GRONRSTD(,@02)                                  2565
*   /*****************************************************************/
*   /*                                                               */
*   /* IF BASE VOL IS A GENERAL USE TYPE, GO REMOVE ITS      #Y30LB26*/
*   /* SLOT IN THE EXTENSION RECORD                          #Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2566
*   IF BASGENUS=ON THEN             /* GENERAL USE VOL       #Y30LB26*/
@RC02563 L     @02,BASEVPTR                                        2566
         TM    BASGENUS(@02),B'00010000'                           2566
         BNO   @RF02566                                            2566
*     DO;                           /*                       @Y30LB26*/
*       ADDSLEXT=OFF;               /* INDICATE REMOVE SLOT  @Y30LB26*/
         NI    ADDSLEXT,B'11111101'                                2568
*       SLOTEXP=OFF;                /* NO EXPIRATION CHANGE  @Y30LB26*/
         NI    SLOTEXP,B'01111111'                                 2569
*       CALL VUEXT;                 /* REMOVE SLOT IN EXTEN  @Y30LB26*/
         BAL   @14,VUEXT                                           2570
*       IF RPLVRETC^=RCZERO THEN    /*                       @Y30LB26*/
         L     @02,RPLVPTR                                         2571
         CLC   RPLVRETC(2,@02),@CB00747                            2571
         BE    @RF02571                                            2571
*         DO;                       /*                       @Y30LB26*/
*           CALL ERREXIT;           /* FREE INVENTORY        @Y30LB26*/
         BAL   @14,ERREXIT                                         2573
*           RETURN;                 /*                       @Y30LB26*/
         B     @EL00040                                            2574
*         END;                      /*                       @Y30LB26*/
*                                                                  2575
*       /*************************************************************/
*       /*                                                           */
*       /* CALL PROGRAM TO UPDATE SPACE FIELDS IN THE        @Y30LB26*/
*       /* GROUP RECORD                                      @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  2576
*       ADDGRP=OFF;                 /* INDICATE REMOV SPACE  @Y30LB26*/
@RF02571 NI    ADDGRP,B'11110111'                                  2576
*       CALL ICBVUPGH(GROUPPTR,BASEVPTR,PASSFLAG);/*         @Y30LB26*/
         L     @15,@CV00676                                        2577
         LA    @01,@AL02577                                        2577
         BALR  @14,@15                                             2577
*       IF RPLVRETC^=RCZERO THEN    /*                       @Y30LB26*/
         L     @02,RPLVPTR                                         2578
         CLC   RPLVRETC(2,@02),@CB00747                            2578
         BE    @RF02578                                            2578
*         DO;                       /*                       @Y30LB26*/
*           CALL ERREXIT;           /* FREE INVENTORY        @Y30LB26*/
         BAL   @14,ERREXIT                                         2580
*           RETURN;                 /*                       @Y30LB26*/
         B     @EL00040                                            2581
*         END;                      /*                       @Y30LB26*/
*     END;                          /*                       #Y30LB26*/
*                                                                  2583
@RF02578 DS    0H                                                  2584
*   /*****************************************************************/
*   /*                                                               */
*   /* GO GET BASE RECORD OUT OF GROUP CHAIN                 @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2584
*   CHICHOGP=ON;                    /* INDICATE GROUPED      @Y30LB26*/
@RF02566 OI    CHICHOGP,B'00010000'                                2584
*   CALL ICBVUCHO(GROUPPTR,BASEVPTR,RPLVPTR,PASSFLAG);/*     @Y30LB26*/
         L     @15,@CV00675                                        2585
         LA    @01,@AL02585                                        2585
         BALR  @14,@15                                             2585
*   IF RPLVRETC^=RCZERO THEN        /*                       @Y30LB26*/
         L     @02,RPLVPTR                                         2586
         CLC   RPLVRETC(2,@02),@CB00747                            2586
         BE    @RF02586                                            2586
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* SAVE RETURN CODES     @Y30LB26*/
         BAL   @14,ERREXIT                                         2588
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00040                                            2589
*     END;                          /*                       @Y30LB26*/
*                                                                  2590
*   /*****************************************************************/
*   /*                                                               */
*   /* SET REQUIRED DEFAULTS FOR GROUPIN                     @ZA00673*/
*   /* IF VOLUME IS NEITHER RESTRICTED OR GENERAL USE        @ZA00673*/
*   /* DEFAULT IS GENERAL USE                                @ZA00673*/
*   /* OTHERWISE SET REQUIRED DEFAULT TO VOLUME ATTRIBUTE    @ZA00673*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2591
*   IF MVRRSTD=OFF&MVRGEN=OFF THEN                                 2591
@RF02586 L     @02,MVRPTR                                          2591
         TM    MVRRSTD(@02),B'11000000'                            2591
         BNZ   @RF02591                                            2591
*     DO;                           /*                       @ZA00673*/
*       IF BASRSTD=OFF&BASGENUS=OFF THEN                           2593
         L     @01,BASEVPTR                                        2593
         TM    BASRSTD(@01),B'00011000'                            2593
         BNZ   @RF02593                                            2593
*         MVRGEN=ON;                /*                       @ZA00673*/
         OI    MVRGEN(@02),B'10000000'                             2594
*       IF BASRSTD=OFF&BASGENUS=ON THEN                            2595
@RF02593 L     @02,BASEVPTR                                        2595
         TM    BASGENUS(@02),B'00010000'                           2595
         BNO   @RF02595                                            2595
         TM    BASRSTD(@02),B'00001000'                            2595
         BNZ   @RF02595                                            2595
*         MVRGEN=ON;                /*                       @ZA00673*/
         L     @02,MVRPTR                                          2596
         OI    MVRGEN(@02),B'10000000'                             2596
*       IF BASRSTD=ON&BASGENUS=OFF THEN                            2597
@RF02595 L     @02,BASEVPTR                                        2597
         TM    BASRSTD(@02),B'00001000'                            2597
         BNO   @RF02597                                            2597
         TM    BASGENUS(@02),B'00010000'                           2597
         BNZ   @RF02597                                            2597
*         MVRRSTD=ON;               /*                       @ZA00673*/
         L     @02,MVRPTR                                          2598
         OI    MVRRSTD(@02),B'01000000'                            2598
*     END;                          /*                       @ZA00673*/
*                                                                  2599
@RF02597 DS    0H                                                  2600
*   /*****************************************************************/
*   /*                                                               */
*   /* CLEAR OUT FIELDS IN THE BASE VOL RECORD THAT          #Y30LB26*/
*   /* HAVE BAD INFORMATION IN THEM FROM PREV GROUP          #Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2600
*   BASGRPV=OFF;                    /* NON-GRPED             #Y30LB26*/
@RF02591 DS    0H                                                  2601
*   BASGENUS=OFF;                   /* NOT GENERAL           #Y30LB26*/
*   BASRSTD=OFF;                    /* NOT RESTRICTED        @Y30LB26*/
         L     @02,BASEVPTR                                        2602
         NI    BASGRPV(@02),B'11000111'                            2602
*   BASGROUP=BLANK;                 /* BLANK OUT GROUP NAME  @Y30LB26*/
         MVI   BASGROUP+1(@02),C' '                                2603
         MVC   BASGROUP+2(6,@02),BASGROUP+1(@02)                   2603
         MVI   BASGROUP(@02),C' '                                  2603
*   BASEXPDT=NULEXPDT;              /* CLEAR EXPIRATION      @Y30LB26*/
*                                                                  2604
         MVC   BASEXPDT(4,@02),NULEXPDT                            2604
*   /*****************************************************************/
*   /*                                                               */
*   /* READ GROUP RECORD FOR UPDATE SO IT CAN BE WRITTEN     @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2605
*   RPLVKEY=ADDR(GKEY);             /* ADDR OF KEY           @Y30LB26*/
         L     @02,RPLVPTR                                         2605
         LA    @15,GKEY                                            2605
         ST    @15,RPLVKEY(,@02)                                   2605
*   RPLVBUF=ADDR(DUMMYREC);         /* ADDR DUMMY BUFFER     @Y30LB26*/
         LA    @15,DUMMYREC                                        2606
         ST    @15,RPLVBUF(,@02)                                   2606
*   RPLVBLN=LENGTH(STORGRP);        /* LENGTH OF BUFFER      @Y30LB26*/
         MVC   RPLVBLN(4,@02),@CF01147                             2607
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB26*/
         OI    RPLVDIR(@02),B'01000000'                            2608
*   RPLVTYP=RPLVREAD;               /* READ GROUP            @Y30LB26*/
         MVI   RPLVTYP(@02),X'00'                                  2609
*   RPLVUPD=ON;                     /* FOR UPDATE            @Y30LB26*/
         OI    RPLVUPD(@02),B'00000010'                            2610
*   RESPECIFY                                                      2611
*     REG1 RSTD;                    /* RESTRICT REG1         @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR OF RPLV          @Y30LB26*/
         LR    REG1,@02                                            2612
*   CALL ICBVIO00;                  /* RD GRP REC FOR UPDATE @Y30LB26*/
         L     @15,@CV00671                                        2613
         BALR  @14,@15                                             2613
*   RESPECIFY                                                      2614
*     REG1 UNRSTD;                  /* RESTRICT REG1         @Y30LB26*/
*   IF RPLVRETC^=RCZERO THEN        /* CHECK RETURN CODE     @Y30LB26*/
         L     @02,RPLVPTR                                         2615
         CLC   RPLVRETC(2,@02),@CB00747                            2615
         BE    @RF02615                                            2615
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* SAVE CODES            @Y30LB26*/
         BAL   @14,ERREXIT                                         2617
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00040                                            2618
*     END;                          /*                       @Y30LB26*/
*                                                                  2619
*   /*****************************************************************/
*   /*                                                               */
*   /* WRITE GROUP RECORD                                    @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2620
*   RPLVBUF=ADDR(STORGRP);          /* ADDR RECORD TO PUT    @Y30LB26*/
@RF02615 L     @02,RPLVPTR                                         2620
         LA    @15,STORGRP                                         2620
         ST    @15,RPLVBUF(,@02)                                   2620
*   RPLVTYP=RPLVPUT;                /* PUT GROUP             @Y30LB26*/
         MVI   RPLVTYP(@02),X'01'                                  2621
*   RESPECIFY                                                      2622
*     REG1 RSTD;                    /* RESTRICT REG1         @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR OF RPLV          @Y30LB26*/
         LR    REG1,@02                                            2623
*   CALL ICBVIO00;                  /* RD GRP REC FOR UPDATE @Y30LB26*/
         L     @15,@CV00671                                        2624
         BALR  @14,@15                                             2624
*   RESPECIFY                                                      2625
*     REG1 UNRSTD;                  /* RESTRICT REG1         @Y30LB26*/
*   IF RPLVRETC^=RCZERO THEN        /* CHECK RETURN CODE     @Y30LB26*/
         L     @02,RPLVPTR                                         2626
         CLC   RPLVRETC(2,@02),@CB00747                            2626
         BE    @RF02626                                            2626
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* SAVE CODES            @Y30LB26*/
         BAL   @14,ERREXIT                                         2628
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00040                                            2629
*     END;                          /*                       @Y30LB26*/
*                                                                  2630
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THE RPLV DATA SET HAS NEVER BEEN JOURNLED          @Y30LB26*/
*   /* BEFORE, JOURNAL IT SINCE AN UPDATE HAS BEEN MADE      @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2631
*   IF JRNLEDSW=OFF THEN            /* JOURNALED BEFORE?     @Y30LB26*/
@RF02626 TM    JRNLEDSW,B'00000001'                                2631
         BNZ   @RF02631                                            2631
*     CALL JOURNAL;                 /* JOURNAL IT            @Y30LB26*/
         BAL   @14,JOURNAL                                         2632
*   RETURN;                         /*                       @Y30LB26*/
         B     @EL00040                                            2633
*   END GROUPOUT;                   /*                       @Y30LB26*/
         B     @EL00040                                            2634
*                                                                  2635
*   /*****************************************************************/
*   /*                                                               */
*   /* THIS ROUTINE PUTS A BASE VOL REC INTO A GROUP         @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2635
*GROUPIN:                                                          2635
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
*                                                                  2635
GROUPIN  ST    @14,@SA00041                                        2635
*   /*****************************************************************/
*   /*                                                               */
*   /* READ THE NEW GROUP RECORD                             @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2636
*   GROUPKY=MVRGROUP;               /* GROUP NAME TO KEY     @Y30LB26*/
         L     @02,MVRPTR                                          2636
         MVC   GROUPKY(8),MVRGROUP(@02)                            2636
*   RPLVKEY=ADDR(GKEY);             /* ADDR IF KEY           @Y30LB26*/
         L     @02,RPLVPTR                                         2637
         LA    @15,GKEY                                            2637
         ST    @15,RPLVKEY(,@02)                                   2637
*   RPLVBUF=ADDR(STORGRP);          /* ADDR BUFFER           @Y30LB26*/
         LA    @15,STORGRP                                         2638
         ST    @15,RPLVBUF(,@02)                                   2638
*   RPLVBLN=LENGTH(STORGRP);        /* LENGTH BUFFER         @Y30LB26*/
         MVC   RPLVBLN(4,@02),@CF01147                             2639
*   RPLVLOC=OFF;                    /* NO LOCATE             @Y30LB26*/
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB26*/
         OI    RPLVDIR(@02),B'01000000'                            2641
         NI    RPLVLOC(@02),B'01111111'                            2641
*   RPLVTYP=RPLVREAD;               /* READ                  @Y30LB26*/
         MVI   RPLVTYP(@02),X'00'                                  2642
*   RESPECIFY                                                      2643
*     REG1 RSTD;                    /* RESTRICT              @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR RPLV             @Y30LB26*/
         LR    REG1,@02                                            2644
*   CALL ICBVIO00;                  /* READ GROUP RECORD     @Y30LB26*/
         L     @15,@CV00671                                        2645
         BALR  @14,@15                                             2645
*   RESPECIFY                                                      2646
*     REG1 UNRSTD;                  /* FREE                  @Y30LB26*/
*   IF RPLVRETC^=RCZERO THEN        /* CK RETURN             @Y30LB26*/
         L     @02,RPLVPTR                                         2647
         CLC   RPLVRETC(2,@02),@CB00747                            2647
         BE    @RF02647                                            2647
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* FREE INVENTORY        @Y30LB26*/
         BAL   @14,ERREXIT                                         2649
*       RETURN;                     /*                       @Y30LB26*/
@EL00041 DS    0H                                                  2650
@EF00041 DS    0H                                                  2650
@ER00041 L     @14,@SA00041                                        2650
         BR    @14                                                 2650
*     END;                          /*                       @Y30LB26*/
*   GROUPPTR=ADDR(STORGRP);         /* ADDR TO RECORD        @Y30LB26*/
*                                                                  2652
@RF02647 LA    @02,STORGRP                                         2652
         ST    @02,GROUPPTR                                        2652
*   /*****************************************************************/
*   /*                                                               */
*   /* IF RESTRICTED USE, ADD ONE TO COUNT IN GROUP          @Y30LB26*/
*   /* RECORD AND INDICATE RESTRICTED IN BASE RECORD         @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2653
*   IF MVRRSTD=ON THEN              /* RESTRICTED USE ?      @Y30LB26*/
         L     @01,MVRPTR                                          2653
         TM    MVRRSTD(@01),B'01000000'                            2653
         BNO   @RF02653                                            2653
*     DO;                           /*                       @Y30LB26*/
*       GRONRSTD=GRONRSTD+ONE;      /* ADD ONE RESTRICTED    @Y30LB26*/
         LA    @15,1                                               2655
         AH    @15,GRONRSTD(,@02)                                  2655
         STH   @15,GRONRSTD(,@02)                                  2655
*       BASRSTD=ON;                 /* INDICATE RESTRICTED   @Y30LB26*/
         L     @02,BASEVPTR                                        2656
         OI    BASRSTD(@02),B'00001000'                            2656
*     END;                          /*                       @Y30LB26*/
*                                                                  2657
*   /*****************************************************************/
*   /*                                                               */
*   /* INDICATE GROUPED AND PUT GROUP NAME IN VOLUME         @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2658
*   BASGRPV=ON;                     /* INDICATE GROUPED      @Y30LB26*/
@RF02653 L     @02,BASEVPTR                                        2658
         OI    BASGRPV(@02),B'00100000'                            2658
*   BASGROUP=MVRGROUP;              /* GROUP NAME IN BASE    @Y30LB26*/
*                                                                  2659
         L     @15,MVRPTR                                          2659
         MVC   BASGROUP(8,@02),MVRGROUP(@15)                       2659
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK IF VOLUME IS GOING TO BE GENERAL USE            #Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2660
*   IF MVRGEN=ON THEN               /* GENERAL USE?          #Y30LB26*/
         TM    MVRGEN(@15),B'10000000'                             2660
         BNO   @RF02660                                            2660
*     DO;                           /*                       @Y30LB26*/
*                                                                  2661
*       /*************************************************************/
*       /*                                                           */
*       /* ADD ONE TO NUMBER OF GENERAL USE IN GROUP.        @ZM31004*/
*       /* INDICATE GENERAL USE IN BASE RECORD               @ZM31004*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  2662
*       GRONGEN=GRONGEN+ONE;        /* ADD ON TO GENERAL     @ZM31004*/
         L     @15,GROUPPTR                                        2662
         LA    @14,1                                               2662
         AH    @14,GRONGEN(,@15)                                   2662
         STH   @14,GRONGEN(,@15)                                   2662
*       BASGENUS=ON;                /* INDICATE GENERAL      @ZM31004*/
*                                                                  2663
         OI    BASGENUS(@02),B'00010000'                           2663
*       /*************************************************************/
*       /*                                                           */
*       /* SET FLAG INDICATING ADDING TO GROUP AND GO        @ZM31004*/
*       /* PUT NEW SPACE VALUES IN GROUP RECORD              @ZM31004*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  2664
*       ADDGRP=ON;                  /* INDIC ADDING TO GRP   @ZM31004*/
         OI    ADDGRP,B'00001000'                                  2664
*       CALL ICBVUPGH(GROUPPTR,BASEVPTR,PASSFLAG);/*         @ZM31004*/
*                                                                  2665
         L     @15,@CV00676                                        2665
         LA    @01,@AL02665                                        2665
         BALR  @14,@15                                             2665
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK RETURN FROM PROCESS GROUP HEADER            @ZM31004*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  2666
*       IF RPLVRETC^=RCZERO THEN    /* CK RETURN             @ZM31004*/
         L     @02,RPLVPTR                                         2666
         CLC   RPLVRETC(2,@02),@CB00747                            2666
         BE    @RF02666                                            2666
*         DO;                       /*                       @ZM31004*/
*           CALL ERREXIT;           /* FREE INVENTORY        @ZM31004*/
         BAL   @14,ERREXIT                                         2668
*           RETURN;                 /*                       @ZM31004*/
         B     @EL00041                                            2669
*         END;                      /*                       @ZM31004*/
*                                                                  2670
*       /*************************************************************/
*       /*                                                           */
*       /* GO PUT A SLOT IN EXTENSION RECORD FOR THIS        @ZM31004*/
*       /* GROUPED GENERAL USE BASE VOLUME                   @ZM31004*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  2671
*       SLOTEXP=OFF;                /* NO EXPIRATION CHANGE  #Y30LB26*/
@RF02666 NI    SLOTEXP,B'01111111'                                 2671
*       ADDSLEXT=ON;                /* INDICATE ADDING SLOT  #Y30LB26*/
         OI    ADDSLEXT,B'00000010'                                2672
*       CALL VUEXT;                 /* PUT SLOT IN EXTEN     @Y30LB26*/
         BAL   @14,VUEXT                                           2673
*       IF RPLVRETC^=RCZERO THEN    /*                       @Y30LB26*/
         L     @02,RPLVPTR                                         2674
         CLC   RPLVRETC(2,@02),@CB00747                            2674
         BE    @RF02674                                            2674
*         DO;                       /*                       @Y30LB26*/
*           CALL ERREXIT;           /*                       @Y30LB26*/
         BAL   @14,ERREXIT                                         2676
*           RETURN;                 /*                       @Y30LB26*/
         B     @EL00041                                            2677
*         END;                      /*                       @Y30LB26*/
*     END;                          /*                       @Y30LB26*/
*                                                                  2679
@RF02674 DS    0H                                                  2680
*   /*****************************************************************/
*   /*                                                               */
*   /* CALL CHAIN IN ROUTINE TO CHAIN BASE RECORD INTO GROUP @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2680
*   CHICHOGP=ON;                    /* INDICATE GROUPED      @Y30LB26*/
@RF02660 OI    CHICHOGP,B'00010000'                                2680
*   CALL ICBVUCHI(GROUPPTR,BASEVPTR,RPLVPTR,PASSFLAG);/*     @Y30LB26*/
*                                                                  2681
         L     @15,@CV00674                                        2681
         LA    @01,@AL02681                                        2681
         BALR  @14,@15                                             2681
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK RETURN                                          @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2682
*   IF RPLVRETC^=RCZERO THEN        /* CK RETURN             @Y30LB26*/
         L     @02,RPLVPTR                                         2682
         CLC   RPLVRETC(2,@02),@CB00747                            2682
         BE    @RF02682                                            2682
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         2684
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00041                                            2685
*     END;                          /*                       @Y30LB26*/
*                                                                  2686
*   /*****************************************************************/
*   /*                                                               */
*   /* READ GROUP RECORD FOR UPDATE SO IT CAN BE WRITTEN     #Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2687
*   RPLVKEY=ADDR(GKEY);             /* ADDR KEY              @Y30LB26*/
@RF02682 L     @02,RPLVPTR                                         2687
         LA    @15,GKEY                                            2687
         ST    @15,RPLVKEY(,@02)                                   2687
*   RPLVBUF=ADDR(DUMMYREC);         /* DUMMY BUFFER          @Y30LB26*/
         LA    @15,DUMMYREC                                        2688
         ST    @15,RPLVBUF(,@02)                                   2688
*   RPLVBLN=LENGTH(STORGRP);        /* LENGTH BUFFER         @Y30LB26*/
         MVC   RPLVBLN(4,@02),@CF01147                             2689
*   RPLVLOC=OFF;                    /* NO LOCATE             @Y30LB26*/
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB26*/
         OI    RPLVDIR(@02),B'01000000'                            2691
         NI    RPLVLOC(@02),B'01111111'                            2691
*   RPLVTYP=RPLVREAD;               /* READ REC              @Y30LB26*/
         MVI   RPLVTYP(@02),X'00'                                  2692
*   RPLVKGE=OFF;                    /* NOT FOR > OR =        @Y30LB26*/
         NI    RPLVKGE(@02),B'11111011'                            2693
*   RPLVUPD=ON;                     /* FOR UPDATE            @Y30LB26*/
         OI    RPLVUPD(@02),B'00000010'                            2694
*   RESPECIFY                                                      2695
*     REG1 RSTD;                    /* RESTRICT              @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR RPLV             @Y30LB26*/
         LR    REG1,@02                                            2696
*   CALL ICBVIO00;                  /* READ GROUP UPDATE     @Y30LB26*/
*                                                                  2697
         L     @15,@CV00671                                        2697
         BALR  @14,@15                                             2697
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK RETURN FROM DUMMY READ                          @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2698
*   IF RPLVRETC^=RCZERO THEN        /* CK RETURN CODE        @Y30LB26*/
         L     @02,RPLVPTR                                         2698
         CLC   RPLVRETC(2,@02),@CB00747                            2698
         BE    @RF02698                                            2698
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* SAVE RETURN CODES     @Y30LB26*/
         BAL   @14,ERREXIT                                         2700
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00041                                            2701
*     END;                          /*                       @Y30LB26*/
*                                                                  2702
*   /*****************************************************************/
*   /*                                                               */
*   /* WRITE GROUP RECORD THAT IS ALL FIXED UP NOW           @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2703
*   RPLVBUF=ADDR(STORGRP);          /* ADDR READ GROUP REC   @Y30LB26*/
@RF02698 L     @02,RPLVPTR                                         2703
         LA    @00,STORGRP                                         2703
         ST    @00,RPLVBUF(,@02)                                   2703
*   RPLVTYP=RPLVPUT;                /* WRITE IT              @Y30LB26*/
         MVI   RPLVTYP(@02),X'01'                                  2704
*   REG1=RPLVPTR;                   /* ADDR RPLV             @Y30LB26*/
         LR    REG1,@02                                            2705
*   CALL ICBVIO00;                  /* WRITE GROUP REC       @Y30LB26*/
         L     @15,@CV00671                                        2706
         BALR  @14,@15                                             2706
*   RESPECIFY                                                      2707
*     REG1 UNRSTD;                  /* FREE REG 1            @Y30LB26*/
*   IF RPLVRETC^=RCZERO THEN        /* CK RETURN             @Y30LB26*/
         L     @02,RPLVPTR                                         2708
         CLC   RPLVRETC(2,@02),@CB00747                            2708
         BE    @RF02708                                            2708
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* SAVE RETURN CODES     @Y30LB26*/
         BAL   @14,ERREXIT                                         2710
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00041                                            2711
*     END;                          /*                       @Y30LB26*/
*                                                                  2712
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK TO SEE IF RPLV HAS ALREADY BEEN JOURNALED.      @Y30LB26*/
*   /* IF IT HAS NOT, THEN GO JOURNAL IT                     @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2713
*   IF JRNLEDSW=OFF THEN            /* JOURNALED BEFORE      @Y30LB26*/
@RF02708 TM    JRNLEDSW,B'00000001'                                2713
         BNZ   @RF02713                                            2713
*     CALL JOURNAL;                 /* JOURNAL IT            @Y30LB26*/
         BAL   @14,JOURNAL                                         2714
*   RETURN;                         /*                       @Y30LB26*/
         B     @EL00041                                            2715
*   END GROUPIN;                    /*                       @Y30LB26*/
         B     @EL00041                                            2716
*                                                                  2717
*   /*****************************************************************/
*   /*                                                               */
*   /* THIS ROUTINE TAKES A BASE VOLUME RECORD OUT OF        @Y30LB26*/
*   /* THE NON-GROUPED CHAIN                                 @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2717
*NGRPOUT:                                                          2717
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
NGRPOUT  ST    @14,@SA00042                                        2717
*   CHICHOGP=OFF;                   /* INDICATE NON-GRPED    @Y30LB26*/
*                                                                  2718
         NI    CHICHOGP,B'11101111'                                2718
*   /*****************************************************************/
*   /*                                                               */
*   /* GO CHAIN VOLUME OUT OF NON-GROUPED CHAIN              @Y30LB26*/
*   /* AND CHECK RETURN CODE                                 @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2719
*   CALL ICBVUCHO(0,BASEVPTR,RPLVPTR,PASSFLAG);/* CHN OUT    @Y30LB26*/
         L     @15,@CV00675                                        2719
         LA    @01,@AL02719                                        2719
         BALR  @14,@15                                             2719
*   IF RPLVRETC^=RCZERO THEN        /* RETURN CODE           @Y30LB26*/
         L     @02,RPLVPTR                                         2720
         CLC   RPLVRETC(2,@02),@CB00747                            2720
         BE    @RF02720                                            2720
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* SAVE RETURN CODE      @Y30LB26*/
         BAL   @14,ERREXIT                                         2722
*       RETURN;                     /*                       @Y30LB26*/
@EL00042 DS    0H                                                  2723
@EF00042 DS    0H                                                  2723
@ER00042 L     @14,@SA00042                                        2723
         BR    @14                                                 2723
*     END;                          /*                       @Y30LB26*/
*   RETURN;                         /*                       @Y30LB26*/
         B     @EL00042                                            2725
*   END NGRPOUT;                    /*                       @Y30LB26*/
         B     @EL00042                                            2726
*                                                                  2727
*   /*****************************************************************/
*   /*                                                               */
*   /* THIS ROUTINE PUTS A BASE VOLUME RECORD INTO           @Y30LB26*/
*   /* THE NON-GROUPED CHAIN                                 @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2727
*NGROUPIN:                                                         2727
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
NGROUPIN ST    @14,@SA00043                                        2727
*   CHICHOGP=OFF;                   /* INDICATE NON-GRPED    @Y30LB26*/
*                                                                  2728
         NI    CHICHOGP,B'11101111'                                2728
*   /*****************************************************************/
*   /*                                                               */
*   /* GO CHAIN VOLUME INTO NON-GROUPED                      @Y30LB26*/
*   /* AND CHECK RETURN CODE                                 @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2729
*   CALL ICBVUCHI(0,BASEVPTR,RPLVPTR,PASSFLAG);/*            @Y30LB26*/
         L     @15,@CV00674                                        2729
         LA    @01,@AL02729                                        2729
         BALR  @14,@15                                             2729
*   IF RPLVRETC^=RCZERO THEN        /*                       @Y30LB26*/
         L     @02,RPLVPTR                                         2730
         CLC   RPLVRETC(2,@02),@CB00747                            2730
         BE    @RF02730                                            2730
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /*                       @Y30LB26*/
         BAL   @14,ERREXIT                                         2732
*       RETURN;                     /*                       @Y30LB26*/
@EL00043 DS    0H                                                  2733
@EF00043 DS    0H                                                  2733
@ER00043 L     @14,@SA00043                                        2733
         BR    @14                                                 2733
*     END;                          /*                       @Y30LB26*/
*                                                                  2734
*   /*****************************************************************/
*   /*                                                               */
*   /* UPDATE FIELDS IN THE BASE VOLUME RECORD THAT          @Y30LB26*/
*   /* NEED TO BE UPDATED WHEN GOING NON-GROUPED CATAGORY    @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2735
*   BASGRPV=OFF;                    /* CLEAR GROUP FLAG      @Y30LB26*/
@RF02730 DS    0H                                                  2736
*   BASGENUS=OFF;                   /* CLEAR GENERAL USED    @Y30LB26*/
*   BASRSTD=OFF;                    /* CLEAR RESTRICTED      @Y30LB26*/
         L     @02,BASEVPTR                                        2737
         NI    BASGRPV(@02),B'11000111'                            2737
*   BASEXPDT=NULEXPDT;              /* CLEAR EXPIRATION      @Y30LB26*/
         MVC   BASEXPDT(4,@02),NULEXPDT                            2738
*   BASGROUP=BLANK;                 /* BLANK GROUP NAME      @Y30LB26*/
         MVI   BASGROUP+1(@02),C' '                                2739
         MVC   BASGROUP+2(6,@02),BASGROUP+1(@02)                   2739
         MVI   BASGROUP(@02),C' '                                  2739
*   RETURN;                         /*                       @Y30LB26*/
         B     @EL00043                                            2740
*   END NGROUPIN;                   /*                       @Y30LB26*/
*                                                                  2742
*   /*****************************************************************/
*   /*                                                               */
*   /* THIS ROUTINE IS CALLED WHEN A GROUPED VOLUME IS       @Y30LB26*/
*   /* CURRENTLY GENERAL USE, BUT IS GOING RESTRICTED        @Y30LB26*/
*   /* IN THE SAME GROUP                                     @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2742
*RESTRICT:                          /*                       @Y30LB26*/
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
*                                                                  2742
RESTRICT ST    @14,@SA00044                                        2742
*   /*****************************************************************/
*   /*                                                               */
*   /* GET GROUP NAME AND SET UP TO READ GROUP RECORD        @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2743
*   GROUPKY=BASGROUP;               /* GROUP NAME            @Y30LB26*/
         L     @02,BASEVPTR                                        2743
         MVC   GROUPKY(8),BASGROUP(@02)                            2743
*   RPLVKEY=ADDR(GKEY);             /* ADDR KEY              @Y30LB26*/
         L     @02,RPLVPTR                                         2744
         LA    @15,GKEY                                            2744
         ST    @15,RPLVKEY(,@02)                                   2744
*   RPLVBUF=ADDR(STORGRP);          /* ADDR BUFFER           @Y30LB26*/
         LA    @15,STORGRP                                         2745
         ST    @15,RPLVBUF(,@02)                                   2745
*   RPLVBLN=LENGTH(STORGRP);        /* LENGTH OF BUFFER      @Y30LB26*/
         MVC   RPLVBLN(4,@02),@CF01147                             2746
*   RPLVLOC=OFF;                    /* NO LOCATE MODE        @Y30LB26*/
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB26*/
         OI    RPLVDIR(@02),B'01000000'                            2748
         NI    RPLVLOC(@02),B'01111111'                            2748
*   RPLVTYP=RPLVREAD;               /* READ                  @Y30LB26*/
         MVI   RPLVTYP(@02),X'00'                                  2749
*   RPLVUPD=ON;                     /* FOR UPDATE            @Y30LB26*/
         OI    RPLVUPD(@02),B'00000010'                            2750
*   RESPECIFY                                                      2751
*     REG1 RSTD;                    /* RESTRICT REG 1        @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR OF RPLV          @Y30LB26*/
         LR    REG1,@02                                            2752
*   CALL ICBVIO00;                  /* READ GROUP RECORD     @Y30LB26*/
         L     @15,@CV00671                                        2753
         BALR  @14,@15                                             2753
*   RESPECIFY                                                      2754
*     REG1 UNRSTD;                  /* UNRESTRICT REG1       @Y30LB26*/
*   IF RPLVRETC^=RCZERO THEN        /* CHECK RETURN?         @Y30LB26*/
         L     @02,RPLVPTR                                         2755
         CLC   RPLVRETC(2,@02),@CB00747                            2755
         BE    @RF02755                                            2755
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* FREE INVENTORY        @Y30LB26*/
         BAL   @14,ERREXIT                                         2757
*       RETURN;                     /*                       @Y30LB26*/
@EL00044 DS    0H                                                  2758
@EF00044 DS    0H                                                  2758
@ER00044 L     @14,@SA00044                                        2758
         BR    @14                                                 2758
*     END;                          /*                       @Y30LB26*/
*                                                                  2759
*   /*****************************************************************/
*   /*                                                               */
*   /* UPDATE FIELDS IN THE GROUP RECORD THAT CHANGE         @Y30LB26*/
*   /* WHEN ONE OF ITS VOLUMES GOES FROM GENERAL TO          @Y30LB26*/
*   /* RESTRICTED                                            @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2760
*   GROUPPTR=ADDR(STORGRP);         /* ADDR TO GROUP REC     @Y30LB26*/
@RF02755 LA    @02,STORGRP                                         2760
         ST    @02,GROUPPTR                                        2760
*   GRONGEN=GRONGEN-ONE;            /* 1 LESS GENERAL USE    @Y30LB26*/
         LH    @15,GRONGEN(,@02)                                   2761
         BCTR  @15,0                                               2761
         STH   @15,GRONGEN(,@02)                                   2761
*   GRONRSTD=GRONRSTD+ONE;          /* ONE MORE RESTRICTED   @Y30LB26*/
         LA    @15,1                                               2762
         AH    @15,GRONRSTD(,@02)                                  2762
         STH   @15,GRONRSTD(,@02)                                  2762
*   ADDGRP=OFF;                     /* INDICATE TAKING OUT   @Y30LB26*/
*                                                                  2763
         NI    ADDGRP,B'11110111'                                  2763
*   /*****************************************************************/
*   /*                                                               */
*   /* GO TAKE SOME SPACE OUT OF GROUPS GENERAL VOLUME       @Y30LB26*/
*   /* TOTALS SINCE IT IS GOING RESTRICTED                   @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2764
*   CALL ICBVUPGH(GROUPPTR,BASEVPTR,PASSFLAG);/*             @Y30LB26*/
         L     @15,@CV00676                                        2764
         LA    @01,@AL02764                                        2764
         BALR  @14,@15                                             2764
*   IF RPLVRETC^=RCZERO THEN        /* CHECK RETURN          @Y30LB26*/
         L     @02,RPLVPTR                                         2765
         CLC   RPLVRETC(2,@02),@CB00747                            2765
         BE    @RF02765                                            2765
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* FREE INVENTORY        @Y30LB26*/
         BAL   @14,ERREXIT                                         2767
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00044                                            2768
*     END;                          /*                       @Y30LB26*/
*                                                                  2769
*   /*****************************************************************/
*   /*                                                               */
*   /* UPDATE FIELDS IN THE BASE VOLUME RECORD THAT          @Y30LB26*/
*   /* CHANGE WHEN GOING FRON GENERAL TO RESTRICTED          @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2770
*   BASGENUS=OFF;                   /* NOT GENERAL USE       @Y30LB26*/
@RF02765 DS    0H                                                  2771
*   BASRSTD=ON;                     /* RESTRICTED USE        @Y30LB26*/
         L     @02,BASEVPTR                                        2771
         OI    BASRSTD(@02),B'00001000'                            2771
         NI    BASGENUS(@02),B'11101111'                           2771
*   BASEXPDT=NULEXPDT;              /* CLEAR EXPIRATION      @Y30LB26*/
*                                                                  2772
         MVC   BASEXPDT(4,@02),NULEXPDT                            2772
*   /*****************************************************************/
*   /*                                                               */
*   /* WRITE THE GROUP RECORD JUST PREVIOUSLY READ           @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2773
*   RPLVTYP=RPLVPUT;                /* PUT GROUP REC         @Y30LB26*/
         L     @02,RPLVPTR                                         2773
         MVI   RPLVTYP(@02),X'01'                                  2773
*   RESPECIFY                                                      2774
*     REG1 RSTD;                    /* RESTRICT REG 1        @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR OF RPLV          @Y30LB26*/
         LR    REG1,@02                                            2775
*   CALL ICBVIO00;                  /* READ GROUP RECORD     @Y30LB26*/
         L     @15,@CV00671                                        2776
         BALR  @14,@15                                             2776
*   RESPECIFY                                                      2777
*     REG1 UNRSTD;                  /* UNRESTRICT REG1       @Y30LB26*/
*   IF RPLVRETC^=RCZERO THEN        /* CHECK RETURN?         @Y30LB26*/
         L     @02,RPLVPTR                                         2778
         CLC   RPLVRETC(2,@02),@CB00747                            2778
         BE    @RF02778                                            2778
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* FREE INVENTORY        @Y30LB26*/
         BAL   @14,ERREXIT                                         2780
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00044                                            2781
*     END;                          /*                       @Y30LB26*/
*                                                                  2782
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THE RPLV HAS NEVER BEEN JOURNALED BEFORE, DO IT    @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2783
*   IF JRNLEDSW=OFF THEN            /* JOURNALED?            @Y30LB26*/
@RF02778 TM    JRNLEDSW,B'00000001'                                2783
         BNZ   @RF02783                                            2783
*     CALL JOURNAL;                 /* JOURNAL IT            @Y30LB26*/
*                                                                  2784
         BAL   @14,JOURNAL                                         2784
*   /*****************************************************************/
*   /*                                                               */
*   /* REMOVE SLOT FROM THE GROUP EXTENSION RECORD           @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2785
*   ADDSLEXT=OFF;                   /* INDICATE REMOVING     @Y30LB26*/
@RF02783 NI    ADDSLEXT,B'11111101'                                2785
*   SLOTEXP=OFF;                    /* NOT EXPIR CALL        @Y30LB26*/
         NI    SLOTEXP,B'01111111'                                 2786
*   CALL VUEXT;                     /* GO REMOVE SLOT        @Y30LB26*/
*                                                                  2787
         BAL   @14,VUEXT                                           2787
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK RETURN CODE                                     @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2788
*   IF RPLVRETC^=RCZERO THEN        /* CHECK RETURN?         @Y30LB26*/
         L     @02,RPLVPTR                                         2788
         CLC   RPLVRETC(2,@02),@CB00747                            2788
         BE    @RF02788                                            2788
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* FREE INVENTORY        @Y30LB26*/
         BAL   @14,ERREXIT                                         2790
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00044                                            2791
*     END;                          /*                       @Y30LB26*/
*   RETURN;                         /*                       @Y30LB26*/
         B     @EL00044                                            2793
*   END RESTRICT;                   /*                       @Y30LB26*/
         B     @EL00044                                            2794
*                                                                  2795
*   /*****************************************************************/
*   /*                                                               */
*   /* THIS ROUTINE IS CALLED WHEN A BASE VOLUME RECORD      @Y30LB26*/
*   /* IS GOING FROM RESTRICTED TO GENERAL USE IN THE        @Y30LB26*/
*   /* SAME GROUP                                            @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2795
*GENERAL:                           /*                       @Y30LB26*/
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
*                                                                  2795
GENERAL  ST    @14,@SA00045                                        2795
*   /*****************************************************************/
*   /*                                                               */
*   /* GET GROUP NAME FROM BASE RECORD AND SET UP TO         @Y30LB26*/
*   /* READ THE GROUP RECORD                                 @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2796
*   GROUPKY=BASGROUP;               /* GET NEW GROUP NAME    @Y30LB26*/
         L     @02,BASEVPTR                                        2796
         MVC   GROUPKY(8),BASGROUP(@02)                            2796
*   RPLVKEY=ADDR(GKEY);             /* ADDR GROUP KEY        @Y30LB26*/
         L     @02,RPLVPTR                                         2797
         LA    @15,GKEY                                            2797
         ST    @15,RPLVKEY(,@02)                                   2797
*   RPLVBUF=ADDR(STORGRP);          /* BUFFER ADDRESS        @Y30LB26*/
         LA    @15,STORGRP                                         2798
         ST    @15,RPLVBUF(,@02)                                   2798
*   RPLVBLN=LENGTH(STORGRP);        /* LENGTH OF BUFFER      @Y30LB26*/
         MVC   RPLVBLN(4,@02),@CF01147                             2799
*   RPLVLOC=OFF;                    /* NO LOCATE MODE        @Y30LB26*/
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB26*/
         OI    RPLVDIR(@02),B'01000000'                            2801
         NI    RPLVLOC(@02),B'01111111'                            2801
*   RPLVTYP=RPLVREAD;               /* READ                  @Y30LB26*/
         MVI   RPLVTYP(@02),X'00'                                  2802
*   RPLVUPD=ON;                     /* FOR UPDATE            @Y30LB26*/
         OI    RPLVUPD(@02),B'00000010'                            2803
*   RESPECIFY                                                      2804
*     REG1 RSTD;                    /* RESTRICT REG 1        @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR OF RPLV          @Y30LB26*/
         LR    REG1,@02                                            2805
*   CALL ICBVIO00;                  /* READ GROUP RECORD     @Y30LB26*/
         L     @15,@CV00671                                        2806
         BALR  @14,@15                                             2806
*   RESPECIFY                                                      2807
*     REG1 UNRSTD;                  /* UNRESTRICT REG1       @Y30LB26*/
*   IF RPLVRETC^=RCZERO THEN        /* CHECK RETURN?         @Y30LB26*/
         L     @02,RPLVPTR                                         2808
         CLC   RPLVRETC(2,@02),@CB00747                            2808
         BE    @RF02808                                            2808
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* FREE INVENTORY        @Y30LB26*/
         BAL   @14,ERREXIT                                         2810
*       RETURN;                     /*                       @Y30LB26*/
@EL00045 DS    0H                                                  2811
@EF00045 DS    0H                                                  2811
@ER00045 L     @14,@SA00045                                        2811
         BR    @14                                                 2811
*     END;                          /*                       @Y30LB26*/
*                                                                  2812
*   /*****************************************************************/
*   /*                                                               */
*   /* GET ADDRESS OF GROUP RECORD, UPDATE REQUIRED FIELDS   @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2813
*   GROUPPTR=ADDR(STORGRP);         /* ADDRESSING TO GRP REC @Y30LB26*/
*                                                                  2813
@RF02808 LA    @02,STORGRP                                         2813
         ST    @02,GROUPPTR                                        2813
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK MOUNTING ATTRIBUTES                             @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2814
*   IF BASBIND=OFF&GROBIND=OFF     /* BINDS MATCH?          @Y30LB26*/
*       BASBIND=ON&GROBIND=ON THEN  /* BINDS MATCH?          @Y30LB26*/
         L     @01,BASEVPTR                                        2814
         TM    BASBIND(@01),B'00000010'                            2814
         BNZ   @GL00060                                            2814
         TM    GROBIND(@02),B'10000000'                            2814
         BZ    @RT02814                                            2814
@GL00060 L     @02,BASEVPTR                                        2814
         TM    BASBIND(@02),B'00000010'                            2814
         BNO   @RF02814                                            2814
         L     @02,GROUPPTR                                        2814
         TM    GROBIND(@02),B'10000000'                            2814
         BNO   @RF02814                                            2814
@RT02814 DS    0H                                                  2815
*     DO;                           /*                       @Y30LB26*/
*       IF BASEXCL=OFF&GROEXCL=OFF /* EXCL MATC             @Y30LB26*/
*           BASEXCL=ON&GROEXCL=ON THEN/* EXCL MAT            @Y30LB26*/
         L     @02,BASEVPTR                                        2816
         TM    BASEXCL(@02),B'00000001'                            2816
         BNZ   @GL00063                                            2816
         L     @02,GROUPPTR                                        2816
         TM    GROEXCL(@02),B'01000000'                            2816
         BZ    @RT02816                                            2816
@GL00063 L     @02,BASEVPTR                                        2816
         TM    BASEXCL(@02),B'00000001'                            2816
         BNO   @RF02816                                            2816
         L     @02,GROUPPTR                                        2816
         TM    GROEXCL(@02),B'01000000'                            2816
         BNO   @RF02816                                            2816
@RT02816 DS    0H                                                  2817
*         DO;                       /*                       @Y30LB26*/
*           IF BASDAERA=OFF&GRODAERA=OFF/* ERA              @Y30LB26*/
*               BASDAERA=ON&GRODAERA=ON THEN/* ERA           @Y30LB26*/
         L     @02,BASEVPTR                                        2818
         TM    BASDAERA(@02),B'10000000'                           2818
         BNZ   @GL00066                                            2818
         L     @02,GROUPPTR                                        2818
         TM    GRODAERA(@02),B'00100000'                           2818
         BZ    @RT02818                                            2818
@GL00066 L     @02,BASEVPTR                                        2818
         TM    BASDAERA(@02),B'10000000'                           2818
         BNO   @RF02818                                            2818
         L     @02,GROUPPTR                                        2818
         TM    GRODAERA(@02),B'00100000'                           2818
         BNO   @RF02818                                            2818
@RT02818 DS    0H                                                  2819
*             DO;                   /*                       @Y30LB26*/
*               IF BASRONLY=OFF&GRORONLY=OFF/*              @Y30LB26*/
*                   BASRONLY=ON&GRORONLY=ON/*                @Y30LB26*/
*                 THEN                                             2820
         L     @02,BASEVPTR                                        2820
         TM    BASRONLY(@02),B'01000000'                           2820
         BNZ   @GL00069                                            2820
         L     @02,GROUPPTR                                        2820
         TM    GRORONLY(@02),B'00010000'                           2820
         BZ    @RT02820                                            2820
@GL00069 L     @02,BASEVPTR                                        2820
         TM    BASRONLY(@02),B'01000000'                           2820
         BNO   @RF02820                                            2820
         L     @02,GROUPPTR                                        2820
         TM    GRORONLY(@02),B'00010000'                           2820
         BNO   @RF02820                                            2820
@RT02820 DS    0H                                                  2821
*                 I=I;              /* DUMMY INST            @Y30LB26*/
         SLR   @02,@02                                             2821
         IC    @02,I                                               2821
         STC   @02,I                                               2821
*               ELSE                /*                       @Y30LB26*/
*                 DO;               /*                       @Y30LB26*/
         B     @RC02820                                            2822
@RF02820 DS    0H                                                  2823
*                   RPLVRETC=FOUR;  /* BAD RC                @Y30LB26*/
         L     @02,RPLVPTR                                         2823
         MVC   RPLVRETC(2,@02),@CB00749                            2823
*                   RPLRCODE=INCOMSS1;/* INCOM               @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00827                            2824
*                   CALL ERREXIT;   /* SAVE STUFF            @Y30LB26*/
         BAL   @14,ERREXIT                                         2825
*                   RETURN;         /*                       @Y30LB26*/
         B     @EL00045                                            2826
*                 END;              /*                       @Y30LB26*/
*             END;                  /*                       @Y30LB26*/
*           ELSE                    /*                       @Y30LB26*/
*             DO;                   /*                       @Y30LB26*/
         B     @RC02818                                            2829
@RF02818 DS    0H                                                  2830
*               RPLVRETC=FOUR;      /* BAD RC                @Y30LB26*/
         L     @02,RPLVPTR                                         2830
         MVC   RPLVRETC(2,@02),@CB00749                            2830
*               RPLRCODE=INCOMSS1;  /* INCOM SS              @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00827                            2831
*               CALL ERREXIT;       /* SAVE                  @Y30LB26*/
         BAL   @14,ERREXIT                                         2832
*               RETURN;             /*                       @Y30LB26*/
         B     @EL00045                                            2833
*             END;                  /*                       @Y30LB26*/
*         END;                      /*                       @Y30LB26*/
*       ELSE                        /*                       @Y30LB26*/
*         DO;                       /*                       @Y30LB26*/
         B     @RC02816                                            2836
@RF02816 DS    0H                                                  2837
*           RPLVRETC=FOUR;          /* BAD RC                @Y30LB26*/
         L     @02,RPLVPTR                                         2837
         MVC   RPLVRETC(2,@02),@CB00749                            2837
*           RPLRCODE=INCOMSS1;      /* INCOM                 @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00827                            2838
*           CALL ERREXIT;           /* SAVE RET              @Y30LB26*/
         BAL   @14,ERREXIT                                         2839
*           RETURN;                 /*                       @Y30LB26*/
         B     @EL00045                                            2840
*         END;                      /*                       @Y30LB26*/
*     END;                          /*                       @Y30LB26*/
*   ELSE                            /*                       @Y30LB26*/
*                                                                  2843
*     /***************************************************************/
*     /*                                                             */
*     /* IF ATTRIBUTES DONT MATCH, EXIT ERROR                @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  2843
*     DO;                           /*                       @Y30LB26*/
         B     @RC02814                                            2843
@RF02814 DS    0H                                                  2844
*       RPLVRETC=FOUR;              /* SET BAD RC            @Y30LB26*/
         L     @02,RPLVPTR                                         2844
         MVC   RPLVRETC(2,@02),@CB00749                            2844
*       RPLRCODE=INCOMSS1;          /* INCOMPAT SS1 ATT      @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00827                            2845
*       CALL ERREXIT;               /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         2846
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00045                                            2847
*     END;                          /*                       @Y30LB26*/
*   GRONGEN=GRONGEN+ONE;            /* ONE MORE GENERAL USE  #Y30LB26*/
@RC02814 L     @02,GROUPPTR                                        2849
         LA    @15,1                                               2849
         AH    @15,GRONGEN(,@02)                                   2849
         STH   @15,GRONGEN(,@02)                                   2849
*   GRONRSTD=GRONRSTD-ONE;          /* ONE LESS RESTRICTED   #Y30LB26*/
*                                                                  2850
         LH    @15,GRONRSTD(,@02)                                  2850
         BCTR  @15,0                                               2850
         STH   @15,GRONRSTD(,@02)                                  2850
*   /*****************************************************************/
*   /*                                                               */
*   /* GO ADD SOME SPACE TO THE GROUP FIELDS SINCE IT IS     #Y30LB26*/
*   /* GETTING A GENERAL TYPE VOLUME                         #Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2851
*   ADDGRP=ON;                      /* INDICATE ADDING GEN   @Y30LB26*/
         OI    ADDGRP,B'00001000'                                  2851
*   CALL ICBVUPGH(GROUPPTR,BASEVPTR,PASSFLAG);/*             @Y30LB26*/
         L     @15,@CV00676                                        2852
         LA    @01,@AL02852                                        2852
         BALR  @14,@15                                             2852
*   IF RPLVRETC^=RCZERO THEN        /* CHECK RETURN          @Y30LB26*/
         L     @02,RPLVPTR                                         2853
         CLC   RPLVRETC(2,@02),@CB00747                            2853
         BE    @RF02853                                            2853
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* FREE INVENTORY        @Y30LB26*/
         BAL   @14,ERREXIT                                         2855
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00045                                            2856
*     END;                          /*                       @Y30LB26*/
*                                                                  2858
*   /*****************************************************************/
*   /*                                                               */
*   /* CHANGE INDICATORS IN BASE VOLUME TO GENERAL USE       @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2858
*   BASGENUS=ON;                    /* GENERAL USE           @Y30LB26*/
@RF02853 DS    0H                                                  2859
*   BASRSTD=OFF;                    /* NOT RESTRICTED USE    @Y30LB26*/
*                                                                  2859
         L     @02,BASEVPTR                                        2859
         OI    BASGENUS(@02),B'00010000'                           2859
         NI    BASRSTD(@02),B'11110111'                            2859
*   /*****************************************************************/
*   /*                                                               */
*   /* WRITE GROUP RECORD                                    @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2860
*   RPLVTYP=RPLVPUT;                /* PUT GROUP REC         @Y30LB26*/
         L     @02,RPLVPTR                                         2860
         MVI   RPLVTYP(@02),X'01'                                  2860
*   RESPECIFY                                                      2861
*     REG1 RSTD;                    /* RESTRICT REG 1        @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR OF RPLV          @Y30LB26*/
         LR    REG1,@02                                            2862
*   CALL ICBVIO00;                  /* READ GROUP RECORD     @Y30LB26*/
         L     @15,@CV00671                                        2863
         BALR  @14,@15                                             2863
*   RESPECIFY                                                      2864
*     REG1 UNRSTD;                  /* UNRESTRICT REG1       @Y30LB26*/
*   IF RPLVRETC^=RCZERO THEN        /* CHECK RETURN?         @Y30LB26*/
         L     @02,RPLVPTR                                         2865
         CLC   RPLVRETC(2,@02),@CB00747                            2865
         BE    @RF02865                                            2865
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* FREE INVENTORY        @Y30LB26*/
         BAL   @14,ERREXIT                                         2867
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00045                                            2868
*     END;                          /*                       @Y30LB26*/
*                                                                  2869
*   /*****************************************************************/
*   /*                                                               */
*   /* IF RPLV HAS NOT BEEN JOURNALED BEFORE, JOURNAL IT     @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2870
*   IF JRNLEDSW=OFF THEN            /* JOURNALED?            @Y30LB26*/
@RF02865 TM    JRNLEDSW,B'00000001'                                2870
         BNZ   @RF02870                                            2870
*     CALL JOURNAL;                 /* JOURNAL IT            @Y30LB26*/
*                                                                  2871
         BAL   @14,JOURNAL                                         2871
*   /*****************************************************************/
*   /*                                                               */
*   /* ADD SLOT TO THE GROUP EXTENSION RECORD                @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2872
*   ADDSLEXT=ON;                    /* INDICATE ADDING       @Y30LB26*/
@RF02870 OI    ADDSLEXT,B'00000010'                                2872
*   SLOTEXP=OFF;                    /* NOT EXPIR CALL        @Y30LB26*/
         NI    SLOTEXP,B'01111111'                                 2873
*   CALL VUEXT;                     /* GO ADD SLOT           @Y30LB26*/
*                                                                  2874
         BAL   @14,VUEXT                                           2874
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK RETURN CODE                                     @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2875
*   IF RPLVRETC^=RCZERO THEN        /* CHECK RETURN?         @Y30LB26*/
         L     @02,RPLVPTR                                         2875
         CLC   RPLVRETC(2,@02),@CB00747                            2875
         BE    @RF02875                                            2875
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* FREE INVENTORY        @Y30LB26*/
         BAL   @14,ERREXIT                                         2877
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00045                                            2878
*     END;                          /*                       @Y30LB26*/
*   RETURN;                         /*                       #Y30LB26*/
         B     @EL00045                                            2880
*   END GENERAL;                    /*                       @Y30LB26*/
         B     @EL00045                                            2881
*                                                                  2882
*   /*****************************************************************/
*   /*                                                               */
*   /* THIS ROUTINE READS THE GROUP RECORD IF EITHER         @Y30LB26*/
*   /* TO OR FOR EXPIRATION DATES WERE SPECIFIED AND         @Y30LB26*/
*   /* IF THERE IS NO EXPIRATION CHECKING FOR THE GROUP      @Y30LB26*/
*   /* IT RETURNS WITH AN REASON CODE                        @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2882
*EXPCK:                                                            2882
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
*                                                                  2882
EXPCK    ST    @14,@SA00046                                        2882
*   /*****************************************************************/
*   /*                                                               */
*   /* BE SURE THAT TO OR FOR WERE SPECIFIED                 @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2883
*   IF MVRFLFOR=ONMVRFLTO=ON THEN  /* CK TO AND FOR         @Y30LB26*/
         L     @02,MVRPTR                                          2883
         TM    MVRFLFOR(@02),B'10001000'                           2883
         BZ    @RF02883                                            2883
*     DO;                           /*                       @Y30LB26*/
*                                                                  2884
*       /*************************************************************/
*       /*                                                           */
*       /* SEE IF BASE RECORD IS GOING GROUPED GENERAL OR    @Y30LB26*/
*       /* STAYING GROUPED GENERAL USE                       @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  2885
*       IF((MVRFLGRO=ONBASGRPV=ON)&MVRGEN=ON)/* GO GEN GRP ?     2885
*                                                            @Y30LB26*/
*           (BASGENUS=ON&MVRNGRP=OFF&MVRRSTD=OFF) THEN/* STAY GEN  2885
*                                                            @Y30LB26*/
*                                                                  2885
         TM    MVRFLGRO(@02),B'01000000'                           2885
         BO    @GL00073                                            2885
         L     @02,BASEVPTR                                        2885
         TM    BASGRPV(@02),B'00100000'                            2885
         BNO   @GL00072                                            2885
@GL00073 L     @02,MVRPTR                                          2885
         TM    MVRGEN(@02),B'10000000'                             2885
         BO    @RT02885                                            2885
@GL00072 L     @02,BASEVPTR                                        2885
         TM    BASGENUS(@02),B'00010000'                           2885
         BNO   @RF02885                                            2885
         L     @02,MVRPTR                                          2885
         TM    MVRNGRP(@02),B'01100000'                            2885
         BNZ   @RF02885                                            2885
@RT02885 DS    0H                                                  2886
*         /***********************************************************/
*         /*                                                         */
*         /* GET GROUP NAME FROM CORRECT SORCE               @Y30LB26*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  2886
*         DO;                       /*                       @Y30LB26*/
*           IF MVRFLGRO=ON THEN     /* GROUP SPECIFIED ?     @Y30LB26*/
         L     @02,MVRPTR                                          2887
         TM    MVRFLGRO(@02),B'01000000'                           2887
         BNO   @RF02887                                            2887
*             GROUPKY=MVRGROUP;     /* GROUP FROM REQ BLK    @Y30LB26*/
         MVC   GROUPKY(8),MVRGROUP(@02)                            2888
*           ELSE                    /*                       @Y30LB26*/
*             GROUPKY=BASGROUP;     /* GROUP FROM BASE REC   @Y30LB26*/
*                                                                  2889
         B     @RC02887                                            2889
@RF02887 L     @02,BASEVPTR                                        2889
         MVC   GROUPKY(8),BASGROUP(@02)                            2889
*           /*********************************************************/
*           /*                                                       */
*           /* SET UP REMAINING PARAMETERS AND READ GROUP RECORD     */
*           /*                                               @Y30LB26*/
*           /* TO SEE IF IT HAS RETENTION SPECIFIED FOR GROUP        */
*           /*                                               @Y30LB26*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  2890
*           RPLVKEY=ADDR(GKEY);     /* ADDR OF KEY           @Y30LB26*/
@RC02887 L     @02,RPLVPTR                                         2890
         LA    @15,GKEY                                            2890
         ST    @15,RPLVKEY(,@02)                                   2890
*           RPLVLOC=ON;             /* LOCATE MODE           @Y30LB26*/
*           RPLVDIR=ON;             /* READ DIRECT           @Y30LB26*/
         OI    RPLVLOC(@02),B'11000000'                            2892
*           RPLVTYP=RPLVREAD;       /* READ REC              @Y30LB26*/
         MVI   RPLVTYP(@02),X'00'                                  2893
*           RPLVUPD=OFF;            /* NOT FOR UPDATE        @Y30LB26*/
         NI    RPLVUPD(@02),B'11111101'                            2894
*           RESPECIFY                                              2895
*             REG1 RSTD;            /* RESTRICT REG 1        @Y30LB26*/
*           REG1=RPLVPTR;           /* ADDR OF RPLV          @Y30LB26*/
         LR    REG1,@02                                            2896
*           CALL ICBVIO00;          /* READ GROUP RECORD     @Y30LB26*/
         L     @15,@CV00671                                        2897
         BALR  @14,@15                                             2897
*           RPLVLOC=OFF;            /* RESET LOCATE FLAG     @Y30LB26*/
         L     @02,RPLVPTR                                         2898
         NI    RPLVLOC(@02),B'01111111'                            2898
*           RESPECIFY                                              2899
*             REG1 UNRSTD;          /* UNRESTRICT REG1       @Y30LB26*/
*           IF RPLVRETC^=RCZERO THEN/* CHECK RETURN?         @Y30LB26*/
         CLC   RPLVRETC(2,@02),@CB00747                            2900
         BE    @RF02900                                            2900
*             DO;                   /*                       @Y30LB26*/
*               CALL ERREXIT;       /* FREE INVENTORY        @Y30LB26*/
         BAL   @14,ERREXIT                                         2902
*               RETURN;             /*                       @Y30LB26*/
@EL00046 DS    0H                                                  2903
@EF00046 DS    0H                                                  2903
@ER00046 L     @14,@SA00046                                        2903
         BR    @14                                                 2903
*             END;                  /*                       @Y30LB26*/
*                                                                  2904
*           /*********************************************************/
*           /*                                                       */
*           /* GET ADDRESS OF GROUP RECORD AND CHECK IF RETENTION    */
*           /*                                               @Y30LB26*/
*           /* CHECKING IN EFFECT                            @Y30LB26*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  2905
*           GROUPPTR=RPLVBUF;       /* ADDRESSING TO BUFFER  @Y30LB26*/
@RF02900 L     @02,RPLVPTR                                         2905
         L     @15,RPLVBUF(,@02)                                   2905
         ST    @15,GROUPPTR                                        2905
*           IF GRORETN=OFF THEN     /* NO RET DATE?          @Y30LB26*/
*                                                                  2906
         TM    GRORETN(@15),B'00000100'                            2906
         BNZ   @RF02906                                            2906
*             /*******************************************************/
*             /*                                                     */
*             /* IF RETENTION CHECKING NOT IN EFFECT, THEN FOULED UP */
*             /*                                             @Y30LB26*/
*             /*                                                     */
*             /*******************************************************/
*                                                                  2907
*             DO;                   /*                       @Y30LB26*/
*               RPLVRETC=FOUR;      /* SET BAD RETURN        @Y30LB26*/
         MVC   RPLVRETC(2,@02),@CB00749                            2908
*               RPLRCODE=NOEXPICK;  /* NO GROUP EXPIRATION   @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00825                            2909
*               CALL ERREXIT;       /* FREE INVENTORY        @Y30LB26*/
         BAL   @14,ERREXIT                                         2910
*               RETURN;             /*                       @Y30LB26*/
         B     @EL00046                                            2911
*             END;                  /*                       @Y30LB26*/
*         END;                      /*                       @Y30LB26*/
*                                                                  2913
*       /*************************************************************/
*       /*                                                           */
*       /* IF BASE VOLUME IS NOT BECOMMING A GROUPED GENERAL @Y30LB26*/
*       /* USE, OR STAYING A GROUPED GENERAL USE, THEN TO    @Y30LB26*/
*       /* OR FOR SHOULD NOT HAVE BEEN SPECIFIED             @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  2914
*       ELSE                        /*                       @Y30LB26*/
*         DO;                       /*                       @Y30LB26*/
         B     @RC02885                                            2914
@RF02885 DS    0H                                                  2915
*           RPLVRETC=FOUR;          /* SET BAD RET CODE      @Y30LB26*/
         L     @02,RPLVPTR                                         2915
         MVC   RPLVRETC(2,@02),@CB00749                            2915
*           RPLRCODE=NOEXPICK;      /* NO EXPIRATION CK      @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00825                            2916
*           CALL ERREXIT;           /* SAVE RET CODES        @Y30LB26*/
         BAL   @14,ERREXIT                                         2917
*           RETURN;                 /*                       @Y30LB26*/
         B     @EL00046                                            2918
*         END;                      /*                       @Y30LB26*/
*     END;                          /*                       @Y30LB26*/
*   END EXPCK;                      /*                       @Y30LB26*/
         B     @EL00046                                            2921
*                                                                  2922
*   /*****************************************************************/
*   /*                                                               */
*   /* ROUTINE UPDATES THE REMAINING FIELDS IN THE BASE      @Y30LB26*/
*   /* VOLUME RECORD THAT HAVE NOTHING TO DO WITH THE GROUP  @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2922
*COMMON:                            /*                       @Y30LB26*/
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
*                                                                  2922
COMMON   ST    @14,@SA00047                                        2922
*   /*****************************************************************/
*   /*                                                               */
*   /* IF GENERAL USE VOLUME THEN HANDLE EXPIRATION          #Y30LB26*/
*   /* CHANGES IF CALLED FOR                                 #Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2923
*   IF BASGRPV=ON&BASGENUS=ON&      /* GENERAL USE VOL?      @Y30LB26*/
*       (MVRNEXPD=ONMVRFLFOR=ONMVRFLTO=ON) THEN/* CHNGN EXP      2923
*                                                            @Y30LB26*/
         L     @02,BASEVPTR                                        2923
         TM    BASGRPV(@02),B'00110000'                            2923
         BNO   @RF02923                                            2923
         L     @02,MVRPTR                                          2923
         TM    MVRNEXPD(@02),B'00000100'                           2923
         BO    @RT02923                                            2923
         TM    MVRFLFOR(@02),B'10001000'                           2923
         BZ    @RF02923                                            2923
@RT02923 DS    0H                                                  2924
*     DO;                           /*                       @Y30LB26*/
*                                                                  2924
*       /*************************************************************/
*       /*                                                           */
*       /* READ GROUP RECORD FOR SLOT ROUTINE WHICH          @Y30LB26*/
*       /* NEEDS GROUP RECORD                                @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  2925
*       GROUPKY=BASGROUP;           /* GET GROUP NAME        @Y30LB26*/
         L     @02,BASEVPTR                                        2925
         MVC   GROUPKY(8),BASGROUP(@02)                            2925
*       RPLVKEY=ADDR(GKEY);         /* ADDR GROUP KEY        @Y30LB26*/
         L     @02,RPLVPTR                                         2926
         LA    @15,GKEY                                            2926
         ST    @15,RPLVKEY(,@02)                                   2926
*       RPLVLOC=OFF;                /* LOCATE MODE           @ZA13484*/
         NI    RPLVLOC(@02),B'01111111'                            2927
*       RPLVBLN=LENGTH(STORGRP);    /* SET LENGTH            @ZA13484*/
         MVC   RPLVBLN(4,@02),@CF01147                             2928
*       RPLVBUF=ADDR(STORGRP);      /* SET BUF ADDR          @ZA13484*/
         LA    @15,STORGRP                                         2929
         ST    @15,RPLVBUF(,@02)                                   2929
*       RPLVDIR=ON;                 /* READ DIRECT           @Y30LB26*/
         OI    RPLVDIR(@02),B'01000000'                            2930
*       RPLVTYP=RPLVREAD;           /* READ GROUP REC        @Y30LB26*/
         MVI   RPLVTYP(@02),X'00'                                  2931
*       RPLVUPD=OFF;                /* NO UPDATE             @Y30LB26*/
         NI    RPLVUPD(@02),B'11111101'                            2932
*       RESPECIFY                                                  2933
*         REG1 RSTD;                /* RESTRICT REG 1        @Y30LB26*/
*       REG1=RPLVPTR;               /* ADDR RPLV             @Y30LB26*/
         LR    REG1,@02                                            2934
*       CALL ICBVIO00;              /* READ GROUP RECORD     @Y30LB26*/
         L     @15,@CV00671                                        2935
         BALR  @14,@15                                             2935
*       RESPECIFY                                                  2936
*         REG1 UNRSTD;              /* FREE REG 1            @Y30LB26*/
*                                                                  2936
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK RETURN CODE                                 @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  2937
*       IF RPLVRETC^=RCZERO THEN    /* CK RETURN             @Y30LB26*/
         L     @02,RPLVPTR                                         2937
         CLC   RPLVRETC(2,@02),@CB00747                            2937
         BE    @RF02937                                            2937
*         DO;                       /*                       @Y30LB26*/
*           CALL ERREXIT;           /* SAVE RETURN CODES     @Y30LB26*/
         BAL   @14,ERREXIT                                         2939
*           RETURN;                 /*                       @Y30LB26*/
@EL00047 DS    0H                                                  2940
@EF00047 DS    0H                                                  2940
@ER00047 L     @14,@SA00047                                        2940
         BR    @14                                                 2940
*         END;                      /*                       @Y30LB26*/
*                                                                  2941
*       /*************************************************************/
*       /*                                                           */
*       /* SET ADDR TO GROUP RECORD JUST READ                @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  2942
*       GROUPPTR=ADDR(STORGRP);     /* ADDR GRP REC          @ZA13484*/
*                                                                  2942
@RF02937 LA    @02,STORGRP                                         2942
         ST    @02,GROUPPTR                                        2942
*       /*************************************************************/
*       /*                                                           */
*       /* NULLIFY EXPIRATION DATE BASE RECORD               #Y30LB26*/
*       /* CALL ROUTINE TO UPDATE SLOT IN EXTENSION RECORD   @ZA00687*/
*       /* TO MATCH RETENTION DATE IN BASE VOLUME RECORD     @ZA00687*/
*       /* IF REQUEST TO MODIFY GROUP NAME OR TO GENERAL-USE @ZA00687*/
*       /* MODIFY RETENTION DATE, DO NOT DELETE AND RE-ADD.  @ZA00687*/
*       /* ALREADY IN LAST GEOUP EXTENSION SLOT. IF MODIFV   @ZA00687*/
*       /* FOR RETENTION DATE. REMOVE FROM CURRENT SLOT AND  @ZA00687*/
*       /* ADD IN LAST EXTENSION SLOT                        @ZA00687*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  2943
*       IF MVRNEXPD=ON THEN         /* NULL EXPIRATION DATE? @ZA00687*/
         L     @02,MVRPTR                                          2943
         TM    MVRNEXPD(@02),B'00000100'                           2943
         BNO   @RF02943                                            2943
*         DO;                       /*                       @XM40000*/
*           BASEXPDT=NULEXPDT;      /* NULLIFY EXPIRATION    @ZA00687*/
         L     @01,BASEVPTR                                        2945
         MVC   BASEXPDT(4,@01),NULEXPDT                            2945
*           IF MVRFLGRO=ONMVRGEN=ON THEN                          2946
         TM    MVRFLGRO(@02),B'01000000'                           2946
         BO    @RT02946                                            2946
         TM    MVRGEN(@02),B'10000000'                             2946
         BO    @RT02946                                            2946
*             ;                     /*                       @ZA00687*/
*           ELSE                                                   2948
*             DO;                   /*                       @ZA00687*/
*               SLOTEXP=OFF;        /* INDICATE DELETE       @ZA00687*/
         NI    SLOTEXP,B'01111111'                                 2949
*               ADDSLEXT=OFF;       /* INDICATE DELETE       @ZA00687*/
         NI    ADDSLEXT,B'11111101'                                2950
*               CALL VUEXT;         /* GO UPDATE SLOT        @ZA00687*/
         BAL   @14,VUEXT                                           2951
*               IF RPLVRETC^=RCZERO THEN/* CK RETURN         @ZA00687*/
         L     @02,RPLVPTR                                         2952
         CLC   RPLVRETC(2,@02),@CB00747                            2952
         BE    @RF02952                                            2952
*                 DO;               /*                       @ZA00687*/
*                   CALL ERREXIT;   /* SAVE RET CODES        @ZA00687*/
         BAL   @14,ERREXIT                                         2954
*                   RETURN;         /*                       @ZA00687*/
         B     @EL00047                                            2955
*                 END;              /*                       @ZA00687*/
*               ADDSLEXT=ON;        /* INDICATE ADD          @ZA00687*/
@RF02952 OI    ADDSLEXT,B'00000010'                                2957
*               CALL VUEXT;         /* GO UPDATE SLOT        @ZA00687*/
         BAL   @14,VUEXT                                           2958
*               IF RPLVRETC^=RCZERO THEN/* CK RETURN         @ZA00687*/
         L     @02,RPLVPTR                                         2959
         CLC   RPLVRETC(2,@02),@CB00747                            2959
         BE    @RF02959                                            2959
*                 DO;               /*                       @ZA00687*/
*                   CALL ERREXIT;   /* SAVE RET CODES        @ZA00687*/
         BAL   @14,ERREXIT                                         2961
*                   RETURN;         /*                       @ZA00687*/
         B     @EL00047                                            2962
*                 END;              /*                       @ZA00687*/
*             END;                  /*                       @ZA00687*/
*         END;                      /*                       @XM40000*/
*       ELSE                        /*                       #Y30LB26*/
*                                                                  2966
*         /***********************************************************/
*         /*                                                         */
*         /* OTHERWISE CHECK IF TO OR FOR SPECIFIED          #Y30LB26*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  2966
*         DO;                       /*                       #Y30LB26*/
*                                                                  2966
         B     @RC02943                                            2966
@RF02943 DS    0H                                                  2967
*           /*********************************************************/
*           /*                                                       */
*           /* IF FOR SPECIFIED, GO CALCULATE EXPIRATION     #Y30LB26*/
*           /* DATE AND PUT IT IN BASE RECORD                #Y30LB26*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  2967
*           IF MVRFLFOR=ON THEN     /* FOR SPECIFIED?        #Y30LB26*/
         L     @02,MVRPTR                                          2967
         TM    MVRFLFOR(@02),B'10000000'                           2967
         BNO   @RF02967                                            2967
*             DO;                   /*                       @Y30LB26*/
*               FOREXP=MVRFOR;      /* SET FOR EXP DATE      @Y30LB26*/
         LH    FOREXP,MVRFOR(,@02)                                 2969
*               CALL VUEXP;         /*                       @Y30LB26*/
         BAL   @14,VUEXP                                           2970
*               BASEXPDT=RETDATE;   /* RET IN BASE REC       @Y30LB26*/
         L     @02,BASEVPTR                                        2971
         MVC   BASEXPDT(4,@02),RETDATE                             2971
*             END;                  /*                       @Y30LB26*/
*                                                                  2972
*           /*********************************************************/
*           /*                                                       */
*           /* IF TO WAS SPECIFIED, IF IT EXCEEDS MAXIMUM,   @Y30LB26*/
*           /* PUT IN MAXIMUM DATE, OTHERWISE PUT IN TO DATE @Y30LB26*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  2973
*           IF MVRFLTO=ON THEN      /* TO SPECIFIED?         @Y30LB26*/
@RF02967 L     @02,MVRPTR                                          2973
         TM    MVRFLTO(@02),B'00001000'                            2973
         BNO   @RF02973                                            2973
*             DO;                   /*                       @Y30LB26*/
*               IF MVRTO>MAXDATE THEN/* CHECK DATE?          @Y30LB26*/
         CLC   MVRTO(4,@02),MAXDATE                                2975
         BNH   @RF02975                                            2975
*                 BASEXPDT=MAXDATE; /* SET TO MAX DATE       @Y30LB26*/
         L     @02,BASEVPTR                                        2976
         MVC   BASEXPDT(4,@02),MAXDATE                             2976
*               ELSE                /*                       @Y30LB26*/
*                 BASEXPDT=MVRTO;   /* SET TO GIVEN DATE     @Y30LB26*/
         B     @RC02975                                            2977
@RF02975 L     @02,BASEVPTR                                        2977
         L     @01,MVRPTR                                          2977
         MVC   BASEXPDT(4,@02),MVRTO(@01)                          2977
*             END;                  /*                       @Y30LB26*/
@RC02975 DS    0H                                                  2979
*         END;                      /*                       @Y30LB26*/
*                                                                  2979
@RF02973 DS    0H                                                  2980
*       /*************************************************************/
*       /*                                                           */
*       /* CALL ROUTINE TO UPDATE SLOT IN EXTENSION RECORD   @Y30LB26*/
*       /* TO MATCH RETENTION DATE IN BASE VOLUME RECORD     @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  2980
*       SLOTEXP=ON;                 /* INDICATE ONLY EXP     @ZA00687*/
@RC02943 OI    SLOTEXP,B'10000000'                                 2980
*       CALL VUEXT;                 /* GO UPDATE SLOT        @ZA00687*/
         BAL   @14,VUEXT                                           2981
*       IF RPLVRETC^=RCZERO THEN    /* CK RETURN             @ZA00687*/
         L     @02,RPLVPTR                                         2982
         CLC   RPLVRETC(2,@02),@CB00747                            2982
         BE    @RF02982                                            2982
*         DO;                       /*                       @ZA00687*/
*           CALL ERREXIT;           /* SAVE RET CODES        @ZA00687*/
         BAL   @14,ERREXIT                                         2984
*           RETURN;                 /*                       @ZA00687*/
         B     @EL00047                                            2985
*         END;                      /*                       @ZA00687*/
*     END;                          /*                       #Y30LB26*/
*                                                                  2987
@RF02982 DS    0H                                                  2988
*   /*****************************************************************/
*   /*                                                               */
*   /* IF NULLIFY DESCRIPTION CALLED FOR, NULLIFY IT         #Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2988
*   IF MVRNDESC=ON THEN             /* NULLIFY DEXCRIPTION?  #Y30LB26*/
@RF02923 L     @02,MVRPTR                                          2988
         TM    MVRNDESC(@02),B'00001000'                           2988
         BNO   @RF02988                                            2988
*     BASDESCR=BLANK;               /* NULLIFT DESCRIP       #Y30LB26*/
         L     @02,BASEVPTR                                        2989
         MVI   BASDESCR+1(@02),C' '                                2989
         MVC   BASDESCR+2(28,@02),BASDESCR+1(@02)                  2989
         MVI   BASDESCR(@02),C' '                                  2989
*   ELSE                            /*                       #Y30LB26*/
*                                                                  2990
*     /***************************************************************/
*     /*                                                             */
*     /* OTHERWISE SEE IF NEW DESCRIPTION CALLED FOR         #Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  2990
*     IF MVRFLDES=ON THEN           /* DESCR SPEC?           #Y30LB26*/
         B     @RC02988                                            2990
@RF02988 L     @02,MVRPTR                                          2990
         TM    MVRFLDES(@02),B'00010000'                           2990
         BNO   @RF02990                                            2990
*       BASDESCR=MVRDES;            /* MODIFY DESCRIPTION    @Y30LB26*/
*                                                                  2991
         L     @01,BASEVPTR                                        2991
         MVC   BASDESCR(30,@01),MVRDES(@02)                        2991
*   /*****************************************************************/
*   /*                                                               */
*   /* IF NEW BACKUP NUMBER SPECIFIED, PUT IT IN             @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2992
*   IF MVRFLBK=ON THEN              /* BACKUP SPEC?          @Y30LB26*/
@RF02990 DS    0H                                                  2992
@RC02988 L     @02,MVRPTR                                          2992
         TM    MVRFLBK(@02),B'00000010'                            2992
         BNO   @RF02992                                            2992
*     BASBKLMT=MVRBKUPN;            /* SET MAX BACKUPS       @Y30LB26*/
*                                                                  2993
         L     @01,BASEVPTR                                        2993
         MVC   BASBKLMT(1,@01),MVRBKUPN(@02)                       2993
*   /*****************************************************************/
*   /*                                                               */
*   /* SET MISMATCH FLAG                                     @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2994
*   IF MVRSLMIS=ON THEN             /* MISMATCH SPECS        @Y30LB26*/
@RF02992 L     @02,MVRPTR                                          2994
         TM    MVRSLMIS(@02),B'00000010'                           2994
         BNO   @RF02994                                            2994
*     BASVSMIS=ON;                  /* SET MISMATCH FLAG     @Y30LB26*/
         L     @02,BASEVPTR                                        2995
         OI    BASVSMIS(@02),B'00100000'                           2995
*   ELSE                            /*                       @Y30LB26*/
*                                                                  2996
*     /***************************************************************/
*     /*                                                             */
*     /* OTHERWISE MIGHT CLEAR MISMATCH FLAG                 @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  2996
*     IF MVRCLMIS=ON THEN           /* CLEAR MISMATCH?       @Y30LB26*/
         B     @RC02994                                            2996
@RF02994 L     @02,MVRPTR                                          2996
         TM    MVRCLMIS(@02),B'00000001'                           2996
         BNO   @RF02996                                            2996
*       BASVSMIS=OFF;               /* CLEAR MISMATCH FLAG   @Y30LB26*/
*                                                                  2997
         L     @02,BASEVPTR                                        2997
         NI    BASVSMIS(@02),B'11011111'                           2997
*   /*****************************************************************/
*   /*                                                               */
*   /* SET NEW VALUE IN RECOVERY VOLUME LABEL AREA           @Y30LB26*/
*   /* OF BASE VOLUME RECORD                                 @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2998
*   IF MVRFLLAB=ON THEN             /* MVRLABEL SPECIFIED ?  @Y30LB26*/
@RF02996 DS    0H                                                  2998
@RC02994 L     @02,MVRPTR                                          2998
         TM    MVRFLLAB(@02),B'00000001'                           2998
         BNO   @RF02998                                            2998
*     BASRECOV=MVRLABEL;            /* SET NEW LABEL         @Y30LB26*/
*                                                                  2999
         L     @01,BASEVPTR                                        2999
         MVC   BASRECOV(6,@01),MVRLABEL(@02)                       2999
*   /*****************************************************************/
*   /*                                                               */
*   /* CLEAR INCOMPLETE VOLUME CREATION FLAG                 @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3000
*   IF MVRCIVCF=ON THEN             /* CLEAR INCOMPLETE?     @Y30LB26*/
@RF02998 L     @02,MVRPTR                                          3000
         TM    MVRCIVCF(@02),B'10000000'                           3000
         BNO   @RF03000                                            3000
*     BASIVCRE=OFF;                 /* CLEAR INCOM VOL FLAG  @Y30LB26*/
*                                                                  3001
         L     @02,BASEVPTR                                        3001
         NI    BASIVCRE(@02),B'01111111'                           3001
*   /*****************************************************************/
*   /*                                                               */
*   /* CLEAR COPY VOLUME FLAG                                @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3002
*   IF MVRCICPY=ON THEN             /* CLEAR COPY FLAG?      @Y30LB26*/
@RF03000 L     @02,MVRPTR                                          3002
         TM    MVRCICPY(@02),B'01000000'                           3002
         BNO   @RF03002                                            3002
*     BASIVCPY=OFF;                 /* CLEAR COPY FLAG       @Y30LB26*/
*                                                                  3003
         L     @02,BASEVPTR                                        3003
         NI    BASIVCPY(@02),B'10111111'                           3003
*   /*****************************************************************/
*   /*                                                               */
*   /* READ BASE VOLUME RECORD FOR UPDATE SO IT              @Y30LB26*/
*   /* CAN BE WRITTEN                                        @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3004
*   RPLVKEY=ADDR(VKEY);             /* ADDR OF KEY           @Y30LB26*/
@RF03002 L     @02,RPLVPTR                                         3004
         LA    @15,VKEY                                            3004
         ST    @15,RPLVKEY(,@02)                                   3004
*   RPLVBUF=ADDR(DUMMYREC);         /* DUMMY FILL SPACE      @Y30LB26*/
         LA    @15,DUMMYREC                                        3005
         ST    @15,RPLVBUF(,@02)                                   3005
*   RPLVBLN=LENGTH(BASEV);          /* LENGTH OF BUFFER      @Y30LB26*/
         MVC   RPLVBLN(4,@02),@CF01147                             3006
*   RPLVLOC=OFF;                    /* NO LOCATE MODE        @Y30LB26*/
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB26*/
         OI    RPLVDIR(@02),B'01000000'                            3008
         NI    RPLVLOC(@02),B'01111111'                            3008
*   RPLVTYP=RPLVREAD;               /* READ REC              @Y30LB26*/
         MVI   RPLVTYP(@02),X'00'                                  3009
*   RPLVUPD=ON;                     /* FOR UPDATE            @Y30LB26*/
         OI    RPLVUPD(@02),B'00000010'                            3010
*   RESPECIFY                                                      3011
*     REG1 RSTD;                    /* RESTRICT REG 1        @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR OF RPLV          @Y30LB26*/
         LR    REG1,@02                                            3012
*   CALL ICBVIO00;                  /* READ BASE FOR UPDATE  @Y30LB26*/
         L     @15,@CV00671                                        3013
         BALR  @14,@15                                             3013
*   RESPECIFY                                                      3014
*     REG1 UNRSTD;                  /* UNRESTRICT REG1       @Y30LB26*/
*   IF RPLVRETC^=RCZERO THEN        /* CHECK RETURN?         @Y30LB26*/
         L     @02,RPLVPTR                                         3015
         CLC   RPLVRETC(2,@02),@CB00747                            3015
         BE    @RF03015                                            3015
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* FREE INVENTORY        @Y30LB26*/
         BAL   @14,ERREXIT                                         3017
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00047                                            3018
*     END;                          /*                       @Y30LB26*/
*                                                                  3019
*   /*****************************************************************/
*   /*                                                               */
*   /* GET ADDRESS OF UPDATED BASE RECORD AND WRITE IT       @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3020
*   RPLVBUF=ADDR(STORBASE);         /* ADDR UPDATED REC      @Y30LB26*/
@RF03015 L     @02,RPLVPTR                                         3020
         LA    @15,STORBASE                                        3020
         ST    @15,RPLVBUF(,@02)                                   3020
*   RPLVTYP=RPLVPUT;                /* PUT OUT RECORD        @Y30LB26*/
         MVI   RPLVTYP(@02),X'01'                                  3021
*   RESPECIFY                                                      3022
*     REG1 RSTD;                    /* RESTRICT REG 1        @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR OF RPLV          @Y30LB26*/
         LR    REG1,@02                                            3023
*   CALL ICBVIO00;                  /* WRITE BASE RECORD     @Y30LB26*/
         L     @15,@CV00671                                        3024
         BALR  @14,@15                                             3024
*   RESPECIFY                                                      3025
*     REG1 UNRSTD;                  /* UNRESTRICT REG1       @Y30LB26*/
*   IF RPLVRETC^=RCZERO THEN        /* CHECK RETURN?         @Y30LB26*/
         L     @02,RPLVPTR                                         3026
         CLC   RPLVRETC(2,@02),@CB00747                            3026
         BE    @RF03026                                            3026
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* FREE INVENTORY        @Y30LB26*/
         BAL   @14,ERREXIT                                         3028
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00047                                            3029
*     END;                          /*                       @Y30LB26*/
*                                                                  3030
*   /*****************************************************************/
*   /*                                                               */
*   /* IF NEVER JOURNALED BEFORE, JOURNAL THE RPLV           @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3031
*   IF JRNLEDSW=OFF THEN            /* JOURNALED BEFORE?     @Y30LB26*/
@RF03026 TM    JRNLEDSW,B'00000001'                                3031
         BNZ   @RF03031                                            3031
*     CALL JOURNAL;                 /* JOURNAL RPLV          @Y30LB26*/
         BAL   @14,JOURNAL                                         3032
*   RETURN;                         /*                       @Y30LB26*/
         B     @EL00047                                            3033
*   END COMMON;                     /*                       @Y30LB26*/
         B     @EL00047                                            3034
*                                                                  3035
*   /*****************************************************************/
*   /*                                                               */
*   /* THIS ROUTINE JOURNALS THE RPLV AND IS CALLED          @Y30LB26*/
*   /* AFTER THE FIRST SUCCESSFUL UPDATE OF THE INVENTORY    @Y30LB26*/
*   /* DATA SET. IT SETS THE JRNLEDSW ON SO THAT IT WILL     @Y30LB26*/
*   /* NOT BE CALLED AGAIN BY THE SAME FUNCTION              @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3035
*JOURNAL:                                                          3035
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
*                                                                  3035
JOURNAL  ST    @14,@SA00048                                        3035
*   /*****************************************************************/
*   /*                                                               */
*   /* RESERVE THE JOURNAL DATA SET                          @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3036
*   RESPECIFY                                                      3036
*     REG1 RSTD;                    /* RESTRICT REG1         @Y30LB26*/
*   RESPECIFY                                                      3037
*     REG0 RSTD;                    /* RESTRICT REG0         @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR OF RPLV          @Y30LB26*/
         L     REG1,RPLVPTR                                        3038
*   REG0=RESEXVJL;                  /* INDICATE JOURNAL      @Y30LB26*/
         LA    REG0,17                                             3039
*   CALL ICBVRR00;                  /* RESERVE JOURNAL       @Y30LB26*/
         L     @15,@CV00673                                        3040
         BALR  @14,@15                                             3040
*   RESPECIFY                                                      3041
*     REG0 UNRSTD;                  /* FREE REG0             @Y30LB26*/
*   RESPECIFY                                                      3042
*     REG1 UNRSTD;                  /* FREE REG1             @Y30LB26*/
*   EXITVJL=ON;                     /* INDI JOURNAL RESERVED @Y30LB26*/
*                                                                  3043
         OI    EXITVJL,B'00000100'                                 3043
*   /*****************************************************************/
*   /*                                                               */
*   /* CALL ROUTINE TO JOURNAL THE RPLV                      @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3044
*   RESPECIFY                                                      3044
*     REG1 RSTD;                    /* RESTRICT              @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR RPLV             @Y30LB26*/
         L     REG1,RPLVPTR                                        3045
*   CALL ICBVJL00;                  /* JOURNAL REQUEST BLK   @Y30LB26*/
         L     @15,@CV00672                                        3046
         BALR  @14,@15                                             3046
*   RESPECIFY                                                      3047
*     REG1 UNRSTD;                  /* FREE REG 1            @Y30LB26*/
*                                                                  3047
*   /*****************************************************************/
*   /*                                                               */
*   /* MAKE IT APPEAR THAT JOURNALING WAS SUCCESSFUL         @Y30LB26*/
*   /* EVEN IF IT WAS NOT                                    @Y30LB26*/
*   /* SET SWITCH INDICATING IT HAS BEEN JOURNALED           @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3048
*   RPLVRETC=RCZERO;                /* ZERO RETURN           @Y30LB26*/
         L     @07,RPLVPTR                                         3048
         MVC   RPLVRETC(2,@07),@CB00747                            3048
*   RPLRCODE=RCZERO;                /* ZERO REASON CODE      @Y30LB26*/
         MVC   RPLRCODE(2,@07),@CB00747                            3049
*   JRNLEDSW=ON;                    /* INDICATE JOURNALED    @Y30LB26*/
*                                                                  3050
         OI    JRNLEDSW,B'00000001'                                3050
*   /*****************************************************************/
*   /*                                                               */
*   /* CALL ROUTINE TO RELEASE JOURNAL DATA SET              @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3051
*   RESPECIFY                                                      3051
*     REG1 RSTD;                    /* RESTRICT REG 1        @Y30LB26*/
*   RESPECIFY                                                      3052
*     REG0 RSTD;                    /* RESTRICT REG 0        @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR OF RPLV          @Y30LB26*/
         LR    REG1,@07                                            3053
*   REG0=DEQJRNL;                   /* INDICATE FREE JOURNAL @Y30LB26*/
         LA    REG0,16                                             3054
*   CALL ICBVRR00;                  /* FREE IT               @Y30LB26*/
         L     @15,@CV00673                                        3055
         BALR  @14,@15                                             3055
*   RESPECIFY                                                      3056
*     REG0 UNRSTD;                  /* FREE REG 0            @Y30LB26*/
*   RESPECIFY                                                      3057
*     REG1 UNRSTD;                  /* FREE REG 1            @Y30LB26*/
*   EXITVJL=OFF;                    /* INDI JOURNAL FREED    @Y30LB26*/
         NI    EXITVJL,B'11111011'                                 3058
*   RETURN;                         /*                       @Y30LB26*/
@EL00048 DS    0H                                                  3059
@EF00048 DS    0H                                                  3059
@ER00048 L     @14,@SA00048                                        3059
         BR    @14                                                 3059
*   END JOURNAL;                    /*                       @Y30LB26*/
*                                                                  3061
*   /*****************************************************************/
*   /*                                                               */
*   /* ROUTINE RESERVES THE INVENTORY DATA SET FOR           @Y30LB26*/
*   /* EXCLUSIVE USE                                         @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3061
*RESERINV:                                                         3061
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
RESERINV ST    @14,@SA00049                                        3061
*   RESPECIFY                                                      3062
*    (REG0,                                                        3062
*     REG1) RSTD;                   /* RESTRICT REGS         @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR OF RPLV          @Y30LB26*/
         L     REG1,RPLVPTR                                        3063
*   REG0=RESEXINV;                  /*                       @Y30LB26*/
         LA    REG0,1                                              3064
*   CALL ICBVRR00;                  /*                       @Y30LB26*/
         L     @15,@CV00673                                        3065
         BALR  @14,@15                                             3065
*   RESPECIFY                                                      3066
*    (REG0,                                                        3066
*     REG1) UNRSTD;                 /* FREE REGS             @Y30LB26*/
*   EXITVVIC=ON;                    /*                       @Y30LB26*/
         OI    EXITVVIC,B'00001000'                                3067
*   RETURN;                         /*                       @Y30LB26*/
@EL00049 DS    0H                                                  3068
@EF00049 DS    0H                                                  3068
@ER00049 L     @14,@SA00049                                        3068
         BR    @14                                                 3068
*   END RESERINV;                   /*                       @Y30LB26*/
*                                                                  3070
*   /*****************************************************************/
*   /*                                                               */
*   /* ROUTINE ENTERED WHEN AN ERROR OCCURES. FREES JOURNAL  @VS32198*/
*   /* IF JOURNAL IS RESERVED AND SAVES REASON AND RETURN    @VS32198*/
*   /* CODES BEFORE RELEASE AND THEN RESTORES THEM.          @VS32198*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3070
*ERREXIT:                                                          3070
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
*                                                                  3070
ERREXIT  ST    @14,@SA00050                                        3070
*   /*****************************************************************/
*   /*                                                               */
*   /* SAVE CODES                                            @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3071
*   REACODE=RPLRCODE;               /* SAVE REASON CODE      @Y30LB26*/
         L     @04,RPLVPTR                                         3071
         MVC   REACODE(2),RPLRCODE(@04)                            3071
*   RETCODE=RPLVRETC;               /* SAVE RETURN CODE      @Y30LB26*/
*                                                                  3072
         MVC   RETCODE(2),RPLVRETC(@04)                            3072
*   /*****************************************************************/
*   /*                                                               */
*   /* SEE IF JOURNAL DATA SET IS RESERVED                   @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3073
*   IF EXITVJL=ON THEN              /* THEN JOR NOT RELEASED @Y30LB26*/
*                                                                  3073
         TM    EXITVJL,B'00000100'                                 3073
         BNO   @RF03073                                            3073
*     /***************************************************************/
*     /*                                                             */
*     /* FREE JOURNAL DATA SET                               @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  3074
*     DO;                           /* RELEASE IT            @Y30LB26*/
*       RESPECIFY                                                  3075
*         REG1 RSTD;                /* RESTRICT              @Y30LB26*/
*       RESPECIFY                                                  3076
*         REG0 RSTD;                /* RESTRICT              @Y30LB26*/
*       REG1=RPLVPTR;               /* ADDR OF RPLV          @Y30LB26*/
         LR    REG1,@04                                            3077
*       REG0=DEQJRNL;               /* SET REG0 TO FREE JRNL @Y30LB26*/
         LA    REG0,16                                             3078
*       CALL ICBVRR00;              /* CALL RESERVE RELEASE  @Y30LB26*/
         L     @15,@CV00673                                        3079
         BALR  @14,@15                                             3079
*       RESPECIFY                                                  3080
*         REG0 UNRSTD;              /* FREE                  @Y30LB26*/
*       RESPECIFY                                                  3081
*         REG1 UNRSTD;              /* FREE                  @Y30LB26*/
*                                                                  3081
*       /*************************************************************/
*       /*                                                           */
*       /* RESTORE REASON AND RETURN VALUES                  @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  3082
*       RPLRCODE=REACODE;           /* AND RETURN CODES      @Y30LB26*/
         L     @04,RPLVPTR                                         3082
         MVC   RPLRCODE(2,@04),REACODE                             3082
*       RPLVRETC=RETCODE;           /* OTHERWISE RETURN      @Y30LB26*/
         MVC   RPLVRETC(2,@04),RETCODE                             3083
*     END;                          /*                       @Y30LB26*/
*   RETURN;                         /* RETURN TO CALLER      @Y30LB26*/
@EL00050 DS    0H                                                  3085
@EF00050 DS    0H                                                  3085
@ER00050 L     @14,@SA00050                                        3085
         BR    @14                                                 3085
*   END ERREXIT;                    /*                       @Y30LB26*/
         B     @EL00050                                            3086
*                                                                  3087
*/*  START OF SPECIFICATIONS ****                                  3087
*                                                                  3087
*    PROCEDURE NAME - ICBVUDBR                                @Y30LB26
*                                                                  3087
*    FUNCTION - TAKES THE DUPLICATE VOLUME RECORD AND MAKES IT INTO A
*    NEW BASE VOLUME RECORD.  IT USES THE CSN'S AND LIBID'S        3087
*    FROM THE DUPLICATE VOLUME RECORD TO FILL IN CORRESPONDING     3087
*    FIELDS OF THE NEW BASE VOLUME RECORD.  IT ALSO READS THE CARTRIDGE
*    INDEX RECORDS AND UPDATES THE KEY OF THE VOLUME THE CARTRIDGE 3087
*    BELONGS TO.  IF THE ORIGINAL BASE VOLUME RECORD WAS GROUPED, THE
*    EXTERNAL PROCEDURE ICBVUCHI MUST BE CALLED AFTER THIS ROUTINE 3087
*    RETURNS CONTROL TO THE CALLER, TO CHAIN THE NEW BASE          3087
*    VOLUME RECORD INTO THE NON-GROUPED CHAIN.  THIS CHAIN-IN ROUTINE
*    ALSO INCREASES THE VOLUME COUNT BY ONE IN THE NON-GROUPED VOLUME
*    HEADER RECORD.  IF THE                                        3087
*    ORIGINAL BASE VOLUME RECORD WAS NON-GROUPED, THE ROUTINE KEEPS
*    THE PREVIOUS AND NEXT BASE VOLUME ID AND ALSO IF THE VOLUME WAS
*    FIRST OR LAST IN THE CHAIN, AND SETS THESE FIELDS AND BITS UP IN
*    THE NEW BASE VOLUME RECORD.  THIS IS TO KEEP FROM HAVING TO CHAIN
*    THE OLD VOLUME OUT OF THE NON-GROUPED CHAIN AND THEN CHAINING THE
*    NEW VOLUME BACK IN.  THE ROUTINE THEN DELETES THE DUPLICATE VOLUME
*    RECORD, WRITES THE NEW BASE VOLUME RECORD AND THE CARTRIDGE   3087
*    INDEX RECORDS.                                           @Y30LB26
*                                                                  3087
*      INPUT - A PARAMETER LIST CONTAINING THE ADDRESS OF THE DUPLICATE
*      RECORD, THE ADDRESS OF THE RPLV, FLAG BYTES, AND OPTIONALLY THE
*      VOLID OF PREVIOUS RECORD, AND THE VOLID OF THE NEXT RECORD. 3087
*      THE FLAG BYTE TELLS IF THE VOLID OF THE PREVIOUS AND        3087
*      AND THE VOLID OF THE NEXT RECORD IS SPECIFIED, AND IF THE   3087
*      OLD BASE WAS FIRST OR LAST IN CHAIN.                   @Y30LB26
*                                                                  3087
*      OUTPUT - ADDRESS OF CREATED BASE VOL REC RETURNED      @Y30LB26
*       IN PARM FIELD.                                        @Y30LB26
*      REASON AND CONDITION CODES RETURNED IN RPLV.           @Y30LB26
*      THE ONLY REASON CODES RETURNED BY THIS PROCEDURE WILL  @Y30LB26
*       BE THE I/O PROCESSOR AND THE JOURNAL REASON CODES.    @Y30LB26
**** END OF SPECIFICATIONS **                                        */
*                                                                  3087
*ICBVUDBR:                                                         3087
*   ENTRY(DUPVDBR,BASEVDBR,RPLVDBR,FLAGDBR,/*                @Y30LB26*/
*       SPREVDBR,SNEXTDBR);         /*                       @Y30LB26*/
@EP03087 MVC   @PC00001(24),0(@01)                                 3087
*   DCL                                                            3088
*     DUPVDBR PTR(31);              /* PTR TO DUP REC        #Y30LB26*/
*   DCL                                                            3089
*     BASEVDBR PTR(31);             /* RETURNED PTR BASE REC @Y30LB26*/
*   DCL                                                            3090
*     RPLVDBR PTR(31);              /* PTR TO RPLV           #Y30LB26*/
*   DCL                                                            3091
*     FLAGDBR BIT(16);              /* INDICATOR FLAGS       @Y30LB26*/
*   DCL                                                            3092
*     SPREVDBR CHAR(6);             /* SAVE PREV VOLID       #Y30LB26*/
*   DCL                                                            3093
*     SNEXTDBR CHAR(6);             /* SAVE NEXT VOLID       #Y30LB26*/
*                                                                  3094
*   /*****************************************************************/
*   /*                                                               */
*   /* SET UP VALUES IN PROGRAM AS THEY WERE PASSED          #Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3094
*   DUPVPTR=DUPVDBR;                /* SET EQUAL TO PASSED   #Y30LB26*/
         L     @02,@PC00001                                        3094
         L     @02,DUPVDBR(,@02)                                   3094
         ST    @02,DUPVPTR                                         3094
*   RPLVPTR=RPLVDBR;                /* ADDR OF RPLV          #Y30LB26*/
         L     @02,@PC00001+8                                      3095
         L     @02,RPLVDBR(,@02)                                   3095
         ST    @02,RPLVPTR                                         3095
*   PASSFLAG=FLAGDBR;               /* INDICATOR FLAGS       #Y30LB26*/
         L     @02,@PC00001+12                                     3096
         MVC   PASSFLAG(2),FLAGDBR(@02)                            3096
*   SAVEPREV=SPREVDBR;              /* SET PREV VOLID        #Y30LB26*/
         L     @02,@PC00001+16                                     3097
         MVC   SAVEPREV(6),SPREVDBR(@02)                           3097
*   SAVENEXT=SNEXTDBR;              /* SET NEXT VOLID        #Y30LB26*/
         L     @02,@PC00001+20                                     3098
         MVC   SAVENEXT(6),SNEXTDBR(@02)                           3098
*   CALL VUDBR;                     /* CALL INTERNAL PROC    @Y30LB26*/
         BAL   @14,VUDBR                                           3099
*   BASEVDBR=BASEVPTR;              /* GET ADDR OF BASE REC  @Y30LB26*/
         L     @02,@PC00001+4                                      3100
         L     @15,BASEVPTR                                        3100
         ST    @15,BASEVDBR(,@02)                                  3100
*   RETURN;                         /*                       @Y30LB26*/
         B     @EL00001                                            3101
*                                                                  3102
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE VUDBR IS CODED SO THAT CODE CONTAINED IN    @Y30LB26*/
*   /* ENTRY ICBVUDBR CAN BE USED BY BOTH THIS MODULE AND BY @Y30LB26*/
*   /* OTHER MODULES                                         @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3102
*VUDBR:                                                            3102
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
VUDBR    ST    @14,@SA00051                                        3102
*   BASEREC=BASEREC&&BASEREC;       /* ZERO BASE BUFFER      @Y30LB26*/
         XC    BASEREC(224),BASEREC                                3103
*   BASEVPTR=ADDR(BASEREC);         /* ADDRESSING TO BASE    #Y30LB26*/
         LA    @02,BASEREC                                         3104
         ST    @02,BASEVPTR                                        3104
*   VOLKY=DUPSERNO;                 /* MOVE VOLID TO KEY     #Y30LB26*/
         L     @15,DUPVPTR                                         3105
         MVC   VOLKY(6),DUPSERNO(@15)                              3105
*   VBLKKY=BLANK;                   /* BLANK PART OF KEY     @Y30LB26*/
         MVI   VBLKKY,C' '                                         3106
*   VIDKY=FIXZERO;                  /* MAKE SURE ID ZERO     #Y30LB26*/
         MVI   VIDKY,X'00'                                         3107
*   BASNAME=VKEY;                   /* MOVE KEY TO RECORD    #Y30LB26*/
         MVC   BASNAME(13,@02),VKEY                                3108
*   BASBASVR=ON;                    /* INDICATE BASE VOL     #Y301B26*/
         OI    BASBASVR(@02),B'00100000'                           3109
*   BASINAC=ON;                     /* INACTIVE              @Y301B26*/
         OI    BASINAC(@02),B'00000100'                            3110
*   BASCSN1=DUPCSN1;                /* GET FIRST CARTRIDGE   @Y30LB26*/
         MVC   BASCSN1(12,@02),DUPCSN1(@15)                        3111
*   BASLIB1=DUPLIB1;                /* LIB ID FIRST CSN      @Y30LB26*/
         MVC   BASLIB1(1,@02),DUPLIB1(@15)                         3112
*   BASCSN2=DUPCSN2;                /* GET SECOND CARTRIDGE  @Y30LB26*/
         MVC   BASCSN2(12,@02),DUPCSN2(@15)                        3113
*   BASLIB2=DUPLIB2;                /* LIB ID SECOND CSN     @Y30LB26*/
         MVC   BASLIB2(1,@02),DUPLIB2(@15)                         3114
*   BASBKLMT=ONE;                   /* SET BACKUP LIMIT      @Y30LB26*/
         MVI   BASBKLMT(@02),X'01'                                 3115
*   BASFRESP=FIXF;                  /* ZERO FREE SPACE       @Y30LB26*/
         L     @14,FIXF                                            3116
         STH   @14,BASFRESP(,@02)                                  3116
*   BASLEXT=FIXF;                   /* ZERO LARGEST EXTENT   @Y30LB26*/
         STH   @14,BASLEXT(,@02)                                   3117
*   BASFREXT=FIXF;                  /* ZERO FREE EXTENTS     @Y30LB26*/
         ST    @14,BASFREXT(,@02)                                  3118
*   BASDLSF=ON;                     /* INDIC SPACE DOWN LVEL @Y30LB26*/
         OI    BASDLSF(@02),B'10000000'                            3119
*   BASPREV=BLANK;                  /* PREVIOUS VOL ID       @Y30LB26*/
         MVI   BASPREV+1(@02),C' '                                 3120
         MVC   BASPREV+2(4,@02),BASPREV+1(@02)                     3120
         MVI   BASPREV(@02),C' '                                   3120
*   BASNEXTV=BLANK;                 /* NEXT VOL ID           @Y30LB26*/
         MVI   BASNEXTV+1(@02),C' '                                3121
         MVC   BASNEXTV+2(4,@02),BASNEXTV+1(@02)                   3121
         MVI   BASNEXTV(@02),C' '                                  3121
*   BASKLCPY=BLANK;                 /* KEY LATEST COPY       @Y30LB26*/
         MVI   BASKLCPY+1(@02),C' '                                3122
         MVC   BASKLCPY+2(11,@02),BASKLCPY+1(@02)                  3122
         MVI   BASKLCPY(@02),C' '                                  3122
*   BASEXPDT=NULEXPDT;              /* NULLIFY EXPIRATION    @Y30LB26*/
         MVC   BASEXPDT(4,@02),NULEXPDT                            3123
*   BASDTREM=BLANK;                 /* DATE VOL REMOVED      @Y30LB26*/
         MVI   BASDTREM+1(@02),C' '                                3124
         MVC   BASDTREM+2(2,@02),BASDTREM+1(@02)                   3124
         MVI   BASDTREM(@02),C' '                                  3124
*   BASDESCR=BLANK;                 /* DESCRIPTION           @Y30LB26*/
         MVI   BASDESCR+1(@02),C' '                                3125
         MVC   BASDESCR+2(28,@02),BASDESCR+1(@02)                  3125
         MVI   BASDESCR(@02),C' '                                  3125
*   BASOWNER=BLANK;                 /* OWNER                 @Y30LB26*/
         MVI   BASOWNER+1(@02),C' '                                3126
         MVC   BASOWNER+2(8,@02),BASOWNER+1(@02)                   3126
         MVI   BASOWNER(@02),C' '                                  3126
*   BASDEST=BLANK;                  /* DESTINATION AFTER EJT @Y30LB26*/
         MVI   BASDEST+1(@02),C' '                                 3127
         MVC   BASDEST+2(28,@02),BASDEST+1(@02)                    3127
         MVI   BASDEST(@02),C' '                                   3127
*   BASRECOV=BLANK;                 /* RECOVERY SER NO       @Y30LB26*/
         MVI   BASRECOV+1(@02),C' '                                3128
         MVC   BASRECOV+2(4,@02),BASRECOV+1(@02)                   3128
         MVI   BASRECOV(@02),C' '                                  3128
*   BASGROUP=BLANK;                 /* GROUP NAME            @Y30LB26*/
         MVI   BASGROUP+1(@02),C' '                                3129
         MVC   BASGROUP+2(6,@02),BASGROUP+1(@02)                   3129
         MVI   BASGROUP(@02),C' '                                  3129
*                                                                  3130
*   /*****************************************************************/
*   /*                                                               */
*   /* GET AND UPDATE THE CARTRIDGE INDEX RECORDS ASSIGNED   #Y30LB26*/
*   /* TO THE DUPLICATE RECORD                               #Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3130
*   CARTKY=DUPCSN1;                 /* GET CART SERIAL NO    #Y30LB26*/
         MVC   CARTKY(12),DUPCSN1(@15)                             3130
*   RPLVKEY=ADDR(IKEY);             /* ADDR OF KEY           #Y30LB26*/
         L     @02,RPLVPTR                                         3131
         LA    @15,IKEY                                            3131
         ST    @15,RPLVKEY(,@02)                                   3131
*   RPLVBUF=ADDR(STORINDX);         /* BUFFER ADDR           #Y30LB26*/
         LA    @15,STORINDX                                        3132
         ST    @15,RPLVBUF(,@02)                                   3132
*   RPLVBLN=LENGTH(STORINDX);       /* LENGTH BUFFER         #Y30LB26*/
         MVC   RPLVBLN(4,@02),@CF01147                             3133
*   RPLVLOC=OFF;                    /* NO LOCATE             #Y30LB26*/
*   RPLVDIR=ON;                     /* READ DIRECT           #Y30LB26*/
         OI    RPLVDIR(@02),B'01000000'                            3135
         NI    RPLVLOC(@02),B'01111111'                            3135
*   RPLVTYP=RPLVREAD;               /* READ RECORD           #Y30LB26*/
         MVI   RPLVTYP(@02),X'00'                                  3136
*   RPLVKGE=OFF;                    /* NOT > OR =            #Y30LB26*/
         NI    RPLVKGE(@02),B'11111011'                            3137
*   RPLVUPD=ON;                     /* FOR UPDATE            #Y30LB26*/
         OI    RPLVUPD(@02),B'00000010'                            3138
*   RESPECIFY                                                      3139
*     REG1 RSTD;                    /* RESTRICT              #Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR OF RPLV          #Y30LB26*/
         LR    REG1,@02                                            3140
*   CALL ICBVIO00;                  /* READ FIRST CART       #Y30LB26*/
         L     @15,@CV00671                                        3141
         BALR  @14,@15                                             3141
*   RESPECIFY                                                      3142
*     REG1 UNRSTD;                  /* FREE                  #Y30LB26*/
*   IF RPLVRETC^=RCZERO THEN        /* CK RETURN             #Y30LB26*/
         L     @02,RPLVPTR                                         3143
         CLC   RPLVRETC(2,@02),@CB00747                            3143
         BE    @RF03143                                            3143
*     DO;                           /*                       #Y30LB26*/
*       CALL ERREXIT;               /* SAVE RET              #Y30LB26*/
         BAL   @14,ERREXIT                                         3145
*       RETURN;                     /*                       #Y30LB26*/
@EL00051 DS    0H                                                  3146
@EF00051 DS    0H                                                  3146
@ER00051 L     @14,@SA00051                                        3146
         BR    @14                                                 3146
*     END;                          /*                       #Y30LB26*/
*                                                                  3147
*   /*****************************************************************/
*   /*                                                               */
*   /* SET UP ADDRESSABILITY TO INDEX RECORD                 #Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3148
*   INDEXPTR=ADDR(STORINDX);        /*                       #Y30LB26*/
@RF03143 LA    INDEXPTR,STORINDX                                   3148
*   INDRECKY=BASNAME;               /* PUT NEW OWNER IN      #Y30LB26*/
*                                                                  3149
         L     @06,BASEVPTR                                        3149
         MVC   INDRECKY(13,INDEXPTR),BASNAME(@06)                  3149
*   /*****************************************************************/
*   /*                                                               */
*   /* WRITE UPDATED INDEX RECORD                            #Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3150
*   RPLVTYP=RPLVPUT;                /* INDICATE PUT          #Y30LB26*/
         L     @02,RPLVPTR                                         3150
         MVI   RPLVTYP(@02),X'01'                                  3150
*   RESPECIFY                                                      3151
*     REG1 RSTD;                    /* RESTRICT REG 1        #Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR OF RPLV          #Y30LB26*/
         LR    REG1,@02                                            3152
*   CALL ICBVIO00;                  /* WRITE INDEX REC       #Y30LB26*/
         L     @15,@CV00671                                        3153
         BALR  @14,@15                                             3153
*   RESPECIFY                                                      3154
*     REG1 UNRSTD;                  /* FREE                  #Y30LB26*/
*   IF RPLVRETC^=RCZERO THEN        /* CK RETURN             #Y30LB26*/
         L     @02,RPLVPTR                                         3155
         CLC   RPLVRETC(2,@02),@CB00747                            3155
         BE    @RF03155                                            3155
*     DO;                           /*                       #Y30LB26*/
*       CALL ERREXIT;               /* SAVE RET CODES        #Y30LB26*/
         BAL   @14,ERREXIT                                         3157
*       RETURN;                     /*                       #Y30LB26*/
         B     @EL00051                                            3158
*     END;                          /*                       #Y30LB26*/
*                                                                  3159
*   /*****************************************************************/
*   /*                                                               */
*   /* IF NOT JOURNALED BEFORE THEN GO JOURNAL THE RPLV      #Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3160
*   IF JRNLEDSW=OFF THEN            /* JOURNALED BEFORE ?    #Y30LB26*/
@RF03155 TM    JRNLEDSW,B'00000001'                                3160
         BNZ   @RF03160                                            3160
*     DO;                           /*                       #Y30LB26*/
*       CALL JOURNAL;               /* JOURNAL RPLV          #Y30LB26*/
         BAL   @14,JOURNAL                                         3162
*       IF RPLVRETC^=RCZERO THEN    /* CK RETURN             #Y30LB26*/
         L     @02,RPLVPTR                                         3163
         CLC   RPLVRETC(2,@02),@CB00747                            3163
         BNE   @RT03163                                            3163
*         RETURN;                   /*                       #Y30LB26*/
*     END;                          /*                       #Y30LB26*/
*                                                                  3165
*   /*****************************************************************/
*   /*                                                               */
*   /* DO THE SAME THING WITH THE SECOND CARTRIDGE           #Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3166
*   CARTKY=DUPCSN2;                 /* GET CART SERIAL NO    #Y30LB26*/
@RF03160 L     @02,DUPVPTR                                         3166
         MVC   CARTKY(12),DUPCSN2(@02)                             3166
*   RPLVKEY=ADDR(IKEY);             /* ADDR OF KEY           #Y30LB26*/
         L     @02,RPLVPTR                                         3167
         LA    @15,IKEY                                            3167
         ST    @15,RPLVKEY(,@02)                                   3167
*   RPLVBUF=ADDR(STORINDX);         /* BUFFER ADDR           #Y30LB26*/
         LA    @15,STORINDX                                        3168
         ST    @15,RPLVBUF(,@02)                                   3168
*   RPLVBLN=LENGTH(STORINDX);       /* LENGTH BUFFER         #Y30LB26*/
         MVC   RPLVBLN(4,@02),@CF01147                             3169
*   RPLVDIR=ON;                     /* READ DIRECT           #Y30LB26*/
         OI    RPLVDIR(@02),B'01000000'                            3170
*   RPLVTYP=RPLVREAD;               /* READ RECORD           #Y30LB26*/
         MVI   RPLVTYP(@02),X'00'                                  3171
*   RPLVUPD=ON;                     /* FOR UPDATE            #Y30LB26*/
         OI    RPLVUPD(@02),B'00000010'                            3172
*   RESPECIFY                                                      3173
*     REG1 RSTD;                    /* RESTRICT              #Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR OF RPLV          #Y30LB26*/
         LR    REG1,@02                                            3174
*   CALL ICBVIO00;                  /* READ FIRST CART       #Y30LB26*/
         L     @15,@CV00671                                        3175
         BALR  @14,@15                                             3175
*   RESPECIFY                                                      3176
*     REG1 UNRSTD;                  /* FREE                  #Y30LB26*/
*   IF RPLVRETC^=RCZERO THEN        /* CK RETURN             #Y30LB26*/
         L     @02,RPLVPTR                                         3177
         CLC   RPLVRETC(2,@02),@CB00747                            3177
         BE    @RF03177                                            3177
*     DO;                           /*                       #Y30LB26*/
*       CALL ERREXIT;               /* SAVE RET              #Y30LB26*/
         BAL   @14,ERREXIT                                         3179
*       RETURN;                     /*                       #Y30LB26*/
         B     @EL00051                                            3180
*     END;                          /*                       #Y30LB26*/
*                                                                  3181
*   /*****************************************************************/
*   /*                                                               */
*   /* SET UP ADDRESSABILITY TO INDEX RECORD                 @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3182
*   INDEXPTR=ADDR(STORINDX);        /*                       @Y30LB26*/
@RF03177 LA    INDEXPTR,STORINDX                                   3182
*   INDRECKY=BASNAME;               /* PUT NEW OWNER IN      @Y30LB26*/
*                                                                  3183
         L     @06,BASEVPTR                                        3183
         MVC   INDRECKY(13,INDEXPTR),BASNAME(@06)                  3183
*   /*****************************************************************/
*   /*                                                               */
*   /* WRITE UPDATED INDEX RECORD                            @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3184
*   RPLVTYP=RPLVPUT;                /* INDICATE PUT          @Y30LB26*/
         L     @02,RPLVPTR                                         3184
         MVI   RPLVTYP(@02),X'01'                                  3184
*   RESPECIFY                                                      3185
*     REG1 RSTD;                    /* RESTRICT REG 1        @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR OF RPLV          @Y30LB26*/
         LR    REG1,@02                                            3186
*   CALL ICBVIO00;                  /* WRITE INDEX REC       @Y30LB26*/
         L     @15,@CV00671                                        3187
         BALR  @14,@15                                             3187
*   RESPECIFY                                                      3188
*     REG1 UNRSTD;                  /* FREE                  @Y30LB26*/
*   IF RPLVRETC^=RCZERO THEN        /* CK RETURN             #Y30LB26*/
         L     @02,RPLVPTR                                         3189
         CLC   RPLVRETC(2,@02),@CB00747                            3189
         BE    @RF03189                                            3189
*     DO;                           /*                       #Y30LB26*/
*       CALL ERREXIT;               /* SAVE RET CODES        #Y30LB26*/
         BAL   @14,ERREXIT                                         3191
*       RETURN;                     /*                       #Y30LB26*/
         B     @EL00051                                            3192
*     END;                          /*                       #Y30LB26*/
*                                                                  3193
*   /*****************************************************************/
*   /*                                                               */
*   /* SCRATCH THE DUPLICATE RECORD THAT WAS CONVERTED INTO  #Y30LB26*/
*   /* A BASE.                                               #Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3194
*   DKEY=DUPNAME;                   /* DUP KEY               #Y30LB26*/
@RF03189 L     @02,DUPVPTR                                         3194
         MVC   DKEY(13),DUPNAME(@02)                               3194
*   RPLVKEY=ADDR(DKEY);             /* ADDR OF KEY           #Y30LB26*/
         L     @02,RPLVPTR                                         3195
         LA    @15,DKEY                                            3195
         ST    @15,RPLVKEY(,@02)                                   3195
*   RPLVBUF=ADDR(DUMMYREC);         /* DUMMY BUFFER          #Y30LB26*/
         LA    @15,DUMMYREC                                        3196
         ST    @15,RPLVBUF(,@02)                                   3196
*   RPLVBLN=LENGTH(DUMMYREC);       /* LENGTH BUFFER         #Y30LB26*/
         MVC   RPLVBLN(4,@02),@CF01147                             3197
*   RPLVDIR=ON;                     /* READ DIRECT           #Y30LB26*/
         OI    RPLVDIR(@02),B'01000000'                            3198
*   RPLVTYP=RPLVREAD;               /* DO A READ             #Y30LB26*/
         MVI   RPLVTYP(@02),X'00'                                  3199
*   RPLVUPD=ON;                     /* READ FOR UPDATE       #Y30LB26*/
         OI    RPLVUPD(@02),B'00000010'                            3200
*   RESPECIFY                                                      3201
*     REG1 RSTD;                    /* RESTRICT              #Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR OF RPLV          #Y30LB26*/
         LR    REG1,@02                                            3202
*   CALL ICBVIO00;                  /* READ DUP RECORD       #Y30LB26*/
         L     @15,@CV00671                                        3203
         BALR  @14,@15                                             3203
*   RESPECIFY                                                      3204
*     REG1 UNRSTD;                  /* FREE                  #Y30LB26*/
*   IF RPLVRETC^=RCZERO THEN        /* CK RETURN             #Y30LB26*/
         L     @02,RPLVPTR                                         3205
         CLC   RPLVRETC(2,@02),@CB00747                            3205
         BE    @RF03205                                            3205
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* SAVE RET              @Y30LB26*/
         BAL   @14,ERREXIT                                         3207
*       RETURN;                     /*                       @Y30LB26*/
         B     @EL00051                                            3208
*     END;                          /*                       @Y30LB26*/
*                                                                  3209
*   /*****************************************************************/
*   /*                                                               */
*   /* NOW DELETE DUP RECORD                                 @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3210
*   RPLVTYP=RPLVDEL;                /* INDICATE DELETE       @Y30LB26*/
@RF03205 L     @02,RPLVPTR                                         3210
         MVI   RPLVTYP(@02),X'05'                                  3210
*   RESPECIFY                                                      3211
*     REG1 RSTD;                    /* RESTRICT              @Y30LB26*/
*   REG1=RPLVPTR;                   /* ADDR RPLV             @Y30LB26*/
         LR    REG1,@02                                            3212
*   CALL ICBVIO00;                  /* DELETE DUP RECORD     @Y30LB26*/
         L     @15,@CV00671                                        3213
         BALR  @14,@15                                             3213
*   RESPECIFY                                                      3214
*     REG1 UNRSTD;                  /* FREE                  @Y30LB26*/
*   IF RPLVRETC^=RCZERO THEN        /* CK RETURN             @Y30LB26*/
         L     @02,RPLVPTR                                         3215
         CLC   RPLVRETC(2,@02),@CB00747                            3215
         BE    @RF03215                                            3215
*     DO;                           /*                       @Y30LB26*/
*       CALL ERREXIT;               /* SAVE RET              #Y30LB26*/
         BAL   @14,ERREXIT                                         3217
*       RETURN;                     /*                       #Y30LB26*/
         B     @EL00051                                            3218
*     END;                          /*                       #Y30LB26*/
*                                                                  3219
*   /*****************************************************************/
*   /*                                                               */
*   /* IF NOT CHAINING INTO NON-GROUPED, SET REQUIRED        @Y30LB26*/
*   /* VALUES IN BASE VOL RECORD                             @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3220
*   IF DUPBCHI=OFF THEN             /* ALREADY NON-GROUPED   @Y30LB26*/
@RF03215 TM    DUPBCHI,B'10000000'                                 3220
         BNZ   @RF03220                                            3220
*     DO;                           /*                       @Y30LB26*/
*                                                                  3221
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK AND SET FIRST AND LAST BITS ON              @Y30LB26*/
*       /* IN NEW BASE VOL RECORD IF REQUIRED                @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  3222
*       IF FCHNDBR=ON THEN          /* WAS OLD BASE 1ST?     @Y30LB26*/
         TM    FCHNDBR,B'01000000'                                 3222
         BNO   @RF03222                                            3222
*         BASFIRST=ON;              /* INDICATE IT IS 1ST    @Y30LB26*/
         L     @02,BASEVPTR                                        3223
         OI    BASFIRST(@02),B'00010000'                           3223
*       IF LCHNDBR=ON THEN          /* LAST IN CHAIN ?       @Y30LB26*/
@RF03222 TM    LCHNDBR,B'00100000'                                 3224
         BNO   @RF03224                                            3224
*         BASLAST=ON;               /* INDICATE LAST         @Y30LB26*/
*                                                                  3225
         L     @02,BASEVPTR                                        3225
         OI    BASLAST(@02),B'00001000'                            3225
*       /*************************************************************/
*       /*                                                           */
*       /* SET FORWARD AND BACKWARD CHAIN POINTERS           @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  3226
*       BASPREV=SAVEPREV;           /* PUT IN PREV VOL       @Y30LB26*/
@RF03224 L     @02,BASEVPTR                                        3226
         MVC   BASPREV(6,@02),SAVEPREV                             3226
*       BASNEXTV=SAVENEXT;          /* PUT IN NEXT VOL       @Y30LB26*/
         MVC   BASNEXTV(6,@02),SAVENEXT                            3227
*     END;                          /*                       @Y30LB26*/
*                                                                  3228
*   /*****************************************************************/
*   /*                                                               */
*   /* SET GOOD RETURN CODES                                 @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3229
*   RPLVRETC=RCZERO;                /*                       @Y30LB26*/
@RF03220 L     @02,RPLVPTR                                         3229
         MVC   RPLVRETC(2,@02),@CB00747                            3229
*   RPLRCODE=RCZERO;                /*                       @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00747                            3230
*   RETURN;                         /*                       @Y301B26*/
         B     @EL00051                                            3231
*   END VUDBR;                      /*                       @Y30LB26*/
         B     @EL00051                                            3232
*                                                                  3233
*/*  START OF SPECIFICATIONS ****                                  3233
*                                                                  3233
*    PROCEDURE NAME - ICBVUEXT                                @Y30LB26
*                                                                  3233
*    FUNCTION - READS A GROUPED VOLUME SERIAL NUMBER EXTENSION RECORD
*    AND EITHER ADDS OR DELETES A SLOT FOR A GIVEN BASE VOLUME RECORD.
*    IT WILL ALSO UPDATE THE RETENTION PERIOD IN AN EXISTING SLOT. 3233
*    WHEN ADDING A SLOT, THE NEW SLOT ALWAYS GOES AT THE END OF THE
*    FIRST EXTENSION RECORD THAT IS NOT FULL.                      3233
*    IT TAKES INFORMATION FROM THE                                 3233
*    BASE VOLUME RECORD AND PUTS IT IN THE SLOT OF THE EXTENSION   3233
*    RECORD.  IF NO SLOT IS AVAILABLE, IT LOOKS FOR THE NEXT EXTENSION
*    RECORD.  IF ONE DOES NOT EXIST, IT CREATES THE NEXT ONE.  WHEN
*    DELETING A SLOT, ALL SLOTS ARE READ UNTIL ONE MATCHING THE    3233
*    VOLUME CONCERNED IS FOUND.  THE REMAINING SLOTS ARE THEN SHIFTED
*    ONE POSITION OVERLAYING THE DELETED SLOT.  THEN THE SLOT COUNT IN
*    THE HEADER SECTION OF THE GROUP EXTENSION RECORD IS DECREASED BY
*    ONE.  WHEN THE SLOT COUNT IN THE EXTENSION RECORD IS ZERO, THE
*    EXTENSION RECORD IS SCRATCHED AND IF IT WAS THE LAST          3233
*    EXTENSION RECORD FOR THAT PARTICULAR GROUP, THE PREVIOUS EXTENSION
*    RECORD IS UPDATED TO SHOW THAT IT IS THE LAST EXTENSION RECORD FOR
*    THAT GROUP. THE RECORD IS THEN EITHER WRITTEN TO OR DELETED FROM
*    THE MSVC DATA SET, DEPENDING ON THE SITUATION.  IF THERE ARE NO
*    GENERAL USE VOLUMES IN THE GROUP, THERE WILL BE NO GROUP EXTENSION
*    RECORDS.                                                 @Y30LB26
*                                                                  3233
*    WHEN CREATING A SLOT, IF THE VOLUME IS EITHER (1) MARKED      3233
*    MOUNTED TO ANY HOST OR IF (2) THE DOWN LEVEL SPACE FLAG IS    3233
*    ON, THE RUNNING COUNT FREE SPACE INVALID FLAG IS TURNED ON.   3233
*    IF THE VOLUME IS NEITHER (1) OR (2) AS ABOVE, THE TOTAL       3233
*    FREE SPACE FROM THE BASE VOLUME RECORD IS PUT INTO THE        3233
*    RUNNING COUNT FIELD OF THE GROUP EXTENSION RECORD, AND        3233
*    THE RUNNING COUNT FREE SPACE INVALID FLAG IS LEFT OFF.        3233
*                                                             @G24LB04
*      INPUTS - A PARAMETER LIST CONTAINING THE ADDRESS OF THE GROUP
*      RECORD, THE ADDRESS OF THE BASE RECORD, THE ADDRESS OF THE RPLV
*      AND FLAG BYTES TELLING IF A SLOT IS TO BE INSERTED OR DELETED,
*      OR IF ONLY THE EXPIRATION DATE IS TO BE CHANGED.       @Y30LB26
*                                                                  3233
*      OUTPUT - REASON AND CONDITION CODES RETURNED IN RPLV.  THE  3233
*      REASON CODES RETURNED ARE:                             @Y30LB26
*                                                                  3233
*      '021B'X  ERROR OCCURED BUT RPLV WAS JOURNALED.         @Y30LB26
*      '0202'X  SLOT TO BE DELETED COULD NOT BE FOUND.        @Y30LB26
*      PLUS I/O PROCESSOR AND THE JOURNAL REASON CODES.       @Y30LB26
**** END OF SPECIFICATIONS **                                        */
*                                                                  3233
*ICBVUEXT:                                                         3233
*   ENTRY(GRPEXT,BASEXT,RPLVEXT,FLAGEXT);/*                  #Y30LB26*/
@EP03233 MVC   @PC00001+24(16),0(@01)                              3233
*   DCL                                                            3234
*     GRPEXT PTR(31);               /* POINTER TO GROUP REC  #Y30LB26*/
*   DCL                                                            3235
*     BASEXT PTR(31);               /* POINTER TO BASE REC   #Y30LB26*/
*   DCL                                                            3236
*     RPLVEXT PTR(31);              /* POINTER TO RPLV       #Y30LB26*/
*   DCL                                                            3237
*     FLAGEXT BIT(16);              /* FLAG BYTE             @Y30LB26*/
*                                                                  3238
*   /*****************************************************************/
*   /*                                                               */
*   /* SET UP PARAMETERS PASSED TO THIS ROUTINE              @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3238
*   GROUPPTR=GRPEXT;                /* SET GROUP ADDRESS     @Y30LB26*/
         L     @02,@PC00001+24                                     3238
         L     @02,GRPEXT(,@02)                                    3238
         ST    @02,GROUPPTR                                        3238
*   BASEVPTR=BASEXT;                /* ADDRESS BASE REC      @Y30LB26*/
         L     @02,@PC00001+28                                     3239
         L     @02,BASEXT(,@02)                                    3239
         ST    @02,BASEVPTR                                        3239
*   RPLVPTR=RPLVEXT;                /* ADDR OF RPLV          @Y30LB26*/
         L     @02,@PC00001+32                                     3240
         L     @02,RPLVEXT(,@02)                                   3240
         ST    @02,RPLVPTR                                         3240
*   PASSFLAG=FLAGEXT;               /* FLAG BYTE             @Y30LB26*/
*                                                                  3241
         L     @02,@PC00001+36                                     3241
         MVC   PASSFLAG(2),FLAGEXT(@02)                            3241
*   /*****************************************************************/
*   /*                                                               */
*   /* CALL INTERNAL PROCEDURE TO GET EXTENSION RECORD       @Y30LB26*/
*   /* PROCESSED                                             @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3242
*   CALL VUEXT;                     /* CALL INTERNAL PROC    @Y30LB26*/
         BAL   @14,VUEXT                                           3242
*   RETURN;                         /*                       @Y30LB26*/
         B     @EL00001                                            3243
*                                                                  3244
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE VUEXT IS CODED SO THAT CODE CONTAINED IN    @Y30LB26*/
*   /* ENTRY ICBVUEXT CAN BE USED BY BOTH THIS MODULE AND BY @Y30LB26*/
*   /* OTHER MODULES                                         @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3244
*VUEXT:                                                            3244
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
VUEXT    ST    @14,@SA00052                                        3244
*   DCL                                                            3245
*     TWO FIXED(8) CONSTANT(2);     /* TWO                   @Y30LB26*/
*   GBLKKY=BLANK;                   /* SET KEY ID            @Y30LB26*/
         MVI   GBLKKY,C' '                                         3246
*   GIDKY=FIXZERO;                  /* INIT KEY ID           @Y30LB26*/
         MVI   GIDKY,X'00'                                         3247
*   LOOPSW=OFF;                     /* OFF BEFORE BEGIN LOOP @Y30LB26*/
*                                                                  3248
         NI    LOOPSW,B'01111111'                                  3248
*   /*****************************************************************/
*   /*                                                               */
*   /* SEE IF ADDING, DELETING SLOT OR UPDATING EXPIRATION   @Y30LB26*/
*   /* DATE. IF DELETING SLOT OR CHANGING EXPIRATION DATE,   @Y30LB26*/
*   /* GO TO SEPERATE SUBROUTINE                             @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3249
*   IF ADDSLEXT=OFFSLOTEXP=ON THEN /* DELETE SLOT?          @Y30LB26*/
         TM    ADDSLEXT,B'00000010'                                3249
         BZ    @RT03249                                            3249
         TM    SLOTEXP,B'10000000'                                 3249
         BNO   @RF03249                                            3249
@RT03249 DS    0H                                                  3250
*     DO;                           /*                       @Y30LB26*/
*       CALL DELETESL;              /* GO DELETE SLOT        @Y30LB26*/
         BAL   @14,DELETESL                                        3251
*       GIDKY=FIXZERO;              /* RESET KEY PROPERLY    @Y30LB26*/
         MVI   GIDKY,X'00'                                         3252
*       RETURN;                     /*                       @Y30LB26*/
@EL00052 DS    0H                                                  3253
@EF00052 DS    0H                                                  3253
@ER00052 L     @14,@SA00052                                        3253
         BR    @14                                                 3253
*     END;                          /*                       @Y30LB26*/
*                                                                  3254
*   /*****************************************************************/
*   /*                                                               */
*   /* BUILD KEY TO READ EXTENSION RECORD                    @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3255
*   GROUPKY=GROVVGRP;               /* GROUP                 @Y30LB26*/
@RF03249 L     @02,GROUPPTR                                        3255
         MVC   GROUPKY(8),GROVVGRP(@02)                            3255
*   GIDKY=GIDKY+FIXONE;             /* ADD TO KEY            @Y30LB26*/
*                                                                  3256
         LA    @02,1                                               3256
         SLR   @15,@15                                             3256
         IC    @15,GIDKY                                           3256
         ALR   @02,@15                                             3256
         STC   @02,GIDKY                                           3256
*   /*****************************************************************/
*   /*                                                               */
*   /* READ FOR GREATER OR EQUAL TO GET FIRST EXTENSION      @Y30LB26*/
*   /* KEEP LOOPING UNTIL AN EXTENSION RECORD IS FOUND       @Y30LB26*/
*   /* THAT IS NOT FULL, OR UNTIL ALL EXTENSION RECORDS      @Y30LB26*/
*   /* ARE READ                                              @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3257
*   DO WHILE I=I;                   /* FIND EXTEN NOT FULL   @Y30LB26*/
         B     @DE03257                                            3257
@DL03257 DS    0H                                                  3258
*     RPLVKEY=ADDR(GKEY);           /* ADDR GROUP EXT KEY    @Y30LB26*/
         L     @02,RPLVPTR                                         3258
         LA    @15,GKEY                                            3258
         ST    @15,RPLVKEY(,@02)                                   3258
*     RPLVBUF=ADDR(STORGPEX);       /* ADDR GROUP EXT BUF    @Y30LB26*/
         LA    @15,STORGPEX                                        3259
         ST    @15,RPLVBUF(,@02)                                   3259
*     RPLVBLN=LENGTH(STORGPEX);     /* LENGTH OF BUFFER      @Y30LB26*/
         MVC   RPLVBLN(4,@02),@CF01148                             3260
*     RPLVLOC=OFF;                  /* NOT LOCATE            @Y30LB26*/
*     RPLVDIR=ON;                   /* READ DIRECT           @Y30LB26*/
         OI    RPLVDIR(@02),B'01000000'                            3262
         NI    RPLVLOC(@02),B'01111111'                            3262
*     RPLVTYP=RPLVREAD;             /* READ RECORD           @Y30LB26*/
         MVI   RPLVTYP(@02),X'00'                                  3263
*     RPLVKGE=ON;                   /* READ GRTR THAN OR =   @Y30LB26*/
         OI    RPLVKGE(@02),B'00000100'                            3264
*     RPLVUPD=ON;                   /* FOR UPDATE            @Y30LB26*/
         OI    RPLVUPD(@02),B'00000010'                            3265
*     RESPECIFY                                                    3266
*       REG1 RSTD;                  /* RESTRICT REG 1        @Y30LB26*/
*     REG1=RPLVPTR;                 /* ADDR OF RPLV          @Y30LB26*/
         LR    REG1,@02                                            3267
*     CALL ICBVIO00;                /* READ EXTENSION RECORD @Y30LB26*/
         L     @15,@CV00671                                        3268
         BALR  @14,@15                                             3268
*     RESPECIFY                                                    3269
*       REG1 UNRSTD;                /* FREE REG 1            @Y30LB26*/
*     IF RPLVRETC^=RCZERO&RPLRCODE^=NORECRC THEN/* CK RET    @Y30LB26*/
         L     @02,RPLVPTR                                         3270
         CLC   RPLVRETC(2,@02),@CB00747                            3270
         BE    @RF03270                                            3270
         CLC   RPLRCODE(2,@02),@CB00789                            3270
         BNE   @RT03270                                            3270
*       RETURN;                     /*                       @VS32198*/
*     GVSNEPTR=ADDR(STORGPEX);      /* ADDRESSING TO RECORD  @Y30LB26*/
*                                                                  3272
@RF03270 LA    GVSNEPTR,STORGPEX                                   3272
*     /***************************************************************/
*     /*                                                             */
*     /* IF NOT PROPER GROUP THEN MUST BE NO EXTENSION RECORDS       */
*     /*                                                     @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  3273
*     IF GVSVVGRP^=GROUPKYRPLRCODE=NORECRC THEN/* RT EXT ?  @Y30LB26*/
*                                                                  3273
         CLC   GVSVVGRP(8,GVSNEPTR),GROUPKY                        3273
         BNE   @RT03273                                            3273
         L     @01,RPLVPTR                                         3273
         CLC   RPLRCODE(2,@01),@CB00789                            3273
         BNE   @RF03273                                            3273
@RT03273 DS    0H                                                  3274
*       /*************************************************************/
*       /*                                                           */
*       /* SHOULD BE NO EXTENSION RECORDS SO GO              @Y30LB26*/
*       /* CREATE A NEW ONE                                  @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  3274
*       DO;                         /*                       @Y30LB26*/
*         IF LOOPSW=ON THEN         /* FOUND RECORD BEFORE   @Y30LB26*/
         TM    LOOPSW,B'10000000'                                  3275
         BNO   @RF03275                                            3275
*           DO;                     /*                       @Y30LB26*/
*             GKEY=GVSNAME;         /* LATEST KEY            @Y30LB26*/
         MVC   GKEY(13),GVSNAME(GVSNEPTR)                          3277
*             GIDKY=GIDKY+FIXONE;   /* ADD ONE               @Y30LB26*/
         LA    @02,1                                               3278
         SLR   @15,@15                                             3278
         IC    @15,GIDKY                                           3278
         ALR   @02,@15                                             3278
         STC   @02,GIDKY                                           3278
*           END;                    /*                       @Y30LB26*/
*         ELSE                      /*                       @Y30LB26*/
*           GIDKY=FIXONE;           /* SET FOR NEXT          @Y30LB26*/
         B     @RC03275                                            3280
@RF03275 MVI   GIDKY,X'01'                                         3280
*         CALL NEWREC;              /* GO DO NEW REC         @Y30LB26*/
@RC03275 BAL   @14,NEWREC                                          3281
*         GIDKY=FIXZERO;            /* RESET KEY CORRECT ID  @Y30LB26*/
         MVI   GIDKY,X'00'                                         3282
*         RETURN;                   /*                       @Y30LB26*/
         B     @EL00052                                            3283
*       END;                        /*                       @Y30LB26*/
*     ELSE                          /*                       @Y30LB26*/
*                                                                  3285
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK TO SEE IF THERE ARE SLOTS LEFT IN RECORD    @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  3285
*       DO;                         /*                       @Y30LB26*/
@RF03273 DS    0H                                                  3286
*         LOOPSW=ON;                /* INDICATE REC FOUND    @Y30LB26*/
         OI    LOOPSW,B'10000000'                                  3286
*         IF GVSESIND>=GVSNSLOT+ONE THEN/* RECORD FULL?      @Y30LB26*/
*                                                                  3287
         LH    @15,GVSESIND(,GVSNEPTR)                             3287
         C     @15,@CF01150                                        3287
         BL    @RF03287                                            3287
*           /*********************************************************/
*           /*                                                       */
*           /* IF THERE ARE NO SLOTS LEFT IN RECORD,         @Y30LB26*/
*           /* SEE IF THIS RECORD IS THE LAST ONE. IF        @Y30LB26*/
*           /* IT IS, INDICATE THAT ITS NOT AND GO CREATE    @Y30LB26*/
*           /* ANOTHER EXTENSION RECORD                      @Y30LB26*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  3288
*           DO;                     /*                       @Y30LB26*/
*             IF GVSEX=OFF THEN     /* LAST EXTENSION?       @Y30LB26*/
         TM    GVSEX(GVSNEPTR),B'10000000'                         3289
         BNZ   @RF03289                                            3289
*               DO;                 /*                       @Y30LB26*/
*                 GVSEX=ON;         /* INDICATE NOT LAST     @Y30LB26*/
*                                                                  3291
         OI    GVSEX(GVSNEPTR),B'10000000'                         3291
*                 /***************************************************/
*                 /*                                                 */
*                 /* WRITE EXTENSION RECORD THAT WAS LAST    @Y30LB26*/
*                 /*                                                 */
*                 /***************************************************/
*                                                                  3292
*                 RPLVTYP=RPLVPUT;  /* PUT FULL EXTEN        @Y30LB26*/
         L     @15,RPLVPTR                                         3292
         MVI   RPLVTYP(@15),X'01'                                  3292
*                 RESPECIFY                                        3293
*                   REG1 RSTD;      /* RESTRICT REG 1        @Y30LB26*/
*                 REG1=RPLVPTR;     /* ADDR RPLV             @Y30LB26*/
         LR    REG1,@15                                            3294
*                 CALL ICBVIO00;    /* WRITE UPDATED EXT REC @Y30LB26*/
         L     @15,@CV00671                                        3295
         BALR  @14,@15                                             3295
*                 RESPECIFY                                        3296
*                   REG1 UNRSTD;    /* FREE REG 1            @Y30LB26*/
*                 IF RPLVRETC^=RCZERO THEN/* CHK RETURN      @Y30LB26*/
         L     @01,RPLVPTR                                         3297
         CLC   RPLVRETC(2,@01),@CB00747                            3297
         BNE   @RT03297                                            3297
*                   RETURN;         /*                       @Y30LB26*/
*                                                                  3298
*                 /***************************************************/
*                 /*                                                 */
*                 /* IF NOT JOURNALED BEFORE, JOURNAL IT NOW @Y30LB26*/
*                 /*                                                 */
*                 /***************************************************/
*                                                                  3299
*                 IF JRNLEDSW=OFF THEN/* JOURNALED BEFORE?   @Y30LB26*/
         TM    JRNLEDSW,B'00000001'                                3299
         BNZ   @RF03299                                            3299
*                   DO;             /*                       @Y30LB26*/
*                     CALL JOURNAL; /* JOURNAL RPLV          @Y30LB26*/
         BAL   @14,JOURNAL                                         3301
*                     IF RPLVRETC^=RCZERO THEN/*             @Y30LB26*/
         L     @01,RPLVPTR                                         3302
         CLC   RPLVRETC(2,@01),@CB00747                            3302
         BNE   @RT03302                                            3302
*                       RETURN;     /*                       @Y30LB26*/
*                   END;            /*                       @Y30LB26*/
*                                                                  3304
*                 /***************************************************/
*                 /*                                                 */
*                 /* SET UP KEY TO GO BUILD NEW EXTENSION    @Y30LB26*/
*                 /* RECORD                                  @Y30LB26*/
*                 /*                                                 */
*                 /***************************************************/
*                                                                  3305
*                 GKEY=GVSNAME;     /* GROUP NAME TO KEY     @Y30LB26*/
@RF03299 MVC   GKEY(13),GVSNAME(GVSNEPTR)                          3305
*                 GIDKY=GIDKY+FIXONE;/* ADD GET NEXT REC     @Y30LB26*/
         LA    @02,1                                               3306
         SLR   @15,@15                                             3306
         IC    @15,GIDKY                                           3306
         ALR   @02,@15                                             3306
         STC   @02,GIDKY                                           3306
*                 CALL NEWREC;      /* GO BUILD NEW RECORD   @Y30LB26*/
         BAL   @14,NEWREC                                          3307
*                 GIDKY=FIXZERO;    /* RESET KEY CORRECT ID  @Y30LB26*/
         MVI   GIDKY,X'00'                                         3308
*                 RETURN;           /*                       @Y30LB26*/
         B     @EL00052                                            3309
*               END;                /*                       @Y30LB26*/
*                                                                  3310
*             /*******************************************************/
*             /*                                                     */
*             /* EXTENSION RECORD WAS FULL, BUT IT WAS       @Y30LB26*/
*             /* NOT THE LAST ONE, SO SET UP KEY TO READ     @Y30LB26*/
*             /* NEXT EXTENSION AND LOOP BACK                @Y30LB26*/
*             /*                                                     */
*             /*******************************************************/
*                                                                  3311
*             ELSE                  /* NOT LAST EXTENISON    @Y30LB26*/
*               DO;                 /*                       @Y30LB26*/
@RF03289 DS    0H                                                  3312
*                 GKEY=GVSNAME;     /* SET UP KEY FOR NEXT   @Y30LB26*/
         MVC   GKEY(13),GVSNAME(GVSNEPTR)                          3312
*                 GIDKY=GIDKY+FIXONE;/* AND LOOP BACK        @Y30LB26*/
         LA    @02,1                                               3313
         SLR   @15,@15                                             3313
         IC    @15,GIDKY                                           3313
         ALR   @02,@15                                             3313
         STC   @02,GIDKY                                           3313
*               END;                /*                       @Y30LB26*/
*           END;                    /*                       @Y30LB26*/
*                                                                  3315
*         /***********************************************************/
*         /*                                                         */
*         /* SINCE EXTENSION RECORD IS NOT FULL, GO          @Y30LB26*/
*         /* BUILD A NEW SLOT IN THIS EXTENSION              @Y30LB26*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  3316
*         ELSE                      /* RECORD NOT FULL       @Y30LB26*/
*           DO;                     /* SO PUT IN NEW SLOT    @Y30LB26*/
         B     @RC03287                                            3316
@RF03287 DS    0H                                                  3317
*             CALL NEWSLOT;         /* GO MAKE A NEW SLOT    @Y30LB26*/
*                                                                  3317
         BAL   @14,NEWSLOT                                         3317
*             /*******************************************************/
*             /*                                                     */
*             /* WRITE UPDATED EXTENSION RECORD              @Y30LB26*/
*             /*                                                     */
*             /*******************************************************/
*                                                                  3318
*             RPLVTYP=RPLVPUT;      /* PUT EXTENSION REC     @Y30LB26*/
         L     @02,RPLVPTR                                         3318
         MVI   RPLVTYP(@02),X'01'                                  3318
*             RESPECIFY                                            3319
*               REG1 RSTD;          /* RESTRICT REG 1        @Y30LB26*/
*             REG1=RPLVPTR;         /* ADDR RPLV             @Y30LB26*/
         LR    REG1,@02                                            3320
*             CALL ICBVIO00;        /* WRITE EXTENSION REC   @Y30LB26*/
         L     @15,@CV00671                                        3321
         BALR  @14,@15                                             3321
*             RESPECIFY                                            3322
*               REG1 UNRSTD;        /* FREE REG 1            @Y30LB26*/
*             IF RPLVRETC^=RCZERO THEN/*                     @Y30LB26*/
         L     @02,RPLVPTR                                         3323
         CLC   RPLVRETC(2,@02),@CB00747                            3323
         BNE   @RT03323                                            3323
*               RETURN;             /*                       @Y30LB26*/
*                                                                  3324
*             /*******************************************************/
*             /*                                                     */
*             /* IF RPLV NEVER JOURNALED BEFORE, JOURNAL IT  @Y30LB26*/
*             /*                                                     */
*             /*******************************************************/
*                                                                  3325
*             IF JRNLEDSW=OFF THEN  /* JOURNALED BEFORE      @Y30LB26*/
         TM    JRNLEDSW,B'00000001'                                3325
         BNZ   @RF03325                                            3325
*               DO;                 /*                       @Y30LB26*/
*                 CALL JOURNAL;     /* JOURNALED RPLV        @Y30LB26*/
         BAL   @14,JOURNAL                                         3327
*                 IF RPLVRETC^=RCZERO THEN/*                 @Y30LB26*/
         L     @02,RPLVPTR                                         3328
         CLC   RPLVRETC(2,@02),@CB00747                            3328
         BNE   @RT03328                                            3328
*                   RETURN;         /*                       @Y30LB26*/
*               END;                /*                       @Y30LB26*/
*                                                                  3330
*             /*******************************************************/
*             /*                                                     */
*             /* RECORD WAS UPDATED OR CREATED SUCCESSFULLY  @Y30LB26*/
*             /*                                                     */
*             /*******************************************************/
*                                                                  3331
*             RPLVRETC=RCZERO;      /* GOOD RC               @Y30LB26*/
@RF03325 L     @02,RPLVPTR                                         3331
         MVC   RPLVRETC(2,@02),@CB00747                            3331
*             RPLRCODE=RCZERO;      /* GOOD REASON           @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00747                            3332
*             GIDKY=FIXZERO;        /* REST TO CORRECT ID    @Y30LB26*/
         MVI   GIDKY,X'00'                                         3333
*             RETURN;               /*                       @Y30LB26*/
         B     @EL00052                                            3334
*           END;                    /*                       @Y30LB26*/
*       END;                        /*                       @Y30LB26*/
@RC03287 DS    0H                                                  3337
*   END;                            /* END WHILE LOOP        @Y30LB26*/
@DE03257 CLC   I(1),I                                              3337
         BE    @DL03257                                            3337
*   END VUEXT;                      /*                       @Y30LB26*/
         B     @EL00052                                            3338
*                                                                  3339
*   /*****************************************************************/
*   /*                                                               */
*   /* THIS ROUTINE IS CALLED WHEN THERE ARE NO EXTENSION    @Y30LB26*/
*   /* RECORDS FOR A PARTICULAR GROUP OR ALL THE EXISTING    @Y30LB26*/
*   /* EXTENSION RECORDS ARE FULL. IT CREATES NEW EXTENSION  @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3339
*NEWREC:                                                           3339
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
*                                                                  3339
NEWREC   ST    @14,@SA00053                                        3339
*   /*****************************************************************/
*   /*                                                               */
*   /* BUILD ENOUGH OF THE EXTENSION RECORD TO CALL THE      @Y30LB26*/
*   /* NEW SLOT ROUTINE TO FILL IN SLOT                      @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3340
*   GVSNEPTR=ADDR(STORGPEX);        /* ADDR EXTEN BUFFER     @Y30LB26*/
         LA    GVSNEPTR,STORGPEX                                   3340
*   GVSHDR=GVSHDR&&GVSHDR;          /* ZERO HEADER SECTION   @Y30LB26*/
         XC    GVSHDR(28,GVSNEPTR),GVSHDR(GVSNEPTR)                3341
*   GVSNAME=GKEY;                   /* FILL IN KEY SECTION   @Y30LB26*/
         MVC   GVSNAME(13,GVSNEPTR),GKEY                           3342
*   GVSGVSEX=ON;                    /* INDICATE EXT REC      @Y30LB26*/
         OI    GVSGVSEX(GVSNEPTR),B'01000000'                      3343
*   GVSESIND=ONE;                   /* FIRST SLOT AVAILABLE  @Y30LB26*/
*                                                                  3344
         MVC   GVSESIND(2,GVSNEPTR),@CH00041                       3344
*   /*****************************************************************/
*   /*                                                               */
*   /* GO BUILD NEW SLOT FOR NEW EXTENSION RECORD            @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3345
*   CALL NEWSLOT;                   /* GO BUILD NEW SLOT     @Y30LB26*/
*                                                                  3345
         BAL   @14,NEWSLOT                                         3345
*   /*****************************************************************/
*   /*                                                               */
*   /* WRITE NEW EXTENSION RECORD                            @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3346
*   RPLVBUF=ADDR(STORGPEX);         /* ADDR OF BUFFER        @Y30LB26*/
         L     @02,RPLVPTR                                         3346
         LA    @15,STORGPEX                                        3346
         ST    @15,RPLVBUF(,@02)                                   3346
*   RPLVRLN=LENGTH(GVSNE);          /* RECORD LENGTH         @Y30LB26*/
         LA    @15,988                                             3347
         ST    @15,RPLVRLN(,@02)                                   3347
*   RPLVBLN=LENGTH(STORGPEX);       /* LENGTH BUFFER         @Y30LB26*/
         ST    @15,RPLVBLN(,@02)                                   3348
*   RPLVLOC=OFF;                    /* NO LOCATE             @Y30LB26*/
         NI    RPLVLOC(@02),B'01111111'                            3349
*   RPLVTYP=RPLVPUT;                /* PUT NEW EXT RECORD    @Y30LB26*/
         MVI   RPLVTYP(@02),X'01'                                  3350
*   RPLVUPD=OFF;                    /* NOT UPDATE            @Y30LB26*/
         NI    RPLVUPD(@02),B'11111101'                            3351
*   RESPECIFY                                                      3352
*     REG1 RSTD;                    /* RESTRICT REG 1        @Y301B26*/
*   REG1=RPLVPTR;                   /* ADDR RPLV             @Y301B26*/
         LR    REG1,@02                                            3353
*   CALL ICBVIO00;                  /* WRITE EXT RECORD      @Y301B26*/
         L     @15,@CV00671                                        3354
         BALR  @14,@15                                             3354
*   RESPECIFY                                                      3355
*     REG1 UNRSTD;                  /* FREE REG1             @Y301B26*/
*   IF RPLVRETC^=RCZERO THEN        /*                       @Y30LB26*/
         L     @02,RPLVPTR                                         3356
         CLC   RPLVRETC(2,@02),@CB00747                            3356
         BNE   @RT03356                                            3356
*     RETURN;                       /*                       @Y30LB26*/
*                                                                  3357
*   /*****************************************************************/
*   /*                                                               */
*   /* IF NEVER JOURNALED BEFORE, JOURNAL IT                 @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3358
*   IF JRNLEDSW=OFF THEN            /* JOURNALED BEFORE?     @Y301B26*/
         TM    JRNLEDSW,B'00000001'                                3358
         BNZ   @RF03358                                            3358
*     CALL JOURNAL;                 /* JOURNAL RPLV          @Y30LB26*/
         BAL   @14,JOURNAL                                         3359
*   RETURN;                         /*                       @Y301B26*/
@EL00053 DS    0H                                                  3360
@EF00053 DS    0H                                                  3360
@ER00053 L     @14,@SA00053                                        3360
         BR    @14                                                 3360
*   END NEWREC;                     /*                       @Y301B26*/
         B     @EL00053                                            3361
*                                                                  3362
*   /*****************************************************************/
*   /*                                                               */
*   /* THIS ROUTINE IS CALLED TO BUILD A NEW SLOT IN         @Y30LB26*/
*   /* AN EXISTING EXTENSION RECORD. IT TAKES INFORMATION    @Y30LB26*/
*   /* FROM THE BASE VOLUME RECORD TO FILL IN THE SLOT       @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3362
*NEWSLOT:                                                          3362
*   PROC(NOSAVE);                   /*                       @Y301B26*/
NEWSLOT  STM   @14,@12,12(@13)                                     3362
         MVC   @PC00054(4),0(@01)                                  3362
*   GVSSLOTS(GVSESIND)=             /* ZERO ENTIRE SLOT      @Y30LB26*/
*       GVSSLOTS(GVSESIND)&&GVSSLOTS(GVSESIND);/*            @Y30LB26*/
         LH    @15,GVSESIND(,GVSNEPTR)                             3363
         MH    @15,@CH01149                                        3363
         ST    @15,@TF00001                                        3363
         ALR   @15,GVSNEPTR                                        3363
         XC    GVSSLOTS-20(20,@15),GVSSLOTS-20(@15)                3363
*   GVSVOLID(GVSESIND)=BASSERNO;    /* VOLUME SERIAL NO.     @Y301B26*/
         LR    @01,GVSNEPTR                                        3364
         AL    @01,@TF00001                                        3364
         L     @15,BASEVPTR                                        3364
         MVC   GVSVOLID-20(6,@01),BASSERNO(@15)                    3364
*   GVSCPUBM(GVSESIND)=BASCPUID;    /* PUT IN CPU ASSOC MAP  @Y30LB26*/
         LR    @01,GVSNEPTR                                        3365
         AL    @01,@TF00001                                        3365
         MVC   GVSCPUBM-20(2,@01),BASCPUID(@15)                    3365
*   GVSFRESP(GVSESIND)=BASFRESP;    /* FREE CYLINDERS        @Y301B26*/
         LH    @14,BASFRESP(,@15)                                  3366
         N     @14,@CF01186                                        3366
         L     @01,@TF00001                                        3366
         STH   @14,GVSFRESP-20(@01,GVSNEPTR)                       3366
*   GVSLEXT(GVSESIND)=BASLEXT;      /* LARGEST FREE EXTENT   @Y301B26*/
         LH    @14,BASLEXT(,@15)                                   3367
         N     @14,@CF01186                                        3367
         L     @01,@TF00001                                        3367
         STH   @14,GVSLEXT-20(@01,GVSNEPTR)                        3367
*   GVSEXPDT(GVSESIND)=BASEXPDT;    /* EXPIRATION DATE       @Y301B26*/
         LR    @01,GVSNEPTR                                        3368
         AL    @01,@TF00001                                        3368
         MVC   GVSEXPDT-20(4,@01),BASEXPDT(@15)                    3368
*   IF BASCPUID^=BITZEROBASDLSF=ON /* IS VOL NOT MOUNTED OR @G24LB04
*                                      DOWN LEVEL FREE SPACE?      3369
*                                                            @G24LB04*/
*     THEN                                                         3369
         CLC   BASCPUID(2,@15),@CB00747                            3369
         BNE   @RT03369                                            3369
         TM    BASDLSF(@15),B'10000000'                            3369
         BNO   @RF03369                                            3369
@RT03369 DS    0H                                                  3370
*     GVSRCFSI(GVSESIND)=ON;        /* TURN ON RUNNING COUNT @G24LB04
*                                      FREE SPACE INVALID    @G24LB04*/
         LH    @15,GVSESIND(,GVSNEPTR)                             3370
         MH    @15,@CH01149                                        3370
         ALR   @15,GVSNEPTR                                        3370
         OI    GVSRCFSI-20(@15),B'10000000'                        3370
*   ELSE                            /*                       @G24LB04*/
*     GVSMTDSP(GVSESIND)=BASFRESP;  /* PUT IN TOTAL FREE     @G24LB04
*                                      SPACE                 @G24LB04*/
         B     @RC03369                                            3371
@RF03369 LH    @15,GVSESIND(,GVSNEPTR)                             3371
         MH    @15,@CH01149                                        3371
         L     @01,BASEVPTR                                        3371
         LH    @14,BASFRESP(,@01)                                  3371
         N     @14,@CF01186                                        3371
         STH   @14,GVSMTDSP-20(@15,GVSNEPTR)                       3371
*   GVSESIND=GVSESIND+ONE;          /* ADD FOR NEXT SLOT     #Y301B26*/
@RC03369 LA    @15,1                                               3372
         AH    @15,GVSESIND(,GVSNEPTR)                             3372
         STH   @15,GVSESIND(,GVSNEPTR)                             3372
*   RETURN;                         /*                       #Y301B26*/
@EL00054 DS    0H                                                  3373
@EF00054 DS    0H                                                  3373
@ER00054 LM    @14,@12,12(@13)                                     3373
         BR    @14                                                 3373
*   END NEWSLOT;                    /*                       @Y301B26*/
*                                                                  3375
*   /*****************************************************************/
*   /*                                                               */
*   /* THIS ROUTINE IS CALLED TO REMOVE A SLOT FROM A        @Y30LB26*/
*   /* GROUP EXTENSION RECORD. IT WILL ALSO UPDATE THE       @Y30LB26*/
*   /* EXPIRATION DATE IN AN EXISTING SLOT.                  @Y30LB26*/
*   /* IF THE SLOT REMOVED IS THE                            @Y30LB26*/
*   /* LAST SLOT IN RECORD, THE RECORD IS DELETED.           @Y30LB26*/
*   /* IF DELETED RECORD WAS THE LAST EXTENSION RECORD       @Y30LB26*/
*   /* AND THERE WAS A PREVIOUS EXTENSION, THE PREVIOUS      @Y30LB26*/
*   /* ONE IS READ AND A FLAG INDICATING IT IS THE LAST      @Y30LB26*/
*   /* IS TURNED ON.                                         @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3375
*DELETESL:                                                         3375
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
*                                                                  3375
DELETESL ST    @14,@SA00055                                        3375
*   /*****************************************************************/
*   /*                                                               */
*   /* SET GROUP NAME IN KEY AND INIT LOOP SWITCH            @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3376
*   GROUPKY=GROVVGRP;               /* GROUP NAME            @Y301B26*/
         L     @02,GROUPPTR                                        3376
         MVC   GROUPKY(8),GROVVGRP(@02)                            3376
*   LOOPSW=OFF;                     /* INIT LOOP SWITCH      @Y301B26*/
*                                                                  3377
         NI    LOOPSW,B'01111111'                                  3377
*   /*****************************************************************/
*   /*                                                               */
*   /* LOOP USED TO GO THRU EXTENSION RECORDS UNTIL RIGHT    @Y30LB26*/
*   /* SLOT IS LOCATED                                       @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3378
*   DO WHILE I=I;                   /* OUTSIDE WHILE         @Y301B26*/
         B     @DE03378                                            3378
@DL03378 DS    0H                                                  3379
*     GIDKY=GIDKY+FIXONE;           /* GET PAST GROUP        @Y301B26*/
         LA    @02,1                                               3379
         SLR   @15,@15                                             3379
         IC    @15,GIDKY                                           3379
         ALR   @02,@15                                             3379
         STC   @02,GIDKY                                           3379
*     RPLVKEY=ADDR(GKEY);           /* ADDR KEY              @Y301B26*/
         L     @02,RPLVPTR                                         3380
         LA    @15,GKEY                                            3380
         ST    @15,RPLVKEY(,@02)                                   3380
*     RPLVBUF=ADDR(STORGPEX);       /* ADDR BUFFER           @Y301B26*/
         LA    @15,STORGPEX                                        3381
         ST    @15,RPLVBUF(,@02)                                   3381
*     RPLVBLN=LENGTH(STORGPEX);     /* LENGTH OF BUFFER      @Y301B26*/
         MVC   RPLVBLN(4,@02),@CF01148                             3382
*     RPLVLOC=OFF;                  /* NO LOCATE             @Y301B26*/
*     RPLVDIR=ON;                   /* READ DIRECT           @Y301B26*/
         OI    RPLVDIR(@02),B'01000000'                            3384
         NI    RPLVLOC(@02),B'01111111'                            3384
*     RPLVTYP=RPLVREAD;             /* READ EXT REC          @Y301B26*/
         MVI   RPLVTYP(@02),X'00'                                  3385
*     RPLVKGE=ON;                   /* READ GT OR =          @Y301B26*/
         OI    RPLVKGE(@02),B'00000100'                            3386
*     RPLVUPD=ON;                   /* FOR UPDATE            @Y301B26*/
         OI    RPLVUPD(@02),B'00000010'                            3387
*     RESPECIFY                                                    3388
*       REG1 RSTD;                  /* RESTRICT REG1         @Y301B26*/
*     REG1=RPLVPTR;                 /* ADDR RPLV             @Y301B26*/
         LR    REG1,@02                                            3389
*     CALL ICBVIO00;                /* READ EXTENSION REC    @Y301B26*/
         L     @15,@CV00671                                        3390
         BALR  @14,@15                                             3390
*     RESPECIFY                                                    3391
*       REG1 UNRSTD;                /* FREE REG 1            @Y301B26*/
*     IF RPLVRETC^=RCZERO THEN      /* CH RETURN             @Y301B26*/
         L     @02,RPLVPTR                                         3392
         CLC   RPLVRETC(2,@02),@CB00747                            3392
         BNE   @RT03392                                            3392
*       RETURN;                     /*                       @Y301B26*/
*                                                                  3393
*     /***************************************************************/
*     /*                                                             */
*     /* GET ADDRESS OF RECORD JUST READ AND CHECK TO SEE    @Y30LB26*/
*     /* IF IT IS AN EXTENSION RECORD FOR THE CORRECT GROUP  @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  3394
*     GVSNEPTR=ADDR(STORGPEX);      /* ADDR OF RECORD READ   @Y301B26*/
         LA    GVSNEPTR,STORGPEX                                   3394
*     IF GVSVVGRP^=GROUPKYGVSGVSEX=OFF THEN/* STILL RT EXT  @Y30LB26*/
*                                                                  3395
         CLC   GVSVVGRP(8,GVSNEPTR),GROUPKY                        3395
         BNE   @RT03395                                            3395
         TM    GVSGVSEX(GVSNEPTR),B'01000000'                      3395
         BNZ   @RF03395                                            3395
@RT03395 DS    0H                                                  3396
*       /*************************************************************/
*       /*                                                           */
*       /* SINCE THERE ARE NO MORE EXTENSIONS FOR THIS       @Y30LB26*/
*       /* GROUP, SET REASON CODE INDICATING THAT SLOT       @Y30LB26*/
*       /* WAS NOT FOUND                                     @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  3396
*       DO;                         /*                       @Y301B26*/
*         RPLVRETC=FOUR;            /* BAD RETURN            @Y301B26*/
         L     @02,RPLVPTR                                         3397
         MVC   RPLVRETC(2,@02),@CB00749                            3397
*         RPLRCODE=NOSLTFND;        /* NO SLOT FOUND         @Y30LB26*/
         MVC   RPLRCODE(2,@02),@CB00835                            3398
*         RETURN;                   /*                       @Y301B26*/
@EL00055 DS    0H                                                  3399
@EF00055 DS    0H                                                  3399
@ER00055 L     @14,@SA00055                                        3399
         BR    @14                                                 3399
*       END;                        /*                       @Y301B26*/
*                                                                  3400
*     /***************************************************************/
*     /*                                                             */
*     /* LOOK FOR SLOT IN EXTENSION RECORD                   @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  3401
*     DO J=1 TO GVSESIND-1;         /* INSIDE WHILE          @Y30LB26*/
@RF03395 LA    @15,1                                               3401
         B     @DE03401                                            3401
@DL03401 DS    0H                                                  3402
*       IF GVSVOLID(J)=BASSERNO THEN/* RIGHT SLOT?           @Y301B26*/
         MH    @15,@CH01149                                        3402
         L     @14,BASEVPTR                                        3402
         ST    @15,@TF00001                                        3402
         ALR   @15,GVSNEPTR                                        3402
         CLC   GVSVOLID-20(6,@15),BASSERNO(@14)                    3402
         BNE   @RF03402                                            3402
*         DO;                       /*                       @Y301B26*/
*                                                                  3403
*           /*********************************************************/
*           /*                                                       */
*           /* CHECK TO SEE IF UPDATING THE RETENTION PERIOD @Y30LB26*/
*           /* IS ALL THAT IS REQUIRED                       @Y30LB26*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  3404
*           IF SLOTEXP=ON THEN      /* RETENTION ?           @Y30LB26*/
         TM    SLOTEXP,B'10000000'                                 3404
         BNO   @RF03404                                            3404
*             DO;                   /*                       @Y30LB26*/
*               GVSEXPDT(J)=BASEXPDT;/* UPDATE RET           @Y30LB26*/
*                                                                  3406
         LR    @01,GVSNEPTR                                        3406
         AL    @01,@TF00001                                        3406
         MVC   GVSEXPDT-20(4,@01),BASEXPDT(@14)                    3406
*               /*****************************************************/
*               /*                                                   */
*               /* WRITE UPDATED EXTENSION RECORD            @Y30LB26*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  3407
*               RPLVTYP=RPLVPUT;    /* WRITE RECORD          @Y30LB26*/
         L     @02,RPLVPTR                                         3407
         MVI   RPLVTYP(@02),X'01'                                  3407
*               RESPECIFY                                          3408
*                 REG1 RSTD;        /* RESTRICT REG 1        @Y30LB26*/
*               REG1=RPLVPTR;       /* ADDR RPLV             @Y30LB26*/
         LR    REG1,@02                                            3409
*               CALL ICBVIO00;      /* WRITE EXTENSION REC   @Y30LB26*/
         L     @15,@CV00671                                        3410
         BALR  @14,@15                                             3410
*               RESPECIFY                                          3411
*                 REG1 UNRSTD;      /* FREE                  @Y30LB26*/
*               IF RPLVRETC^=RCZERO THEN/* CHECK RETURN      @Y30LB26*/
         L     @02,RPLVPTR                                         3412
         CLC   RPLVRETC(2,@02),@CB00747                            3412
         BNE   @RT03412                                            3412
*                 RETURN;           /*                       @Y30LB26*/
*                                                                  3413
*               /*****************************************************/
*               /*                                                   */
*               /* IF RPLV HAS NOT BEEN JOURNALED YET,       @Y30LB26*/
*               /* JOURNAL IT                                @Y30LB26*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  3414
*               IF JRNLEDSW=OFF THEN/* IF NOT JOURNALED      @Y30LB26*/
         TM    JRNLEDSW,B'00000001'                                3414
         BNZ   @RF03414                                            3414
*                 CALL JOURNAL;     /* JOURNAL THE RPLV      @Y30LB26*/
         BAL   @14,JOURNAL                                         3415
*               RETURN;             /*                       @Y30LB26*/
         B     @EL00055                                            3416
*             END;                  /*                       @Y30LB26*/
*                                                                  3417
*           /*********************************************************/
*           /*                                                       */
*           /* SINCE FOUND SLOT, SEE IF IT IS THE ONLY       @Y30LB26*/
*           /* SLOT IN THAT EXTENSION RECORD                 @Y30LB26*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  3418
*           IF GVSESIND>TWO THEN    /*                       @Y30LB26*/
*                                                                  3418
@RF03404 LH    @15,GVSESIND(,GVSNEPTR)                             3418
         C     @15,@CF00058                                        3418
         BNH   @RF03418                                            3418
*             /*******************************************************/
*             /*                                                     */
*             /* IF MORE THAN ONE SLOT IN RECORD, SHIFT      @Y30LB26*/
*             /* LEFT OVER DELETED SLOT                      @Y30LB26*/
*             /*                                                     */
*             /*******************************************************/
*                                                                  3419
*             DO;                   /*                       @Y301B26*/
*               RESPECIFY                                          3420
*                (REG4,                                            3420
*                 REG5,                                            3420
*                 REG6,                                            3420
*                 REG7) RSTD;       /* RSTR                  @Y30LB26*/
*               REG4=ADDR(GVSVOLID(J));/* ADDR SLOT REMOVED  @Y301B26*/
         LA    @14,20                                              3421
         SLR   @01,@01                                             3421
         IC    @01,J                                               3421
         MR    @00,@14                                             3421
         LA    REG4,GVSVOLID-20(@01,GVSNEPTR)                      3421
*               REG6=ADDR(GVSVOLID(J+1));/* ADDR NEXT SLOT   @Y301B26*/
         LA    @01,GVSVOLID(@01,GVSNEPTR)                          3422
         LR    REG6,@01                                            3422
*               REG5=ADDR(GVSVOLID(GVSESIND))-/*             @Y30LB26*/
*                   ADDR(GVSVOLID(J+1));/* GET LENGTH FOR MOVE     3423
*                                                            @Y30LB26*/
         MR    @14,@14                                             3423
         LA    REG5,GVSVOLID-20(@15,GVSNEPTR)                      3423
         SLR   REG5,@01                                            3423
*               REG7=REG5;          /* LENGTH OF MOVE        @Y301B26*/
         LR    REG7,REG5                                           3424
*               GEN(MVCL REG4,REG6);/* SHIFT ONE SLOT TO LEFT      3425
*                                                            @Y301B26*/
         MVCL REG4,REG6
*               RESPECIFY                                          3426
*                (REG4,                                            3426
*                 REG5,                                            3426
*                 REG6,                                            3426
*                 REG7) UNRSTD;     /* FREE                  @Y30LB26*/
*                                                                  3426
*               /*****************************************************/
*               /*                                                   */
*               /* INDICATE ONE MORE SLOT IS AVAILABLE       @Y30LB26*/
*               /* IN RECORD                                 @Y30LB26*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  3427
*               GVSESIND=GVSESIND-ONE;/* DECREASE SLOT COUNT @Y301B26*/
*                                                                  3427
         LH    @15,GVSESIND(,GVSNEPTR)                             3427
         BCTR  @15,0                                               3427
         STH   @15,GVSESIND(,GVSNEPTR)                             3427
*               /*****************************************************/
*               /*                                                   */
*               /* WRITE UPDATED EXTENSION RECORD            @Y30LB26*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  3428
*               RPLVTYP=RPLVPUT;    /* WRITE RECORD          @Y301B26*/
         L     @02,RPLVPTR                                         3428
         MVI   RPLVTYP(@02),X'01'                                  3428
*               RESPECIFY                                          3429
*                 REG1 RSTD;        /* RESTRICT REG 1        @Y301B26*/
*               REG1=RPLVPTR;       /* ADDR RPLV             @Y301B26*/
         LR    REG1,@02                                            3430
*               CALL ICBVIO00;      /* WRITE EXTENSION REC   @Y301B26*/
         L     @15,@CV00671                                        3431
         BALR  @14,@15                                             3431
*               RESPECIFY                                          3432
*                 REG1 UNRSTD;      /* FREE                  @Y301B26*/
*               IF RPLVRETC^=RCZERO THEN/* CHECK RETURN      @Y301B26*/
         L     @02,RPLVPTR                                         3433
         CLC   RPLVRETC(2,@02),@CB00747                            3433
         BNE   @RT03433                                            3433
*                 RETURN;           /*                       @Y301B26*/
*                                                                  3434
*               /*****************************************************/
*               /*                                                   */
*               /* IF RPLV HAS NOT BEEN JOURNALED YET,       @Y30LB26*/
*               /* JOURNAL IT                                @Y30LB26*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  3435
*               IF JRNLEDSW=OFF THEN/* IF NOT JOURNALED      @Y301B26*/
         TM    JRNLEDSW,B'00000001'                                3435
         BNZ   @RF03435                                            3435
*                 CALL JOURNAL;     /* JOURNAL THE RPLV      @Y30LB26*/
         BAL   @14,JOURNAL                                         3436
*               RETURN;             /*                       @Y30LB26*/
         B     @EL00055                                            3437
*             END;                  /*                       @Y301B26*/
*                                                                  3438
*           /*********************************************************/
*           /*                                                       */
*           /* SINCE THE EXTENSION RECORD HAS ONLY ONE       @Y30LB26*/
*           /* SLOT IN IT AND IT IS TO BE REMOVED, JUST      @Y30LB26*/
*           /* DELETE ENTIRE RECORD                          @Y30LB26*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  3439
*           ELSE                    /* LAST SLOT IN RECORD   @Y301B26*/
*             DO;                   /* SO DELETE IT          @Y301B26*/
@RF03418 DS    0H                                                  3440
*               RPLVTYP=RPLVDEL;    /* INDICATE DELETE       @Y301B26*/
         L     @15,RPLVPTR                                         3440
         MVI   RPLVTYP(@15),X'05'                                  3440
*               RESPECIFY                                          3441
*                 REG1 RSTD;        /* RESTRICT REG 1        @Y301B26*/
*               REG1=RPLVPTR;       /* ADDR RPLV             @Y301B26*/
         LR    REG1,@15                                            3442
*               CALL ICBVIO00;      /* DELETE EXTENSION      @Y301B26*/
         L     @15,@CV00671                                        3443
         BALR  @14,@15                                             3443
*               RESPECIFY                                          3444
*                 REG1 UNRSTD;      /* FREE REG 1            @Y301B26*/
*               IF RPLVRETC^=RCZERO THEN/*                   @Y30LB26*/
         L     @01,RPLVPTR                                         3445
         CLC   RPLVRETC(2,@01),@CB00747                            3445
         BNE   @RT03445                                            3445
*                 RETURN;           /*                       @Y301B26*/
*                                                                  3446
*               /*****************************************************/
*               /*                                                   */
*               /* IF NOT PREVIOUSLY JOURNALED, JOURNAL      @Y30LB26*/
*               /* THE RPLV                                  @Y30LB26*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  3447
*               IF JRNLEDSW=OFF THEN/* IF NOT JOURNALED      @Y301B26*/
         TM    JRNLEDSW,B'00000001'                                3447
         BNZ   @RF03447                                            3447
*                 DO;               /*                       @Y301B26*/
*                   CALL JOURNAL;   /* JOURNAL RPLV          @Y301B26*/
         BAL   @14,JOURNAL                                         3449
*                   IF RPLVRETC^=RCZERO THEN/*               @Y30LB26*/
         L     @01,RPLVPTR                                         3450
         CLC   RPLVRETC(2,@01),@CB00747                            3450
         BNE   @RT03450                                            3450
*                     RETURN;       /*                       @Y301B26*/
*                 END;              /*                       @Y301B26*/
*                                                                  3452
*               /*****************************************************/
*               /*                                                   */
*               /* CHECK TO SEE IF DELETED RECORD WAS        @Y30LB26*/
*               /* THE LAST EXTENSION RECORD. IF IT WAS      @Y30LB26*/
*               /* READ THE PREVIOUS EXTENSION RECORD        @Y30LB26*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  3453
*               IF GVSEX=OFF&LOOPSW=ON THEN/* LAST EXT REC   @Y301B26*/
@RF03447 TM    GVSEX(GVSNEPTR),B'10000000'                         3453
         BNZ   @RF03453                                            3453
         TM    LOOPSW,B'10000000'                                  3453
         BNO   @RF03453                                            3453
*                 DO;               /* WITH PREV EXTENSIONS  @Y301B26*/
*                   RPLVKEY=ADDR(SAVEKEY);/* GET KEY PREV EXT      3455
*                                                            @Y301B26*/
         L     @02,RPLVPTR                                         3455
         LA    @15,SAVEKEY                                         3455
         ST    @15,RPLVKEY(,@02)                                   3455
*                   RPLVBUF=ADDR(STORGPEX);/* ADDR OF BUFFER @Y301B26*/
         LA    @15,STORGPEX                                        3456
         ST    @15,RPLVBUF(,@02)                                   3456
*                   RPLVBLN=LENGTH(STORGPEX);/* LENGTH BUFFER      3457
*                                                            @Y301B26*/
         MVC   RPLVBLN(4,@02),@CF01148                             3457
*                   RPLVLOC=OFF;    /*                       @Y301B26*/
*                   RPLVDIR=ON;     /* READ DIRECT           @Y301B26*/
         OI    RPLVDIR(@02),B'01000000'                            3459
         NI    RPLVLOC(@02),B'01111111'                            3459
*                   RPLVTYP=RPLVREAD;/* READ REC             @Y301B26*/
         MVI   RPLVTYP(@02),X'00'                                  3460
*                   RPLVKGE=OFF;    /* NO GT OR =            @Y301B26*/
         NI    RPLVKGE(@02),B'11111011'                            3461
*                   RPLVUPD=ON;     /* FOR UPDATE            @Y301B26*/
         OI    RPLVUPD(@02),B'00000010'                            3462
*                   RESPECIFY                                      3463
*                     REG1 RSTD;    /* RESTRICT              @Y301B26*/
*                   REG1=RPLVPTR;   /* ADDR RPLV             @Y301B26*/
         LR    REG1,@02                                            3464
*                   CALL ICBVIO00;  /* READ PREVIOUS EXTEN   @Y301B26*/
         L     @15,@CV00671                                        3465
         BALR  @14,@15                                             3465
*                   RESPECIFY                                      3466
*                     REG1 UNRSTD;  /* FREE REG 1            @Y301B26*/
*                   IF RPLVRETC^=RCZERO THEN/*               @Y30LB26*/
         L     @02,RPLVPTR                                         3467
         CLC   RPLVRETC(2,@02),@CB00747                            3467
         BNE   @RT03467                                            3467
*                     RETURN;       /*                       @Y301B26*/
*                   GVSNEPTR=ADDR(STORGPEX);/* ADDR REC READ @Y30LB26*/
*                                                                  3469
         LA    GVSNEPTR,STORGPEX                                   3469
*                   /*************************************************/
*                   /*                                               */
*                   /* SET FLAG INDICATING THAT THIS IS NOW  @Y30LB26*/
*                   /* THE LAST EXTENSION RECORD             @Y30LB26*/
*                   /*                                               */
*                   /*************************************************/
*                                                                  3470
*                   GVSEX=OFF;      /* INDICATE LAST EXT REC @Y301B26*/
*                                                                  3470
         NI    GVSEX(GVSNEPTR),B'01111111'                         3470
*                   /*************************************************/
*                   /*                                               */
*                   /* WRITE EXTENSION RECORD                @Y30LB26*/
*                   /*                                               */
*                   /*************************************************/
*                                                                  3471
*                   RPLVTYP=RPLVPUT;/* PUT RECORD            @Y301B26*/
         L     @02,RPLVPTR                                         3471
         MVI   RPLVTYP(@02),X'01'                                  3471
*                   RESPECIFY                                      3472
*                     REG1 RSTD;    /* RESTRICT              @Y301B26*/
*                   REG1=RPLVPTR;   /*                       @Y30LB26*/
         LR    REG1,@02                                            3473
*                   CALL ICBVIO00;  /* WRITE EXTENSION REC   @Y30LB26*/
         L     @15,@CV00671                                        3474
         BALR  @14,@15                                             3474
*                   RESPECIFY                                      3475
*                     REG1 UNRSTD;  /*                       @Y30LB26*/
*                   IF RPLVRETC^=RCZERO THEN/*               @Y30LB26*/
         L     @02,RPLVPTR                                         3476
         CLC   RPLVRETC(2,@02),@CB00747                            3476
         BNE   @RT03476                                            3476
*                     RETURN;       /*                       @Y301B26*/
*                 END;              /*                       @Y301B26*/
*               RETURN;             /*                       @Y30LB26*/
         B     @EL00055                                            3479
*             END;                  /*                       @Y301B26*/
*         END;                      /*                       @Y301B26*/
*     END;                          /* END INSIDE WHILE      @Y301B26*/
*                                                                  3482
@RF03402 LA    @15,1                                               3482
         SLR   @14,@14                                             3482
         IC    @14,J                                               3482
         ALR   @15,@14                                             3482
@DE03401 STC   @15,J                                               3482
         LH    @14,GVSESIND(,GVSNEPTR)                             3482
         BCTR  @14,0                                               3482
         CR    @15,@14                                             3482
         BNH   @DL03401                                            3482
*     /***************************************************************/
*     /*                                                             */
*     /* INDICATE AT LEAST ONE EXTENSION RECORD WAS FOUND    @Y30LB26*/
*     /* SO THAT IF THE LAST ONE IS DELETED, A PREVIOUS      @Y30LB26*/
*     /* READ CAN BE DONE                                    @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  3483
*     LOOPSW=ON;                    /* INDIC FND AT LEAST 1  @Y30LB26*/
         OI    LOOPSW,B'10000000'                                  3483
*     SAVEKEY=GVSNAME;              /* SAVE OLD KEY          @Y301B26*/
         MVC   SAVEKEY(13),GVSNAME(GVSNEPTR)                       3484
*     GKEY=GVSNAME;                 /* SET UP KEY FOR NEXT   @Y30LB26*/
         MVC   GKEY(13),GVSNAME(GVSNEPTR)                          3485
*   END;                            /* OUTSIDE WHILE LOOP    @Y30LB26*/
@DE03378 CLC   I(1),I                                              3486
         BE    @DL03378                                            3486
*   RETURN;                         /*                       @Y301B26*/
         B     @EL00055                                            3487
*   END DELETESL;                   /*                       @Y301B26*/
         B     @EL00055                                            3488
*                                                                  3489
*/*  START OF SPECIFICATIONS ****                                  3489
*                                                                  3489
*    PROCEDURE NAME - ICBVUEXP                                @Y30LB26
*                                                                  3489
*    FUNCTION - THE ROUTINE USES A FORMULA THAT DOES TAKE INTO ACCOUNT
*    LEAP YEAR WHEN CALCULATING THE JULIAN DATE.                   3489
*    IF A FOR DAYS OF 9999 IS PASSED TO THE ROUTINE, IT WILL       3489
*    RETURN AN EXPIRATION DATE OF 99365.  ALSO IF THE DAYS PASSED  3489
*    CALCULATES OUT TO A VALUE OVER 99365, THEN 99365 IS RETURNED. 3489
*                                                             @Y30LB26
*                                                                  3489
*      INPUT - A PARAMETER LIST WHICH CONTAINS THE NUMBER OF DAYS AHEAD
*      TO MAKE THE EXPIRATION DATE AND A SPACE FOR THE EXPIRATION DATE
*      TO BE RETURNED IN.                                     @Y30LB26
*                                                                  3489
*      OUTPUT - EXPIRATION DATE RETURNED IN THE PARAMETER LIST.    3489
*      THERE ARE NO REASON OR RETURN CODES FROM THIS PROGRAM. @Y30LB26
*                                                                  3489
**** END OF SPECIFICATIONS **                                        */
*                                                                  3489
*ICBVUEXP:                                                         3489
*   ENTRY(FOR,EXPDATE);             /*                       @Y30LB26*/
@EP03489 MVC   @PC00001+40(8),0(@01)                               3489
*   DCL                                                            3490
*     FOR FIXED(15);                /* NO DAYS TO EXPIRATION @Y30LB26*/
*   DCL                                                            3491
*     EXPDATE CHAR(4);              /* RTNTN DATE PACKED DEC @Y30LB26*/
*                                                                  3491
*   /*****************************************************************/
*   /*                                                               */
*   /* SET UP VALUE IN PROGRAM AS IT WAS PASSED              @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3492
*   FOREXP=FOR;                     /* DAYS TO EXPIRATION    @Y30LB26*/
*                                                                  3492
         L     @02,@PC00001+40                                     3492
         LH    FOREXP,FOR(,@02)                                    3492
*   /*****************************************************************/
*   /*                                                               */
*   /* CALL INTERNAL PROCEDURE AND SET VALUE TO BE PASSED    @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3493
*   CALL VUEXP;                     /* CALL INTER PROC       @Y30LB26*/
         BAL   @14,VUEXP                                           3493
*   EXPDATE=RETDATE;                /* EXPIRATION DATE       @Y30LB26*/
         L     @02,@PC00001+44                                     3494
         MVC   EXPDATE(4,@02),RETDATE                              3494
*   RETURN;                         /*                       @Y30LB26*/
         B     @EL00001                                            3495
*                                                                  3496
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE VUEXP IS CODED SO THAT CODE CONTAINED       @Y30LB26*/
*   /* IN ENTRY ICBVUEXP CAN BE USED BY BOTH THIS MODULE     @Y30LB26*/
*   /* AND BY OTHER MODULES                                  @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3496
*VUEXP:                                                            3496
*   PROC OPTIONS(SAVE(REG14));      /*                       @ZDR2053*/
VUEXP    ST    @14,@SA00056                                        3496
*   DCL                                                            3497
*     NRMYR FIXED(15) CONSTANT(365);/* NO DAYS YEAR          @Y30LB26*/
*   DCL                                                            3498
*     LEAPYR FIXED(15) CONSTANT(366);/* NO DAYS LEAP YEAR    @G24LB26*/
*   DCL                                                            3499
*     THOU FIXED(31) INIT(1000);    /* 1000                  @Y30LB26*/
*   DCL                                                            3500
*     DBLWORD CHAR(8) BDY(DWORD);   /* TWO WORDS             @Y30LB26*/
*   DCL                                                            3501
*     1 DATE,                                                      3501
*      2 DAY FIXED(15),             /* NO DAYS               @ZA13484*/
*      2 YEAR FIXED(15);            /* YEAR                  @ZA13484*/
*   RESPECIFY                                                      3502
*    (REG0,                                                        3502
*     REG1) RSTD;                   /* RESTRICT              @Y30LB26*/
*   MAXDATE='0099365C'X;            /* SET MAX DATE          @Y30LB26*/
*                                                                  3503
         MVC   MAXDATE(4),@CB00765                                 3503
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR RECOVERY REQUEST AND IF SO USE THE          @ZA13484*/
*   /* DATE THE RPLV WAS CREATED.                            @ZA13484*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3504
*   IF RPLJRCVY=ON&RPLVDATE^=NULLDATE THEN/* RECOVERY?       @ZA13484*/
         L     @07,RPLVPTR                                         3504
         TM    RPLJRCVY(@07),B'00000010'                           3504
         BNO   @RF03504                                            3504
         CLC   RPLVDATE(4,@07),NULLDATE                            3504
         BE    @RF03504                                            3504
*     DATE=RPLVDATE;                /* RPLV DATE             @ZA13484*/
         MVC   DATE(4),RPLVDATE(@07)                               3505
*   ELSE                                                           3506
*     DO;                           /*                       @ZA13484*/
*                                                                  3506
         B     @RC03504                                            3506
@RF03504 DS    0H                                                  3507
*       /*************************************************************/
*       /*                                                           */
*       /* GET THE CURRENT DATE BY ISSUING THE TIME MACRO    @Y30LB26*/
*       /* THEN CONVERT IT TO BINARY AND SEPERATE THE DAYS   @Y30LB26*/
*       /* AND YEARS                                         @Y30LB26*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  3507
*       GENERATE;                                                  3507
*                                                          /*@Y30LB26*/
         TIME DEC                   GET CURRENT DATE           @Y30LB26
         SR REG0,REG0               CLEAR REG0                 @Y30LB26
         ST REG0,DBLWORD            CLEAR 1ST HALF DBL         @Y30LB26
         ST REG1,DBLWORD+4          DATE TO SECOND HALF        @Y30LB26
         CVB REG1,DBLWORD           CONVERT TO BINARY          @Y30LB26
         D REG0,THOU                SEPERATE DAY & YEAR        @Y30LB26
         STH REG0,DAY               GET DAYS                   @Y30LB26
         STH REG1,YEAR              GET YEAR                   @Y30LB26
*     END;                          /*                       @ZA13484*/
*                                                                  3508
*   /*****************************************************************/
*   /*                                                               */
*   /* ADD THE FOR DAYS TO THE CURRENT DAYS                  @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3509
*   DAY=DAY+FOREXP;                 /* ADD FOR DAYS          @Y30LB26*/
@RC03504 LR    @07,FOREXP                                          3509
         AH    @07,DAY                                             3509
         STH   @07,DAY                                             3509
*   I=ZERO;                         /* INIT LOOP SWITCH      @Y30LB26*/
         MVI   I,X'00'                                             3510
*   DO WHILE I=ZERO;                /* OUTSIDE LOOP          @Y30LB26*/
*                                                                  3511
         B     @DE03511                                            3511
@DL03511 DS    0H                                                  3512
*     /***************************************************************/
*     /*                                                             */
*     /* DIVIDE BY FOUR AND CHECK THE REMAINDER TO SEE IF    @Y30LB26*/
*     /* IT IS A LEAP YEAR                                   @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  3512
*     IF YEAR//4=ZERO THEN          /* LEAP YEAR?            @Y30LB26*/
         LH    @04,YEAR                                            3512
         LR    @06,@04                                             3512
         SRDA  @06,32                                              3512
         D     @06,@CF00045                                        3512
         LTR   @06,@06                                             3512
         BNZ   @RF03512                                            3512
*       DO;                         /*                       @Y30LB26*/
*                                                                  3513
*         /***********************************************************/
*         /*                                                         */
*         /* IF LEAP YEAR, SEE IF MORE THAN 366 DAYS         @G24LB26*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  3514
*         IF DAY>LEAPYR THEN        /* ENOUGH MAKE A YR?     @ZA13056*/
*                                                                  3514
         LH    @02,DAY                                             3514
         LA    @15,366                                             3514
         CR    @02,@15                                             3514
         BNH   @RF03514                                            3514
*           /*********************************************************/
*           /*                                                       */
*           /* SUBTRACT 366 FROM DAYS AND ADD ONE YEAR,      @G24LB26*/
*           /* GO BACK TO START OF LOOP                      @Y30LB26*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  3515
*           DO;                     /*                       @Y30LB26*/
*             DAY=DAY-LEAPYR;       /* SUBTRACT 366          @G24LB26*/
         SLR   @02,@15                                             3516
         STH   @02,DAY                                             3516
*             YEAR=YEAR+1;          /* ADD YEAR              @Y30LB26*/
         AL    @04,@CF00041                                        3517
         STH   @04,YEAR                                            3517
*           END;                    /*                       @Y30LB26*/
*                                                                  3518
*         /***********************************************************/
*         /*                                                         */
*         /* OTHERWISE DROP OUT OF LOOP                      @Y30LB26*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  3519
*         ELSE                      /*                       @Y30LB26*/
*           I=1;                    /* GET OUT LOOP          @Y30LB26*/
         B     @RC03514                                            3519
@RF03514 MVI   I,X'01'                                             3519
*       END;                        /*                       @Y30LB26*/
*                                                                  3520
*     /***************************************************************/
*     /*                                                             */
*     /* IF IT IS NOT A LEAP YEAR, SEE IF THERE ARE 365 DAYS @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  3521
*     ELSE                          /*                       @Y30LB26*/
*       IF DAY>NRMYR THEN           /* ENOUGH FOR YEAR       @ZA13056*/
*                                                                  3521
         B     @RC03512                                            3521
@RF03512 LH    @04,DAY                                             3521
         LA    @02,365                                             3521
         CR    @04,@02                                             3521
         BNH   @RF03521                                            3521
*         /***********************************************************/
*         /*                                                         */
*         /* IF MORE THAN 365, SUBTRACT 365, ADD ONE         @Y30LB26*/
*         /* YEAR AND GO BACK TO START OF LOOP               @Y30LB26*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  3522
*         DO;                       /*                       @Y30LB26*/
*           DAY=DAY-NRMYR;          /* SUBTRACT 365          @Y30LB26*/
         SLR   @04,@02                                             3523
         STH   @04,DAY                                             3523
*           YEAR=YEAR+1;            /* ADD TO YEAR           @Y30LB26*/
         LA    @04,1                                               3524
         AH    @04,YEAR                                            3524
         STH   @04,YEAR                                            3524
*         END;                      /*                       @Y30LB26*/
*                                                                  3525
*     /***************************************************************/
*     /*                                                             */
*     /* IF NOT 365 DAYS, DROP OUT OF LOOP                   @Y30LB26*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  3526
*       ELSE                        /*                       @Y30LB26*/
*         I=1;                      /* GET OUT OF LOOP       @Y30LB26*/
         B     @RC03521                                            3526
@RF03521 MVI   I,X'01'                                             3526
*   END;                            /* END WHILE LOOP        @Y30LB26*/
*                                                                  3527
@RC03521 DS    0H                                                  3527
@RC03512 DS    0H                                                  3527
@DE03511 CLI   I,0                                                 3527
         BE    @DL03511                                            3527
*   /*****************************************************************/
*   /*                                                               */
*   /* MULT YEARS BY 1000 AND ADD DAYS TO GET YEARS AND      @Y30LB26*/
*   /* DAYS BACK TOGATHER AGAIN. THEN CONVERT TO DECIMAL     @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3528
*   REG1=YEAR*THOU;                 /* MULT                  @Y30LB26*/
         L     REG1,THOU                                           3528
         MH    REG1,YEAR                                           3528
*   REG1=REG1+DAY;                  /* GET WHOLE DATE        @Y30LB26*/
         AH    REG1,DAY                                            3529
*   GEN(CVD REG1,DBLWORD);          /* CONVERT TO DEC        @Y30LB26*/
*                                                                  3530
         CVD REG1,DBLWORD
*   /*****************************************************************/
*   /*                                                               */
*   /* MOVE NEW DATE INTO RETURN PARAMETER                   @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3531
*   RETDATE=DBLWORD(5:8);           /* GET DATE              @Y30LB26*/
         MVC   RETDATE(4),DBLWORD+4                                3531
*   RESPECIFY                                                      3532
*    (REG0,                                                        3532
*     REG1) UNRSTD;                 /* FREE REGS             @Y30LB26*/
*                                                                  3532
*   /*****************************************************************/
*   /*                                                               */
*   /* IF CALCULATED DATE IS OVER THE MAX ALLOWED DATE,      @Y30LB26*/
*   /* THEN PUT IN THE MAXIMUM DATE                          @Y30LB26*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  3533
*   IF RETDATE>MAXDATE THEN         /* SEE IF TOO BIG        @Y30LB26*/
         CLC   RETDATE(4),MAXDATE                                  3533
         BNH   @RF03533                                            3533
*     RETDATE=MAXDATE;              /* SET MAX DATE          @Y30LB26*/
         MVC   RETDATE(4),MAXDATE                                  3534
*   RETURN;                         /*                       @Y30LB26*/
@EL00056 DS    0H                                                  3535
@EF00056 DS    0H                                                  3535
@ER00056 L     @14,@SA00056                                        3535
         BR    @14                                                 3535
*   END VUEXP;                      /*                       @Y30LB26*/
         B     @EL00056                                            3536
*   END ICBVUT01                    /*                       @Y30LB26*/
*                                                                  3537
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.     */
*/*%INCLUDE SYSLIB  (IEZRPLV )                                       */
*/*%INCLUDE SYSLIB  (IEZVVICB)                                       */
*/*%INCLUDE SYSLIB  (IEZNGVR )                                       */
*/*%INCLUDE SYSLIB  (IEZBCDV )                                       */
*/*%INCLUDE SYSLIB  (IEZGROUP)                                       */
*/*%INCLUDE SYSLIB  (IEZGVSNE)                                       */
*/*%INCLUDE SYSLIB  (IEZBASEV)                                       */
*/*%INCLUDE SYSLIB  (IEZCOPYV)                                       */
*/*%INCLUDE SYSLIB  (IEZDUPV )                                       */
*/*%INCLUDE SYSLIB  (IEZINDEX)                                       */
*/*%INCLUDE SYSLIB  (IEZCPUID)                                       */
*/*%INCLUDE SYSLIB  (IEZRVR  )                                       */
*/*%INCLUDE SYSLIB  (IEZMGP  )                                       */
*/*%INCLUDE SYSLIB  (IEZSGP  )                                       */
*/*%INCLUDE SYSLIB  (IEZRVVI )                                       */
*/*%INCLUDE SYSLIB  (IEZMVR  )                                       */
*                                                                  3537
*       ;                                                          3537
         B     @EL00001                                            3537
@DATA    DS    0H
@CH01149 DC    H'20'
@CH00688 DC    H'256'
@CH00890 DC    H'404'
@SC01176 CLC   MGPGROUP(0,@07),0(@15)
         DS    0F
@AL00733 EQU   *                       LIST WITH   4 ARGUMENT(S)
@AL00753 EQU   *                       LIST WITH   4 ARGUMENT(S)
@AL02719 EQU   *                       LIST WITH   4 ARGUMENT(S)
@AL02729 DC    A(@CF00039)             LIST WITH   4 ARGUMENT(S)
         DC    A(BASEVPTR)
         DC    A(RPLVPTR)
         DC    A(PASSFLAG)
@AL00845 EQU   *                       LIST WITH   4 ARGUMENT(S)
@AL02585 EQU   *                       LIST WITH   4 ARGUMENT(S)
@AL02681 DC    A(GROUPPTR)             LIST WITH   4 ARGUMENT(S)
         DC    A(BASEVPTR)
         DC    A(RPLVPTR)
         DC    A(PASSFLAG)
@AL02577 EQU   *                       LIST WITH   3 ARGUMENT(S)
@AL02665 EQU   *                       LIST WITH   3 ARGUMENT(S)
@AL02764 EQU   *                       LIST WITH   3 ARGUMENT(S)
@AL02852 DC    A(GROUPPTR)             LIST WITH   3 ARGUMENT(S)
         DC    A(BASEVPTR)
         DC    A(PASSFLAG)
         DS    0F
@SA00001 DS    18F
@PC00001 DS    12F
@SA00008 DS    1F
@SA00002 DS    1F
@SA00004 DS    18F
@SA00007 DS    1F
@SA00038 DS    1F
@SA00015 DS    1F
@SA00003 DS    1F
@SA00005 DS    1F
@SA00006 DS    1F
@SA00052 DS    1F
@SA00009 DS    1F
@SA00012 DS    1F
@SA00010 DS    1F
@SA00011 DS    1F
@SA00051 DS    1F
@SA00014 DS    1F
@SA00013 DS    1F
@SA00017 DS    1F
@SA00018 DS    1F
@SA00019 DS    1F
@SA00021 DS    1F
@SA00022 DS    1F
@SA00023 DS    1F
@SA00029 DS    1F
@SA00030 DS    1F
@SA00031 DS    1F
@SA00033 DS    1F
@SA00032 DS    1F
@SA00016 DS    1F
@SA00036 DS    1F
@SA00037 DS    1F
@SA00020 DS    1F
@SA00024 DS    1F
@SA00025 DS    1F
@SA00028 DS    1F
@SA00026 DS    1F
@SA00027 DS    1F
@SA00034 DS    1F
@SA00056 DS    1F
@SA00039 DS    1F
@SA00046 DS    1F
@SA00040 DS    1F
@SA00042 DS    1F
@SA00041 DS    1F
@SA00047 DS    1F
@SA00043 DS    1F
@SA00045 DS    1F
@SA00044 DS    1F
@SA00055 DS    1F
@SA00053 DS    1F
@PC00054 DS    1F
@SA00035 DS    0F
@SA00048 DS    0F
@SA00050 DS    0F
@SA00049 DS    0F
         DS    1F
@TF00001 DS    F
         DS    0F
@CF00039 DC    F'0'
@CF00041 DC    F'1'
@CH00041 EQU   @CF00041+2
@CF00058 DC    F'2'
@CF00045 DC    F'4'
@CF00036 DC    F'8'
@CF01150 DC    F'49'
@CF00892 DC    F'100'
@CF01146 DC    F'164'
@CF01147 DC    F'224'
@CF01148 DC    F'988'
@CF01186 DC    XL4'0000FFFF'
@CV00671 DC    V(ICBVIO00)
@CV00672 DC    V(ICBVJL00)
@CV00673 DC    V(ICBVRR00)
@CV00674 DC    V(ICBVUCHI)
@CV00675 DC    V(ICBVUCHO)
@CV00676 DC    V(ICBVUPGH)
         DS    0D
RPLVPTR  DS    A
GROUPPTR DS    A
BASEVPTR DS    A
COPYVPTR DS    A
DUPVPTR  DS    A
RVRPTR   DS    A
MVRPTR   DS    A
FIXF     DC    XL4'FFFFFFFF'
THOU     DC    F'1000'
RVRLEN   DC    AL2(24)
MGPLEN   DC    AL2(104)
SGPLEN   DC    AL2(20)
RVVLEN   DC    AL2(68)
MVRLEN   DC    AL2(88)
LIBTEST  DC    XL1'FF'
I        DS    FL1
J        DS    FL1
@CB00765 DC    X'0099365C'
@CB00747 DC    X'0000'
@CB00749 DC    X'0004'
@CB00785 DC    X'0213'
@CB00787 DC    X'0214'
@CB00789 DC    X'0208'
@CB00793 DC    X'0217'
@CB00795 DC    X'0218'
@CB00797 DC    X'0219'
@CB00799 DC    X'021A'
@CB00801 DC    X'0229'
@CB00803 DC    X'0201'
@CB00805 DC    X'021C'
@CB00807 DC    X'021D'
@CB00809 DC    X'021E'
@CB00811 DC    X'021F'
@CB00813 DC    X'0220'
@CB00815 DC    X'0221'
@CB00817 DC    X'0222'
@CB00819 DC    X'0223'
@CB00821 DC    X'0224'
@CB00823 DC    X'0225'
@CB00825 DC    X'0227'
@CB00827 DC    X'0228'
@CB00829 DC    X'0226'
@CB00831 DC    X'022A'
@CB00833 DC    X'0230'
@CB00835 DC    X'0202'
@CB00839 DC    X'0205'
@CB00841 DC    X'023C'
REACODE  DS    CL2
RETCODE  DS    CL2
STORBASE DS    CL224
STORGRP  DS    CL224
STORDUP  DS    CL224
STORINDX DS    CL224
STORCPY  DS    CL224
DUMMYREC DS    CL224
DUMGVSNE DS    CL988
BASEREC  DS    CL224
STORGPEX DS    CL988
SAVEKEY  DS    CL13
GKEY     DS    CL13
         ORG   GKEY
GKY      DC    CL3'G  '
GROUPKY  DS    CL8
GBLKKY   DC    CL1' '
GIDKY    DC    XL1'00'
         ORG   GKEY+13
VKEY     DS    CL13
         ORG   VKEY
VKY      DC    CL5'V    '
VOLKY    DS    CL6
VBLKKY   DC    CL1' '
VIDKY    DC    XL1'00'
         ORG   VKEY+13
DKEY     DS    CL13
         ORG   DKEY
DKY      DC    CL5'D    '
DVOLKY   DS    CL6
DBLKKY   DC    CL1' '
DIDKY    DC    XL1'00'
         ORG   DKEY+13
IKEY     DS    CL13
         ORG   IKEY
IKY      DC    CL1'I'
CARTKY   DS    CL12
         ORG   IKEY+13
NGHEADER DC    CL13'N   HEADER   '
CKEY     DC    CL13'C  CPU ID    '
PASSFLAG DS    BL2
         ORG   PASSFLAG
DUPBCHI  DS    BL1
FCHNDBR  EQU   PASSFLAG+0
LCHNDBR  EQU   PASSFLAG+0
CHICHOGP EQU   PASSFLAG+0
ADDGRP   EQU   PASSFLAG+0
RESV     EQU   PASSFLAG+0
ADDSLEXT EQU   PASSFLAG+0
JRNLEDSW EQU   PASSFLAG+0
SLOTEXP  DS    BL1
         ORG   PASSFLAG+2
INTERFLG DS    BL1
         ORG   INTERFLG
LOOPSW   DS    BL1
BKUPFND  EQU   INTERFLG+0
BACKUPFL EQU   INTERFLG+0
DUPFNDFL EQU   INTERFLG+0
EXITVVIC EQU   INTERFLG+0
EXITVJL  EQU   INTERFLG+0
REL3CONF EQU   INTERFLG+0
         ORG   INTERFLG+1
SAVEPREV DS    CL6
SAVENEXT DS    CL6
RETDATE  DS    CL4
NULEXPDT DC    X'FFFFFFFF'
NULLDATE DC    X'00000000'
MAXDATE  DC    X'0099365C'
BLANK8   DC    CL8'        '
ZEROCHAR DC    X'000000000000000000000000'
SYSGROUP DC    CL8'SYSGROUP'
         DS    CL1
ARITHBAS DS    CL2
         ORG   ARITHBAS
BASEID   DS    FL2
         ORG   ARITHBAS+2
ARITHGRP DS    CL2
         ORG   ARITHGRP
GRPID    DS    FL2
         ORG   ARITHGRP+2
ARITHCTG DS    CL1
         ORG   ARITHCTG
CARTID   DS    FL1
         ORG   ARITHCTG+1
UT1PATCH DS    CL200
         ORG   UT1PATCH
@NM00051 DC    200X'00'
         ORG   UT1PATCH+200
TEST1    DS    CL256
         ORG   TEST1
TESTINIT DC    64X'01'
         DC    X'00'
         DC    26X'01'
         DC    X'00'
         DC    31X'01'
         DC    2X'00'
         DC    68X'01'
         DC    9X'00'
         DC    7X'01'
         DC    9X'00'
         DC    8X'01'
         DC    8X'00'
         DC    6X'01'
         DC    10X'00'
         DC    6X'01'
         ORG   TEST1+256
EXPIR    DS    CL4
         DS    CL5
DBLWORD  DS    CL8
DATE     DS    CL4
         ORG   DATE
DAY      DS    FL2
YEAR     DS    FL2
         ORG   DATE+4
@00      EQU   00                      EQUATES FOR REGISTERS 0-15
@01      EQU   01
@02      EQU   02
@03      EQU   03
@04      EQU   04
@05      EQU   05
@06      EQU   06
@07      EQU   07
@08      EQU   08
@09      EQU   09
@10      EQU   10
@11      EQU   11
@12      EQU   12
@13      EQU   13
@14      EQU   14
@15      EQU   15
IS       EQU   @04
COUNT    EQU   @06
FOREXP   EQU   @06
RVVIPTR  EQU   @05
SGPPTR   EQU   @05
MGPPTR   EQU   @06
CPUIDPTR EQU   @04
INDEXPTR EQU   @07
GVSNEPTR EQU   @02
BCDVPTR  EQU   @05
NGVRPTR  EQU   @04
VVIPTR   EQU   @04
REG0     EQU   @00
REG1     EQU   @01
REG2     EQU   @02
REG4     EQU   @04
REG5     EQU   @05
REG6     EQU   @06
REG7     EQU   @07
REG14    EQU   @14
REG15    EQU   @15
RPLV     EQU   0
RPLTCBPR EQU   RPLV+8
RPLVVICB EQU   RPLV+12
RPLFLAGA EQU   RPLV+28
RPLJRCVY EQU   RPLFLAGA
RPLVJRNL EQU   RPLFLAGA
RPLRCODE EQU   RPLV+32
RPLVRETC EQU   RPLV+34
RPLVDATE EQU   RPLV+38
RPLVSAM  EQU   RPLV+56
RPLVTYP  EQU   RPLVSAM+2
RPLVBUF  EQU   RPLVSAM+32
RPLVKEY  EQU   RPLVSAM+36
RPLVOPT  EQU   RPLVSAM+40
RPLVLOC  EQU   RPLVOPT
RPLVDIR  EQU   RPLVOPT
RPLVNEXT EQU   RPLVOPT
RPLVKGE  EQU   RPLVOPT
RPLVUPD  EQU   RPLVOPT+1
RPLVRLN  EQU   RPLVSAM+48
RPLVBLN  EQU   RPLVSAM+52
RPLVUTIL EQU   RPLV+132
VVICB    EQU   0
VVIFLGA  EQU   VVICB+15
VVIFLG0  EQU   VVIFLGA
VVIFLG2  EQU   VVIFLGA
NGVR     EQU   0
NGVRTYPE EQU   NGVR+13
NGVFVOL  EQU   NGVR+17
NGVNOVOL EQU   NGVR+30
BCDV     EQU   0
BCDNAME  EQU   BCDV
BCDPREFX EQU   BCDNAME
BCDID    EQU   BCDNAME+11
BCDFLAGA EQU   BCDV+14
BCDTYPE  EQU   BCDFLAGA
BCDFLAGB EQU   BCDFLAGA+2
BCDRCVYF EQU   BCDV+20
BCDSATIA EQU   BCDRCVYF
BCDMISCF EQU   BCDRCVYF+2
BCDHOLD  EQU   BCDMISCF
BCDCSN1  EQU   BCDV+24
BCDLIB1  EQU   BCDV+36
BCDLID1  EQU   BCDLIB1
BCDCSN2  EQU   BCDV+37
BCDLIB2  EQU   BCDV+49
BCDLID2  EQU   BCDLIB2
GROUP    EQU   0
GRONAME  EQU   GROUP
GROG     EQU   GRONAME
GROVVGRP EQU   GRONAME+3
GROID    EQU   GRONAME+11
GROZERO  EQU   GROID+1
GROFLAGA EQU   GROUP+13
GROTYPE  EQU   GROFLAGA
GROGVR   EQU   GROTYPE
GROBIND  EQU   GROFLAGA+2
GROEXCL  EQU   GROFLAGA+2
GRODAERA EQU   GROFLAGA+2
GRORONLY EQU   GROFLAGA+2
GRORLSE  EQU   GROFLAGA+2
GRORETN  EQU   GROFLAGA+2
GROFSN   EQU   GROUP+17
GROLSN   EQU   GROUP+23
GROPCENT EQU   GROUP+29
GRONGEN  EQU   GROUP+30
GRONRSTD EQU   GROUP+32
GRONINAC EQU   GROUP+34
GROPSPD  EQU   GROUP+36
GROSSPD  EQU   GROUP+38
GROSTRSH EQU   GROUP+40
GROFRESP EQU   GROUP+44
GRORETPD EQU   GROUP+52
GROERRTS EQU   GROUP+56
GRODESCR EQU   GROUP+64
GROCONUS EQU   GROUP+94
GRORESSP EQU   GROUP+95
GROOWNER EQU   GROUP+96
GROADDR  EQU   GROUP+106
GVSNE    EQU   0
GVSHDR   EQU   GVSNE
GVSNAME  EQU   GVSHDR
GVSVVGRP EQU   GVSNAME+3
GVSID    EQU   GVSNAME+11
GVSFLAGA EQU   GVSHDR+13
GVSTYPE  EQU   GVSFLAGA
GVSGVSEX EQU   GVSTYPE
GVSEX    EQU   GVSFLAGA+2
GVSESIND EQU   GVSHDR+18
GVSSLOTS EQU   GVSNE+28
GVSVOLID EQU   GVSSLOTS
GVSVOLFL EQU   GVSSLOTS+6
GVSCPUBM EQU   GVSVOLFL
GVSRCFSI EQU   GVSVOLFL+2
GVSMTNSH EQU   GVSVOLFL+2
GVSFRESP EQU   GVSSLOTS+10
GVSLEXT  EQU   GVSSLOTS+12
GVSEXPDT EQU   GVSSLOTS+14
GVSMTDSP EQU   GVSSLOTS+18
BASEV    EQU   0
BASNAME  EQU   BASEV
BASEVKEY EQU   BASNAME
BASSERNO EQU   BASNAME+5
BASID    EQU   BASNAME+11
BASZERO  EQU   BASID+1
BASFLAGA EQU   BASEV+14
BASTYPE  EQU   BASFLAGA
BASBASVR EQU   BASTYPE
BASDLSF  EQU   BASFLAGA+2
BASGRPV  EQU   BASFLAGA+2
BASGENUS EQU   BASFLAGA+2
BASRSTD  EQU   BASFLAGA+2
BASINAC  EQU   BASFLAGA+2
BASBIND  EQU   BASFLAGA+2
BASEXCL  EQU   BASFLAGA+2
BASDAERA EQU   BASFLAGA+3
BASRONLY EQU   BASFLAGA+3
BASFIRST EQU   BASFLAGA+3
BASLAST  EQU   BASFLAGA+3
BASCPUID EQU   BASEV+18
BASRCVYF EQU   BASEV+20
BASSATIA EQU   BASRCVYF
BASIVCRE EQU   BASSATIA
BASIVCPY EQU   BASSATIA
BASVSMIS EQU   BASSATIA
BASMISCF EQU   BASRCVYF+2
BASHOLD  EQU   BASMISCF
BASCSN1  EQU   BASEV+24
BASLIB1  EQU   BASEV+36
BASLID1  EQU   BASLIB1
BASCSN2  EQU   BASEV+37
BASLIB2  EQU   BASEV+49
BASLID2  EQU   BASLIB2
BASPREV  EQU   BASEV+50
BASNEXTV EQU   BASEV+56
BASNCOPY EQU   BASEV+62
BASNBKUP EQU   BASEV+63
BASBKLMT EQU   BASEV+64
BASFRESP EQU   BASEV+68
BASLEXT  EQU   BASEV+70
BASFREXT EQU   BASEV+72
BASKLCPY EQU   BASEV+76
BASCOPID EQU   BASKLCPY+11
BASEXPDT EQU   BASEV+96
BASDTREM EQU   BASEV+100
BASDESCR EQU   BASEV+104
BASOWNER EQU   BASEV+134
BASDEST  EQU   BASEV+144
BASRECOV EQU   BASEV+174
BASGROUP EQU   BASEV+180
COPYV    EQU   0
COPNAME  EQU   COPYV
COPV     EQU   COPNAME
COPSERNO EQU   COPNAME+5
COPID    EQU   COPNAME+11
COPFLAGA EQU   COPYV+14
COPTYPE  EQU   COPFLAGA
COPBKUP  EQU   COPFLAGA+2
COPRCVYF EQU   COPYV+20
COPSATIA EQU   COPRCVYF
COPIVCPY EQU   COPSATIA
COPMISCF EQU   COPRCVYF+2
COPHOLD  EQU   COPMISCF
COPLIB1  EQU   COPYV+36
COPLID1  EQU   COPLIB1
COPLIB2  EQU   COPYV+49
COPLID2  EQU   COPLIB2
COPDATE  EQU   COPYV+50
DUPV     EQU   0
DUPNAME  EQU   DUPV
DUPD     EQU   DUPNAME
DUPSERNO EQU   DUPNAME+5
DUPID    EQU   DUPNAME+11
DUPFLAGA EQU   DUPV+14
DUPTYPE  EQU   DUPFLAGA
DUPRCVYF EQU   DUPV+20
DUPCSN1  EQU   DUPV+24
DUPLIB1  EQU   DUPV+36
DUPLID1  EQU   DUPLIB1
DUPCSN2  EQU   DUPV+37
DUPLIB2  EQU   DUPV+49
DUPLID2  EQU   DUPLIB2
INDEX    EQU   0
INDNAME  EQU   INDEX
INDI     EQU   INDNAME
INDTYPE  EQU   INDEX+13
INDRECKY EQU   INDEX+15
INDPREFX EQU   INDRECKY
INDVSRNO EQU   INDRECKY+5
INDRECID EQU   INDRECKY+11
INDEXREC EQU   INDRECID+1
CPUID    EQU   0
CPUTYPE  EQU   CPUID+18
CPUMAP   EQU   CPUID+20
RVR      EQU   0
RVRCODE  EQU   RVR+4
RVROPCD  EQU   RVRCODE
RVRVOLID EQU   RVR+8
RVRCPYID EQU   RVR+15
RVRFLAGA EQU   RVR+16
RVRBASEV EQU   RVRFLAGA
RVRCOPYV EQU   RVRFLAGA
MGP      EQU   0
MGPCODE  EQU   MGP+4
MGPGROUP EQU   MGP+8
MGPOWNER EQU   MGP+16
MGPRI    EQU   MGP+26
MGPSEC   EQU   MGP+28
MGPRETPD EQU   MGP+30
MGPTHOLD EQU   MGP+32
MGPCONUS EQU   MGP+33
MGPRESSP EQU   MGP+34
MGPDESCR EQU   MGP+36
MGPADDR  EQU   MGP+66
MGPFLAGA EQU   MGP+96
MGPRLSE  EQU   MGPFLAGA
MGPNRLSE EQU   MGPFLAGA
MGPBIND  EQU   MGPFLAGA
MGPNBIND EQU   MGPFLAGA
MGPEXCL  EQU   MGPFLAGA
MGPSHARE EQU   MGPFLAGA
MGPRONLY EQU   MGPFLAGA
MGPRW    EQU   MGPFLAGA
MGPDERAS EQU   MGPFLAGA+1
MGPNDERA EQU   MGPFLAGA+1
MGPFLOWN EQU   MGPFLAGA+1
MGPFLPRI EQU   MGPFLAGA+1
MGPFLSEC EQU   MGPFLAGA+1
MGPFLTHO EQU   MGPFLAGA+1
MGPFLRET EQU   MGPFLAGA+1
MGPFLDES EQU   MGPFLAGA+2
MGPFLADD EQU   MGPFLAGA+2
MGPNTHLD EQU   MGPFLAGA+2
MGPNOWNR EQU   MGPFLAGA+2
MGPNRETP EQU   MGPFLAGA+2
MGPNDESC EQU   MGPFLAGA+2
MGPNADDR EQU   MGPFLAGA+2
MGPFLCON EQU   MGPFLAGA+2
MGPFLRES EQU   MGPFLAGA+3
SGP      EQU   0
SGPCODE  EQU   SGP+4
SGPGROUP EQU   SGP+8
RVVI     EQU   0
RVVOPCOD EQU   RVVI+4
RVVOLUME EQU   RVVI+8
RVVGROUP EQU   RVVI+14
RVVARLN  EQU   RVVI+22
RVVAREA  EQU   RVVI+24
RVVBUFLN EQU   RVVI+30
RVVEXPIR EQU   RVVI+36
RVVCDATE EQU   RVVI+38
RVVRDSEQ EQU   RVVI+43
RVVRDCSN EQU   RVVI+44
RVVCPYID EQU   RVVI+56
RVVDUPID EQU   RVVI+57
RVVFLAGA EQU   RVVI+58
RVVRMODE EQU   RVVFLAGA
RVVRDR   EQU   RVVRMODE
RVVRDNR  EQU   RVVRMODE
RVVRDCH  EQU   RVVRMODE
RVVCHAIN EQU   RVVFLAGA+1
RVVGPVOL EQU   RVVCHAIN
RVVNGVOL EQU   RVVCHAIN
RVVRDRCD EQU   RVVFLAGA+2
RVVBVRCD EQU   RVVRDRCD
RVVGRPRC EQU   RVVRDRCD
RVVCPYRC EQU   RVVRDRCD
RVVDUPRC EQU   RVVRDRCD
RVVRUNKN EQU   RVVRDRCD
RVVCIRCD EQU   RVVRDRCD
RVVCPURC EQU   RVVRDRCD
RVVALL   EQU   RVVRDRCD
RVVRTEST EQU   RVVFLAGA+3
RVVEXPDT EQU   RVVRTEST
RVVTHOLD EQU   RVVRTEST
RVVGSVOL EQU   RVVRTEST
RVVRSTD  EQU   RVVRTEST
RVVINACT EQU   RVVRTEST
RVVACTV  EQU   RVVRTEST
RVVDVOL  EQU   RVVRTEST
RVVBPLHD EQU   RVVRTEST
RVVCPYTP EQU   RVVFLAGA+4
RVVLBKUP EQU   RVVCPYTP
RVVOBKUP EQU   RVVCPYTP
RVVLCOPY EQU   RVVCPYTP
RVVCPLHD EQU   RVVCPYTP
RVVSPEC  EQU   RVVFLAGA+5
RVVSGRP  EQU   RVVSPEC
RVVSDTE  EQU   RVVSPEC
RVVSSEQ  EQU   RVVSPEC
RVVSCSN  EQU   RVVSPEC
RVVSCPY  EQU   RVVSPEC
RVVSDUP  EQU   RVVSPEC
RVVSVOL  EQU   RVVSPEC
MVR      EQU   0
MVRCODE  EQU   MVR+4
MVRFLAGA EQU   MVR+8
MVRFLFOR EQU   MVRFLAGA
MVRFLGRO EQU   MVRFLAGA
MVRFLDES EQU   MVRFLAGA
MVRFLTO  EQU   MVRFLAGA
MVRFLCSN EQU   MVRFLAGA
MVRFLBK  EQU   MVRFLAGA
MVRFLLAB EQU   MVRFLAGA
MVRGEN   EQU   MVRFLAGA+1
MVRRSTD  EQU   MVRFLAGA+1
MVRNGRP  EQU   MVRFLAGA+1
MVRBKUP  EQU   MVRFLAGA+1
MVRNDESC EQU   MVRFLAGA+1
MVRNEXPD EQU   MVRFLAGA+1
MVRSLMIS EQU   MVRFLAGA+1
MVRCLMIS EQU   MVRFLAGA+1
MVRCIVCF EQU   MVRFLAGA+2
MVRCICPY EQU   MVRFLAGA+2
MVRBVOL  EQU   MVR+12
MVRFOR   EQU   MVR+18
MVRGROUP EQU   MVR+20
MVRDES   EQU   MVR+28
MVRTO    EQU   MVR+58
MVRCSN   EQU   MVR+62
MVRBKUPN EQU   MVR+74
MVRLABEL EQU   MVR+76
BUFFER   EQU   0
DUPVDBR  EQU   0
BASEVDBR EQU   0
RPLVDBR  EQU   0
FLAGDBR  EQU   0
SPREVDBR EQU   0
SNEXTDBR EQU   0
GRPEXT   EQU   0
BASEXT   EQU   0
RPLVEXT  EQU   0
FLAGEXT  EQU   0
NOSAVE   EQU   0
FOR      EQU   0
EXPDATE  EQU   0
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS
@NM00050 EQU   MVR+82
MVRBLNK1 EQU   MVR+75
@NM00049 EQU   MVRFLAGA+2
MVRFLBAS EQU   MVRFLAGA
@NM00048 EQU   MVRCODE+1
MVROPCD  EQU   MVRCODE
MVRLNGTH EQU   MVR
@NM00047 EQU   RVVI+64
RVVSEXP  EQU   RVVSPEC
@NM00046 EQU   RVVCPYTP
@NM00045 EQU   RVVCHAIN
@NM00044 EQU   RVVRMODE
RVVBLNK1 EQU   RVVI+42
RVVRTBUF EQU   RVVI+32
@NM00043 EQU   RVVI+28
@NM00042 EQU   RVVOPCOD+1
RVVCODE  EQU   RVVOPCOD
RVVLNGTH EQU   RVVI
@NM00041 EQU   SGP+16
@NM00040 EQU   SGPCODE+1
SGPOPCD  EQU   SGPCODE
SGPLNGTH EQU   SGP
@NM00039 EQU   MGP+100
@NM00038 EQU   MGPFLAGA+3
MGPFLGRO EQU   MGPFLAGA+1
@NM00037 EQU   MGP+35
@NM00036 EQU   MGPCODE+1
MGPOPCD  EQU   MGPCODE
MGPLNGTH EQU   MGP
@NM00035 EQU   RVR+20
@NM00034 EQU   RVRFLAGA
RVRBLNK1 EQU   RVR+14
@NM00033 EQU   RVRCODE+1
RVRLNGTH EQU   RVR
@NM00032 EQU   CPUID+150
CPUPURGE EQU   CPUID+148
CPUMASK  EQU   CPUMAP+6
@NM00031 EQU   CPUMAP+5
CPUIDREC EQU   CPUMAP
CPURES2  EQU   CPUTYPE
CPUASSOC EQU   CPUTYPE
CPURES1  EQU   CPUTYPE
CPUDNEXT EQU   CPUID+16
CPUINEXT EQU   CPUID+14
@NM00030 EQU   CPUID+13
CPUNAME  EQU   CPUID
@NM00029 EQU   INDEX+28
INDBLNK2 EQU   INDRECID
INDBLNK1 EQU   INDPREFX+1
INDALPHA EQU   INDPREFX
INDRES2  EQU   INDTYPE
INDINDEX EQU   INDTYPE
INDRES1  EQU   INDTYPE
INDSERNO EQU   INDNAME+1
@NM00028 EQU   DUPV+50
DUP2BIT2 EQU   DUPLID2
DUP2BIT1 EQU   DUPLID2
DUPRES4  EQU   DUPLIB2
DUP1BIT2 EQU   DUPLID1
DUP1BIT1 EQU   DUPLID1
DUPRES3  EQU   DUPLIB1
DUPMISCF EQU   DUPRCVYF+2
DUPSATIA EQU   DUPRCVYF
@NM00027 EQU   DUPV+18
@NM00026 EQU   DUPFLAGA+2
DUPRES2  EQU   DUPTYPE
DUPDUPLR EQU   DUPTYPE
DUPRES1  EQU   DUPTYPE
DUPRES5  EQU   DUPV+13
DUPNO    EQU   DUPID+1
DUPBLANK EQU   DUPID
@NM00025 EQU   COPYV+136
COPFREXT EQU   COPYV+132
COPLEXT  EQU   COPYV+130
COPFRESP EQU   COPYV+128
COPOWNER EQU   COPYV+118
COPDEST  EQU   COPYV+88
COPDESCR EQU   COPYV+58
COPDTREM EQU   COPYV+54
COP2BIT2 EQU   COPLID2
COP2BIT1 EQU   COPLID2
COPRES5  EQU   COPLIB2
COPCSN2  EQU   COPYV+37
COP1BIT2 EQU   COPLID1
COP1BIT1 EQU   COPLID1
COPRES4  EQU   COPLIB1
COPCSN1  EQU   COPYV+24
@NM00024 EQU   COPMISCF
COPRES3  EQU   COPSATIA
COPVSMIS EQU   COPSATIA
COPIVCRE EQU   COPSATIA
@NM00023 EQU   COPYV+18
@NM00022 EQU   COPFLAGA+3
COPDLSPF EQU   COPFLAGA+3
COPRONLY EQU   COPFLAGA+3
COPDAERA EQU   COPFLAGA+2
COPEXCL  EQU   COPFLAGA+2
COPBIND  EQU   COPFLAGA+2
COPRSTD  EQU   COPFLAGA+2
COPGENUS EQU   COPFLAGA+2
COPVSAM  EQU   COPFLAGA+2
COPGROUP EQU   COPFLAGA+2
COPRES2  EQU   COPTYPE
COPCOPYV EQU   COPTYPE
COPRES1  EQU   COPTYPE
COPRES6  EQU   COPYV+13
COPNO    EQU   COPID+1
COPBLANK EQU   COPID
@NM00021 EQU   BASEV+192
BASXPDT2 EQU   BASEV+188
BASDLMTD EQU   BASEV+92
BASRES6  EQU   BASEV+89
BASCOPNO EQU   BASCOPID+1
BASCOPBK EQU   BASCOPID
BASCOPSN EQU   BASKLCPY+5
BASCOPV  EQU   BASKLCPY
@NM00020 EQU   BASEV+65
BAS2BIT2 EQU   BASLID2
BAS2BIT1 EQU   BASLID2
BASRES5  EQU   BASLIB2
BAS1BIT2 EQU   BASLID1
BAS1BIT1 EQU   BASLID1
BASRES4  EQU   BASLIB1
BASRES3  EQU   BASMISCF
BASRES8  EQU   BASSATIA
@NM00019 EQU   BASFLAGA+3
BASREASS EQU   BASFLAGA+3
BASNOCPY EQU   BASFLAGA+2
BASRES2  EQU   BASTYPE
BASRES1  EQU   BASTYPE
BASRES7  EQU   BASEV+13
BASBLANK EQU   BASID
@NM00018 EQU   GVSVOLFL+2
@NM00017 EQU   GVSHDR+20
@NM00016 EQU   GVSHDR+17
@NM00015 EQU   GVSFLAGA+2
@NM00014 EQU   GVSTYPE
@NM00013 EQU   GVSTYPE
GVSNO    EQU   GVSID+1
GVSRES1  EQU   GVSID
GVSG     EQU   GVSNAME
@NM00012 EQU   GROUP+136
GROERRTM EQU   GROERRTS+4
GROERRDT EQU   GROERRTS
GROFREXT EQU   GROUP+48
@NM00011 EQU   GROFLAGA+2
GROMSG1  EQU   GROFLAGA+2
GRORES1  EQU   GROTYPE
GROBLANK EQU   GROID
BCD2BIT2 EQU   BCDLID2
BCD2BIT1 EQU   BCDLID2
BCDRES8  EQU   BCDLIB2
BCD1BIT2 EQU   BCDLID1
BCD1BIT1 EQU   BCDLID1
BCDRE10  EQU   BCDLIB1
BCDRES7A EQU   BCDMISCF
BCDRES7  EQU   BCDSATIA
BCDVSMIS EQU   BCDSATIA
BCDIVCPY EQU   BCDSATIA
BCDIVCRE EQU   BCDSATIA
BCDCPUID EQU   BCDV+18
BCDRES5  EQU   BCDFLAGB+1
BCDREASS EQU   BCDFLAGB+1
BCDRES4  EQU   BCDFLAGB
BCDRES3  EQU   BCDTYPE
BCDDUP   EQU   BCDTYPE
BCDRES2  EQU   BCDTYPE
BCDCOPY  EQU   BCDTYPE
BCDBASE  EQU   BCDTYPE
BCDRES1  EQU   BCDTYPE
BCDRES9  EQU   BCDV+13
BCDINDEX EQU   BCDID+1
BCDBLNK2 EQU   BCDID
BCDSERNO EQU   BCDNAME+5
BCDBLNK1 EQU   BCDPREFX+1
BCDALPHA EQU   BCDPREFX
@NM00010 EQU   NGVR+32
@NM00009 EQU   NGVR+29
NGVLVOL  EQU   NGVR+23
@NM00008 EQU   NGVR+15
NGVRES2  EQU   NGVRTYPE+1
NGVHDR   EQU   NGVRTYPE
NGVRES1  EQU   NGVRTYPE
NGVNAME  EQU   NGVR
VVIUNUSD EQU   VVICB+116
VVINUSDC EQU   VVICB+112
VVITPFCH EQU   VVICB+108
VVIDVMEL EQU   VVICB+104
VVIVBSTF EQU   VVICB+100
VVISSOBA EQU   VVICB+96
VVIVSCRA EQU   VVICB+92
VVISTPTB EQU   VVICB+88
VVIDVMTA EQU   VVICB+84
VVIJUCB  EQU   VVICB+80
VVIIUCB  EQU   VVICB+76
VVIRES6  EQU   VVICB+72
VVIRES5  EQU   VVICB+68
VVIRES4  EQU   VVICB+64
VVIUCB   EQU   VVICB+60
VVIVJL   EQU   VVICB+56
VVIVRR   EQU   VVICB+52
VVIQLSPL EQU   VVICB+48
VVIQRPL2 EQU   VVICB+44
VVIQRPL1 EQU   VVICB+40
VVIRES3  EQU   VVICB+36
VVIVQMP  EQU   VVICB+32
VVIECB1  EQU   VVICB+28
VVICATAD EQU   VVICB+24
VVIDCBAD EQU   VVICB+20
VVIACBAD EQU   VVICB+16
VVIFLG7  EQU   VVIFLGA
VVIFLG6  EQU   VVIFLGA
VVIFLG5  EQU   VVIFLGA
VVIFLG4  EQU   VVIFLGA
VVIFLG3  EQU   VVIFLGA
VVIFLG1  EQU   VVIFLGA
VVIALCON EQU   VVICB+14
VVICPUID EQU   VVICB+12
VVIUCAT  EQU   VVICB+4
VVICID   EQU   VVICB
@NM00007 EQU   RPLVSAM+44
@NM00006 EQU   RPLVOPT
@NM00005 EQU   RPLVOPT
@NM00004 EQU   RPLVSAM+28
RPLVACB  EQU   RPLVSAM+24
@NM00003 EQU   RPLVSAM+3
@NM00002 EQU   RPLVSAM
@NM00001 EQU   RPLV+42
RPLRMSCC EQU   RPLV+36
RPLVTLEN EQU   RPLV+30
RPLVRES1 EQU   RPLFLAGA+1
RPLVVOP  EQU   RPLFLAGA
RPLVVIN  EQU   RPLFLAGA
RPLVCOMP EQU   RPLFLAGA
RPLVPROG EQU   RPLFLAGA
RPLVPOST EQU   RPLFLAGA
RPLFTIME EQU   RPLFLAGA
RPLVRSV3 EQU   RPLV+24
RPLVRSV2 EQU   RPLV+20
RPLVRSV1 EQU   RPLV+16
RPLASCBP EQU   RPLTCBPR
RPLVECB  EQU   RPLV+4
RPLVQPTR EQU   RPLV
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS
@RF00189 EQU   @EL00001
@RF00191 EQU   @EL00001
@RF00199 EQU   @EL00001
@RF00201 EQU   @EL00001
@RF00209 EQU   @EL00001
@RF00211 EQU   @EL00001
@RF00219 EQU   @EL00001
@RF00221 EQU   @EL00001
@RF00229 EQU   @EL00001
@RF00231 EQU   @EL00001
@RT00249 EQU   @EL00002
@RT00448 EQU   @EL00004
@RT00453 EQU   @EL00004
@RF00456 EQU   @EL00004
@RT00464 EQU   @EL00005
@RT00511 EQU   @EL00006
@RT00685 EQU   @EL00009
@RF00716 EQU   @RC00709
@RT00726 EQU   @EL00009
@RF00742 EQU   @EL00009
@RF00770 EQU   @EL00009
@RT00786 EQU   @EL00010
@RT00818 EQU   @EL00010
@RF00815 EQU   @EL00010
@RF00873 EQU   @EL00011
@RT00907 EQU   @EL00012
@RT00935 EQU   @EL00012
@RF00969 EQU   @EL00012
@RT01071 EQU   @EL00014
@RF01056 EQU   @RC01053
@RF01068 EQU   @RC01053
@RT01111 EQU   @EL00014
@RF01095 EQU   @RC01092
@RT01254 EQU   @EL00016
@RT01286 EQU   @EL00017
@RT01339 EQU   @EL00018
@RT01380 EQU   @EL00019
@RT01382 EQU   @EL00019
@RF01411 EQU   @RC01409
@RT01444 EQU   @EL00019
@RT01493 EQU   @EL00020
@RT01497 EQU   @EL00020
@RT01527 EQU   @EL00021
@RT01542 EQU   @EL00021
@RT01580 EQU   @EL00022
@RT01594 EQU   @EL00022
@RC01575 EQU   @RC01573
@RT01675 EQU   @EL00024
@RT01689 EQU   @EL00024
@RC01665 EQU   @RC01663
@RT01756 EQU   @EL00026
@RC01776 EQU   @RC01774
@RT01804 EQU   @EL00026
@RT01844 EQU   @EL00027
@RT01898 EQU   @EL00028
@RT01937 EQU   @EL00029
@RT01976 EQU   @EL00030
@RT02029 EQU   @EL00031
@RT02047 EQU   @EL00031
@RT02151 EQU   @EL00034
@RT02161 EQU   @EL00034
@RF02190 EQU   @EL00036
@RC02203 EQU   @EL00037
@RF02234 EQU   @RC02232
@RT02318 EQU   @EL00038
@RC02343 EQU   @RC02341
@RT02380 EQU   @EL00038
@RT02385 EQU   @EL00038
@RT02389 EQU   @EL00038
@RT02398 EQU   @EL00038
@RT02401 EQU   @EL00038
@RT02413 EQU   @EL00038
@RT02424 EQU   @EL00038
@RF02504 EQU   @EL00039
@RF02533 EQU   @EL00039
@RF02536 EQU   @EL00039
@RF02631 EQU   @EL00040
@RF02713 EQU   @EL00041
@RF02720 EQU   @EL00042
@RF02788 EQU   @EL00044
@RC02816 EQU   @RC02814
@RF02875 EQU   @EL00045
@RF02883 EQU   @EL00046
@RC02885 EQU   @EL00046
@RT02946 EQU   @RC02943
@RF02959 EQU   @RC02943
@RF03031 EQU   @EL00047
@RF03073 EQU   @EL00050
@RT03163 EQU   @EL00051
@RT03270 EQU   @EL00052
@RT03297 EQU   @EL00052
@RT03302 EQU   @EL00052
@RT03323 EQU   @EL00052
@RT03328 EQU   @EL00052
@RT03356 EQU   @EL00053
@RF03358 EQU   @EL00053
@RT03392 EQU   @EL00055
@RT03412 EQU   @EL00055
@RF03414 EQU   @EL00055
@RT03433 EQU   @EL00055
@RF03435 EQU   @EL00055
@RT03445 EQU   @EL00055
@RT03450 EQU   @EL00055
@RT03467 EQU   @EL00055
@RT03476 EQU   @EL00055
@RF03453 EQU   @EL00055
@RC03514 EQU   @RC03512
@RF03533 EQU   @EL00056
@RC01668 EQU   @RC01665
@RC02345 EQU   @RC02343
@RC02818 EQU   @RC02816
@RF02906 EQU   @RC02885
@RC01670 EQU   @RC01668
@RC02347 EQU   @RC02345
@RC02820 EQU   @RC02818
@ENDDATA EQU   *
         END   ICBVUT01,(C'PLS0930',0603,77062)

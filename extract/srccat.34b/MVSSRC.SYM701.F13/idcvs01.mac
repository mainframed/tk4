VS01     TITLE '********  IDCVS01:  VOLUME SERVICES - VTOC FUNCTIONS  **
               ******** '
        MACRO
        GETMAIN &R,&LV=
        L     REG15,0(REG1)           GDTTBL ADDRESS
        L     REG15,GDTPRL(REG15)     PROL ROUTINE ADDRESS
        CNOP  2,4                     BOUNDARY ALIGNMENT
        LA    REG14,*+14              RETURN ADDRESS
        BALR  REG1,REG15              LINKAGE TO PROL ROUTINE
        DC    A(MODID)                MODULE ID ADDRESS
        DC    A(@SIZDATD)             AUTOMATIC STORAGE SIZE ADDRESS
        MEND
IDCVS01  CSECT ,                                                   0002
@MAINENT DS    0H                                                  0002
         USING *,@15                                               0002
         B     @PROLOG                                             0002
         DC    AL1(16)                                             0002
         DC    C'IDCVS01   76.320'                                 0002
         DROP  @15
@PROLOG  STM   @14,@12,12(@13)                                     0002
         BALR  @06,0                                               0002
@PSTART  LA    @10,4095(,@06)                                      0002
         LA    @12,4095(,@10)                                      0002
         USING @PSTART,@06                                         0002
         USING @PSTART+4095,@10                                    0002
         USING @PSTART+8190,@12                                    0002
         L     @00,@SIZDATD                                        0002
         GETMAIN  R,LV=(0)
         LR    @11,@01                                             0002
         LA    @09,4095(,@11)                                      0002
         LA    @08,4095(,@09)                                      0002
         LA    @07,4095(,@08)                                      0002
         USING @DATD,@11                                           0002
         USING @DATD+4095,@09                                      0002
         USING @DATD+8190,@08                                      0002
         USING @DATD+12285,@07                                     0002
         ST    @13,@SA00001+4                                      0002
         LM    @00,@01,20(@13)                                     0002
         ST    @11,8(,@13)                                         0002
         LR    @13,@11                                             0002
         MVC   @PC00001(12),0(@01)                                 0002
*   OLDERID2=NEWERID2;                                             0304
         L     @04,@PC00001                                        0304
         L     @15,GDTTR2(,@04)                                    0304
         MVC   @TS00001(95),NEWERID2(@15)                          0304
         MVC   OLDERID2(95,@15),@TS00001                           0304
*   NEWID2='VS01';                  /*                       @Y30LB37*/
         MVC   NEWID2(4,@15),@CC01329                              0305
*   IF GDTDBG=NULLPTR THEN                                         0306
         L     @04,GDTDBG(,@04)                                    0306
         LTR   @04,@04                                             0306
         BZ    @RT00306                                            0306
*     ;                                                            0307
*   ELSE                                                           0308
*     CALL IDCDB010(GDTTBL,'VSBG'); /*                       @Y30LB37*/
*                                                                  0308
         L     @04,@PC00001                                        0308
         ST    @04,@AL00001                                        0308
         LA    @15,@CC01471                                        0308
         ST    @15,@AL00001+4                                      0308
         MVI   @AL00001+4,X'80'                                    0308
         L     @15,GDTDBG(,@04)                                    0308
         LA    @01,@AL00001                                        0308
         BALR  @14,@15                                             0308
*   /*****************************************************************/
*   /*                                                               */
*   /* INITIALIZE UPRINT AND USYSINFO AREAS TO ZERO.         @Y30LB37*/
*   /* INITIALIZE RETURN CODE AND SWITCHES TO ZERO.          @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0309
*   RETCODE=0;                      /* INITIALIZE RETURN CODE      0309
*                                                            @Y30LB37*/
@RT00306 SLR   @15,@15                                             0309
         STH   @15,RETCODE                                         0309
*   V1PGSWS=''B;                    /* CLEAR SWITCH AREA     @Y30LB37*/
         XC    V1PGSWS(2),V1PGSWS                                  0310
*   DDSTRU=ADDR(PRINTARG);          /* INIT ARGUMENT LIST PTR      0311
*                                                            @Y30LB37*/
         LA    @15,PRINTARG                                        0311
         ST    @15,DDSTRU                                          0311
*   PRINTARG=''B;                   /* CLEAR PRINTARG BLOCK  @Y30LB37*/
         XC    PRINTARG(44),PRINTARG                               0312
*   INFOPTR=ADDR(INFOAREA);         /* INIT UNITABL PTR      @Y30LB37*/
         LA    @15,INFOAREA                                        0313
         ST    @15,INFOPTR                                         0313
*   UNITABL=''B;                    /* CLEAR UNITABL OUTPUT  @Y30LB37*/
         XC    UNITABL(11,@15),UNITABL(@15)                        0314
*   ALLAGL=''B;                     /* CLEAR ALLAGL AREA     @Y30LB37*/
         LA    @15,ALLLIST                                         0315
         XC    ALLAGL(31,@15),ALLAGL(@15)                          0315
*   VRACFPTR=ADDR(VS1RACF);         /*                       @G24LB31*/
*                                                                  0316
         LA    @15,VS1RACF                                         0316
         ST    @15,VRACFPTR                                        0316
*   /*****************************************************************/
*   /*                                                               */
*   /* INITIALIZE ARGLIST PTR AND MOVE IN REQUEST.           @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0317
*   ARGLPTR=ADDR(VS1ARGL);          /* INIT ARGLIST PTR      @Y30LB37*/
         L     ARGLPTR,@PC00001+8                                  0317
*   VSHEAD=REQUEST;                 /* MOVE IN REQUEST       @Y30LB37*/
         L     @15,@PC00001+4                                      0318
         MVC   VSHEAD(8,ARGLPTR),REQUEST(@15)                      0318
*                                                                  0319
*   /*****************************************************************/
*   /*                                                               */
*   /* DETERMINE REQUEST PASSED BY THE CALLER AND CALL THE   @Y30LB37*/
*   /* APPROPRIATE ROUTINE TO PROCESS THE REQUEST OR UABORT  @Y30LB37*/
*   /* IF AN INVALID REQUEST.                                @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0319
*   IF REQUEST=SECCHECK THEN                                       0319
         CLC   REQUEST(8,@15),SECCHECK                             0319
         BNE   @RF00319                                            0319
*     CALL SECHECK;                 /*                       @Y30LB37*/
         BAL   @14,SECHECK                                         0320
*   ELSE                                                           0321
*     IF REQUEST=GETVTOC THEN                                      0321
         B     @RC00319                                            0321
@RF00319 L     @15,@PC00001+4                                      0321
         CLC   REQUEST(8,@15),GETVTOC                              0321
         BNE   @RF00321                                            0321
*       CALL VTOCGET;               /*                       @Y30LB37*/
         BAL   @14,VTOCGET                                         0322
*     ELSE                                                         0323
*       IF REQUEST=PUTVTOC THEN                                    0323
         B     @RC00321                                            0323
@RF00321 L     @15,@PC00001+4                                      0323
         CLC   REQUEST(8,@15),PUTVTOC                              0323
         BNE   @RF00323                                            0323
*         CALL VTOCPUT;             /*                       @Y30LB37*/
         BAL   @14,VTOCPUT                                         0324
*       ELSE                                                       0325
*         IF REQUEST=SCRVTOC THEN                                  0325
         B     @RC00323                                            0325
@RF00323 L     @15,@PC00001+4                                      0325
         CLC   REQUEST(8,@15),SCRVTOC                              0325
         BNE   @RF00325                                            0325
*           CALL SCRATCH;           /*                       @Y30LB37*/
         BAL   @14,SCRATCH                                         0326
*         ELSE                                                     0327
*           IF REQUEST=RECATLG THEN                                0327
         B     @RC00325                                            0327
@RF00325 L     @15,@PC00001+4                                      0327
         CLC   REQUEST(8,@15),RECATLG                              0327
         BNE   @RF00327                                            0327
*             CALL RECATLOG;        /*                       @Y30LB37*/
         BAL   @14,RECATLOG                                        0328
*           ELSE                                                   0329
*             DO;                                                  0329
         B     @RC00327                                            0329
@RF00327 DS    0H                                                  0330
*               RESPECIFY                                          0330
*                (REG13,                                           0330
*                 REG14,                                           0330
*                 REG15) RSTD;                                     0330
*               REG15=40;                                          0331
         LA    REG15,40                                            0331
*               REG14=GDTABT;                                      0332
         L     @05,@PC00001                                        0332
         L     REG14,GDTABT(,@05)                                  0332
*               REG13=GDTABH;                                      0333
         L     REG13,GDTABH(,@05)                                  0333
*               GEN(BR    REG14);                                  0334
         BR    REG14
*               RESPECIFY                                          0335
*                (REG13,                                           0335
*                 REG14,                                           0335
*                 REG15) UNRSTD;                                   0335
*             END;                  /* ISSUE UABORT FOR BAD  @Y30LB37
*                                      ARGUMENT LIST         @Y30LB37*/
*                                                                  0336
*   /*****************************************************************/
*   /*                                                               */
*   /* SAVE THE RETURN CODE RETURNED FROM THE SUBROUTINE.    @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0337
*   RESPECIFY                                                      0337
*     RTNREG RSTD;                                                 0337
@RC00327 DS    0H                                                  0337
@RC00325 DS    0H                                                  0337
@RC00323 DS    0H                                                  0337
@RC00321 DS    0H                                                  0337
@RC00319 DS    0H                                                  0338
*   TESTRC=RTNREG;                                                 0338
         STH   RTNREG,TESTRC                                       0338
*   RESPECIFY                                                      0339
*     RTNREG UNRSTD;                /*                       @Y30LB37*/
*   IF TESTRC^=0 THEN                                              0340
         LH    @15,TESTRC                                          0340
         LTR   @15,@15                                             0340
         BZ    @RF00340                                            0340
*     RETCODE=TESTRC;               /*                       @Y30LB37*/
         STH   @15,RETCODE                                         0341
*                                                                  0342
*   /*****************************************************************/
*   /*                                                               */
*   /* RETURN TO THE CALLER OF THIS VOLUME SERVICES ROUTINE  @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0342
*   IF GDTDBG=NULLPTR THEN                                         0342
@RF00340 L     @15,@PC00001                                        0342
         L     @15,GDTDBG(,@15)                                    0342
         LTR   @15,@15                                             0342
         BZ    @RT00342                                            0342
*     ;                                                            0343
*   ELSE                                                           0344
*     CALL IDCDB010(GDTTBL,'VSND'); /* UDUMP EXIT            @Y30LB37*/
         L     @15,@PC00001                                        0344
         ST    @15,@AL00001                                        0344
         LA    @14,@CC01479                                        0344
         ST    @14,@AL00001+4                                      0344
         MVI   @AL00001+4,X'80'                                    0344
         L     @15,GDTDBG(,@15)                                    0344
         LA    @01,@AL00001                                        0344
         BALR  @14,@15                                             0344
*   CALL IDCSAEP0(GDTTBL,MODID,RETCODE);/* RETURN            @Y30LB37*/
@RT00342 L     @15,@PC00001                                        0345
         ST    @15,@AL00001                                        0345
         LA    @14,MODID                                           0345
         ST    @14,@AL00001+4                                      0345
         LA    @14,RETCODE                                         0345
         ST    @14,@AL00001+8                                      0345
         MVI   @AL00001+8,X'80'                                    0345
         L     @15,GDTEPL(,@15)                                    0345
         LA    @01,@AL00001                                        0345
         BALR  @14,@15                                             0345
*                                                                  0346
*/********************************************************************/
*/*                                                                  */
*/*  PROCEDURE NAME - VTOCGET                                @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  FUNCTION - THIS PROCEDURE RETRIEVES VTOC INFORMATION    @Y30LB37*/
*/*             FROM THE FORMAT 4 DSCB.  VTOCGET CALLS       @Y30LB37*/
*/*             SUBORDINATE ROUTINES VTOCOPEN, AND FMT4READ  @Y30LB37*/
*/*             TO OPEN THE VTOC AND READ THE FORMAT 4       @Y30LB37*/
*/*             DSCB.                                        @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  INPUT - THE INFORMATION PASSED IN THE VS1AGL ARGUMENT   @Y30LB37*/
*/*          LIST:  FIELDS VSIOP, VSALTTRK, AND VSVSFLAG.    @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  OUTPUT- THE INFORMATION RETURNED IS EITHER A ZERO       @Y30LB37*/
*/*          OR FOUR ERROR CODE.  IF THE RETURN CODE IS      @Y30LB37*/
*/*          ZERO, INFORMATION IS RETURNED ABOUT THE         @Y30LB37*/
*/*          VTOC ACCORDING TO THE INPUT REQUEST FLAGS.      @Y30LB37*/
*/*          RETURN CODES ARE:                               @Y30LB37*/
*/*          0 - SUCCESSFUL                                  @Y30LB37*/
*/*          4 - VTOC OPEN WAS UNSUCCESSFUL                  @Y30LB37*/
*/*              VTOC READ WAS UNSUCCESSFUL                  @Y30LB37*/
*/*              FIRST RECORD WAS NOT A FORMAT 4             @Y30LB37*/
*/*              ERROR RETRIEVING UCB ADDRESS                @Y30LB37*/
*/*              ERROR RESERVING VOLUME                      @Y30LB37*/
*/*                                                                  */
*/********************************************************************/
*                                                                  0346
*VTOCGET:                                                          0346
*   PROCEDURE;                      /*                       @Y30LB37*/
*                                                                  0346
@EL00001 L     @13,4(,@13)                                         0346
@EF00001 L     @00,@SIZDATD                                        0346
         LR    @01,@11                                             0346
         FREEMAIN R,LV=(0),A=(1)
@ER00001 LM    @14,@12,12(@13)                                     0346
         BR    @14                                                 0346
VTOCGET  STM   @14,@12,@SA00002                                    0346
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL DECLARATIONS FOR VTOCGET                        @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0347
*   DCL                                                            0347
*     VTOCGRC FIXED(15);            /* VTOCGET RETURN CODE   @Y30LB37*/
*                                                                  0348
*   /*****************************************************************/
*   /*                                                               */
*   /* CALL THE VTOCOPEN PROCEDURE TO OPEN THE VTOC          @Y30LB37*/
*   /* IF IT IS NOT ALREADY OPEN (VSIOP IS ZERO).            @Y30LB37*/
*   /* VTOCOPEN SETS THE VSIOP FIELD. IF VTOCOPEN IS         @Y30LB37*/
*   /* UNSUCCESSFUL THEN SET VTOCGRC TO FOUR.                @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0348
*   OLDERID2=NEWERID2;                                             0348
         L     @05,@PC00001                                        0348
         L     @05,GDTTR2(,@05)                                    0348
         MVC   @TS00001(95),NEWERID2(@05)                          0348
         MVC   OLDERID2(95,@05),@TS00001                           0348
*   NEWID2='VSVG';                  /* ISSUE UTRACE MACRO    @Y30LB37*/
         MVC   NEWID2(4,@05),@CC01484                              0349
*   VTOCGRC=0;                      /*                       @Y30LB37*/
         SLR   @05,@05                                             0350
         LR    VTOCGRC,@05                                         0350
*   IF VSIOP=NULLPTR THEN                                          0351
         C     @05,VSIOP(,ARGLPTR)                                 0351
         BNE   @RF00351                                            0351
*     DO;                           /*                       @Y30LB37*/
*       CALL VTOCOPEN;              /*                       @Y30LB37*/
         BAL   @14,VTOCOPEN                                        0353
*       RESPECIFY                                                  0354
*         RTNREG RSTD;                                             0354
*       TESTRC=RTNREG;                                             0355
         STH   RTNREG,TESTRC                                       0355
*       RESPECIFY                                                  0356
*         RTNREG UNRSTD;            /*                       @Y30LB37*/
*       IF TESTRC^=0 THEN                                          0357
         LH    @05,TESTRC                                          0357
         LTR   @05,@05                                             0357
         BZ    @RF00357                                            0357
*         VTOCGRC=4;                /*                       @Y30LB37*/
         LA    VTOCGRC,4                                           0358
*     END;                          /*                       @Y30LB37*/
*                                                                  0359
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THE VTOC IS ALREADY OPEN PICK UP THE IOCSPTR FROM  @Y30LB37*/
*   /* THE VS1AGL.                                           @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0360
*   ELSE                                                           0360
*     IOCSPTR=VSIOP;                /*                       @Y30LB37*/
         B     @RC00351                                            0360
@RF00351 L     @05,VSIOP(,ARGLPTR)                                 0360
         ST    @05,IOCSPTR                                         0360
*                                                                  0361
*   /*****************************************************************/
*   /*                                                               */
*   /* IF VTOCOPEN SUCCESSFUL CALL FMT4READ TO READ THE      @Y30LB37*/
*   /* FORMAT 4 DSCB. IF VSALTTRK IS ON THEN RETRIEVE        @Y30LB37*/
*   /* THE ALTERNATE TRACK INFORMATION FROM THE FORMAT 4     @Y30LB37*/
*   /* DSCB. IF VSVSFLAG IS ON THEN SET THE VSVSAM FLAG      @Y30LB37*/
*   /* ACCORDING TO THE SETTING OF THE DS4VSREF FLAG. IF     @Y30LB37*/
*   /* THE FMT4READ PROCEDURE WAS NOT SUCCESSFUL, THEN       @Y30LB37*/
*   /* SET THE RETURN CODE TO RCFAIL.                        @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0361
*   IF VTOCGRC=0 THEN                                              0361
@RC00351 LTR   VTOCGRC,VTOCGRC                                     0361
         BNZ   @RF00361                                            0361
*     DO;                           /*                       @Y30LB37*/
*       CALL FMT4READ;              /*                       @Y30LB37*/
         BAL   @14,FMT4READ                                        0363
*       RESPECIFY                                                  0364
*         RTNREG RSTD;                                             0364
*       TESTRC=RTNREG;                                             0365
         STH   RTNREG,TESTRC                                       0365
*       RESPECIFY                                                  0366
*         RTNREG UNRSTD;            /*                       @Y30LB37*/
*       IF TESTRC=0 THEN                                           0367
         LH    @05,TESTRC                                          0367
         LTR   @05,@05                                             0367
         BNZ   @RF00367                                            0367
*         DO;                       /*                       @Y30LB37*/
*           IF VSALTTRK=ON THEN                                    0369
         TM    VSALTTRK(ARGLPTR),B'01000000'                       0369
         BNO   @RF00369                                            0369
*             DO;                   /*                       @Y30LB37*/
*               V1NXAREA=DS4HCCHH;  /*                       @Y30LB37*/
         L     @05,VSNXTATP(,ARGLPTR)                              0371
         LA    @03,44                                              0371
         AL    @03,F4PTR                                           0371
         MVC   V1NXAREA(4,@05),DS4HCCHH(@03)                       0371
*               V1NUAREA=DS4NOATK;  /*                       @Y30LB37*/
         L     @05,VSNUMATP(,ARGLPTR)                              0372
         MVC   V1NUAREA(2,@05),DS4NOATK(@03)                       0372
*             END;                  /*                       @Y30LB37*/
*           IF VSVSFLAG=ON THEN                                    0374
@RF00369 TM    VSVSFLAG(ARGLPTR),B'00100000'                       0374
         BNO   @RF00374                                            0374
*             IF DS4VSREF=ON THEN                                  0375
         L     @05,F4PTR                                           0375
         TM    DS4VSREF+44(@05),B'10000000'                        0375
         BNO   @RF00375                                            0375
*               VSVSAM=ON;          /*                       @Y30LB37*/
         OI    VSVSAM(ARGLPTR),B'10000000'                         0376
*             ELSE                                                 0377
*               VSVSAM=OFF;         /*                       @Y30LB37*/
         B     @RC00375                                            0377
@RF00375 NI    VSVSAM(ARGLPTR),B'01111111'                         0377
*         END;                      /*                       @Y30LB37*/
*       ELSE                                                       0379
*         VTOCGRC=4;                /*                       @Y30LB37*/
         B     @RC00367                                            0379
@RF00367 LA    VTOCGRC,4                                           0379
*     END;                          /*                       @Y30LB37*/
@RC00367 DS    0H                                                  0381
*   RETURN CODE(VTOCGRC);           /* RETURN TO MAIN ROUTINE      0381
*                                                            @Y30LB37*/
@RF00361 LR    @15,VTOCGRC                                         0381
         L     @14,@SA00002                                        0381
         LM    @00,@12,@SA00002+8                                  0381
         BR    @14                                                 0381
*   END VTOCGET;                    /* END OF VTOCGET PROC   @Y30LB37*/
*                                                                  0383
*/********************************************************************/
*/*                                                                  */
*/*  PROCEDURE NAME - VTOCPUT                                @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  FUNCTION - THIS PROCEDURE UPDATES VTOC INFORMATION      @Y30LB37*/
*/*             IN THE FORMAT 4 DSCB.  VTOCPUT CALLS         @Y30LB37*/
*/*             SUBORDINATE ROUTINES VTOCOPEN, AND FMT4READ  @Y30LB37*/
*/*             TO OPEN THE VTOC AND READ THE FORMAT 4       @Y30LB37*/
*/*             DSCB.  VTOCPUT CALLS UPRINT TO PRINT ERROR   @Y30LB37*/
*/*             MESSAGES IDC1968I, IDC1969I OR IDC0970I IF   @Y30LB37*/
*/*             AN ERROR OCCURRED UPDATING THE VTOC.         @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  INPUT - THE INFORMATION PASSED IN THE VS1AGL ARGUMENT   @Y30LB37*/
*/*          LIST:  FIELDS VSIOP, VSALTTRK, VSNXTATP,        @Y30LB37*/
*/*          VSTIME, VSNUMATP, VSMSG, AND VSVOLP.            @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  OUTPUT- THE INFORMATION RETURNED IS EITHER A ZERO       @Y30LB37*/
*/*          OR FOUR ERROR CODE.                             @Y30LB37*/
*/*          RETURN CODES ARE:                               @Y30LB37*/
*/*          0 - SUCCESSFUL                                  @Y30LB37*/
*/*          4 - VTOC OPEN WAS UNSUCCESSFUL                  @Y30LB37*/
*/*              VTOC READ WAS UNSUCCESSFUL                  @Y30LB37*/
*/*              FIRST RECORD WAS NOT A FORMAT 4             @Y30LB37*/
*/*              ERROR UPDATING THE VTOC                     @Y30LB37*/
*/*              ERROR RETRIEVING UCB ADDRESS                @Y30LB37*/
*/*              ERROR RESERVING VOLUME                      @Y30LB37*/
*/*                                                                  */
*/********************************************************************/
*                                                                  0383
*VTOCPUT:                                                          0383
*   PROCEDURE;                      /*                       @Y30LB37*/
*                                                                  0383
VTOCPUT  STM   @14,@12,@SA00003                                    0383
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL DECLARATIONS FOR VTOCPUT                        @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0384
*   DCL                                                            0384
*     VTOCPRC FIXED(15);            /* VTOCPUT RETURN CODE   @Y30LB37*/
*   DCL                                                            0385
*     VPTIME CHAR(8);               /* UTIME RETURN TIME AREA      0385
*                                                            @Y30LB37*/
*   DCL                                                            0386
*     VPDATE CHAR(4);               /* UTIME RETURN DATE AREA      0386
*                                                            @Y30LB37*/
*                                                                  0387
*   /*****************************************************************/
*   /*                                                               */
*   /* CALL THE VTOCOPEN PROCEDURE TO OPEN THE VTOC          @Y30LB37*/
*   /* IF IT IS NOT ALREADY OPEN (VSIOP IS ZERO).            @Y30LB37*/
*   /* VTOCOPEN SETS THE VSIOP FIELD. IF VTOCOPEN IS         @Y30LB37*/
*   /* UNSUCCESSFUL THEN SET VTOCPRC TO FOUR.                @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0387
*   OLDERID2=NEWERID2;                                             0387
         L     @05,@PC00001                                        0387
         L     @05,GDTTR2(,@05)                                    0387
         MVC   @TS00001(95),NEWERID2(@05)                          0387
         MVC   OLDERID2(95,@05),@TS00001                           0387
*   NEWID2='VSVP';                  /* ISSUE UTRACE MACRO    @Y30LB37*/
         MVC   NEWID2(4,@05),@CC01493                              0388
*   VTOCPRC=0;                      /*                       @Y30LB37*/
         SLR   @05,@05                                             0389
         LR    VTOCPRC,@05                                         0389
*   IF VSIOP=NULLPTR THEN                                          0390
         C     @05,VSIOP(,ARGLPTR)                                 0390
         BNE   @RF00390                                            0390
*     DO;                           /*                       @Y30LB37*/
*       CALL VTOCOPEN;              /*                       @Y30LB37*/
         BAL   @14,VTOCOPEN                                        0392
*       RESPECIFY                                                  0393
*         RTNREG RSTD;                                             0393
*       TESTRC=RTNREG;                                             0394
         STH   RTNREG,TESTRC                                       0394
*       RESPECIFY                                                  0395
*         RTNREG UNRSTD;            /*                       @Y30LB37*/
*       IF TESTRC^=0 THEN                                          0396
         LH    @05,TESTRC                                          0396
         LTR   @05,@05                                             0396
         BZ    @RF00396                                            0396
*         VTOCPRC=4;                /*                       @Y30LB37*/
         LA    VTOCPRC,4                                           0397
*     END;                          /*                       @Y30LB37*/
*                                                                  0398
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THE VTOC IS ALREADY OPEN PICK UP THE IOCSPTR FROM  @Y30LB37*/
*   /* THE VS1AGL.                                           @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0399
*   ELSE                                                           0399
*     IOCSPTR=VSIOP;                /*                       @Y30LB37*/
         B     @RC00390                                            0399
@RF00390 L     @05,VSIOP(,ARGLPTR)                                 0399
         ST    @05,IOCSPTR                                         0399
*                                                                  0400
*   /*****************************************************************/
*   /*                                                               */
*   /* IF VTOCOPEN SUCCESSFUL CALL FMT4READ TO READ THE      @Y30LB37*/
*   /* FORMAT 4 DSCB. IF VSALTTRK IS ON THEN UPDATE          @Y30LB37*/
*   /* THE ALTERNATE TRACK INFORMATION INTO THE FORMAT 4     @Y30LB37*/
*   /* DSCB. IF VSTIME IS ON THEN ISSUE THE UTIME MACRO      @Y30LB37*/
*   /* TO RETRIEVE THE TIME OF DAY IN BINARY AND SET THE     @Y30LB37*/
*   /* FORMAT 4 DSCB ACCORDING TO THE RETURNED TIME FROM     @Y30LB37*/
*   /* THE UTIME MACRO. IF THE FMT4READ PROCEDURE FOUND      @Y30LB37*/
*   /* AN ERROR, SET THE RETURN CODE TO RCFAIL.              @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0400
*   IF VTOCPRC=0 THEN                                              0400
@RC00390 LTR   VTOCPRC,VTOCPRC                                     0400
         BNZ   @RF00400                                            0400
*     DO;                           /*                       @Y30LB37*/
*       CALL FMT4READ;              /*                       @Y30LB37*/
         BAL   @14,FMT4READ                                        0402
*       RESPECIFY                                                  0403
*         RTNREG RSTD;                                             0403
*       TESTRC=RTNREG;                                             0404
         STH   RTNREG,TESTRC                                       0404
*       RESPECIFY                                                  0405
*         RTNREG UNRSTD;            /*                       @Y30LB37*/
*       IF TESTRC=0 THEN                                           0406
         LH    @05,TESTRC                                          0406
         LTR   @05,@05                                             0406
         BNZ   @RF00406                                            0406
*         DO;                       /*                       @Y30LB37*/
*           IF VSALTTRK=ON THEN                                    0408
         TM    VSALTTRK(ARGLPTR),B'01000000'                       0408
         BNO   @RF00408                                            0408
*             DO;                   /*                       @Y30LB37*/
*               DS4HCCHH=V1NXAREA;  /*                       @Y30LB37*/
         LA    @05,44                                              0410
         AL    @05,F4PTR                                           0410
         L     @03,VSNXTATP(,ARGLPTR)                              0410
         MVC   DS4HCCHH(4,@05),V1NXAREA(@03)                       0410
*               DS4NOATK=V1NUAREA;  /*                       @Y30LB37*/
         L     @03,VSNUMATP(,ARGLPTR)                              0411
         MVC   DS4NOATK(2,@05),V1NUAREA(@03)                       0411
*             END;                  /*                       @Y30LB37*/
*           IF VSTIME=ON THEN                                      0413
@RF00408 TM    VSTIME(ARGLPTR),B'10000000'                         0413
         BNO   @RF00413                                            0413
*             DO;                   /*                       @Y30LB37*/
*               CALL IDCSATI0(GDTTBL,VPTIME,VPDATE,CLOCK);/* @Y30LB37*/
         L     @05,@PC00001                                        0415
         ST    @05,@AL00001                                        0415
         LA    @03,VPTIME                                          0415
         ST    @03,@AL00001+4                                      0415
         LA    @03,VPDATE                                          0415
         ST    @03,@AL00001+8                                      0415
         LA    @03,CLOCK                                           0415
         ST    @03,@AL00001+12                                     0415
         MVI   @AL00001+12,X'80'                                   0415
         L     @15,GDTTIM(,@05)                                    0415
         LA    @01,@AL00001                                        0415
         BALR  @14,@15                                             0415
*               DS4AMTIM=VPTIME;    /*                       @Y30LB37*/
         L     @05,F4PTR                                           0416
         MVC   DS4AMTIM+44(8,@05),VPTIME                           0416
*             END;                  /*                       @Y30LB37*/
*         END;                      /*                       @Y30LB37*/
*       ELSE                                                       0419
*         VTOCPRC=4;                /*                       @Y30LB37*/
         B     @RC00406                                            0419
@RF00406 LA    VTOCPRC,4                                           0419
*     END;                          /*                       @Y30LB37*/
@RC00406 DS    0H                                                  0421
*                                                                  0421
*   /*****************************************************************/
*   /*                                                               */
*   /* ISSUE UPUT MACRO TO PUT THE UPDATED VTOC BACK. IF     @Y30LB37*/
*   /* AN ERROR OCCURS THEN SET RETURN CODE TO TESTRC.       @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0421
*   IF VTOCPRC=0 THEN                                              0421
@RF00400 LTR   VTOCPRC,VTOCPRC                                     0421
         BNZ   @RF00421                                            0421
*     DO;                           /*                       @Y30LB37*/
*       CALL IDCIOPT0(GDTTBL,IOCSPTR);/*                     @Y30LB37*/
         L     @05,@PC00001                                        0423
         ST    @05,@AL00001                                        0423
         LA    @03,IOCSPTR                                         0423
         ST    @03,@AL00001+4                                      0423
         MVI   @AL00001+4,X'80'                                    0423
         L     @15,GDTPUT(,@05)                                    0423
         LA    @01,@AL00001                                        0423
         BALR  @14,@15                                             0423
*       RESPECIFY                                                  0424
*         RTNREG RSTD;                                             0424
*       TESTRC=RTNREG;                                             0425
         STH   RTNREG,TESTRC                                       0425
*       RESPECIFY                                                  0426
*         RTNREG UNRSTD;            /*                       @Y30LB37*/
*       IF TESTRC^=0 THEN                                          0427
         LH    @05,TESTRC                                          0427
         LTR   @05,@05                                             0427
         BZ    @RF00427                                            0427
*         VTOCPRC=TESTRC;           /*                       @Y30LB37*/
         LR    VTOCPRC,@05                                         0428
*     END;                          /*                       @Y30LB37*/
*                                                                  0429
@RF00427 DS    0H                                                  0430
*   /*****************************************************************/
*   /*                                                               */
*   /* ISSUE A UPRINT MACRO IF AN ERROR OCCURRED UPDATING    @Y30LB37*/
*   /* FORMAT 4 DSCB.                                        @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0430
*   IF VTOCPRC^=0 THEN                                             0430
@RF00421 LTR   VTOCPRC,VTOCPRC                                     0430
         BZ    @RF00430                                            0430
*     DO;                           /*                       @Y30LB37*/
*                                                                  0431
*       /*************************************************************/
*       /*                                                           */
*       /* IF THE TIME COULD NOT BE UPDATED, ISSUE MESSAGE   @Y30LB37*/
*       /* IDC1968I. ISSUE THREE DIFFERENT VERSIONS OF       @Y30LB37*/
*       /* IDC1968I ACCORDING TO THE WAY VSMSG IS SET.       @Y30LB37*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0432
*       IF VSTIME=ON THEN                                          0432
         TM    VSTIME(ARGLPTR),B'10000000'                         0432
         BNO   @RF00432                                            0432
*         DO;                       /*                       @Y30LB37*/
*           DARGSMOD=MSGMODID;      /*                       @Y30LB37*/
         L     @05,DDSTRU                                          0434
         MVC   DARGSMOD(3,@05),@CC01408                            0434
*           DARGDBP=VSVOLP;         /*                       @Y30LB37*/
         L     @03,VSVOLP(,ARGLPTR)                                0435
         ST    @03,DARGDBP(,@05)                                   0435
*           DARGILP=VOLSERLN;       /*                       @Y30LB37*/
         MVC   DARGILP(2,@05),@CH00035                             0436
*           IF VSTOV=OFF&VSFROMV=OFF THEN                          0437
         TM    VSTOV(ARGLPTR),B'11000000'                          0437
         BNZ   @RF00437                                            0437
*             DARGSENT=MSG1968A;    /*                       @Y30LB37*/
         MVI   DARGSENT(@05),X'0B'                                 0438
*           ELSE                                                   0439
*             IF VSTOV=ON THEN                                     0439
         B     @RC00437                                            0439
@RF00437 TM    VSTOV(ARGLPTR),B'01000000'                          0439
         BNO   @RF00439                                            0439
*               DARGSENT=MSG1968B;  /*                       @Y30LB37*/
         L     @05,DDSTRU                                          0440
         MVI   DARGSENT(@05),X'13'                                 0440
*             ELSE                                                 0441
*               IF VSFROMV=ON THEN                                 0441
         B     @RC00439                                            0441
@RF00439 TM    VSFROMV(ARGLPTR),B'10000000'                        0441
         BNO   @RF00441                                            0441
*                 DARGSENT=MSG1968C;/*                       @Y30LB37*/
         L     @05,DDSTRU                                          0442
         MVI   DARGSENT(@05),X'14'                                 0442
*           CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*          @Y30LB37*/
@RF00441 DS    0H                                                  0443
@RC00439 DS    0H                                                  0443
@RC00437 L     @05,@PC00001                                        0443
         ST    @05,@AL00001                                        0443
         LA    @03,@CF00120                                        0443
         ST    @03,@AL00001+4                                      0443
         LA    @03,DDSTRU                                          0443
         ST    @03,@AL00001+8                                      0443
         MVI   @AL00001+8,X'80'                                    0443
         L     @15,GDTPRT(,@05)                                    0443
         LA    @01,@AL00001                                        0443
         BALR  @14,@15                                             0443
*         END;                      /*                       @Y30LB37*/
*                                                                  0445
*       /*************************************************************/
*       /*                                                           */
*       /* IF ALTERNATE TRACK INFORMATION COULD NOT BE       @Y30LB37*/
*       /* UPDATED, THEN ISSUE ERROR MESSAGE IDC1969I.       @Y30LB37*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0445
*       IF VSALTTRK=ON THEN                                        0445
@RF00432 TM    VSALTTRK(ARGLPTR),B'01000000'                       0445
         BNO   @RF00445                                            0445
*         DO;                       /*                       @Y30LB37*/
*           DARGSMOD=MSGMODID;      /*                       @Y30LB37*/
         L     @05,DDSTRU                                          0447
         MVC   DARGSMOD(3,@05),@CC01408                            0447
*           DARGSENT=MSG1969I;      /*                       @Y30LB37*/
         MVI   DARGSENT(@05),X'0C'                                 0448
*           DARGDBP=VSVOLP;         /*                       @Y30LB37*/
         L     @03,VSVOLP(,ARGLPTR)                                0449
         ST    @03,DARGDBP(,@05)                                   0449
*           DARGILP=VOLSERLN;       /*                       @Y30LB37*/
         MVC   DARGILP(2,@05),@CH00035                             0450
*           CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*          @Y30LB37*/
*                                                                  0451
         L     @05,@PC00001                                        0451
         ST    @05,@AL00001                                        0451
         LA    @03,@CF00120                                        0451
         ST    @03,@AL00001+4                                      0451
         LA    @03,DDSTRU                                          0451
         ST    @03,@AL00001+8                                      0451
         MVI   @AL00001+8,X'80'                                    0451
         L     @15,GDTPRT(,@05)                                    0451
         LA    @01,@AL00001                                        0451
         BALR  @14,@15                                             0451
*           /*********************************************************/
*           /*                                                       */
*           /* IF ALTERNATE TRACK INFORMATION COULD NOT BE   @Y30LB37*/
*           /* UPDATED, THEN ISSUE ERROR MESSAGE IDC0970I,   @Y30LB37*/
*           /* INSERTING THE CALLERS UPDATE INFORMATION IN   @Y30LB37*/
*           /* THE VS1AGL. ISSUE UPRINT MACRO.               @Y30LB37*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  0452
*           IF V1NXAREA^=ZEROFLD4&V1NUAREA^=ZEROFLD2 THEN          0452
         L     @05,VSNXTATP(,ARGLPTR)                              0452
         CLC   V1NXAREA(4,@05),ZEROFLD4                            0452
         BE    @RF00452                                            0452
         L     @03,VSNUMATP(,ARGLPTR)                              0452
         CLC   V1NUAREA(2,@03),ZEROFLD2                            0452
         BE    @RF00452                                            0452
*             DO;                   /*                       @Y30LB37*/
*               PRINTARG=''B;       /*                       @Y30LB37*/
         XC    PRINTARG(44),PRINTARG                               0454
*               DARGSMOD=MSGMODID;  /*                       @Y30LB37*/
         L     @15,DDSTRU                                          0455
         MVC   DARGSMOD(3,@15),@CC01408                            0455
*               DARGSENT=MSG0970I;  /*                       @Y30LB37*/
         MVI   DARGSENT(@15),X'16'                                 0456
*               DARGDBP=VSNUMATP;   /*                       @Y30LB37*/
         ST    @03,DARGDBP(,@15)                                   0457
*               DARGILP=LENGTH(V1NUAREA);/*                  @Y30LB37*/
         MVC   DARGILP(2,@15),@CH00159                             0458
*               DARGCNT=1;          /*                       @Y30LB37*/
         LA    @03,1                                               0459
         STH   @03,DARGCNT(,@15)                                   0459
*               DARGINS(1)=ONE;     /*                       @Y30LB37*/
         STH   @03,DARGINS(,@15)                                   0460
*               DARGDTM(1)=VSNXTATP;/*                       @Y30LB37*/
         ST    @05,DARGDTM(,@15)                                   0461
*               DARGINL(1)=LENGTH(V1NXAREA);/*               @Y30LB37*/
         MVC   DARGINL(2,@15),@CH00046                             0462
*               CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*      @Y30LB37*/
         L     @03,@PC00001                                        0463
         ST    @03,@AL00001                                        0463
         LA    @15,@CF00120                                        0463
         ST    @15,@AL00001+4                                      0463
         LA    @15,DDSTRU                                          0463
         ST    @15,@AL00001+8                                      0463
         MVI   @AL00001+8,X'80'                                    0463
         L     @15,GDTPRT(,@03)                                    0463
         LA    @01,@AL00001                                        0463
         BALR  @14,@15                                             0463
*             END;                  /*                       @Y30LB37*/
*         END;                      /*                       @Y30LB37*/
@RF00452 DS    0H                                                  0466
*     END;                          /*                       @Y30LB37*/
@RF00445 DS    0H                                                  0467
*   RETURN CODE(VTOCPRC);           /* RETURN TO MAIN ROUTINE      0467
*                                                            @Y30LB37*/
@RF00430 LR    @15,VTOCPRC                                         0467
         L     @14,@SA00003                                        0467
         LM    @00,@12,@SA00003+8                                  0467
         BR    @14                                                 0467
*   END VTOCPUT;                    /* END OF VTOCPUT PROC   @Y30LB37*/
*                                                                  0469
*/********************************************************************/
*/*                                                                  */
*/*  PROCEDURE NAME - VTOCOPEN                               @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  FUNCTION - THIS PROCEDURE OPENS THE VTOC FOR BSAM       @Y30LB37*/
*/*             UPDATE PROCESSING AND RESERVES THE           @Y30LB37*/
*/*             VOLUME IF REQUESTED.  VTOCOPEN CALLS UPRINT  @Y30LB37*/
*/*             TO PRINT ERROR MESSAGE IDC2971I IF THE       @Y30LB37*/
*/*             RESERVE WAS NOT SUCCESSFUL.                  @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  INPUT - THE INFORMATION PASSED IN THE VS1AGL ARGUMENT   @Y30LB37*/
*/*          LIST:  FIELDS VSRES, VSFILEP, AND VSVOLP.  IT   @Y30LB37*/
*/*          ALSO USES FIELD VSUCBP TO DETERMINE IF USYSINFO @Y30LB37*/
*/*          SHOULD BE CALLED IF VSUCBP POINTS TO ZEROS.     @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  OUTPUT- THE INFORMATION RETURNED IS EITHER A ZERO       @Y30LB37*/
*/*          OR FOUR ERROR CODE.  VSIOP FIELD IS SET WITH    @Y30LB37*/
*/*          ADDRESS OF IOCSTR FOR VTOC.  UCB ADDRESS IS     @Y30LB37*/
*/*          RETURNED IN AREA POINTED TO BY THE              @Y30LB37*/
*/*          VS1AGL.  RETURN CODES ARE:                      @Y30LB37*/
*/*          0 - SUCCESSFUL                                  @Y30LB37*/
*/*          4 - VTOC OPEN WAS UNSUCCESSFUL                  @Y30LB37*/
*/*              ERROR RETRIEVING UCB ADDRESS                @Y30LB37*/
*/*              ERROR RESERVING VOLUME                      @Y30LB37*/
*/*                                                                  */
*/********************************************************************/
*                                                                  0469
*VTOCOPEN:                                                         0469
*   PROCEDURE;                      /*                       @Y30LB37*/
VTOCOPEN STM   @14,@12,@SA00004                                    0469
*                                                                  0470
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL DECLARATIONS FOR VTOCOPEN                       @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0470
*   DCL                                                            0470
*     VTOCORC FIXED(15);            /* VTOCOPEN RETURN CODE  @Y30LB37*/
*   DCL                                                            0471
*     OPNLIST CHAR(LENGTH(OPNAGL))  /* OPNAGL GETMAINED      @Y30LB37*/
*         BDY(WORD);                /* AREA                  @Y30LB37*/
*   DCL                                                            0472
*     1 DSNAME BDY(WORD) STATIC,    /* DSNAME FIELD FOR VTOC @Y30LB37*/
*      2 *(44) CHAR(1) INIT((44)'04'X);/* INITIALIZED        @Y30LB37*/
*   DCL                                                            0473
*     BLKSIZ96 FIXED(31) CONSTANT(96);/* BLOCK SIZE 96       @Y30LB37*/
*   DCL                                                            0474
*     KEYLEN44 FIXED(8) CONSTANT(44);/* KEY LENGTH OF 44     @Y30LB37*/
*   DCL                                                            0475
*     1 CNTVOL BDY(WORD),           /* COUNT AND VOLSER      @Y30LB37*/
*      2 COUNT FIXED(8),            /* NUMBER VOLSERS        @Y30LB37*/
*      2 VOLLAB CHAR(6);            /* VOLUME SERIAL         @Y30LB37*/
*   DCL                                                            0476
*     1 MINORNAM BDY(WORD),         /* MINOR NAME DSECT      @Y30LB37*/
*      2 MINLEN FIXED(8),           /* MINOR NAME LENGTH     @Y30LB37*/
*      2 MINVOL CHAR(6),            /* MINOR VOLUME SERIAL   @Y30LB37*/
*      2 MINCON CHAR(16);           /* MINOR CONSTANT NAME   @Y30LB37*/
*   DCL                                                            0477
*     MAJNAME CHAR(8) STATIC        /* URESERVE MAJOR NAME   @Y30LB37*/
*         BDY(WORD) INIT('SYSZAMS ');/* INITIALIZED          @Y30LB37*/
*   DCL                                                            0478
*     MINRNAME CHAR(13) STATIC      /* URESERVE MINOR NAME   @Y30LB37*/
*         BDY(WORD) INIT('.REAL.RESERVE');/* INITIALIZED     @Y30LB37*/
*   DCL                                                            0479
*     MINVNAME CHAR(16) STATIC      /* URESERVE MINOR NAME   @Y30LB37*/
*         BDY(WORD) INIT('.VIRTUAL.RESERVE');/* INITIALIZED  @Y30LB37*/
*                                                                  0480
*   /*****************************************************************/
*   /*                                                               */
*   /* INITIALIZE THE OPNAGL ARGUMENT LIST AND ISSUE THE     @Y30LB37*/
*   /* UOPEN MACRO TO OPEN THE VTOC. IF FAILS ISSUE THE      @Y30LB37*/
*   /* UCLOSE MACRO IF THE IOCSPTR IS NOT ZEROS AND SET      @Y30LB37*/
*   /* THE RETURN CODE TO RCFAIL AND THE IOCSTR POINTER      @Y30LB37*/
*   /* FIELD IN THE VS1AGL TO ZERO.                          @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0480
*   OLDERID2=NEWERID2;                                             0480
         L     @03,@PC00001                                        0480
         L     @15,GDTTR2(,@03)                                    0480
         MVC   @TS00001(95),NEWERID2(@15)                          0480
         MVC   OLDERID2(95,@15),@TS00001                           0480
*   NEWID2='VSVT';                  /* ISSUE UTRACE MACRO    @Y30LB37*/
         MVC   NEWID2(4,@15),@CC01519                              0481
*   VTOCORC=0;                      /* SET RETURN CODE TO 0  @Y30LB37*/
         SLR   VTOCORC,VTOCORC                                     0482
*   OPNPTR=ADDR(OPNLIST);           /* INITIALIZE OPNAGL PTR @Y30LB37*/
         LA    OPNPTR,OPNLIST                                      0483
*   OPNAGL=''B;                     /* CLEAR THE OPEN AGL    @Y30LB37*/
         XC    OPNAGL(48,OPNPTR),OPNAGL(OPNPTR)                    0484
*   OPNOPTUP=ON;                    /* UPDATE OPTION FLAG    @Y30LB37*/
*   OPNOPTBK=ON;                    /* FIXED BLOCK OPTION    @Y30LB37*/
         OI    OPNOPTUP(OPNPTR),B'00110000'                        0486
*   OPNRFMFX=ON;                    /* RECFM FIXED OPTION    @Y30LB37*/
         OI    OPNRFMFX(OPNPTR),B'10000000'                        0487
*   OPNOPTJM=ON;                    /* OPEN TYPE J OPTION    @Y30LB37*/
         OI    OPNOPTJM(OPNPTR),B'00100000'                        0488
*   OPNDSOPS=ON;                    /* DSORG PS              @Y30LB37*/
         OI    OPNDSOPS(OPNPTR),B'01000000'                        0489
*   OPNIOC=ADDR(IOCSPTR);           /* INITIALIZE IOCSTR PTR @Y30LB37*/
         LA    @15,IOCSPTR                                         0490
         ST    @15,OPNIOC(,OPNPTR)                                 0490
*   OPNDDN=VSFILEP;                 /* DDNAME POINTER        @Y30LB37*/
         L     @15,VSFILEP(,ARGLPTR)                               0491
         ST    @15,OPNDDN(,OPNPTR)                                 0491
*   OPNBLK=BLKSIZ96;                /* BLKSIZE OF 96         @Y30LB37*/
         MVC   OPNBLK(4,OPNPTR),@CF01150                           0492
*   OPNKYL=KEYLEN44;                /* KEY LENGTH OF 44      @Y30LB37*/
         MVI   OPNKYL(OPNPTR),X'2C'                                0493
*   COUNT=ONE;                      /* ONE VOLSER PASSED     @Y30LB37*/
         MVI   COUNT,X'01'                                         0494
*   VOLLAB=V1VOLA;                  /* VOLUME LABEL          @Y30LB37*/
         L     @01,VSVOLP(,ARGLPTR)                                0495
         MVC   VOLLAB(6),V1VOLA(@01)                               0495
*   OPNVOL=ADDR(CNTVOL);            /* ADDRESS OF VOLSER/CNT @Y30LB37*/
         LA    @15,CNTVOL                                          0496
         ST    @15,OPNVOL(,OPNPTR)                                 0496
*   OPNDSN=ADDR(DSNAME);            /* DSNAME ADDRESS        @Y30LB37*/
         LA    @15,DSNAME                                          0497
         ST    @15,OPNDSN(,OPNPTR)                                 0497
*   CALL IDCIOOP0(GDTTBL,OPNAGL);   /* ISSUE UOPEN MACRO     @Y30LB37*/
         ST    @03,@AL00001                                        0498
         ST    OPNPTR,@AL00001+4                                   0498
         MVI   @AL00001+4,X'80'                                    0498
         L     @15,GDTOPN(,@03)                                    0498
         LA    @01,@AL00001                                        0498
         BALR  @14,@15                                             0498
*   RESPECIFY                                                      0499
*     RTNREG RSTD;                                                 0499
*   TESTRC=RTNREG;                                                 0500
         STH   RTNREG,TESTRC                                       0500
*   RESPECIFY                                                      0501
*     RTNREG UNRSTD;                /*                       @Y30LB37*/
*   IF TESTRC^=0 THEN                                              0502
         LH    @15,TESTRC                                          0502
         SLR   @14,@14                                             0502
         CR    @15,@14                                             0502
         BE    @RF00502                                            0502
*     DO;                           /*                       @Y30LB37*/
*       VTOCORC=4;                  /*                       @Y30LB37*/
         LA    VTOCORC,4                                           0504
*       IF IOCSPTR^=NULLPTR THEN                                   0505
         C     @14,IOCSPTR                                         0505
         BE    @RF00505                                            0505
*         CALL IDCIOCL0(GDTTBL,IOCSPTR);/*                   @Y30LB37*/
         L     @15,@PC00001                                        0506
         ST    @15,@AL00001                                        0506
         LA    @14,IOCSPTR                                         0506
         ST    @14,@AL00001+4                                      0506
         MVI   @AL00001+4,X'80'                                    0506
         L     @15,GDTCLS(,@15)                                    0506
         LA    @01,@AL00001                                        0506
         BALR  @14,@15                                             0506
*       VSIOP=NULLPTR;              /*                       @Y30LB37*/
@RF00505 SLR   @15,@15                                             0507
         ST    @15,VSIOP(,ARGLPTR)                                 0507
*     END;                          /*                       @Y30LB37*/
*                                                                  0508
*   /*****************************************************************/
*   /*                                                               */
*   /* IF UOPEN SUCCESSFUL SET IOCSTR POINTER IN VS1AGL.     @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0509
*   ELSE                                                           0509
*     VSIOP=IOCSPTR;                /*                       @Y30LB37*/
         B     @RC00502                                            0509
@RF00502 L     @15,IOCSPTR                                         0509
         ST    @15,VSIOP(,ARGLPTR)                                 0509
*                                                                  0510
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THE VTOC WAS OPENED SUCCESSFULLY, THEN IF A        @Y30LB37*/
*   /* RESERVE WAS REQUESTED CHECK TO SEE IF THE CALLER      @Y30LB37*/
*   /* SPECIFIED A UCB ADDRESS. IF NOT, THEN ISSUE A         @Y30LB37*/
*   /* USYSINFO MACRO TO OBTAIN THE UCB ADDRESS AND PUT      @Y30LB37*/
*   /* THE UCB ADDRESS IN THE CALLER'S AREA. IF USYSINFO     @Y30LB37*/
*   /* WAS NOT SUCCESSFUL, SET THE RETURN CODE TO RCFAIL.    @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0510
*   IF VTOCORC=0 THEN                                              0510
@RC00502 SLR   @15,@15                                             0510
         CR    VTOCORC,@15                                         0510
         BNE   @RF00510                                            0510
*     IF VSRES=ON THEN                                             0511
         TM    VSRES(ARGLPTR),B'10000000'                          0511
         BNO   @RF00511                                            0511
*       IF V1UCBADR=NULLPTR THEN                                   0512
         L     @01,VSUCBP(,ARGLPTR)                                0512
         C     @15,V1UCBADR(,@01)                                  0512
         BNE   @RF00512                                            0512
*         DO;                       /*                       @Y30LB37*/
*           CALL IDCSASI0(GDTTBL,UNIT,INFOPTR,V1DDNAM);/*    @Y30LB37*/
         L     @15,@PC00001                                        0514
         ST    @15,@AL00001                                        0514
         LA    @14,UNIT                                            0514
         ST    @14,@AL00001+4                                      0514
         LA    @14,INFOPTR                                         0514
         ST    @14,@AL00001+8                                      0514
         L     @01,VSFILEP(,ARGLPTR)                               0514
         ST    @01,@AL00001+12                                     0514
         MVI   @AL00001+12,X'80'                                   0514
         L     @15,GDTSFO(,@15)                                    0514
         LA    @01,@AL00001                                        0514
         BALR  @14,@15                                             0514
*           RESPECIFY                                              0515
*             RTNREG RSTD;                                         0515
*           TESTRC=RTNREG;                                         0516
         STH   RTNREG,TESTRC                                       0516
*           RESPECIFY                                              0517
*             RTNREG UNRSTD;        /*                       @Y30LB37*/
*           IF TESTRC=0 THEN                                       0518
         LH    @15,TESTRC                                          0518
         LTR   @15,@15                                             0518
         BNZ   @RF00518                                            0518
*             V1UCBADR=UNITUCB;     /*                       @Y30LB37*/
         L     @01,VSUCBP(,ARGLPTR)                                0519
         L     @15,INFOPTR                                         0519
         L     @00,UNITUCB(,@15)                                   0519
         ST    @00,V1UCBADR(,@01)                                  0519
*           ELSE                                                   0520
*             VTOCORC=4;            /*                       @Y30LB37*/
         B     @RC00518                                            0520
@RF00518 LA    VTOCORC,4                                           0520
*         END;                      /*                       @Y30LB37*/
@RC00518 DS    0H                                                  0522
*                                                                  0522
*   /*****************************************************************/
*   /*                                                               */
*   /* IF ALL IS SUCCESSFUL AND A RESERVE REQUEST WAS        @Y30LB37*/
*   /* SPECIFIED, THEN ISSUE A URESERVE MACRO. SET THE       @Y30LB37*/
*   /* MINOR NAME FOR VIRTUAL OR REAL VOLUME SERIAL NUMBER   @Y30LB37*/
*   /* ACCORDING TO CALLER'S REQUEST. IF THE URESERVE        @Y30LB37*/
*   /* MACRO IS UNSUCCESSFUL THEN ISSUE ERROR MESSAGE        @Y30LB37*/
*   /* IDC2971I VIA THE UPRINT MACRO AND SET RETURN CODE     @Y30LB37*/
*   /* TO RCFAIL.                                            @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0522
*   IF VTOCORC=0 THEN                                              0522
@RF00512 DS    0H                                                  0522
@RF00511 DS    0H                                                  0522
@RF00510 LTR   VTOCORC,VTOCORC                                     0522
         BNZ   @RF00522                                            0522
*     IF VSRES=ON THEN                                             0523
         TM    VSRES(ARGLPTR),B'10000000'                          0523
         BNO   @RF00523                                            0523
*       DO;                         /*                       @Y30LB37*/
*         IF VSREAL=ON THEN                                        0525
         TM    VSREAL(ARGLPTR),B'01000000'                         0525
         BNO   @RF00525                                            0525
*           DO;                     /*                       @Y30LB37*/
*             MINCON=MINRNAME;      /*                       @Y30LB37*/
         MVI   MINCON+13,C' '                                      0527
         MVC   MINCON+14(2),MINCON+13                              0527
         MVC   MINCON(13),MINRNAME                                 0527
*             MINLEN=LENGTH(MINRNAME)+VOLSERLN;/*            @Y30LB37*/
         MVI   MINLEN,X'13'                                        0528
*           END;                    /*                       @Y30LB37*/
*         ELSE                                                     0530
*           DO;                     /*                       @Y30LB37*/
         B     @RC00525                                            0530
@RF00525 DS    0H                                                  0531
*             MINCON=MINVNAME;      /*                       @Y30LB37*/
         MVC   MINCON(16),MINVNAME                                 0531
*             MINLEN=LENGTH(MINVNAME)+VOLSERLN;/*            @Y30LB37*/
         MVI   MINLEN,X'16'                                        0532
*           END;                    /*                       @Y30LB37*/
*         MINVOL=V1VOLA;            /*                       @Y30LB37*/
@RC00525 L     @01,VSVOLP(,ARGLPTR)                                0534
         MVC   MINVOL(6),V1VOLA(@01)                               0534
*         CALL IDCSARV0(GDTTBL,EXCL,WAIT,V1UCBADR,MAJNAME,MINORNAM);
         L     @15,@PC00001                                        0535
         ST    @15,@AL00001                                        0535
         LA    @14,EXCL                                            0535
         ST    @14,@AL00001+4                                      0535
         LA    @14,WAIT                                            0535
         ST    @14,@AL00001+8                                      0535
         L     @01,VSUCBP(,ARGLPTR)                                0535
         ST    @01,@AL00001+12                                     0535
         LA    @14,MAJNAME                                         0535
         ST    @14,@AL00001+16                                     0535
         LA    @14,MINORNAM                                        0535
         ST    @14,@AL00001+20                                     0535
         MVI   @AL00001+20,X'80'                                   0535
         L     @15,GDTRSV(,@15)                                    0535
         LA    @01,@AL00001                                        0535
         BALR  @14,@15                                             0535
*                                   /*                       @ZA05123*/
*         RESPECIFY                                                0536
*           RTNREG RSTD;                                           0536
*         TESTRC=RTNREG;                                           0537
         STH   RTNREG,TESTRC                                       0537
*         RESPECIFY                                                0538
*           RTNREG UNRSTD;          /*                       @Y30LB37*/
*         IF TESTRC^=0 THEN                                        0539
         LH    @15,TESTRC                                          0539
         LTR   @15,@15                                             0539
         BZ    @RF00539                                            0539
*           DO;                     /*                       @Y30LB37*/
*             VTOCORC=4;            /*                       @Y30LB37*/
         LA    VTOCORC,4                                           0541
*             DARGSMOD=MSGMODID;    /*                       @Y30LB37*/
         L     @15,DDSTRU                                          0542
         MVC   DARGSMOD(3,@15),@CC01408                            0542
*             DARGSENT=MSG2971I;    /*                       @Y30LB37*/
         MVI   DARGSENT(@15),X'15'                                 0543
*             DARGDBP=VSVOLP;       /*                       @Y30LB37*/
         L     @14,VSVOLP(,ARGLPTR)                                0544
         ST    @14,DARGDBP(,@15)                                   0544
*             DARGILP=VOLSERLN;     /*                       @Y30LB37*/
         MVC   DARGILP(2,@15),@CH00035                             0545
*             CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*        @Y30LB37*/
         L     @15,@PC00001                                        0546
         ST    @15,@AL00001                                        0546
         LA    @14,@CF00120                                        0546
         ST    @14,@AL00001+4                                      0546
         LA    @14,DDSTRU                                          0546
         ST    @14,@AL00001+8                                      0546
         MVI   @AL00001+8,X'80'                                    0546
         L     @15,GDTPRT(,@15)                                    0546
         LA    @01,@AL00001                                        0546
         BALR  @14,@15                                             0546
*           END;                    /*                       @Y30LB37*/
*       END;                        /*                       @Y30LB37*/
@RF00539 DS    0H                                                  0549
*   RETURN CODE(VTOCORC);           /* RETURN TO MAIN ROUTINE      0549
*                                                            @Y30LB37*/
@RF00523 DS    0H                                                  0549
@RF00522 LR    @15,VTOCORC                                         0549
         L     @14,@SA00004                                        0549
         LM    @00,@12,@SA00004+8                                  0549
         BR    @14                                                 0549
*   END VTOCOPEN;                   /* END OF VTOCOPEN PROC  @Y30LB37*/
*                                                                  0551
*/********************************************************************/
*/*                                                                  */
*/*  PROCEDURE NAME - FMT4READ                               @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  FUNCTION - THIS PROCEDURE READS AND TESTS INFORMATION   @Y30LB37*/
*/*             FOR A FORMAT 4 DSCB.  FMT4READ CALLS UPRINT  @Y30LB37*/
*/*             TO PRINT ERROR MESSAGE IDC2963I IF AN ERROR  @Y30LB37*/
*/*             OCCURRED READING THE FORMAT 4 DSCB.          @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  INPUT - THE INFORMATION PASSED IN THE VS1AGL ARGUMENT   @Y30LB37*/
*/*          LIST:  FIELDS VSIOP, VSFILEP, VSVOLP, AND       @Y30LB37*/
*/*          UNITVTOC IN UNITABL SET TO 0 OR TTR TO VTOC.    @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  OUTPUT- THE INFORMATION RETURNED IS A ZERO OR FOUR      @Y30LB37*/
*/*          ERROR CODE.  THE UNITVTOC FIELD IS SET WITH     @Y30LB37*/
*/*          THE TTR TO THE VTOC.  THE POINTER TO THE        @Y30LB37*/
*/*          FORMAT 4 DSCB IS SET.                           @Y30LB37*/
*/*          RETURN CODES ARE:                               @Y30LB37*/
*/*          0 - SUCCESSFUL                                  @Y30LB37*/
*/*          4 - VTOC READ WAS UNSUCCESSFUL                  @Y30LB37*/
*/*              FIRST RECORD WAS NOT A FORMAT 4             @Y30LB37*/
*/*              ERROR RETRIEVING TTR TO THE VTOC            @Y30LB37*/
*/*                                                                  */
*/********************************************************************/
*                                                                  0551
*FMT4READ:                                                         0551
*   PROCEDURE;                      /*                       @Y30LB37*/
*                                                                  0551
FMT4READ STM   @14,@12,@SA00005                                    0551
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL DECLARATIONS FOR FMT4READ                       @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0552
*   DCL                                                            0552
*     FMT4RRC FIXED(15);            /* FMT4READ RETURN CODE  @Y30LB37*/
*   DCL                                                            0553
*     FORMAT4R CHAR(1) STATIC INIT('F4'X);/* CONSTANT F4     @Y30LB37*/
*   DCL                                                            0554
*     RELATTRZ CHAR(4) STATIC       /* RELATIVE TRACK NO     @Y30LB37*/
*         INIT('00000100'X);        /* FOR VTOC              @Y30LB37*/
*                                                                  0555
*   /*****************************************************************/
*   /*                                                               */
*   /* INITITALIZE AND ISSUE UTRACE MACRO AND INITIALIZE     @Y30LB37*/
*   /* FORMAT FOUR READ RETURN CODE.                         @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0555
*   OLDERID2=NEWERID2;                                             0555
         L     @05,@PC00001                                        0555
         L     @03,GDTTR2(,@05)                                    0555
         MVC   @TS00001(95),NEWERID2(@03)                          0555
         MVC   OLDERID2(95,@03),@TS00001                           0555
*   NEWID2='VS4R';                  /* ISSUE UTRACE MACRO    @Y30LB37*/
         MVC   NEWID2(4,@03),@CC01528                              0556
*   FMT4RRC=0;                      /*                       @Y30LB37*/
*                                                                  0557
         SLR   FMT4RRC,FMT4RRC                                     0557
*   /*****************************************************************/
*   /*                                                               */
*   /* ISSUE THE UPOSIT MACRO TO POSITION TO THE TTR.        @Y30LB37*/
*   /* THE ONLY POSSIBLE RETURN CODE IS ZERO FROM UPOSIT.    @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0558
*   IOCTTR=RELATTRZ;                /*                       @Y30LB37*/
         L     @03,IOCSPTR                                         0558
         MVC   IOCTTR(4,@03),RELATTRZ                              0558
*   CALL IDCIOPO0(GDTTBL,IOCSPTR);  /*                       @Y30LB37*/
         ST    @05,@AL00001                                        0559
         LA    @03,IOCSPTR                                         0559
         ST    @03,@AL00001+4                                      0559
         MVI   @AL00001+4,X'80'                                    0559
         L     @15,GDTPOS(,@05)                                    0559
         LA    @01,@AL00001                                        0559
         BALR  @14,@15                                             0559
*                                                                  0560
*   /*****************************************************************/
*   /*                                                               */
*   /* ISSUE A UGET MACRO TO READ THE FIRST RECORD WHICH     @Y30LB37*/
*   /* SHOULD BE THE FORMAT 4 DSCB. IF UGET IS SUCCESSFUL    @Y30LB37*/
*   /* SET THE POINTER TO THE FORMAT 4 RECORD TO THE RECORD  @Y30LB37*/
*   /* JUST READ. IF UGET FAILED SET BAD RETURN CODE.        @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0560
*   IF FMT4RRC=0 THEN                                              0560
         LTR   FMT4RRC,FMT4RRC                                     0560
         BNZ   @RF00560                                            0560
*     DO;                           /*                       @Y30LB37*/
*       CALL IDCIOGT0(GDTTBL,IOCSPTR);/*                     @Y30LB37*/
         L     @05,@PC00001                                        0562
         ST    @05,@AL00001                                        0562
         LA    @03,IOCSPTR                                         0562
         ST    @03,@AL00001+4                                      0562
         MVI   @AL00001+4,X'80'                                    0562
         L     @15,GDTGET(,@05)                                    0562
         LA    @01,@AL00001                                        0562
         BALR  @14,@15                                             0562
*       RESPECIFY                                                  0563
*         RTNREG RSTD;                                             0563
*       TESTRC=RTNREG;                                             0564
         STH   RTNREG,TESTRC                                       0564
*       RESPECIFY                                                  0565
*         RTNREG UNRSTD;            /*                       @Y30LB37*/
*       IF TESTRC=0 THEN                                           0566
         LH    @05,TESTRC                                          0566
         LTR   @05,@05                                             0566
         BNZ   @RF00566                                            0566
*         F4PTR=IOCDAD;             /*                       @Y30LB37*/
         L     @05,IOCSPTR                                         0567
         L     @05,IOCDAD(,@05)                                    0567
         ST    @05,F4PTR                                           0567
*       ELSE                                                       0568
*         FMT4RRC=4;                /*                       @Y30LB37*/
         B     @RC00566                                            0568
@RF00566 LA    FMT4RRC,4                                           0568
*     END;                          /*                       @Y30LB37*/
*                                                                  0569
@RC00566 DS    0H                                                  0570
*   /*****************************************************************/
*   /*                                                               */
*   /* ISSUE A UPRINT MACRO IF THE RECORD READ IS NOT A      @Y30LB37*/
*   /* FORMAT 4 DSCB. THE ERROR MESSAGE IS IDC2963I WITH     @Y30LB37*/
*   /* THREE VARIATIONS ACCORDING TO THE WAY VSMSG IS SET.   @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0570
*   IF FMT4RRC=0 THEN                                              0570
@RF00560 LTR   FMT4RRC,FMT4RRC                                     0570
         BNZ   @RF00570                                            0570
*     IF DS4IDFMT^=FORMAT4R THEN                                   0571
         L     @05,F4PTR                                           0571
         CLC   DS4IDFMT+44(1,@05),FORMAT4R                         0571
         BE    @RF00571                                            0571
*       DO;                         /*                       @Y30LB37*/
*         FMT4RRC=4;                /*                       @Y30LB37*/
         LA    FMT4RRC,4                                           0573
*         DARGSMOD=MSGMODID;        /*                       @Y30LB37*/
         L     @05,DDSTRU                                          0574
         MVC   DARGSMOD(3,@05),@CC01408                            0574
*         DARGDBP=VSVOLP;           /*                       @Y30LB37*/
         L     @03,VSVOLP(,ARGLPTR)                                0575
         ST    @03,DARGDBP(,@05)                                   0575
*         DARGILP=VOLSERLN;         /*                       @Y30LB37*/
         MVC   DARGILP(2,@05),@CH00035                             0576
*         IF VSFROMV=OFF&VSTOV=OFF THEN                            0577
         TM    VSFROMV(ARGLPTR),B'11000000'                        0577
         BNZ   @RF00577                                            0577
*           DARGSENT=MSG2963A;      /*                       @Y30LB37*/
         MVI   DARGSENT(@05),X'05'                                 0578
*         ELSE                                                     0579
*           IF VSFROMV=ON THEN                                     0579
         B     @RC00577                                            0579
@RF00577 TM    VSFROMV(ARGLPTR),B'10000000'                        0579
         BNO   @RF00579                                            0579
*             DARGSENT=MSG2963B;    /*                       @Y30LB37*/
         L     @05,DDSTRU                                          0580
         MVI   DARGSENT(@05),X'11'                                 0580
*           ELSE                                                   0581
*             DARGSENT=MSG2963C;    /*                       @Y30LB37*/
         B     @RC00579                                            0581
@RF00579 L     @05,DDSTRU                                          0581
         MVI   DARGSENT(@05),X'12'                                 0581
*         CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*            @Y30LB37*/
@RC00579 DS    0H                                                  0582
@RC00577 L     @05,@PC00001                                        0582
         ST    @05,@AL00001                                        0582
         LA    @03,@CF00120                                        0582
         ST    @03,@AL00001+4                                      0582
         LA    @03,DDSTRU                                          0582
         ST    @03,@AL00001+8                                      0582
         MVI   @AL00001+8,X'80'                                    0582
         L     @15,GDTPRT(,@05)                                    0582
         LA    @01,@AL00001                                        0582
         BALR  @14,@15                                             0582
*       END;                        /*                       @Y30LB37*/
*   RETURN CODE(FMT4RRC);           /* RETURN TO MAIN ROUTINE      0584
*                                                            @Y30LB37*/
@RF00571 DS    0H                                                  0584
@RF00570 LR    @15,FMT4RRC                                         0584
         L     @14,@SA00005                                        0584
         LM    @00,@12,@SA00005+8                                  0584
         BR    @14                                                 0584
*   END FMT4READ;                   /* END OF FMT4READ PROC  @Y30LB37*/
*                                                                  0586
*/********************************************************************/
*/*                                                                  */
*/*  PROCEDURE NAME - FMT1READ                               @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  FUNCTION - THIS PROCEDURE READS AND TESTS INFORMATION   @Y30LB37*/
*/*             IN A FORMAT 1 DSCB.  FMT1READ READS FORMAT   @Y30LB37*/
*/*             1 DSCBS UNTIL A DSCB IS FOUND THAT MEETS     @Y30LB37*/
*/*             THE TESTS.  FMT1READ ISSUES UGET TO GET      @Y30LB37*/
*/*             THE FORMAT 1 DSCB.                           @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  INPUT - THE INFORMATION PASSED IN THE VS1AGL ARGUMENT   @Y30LB37*/
*/*          LIST:  FIELD VSIOP.  ORGTYPE FIELD FOR WHAT     @Y30LB37*/
*/*          ORGANIZATION TO SEARCH ON.  PROTTYPE FIELD      @Y30LB37*/
*/*          FOR WHAT PROTECTION TYPE TO SEARCH ON.          @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  OUTPUT- THE INFORMATION RETURNED IS EITHER A ZERO       @Y30LB37*/
*/*          OR FOUR ERROR CODE.  EXPONLY SET TO 1 IF DATA   @Y30LB37*/
*/*          SET HAS NOT EXPIRED, SET TO 0 TO INITIALIZE.    @Y30LB37*/
*/*          SET FORMAT 1 DSCB ADDRESS IF SUCCESSFUL.        @Y30LB37*/
*/*          RETURN CODES ARE:                               @Y30LB37*/
*/*          0 - SUCCESSFUL                                  @Y30LB37*/
*/*          4 - VTOC READ WAS UNSUCCESSFUL                  @Y30LB37*/
*/*          8 - END OF FILE SEARCHING FOR A FORMAT 1        @Y30LB37*/
*/*                                                                  */
*/********************************************************************/
*                                                                  0586
*FMT1READ:                                                         0586
*   PROCEDURE(ORGTYPE,              /* ORGANIZATION TYPE     @Y30LB37*/
*       PROTTYPE);                  /* PROTECTION TYPE       @Y30LB37*/
FMT1READ STM   @14,@04,@SA00006                                    0586
         STM   @06,@12,@SA00006+28                                 0586
         MVC   @PC00006(8),0(@01)                                  0586
*                                                                  0587
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL DECLARATIONS FOR FMT1READ                       @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0587
*   DCL                                                            0587
*     FMT1RRC FIXED(15);            /* FMT1READ RETURN CODE  @Y30LB37*/
*   DCL                                                            0588
*     FORMAT1R CHAR(1) STATIC INIT('F1'X);/* CONSTANT F1     @Y30LB37*/
*   DCL                                                            0589
*     ZEROEXP CHAR(3) STATIC        /* ZERO CONSTANT FOR     @Y30LB37*/
*         INIT('000000'X);          /* EXPIRATION DATE       @Y30LB37*/
*   DCL                                                            0590
*     F1TIME CHAR(8);               /* UTIME RETURN TIME AREA      0590
*                                                            @Y30LB37*/
*   DCL                                                            0591
*     F1DATE CHAR(4);               /* UTIME RETURN DATE AREA      0591
*                                                            @Y30LB37*/
*   DCL                                                            0592
*     ORGTYPE CHAR(4);              /* DSORG TYPE PARM       @Y30LB37*/
*   DCL                                                            0593
*     PROTTYPE CHAR(8);             /* PROTECTION TYPE PARM  @Y30LB37*/
*   DCL                                                            0594
*     1 EXPDWORK CHAR(3) BDY(WORD), /* EXPIRATION DATE AREA  @Y30LB37*/
*      2 EXPYEAR BIT(8),            /* YEAR AREA             @Y30LB37*/
*      2 EXPDAY BIT(16);            /* DAY AREA              @Y30LB37*/
*   DCL                                                            0595
*     1 DATEWORK FIXED(32) BDY(WORD),/* DATE CONVERSION AREA @Y30LB37*/
*      2 * BIT(8),                  /* UNUSED                @Y30LB37*/
*      2 DAWKYEAR BIT(8),           /* CONV YEAR AREA        @Y30LB37*/
*      2 DAWKDAY BIT(16);           /* CONV DAY AREA         @Y30LB37*/
*   DCL                                                            0596
*     BIN1000 FIXED(15) CONSTANT(1000);/* 1000 BINARY        @Y30LB37*/
*                                                                  0597
*   /*****************************************************************/
*   /*                                                               */
*   /* READ THE VTOC UNTIL FORMAT 1 DSCB FOUND, END OF FILE  @Y30LB37*/
*   /* IS ENCOUNTERED, OR AN ERROR OCCURS.                   @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0597
*   OLDERID2=NEWERID2;                                             0597
         L     @04,@PC00001                                        0597
         L     @04,GDTTR2(,@04)                                    0597
         MVC   @TS00001(95),NEWERID2(@04)                          0597
         MVC   OLDERID2(95,@04),@TS00001                           0597
*   NEWID2='VS1R';                  /* ISSUE UTRACE MACRO    @Y30LB37*/
         MVC   NEWID2(4,@04),@CC01553                              0598
*   FMT1RRC=0;                      /*                       @Y30LB37*/
         SLR   FMT1RRC,FMT1RRC                                     0599
*   QUITSW=OFF;                     /*                       @Y30LB37*/
*   EXPONLY=OFF;                    /*                       @Y30LB37*/
         NI    QUITSW,B'00111111'                                  0601
*F1RDLOOP:                                                         0602
*   DO WHILE QUITSW=OFF;            /*                       @Y30LB37*/
*                                                                  0602
F1RDLOOP B     @DE00602                                            0602
@DL00602 DS    0H                                                  0603
*     /***************************************************************/
*     /*                                                             */
*     /* ISSUE A UGET MACRO TO READ A FORMAT 1 DSCB. IF      @Y30LB37*/
*     /* THE UGET IS SUCCESSFUL SET THE POINTER TO THE       @Y30LB37*/
*     /* FORMAT 1 DSCB MAPPING MACRO. IF THE READ FAILS      @Y30LB37*/
*     /* THEN SET THE RETURN CODE AND LOOP TERMINATION SW.   @Y30LB37*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0603
*     CALL IDCIOGT0(GDTTBL,IOCSPTR);/*                       @Y30LB37*/
         L     @04,@PC00001                                        0603
         ST    @04,@AL00001                                        0603
         LA    @03,IOCSPTR                                         0603
         ST    @03,@AL00001+4                                      0603
         MVI   @AL00001+4,X'80'                                    0603
         L     @15,GDTGET(,@04)                                    0603
         LA    @01,@AL00001                                        0603
         BALR  @14,@15                                             0603
*     RESPECIFY                                                    0604
*       RTNREG RSTD;                                               0604
*     TESTRC=RTNREG;                                               0605
         STH   RTNREG,TESTRC                                       0605
*     RESPECIFY                                                    0606
*       RTNREG UNRSTD;              /*                       @Y30LB37*/
*     IF TESTRC=0 THEN                                             0607
         LH    @04,TESTRC                                          0607
         LTR   @04,@04                                             0607
         BNZ   @RF00607                                            0607
*       F1PTR=IOCDAD;               /*                       @Y30LB37*/
         L     @03,IOCSPTR                                         0608
         L     F1PTR,IOCDAD(,@03)                                  0608
*     ELSE                                                         0609
*       DO;                         /*                       @Y30LB37*/
         B     @RC00607                                            0609
@RF00607 DS    0H                                                  0610
*         QUITSW=ON;                /*                       @Y30LB37*/
         OI    QUITSW,B'01000000'                                  0610
*         FMT1RRC=TESTRC;           /*                       @Y30LB37*/
         LH    FMT1RRC,TESTRC                                      0611
*       END;                        /*                       @Y30LB37*/
*                                                                  0613
*     /***************************************************************/
*     /*                                                             */
*     /* IF THE READ IS SUCCESSFUL AND THE RECORD READ IS    @Y30LB37*/
*     /* A FORMAT 1 DSCB, THEN DETERMINE IF THE RECORD READ  @Y30LB37*/
*     /* MEETS THE ORGANIZATION TYPE SPECIFIED BY THE        @Y30LB37*/
*     /* CALLER.                                             @Y30LB37*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0613
*     IF FMT1RRC=0&DS1FMTID=FORMAT1R THEN                          0613
@RC00607 LTR   FMT1RRC,FMT1RRC                                     0613
         BNZ   @RF00613                                            0613
         CLC   DS1FMTID(1,F1PTR),FORMAT1R                          0613
         BNE   @RF00613                                            0613
*       DO;                         /*                       @Y30LB37*/
*         IF ORGTYPE=ORGTNONV&DSORGAM=OFFORGTYPE^=ORGTNONV THEN   0615
         L     @04,@PC00006                                        0615
         CLC   ORGTYPE(4,@04),ORGTNONV                             0615
         BNE   @GL00003                                            0615
         TM    DSORGAM(F1PTR),B'00001000'                          0615
         BZ    @RT00615                                            0615
@GL00003 L     @04,@PC00006                                        0615
         CLC   ORGTYPE(4,@04),ORGTNONV                             0615
         BE    @RF00615                                            0615
@RT00615 DS    0H                                                  0616
*           DO;                     /*                       @Y30LB37*/
*                                                                  0616
*             /*******************************************************/
*             /*                                                     */
*             /* IF PROTTYPE IS 'READ' THEN TEST DS1DSIND    @Y30LB37*/
*             /* EITHER FOR THE RACF PROTECTION BIT TO BE ON @G24LB31*/
*             /* OR FOR THE PASSWORD PROTECTION BIT TO BE ON @G24LB31*/
*             /* AND THE READ WITHOUT PASSWORD PROTECT BIT   @Y30LB37*/
*             /* TO BE OFF INDICATING READ PROTECTION. IF    @Y30LB37*/
*             /* READ PROTECTED RETURN THE RECORD TO THE     @Y30LB37*/
*             /* CALLER, IF NOT READ ANOTHER FORMAT 1.       @Y30LB37*/
*             /*                                                     */
*             /*******************************************************/
*                                                                  0617
*             IF PROTTYPE=PROTREAD THEN                            0617
         L     @04,@PC00006+4                                      0617
         CLC   PROTTYPE(8,@04),PROTREAD                            0617
         BNE   @RF00617                                            0617
*               IF(PASSPROT=ON&READOK=OFF)/*                @G24LB31*/
*                   PROTRACF=ON THEN/*                       @G24LB31*/
         TM    PASSPROT(F1PTR),B'00010000'                         0618
         BNO   @GL00005                                            0618
         TM    READOK(F1PTR),B'00000100'                           0618
         BZ    @RT00618                                            0618
@GL00005 TM    PROTRACF(F1PTR),B'01000000'                         0618
         BNO   @RF00618                                            0618
@RT00618 DS    0H                                                  0619
*                 QUITSW=ON;        /*                       @G24LB31*/
*                                                                  0619
         OI    QUITSW,B'01000000'                                  0619
*             /*******************************************************/
*             /*                                                     */
*             /* IF PROTTYPE IS 'WRITE' THEN TEST IF THE     @Y30LB37*/
*             /* DS1DSIND RACF PROTECTION BIT IS ON OR THE   @G24LB31*/
*             /* DS1DSIND PASSWORD PROTECTION BIT IS         @Y30LB37*/
*             /* ON INDICATING READ PROTECTION AND           @Y30LB37*/
*             /* WRITE PROTECTION. THE READ WITHOUT          @Y30LB37*/
*             /* PASSWORD PROTECTION BIT CAN BE IGNORED.     @Y30LB37*/
*             /* IF BOTH PROTECTED RETURN THE RECORD TO THE  @Y30LB37*/
*             /* CALLER, IF NOT THEN CHECK THE EXPIRATION    @Y30LB37*/
*             /* DATE.                                       @Y30LB37*/
*             /*                                                     */
*             /*******************************************************/
*                                                                  0620
*             IF PROTTYPE=PROTRITE THEN                            0620
@RF00618 DS    0H                                                  0620
@RF00617 L     @04,@PC00006+4                                      0620
         CLC   PROTTYPE(8,@04),PROTRITE                            0620
         BNE   @RF00620                                            0620
*               IF PASSPROT=ONPROTRACF=ON THEN/*            @G24LB31*/
         TM    PASSPROT(F1PTR),B'01010000'                         0621
         BZ    @RF00621                                            0621
*                 QUITSW=ON;        /*                       @Y30LB37*/
         OI    QUITSW,B'01000000'                                  0622
*               ELSE                                               0623
*                 IF DS1EXPDT^=ZEROEXP THEN                        0623
         B     @RC00621                                            0623
@RF00621 CLC   DS1EXPDT(3,F1PTR),ZEROEXP                           0623
         BE    @RF00623                                            0623
*                   DO;             /*                       @Y30LB37*/
*                                                                  0625
*                     /***********************************************/
*                     /*                                             */
*                     /* ISSUE A UTIME MACRO TO GET THE      @Y30LB37*/
*                     /* CURRENT TIME AND DATE. CONVERT      @Y30LB37*/
*                     /* THE DATE TO BINARY AND DIVIDE BY    @Y30LB37*/
*                     /* 1000 AND THEN DETERMINE IF THE      @Y30LB37*/
*                     /* DATE ON THE FORMAT 1 HAS EXPIRED.   @Y30LB37*/
*                     /* IF IT HASN'T EXPIRED, SET THE       @Y30LB37*/
*                     /* EXPONLY SWITCH ON AND RETURN THE    @Y30LB37*/
*                     /* RECORD TO THE CALLER.               @Y30LB37*/
*                     /*                                             */
*                     /***********************************************/
*                                                                  0625
*                     EXPDWORK=DS1EXPDT;/*                   @Y30LB37*/
         MVC   EXPDWORK(3),DS1EXPDT(F1PTR)                         0625
*                     CALL IDCSATI0(GDTTBL,F1TIME,F1DATE);/* @Y30LB37*/
         L     @04,@PC00001                                        0626
         ST    @04,@AL00001                                        0626
         LA    @03,F1TIME                                          0626
         ST    @03,@AL00001+4                                      0626
         LA    @03,F1DATE                                          0626
         ST    @03,@AL00001+8                                      0626
         MVI   @AL00001+8,X'80'                                    0626
         L     @15,GDTTIM(,@04)                                    0626
         LA    @01,@AL00001                                        0626
         BALR  @14,@15                                             0626
*                     CVB(DATEWORK,F1DATE);/*                @Y30LB37*/
         XC    @TS00001(8),@TS00001                                0627
         MVC   @TS00001+4(4),F1DATE                                0627
         CVB   @04,@TS00001                                        0627
         ST    @04,DATEWORK                                        0627
*                     DATEWORK=DATEWORK/BIN1000;/*           @Y30LB37*/
         LR    @01,@04                                             0628
         SLR   @00,@00                                             0628
         D     @00,@CF01552                                        0628
         ST    @01,DATEWORK                                        0628
*                     IF DAWKYEAR<EXPYEAR THEN                     0629
         CLC   DAWKYEAR(1),EXPYEAR                                 0629
         BNL   @RF00629                                            0629
*                       DO;         /*                       @Y30LB37*/
*                         EXPONLY=ON;/*                      @Y30LB37*/
*                         QUITSW=ON;/*                       @Y30LB37*/
         OI    EXPONLY,B'11000000'                                 0632
*                       END;        /*                       @Y30LB37*/
*                     ELSE                                         0634
*                       IF DAWKYEAR=EXPYEAR THEN                   0634
         B     @RC00629                                            0634
@RF00629 CLC   DAWKYEAR(1),EXPYEAR                                 0634
         BNE   @RF00634                                            0634
*                         IF DAWKDAY<EXPDAY THEN                   0635
         CLC   DAWKDAY(2),EXPDAY                                   0635
         BNL   @RF00635                                            0635
*                           DO;     /*                       @Y30LB37*/
*                             EXPONLY=ON;/*                  @Y30LB37*/
*                             QUITSW=ON;/*                   @Y30LB37*/
         OI    EXPONLY,B'11000000'                                 0638
*                           END;    /*                       @Y30LB37*/
*                   END;            /*                       @Y30LB37*/
*                                                                  0640
@RF00635 DS    0H                                                  0640
@RF00634 DS    0H                                                  0640
@RC00629 DS    0H                                                  0641
*             /*******************************************************/
*             /*                                                     */
*             /* IF 'ALL' SPECIFIED RETURN THE RECORD TO     @Y30LB37*/
*             /* THE CALLER, IF NOT READ ANOTHER FORMAT 1.   @Y30LB37*/
*             /*                                                     */
*             /*******************************************************/
*                                                                  0641
*             IF PROTTYPE=PROTTALL THEN                            0641
@RF00623 DS    0H                                                  0641
@RC00621 DS    0H                                                  0641
@RF00620 L     @04,@PC00006+4                                      0641
         CLC   PROTTYPE(8,@04),PROTTALL                            0641
         BNE   @RF00641                                            0641
*               QUITSW=ON;          /*                       @Y30LB37*/
         OI    QUITSW,B'01000000'                                  0642
*           END;                    /*                       @Y30LB37*/
@RF00641 DS    0H                                                  0644
*       END;                        /*                       @Y30LB37*/
@RF00615 DS    0H                                                  0645
*   END F1RDLOOP;                   /*                       @Y30LB37*/
@RF00613 DS    0H                                                  0645
@DE00602 TM    QUITSW,B'01000000'                                  0645
         BZ    @DL00602                                            0645
*   IF FMT1RRC=16 THEN                                             0646
         C     FMT1RRC,@CF00509                                    0646
         BNE   @RF00646                                            0646
*     FMT1RRC=RCEOFILE;             /* CHANGE RC 16 TO AN 8  @Y30LB37*/
         LA    FMT1RRC,8                                           0647
*   RETURN CODE(FMT1RRC);           /* RETURN TO MAIN ROUTINE      0648
*                                                            @Y30LB37*/
@RF00646 LR    @15,FMT1RRC                                         0648
         L     @14,@SA00006                                        0648
         LM    @00,@04,@SA00006+8                                  0648
         LM    @06,@12,@SA00006+28                                 0648
         BR    @14                                                 0648
*   END FMT1READ;                   /* END OF FMT1READ PROC  @Y30LB37*/
*                                                                  0650
*/********************************************************************/
*/*                                                                  */
*/*  PROCEDURE NAME - RECATLOG                               @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  FUNCTION - THIS PROCEDURE RECATALOGS NON-VSAM DATA SETS @Y30LB37*/
*/*             INTO THE CATALOG.  RECATLOG CALLS            @Y30LB37*/
*/*             SUBORDINATE ROUTINES VTOCOPEN, FMT4READ,     @Y30LB37*/
*/*             AND SUBORDINATE ROUTINE FMT1READ TO OPEN     @Y30LB37*/
*/*             THE VTOC AND READ THE FORMAT 1 DSCBS.        @Y30LB37*/
*/*             PRINTS MESSAGES IDC2966I OR IDC2967I IF AN   @Y30LB37*/
*/*             ERROR OCCURS RECATALOGING.                   @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  INPUT - THE INFORMATION PASSED IN THE VS1AGL ARGUMENT   @Y30LB37*/
*/*          LIST:  FIELDS VSIOP, VSDEVICE, VSSERIAL,        @Y30LB37*/
*/*          VSDEVP, AND VSSERP.                             @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  OUTPUT- THE INFORMATION RETURNED IS EITHER A ZERO       @Y30LB37*/
*/*          OR FOUR ERROR CODE.                             @Y30LB37*/
*/*          RETURN CODES ARE:                               @Y30LB37*/
*/*          0 - SUCCESSFUL                                  @Y30LB37*/
*/*          4 - VTOC OPEN WAS UNSUCCESSFUL                  @Y30LB37*/
*/*              VTOC READ WAS UNSUCCESSFUL                  @Y30LB37*/
*/*              ERROR RECATALOGING A DATA SET               @Y30LB37*/
*/*              ERROR RETRIEVING UCB ADDRESS                @Y30LB37*/
*/*              ERROR RESERVING VOLUME                      @Y30LB37*/
*/*                                                                  */
*/********************************************************************/
*                                                                  0650
*RECATLOG:                                                         0650
*   PROCEDURE;                      /*                       @Y30LB37*/
*                                                                  0650
RECATLOG STM   @14,@12,@SA00007                                    0650
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL DECLARATIONS FOR RECATLOG                       @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0651
*   DCL                                                            0651
*     RECATRC FIXED(15);            /* RECATLOG RETURN CODE  @Y30LB37*/
*   DCL                                                            0652
*     CATCOUNT FIXED(31);           /* NUM DS RECATALOGED    @Y30LB37*/
*   DCL                                                            0653
*     RECATARG CHAR(LENGTH(RCTAGL)) /* RCTAGL GOTTEN         @Y30LB37*/
*         BDY(WORD);                /* AREA                  @Y30LB37*/
*                                                                  0654
*   /*****************************************************************/
*   /*                                                               */
*   /*                                                       @Y30LB37*/
*   /* CALL THE VTOCOPEN PROCEDURE TO OPEN THE VTOC          @Y30LB37*/
*   /* IF IT IS NOT ALREADY OPEN (VSIOP IS ZERO).            @Y30LB37*/
*   /* VTOCOPEN SETS THE VSIOP FIELD. IF VTOCOPEN IS         @Y30LB37*/
*   /* UNSUCCESSFUL THEN SET VTOCGRC TO FOUR.                @Y30LB37*/
*   /*                                                       @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0654
*   RFY                                                            0654
*     RCTAGL BASED(ADDR(RECATARG)); /*                       @Y30LB37*/
*   OLDERID2=NEWERID2;                                             0655
         L     @03,@PC00001                                        0655
         L     @03,GDTTR2(,@03)                                    0655
         MVC   @TS00001(95),NEWERID2(@03)                          0655
         MVC   OLDERID2(95,@03),@TS00001                           0655
*   NEWID2='VSRC';                  /* ISSUE UTRACE MACRO    @Y30LB37*/
         MVC   NEWID2(4,@03),@CC01565                              0656
*   RECATSW=ON;                     /*                       @Y30LB37*/
         OI    RECATSW,B'00001000'                                 0657
*   RECATRC=0;                      /*                       @Y30LB37*/
         SLR   @15,@15                                             0658
         LR    RECATRC,@15                                         0658
*   CATCOUNT=0;                     /*                       @Y30LB37*/
         ST    @15,CATCOUNT                                        0659
*   IF VSIOP=NULLPTR THEN                                          0660
         C     @15,VSIOP(,ARGLPTR)                                 0660
         BNE   @RF00660                                            0660
*     DO;                           /*                       @Y30LB37*/
*       CALL VTOCOPEN;              /*                       @Y30LB37*/
         BAL   @14,VTOCOPEN                                        0662
*       RESPECIFY                                                  0663
*         RTNREG RSTD;                                             0663
*       TESTRC=RTNREG;                                             0664
         STH   RTNREG,TESTRC                                       0664
*       RESPECIFY                                                  0665
*         RTNREG UNRSTD;            /*                       @Y30LB37*/
*       IF TESTRC^=0 THEN                                          0666
         LH    @03,TESTRC                                          0666
         LTR   @03,@03                                             0666
         BZ    @RF00666                                            0666
*         DO;                       /*                       @Y30LB37*/
*           RECATSW=OFF;            /*                       @Y30LB37*/
         NI    RECATSW,B'11110111'                                 0668
*           RECATRC=4;              /*                       @Y30LB37*/
         LA    RECATRC,4                                           0669
*         END;                      /*                       @Y30LB37*/
*     END;                          /*                       @Y30LB37*/
*                                                                  0672
*   /*****************************************************************/
*   /*                                                               */
*   /* IF VTOCOPEN WAS NOT CALLED INSERT THE ADDRESS OF      @Y30LB37*/
*   /* THE IOCSTR FROM THE VS1AGL AND CALL FMT4READ TO       @Y30LB37*/
*   /* POSITION TO THE BEGINNING OF THE VTOC. IF FMT4READ    @Y30LB37*/
*   /* IS UNSUCCESSFUL THEN SET RECATRC TO RCFAIL.           @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0672
*   ELSE                                                           0672
*     DO;                           /*                       @Y30LB37*/
         B     @RC00660                                            0672
@RF00660 DS    0H                                                  0673
*       IOCSPTR=VSIOP;              /*                       @Y30LB37*/
         L     @03,VSIOP(,ARGLPTR)                                 0673
         ST    @03,IOCSPTR                                         0673
*       CALL FMT4READ;              /*                       @Y30LB37*/
         BAL   @14,FMT4READ                                        0674
*       RESPECIFY                                                  0675
*         RTNREG RSTD;                                             0675
*       TESTRC=RTNREG;                                             0676
         STH   RTNREG,TESTRC                                       0676
*       RESPECIFY                                                  0677
*         RTNREG UNRSTD;            /*                       @Y30LB37*/
*       IF TESTRC^=0 THEN                                          0678
         LH    @03,TESTRC                                          0678
         LTR   @03,@03                                             0678
         BZ    @RF00678                                            0678
*         DO;                       /*                       @Y30LB37*/
*           RECATSW=OFF;            /*                       @Y30LB37*/
         NI    RECATSW,B'11110111'                                 0680
*           RECATRC=4;              /*                       @Y30LB37*/
         LA    RECATRC,4                                           0681
*         END;                      /*                       @Y30LB37*/
*     END;                          /*                       @Y30LB37*/
@RF00678 DS    0H                                                  0684
*                                                                  0684
*   /*****************************************************************/
*   /*                                                               */
*   /* EXECUTE RCATLOOP UNTIL END OF FILE IS DETECTED OR AN  @Y30LB37*/
*   /* ERROR IS ENCOUNTERED READING THE VTOC.                @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0684
*RCATLOOP:                                                         0684
*   DO WHILE RECATSW=ON;            /*                       @Y30LB37*/
*                                                                  0684
@RC00660 DS    0H                                                  0684
RCATLOOP B     @DE00684                                            0684
@DL00684 DS    0H                                                  0685
*     /***************************************************************/
*     /*                                                             */
*     /* CALL THE FMT1READ PROCEDURE WITH ORGTYPE SET TO     @Y30LB37*/
*     /* 'NONV' AND PROTTYPE SET TO 'ALL'. IF AN ERROR       @Y30LB37*/
*     /* OR END OF FILE OCCURS THEN SET RECATSW OFF AND      @Y30LB37*/
*     /* SET RETURN CODE ACCORDING TO THAT RETURNED BY       @Y30LB37*/
*     /* FMT1READ.                                           @Y30LB37*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0685
*     CALL FMT1READ(ORGTNONV,PROTTALL);/*                    @Y30LB37*/
         LA    @01,@AL00685                                        0685
         BAL   @14,FMT1READ                                        0685
*     RESPECIFY                                                    0686
*       RTNREG RSTD;                                               0686
*     TESTRC=RTNREG;                                               0687
         STH   RTNREG,TESTRC                                       0687
*     RESPECIFY                                                    0688
*       RTNREG UNRSTD;              /*                       @Y30LB37*/
*     IF TESTRC^=0 THEN                                            0689
         LH    @03,TESTRC                                          0689
         LTR   @03,@03                                             0689
         BZ    @RF00689                                            0689
*       DO;                         /*                       @Y30LB37*/
*         RECATSW=OFF;              /*                       @Y30LB37*/
         NI    RECATSW,B'11110111'                                 0691
*         IF RECATRC^=4 THEN        /*                       @ZM00977*/
         C     RECATRC,@CF00046                                    0692
         BE    @RF00692                                            0692
*           RECATRC=TESTRC;         /*                       @Y30LB37*/
         LR    RECATRC,@03                                         0693
*       END;                        /*                       @Y30LB37*/
*                                                                  0695
*     /***************************************************************/
*     /*                                                             */
*     /* IF A FORMAT 1 DSCB WAS RETURNED, RECATALOG IT.      @Y30LB37*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0695
*     ELSE                                                         0695
*       DO;                         /*                       @Y30LB37*/
*                                                                  0695
         B     @RC00689                                            0695
@RF00689 DS    0H                                                  0696
*         /***********************************************************/
*         /*                                                         */
*         /* ISSUE URECAT MACRO TO RECATALOG THE DATA        @Y30LB37*/
*         /* SET. IF VSDEVICE FLAG IS ON THEN RETRIEVE       @Y30LB37*/
*         /* THE NEW DEVICE TYPE POINTED TO BY THE VSDEVP    @Y30LB37*/
*         /* FIELD. IF VSSERIAL FLAG IS ON THEN RETRIEVE     @Y30LB37*/
*         /* THE NEW VOLUME SERIAL POINTED TO BY THE VSSERP  @Y30LB37*/
*         /* FIELD. CONTINUE ON IF AN ERROR OR NOT.          @Y30LB37*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  0696
*         RECATARG=''B;             /*                       @Y30LB37*/
         XC    RECATARG(76),RECATARG                               0696
*         RCTDSET=DS1DSNAM;         /*                       @Y30LB37*/
         LA    @03,RECATARG                                        0697
         MVC   RCTDSET(44,@03),DS1DSNAM(F1PTR)                     0697
*         RCTODEV=VSODEVP->V1DEVA;  /*                       @Y30LB37*/
         L     @01,VSODEVP(,ARGLPTR)                               0698
         MVC   RCTODEV(4,@03),V1DEVA(@01)                          0698
*         RCTOVOL=VSOSERP->V1VOLA;  /*                       @Y30LB37*/
         L     @01,VSOSERP(,ARGLPTR)                               0699
         MVC   RCTOVOL(6,@03),V1VOLA(@01)                          0699
*         IF VSDEVICE=ON THEN                                      0700
         TM    VSDEVICE(ARGLPTR),B'10000000'                       0700
         BNO   @RF00700                                            0700
*           DO;                     /*                       @Y30LB37*/
*             RCTDEV=ON;            /*                       @Y30LB37*/
         OI    RCTDEV(@03),B'10000000'                             0702
*             RCTNDEV=V1DEVA;       /*                       @Y30LB37*/
         L     @01,VSDEVP(,ARGLPTR)                                0703
         MVC   RCTNDEV(4,@03),V1DEVA(@01)                          0703
*           END;                    /*                       @Y30LB37*/
*         IF VSSERIAL=ON THEN                                      0705
@RF00700 TM    VSSERIAL(ARGLPTR),B'01000000'                       0705
         BNO   @RF00705                                            0705
*           DO;                     /*                       @Y30LB37*/
*             RCTVOL=ON;            /*                       @Y30LB37*/
         LA    @03,RECATARG                                        0707
         OI    RCTVOL(@03),B'01000000'                             0707
*             RCTNVOL=VSSERP->V1VOLA;/*                      @Y30LB37*/
         L     @01,VSSERP(,ARGLPTR)                                0708
         MVC   RCTNVOL(6,@03),V1VOLA(@01)                          0708
*           END;                    /*                       @Y30LB37*/
*         CALL IDCSARC0(GDTTBL,RCTAGL);/*                    @Y30LB37*/
@RF00705 L     @03,@PC00001                                        0710
         ST    @03,@AL00001                                        0710
         LA    @15,RECATARG                                        0710
         ST    @15,@AL00001+4                                      0710
         MVI   @AL00001+4,X'80'                                    0710
         L     @15,GDTRCT(,@03)                                    0710
         LA    @01,@AL00001                                        0710
         BALR  @14,@15                                             0710
*         RESPECIFY                                                0711
*           RTNREG RSTD;                                           0711
*         TESTRC=RTNREG;                                           0712
         STH   RTNREG,TESTRC                                       0712
*         RESPECIFY                                                0713
*           RTNREG UNRSTD;          /*                       @Y30LB37*/
*                                                                  0714
*         /***********************************************************/
*         /*                                                         */
*         /* IF THE DATA SET WAS RECATALOGED SUCCESSFULLY    @Y30LB37*/
*         /* ISSUE UPRINT TO PRINT THE DATA SET NAME MSG.    @Y30LB37*/
*         /* IF THE VSLIST FLAG IS SPECIFIED IN THE VS1AGL.  @Y30LB37*/
*         /* INCREMENT THE COUNT OF DATA SETS RECATALOGED.   @Y30LB37*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  0714
*         IF TESTRC=0 THEN                                         0714
         LH    @03,TESTRC                                          0714
         LTR   @03,@03                                             0714
         BNZ   @RF00714                                            0714
*           DO;                     /*                       @ZM00977*/
*             CATCOUNT=CATCOUNT+ONE;/*                       @ZM00977*/
         LA    @03,1                                               0716
         AL    @03,CATCOUNT                                        0716
         ST    @03,CATCOUNT                                        0716
*             IF VSLIST=ON THEN                                    0717
         TM    VSLIST(ARGLPTR),B'00100000'                         0717
         BNO   @RF00717                                            0717
*               DO;                 /*                       @ZM00977*/
*                 PRINTARG=''B;     /*                       @Y30LB37*/
         XC    PRINTARG(44),PRINTARG                               0719
*                 DARGSMOD=MSGMODID;/*                       @Y30LB37*/
         L     @03,DDSTRU                                          0720
         MVC   DARGSMOD(3,@03),@CC01408                            0720
*                 DARGSENT=MSGRECAT;/*                       @Y30LB37*/
         MVI   DARGSENT(@03),X'09'                                 0721
*                 DARGDBP=ADDR(DS1DSNAM);/*                  @Y30LB37*/
         ST    F1PTR,DARGDBP(,@03)                                 0722
*                 DARGILP=LENGTH(DS1DSNAM);/*                @Y30LB37*/
         MVC   DARGILP(2,@03),@CH00849                             0723
*                 CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*    @Y30LB37*/
         L     @03,@PC00001                                        0724
         ST    @03,@AL00001                                        0724
         LA    @15,@CF00120                                        0724
         ST    @15,@AL00001+4                                      0724
         LA    @15,DDSTRU                                          0724
         ST    @15,@AL00001+8                                      0724
         MVI   @AL00001+8,X'80'                                    0724
         L     @15,GDTPRT(,@03)                                    0724
         LA    @01,@AL00001                                        0724
         BALR  @14,@15                                             0724
*               END;                /*                       @Y30LB37*/
*           END;                    /*                       @ZM00977*/
*                                                                  0726
*         /***********************************************************/
*         /*                                                         */
*         /* IF AN ERROR OCCURRED RECATALOGING THE DATA SET  @Y30LB37*/
*         /* THEN, SET THE RETURN CODE TO THAT RETURNED.     @Y30LB37*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  0727
*         ELSE                                                     0727
*           IF TESTRC=4 THEN                                       0727
         B     @RC00714                                            0727
@RF00714 LH    @03,TESTRC                                          0727
         C     @03,@CF00046                                        0727
         BNE   @RF00727                                            0727
*             RECATRC=TESTRC;       /*                       @Y30LB37*/
         LR    RECATRC,@03                                         0728
*       END;                        /*                       @Y30LB37*/
@RF00727 DS    0H                                                  0729
@RC00714 DS    0H                                                  0730
*   END RCATLOOP;                   /*                       @Y30LB37*/
@RC00689 DS    0H                                                  0730
@DE00684 TM    RECATSW,B'00001000'                                 0730
         BO    @DL00684                                            0730
*                                                                  0731
*   /*****************************************************************/
*   /*                                                               */
*   /* IF END OF FILE RETURN CODE THEN SET RETURN CODE TO    @Y30LB37*/
*   /* ZERO. ISSUE ERROR MESSAGE IDC2966I IF RETURN CODE     @Y30LB37*/
*   /* FOUR AND RECATALOG COUNT IS ZEROS. ISSUE ERROR        @Y30LB37*/
*   /* MESSAGE IDC2967I IF RETURN CODE IS FOUR AND RECAT-    @Y30LB37*/
*   /* ALOG COUNT IS NOT ZEROS INDICATING SOME WERE RE-      @Y30LB37*/
*   /* CATALOGED BEFORE AN ERROR OCCURRED.                   @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0731
*   IF RECATRC=RCEOFILE THEN                                       0731
         C     RECATRC,@CF00040                                    0731
         BNE   @RF00731                                            0731
*     RECATRC=0;                    /*                       @Y30LB37*/
         SLR   RECATRC,RECATRC                                     0732
*   IF RECATRC=4 THEN                                              0733
@RF00731 C     RECATRC,@CF00046                                    0733
         BNE   @RF00733                                            0733
*     DO;                           /*                       @Y30LB37*/
*       PRINTARG=''B;               /*                       @Y30LB37*/
         XC    PRINTARG(44),PRINTARG                               0735
*       IF CATCOUNT=0 THEN                                         0736
         L     @03,CATCOUNT                                        0736
         LTR   @03,@03                                             0736
         BNZ   @RF00736                                            0736
*         DARGSENT=MSG2966I;        /*                       @Y30LB37*/
         L     @03,DDSTRU                                          0737
         MVI   DARGSENT(@03),X'08'                                 0737
*       ELSE                                                       0738
*         DARGSENT=MSG2967I;        /*                       @Y30LB37*/
         B     @RC00736                                            0738
@RF00736 L     @03,DDSTRU                                          0738
         MVI   DARGSENT(@03),X'0A'                                 0738
*       DARGSMOD=MSGMODID;          /*                       @Y30LB37*/
@RC00736 L     @03,DDSTRU                                          0739
         MVC   DARGSMOD(3,@03),@CC01408                            0739
*       CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*              @Y30LB37*/
         L     @03,@PC00001                                        0740
         ST    @03,@AL00001                                        0740
         LA    @15,@CF00120                                        0740
         ST    @15,@AL00001+4                                      0740
         LA    @15,DDSTRU                                          0740
         ST    @15,@AL00001+8                                      0740
         MVI   @AL00001+8,X'80'                                    0740
         L     @15,GDTPRT(,@03)                                    0740
         LA    @01,@AL00001                                        0740
         BALR  @14,@15                                             0740
*     END;                          /*                       @Y30LB37*/
*   RETURN CODE(RECATRC);           /* RETURN TO MAIN ROUTINE      0742
*                                                            @Y30LB37*/
@RF00733 LR    @15,RECATRC                                         0742
         L     @14,@SA00007                                        0742
         LM    @00,@12,@SA00007+8                                  0742
         BR    @14                                                 0742
*   END RECATLOG;                   /* END OF RECATLOG PROC  @Y30LB37*/
*                                                                  0744
*/********************************************************************/
*/*                                                                  */
*/*  PROCEDURE NAME - SCRATCH                                @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  FUNCTION - THIS PROCEDURE SETS THE VSAM OWNERSHIP BIT   @Y30LB37*/
*/*             OFF IN THE FORMAT 4 DSCB AND SCRATCHES THE   @Y30LB37*/
*/*             NON-VSAM DATA SETS AND VSAM DATA SPACES      @Y30LB37*/
*/*             REPRESENTED BY THE FORMAT 1 DSCB'S.          @Y30LB37*/
*/*             SCRATCH CALLS SUBORDINATE ROUTINES           @Y30LB37*/
*/*             VTOCOPEN, FMT4SCR, AND FMT1SCR TO SCRATCH    @Y30LB37*/
*/*             THE FORMAT 4 AND FORMAT 1 DSCBS.  PRINTS     @Y30LB37*/
*/*             MESSAGES IDC2964I OR IDC2965I, IF AN ERROR   @Y30LB37*/
*/*             OCCURS SCRATCHING THE VTOC.                  @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  INPUT - THE INFORMATION PASSED IN THE VS1AGL ARGUMENT   @Y30LB37*/
*/*          LIST:  FIELD VSIOP.                             @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  OUTPUT- THE INFORMATION RETURNED IS EITHER A ZERO       @Y30LB37*/
*/*          OR FOUR ERROR CODE.                             @Y30LB37*/
*/*          RETURN CODES ARE:                               @Y30LB37*/
*/*          0 - SUCCESSFUL                                  @Y30LB37*/
*/*          4 - VTOC OPEN WAS UNSUCCESSFUL                  @Y30LB37*/
*/*              VTOC READ WAS UNSUCCESSFUL                  @Y30LB37*/
*/*              ERROR SCRATCHING A DATA SET                 @Y30LB37*/
*/*              ERROR RETRIEVING UCB ADDRESS                @Y30LB37*/
*/*              ERROR RESERVING VOLUME                      @Y30LB37*/
*/*              ERROR READING OR UPDATING A VTOC            @Y30LB37*/
*/*              ERROR READING OR UPDATING A FORMAT 4 DSCB   @Y30LB37*/
*/*                                                                  */
*/********************************************************************/
*                                                                  0744
*SCRATCH:                                                          0744
*   PROCEDURE;                      /*                       @Y30LB37*/
*                                                                  0744
SCRATCH  STM   @14,@12,@SA00008                                    0744
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL DECLARATIONS FOR SCRATCH                        @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0745
*   DCL                                                            0745
*     SCRATRC FIXED(15);            /* SCRATCH RETURN CODE   @Y30LB37*/
*                                                                  0746
*   /*****************************************************************/
*   /*                                                               */
*   /* CALL THE VTOCOPEN PROCEDURE TO OPEN THE VTOC          @Y30LB37*/
*   /* IF IT IS NOT ALREADY OPEN (VSIOP IS ZERO).            @Y30LB37*/
*   /* VTOCOPEN SETS THE VSIOP FIELD. IF VTOCOPEN IS         @Y30LB37*/
*   /* UNSUCCESSFUL THEN SET SCRATRC TO FOUR.                @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0746
*   OLDERID2=NEWERID2;                                             0746
         L     @03,@PC00001                                        0746
         L     @03,GDTTR2(,@03)                                    0746
         MVC   @TS00001(95),NEWERID2(@03)                          0746
         MVC   OLDERID2(95,@03),@TS00001                           0746
*   NEWID2='VSSC';                  /* ISSUE UTRACE MACRO    @Y30LB37*/
         MVC   NEWID2(4,@03),@CC01572                              0747
*   SCRATRC=0;                      /*                       @Y30LB37*/
         SLR   @15,@15                                             0748
         LR    SCRATRC,@15                                         0748
*   IF VSIOP=NULLPTR THEN                                          0749
         C     @15,VSIOP(,ARGLPTR)                                 0749
         BNE   @RF00749                                            0749
*     DO;                           /*                       @Y30LB37*/
*       CALL VTOCOPEN;              /*                       @Y30LB37*/
         BAL   @14,VTOCOPEN                                        0751
*       RESPECIFY                                                  0752
*         RTNREG RSTD;                                             0752
*       TESTRC=RTNREG;                                             0753
         STH   RTNREG,TESTRC                                       0753
*       RESPECIFY                                                  0754
*         RTNREG UNRSTD;            /*                       @Y30LB37*/
*       IF TESTRC^=0 THEN                                          0755
         LH    @03,TESTRC                                          0755
         LTR   @03,@03                                             0755
         BZ    @RF00755                                            0755
*         SCRATRC=4;                /*                       @Y30LB37*/
         LA    SCRATRC,4                                           0756
*     END;                          /*                       @Y30LB37*/
*                                                                  0757
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THE VTOC IS ALREADY OPEN PICK UP THE IOCSPTR FROM  @Y30LB37*/
*   /* THE VS1AGL.                                           @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0758
*   ELSE                                                           0758
*     IOCSPTR=VSIOP;                /*                       @Y30LB37*/
*                                                                  0758
         B     @RC00749                                            0758
@RF00749 L     @03,VSIOP(,ARGLPTR)                                 0758
         ST    @03,IOCSPTR                                         0758
*   /*****************************************************************/
*   /*                                                               */
*   /* CALL THE FMT4SCR PROCEDURE TO RESET THE VSAM FLAG     @Y30LB37*/
*   /* IN THE FORMAT 4 DSCB. IF ERROR SET RETURN CODE        @Y30LB37*/
*   /* TO INDICATE NO FUNCTION PERFORMED.                    @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0759
*   IF SCRATRC=0 THEN                                              0759
@RC00749 LTR   SCRATRC,SCRATRC                                     0759
         BNZ   @RF00759                                            0759
*     DO;                           /*                       @Y30LB37*/
*       CALL FMT4SCR;               /*                       @Y30LB37*/
         BAL   @14,FMT4SCR                                         0761
*       RESPECIFY                                                  0762
*         RTNREG RSTD;                                             0762
*       TESTRC=RTNREG;                                             0763
         STH   RTNREG,TESTRC                                       0763
*       RESPECIFY                                                  0764
*         RTNREG UNRSTD;            /*                       @Y30LB37*/
*       IF TESTRC^=0 THEN                                          0765
         LH    @03,TESTRC                                          0765
         LTR   @03,@03                                             0765
         BZ    @RF00765                                            0765
*         SCRATRC=4;                /*                       @Y30LB37*/
         LA    SCRATRC,4                                           0766
*     END;                          /*                       @Y30LB37*/
@RF00765 DS    0H                                                  0768
*                                                                  0768
*   /*****************************************************************/
*   /*                                                               */
*   /* CALL THE FMT1SCR ROUTINE TO SCRATCH THE FORMAT 1      @Y30LB37*/
*   /* DSCBS. IF FMT1SCR TERMINATED IN THE MIDDLE OF         @Y30LB37*/
*   /* SCRATCHING THE VTOC (RETURN CODE IS 4). THEN SET      @Y30LB37*/
*   /* THE RETURN CODE TO INDICATE FUNCTION TERMINATED       @Y30LB37*/
*   /* (CODE 12). IF FMT1SCR FOUND AN ERROR BUT PROC-        @Y30LB37*/
*   /* CESSED THE ENTIRE VTOC (RETURN CODE IS 8) THEN SET    @Y30LB37*/
*   /* RETURN CODE 8 TO INDICATE NO MESSAGES BUT ERROR.      @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0768
*   IF SCRATRC=0 THEN                                              0768
@RF00759 LTR   SCRATRC,SCRATRC                                     0768
         BNZ   @RF00768                                            0768
*     DO;                           /*                       @Y30LB37*/
*       CALL FMT1SCR;               /*                       @Y30LB37*/
         BAL   @14,FMT1SCR                                         0770
*       RESPECIFY                                                  0771
*         RTNREG RSTD;                                             0771
*       TESTRC=RTNREG;                                             0772
         STH   RTNREG,TESTRC                                       0772
*       RESPECIFY                                                  0773
*         RTNREG UNRSTD;            /*                       @Y30LB37*/
*       IF TESTRC^=0 THEN                                          0774
         LH    @03,TESTRC                                          0774
         LTR   @03,@03                                             0774
         BZ    @RF00774                                            0774
*         IF TESTRC=4 THEN                                         0775
         C     @03,@CF00046                                        0775
         BNE   @RF00775                                            0775
*           SCRATRC=RCFUNTRM;       /*                       @Y30LB37*/
         LA    SCRATRC,12                                          0776
*         ELSE                                                     0777
*           SCRATRC=RCNOMSG;        /*                       @Y30LB37*/
         B     @RC00775                                            0777
@RF00775 LA    SCRATRC,8                                           0777
*     END;                          /*                       @Y30LB37*/
*                                                                  0778
@RC00775 DS    0H                                                  0778
@RF00774 DS    0H                                                  0779
*   /*****************************************************************/
*   /*                                                               */
*   /* IF NO FUNCTION PERFORMED THEN PRINT ERROR MESSAGE     @Y30LB37*/
*   /* IDC2964I VIA UPRINT.                                  @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0779
*   IF SCRATRC=4 THEN                                              0779
@RF00768 C     SCRATRC,@CF00046                                    0779
         BNE   @RF00779                                            0779
*     DO;                           /*                       @Y30LB37*/
*       DARGSMOD=MSGMODID;          /*                       @Y30LB37*/
         L     @03,DDSTRU                                          0781
         MVC   DARGSMOD(3,@03),@CC01408                            0781
*       DARGSENT=MSG2964I;          /*                       @Y30LB37*/
         MVI   DARGSENT(@03),X'06'                                 0782
*       CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*              @Y30LB37*/
         L     @03,@PC00001                                        0783
         ST    @03,@AL00001                                        0783
         LA    @15,@CF00120                                        0783
         ST    @15,@AL00001+4                                      0783
         LA    @15,DDSTRU                                          0783
         ST    @15,@AL00001+8                                      0783
         MVI   @AL00001+8,X'80'                                    0783
         L     @15,GDTPRT(,@03)                                    0783
         LA    @01,@AL00001                                        0783
         BALR  @14,@15                                             0783
*     END;                          /*                       @Y30LB37*/
*                                                                  0785
*   /*****************************************************************/
*   /*                                                               */
*   /* IF FUNCTION TERMINATED RETURN CODE 12 THEN PRINT      @Y30LB37*/
*   /* ERROR MESSAGE IDC2965I VIA UPRINT AND SET RETURN      @Y30LB37*/
*   /* CODE 12 TO A RETURN CODE 4.                           @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0785
*   IF SCRATRC=RCFUNTRM THEN                                       0785
@RF00779 C     SCRATRC,@CF00037                                    0785
         BNE   @RF00785                                            0785
*     DO;                           /*                       @Y30LB37*/
*       SCRATRC=4;                  /*                       @Y30LB37*/
         LA    SCRATRC,4                                           0787
*       DARGSMOD=MSGMODID;          /*                       @Y30LB37*/
         L     @03,DDSTRU                                          0788
         MVC   DARGSMOD(3,@03),@CC01408                            0788
*       DARGSENT=MSG2965I;          /*                       @Y30LB37*/
         MVI   DARGSENT(@03),X'07'                                 0789
*       CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*              @Y30LB37*/
         L     @03,@PC00001                                        0790
         ST    @03,@AL00001                                        0790
         LA    @15,@CF00120                                        0790
         ST    @15,@AL00001+4                                      0790
         LA    @15,DDSTRU                                          0790
         ST    @15,@AL00001+8                                      0790
         MVI   @AL00001+8,X'80'                                    0790
         L     @15,GDTPRT(,@03)                                    0790
         LA    @01,@AL00001                                        0790
         BALR  @14,@15                                             0790
*     END;                          /*                       @Y30LB37*/
*                                                                  0791
*   /*****************************************************************/
*   /*                                                               */
*   /* RETURN TO CALLER WITH A RETURN CODE OF 4 OR 0.        @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0792
*   IF SCRATRC=RCNOMSG THEN                                        0792
@RF00785 C     SCRATRC,@CF00040                                    0792
         BNE   @RF00792                                            0792
*     SCRATRC=4;                    /*                       @Y30LB37*/
         LA    SCRATRC,4                                           0793
*   RETURN CODE(SCRATRC);           /* RETURN TO MAIN ROUTINE      0794
*                                                            @Y30LB37*/
@RF00792 LR    @15,SCRATRC                                         0794
         L     @14,@SA00008                                        0794
         LM    @00,@12,@SA00008+8                                  0794
         BR    @14                                                 0794
*   END SCRATCH;                    /* END OF SCRATCH PROC   @Y30LB37*/
*                                                                  0796
*/********************************************************************/
*/*                                                                  */
*/*  PROCEDURE NAME - FMT4SCR                                @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  FUNCTION - THIS PROCEDURE CLEARS THE OWNERSHIP FLAG     @Y30LB37*/
*/*             FROM THE FORMAT 4 DSCB.  FMT4SCR CALLS       @Y30LB37*/
*/*             SUBORDINATE ROUTINE FMT4READ TO READ THE     @Y30LB37*/
*/*             FORMAT 4 DSCB.                               @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  INPUT - THE INFORMATION PASSED IN THE VS1AGL ARGUMENT   @Y30LB37*/
*/*          LIST:  FIELD VSIOP.                             @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  OUTPUT- THE INFORMATION RETURNED IS EITHER A ZERO       @Y30LB37*/
*/*          OR FOUR ERROR CODE AND/OR RETURNED INFORMA-     @Y30LB37*/
*/*          TION ABOUT THE VTOC ACCORDING TO THE INPUT      @Y30LB37*/
*/*          REQUEST FLAGS.  RETURN CODES ARE:               @Y30LB37*/
*/*          0 - SUCCESSFUL                                  @Y30LB37*/
*/*          4 - VTOC READ WAS UNSUCCESSFUL                  @Y30LB37*/
*/*              FIRST RECORD WAS NOT A FORMAT 4             @Y30LB37*/
*/*              ERROR UPDATING THE FORMAT 4 RECORD          @Y30LB37*/
*/*                                                                  */
*/********************************************************************/
*                                                                  0796
*FMT4SCR:                                                          0796
*   PROCEDURE;                      /*                       @Y30LB37*/
*                                                                  0796
FMT4SCR  STM   @14,@12,@SA00009                                    0796
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL DECLARATIONS FOR FMT4SCR                        @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0797
*   DCL                                                            0797
*     FMT4SRC FIXED(15);            /* FMT4SCR RETURN CODE   @Y30LB37*/
*                                                                  0798
*   /*****************************************************************/
*   /*                                                               */
*   /* CALL FMT4READ PROCEDURE TO READ THE FORMAT 4 DSCB.    @Y30LB37*/
*   /* IF FMT4READ FAILS SET ERROR RETURN CODE.              @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0798
*   OLDERID2=NEWERID2;                                             0798
         L     @05,@PC00001                                        0798
         L     @05,GDTTR2(,@05)                                    0798
         MVC   @TS00001(95),NEWERID2(@05)                          0798
         MVC   OLDERID2(95,@05),@TS00001                           0798
*   NEWID2='VS4S';                  /* ISSUE UTRACE MACRO    @Y30LB37*/
         MVC   NEWID2(4,@05),@CC01579                              0799
*   FMT4SRC=0;                      /*                       @Y30LB37*/
         SLR   FMT4SRC,FMT4SRC                                     0800
*   CALL FMT4READ;                  /*                       @Y30LB37*/
         BAL   @14,FMT4READ                                        0801
*   RESPECIFY                                                      0802
*     RTNREG RSTD;                                                 0802
*   TESTRC=RTNREG;                                                 0803
         STH   RTNREG,TESTRC                                       0803
*   RESPECIFY                                                      0804
*     RTNREG UNRSTD;                /*                       @Y30LB37*/
*   IF TESTRC^=0 THEN                                              0805
         LH    @03,TESTRC                                          0805
         LTR   @03,@03                                             0805
         BZ    @RF00805                                            0805
*     FMT4SRC=4;                    /*                       @Y30LB37*/
*                                                                  0806
         LA    FMT4SRC,4                                           0806
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THE VSAM OWNERSHIP FLAG (DS4VSREF) IS ON, THEN     @Y30LB37*/
*   /* SET OFF THE DS4VSREF FLAG IN THE FORMAT 4 DSCB AND    @Y30LB37*/
*   /* ISSUE A UPUT MACRO TO UPDATE THE FORMAT 4 DSCB.       @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0807
*   IF FMT4SRC=0 THEN                                              0807
@RF00805 LTR   FMT4SRC,FMT4SRC                                     0807
         BNZ   @RF00807                                            0807
*     IF DS4VSREF=ON THEN                                          0808
         LA    @03,44                                              0808
         AL    @03,F4PTR                                           0808
         TM    DS4VSREF(@03),B'10000000'                           0808
         BNO   @RF00808                                            0808
*       DO;                         /*                       @Y30LB37*/
*         DS4VSREF=OFF;             /*                       @Y30LB37*/
         NI    DS4VSREF(@03),B'01111111'                           0810
*         CALL IDCIOPT0(GDTTBL,IOCSPTR);/*                   @Y30LB37*/
         L     @03,@PC00001                                        0811
         ST    @03,@AL00001                                        0811
         LA    @15,IOCSPTR                                         0811
         ST    @15,@AL00001+4                                      0811
         MVI   @AL00001+4,X'80'                                    0811
         L     @15,GDTPUT(,@03)                                    0811
         LA    @01,@AL00001                                        0811
         BALR  @14,@15                                             0811
*         RESPECIFY                                                0812
*           RTNREG RSTD;                                           0812
*         TESTRC=RTNREG;                                           0813
         STH   RTNREG,TESTRC                                       0813
*         RESPECIFY                                                0814
*           RTNREG UNRSTD;          /*                       @Y30LB37*/
*         IF TESTRC^=0 THEN                                        0815
         LH    @03,TESTRC                                          0815
         LTR   @03,@03                                             0815
         BZ    @RF00815                                            0815
*           FMT4SRC=4;              /*                       @Y30LB37*/
         LA    FMT4SRC,4                                           0816
*       END;                        /*                       @Y30LB37*/
@RF00815 DS    0H                                                  0818
*   RETURN CODE(FMT4SRC);           /* RETURN TO MAIN ROUTINE      0818
*                                                            @Y30LB37*/
@RF00808 DS    0H                                                  0818
@RF00807 LR    @15,FMT4SRC                                         0818
         L     @14,@SA00009                                        0818
         LM    @00,@12,@SA00009+8                                  0818
         BR    @14                                                 0818
*   END FMT4SCR;                    /* END OF FMT4SCR PROC   @Y30LB37*/
*                                                                  0820
*/********************************************************************/
*/*                                                                  */
*/*  PROCEDURE NAME - FMT1SCR                                @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  FUNCTION - THIS PROCEDURE SCRATCHES FROM THE VOLUME     @Y30LB37*/
*/*             ALL THE FORMAT 1 DSCBS.  FMT1SCR CALLS       @Y30LB37*/
*/*             SUBORDINATE ROUTINE FMT1READ TO READ THE     @Y30LB37*/
*/*             FORMAT 1 DSCB.                               @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  INPUT - THE INFORMATION PASSED IN THE VS1AGL ARGUMENT   @Y30LB37*/
*/*          LIST:  FIELD VSIOP.                             @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  OUTPUT- THE INFORMATION RETURNED IS EITHER A ZERO       @Y30LB37*/
*/*          OR FOUR ERROR CODE AND/OR RETURNED INFORMA-     @Y30LB37*/
*/*          TION ABOUT THE FMT1 ACCORDING TO THE INPUT      @Y30LB37*/
*/*          REQUEST FLAGS.  RETURN CODES ARE:               @Y30LB37*/
*/*          0 - SUCCESSFUL                                  @Y30LB37*/
*/*          4 - ERROR READING OR UPDATING VTOC              @Y30LB37*/
*/*          8 - ERROR SCRATCHING DATA SETS BUT VTOC         @Y30LB37*/
*/*              PROCESSED                                   @Y30LB37*/
*/*                                                                  */
*/********************************************************************/
*                                                                  0820
*FMT1SCR:                                                          0820
*   PROCEDURE;                      /*                       @Y30LB37*/
*                                                                  0820
FMT1SCR  STM   @14,@12,@SA00010                                    0820
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL DECLARATIONS FOR FMT1SCR                        @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0821
*   DCL                                                            0821
*     FMT1SRC FIXED(15);            /* FMT1SCR RETURN CODE   @Y30LB37*/
*   DCL                                                            0822
*     VVOLPTR PTR(31);              /* UVOLLIST PTR          @Y30LB37*/
*   DCL                                                            0823
*     VOLIST CHAR(LENGTH(UVOLLIST)) /* GETMAINED AREA FOR    @Y30LB37*/
*         BDY(WORD);                /* UVOLLIST DSECT        @Y30LB37*/
*                                                                  0824
*   /*****************************************************************/
*   /*                                                               */
*   /* ISSUE UTRACE MACRO AND THEN INITIALIZE FIELDS AND     @Y30LB37*/
*   /* SWITCHES FOR LOOP CONTROL.                            @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0824
*   RFY                                                            0824
*     UVOLLIST BASED(VVOLPTR);      /*                       @Y30LB37*/
*   OLDERID2=NEWERID2;                                             0825
         L     @03,@PC00001                                        0825
         L     @03,GDTTR2(,@03)                                    0825
         MVC   @TS00001(95),NEWERID2(@03)                          0825
         MVC   OLDERID2(95,@03),@TS00001                           0825
*   NEWID2='VS1S';                  /* ISSUE UTRACE MACRO    @Y30LB37*/
         MVC   NEWID2(4,@03),@CC01587                              0826
*   FMT1SRC=0;                      /*                       @Y30LB37*/
         SLR   FMT1SRC,FMT1SRC                                     0827
*   TERMSW=OFF;                     /*                       @Y30LB37*/
*   SCRERRSW=OFF;                   /*                       @Y30LB37*/
         NI    TERMSW,B'11001111'                                  0829
*   VVOLPTR=ADDR(VOLIST);           /*                       @Y30LB37*/
         LA    @03,VOLIST                                          0830
         ST    @03,VVOLPTR                                         0830
*                                                                  0831
*   /*****************************************************************/
*   /*                                                               */
*   /* LOOP THROUGH TO PROCESS ALL FORMAT 1 DSCBS UNTIL      @Y30LB37*/
*   /* END OF FILE OCCURS OR AN ERROR OCCURS READING OR      @Y30LB37*/
*   /* UPDATING THE VTOC.                                    @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0831
*FMT1LOOP:                                                         0831
*   DO WHILE TERMSW=OFF;            /*                       @Y30LB37*/
FMT1LOOP B     @DE00831                                            0831
@DL00831 DS    0H                                                  0832
*     RESETDS1=OFF;                 /*                       @G24LB31*/
*     NOSCRDS1=OFF;                 /*                       @G24LB31*/
*                                                                  0833
         NI    RESETDS1,B'00111111'                                0833
*     /***************************************************************/
*     /*                                                             */
*     /* CALL THE FMT1READ ROUTINE TO READ THE FORMAT 1      @Y30LB37*/
*     /* DSCBS. THE ORGTYPE AND PROTTYPE FIELDS ARE SET      @Y30LB37*/
*     /* TO 'ALL'.                                           @Y30LB37*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0834
*     CALL FMT1READ(ORGTALL,PROTTALL);/*                     @Y30LB37*/
         LA    @01,@AL00834                                        0834
         BAL   @14,FMT1READ                                        0834
*     RESPECIFY                                                    0835
*       RTNREG RSTD;                                               0835
*     TESTRC=RTNREG;                                               0836
         STH   RTNREG,TESTRC                                       0836
*     RESPECIFY                                                    0837
*       RTNREG UNRSTD;              /*                       @Y30LB37*/
*     IF TESTRC=0 THEN                                             0838
         LH    @03,TESTRC                                          0838
         LTR   @03,@03                                             0838
         BNZ   @RF00838                                            0838
*       DO;                         /*                       @Y30LB37*/
*                                                                  0839
*         /***********************************************************/
*         /*                                                         */
*         /* IF THE READ IS SUCCESSFUL THEN CHECK FOR A      @Y30LB37*/
*         /* VSAM DATA SET OR DATA SPACE ('AM' DSORG TYPE).  @Y30LB37*/
*         /* IF 'AM' THEN SET DSORG TO 'PS' TO INDICATE      @Y30LB37*/
*         /* NON-VSAM AND ZERO THE DS1DSIND FIELD TO         @Y30LB37*/
*         /* INDICATE NO PROTECTION. VSAM SECURITY CHECK-    @Y30LB37*/
*         /* ING WILL THUS BE BYPASSED.                      @G24LB31*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  0840
*         IF DSORGAM=ON THEN                                       0840
         TM    DSORGAM(F1PTR),B'00001000'                          0840
         BNO   @RF00840                                            0840
*           DO;                     /*                       @Y30LB37*/
*             DSORGAM=OFF;          /*                       @Y30LB37*/
         NI    DSORGAM(F1PTR),B'11110111'                          0842
*             DSORGPS=ON;           /*                       @Y30LB37*/
         OI    DSORGPS(F1PTR),B'01000000'                          0843
*             DS1DSIND=HEXZERO;     /*                       @Y30LB37*/
         MVC   DS1DSIND(1,F1PTR),HEXZERO                           0844
*             RESETDS1=ON;          /*                       @G24LB31*/
         OI    RESETDS1,B'10000000'                                0845
*           END;                    /*                       @G24LB31*/
*                                                                  0847
*         /***********************************************************/
*         /*                                                         */
*         /*                                                 @G24LB31*/
*         /* IF DATA SET IS RACF PROTECTED, ISSUE URACHECK.  @G24LB31*/
*         /* SET THE RACF INDICATOR OFF IN THE FORMAT 1      @G24LB31*/
*         /* DSCB AND REWRITE THE DSCB IF THE URACHECK       @G24LB31*/
*         /* MACRO WAS SUCCESSFUL.                           @G24LB31*/
*         /*                                                 @G24LB31*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  0847
*         ELSE                      /*                       @G24LB31*/
*           IF PROTRACF=ON THEN     /*                       @G24LB31*/
         B     @RC00840                                            0847
@RF00840 TM    PROTRACF(F1PTR),B'01000000'                         0847
         BNO   @RF00847                                            0847
*             DO;                   /*                       @G24LB31*/
*               VS1RACF=''B;        /*                       @G24LB31*/
         XC    VS1RACF(20),VS1RACF                                 0849
*               RACFDSTV=OFF;       /* RACF NON-VSAM D.S.    @G24LB31*/
         LA    @03,VS1RACF                                         0850
         NI    RACFDSTV(@03),B'11101111'                           0850
*               RACFTUPD=ON;        /* RACF UPDATE ACCESS    @G24LB31*/
         OI    RACFTUPD(@03),B'00000100'                           0851
*               RACFENT=ADDR(DS1DSNAM);/*                    @G24LB31*/
         ST    F1PTR,RACFENT(,@03)                                 0852
*               RACFCLN=ADDR(CLASSRAC);/* RACF CLASS         @G24LB31*/
         LA    @15,CLASSRAC                                        0853
         ST    @15,RACFCLN(,@03)                                   0853
*               CLASSLEN=LENGTH(CLASSDS);/*                  @G24LB31*/
         MVI   CLASSLEN,X'07'                                      0854
*               CLASSNM=CLASSDS;    /*                       @G24LB31*/
         MVI   CLASSNM+7,C' '                                      0855
         MVC   CLASSNM(7),CLASSDS                                  0855
*               RACFVOLS=VSVOLP;    /*                       @G24LB31*/
         L     @15,VSVOLP(,ARGLPTR)                                0856
         ST    @15,RACFVOLS(,@03)                                  0856
*               CALL IDCSARK0(GDTTBL,VRACFPTR);/*            @G24LB31*/
         L     @03,@PC00001                                        0857
         ST    @03,@AL00001                                        0857
         LA    @15,VRACFPTR                                        0857
         ST    @15,@AL00001+4                                      0857
         MVI   @AL00001+4,X'80'                                    0857
         L     @15,GDTRCK(,@03)                                    0857
         LA    @01,@AL00001                                        0857
         BALR  @14,@15                                             0857
*               RESPECIFY                                          0858
*                 RTNREG RSTD;                                     0858
*               TESTRC=RTNREG;                                     0859
         STH   RTNREG,TESTRC                                       0859
*               RESPECIFY                                          0860
*                 RTNREG UNRSTD;    /*                       @G24LB31*/
*                                                                  0860
*               /*****************************************************/
*               /*                                                   */
*               /* ******************************************        */
*               /*                                           @G24LB31*/
*               /*                                           @G24LB31*/
*               /* IF URACHECK MACRO FAILED, SET SCRERRSW TO @G24LB31*/
*               /* INDICATE A D.S. COULD NOT BE SCRATCHED.   @G24LB31*/
*               /* CONTINUE SCRATCHING REMAINING DATA SETS.  @G24LB31*/
*               /*                                           @G24LB31*/
*               /* ******************************************        */
*               /*                                           @G24LB31*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  0861
*               IF TESTRC^=0 THEN   /*                       @G24LB31*/
         LH    @03,TESTRC                                          0861
         LTR   @03,@03                                             0861
         BZ    @RF00861                                            0861
*                 DO;               /*                       @G24LB31*/
*                   SCRERRSW=ON;    /*                       @G24LB31*/
         OI    SCRERRSW,B'00010000'                                0863
*                   NOSCRDS1=ON;    /* DO NOT SCRATCH THIS D.S.    0864
*                                                            @G24LB31*/
         OI    NOSCRDS1,B'01000000'                                0864
*                 END;              /*                       @G24LB31*/
*               ELSE                /*                       @G24LB31*/
*                 DO;               /*                       @G24LB31*/
         B     @RC00861                                            0866
@RF00861 DS    0H                                                  0867
*                   DS1DSIND=HEXZERO;/* SET OFF RACF PROT    @G24LB31*/
         MVC   DS1DSIND(1,F1PTR),HEXZERO                           0867
*                   RESETDS1=ON;    /*                       @G24LB31*/
         OI    RESETDS1,B'10000000'                                0868
*                 END;              /*                       @G24LB31*/
*             END;                  /*                       @G24LB31*/
@RC00861 DS    0H                                                  0871
*                                                                  0871
*         /***********************************************************/
*         /*                                                         */
*         /*                                                 @G24LB31*/
*         /* ISSUE UPUT MACRO TO PUT THE UPDATED FORMAT 1.   @G24LB31*/
*         /*                                                 @G24LB31*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  0871
*         IF RESETDS1=ON THEN       /*                       @G24LB31*/
@RF00847 DS    0H                                                  0871
@RC00840 TM    RESETDS1,B'10000000'                                0871
         BNO   @RF00871                                            0871
*           DO;                     /*                       @G24LB31*/
*             CALL IDCIOPT0(GDTTBL,IOCSPTR);/*               @G24LB31*/
         L     @03,@PC00001                                        0873
         ST    @03,@AL00001                                        0873
         LA    @15,IOCSPTR                                         0873
         ST    @15,@AL00001+4                                      0873
         MVI   @AL00001+4,X'80'                                    0873
         L     @15,GDTPUT(,@03)                                    0873
         LA    @01,@AL00001                                        0873
         BALR  @14,@15                                             0873
*             RESPECIFY                                            0874
*               RTNREG RSTD;                                       0874
*             TESTRC=RTNREG;                                       0875
         STH   RTNREG,TESTRC                                       0875
*             RESPECIFY                                            0876
*               RTNREG UNRSTD;      /*                       @G24LB31*/
*                                                                  0876
*             /*******************************************************/
*             /*                                                     */
*             /*                                             @G24LB31*/
*             /* IF THE UPUT MACRO IS UNSUCCESSFUL, THEN     @G24LB31*/
*             /* SET THE RETURN CODE TO RCFAIL.              @G24LB31*/
*             /*                                             @G24LB31*/
*             /*                                                     */
*             /*******************************************************/
*                                                                  0877
*             IF TESTRC^=0 THEN                                    0877
         LH    @03,TESTRC                                          0877
         LTR   @03,@03                                             0877
         BZ    @RF00877                                            0877
*               DO;                 /*                       @G24LB31*/
*                 TERMSW=ON;        /*                       @G24LB31*/
         OI    TERMSW,B'00100000'                                  0879
*                 FMT1SRC=4;        /*                       @G24LB31*/
         LA    FMT1SRC,4                                           0880
*               END;                /*                       @G24LB31*/
*           END;                    /*                       @G24LB31*/
*                                                                  0882
@RF00877 DS    0H                                                  0883
*         /***********************************************************/
*         /*                                                         */
*         /* IF THE UPUT IS SUCCESSFUL OR THE DSORG IS NOT   #Y30LB37*/
*         /* 'AM' DSORG TYPE, THEN ISSUE A USCRATCH MACRO    #Y30LB37*/
*         /* TO SCRATCH THE FORMAT 1 DSCB.                   #Y30LB37*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  0883
*         IF FMT1SRC=0&NOSCRDS1=OFF THEN/*                   @G24LB31*/
@RF00871 LTR   FMT1SRC,FMT1SRC                                     0883
         BNZ   @RF00883                                            0883
         TM    NOSCRDS1,B'01000000'                                0883
         BNZ   @RF00883                                            0883
*           DO;                     /*                       @Y30LB37*/
*             UVOLCNT=ONE;          /*                       @Y30LB37*/
         L     @03,VVOLPTR                                         0885
         MVC   UVOLCNT(2,@03),@CH00223                             0885
*             UVOLDEV(1)=V1DEVA;    /*                       @Y30LB37*/
         L     @01,VSDEVP(,ARGLPTR)                                0886
         MVC   UVOLDEV(4,@03),V1DEVA(@01)                          0886
*             UVOLVOL(1)=V1VOLA;    /*                       @Y30LB37*/
         L     @01,VSVOLP(,ARGLPTR)                                0887
         MVC   UVOLVOL(6,@03),V1VOLA(@01)                          0887
*             CALL IDCSASC0(GDTTBL,DS1DSNAM,VVOLPTR,OVERRIDE);     0888
         L     @03,@PC00001                                        0888
         ST    @03,@AL00001                                        0888
         ST    F1PTR,@AL00001+4                                    0888
         LA    @15,VVOLPTR                                         0888
         ST    @15,@AL00001+8                                      0888
         LA    @15,OVERRIDE                                        0888
         ST    @15,@AL00001+12                                     0888
         MVI   @AL00001+12,X'80'                                   0888
         L     @15,GDTSCR(,@03)                                    0888
         LA    @01,@AL00001                                        0888
         BALR  @14,@15                                             0888
*             RESPECIFY                                            0889
*               RTNREG RSTD;                                       0889
*             TESTRC=RTNREG;                                       0890
         STH   RTNREG,TESTRC                                       0890
*             RESPECIFY                                            0891
*               RTNREG UNRSTD;      /*                       @Y30LB37*/
*                                                                  0891
*             /*******************************************************/
*             /*                                                     */
*             /* IF AN ERROR OCCURRED, CONTINUE SCRATCHING   @Y30LB37*/
*             /* MORE DATA SETS BUT SET THE SCRERRSW TO      @Y30LB37*/
*             /* REMEMBER THAT AN ERROR OCCURRED.            @Y30LB37*/
*             /*                                                     */
*             /*******************************************************/
*                                                                  0892
*             IF TESTRC^=0 THEN                                    0892
         LH    @03,TESTRC                                          0892
         LTR   @03,@03                                             0892
         BZ    @RF00892                                            0892
*               SCRERRSW=ON;        /*                       @Y30LB37*/
         OI    SCRERRSW,B'00010000'                                0893
*           END;                    /*                       @Y30LB37*/
*       END;                        /*                       @Y30LB37*/
*                                                                  0896
*     /***************************************************************/
*     /*                                                             */
*     /* IF READ FAILED OR END OF FILE SET LOOP TERMSW ON.   @Y30LB37*/
*     /* IF FMT1READ FAILED THEN ALSO SET THE RETURN CODE    @Y30LB37*/
*     /* TO RCFAIL.                                          @Y30LB37*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0896
*     ELSE                                                         0896
*       DO;                         /*                       @Y30LB37*/
         B     @RC00838                                            0896
@RF00838 DS    0H                                                  0897
*         TERMSW=ON;                /*                       @Y30LB37*/
         OI    TERMSW,B'00100000'                                  0897
*         IF TESTRC=4 THEN                                         0898
         LH    @03,TESTRC                                          0898
         C     @03,@CF00046                                        0898
         BNE   @RF00898                                            0898
*           FMT1SRC=TESTRC;         /*                       @Y30LB37*/
         LR    FMT1SRC,@03                                         0899
*       END;                        /*                       @Y30LB37*/
@RF00898 DS    0H                                                  0901
*   END FMT1LOOP;                   /*                       @Y30LB37*/
*                                                                  0901
@RC00838 DS    0H                                                  0901
@DE00831 TM    TERMSW,B'00100000'                                  0901
         BZ    @DL00831                                            0901
*   /*****************************************************************/
*   /*                                                               */
*   /* SET THE PROPER RETURN CODE IN REGISTER 15 AND THEN    @Y30LB37*/
*   /* RETURN TO THE CALLER. IF AN ERROR OCCURRED SCRATCH-   @Y30LB37*/
*   /* ING A DATA SET (SCRERRSW ON) BUT THE ENTIRE VTOC WAS  @Y30LB37*/
*   /* PROCESSED (RETURN CODE ZERO) SET THE FINAL RETURN     @Y30LB37*/
*   /* CODE TO 8.                                            @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0902
*   IF SCRERRSW=ON&FMT1SRC=0 THEN                                  0902
         TM    SCRERRSW,B'00010000'                                0902
         BNO   @RF00902                                            0902
         LTR   FMT1SRC,FMT1SRC                                     0902
         BNZ   @RF00902                                            0902
*     FMT1SRC=RCSCRERR;             /*                       @Y30LB37*/
         LA    FMT1SRC,8                                           0903
*   RETURN CODE(FMT1SRC);           /* RETURN TO MAIN ROUTINE      0904
*                                                            @Y30LB37*/
@RF00902 LR    @15,FMT1SRC                                         0904
         L     @14,@SA00010                                        0904
         LM    @00,@12,@SA00010+8                                  0904
         BR    @14                                                 0904
*   END FMT1SCR;                    /* END OF FMT1SCR PROC   @Y30LB37*/
*                                                                  0906
*/********************************************************************/
*/*                                                                  */
*/*  PROCEDURE NAME - SECHECK                                @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  FUNCTION - THIS PROCEDURE CALLS THE PROPER ROUTINES     @Y30LB37*/
*/*             TO OPEN THE VTOC, CHECK THE FORMAT 4 DSCB    @Y30LB37*/
*/*             FOR SECURITY, AND CHECK THE FORMAT 1 DSCBS   @Y30LB37*/
*/*             FOR SECURITY.                                @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  INPUT - THE INFORMATION PASSED IN THE VS1AGL ARGUMENT   @Y30LB37*/
*/*          LIST:  FIELD VSIOP AND VSNONONV FLAG.           @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  OUTPUT- THE INFORMATION RETURNED IS EITHER A ZERO, FOUR @Y30LB37*/
*/*          OR EIGHT ERROR CODE.                            @Y30LB37*/
*/*          RETURN CODES ARE:                               @Y30LB37*/
*/*          0 - SUCCESSFUL                                  @Y30LB37*/
*/*          4 - VTOC OPEN WAS UNSUCCESSFUL                  @Y30LB37*/
*/*              VTOC READ WAS UNSUCCESSFUL                  @Y30LB37*/
*/*              ERROR PASSWORD CHECKING A DATA SET          @Y30LB37*/
*/*              ERROR RETRIEVING UCB ADDRESS                @Y30LB37*/
*/*              ERROR RESERVING VOLUME                      @Y30LB37*/
*/*              ERROR READING OR UPDATING A VTOC            @Y30LB37*/
*/*              ERROR READING OR UPDATING A FORMAT 4 DSCB   @Y30LB37*/
*/*          8 - VSAM CLOSE WAS UNSUCCESSFUL                 @Y30LB37*/
*/*              ERROR CLOSING A DATA SET ON THE VTOC        @Y30LB37*/
*/*                                                                  */
*/********************************************************************/
*                                                                  0906
*SECHECK:                                                          0906
*   PROCEDURE;                      /*                       @Y30LB37*/
*                                                                  0906
SECHECK  STM   @14,@12,@SA00011                                    0906
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL DECLARATIONS FOR SECHECK                        @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0907
*   DCL                                                            0907
*     SECHKRC FIXED(15);            /* SECHECK RETURN CODE   @Y30LB37*/
*   DCL                                                            0908
*     CATPASS CHAR(4);              /* CATALOG CHK PARM AREA @Y30LB37*/
*                                                                  0909
*   /*****************************************************************/
*   /*                                                               */
*   /* CALL THE VTOCOPEN PROCEDURE TO OPEN THE VTOC          @Y30LB37*/
*   /* IF IT IS NOT ALREADY OPEN (VSIOP IS ZERO).            @Y30LB37*/
*   /* VTOCOPEN SETS THE VSIOP FIELD. IF VTOCOPEN IS         @Y30LB37*/
*   /* UNSUCCESSFUL THEN SET SECHKRC TO FOUR.                @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0909
*   OLDERID2=NEWERID2;                                             0909
         L     @03,@PC00001                                        0909
         L     @03,GDTTR2(,@03)                                    0909
         MVC   @TS00001(95),NEWERID2(@03)                          0909
         MVC   OLDERID2(95,@03),@TS00001                           0909
*   NEWID2='VSSE';                  /* ISSUE UTRACE MACRO    @Y30LB37*/
         MVC   NEWID2(4,@03),@CC01595                              0910
*   SECHKRC=0;                      /*                       @Y30LB37*/
         SLR   @15,@15                                             0911
         LR    SECHKRC,@15                                         0911
*   IF VSIOP=NULLPTR THEN                                          0912
         C     @15,VSIOP(,ARGLPTR)                                 0912
         BNE   @RF00912                                            0912
*     DO;                           /*                       @Y30LB37*/
*       CALL VTOCOPEN;              /*                       @Y30LB37*/
         BAL   @14,VTOCOPEN                                        0914
*       RESPECIFY                                                  0915
*         RTNREG RSTD;                                             0915
*       TESTRC=RTNREG;                                             0916
         STH   RTNREG,TESTRC                                       0916
*       RESPECIFY                                                  0917
*         RTNREG UNRSTD;            /*                       @Y30LB37*/
*       IF TESTRC^=0 THEN                                          0918
         LH    @03,TESTRC                                          0918
         LTR   @03,@03                                             0918
         BZ    @RF00918                                            0918
*         SECHKRC=4;                /*                       @Y30LB37*/
         LA    SECHKRC,4                                           0919
*     END;                          /*                       @Y30LB37*/
*                                                                  0920
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THE VTOC IS ALREADY OPEN PICK UP THE IOCSPTR FROM  @Y30LB37*/
*   /* THE VS1AGL.                                           @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0921
*   ELSE                                                           0921
*     IOCSPTR=VSIOP;                /*                       @Y30LB37*/
*                                                                  0921
         B     @RC00912                                            0921
@RF00912 L     @03,VSIOP(,ARGLPTR)                                 0921
         ST    @03,IOCSPTR                                         0921
*   /*****************************************************************/
*   /*                                                               */
*   /* IF VTOCOPEN SUCCESSFUL CALL FMT4CHK TO CHECK THE      @Y30LB37*/
*   /* FORMAT 4 DSCB, FOR SECURITY. PASS AS INPUT CATPASS    @Y30LB37*/
*   /* WHICH FMT4CHK WILL SET INDICATING WHETHER THE CATA-   @Y30LB37*/
*   /* LOG-LEVEL PASSWORD HAS BEEN VERIFIED OR NOT. SET      @Y30LB37*/
*   /* THE RETURN CODE TO THAT RETURNED BY FMT4CHK.          @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0922
*   IF SECHKRC=0 THEN                                              0922
@RC00912 LTR   SECHKRC,SECHKRC                                     0922
         BNZ   @RF00922                                            0922
*     DO;                           /*                       @Y30LB37*/
*       CALL FMT4CHK(CATPASS);      /*                       @Y30LB37*/
         LA    @15,CATPASS                                         0924
         ST    @15,@AL00001                                        0924
         LA    @01,@AL00001                                        0924
         BAL   @14,FMT4CHK                                         0924
*       RESPECIFY                                                  0925
*         RTNREG RSTD;                                             0925
*       TESTRC=RTNREG;                                             0926
         STH   RTNREG,TESTRC                                       0926
*       RESPECIFY                                                  0927
*         RTNREG UNRSTD;            /*                       @Y30LB37*/
*       SECHKRC=TESTRC;             /*                       @Y30LB37*/
         LH    @15,TESTRC                                          0928
         LR    SECHKRC,@15                                         0928
*                                                                  0929
*       /*************************************************************/
*       /*                                                           */
*       /* IF A NON SEVERE ERROR OCCURRED OR IF NO PASSWORD  @Y30LB37*/
*       /* PROMPTING IS REQUIRED, CALL FMT1CHK TO CHECK THE  @Y30LB37*/
*       /* FORMAT 1 DSCBS. PASS THE FMT1CHK ROUTINE THE 4-   @Y30LB37*/
*       /* BYTE CATPASS FROM FMT4CHK THAT WAS SET INDICAT-   @Y30LB37*/
*       /* ING WHETHER THE CATALOG PASSWORD WAS VERIFIED     @Y30LB37*/
*       /* OR NOT.                                           @Y30LB37*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0929
*       IF SECHKRC=4&VSNONONV=ONSECHKRC=8SECHKRC=0 THEN          0929
         C     SECHKRC,@CF00046                                    0929
         BNE   @GL00009                                            0929
         TM    VSNONONV(ARGLPTR),B'00100000'                       0929
         BO    @RT00929                                            0929
@GL00009 C     SECHKRC,@CF00040                                    0929
         BE    @RT00929                                            0929
         LTR   SECHKRC,SECHKRC                                     0929
         BNZ   @RF00929                                            0929
@RT00929 DS    0H                                                  0930
*         DO;                       /*                       @Y30LB37*/
*           CALL FMT1CHK(CATPASS);  /*                       @Y30LB37*/
         LA    @03,CATPASS                                         0931
         ST    @03,@AL00001                                        0931
         LA    @01,@AL00001                                        0931
         BAL   @14,FMT1CHK                                         0931
*           RESPECIFY                                              0932
*             RTNREG RSTD;                                         0932
*           TESTRC=RTNREG;                                         0933
         STH   RTNREG,TESTRC                                       0933
*           RESPECIFY                                              0934
*             RTNREG UNRSTD;        /*                       @Y30LB37*/
*                                                                  0934
*           /*********************************************************/
*           /*                                                       */
*           /* IF THE RETURN CODE FROM FMT1CHK IS FOUR OR    @Y30LB37*/
*           /* FMT4READ HAD AN ERROR,THEN SET RETURN CODE    @Y30LB37*/
*           /* TO FOUR. IF CLOSE ERROR SET RETCODE TO 8.     @Y30LB37*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  0935
*           IF TESTRC=4 THEN                                       0935
         LH    @03,TESTRC                                          0935
         LA    @15,4                                               0935
         CR    @03,@15                                             0935
         BNE   @RF00935                                            0935
*             SECHKRC=4;            /*                       @Y30LB37*/
         LR    SECHKRC,@15                                         0936
*           ELSE                                                   0937
*             IF TESTRC=8&SECHKRC=0 THEN                           0937
         B     @RC00935                                            0937
@RF00935 LA    @03,8                                               0937
         CH    @03,TESTRC                                          0937
         BNE   @RF00937                                            0937
         LTR   SECHKRC,SECHKRC                                     0937
         BNZ   @RF00937                                            0937
*               SECHKRC=8;          /*                       @Y30LB37*/
         LR    SECHKRC,@03                                         0938
*         END;                      /*                       @Y30LB37*/
@RF00937 DS    0H                                                  0939
@RC00935 DS    0H                                                  0940
*       IF SECHKRC=RC4RDERR THEN                                   0940
@RF00929 C     SECHKRC,@CF00509                                    0940
         BNE   @RF00940                                            0940
*         SECHKRC=4;                /*                       @Y30LB37*/
         LA    SECHKRC,4                                           0941
*     END;                          /*                       @Y30LB37*/
@RF00940 DS    0H                                                  0943
*   RETURN CODE(SECHKRC);           /* RETURN TO MAIN ROUTINE      0943
*                                                            @Y30LB37*/
@RF00922 LR    @15,SECHKRC                                         0943
         L     @14,@SA00011                                        0943
         LM    @00,@12,@SA00011+8                                  0943
         BR    @14                                                 0943
*   END SECHECK;                    /* END OF SECHECK PROC   @Y30LB37*/
*                                                                  0945
*/********************************************************************/
*/*                                                                  */
*/*  PROCEDURE NAME - FMT4CHK                                @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  FUNCTION - THIS PROCEDURE CHECKS THE FORMAT 4 DSCB      @Y30LB37*/
*/*             FOR SECURITY.  CALLS THE PROPER ROUTINES     @Y30LB37*/
*/*             TO READ THE FORMAT 4 DSCB AND VERIFY THE     @Y30LB37*/
*/*             VSAM CATALOG PASSWORD.  CALLS UPRINT TO      @Y30LB37*/
*/*             TO PRINT ERROR MESSAGE IDC3067I.             @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  INPUT - THE INFORMATION PASSED IN THE VS1AGL ARGUMENT   @Y30LB37*/
*/*          LIST:  FIELDS VSVOLP, VSMSG, AND VSNOVSAM FLAG. @Y30LB37*/
*/*          ALSO THE 4 BYTE AREA FOR RETURNING THE SECURITY @Y30LB37*/
*/*          INFORMATION CONCERNING THE CATALOG.             @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  OUTPUT- THE INFORMATION RETURNED IS EITHER A 0, 4,      @Y30LB37*/
*/*          8, OR 16 ERROR CODE WHETHER THE 'GOOD' OR 'BAD' @Y30LB37*/
*/*          TO INDICATE WHETHER THE CATALOG PASSWORD WAS    @Y30LB37*/
*/*          VERIFIED.  THE VSVSAM AND VSUCAT FIELDS MAY BE  @Y30LB37*/
*/*          SET IN THE CALLER'S VS1AGL.  FM4PASS IS SET.    @Y30LB37*/
*/*          SECURITY INFORMATION FOUND.                     @Y30LB37*/
*/*          RETURN CODES ARE:                               @Y30LB37*/
*/*          0 - SUCCESSFUL                                  @Y30LB37*/
*/*          4 - VSAM CATALOG OPEN WAS UNSUCCESSFUL          @Y30LB37*/
*/*              VOLUME OWNED BY VSAM CATALOG, BUT           @Y30LB37*/
*/*              NOT ALLOWED BY CALLER                       @Y30LB37*/
*/*              ERROR VERIFYING CATALOG PASSWORD            @Y30LB37*/
*/*              ERROR LOCATING VOLUME ENTRY                 @Y30LB37*/
*/*          8 - ERROR CLOSING VSAM CATALOG                  @Y30LB37*/
*/*          16- ERROR READING FORMAT 4 DSCB                 @Y30LB37*/
*/*                                                                  */
*/********************************************************************/
*                                                                  0945
*FMT4CHK:                                                          0945
*   PROCEDURE(FM4PASS);             /* CATPASS PASSWORD PARM @Y30LB37*/
*                                                                  0945
FMT4CHK  STM   @14,@12,@SA00012                                    0945
         MVC   @PC00012(4),0(@01)                                  0945
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL DECLARATIONS FOR FMT4CHK                        @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0946
*   DCL                                                            0946
*     FMT4CRC FIXED(15);            /* FMT4CHK RETURN CODE   @Y30LB37*/
*   DCL                                                            0947
*     FM4PASS CHAR(4);              /* CATALOG CHK PARM AREA @Y30LB37*/
*                                                                  0948
*   /*****************************************************************/
*   /*                                                               */
*   /* CALL THE FMT4READ PROCEDURE. IF THE FMT4READ IS       @Y30LB37*/
*   /* UNSUCCESSFUL THEN SET FMT4CRC TO 16.                  @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0948
*   OLDERID2=NEWERID2;                                             0948
         L     @05,@PC00001                                        0948
         L     @05,GDTTR2(,@05)                                    0948
         MVC   @TS00001(95),NEWERID2(@05)                          0948
         MVC   OLDERID2(95,@05),@TS00001                           0948
*   NEWID2='VS4C';                  /* ISSUE UTRACE MACRO    @Y30LB37*/
         MVC   NEWID2(4,@05),@CC01604                              0949
*   FMT4CRC=0;                      /*                       @Y30LB37*/
         SLR   FMT4CRC,FMT4CRC                                     0950
*   CALL FMT4READ;                  /*                       @Y30LB37*/
         BAL   @14,FMT4READ                                        0951
*   RESPECIFY                                                      0952
*     RTNREG RSTD;                                                 0952
*   TESTRC=RTNREG;                                                 0953
         STH   RTNREG,TESTRC                                       0953
*   RESPECIFY                                                      0954
*     RTNREG UNRSTD;                /*                       @Y30LB37*/
*   IF TESTRC^=0 THEN                                              0955
         LH    @05,TESTRC                                          0955
         LTR   @05,@05                                             0955
         BZ    @RF00955                                            0955
*     FMT4CRC=RC4RDERR;             /*                       @Y30LB37*/
*                                                                  0956
         LA    FMT4CRC,16                                          0956
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK IF THE VOLUME IS VSAM (DS4VSREF FLAG IS ON).    @Y30LB37*/
*   /* IF IT IS, SET THE VSVSAM BIT ON.                      @Y30LB37*/
*   /* IF THE VSNOVSAM FLAG IS ON AND THE DS4VSREF FLAG      @Y30LB37*/
*   /* IS ON THIS IS CONSIDERED UNSUCCESSFUL THEN            @Y30LB37*/
*   /* SET FMT4CRC TO FOUR AND EXIT.                         @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0957
*   IF FMT4CRC=0&DS4VSREF=ON THEN                                  0957
@RF00955 LTR   FMT4CRC,FMT4CRC                                     0957
         BNZ   @RF00957                                            0957
         L     @05,F4PTR                                           0957
         TM    DS4VSREF+44(@05),B'10000000'                        0957
         BNO   @RF00957                                            0957
*     DO;                           /*                       @Y30LB37*/
*       VSVSAM=ON;                  /*                       @Y30LB37*/
         OI    VSVSAM(ARGLPTR),B'10000000'                         0959
*                                                                  0960
*       /*************************************************************/
*       /*                                                           */
*       /* ISSUE A UPRINT MACRO IF THE VOLUME CAN            @Y30LB37*/
*       /* NOT BE OWNED BY VSAM CATALOG. THE ERROR MESSAGE   @Y30LB37*/
*       /* IS IDC3067I WITH THREE VARIATIONS ACCORDING       @Y30LB37*/
*       /* TO THE WAY VSMSG IS SET.                          @Y30LB37*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0960
*       IF VSNOVSAM=ON THEN                                        0960
         TM    VSNOVSAM(ARGLPTR),B'10000000'                       0960
         BNO   @RF00960                                            0960
*         DO;                       /*                       @Y30LB37*/
*           FMT4CRC=4;              /*                       @Y30LB37*/
         LA    FMT4CRC,4                                           0962
*           DARGSMOD=MSGCM0ID;      /*                       @Y30LB37*/
         L     @05,DDSTRU                                          0963
         MVC   DARGSMOD(3,@05),@CC01410                            0963
*           DARGDBP=VSVOLP;         /*                       @Y30LB37*/
         L     @03,VSVOLP(,ARGLPTR)                                0964
         ST    @03,DARGDBP(,@05)                                   0964
*           DARGILP=VOLSERLN;       /*                       @Y30LB37*/
         MVC   DARGILP(2,@05),@CH00035                             0965
*           IF VSFROMV=OFF&VSTOV=OFF THEN                          0966
         TM    VSFROMV(ARGLPTR),B'11000000'                        0966
         BNZ   @RF00966                                            0966
*             DARGSENT=MSG3067A;    /*                       @Y30LB37*/
         MVI   DARGSENT(@05),X'29'                                 0967
*           ELSE                                                   0968
*             IF VSTOV=ON THEN                                     0968
         B     @RC00966                                            0968
@RF00966 TM    VSTOV(ARGLPTR),B'01000000'                          0968
         BNO   @RF00968                                            0968
*               DARGSENT=MSG3067B;  /*                       @Y30LB37*/
         L     @05,DDSTRU                                          0969
         MVI   DARGSENT(@05),X'2A'                                 0969
*             ELSE                                                 0970
*               DARGSENT=MSG3067C;  /*                       @Y30LB37*/
         B     @RC00968                                            0970
@RF00968 L     @05,DDSTRU                                          0970
         MVI   DARGSENT(@05),X'2B'                                 0970
*           CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*          @Y30LB37*/
@RC00968 DS    0H                                                  0971
@RC00966 L     @05,@PC00001                                        0971
         ST    @05,@AL00001                                        0971
         LA    @03,@CF00120                                        0971
         ST    @03,@AL00001+4                                      0971
         LA    @03,DDSTRU                                          0971
         ST    @03,@AL00001+8                                      0971
         MVI   @AL00001+8,X'80'                                    0971
         L     @15,GDTPRT(,@05)                                    0971
         LA    @01,@AL00001                                        0971
         BALR  @14,@15                                             0971
*         END;                      /*                       @Y30LB37*/
*                                                                  0972
*       /*************************************************************/
*       /*                                                           */
*       /* CALL CATCHK IF THE VOLUME CAN BE OWNED BY A VSAM  @Y30LB37*/
*       /* CATALOG. THE PARAMETER PASSED IS THE CATPASS      @Y30LB37*/
*       /* FIELD FROM THE CALLING PROCEDURE. SET THE         @Y30LB37*/
*       /* RETURN CODE IF ERROR IN CATCHK TO THE CODE        @Y30LB37*/
*       /* RETURNED BY CATCHK.                               @Y30LB37*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0973
*       ELSE                                                       0973
*         DO;                       /*                       @Y30LB37*/
         B     @RC00960                                            0973
@RF00960 DS    0H                                                  0974
*           CALL CATCHK(FM4PASS);   /*                       @Y30LB37*/
         L     @05,@PC00012                                        0974
         ST    @05,@AL00001                                        0974
         LA    @01,@AL00001                                        0974
         BAL   @14,CATCHK                                          0974
*           RESPECIFY                                              0975
*             RTNREG RSTD;                                         0975
*           TESTRC=RTNREG;                                         0976
         STH   RTNREG,TESTRC                                       0976
*           RESPECIFY                                              0977
*             RTNREG UNRSTD;        /*                       @Y30LB37*/
*           IF TESTRC^=0 THEN                                      0978
         LH    @05,TESTRC                                          0978
         LTR   @05,@05                                             0978
         BZ    @RF00978                                            0978
*             FMT4CRC=TESTRC;       /*                       @Y30LB37*/
         LR    FMT4CRC,@05                                         0979
*         END;                      /*                       @Y30LB37*/
*     END;                          /*                       @Y30LB37*/
*                                                                  0982
*   /*****************************************************************/
*   /*                                                               */
*   /* THE DS4VSREF FLAG IS OFF THEN SET THE VSVSAM BIT OFF  @Y30LB37*/
*   /* AND THE VSUCAT BIT OFF.                               @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0982
*   ELSE                                                           0982
*     DO;                           /*                       @Y30LB37*/
         B     @RC00957                                            0982
@RF00957 DS    0H                                                  0983
*       VSVSAM=OFF;                 /*                       @Y30LB37*/
*       VSUCAT=OFF;                 /*                       @Y30LB37*/
         NI    VSVSAM(ARGLPTR),B'00111111'                         0984
*     END;                          /*                       @Y30LB37*/
*   RETURN CODE(FMT4CRC);           /* RETURN TO MAIN ROUTINE      0986
*                                                            @Y30LB37*/
@RC00957 LR    @15,FMT4CRC                                         0986
         L     @14,@SA00012                                        0986
         LM    @00,@12,@SA00012+8                                  0986
         BR    @14                                                 0986
*   END FMT4CHK;                    /* END OF FMT4CHK PROC   @Y30LB37*/
*                                                                  0988
*/********************************************************************/
*/*                                                                  */
*/*  PROCEDURE NAME - FMT1CHK                                @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  FUNCTION - THIS PROCEDURE CHECKS THE FORMAT 1 DSCBS     @Y30LB37*/
*/*             FOR SECURITY.  CALLS THE PROPER ROUTINES     @Y30LB37*/
*/*             TO OPEN DATA SETS, AND READ THE FORMAT 1     @Y30LB37*/
*/*             DSCBS.                                       @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  INPUT - THE INFORMATION PASSED IN THE VS1AGL ARGUMENT   @Y30LB37*/
*/*          LIST:  FIELDS VSREAD, VSWRITE, VSVOLP, VSMSG,   @Y30LB37*/
*/*          AND VSNONONV.  FMT1PASS SET WITH 'GOOD' OR      @Y30LB37*/
*/*          'BAD' TO INDICATE WHETHER THE CATALOG PASSWORD  @Y30LB37*/
*/*          HAS ALREADY BEEN VERIFIED.                      @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  OUTPUT- THE INFORMATION RETURNED IS EITHER A ZERO, FOUR @Y30LB37*/
*/*          OR EIGHT ERROR CODE AND/OR SECURITY INFORMA-    @Y30LB37*/
*/*          TION, ACCORDING TO THE INPUT REQUEST FLAGS.     @Y30LB37*/
*/*          RETURN CODES ARE:                               @Y30LB37*/
*/*          0 - SUCCESSFUL                                  @Y30LB37*/
*/*          4 - VTOC READ WAS UNSUCCESSFUL                  @Y30LB37*/
*/*              ERROR OPENING DATA SETS                     @Y30LB37*/
*/*              VOLUME HAS DATA SETS NOT ALLOWED BY CALLER  @Y30LB37*/
*/*          8 - ERROR CLOSING DATA SETS                     @Y30LB37*/
*/*                                                                  */
*/********************************************************************/
*                                                                  0988
*FMT1CHK:                                                          0988
*   PROCEDURE(FM1PASS);             /* CATPASS PASSWORD PARM @Y30LB37*/
*                                                                  0988
FMT1CHK  STM   @14,@12,@SA00013                                    0988
         MVC   @PC00013(4),0(@01)                                  0988
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL DECLARATIONS FOR FMT1CHK                        @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0989
*   DCL                                                            0989
*     FMT1CRC FIXED(15);            /* FMT1CHK RETURN CODE   @Y30LB37*/
*   DCL                                                            0990
*     FM1PASS CHAR(4);              /* CATALOG CHK PARM AREA @Y30LB37*/
*   DCL                                                            0991
*     ORGTAREA CHAR(4);             /* ORGTYPE AREA          @Y30LB37*/
*   DCL                                                            0992
*     PROTAREA CHAR(8);             /* PROTTYPE AREA         @Y30LB37*/
*                                                                  0993
*   /*****************************************************************/
*   /*                                                               */
*   /* CALL THE FMT1READ PROCEDURE IF VSNONONV BIT IS ON.    @Y30LB37*/
*   /* FMT1READ GETS THE ORGTYPE SET TO NONV AND THE PROT-   @Y30LB37*/
*   /* TYPE SET TO ALL TO READ FOR ALL NON-VSAM              @Y30LB37*/
*   /* DATA SETS. IF FMT1READ IS SUCCESSFUL THEN             @Y30LB37*/
*   /* THAT IS CONSIDERED AN ERROR. IF FMT1READ IS           @Y30LB37*/
*   /* UNSUCCESSFUL THEN SET FMT1CRC TO FOUR AND EXIT.       @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0993
*   OLDERID2=NEWERID2;                                             0993
         L     @03,@PC00001                                        0993
         L     @03,GDTTR2(,@03)                                    0993
         MVC   @TS00001(95),NEWERID2(@03)                          0993
         MVC   OLDERID2(95,@03),@TS00001                           0993
*   NEWID2='VS1C';                  /* ISSUE UTRACE MACRO    @Y30LB37*/
         MVC   NEWID2(4,@03),@CC01614                              0994
*   FMT1CRC=0;                      /*                       @Y30LB37*/
         SLR   FMT1CRC,FMT1CRC                                     0995
*   IF VSNONONV=ON THEN                                            0996
         TM    VSNONONV(ARGLPTR),B'00100000'                       0996
         BNO   @RF00996                                            0996
*     DO;                           /*                       @Y30LB37*/
*       CALL FMT1READ(ORGTNONV,PROTTALL);/*                  @Y30LB37*/
         LA    @01,@AL00998                                        0998
         BAL   @14,FMT1READ                                        0998
*       RESPECIFY                                                  0999
*         RTNREG RSTD;                                             0999
*       TESTRC=RTNREG;                                             1000
         STH   RTNREG,TESTRC                                       1000
*       RESPECIFY                                                  1001
*         RTNREG UNRSTD;            /*                       @Y30LB37*/
*       IF TESTRC=0 THEN                                           1002
         LH    @05,TESTRC                                          1002
         LTR   @05,@05                                             1002
         BNZ   @RF01002                                            1002
*         DO;                       /*                       @Y30LB37*/
*                                                                  1003
*           /*********************************************************/
*           /*                                                       */
*           /* ISSUE A UPRINT MACRO IF THE VOLUME HAS        @Y30LB37*/
*           /* SUCCESSFULLY READ A FORMAT 1. THE ERROR       @Y30LB37*/
*           /* MESSAGE IS IDC2961I WITH THREE VARIATIONS     @Y30LB37*/
*           /* ACCORDING TO THE WAY VSMSG IS SET.            @Y30LB37*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1004
*           FMT1CRC=4;              /*                       @Y30LB37*/
         LA    FMT1CRC,4                                           1004
*           DARGSMOD=MSGMODID;      /*                       @Y30LB37*/
         L     @05,DDSTRU                                          1005
         MVC   DARGSMOD(3,@05),@CC01408                            1005
*           DARGDBP=VSVOLP;         /*                       @Y30LB37*/
         L     @03,VSVOLP(,ARGLPTR)                                1006
         ST    @03,DARGDBP(,@05)                                   1006
*           DARGILP=VOLSERLN;       /*                       @Y30LB37*/
         MVC   DARGILP(2,@05),@CH00035                             1007
*           IF VSFROMV=OFF&VSTOV=OFF THEN                          1008
         TM    VSFROMV(ARGLPTR),B'11000000'                        1008
         BNZ   @RF01008                                            1008
*             DARGSENT=MSG2961A;    /*                       @Y30LB37*/
         MVI   DARGSENT(@05),X'03'                                 1009
*           ELSE                                                   1010
*             IF VSFROMV=ON THEN                                   1010
         B     @RC01008                                            1010
@RF01008 TM    VSFROMV(ARGLPTR),B'10000000'                        1010
         BNO   @RF01010                                            1010
*               DARGSENT=MSG2961B;  /*                       @Y30LB37*/
         L     @03,DDSTRU                                          1011
         MVI   DARGSENT(@03),X'0F'                                 1011
*             ELSE                                                 1012
*               DARGSENT=MSG2961C;  /*                       @Y30LB37*/
         B     @RC01010                                            1012
@RF01010 L     @03,DDSTRU                                          1012
         MVI   DARGSENT(@03),X'10'                                 1012
*           CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*          @Y30LB37*/
@RC01010 DS    0H                                                  1013
@RC01008 L     @03,@PC00001                                        1013
         ST    @03,@AL00001                                        1013
         LA    @15,@CF00120                                        1013
         ST    @15,@AL00001+4                                      1013
         LA    @15,DDSTRU                                          1013
         ST    @15,@AL00001+8                                      1013
         MVI   @AL00001+8,X'80'                                    1013
         L     @15,GDTPRT(,@03)                                    1013
         LA    @01,@AL00001                                        1013
         BALR  @14,@15                                             1013
*         END;                      /*                       @Y30LB37*/
*       IF TESTRC=4 THEN                                           1015
@RF01002 LA    @03,4                                               1015
         CH    @03,TESTRC                                          1015
         BNE   @RF01015                                            1015
*         FMT1CRC=4;                /*                       @Y30LB37*/
         LR    FMT1CRC,@03                                         1016
*     END;                          /*                       @Y30LB37*/
*                                                                  1018
*   /*****************************************************************/
*   /*                                                               */
*   /* CALL THE FMT1READ PROCEDURE IF VSNONONV BIT IS OFF.   @Y30LB37*/
*   /* FMT1READ GETS THE ORGTYPE SET TO NONV IF THE PASSED   @Y30LB37*/
*   /* PARAMETER IS CATGOOD TO READ ONLY FOR NON-VSAM DATA   @Y30LB37*/
*   /* SETS SINCE VSAM CATALOG PASSWORD HAS ALREADY          @Y30LB37*/
*   /* BEEN VERIFIED. IF VSREAD IS SET THE PROTTYPE          @Y30LB37*/
*   /* IS SET TO READ. IF VSWRITE IS SET THE PROTTYPE        @Y30LB37*/
*   /* IS SET TO WRITE. IF FMT1READ IS SUCCESSFUL THEN       @Y30LB37*/
*   /* CONTINUE WITH THE SECURITY CHECK. IF FMT1READ IS      @Y30LB37*/
*   /* UNSUCCESSFUL THEN SET FMT1CRC TO FOUR.                @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1018
*   ELSE                                                           1018
*     DO;                           /*                       @Y30LB37*/
         B     @RC00996                                            1018
@RF00996 DS    0H                                                  1019
*       V1DDCNT=''B;                /*                       @Y30LB37*/
         SLR   @03,@03                                             1019
         STH   @03,V1DDCNT                                         1019
*       SECHKSW=OFF;                /*                       @Y30LB37*/
*                                                                  1020
         NI    SECHKSW,B'11111011'                                 1020
*       /*************************************************************/
*       /*                                                           */
*       /* DO WHILE LOOP WHILE SECHKSW IS TURNED OFF.        @Y30LB37*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1021
*SECKLOOP:                                                         1021
*       DO WHILE SECHKSW=OFF;       /*                       @Y30LB37*/
SECKLOOP B     @DE01021                                            1021
@DL01021 DS    0H                                                  1022
*         IF VSREAD=ON THEN                                        1022
         TM    VSREAD(ARGLPTR),B'00010000'                         1022
         BNO   @RF01022                                            1022
*           PROTAREA=PROTREAD;      /*                       @Y30LB37*/
         MVC   PROTAREA(8),PROTREAD                                1023
*         ELSE                                                     1024
*           PROTAREA=PROTRITE;      /*                       @Y30LB37*/
         B     @RC01022                                            1024
@RF01022 MVC   PROTAREA(8),PROTRITE                                1024
*         IF FM1PASS=CATGOOD THEN                                  1025
@RC01022 L     @03,@PC00013                                        1025
         CLC   FM1PASS(4,@03),CATGOOD                              1025
         BNE   @RF01025                                            1025
*           ORGTAREA=ORGTNONV;      /*                       @Y30LB37*/
         MVC   ORGTAREA(4),ORGTNONV                                1026
*         ELSE                                                     1027
*           ORGTAREA=ORGTALL;       /*                       @Y30LB37*/
         B     @RC01025                                            1027
@RF01025 MVC   ORGTAREA(4),ORGTALL                                 1027
*         CALL FMT1READ(ORGTAREA,PROTAREA);/*                @Y30LB37*/
@RC01025 LA    @03,ORGTAREA                                        1028
         ST    @03,@AL00001                                        1028
         LA    @03,PROTAREA                                        1028
         ST    @03,@AL00001+4                                      1028
         LA    @01,@AL00001                                        1028
         BAL   @14,FMT1READ                                        1028
*         RESPECIFY                                                1029
*           RTNREG RSTD;                                           1029
*         TESTRC=RTNREG;                                           1030
         STH   RTNREG,TESTRC                                       1030
*         RESPECIFY                                                1031
*           RTNREG UNRSTD;          /*                       @Y30LB37*/
*         IF TESTRC=4 THEN                                         1032
         LH    @03,TESTRC                                          1032
         LA    @15,4                                               1032
         CR    @03,@15                                             1032
         BNE   @RF01032                                            1032
*           DO;                     /*                       @Y30LB37*/
*             FMT1CRC=4;            /*                       @Y30LB37*/
         LR    FMT1CRC,@15                                         1034
*             SECHKSW=ON;           /*                       @Y30LB37*/
         OI    SECHKSW,B'00000100'                                 1035
*           END;                    /*                       @Y30LB37*/
*         IF TESTRC=RCEOFILE THEN                                  1037
@RF01032 CLC   TESTRC(2),@CH00040                                  1037
         BNE   @RF01037                                            1037
*           SECHKSW=ON;             /*                       @Y30LB37*/
         OI    SECHKSW,B'00000100'                                 1038
*                                                                  1039
*         /***********************************************************/
*         /*                                                         */
*         /* CALL VSAMCHK, EXPIRCHK, OR NVSAMCHK DEPENDING   @Y30LB37*/
*         /* ON IF THE FORMAT 1 IS A VSAM DATA SET OR THE    @Y30LB37*/
*         /* EXPONLY SWITCH IS SET (CHECK THE EXPIRATION     @Y30LB37*/
*         /* DATE).                                          @Y30LB37*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  1039
*         IF TESTRC=0 THEN                                         1039
@RF01037 LH    @03,TESTRC                                          1039
         LTR   @03,@03                                             1039
         BNZ   @RF01039                                            1039
*           DO;                     /*                       @Y30LB37*/
*             IF DSORGAM=ON THEN                                   1041
         TM    DSORGAM(F1PTR),B'00001000'                          1041
         BNO   @RF01041                                            1041
*               CALL VSAMCHK;       /*                       @Y30LB37*/
         BAL   @14,VSAMCHK                                         1042
*             ELSE                                                 1043
*               IF EXPONLY=ON THEN                                 1043
         B     @RC01041                                            1043
@RF01041 TM    EXPONLY,B'10000000'                                 1043
         BNO   @RF01043                                            1043
*                 CALL EXPIRCHK;    /*                       @Y30LB37*/
         BAL   @14,EXPIRCHK                                        1044
*               ELSE                                               1045
*                 CALL NVSAMCHK;    /*                       @Y30LB37*/
         B     @RC01043                                            1045
@RF01043 BAL   @14,NVSAMCHK                                        1045
*             RESPECIFY                                            1046
*               RTNREG RSTD;                                       1046
@RC01043 DS    0H                                                  1046
@RC01041 DS    0H                                                  1047
*             TESTRC=RTNREG;                                       1047
         STH   RTNREG,TESTRC                                       1047
*             RESPECIFY                                            1048
*               RTNREG UNRSTD;      /*                       @Y30LB37*/
*             IF TESTRC=4 THEN                                     1049
         LH    @03,TESTRC                                          1049
         LA    @15,4                                               1049
         CR    @03,@15                                             1049
         BNE   @RF01049                                            1049
*               DO;                 /*                       @Y30LB37*/
*                 FMT1CRC=4;        /*                       @Y30LB37*/
         LR    FMT1CRC,@15                                         1051
*                 SECHKSW=ON;       /*                       @Y30LB37*/
         OI    SECHKSW,B'00000100'                                 1052
*               END;                /*                       @Y30LB37*/
*             IF TESTRC=8 THEN                                     1054
@RF01049 LH    @03,TESTRC                                          1054
         C     @03,@CF00040                                        1054
         BNE   @RF01054                                            1054
*               FMT1CRC=TESTRC;     /*                       @Y30LB37*/
         LR    FMT1CRC,@03                                         1055
*           END;                    /*                       @Y30LB37*/
@RF01054 DS    0H                                                  1057
*       END SECKLOOP;               /*                       @Y30LB37*/
@RF01039 DS    0H                                                  1057
@DE01021 TM    SECHKSW,B'00000100'                                 1057
         BZ    @DL01021                                            1057
*     END;                          /*                       @Y30LB37*/
*   RETURN CODE(FMT1CRC);           /* RETURN TO MAIN ROUTINE      1059
*                                                            @Y30LB37*/
@RC00996 LR    @15,FMT1CRC                                         1059
         L     @14,@SA00013                                        1059
         LM    @00,@12,@SA00013+8                                  1059
         BR    @14                                                 1059
*   END FMT1CHK;                    /* END OF FMT1CHK PROC   @Y30LB37*/
*                                                                  1061
*/********************************************************************/
*/*                                                                  */
*/*  PROCEDURE NAME - VSAMCHK                                @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  FUNCTION - THIS PROCEDURE OPENS THE VSAM DATA           @Y30LB37*/
*/*             SPACE.  ISSUES THE UEXCP MACRO TO OPEN THE   @Y30LB37*/
*/*             DATA SPACE, AND UEXCP MACRO TO CLOSE THE     @Y30LB37*/
*/*             DATA SPACE.                                  @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  INPUT - THE INFORMATION PASSED IN THE VS1AGL ARGUMENT   @Y30LB37*/
*/*          LIST:  FIELD VSFILEP.  DS1DSNAM FIELD IN THE    @Y30LB37*/
*/*          FORMAT 1 DSCB.                                  @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  OUTPUT- THE INFORMATION RETURNED IS EITHER A ZERO,      @Y30LB37*/
*/*          FOUR OR EIGHT ERROR CODES.                      @Y30LB37*/
*/*          RETURN CODES ARE:                               @Y30LB37*/
*/*          0 - SUCCESSFUL                                  @Y30LB37*/
*/*          4 - ERROR OPENING DATA SET                      @Y30LB37*/
*/*          8 - ERROR CLOSING DATA SET                      @Y30LB37*/
*/*                                                                  */
*/********************************************************************/
*                                                                  1061
*VSAMCHK:                                                          1061
*   PROCEDURE;                      /*                       @Y30LB37*/
*                                                                  1061
VSAMCHK  STM   @14,@12,@SA00014                                    1061
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL DECLARATIONS FOR VSAMCHK                        @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1062
*   DCL                                                            1062
*     VSAMCRC FIXED(15);            /* VSAMCHK RETURN CODE   @Y30LB37*/
*                                                                  1063
*   /*****************************************************************/
*   /*                                                               */
*   /* INITIALIZE THE OPEN ARGUMENT LIST AND OPEN THE DATA   @Y30LB37*/
*   /* SET VIA THE UEXCP MACRO. IF THE OPEN WAS NOT          @Y30LB37*/
*   /* SUCCESSFUL, SET THE RETURN CODE TO RCFAIL.            @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1063
*   RFY                                                            1063
*     EXOARG BASED(ADDR(EXOLIST));  /*                       @Y30LB37*/
*   OLDERID2=NEWERID2;                                             1064
         L     @03,@PC00001                                        1064
         L     @15,GDTTR2(,@03)                                    1064
         MVC   @TS00001(95),NEWERID2(@15)                          1064
         MVC   OLDERID2(95,@15),@TS00001                           1064
*   NEWID2='VSVC';                  /* ISSUE UTRACE MACRO    @Y30LB37*/
         MVC   NEWID2(4,@15),@CC01626                              1065
*   VSAMCRC=0;                      /*                       @Y30LB37*/
         SLR   VSAMCRC,VSAMCRC                                     1066
*   RTNAREA=''B;                    /*                       @Y30LB37*/
         SLR   @15,@15                                             1067
         ST    @15,RTNAREA                                         1067
*   EXOARG=''B;                     /*                       @Y30LB37*/
         LA    @15,EXOLIST                                         1068
         XC    EXOARG(34,@15),EXOARG(@15)                          1068
*   EXOPASS=ON;                     /*                       @Y30LB37*/
         OI    EXOPASS(@15),B'00100000'                            1069
*   EXOVSN=VSVOLP;                  /* INSERT VOLUME SERIAL  @ZA09532*/
         L     @14,VSVOLP(,ARGLPTR)                                1070
         ST    @14,EXOVSN(,@15)                                    1070
*   EXODDN=VSFILEP;                 /*                       @Y30LB37*/
         L     @14,VSFILEP(,ARGLPTR)                               1071
         ST    @14,EXODDN(,@15)                                    1071
*   EXODSN=ADDR(DS1DSNAM);          /*                       @Y30LB37*/
         ST    F1PTR,EXODSN(,@15)                                  1072
*   EXOCTLBK=ADDR(RTNAREA);         /*                       @Y30LB37*/
         LA    @14,RTNAREA                                         1073
         ST    @14,EXOCTLBK(,@15)                                  1073
*   EXOREAD=ON;                     /*                       @Y30LB37*/
         OI    EXOREAD(@15),B'10000000'                            1074
*   CALL IDCIO050(GDTTBL,OPEN,EXOARG);/*                     @Y30LB37*/
         ST    @03,@AL00001                                        1075
         LA    @14,OPEN                                            1075
         ST    @14,@AL00001+4                                      1075
         ST    @15,@AL00001+8                                      1075
         MVI   @AL00001+8,X'80'                                    1075
         L     @15,GDTEXP(,@03)                                    1075
         LA    @01,@AL00001                                        1075
         BALR  @14,@15                                             1075
*   RESPECIFY                                                      1076
*     RTNREG RSTD;                                                 1076
*   TESTRC=RTNREG;                                                 1077
         STH   RTNREG,TESTRC                                       1077
*   RESPECIFY                                                      1078
*     RTNREG UNRSTD;                /*                       @Y30LB37*/
*   IF TESTRC^=0 THEN                                              1079
         LH    @03,TESTRC                                          1079
         LTR   @03,@03                                             1079
         BZ    @RF01079                                            1079
*     VSAMCRC=4;                    /*                       @Y30LB37*/
*                                                                  1080
         LA    VSAMCRC,4                                           1080
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THE OPEN WAS SUCCESSFUL THEN ISSUE THE CLOSE       @Y30LB37*/
*   /* MACRO VIA THE UEXCP MACRO. IF THE OPEN WAS NOT        @Y30LB37*/
*   /* SUCCESSFUL, SET THE RETURN CODE TO RCNCLOSE UNLESS    @Y30LB37*/
*   /* THE RETURN CODE IS RCFAIL.                            @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1081
*   IF RTNAREA^=NULLPTR THEN                                       1081
@RF01079 L     @03,RTNAREA                                         1081
         LTR   @03,@03                                             1081
         BZ    @RF01081                                            1081
*     DO;                           /*                       @Y30LB37*/
*       CALL IDCIO050(GDTTBL,CLOSE,RTNAREA);/*               @Y30LB37*/
         L     @03,@PC00001                                        1083
         ST    @03,@AL00001                                        1083
         LA    @15,CLOSE                                           1083
         ST    @15,@AL00001+4                                      1083
         LA    @15,RTNAREA                                         1083
         ST    @15,@AL00001+8                                      1083
         MVI   @AL00001+8,X'80'                                    1083
         L     @15,GDTEXP(,@03)                                    1083
         LA    @01,@AL00001                                        1083
         BALR  @14,@15                                             1083
*       RESPECIFY                                                  1084
*         RTNREG RSTD;                                             1084
*       TESTRC=RTNREG;                                             1085
         STH   RTNREG,TESTRC                                       1085
*       RESPECIFY                                                  1086
*         RTNREG UNRSTD;            /*                       @Y30LB37*/
*       IF TESTRC^=0&VSAMCRC^=4 THEN                               1087
         LH    @03,TESTRC                                          1087
         LTR   @03,@03                                             1087
         BZ    @RF01087                                            1087
         C     VSAMCRC,@CF00046                                    1087
         BE    @RF01087                                            1087
*         VSAMCRC=8;                /*                       @Y30LB37*/
         LA    VSAMCRC,8                                           1088
*     END;                          /*                       @Y30LB37*/
@RF01087 DS    0H                                                  1090
*   RETURN CODE(VSAMCRC);           /* RETURN TO MAIN ROUTINE      1090
*                                                            @Y30LB37*/
@RF01081 LR    @15,VSAMCRC                                         1090
         L     @14,@SA00014                                        1090
         LM    @00,@12,@SA00014+8                                  1090
         BR    @14                                                 1090
*   END VSAMCHK;                    /* END OF VSAMCHK PROC   @Y30LB37*/
*                                                                  1092
*/********************************************************************/
*/*                                                                  */
*/*  PROCEDURE NAME - NVSAMCHK                               @Y30LB37*/
*/*                                                          @Y30LB37*/
*/* FUNCTION - THIS PROC OPENS THE NON-VSAM NON-RACF DATA    @G24LB31*/
*/*             SET.  ISSUES THE UIOINFO MACRO TO LOCATE THE @Y30LB37*/
*/*             DSNAME THAT CORRESPONDS TO THE DD CARDS FOR  @Y30LB37*/
*/*             PASSWORD CHECKING.  ISSUES THE UEXCP         @Y30LB37*/
*/*             MACRO TO OPEN THE DATA SET, AND UEXCP        @Y30LB37*/
*/*             MACRO TO CLOSE THE DATA  SET.                @Y30LB37*/
*/*             ISSUES UPRINT MACRO TO PRINT MESSAGE         @Y30LB37*/
*/*             IDC2960I IF ANY PASSWORD FILE ERRORS.        @Y30LB37*/
*/*             FOR RACF PROTECTED NON-VSAM DATA SETS,       @G24LB31*/
*/*             ISSUES THE URACHECK MACRO FOR RACF           @G24LB31*/
*/*             AUTHORIZATION CHECKING.                      @G24LB31*/
*/*                                                          @Y30LB37*/
*/*  INPUT - THE INFORMATION PASSED IN THE VS1AGL ARGUMENT   @Y30LB37*/
*/*          LIST:  FIELDS VSFILEP AND VSVOLP.  VSFILEP      @Y30LB37*/
*/*          POINTS TO A TABLE OF DDNAMES FOR THE PASSWORD   @Y30LB37*/
*/*          FILES SPECIFIED ON THE UTILITY COMMAND.  THE    @Y30LB37*/
*/*          FORMAT 1 DSCB OF DATA SET TO BE RACF OR         @G24LB31*/
*/*          PASSWORD CHECKED.                               @G24LB31*/
*/*          V1DSNTBL IS SET WITH THE DDNAME AND COR-        @G24LB31*/
*/*          RESPONDING DATA SET NAME OF THOSE PASSWORD      @Y30LB37*/
*/*          DD CARD FOR WHICH UIOINFO HAS ALREADY BEEN      @Y30LB37*/
*/*          ISSUED.                                         @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  OUTPUT- THE INFORMATION RETURNED IS EITHER A ZERO,      @Y30LB37*/
*/*          FOUR OR EIGHT ERROR CODES. V1DSNTBL IS UPDATED  @Y30LB37*/
*/*          WITH MORE DDNAMES AND CORRESPONDING DSNAMES.    @Y30LB37*/
*/*          RETURN CODES ARE:                               @Y30LB37*/
*/*          0 - SUCCESSFUL                                  @Y30LB37*/
*/*          4 - ERROR OPENING DATA SET                      @Y30LB37*/
*/*              NO DD CARD FOR DATA SET                     @Y30LB37*/
*/*              ERROR RETRIEVING THE NAME OF THE DATA SET   @Y30LB37*/
*/*          8 - ERROR CLOSING DATA SET                      @Y30LB37*/
*/*                                                                  */
*/********************************************************************/
*                                                                  1092
*NVSAMCHK:                                                         1092
*   PROCEDURE;                      /*                       @Y30LB37*/
NVSAMCHK STM   @14,@12,@SA00015                                    1092
*                                                                  1093
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL DECLARATIONS FOR NVSAMCHK                       @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1093
*   DCL                                                            1093
*     NVSAMRC FIXED(15);            /* NVSAMCHK RETURN CODE  @Y30LB37*/
*   DCL                                                            1094
*     NVCOUNT FIXED(15);            /* DDNAME INTERNAL COUNT @Y30LB37*/
*                                                                  1094
*   /*****************************************************************/
*   /*                                                               */
*   /* DECLARATION FOR PASSWORD FILE TABLE IN FDT.           @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1095
*   DCL                                                            1095
*     1 PFILE BASED(VSPFILEP) BDY(HWORD),                          1095
*      2 PFILECNT FIXED(15),        /* COUNT OF ENTRIES      @Y30LB37*/
*      2 *(255) BDY(HWORD),                                        1095
*       3 PFILELEN FIXED(8),        /* DATA ITEM LENGTH      @Y30LB37*/
*       3 PFILEVAL CHAR(8);         /* DATA ITEM VALUE       @Y30LB37*/
*   DCL                                                            1096
*     1 IOINFBLK BDY(WORD),         /* UIOINFO RETURN AREA   @Y30LB37*/
*      2 IOHEADLN FIXED(15),        /* HEADER LENGTH PASSED  @Y30LB37*/
*      2 IOHEAD02 FIXED(15),        /* HEADER LEN RETURNED   @Y30LB37*/
*      2 IOID CHAR(2),              /* ID FIELD              @Y30LB37*/
*      2 IOLENGTH CHAR(2),          /* DATA LENGTH           @Y30LB37*/
*      2 IORETDSN CHAR(44);         /* RETURNED DSNAME       @Y30LB37*/
*   DCL                                                            1097
*     IOINFBYT CHAR(1);             /* UIOINFO OPTION BYTE   @Y30LB37*/
*   DCL                                                            1098
*     V1NVDDNM CHAR(8);             /* UIOINFO DDNAME        @Y30LB37*/
*   DCL                                                            1099
*     IOBLKPTR PTR(31);             /* POINTER TO IOINFOBLK  @Y30LB37*/
*                                                                  1100
*   /*****************************************************************/
*   /*                                                               */
*   /* ISSUE UTRACE MACRO AND INITIALIZE THE RETURN CODE.    @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1100
*   RFY                                                            1100
*     IOINFOPT BASED(ADDR(IOINFBYT));/*                      @Y30LB37*/
*   RFY                                                            1101
*     EXOARG BASED(ADDR(EXOLIST));  /*                       @Y30LB37*/
*   OLDERID2=NEWERID2;                                             1102
         L     @03,@PC00001                                        1102
         L     @03,GDTTR2(,@03)                                    1102
         MVC   @TS00001(95),NEWERID2(@03)                          1102
         MVC   OLDERID2(95,@03),@TS00001                           1102
*   NEWID2='VSNC';                  /* ISSUE UTRACE MACRO    @Y30LB37*/
         MVC   NEWID2(4,@03),@CC01650                              1103
*   OPENSW=OFF;                     /*                       @Y30LB37*/
         NI    OPENSW,B'11111101'                                  1104
*   NVSAMRC=0;                      /*                       @Y30LB37*/
         SLR   NVSAMRC,NVSAMRC                                     1105
*   IOINFBYT=''B;                   /*                       @Y30LB37*/
         MVI   IOINFBYT,X'00'                                      1106
*   RTNAREA=''B;                    /*                       @Y30LB37*/
         SLR   @03,@03                                             1107
         ST    @03,RTNAREA                                         1107
*   EXOARG=''B;                     /*                       @Y30LB37*/
         LA    @03,EXOLIST                                         1108
         XC    EXOARG(34,@03),EXOARG(@03)                          1108
*                                                                  1109
*   /*****************************************************************/
*   /*                                                               */
*   /*                                                       @G24LB31*/
*   /* IF THE NON-VSAM DATA SET IS RACF PROTECTED,           @G24LB31*/
*   /* ISSUE THE URACHECK MACRO TO VERIFY ACCESS TO          @G24LB31*/
*   /* THE RACF PROTECTED NON-VSAM DATA SET.                 @G24LB31*/
*   /*                                                       @G24LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1109
*   IF PROTRACF=ON THEN             /*                       @G24LB31*/
         TM    PROTRACF(F1PTR),B'01000000'                         1109
         BNO   @RF01109                                            1109
*     DO;                           /*                       @G24LB31*/
*       VS1RACF=''B;                /*                       @G24LB31*/
         XC    VS1RACF(20),VS1RACF                                 1111
*       RACFDSTV=OFF;               /* RACF NON-VSAM D.S.    @G24LB31*/
         LA    @03,VS1RACF                                         1112
         NI    RACFDSTV(@03),B'11101111'                           1112
*       IF VSREAD=ON THEN           /*                       @G24LB31*/
         TM    VSREAD(ARGLPTR),B'00010000'                         1113
         BNO   @RF01113                                            1113
*         RACFTRD=ON;               /* RACF READ ACCESS      @G24LB31*/
         OI    RACFTRD(@03),B'00000010'                            1114
*       ELSE                        /*                       @G24LB31*/
*         RACFTUPD=ON;              /* RACF UPDATE ACCESS    @G24LB31*/
         B     @RC01113                                            1115
@RF01113 LA    @03,VS1RACF                                         1115
         OI    RACFTUPD(@03),B'00000100'                           1115
*       RACFENT=ADDR(DS1DSNAM);     /*                       @G24LB31*/
@RC01113 LA    @03,VS1RACF                                         1116
         ST    F1PTR,RACFENT(,@03)                                 1116
*       RACFCLN=ADDR(CLASSRAC);     /* RACF PROTECTION CLASS @G24LB31*/
         LA    @15,CLASSRAC                                        1117
         ST    @15,RACFCLN(,@03)                                   1117
*       CLASSLEN=LENGTH(CLASSDS);   /*                       @G24LB31*/
         MVI   CLASSLEN,X'07'                                      1118
*       CLASSNM=CLASSDS;            /*                       @G24LB31*/
         MVI   CLASSNM+7,C' '                                      1119
         MVC   CLASSNM(7),CLASSDS                                  1119
*       RACFVOLS=VSVOLP;            /*                       @G24LB31*/
         L     @15,VSVOLP(,ARGLPTR)                                1120
         ST    @15,RACFVOLS(,@03)                                  1120
*       CALL IDCSARK0(GDTTBL,VRACFPTR);/*                    @G24LB31*/
         L     @03,@PC00001                                        1121
         ST    @03,@AL00001                                        1121
         LA    @15,VRACFPTR                                        1121
         ST    @15,@AL00001+4                                      1121
         MVI   @AL00001+4,X'80'                                    1121
         L     @15,GDTRCK(,@03)                                    1121
         LA    @01,@AL00001                                        1121
         BALR  @14,@15                                             1121
*       RESPECIFY                                                  1122
*         RTNREG RSTD;                                             1122
*       TESTRC=RTNREG;                                             1123
         STH   RTNREG,TESTRC                                       1123
*       RESPECIFY                                                  1124
*         RTNREG UNRSTD;            /*                       @G24LB31*/
*                                                                  1124
*       /*************************************************************/
*       /*                                                           */
*       /* ************************************************* @G24LB31*/
*       /*                                                   @G24LB31*/
*       /* IF URACHECK MACRO IS UNSUCCESSFUL, SET RETURN     @G24LB31*/
*       /* CODE TO RCFAIL.                                   @G24LB31*/
*       /*                                                   @G24LB31*/
*       /* ************************************************* @G24LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1125
*       IF TESTRC^=0 THEN           /*                       @G24LB31*/
         LH    @03,TESTRC                                          1125
         LTR   @03,@03                                             1125
         BZ    @RF01125                                            1125
*         NVSAMRC=4;                /*                       @G24LB31*/
         LA    NVSAMRC,4                                           1126
*     END;                          /*                       @G24LB31*/
*                                                                  1128
*   /*****************************************************************/
*   /*                                                               */
*   /*                                                       @G24LB31*/
*   /* IF THE DATA SET IS NOT RACF PROTECTED, PROCEED WITH   @G24LB31*/
*   /* PASSWORD PROTECTION CHECKING.                         @G24LB31*/
*   /*                                                       @G24LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1128
*   ELSE                            /*                       @G24LB31*/
*NONRACF:                           /*                       @G24LB31*/
*     DO;                           /*                       @G24LB31*/
*                                                                  1128
         B     @RC01109                                            1128
@RF01109 DS    0H                                                  1128
NONRACF  DS    0H                                                  1129
*       /*************************************************************/
*       /*                                                           */
*       /*                                                   @G24LB31*/
*       /* CHECK IF PFILE LIST WAS SPECIFIED. IF NOT THEN    @G24LB31*/
*       /* SET RETURN CODE TO PRINT MESSAGE IDC2960I.        @G24LB31*/
*       /*                                                   @G24LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1129
*       IF VSPFILEP=NULLPTR THEN                                   1129
         L     @03,VSPFILEP(,ARGLPTR)                              1129
         LTR   @03,@03                                             1129
         BNZ   @RF01129                                            1129
*         NVSAMRC=RCPRTMSG;         /*                       #Y30LB37*/
*                                                                  1130
         LA    NVSAMRC,16                                          1130
*       /*************************************************************/
*       /*                                                           */
*       /* PROCESS THE INTERNAL DSNAME TABLE OF PASSWORD FILE        */
*       /*                                                   @Y30LB37*/
*       /* DDNAMES AND CORRESPONDING DSNAMES TO FIND THE DSNAME      */
*       /*                                                   @Y30LB37*/
*       /* PASSED AS INPUT. IF THE DSNAME IS FOUND TURN ON THE       */
*       /*                                                   @Y30LB37*/
*       /* OPENSW TO INDICATE A DDNAME WAS FOUND TO OPEN AND @Y30LB37*/
*       /* RETRIEVE THE DDNAME FROM THE TABLE AND EXIT.      @Y30LB37*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1131
*       NVCOUNT=ONE;                /*                       @Y30LB37*/
@RF01129 LA    NVCOUNT,1                                           1131
*SCANLOOP:                                                         1132
*       DO WHILE(NVCOUNT<=V1DDCNT&OPENSW=OFF&NVSAMRC=0);           1132
SCANLOOP B     @DE01132                                            1132
@DL01132 DS    0H                                                  1133
*         IF V1DDSNAM(NVCOUNT)=DS1DSNAM THEN                       1133
         LR    @15,NVCOUNT                                         1133
         MH    @15,@CH01708                                        1133
         LA    @14,V1DDSNAM-52(@15)                                1133
         CLC   0(44,@14),DS1DSNAM(F1PTR)                           1133
         BNE   @RF01133                                            1133
*           DO;                     /*                       @Y30LB37*/
*             OPENSW=ON;            /*                       @Y30LB37*/
         OI    OPENSW,B'00000010'                                  1135
*             EXODDN=ADDR(V1DDDNAM(NVCOUNT));/*              @Y30LB37*/
         LA    @14,EXOLIST                                         1136
         LA    @15,V1DDDNAM-52(@15)                                1136
         ST    @15,EXODDN(,@14)                                    1136
*           END;                    /*                       @Y30LB37*/
*         NVCOUNT=NVCOUNT+ONE;      /*                       @Y30LB37*/
@RF01133 AL    NVCOUNT,@CF00223                                    1138
*       END SCANLOOP;               /*                       @Y30LB37*/
@DE01132 CH    NVCOUNT,V1DDCNT                                     1139
         BH    @DC01132                                            1139
         TM    OPENSW,B'00000010'                                  1139
         BNZ   @DC01132                                            1139
         LTR   NVSAMRC,NVSAMRC                                     1139
         BZ    @DL01132                                            1139
@DC01132 DS    0H                                                  1140
*                                                                  1140
*       /*************************************************************/
*       /*                                                           */
*       /* IF THE DD CARD FOR THE INPUT DATA SET NAME HAS NOT        */
*       /*                                                   @Y30LB37*/
*       /* ALREADY BEEN FOUND, THEN PROCESS THE PASSWORD INPUT       */
*       /*                                                   @Y30LB37*/
*       /* FILE (PFILE) TABLE. WHEN ALL THE DDNAMES IN THE   @Y30LB37*/
*       /* PFILE TABLE ARE PROCESSED, SET THE RETURN CODE TO @Y30LB37*/
*       /* ISSUE MESSAGE IDC2960I. IF NOT ISSUE USYSINFO.    @Y30LB37*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1140
*FINDLOOP:                                                         1140
*       DO WHILE(OPENSW=OFF&NVSAMRC=0);/*                    @Y30LB37*/
FINDLOOP B     @DE01140                                            1140
@DL01140 DS    0H                                                  1141
*         IF PFILECNT=V1DDCNT THEN                                 1141
         L     @03,VSPFILEP(,ARGLPTR)                              1141
         CLC   PFILECNT(2,@03),V1DDCNT                             1141
         BNE   @RF01141                                            1141
*           NVSAMRC=RCPRTMSG;       /*                       @Y30LB37*/
         LA    NVSAMRC,16                                          1142
*         ELSE                                                     1143
*           DO;                     /*                       @Y30LB37*/
*                                                                  1143
         B     @RC01141                                            1143
@RF01141 DS    0H                                                  1144
*             /*******************************************************/
*             /*                                                     */
*             /* ISSUE USYSINFO MACRO TO OBTAIN DSNAME THAT  @Y30LB37*/
*             /* CORRESPONDS TO THE DDNAME.                  @Y30LB37*/
*             /*                                                     */
*             /*******************************************************/
*                                                                  1144
*             IOINFBLK=''B;         /*                       @Y30LB37*/
         XC    IOINFBLK(52),IOINFBLK                               1144
*             IOHEADLN=LENGTH(IOINFBLK);/*                   @Y30LB37*/
         MVC   IOHEADLN(2),@CH01708                                1145
*             IOBLKPTR=ADDR(IOINFBLK);/*                     @Y30LB37*/
         LA    @03,IOINFBLK                                        1146
         ST    @03,IOBLKPTR                                        1146
*             IOINFDSN=ON;          /*                       @Y30LB37*/
         LA    @03,IOINFBYT                                        1147
         OI    IOINFDSN(@03),B'00100000'                           1147
*             V1NVDDNM=PFILEVAL(V1DDCNT+ONE);/*              @Y30LB37*/
         LH    @03,V1DDCNT                                         1148
         MH    @03,@CH00036                                        1148
         L     @01,VSPFILEP(,ARGLPTR)                              1148
         ALR   @01,@03                                             1148
         MVC   V1NVDDNM(8),PFILEVAL(@01)                           1148
*             CALL IDCIOSI0(GDTTBL,IOINFBYT,IOBLKPTR,V1NVDDNM);    1149
         L     @03,@PC00001                                        1149
         ST    @03,@AL00001                                        1149
         LA    @15,IOINFBYT                                        1149
         ST    @15,@AL00001+4                                      1149
         LA    @15,IOBLKPTR                                        1149
         ST    @15,@AL00001+8                                      1149
         LA    @15,V1NVDDNM                                        1149
         ST    @15,@AL00001+12                                     1149
         MVI   @AL00001+12,X'80'                                   1149
         L     @15,GDTIFO(,@03)                                    1149
         LA    @01,@AL00001                                        1149
         BALR  @14,@15                                             1149
*             RESPECIFY                                            1150
*               RTNREG RSTD;                                       1150
*             TESTRC=RTNREG;                                       1151
         STH   RTNREG,TESTRC                                       1151
*             RESPECIFY                                            1152
*               RTNREG UNRSTD;      /*                       @Y30LB37*/
*                                                                  1152
*             /*******************************************************/
*             /*                                                     */
*             /* IF USYSINFO MACRO IS UNSUCCESSFUL SET RETURN        */
*             /*                                             @Y30LB37*/
*             /* CODE TO RCFAIL.                             @Y30LB37*/
*             /*                                                     */
*             /*******************************************************/
*                                                                  1153
*             IF TESTRC^=0 THEN                                    1153
         LH    @03,TESTRC                                          1153
         LTR   @03,@03                                             1153
         BZ    @RF01153                                            1153
*               NVSAMRC=4;          /*                       @Y30LB37*/
         LA    NVSAMRC,4                                           1154
*                                                                  1155
*             /*******************************************************/
*             /*                                                     */
*             /* SET THE DDNAME OF CORRESPONDING DATA SET NAME       */
*             /*                                             @Y30LB37*/
*             /* IN THE INTERNAL TABLE. IF NO DATA SET NAME  @Y30LB37*/
*             /* WAS FOUND IN THE JFCB, MOVE 44 BLANKS INTO  @Y30LB37*/
*             /* THE INTERNAL TABLE INSTEAD OF THE DSNAME.   @Y30LB37*/
*             /*                                                     */
*             /*******************************************************/
*                                                                  1155
*             ELSE                                                 1155
*               DO;                 /*                       @Y30LB37*/
         B     @RC01153                                            1155
@RF01153 DS    0H                                                  1156
*                 V1DDCNT=V1DDCNT+ONE;/*                     @Y30LB37*/
         LA    @03,1                                               1156
         AH    @03,V1DDCNT                                         1156
         STH   @03,V1DDCNT                                         1156
*                 V1DDDNAM(V1DDCNT)=V1NVDDNM;/*              @Y30LB37*/
         MH    @03,@CH01708                                        1157
         LA    @01,V1DDDNAM-52(@03)                                1157
         MVC   0(8,@01),V1NVDDNM                                   1157
*                 IF IOLENGTH=ZEROFLD2 THEN                        1158
         CLC   IOLENGTH(2),ZEROFLD2                                1158
         BNE   @RF01158                                            1158
*                   V1DDSNAM(V1DDCNT)=' ';/*                 @Y30LB37*/
         LA    @01,V1DDSNAM-52(@03)                                1159
         MVI   1(@01),C' '                                         1159
         MVC   2(42,@01),1(@01)                                    1159
         MVI   0(@01),C' '                                         1159
*                 ELSE                                             1160
*                   V1DDSNAM(V1DDCNT)=IORETDSN;/*            @Y30LB37*/
*                                                                  1160
         B     @RC01158                                            1160
@RF01158 LH    @03,V1DDCNT                                         1160
         MH    @03,@CH01708                                        1160
         LA    @01,V1DDSNAM-52(@03)                                1160
         MVC   0(44,@01),IORETDSN                                  1160
*                 /***************************************************/
*                 /*                                                 */
*                 /* IF DSNAMES ARE EQUAL THEN SET OPENSW ON.        */
*                 /*                                         @Y30LB37*/
*                 /* SET DDNAME IN OPEN ARGUMENT LIST.       @Y30LB37*/
*                 /*                                                 */
*                 /***************************************************/
*                                                                  1161
*                 IF V1DDSNAM(V1DDCNT)=DS1DSNAM THEN               1161
@RC01158 LH    @03,V1DDCNT                                         1161
         MH    @03,@CH01708                                        1161
         LA    @01,V1DDSNAM-52(@03)                                1161
         CLC   0(44,@01),DS1DSNAM(F1PTR)                           1161
         BNE   @RF01161                                            1161
*                   DO;             /*                       @Y30LB37*/
*                     OPENSW=ON;    /*                       @Y30LB37*/
         OI    OPENSW,B'00000010'                                  1163
*                     EXODDN=ADDR(V1DDDNAM(V1DDCNT));/*      @Y30LB37*/
         LA    @15,EXOLIST                                         1164
         LA    @03,V1DDDNAM-52(@03)                                1164
         ST    @03,EXODDN(,@15)                                    1164
*                   END;            /*                       @Y30LB37*/
*               END;                /*                       @Y30LB37*/
@RF01161 DS    0H                                                  1167
*           END;                    /*                       @Y30LB37*/
@RC01153 DS    0H                                                  1168
*       END FINDLOOP;               /*                       @Y30LB37*/
@RC01141 DS    0H                                                  1168
@DE01140 TM    OPENSW,B'00000010'                                  1168
         BNZ   @DC01140                                            1168
         LTR   NVSAMRC,NVSAMRC                                     1168
         BZ    @DL01140                                            1168
@DC01140 DS    0H                                                  1169
*                                                                  1169
*       /*************************************************************/
*       /*                                                           */
*       /* PRINT MESSAGE IDC2960I TO INDICATE A DD CARD WAS NOT      */
*       /*                                                   @Y30LB37*/
*       /* FOUND FOR THE DSNAME, IF THE RETURN CODE IS       @Y30LB37*/
*       /* RCPRTMSG SET THE RETURN CODE TO RCFAIL.           @Y30LB37*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1169
*       IF NVSAMRC=RCPRTMSG THEN                                   1169
         C     NVSAMRC,@CF00509                                    1169
         BNE   @RF01169                                            1169
*         DO;                       /*                       @Y30LB37*/
*           DARGSMOD=MSGMODID;      /*                       @Y30LB37*/
         L     @03,DDSTRU                                          1171
         MVC   DARGSMOD(3,@03),@CC01408                            1171
*           DARGSENT=MSG2960I;      /*                       @Y30LB37*/
         MVI   DARGSENT(@03),X'02'                                 1172
*           DARGDBP=ADDR(DS1DSNAM); /*                       @Y30LB37*/
         ST    F1PTR,DARGDBP(,@03)                                 1173
*           DARGILP=LENGTH(DS1DSNAM);/*                      @Y30LB37*/
         MVC   DARGILP(2,@03),@CH00849                             1174
*           CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*          @Y30LB37*/
         L     @03,@PC00001                                        1175
         ST    @03,@AL00001                                        1175
         LA    @15,@CF00120                                        1175
         ST    @15,@AL00001+4                                      1175
         LA    @15,DDSTRU                                          1175
         ST    @15,@AL00001+8                                      1175
         MVI   @AL00001+8,X'80'                                    1175
         L     @15,GDTPRT(,@03)                                    1175
         LA    @01,@AL00001                                        1175
         BALR  @14,@15                                             1175
*           NVSAMRC=4;              /*                       @Y30LB37*/
         LA    NVSAMRC,4                                           1176
*         END;                      /*                       @Y30LB37*/
*                                                                  1177
*       /*************************************************************/
*       /*                                                           */
*       /* IF A DD CARD HAS BEEN FOUND TO OPEN, THEN         @Y30LB37*/
*       /* INITIALIZE THE OPEN ARGUMENT LIST AND ISSUE       @Y30LB37*/
*       /* THE UEXCP MACRO. IF THE OPEN IS NOT SUCCESSFUL,   @Y30LB37*/
*       /* SET THE RETURN CODE TO RCFAIL.                    @Y30LB37*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1178
*       IF OPENSW=ON THEN                                          1178
@RF01169 TM    OPENSW,B'00000010'                                  1178
         BNO   @RF01178                                            1178
*         DO;                       /*                       @Y30LB37*/
*           EXOPASS=ON;             /* PASSWORD VERIFY ON    @Y30LB37*/
         LA    @03,EXOLIST                                         1180
         OI    EXOPASS(@03),B'00100000'                            1180
*           EXOVSN=VSVOLP;          /* INSERT VOLUME SERIAL  @Y30LB37*/
         L     @15,VSVOLP(,ARGLPTR)                                1181
         ST    @15,EXOVSN(,@03)                                    1181
*           EXOCTLBK=ADDR(RTNAREA); /* ADDRESS OPEN BLOCK    @Y30LB37*/
         LA    @15,RTNAREA                                         1182
         ST    @15,EXOCTLBK(,@03)                                  1182
*           IF VSREAD=ON THEN                                      1183
         TM    VSREAD(ARGLPTR),B'00010000'                         1183
         BNO   @RF01183                                            1183
*             EXOREAD=ON;           /* OPEN READ IF VSREAD   @Y30LB37*/
         OI    EXOREAD(@03),B'10000000'                            1184
*           CALL IDCIO050(GDTTBL,OPEN,EXOARG);/*             @Y30LB37*/
@RF01183 L     @03,@PC00001                                        1185
         ST    @03,@AL00001                                        1185
         LA    @15,OPEN                                            1185
         ST    @15,@AL00001+4                                      1185
         LA    @15,EXOLIST                                         1185
         ST    @15,@AL00001+8                                      1185
         MVI   @AL00001+8,X'80'                                    1185
         L     @15,GDTEXP(,@03)                                    1185
         LA    @01,@AL00001                                        1185
         BALR  @14,@15                                             1185
*           RESPECIFY                                              1186
*             RTNREG RSTD;                                         1186
*           TESTRC=RTNREG;                                         1187
         STH   RTNREG,TESTRC                                       1187
*           RESPECIFY                                              1188
*             RTNREG UNRSTD;        /*                       @Y30LB37*/
*           IF TESTRC^=0 THEN                                      1189
         LH    @03,TESTRC                                          1189
         LTR   @03,@03                                             1189
         BZ    @RF01189                                            1189
*             NVSAMRC=4;            /*                       @Y30LB37*/
         LA    NVSAMRC,4                                           1190
*         END;                      /*                       @Y30LB37*/
@RF01189 DS    0H                                                  1192
*                                                                  1192
*       /*************************************************************/
*       /*                                                           */
*       /* IF THE OPEN WAS PERFORMED THEN ISSUE THE CLOSE    @Y30LB37*/
*       /* MACRO VIA THE UEXCP MACRO. IF CLOSE NOT SUCCESSFUL,       */
*       /*                                                   @Y30LB37*/
*       /* SET RETURN CODE TO RCNCLOSE ONLY IF RETURN CODE IS        */
*       /*                                                   @Y30LB37*/
*       /* NOT MORE SEVERE ALREADY.                          @Y30LB37*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1192
*       IF RTNAREA^=NULLPTR THEN                                   1192
@RF01178 L     @03,RTNAREA                                         1192
         LTR   @03,@03                                             1192
         BZ    @RF01192                                            1192
*         DO;                       /*                       @Y30LB37*/
*           CALL IDCIO050(GDTTBL,CLOSE,RTNAREA);/*           @Y30LB37*/
         L     @03,@PC00001                                        1194
         ST    @03,@AL00001                                        1194
         LA    @15,CLOSE                                           1194
         ST    @15,@AL00001+4                                      1194
         LA    @15,RTNAREA                                         1194
         ST    @15,@AL00001+8                                      1194
         MVI   @AL00001+8,X'80'                                    1194
         L     @15,GDTEXP(,@03)                                    1194
         LA    @01,@AL00001                                        1194
         BALR  @14,@15                                             1194
*           RESPECIFY                                              1195
*             RTNREG RSTD;                                         1195
*           TESTRC=RTNREG;                                         1196
         STH   RTNREG,TESTRC                                       1196
*           RESPECIFY                                              1197
*             RTNREG UNRSTD;        /*                       @Y30LB37*/
*           IF TESTRC^=0&NVSAMRC^=4 THEN                           1198
         LH    @03,TESTRC                                          1198
         LTR   @03,@03                                             1198
         BZ    @RF01198                                            1198
         C     NVSAMRC,@CF00046                                    1198
         BE    @RF01198                                            1198
*             NVSAMRC=8;            /*                       @Y30LB37*/
         LA    NVSAMRC,8                                           1199
*         END;                      /*                       @Y30LB37*/
@RF01198 DS    0H                                                  1201
*     END NONRACF;                  /*                       @G24LB31*/
@RF01192 DS    0H                                                  1202
*   RETURN CODE(NVSAMRC);           /* RETURN TO MAIN ROUTINE      1202
*                                                            @Y30LB37*/
@RC01109 LR    @15,NVSAMRC                                         1202
         L     @14,@SA00015                                        1202
         LM    @00,@12,@SA00015+8                                  1202
         BR    @14                                                 1202
*   END NVSAMCHK;                   /* END OF NVSAMCHK PROC  @Y30LB37*/
*                                                                  1204
*/********************************************************************/
*/*                                                                  */
*/*  PROCEDURE NAME - EXPIRCHK                               @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  FUNCTION - THIS PROCEDURE OPENS THE NON-EXPIRED DATA    @Y30LB37*/
*/*             SET TO ASK FOR OPERATOR PERMISSION.          @Y30LB37*/
*/*             ISSUES THE UEXCP MACRO TO OPEN THE           @Y30LB37*/
*/*             DATA SET, AND UEXCP MACRO TO CLOSE THE DATA  @Y30LB37*/
*/*             SET.                                         @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  INPUT - THE INFORMATION PASSED IN THE VS1AGL ARGUMENT   @Y30LB37*/
*/*          LIST:  FIELD VSFILEP.                           @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  OUTPUT- THE INFORMATION RETURNED IS EITHER A ZERO,      @Y30LB37*/
*/*          FOUR OR EIGHT ERROR CODES.                      @Y30LB37*/
*/*          RETURN CODES ARE:                               @Y30LB37*/
*/*          0 - SUCCESSFUL                                  @Y30LB37*/
*/*          4 - ERROR OPENING DATA SET                      @Y30LB37*/
*/*          8 - ERROR CLOSING DATA SET                      @Y30LB37*/
*/*                                                                  */
*/********************************************************************/
*                                                                  1204
*EXPIRCHK:                                                         1204
*   PROCEDURE;                      /*                       @Y30LB37*/
*                                                                  1204
EXPIRCHK STM   @14,@12,@SA00016                                    1204
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL DECLARATIONS FOR EXPIRCHK                       @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1205
*   DCL                                                            1205
*     EXPIRRC FIXED(15);            /* EXPIRCHK RETURN CODE  @Y30LB37*/
*                                                                  1206
*   /*****************************************************************/
*   /*                                                               */
*   /* INITIALIZE THE OPEN ARGUMENT LIST AND ISSUE           @Y30LB37*/
*   /* THE UEXCP MACRO TO OPEN THE DATA SET FOR OUTPUT.      @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1206
*   RFY                                                            1206
*     EXOARG BASED(ADDR(EXOLIST));  /*                       @Y30LB37*/
*   OLDERID2=NEWERID2;                                             1207
         L     @03,@PC00001                                        1207
         L     @15,GDTTR2(,@03)                                    1207
         MVC   @TS00001(95),NEWERID2(@15)                          1207
         MVC   OLDERID2(95,@15),@TS00001                           1207
*   NEWID2='VSEC';                  /* ISSUE UTRACE MACRO    @Y30LB37*/
         MVC   NEWID2(4,@15),@CC01664                              1208
*   EXPIRRC=0;                      /*                       @Y30LB37*/
         SLR   EXPIRRC,EXPIRRC                                     1209
*   RTNAREA=''B;                    /*                       @Y30LB37*/
         SLR   @15,@15                                             1210
         ST    @15,RTNAREA                                         1210
*   EXOARG=''B;                     /*                       @Y30LB37*/
         LA    @15,EXOLIST                                         1211
         XC    EXOARG(34,@15),EXOARG(@15)                          1211
*   EXOPASS=ON;                     /*                       @Y30LB37*/
         OI    EXOPASS(@15),B'00100000'                            1212
*   EXOVSN=VSVOLP;                  /* INSERT VOLUME SERIAL  @ZA09532*/
         L     @14,VSVOLP(,ARGLPTR)                                1213
         ST    @14,EXOVSN(,@15)                                    1213
*   EXODDN=VSFILEP;                 /*                       @Y30LB37*/
         L     @14,VSFILEP(,ARGLPTR)                               1214
         ST    @14,EXODDN(,@15)                                    1214
*   EXODSN=ADDR(DS1DSNAM);          /*                       @Y30LB37*/
         ST    F1PTR,EXODSN(,@15)                                  1215
*   EXOCTLBK=ADDR(RTNAREA);         /*                       @Y30LB37*/
         LA    @14,RTNAREA                                         1216
         ST    @14,EXOCTLBK(,@15)                                  1216
*   CALL IDCIO050(GDTTBL,OPEN,EXOARG);/*                     @Y30LB37*/
         ST    @03,@AL00001                                        1217
         LA    @14,OPEN                                            1217
         ST    @14,@AL00001+4                                      1217
         ST    @15,@AL00001+8                                      1217
         MVI   @AL00001+8,X'80'                                    1217
         L     @15,GDTEXP(,@03)                                    1217
         LA    @01,@AL00001                                        1217
         BALR  @14,@15                                             1217
*   RESPECIFY                                                      1218
*     RTNREG RSTD;                                                 1218
*   TESTRC=RTNREG;                                                 1219
         STH   RTNREG,TESTRC                                       1219
*   RESPECIFY                                                      1220
*     RTNREG UNRSTD;                /*                       @Y30LB37*/
*                                                                  1220
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THE OPEN IS UNSUCCESSFUL THEN SET RETURN CODE      @Y30LB37*/
*   /* TO RCFAIL.                                            @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1221
*   IF TESTRC^=0 THEN                                              1221
         LH    @03,TESTRC                                          1221
         LTR   @03,@03                                             1221
         BZ    @RF01221                                            1221
*     EXPIRRC=4;                    /*                       @Y30LB37*/
         LA    EXPIRRC,4                                           1222
*                                                                  1223
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THE OPEN WAS PERFORMED THEN ISSUE THE CLOSE        @Y30LB37*/
*   /* MACRO VIA THE UEXCP MACRO. IF CLOSE NOT SUCCESSFUL,   @Y30LB37*/
*   /* SET RETURN CODE TO RCNCLOSE ONLY IF RETURN CODE IS    @Y30LB37*/
*   /* NOT MORE SEVERE ALREADY.                              @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1223
*   IF RTNAREA^=NULLPTR THEN                                       1223
@RF01221 L     @03,RTNAREA                                         1223
         LTR   @03,@03                                             1223
         BZ    @RF01223                                            1223
*     DO;                           /*                       @Y30LB37*/
*       CALL IDCIO050(GDTTBL,CLOSE,RTNAREA);/*               @Y30LB37*/
         L     @03,@PC00001                                        1225
         ST    @03,@AL00001                                        1225
         LA    @15,CLOSE                                           1225
         ST    @15,@AL00001+4                                      1225
         LA    @15,RTNAREA                                         1225
         ST    @15,@AL00001+8                                      1225
         MVI   @AL00001+8,X'80'                                    1225
         L     @15,GDTEXP(,@03)                                    1225
         LA    @01,@AL00001                                        1225
         BALR  @14,@15                                             1225
*       RESPECIFY                                                  1226
*         RTNREG RSTD;                                             1226
*       TESTRC=RTNREG;                                             1227
         STH   RTNREG,TESTRC                                       1227
*       RESPECIFY                                                  1228
*         RTNREG UNRSTD;            /*                       @Y30LB37*/
*       IF TESTRC^=0&EXPIRRC^=4 THEN                               1229
         LH    @03,TESTRC                                          1229
         LTR   @03,@03                                             1229
         BZ    @RF01229                                            1229
         C     EXPIRRC,@CF00046                                    1229
         BE    @RF01229                                            1229
*         EXPIRRC=8;                /*                       @Y30LB37*/
         LA    EXPIRRC,8                                           1230
*     END;                          /*                       @Y30LB37*/
@RF01229 DS    0H                                                  1232
*   RETURN CODE(EXPIRRC);           /* RETURN TO MAIN ROUTINE      1232
*                                                            @Y30LB37*/
@RF01223 LR    @15,EXPIRRC                                         1232
         L     @14,@SA00016                                        1232
         LM    @00,@12,@SA00016+8                                  1232
         BR    @14                                                 1232
*   END EXPIRCHK;                   /* END OF EXPIRCHK PROC  @Y30LB37*/
*                                                                  1234
*/********************************************************************/
*/*                                                                  */
*/*  PROCEDURE NAME - CATCHK                                 @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  FUNCTION - THIS PROCEDURE DETERMINES IF THE VOLUME IS   @Y30LB37*/
*/*             OWNED BY THE VSAM CATALOG, VERIFIES THE      @Y30LB37*/
*/*             CATALOG MASTER LEVEL PASSWORD, AND DETER-    @Y30LB37*/
*/*             MINES IF THE USER CATALOG IS ON THIS         @Y30LB37*/
*/*             VOLUME.  CALLS CATOPEN TO OPEN THE CATALOG,  @Y30LB37*/
*/*             AND PRINTS ERROR MESSAGES IDC3009I,          @Y30LB37*/
*/*             IDC3007I AND IDC2962I.                       @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  INPUT - THE INFORMATION PASSED IN THE VS1AGL ARGUMENT   @Y30LB37*/
*/*          LIST: FIELDS VSCATP, VSCATDDP, VSVOLP, VSACBP,  @Y30LB37*/
*/*          VSUCTEST AND VSPSWDP.  CHKPASS IS THE CATPASS   @Y30LB37*/
*/*          PARM TO BE UPDATED WITH 'GOOD' OR 'BAD'.        @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  OUTPUT- THE INFORMATION RETURNED IS EITHER A ZERO, FOUR @Y30LB37*/
*/*          OR EIGHT ERROR CODE.  CHKPASS IS SET TO 'GOOD'  @Y30LB37*/
*/*          IF THE CATALOG PASSWORD WAS VERIFIED OR SET     @Y30LB37*/
*/*          TO 'BAD' OTHERWISE.  VSUCAT IS SET TO 1 IF THE  @Y30LB37*/
*/*          USER CATALOG IS ON THE VOLUME ELSE SET TO ZERO. @Y30LB37*/
*/*          RETURN CODES ARE:                               @Y30LB37*/
*/*          0 - SUCCESSFUL                                  @Y30LB37*/
*/*          4 - ERROR VERIFYING PASSWORDS                   @Y30LB37*/
*/*              ERROR OPENING THE CATALOG                   @Y30LB37*/
*/*              ERROR LOCATING VOLUME ENTRY OR OTHER ERROR  @Y30LB37*/
*/*          8 - ERROR CLOSING THE CATALOG                   @Y30LB37*/
*/*              ERROR DEALLOCATING CATALOG                  @Y30LB37*/
*/*                                                                  */
*/********************************************************************/
*                                                                  1234
*CATCHK:                                                           1234
*   PROCEDURE(CHKPASS);             /* CATPASS PASSWORD PARM @Y30LB37*/
CATCHK   STM   @14,@12,@SA00017                                    1234
         MVC   @PC00017(4),0(@01)                                  1234
*                                                                  1235
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL DECLARATIONS FOR CATCHK                         @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1235
*   DCL                                                            1235
*     CATCKRC FIXED(15);            /* CATCHK RETURN CODE    @Y30LB37*/
*   DCL                                                            1236
*     CHKPASS CHAR(4);              /* CATALOG CHK PARM AREA @Y30LB37*/
*   DCL                                                            1237
*     V1CPLIST CHAR(LENGTH(CTGPL)+LENGTH(CTGFIELD))/* CATALOG      1237
*                                                            @Y30LB37*/
*         BDY(WORD);                /* PARAMETER LIST        @Y30LB37*/
*   DCL                                                            1238
*     V1CFLIST CHAR(LENGTH(CTGFL)+LENGTH(CTGFLDAT))/* CATALOG      1238
*                                                            @Y30LB37*/
*         BDY(WORD);                /* PARAMETER LIST        @Y30LB37*/
*   DCL                                                            1239
*     V1CPSAVE CHAR(LENGTH(CTGPL)+LENGTH(CTGFIELD))/* CATALOG      1239
*                                                            @Y30LB37*/
*         BDY(WORD);                /* PARAMETER SAVE LIST   @Y30LB37*/
*   DCL                                                            1240
*     V1CFSAVE CHAR(LENGTH(CTGFL)+LENGTH(CTGFLDAT))/* CATALOG      1240
*                                                            @Y30LB37*/
*         BDY(WORD);                /* PARAMETER SAVE LIST   @Y30LB37*/
*   DCL                                                            1241
*     CATIOCSP PTR(31);             /* IOCSTR POINTER        @Y30LB37*/
*   DCL                                                            1242
*     CATACB PTR(31);               /* ACB POINTER           @Y30LB37*/
*   DCL                                                            1243
*     1 VOLBLOCK,                   /* VOLSER AND BLANKS     @Y30LB37*/
*      2 VOLBSER CHAR(6),           /* VOLSER AREA           @Y30LB37*/
*      2 VOLBLANK CHAR(38);         /* BLANK OUT AREA        @Y30LB37*/
*   DCL                                                            1244
*     1 V1CWORKA BDY(WORD),         /* CTGPL WORK AREA       @Y30LB37*/
*      2 V1CWRKLN FIXED(15),        /* LENGTH AREA           @Y30LB37*/
*      2 V1CRETLN FIXED(15),        /* LENGTH AREA           @Y30LB37*/
*      2 V1CWRKAR CHAR(3);          /* RETURN AREA           @ZM00982*/
*   DCL                                                            1245
*     V1ENTID CHAR(8) STATIC        /* ENTRY ID CONSTANT     @Y30LB37*/
*         INIT('ENTIDNO ');         /* INITIALIZED           @Y30LB37*/
*   DCL                                                            1246
*     RCPASERR FIXED(15) CONSTANT(56);/* PASSWORD ERROR      @Y30LB37*/
*   DCL                                                            1247
*     RCNVOLEN FIXED(15) CONSTANT(8);/* NO ENTRY ERROR       @Y30LB37*/
*   DCL                                                            1248
*     USERCAT9 CHAR(3) STATIC INIT('000009'X);/*             @ZM00982*/
*                                                                  1248
*   /*****************************************************************/
*   /*                                                               */
*   /* USER ENTRY ID NO                                      @ZM00982*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1249
*                                                                  1249
*   /*****************************************************************/
*   /*                                                               */
*   /* INITIALIZE THE CPL AND FPL ALSO INITIALIZE            @Y30LB37*/
*   /* THE PARAMETERS TO ZEROS.                              @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1249
*   OLDERID2=NEWERID2;                                             1249
         L     @03,@PC00001                                        1249
         L     @03,GDTTR2(,@03)                                    1249
         MVC   @TS00001(95),NEWERID2(@03)                          1249
         MVC   OLDERID2(95,@03),@TS00001                           1249
*   NEWID2='VSCC';                  /* ISSUE UTRACE MACRO    @Y30LB37*/
         MVC   NEWID2(4,@03),@CC01692                              1250
*   CATCKRC=0;                      /*                       @Y30LB37*/
         SLR   @15,@15                                             1251
         LR    CATCKRC,@15                                         1251
*   CTGPLPTR=ADDR(V1CPLIST);        /*                       @Y30LB37*/
         LA    @03,V1CPLIST                                        1252
         ST    @03,CTGPLPTR                                        1252
*   CTGFLPTR=ADDR(V1CFLIST);        /*                       @Y30LB37*/
         LA    CTGFLPTR,V1CFLIST                                   1253
*   CTGPL=''B;                      /*                       @Y30LB37*/
         XC    CTGPL(28,@03),CTGPL(@03)                            1254
*   CTGFL=''B;                      /*                       @Y30LB37*/
         XC    CTGFL(16,CTGFLPTR),CTGFL(CTGFLPTR)                  1255
*   CATIOCSP=NULLPTR;               /*                       @Y30LB37*/
         ST    @15,CATIOCSP                                        1256
*   CATACB=NULLPTR;                 /*                       @Y30LB37*/
         ST    @15,CATACB                                          1257
*   VOLBLANK=''B;                   /*                       @Y30LB37*/
         XC    VOLBLANK(38),VOLBLANK                               1258
*                                                                  1259
*   /*****************************************************************/
*   /*                                                               */
*   /* CALL THE CATOPEN PROCEDURE IF THERE IS NO CATALOG     @Y30LB37*/
*   /* ACB ALREADY (VSACBP IS ZERO), AND A CATALOG DD CARD   @Y30LB37*/
*   /* IS PASSED OR NEEDS TO BE RETURNED (VSCATDDP IS        @Y30LB37*/
*   /* NOT EQUAL TO ZEROS).                                  @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1259
*   IF VSACBP=NULLPTR&VSCATDDP^=NULLPTR THEN                       1259
         C     @15,VSACBP(,ARGLPTR)                                1259
         BNE   @RF01259                                            1259
         C     @15,VSCATDDP(,ARGLPTR)                              1259
         BE    @RF01259                                            1259
*     DO;                           /*                       @Y30LB37*/
*       CALL CATOPEN(CATACB,CATIOCSP);/*                     @Y30LB37*/
         LA    @03,CATACB                                          1261
         ST    @03,@AL00001                                        1261
         LA    @03,CATIOCSP                                        1261
         ST    @03,@AL00001+4                                      1261
         LA    @01,@AL00001                                        1261
         BAL   @14,CATOPEN                                         1261
*       RESPECIFY                                                  1262
*         RTNREG RSTD;                                             1262
*       TESTRC=RTNREG;                                             1263
         STH   RTNREG,TESTRC                                       1263
*       RESPECIFY                                                  1264
*         RTNREG UNRSTD;            /*                       @Y30LB37*/
*                                                                  1264
*       /*************************************************************/
*       /*                                                           */
*       /* IF CATOPEN IS UNSUCCESSFUL SET RETURN CODE TO     @Y30LB37*/
*       /* RCFAIL.                                           @Y30LB37*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1265
*       IF TESTRC^=0 THEN                                          1265
         LH    @03,TESTRC                                          1265
         LTR   @03,@03                                             1265
         BZ    @RF01265                                            1265
*         CATCKRC=4;                /*                       @Y30LB37*/
         LA    CATCKRC,4                                           1266
*     END;                          /*                       @Y30LB37*/
*                                                                  1267
@RF01265 DS    0H                                                  1268
*   /*****************************************************************/
*   /*                                                               */
*   /* ISSUE THE UCATLG MACRO TO LOCATE THE VOLUME ENTRY     @Y30LB37*/
*   /* AND VERIFY RACF ALTER AUTHORIZATION OR                @G24LB31*/
*   /* THE MASTER LEVEL PASSWORD OF THE                      @G24LB31*/
*   /* CATALOG IF RETURN CODE IS ZERO. SET THE CPL           @Y30LB37*/
*   /* AND FPL TO ISSUE THE UCATLG. INITIALIZE THE CPL       @Y30LB37*/
*   /* ACCORDING TO THE INPUT VS1AGL PARAMETERS.             @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1268
*   IF CATCKRC=0 THEN                                              1268
@RF01259 SLR   @03,@03                                             1268
         CR    CATCKRC,@03                                         1268
         BNE   @RF01268                                            1268
*     DO;                           /*                       @Y30LB37*/
*       CTGMAST=ON;                 /*                       @Y30LB37*/
*       CTGNAME=ON;                 /*                       @Y30LB37*/
         L     @15,CTGPLPTR                                        1271
         OI    CTGMAST(@15),B'01000100'                            1271
*       CTGAM0=ON;                  /*                       @Y30LB37*/
*       CTGNUM=ON;                  /*                       @Y30LB37*/
         OI    CTGAM0(@15),B'00000011'                             1273
*                                                                  1274
*       /*************************************************************/
*       /*                                                           */
*       /* IF VSACBP AND CATACB POINTERS ARE ZERO THEN USE   @Y30LB37*/
*       /* THE CATALOG NAME POINTER AND TURN ON CTGCNAME.    @Y30LB37*/
*       /* IF NOT, THEN USE ONE OF THE TWO FIELDS WHICH      @Y30LB37*/
*       /* WAS SPECIFIED BY THE CALLER.                      @Y30LB37*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1274
*       IF VSACBP=NULLPTR&CATACB=NULLPTR THEN                      1274
         C     @03,VSACBP(,ARGLPTR)                                1274
         BNE   @RF01274                                            1274
         C     @03,CATACB                                          1274
         BNE   @RF01274                                            1274
*         DO;                       /*                       @Y30LB37*/
*           CTGCNAME=ON;            /*                       @Y30LB37*/
         OI    CTGCNAME(@15),B'00000010'                           1276
*           CTGCAT=VSCATP;          /*                       @Y30LB37*/
         L     @03,VSCATP(,ARGLPTR)                                1277
         ST    @03,CTGCAT(,@15)                                    1277
*         END;                      /*                       @Y30LB37*/
*       ELSE                                                       1279
*         IF VSACBP^=NULLPTR THEN                                  1279
         B     @RC01274                                            1279
@RF01274 L     @03,VSACBP(,ARGLPTR)                                1279
         LTR   @03,@03                                             1279
         BZ    @RF01279                                            1279
*           CTGCAT=ADDR(VSACBP);    /*                       @ZM30711*/
         LA    @03,VSACBP(,ARGLPTR)                                1280
         L     @01,CTGPLPTR                                        1280
         ST    @03,CTGCAT(,@01)                                    1280
*         ELSE                                                     1281
*           CTGCAT=ADDR(CATACB);    /*                       @ZM30711*/
         B     @RC01279                                            1281
@RF01279 LA    @03,CATACB                                          1281
         L     @01,CTGPLPTR                                        1281
         ST    @03,CTGCAT(,@01)                                    1281
*       V1CWRKLN=LENGTH(V1CWORKA);  /* INIT LENGTH OF WRK    @Y30LB37*/
@RC01279 DS    0H                                                  1282
@RC01274 MVC   V1CWRKLN(2),@CH00041                                1282
*       CTGWKA=ADDR(V1CWORKA);      /* ADDRESS OF WRK AREA   @Y30LB37*/
         L     @03,CTGPLPTR                                        1283
         LA    @15,V1CWORKA                                        1283
         ST    @15,CTGWKA(,@03)                                    1283
*       VOLBSER=V1VOLA;             /* INSERT VOLSER         @Y30LB37*/
         L     @01,VSVOLP(,ARGLPTR)                                1284
         MVC   VOLBSER(6),V1VOLA(@01)                              1284
*       CTGENT=ADDR(VOLBLOCK);      /* ADDRESS OF VOLSER WRK @Y30LB37*/
         LA    @15,VOLBLOCK                                        1285
         ST    @15,CTGENT(,@03)                                    1285
*       CTGFUNC=CTGLOC;             /* FUNCTION LOCATE       @Y30LB37*/
         NI    CTGFUNC(@03),B'00111111'                            1286
         OI    CTGFUNC(@03),B'00100000'                            1286
*       CTGNOFLD=1;                 /* NO OF CTGFL FIELDS    @Y30LB37*/
         MVI   CTGNOFLD(@03),X'01'                                 1287
*       CTGPSWD=VSPSWDP;            /* PASSWORD POINTER      @Y30LB37*/
         L     @15,VSPSWDP(,ARGLPTR)                               1288
         ST    @15,CTGPSWD(,@03)                                   1288
*       CTGFIELD(1)=CTGFLPTR;       /* CTGFL FIELD POINTER   @Y30LB37*/
         ST    CTGFLPTR,CTGFIELD(,@03)                             1289
*       CTGFLDNO=1;                 /* CTGFL FIELD NUMBER    @Y30LB37*/
         MVI   CTGFLDNO(CTGFLPTR),X'01'                            1290
*       CTGFLDNM=ADDR(V1ENTID);     /* CATALOG ENTRY ID      @Y30LB37*/
*                                                                  1291
         LA    @03,V1ENTID                                         1291
         ST    @03,CTGFLDNM(,CTGFLPTR)                             1291
*       /*************************************************************/
*       /*                                                           */
*       /* IF VSUCTEST IS ON THEN SAVE THE INITIALIZED       @Y30LB37*/
*       /* CATALOG PARAMETER LISTS.                          @Y30LB37*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1292
*       IF VSUCTEST=ON THEN                                        1292
         TM    VSUCTEST(ARGLPTR),B'00000100'                       1292
         BNO   @RF01292                                            1292
*         DO;                       /*                       @Y30LB37*/
*           V1CPSAVE=V1CPLIST;      /*                       @Y30LB37*/
         MVC   V1CPSAVE(32),V1CPLIST                               1294
*           V1CFSAVE=V1CFLIST;      /*                       @Y30LB37*/
         MVC   V1CFSAVE(24),V1CFLIST                               1295
*         END;                      /*                       @Y30LB37*/
*                                                                  1296
*       /*************************************************************/
*       /*                                                           */
*       /* ISSUE UCATLG MACRO WITH CPL POINTER SPECIFIED.    @Y30LB37*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1297
*       CALL IDCSACA0(GDTTBL,CTGPLPTR);/*                    @Y30LB37*/
@RF01292 L     @05,@PC00001                                        1297
         ST    @05,@AL00001                                        1297
         LA    @03,CTGPLPTR                                        1297
         ST    @03,@AL00001+4                                      1297
         L     @15,GDTCAT(,@05)                                    1297
         LA    @01,@AL00001                                        1297
         BALR  @14,@15                                             1297
*       RESPECIFY                                                  1298
*         RTNREG RSTD;                                             1298
*       TESTRC=RTNREG;                                             1299
         STH   RTNREG,TESTRC                                       1299
*       RESPECIFY                                                  1300
*         RTNREG UNRSTD;            /*                       @Y30LB37*/
*                                                                  1301
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK IF THE RETURN CODE FROM UCATLG IS ZERO.     @Y30LB37*/
*       /* SET CHKPASS TO 'GOOD' IF ZERO. IF FAILURE         @Y30LB37*/
*       /* PRINT ERROR MESSAGES ACCORDINGLY AND SET          @Y30LB37*/
*       /* CHKPASS TO 'BAD'.                                 @Y30LB37*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1301
*       IF TESTRC=0 THEN                                           1301
         LH    @05,TESTRC                                          1301
         LTR   @05,@05                                             1301
         BNZ   @RF01301                                            1301
*         CHKPASS=CATGOOD;          /*                       @Y30LB37*/
         L     @05,@PC00017                                        1302
         MVC   CHKPASS(4,@05),CATGOOD                              1302
*       ELSE                                                       1303
*         DO;                       /*                       @Y30LB37*/
         B     @RC01301                                            1303
@RF01301 DS    0H                                                  1304
*           CHKPASS=CATBAD;         /*                       @Y30LB37*/
*                                                                  1304
         L     @05,@PC00017                                        1304
         MVC   CHKPASS(4,@05),CATBAD                               1304
*           /*********************************************************/
*           /*                                                       */
*           /* IF UCATLG RETURNED A PASSWORD ERROR THEN SET  @Y30LB37*/
*           /* THE CATCKRC TO A PASSWORD ERROR IF CHECKING   @YD00171*/
*           /* CATALOG MASTER PASSWORD IS NOT REQUIRED.      @YD00171*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1305
*           IF TESTRC=RCPASERR&VSUCMAST=OFF THEN                   1305
         LA    @05,56                                              1305
         CH    @05,TESTRC                                          1305
         BNE   @RF01305                                            1305
         TM    VSUCMAST(ARGLPTR),B'00000001'                       1305
         BNZ   @RF01305                                            1305
*             CATCKRC=RCPASERR;     /*                       @YD00171*/
         LR    CATCKRC,@05                                         1306
*           ELSE                                                   1307
*                                                                  1307
*             /*******************************************************/
*             /*                                                     */
*             /* IF CMS RETURNED A NO VOLUME ENTRY ERROR     @Y30LB37*/
*             /* RETURN CODE THEN PRINT MESSAGE IDC2962I     @Y30LB37*/
*             /* AND SET RETURN CODE TO RCFAIL.              @Y30LB37*/
*             /*                                                     */
*             /*******************************************************/
*                                                                  1307
*             IF TESTRC=RCNVOLEN THEN                              1307
         B     @RC01305                                            1307
@RF01305 CLC   TESTRC(2),@CH00040                                  1307
         BNE   @RF01307                                            1307
*               DO;                 /*                       @Y30LB37*/
*                 CATCKRC=4;        /*                       @Y30LB37*/
         LA    CATCKRC,4                                           1309
*                 DARGSMOD=MSGMODID;/*                       @Y30LB37*/
         L     @05,DDSTRU                                          1310
         MVC   DARGSMOD(3,@05),@CC01408                            1310
*                 DARGSENT=MSG2962I;/*                       @Y30LB37*/
         MVI   DARGSENT(@05),X'04'                                 1311
*                 DARGDBP=VSVOLP;   /*                       @Y30LB37*/
         L     @03,VSVOLP(,ARGLPTR)                                1312
         ST    @03,DARGDBP(,@05)                                   1312
*                 DARGILP=VOLSERLN; /*                       @Y30LB37*/
         MVC   DARGILP(2,@05),@CH00035                             1313
*                 CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*    @Y30LB37*/
         L     @05,@PC00001                                        1314
         ST    @05,@AL00001                                        1314
         LA    @03,@CF00120                                        1314
         ST    @03,@AL00001+4                                      1314
         LA    @03,DDSTRU                                          1314
         ST    @03,@AL00001+8                                      1314
         MVI   @AL00001+8,X'80'                                    1314
         L     @15,GDTPRT(,@05)                                    1314
         LA    @01,@AL00001                                        1314
         BALR  @14,@15                                             1314
*               END;                /*                       @Y30LB37*/
*                                                                  1316
*           /*********************************************************/
*           /*                                                       */
*           /* IF CMS RETURNED INFORMATION IN FEED BACK      @Y30LB37*/
*           /* AREA PRINT MESSAGE IDC3009I.                  @Y30LB37*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1316
*             ELSE                                                 1316
*               DO;                 /*                       @Y30LB37*/
         B     @RC01307                                            1316
@RF01307 DS    0H                                                  1317
*                 CATCKRC=4;        /*                       @Y30LB37*/
         LA    CATCKRC,4                                           1317
*                 IF CTGFDBK^=NULLPTR THEN                         1318
         L     @05,CTGPLPTR                                        1318
         LH    @03,CTGFDBK(,@05)                                   1318
         N     @03,@CF01734                                        1318
         LTR   @03,@03                                             1318
         BZ    @RF01318                                            1318
*                   DO;             /*                       @Y30LB37*/
*                     PRINTARG=''B; /*                       @Y30LB37*/
         XC    PRINTARG(44),PRINTARG                               1320
*                     DARGSMOD=MSGUV0ID;/*                   @Y30LB37*/
         L     @03,DDSTRU                                          1321
         MVC   DARGSMOD(3,@03),@CC01412                            1321
*                     DARGSENT=MUV3009I;/*                   @Y30LB37*/
         MVI   DARGSENT(@03),X'0A'                                 1322
*                     DARGRETP=NULLPTR;/*                    @Y30LB37*/
         SLR   @15,@15                                             1323
         ST    @15,DARGRETP(,@03)                                  1323
*                     DARGCNT=3;    /*                       @Y30LB37*/
         LA    @15,3                                               1324
         STH   @15,DARGCNT(,@03)                                   1324
*                     DARGINS(1)=1; /*                       @Y30LB37*/
         MVC   DARGINS(2,@03),@CH00223                             1325
*                     DARGDTM(1)=ADDR(TESTRC);/*             @Y30LB37*/
         LA    @14,TESTRC                                          1326
         ST    @14,DARGDTM(,@03)                                   1326
*                     DARGINL(1)=LENGTH(TESTRC);/*           @Y30LB37*/
         LA    @14,2                                               1327
         STH   @14,DARGINL(,@03)                                   1327
*                     DARGINS(2)=2; /*                       @Y30LB37*/
         STH   @14,DARGINS+8(,@03)                                 1328
*                     DARGDTM(2)=ADDR(CTGFDBK);/*            @Y30LB37*/
         LA    @01,CTGFDBK(,@05)                                   1329
         ST    @01,DARGDTM+8(,@03)                                 1329
*                     DARGINL(2)=LENGTH(CTGFDBK);/*          @Y30LB37*/
         STH   @14,DARGINL+8(,@03)                                 1330
*                     DARGINS(3)=3; /*                       @Y30LB37*/
         STH   @15,DARGINS+16(,@03)                                1331
*                     DARGDTM(3)=ADDR(CTGFBFLG);/*           @Y30LB37*/
         LA    @05,CTGFBFLG(,@05)                                  1332
         ST    @05,DARGDTM+16(,@03)                                1332
*                     DARGINL(3)=2; /*                       @Y30LB37*/
         STH   @14,DARGINL+16(,@03)                                1333
*                   END;            /*                       @Y30LB37*/
*                                                                  1334
*                 /***************************************************/
*                 /*                                                 */
*                 /* IF CMS DID NOT RETURN INFORMATION IN    @Y30LB37*/
*                 /* FEEDBACK AREA PRINT MESSAGE IDC3007I.   @Y30LB37*/
*                 /*                                                 */
*                 /***************************************************/
*                                                                  1335
*                 ELSE                                             1335
*                   DO;             /*                       @Y30LB37*/
         B     @RC01318                                            1335
@RF01318 DS    0H                                                  1336
*                     DARGSMOD=MSGUV0ID;/*                   @Y30LB37*/
         L     @05,DDSTRU                                          1336
         MVC   DARGSMOD(3,@05),@CC01412                            1336
*                     DARGSENT=MUV3007I;/*                   @Y30LB37*/
         MVI   DARGSENT(@05),X'07'                                 1337
*                     DARGDBP=ADDR(TESTRC);/*                @Y30LB37*/
         LA    @03,TESTRC                                          1338
         ST    @03,DARGDBP(,@05)                                   1338
*                     DARGILP=LENGTH(TESTRC);/*              @Y30LB37*/
         MVC   DARGILP(2,@05),@CH00159                             1339
*                     DARGRETP=NULLPTR;/*                    @Y30LB37*/
         SLR   @03,@03                                             1340
         ST    @03,DARGRETP(,@05)                                  1340
*                   END;            /*                       @Y30LB37*/
*                 CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*    @Y30LB37*/
@RC01318 L     @05,@PC00001                                        1342
         ST    @05,@AL00001                                        1342
         LA    @03,@CF00120                                        1342
         ST    @03,@AL00001+4                                      1342
         LA    @03,DDSTRU                                          1342
         ST    @03,@AL00001+8                                      1342
         MVI   @AL00001+8,X'80'                                    1342
         L     @15,GDTPRT(,@05)                                    1342
         LA    @01,@AL00001                                        1342
         BALR  @14,@15                                             1342
*               END;                /*                       @Y30LB37*/
*         END;                      /*                       @Y30LB37*/
@RC01307 DS    0H                                                  1344
@RC01305 DS    0H                                                  1345
*     END;                          /*                       @Y30LB37*/
@RC01301 DS    0H                                                  1346
*                                                                  1346
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THE VSUCTEST BIT IS ON THEN CHECK IF A PASSWORD    @Y30LB37*/
*   /* ERROR OCCURRED, IF SO RE-ISSUE UCATLG MACRO USING     @Y30LB37*/
*   /* THE SAVED CPL AND FPL PREVIOUSLY INITIALIZED.         @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1346
*   IF VSUCTEST=ON THEN                                            1346
@RF01268 TM    VSUCTEST(ARGLPTR),B'00000100'                       1346
         BNO   @RF01346                                            1346
*     DO;                           /*                       @Y30LB37*/
*       IF CATCKRC=RCPASERR THEN                                   1348
         C     CATCKRC,@CF01688                                    1348
         BNE   @RF01348                                            1348
*         DO;                       /*                       @Y30LB37*/
*           CTGPLPTR=ADDR(V1CPSAVE);/*                       @Y30LB37*/
         LA    @15,V1CPSAVE                                        1350
         ST    @15,CTGPLPTR                                        1350
*           CTGFLPTR=ADDR(V1CFSAVE);/*                       @Y30LB37*/
         LA    CTGFLPTR,V1CFSAVE                                   1351
*           CTGMAST=OFF;            /*                       @Y30LB37*/
         NI    CTGMAST(@15),B'10111111'                            1352
*           CALL IDCSACA0(GDTTBL,CTGPLPTR);/*                @Y30LB37*/
         L     @05,@PC00001                                        1353
         ST    @05,@AL00001                                        1353
         LA    @15,CTGPLPTR                                        1353
         ST    @15,@AL00001+4                                      1353
         L     @15,GDTCAT(,@05)                                    1353
         LA    @01,@AL00001                                        1353
         BALR  @14,@15                                             1353
*           RESPECIFY                                              1354
*             RTNREG RSTD;                                         1354
*           TESTRC=RTNREG;                                         1355
         STH   RTNREG,TESTRC                                       1355
*           RESPECIFY                                              1356
*             RTNREG UNRSTD;        /*                       @Y30LB37*/
*           IF TESTRC^=0 THEN                                      1357
         LH    @05,TESTRC                                          1357
         SLR   @15,@15                                             1357
         CR    @05,@15                                             1357
         BE    @RF01357                                            1357
*             DO;                   /*                       @Y30LB37*/
*                                                                  1358
*               /*****************************************************/
*               /*                                                   */
*               /* IF ERROR THEN PRINT MESSAGE IDC3007I.     @Y30LB37*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  1359
*               CATCKRC=4;          /*                       @Y30LB37*/
         LA    CATCKRC,4                                           1359
*               DARGSMOD=MSGUV0ID;  /*                       @Y30LB37*/
         L     @05,DDSTRU                                          1360
         MVC   DARGSMOD(3,@05),@CC01412                            1360
*               DARGSENT=MUV3007I;  /*                       @Y30LB37*/
         MVI   DARGSENT(@05),X'07'                                 1361
*               DARGDBP=ADDR(TESTRC);/*                      @Y30LB37*/
         LA    @03,TESTRC                                          1362
         ST    @03,DARGDBP(,@05)                                   1362
*               DARGILP=LENGTH(TESTRC);/*                    @Y30LB37*/
         MVC   DARGILP(2,@05),@CH00159                             1363
*               DARGRETP=NULLPTR;   /*                       @Y30LB37*/
         ST    @15,DARGRETP(,@05)                                  1364
*               CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*      @Y30LB37*/
         L     @05,@PC00001                                        1365
         ST    @05,@AL00001                                        1365
         LA    @03,@CF00120                                        1365
         ST    @03,@AL00001+4                                      1365
         LA    @03,DDSTRU                                          1365
         ST    @03,@AL00001+8                                      1365
         MVI   @AL00001+8,X'80'                                    1365
         L     @15,GDTPRT(,@05)                                    1365
         LA    @01,@AL00001                                        1365
         BALR  @14,@15                                             1365
*             END;                  /*                       @Y30LB37*/
*           ELSE                                                   1367
*             CATCKRC=0;            /*                       @Y30LB37*/
         B     @RC01357                                            1367
@RF01357 SLR   CATCKRC,CATCKRC                                     1367
*         END;                      /*                       @Y30LB37*/
*                                                                  1368
@RC01357 DS    0H                                                  1369
*       /*************************************************************/
*       /*                                                           */
*       /* IF USER CATALOG IS ON THIS VOLUME SET VSUCAT      @Y30LB37*/
*       /* ON OR ELSE SET IT OFF.                            @Y30LB37*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1369
*       IF CATCKRC=0 THEN                                          1369
@RF01348 LTR   CATCKRC,CATCKRC                                     1369
         BNZ   @RF01369                                            1369
*         IF V1CWRKAR=USERCAT9 THEN                                1370
         CLC   V1CWRKAR(3),USERCAT9                                1370
         BNE   @RF01370                                            1370
*           VSUCAT=ON;              /*                       @Y30LB37*/
         OI    VSUCAT(ARGLPTR),B'01000000'                         1371
*         ELSE                                                     1372
*           VSUCAT=OFF;             /*                       @Y30LB37*/
         B     @RC01370                                            1372
@RF01370 NI    VSUCAT(ARGLPTR),B'10111111'                         1372
*     END;                          /*                       @Y30LB37*/
@RC01370 DS    0H                                                  1373
@RF01369 DS    0H                                                  1374
*                                                                  1374
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THE CATIOCSP IS NOT ZEROS THEN ISSUE A UCLOSE      @Y30LB37*/
*   /* MACRO. IF ERROR OCCURS THEN SET RETURN CODE TO 8      @Y30LB37*/
*   /* (RCNCLOSE) UNLESS RETURN CODE ALREADY MORE SEVERE.    @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1374
*   IF CATIOCSP^=NULLPTR THEN                                      1374
@RF01346 L     @05,CATIOCSP                                        1374
         LTR   @05,@05                                             1374
         BZ    @RF01374                                            1374
*     DO;                           /*                       @Y30LB37*/
*       CALL IDCIOCL0(GDTTBL,CATIOCSP);/*                    @Y30LB37*/
         L     @05,@PC00001                                        1376
         ST    @05,@AL00001                                        1376
         LA    @03,CATIOCSP                                        1376
         ST    @03,@AL00001+4                                      1376
         MVI   @AL00001+4,X'80'                                    1376
         L     @15,GDTCLS(,@05)                                    1376
         LA    @01,@AL00001                                        1376
         BALR  @14,@15                                             1376
*       RESPECIFY                                                  1377
*         RTNREG RSTD;                                             1377
*       TESTRC=RTNREG;                                             1378
         STH   RTNREG,TESTRC                                       1378
*       RESPECIFY                                                  1379
*         RTNREG UNRSTD;            /*                       @Y30LB37*/
*       IF TESTRC^=0&CATCKRC^=4 THEN                               1380
         LH    @05,TESTRC                                          1380
         LTR   @05,@05                                             1380
         BZ    @RF01380                                            1380
         C     CATCKRC,@CF00046                                    1380
         BE    @RF01380                                            1380
*         CATCKRC=8;                /*                       @Y30LB37*/
         LA    CATCKRC,8                                           1381
*     END;                          /*                       @Y30LB37*/
*                                                                  1382
@RF01380 DS    0H                                                  1383
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THE ALLOCSW IS ON THEN ISSUE A UDEALLOC            @Y30LB37*/
*   /* MACRO. IF ERROR OCCURS THEN SET RETURN CODE TO 8      @Y30LB37*/
*   /* (RCNCLOSE) UNLESS RETURN CODE ALREADY MORE SEVERE.    @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1383
*   IF ALLOCSW=ON THEN                                             1383
@RF01374 TM    ALLOCSW,B'00000001'                                 1383
         BNO   @RF01383                                            1383
*     DO;                           /*                       @Y30LB37*/
*       CALL IDCSADL0(GDTTBL,ALLAGL);/*                      @Y30LB37*/
         L     @05,@PC00001                                        1385
         ST    @05,@AL00001                                        1385
         LA    @03,ALLLIST                                         1385
         ST    @03,@AL00001+4                                      1385
         MVI   @AL00001+4,X'80'                                    1385
         L     @15,GDTDLC(,@05)                                    1385
         LA    @01,@AL00001                                        1385
         BALR  @14,@15                                             1385
*       RESPECIFY                                                  1386
*         RTNREG RSTD;                                             1386
*       TESTRC=RTNREG;                                             1387
         STH   RTNREG,TESTRC                                       1387
*       RESPECIFY                                                  1388
*         RTNREG UNRSTD;            /*                       @Y30LB37*/
*       IF TESTRC^=0&CATCKRC^=4 THEN                               1389
         LH    @05,TESTRC                                          1389
         LTR   @05,@05                                             1389
         BZ    @RF01389                                            1389
         C     CATCKRC,@CF00046                                    1389
         BE    @RF01389                                            1389
*         CATCKRC=8;                /*                       @Y30LB37*/
         LA    CATCKRC,8                                           1390
*     END;                          /*                       @Y30LB37*/
@RF01389 DS    0H                                                  1392
*   IF CATCKRC=RCPASERR THEN                                       1392
@RF01383 C     CATCKRC,@CF01688                                    1392
         BNE   @RF01392                                            1392
*     CATCKRC=0;                    /*                       @Y30LB37*/
         SLR   CATCKRC,CATCKRC                                     1393
*   RETURN CODE(CATCKRC);           /* RETURN TO MAIN ROUTINE      1394
*                                                            @Y30LB37*/
@RF01392 LR    @15,CATCKRC                                         1394
         L     @14,@SA00017                                        1394
         LM    @00,@12,@SA00017+8                                  1394
         BR    @14                                                 1394
*   END CATCHK;                     /* END OF CATCHK PROC    @Y30LB37*/
*                                                                  1396
*/********************************************************************/
*/*                                                                  */
*/*  PROCEDURE NAME - CATOPEN                                @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  FUNCTION - THIS PROCEDURE ALLOCATES A DD CARD FOR THE   @Y30LB37*/
*/*             CATALOG IF NECESSARY & OPENS A VSAM CATALOG  @Y30LB37*/
*/*             TO VERIFY PASSWORDS, AND PRINTS ERROR        @Y30LB37*/
*/*             MESSAGE IDC3010I.  PERFORMS UALLOC IF        @Y30LB37*/
*/*             DDNAME NOT PASSED BY CALLER.                 @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  INPUT - THE INFORMATION PASSED IN THE VS1AGL ARGUMENT   @Y30LB37*/
*/*          LIST:  FIELDS VSCATP, VSCATDDP, VSVOLP, VSACBP, @Y30LB37*/
*/*          VSOPCAT AND VSPSWDP.  TWO INPUT PARA-           @Y30LB37*/
*/*          METERS ARE PASSED THAT WILL BE INITIALIZED IF   @Y30LB37*/
*/*          THE CATALOG OPEN IS SUCCESSFUL.  THEY ARE (1)   @Y30LB37*/
*/*          OPENACB - ACB POINTER AND (2) OPENIOCS - OPEN   @Y30LB37*/
*/*          IOCSTR POINTER.                                 @Y30LB37*/
*/*                                                          @Y30LB37*/
*/*  OUTPUT- THE INFORMATION RETURNED IS EITHER A ZERO,      @Y30LB37*/
*/*          OR FOUR ERROR CODE.  ALLOCSW SET ON IF UALLOC   @Y30LB37*/
*/*          IS PERFORMED SUCCESSFULLY AND THE DDNAME IN THE @Y30LB37*/
*/*          VS1AGL POINTED TO BY VSCATDDP.  TWO INPUT PARA- @Y30LB37*/
*/*          METERS ARE PASSED THAT WILL BE INITIALIZED IF   @Y30LB37*/
*/*          THE CATALOG OPEN IS SUCCESSFUL.  THEY ARE (1)   @Y30LB37*/
*/*          OPENACB - ACB POINTER AND (2) OPENIOCS - OPEN   @Y30LB37*/
*/*          IOCSTR POINTER.                                 @Y30LB37*/
*/*          RETURN CODES ARE:                               @Y30LB37*/
*/*          0 - SUCCESSFUL                                  @Y30LB37*/
*/*          4 - ERROR OPENING THE CATALOG                   @Y30LB37*/
*/*              ERROR ALLOCATING CATALOG                    @Y30LB37*/
*/*                                                                  */
*/********************************************************************/
*                                                                  1396
*CATOPEN:                                                          1396
*   PROCEDURE(OPENACB,              /* OPEN ACB POINTER      @Y30LB37*/
*       OPENIOCS);                  /* OPEN IOCSTR POINTER   @Y30LB37*/
CATOPEN  STM   @14,@12,@SA00018                                    1396
         MVC   @PC00018(8),0(@01)                                  1396
*                                                                  1397
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL DECLARATIONS FOR CATOPEN                        @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1397
*   DCL                                                            1397
*     CATOPRC FIXED(15);            /* CATOPEN RETURN CODE   @Y30LB37*/
*   DCL                                                            1398
*     OPENACB PTR(31);              /* CATALOG ACB PARM AREA @Y30LB37*/
*   DCL                                                            1399
*     OPENIOCS PTR(31);             /* CATALOG OPEN IOCSTRP  @Y30LB37*/
*   DCL                                                            1400
*     BLANKDDN CHAR(8) STATIC       /* BLANK DDNAME          @Y30LB37*/
*         INIT('        ');         /* INITIALIZED           @Y30LB37*/
*   DCL                                                            1401
*     OPENLST CHAR(LENGTH(OPNAGL))  /* OPEN GETMAINED        @Y30LB37*/
*         BDY(WORD);                /* LIST                  @Y30LB37*/
*   DCL                                                            1402
*     CATDSN CHAR(44) BASED;        /* DSNAME FOR COMPARING  @Y30LB37*/
*                                                                  1403
*   /*****************************************************************/
*   /*                                                               */
*   /* ISSUE UTRACE MACRO AND INITIALIZE OPNPTR AND RETURN   @Y30LB37*/
*   /* CODE.                                                 @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1403
*   OLDERID2=NEWERID2;                                             1403
         L     @03,@PC00001                                        1403
         L     @15,GDTTR2(,@03)                                    1403
         MVC   @TS00001(95),NEWERID2(@15)                          1403
         MVC   OLDERID2(95,@15),@TS00001                           1403
*   NEWID2='VSCO';                  /* ISSUE UTRACE MACRO    @Y30LB37*/
         MVC   NEWID2(4,@15),@CC01706                              1404
*   CATOPRC=0;                      /*                       @Y30LB37*/
         SLR   @15,@15                                             1405
         LR    CATOPRC,@15                                         1405
*   OPNPTR=ADDR(OPENLST);           /*                       @Y30LB37*/
         LA    OPNPTR,OPENLST                                      1406
*   OPNAGL=''B;                     /* CLEAR THE OPEN AGL    @ZA11678*/
         XC    OPNAGL(48,OPNPTR),OPNAGL(OPNPTR)                    1407
*                                                                  1408
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK VSOPCAT AND VSCATP FIELDS TO SEE IF AN OPEN     @Y30LB37*/
*   /* SHOULD BE PERFORMED OR NOT.                           @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1408
*   IF VSOPCAT=ON&VSCATP^=NULLPTR THEN                             1408
         TM    VSOPCAT(ARGLPTR),B'00000010'                        1408
         BNO   @RF01408                                            1408
         L     @14,VSCATP(,ARGLPTR)                                1408
         CR    @14,@15                                             1408
         BE    @RF01408                                            1408
*     DO;                           /*                       @Y30LB37*/
*                                                                  1409
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK TO SEE IF DDNAME FOR CATALOG IS BLANK.      @Y30LB37*/
*       /* IF SO, THEN ISSUE A UALLOC MACRO.                 @Y30LB37*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1410
*       IF VSCATDDP->V1DDNAM=BLANKDDN THEN                         1410
         L     @01,VSCATDDP(,ARGLPTR)                              1410
         CLC   V1DDNAM(8,@01),BLANKDDN                             1410
         BNE   @RF01410                                            1410
*         DO;                       /*                       @Y30LB37*/
*           ALLDSN=VSCATP;          /*                       @Y30LB37*/
         LA    @15,ALLLIST                                         1412
         ST    @14,ALLDSN(,@15)                                    1412
*           ALLSTSSR=ON;            /*                       @Y30LB37*/
         OI    ALLSTSSR(@15),B'00001000'                           1413
*           ALLDSPKP=ON;            /*                       @Y30LB37*/
         OI    ALLDSPKP(@15),B'00001000'                           1414
*           ALLOPTDS=ON;            /*                       @Y30LB37*/
         OI    ALLOPTDS(@15),B'01000000'                           1415
*           CALL IDCSAAL0(GDTTBL,ALLAGL);/*                  @Y30LB37*/
         ST    @03,@AL00001                                        1416
         ST    @15,@AL00001+4                                      1416
         MVI   @AL00001+4,X'80'                                    1416
         L     @15,GDTALC(,@03)                                    1416
         LA    @01,@AL00001                                        1416
         BALR  @14,@15                                             1416
*           RESPECIFY                                              1417
*             RTNREG RSTD;                                         1417
*           TESTRC=RTNREG;                                         1418
         STH   RTNREG,TESTRC                                       1418
*           RESPECIFY                                              1419
*             RTNREG UNRSTD;        /*                       @Y30LB37*/
*                                                                  1419
*           /*********************************************************/
*           /*                                                       */
*           /* IF UALLOC FAILS SET RETURN CODE TO RCFAIL.    @Y30LB37*/
*           /* IF UALLOC IS SUCCESSFUL THEN PLACE THE DD-    @Y30LB37*/
*           /* NAME RETURNED BY UALLOC IN THE FIELD POINTED  @Y30LB37*/
*           /* TO BY VSCATDDP AND SET THE UALLOC SWITCH ON.  @Y30LB37*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1420
*           IF TESTRC^=0 THEN                                      1420
         LH    @03,TESTRC                                          1420
         LTR   @03,@03                                             1420
         BZ    @RF01420                                            1420
*             CATOPRC=4;            /*                       @Y30LB37*/
         LA    CATOPRC,4                                           1421
*           ELSE                                                   1422
*             DO;                   /*                       @Y30LB37*/
         B     @RC01420                                            1422
@RF01420 DS    0H                                                  1423
*               VSCATDDP->V1DDNAM=ALLDDN;/*                  @Y30LB37*/
         L     @03,VSCATDDP(,ARGLPTR)                              1423
         LA    @15,ALLLIST                                         1423
         MVC   V1DDNAM(8,@03),ALLDDN(@15)                          1423
*               ALLOCSW=ON;         /*                       @Y30LB37*/
         OI    ALLOCSW,B'00000001'                                 1424
*             END;                  /*                       @Y30LB37*/
*         END;                      /*                       @Y30LB37*/
*     END;                          /*                       @Y30LB37*/
*   ELSE                                                           1428
*     CATOPRC=RCFUNTRM;             /*                       @Y30LB37*/
         B     @RC01408                                            1428
@RF01408 LA    CATOPRC,12                                          1428
*                                                                  1429
*   /*****************************************************************/
*   /*                                                               */
*   /* ISSUE THE UOPEN MACRO TO OPEN THE CATALOG FOR         @Y30LB37*/
*   /* PASSWORD CHECKING IF RETURN CODE IS ZERO.             @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1429
*   IF CATOPRC=0 THEN                                              1429
@RC01408 LTR   CATOPRC,CATOPRC                                     1429
         BNZ   @RF01429                                            1429
*     DO;                           /*                       @Y30LB37*/
*       OPNTYPCI=ON;                /* OPEN CATALOG OPTION   @Y30LB37*/
         OI    OPNTYPCI(OPNPTR),B'00100000'                        1431
*       OPNIOC=ADDR(OPENIOCS);      /* OPEN IOCSTR POINTER   @Y30LB37*/
         L     @03,@PC00018+4                                      1432
         ST    @03,OPNIOC(,OPNPTR)                                 1432
*       OPNOPTUP=ON;                /* OPEN FOR UPDATE       @Y30LB37*/
         OI    OPNOPTUP(OPNPTR),B'00100000'                        1433
*       OPNDDN=VSCATDDP;            /* DDNAME ADDRESS        @Y30LB37*/
         L     @03,VSCATDDP(,ARGLPTR)                              1434
         ST    @03,OPNDDN(,OPNPTR)                                 1434
*       OPNMODRC=ON;                /* RETURN ACB ADDRESS    @Y30LB37*/
         OI    OPNMODRC(OPNPTR),B'00100000'                        1435
*       OPNPWA=VSPSWDP;             /* PASSWORD ADDR IF ^0   @Y30LB37*/
         L     @03,VSPSWDP(,ARGLPTR)                               1436
         ST    @03,OPNPWA(,OPNPTR)                                 1436
*       CALL IDCIOOP0(GDTTBL,OPNAGL);/* OPEN THE CATALOG     @Y30LB37*/
         L     @03,@PC00001                                        1437
         ST    @03,@AL00001                                        1437
         ST    OPNPTR,@AL00001+4                                   1437
         MVI   @AL00001+4,X'80'                                    1437
         L     @15,GDTOPN(,@03)                                    1437
         LA    @01,@AL00001                                        1437
         BALR  @14,@15                                             1437
*       RESPECIFY                                                  1438
*         RTNREG RSTD;                                             1438
*       TESTRC=RTNREG;                                             1439
         STH   RTNREG,TESTRC                                       1439
*       RESPECIFY                                                  1440
*         RTNREG UNRSTD;            /*                       @Y30LB37*/
*                                                                  1440
*       /*************************************************************/
*       /*                                                           */
*       /* IF UOPEN SUCCESSFUL AND CATALOG NAMES ARE EQUAL   @Y30LB37*/
*       /* THEN SET PARAMETERS TO IOCSPTR AND ACB PTR. IF    @Y30LB37*/
*       /* UOPEN UNSUCCESSFUL AND CATALOG NAMES ARE          @Y30LB37*/
*       /* NOT EQUAL THEN PRINT MESSAGE IDC3010I VIA UPRINT  @Y30LB37*/
*       /* AND SET RETURN CODE TO 4. IF OPEN IS NOT SUC-     @Y30LB37*/
*       /* CESSFUL, SET RETURN CODE TO RCFAIL.               @Y30LB37*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1441
*       IF TESTRC=0&VSCATP^=NULLPTR THEN                           1441
         LH    @15,TESTRC                                          1441
         SLR   @14,@14                                             1441
         CR    @15,@14                                             1441
         BNE   @RF01441                                            1441
         L     @15,VSCATP(,ARGLPTR)                                1441
         CR    @15,@14                                             1441
         BE    @RF01441                                            1441
*         DO;                       /*                       @Y30LB37*/
*           RFY                                                    1443
*             IOCSTR BASED(OPENIOCS);/*                      @Y30LB37*/
*           IF VSCATP->CATDSN=IOCDSN->CATDSN THEN                  1444
         L     @14,@PC00018+4                                      1444
         L     @14,OPENIOCS(,@14)                                  1444
         L     @01,IOCDSN(,@14)                                    1444
         CLC   CATDSN(44,@15),CATDSN(@01)                          1444
         BNE   @RF01444                                            1444
*             OPENACB=IOCCBP;       /*                       @Y30LB37*/
         L     @15,@PC00018                                        1445
         L     @14,IOCCBP(,@14)                                    1445
         ST    @14,OPENACB(,@15)                                   1445
*           ELSE                                                   1446
*             DO;                   /*                       @Y30LB37*/
         B     @RC01444                                            1446
@RF01444 DS    0H                                                  1447
*               DARGSMOD=MSGUV0ID;  /*                       @Y30LB37*/
         L     @15,DDSTRU                                          1447
         MVC   DARGSMOD(3,@15),@CC01412                            1447
*               DARGSENT=MUV3010I;  /*                       @Y30LB37*/
         MVI   DARGSENT(@15),X'0B'                                 1448
*               DARGDBP=VSCATP;     /*                       @Y30LB37*/
         L     @14,VSCATP(,ARGLPTR)                                1449
         ST    @14,DARGDBP(,@15)                                   1449
*               DARGILP=LENGTH(CATDSN);/*                    @Y30LB37*/
         MVC   DARGILP(2,@15),@CH00849                             1450
*               CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*      @Y30LB37*/
         L     @15,@PC00001                                        1451
         ST    @15,@AL00001                                        1451
         LA    @14,@CF00120                                        1451
         ST    @14,@AL00001+4                                      1451
         LA    @14,DDSTRU                                          1451
         ST    @14,@AL00001+8                                      1451
         MVI   @AL00001+8,X'80'                                    1451
         L     @15,GDTPRT(,@15)                                    1451
         LA    @01,@AL00001                                        1451
         BALR  @14,@15                                             1451
*               CATOPRC=4;          /*                       @Y30LB37*/
         LA    CATOPRC,4                                           1452
*             END;                  /*                       @Y30LB37*/
*         END;                      /*                       @Y30LB37*/
*       ELSE                                                       1455
*         CATOPRC=4;                /*                       @Y30LB37*/
         B     @RC01441                                            1455
@RF01441 LA    CATOPRC,4                                           1455
*     END;                          /*                       @Y30LB37*/
@RC01441 DS    0H                                                  1457
*                                                                  1457
*   /*****************************************************************/
*   /*                                                               */
*   /* CLOSE THE CATALOG IF OPEN FAILURE BUT OPEN PERFORMED  @Y30LB37*/
*   /* SOME FUNCTION.                                        @Y30LB37*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1457
*   IF CATOPRC=4&OPENIOCS^=NULLPTR THEN                            1457
@RF01429 C     CATOPRC,@CF00046                                    1457
         BNE   @RF01457                                            1457
         L     @15,@PC00018+4                                      1457
         L     @14,OPENIOCS(,@15)                                  1457
         LTR   @14,@14                                             1457
         BZ    @RF01457                                            1457
*     DO;                           /*                       @Y30LB37*/
*       CALL IDCIOCL0(GDTTBL,OPENIOCS);/*                    @Y30LB37*/
         L     @14,@PC00001                                        1459
         ST    @14,@AL00001                                        1459
         ST    @15,@AL00001+4                                      1459
         MVI   @AL00001+4,X'80'                                    1459
         L     @15,GDTCLS(,@14)                                    1459
         LA    @01,@AL00001                                        1459
         BALR  @14,@15                                             1459
*       OPENIOCS=NULLPTR;           /*                       @Y30LB37*/
         L     @15,@PC00018+4                                      1460
         SLR   @14,@14                                             1460
         ST    @14,OPENIOCS(,@15)                                  1460
*     END;                          /*                       @Y30LB37*/
*   IF CATOPRC=RCFUNTRM THEN                                       1462
@RF01457 C     CATOPRC,@CF00037                                    1462
         BNE   @RF01462                                            1462
*     CATOPRC=0;                    /* CHANGE RC 12 TO AN 8  @Y30LB37*/
         SLR   CATOPRC,CATOPRC                                     1463
*   RETURN CODE(CATOPRC);           /* RETURN TO MAIN ROUTINE      1464
*                                                            @Y30LB37*/
@RF01462 LR    @15,CATOPRC                                         1464
         L     @14,@SA00018                                        1464
         LM    @00,@12,@SA00018+8                                  1464
         BR    @14                                                 1464
*   END CATOPEN;                    /* END OF CATOPEN PROC   @Y30LB37*/
*   END IDCVS01                     /* END OF MSS VOLUME SERVICES -
*                                      IDCVS01               @Y30LB37*/
*                                                                  1466
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.     */
*/*%INCLUDE SYSLIB  (AMSDF01 )                                       */
*/*%INCLUDE SYSLIB  (AMSDF00 )                                       */
*/*@INCLUDE SYSLIB  (AMSDF02 )                                       */
*/*%INCLUDE SYSLIB  (IDCDF04 )                                       */
*/*%INCLUDE SYSLIB  (IECSDSL1)                                       */
*/*%INCLUDE SYSLIB  (IEZCTGPL)                                       */
*/*%INCLUDE SYSLIB  (IEZCTGFL)                                       */
*                                                                  1466
*       ;                                                          1466
@DATA    DS    0H
@CH00159 DC    H'2'
@CH00035 DC    H'6'
@CH00041 DC    H'7'
@CH00036 DC    H'10'
@CH00849 DC    H'44'
@CH01708 DC    H'52'
         DS    0F
@AL00685 EQU   *                       LIST WITH   2 ARGUMENT(S)
@AL00998 DC    A(ORGTNONV)             LIST WITH   2 ARGUMENT(S)
         DC    A(PROTTALL)
@AL00834 DC    A(ORGTALL)              LIST WITH   2 ARGUMENT(S)
         DC    A(PROTTALL)
@DATD    DSECT
         DS    0F
@SA00001 DS    18F
@PC00001 DS    3F
@SA00011 DS    15F
@SA00002 DS    15F
@SA00003 DS    15F
@SA00008 DS    15F
@SA00007 DS    15F
@SA00004 DS    15F
@SA00005 DS    15F
@SA00006 DS    14F
@PC00006 DS    2F
@SA00009 DS    15F
@SA00010 DS    15F
@SA00012 DS    15F
@PC00012 DS    1F
@SA00013 DS    15F
@PC00013 DS    1F
@SA00017 DS    15F
@PC00017 DS    1F
@SA00014 DS    15F
@SA00016 DS    15F
@SA00015 DS    15F
@SA00018 DS    15F
@PC00018 DS    2F
@AL00001 DS    6A
IDCVS01  CSECT
         DS    0F
@CF00120 DC    F'0'
@CF00223 DC    F'1'
@CH00223 EQU   @CF00223+2
@CF00046 DC    F'4'
@CH00046 EQU   @CF00046+2
@CF00040 DC    F'8'
@CH00040 EQU   @CF00040+2
@CF00037 DC    F'12'
@CF00509 DC    F'16'
@CF01688 DC    F'56'
@CF01150 DC    F'96'
@CF01552 DC    F'1000'
@CF01734 DC    XL4'0000FFFF'
@DATD    DSECT
         DS    0D
LISTSCAN DS    A
IOCSPTR  DS    A
DDSTRU   DS    A
FSADDR   DS    A
ERCNVADR DS    A
DMPINDEX DS    A
CCMSGPTR DS    A
CMMSGPTR DS    A
CTMSGPTR DS    A
ELEMENT  DS    F
F4PTR    DS    A
CTGPLPTR DS    A
VRACFPTR DS    A
RTNAREA  DS    A
INFOPTR  DS    A
DATEWORK DS    FL4
         ORG   DATEWORK
@NM00122 DS    BL1
DAWKYEAR DS    BL1
DAWKDAY  DS    BL2
         ORG   DATEWORK+4
CATCOUNT DS    F
VVOLPTR  DS    A
IOBLKPTR DS    A
CATIOCSP DS    A
CATACB   DS    A
LISTPTR  DS    A
TESTRC   DS    H
RETCODE  DS    H
SETRC    DS    H
LISTLN   DS    FL1
         DS    0D
@TS00001 DS    CL95
         DS    CL1
PRINTARG DS    CL44
EXOLIST  DS    CL34
         DS    CL2
ALLLIST  DS    CL31
         DS    CL1
VS1RACF  DS    CL20
CLASSRAC DS    CL9
         ORG   CLASSRAC
CLASSLEN DS    AL1
CLASSNM  DS    CL8
         ORG   CLASSRAC+9
V1PGSWS  DS    CL2
         ORG   V1PGSWS
EXPONLY  DS    BL1
QUITSW   EQU   V1PGSWS+0
TERMSW   EQU   V1PGSWS+0
SCRERRSW EQU   V1PGSWS+0
RECATSW  EQU   V1PGSWS+0
SECHKSW  EQU   V1PGSWS+0
OPENSW   EQU   V1PGSWS+0
ALLOCSW  EQU   V1PGSWS+0
RESETDS1 DS    BL1
NOSCRDS1 EQU   V1PGSWS+1
         ORG   V1PGSWS+2
         DS    CL1
INFOAREA DS    CL11
         DS    CL1
V1DSNTBL DS    CL13262
         ORG   V1DSNTBL
V1DDCNT  DS    FL2
@NM00120 DS    CL52
         ORG   @NM00120+0
V1DDDNAM DS    CL8
V1DDSNAM DS    CL44
         ORG   V1DSNTBL+13262
VPTIME   DS    CL8
VPDATE   DS    CL4
         DS    CL2
OPNLIST  DS    CL384
CNTVOL   DS    CL7
         ORG   CNTVOL
COUNT    DS    FL1
VOLLAB   DS    CL6
         ORG   CNTVOL+7
         DS    CL1
MINORNAM DS    CL23
         ORG   MINORNAM
MINLEN   DS    FL1
MINVOL   DS    CL6
MINCON   DS    CL16
         ORG   MINORNAM+23
F1TIME   DS    CL8
F1DATE   DS    CL4
         DS    CL1
EXPDWORK DS    CL3
         ORG   EXPDWORK
EXPYEAR  DS    BL1
EXPDAY   DS    BL2
         ORG   EXPDWORK+3
         DS    CL1
RECATARG DS    CL76
VOLIST   DS    CL2
CATPASS  DS    CL4
ORGTAREA DS    CL4
PROTAREA DS    CL8
         DS    CL2
IOINFBLK DS    CL52
         ORG   IOINFBLK
IOHEADLN DS    FL2
IOHEAD02 DS    FL2
IOID     DS    CL2
IOLENGTH DS    CL2
IORETDSN DS    CL44
         ORG   IOINFBLK+52
IOINFBYT DS    CL1
V1NVDDNM DS    CL8
         DS    CL3
V1CPLIST DS    CL32
V1CFLIST DS    CL24
V1CPSAVE DS    CL32
V1CFSAVE DS    CL24
VOLBLOCK DS    CL44
         ORG   VOLBLOCK
VOLBSER  DS    CL6
VOLBLANK DS    CL38
         ORG   VOLBLOCK+44
V1CWORKA DS    CL7
         ORG   V1CWORKA
V1CWRKLN DS    FL2
V1CRETLN DS    FL2
V1CWRKAR DS    CL3
         ORG   V1CWORKA+7
         DS    CL1
OPENLST  DS    CL384
         ORG   *+1-(*-@DATD)/(*-@DATD) INSURE DSECT DATA
@ENDDATD EQU   *
IDCVS01  CSECT
         DS    0F
@SIZDATD DC    AL1(0)
         DC    AL3(@ENDDATD-@DATD)
         DS    0D
@CC01329 DC    C'VS01'
@CC01471 DC    C'VSBG'
@CC01479 DC    C'VSND'
@CC01484 DC    C'VSVG'
@CC01493 DC    C'VSVP'
@CC01519 DC    C'VSVT'
@CC01528 DC    C'VS4R'
@CC01553 DC    C'VS1R'
@CC01565 DC    C'VSRC'
@CC01572 DC    C'VSSC'
@CC01579 DC    C'VS4S'
@CC01587 DC    C'VS1S'
@CC01595 DC    C'VSSE'
@CC01604 DC    C'VS4C'
@CC01614 DC    C'VS1C'
@CC01626 DC    C'VSVC'
@CC01650 DC    C'VSNC'
@CC01664 DC    C'VSEC'
@CC01692 DC    C'VSCC'
@CC01706 DC    C'VSCO'
@CC01408 EQU   @CC01329
@CC01410 DC    C'CM0'
@CC01412 DC    C'UV0'
ALL      DC    CL3'ALL'
FORMAT   DC    CL4'FORM'
HSECOND  DC    CL4'HSEC'
CLOCK    DC    CL4'KLOK'
SETZERO  DC    CL4'ZERO'
SETBLANK DC    CL4'BLNK'
NOSET    DC    CL4'NSET'
OVERRIDE DC    CL4'OVRD'
ACQUIRE  DC    CL8'ACQUIRE '
RELINQ   DC    CL8'RELINQ  '
MOUNT    DC    CL8'MOUNT   '
DEMOUNT  DC    CL8'DEMOUNT '
DEFINE   DC    CL8'DEFINE  '
MOVE     DC    CL8'MOVE    '
TRACEQ   DC    CL8'TRACEQ  '
COPYTABL DC    CL8'COPYTABL'
COPYCRTG DC    CL8'COPYCRTG'
COPYVOL  DC    CL8'COPYVOL '
VVIC     DC    CL8'VVIC    '
TUNE     DC    CL8'TUNE    '
NAMES    DC    CL4'NAME'
UNIT     DC    CL4'UNIT'
SHR      DC    CL4'SHR '
EXCL     DC    CL4'EXCL'
NOWAIT   DC    CL4'NWAI'
WAIT     DC    CL4'WAIT'
SECCHECK DC    CL8'SECCHECK'
SCRVTOC  DC    CL8'SCRVTOC '
GETVTOC  DC    CL8'GETVTOC '
PUTVTOC  DC    CL8'PUTVTOC '
RECATLG  DC    CL8'RECATLG '
INITVOL  DC    CL8'INITVOL '
CHECK    DC    CL8'CHECK   '
POSTUCB  DC    CL8'POSTUCB '
GET      DC    CL8'GET     '
PUT      DC    CL8'PUT     '
CLOSE    DC    CL8'CLOSE   '
OPEN     DC    CL8'OPEN    '
RVOPENR  DC    CL8'OPENR   '
RVRDCNT  DC    CL8'READCNT '
RVREADKD DC    CL8'READKD  '
RVSPACCR DC    CL8'SPACCR  '
RVFWRITE DC    CL8'FWRITE  '
RVWRITER DC    CL8'WRITEREC'
PUTLABEL DC    CL8'PUTLABEL'
GETLABEL DC    CL8'GETLABEL'
CANCEL   DC    CL8'CANCEL  '
SET      DC    CL8'SET     '
SELECTX  DC    CL8'SELECTX '
CHANGEX  DC    CL8'CHANGEX '
SELECTDD DC    CL8'SELECTDD'
SELECTDS DC    CL8'SELECTDS'
TBLREST  DC    CL8'TBLREST '
NULLIFYC DC    CL8'NULLIFYC'
RDMSC    DC    CL8'RDMSC   '
RDMSCTBL DC    CL8'RDMSCTBL'
RDCARTLB DC    CL8'RDCARTLB'
AUDITCEL DC    CL8'AUDITCEL'
RDSTGAD  DC    CL8'RDSTGAD '
MODIFYC  DC    CL8'MODIFYC '
MODID    DC    CL4'VS01'
CLASSDS  DC    CL7'DATASET'
ZEROVOL  DC    X'000000000000'
ZEROVTOC DC    X'00000000'
HEXZERO  DC    X'00'
ZEROFLD4 DC    X'00000000'
ZEROFLD2 DC    X'0000'
ORGTALL  DC    CL4'ALL '
ORGTNONV DC    CL4'NONV'
PROTTALL DC    CL8'ALL     '
PROTREAD DC    CL8'READ    '
PROTRITE DC    CL8'WRITE   '
CATGOOD  DC    CL4'GOOD'
CATBAD   DC    CL4'BAD '
FIXAREA  DS    CL400
         ORG   FIXAREA
ZAPAREA  DC    400X'00'
         ORG   FIXAREA+400
         DS    CL3
DSNAME   DS    CL44
         ORG   DSNAME
@NM00121 DC    44X'04'
         ORG   DSNAME+44
MAJNAME  DC    CL8'SYSZAMS '
MINRNAME DC    CL13'.REAL.RESERVE'
         DS    CL3
MINVNAME DC    CL16'.VIRTUAL.RESERVE'
FORMAT4R DC    X'F4'
RELATTRZ DC    X'00000100'
FORMAT1R DC    X'F1'
ZEROEXP  DC    X'000000'
V1ENTID  DC    CL8'ENTIDNO '
USERCAT9 DC    X'000009'
BLANKDDN DC    CL8'        '
@00      EQU   00                      EQUATES FOR REGISTERS 0-15
@01      EQU   01
@02      EQU   02
@03      EQU   03
@04      EQU   04
@05      EQU   05
@06      EQU   06
@07      EQU   07
@08      EQU   08
@09      EQU   09
@10      EQU   10
@11      EQU   11
@12      EQU   12
@13      EQU   13
@14      EQU   14
@15      EQU   15
CATOPRC  EQU   @05
CATCKRC  EQU   @02
EXPIRRC  EQU   @02
NVCOUNT  EQU   @03
NVSAMRC  EQU   @02
VSAMCRC  EQU   @02
FMT1CRC  EQU   @02
FMT4CRC  EQU   @02
SECHKRC  EQU   @02
FMT1SRC  EQU   @02
FMT4SRC  EQU   @02
SCRATRC  EQU   @02
RECATRC  EQU   @02
FMT1RRC  EQU   @02
FMT4RRC  EQU   @02
VTOCORC  EQU   @05
VTOCPRC  EQU   @02
VTOCGRC  EQU   @02
ARGLPTR  EQU   @04
CTGFLPTR EQU   @05
F1PTR    EQU   @05
OPNPTR   EQU   @02
RTNREG   EQU   @15
REG13    EQU   @13
REG14    EQU   @14
REG15    EQU   @15
REG0     EQU   @00
REG1     EQU   @01
REG10    EQU   @10
REG11    EQU   @11
REG12    EQU   @12
REG2     EQU   @02
REG3     EQU   @03
REG4     EQU   @04
REG5     EQU   @05
REG6     EQU   @06
REG7     EQU   @07
REG8     EQU   @08
REG9     EQU   @09
IDCSAEP0 EQU   0
IDCSATI0 EQU   0
IDCSACA0 EQU   0
IDCSAAL0 EQU   0
IDCSADL0 EQU   0
IDCSARV0 EQU   0
IDCSASI0 EQU   0
IDCSASC0 EQU   0
IDCSARC0 EQU   0
IDCSARK0 EQU   0
TRACE1   EQU   0
OLDERID1 EQU   TRACE1
TRACE2   EQU   0
OLDERID2 EQU   TRACE2
NEWID2   EQU   TRACE2+95
NEWERID2 EQU   5
CIRAGL   EQU   0
CIRTYPE  EQU   CIRAGL
ALLAGL   EQU   0
ALLDSN   EQU   ALLAGL
ALLDDN   EQU   ALLAGL+4
ALLSTS   EQU   ALLAGL+24
ALLSTSSR EQU   ALLSTS
ALLDSP   EQU   ALLAGL+25
ALLDSPKP EQU   ALLDSP
ALLORG   EQU   ALLAGL+26
ALLOPT   EQU   ALLAGL+28
ALLOPTDS EQU   ALLOPT
RACFAGL  EQU   0
RACFFLG1 EQU   RACFAGL
RACFDSTV EQU   RACFFLG1
RACFFLG2 EQU   RACFAGL+1
RACFTUPD EQU   RACFFLG2
RACFTRD  EQU   RACFFLG2
RACFFLG3 EQU   RACFAGL+2
RACFFLG4 EQU   RACFAGL+3
RACFENT  EQU   RACFAGL+4
RACFCLN  EQU   RACFAGL+12
RACFVOLS EQU   RACFAGL+16
UNITABL  EQU   0
UNITUCB  EQU   UNITABL
UNITADR  EQU   UNITABL+4
@NM00017 EQU   UNITADR
UNITSTAT EQU   UNITABL+6
IDCIOOP0 EQU   0
IDCIOCL0 EQU   0
IDCIOPO0 EQU   0
IDCIOGT0 EQU   0
IDCIOPT0 EQU   0
IDCIOSI0 EQU   0
IDCIO050 EQU   0
IOCSTR   EQU   0
IOCDAD   EQU   IOCSTR
IOCDSO   EQU   IOCSTR+16
IOCRFM   EQU   IOCSTR+17
IOCMAC   EQU   IOCSTR+18
IOCMAC2  EQU   IOCSTR+19
IOCCHP   EQU   IOCSTR+20
IOCMSG   EQU   IOCSTR+21
IOCDSN   EQU   IOCSTR+32
IOCCBP   EQU   IOCSTR+36
IOCRBA   EQU   IOCSTR+40
IOCTTR   EQU   IOCRBA
IOCMEM   EQU   IOCSTR+44
IOCNWM   EQU   IOCSTR+48
IOCREL   EQU   IOCSTR+60
OPNAGL   EQU   0
OPNOPT   EQU   OPNAGL
OPNOPTUP EQU   OPNOPT
OPNOPTBK EQU   OPNOPT
OPNRFM   EQU   OPNAGL+1
OPNRFMFX EQU   OPNRFM
OPNTYP   EQU   OPNAGL+2
OPNTYPCI EQU   OPNTYP
OPNMOD   EQU   OPNAGL+3
OPNMODRC EQU   OPNMOD
OPNIOC   EQU   OPNAGL+4
OPNDDN   EQU   OPNAGL+8
OPNPWA   EQU   OPNAGL+12
OPNDSN   EQU   OPNAGL+16
OPNDEV   EQU   OPNAGL+24
OPNBLK   EQU   OPNAGL+36
OPNKYL   EQU   OPNAGL+40
OPNDSO   EQU   OPNAGL+41
OPNDSOPS EQU   OPNDSO
OPNOPT2  EQU   OPNAGL+42
OPNOPTJM EQU   OPNOPT2
OPNVOL   EQU   OPNAGL+44
IOINFOPT EQU   0
IOINFDSN EQU   IOINFOPT
UVOLLIST EQU   0
UVOLCNT  EQU   UVOLLIST
UVOLENT  EQU   UVOLLIST+2
UVOLDEV  EQU   UVOLENT
UVOLVOL  EQU   UVOLENT+4
AMSTP011 EQU   0
DARGLIST EQU   0
DARGDBP  EQU   DARGLIST
DARGRETP EQU   DARGLIST+4
DARGSTID EQU   DARGLIST+8
DARGSMOD EQU   DARGSTID
DARGSENT EQU   DARGSTID+3
DARGILP  EQU   DARGLIST+12
DARGCNT  EQU   DARGLIST+14
DARGARY  EQU   DARGLIST+20
DARGINS  EQU   DARGARY
DARGINL  EQU   DARGARY+2
DARGDTM  EQU   DARGARY+4
FMTLIST  EQU   0
FMTFLGS  EQU   FMTLIST
FMTSPF   EQU   FMTLIST+2
FMTRFNO  EQU   FMTSPF
FMTILEN  EQU   FMTRFNO
FMTIOFF  EQU   FMTLIST+4
FMTTRBC  EQU   FMTIOFF
FMTSTO   EQU   FMTTRBC
FMTOCOL  EQU   FMTLIST+6
FMTCNVF  EQU   FMTLIST+10
ERCNVTAB EQU   0
ERTYPE   EQU   ERCNVTAB
EROPER   EQU   ERCNVTAB+1
EROSOPER EQU   ERCNVTAB+2
ERCATRC  EQU   ERCNVTAB+16
ERCPLPT  EQU   ERCNVTAB+20
IDCDB010 EQU   0
DMPITM   EQU   0
DMPARY   EQU   0
CCMSG    EQU   0
CMMSG    EQU   0
CMVOLFLG EQU   CMMSG+6
CTMSG    EQU   0
CTARRAY  EQU   CTMSG+4
MDAGL    EQU   0
MDFLAGS  EQU   MDAGL+30
MDVTOC   EQU   MDAGL+32
PUAGL    EQU   0
CKAGL    EQU   0
CKFLAGS  EQU   CKAGL+28
EXCLAGL  EQU   0
EXCLFLAG EQU   EXCLAGL+22
EXOARG   EQU   0
EXODDN   EQU   EXOARG+8
EXODSN   EQU   EXOARG+12
EXOVSN   EQU   EXOARG+16
EXOCTLBK EQU   EXOARG+28
EXOPT    EQU   EXOARG+32
EXOPASS  EQU   EXOPT
EXFLG    EQU   EXOARG+33
EXOREAD  EQU   EXFLG
EXGARG   EQU   0
EXWRARG  EQU   0
EXRWCHR  EQU   EXWRARG+26
EXSPACE  EQU   EXWRARG+36
EXPARG   EQU   0
EXPDATA  EQU   EXPARG+12
EXPDATAB EQU   0
EXPARRAY EQU   EXPDATAB+4
VS2AGL   EQU   0
VSLABOPT EQU   VS2AGL+28
VS2MSG   EQU   VS2AGL+35
VS2RESOP EQU   VS2AGL+36
VS1AGL   EQU   0
VSHEAD   EQU   VS1AGL
VSUCBP   EQU   VS1AGL+8
VSVOLP   EQU   VS1AGL+12
VSFILEP  EQU   VS1AGL+16
VSIOP    EQU   VS1AGL+20
VSNUMATP EQU   VS1AGL+24
VSNXTATP EQU   VS1AGL+28
VSCATP   EQU   VS1AGL+32
VSACBP   EQU   VS1AGL+36
VSCATDDP EQU   VS1AGL+40
VSPSWDP  EQU   VS1AGL+44
VSPFILEP EQU   VS1AGL+48
VSSERP   EQU   VS1AGL+52
VSDEVP   EQU   VS1AGL+56
VSOSERP  EQU   VS1AGL+60
VSODEVP  EQU   VS1AGL+64
VSSECOPT EQU   VS1AGL+68
VSNOVSAM EQU   VSSECOPT
VSNONONV EQU   VSSECOPT
VSREAD   EQU   VSSECOPT
VSUCTEST EQU   VSSECOPT
VSOPCAT  EQU   VSSECOPT
VSUCMAST EQU   VSSECOPT
VSVTOPT  EQU   VS1AGL+69
VSTIME   EQU   VSVTOPT
VSALTTRK EQU   VSVTOPT
VSVSFLAG EQU   VSVTOPT
VSCATOPT EQU   VS1AGL+70
VSDEVICE EQU   VSCATOPT
VSSERIAL EQU   VSCATOPT
VSLIST   EQU   VSCATOPT
VSRETURN EQU   VS1AGL+71
VSVSAM   EQU   VSRETURN
VSUCAT   EQU   VSRETURN
VSMSG    EQU   VS1AGL+72
VSFROMV  EQU   VSMSG
VSTOV    EQU   VSMSG
VSRESOPT EQU   VS1AGL+73
VSRES    EQU   VSRESOPT
VSREAL   EQU   VSRESOPT
RCTAGL   EQU   0
RCTOPT   EQU   RCTAGL+8
RCTDEV   EQU   RCTOPT
RCTVOL   EQU   RCTOPT
RCTODEV  EQU   RCTAGL+12
RCTNDEV  EQU   RCTAGL+16
RCTOVOL  EQU   RCTAGL+20
RCTNVOL  EQU   RCTAGL+26
RCTDSET  EQU   RCTAGL+32
STAEPARM EQU   0
STARCVY  EQU   STAEPARM+52
STARETRY EQU   STAEPARM+53
VOLLABEL EQU   0
SV82LIST EQU   0
@NM00074 EQU   SV82LIST+4
SV82DCBP EQU   @NM00074
@NM00075 EQU   SV82LIST+12
SV82WRKP EQU   @NM00075
SRTAGL   EQU   0
LCTINFO  EQU   0
LCTFLAGS EQU   LCTINFO+32
UCTAGL   EQU   0
UCTFLAGS EQU   UCTAGL+68
SELAGL   EQU   0
SELFLAGS EQU   SELAGL+22
DATESAGL EQU   0
DATESOPT EQU   DATESAGL+20
VS3AGL   EQU   0
VS3FLAGS EQU   VS3AGL+58
VSDVTOC  EQU   0
VSDSTAT  EQU   0
VSDSFLG1 EQU   VSDSTAT+16
VSDFLG2  EQU   VSDSTAT+17
VSDSCR   EQU   0
VSDSCRFL EQU   VSDSCR+4
VSDUSAGE EQU   0
VSDDORG  EQU   VSDUSAGE+9
VSDALLOC EQU   VSDUSAGE+10
VSDUSEF  EQU   VSDUSAGE+11
VSDDSORG EQU   VSDUSAGE+16
VSDBLOCK EQU   0
VSDSPACE EQU   VSDBLOCK+12
VSDARRAY EQU   VSDBLOCK+16
VSDVARY  EQU   VSDARRAY+48
IECSDSF1 EQU   0
IECSDSL1 EQU   0
DS1DSNAM EQU   IECSDSL1
DS1FMTID EQU   IECSDSL1+44
DS1EXPDT EQU   IECSDSL1+56
DS1DSORG EQU   IECSDSL1+82
DS1DSIND EQU   IECSDSL1+93
IECSDSF4 EQU   0
IECSDSL4 EQU   0
DS4IDFMT EQU   IECSDSL4
DS4HCCHH EQU   IECSDSL4+8
DS4NOATK EQU   IECSDSL4+12
DS4DEVCT EQU   IECSDSL4+18
DS4DEVOV EQU   DS4DEVCT+6
DS4AMTIM EQU   IECSDSL4+32
DS4AMCAT EQU   IECSDSL4+40
DS4VSIND EQU   DS4AMCAT
DS4VSREF EQU   DS4VSIND
CTGPL    EQU   0
CTGOPTN1 EQU   CTGPL
CTGMAST  EQU   CTGOPTN1
CTGNAME  EQU   CTGOPTN1
CTGCNAME EQU   CTGOPTN1
CTGOPTN2 EQU   CTGPL+1
CTGEXT   EQU   CTGOPTN2
CTGERASE EQU   CTGOPTN2
CTGSMF   EQU   CTGERASE
CTGREL   EQU   CTGSMF
CTGPURG  EQU   CTGOPTN2
CTGVMNT  EQU   CTGPURG
CTGOPTN3 EQU   CTGPL+2
CTGFUNC  EQU   CTGOPTN3
CTGNUM   EQU   CTGOPTN3
CTGAM0   EQU   CTGOPTN3
CTGOPTN4 EQU   CTGPL+3
CTGENT   EQU   CTGPL+4
CTGCAT   EQU   CTGPL+8
CTGWKA   EQU   CTGPL+12
CTGDSORG EQU   CTGPL+16
CTGNOFLD EQU   CTGPL+19
CTGDDNM  EQU   CTGPL+20
CTGNEWNM EQU   CTGDDNM
CTGFDBK  EQU   CTGNEWNM
CTGFBFLG EQU   CTGNEWNM+2
CTGJSCB  EQU   CTGPL+24
CTGPSWD  EQU   CTGJSCB
CTGFIELD EQU   CTGPL+28
CTGFL    EQU   0
CTGFLDNO EQU   CTGFL
CTGFLDRE EQU   CTGFL+3
CTGFLDNM EQU   CTGFL+8
CTGFLDAT EQU   CTGFL+16
DSCBFMT4 EQU   0
DS4DATA  EQU   DSCBFMT4+44
V1VOLA   EQU   0
V1DEVA   EQU   0
V1UCBADR EQU   0
V1DDNAM  EQU   0
V1NXAREA EQU   0
V1NUAREA EQU   0
PFILE    EQU   0
PFILECNT EQU   PFILE
@NM00123 EQU   PFILE+2
PFILEVAL EQU   @NM00123+1
CATDSN   EQU   0
AMSTP041 EQU   0
AMSTP042 EQU   0
AMSTP043 EQU   0
AMSTP044 EQU   0
DMPTRM   EQU   0
IDCIOCO0 EQU   0
IDCIOIT0 EQU   0
IDCIOST0 EQU   0
IDCIOTM0 EQU   0
IDCIOVY0 EQU   0
IDCSACL0 EQU   0
IDCSACR0 EQU   0
IDCSADE0 EQU   0
IDCSADQ0 EQU   0
IDCSAFP0 EQU   0
IDCSAFS0 EQU   0
IDCSAGP0 EQU   0
IDCSAGS0 EQU   0
IDCSAID0 EQU   0
IDCSALC0 EQU   0
IDCSALD0 EQU   0
IDCSALK0 EQU   0
IDCSANQ0 EQU   0
IDCSAPR0 EQU   0
IDCSAPT0 EQU   0
IDCSAQL0 EQU   0
IDCSASN0 EQU   0
IDCSASS0 EQU   0
IDCSAST0 EQU   0
IDCSAUC0 EQU   0
IDCSAWO0 EQU   0
IDCSA060 EQU   0
IDCST010 EQU   0
IDCTPER0 EQU   0
LISTTEST EQU   0
NEWERID1 EQU   5
GDTTBL   EQU   0
GDTTR1   EQU   GDTTBL+8
GDTTR2   EQU   GDTTBL+12
GDTDBG   EQU   GDTTBL+40
GDTSTC   EQU   GDTTBL+44
GDTPRT   EQU   GDTTBL+48
GDTESS   EQU   GDTTBL+52
GDTESA   EQU   GDTTBL+56
GDTRST   EQU   GDTTBL+60
GDTRES   EQU   GDTTBL+64
GDTCAL   EQU   GDTTBL+68
GDTGSP   EQU   GDTTBL+72
GDTFSP   EQU   GDTTBL+76
GDTGPL   EQU   GDTTBL+80
GDTFPL   EQU   GDTTBL+84
GDTLOD   EQU   GDTTBL+88
GDTDEL   EQU   GDTTBL+92
GDTPRL   EQU   GDTTBL+96
GDTEPL   EQU   GDTTBL+100
GDTTIM   EQU   GDTTBL+104
GDTIIO   EQU   GDTTBL+108
GDTTIO   EQU   GDTTBL+112
GDTOPN   EQU   GDTTBL+124
GDTCLS   EQU   GDTTBL+128
GDTGET   EQU   GDTTBL+132
GDTPUT   EQU   GDTTBL+136
GDTPOS   EQU   GDTTBL+140
GDTCPY   EQU   GDTTBL+144
GDTCAT   EQU   GDTTBL+148
GDTABT   EQU   GDTTBL+152
GDTABH   EQU   GDTTBL+156
GDTSNP   EQU   GDTTBL+164
GDTVFY   EQU   GDTTBL+172
GDTUID   EQU   GDTTBL+192
GDTPMT   EQU   GDTTBL+196
GDTCIR   EQU   GDTTBL+200
GDTLNK   EQU   GDTTBL+204
GDTALC   EQU   GDTTBL+208
GDTDLC   EQU   GDTTBL+212
GDTQAL   EQU   GDTTBL+216
GDTSTW   EQU   GDTTBL+220
GDTSSC   EQU   GDTTBL+224
GDTENQ   EQU   GDTTBL+228
GDTRSV   EQU   GDTTBL+232
GDTDEQ   EQU   GDTTBL+236
GDTSFO   EQU   GDTTBL+240
GDTWTO   EQU   GDTTBL+244
GDTSCR   EQU   GDTTBL+248
GDTUNT   EQU   GDTTBL+252
GDTRCT   EQU   GDTTBL+256
GDTIFO   EQU   GDTTBL+260
GDTEXP   EQU   GDTTBL+264
GDTSTA   EQU   GDTTBL+268
GDTERR   EQU   GDTTBL+272
GDTUNC   EQU   GDTTBL+276
GDTLOC   EQU   GDTTBL+280
GDTRCK   EQU   GDTTBL+284
REQUEST  EQU   0
VS1ARGL  EQU   0
ORGTYPE  EQU   0
PROTTYPE EQU   0
FM4PASS  EQU   0
FM1PASS  EQU   0
CHKPASS  EQU   0
OPENACB  EQU   0
OPENIOCS EQU   0
@NM00108 EQU   CTGDDNM
CTGPROB  EQU   @NM00108
CTGREASN EQU   CTGPROB+2
DSDSORG  EQU   DS1DSORG
DSBYTE1  EQU   DSDSORG
DSORGPS  EQU   DSBYTE1
DSBYTE2  EQU   DSDSORG+1
DSORGAM  EQU   DSBYTE2
DSINDDS  EQU   DS1DSIND
PROTRACF EQU   DSINDDS
PASSPROT EQU   DSINDDS
READOK   EQU   DSINDDS
*                                      START UNREFERENCED COMPONENTS
@NM00119 EQU   DSINDDS
@NM00118 EQU   DSINDDS
@NM00117 EQU   DSINDDS
@NM00116 EQU   DSINDDS
@NM00115 EQU   DSBYTE2
@NM00114 EQU   DSBYTE2
@NM00113 EQU   DSBYTE1
@NM00112 EQU   DSBYTE1
CTGREAS2 EQU   CTGREASN+1
CTGREAS1 EQU   CTGREASN
CTGMODID EQU   CTGPROB
@NM00110 EQU   VS1ARGL
GDTECT   EQU   GDTTBL+188
GDTPSB   EQU   GDTTBL+184
GDTUPT   EQU   GDTTBL+180
GDTCMB   EQU   GDTTBL+176
GDTSPR   EQU   GDTTBL+168
@NM00001 EQU   GDTTBL+160
GDTTOH   EQU   GDTTBL+120
GDTRIP   EQU   GDTTBL+116
GDTIOH   EQU   GDTTBL+36
GDTSAH   EQU   GDTTBL+32
GDTTPH   EQU   GDTTBL+28
GDTRIH   EQU   GDTTBL+24
GDTSTH   EQU   GDTTBL+20
GDTDBH   EQU   GDTTBL+16
GDTPRM   EQU   GDTTBL+4
GDTHDR   EQU   GDTTBL
PFILELEN EQU   @NM00123
@NM00111 EQU   DSCBFMT4
CTGFLPT  EQU   CTGFLDAT+4
CTGFLNG  EQU   CTGFLDAT
CTGFLCHN EQU   CTGFL+12
CTGFLDWA EQU   CTGFL+4
CTGFLDTS EQU   CTGFLDRE
@NM00109 EQU   CTGFLDRE
CTGFLDGC EQU   CTGFL+2
CTGFLDCD EQU   CTGFL+1
@NM00107 EQU   CTGFBFLG
CTGNGDSN EQU   CTGFBFLG
CTGGDGB  EQU   CTGFBFLG
CTGKEEP  EQU   CTGFBFLG
CTGPAR   EQU   CTGFBFLG
CTGTYPE  EQU   CTGPL+18
@NM00106 EQU   CTGDSORG
CTGOPTNS EQU   CTGDSORG
CTGCVOL  EQU   CTGCAT
CTGFVT   EQU   CTGENT
@NM00105 EQU   CTGOPTN4
CTGBYPMT EQU   CTGOPTN4
@NM00104 EQU   CTGOPTN4
CTGDOCAT EQU   CTGOPTN4
CTGLBASE EQU   CTGOPTN4
CTGSRH   EQU   CTGOPTN3
CTGGDGL  EQU   CTGOPTN3
CTGSUPLT EQU   CTGOPTN3
@NM00103 EQU   CTGOPTN2
CTGSCR   EQU   CTGOPTN2
CTGOVRID EQU   CTGOPTN2
CTGDISC  EQU   CTGOPTN2
CTGGTNXT EQU   CTGOPTN2
CTGRCATN EQU   CTGVMNT
CTGGTALL EQU   CTGREL
CTGNSVS  EQU   CTGEXT
CTGGENLD EQU   CTGOPTN1
CTGREAD  EQU   CTGOPTN1
CTGUPD   EQU   CTGOPTN1
CTGCI    EQU   CTGOPTN1
CTGBYPSS EQU   CTGOPTN1
DS4END   EQU   IECSDSL4+96
@NM00102 EQU   IECSDSL4+71
DS4VTOCE EQU   IECSDSL4+61
DS4F6PTR EQU   IECSDSL4+56
@NM00101 EQU   IECSDSL4+51
DS4R2TIM EQU   IECSDSL4+43
DS4VSCRA EQU   DS4AMCAT+1
@NM00100 EQU   DS4VSIND
DS4VSBAD EQU   DS4VSIND
DS4DEVDB EQU   DS4DEVCT+13
DS4DEVDT EQU   DS4DEVCT+12
DS4DEVTL EQU   DS4DEVCT+10
DS4DEVFG EQU   DS4DEVCT+9
DS4DEVK  EQU   DS4DEVCT+8
DS4DEVL  EQU   DS4DEVOV+1
DS4DEVI  EQU   DS4DEVOV
DS4DEVTK EQU   DS4DEVCT+4
DS4DEVSZ EQU   DS4DEVCT
@NM00099 EQU   IECSDSL4+16
DS4NOEXT EQU   IECSDSL4+15
DS4VTOCI EQU   IECSDSL4+14
DS4DSREC EQU   IECSDSL4+6
DS4HPCHR EQU   IECSDSL4+1
@NM00098 EQU   IECSDSF4
DS1END   EQU   IECSDSL1+140
DS1PTRDS EQU   IECSDSL1+135
DS1EXT3  EQU   IECSDSL1+125
DS1EXT2  EQU   IECSDSL1+115
DS1EXT1  EQU   IECSDSL1+105
@NM00097 EQU   IECSDSL1+103
DS1TRBAL EQU   IECSDSL1+101
DS1LSTAR EQU   IECSDSL1+98
DS1SCALO EQU   IECSDSL1+94
DS1RKP   EQU   IECSDSL1+91
DS1KEYL  EQU   IECSDSL1+90
DS1LRECL EQU   IECSDSL1+88
DS1BLKL  EQU   IECSDSL1+86
DS1OPTCD EQU   IECSDSL1+85
DS1RECFM EQU   IECSDSL1+84
@NM00096 EQU   IECSDSL1+75
DS1SYSCD EQU   IECSDSL1+62
@NM00095 EQU   IECSDSL1+61
DS1NOBDB EQU   IECSDSL1+60
DS1NOEPV EQU   IECSDSL1+59
DS1CREDT EQU   IECSDSL1+53
DS1VOLSQ EQU   IECSDSL1+51
DS1DSSN  EQU   IECSDSL1+45
@NM00094 EQU   IECSDSF1
VSDDSN   EQU   VSDARRAY+4
VSDVOLCT EQU   VSDARRAY
VSDFMT0  EQU   VSDBLOCK+8
VSDVTOCS EQU   VSDBLOCK+4
VSDELEM  EQU   VSDBLOCK
VSDFREE  EQU   VSDUSAGE+24
VSDALLC  EQU   VSDUSAGE+19
VSDDSOR3 EQU   VSDDSORG+2
@NM00093 EQU   VSDDSORG
VSDSCAL  EQU   VSDUSAGE+12
@NM00092 EQU   VSDUSEF
VSDCALFR EQU   VSDUSEF
@NM00091 EQU   VSDALLOC
VSDABSTR EQU   VSDALLOC
VSDABLK  EQU   VSDALLOC
VSDATRK  EQU   VSDALLOC
VSDACYL  EQU   VSDALLOC
@NM00090 EQU   VSDDORG
VSDOU    EQU   VSDDORG
VSDOIS   EQU   VSDDORG
VSDODA   EQU   VSDDORG
VSDOUN   EQU   VSDDORG
VSDOPS   EQU   VSDDORG
VSDOPO   EQU   VSDDORG
VSDEXTS  EQU   VSDUSAGE+8
VSDSECAL EQU   VSDUSAGE+4
VSDFTRK  EQU   VSDUSAGE+2
VSDTRKS  EQU   VSDUSAGE
@NM00089 EQU   VSDSCR+5
@NM00088 EQU   VSDSCRFL
VSDVSAM  EQU   VSDSCRFL
VSDCATLC EQU   VSDSCRFL
VSDACBPT EQU   VSDSCR
@NM00087 EQU   VSDSTAT+29
VSDPRTC  EQU   VSDSTAT+25
VSDCAT   EQU   VSDSTAT+22
VSDEXP   EQU   VSDSTAT+20
VSDCRE   EQU   VSDSTAT+18
@NM00086 EQU   VSDFLG2
VSDRACF  EQU   VSDFLG2
VSDERROR EQU   VSDFLG2
VSDPROT  EQU   VSDFLG2
VSDPWW   EQU   VSDFLG2
VSDPWR   EQU   VSDFLG2
@NM00085 EQU   VSDSFLG1
VSDCVSAM EQU   VSDSFLG1
VSDCATLG EQU   VSDSFLG1
VSDVSAME EQU   VSDSFLG1
VSDVSAMC EQU   VSDSFLG1
VSDVTOCE EQU   VSDSFLG1
VSDVTOCC EQU   VSDSFLG1
VSDOWNER EQU   VSDSTAT+8
VSDEXPIR EQU   VSDSTAT+4
VSDCREAT EQU   VSDSTAT
VSDFRCCL EQU   VSDVTOC+21
@NM00084 EQU   VSDVTOC+20
VSDFREXT EQU   VSDVTOC+16
@NM00083 EQU   VSDVTOC+15
VSDFRTRK EQU   VSDVTOC+11
@NM00082 EQU   VSDVTOC+10
VSDFRCYL EQU   VSDVTOC+6
@NM00081 EQU   VSDVTOC
@NM00080 EQU   VS3FLAGS
VS3SYSNM EQU   VS3FLAGS
VS3UNCAT EQU   VS3FLAGS
VS3SCR   EQU   VS3FLAGS
VS3USAGE EQU   VS3FLAGS
VS3STAT  EQU   VS3FLAGS
VS3DD    EQU   VS3AGL+50
VS3VOL   EQU   VS3AGL+44
VS3POOL  EQU   VS3AGL+40
VS3DEV   EQU   VS3AGL+36
VS3UCBP  EQU   VS3AGL+32
VS3CREAT EQU   VS3AGL+28
VS3EXPIR EQU   VS3AGL+24
VS3AST   EQU   VS3AGL+22
VS3LEVLN EQU   VS3AGL+20
VS3LEVP  EQU   VS3AGL+16
VS3EXDSP EQU   VS3AGL+12
VS3LISTP EQU   VS3AGL+8
VS3HEAD  EQU   VS3AGL
@NM00079 EQU   DATESOPT
DATDAYOP EQU   DATESOPT
DATDTEOP EQU   DATESOPT
DATSUB   EQU   DATESOPT
DATADD   EQU   DATESOPT
DATRETRN EQU   DATESAGL+16
DATDAYS  EQU   DATESAGL+12
DATDATE  EQU   DATESAGL+8
DATHEAD  EQU   DATESAGL
@NM00078 EQU   SELFLAGS
SELVOL   EQU   SELAGL+16
SELDDNP  EQU   SELAGL+12
SELUCBP  EQU   SELAGL+8
SELHEAD  EQU   SELAGL
@NM00077 EQU   UCTFLAGS
UCTVSCAT EQU   UCTFLAGS
UCTDD    EQU   UCTAGL+60
UCTVOLP  EQU   UCTAGL+56
UCTACBP  EQU   UCTAGL+52
UCTDSN   EQU   UCTAGL+8
UCTHEAD  EQU   UCTAGL
@NM00076 EQU   LCTFLAGS
LCTVSCAT EQU   LCTFLAGS
LCTOWNER EQU   LCTINFO+24
LCTEXPIR EQU   LCTINFO+20
LCTCREAT EQU   LCTINFO+16
LCTACBP  EQU   LCTINFO+12
LCTMULVC EQU   LCTINFO+8
LCTHEAD  EQU   LCTINFO
SRTWORKP EQU   SRTAGL+28
SRTFLDLN EQU   SRTAGL+24
SRTPOSIT EQU   SRTAGL+20
SRTLEN   EQU   SRTAGL+16
SRTNUM   EQU   SRTAGL+12
SRTADDR  EQU   SRTAGL+8
SRTHEAD  EQU   SRTAGL
SV82DEBP EQU   SV82WRKP
SV82TTRP EQU   SV82LIST+8
SV82VOLP EQU   SV82DCBP
SV82UCBP EQU   SV82LIST+1
SV82CODE EQU   SV82LIST
VOLRESV3 EQU   VOLLABEL+55
VOLOWNER EQU   VOLLABEL+45
VOLRESV1 EQU   VOLLABEL+20
VOLVTOC  EQU   VOLLABEL+15
VOLSECTY EQU   VOLLABEL+14
VOLSERNO EQU   VOLLABEL+8
VOLNO    EQU   VOLLABEL+7
VOLLABI  EQU   VOLLABEL+4
VOLKEY   EQU   VOLLABEL
STAVTTR  EQU   STAEPARM+54
@NM00073 EQU   STARETRY
STAVTOC  EQU   STARETRY
STAOFF   EQU   STARETRY
STAIO05  EQU   STARETRY
@NM00072 EQU   STARCVY
STACLEAR EQU   STARCVY
STAVPOST EQU   STARCVY
STAVENQ  EQU   STARCVY
STAVDMNT EQU   STARCVY
STAVMNT  EQU   STARCVY
STATCB   EQU   STAEPARM+48
STARTADD EQU   STAEPARM+44
STAEXSAV EQU   STAEPARM+40
STARTSAV EQU   STAEPARM+36
STARTTR  EQU   STAEPARM+32
@NM00071 EQU   STAEPARM+30
STARVOL  EQU   STAEPARM+24
STARUCB  EQU   STAEPARM+20
@NM00070 EQU   STAEPARM+18
STAVVOL  EQU   STAEPARM+12
STAVUCB  EQU   STAEPARM+8
STAHEAD  EQU   STAEPARM
@NM00069 EQU   RCTAGL+10
@NM00068 EQU   RCTOPT
RCTHEAD  EQU   RCTAGL
@NM00067 EQU   VSRESOPT
@NM00066 EQU   VSMSG
@NM00065 EQU   VSRETURN
@NM00064 EQU   VSCATOPT
@NM00063 EQU   VSVTOPT
VSWRITE  EQU   VSSECOPT
VSMASTER EQU   VSSECOPT
VSVTOCPT EQU   VS2AGL+48
@NM00062 EQU   VS2AGL+45
VSDDNAME EQU   VS2AGL+37
@NM00061 EQU   VS2RESOP
VS2REAL  EQU   VS2RESOP
VS2RES   EQU   VS2RESOP
@NM00060 EQU   VS2MSG
VS2TOV   EQU   VS2MSG
VSVOLUME EQU   VS2AGL+29
@NM00059 EQU   VSLABOPT
VSNOVTOC EQU   VSLABOPT
VSVOLSER EQU   VSLABOPT
VSOWNER  EQU   VSLABOPT
VSIOBKPT EQU   VS2AGL+24
VSVOLPTR EQU   VS2AGL+20
VSOWNPTR EQU   VS2AGL+16
VSVTOCSZ EQU   VS2AGL+12
VSUCBPTR EQU   VS2AGL+8
VS2HEAD  EQU   VS2AGL
EXPDATAL EQU   EXPARRAY+6
@NM00058 EQU   EXPARRAY+5
EXPKEYLN EQU   EXPARRAY+4
EXPDATAP EQU   EXPARRAY
EXPRECNO EQU   EXPDATAB
EXPCCHHR EQU   EXPARG+16
EXPCTLBK EQU   EXPARG+8
EXPHEAD  EQU   EXPARG
EXRWFUN  EQU   EXWRARG+46
@NM00057 EQU   EXSPACE+8
@NM00056 EQU   EXSPACE+6
@NM00055 EQU   EXSPACE+4
@NM00054 EQU   EXSPACE+1
@NM00053 EQU   EXSPACE
EXRWKDLN EQU   EXWRARG+32
@NM00052 EQU   EXWRARG+31
EXRECNUM EQU   EXRWCHR+4
EXHH     EQU   EXRWCHR+2
EXCC     EQU   EXRWCHR
EXCCWCNT EQU   EXWRARG+24
EXLOCPTR EQU   EXWRARG+20
EXRWDARE EQU   EXWRARG+16
EXRWIOAR EQU   EXWRARG+12
EXRWCTBL EQU   EXWRARG+8
EXRWRES  EQU   EXWRARG
EXGDATAL EQU   EXGARG+30
@NM00051 EQU   EXGARG+29
EXGKEYLN EQU   EXGARG+28
EXGDATAP EQU   EXGARG+24
EXGRECNO EQU   EXGARG+20
EXGCCHH2 EQU   EXGARG+16
EXGCCHH1 EQU   EXGARG+12
EXGCTLBK EQU   EXGARG+8
EXGHEAD  EQU   EXGARG
EXOVTH   EQU   EXFLG
EXORVT   EQU   EXFLG
EXORDS   EQU   EXFLG
EXOSPK   EQU   EXFLG
EXORVS   EQU   EXFLG
@NM00050 EQU   EXFLG
@NM00049 EQU   EXOPT
EXOREP   EQU   EXOPT
EXOVTOC  EQU   EXOPT
EXONEW   EQU   EXOPT
EXOLAB   EQU   EXOPT
EXOTAB   EQU   EXOPT
EXOEXT   EQU   EXOARG+24
EXOUCB   EQU   EXOARG+20
EXOHEAD  EQU   EXOARG
@NM00048 EQU   EXCLFLAG
EXCLMNT  EQU   EXCLFLAG
EXCLVOL  EQU   EXCLAGL+16
EXCLDDP  EQU   EXCLAGL+12
EXCLUCBP EQU   EXCLAGL+8
EXCLHEAD EQU   EXCLAGL
@NM00047 EQU   CKFLAGS
CKDMTABL EQU   CKFLAGS
CKRETTYP EQU   CKFLAGS
CKTESTVT EQU   CKFLAGS
CKLABELP EQU   CKAGL+24
CKDATYPE EQU   CKAGL+20
CKDDNAME EQU   CKAGL+12
CKUCBPTR EQU   CKAGL+8
CKHEAD   EQU   CKAGL
PULABELP EQU   PUAGL+16
PUTTRPTR EQU   PUAGL+12
PUUCBPTR EQU   PUAGL+8
PUHEAD   EQU   PUAGL
MDR      EQU   MDVTOC+4
MDHH     EQU   MDVTOC+2
MDCC     EQU   MDVTOC
@NM00046 EQU   MDAGL+31
MDVTOCTR EQU   MDFLAGS
MDFORCE  EQU   MDFLAGS
MDDEQ    EQU   MDFLAGS
MDENQ    EQU   MDFLAGS
MDWAIT   EQU   MDFLAGS
MDPOST   EQU   MDFLAGS
MDCLEAR  EQU   MDFLAGS
MDNEWVOL EQU   MDFLAGS
MDLABEL  EQU   MDAGL+24
MDPUAGL  EQU   MDAGL+20
MDDDNAME EQU   MDAGL+12
MDUCBPTR EQU   MDAGL+8
MDHEAD   EQU   MDAGL
CTTBLRR  EQU   CTARRAY+3
CTTBLHH  EQU   CTARRAY+2
CTTBLCC  EQU   CTARRAY+1
CTTBLID  EQU   CTARRAY
CTREALH  EQU   CTMSG+3
CTREALCC EQU   CTMSG+1
@NM00045 EQU   CTMSG
CMCSN2   EQU   CMMSG+28
CMCSN1   EQU   CMMSG+16
CMNUMCRT EQU   CMMSG+15
@NM00044 EQU   CMMSG+14
CMNEWVOL EQU   CMMSG+8
@NM00043 EQU   CMMSG+7
@NM00042 EQU   CMVOLFLG
CMRONLY  EQU   CMVOLFLG
CMBIND   EQU   CMVOLFLG
CMSCRCRT EQU   CMVOLFLG
CMEXCL   EQU   CMVOLFLG
CMDERAS  EQU   CMVOLFLG
CMSCRVOL EQU   CMVOLFLG
CMCECART EQU   CMVOLFLG
CMOLDVOL EQU   CMMSG
CCOLDCSN EQU   CCMSG+24
CCNEWCSN EQU   CCMSG+12
@NM00041 EQU   CCMSG+10
CCVOL    EQU   CCMSG+4
@NM00040 EQU   CCMSG+2
CCEJCODE EQU   CCMSG+1
CCPSTCDE EQU   CCMSG
@NM00039 EQU   DMPARY+15
DMPARYTP EQU   DMPARY+14
DMPARYEX EQU   DMPARY+12
DMPARYIC EQU   DMPARY+10
DMPARYSZ EQU   DMPARY+8
DMPARYNM EQU   DMPARY
@NM00038 EQU   DMPITM+15
DMPITMTP EQU   DMPITM+14
DMPITMLN EQU   DMPITM+12
DMPITMPT EQU   DMPITM+8
DMPITMNM EQU   DMPITM
@NM00037 EQU   ERCNVTAB+24
ERDARBPT EQU   ERCPLPT
ERDYNRC  EQU   ERCATRC
ERDSNM   EQU   ERCNVTAB+12
@NM00036 EQU   ERCNVTAB+4
@NM00035 EQU   ERCNVTAB+3
@NM00034 EQU   EROSOPER
EROSUCDX EQU   EROSOPER
EROSCATL EQU   EROSOPER
@NM00033 EQU   EROPER
ERCATAL  EQU   EROPER
ERCATDL  EQU   EROPER
ERCATDE  EQU   EROPER
ERCATLC  EQU   EROPER
@NM00032 EQU   ERTYPE
ERDYNAL  EQU   ERTYPE
EROSCAT  EQU   ERTYPE
ERCATLG  EQU   ERTYPE
@NM00031 EQU   FMTCNVF+1
FMTAR    EQU   FMTCNVF+1
FMTBS    EQU   FMTCNVF+1
FMTSS    EQU   FMTCNVF+1
FMTAL    EQU   FMTCNVF+1
FMTZS    EQU   FMTCNVF+1
@NM00030 EQU   FMTCNVF
FMTPU    EQU   FMTCNVF
FMTBD    EQU   FMTCNVF
FMTBHD   EQU   FMTCNVF
FMTBHA   EQU   FMTCNVF
FMTBH    EQU   FMTCNVF
FMTOLEN  EQU   FMTLIST+8
FMTRIO   EQU   FMTOCOL
FMTSPT   EQU   FMTSTO
FMTSTL   EQU   FMTILEN
@NM00029 EQU   FMTFLGS+1
FMTSMSG  EQU   FMTFLGS+1
FMTHDF   EQU   FMTFLGS
FMTDFF   EQU   FMTFLGS
FMTSTF   EQU   FMTFLGS
FMTREPF  EQU   FMTFLGS
FMTBDF   EQU   FMTFLGS
FMTIDF   EQU   FMTFLGS
FMTSCF   EQU   FMTFLGS
FMTEOLF  EQU   FMTFLGS
DARGPCT  EQU   DARGINL
DARGREP  EQU   DARGINS
@NM00028 EQU   DARGLIST+19
DARGIND  EQU   DARGLIST+18
DARGRETL EQU   DARGLIST+16
@NM00027 EQU   IOINFOPT
IOINFLUB EQU   IOINFOPT
IOINFTMS EQU   IOINFOPT
IOINFSUP EQU   IOINFOPT
IOINFVOL EQU   IOINFOPT
IOINFDVT EQU   IOINFOPT
OPNSTRNO EQU   OPNAGL+43
@NM00026 EQU   OPNOPT2
@NM00025 EQU   OPNOPT2
OPNOPTAS EQU   OPNOPT2
@NM00024 EQU   OPNDSO
OPNDSOPO EQU   OPNDSO
OPNDSOIS EQU   OPNDSO
OPNDSOAM EQU   OPNDSO
OPNREC   EQU   OPNAGL+32
OPNDEVIX EQU   OPNDEV+4
OPNDEVDT EQU   OPNDEV
OPNCBP   EQU   OPNAGL+20
OPNMODRP EQU   OPNMOD
OPNMODUB EQU   OPNMOD
OPNMODRS EQU   OPNMOD
OPNMODAX EQU   OPNMOD
OPNMODRR EQU   OPNMOD
OPNMODAC EQU   OPNMOD
OPNMODPD EQU   OPNMOD
OPNTYPSY EQU   OPNTYP
OPNTYPRV EQU   OPNTYP
OPNTYPEX EQU   OPNTYP
OPNTYPRA EQU   OPNTYP
OPNTYPXM EQU   OPNTYP
OPNTYPSO EQU   OPNTYP
OPNTYPSI EQU   OPNTYP
@NM00023 EQU   OPNRFM
OPNRFMBK EQU   OPNRFM
OPNRFMSF EQU   OPNRFM
OPNRFMUN EQU   OPNRFM
OPNRFMVR EQU   OPNRFM
OPNOPTSK EQU   OPNOPT
OPNOPTDR EQU   OPNOPT
OPNOPTCR EQU   OPNOPT
OPNOPTKS EQU   OPNOPT
OPNOPTOT EQU   OPNOPT
OPNOPTIN EQU   OPNOPT
IOCEXT   EQU   IOCSTR+64
IOCTSML  EQU   IOCREL+2
IOCTPML  EQU   IOCREL
IOCWORK  EQU   IOCSTR+56
IOCRRN   EQU   IOCSTR+52
IOCPNM   EQU   IOCNWM+2
IOCPTL   EQU   IOCNWM
IOCKYA   EQU   IOCMEM
IOCVRC   EQU   IOCTTR
IOCHURBA EQU   IOCSTR+28
IOCVOLSR EQU   IOCSTR+22
@NM00022 EQU   IOCMSG
IOCMSGSM EQU   IOCMSG
IOCMSGAE EQU   IOCMSG
IOCMSGCE EQU   IOCMSG
IOCMSGOE EQU   IOCMSG
IOCMSGOP EQU   IOCMSG
IOCCHPKG EQU   IOCMSG
IOCCHPKE EQU   IOCMSG
IOCCHPNU EQU   IOCCHP
IOCCHPUP EQU   IOCCHP
IOCCHPBK EQU   IOCCHP
IOCCHPCR EQU   IOCCHP
IOCCHPKS EQU   IOCCHP
IOCCHPSK EQU   IOCCHP
IOCCHPDR EQU   IOCCHP
IOCCHPSQ EQU   IOCCHP
IOCMACNT EQU   IOCMAC2
IOCMACER EQU   IOCMAC2
IOCMACPA EQU   IOCMAC2
IOCMACEN EQU   IOCMAC2
IOCMACCP EQU   IOCMAC2
IOCMACRR EQU   IOCMAC2
IOCMACAS EQU   IOCMAC2
IOCMACSK EQU   IOCMAC2
@NM00021 EQU   IOCMAC
IOCMACCC EQU   IOCMAC
IOCMACDR EQU   IOCMAC
IOCMACBK EQU   IOCMAC
IOCMACCR EQU   IOCMAC
IOCMACUP EQU   IOCMAC
IOCMACOT EQU   IOCMAC
IOCMACIN EQU   IOCMAC
@NM00020 EQU   IOCRFM
IOCRFMBK EQU   IOCRFM
IOCRFMSF EQU   IOCRFM
IOCRFMUN EQU   IOCRFM
IOCRFMVR EQU   IOCRFM
IOCRFMFX EQU   IOCRFM
@NM00019 EQU   IOCDSO
IOCDSOPO EQU   IOCDSO
IOCDSOIS EQU   IOCDSO
IOCDSOPS EQU   IOCDSO
IOCDSOAM EQU   IOCDSO
IOCRKP   EQU   IOCSTR+13
IOCKYL   EQU   IOCSTR+12
IOCTRN   EQU   IOCSTR+8
IOCDLN   EQU   IOCSTR+4
UNITVTOC EQU   UNITABL+7
@NM00018 EQU   UNITSTAT
UNITUSHR EQU   UNITSTAT
UNITXSHR EQU   UNITSTAT
UNITISHR EQU   UNITSTAT
UNITUA   EQU   @NM00017+1
UNITCHA  EQU   @NM00017
RACFPROF EQU   RACFAGL+8
@NM00016 EQU   RACFFLG4
@NM00015 EQU   RACFFLG3
RACFPRF  EQU   RACFFLG3
@NM00014 EQU   RACFFLG3
@NM00013 EQU   RACFFLG2
RACFTCTL EQU   RACFFLG2
@NM00012 EQU   RACFFLG2
RACFTALT EQU   RACFFLG2
RACFCSA  EQU   RACFFLG1
RACFLOGN EQU   RACFFLG1
RACFLOGF EQU   RACFFLG1
@NM00011 EQU   RACFFLG1
@NM00010 EQU   RACFFLG1
ALLUNCNT EQU   ALLAGL+30
ALLVLCNT EQU   ALLAGL+29
@NM00009 EQU   ALLOPT
ALLOPTUN EQU   ALLOPT
ALLOPTPV EQU   ALLOPT
ALLOPTVL EQU   ALLOPT
@NM00008 EQU   ALLORG+1
ALLORGVS EQU   ALLORG+1
@NM00007 EQU   ALLORG+1
ALLORGGS EQU   ALLORG+1
ALLORGUN EQU   ALLORG
ALLORGPO EQU   ALLORG
ALLORGMQ EQU   ALLORG
ALLORGCQ EQU   ALLORG
ALLORGCX EQU   ALLORG
ALLORGDA EQU   ALLORG
ALLORGPS EQU   ALLORG
ALLORGIS EQU   ALLORG
ALLDSPUN EQU   ALLDSP
ALLDSPCG EQU   ALLDSP
ALLDSPDE EQU   ALLDSP
@NM00006 EQU   ALLDSP
ALLSTSOD EQU   ALLSTS
ALLSTSMD EQU   ALLSTS
ALLSTSNW EQU   ALLSTS
@NM00005 EQU   ALLSTS
ALLPWD   EQU   ALLAGL+20
ALLVLP   EQU   ALLAGL+16
ALLULP   EQU   ALLAGL+12
CIRPID   EQU   CIRAGL+28
CIRPWD   EQU   CIRAGL+24
CIRCAT   EQU   CIRAGL+20
CIRWKP   EQU   CIRAGL+16
CIRTLR   EQU   CIRAGL+12
CIRHDR   EQU   CIRAGL+8
CIRTLN   EQU   CIRAGL+6
CIRHLN   EQU   CIRAGL+4
@NM00004 EQU   CIRAGL+1
@NM00003 EQU   CIRTYPE
CIRTYPAQ EQU   CIRTYPE
CIRTYP1Q EQU   CIRTYPE
NEWID1   EQU   TRACE1+95
CALLID   EQU   OLDERID1+90
@NM00002 EQU   OLDERID1
*                                      END UNREFERENCED COMPONENTS
@RF00357 EQU   @RC00351
@RC00375 EQU   @RC00367
@RF00374 EQU   @RC00367
@RF00396 EQU   @RC00390
@RF00413 EQU   @RC00406
@RF00666 EQU   @RC00660
@RF00692 EQU   @RC00689
@RF00717 EQU   @RC00714
@RF00755 EQU   @RC00749
@RF00883 EQU   @RC00838
@RF00892 EQU   @RC00838
@RF00918 EQU   @RC00912
@RC00960 EQU   @RC00957
@RF00978 EQU   @RC00957
@RF01015 EQU   @RC00996
@RF01125 EQU   @RC01109
@RF01410 EQU   @RC01408
@RC01420 EQU   @RC01408
@RC01444 EQU   @RC01441
@PB00018 EQU   @EL00001
@PB00017 EQU   @PB00018
@PB00016 EQU   @PB00017
@PB00015 EQU   @PB00016
@PB00014 EQU   @PB00015
@PB00013 EQU   @PB00014
@PB00012 EQU   @PB00013
@PB00011 EQU   @PB00012
@PB00010 EQU   @PB00011
@PB00009 EQU   @PB00010
@PB00008 EQU   @PB00009
@PB00007 EQU   @PB00008
@PB00006 EQU   @PB00007
@PB00005 EQU   @PB00006
@PB00004 EQU   @PB00005
@PB00003 EQU   @PB00004
@PB00002 EQU   @PB00003
@ENDDATA EQU   *
         END   IDCVS01,(C'PLS2022',0603,76320)

         TITLE 'FSC GENERATOR                                          *
                        '
ISDAGEN0 CSECT ,                                                   0001
@MAINENT DS    0H                                                  0001
         USING *,@15                                               0001
         B     @PROLOG                                             0001
         DC    AL1(8)                                              0001
         DC    C'ISDAGEN0'                                         0001
         DROP  @15
@PROLOG  STM   @14,@12,12(@13)                                     0001
         BALR  @12,0                                               0001
@PSTART  DS    0H                                                  0001
         USING @PSTART,@12                                         0001
         L     @00,@SIZDATD                                        0001
         ISDAGSPC R,LV=(0)
         LR    @11,@01                                             0001
         USING @DATD,@11                                           0001
         ST    @13,@SA00001+4                                      0001
         LM    @00,@01,20(@13)                                     0001
         ST    @11,8(,@13)                                         0001
         LR    @13,@11                                             0001
         MVC   @PC00001(4),0(@01)                                  0001
*                                                                    */
*                                                                  0016
*   /*****************************************************************/
*   /*                                                               */
*   /* PROGRAM START.                                                */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0016
*   CVTPTR=WORKPTR;                /* SET PTR TO SDACVT.    @Y30LB51*/
         L     @10,@PC00001                                        0016
         L     CVTPTR,WORKPTR(,@10)                                0016
*   GENRETCD=0;                     /* INITIALIZE RETURN CODE.     0017
*                                                            @Y30LB51*/
         SLR   GENRETCD,GENRETCD                                   0017
*   LOGPTR=DATAPTR;                 /* SET PTR TO RECORD.    @Y30LB51*/
         L     LOGPTR,DATAPTR(,CVTPTR)                             0018
*   SENSEPTR=SDATAPTR;              /* SET PTR TO SENSE AREA.      0019
*                                                            @Y30LB51*/
         L     SENSEPTR,SDATAPTR(,CVTPTR)                          0019
*   LPARMPTR=PARMPTR;               /* SET PTR TO SDAPARMS.  @Y30LB51*/
         L     LPARMPTR,PARMPTR(,CVTPTR)                           0020
*   CALL RECTYPE;                   /* GO CREATE THE FSC.    @Y30LB51*/
         BAL   @14,RECTYPE                                         0021
*   IF GENRETCD=0 THEN              /* IF FSC GENERATED      @Y30LB51*/
         LTR   GENRETCD,GENRETCD                                   0022
         BNZ   @RF00022                                            0022
*     SDAFLAG0(8)='1'B;             /* SET FSC GENERATED FLAG.     0023
*                                                            @Y30LB51*/
         L     @10,SDA00PTR(,CVTPTR)                               0023
         OI    SDAFLAG0(@10),B'00000001'                           0023
*   ELSE                            /* FSC GENERATION FAILED.      0024
*                                                            @Y30LB51*/
*     IF GENRETCD=REALDASD THEN     /* IF REAL DASD RECORD   @Y30LB51*/
         B     @RC00022                                            0024
@RF00022 CH    GENRETCD,@CH00101                                   0024
         BNE   @RF00024                                            0024
*       GENRETCD=0;                 /* RESET RETURN CODE.    @Y30LB51*/
         SLR   GENRETCD,GENRETCD                                   0025
*     ELSE                                                         0026
*       ;                           /* RECORD WAS INVALID.           */
@RF00024 DS    0H                                                  0027
*   RETURN CODE(GENRETCD);          /*                       @Y30LB51
*                                                                    */
@RC00022 L     @13,4(,@13)                                         0027
         L     @00,@SIZDATD                                        0027
         LR    @01,@11                                             0027
         ISDAFSPC R,LV=(0),A=(1)
         LR    @15,@04                                             0027
         L     @14,12(,@13)                                        0027
         LM    @00,@12,20(@13)                                     0027
         BR    @14                                                 0027
*RECTYPE:                                                          0028
*   PROC OPTIONS(SAVE(14));         /*                       @Y30LB51*/
*                                                                  0028
@EL00001 L     @13,4(,@13)                                         0028
@EF00001 L     @00,@SIZDATD                                        0028
         LR    @01,@11                                             0028
         ISDAFSPC R,LV=(0),A=(1)
@ER00001 LM    @14,@12,12(@13)                                     0028
         BR    @14                                                 0028
RECTYPE  ST    @14,@SA00002                                        0028
*   /*****************************************************************/
*   /*                                                               */
*   /* THIS ROUTINE WILL DETERMINE THE INPUT RECORD FORMAT.          */
*   /* A ROUTINE TO CREATE THE FSC FOR EACH OF THE FORMATS WILL      */
*   /* BE CALLED.                                                    */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0029
*   IF INDEVTYP='S' THEN            /* IF SUBSYSTEM RECORD   @Y30LB51*/
         L     @10,SDA00PTR(,CVTPTR)                               0029
         CLI   INDEVTYP(@10),C'S'                                  0029
         BNE   @RF00029                                            0029
*     IF FSCMSC=0 THEN              /* AND IF FSC IS ZERO    @Y30LB51*/
         ICM   @10,3,FSCMSC(SENSEPTR)                              0030
         BNZ   @RF00030                                            0030
*       IF FORMATNO(2)='1'B THEN    /* IF FMT 1 RECORD       @Y30LB51*/
         TM    FORMATNO(SENSEPTR),B'01000000'                      0031
         BNO   @RF00031                                            0031
*         CALL FMTONE;              /* CREATE THE FSC.       @Y30LB51*/
         BAL   @14,FMTONE                                          0032
*       ELSE                        /* NOT FMT 1 RECORD.     @Y30LB51*/
*         IF FORMATNO(3)='1'B THEN  /* IF FMT 2 RECORD       @Y30LB51*/
         B     @RC00031                                            0033
@RF00031 TM    FORMATNO(SENSEPTR),B'00100000'                      0033
         BNO   @RF00033                                            0033
*           CALL FMTTWO;            /* CREATE THE FSC.       @Y30LB51*/
         BAL   @14,FMTTWO                                          0034
*         ELSE                      /* NOT FMT 2 RECORD.     @Y30LB51*/
*           CALL DASDFIVE;          /* MUST BE FMT 5.        @Y30LB51*/
         B     @RC00033                                            0035
@RF00033 BAL   @14,DASDFIVE                                        0035
*     ELSE                          /* FSC NOT ZERO,         @Y30LB51*/
*       GENRETCD=REALDASD;          /* FSC ALREADY GENERATED @ZA05080*/
         B     @RC00030                                            0036
@RF00030 LA    GENRETCD,2                                          0036
*   ELSE                            /* NOT SUBSYSTEM RECORD. @Y30LB51*/
*     IF INDEVTYP='R' THEN          /* IF REAL DASD RECORD   @Y30LB51*/
         B     @RC00029                                            0037
@RF00029 L     @10,SDA00PTR(,CVTPTR)                               0037
         CLI   INDEVTYP(@10),C'R'                                  0037
         BNE   @RF00037                                            0037
*       GENRETCD=REALDASD;          /* REJECT THE RECORD.    @Y30LB51*/
         LA    GENRETCD,2                                          0038
*     ELSE                          /* MUST BE VIRTUAL DASD, @Y30LB51*/
*       CALL DASDFIVE;              /* GO BUILD FSC.         @Y30LB51*/
         B     @RC00037                                            0039
@RF00037 BAL   @14,DASDFIVE                                        0039
*   END RECTYPE;                    /*                       @Y30LB51
*                                                                    */
@EL00002 DS    0H                                                  0040
@EF00002 DS    0H                                                  0040
@ER00002 L     @14,@SA00002                                        0040
         BR    @14                                                 0040
*FMTONE:                                                           0041
*   PROC OPTIONS(SAVE(14));         /*                       @Y30LB51*/
*                                                                  0041
FMTONE   ST    @14,12(,@13)                                        0041
*   /*****************************************************************/
*   /*                                                               */
*   /* THIS ROUTINE WILL CREATE THE FSC FOR A FORMAT ONE RECORD.     */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0042
*   IF CNTCHK='02'X THEN            /* IF MICROPROGRAM DETECTED ERROR
*                                      ONLY                  @Y30LB51*/
         CLI   CNTCHK(SENSEPTR),X'02'                              0042
         BNE   @RF00042                                            0042
*     DO;                           /* CREATE FSC 23XX.      @Y30LB51*/
*       FSCCODE='23'X;              /*                       @Y30LB51*/
         MVI   FSCCODE,X'23'                                       0044
*       FSCBYTE=ERRBYTE;            /* XX = BYTE 23          @Y30LB51*/
         MVC   FSCBYTE(1),ERRBYTE(SENSEPTR)                        0045
*     END;                          /*                       @Y30LB51*/
*   ELSE                            /* NOT MICROPROGRAM DETECTED   0047
*                                      ERROR.                @Y30LB51*/
*     IF CNTCHK='08'X THEN          /* IF CTRL INFC CHECK    @Y30LB51*/
         B     @RC00042                                            0047
@RF00042 CLI   CNTCHK(SENSEPTR),X'08'                              0047
         BNE   @RF00047                                            0047
*       IF CHNCHK(1)='0'B THEN      /* AND IF NOT TAG ERROR  @Y30LB51*/
         TM    CHNCHK(SENSEPTR),B'10000000'                        0048
         BNZ   @RF00048                                            0048
*         DO;                       /* CREATE FSC = 20XX.    @Y30LB51*/
*           FSCCODE='20'X;          /*                       @Y30LB51*/
         MVI   FSCCODE,X'20'                                       0050
*           FSCBYTE=CHNCHK;         /* XX = BYTE 20          @Y30LB51*/
         MVC   FSCBYTE(1),CHNCHK(SENSEPTR)                         0051
*         END;                      /*                       @Y30LB51*/
*       ELSE                        /* TAG ERROR BIT ON,     @Y30LB51*/
*         DO;                       /* CREATE FSC = 21XX.    @Y30LB51*/
         B     @RC00048                                            0053
@RF00048 DS    0H                                                  0054
*           FSCCODE='21'X;          /*                       @Y30LB51*/
         MVI   FSCCODE,X'21'                                       0054
*           FSCBYTE=CHNCHK2;        /* XX = BYTE 21          @Y30LB51*/
         MVC   FSCBYTE(1),CHNCHK2(SENSEPTR)                        0055
*         END;                      /*                       @Y30LB51*/
*     ELSE                          /* NOT CTRL INFC CHECK.  @Y30LB51*/
*       IF CNTCHK^='00'X THEN       /* IF CONTROL CHECK      @Y30LB51*/
         B     @RC00047                                            0057
@RF00047 CLI   CNTCHK(SENSEPTR),X'00'                              0057
         BE    @RF00057                                            0057
*         DO;                       /* CREATE FSC = 22XX.    @Y30LB51*/
*           FSCCODE='22'X;          /*                       @Y30LB51*/
         MVI   FSCCODE,X'22'                                       0059
*           FSCBYTE=CNTCHK;         /* XX = BYTE 15          @Y30LB51*/
         MVC   FSCBYTE(1),CNTCHK(SENSEPTR)                         0060
*         END;                      /*                       @Y30LB51*/
*       ELSE                        /* NOT CONTROL CHECK.    @Y30LB51*/
*         FSCBUILD=''B;             /* CREATE ZERO FSC.      @Y30LB51*/
         B     @RC00057                                            0062
@RF00057 XC    FSCBUILD(2),FSCBUILD                                0062
*   FSCMSC=FSCBUILD;                /* PUT FSC IN RECORD.    @Y30LB51*/
@RC00057 DS    0H                                                  0063
@RC00047 DS    0H                                                  0063
@RC00042 MVC   FSCMSC(2,SENSEPTR),FSCBUILD                         0063
*   END FMTONE;                     /*                       @Y30LB51
*                                                                    */
@EL00003 DS    0H                                                  0064
@EF00003 DS    0H                                                  0064
@ER00003 L     @14,12(,@13)                                        0064
         BR    @14                                                 0064
*FMTTWO:                                                           0065
*   PROC OPTIONS(SAVE(14));         /*                       @Y30LB51*/
*                                                                  0065
FMTTWO   ST    @14,12(,@13)                                        0065
*   /*****************************************************************/
*   /*                                                               */
*   /* THIS ROUTINE WILL CREATE THE FSC FOR A FORMAT TWO RECORD.     */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0066
*   IF ERRLAT1(2)='1'B THEN         /* IF CLOCK BIT ON       @Y30LB51*/
         TM    ERRLAT1(SENSEPTR),B'01000000'                       0066
         BNO   @RF00066                                            0066
*     DO;                           /* CREATE FSC = 31XX.    @Y30LB51*/
*       FSCCODE='31'X;              /*                       @Y30LB51*/
         MVI   FSCCODE,X'31'                                       0068
*       FSCBYTE=ERRLAT1;            /* XX = BYTE 24          @Y30LB51*/
         MVC   FSCBYTE(1),ERRLAT1(SENSEPTR)                        0069
*     END;                          /*                       @Y30LB51*/
*   ELSE                            /* NOT CLOCK ERROR.      @Y30LB51*/
*     IF ERRLAT2='00'X THEN         /* IF ERROR LATCH = ZERO @Y30LB51*/
         B     @RC00066                                            0071
@RF00066 CLI   ERRLAT2(SENSEPTR),X'00'                             0071
         BNE   @RF00071                                            0071
*       IF(ERRLAT1='00'X)×(ERRLAT1='80'X) THEN/* IF ERROR LATCH 1 IS
*                                      '00' OR '80'          @ZA00692*/
         CLI   ERRLAT1(SENSEPTR),X'00'                             0072
         BE    @RT00072                                            0072
         CLI   ERRLAT1(SENSEPTR),X'80'                             0072
         BNE   @RF00072                                            0072
@RT00072 DS    0H                                                  0073
*         DO;                       /* CREATE FSC = 39XX.    @Y30LB51*/
*           FSCCODE='39'X;          /*                       @Y30LB51*/
         MVI   FSCCODE,X'39'                                       0074
*           FSCBYTE=SUBFMTMG;       /* XX = BYTE 11          @Y30LB51*/
         MVC   FSCBYTE(1),SUBFMTMG(SENSEPTR)                       0075
*         END;                      /*                       @Y30LB51*/
*       ELSE                        /* ERROR LATCH 1 NOT 00 OR 08. 0077
*                                                            @Y30LB51*/
*         IF ERRLAT1(1)='1'B THEN   /* IF ERROR LATCH 1 BIT 0 ON   0077
*                                                            @Y30LB51*/
         B     @RC00072                                            0077
@RF00072 TM    ERRLAT1(SENSEPTR),B'10000000'                       0077
         BNO   @RF00077                                            0077
*           DO;                     /* CREATE FSC = 33XX.    @Y30LB51*/
*             FSCCODE='33'X;        /*                       @Y30LB51*/
         MVI   FSCCODE,X'33'                                       0079
*             FSCBYTE=ERRLAT1;      /* XX = BYTE 24          @Y30LB51*/
         MVC   FSCBYTE(1),ERRLAT1(SENSEPTR)                        0080
*           END;                    /*                       @Y30LB51*/
*         ELSE                      /* ERROR LATCH 1 BIT 0 OFF.    0082
*                                                            @Y30LB51*/
*           DO;                     /* CREATE FSC = 35XX.    @Y30LB51*/
         B     @RC00077                                            0082
@RF00077 DS    0H                                                  0083
*             FSCCODE='35'X;        /*                       @Y30LB51*/
         MVI   FSCCODE,X'35'                                       0083
*             FSCBYTE=ERRLAT1;      /* XX = BYTE 24          @Y30LB51*/
         MVC   FSCBYTE(1),ERRLAT1(SENSEPTR)                        0084
*           END;                    /*                       @Y30LB51*/
*     ELSE                          /* ERROR LATCH 2 NOT ZERO.     0086
*                                                            @Y30LB51*/
*       IF ERRLAT1(1)='1'B THEN     /* IF ERROR LATCH 1 BIT 1 ON   0086
*                                                            @Y30LB51*/
         B     @RC00071                                            0086
@RF00071 TM    ERRLAT1(SENSEPTR),B'10000000'                       0086
         BNO   @RF00086                                            0086
*         DO;                       /* CREATE FSC = 32XX.    @Y30LB51*/
*           FSCCODE='32'X;          /*                       @Y30LB51*/
         MVI   FSCCODE,X'32'                                       0088
*           FSCBYTE=ERRLAT2;        /* XX = BYTE 25          @Y30LB51*/
         MVC   FSCBYTE(1),ERRLAT2(SENSEPTR)                        0089
*         END;                      /*                       @Y30LB51*/
*       ELSE                        /* ERROR LATCH 1 BIT 1 OFF.    0091
*                                                            @Y30LB51*/
*         DO;                       /* CREATE FSC = 34XX.    @Y30LB51*/
         B     @RC00086                                            0091
@RF00086 DS    0H                                                  0092
*           FSCCODE='34'X;          /*                       @Y30LB51*/
         MVI   FSCCODE,X'34'                                       0092
*           FSCBYTE=ERRLAT2;        /* XX = BYTE 25          @Y30LB51*/
         MVC   FSCBYTE(1),ERRLAT2(SENSEPTR)                        0093
*         END;                      /*                       @Y30LB51*/
*   FSCMSC=FSCBUILD;                /* PUT FSC IN RECORD.    @Y30LB51*/
@RC00086 DS    0H                                                  0095
@RC00071 DS    0H                                                  0095
@RC00066 MVC   FSCMSC(2,SENSEPTR),FSCBUILD                         0095
*   END FMTTWO;                     /*                       @Y30LB51
*                                                                    */
@EL00004 DS    0H                                                  0096
@EF00004 DS    0H                                                  0096
@ER00004 L     @14,12(,@13)                                        0096
         BR    @14                                                 0096
*DASDFIVE:                                                         0097
*   PROC OPTIONS(SAVE(14));         /*                       @Y30LB51*/
*                                                                  0097
DASDFIVE ST    @14,@SA00005                                        0097
*   /*****************************************************************/
*   /*                                                               */
*   /* THIS ROUTINE WILL CREATE THE FSC FOR A FORMAT 5 OR HOST DASD  */
*   /* RECORD.                                                       */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0098
*   IF INDEVTYP='S' THEN            /* IF FMT 5 RECORD       @Y30LB51*/
         L     @10,SDA00PTR(,CVTPTR)                               0098
         CLI   INDEVTYP(@10),C'S'                                  0098
         BNE   @RF00098                                            0098
*     SENSEPTR=SENSEPTR+4;          /* ADJUST POINTER.       @Y30LB51*/
         AH    SENSEPTR,@CH00105                                   0099
*   ELSE                                                           0100
*     ;                             /* DASD RECORD.          @Y30LB51*/
@RF00098 DS    0H                                                  0101
*   IF FSCAREA=0 THEN               /* IF FSC IS ZERO        @Y30LB51*/
         ICM   @10,3,FSCAREA(SENSEPTR)                             0101
         BNZ   @RF00101                                            0101
*     DO;                           /* CREATE THE FSC.       @Y30LB51*/
*       WORKBYTE=FMTMSG;            /* GET SUBFMT AND MSG CODE     0103
*                                                            @Y30LB51*/
         MVC   WORKBYTE(1),FMTMSG(SENSEPTR)                        0103
*       WORKBYTE=WORKBYTE&FMTMASK;  /* AND ISOLATE SUBFMT.   @Y30LB51*/
         NI    WORKBYTE,X'F0'                                      0104
*       IF WORKBYTE='00'X THEN      /* IF SUBFMT 0 RECORD    @Y30LB51*/
         CLI   WORKBYTE,X'00'                                      0105
         BNE   @RF00105                                            0105
*         DO;                       /* CREATE FSC = 09XX.    @Y30LB51*/
*           FSCCODE='09'X;          /*                       @Y30LB51*/
         MVI   FSCCODE,X'09'                                       0107
*           FSCBYTE=FMTMSG;         /* XX = BYTE 7           @Y30LB51*/
         MVC   FSCBYTE(1),FMTMSG(SENSEPTR)                         0108
*         END;                      /*                       @Y30LB51*/
*       ELSE                        /* NOT SUBFMT 0 RECORD.  @Y30LB51*/
*         IF WORKBYTE='20'X THEN    /* IF SUBFMT 2 RECORD    @Y30LB51*/
         B     @RC00105                                            0110
@RF00105 CLI   WORKBYTE,X'20'                                      0110
         BNE   @RF00110                                            0110
*           CALL SUBFMT2;           /* CREATE THE FSC.       @Y30LB51*/
         BAL   @14,SUBFMT2                                         0111
*         ELSE                      /* SUBFMT 3 RECORD,      @Y30LB51*/
*           CALL SUBFMT3;           /* CREATE THE FSC.       @Y30LB51*/
         B     @RC00110                                            0112
@RF00110 BAL   @14,SUBFMT3                                         0112
*       FSCAREA=FSCBUILD;           /* PUT FSC IN RECORD.    @Y30LB51*/
@RC00110 DS    0H                                                  0113
@RC00105 MVC   FSCAREA(2,SENSEPTR),FSCBUILD                        0113
*     END;                          /*                       @Y30LB51*/
*   ELSE                            /* FSC NOT ZERO.         @Y30LB51*/
*     GENRETCD=REALDASD;            /* FSC ALREADY GENERATED @ZA05080*/
         B     @RC00101                                            0115
@RF00101 LA    GENRETCD,2                                          0115
*   END DASDFIVE;                   /*                       @Y30LB51
*                                                                    */
@EL00005 DS    0H                                                  0116
@EF00005 DS    0H                                                  0116
@ER00005 L     @14,@SA00005                                        0116
         BR    @14                                                 0116
*SUBFMT2:                                                          0117
*   PROC OPTIONS(SAVE(14));         /*                       @Y30LB51*/
*                                                                  0117
SUBFMT2  ST    @14,12(,@13)                                        0117
*   /*****************************************************************/
*   /*                                                               */
*   /* THIS ROUTINE WILL CREATE THE FSC FOR A SUBFORMAT TWO RECORD.  */
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0118
*   IF BYTE11='00'X THEN            /* IF BYTE 11 IS ZERO    @Y30LB51*/
         CLI   BYTE11(SENSEPTR),X'00'                              0118
         BNE   @RF00118                                            0118
*     DO;                           /* CREATE FSC '29XX'.    @Y30LB51*/
*       FSCCODE='29'X;              /*                       @Y30LB51*/
         MVI   FSCCODE,X'29'                                       0120
*       FSCBYTE=FMTMSG;             /* XX = BYTE 7           @Y30LB51*/
         MVC   FSCBYTE(1),FMTMSG(SENSEPTR)                         0121
*     END;                          /*                       @Y30LB51*/
*   ELSE                            /* BYTE 11 IS NOT ZERO.  @Y30LB51*/
*     IF BYTE11='08'X THEN          /* IF BYTE 11 IS '08'    @Y30LB51*/
         B     @RC00118                                            0123
@RF00118 CLI   BYTE11(SENSEPTR),X'08'                              0123
         BNE   @RF00123                                            0123
*       DO;                         /* CREATE FSC '21XX'.    @Y30LB51*/
*         FSCCODE='21'X;            /*                       @Y30LB51*/
         MVI   FSCCODE,X'21'                                       0125
*         FSCBYTE=BYTE20;           /* XX = BYTE 20          @Y30LB51*/
         MVC   FSCBYTE(1),BYTE20(SENSEPTR)                         0126
*       END;                        /*                       @Y30LB51*/
*     ELSE                          /* BYTE 11 IS NOT ZERO.  @Y30LB51*/
*       DO;                         /* CREATE FSC '22XX'.    @Y30LB51*/
         B     @RC00123                                            0128
@RF00123 DS    0H                                                  0129
*         FSCCODE='22'X;            /*                       @Y30LB51*/
         MVI   FSCCODE,X'22'                                       0129
*         FSCBYTE=BYTE11;           /* XX = BYTE 11          @Y30LB51*/
         MVC   FSCBYTE(1),BYTE11(SENSEPTR)                         0130
*       END;                        /*                       @Y30LB51*/
*   END SUBFMT2;                    /*                       @Y30LB51
*                                                                    */
@EL00006 DS    0H                                                  0132
@EF00006 DS    0H                                                  0132
@ER00006 L     @14,12(,@13)                                        0132
         BR    @14                                                 0132
*SUBFMT3:                                                          0133
*   PROC OPTIONS(SAVE(14));         /*                       @Y30LB51*/
*                                                                  0133
SUBFMT3  ST    @14,12(,@13)                                        0133
*   /*****************************************************************/
*   /*                                                               */
*   /* THIS ROUTINE WILL CREATE THE FSC FOR A SUBFORMAT THREE RECORD.*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0134
*   IF CLOCKERR='1'B THEN           /* IF BIT 1 BYTE 10 IS ON      0134
*                                                            @Y30LB51*/
         TM    CLOCKERR(SENSEPTR),B'01000000'                      0134
         BNO   @RF00134                                            0134
*     DO;                           /* CREATE FSC '31XX'.    @Y30LB51*/
*       FSCCODE='31'X;              /*                       @Y30LB51*/
         MVI   FSCCODE,X'31'                                       0136
*       FSCBYTE=BYTE10;             /* XX = BYTE 10          @Y30LB51*/
         MVC   FSCBYTE(1),BYTE10(SENSEPTR)                         0137
*     END;                          /*                       @Y30LB51*/
*   ELSE                            /* BIT 1 BYTE 10 IS OFF. @Y30LB51*/
*     IF BYTE11='00'X THEN          /* IF BYTE 11 IS ZERO    @Y30LB51*/
         B     @RC00134                                            0139
@RF00134 CLI   BYTE11(SENSEPTR),X'00'                              0139
         BNE   @RF00139                                            0139
*       IF(BYTE10='00'X)×(BYTE10='80'X) THEN/* AND IF BYTE 10 IS ZERO
*                                      OR '80'               @Y30LB51*/
         CLI   BYTE10(SENSEPTR),X'00'                              0140
         BE    @RT00140                                            0140
         CLI   BYTE10(SENSEPTR),X'80'                              0140
         BNE   @RF00140                                            0140
@RT00140 DS    0H                                                  0141
*         DO;                       /* CREATE FSC '39XX'.    @Y30LB51*/
*           FSCCODE='39'X;          /*                       @Y30LB51*/
         MVI   FSCCODE,X'39'                                       0142
*           FSCBYTE=FMTMSG;         /* XX = BYTE 7           @Y30LB51*/
         MVC   FSCBYTE(1),FMTMSG(SENSEPTR)                         0143
*         END;                      /*                       @Y30LB51*/
*       ELSE                        /* BYTE 10 NOT ZERO OR '08'.   0145
*                                                            @Y30LB51*/
*         IF TIMEBIT='1'B THEN      /* IF BIT 0 BYTE 10 IS ON      0145
*                                                            @Y30LB51*/
         B     @RC00140                                            0145
@RF00140 TM    TIMEBIT(SENSEPTR),B'10000000'                       0145
         BNO   @RF00145                                            0145
*           DO;                     /* CREATE FSC '33XX'.    @Y30LB51*/
*             FSCCODE='33'X;        /*                       @Y30LB51*/
         MVI   FSCCODE,X'33'                                       0147
*             FSCBYTE=BYTE10;       /* XX = BYTE 10          @Y30LB51*/
         MVC   FSCBYTE(1),BYTE10(SENSEPTR)                         0148
*           END;                    /*                       @Y30LB51*/
*         ELSE                      /* BIT 0, BYTE 10 IS OFF.      0150
*                                                            @Y30LB51*/
*           DO;                     /* CREATE FSC '35XX'.    @Y30LB51*/
         B     @RC00145                                            0150
@RF00145 DS    0H                                                  0151
*             FSCCODE='35'X;        /*                       @Y30LB51*/
         MVI   FSCCODE,X'35'                                       0151
*             FSCBYTE=BYTE10;       /* XX = BYTE 10          @Y30LB51*/
         MVC   FSCBYTE(1),BYTE10(SENSEPTR)                         0152
*           END;                    /*                       @Y30LB51*/
*     ELSE                          /* BYTE 11 IS NOT ZERO.  @Y30LB51*/
*       IF TIMEBIT='1'B THEN        /* IF BIT 0 BYTE 10 IS ON      0154
*                                                            @Y30LB51*/
         B     @RC00139                                            0154
@RF00139 TM    TIMEBIT(SENSEPTR),B'10000000'                       0154
         BNO   @RF00154                                            0154
*         DO;                       /* CREATE FSC '32XX'.    @Y30LB51*/
*           FSCCODE='32'X;          /*                       @Y30LB51*/
         MVI   FSCCODE,X'32'                                       0156
*           FSCBYTE=BYTE11;         /* XX = BYTE 11          @Y30LB51*/
         MVC   FSCBYTE(1),BYTE11(SENSEPTR)                         0157
*         END;                      /*                       @Y30LB51*/
*       ELSE                        /* BIT 0, BYTE 10 IS OFF.      0159
*                                                            @Y30LB51*/
*         DO;                       /* CREATE FSC '34XX'.    @Y30LB51*/
         B     @RC00154                                            0159
@RF00154 DS    0H                                                  0160
*           FSCCODE='34'X;          /*                       @Y30LB51*/
         MVI   FSCCODE,X'34'                                       0160
*           FSCBYTE=BYTE11;         /* XX = BYTE 11          @Y30LB51*/
         MVC   FSCBYTE(1),BYTE11(SENSEPTR)                         0161
*         END;                      /*                       @Y30LB51*/
*   END SUBFMT3;                    /*                       @Y30LB51
*                                                                    */
@EL00007 DS    0H                                                  0163
@EF00007 DS    0H                                                  0163
@ER00007 L     @14,12(,@13)                                        0163
         BR    @14                                                 0163
*   END ISDAGEN0                    /*                       @Y30LB51*/
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.      *
*/*%INCLUDE SYSLIB  (ISDACVT )                                        *
*/*%INCLUDE SYSLIB  (ISDAPRMS)                                        *
*/*%INCLUDE SYSLIB  (ISDAWORK)                                        *
*/*%INCLUDE SYSLIB  (ISDAMSCS)                                        *
*;                                                                 0164
@DATA    DS    0H
@CH00101 DC    H'2'
@CH00105 DC    H'4'
@DATD    DSECT
         DS    0F
@SA00001 DS    18F
@PC00001 DS    1F
@SA00002 DS    1F
@SA00005 DS    1F
ISDAGEN0 CSECT
         DS    0F
@DATD    DSECT
         DS    0D
FSCBUILD DS    CL2
         ORG   FSCBUILD
FSCCODE  DS    CL1
FSCBYTE  DS    CL1
         ORG   FSCBUILD+2
WORKBYTE DS    BL1
         ORG   *+1-(*-@DATD)/(*-@DATD) INSURE DSECT DATA
@ENDDATD EQU   *
ISDAGEN0 CSECT
         NOPR  ((@ENDDATD-@DATD)/161*16)
         DS    0F
@SIZDATD DC    AL1(0)
         DC    AL3(@ENDDATD-@DATD)
@CV00160 DC    V(ISDAFREE)
@CV00159 DC    V(ISDAGET1)
         DS    0D
PATCH    DS    CL50
         ORG   PATCH
@NM00003 DC    50X'00'
         ORG   PATCH+50
@00      EQU   00                      EQUATES FOR REGISTERS 0-15
@01      EQU   01
@02      EQU   02
@03      EQU   03
@04      EQU   04
@05      EQU   05
@06      EQU   06
@07      EQU   07
@08      EQU   08
@09      EQU   09
@10      EQU   10
@11      EQU   11
@12      EQU   12
@13      EQU   13
@14      EQU   14
@15      EQU   15
SENSEPTR EQU   @03
LOGPTR   EQU   @03
GENRETCD EQU   @04
LPARMPTR EQU   @05
CVTPTR   EQU   @02
RF       EQU   @15
ISDACVT  EQU   0
CVTPTRS0 EQU   ISDACVT
DATAPTR  EQU   CVTPTRS0
SDATAPTR EQU   CVTPTRS0+4
PARMPTR  EQU   CVTPTRS0+8
SDA00PTR EQU   CVTPTRS0+12
GET0CALL EQU   ISDACVT+100
SPNOLEN  EQU   GET0CALL
HEXPCALL EQU   ISDACVT+108
PRT0CALL EQU   ISDACVT+120
OUTLINE  EQU   PRT0CALL
SDADATD  EQU   ISDACVT+256
PRTDATD  EQU   ISDACVT+416
ISDAPRMS EQU   0
CINPUT   EQU   ISDAPRMS
CSTART   EQU   ISDAPRMS+2
CEND     EQU   ISDAPRMS+6
CFSCONLY EQU   ISDAPRMS+13
CSSIDF   EQU   ISDAPRMS+17
CSERIAL  EQU   ISDAPRMS+21
CREPORTS EQU   ISDAPRMS+33
ISDAWORK EQU   0
INFLAGS  EQU   ISDAWORK
INDEVTYP EQU   INFLAGS+2
SDAFLAG0 EQU   INFLAGS+3
INRECCUA EQU   ISDAWORK+6
ISDAMSCS EQU   0
SUBSYSID EQU   ISDAMSCS+1
SSID     EQU   SUBSYSID
FORMATNO EQU   ISDAMSCS+3
SUBSENSE EQU   ISDAMSCS+4
SUBFMTMG EQU   SUBSENSE+7
MSCRECD  EQU   0
CNTCHK   EQU   MSCRECD+15
CHNCHK   EQU   MSCRECD+20
CHNCHK2  EQU   MSCRECD+21
ERRBYTE  EQU   MSCRECD+23
ERRLAT1  EQU   MSCRECD+24
ERRLAT2  EQU   MSCRECD+25
FSCMSC   EQU   MSCRECD+26
DASDREC  EQU   0
FMTMSG   EQU   DASDREC+7
BYTE10   EQU   DASDREC+10
TIMEBIT  EQU   BYTE10
CLOCKERR EQU   BYTE10
BYTE11   EQU   DASDREC+11
BYTE20   EQU   DASDREC+20
FSCAREA  EQU   DASDREC+22
WORKPTR  EQU   0
*                                      START UNREFERENCED COMPONENTS
@NM00016 EQU   DASDREC+24
@NM00015 EQU   DASDREC+21
@NM00014 EQU   DASDREC+12
@NM00013 EQU   BYTE10
@NM00012 EQU   DASDREC+8
MESSAGE  EQU   FMTMSG
FORMAT   EQU   FMTMSG
@NM00011 EQU   DASDREC
@NM00010 EQU   MSCRECD+28
@NM00009 EQU   MSCRECD+22
@NM00008 EQU   MSCRECD+16
@NM00007 EQU   MSCRECD
SANOMSCD EQU   SUBSENSE+27
RCYLMSCD EQU   SUBSENSE+25
RUAMSCD  EQU   SUBSENSE+24
MSCFSC   EQU   SUBSENSE+22
@NM00006 EQU   SUBSENSE+21
RUADASD  EQU   SUBSENSE+20
DASDFSC  EQU   SUBSENSE+18
@NM00005 EQU   SUBSENSE+8
MSGCODEN EQU   SUBFMTMG
SUBFMTNO EQU   SUBFMTMG
SALOWAD2 EQU   SUBSENSE+6
SARETRY  EQU   SUBSENSE+5
@NM00004 EQU   SUBSENSE+4
DASDFMTN EQU   SUBSENSE+3
SALOWADD EQU   SUBSENSE+2
SUBSTAT5 EQU   SUBSENSE+1
SUBSTAT4 EQU   SUBSENSE
SSIDDEVT EQU   SSID+1
SSIDLIBN EQU   SSID+1
SSIDTYPE EQU   SSID
SSIDFLAG EQU   SUBSYSID
STATUS   EQU   ISDAMSCS
DEVPTR   EQU   ISDAWORK+16
NOUTREC  EQU   ISDAWORK+12
NINREC   EQU   ISDAWORK+8
CUABYTE1 EQU   INRECCUA+1
CUABYTE0 EQU   INRECCUA
DLENGTH  EQU   ISDAWORK+4
INSOURCE EQU   INFLAGS+1
IRECTYPE EQU   INFLAGS
CTRACE   EQU   ISDAPRMS+48
CGEN     EQU   ISDAPRMS+47
CDETAIL  EQU   ISDAPRMS+46
CPERIOD  EQU   ISDAPRMS+45
CPWR     EQU   CREPORTS+11
CAPRSUU  EQU   CREPORTS+10
CDRC     EQU   CREPORTS+9
CDAT     EQU   CREPORTS+8
CCSBCSF  EQU   CREPORTS+7
CDCKTLX  EQU   CREPORTS+6
CEQC     EQU   CREPORTS+5
CFSC     EQU   CREPORTS+4
CDHEDHU  EQU   CREPORTS+3
CSUM     EQU   CREPORTS+2
CPAD     EQU   CREPORTS+1
CDCS     EQU   CREPORTS
CSERNO   EQU   CSERIAL+4
@NM00002 EQU   CSERIAL+3
CIBM     EQU   CSERIAL
CRATIO   EQU   ISDAPRMS+19
CSSID    EQU   CSSIDF
@NM00001 EQU   CSSIDF
CFSC34   EQU   CFSCONLY+2
CFSC12   EQU   CFSCONLY
CTYPE    EQU   ISDAPRMS+11
CSUMMARY EQU   ISDAPRMS+10
CENDDAY  EQU   CEND+2
CENDYEAR EQU   CEND
CSTDAY   EQU   CSTART+2
CSTYEAR  EQU   CSTART
CHISTIN  EQU   CINPUT+1
CLOGIN   EQU   CINPUT
PRTSA001 EQU   PRTDATD
SDATEMPS EQU   SDADATD+136
SDASA002 EQU   SDADATD+76
SDAPC001 EQU   SDADATD+72
SDASA001 EQU   SDADATD
SDARPTID EQU   PRT0CALL+133
LINE     EQU   OUTLINE+1
ANSI     EQU   OUTLINE
DUMPIDNO EQU   HEXPCALL+8
DUMPLEN  EQU   HEXPCALL+4
DUMPADDR EQU   HEXPCALL
COREADDR EQU   GET0CALL+4
CORELEN  EQU   SPNOLEN+1
SPNO     EQU   SPNOLEN
WORKCALL EQU   CVTPTRS0+96
GEN00PTR EQU   CVTPTRS0+92
CNFG0PTR EQU   CVTPTRS0+88
PWR00PTR EQU   CVTPTRS0+84
APR00PTR EQU   CVTPTRS0+80
DRC00PTR EQU   CVTPTRS0+76
DAT00PTR EQU   CVTPTRS0+72
CSB00PTR EQU   CVTPTRS0+68
DCK00PTR EQU   CVTPTRS0+64
EQC00PTR EQU   CVTPTRS0+60
FSC00PTR EQU   CVTPTRS0+56
DHE00PTR EQU   CVTPTRS0+52
SUM00PTR EQU   CVTPTRS0+48
PAD00PTR EQU   CVTPTRS0+44
DCS00PTR EQU   CVTPTRS0+40
LOG00PTR EQU   CVTPTRS0+36
HIST0PTR EQU   CVTPTRS0+32
PRT00PTR EQU   CVTPTRS0+28
GET00PTR EQU   CVTPTRS0+24
TYPE0PTR EQU   CVTPTRS0+20
PARM0PTR EQU   CVTPTRS0+16
*                                      END UNREFERENCED COMPONENTS
@RC00037 EQU   @EL00002
@RC00029 EQU   @EL00002
@RC00048 EQU   @RC00047
@RC00077 EQU   @RC00071
@RC00072 EQU   @RC00071
@RC00101 EQU   @EL00005
@RC00123 EQU   @EL00006
@RC00118 EQU   @EL00006
@RC00154 EQU   @EL00007
@RC00139 EQU   @EL00007
@RC00134 EQU   @EL00007
@RC00030 EQU   @RC00029
@RC00145 EQU   @RC00139
@RC00140 EQU   @RC00139
@RC00033 EQU   @RC00030
@RC00031 EQU   @RC00030
@ENDDATA EQU   *
         END   ISDAGEN0,(C'PLS1839',0603,75268)

         TITLE 'ICBVMS00 - OCT 9, 1974 MVS                             *
                        '
ICBVMS00 CSECT ,                                                   0001
@MAINENT DS    0H                                                  0001
         USING *,@15                                               0001
         B     @PROLOG                                             0001
         DC    AL2(@EP00001-@MAINENT)
         DC    AL1(16)                                             0001
         DC    C'ICBVMS00  76.348'                                 0001
ICBVUCIR DS    0H                                                  0001
         USING *,@15                                               0001
         B     @PROLOG                                             0001
         DC    AL2(@EP01495-ICBVUCIR)
         ENTRY ICBVUCIR
ICBVUBVR DS    0H                                                  0001
         USING *,@15                                               0001
         B     @PROLOG                                             0001
         DC    AL2(@EP01677-ICBVUBVR)
         ENTRY ICBVUBVR
         DROP  @15
@PROLOG  STM   @14,@12,12(@13)                                     0001
         BALR  @12,0                                               0001
@PSTART  LA    @11,4095(,@12)                                      0001
         LA    @10,4095(,@11)                                      0001
         LA    @09,4095(,@10)                                      0001
         USING @PSTART,@12                                         0001
         USING @PSTART+4095,@11                                    0001
         USING @PSTART+8190,@10                                    0001
         USING @PSTART+12285,@09                                   0001
         ST    @13,@SA00001+4                                      0001
         LA    @14,@SA00001                                        0001
         ST    @14,8(,@13)                                         0001
         LR    @13,@14                                             0001
         AH    @15,4(,@15)                                         0001
         BR    @15                                                 0001
@EP00001 DS    0H                                                  0002
*   RPLVPTR=RG1;                    /* ADDR TO REQUEST BLK   @Y30LB25*/
         LR    RPLVPTR,RG1                                         0113
*   RESPECIFY                                                      0114
*     RG1 UNRSTD;                   /* FREE REG1             @Y30LB25*/
*   VVIPTR=RPLVVICB;                /* ADDR TO MSVCB         @Y30LB25*/
         L     VVIPTR,RPLVVICB(,RPLVPTR)                           0115
*   MESGPTR=ADDR(RPLVUTIL);         /* ADDR TO MSC MSG       @Y30LB25*/
         LA    MESGPTR,RPLVUTIL(,RPLVPTR)                          0116
*   GROUPPTR=ADDR(GROUPBUF);        /* ADDR GRP BUF          @Y30LB25*/
         LA    @08,GROUPBUF                                        0117
         ST    @08,GROUPPTR                                        0117
*   COPYVPTR=ADDR(COPYBUF);         /* ADDR CVR BUF          @Y30LB25*/
         LA    COPYVPTR,COPYBUF                                    0118
*   BASEVPTR=ADDR(BASEBUF);         /* ADDR BVR BUF          @Y30LB25*/
         LA    @08,BASEBUF                                         0119
         ST    @08,BASEVPTR                                        0119
*   INDEXPTR=ADDR(INDEXBUF);        /* ADDR CIR BUF          @Y30LB25*/
         LA    INDEXPTR,INDEXBUF                                   0120
*   DUPVPTR=ADDR(DUPVBUF);          /* ADDR DUP BUF          @Y30LB25*/
         LA    @08,DUPVBUF                                         0121
         ST    @08,DUPVPTR                                         0121
*   WORKAREA=WORKAREA&&WORKAREA;    /* ZERO WORK AREA        @Y30LB25*/
         XC    WORKAREA(19),WORKAREA                               0122
*   MSGTCODE=I;                     /* INVENTORY ERROR       @Y30LB25*/
         MVI   MSGTCODE,C'I'                                       0123
*   DIDKY=FIXONE;                   /* SET DVR KEY ID        @Y30LB25*/
         MVI   DIDKY,X'01'                                         0124
*   CIDKY=FIXONE;                   /* SET CVR KEY ID        @Y30LB25*/
         MVI   CIDKY,X'01'                                         0125
*                                                                  0126
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR MSVC DISABLED                               @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0126
*   IF VVIFLG0=ON                   /* MSVC DISABLED?        @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
         TM    VVIFLG0(VVIPTR),B'10000000'                         0126
         BNO   @RF00126                                            0126
*     DO;                           /* NOTIFY LIBRARIAN      @Y30LB25*/
*       MSGTCODE=D;                 /* DISABLED              @Y30LB25*/
         MVI   MSGTCODE,C'D'                                       0128
*       CALL PLIBMSG;               /* OF MSC MESSAGE        @Y30LB25*/
         BAL   @14,PLIBMSG                                         0129
*       RETURN;                     /* RETURN TO ICBVCR00    @Y30LB25*/
@EL00001 L     @13,4(,@13)                                         0130
@EF00001 DS    0H                                                  0130
@ER00001 LM    @14,@12,12(@13)                                     0130
         BR    @14                                                 0130
*     END;                          /*                       @Y30LB25*/
*                                                                  0132
*   /*****************************************************************/
*   /*                                                               */
*   /* JOURNAL THE RPLV                                      @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0132
*   CALL PJRNL;                     /* JOURNAL THE RPLV      @Y30LB25*/
@RF00126 BAL   @14,PJRNL                                           0132
*   RPLVFLG=ON;                     /* RPLV JOURNALED        @Y30LB25*/
         OI    RPLVFLG,B'00000001'                                 0133
*                                                                  0134
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR MESSAGE ID (CODE) 04.                       @Y30LB25*/
*   /* IF CE CARTRIDGE IS INVOLVED, THEN RETURN.             @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0134
*   IF CODESM=CRTVOL                /* CREATE VOLUME MSG?    @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
         LA    @08,8                                               0134
         ALR   @08,MESGPTR                                         0134
         CLI   CODESM(@08),X'04'                                   0134
         BNE   @RF00134                                            0134
*     IF CECART=ON                  /* CE CART?              @Y30LB25*/
*       THEN                        /* YES                   @Y30LB25*/
         TM    CECART(@08),B'10000000'                             0135
         BO    @RT00135                                            0135
*       RETURN;                     /*                       @Y30LB25*/
*     ELSE                          /*                       @Y30LB25*/
*       DO;                         /* PROCESS MSC MSG       @Y30LB25*/
*         CALL PCRTVOL;             /* FOR CREATE VOL        @Y30LB25*/
         BAL   @14,PCRTVOL                                         0138
*         RETURN;                   /* RETURN TO ICBVCR00    @Y30LB25*/
         B     @EL00001                                            0139
*       END;                        /*                       @Y30LB25*/
*                                                                  0141
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR MESSAGE ID (CODE) 0A.                       @Y30LB25*/
*   /* IF CE CARTRIDGE IS INVOLVED, THEN RETURN.             @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0141
*   IF CODESM=ACTVOL                /* ACTIVATE VOL MSG?     @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
@RF00134 LA    @08,8                                               0141
         ALR   @08,MESGPTR                                         0141
         CLI   CODESM(@08),X'0A'                                   0141
         BNE   @RF00141                                            0141
*     IF CECART=ON                  /* CE CART?              @Y30LB25*/
*       THEN                        /* YES                   @Y30LB25*/
         TM    CECART(@08),B'10000000'                             0142
         BO    @RT00142                                            0142
*       RETURN;                     /*                       @Y30LB25*/
*     ELSE                          /*                       @Y30LB25*/
*       DO;                         /* PROCESS MSC MSG       @Y30LB25*/
*         CALL PACTVOL;             /* FOR ACTIVATE VOL      @Y30LB25*/
         BAL   @14,PACTVOL                                         0145
*         RETURN;                   /* RETURN TO ICBVCR00    @Y30LB25*/
         B     @EL00001                                            0146
*       END;                        /*                       @Y30LB25*/
*                                                                  0148
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR MESSAGE ID (CODE) 0D.                       @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0148
*   IF CODESM=CPYCRT                /* COPY CART. MSG?       @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
@RF00141 CLI   CODESM+8(MESGPTR),X'0D'                             0148
         BNE   @RF00148                                            0148
*     DO;                           /* PROCESS MSC MSG       @Y30LB25*/
*       CALL PCPYCRT;               /* FOR COPY CARTRIDGE    @Y30LB25*/
         BAL   @14,PCPYCRT                                         0150
*       RETURN;                     /* RETURN TO ICBVCR00    @Y30LB25*/
         B     @EL00001                                            0151
*     END;                          /*                       @Y30LB25*/
*                                                                  0153
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR MESSAGE ID (CODE) 83.                       @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0153
*   IF CODEUSM=CAS                  /* C.A.S. MSG?           @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
@RF00148 CLI   CODEUSM+8(MESGPTR),X'83'                            0153
         BNE   @RF00153                                            0153
*     DO;                           /* PROCESS MSC MSG       @Y30LB25*/
*       CALL PCAS;                  /* FOR C.A.S.            @Y30LB25*/
         BAL   @14,PCAS                                            0155
*       RETURN;                     /* RETURN TO ICBVCR00    @Y30LB25*/
         B     @EL00001                                            0156
*     END;                          /*                       @Y30LB25*/
*   ELSE                            /* WRONG MSG ID          @Y30LB25*/
*     RETURN;                       /*                       @Y30LB25*/
*                                                                  0159
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - PJRNL                                @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* FUNCTION - WRITE THE RPLV TO .MSVIJRNL.               @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* INPUT -                                               @Y30LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* OUTPUT -                                              @Y30LB25*/
*   /* ERROR RETURN/REASON CODE IN WORKAREA                  @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0159
*PJRNL:                             /*                       @Y30LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/
PJRNL    ST    @14,@SA00002                                        0159
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG0 RSTD;                     /* RESTRICT REG 0        @Y30LB25*/
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG0=RESEXVJL;                   /* RESERVE JRNL FLAG     @Y30LB25*/
         LA    RG0,17                                              0162
*   RG1=RPLVPTR;                    /* RPLV PTR              @Y30LB25*/
         LR    RG1,RPLVPTR                                         0163
*   CALL ICBVRR00;                  /* RESERVE JOURNNAL      @Y30LB25*/
         L     @15,@CV00611                                        0164
         BALR  @14,@15                                             0164
*   CALL ICBVJL00;                  /* JRNL THE RPLV         @Y30LB25*/
         L     @15,@CV00612                                        0165
         BALR  @14,@15                                             0165
*   RG0=DEQJRNL;                    /* RELEASE JRNL FLAG     @Y30LB25*/
         LA    RG0,16                                              0166
*   CALL ICBVRR00;                  /* RELEASE JOURNNAL      @Y30LB25*/
         L     @15,@CV00611                                        0167
         BALR  @14,@15                                             0167
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG0 UNRSTD;                   /* UNRESTRICT REG 0      @Y30LB25*/
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   RETURN;                         /*                       @Y30LB25*/
@EL00002 DS    0H                                                  0170
@EF00002 DS    0H                                                  0170
@ER00002 L     @14,@SA00002                                        0170
         BR    @14                                                 0170
*   END PJRNL;                      /*                       @Y30LB25*/
*                                                                  0172
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - PLIBMSG                              @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* FUNCTION - SEND A MESSAGE TO THE LIBRARIAN            @Y30LB25*/
*   /* INDICATING AN ERROR HAS OCCURRED AND THE INCLUDED     @Y30LB25*/
*   /* MSC MESSAGE DID NOT RESULT IN THE COMPLETE UPDATE     @Y30LB25*/
*   /* OF MSVC'S RECORDS.                                    @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* INPUT -                                               @Y30LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* OUTPUT -                                              @Y30LB25*/
*   /* MESSAGE DEFINITION PARAMETER LIST                     @Y30LB25*/
*   /* MESSAGE ID 412 TO THE LIBRARIAN                       @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0172
*PLIBMSG:                           /*                       @Y30LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/
PLIBMSG  ST    @14,@SA00003                                        0172
*   MSGRQ=MSGRQ&&MSGRQ;             /* ZERO MEG REQ BLK      @Y30LB25*/
         XC    MSGRQ(32),MSGRQ                                     0173
*   MSGID=VMSGID1;                  /* SET MSG ID NUMBER     @Y30LB25*/
         MVC   MSGID(4),@CF00584                                   0174
*   MSGTEXT1=ADDR(MSG412);          /* ADDR OF MSG           @Y30LB25*/
         LA    @08,MSG412                                          0175
         STCM  @08,7,MSGTEXT1                                      0175
*   MSGLEN1=LENGTH(MSG412);         /* LENGTH OF MSG         @Y30LB25*/
         MVI   MSGLEN1,X'34'                                       0176
*   MSGRPLV=RPLVPTR;                /* PTR TO RPLV           @Y30LB25*/
         ST    RPLVPTR,MSGRPLV                                     0177
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=ADDR(MSGRQ);                /* ADDR OF MSG BLK       @Y30LB25*/
*                                                                  0179
         LA    RG1,MSGRQ                                           0179
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR CREATE A VOLUME - NO CE CARTRIDGES          @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0180
*   IF CODESM=CRTVOL&CECART=OFF     /* CREATE VOL AND        @Y30LB25
*                                      NOT A CE CART?        @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
         LA    @08,8                                               0180
         ALR   @08,MESGPTR                                         0180
         CLI   CODESM(@08),X'04'                                   0180
         BNE   @RF00180                                            0180
         TM    CECART(@08),B'10000000'                             0180
         BNZ   @RF00180                                            0180
*     DO;                           /*                       @Y30LB25*/
*       IDMSG=CRTVOL1;              /* SET MSG ID            @Y30LB25*/
         MVC   IDMSG(2),@CC00555                                   0182
*       CSN1=CSN1SM;                /* CSN1                  @Y30LB25*/
         MVC   CSN1(12),CSN1SM(@08)                                0183
*       CSN2=CSN2SM;                /* CSN2                  @Y30LB25*/
         MVC   CSN2(12),CSN2SM(@08)                                0184
*       VOLID=VOLIDSM;              /* VOLID                 @Y30LB25*/
         MVC   VOLID(6),VOLIDSM(@08)                               0185
*       CALL ICBVOP00;              /* MSG TO LIBRARIAN      @Y30LB25*/
         L     @15,@CV00613                                        0186
         BALR  @14,@15                                             0186
*       RETURN;                     /*                       @Y30LB25*/
@EL00003 DS    0H                                                  0187
@EF00003 DS    0H                                                  0187
@ER00003 L     @14,@SA00003                                        0187
         BR    @14                                                 0187
*     END;                          /*                       @Y30LB25*/
*                                                                  0188
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR ACTIVE VOLUME - NO CE CARTRIDGE             @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0189
*   IF CODESM=ACTVOL&CECART=OFF     /* ACTIVE VOL AND        @Y30LB25
*                                      NOT A CE CART?        @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
@RF00180 LA    @08,8                                               0189
         ALR   @08,MESGPTR                                         0189
         CLI   CODESM(@08),X'0A'                                   0189
         BNE   @RF00189                                            0189
         TM    CECART(@08),B'10000000'                             0189
         BNZ   @RF00189                                            0189
*     DO;                           /*                       @Y30LB25*/
*       IDMSG=ACTVOL1;              /* SET MSG ID            @Y30LB25*/
         MVC   IDMSG(2),@CC00557                                   0191
*       CSN1=BLANK12;               /* CSN1 BLANK            @Y30LB25*/
         MVC   CSN1(12),@CC00572                                   0192
*       CSN2=BLANK12;               /* CSN2 BLANK            @Y30LB25*/
         MVC   CSN2(12),@CC00572                                   0193
*       VOLID=VOLIDSM;              /* VOLID                 @Y30LB25*/
         MVC   VOLID(6),VOLIDSM(@08)                               0194
*       CALL ICBVOP00;              /* MSG TO LIBRARIAN      @Y30LB25*/
         L     @15,@CV00613                                        0195
         BALR  @14,@15                                             0195
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00003                                            0196
*     END;                          /*                       @Y30LB25*/
*                                                                  0197
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR COPY CARTRIDGE                              @ZM30979*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0198
*   IF CODESM=CPYCRT                /* COPY CART             @ZM30979*/
*     THEN                          /* YES                   @Y30LB25*/
@RF00189 LA    @08,8                                               0198
         ALR   @08,MESGPTR                                         0198
         CLI   CODESM(@08),X'0D'                                   0198
         BNE   @RF00198                                            0198
*     DO;                           /*                       @Y30LB25*/
*       IDMSG=CPYVOL1;              /* SET MSG ID            @Y30LB25*/
         MVC   IDMSG(2),@CC00559                                   0200
*       CSN1=NEWCSN;                /* NEW CSN               @Y30LB25*/
         MVC   CSN1(12),NEWCSN(@08)                                0201
*       CSN2=OLDCSN;                /* OLD CSN               @Y30LB25*/
         MVC   CSN2(12),OLDCSN(@08)                                0202
*       VOLID=VOLIDCSM;             /* VOLID                 @ZM30979*/
         MVC   VOLID(6),VOLIDCSM(@08)                              0203
*       CALL ICBVOP00;              /* MSG TO LIBRARIAN      @Y30LB25*/
         L     @15,@CV00613                                        0204
         BALR  @14,@15                                             0204
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00003                                            0205
*     END;                          /*                       @Y30LB25*/
*                                                                  0206
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR CARTRIDGE ACCESS STATION                    @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0207
*   IF CODEUSM=CAS                  /* C .A. S.?             @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
@RF00198 LA    @08,8                                               0207
         ALR   @08,MESGPTR                                         0207
         CLI   CODEUSM(@08),X'83'                                  0207
         BNE   @RF00207                                            0207
*     DO;                           /*                       @Y30LB25*/
*       IDMSG=CAS1;                 /* SET MSG ID            @Y30LB25*/
         MVC   IDMSG(2),@CC00561                                   0209
*       CSN1=CSN1USM;               /* CSN OF CART ENTER     @Y30LB25*/
         MVC   CSN1(12),CSN1USM(@08)                               0210
*       CSN2=CSN2USM;               /* CSN OF OTHER CART     @Y30LB25*/
         MVC   CSN2(12),CSN2USM(@08)                               0211
*       VOLID=VOLIDUSM;             /* VOLID                 @Y30LB25*/
         MVC   VOLID(6),VOLIDUSM(@08)                              0212
*       CALL ICBVOP00;              /* MSG TO LIBRARIAN      @Y30LB25*/
         L     @15,@CV00613                                        0213
         BALR  @14,@15                                             0213
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00003                                            0214
*     END;                          /*                       @Y30LB25*/
*   RESPECIFY                                                      0216
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   END PLIBMSG;                    /*                       @Y30LB25*/
         B     @EL00003                                            0217
*                                                                  0218
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - PCRTVOL (CREATE AN INACTIVE VOLUME)  @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* FUNCTION - RESERVE .MSVI DATA SET. FIND THE BVR       @Y30LB25*/
*   /* FOR INPUT VOLID. FOR NO BVR OR AN ERROR CONDITION     @Y30LB25*/
*   /* BEFORE ANY MSVC RECORDS ARE CREATED OR UPDATED, A     @Y30LB25*/
*   /* MESSAGE IS SENT TO THE LIBRARIAN INDICATING THE       @Y30LB25*/
*   /* CONTENTS OF THE INPUT MESSAGE WHICH WAS TO BE USED    @Y30LB25*/
*   /* TO UPDATE THE MSVC RECORDS.                           @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* INPUT -                                               @Y30LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* OUTPUT -                                              @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0218
*PCRTVOL:                           /* ID 04                 @Y30LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/
*                                                                  0218
PCRTVOL  ST    @14,@SA00004                                        0218
*   /*****************************************************************/
*   /*                                                               */
*   /* RESERVE .MSVI                                         @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0219
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG0 RSTD;                     /* RESTRICT REG 0        @Y30LB25*/
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG0=RESEXINV;                   /* INDICATE RESERVE      @Y30LB25*/
         LA    RG0,1                                               0221
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         0222
*   CALL ICBVRR00;                  /* RESERVE .MSVI         @Y30LB25*/
         L     @15,@CV00611                                        0223
         BALR  @14,@15                                             0223
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG0 UNRSTD;                   /* UNRESTRICT REG 0      @Y30LB25*/
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*                                                                  0225
*   /*****************************************************************/
*   /*                                                               */
*   /* READ FOR A BASE VOLUME RECORD                         @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0226
*   BVOLKY=VOLIDSM;                 /* VOLID FROM SOL MSG    @Y30LB25*/
         MVC   BVOLKY(6),VOLIDSM+8(MESGPTR)                        0226
*   RPLVKEY=ADDR(BKEY);             /* ADDR OF KEY           @Y30LB25*/
         LA    @08,BKEY                                            0227
         ST    @08,RPLVKEY(,RPLVPTR)                               0227
*   RPLVBUF=BASEVPTR;               /* PT TO BVR BUF         @Y30LB25*/
         L     @08,BASEVPTR                                        0228
         ST    @08,RPLVBUF(,RPLVPTR)                               0228
*   RPLVBLN=LENGTH(BASEBUF);        /* BVR BUFFER LENGTH     @Y30LB25*/
         MVC   RPLVBLN(4,RPLVPTR),@CF00804                         0229
*   RPLVTYP=RPLVREAD;               /* READ OPTION ON        @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'00'                              0230
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB25*/
         OI    RPLVDIR(RPLVPTR),B'01000000'                        0231
*   RPLVUPD=ON;                     /* READ FOR UPDATE       @Y30LB25*/
         OI    RPLVUPD(RPLVPTR),B'00000010'                        0232
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         0234
*   CALL ICBVIO00;                  /* READ FOR BVR          @Y30LB25*/
         L     @15,@CV00610                                        0235
         BALR  @14,@15                                             0235
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/
*     THEN                          /* NO BVR, THEREFORE     @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              0237
         N     @08,@CF00815                                        0237
         LTR   @08,@08                                             0237
         BZ    @RF00237                                            0237
*     DO;                           /* NO CVR                @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         0239
*       RETURN;                     /*                       @Y30LB25*/
@EL00004 DS    0H                                                  0240
@EF00004 DS    0H                                                  0240
@ER00004 L     @14,@SA00004                                        0240
         BR    @14                                                 0240
*     END;                          /*                       @Y30LB25*/
*   BCDVPTR=BCDVPTR&&BCDVPTR;       /* ZERO BCD PTR          @Y30LB25
*                                      NO WARN MSG           @Y30LB25*/
*                                                                  0242
@RF00237 L     @08,BCDVPTR                                         0242
         LR    @04,@08                                             0242
         XR    @04,@08                                             0242
         ST    @04,BCDVPTR                                         0242
*   /*****************************************************************/
*   /*                                                               */
*   /* UPDATE THE BASE VOLUME RECORD, IF ANY                 @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0243
*   CALL PBVR;                      /* UPDT BVR FOR VOLID    @Y30LB25*/
         BAL   @14,PBVR                                            0243
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/
*     THEN                          /* NO BVR FOUND          @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              0244
         N     @08,@CF00815                                        0244
         LTR   @08,@08                                             0244
         BZ    @RF00244                                            0244
*     DO;                           /*                       @Y30LB25*/
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00004                                            0246
*     END;                          /*                       @Y30LB25*/
*   ELSE                            /*                       @Y30LB25*/
*     IF BCDVPTR=BASEVPTR           /* BVR FOUND?            @Y30LB25*/
*       THEN                        /*                       @Y30LB25*/
@RF00244 CLC   BCDVPTR(4),BASEVPTR                                 0248
         BNE   @RF00248                                            0248
*       DO;                         /* YES                   @Y30LB25*/
*         RETURN;                   /*                       @Y30LB25*/
         B     @EL00004                                            0250
*       END;                        /*                       @Y30LB25*/
*                                                                  0251
*   /*****************************************************************/
*   /*                                                               */
*   /* NO BASE VOLUME RECORD WAS FOUND, THEREFORE UPDATE     @Y30LB25*/
*   /* A COPY VOLUME RECORD                                  @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0252
*   CALL FNDCVR;                    /* FIND CVR              @Y30LB25*/
@RF00248 BAL   @14,FNDCVR                                          0252
*   RETURN;                         /*                       @Y30LB25*/
         B     @EL00004                                            0253
*   END PCRTVOL;                    /*                       @Y30LB25*/
*                                                                  0255
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - PBVR                                 @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* FUNCTION - DETERMINE IF BVR IS TO BE UPDATED AND      @Y30LB25*/
*   /* WRITTEN TO .MSVI.                                     @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* INPUT -                                               @Y30LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/
*   /* BASE VOLUME RECORD                                    @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* OUTPUT -                                              @Y30LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/
*   /* BASE VOLUME RECORD                                    @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0255
*PBVR:                                                             0255
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/
*                                                                  0255
PBVR     ST    @14,@SA00005                                        0255
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK IF THIS IS THE MSVC RECORD TO BE UPDATED        @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0256
*   IF(BASCSN1=BLANK12)&(BASCSN2=BLANK12)/* REC TO BE UPDATED?     0256
*                                                            @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
         L     @08,BASEVPTR                                        0256
         CLC   BASCSN1(12,@08),@CC00572                            0256
         BNE   @RF00256                                            0256
         CLC   BASCSN2(12,@08),@CC00572                            0256
         BNE   @RF00256                                            0256
*     DO;                           /*                       @Y30LB25*/
*                                                                  0257
*       /*************************************************************/
*       /*                                                           */
*       /* UPDATE AND WRITE THE BVR                          @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0258
*       BASCSN1=CSN1SM;             /* UPDATE CSN1           @Y30LB25*/
         LA    @04,8                                               0258
         ALR   @04,MESGPTR                                         0258
         MVC   BASCSN1(12,@08),CSN1SM(@04)                         0258
*       BASCSN2=CSN2SM;             /* UPDATE CSN2           @Y30LB25*/
         MVC   BASCSN2(12,@08),CSN2SM(@04)                         0259
*       RPLVTYP=RPLVPUT;            /* SET PUT ON            @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'01'                              0260
*       RESPECIFY                   /*                       @Y30LB25*/
*         RG1 RSTD;                 /* RESTRICT REG 1        @Y30LB25*/
*       RG1=RPLVPTR;                /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         0262
*       CALL ICBVIO00;              /* WRITE BVR             @Y30LB25*/
         L     @15,@CV00610                                        0263
         BALR  @14,@15                                             0263
*       RESPECIFY                   /*                       @Y30LB25*/
*         RG1 UNRSTD;               /* UNRESTRICT REG 1      @Y30LB25*/
*       IF RPLVRETC^=FIXZERO        /* CK RETURN CODE        @Y30LB25*/
*         THEN                      /* I/O ERROR             @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              0265
         N     @08,@CF00815                                        0265
         LTR   @08,@08                                             0265
         BZ    @RF00265                                            0265
*         DO;                       /*                       @Y30LB25*/
*           CALL PLIBMSG;           /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         0267
*           RETURN;                 /*                       @Y30LB25*/
@EL00005 DS    0H                                                  0268
@EF00005 DS    0H                                                  0268
@ER00005 L     @14,@SA00005                                        0268
         BR    @14                                                 0268
*         END;                      /*                       @Y30LB25*/
*       ELSE                        /* CREATE CIRS           @Y30LB25*/
*                                                                  0270
*         /***********************************************************/
*         /*                                                         */
*         /* CREATE OR UPDATE TWO CIRS                       @Y30LB25*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  0270
*         DO;                       /*                       @Y30LB25*/
@RF00265 DS    0H                                                  0271
*           BCDVPTR=BASEVPTR;       /* COMMON MAP            @Y30LB25*/
         L     @08,BASEVPTR                                        0271
         ST    @08,BCDVPTR                                         0271
*           CALL CRT2CIR;           /* CREATE CIRS           @Y30LB25*/
         BAL   @14,CRT2CIR                                         0272
*         END;                      /*                       @Y30LB25*/
*     END;                          /*                       @Y30LB25*/
*   RETURN;                         /*                       @Y30LB25*/
         B     @EL00005                                            0275
*   END PBVR;                       /*                       @Y30LB25*/
         B     @EL00005                                            0276
*                                                                  0277
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - FNDCVR                               @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* FUNCTION - FIND, UPDATE, AND WRITE THE CVR TO         @Y30LB25*/
*   /* .MSVI FOR THE INPUT CSNS AND VOLID.                   @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* INPUT -                                               @Y30LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/
*   /* BASE VOLUME RECORD                                    @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* OUTPUT -                                              @Y30LB25*/
*   /* COPY VOLUME RECORD                                    @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0277
*FNDCVR:                            /*                       @Y30LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/
*                                                                  0277
FNDCVR   ST    @14,@SA00006                                        0277
*   /*****************************************************************/
*   /*                                                               */
*   /* FIND THE CORRECT CVR.                                 @Y30LB25*/
*   /* START WITH FIRST CVR INCASE AFTER MCS PROCESSING      @Y30LB25*/
*   /* FOR ICBVUT00 IS NOT COMPLETE.                         @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0278
*   CVOLKY=VOLIDSM;                 /* SET CVR VOLID         @Y30LB25*/
         MVC   CVOLKY(6),VOLIDSM+8(MESGPTR)                        0278
*   CIDKY=FIXONE;                   /* 1ST CVR               @Y30LB25*/
         LA    @08,1                                               0279
         STC   @08,CIDKY                                           0279
*   RPLVKEY=ADDR(CKEY);             /* ADDR OF CVR KEY       @Y30LB25*/
         LA    @04,CKEY                                            0280
         ST    @04,RPLVKEY(,RPLVPTR)                               0280
*   RPLVBUF=COPYVPTR;               /* ADDR OF READ BUF      @Y30LB25*/
         ST    COPYVPTR,RPLVBUF(,RPLVPTR)                          0281
*   RPLVBLN=LENGTH(COPYBUF);        /* CVR BUFFER LENGTH     @Y30LB25*/
         MVC   RPLVBLN(4,RPLVPTR),@CF00805                         0282
*   RPLVTYP=RPLVREAD;               /* READ OPTION ON        @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'00'                              0283
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB25*/
         OI    RPLVDIR(RPLVPTR),B'01000000'                        0284
*   RPLVUPD=ON;                     /* READ FOR UPDATE       @Y30LB25*/
         OI    RPLVUPD(RPLVPTR),B'00000010'                        0285
*   A=CIDKY;                        /* SET KEY               @Y30LB25*/
         LR    A,@08                                               0286
*   DO CIDKY=A BY 1 TO 255          /* SEARCH FOR CVR        @Y30LB25*/
*         WHILE(RPLVRETC=FIXZERO)×(RPLRCODE=NORECFND);/*     @Y30LB25
*                                      SEARCH CONDITIONS     @Y30LB25*/
         LR    @08,A                                               0287
         STC   @08,CIDKY                                           0287
         B     @DE00287                                            0287
@DL00287 LH    @08,RPLVRETC(,RPLVPTR)                              0287
         N     @08,@CF00815                                        0287
         LTR   @08,@08                                             0287
         BZ    @DB00287                                            0287
         CLC   RPLRCODE(2,RPLVPTR),@CB00586                        0287
         BNE   @DC00287                                            0287
@DB00287 DS    0H                                                  0288
*     RESPECIFY                     /*                       @Y30LB25*/
*       RG1 RSTD;                   /* RESTRICT REG 1        @Y30LB25*/
*     RG1=RPLVPTR;                  /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         0289
*     CALL ICBVIO00;                /* READ FOR CVR          @Y30LB25*/
         L     @15,@CV00610                                        0290
         BALR  @14,@15                                             0290
*     RESPECIFY                     /*                       @Y30LB25*/
*       RG1 UNRSTD;                 /* UNRESTRICT REG 1      @Y30LB25*/
*                                                                  0291
*     /***************************************************************/
*     /*                                                             */
*     /* CHECK FOR CORRECT CVR                               @Y30LB25*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0292
*     IF(COPCSN1=BLANK12)&(COPCSN2=BLANK12)&(RPLVRETC=FIXZERO)/* REC
*                                      TO BE UPDATED?        @Y30LB25*/
*       THEN                        /* YES                   @Y30LB25*/
         CLC   COPCSN1(12,COPYVPTR),@CC00572                       0292
         BNE   @RF00292                                            0292
         CLC   COPCSN2(12,COPYVPTR),@CC00572                       0292
         BNE   @RF00292                                            0292
         LH    @08,RPLVRETC(,RPLVPTR)                              0292
         N     @08,@CF00815                                        0292
         LTR   @08,@08                                             0292
         BNZ   @RF00292                                            0292
*       DO;                         /*                       @Y30LB25*/
*                                                                  0293
*         /***********************************************************/
*         /*                                                         */
*         /* UPDATE AND WRITE THE CVR                        @Y30LB25*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  0294
*         COPCSN1=CSN1SM;           /* UPDATE CSN1           @Y30LB25*/
         LA    @08,8                                               0294
         ALR   @08,MESGPTR                                         0294
         MVC   COPCSN1(12,COPYVPTR),CSN1SM(@08)                    0294
*         COPCSN2=CSN2SM;           /* UPDATE CSN2           @Y30LB25*/
         MVC   COPCSN2(12,COPYVPTR),CSN2SM(@08)                    0295
*         RPLVTYP=RPLVPUT;          /* WRITE REQUEST         @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'01'                              0296
*         RESPECIFY                 /*                       @Y30LB25*/
*           RG1 RSTD;               /* RESTRICT REG 1        @Y30LB25*/
*         RG1=RPLVPTR;              /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         0298
*         CALL ICBVIO00;            /* WRITE CVR             @Y30LB25*/
         L     @15,@CV00610                                        0299
         BALR  @14,@15                                             0299
*         RESPECIFY                 /*                       @Y30LB25*/
*           RG1 UNRSTD;             /* UNRESTRICT REG 1      @Y30LB25*/
*         IF RPLVRETC^=FIXZERO      /* CHECK RETN CODE       @Y30LB25*/
*           THEN                    /*                       @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              0301
         N     @08,@CF00815                                        0301
         LTR   @08,@08                                             0301
         BZ    @RF00301                                            0301
*           DO;                     /*                       @Y30LB25*/
*             CALL PLIBMSG;         /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         0303
*             RETURN;               /*                       @Y30LB25*/
@EL00006 DS    0H                                                  0304
@EF00006 DS    0H                                                  0304
@ER00006 L     @14,@SA00006                                        0304
         BR    @14                                                 0304
*           END;                    /*                       @Y30LB25*/
*         ELSE                      /*                       @Y30LB25*/
*                                                                  0306
*           /*********************************************************/
*           /*                                                       */
*           /* CREATE OR UPDATE TWO CIRS                     @Y30LB25*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  0306
*           DO;                     /* CREATE/UPDATE CIRS    @Y30LB25*/
@RF00301 DS    0H                                                  0307
*             BCDVPTR=COPYVPTR;     /* COMMON MAP            @Y30LB25*/
         ST    COPYVPTR,BCDVPTR                                    0307
*             CALL CRT2CIR;         /* CREATE CIRS           @Y30LB25*/
         BAL   @14,CRT2CIR                                         0308
*             RETURN;               /*                       @Y30LB25*/
         B     @EL00006                                            0309
*           END;                    /*                       @Y30LB25*/
*       END;                        /*                       @Y30LB25*/
*   END;                            /*                       @Y30LB25*/
*                                                                  0312
@RF00292 LA    @08,1                                               0312
         SLR   @04,@04                                             0312
         IC    @04,CIDKY                                           0312
         ALR   @08,@04                                             0312
         STC   @08,CIDKY                                           0312
@DE00287 C     @08,@CF00546                                        0312
         BNH   @DL00287                                            0312
@DC00287 DS    0H                                                  0313
*   /*****************************************************************/
*   /*                                                               */
*   /* ERROR - NO CVR OR BVR EXISTS, OR AN I/O ERROR OCCURED @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0313
*   CALL PLIBMSG;                   /* MSG TO LIBRARIAN      @Y30LB25
*                                      NO CVR TO USE         @Y30LB25*/
         BAL   @14,PLIBMSG                                         0313
*   RETURN;                         /*                       @Y30LB25*/
         B     @EL00006                                            0314
*   END FNDCVR;                     /*                       @Y30LB25*/
*                                                                  0316
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - PACTVOL (ACTIVATE AN INACTIVE        @Y30LB25*/
*   /* VOLUME)                                               @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* FUNCTION - GET BVR AND UPDATE ITS ATTRIBUTES.         @Y30LB25*/
*   /* WRITE THE BVR.                                        @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* INPUT -                                               @Y30LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/
*   /* BASE VOLUME RECORD                                    @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* OUTPUT -                                              @Y30LB25*/
*   /* BASE VOLUME RECORD                                    @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0316
*PACTVOL:                           /* ID 0A                 @Y30LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/
*                                                                  0316
PACTVOL  ST    @14,@SA00007                                        0316
*   /*****************************************************************/
*   /*                                                               */
*   /* RESERVE .MSVI                                         @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0317
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG0 RSTD;                     /* RESTRICT REG 0        @Y30LB25*/
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG0=RESEXINV;                   /* INDICATE RESERVE      @Y30LB25*/
         LA    RG0,1                                               0319
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         0320
*   CALL ICBVRR00;                  /* RESERVE .MSVI         @Y30LB25*/
         L     @15,@CV00611                                        0321
         BALR  @14,@15                                             0321
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG0 UNRSTD;                   /* UNRESTRICT REG 0      @Y30LB25*/
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*                                                                  0323
*   /*****************************************************************/
*   /*                                                               */
*   /* GET THE BVR                                           @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0324
*   BVOLKY=VOLIDSM;                 /* VOLID FROM SOL MSG    @Y30LB25*/
         MVC   BVOLKY(6),VOLIDSM+8(MESGPTR)                        0324
*   RPLVKEY=ADDR(BKEY);             /* ADDR OF KEY           @Y30LB25*/
         LA    @08,BKEY                                            0325
         ST    @08,RPLVKEY(,RPLVPTR)                               0325
*   RPLVBUF=BASEVPTR;               /* PT TO BVR BUF         @Y30LB25*/
         L     @08,BASEVPTR                                        0326
         ST    @08,RPLVBUF(,RPLVPTR)                               0326
*   RPLVBLN=LENGTH(BASEBUF);        /* SET BVR BUF LENGTH    @Y30LB25*/
         MVC   RPLVBLN(4,RPLVPTR),@CF00804                         0327
*   RPLVTYP=RPLVREAD;               /* READ OPTION ON        @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'00'                              0328
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB25*/
         OI    RPLVDIR(RPLVPTR),B'01000000'                        0329
*   RPLVUPD=ON;                     /* READ FOR UPDATE       @Y30LB25*/
         OI    RPLVUPD(RPLVPTR),B'00000010'                        0330
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         0332
*   CALL ICBVIO00;                  /* READ FOR BVR          @Y30LB25*/
         L     @15,@CV00610                                        0333
         BALR  @14,@15                                             0333
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/
*     THEN                          /*                       @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              0335
         N     @08,@CF00815                                        0335
         LTR   @08,@08                                             0335
         BZ    @RF00335                                            0335
*     DO;                           /*                       @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         0337
*       RETURN;                     /*                       @Y30LB25*/
@EL00007 DS    0H                                                  0338
@EF00007 DS    0H                                                  0338
@ER00007 L     @14,@SA00007                                        0338
         BR    @14                                                 0338
*     END;                          /*                       @Y30LB25*/
*                                                                  0339
*   /*****************************************************************/
*   /*                                                               */
*   /* SET ATTRIBUTES                                        @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0340
*   BASEXCL=OFF;                    /* CLEAR EXCLUSIVE       @Y30LB25*/
@RF00335 L     @08,BASEVPTR                                        0340
         NI    BASEXCL(@08),B'11111110'                            0340
*   BASDAERA=OFF;                   /* CLEAR DASD ERASE      @Y30LB25*/
         NI    BASDAERA(@08),B'01111111'                           0341
*   BASBIND=OFF;                    /* CLEAR BIND            @Y30LB25*/
         NI    BASBIND(@08),B'11111101'                            0342
*   BASRONLY=OFF;                   /* CLEAR READ ONLY       @Y30LB25*/
         NI    BASRONLY(@08),B'10111111'                           0343
*   IF EXCLATTB=ON                  /* SET EXCLUS ATTB?      @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
         TM    EXCLATTB+8(MESGPTR),B'00010000'                     0344
         BNO   @RF00344                                            0344
*     BASEXCL=ON;                   /* SET EXCLUSIVE         @Y30LB25*/
         OI    BASEXCL(@08),B'00000001'                            0345
*   IF SECVOL=ON                    /* DASD ERASE?           @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
@RF00344 TM    SECVOL+8(MESGPTR),B'00100000'                       0346
         BNO   @RF00346                                            0346
*     BASDAERA=ON;                  /* DASD ERASE            @Y30LB25*/
         L     @08,BASEVPTR                                        0347
         OI    BASDAERA(@08),B'10000000'                           0347
*   IF BINDATTB=ON                  /* SET BIND ATTB?        @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
@RF00346 TM    BINDATTB+8(MESGPTR),B'00000100'                     0348
         BNO   @RF00348                                            0348
*     BASBIND=ON;                   /* SET BIND              @Y30LB25*/
         L     @08,BASEVPTR                                        0349
         OI    BASBIND(@08),B'00000010'                            0349
*   IF RONLYATB=ON                  /* READ ONLY ATTB?       @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
@RF00348 TM    RONLYATB+8(MESGPTR),B'00000010'                     0350
         BNO   @RF00350                                            0350
*     BASRONLY=ON;                  /* SET READ ONLY         @Y30LB25*/
*                                                                  0351
         L     @08,BASEVPTR                                        0351
         OI    BASRONLY(@08),B'01000000'                           0351
*   /*****************************************************************/
*   /*                                                               */
*   /* WRITE THE RECORD                                      @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0352
*   RPLVTYP=RPLVPUT;                /* SET PUT ON            @Y30LB25*/
@RF00350 MVI   RPLVTYP(RPLVPTR),X'01'                              0352
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         0354
*   CALL ICBVIO00;                  /* WRITE BVR             @Y30LB25*/
         L     @15,@CV00610                                        0355
         BALR  @14,@15                                             0355
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/
*     THEN                          /*                       @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              0357
         N     @08,@CF00815                                        0357
         LTR   @08,@08                                             0357
         BZ    @RF00357                                            0357
*     CALL PLIBMSG;                 /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         0358
*   RETURN;                         /*                       @Y30LB25*/
         B     @EL00007                                            0359
*   END PACTVOL;                    /*                       @Y30LB25*/
         B     @EL00007                                            0360
*                                                                  0361
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - PCPYCRT (COPY CARTRIDGE)             @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* FUNCTION - GET THE BVR AND UPDATE ITS CSN FIELD FOR   @Y30LB25*/
*   /* THE NEW CSN. WRITE THE BVR. DELETE THE CIR FOR        @Y30LB25*/
*   /* THE OLD CSN - NONE FOUND IS OK.                       @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* INPUT -                                               @Y30LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/
*   /* BASE VOLUME RECORD                                    @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* OUTPUT -                                              @Y30LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/
*   /* BASE VOLUME RECORD                                    @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0361
*PCPYCRT:                           /* ID 0D                 @Y30LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/
*                                                                  0361
PCPYCRT  ST    @14,@SA00008                                        0361
*   /*****************************************************************/
*   /*                                                               */
*   /* RESERVE .MSVI                                         @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0362
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG0 RSTD;                     /* RESTRICT REG 0        @Y30LB25*/
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG0=RESEXINV;                   /* INDICATE RESERVE      @Y30LB25*/
         LA    RG0,1                                               0364
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         0365
*   CALL ICBVRR00;                  /* RESERVE .MSVI         @Y30LB25*/
         L     @15,@CV00611                                        0366
         BALR  @14,@15                                             0366
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG0 UNRSTD;                   /* UNRESTRICT REG 0      @Y30LB25*/
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*                                                                  0368
*   /*****************************************************************/
*   /*                                                               */
*   /* GET THE BVR                                           @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0369
*   BVOLKY=VOLIDCSM;                /* VOLID FROM SOL MSG    @ZM30979*/
         MVC   BVOLKY(6),VOLIDCSM+8(MESGPTR)                       0369
*   RPLVKEY=ADDR(BKEY);             /* ADDR OF KEY           @Y30LB25*/
         LA    @08,BKEY                                            0370
         ST    @08,RPLVKEY(,RPLVPTR)                               0370
*   RPLVBUF=BASEVPTR;               /* PT TO BVR BUF         @Y30LB25*/
         L     @08,BASEVPTR                                        0371
         ST    @08,RPLVBUF(,RPLVPTR)                               0371
*   RPLVBLN=LENGTH(BASEBUF);        /* SET BVR BUF LENGTH    @Y30LB25*/
         MVC   RPLVBLN(4,RPLVPTR),@CF00804                         0372
*   RPLVTYP=RPLVREAD;               /* READ OPTION ON        @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'00'                              0373
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB25*/
         OI    RPLVDIR(RPLVPTR),B'01000000'                        0374
*   RPLVUPD=ON;                     /* READ FOR UPDATE       @Y30LB25*/
         OI    RPLVUPD(RPLVPTR),B'00000010'                        0375
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         0377
*   CALL ICBVIO00;                  /* READ FOR BVR          @Y30LB25*/
         L     @15,@CV00610                                        0378
         BALR  @14,@15                                             0378
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/
*     THEN                          /*                       @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              0380
         N     @08,@CF00815                                        0380
         LTR   @08,@08                                             0380
         BZ    @RF00380                                            0380
*     DO;                           /*                       @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         0382
*       RETURN;                     /*                       @Y30LB25*/
@EL00008 DS    0H                                                  0383
@EF00008 DS    0H                                                  0383
@ER00008 L     @14,@SA00008                                        0383
         BR    @14                                                 0383
*     END;                          /*                       @Y30LB25*/
*                                                                  0384
*   /*****************************************************************/
*   /*                                                               */
*   /* UPDATE BVR CSN                                        @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0385
*   IF OLDCSN=BASCSN1               /* CART COPIED?          @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
@RF00380 LA    @08,8                                               0385
         ALR   @08,MESGPTR                                         0385
         L     @04,BASEVPTR                                        0385
         CLC   OLDCSN(12,@08),BASCSN1(@04)                         0385
         BNE   @RF00385                                            0385
*     DO;                           /*                       @Y30LB25*/
*       CSNUMBER=ON;                /* CSN1 FOR ICBVUCIR     @Y30LB25*/
         OI    CSNUMBER,B'00000100'                                0387
*       BASCSN1=NEWCSN;             /* UPDATE CSN            @Y30LB25*/
         MVC   BASCSN1(12,@04),NEWCSN(@08)                         0388
*     END;                          /*                       @Y30LB25*/
*   ELSE                            /* CHECK OTHER CSN       @Y30LB25*/
*     IF OLDCSN=BASCSN2             /* CART COPIED?          @Y30LB25*/
*       THEN                        /* YES                   @Y30LB25*/
         B     @RC00385                                            0390
@RF00385 LA    @08,8                                               0390
         ALR   @08,MESGPTR                                         0390
         L     @04,BASEVPTR                                        0390
         CLC   OLDCSN(12,@08),BASCSN2(@04)                         0390
         BNE   @RF00390                                            0390
*       DO;                         /*                       @Y30LB25*/
*         CSNUMBER=OFF;             /* CSN1 FOR ICBVUCIR     @Y30LB25*/
         NI    CSNUMBER,B'11111011'                                0392
*         BASCSN2=NEWCSN;           /* UPDATE CSN            @Y30LB25*/
         MVC   BASCSN2(12,@04),NEWCSN(@08)                         0393
*       END;                        /*                       @Y30LB25*/
*     ELSE                          /* ERROR                 @Y30LB25*/
*       DO;                         /*                       @Y30LB25*/
         B     @RC00390                                            0395
@RF00390 DS    0H                                                  0396
*         CALL PLIBMSG;             /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         0396
*         RETURN;                   /*                       @Y30LB25*/
         B     @EL00008                                            0397
*       END;                        /*                       @Y30LB25*/
*                                                                  0398
*   /*****************************************************************/
*   /*                                                               */
*   /* WRITE THE BVR                                         @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0399
*   RPLVTYP=RPLVPUT;                /* SET PUT ON            @Y30LB25*/
@RC00390 DS    0H                                                  0399
@RC00385 MVI   RPLVTYP(RPLVPTR),X'01'                              0399
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         0401
*   CALL ICBVIO00;                  /* WRITE BVR             @Y30LB25*/
         L     @15,@CV00610                                        0402
         BALR  @14,@15                                             0402
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/
*     THEN                          /*                       @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              0404
         N     @08,@CF00815                                        0404
         LTR   @08,@08                                             0404
         BZ    @RF00404                                            0404
*     DO;                           /*                       @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         0406
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00008                                            0407
*     END;                          /*                       @Y30LB25*/
*                                                                  0408
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCESS AND CREATE A CIR                              @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0409
*   BCDVPTR=BASEVPTR;               /* PTR TO BVR            @Y30LB25*/
@RF00404 L     @08,BASEVPTR                                        0409
         ST    @08,BCDVPTR                                         0409
*   CALL VUCIR;                     /*                       @Y30LB25
*                                      PROC/CREATE CIR       @Y30LB25*/
         BAL   @14,VUCIR                                           0410
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/
*     THEN                          /*                       @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              0411
         N     @08,@CF00815                                        0411
         LTR   @08,@08                                             0411
         BZ    @RF00411                                            0411
*     DO;                           /*                       @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         0413
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00008                                            0414
*     END;                          /*                       @Y30LB25*/
*                                                                  0415
*   /*****************************************************************/
*   /*                                                               */
*   /* GET CIR FOR THE OLD CSN                               @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0416
*   IVOLKY=OLDCSN;                  /* SET THE KEY           @Y30LB25*/
@RF00411 MVC   IVOLKY(12),OLDCSN+8(MESGPTR)                        0416
*   RPLVTYP=RPLVREAD;               /* READ OPTION ON        @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'00'                              0417
*   RPLVLOC=OFF;                    /* LOCATE OFF            @Y30LB25*/
         NI    RPLVLOC(RPLVPTR),B'01111111'                        0418
*   RPLVUPD=ON;                     /* READ FOR UPDATE       @Y30LB25*/
         OI    RPLVUPD(RPLVPTR),B'00000010'                        0419
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB25*/
         OI    RPLVDIR(RPLVPTR),B'01000000'                        0420
*   RPLVKEY=ADDR(IKEY);             /* ADDR OF KEY           @Y30LB25*/
         LA    @08,IKEY                                            0421
         ST    @08,RPLVKEY(,RPLVPTR)                               0421
*   RPLVBUF=INDEXPTR;               /* ADDR OF BUFFER        @Y30LB25*/
         ST    INDEXPTR,RPLVBUF(,RPLVPTR)                          0422
*   RPLVBLN=LENGTH(INDEXBUF);       /* CIR BUFFER LENGTH     @Y30LB25*/
         MVC   RPLVBLN(4,RPLVPTR),@CF00806                         0423
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         0425
*   CALL ICBVIO00;                  /* READ FOR CIR          @Y30LB25*/
         L     @15,@CV00610                                        0426
         BALR  @14,@15                                             0426
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC^=FIXZERO            /* CHECK RETURN CODE     @Y30LB25*/
*     THEN                          /*                       @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              0428
         N     @08,@CF00815                                        0428
         LTR   @08,@08                                             0428
         BZ    @RF00428                                            0428
*     DO;                           /*                       @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         0430
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00008                                            0431
*     END;                          /*                       @Y30LB25*/
*   IF INDVSRNO^=VOLIDCSM           /* CORRECT CIR?          @ZM30979*/
*     THEN                          /* NO                    @Y30LB25*/
@RF00428 CLC   INDVSRNO(6,INDEXPTR),VOLIDCSM+8(MESGPTR)            0433
         BE    @RF00433                                            0433
*     DO;                           /*                       @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         0435
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00008                                            0436
*     END;                          /*                       @Y30LB25*/
*                                                                  0437
*   /*****************************************************************/
*   /*                                                               */
*   /* DELETE THE CIR FOR THE OLD CSN                        @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0438
*   RPLVTYP=RPLVDEL;                /* DELETE ON             @Y30LB25*/
@RF00433 MVI   RPLVTYP(RPLVPTR),X'05'                              0438
*   RPLVBUF=INDEXPTR;               /* ADDR OF BUFFER        @Y30LB25*/
         ST    INDEXPTR,RPLVBUF(,RPLVPTR)                          0439
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         0441
*   CALL ICBVIO00;                  /* DELETE CIR            @Y30LB25*/
         L     @15,@CV00610                                        0442
         BALR  @14,@15                                             0442
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC^=FIXZERO            /* CHECK RETURN CODE     @Y30LB25*/
*     THEN                          /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              0444
         N     @08,@CF00815                                        0444
         LTR   @08,@08                                             0444
         BZ    @RF00444                                            0444
*     CALL PLIBMSG;                 /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         0445
*   RETURN;                         /*                       @Y30LB25*/
         B     @EL00008                                            0446
*   END PCPYCRT;                    /*                       @Y30LB25*/
         B     @EL00008                                            0447
*                                                                  0448
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - PCAS (CARTRIDGE ACCESS STATION)      @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* FUNCTION - RESERVE .MSVI DATA SET.                    @Y30LB25*/
*   /* PROCESS CARTRIDGES ENTERED AT THE CARTRIDGE           @Y30LB25*/
*   /* ACCESS STATION (CAS). FIND AND UPDATE THE             @Y30LB25*/
*   /* CORRECT MSVC RECORD FOR THE CARTRIDGE ENTERED.        @Y30LB25*/
*   /* IF NONE CAN BE FOUND, TRY TO FIND THE CORRECT MSVC    @Y30LB25*/
*   /* RECORD FOR THE OTHER CARTRIDGE OF THE PAIR (THE ONE   @Y30LB25*/
*   /* NOT ENTERED)                                          @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* INPUT -                                               @Y30LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* OUTPUT -                                              @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0448
*PCAS:                              /* ID 83                 @Y30LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/
*                                                                  0448
PCAS     ST    @14,@SA00009                                        0448
*   /*****************************************************************/
*   /*                                                               */
*   /* RESERVE .MSVI                                         @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0449
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG0 RSTD;                     /* RESTRICT REG 0        @Y30LB25*/
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG0=RESEXINV;                   /* INDICATE RESERVE      @Y30LB25*/
         LA    RG0,1                                               0451
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         0452
*   CALL ICBVRR00;                  /* RESERVE .MSVI         @Y30LB25*/
         L     @15,@CV00611                                        0453
         BALR  @14,@15                                             0453
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG0 UNRSTD;                   /* UNRESTRICT REG 0      @Y30LB25*/
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*                                                                  0455
*   /*****************************************************************/
*   /*                                                               */
*   /* GET CIR FOR THE CARTRIDGE ENTERED                     @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0456
*   IVOLKY=CSN1USM;                 /* CSN OF CART           @Y30LB25
*                                      ENTERED               @Y30LB25*/
         MVC   IVOLKY(12),CSN1USM+8(MESGPTR)                       0456
*   RPLVKEY=ADDR(IKEY);             /* ADDR OF KEY           @Y30LB25*/
         LA    @08,IKEY                                            0457
         ST    @08,RPLVKEY(,RPLVPTR)                               0457
*   RPLVBUF=INDEXPTR;               /* PT TO CIR BUF         @Y30LB25*/
         ST    INDEXPTR,RPLVBUF(,RPLVPTR)                          0458
*   RPLVBLN=LENGTH(INDEXBUF);       /* SET CIR BUF LENGTH    @Y30LB25*/
         MVC   RPLVBLN(4,RPLVPTR),@CF00806                         0459
*   RPLVTYP=RPLVREAD;               /* READ OPTION ON        @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'00'                              0460
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB25*/
         OI    RPLVDIR(RPLVPTR),B'01000000'                        0461
*   RPLVUPD=ON;                     /* READ FOR UPDATE       @Y30LB25*/
         OI    RPLVUPD(RPLVPTR),B'00000010'                        0462
*   RPLVLOC=OFF;                    /* NO LOCATE             @Y30LB25*/
         NI    RPLVLOC(RPLVPTR),B'01111111'                        0463
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         0465
*   CALL ICBVIO00;                  /* READ FOR CIR          @Y30LB25*/
         L     @15,@CV00610                                        0466
         BALR  @14,@15                                             0466
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLRCODE=IOERROR             /* CK REASON CODE        @Y30LB25*/
*     THEN                          /* ERROR                 @Y30LB25*/
         CLC   RPLRCODE(2,RPLVPTR),@CB00588                        0468
         BNE   @RF00468                                            0468
*     DO;                           /*                       @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         0470
*       RETURN;                     /*                       @Y30LB25*/
@EL00009 DS    0H                                                  0471
@EF00009 DS    0H                                                  0471
@ER00009 L     @14,@SA00009                                        0471
         BR    @14                                                 0471
*     END;                          /*                       @Y30LB25*/
*                                                                  0472
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR PROCESS OF THE OTHER CARTRIDGE              @Y30LB25*/
*   /* PAIRED WITH THE ONE ENTERED                           @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0473
*   IF RPLRCODE=NORECFND×INDVSRNO^=VOLIDUSM/* NO REC FND OR  @Y30LB25
*                                      WRONG VOLID?          @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
@RF00468 CLC   RPLRCODE(2,RPLVPTR),@CB00586                        0473
         BE    @RT00473                                            0473
         CLC   INDVSRNO(6,INDEXPTR),VOLIDUSM+8(MESGPTR)            0473
         BE    @RF00473                                            0473
@RT00473 DS    0H                                                  0474
*     DO;                           /*                       @Y30LB25*/
*       RPLRCODE=RPLRCODE&&RPLRCODE;/* ZERO REASON CODE      @Y30LB25*/
         XC    RPLRCODE(2,RPLVPTR),RPLRCODE(RPLVPTR)               0475
*       RPLVRETC=RPLVRETC&&RPLVRETC;/* ZERO RETURN CODE      @Y30LB25*/
         XC    RPLVRETC(2,RPLVPTR),RPLVRETC(RPLVPTR)               0476
*       CALL P2NDCART;              /* CK 2ND CART           @Y30LB25*/
         BAL   @14,P2NDCART                                        0477
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00009                                            0478
*     END;                          /*                       @Y30LB25*/
*                                                                  0479
*   /*****************************************************************/
*   /*                                                               */
*   /* DETERMINE TYPE OF MSVC RECORD                         @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0480
*   IF INDALPHA=D                   /* DVR?                  @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
@RF00473 CLI   INDALPHA(INDEXPTR),C'D'                             0480
         BNE   @RF00480                                            0480
*     DO;                           /*                       @Y30LB25*/
*                                                                  0481
*       /*************************************************************/
*       /*                                                           */
*       /* DVR FOR CARTRIDGE ENTERED                         @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0482
*       CALL CKDVR1;                /* CK DVR FOR CART       @Y30LB25
*                                      ENTERED               @Y30LB25*/
         BAL   @14,CKDVR1                                          0482
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00009                                            0483
*     END;                          /*                       @Y30LB25*/
*   ELSE                            /* BVR OR CVR?           @Y30LB25*/
*     IF INDEXREC=FIXZERO           /* BVR?                  @Y30LB25*/
*       THEN                        /* YES                   @Y30LB25*/
@RF00480 CLI   INDEXREC(INDEXPTR),0                                0485
         BNE   @RF00485                                            0485
*       DO;                         /*                       @Y30LB25*/
*                                                                  0486
*         /***********************************************************/
*         /*                                                         */
*         /* BVR FOR CARTRIDGE ENTERED                       @Y30LB25*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  0487
*         CALL CKBVR1;              /* CK BVR FOR CART       @Y30LB25
*                                      ENTERED               @Y30LB25*/
         BAL   @14,CKBVR1                                          0487
*         RETURN;                   /*                       @Y30LB25*/
         B     @EL00009                                            0488
*       END;                        /*                       @Y30LB25*/
*     ELSE                          /* IS A CVR              @Y30LB25*/
*       DO;                         /*                       @Y30LB25*/
*                                                                  0490
@RF00485 DS    0H                                                  0491
*         /***********************************************************/
*         /*                                                         */
*         /* CVR FOR CARTRIDGE ENTERED                       @Y30LB25*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  0491
*         CALL CKCVR1;              /* CK CVR FOR CART       @Y30LB25
*                                      ENTERED               @Y30LB25*/
         BAL   @14,CKCVR1                                          0491
*         RETURN;                   /*                       @Y30LB25*/
         B     @EL00009                                            0492
*       END;                        /*                       @Y30LB25*/
*   END PCAS;                       /*                       @Y30LB25*/
*                                                                  0495
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - P2NDCART                             @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* FUNCTION - FIND AND UPDATE THE CORRECT MSVC RECORD    @Y30LB25*/
*   /* FOR THE OTHER CARTRIDGE WHICH IS PAIRED               @Y30LB25*/
*   /* WITH THE ONE WHICH WAS ENTERED.                       @Y30LB25*/
*   /* IF NONE CAN BE FOUND, CREATE A BVR IF ONE             @Y30LB25*/
*   /* DOES NOT EXIST. IF A BVR EXISTS, CREATE A DVR.        @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* INPUT -                                               @Y30LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* OUTPUT -                                              @Y30LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0495
*P2NDCART:                          /*                       @Y30LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/
*                                                                  0495
P2NDCART ST    @14,@SA00010                                        0495
*   /*****************************************************************/
*   /*                                                               */
*   /* GET CIR FOR OTHER CARTRIDGE PAIRED WITH THE           @Y30LB25*/
*   /* ONE ENTERED                                           @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0496
*   IVOLKY=CSN2USM;                 /* CSN OF OTHER CART     @Y30LB25*/
         MVC   IVOLKY(12),CSN2USM+8(MESGPTR)                       0496
*   RPLVKEY=ADDR(IKEY);             /* ADDR OF KEY           @Y30LB25*/
         LA    @08,IKEY                                            0497
         ST    @08,RPLVKEY(,RPLVPTR)                               0497
*   RPLVBUF=INDEXPTR;               /* PT TO CIR BUF         @Y30LB25*/
         ST    INDEXPTR,RPLVBUF(,RPLVPTR)                          0498
*   RPLVBLN=LENGTH(INDEXBUF);       /* SET CIR BUF LENGTH    @Y30LB25*/
         MVC   RPLVBLN(4,RPLVPTR),@CF00806                         0499
*   RPLVTYP=RPLVREAD;               /* READ OPTION ON        @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'00'                              0500
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB25*/
         OI    RPLVDIR(RPLVPTR),B'01000000'                        0501
*   RPLVUPD=ON;                     /* READ FOR UPDATE       @Y30LB25*/
         OI    RPLVUPD(RPLVPTR),B'00000010'                        0502
*   RPLVLOC=OFF;                    /* NO LOCATE             @Y30LB25*/
         NI    RPLVLOC(RPLVPTR),B'01111111'                        0503
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         0505
*   CALL ICBVIO00;                  /* READ FOR CIR          @Y30LB25*/
         L     @15,@CV00610                                        0506
         BALR  @14,@15                                             0506
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLRCODE=IOERROR             /* CK REASON CODE        @Y30LB25*/
*     THEN                          /* ERROR                 @Y30LB25*/
         CLC   RPLRCODE(2,RPLVPTR),@CB00588                        0508
         BNE   @RF00508                                            0508
*     DO;                           /*                       @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         0510
*       RETURN;                     /*                       @Y30LB25*/
@EL00010 DS    0H                                                  0511
@EF00010 DS    0H                                                  0511
@ER00010 L     @14,@SA00010                                        0511
         BR    @14                                                 0511
*     END;                          /*                       @Y30LB25*/
*                                                                  0512
*   /*****************************************************************/
*   /*                                                               */
*   /* DETERMINE TYPE OF MSVC RECORD FOUND, IF ANY           @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0513
*   IF RPLRCODE=NORECFND×INDVSRNO^=VOLIDUSM/* NO REC FND OR  @Y30LB25
*                                      WRONG VOLID?          @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
@RF00508 CLC   RPLRCODE(2,RPLVPTR),@CB00586                        0513
         BE    @RT00513                                            0513
         CLC   INDVSRNO(6,INDEXPTR),VOLIDUSM+8(MESGPTR)            0513
         BE    @RF00513                                            0513
@RT00513 DS    0H                                                  0514
*     DO;                           /*                       @Y30LB25*/
*                                                                  0514
*       /*************************************************************/
*       /*                                                           */
*       /* NO RECORD WAS FOUND                               @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0515
*       RPLRCODE=RPLRCODE&&RPLRCODE;/* ZERO REASON CODE      @Y30LB25*/
         XC    RPLRCODE(2,RPLVPTR),RPLRCODE(RPLVPTR)               0515
*       RPLVRETC=RPLVRETC&&RPLVRETC;/* ZERO RETURN CODE      @Y30LB25*/
         XC    RPLVRETC(2,RPLVPTR),RPLVRETC(RPLVPTR)               0516
*       CALL NONEFND;               /* CREATE BVR OR DVR     @Y30LB25*/
         BAL   @14,NONEFND                                         0517
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00010                                            0518
*     END;                          /*                       @Y30LB25*/
*                                                                  0519
*   /*****************************************************************/
*   /*                                                               */
*   /* DVR FOR OTHER CARTRIDGE PAIRED WITH THE               @Y30LB25*/
*   /* ONE ENTERED                                           @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0520
*   IF INDALPHA=D                   /* DVR?                  @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
@RF00513 CLI   INDALPHA(INDEXPTR),C'D'                             0520
         BNE   @RF00520                                            0520
*     DO;                           /*                       @Y30LB25*/
*       CALL CKDVR2;                /* CK DVR FOR OTHER      @Y30LB25
*                                      CARTRIDGE             @Y30LB25*/
         BAL   @14,CKDVR2                                          0522
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00010                                            0523
*     END;                          /*                       @Y30LB25*/
*   ELSE                            /* BVR OR CVR?           @Y30LB25*/
*                                                                  0525
*     /***************************************************************/
*     /*                                                             */
*     /* BVR FOR OTHER CARTRIDGE PAIRED WITH THE             @Y30LB25*/
*     /* ONE ENTERED                                         @Y30LB25*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  0525
*     IF INDEXREC=FIXZERO           /* BVR?                  @Y30LB25*/
*       THEN                        /* YES                   @Y30LB25*/
@RF00520 CLI   INDEXREC(INDEXPTR),0                                0525
         BNE   @RF00525                                            0525
*       DO;                         /*                       @Y30LB25*/
*         CALL CKBVR2;              /* CK BVR FOR OTHER      @Y30LB25
*                                      CARTRIDGE             @Y30LB25*/
         BAL   @14,CKBVR2                                          0527
*         RETURN;                   /*                       @Y30LB25*/
         B     @EL00010                                            0528
*       END;                        /*                       @Y30LB25*/
*     ELSE                          /* IS A CVR              @Y30LB25*/
*                                                                  0530
*       /*************************************************************/
*       /*                                                           */
*       /* CVR FOR OTHER CARTRIDGE PAIRED WITH THE           @Y30LB25*/
*       /* ONE ENTERED                                       @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0530
*       DO;                         /*                       @Y30LB25*/
@RF00525 DS    0H                                                  0531
*         CALL CKCVR2;              /* CK CVR FOR OTHER      @Y30LB25
*                                      CARTRIDGE             @Y30LB25*/
         BAL   @14,CKCVR2                                          0531
*         RETURN;                   /*                       @Y30LB25*/
         B     @EL00010                                            0532
*       END;                        /*                       @Y30LB25*/
*   END P2NDCART;                   /*                       @Y30LB25*/
*                                                                  0535
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - CKDVR1                               @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* FUNCTION - UPDATE A DVR AND CIR FOR THE CSN OF THE    @Y30LB25*/
*   /* CARTRIDGE ENTERED.                                    @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* INPUT -                                               @Y30LB25*/
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* OUTPUT -                                              @Y30LB25*/
*   /* DUPLICATE VOLUME RECORD                               @Y30LB25*/
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0535
*CKDVR1:                            /*                       @Y30LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/
*                                                                  0535
CKDVR1   ST    @14,@SA00011                                        0535
*   /*****************************************************************/
*   /*                                                               */
*   /* GET THE DVR FROM THE CSN OF THE CARTRIDGE ENTERED     @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0536
*   DKEY=INDRECKY;                  /* DVR KEY               @Y30LB25*/
         MVC   DKEY(13),INDRECKY(INDEXPTR)                         0536
*   RPLVKEY=ADDR(DKEY);             /* ADDR OF KEY           @Y30LB25*/
         LA    @08,DKEY                                            0537
         ST    @08,RPLVKEY(,RPLVPTR)                               0537
*   RPLVBUF=DUPVPTR;                /* PT TO DVR BUF         @Y30LB25*/
         L     @08,DUPVPTR                                         0538
         ST    @08,RPLVBUF(,RPLVPTR)                               0538
*   RPLVBLN=LENGTH(DUPVBUF);        /* SET DVR BUF LENGTH    @Y30LB25*/
         MVC   RPLVBLN(4,RPLVPTR),@CF00804                         0539
*   RPLVTYP=RPLVREAD;               /* READ OPTION ON        @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'00'                              0540
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB25*/
         OI    RPLVDIR(RPLVPTR),B'01000000'                        0541
*   RPLVUPD=ON;                     /* READ FOR UPDATE       @Y30LB25*/
         OI    RPLVUPD(RPLVPTR),B'00000010'                        0542
*   RPLVLOC=OFF;                    /* NO LOCATE             @Y30LB25*/
         NI    RPLVLOC(RPLVPTR),B'01111111'                        0543
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         0545
*   CALL ICBVIO00;                  /* READ FOR DVR          @Y30LB25*/
         L     @15,@CV00610                                        0546
         BALR  @14,@15                                             0546
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              0548
         N     @08,@CF00815                                        0548
         LTR   @08,@08                                             0548
         BZ    @RF00548                                            0548
*     DO;                           /* NO REC FND            @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         0550
*       RETURN;                     /*                       @Y30LB25*/
@EL00011 DS    0H                                                  0551
@EF00011 DS    0H                                                  0551
@ER00011 L     @14,@SA00011                                        0551
         BR    @14                                                 0551
*     END;                          /*                       @Y30LB25*/
*                                                                  0552
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR CORRECT RECORD                              @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0553
*   IF(CSN1USM=DUPCSN1&CSN2USM=DUPCSN2)×/* ALL CSNS MATCH?   @Y30LB25*/
*       (CSN1USM=DUPCSN2&CSN2USM=DUPCSN1)/*                  @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
@RF00548 LA    @08,8                                               0553
         ALR   @08,MESGPTR                                         0553
         L     @04,DUPVPTR                                         0553
         CLC   CSN1USM(12,@08),DUPCSN1(@04)                        0553
         BNE   @GL00009                                            0553
         CLC   CSN2USM(12,@08),DUPCSN2(@04)                        0553
         BE    @RT00553                                            0553
@GL00009 LA    @08,8                                               0553
         ALR   @08,MESGPTR                                         0553
         L     @04,DUPVPTR                                         0553
         CLC   CSN1USM(12,@08),DUPCSN2(@04)                        0553
         BNE   @RF00553                                            0553
         CLC   CSN2USM(12,@08),DUPCSN1(@04)                        0553
         BNE   @RF00553                                            0553
@RT00553 DS    0H                                                  0554
*     DO;                           /*                       @Y30LB25*/
*                                                                  0554
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK FOR CSN1                                    @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0555
*       IF SEQNUM=ONEF1             /* CSN1?                 @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
         LA    @08,8                                               0555
         ALR   @08,MESGPTR                                         0555
         CLI   SEQNUM(@08),X'F1'                                   0555
         BNE   @RF00555                                            0555
*         DO;                       /*                       @Y30LB25*/
*                                                                  0556
*           /*********************************************************/
*           /*                                                       */
*           /* SET LIBID1                                    @Y30LB25*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  0557
*           DUPLIB1=DUPLIB1&&DUPLIB1;/* ZERO LIBID1          @Y30LB25*/
         L     @04,DUPVPTR                                         0557
         SLR   @03,@03                                             0557
         IC    @03,DUPLIB1(,@04)                                   0557
         LR    @15,@03                                             0557
         XR    @15,@03                                             0557
         STC   @15,DUPLIB1(,@04)                                   0557
*           IF LUSM1=ON             /* BIT 1 ON?             @Y30LB25*/
*             THEN                  /* YES                   @Y30LB25*/
         TM    LUSM1(@08),B'10000000'                              0558
         BNO   @RF00558                                            0558
*             DUP1BIT1=ON;          /* LIBID1 BIT1 ON        @Y30LB25*/
         OI    DUP1BIT1(@04),B'00000010'                           0559
*           IF LUSM2=ON             /* BIT 2 ON?             @Y30LB25*/
*             THEN                  /* YES                   @Y30LB25*/
@RF00558 TM    LUSM2+8(MESGPTR),B'01000000'                        0560
         BNO   @RF00560                                            0560
*             DUP1BIT2=ON;          /* LIBID1 BIT2 ON        @Y30LB25*/
         L     @08,DUPVPTR                                         0561
         OI    DUP1BIT2(@08),B'00000001'                           0561
*           DUPCSN1=CSN1USM;        /* SET FIRST CSN         @ZM31119*/
@RF00560 L     @08,DUPVPTR                                         0562
         LA    @04,8                                               0562
         ALR   @04,MESGPTR                                         0562
         MVC   DUPCSN1(12,@08),CSN1USM(@04)                        0562
*           DUPCSN2=CSN2USM;        /* SET SECOND CSN        @ZM31119*/
         MVC   DUPCSN2(12,@08),CSN2USM(@04)                        0563
*         END;                      /*                       @Y30LB25*/
*                                                                  0564
*       /*************************************************************/
*       /*                                                           */
*       /* CSN2                                              @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0565
*       ELSE                        /* CSN2                  @Y30LB25*/
*                                                                  0565
*         /***********************************************************/
*         /*                                                         */
*         /* SET LIBID2                                      @Y30LB25*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  0565
*         DO;                       /*                       @Y30LB25*/
         B     @RC00555                                            0565
@RF00555 DS    0H                                                  0566
*           DUPLIB2=DUPLIB2&&DUPLIB2;/* ZERO LIBID2          @Y30LB25*/
         L     @08,DUPVPTR                                         0566
         SLR   @04,@04                                             0566
         IC    @04,DUPLIB2(,@08)                                   0566
         LR    @03,@04                                             0566
         XR    @03,@04                                             0566
         STC   @03,DUPLIB2(,@08)                                   0566
*           IF LUSM1=ON             /* BIT 1 ON?             @Y30LB25*/
*             THEN                  /* YES                   @Y30LB25*/
         TM    LUSM1+8(MESGPTR),B'10000000'                        0567
         BNO   @RF00567                                            0567
*             DUP2BIT1=ON;          /* LIBID2 BIT1 ON        @Y30LB25*/
         OI    DUP2BIT1(@08),B'00000010'                           0568
*           IF LUSM2=ON             /* BIT 2 ON?             @Y30LB25*/
*             THEN                  /* YES                   @Y30LB25*/
@RF00567 TM    LUSM2+8(MESGPTR),B'01000000'                        0569
         BNO   @RF00569                                            0569
*             DUP2BIT2=ON;          /* LIBID2 BIT2 ON        @Y30LB25*/
         L     @08,DUPVPTR                                         0570
         OI    DUP2BIT2(@08),B'00000001'                           0570
*           DUPCSN1=CSN2USM;        /* SET FIRST CSN         @ZM31119*/
@RF00569 L     @08,DUPVPTR                                         0571
         LA    @04,8                                               0571
         ALR   @04,MESGPTR                                         0571
         MVC   DUPCSN1(12,@08),CSN2USM(@04)                        0571
*           DUPCSN2=CSN1USM;        /* SET SECOND CSN        @ZM31119*/
         MVC   DUPCSN2(12,@08),CSN1USM(@04)                        0572
*         END;                      /*                       @Y30LB25*/
*                                                                  0573
*       /*************************************************************/
*       /*                                                           */
*       /* WRITE THE DVR                                     @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0574
*       RPLVTYP=RPLVPUT;            /* WRITE                 @Y30LB25*/
@RC00555 MVI   RPLVTYP(RPLVPTR),X'01'                              0574
*       RESPECIFY                   /*                       @Y30LB25*/
*         RG1 RSTD;                 /* RESTRICT REG 1        @Y30LB25*/
*       RG1=RPLVPTR;                /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         0576
*       CALL ICBVIO00;              /* WRITE DVR             @Y30LB25*/
         L     @15,@CV00610                                        0577
         BALR  @14,@15                                             0577
*       RESPECIFY                   /*                       @Y30LB25*/
*         RG1 UNRSTD;               /* UNRESTRICT REG 1      @Y30LB25*/
*       IF RPLVRETC^=FIXZERO        /* CHECK RETN CODE       @Y30LB25*/
*         THEN                      /*                       @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              0579
         N     @08,@CF00815                                        0579
         LTR   @08,@08                                             0579
         BZ    @RF00579                                            0579
*         CALL PLIBMSG;             /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         0580
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00011                                            0581
*     END;                          /*                       @Y30LB25*/
*                                                                  0582
*   /*****************************************************************/
*   /*                                                               */
*   /* OTHER CARTRIDGE PAIRED WITH THE ONE ENTERED MUST      @Y30LB25*/
*   /* NOT MATCH EITHER CSN1 OR CSN2 IN THE DVR.             @Y30LB25*/
*   /* FIND THE NONMATCH BY FINDING WHICH ONE THE CSN        @Y30LB25*/
*   /* ENTERED MATCHES.                                      @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0583
*   IF DUPCSN1^=CSN1USM             /* NO MATCH CSN1?        @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
@RF00553 L     @08,DUPVPTR                                         0583
         LA    @04,8                                               0583
         ALR   @04,MESGPTR                                         0583
         CLC   DUPCSN1(12,@08),CSN1USM(@04)                        0583
         BE    @RF00583                                            0583
*     DO;                           /*                       @Y30LB25*/
*       IVOLKY=DUPCSN1;             /* SAVE CSN1             @Y30LB25*/
         MVC   IVOLKY(12),DUPCSN1(@08)                             0585
*       DUPCSN1=CSN2USM;            /* UPDATE DVR CSN1       @Y30LB25*/
         MVC   DUPCSN1(12,@08),CSN2USM(@04)                        0586
*       DUPLIB1=DUPLIB1&&DUPLIB1;   /* ZERO LIBID1           @Y30LB25*/
         SLR   @03,@03                                             0587
         IC    @03,DUPLIB1(,@08)                                   0587
         LR    @15,@03                                             0587
         XR    @15,@03                                             0587
         STC   @15,DUPLIB1(,@08)                                   0587
*       IF LUSM1=ON                 /* BIT 1 ON?             @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
         TM    LUSM1(@04),B'10000000'                              0588
         BNO   @RF00588                                            0588
*         DUP1BIT1=ON;              /* LIBID1 BIT1 ON        @Y30LB25*/
         OI    DUP1BIT1(@08),B'00000010'                           0589
*       IF LUSM2=ON                 /* BIT 2 ON?             @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
@RF00588 TM    LUSM2+8(MESGPTR),B'01000000'                        0590
         BNO   @RF00590                                            0590
*         DUP2BIT1=ON;              /* LIBID1 BIT2 ON        @Y30LB25*/
         L     @08,DUPVPTR                                         0591
         OI    DUP2BIT1(@08),B'00000010'                           0591
*       CALL DVRCSN1;               /* PROC DVR CSN1 CIR     @Y30LB25*/
@RF00590 BAL   @14,DVRCSN1                                         0592
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00011                                            0593
*     END;                          /*                       @Y30LB25*/
*   ELSE                            /* NO MATCH DVR CSN2     @Y30LB25*/
*     DO;                           /*                       @Y30LB25*/
@RF00583 DS    0H                                                  0596
*       IVOLKY=DUPCSN2;             /* SAVE CSN2             @Y30LB25*/
         L     @08,DUPVPTR                                         0596
         MVC   IVOLKY(12),DUPCSN2(@08)                             0596
*       DUPCSN2=CSN2USM;            /* UPDATE DVR CSN2       @Y30LB25*/
         LA    @04,8                                               0597
         ALR   @04,MESGPTR                                         0597
         MVC   DUPCSN2(12,@08),CSN2USM(@04)                        0597
*       DUPLIB2=DUPLIB2&&DUPLIB2;   /* ZERO LIBID2           @Y30LB25*/
         SLR   @03,@03                                             0598
         IC    @03,DUPLIB2(,@08)                                   0598
         LR    @15,@03                                             0598
         XR    @15,@03                                             0598
         STC   @15,DUPLIB2(,@08)                                   0598
*       IF LUSM1=ON                 /* BIT 1 ON?             @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
         TM    LUSM1(@04),B'10000000'                              0599
         BNO   @RF00599                                            0599
*         DUP2BIT1=ON;              /* LIBID2 BIT1 ON        @Y30LB25*/
         OI    DUP2BIT1(@08),B'00000010'                           0600
*       IF LUSM2=ON                 /* BIT 2 ON?             @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
@RF00599 TM    LUSM2+8(MESGPTR),B'01000000'                        0601
         BNO   @RF00601                                            0601
*         DUP2BIT2=ON;              /* LIBID2 BIT2 ON        @Y30LB25*/
         L     @08,DUPVPTR                                         0602
         OI    DUP2BIT2(@08),B'00000001'                           0602
*       CALL DVRCSN2;               /* PROC DVR CSN2 CIR     @Y30LB25*/
@RF00601 BAL   @14,DVRCSN2                                         0603
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00011                                            0604
*     END;                          /*                       @Y30LB25*/
*   END CKDVR1;                     /*                       @Y30LB25*/
         B     @EL00011                                            0606
*                                                                  0607
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - CKDVR2                               @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* FUNCTION - UPDATE A DVR AND CIR FOR THE CSN OF THE    @Y30LB25*/
*   /* OTHER CARTRIDGE TO THE PAIR FOR THE ONE ENTERED.      @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* INPUT -                                               @Y30LB25*/
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* OUTPUT -                                              @Y30LB25*/
*   /* DUPLICATE VOLUME RECORD                               @Y30LB25*/
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0607
*CKDVR2:                            /*                       @Y30LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/
*                                                                  0607
CKDVR2   ST    @14,@SA00012                                        0607
*   /*****************************************************************/
*   /*                                                               */
*   /* GET THE DVR FROM THE CSN OF THE CARTRIDGE PAIRED      @Y30LB25*/
*   /* WITH THE ONE ENTERED                                  @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0608
*   DKEY=INDRECKY;                  /* DVR KEY               @Y30LB25*/
         MVC   DKEY(13),INDRECKY(INDEXPTR)                         0608
*   RPLVKEY=ADDR(DKEY);             /* ADDR OF KEY           @Y30LB25*/
         LA    @08,DKEY                                            0609
         ST    @08,RPLVKEY(,RPLVPTR)                               0609
*   RPLVBUF=DUPVPTR;                /* PT TO DVR BUF         @Y30LB25*/
         L     @08,DUPVPTR                                         0610
         ST    @08,RPLVBUF(,RPLVPTR)                               0610
*   RPLVBLN=LENGTH(DUPVBUF);        /* SET DVR BUF LENGTH    @Y30LB25*/
         MVC   RPLVBLN(4,RPLVPTR),@CF00804                         0611
*   RPLVTYP=RPLVREAD;               /* READ OPTION ON        @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'00'                              0612
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB25*/
         OI    RPLVDIR(RPLVPTR),B'01000000'                        0613
*   RPLVUPD=ON;                     /* READ FOR UPDATE       @Y30LB25*/
         OI    RPLVUPD(RPLVPTR),B'00000010'                        0614
*   RPLVLOC=OFF;                    /* NO LOCATE             @Y30LB25*/
         NI    RPLVLOC(RPLVPTR),B'01111111'                        0615
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         0617
*   CALL ICBVIO00;                  /* READ FOR DVR          @Y30LB25*/
         L     @15,@CV00610                                        0618
         BALR  @14,@15                                             0618
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              0620
         N     @08,@CF00815                                        0620
         LTR   @08,@08                                             0620
         BZ    @RF00620                                            0620
*     DO;                           /* NO REC FND            @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         0622
*       RETURN;                     /*                       @Y30LB25*/
@EL00012 DS    0H                                                  0623
@EF00012 DS    0H                                                  0623
@ER00012 L     @14,@SA00012                                        0623
         BR    @14                                                 0623
*     END;                          /*                       @Y30LB25*/
*                                                                  0624
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR CORRECT RECORD                              @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0625
*   IF(CSN1USM=DUPCSN1&CSN2USM=DUPCSN2)×/* ALL CSNS MATCH?   @Y30LB25*/
*       (CSN1USM=DUPCSN2&CSN2USM=DUPCSN1)/*                  @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
@RF00620 LA    @08,8                                               0625
         ALR   @08,MESGPTR                                         0625
         L     @04,DUPVPTR                                         0625
         CLC   CSN1USM(12,@08),DUPCSN1(@04)                        0625
         BNE   @GL00012                                            0625
         CLC   CSN2USM(12,@08),DUPCSN2(@04)                        0625
         BE    @RT00625                                            0625
@GL00012 LA    @08,8                                               0625
         ALR   @08,MESGPTR                                         0625
         L     @04,DUPVPTR                                         0625
         CLC   CSN1USM(12,@08),DUPCSN2(@04)                        0625
         BNE   @RF00625                                            0625
         CLC   CSN2USM(12,@08),DUPCSN1(@04)                        0625
         BNE   @RF00625                                            0625
@RT00625 DS    0H                                                  0626
*     DO;                           /*                       @Y30LB25*/
*                                                                  0626
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK FOR CSN1                                    @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0627
*       IF SEQNUM=ONEF1             /* CSN1?                 @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
         LA    @08,8                                               0627
         ALR   @08,MESGPTR                                         0627
         CLI   SEQNUM(@08),X'F1'                                   0627
         BNE   @RF00627                                            0627
*         DO;                       /*                       @Y30LB25*/
*                                                                  0628
*           /*********************************************************/
*           /*                                                       */
*           /* SET LIBID1                                    @Y30LB25*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  0629
*           DUPLIB1=DUPLIB1&&DUPLIB1;/* ZERO LIBID1          @Y30LB25*/
         L     @04,DUPVPTR                                         0629
         SLR   @03,@03                                             0629
         IC    @03,DUPLIB1(,@04)                                   0629
         LR    @15,@03                                             0629
         XR    @15,@03                                             0629
         STC   @15,DUPLIB1(,@04)                                   0629
*           IF LUSM1=ON             /* BIT 1 ON?             @Y30LB25*/
*             THEN                  /* YES                   @Y30LB25*/
         TM    LUSM1(@08),B'10000000'                              0630
         BNO   @RF00630                                            0630
*             DUP1BIT1=ON;          /* LIBID1 BIT1 ON        @Y30LB25*/
         OI    DUP1BIT1(@04),B'00000010'                           0631
*           IF LUSM2=ON             /* BIT 2 ON?             @Y30LB25*/
*             THEN                  /* YES                   @Y30LB25*/
@RF00630 TM    LUSM2+8(MESGPTR),B'01000000'                        0632
         BNO   @RF00632                                            0632
*             DUP1BIT2=ON;          /* LIBID1 BIT2 ON        @Y30LB25*/
         L     @08,DUPVPTR                                         0633
         OI    DUP1BIT2(@08),B'00000001'                           0633
*           DUPCSN1=CSN1USM;        /* SET FIRST CSN         @ZM31119*/
@RF00632 L     @08,DUPVPTR                                         0634
         LA    @04,8                                               0634
         ALR   @04,MESGPTR                                         0634
         MVC   DUPCSN1(12,@08),CSN1USM(@04)                        0634
*           DUPCSN2=CSN2USM;        /* SET SECOND CSN        @ZM31119*/
         MVC   DUPCSN2(12,@08),CSN2USM(@04)                        0635
*         END;                      /*                       @Y30LB25*/
*                                                                  0636
*       /*************************************************************/
*       /*                                                           */
*       /* CSN2                                              @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0637
*       ELSE                        /* CSN2                  @Y30LB25*/
*                                                                  0637
*         /***********************************************************/
*         /*                                                         */
*         /* SET LIBID2                                      @Y30LB25*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  0637
*         DO;                       /*                       @Y30LB25*/
         B     @RC00627                                            0637
@RF00627 DS    0H                                                  0638
*           DUPLIB2=DUPLIB2&&DUPLIB2;/* ZERO LIBID2          @Y30LB25*/
         L     @08,DUPVPTR                                         0638
         SLR   @04,@04                                             0638
         IC    @04,DUPLIB2(,@08)                                   0638
         LR    @03,@04                                             0638
         XR    @03,@04                                             0638
         STC   @03,DUPLIB2(,@08)                                   0638
*           IF LUSM1=ON             /* BIT 1 ON?             @Y30LB25*/
*             THEN                  /* YES                   @Y30LB25*/
         TM    LUSM1+8(MESGPTR),B'10000000'                        0639
         BNO   @RF00639                                            0639
*             DUP2BIT1=ON;          /* LIBID2 BIT1 ON        @Y30LB25*/
         OI    DUP2BIT1(@08),B'00000010'                           0640
*           IF LUSM2=ON             /* BIT 2 ON?             @Y30LB25*/
*             THEN                  /* YES                   @Y30LB25*/
@RF00639 TM    LUSM2+8(MESGPTR),B'01000000'                        0641
         BNO   @RF00641                                            0641
*             DUP2BIT2=ON;          /* LIBID2 BIT2 ON        @Y30LB25*/
         L     @08,DUPVPTR                                         0642
         OI    DUP2BIT2(@08),B'00000001'                           0642
*           DUPCSN1=CSN2USM;        /* SET FIRST CSN         @ZM31119*/
@RF00641 L     @08,DUPVPTR                                         0643
         LA    @04,8                                               0643
         ALR   @04,MESGPTR                                         0643
         MVC   DUPCSN1(12,@08),CSN2USM(@04)                        0643
*           DUPCSN2=CSN1USM;        /* SET SECOND CSN        @ZM31119*/
         MVC   DUPCSN2(12,@08),CSN1USM(@04)                        0644
*         END;                      /*                       @Y30LB25*/
*                                                                  0645
*       /*************************************************************/
*       /*                                                           */
*       /* WRITE THE DVR                                     @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0646
*       RPLVTYP=RPLVPUT;            /* WRITE                 @Y30LB25*/
@RC00627 MVI   RPLVTYP(RPLVPTR),X'01'                              0646
*       RESPECIFY                   /*                       @Y30LB25*/
*         RG1 RSTD;                 /* RESTRICT REG 1        @Y30LB25*/
*       RG1=RPLVPTR;                /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         0648
*       CALL ICBVIO00;              /* WRITE DVR             @Y30LB25*/
         L     @15,@CV00610                                        0649
         BALR  @14,@15                                             0649
*       RESPECIFY                   /*                       @Y30LB25*/
*         RG1 UNRSTD;               /* UNRESTRICT REG 1      @Y30LB25*/
*       IF RPLVRETC^=FIXZERO        /* CHECK RETN CODE       @Y30LB25*/
*         THEN                      /*                       @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              0651
         N     @08,@CF00815                                        0651
         LTR   @08,@08                                             0651
         BZ    @RF00651                                            0651
*         CALL PLIBMSG;             /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         0652
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00012                                            0653
*     END;                          /*                       @Y30LB25*/
*                                                                  0654
*   /*****************************************************************/
*   /*                                                               */
*   /* THE CARTRIDGE ENTERED MUST NOT MATCH WITH EITHER      @Y30LB25*/
*   /* CSN1 OR CSN2 IN THE DVR.                              @Y30LB25*/
*   /* FIND THE NONMATCH BY FINDING WHICH ONE THE CSN NOT    @Y30LB25*/
*   /* ENTERED MATCHES.                                      @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0655
*   IF DUPCSN1^=CSN2USM             /* NO MATCH CSN2?        @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
@RF00625 L     @08,DUPVPTR                                         0655
         LA    @04,8                                               0655
         ALR   @04,MESGPTR                                         0655
         CLC   DUPCSN1(12,@08),CSN2USM(@04)                        0655
         BE    @RF00655                                            0655
*     DO;                           /*                       @Y30LB25*/
*       IVOLKY=DUPCSN1;             /* SAVE CSN1             @Y30LB25*/
         MVC   IVOLKY(12),DUPCSN1(@08)                             0657
*       DUPCSN1=CSN1USM;            /* UPDATE DVR CSN1       @Y30LB25*/
         MVC   DUPCSN1(12,@08),CSN1USM(@04)                        0658
*       DUPLIB1=DUPLIB1&&DUPLIB1;   /* ZERO LIBID1           @Y30LB25*/
         SLR   @03,@03                                             0659
         IC    @03,DUPLIB1(,@08)                                   0659
         LR    @15,@03                                             0659
         XR    @15,@03                                             0659
         STC   @15,DUPLIB1(,@08)                                   0659
*       IF LUSM1=ON                 /* BIT 1 ON?             @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
         TM    LUSM1(@04),B'10000000'                              0660
         BNO   @RF00660                                            0660
*         DUP1BIT1=ON;              /* LIBID1 BIT1 ON        @Y30LB25*/
         OI    DUP1BIT1(@08),B'00000010'                           0661
*       IF LUSM2=ON                 /* BIT 2 ON?             @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
@RF00660 TM    LUSM2+8(MESGPTR),B'01000000'                        0662
         BNO   @RF00662                                            0662
*         DUP1BIT2=ON;              /* LIBID1 BIT2 ON        @Y30LB25*/
         L     @08,DUPVPTR                                         0663
         OI    DUP1BIT2(@08),B'00000001'                           0663
*       CALL DVRCSN1;               /* PROC DVR CSN1 CIR     @Y30LB25*/
@RF00662 BAL   @14,DVRCSN1                                         0664
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00012                                            0665
*     END;                          /*                       @Y30LB25*/
*   ELSE                            /* NO MATCH DVR CSN2     @Y30LB25*/
*     DO;                           /*                       @Y30LB25*/
@RF00655 DS    0H                                                  0668
*       IVOLKY=DUPCSN2;             /* SAVE CSN2             @Y30LB25*/
         L     @08,DUPVPTR                                         0668
         MVC   IVOLKY(12),DUPCSN2(@08)                             0668
*       DUPCSN2=CSN1USM;            /* UPDATE DVR CSN1       @Y30LB25*/
         LA    @04,8                                               0669
         ALR   @04,MESGPTR                                         0669
         MVC   DUPCSN2(12,@08),CSN1USM(@04)                        0669
*       DUPLIB2=DUPLIB2&&DUPLIB2;   /* ZERO LIBID2           @Y30LB25*/
         SLR   @03,@03                                             0670
         IC    @03,DUPLIB2(,@08)                                   0670
         LR    @15,@03                                             0670
         XR    @15,@03                                             0670
         STC   @15,DUPLIB2(,@08)                                   0670
*       IF LUSM1=ON                 /* BIT 1 ON?             @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
         TM    LUSM1(@04),B'10000000'                              0671
         BNO   @RF00671                                            0671
*         DUP2BIT1=ON;              /* LIBID2 BIT1 ON        @Y30LB25*/
         OI    DUP2BIT1(@08),B'00000010'                           0672
*       IF LUSM2=ON                 /* BIT 2 ON?             @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
@RF00671 TM    LUSM2+8(MESGPTR),B'01000000'                        0673
         BNO   @RF00673                                            0673
*         DUP2BIT2=ON;              /* LIBID2 BIT2 ON        @Y30LB25*/
         L     @08,DUPVPTR                                         0674
         OI    DUP2BIT2(@08),B'00000001'                           0674
*       CALL DVRCSN2;               /* PROC DVR CSN2 CIR     @Y30LB25*/
@RF00673 BAL   @14,DVRCSN2                                         0675
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00012                                            0676
*     END;                          /*                       @Y30LB25*/
*   END CKDVR2;                     /*                       @Y30LB25*/
         B     @EL00012                                            0678
*                                                                  0679
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - DVRCSN1                              @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* FUNCTION - WRITE THE DVR.                             @Y30LB25*/
*   /* READ FOR CIR OF REPLACED CSN1.                        @Y30LB25*/
*   /* IF THERE IS NOT ONE OR IT DOES NOT POINT TO THE       @Y30LB25*/
*   /* DVR, CREATE A NEW CIR FOR CSN1 OF DVR AND RETURN.     @Y30LB25*/
*   /* OTHERWISE, CREATE A NEW CIR FOR THE NEW CSN1          @Y30LB25*/
*   /* AND DELETE THE OLD CSN.                               @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* INPUT -                                               @Y30LB25*/
*   /* DUPLICATE VOLUME RECORD                               @Y30LB25*/
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* OUTPUT -                                              @Y30LB25*/
*   /* DUPLICATE VOLUME RECORD                               @Y30LB25*/
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0679
*DVRCSN1:                           /*                       @Y30LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/
*                                                                  0679
DVRCSN1  ST    @14,@SA00013                                        0679
*   /*****************************************************************/
*   /*                                                               */
*   /* WRITE THE DVR FOR THE CARTRIDGE ENTERED               @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0680
*   RPLVTYP=RPLVPUT;                /* WRITE                 @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'01'                              0680
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         0682
*   CALL ICBVIO00;                  /* WRITE DVR             @Y30LB25*/
         L     @15,@CV00610                                        0683
         BALR  @14,@15                                             0683
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              0685
         N     @08,@CF00815                                        0685
         LTR   @08,@08                                             0685
         BZ    @RF00685                                            0685
*     DO;                           /* NO REC FND            @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         0687
*       RETURN;                     /*                       @Y30LB25*/
@EL00013 DS    0H                                                  0688
@EF00013 DS    0H                                                  0688
@ER00013 L     @14,@SA00013                                        0688
         BR    @14                                                 0688
*     END;                          /*                       @Y30LB25*/
*                                                                  0689
*   /*****************************************************************/
*   /*                                                               */
*   /* READ FOR CIR OF REPLACED CSN1 OF THE DVR              @Y30LB25*/
*   /* IVOLKY CAN BE BLANKS FOR A NEWLY CREATED DVR.         @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0690
*   RPLVTYP=RPLVREAD;               /* READ                  @Y30LB25*/
@RF00685 MVI   RPLVTYP(RPLVPTR),X'00'                              0690
*   RPLVLOC=OFF;                    /* NO LOCATE             @Y30LB25*/
         NI    RPLVLOC(RPLVPTR),B'01111111'                        0691
*   RPLVUPD=ON;                     /* UPDATE                @Y30LB25*/
         OI    RPLVUPD(RPLVPTR),B'00000010'                        0692
*   RPLVDIR=ON;                     /* DIRECT                @Y30LB25*/
         OI    RPLVDIR(RPLVPTR),B'01000000'                        0693
*   RPLVKEY=ADDR(IKEY);             /* ADDR OF KEY           @Y30LB25*/
         LA    @08,IKEY                                            0694
         ST    @08,RPLVKEY(,RPLVPTR)                               0694
*   RPLVBUF=INDEXPTR;               /* PTR TO CIR BUF        @Y30LB25*/
         ST    INDEXPTR,RPLVBUF(,RPLVPTR)                          0695
*   RPLVBLN=LENGTH(INDEXBUF);       /* CIR BUF LENGTH        @Y30LB25*/
         MVC   RPLVBLN(4,RPLVPTR),@CF00806                         0696
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         0698
*   CALL ICBVIO00;                  /* READ CIR              @Y30LB25*/
         L     @15,@CV00610                                        0699
         BALR  @14,@15                                             0699
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLRCODE=IOERROR             /* CK REASON CODE        @Y30LB25*/
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/
         CLC   RPLRCODE(2,RPLVPTR),@CB00588                        0701
         BNE   @RF00701                                            0701
*     DO;                           /* NO REC FND            @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         0703
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00013                                            0704
*     END;                          /*                       @Y30LB25*/
*                                                                  0705
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK THE RECORD, IF ANY                              @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0706
*   IF RPLRCODE=NORECFND×INDVSRNO^=DUPSERNO/*                @Y30LB25
*                                      NO RECORD FND OR      @Y30LB25
*                                      WRONG SERIAL NO?      @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
@RF00701 CLC   RPLRCODE(2,RPLVPTR),@CB00586                        0706
         BE    @RT00706                                            0706
         L     @08,DUPVPTR                                         0706
         CLC   INDVSRNO(6,INDEXPTR),DUPSERNO(@08)                  0706
         BE    @RF00706                                            0706
@RT00706 DS    0H                                                  0707
*     DO;                           /*                       @Y30LB25*/
*                                                                  0707
*       /*************************************************************/
*       /*                                                           */
*       /* CREATE A CIR FOR CSN1                             @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0708
*       CSNUMBER=ON;                /* CSN1                  @Y30LB25*/
         OI    CSNUMBER,B'00000100'                                0708
*       BCDVPTR=DUPVPTR;            /* DVR PTR               @Y30LB25*/
         L     @08,DUPVPTR                                         0709
         ST    @08,BCDVPTR                                         0709
*       CALL VUCIR;                 /*                       @Y30LB25
*                                      MAKE CIR FOR CSN1     @Y30LB25*/
         BAL   @14,VUCIR                                           0710
*       IF RPLVRETC^=FIXZERO        /* CK RETURN CODE        @Y30LB25*/
*         THEN                      /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              0711
         N     @08,@CF00815                                        0711
         LTR   @08,@08                                             0711
         BZ    @RF00711                                            0711
*         CALL PLIBMSG;             /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         0712
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00013                                            0713
*     END;                          /*                       @Y30LB25*/
*                                                                  0714
*   /*****************************************************************/
*   /*                                                               */
*   /* DELETE CIR FOR THE REPLACED CSN1                      @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0715
*   RPLVTYP=RPLVDEL;                /* DELETE                @Y30LB25*/
@RF00706 MVI   RPLVTYP(RPLVPTR),X'05'                              0715
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         0717
*   CALL ICBVIO00;                  /* DELETE CIR            @Y30LB25*/
         L     @15,@CV00610                                        0718
         BALR  @14,@15                                             0718
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              0720
         N     @08,@CF00815                                        0720
         LTR   @08,@08                                             0720
         BZ    @RF00720                                            0720
*     DO;                           /* NO REC FND            @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         0722
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00013                                            0723
*     END;                          /*                       @Y30LB25*/
*                                                                  0724
*   /*****************************************************************/
*   /*                                                               */
*   /* CREATE A CIR FOR CSN1                                 @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0725
*   CSNUMBER=ON;                    /* CSN1                  @Y30LB25*/
@RF00720 OI    CSNUMBER,B'00000100'                                0725
*   BCDVPTR=DUPVPTR;                /* DVR PTR               @Y30LB25*/
         L     @08,DUPVPTR                                         0726
         ST    @08,BCDVPTR                                         0726
*   CALL VUCIR;                     /*                       @Y30LB25
*                                      MAKE CIR FOR CSN1     @Y30LB25*/
         BAL   @14,VUCIR                                           0727
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/
*     THEN                          /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              0728
         N     @08,@CF00815                                        0728
         LTR   @08,@08                                             0728
         BZ    @RF00728                                            0728
*     CALL PLIBMSG;                 /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         0729
*   RETURN;                         /*                       @Y30LB25*/
         B     @EL00013                                            0730
*   END DVRCSN1;                    /*                       @Y30LB25*/
         B     @EL00013                                            0731
*                                                                  0732
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - DVRCSN2                              @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* FUNCTION - WRITE THE DVR.                             @Y30LB25*/
*   /* READ FOR CIR OF REPLACED CSN2.                        @Y30LB25*/
*   /* IF THERE IS NOT ONE OR IT DOES NOT POINT TO THE       @Y30LB25*/
*   /* DVR, CREATE A NEW CIR FOR CSN2 OF DVR AND RETURN.     @Y30LB25*/
*   /* OTHERWISE, CREATE A NEW CIR FOR THE NEW CSN2          @Y30LB25*/
*   /* AND DELETE THE OLD CSN.                               @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* INPUT -                                               @Y30LB25*/
*   /* DUPLICATE VOLUME RECORD                               @Y30LB25*/
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* OUTPUT -                                              @Y30LB25*/
*   /* DUPLICATE VOLUME RECORD                               @Y30LB25*/
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0732
*DVRCSN2:                           /*                       @Y30LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/
*                                                                  0732
DVRCSN2  ST    @14,@SA00014                                        0732
*   /*****************************************************************/
*   /*                                                               */
*   /* WRITE THE DVR FOR THE CARTRIDGE PAIRED WITH THE       @Y30LB25*/
*   /* ONE ENTERED                                           @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0733
*   RPLVTYP=RPLVPUT;                /* WRITE                 @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'01'                              0733
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         0735
*   CALL ICBVIO00;                  /* WRITE DVR             @Y30LB25*/
         L     @15,@CV00610                                        0736
         BALR  @14,@15                                             0736
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              0738
         N     @08,@CF00815                                        0738
         LTR   @08,@08                                             0738
         BZ    @RF00738                                            0738
*     DO;                           /* NO REC FND            @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         0740
*       RETURN;                     /*                       @Y30LB25*/
@EL00014 DS    0H                                                  0741
@EF00014 DS    0H                                                  0741
@ER00014 L     @14,@SA00014                                        0741
         BR    @14                                                 0741
*     END;                          /*                       @Y30LB25*/
*                                                                  0742
*   /*****************************************************************/
*   /*                                                               */
*   /* READ FOR CIR OF REPLACED CSN2 OF THE DVR              @Y30LB25*/
*   /* IVOLKY CAN BE BLANKS FOR A NEWLY CREATED DVR.         @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0743
*   RPLVTYP=RPLVREAD;               /* READ                  @Y30LB25*/
@RF00738 MVI   RPLVTYP(RPLVPTR),X'00'                              0743
*   RPLVLOC=OFF;                    /* NO LOCATE             @Y30LB25*/
         NI    RPLVLOC(RPLVPTR),B'01111111'                        0744
*   RPLVUPD=ON;                     /* UPDATE                @Y30LB25*/
         OI    RPLVUPD(RPLVPTR),B'00000010'                        0745
*   RPLVDIR=ON;                     /* DIRECT                @Y30LB25*/
         OI    RPLVDIR(RPLVPTR),B'01000000'                        0746
*   RPLVKEY=ADDR(IKEY);             /* ADDR OF KEY           @Y30LB25*/
         LA    @08,IKEY                                            0747
         ST    @08,RPLVKEY(,RPLVPTR)                               0747
*   RPLVBUF=INDEXPTR;               /* PTR TO CIR BUF        @Y30LB25*/
         ST    INDEXPTR,RPLVBUF(,RPLVPTR)                          0748
*   RPLVBLN=LENGTH(INDEXBUF);       /* CIR BUF LENGTH        @Y30LB25*/
         MVC   RPLVBLN(4,RPLVPTR),@CF00806                         0749
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         0751
*   CALL ICBVIO00;                  /* READ CIR              @Y30LB25*/
         L     @15,@CV00610                                        0752
         BALR  @14,@15                                             0752
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLRCODE=IOERROR             /* CK REASON CODE        @Y30LB25*/
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/
         CLC   RPLRCODE(2,RPLVPTR),@CB00588                        0754
         BNE   @RF00754                                            0754
*     DO;                           /* NO REC FND            @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         0756
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00014                                            0757
*     END;                          /*                       @Y30LB25*/
*                                                                  0758
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK THE RECORD, IF ANY                              @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0759
*   IF RPLRCODE=NORECFND×INDVSRNO^=DUPSERNO/*                @Y30LB25
*                                      NO RECORD FND OR      @Y30LB25
*                                      WRONG SERIAL NO?      @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
@RF00754 CLC   RPLRCODE(2,RPLVPTR),@CB00586                        0759
         BE    @RT00759                                            0759
         L     @08,DUPVPTR                                         0759
         CLC   INDVSRNO(6,INDEXPTR),DUPSERNO(@08)                  0759
         BE    @RF00759                                            0759
@RT00759 DS    0H                                                  0760
*     DO;                           /*                       @Y30LB25*/
*                                                                  0760
*       /*************************************************************/
*       /*                                                           */
*       /* CREATE A CIR FOR CSN2                             @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0761
*       CSNUMBER=OFF;               /* CSN2                  @Y30LB25*/
         NI    CSNUMBER,B'11111011'                                0761
*       BCDVPTR=DUPVPTR;            /* DVR PTR               @Y30LB25*/
         L     @08,DUPVPTR                                         0762
         ST    @08,BCDVPTR                                         0762
*       CALL VUCIR;                 /*                       @Y30LB25
*                                      MAKE CIR FOR CSN2     @Y30LB25*/
         BAL   @14,VUCIR                                           0763
*       IF RPLVRETC^=FIXZERO        /* CK RETURN CODE        @Y30LB25*/
*         THEN                      /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              0764
         N     @08,@CF00815                                        0764
         LTR   @08,@08                                             0764
         BZ    @RF00764                                            0764
*         CALL PLIBMSG;             /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         0765
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00014                                            0766
*     END;                          /*                       @Y30LB25*/
*                                                                  0767
*   /*****************************************************************/
*   /*                                                               */
*   /* DELETE CIR FOR THE REPLACED CSN2                      @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0768
*   RPLVTYP=RPLVDEL;                /* DELETE                @Y30LB25*/
@RF00759 MVI   RPLVTYP(RPLVPTR),X'05'                              0768
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         0770
*   CALL ICBVIO00;                  /* DELETE CIR            @Y30LB25*/
         L     @15,@CV00610                                        0771
         BALR  @14,@15                                             0771
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              0773
         N     @08,@CF00815                                        0773
         LTR   @08,@08                                             0773
         BZ    @RF00773                                            0773
*     DO;                           /* NO REC FND            @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         0775
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00014                                            0776
*     END;                          /*                       @Y30LB25*/
*                                                                  0777
*   /*****************************************************************/
*   /*                                                               */
*   /* CREATE A CIR FOR CSN2                                 @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0778
*   CSNUMBER=OFF;                   /* CSN2                  @Y30LB25*/
@RF00773 NI    CSNUMBER,B'11111011'                                0778
*   BCDVPTR=DUPVPTR;                /* DVR PTR               @Y30LB25*/
         L     @08,DUPVPTR                                         0779
         ST    @08,BCDVPTR                                         0779
*   CALL VUCIR;                     /*                       @Y30LB25
*                                      MAKE CIR FOR CSN2     @Y30LB25*/
         BAL   @14,VUCIR                                           0780
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/
*     THEN                          /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              0781
         N     @08,@CF00815                                        0781
         LTR   @08,@08                                             0781
         BZ    @RF00781                                            0781
*     CALL PLIBMSG;                 /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         0782
*   RETURN;                         /*                       @Y30LB25*/
         B     @EL00014                                            0783
*   END DVRCSN2;                    /*                       @Y30LB25*/
         B     @EL00014                                            0784
*                                                                  0785
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - CKBVR1                               @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* FUNCTION - UPDATE A BVR AND CIR FOR THE CSN OF THE    @Y30LB25*/
*   /* CARTRIDGE ENTERED.                                    @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* INPUT -                                               @Y30LB25*/
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* OUTPUT -                                              @Y30LB25*/
*   /* BASE VOLUME RECORD                                    @Y30LB25*/
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0785
*CKBVR1:                            /*                       @Y30LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/
*                                                                  0785
CKBVR1   ST    @14,@SA00015                                        0785
*   /*****************************************************************/
*   /*                                                               */
*   /* GET THE BVR FROM THE CSN OF THE CARTRIDGE ENTERED     @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0786
*   BKEY=INDRECKY;                  /* BVR KEY               @Y30LB25*/
         MVC   BKEY(13),INDRECKY(INDEXPTR)                         0786
*   RPLVKEY=ADDR(BKEY);             /* ADDR OF KEY           @Y30LB25*/
         LA    @08,BKEY                                            0787
         ST    @08,RPLVKEY(,RPLVPTR)                               0787
*   RPLVBUF=BASEVPTR;               /* PT TO BVR BUF         @Y30LB25*/
         L     @08,BASEVPTR                                        0788
         ST    @08,RPLVBUF(,RPLVPTR)                               0788
*   RPLVBLN=LENGTH(BASEBUF);        /* SET BVR BUF LENGTH    @Y30LB25*/
         MVC   RPLVBLN(4,RPLVPTR),@CF00804                         0789
*   RPLVTYP=RPLVREAD;               /* READ OPTION ON        @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'00'                              0790
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB25*/
         OI    RPLVDIR(RPLVPTR),B'01000000'                        0791
*   RPLVUPD=ON;                     /* READ FOR UPDATE       @Y30LB25*/
         OI    RPLVUPD(RPLVPTR),B'00000010'                        0792
*   RPLVLOC=OFF;                    /* NO LOCATE             @Y30LB25*/
         NI    RPLVLOC(RPLVPTR),B'01111111'                        0793
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         0795
*   CALL ICBVIO00;                  /* READ FOR BVR          @Y30LB25*/
         L     @15,@CV00610                                        0796
         BALR  @14,@15                                             0796
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              0798
         N     @08,@CF00815                                        0798
         LTR   @08,@08                                             0798
         BZ    @RF00798                                            0798
*     DO;                           /* NO REC FND            @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         0800
*       RETURN;                     /*                       @Y30LB25*/
@EL00015 DS    0H                                                  0801
@EF00015 DS    0H                                                  0801
@ER00015 L     @14,@SA00015                                        0801
         BR    @14                                                 0801
*     END;                          /*                       @Y30LB25*/
*                                                                  0802
*   /*****************************************************************/
*   /*                                                               */
*   /* SET THE DOWN LEVEL SPACE FLAGE                        @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0803
*   BASDLSF=ON;                     /* DOWN LEVEL SPACE      @Y30LB25*/
*                                                                  0803
@RF00798 L     @08,BASEVPTR                                        0803
         OI    BASDLSF(@08),B'10000000'                            0803
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR CORRECT RECORD                              @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0804
*   IF(CSN1USM=BASCSN1&CSN2USM=BASCSN2)×/* ALL CSNS MATCH?   @Y30LB25*/
*       (CSN1USM=BASCSN2&CSN2USM=BASCSN1)/*                  @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
         LA    @04,8                                               0804
         ALR   @04,MESGPTR                                         0804
         CLC   CSN1USM(12,@04),BASCSN1(@08)                        0804
         BNE   @GL00017                                            0804
         CLC   CSN2USM(12,@04),BASCSN2(@08)                        0804
         BE    @RT00804                                            0804
@GL00017 LA    @08,8                                               0804
         ALR   @08,MESGPTR                                         0804
         L     @04,BASEVPTR                                        0804
         CLC   CSN1USM(12,@08),BASCSN2(@04)                        0804
         BNE   @RF00804                                            0804
         CLC   CSN2USM(12,@08),BASCSN1(@04)                        0804
         BNE   @RF00804                                            0804
@RT00804 DS    0H                                                  0805
*     DO;                           /*                       @Y30LB25*/
*                                                                  0805
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK FOR CSN1                                    @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0806
*       IF SEQNUM=ONEF1             /* CSN1?                 @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
         LA    @08,8                                               0806
         ALR   @08,MESGPTR                                         0806
         CLI   SEQNUM(@08),X'F1'                                   0806
         BNE   @RF00806                                            0806
*         DO;                       /*                       @Y30LB25*/
*                                                                  0807
*           /*********************************************************/
*           /*                                                       */
*           /* SET LIBID1                                    @Y30LB25*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  0808
*           BASLIB1=BASLIB1&&BASLIB1;/* ZERO LIBID1          @Y30LB25*/
         L     @04,BASEVPTR                                        0808
         SLR   @03,@03                                             0808
         IC    @03,BASLIB1(,@04)                                   0808
         LR    @15,@03                                             0808
         XR    @15,@03                                             0808
         STC   @15,BASLIB1(,@04)                                   0808
*           IF LUSM1=ON             /* BIT 1 ON?             @Y30LB25*/
*             THEN                  /* YES                   @Y30LB25*/
         TM    LUSM1(@08),B'10000000'                              0809
         BNO   @RF00809                                            0809
*             BAS1BIT1=ON;          /* LIBID1 BIT1 ON        @Y30LB25*/
         OI    BAS1BIT1(@04),B'00000010'                           0810
*           IF LUSM2=ON             /* BIT 2 ON?             @Y30LB25*/
*             THEN                  /* YES                   @Y30LB25*/
@RF00809 TM    LUSM2+8(MESGPTR),B'01000000'                        0811
         BNO   @RF00811                                            0811
*             BAS1BIT2=ON;          /* LIBID1 BIT2 ON        @Y30LB25*/
         L     @08,BASEVPTR                                        0812
         OI    BAS1BIT2(@08),B'00000001'                           0812
*           BASCSN1=CSN1USM;        /* SET FIRST CSN         @ZM31119*/
@RF00811 L     @08,BASEVPTR                                        0813
         LA    @04,8                                               0813
         ALR   @04,MESGPTR                                         0813
         MVC   BASCSN1(12,@08),CSN1USM(@04)                        0813
*           BASCSN2=CSN2USM;        /* SET SECOND CSN        @ZM31119*/
         MVC   BASCSN2(12,@08),CSN2USM(@04)                        0814
*         END;                      /*                       @Y30LB25*/
*                                                                  0815
*       /*************************************************************/
*       /*                                                           */
*       /* CSN2                                              @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0816
*       ELSE                        /* CSN2                  @Y30LB25*/
*                                                                  0816
*         /***********************************************************/
*         /*                                                         */
*         /* SET LIBID2                                      @Y30LB25*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  0816
*         DO;                       /*                       @Y30LB25*/
         B     @RC00806                                            0816
@RF00806 DS    0H                                                  0817
*           BASLIB2=BASLIB2&&BASLIB2;/* ZERO LIBID2          @Y30LB25*/
         L     @08,BASEVPTR                                        0817
         SLR   @04,@04                                             0817
         IC    @04,BASLIB2(,@08)                                   0817
         LR    @03,@04                                             0817
         XR    @03,@04                                             0817
         STC   @03,BASLIB2(,@08)                                   0817
*           IF LUSM1=ON             /* BIT 1 ON?             @Y30LB25*/
*             THEN                  /* YES                   @Y30LB25*/
         TM    LUSM1+8(MESGPTR),B'10000000'                        0818
         BNO   @RF00818                                            0818
*             BAS2BIT1=ON;          /* LIBID2 BIT1 ON        @Y30LB25*/
         OI    BAS2BIT1(@08),B'00000010'                           0819
*           IF LUSM2=ON             /* BIT 2 ON?             @Y30LB25*/
*             THEN                  /* YES                   @Y30LB25*/
@RF00818 TM    LUSM2+8(MESGPTR),B'01000000'                        0820
         BNO   @RF00820                                            0820
*             BAS2BIT2=ON;          /* LIBID2 BIT2 ON        @Y30LB25*/
         L     @08,BASEVPTR                                        0821
         OI    BAS2BIT2(@08),B'00000001'                           0821
*           BASCSN1=CSN2USM;        /* SET FIRST CSN         @ZM31119*/
@RF00820 L     @08,BASEVPTR                                        0822
         LA    @04,8                                               0822
         ALR   @04,MESGPTR                                         0822
         MVC   BASCSN1(12,@08),CSN2USM(@04)                        0822
*           BASCSN2=CSN1USM;        /* SET SECOND CSN        @ZM31119*/
         MVC   BASCSN2(12,@08),CSN1USM(@04)                        0823
*         END;                      /*                       @Y30LB25*/
*                                                                  0824
*       /*************************************************************/
*       /*                                                           */
*       /* UPDATE THE BVR                                    @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0825
*       BASDTREM=BLANK4;            /* NULL DATE REMOVED     @Y30LB25*/
@RC00806 L     @08,BASEVPTR                                        0825
         MVI   BASDTREM+1(@08),C' '                                0825
         MVC   BASDTREM+2(2,@08),BASDTREM+1(@08)                   0825
         MVI   BASDTREM(@08),C' '                                  0825
*       BASDEST=BLANK30;            /* NULL DESTINATION      @Y30LB25*/
*                                                                  0826
         MVI   BASDEST+1(@08),C' '                                 0826
         MVC   BASDEST+2(28,@08),BASDEST+1(@08)                    0826
         MVI   BASDEST(@08),C' '                                   0826
*       /*************************************************************/
*       /*                                                           */
*       /* WRITE THE BVR                                     @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0827
*       RPLVTYP=RPLVPUT;            /* WRITE                 @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'01'                              0827
*       RESPECIFY                   /*                       @Y30LB25*/
*         RG1 RSTD;                 /* RESTRICT REG 1        @Y30LB25*/
*       RG1=RPLVPTR;                /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         0829
*       CALL ICBVIO00;              /* WRITE BVR             @Y30LB25*/
         L     @15,@CV00610                                        0830
         BALR  @14,@15                                             0830
*       RESPECIFY                   /*                       @Y30LB25*/
*         RG1 UNRSTD;               /* UNRESTRICT REG 1      @Y30LB25*/
*       IF RPLVRETC^=FIXZERO        /* CHECK RETN CODE       @Y30LB25*/
*         THEN                      /*                       @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              0832
         N     @08,@CF00815                                        0832
         LTR   @08,@08                                             0832
         BZ    @RF00832                                            0832
*         CALL PLIBMSG;             /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         0833
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00015                                            0834
*     END;                          /*                       @Y30LB25*/
*                                                                  0835
*   /*****************************************************************/
*   /*                                                               */
*   /* OTHER CARTRIDGE PAIRED WITH THE ONE ENTERED MUST      @Y30LB25*/
*   /* NOT MATCH EITHER CSN1 OR CSN2 IN THE BVR              @Y30LB25*/
*   /* FIND THE NONMATCH BY FINDING WHICH ONE THE CSN        @Y30LB25*/
*   /* ENTERED MATCHES.                                      @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0836
*   IF BASCSN1^=CSN1USM             /* NO MATCH CSN1?        @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
@RF00804 L     @08,BASEVPTR                                        0836
         LA    @04,8                                               0836
         ALR   @04,MESGPTR                                         0836
         CLC   BASCSN1(12,@08),CSN1USM(@04)                        0836
         BE    @RF00836                                            0836
*     DO;                           /*                       @Y30LB25*/
*       IVOLKY=BASCSN1;             /* SAVE CSN1             @Y30LB25*/
         MVC   IVOLKY(12),BASCSN1(@08)                             0838
*       BASCSN1=CSN2USM;            /* UPDATE BVR CSN1       @Y30LB25*/
         MVC   BASCSN1(12,@08),CSN2USM(@04)                        0839
*       BASLIB1=BASLIB1&&BASLIB1;   /* ZERO LIBID1           @Y30LB25*/
         SLR   @03,@03                                             0840
         IC    @03,BASLIB1(,@08)                                   0840
         LR    @15,@03                                             0840
         XR    @15,@03                                             0840
         STC   @15,BASLIB1(,@08)                                   0840
*       IF LUSM1=ON                 /* BIT 1 ON?             @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
         TM    LUSM1(@04),B'10000000'                              0841
         BNO   @RF00841                                            0841
*         BAS1BIT1=ON;              /* LIBID1 BIT1 ON        @Y30LB25*/
         OI    BAS1BIT1(@08),B'00000010'                           0842
*       IF LUSM2=ON                 /* BIT 2 ON?             @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
@RF00841 TM    LUSM2+8(MESGPTR),B'01000000'                        0843
         BNO   @RF00843                                            0843
*         BAS1BIT2=ON;              /* LIBID1 BIT2 ON        @Y30LB25*/
         L     @08,BASEVPTR                                        0844
         OI    BAS1BIT2(@08),B'00000001'                           0844
*       BASDTREM=BLANK4;            /* NULL DATE REMOVED     @Y30LB25*/
@RF00843 L     @08,BASEVPTR                                        0845
         MVI   BASDTREM+1(@08),C' '                                0845
         MVC   BASDTREM+2(2,@08),BASDTREM+1(@08)                   0845
         MVI   BASDTREM(@08),C' '                                  0845
*       BASDEST=BLANK30;            /* NULL DESTINATION      @Y30LB25*/
         MVI   BASDEST+1(@08),C' '                                 0846
         MVC   BASDEST+2(28,@08),BASDEST+1(@08)                    0846
         MVI   BASDEST(@08),C' '                                   0846
*       CALL BVRCSN1;               /* PROC BVR CSN1 CIR     @Y30LB25*/
         BAL   @14,BVRCSN1                                         0847
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00015                                            0848
*     END;                          /*                       @Y30LB25*/
*   ELSE                            /* NO MATCH BVR CSN2     @Y30LB25*/
*     DO;                           /*                       @Y30LB25*/
@RF00836 DS    0H                                                  0851
*       IVOLKY=BASCSN2;             /* SAVE CSN2             @Y30LB25*/
         L     @08,BASEVPTR                                        0851
         MVC   IVOLKY(12),BASCSN2(@08)                             0851
*       BASCSN2=CSN2USM;            /* UPDATE BVR CSN2       @Y30LB25*/
         LA    @04,8                                               0852
         ALR   @04,MESGPTR                                         0852
         MVC   BASCSN2(12,@08),CSN2USM(@04)                        0852
*       BASLIB2=BASLIB2&&BASLIB2;   /* ZERO LIBID2           @Y30LB25*/
         SLR   @03,@03                                             0853
         IC    @03,BASLIB2(,@08)                                   0853
         LR    @15,@03                                             0853
         XR    @15,@03                                             0853
         STC   @15,BASLIB2(,@08)                                   0853
*       IF LUSM1=ON                 /* BIT 1 ON?             @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
         TM    LUSM1(@04),B'10000000'                              0854
         BNO   @RF00854                                            0854
*         BAS2BIT1=ON;              /* LIBID2 BIT1 ON        @Y30LB25*/
         OI    BAS2BIT1(@08),B'00000010'                           0855
*       IF LUSM2=ON                 /* BIT 2 ON?             @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
@RF00854 TM    LUSM2+8(MESGPTR),B'01000000'                        0856
         BNO   @RF00856                                            0856
*         BAS2BIT2=ON;              /* LIBID2 BIT2 ON        @Y30LB25*/
         L     @08,BASEVPTR                                        0857
         OI    BAS2BIT2(@08),B'00000001'                           0857
*       BASDTREM=BLANK4;            /* NULL DATE REMOVED     @Y30LB25*/
@RF00856 L     @08,BASEVPTR                                        0858
         MVI   BASDTREM+1(@08),C' '                                0858
         MVC   BASDTREM+2(2,@08),BASDTREM+1(@08)                   0858
         MVI   BASDTREM(@08),C' '                                  0858
*       BASDEST=BLANK30;            /* NULL DESTINATION      @Y30LB25*/
         MVI   BASDEST+1(@08),C' '                                 0859
         MVC   BASDEST+2(28,@08),BASDEST+1(@08)                    0859
         MVI   BASDEST(@08),C' '                                   0859
*       CALL BVRCSN2;               /* PROC BVR CSN2 CIR     @Y30LB25*/
         BAL   @14,BVRCSN2                                         0860
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00015                                            0861
*     END;                          /*                       @Y30LB25*/
*   END CKBVR1;                     /*                       @Y30LB25*/
         B     @EL00015                                            0863
*                                                                  0864
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - CKBVR2                               @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* FUNCTION - UPDATE A BVR AND CIR FOR THE CSN OF THE    @Y30LB25*/
*   /* OTHER CARTRIDGE TO THE PAIR FOR THE ONE ENTERED.      @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* INPUT -                                               @Y30LB25*/
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* OUTPUT -                                              @Y30LB25*/
*   /* BASE VOLUME RECORD                                    @Y30LB25*/
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0864
*CKBVR2:                            /*                       @Y30LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/
*                                                                  0864
CKBVR2   ST    @14,@SA00016                                        0864
*   /*****************************************************************/
*   /*                                                               */
*   /* GET THE BVR FROM THE CSN OF THE CARTRIDGE PAIRED      @Y30LB25*/
*   /* WITH THE ONE ENTERED                                  @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0865
*   BKEY=INDRECKY;                  /* BVR KEY               @Y30LB25*/
         MVC   BKEY(13),INDRECKY(INDEXPTR)                         0865
*   RPLVKEY=ADDR(BKEY);             /* ADDR OF KEY           @Y30LB25*/
         LA    @08,BKEY                                            0866
         ST    @08,RPLVKEY(,RPLVPTR)                               0866
*   RPLVBUF=BASEVPTR;               /* PT TO BVR BUF         @Y30LB25*/
         L     @08,BASEVPTR                                        0867
         ST    @08,RPLVBUF(,RPLVPTR)                               0867
*   RPLVBLN=LENGTH(BASEBUF);        /* SET BVR BUF LENGTH    @Y30LB25*/
         MVC   RPLVBLN(4,RPLVPTR),@CF00804                         0868
*   RPLVTYP=RPLVREAD;               /* READ OPTION ON        @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'00'                              0869
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB25*/
         OI    RPLVDIR(RPLVPTR),B'01000000'                        0870
*   RPLVUPD=ON;                     /* READ FOR UPDATE       @Y30LB25*/
         OI    RPLVUPD(RPLVPTR),B'00000010'                        0871
*   RPLVLOC=OFF;                    /* NO LOCATE             @Y30LB25*/
         NI    RPLVLOC(RPLVPTR),B'01111111'                        0872
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         0874
*   CALL ICBVIO00;                  /* READ FOR BVR          @Y30LB25*/
         L     @15,@CV00610                                        0875
         BALR  @14,@15                                             0875
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              0877
         N     @08,@CF00815                                        0877
         LTR   @08,@08                                             0877
         BZ    @RF00877                                            0877
*     DO;                           /* NO REC FND            @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         0879
*       RETURN;                     /*                       @Y30LB25*/
@EL00016 DS    0H                                                  0880
@EF00016 DS    0H                                                  0880
@ER00016 L     @14,@SA00016                                        0880
         BR    @14                                                 0880
*     END;                          /*                       @Y30LB25*/
*                                                                  0881
*   /*****************************************************************/
*   /*                                                               */
*   /* SET THE DOWN LEVEL SPCAE FLAG                         @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0882
*   BASDLSF=ON;                     /* DOWN LEVEL SPACE      @Y30LB25*/
*                                                                  0882
@RF00877 L     @08,BASEVPTR                                        0882
         OI    BASDLSF(@08),B'10000000'                            0882
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR CORRECT RECORD                              @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0883
*   IF(CSN1USM=BASCSN1&CSN2USM=BASCSN2)×/* ALL CSNS MATCH?   @Y30LB25*/
*       (CSN1USM=BASCSN2&CSN2USM=BASCSN1)/*                  @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
         LA    @04,8                                               0883
         ALR   @04,MESGPTR                                         0883
         CLC   CSN1USM(12,@04),BASCSN1(@08)                        0883
         BNE   @GL00020                                            0883
         CLC   CSN2USM(12,@04),BASCSN2(@08)                        0883
         BE    @RT00883                                            0883
@GL00020 LA    @08,8                                               0883
         ALR   @08,MESGPTR                                         0883
         L     @04,BASEVPTR                                        0883
         CLC   CSN1USM(12,@08),BASCSN2(@04)                        0883
         BNE   @RF00883                                            0883
         CLC   CSN2USM(12,@08),BASCSN1(@04)                        0883
         BNE   @RF00883                                            0883
@RT00883 DS    0H                                                  0884
*     DO;                           /*                       @Y30LB25*/
*                                                                  0884
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK FOR CSN1                                    @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0885
*       IF SEQNUM=ONEF1             /* CSN1?                 @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
         LA    @08,8                                               0885
         ALR   @08,MESGPTR                                         0885
         CLI   SEQNUM(@08),X'F1'                                   0885
         BNE   @RF00885                                            0885
*         DO;                       /*                       @Y30LB25*/
*           BASLIB1=BASLIB1&&BASLIB1;/* ZERO LIBID1          @Y30LB25*/
         L     @04,BASEVPTR                                        0887
         SLR   @03,@03                                             0887
         IC    @03,BASLIB1(,@04)                                   0887
         LR    @15,@03                                             0887
         XR    @15,@03                                             0887
         STC   @15,BASLIB1(,@04)                                   0887
*           IF LUSM1=ON             /* BIT 1 ON?             @Y30LB25*/
*             THEN                  /* YES                   @Y30LB25*/
         TM    LUSM1(@08),B'10000000'                              0888
         BNO   @RF00888                                            0888
*             BAS1BIT1=ON;          /* LIBID1 BIT1 ON        @Y30LB25*/
         OI    BAS1BIT1(@04),B'00000010'                           0889
*           IF LUSM2=ON             /* BIT 2 ON?             @Y30LB25*/
*             THEN                  /* YES                   @Y30LB25*/
@RF00888 TM    LUSM2+8(MESGPTR),B'01000000'                        0890
         BNO   @RF00890                                            0890
*             BAS1BIT2=ON;          /* LIBID1 BIT2 ON        @Y30LB25*/
         L     @08,BASEVPTR                                        0891
         OI    BAS1BIT2(@08),B'00000001'                           0891
*           BASCSN1=CSN1USM;        /* SET FIRST CSN         @ZM31119*/
@RF00890 L     @08,BASEVPTR                                        0892
         LA    @04,8                                               0892
         ALR   @04,MESGPTR                                         0892
         MVC   BASCSN1(12,@08),CSN1USM(@04)                        0892
*           BASCSN2=CSN2USM;        /* SET SECOND CSN        @ZM31119*/
         MVC   BASCSN2(12,@08),CSN2USM(@04)                        0893
*         END;                      /*                       @Y30LB25*/
*                                                                  0894
*       /*************************************************************/
*       /*                                                           */
*       /* CSN2                                              @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0895
*       ELSE                        /* CSN2                  @Y30LB25*/
*         DO;                       /*                       @Y30LB25*/
*                                                                  0895
         B     @RC00885                                            0895
@RF00885 DS    0H                                                  0896
*           /*********************************************************/
*           /*                                                       */
*           /* SET LIBID2                                    @Y30LB25*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  0896
*           BASLIB2=BASLIB2&&BASLIB2;/* ZERO LIBID2          @Y30LB25*/
         L     @08,BASEVPTR                                        0896
         SLR   @04,@04                                             0896
         IC    @04,BASLIB2(,@08)                                   0896
         LR    @03,@04                                             0896
         XR    @03,@04                                             0896
         STC   @03,BASLIB2(,@08)                                   0896
*           IF LUSM1=ON             /* BIT 1 ON?             @Y30LB25*/
*             THEN                  /* YES                   @Y30LB25*/
         TM    LUSM1+8(MESGPTR),B'10000000'                        0897
         BNO   @RF00897                                            0897
*             BAS2BIT1=ON;          /* LIBID2 BIT1 ON        @Y30LB25*/
         OI    BAS2BIT1(@08),B'00000010'                           0898
*           IF LUSM2=ON             /* BIT 2 ON?             @Y30LB25*/
*             THEN                  /* YES                   @Y30LB25*/
@RF00897 TM    LUSM2+8(MESGPTR),B'01000000'                        0899
         BNO   @RF00899                                            0899
*             BAS2BIT2=ON;          /* LIBID2 BIT2 ON        @Y30LB25*/
         L     @08,BASEVPTR                                        0900
         OI    BAS2BIT2(@08),B'00000001'                           0900
*           BASCSN1=CSN2USM;        /* SET FIRST CSN         @ZM31119*/
@RF00899 L     @08,BASEVPTR                                        0901
         LA    @04,8                                               0901
         ALR   @04,MESGPTR                                         0901
         MVC   BASCSN1(12,@08),CSN2USM(@04)                        0901
*           BASCSN2=CSN1USM;        /* SET SECOND CSN        @ZM31119*/
         MVC   BASCSN2(12,@08),CSN1USM(@04)                        0902
*         END;                      /*                       @Y30LB25*/
*                                                                  0903
*       /*************************************************************/
*       /*                                                           */
*       /* UPDATE THE BVR                                    @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0904
*       BASDTREM=BLANK4;            /* NULL DATE REMOVED     @Y30LB25*/
@RC00885 L     @08,BASEVPTR                                        0904
         MVI   BASDTREM+1(@08),C' '                                0904
         MVC   BASDTREM+2(2,@08),BASDTREM+1(@08)                   0904
         MVI   BASDTREM(@08),C' '                                  0904
*       BASDEST=BLANK30;            /* NULL DESTINATION      @Y30LB25*/
*                                                                  0905
         MVI   BASDEST+1(@08),C' '                                 0905
         MVC   BASDEST+2(28,@08),BASDEST+1(@08)                    0905
         MVI   BASDEST(@08),C' '                                   0905
*       /*************************************************************/
*       /*                                                           */
*       /* WRITE THE BVR                                     @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0906
*       RPLVTYP=RPLVPUT;            /* WRITE                 @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'01'                              0906
*       RESPECIFY                   /*                       @Y30LB25*/
*         RG1 RSTD;                 /* RESTRICT REG 1        @Y30LB25*/
*       RG1=RPLVPTR;                /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         0908
*       CALL ICBVIO00;              /* WRITE BVR             @Y30LB25*/
         L     @15,@CV00610                                        0909
         BALR  @14,@15                                             0909
*       RESPECIFY                   /*                       @Y30LB25*/
*         RG1 UNRSTD;               /* UNRESTRICT REG 1      @Y30LB25*/
*       IF RPLVRETC^=FIXZERO        /* CHECK RETN CODE       @Y30LB25*/
*         THEN                      /*                       @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              0911
         N     @08,@CF00815                                        0911
         LTR   @08,@08                                             0911
         BZ    @RF00911                                            0911
*         CALL PLIBMSG;             /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         0912
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00016                                            0913
*     END;                          /*                       @Y30LB25*/
*                                                                  0914
*   /*****************************************************************/
*   /*                                                               */
*   /* THE CARTRIDGE ENTERED MUST NOT MATCH WITH EITHER      @Y30LB25*/
*   /* CSN1 OR CSN2 IN THE BVR.                              @Y30LB25*/
*   /* FIND THE NONMATCH BY FINDING WHICH ONE THE CSN NOT    @Y30LB25*/
*   /* ENTERED MATCHES.                                      @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0915
*   IF BASCSN1^=CSN2USM             /* NO MATCH CSN2?        @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
@RF00883 L     @08,BASEVPTR                                        0915
         LA    @04,8                                               0915
         ALR   @04,MESGPTR                                         0915
         CLC   BASCSN1(12,@08),CSN2USM(@04)                        0915
         BE    @RF00915                                            0915
*     DO;                           /*                       @Y30LB25*/
*       IVOLKY=BASCSN1;             /* SAVE CSN1             @Y30LB25*/
         MVC   IVOLKY(12),BASCSN1(@08)                             0917
*       BASCSN1=CSN1USM;            /* UPDATE BVR CSN1       @Y30LB25*/
         MVC   BASCSN1(12,@08),CSN1USM(@04)                        0918
*       BASLIB1=BASLIB1&&BASLIB1;   /* ZERO LIBID1           @Y30LB25*/
         SLR   @03,@03                                             0919
         IC    @03,BASLIB1(,@08)                                   0919
         LR    @15,@03                                             0919
         XR    @15,@03                                             0919
         STC   @15,BASLIB1(,@08)                                   0919
*       IF LUSM1=ON                 /* BIT 1 ON?             @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
         TM    LUSM1(@04),B'10000000'                              0920
         BNO   @RF00920                                            0920
*         BAS1BIT1=ON;              /* LIBID1 BIT1 ON        @Y30LB25*/
         OI    BAS1BIT1(@08),B'00000010'                           0921
*       IF LUSM2=ON                 /* BIT 2 ON?             @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
@RF00920 TM    LUSM2+8(MESGPTR),B'01000000'                        0922
         BNO   @RF00922                                            0922
*         BAS1BIT2=ON;              /* LIBID1 BIT2 ON        @Y30LB25*/
         L     @08,BASEVPTR                                        0923
         OI    BAS1BIT2(@08),B'00000001'                           0923
*       BASDTREM=BLANK4;            /* NULL DATE REMOVED     @Y30LB25*/
@RF00922 L     @08,BASEVPTR                                        0924
         MVI   BASDTREM+1(@08),C' '                                0924
         MVC   BASDTREM+2(2,@08),BASDTREM+1(@08)                   0924
         MVI   BASDTREM(@08),C' '                                  0924
*       BASDEST=BLANK30;            /* NULL DESTINATION      @Y30LB25*/
         MVI   BASDEST+1(@08),C' '                                 0925
         MVC   BASDEST+2(28,@08),BASDEST+1(@08)                    0925
         MVI   BASDEST(@08),C' '                                   0925
*       CALL BVRCSN1;               /* PROC BVR CSN1 CIR     @Y30LB25*/
         BAL   @14,BVRCSN1                                         0926
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00016                                            0927
*     END;                          /*                       @Y30LB25*/
*   ELSE                            /* NO MATCH BVR CSN2     @Y30LB25*/
*     DO;                           /*                       @Y30LB25*/
@RF00915 DS    0H                                                  0930
*       IVOLKY=BASCSN2;             /* SAVE CSN2             @Y30LB25*/
         L     @08,BASEVPTR                                        0930
         MVC   IVOLKY(12),BASCSN2(@08)                             0930
*       BASCSN2=CSN1USM;            /* UPDATE BVR CSN2       @Y30LB25*/
         LA    @04,8                                               0931
         ALR   @04,MESGPTR                                         0931
         MVC   BASCSN2(12,@08),CSN1USM(@04)                        0931
*       BASLIB2=BASLIB2&&BASLIB2;   /* ZERO LIBID2           @Y30LB25*/
         SLR   @03,@03                                             0932
         IC    @03,BASLIB2(,@08)                                   0932
         LR    @15,@03                                             0932
         XR    @15,@03                                             0932
         STC   @15,BASLIB2(,@08)                                   0932
*       IF LUSM1=ON                 /* BIT 1 ON?             @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
         TM    LUSM1(@04),B'10000000'                              0933
         BNO   @RF00933                                            0933
*         BAS2BIT1=ON;              /* LIBID2 BIT1 ON        @Y30LB25*/
         OI    BAS2BIT1(@08),B'00000010'                           0934
*       IF LUSM2=ON                 /* BIT 2 ON?             @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
@RF00933 TM    LUSM2+8(MESGPTR),B'01000000'                        0935
         BNO   @RF00935                                            0935
*         BAS2BIT2=ON;              /* LIBID2 BIT2 ON        @Y30LB25*/
         L     @08,BASEVPTR                                        0936
         OI    BAS2BIT2(@08),B'00000001'                           0936
*       BASDTREM=BLANK4;            /* NULL DATE REMOVED     @Y30LB25*/
@RF00935 L     @08,BASEVPTR                                        0937
         MVI   BASDTREM+1(@08),C' '                                0937
         MVC   BASDTREM+2(2,@08),BASDTREM+1(@08)                   0937
         MVI   BASDTREM(@08),C' '                                  0937
*       BASDEST=BLANK30;            /* NULL DESTINATION      @Y30LB25*/
         MVI   BASDEST+1(@08),C' '                                 0938
         MVC   BASDEST+2(28,@08),BASDEST+1(@08)                    0938
         MVI   BASDEST(@08),C' '                                   0938
*       CALL BVRCSN2;               /* PROC BVR CSN2 CIR     @Y30LB25*/
         BAL   @14,BVRCSN2                                         0939
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00016                                            0940
*     END;                          /*                       @Y30LB25*/
*   END CKBVR2;                     /*                       @Y30LB25*/
         B     @EL00016                                            0942
*                                                                  0943
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - BVRCSN1                              @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* FUNCTION - WRITE THE BVR.                             @Y30LB25*/
*   /* READ FOR CIR OF REPLACED CSN1.                        @Y30LB25*/
*   /* IF THERE IS NOT ONE OR IT DOES NOT POINT TO THE       @Y30LB25*/
*   /* BVR, CREATE A NEW CIR FOR CSN1 OF BVR AND RETURN.     @Y30LB25*/
*   /* OTHERWISE, CREATE A NEW CIR FOR THE NEW CSN1          @Y30LB25*/
*   /* AND DELETE THE OLD CSN.                               @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* INPUT -                                               @Y30LB25*/
*   /* BASE VOLUME RECORD                                    @Y30LB25*/
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* OUTPUT -                                              @Y30LB25*/
*   /* BASE VOLUME RECORD                                    @Y30LB25*/
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0943
*BVRCSN1:                           /*                       @Y30LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/
*                                                                  0943
BVRCSN1  ST    @14,@SA00017                                        0943
*   /*****************************************************************/
*   /*                                                               */
*   /* WRITE THE BVR FOR THE CARTRIDGE ENTERED               @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0944
*   RPLVTYP=RPLVPUT;                /* WRITE                 @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'01'                              0944
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         0946
*   CALL ICBVIO00;                  /* WRITE BVR             @Y30LB25*/
         L     @15,@CV00610                                        0947
         BALR  @14,@15                                             0947
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              0949
         N     @08,@CF00815                                        0949
         LTR   @08,@08                                             0949
         BZ    @RF00949                                            0949
*     DO;                           /* NO REC FND            @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         0951
*       RETURN;                     /*                       @Y30LB25*/
@EL00017 DS    0H                                                  0952
@EF00017 DS    0H                                                  0952
@ER00017 L     @14,@SA00017                                        0952
         BR    @14                                                 0952
*     END;                          /*                       @Y30LB25*/
*                                                                  0953
*   /*****************************************************************/
*   /*                                                               */
*   /* READ FOR CIR OF REPLACED CSN1 OF THE BVR              @Y30LB25*/
*   /* IVOLKY CAN BE BLANKS FOR A NEWLY CREATED BVR.         @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0954
*   RPLVTYP=RPLVREAD;               /* READ                  @Y30LB25*/
@RF00949 MVI   RPLVTYP(RPLVPTR),X'00'                              0954
*   RPLVLOC=OFF;                    /* NO LOCATE             @Y30LB25*/
         NI    RPLVLOC(RPLVPTR),B'01111111'                        0955
*   RPLVUPD=ON;                     /* UPDATE                @Y30LB25*/
         OI    RPLVUPD(RPLVPTR),B'00000010'                        0956
*   RPLVDIR=ON;                     /* DIRECT                @Y30LB25*/
         OI    RPLVDIR(RPLVPTR),B'01000000'                        0957
*   RPLVKEY=ADDR(IKEY);             /* ADDR OF KEY           @Y30LB25*/
         LA    @08,IKEY                                            0958
         ST    @08,RPLVKEY(,RPLVPTR)                               0958
*   RPLVBUF=INDEXPTR;               /* PTR TO CIR BUF        @Y30LB25*/
         ST    INDEXPTR,RPLVBUF(,RPLVPTR)                          0959
*   RPLVBLN=LENGTH(INDEXBUF);       /* CIR BUF LENGTH        @Y30LB25*/
         MVC   RPLVBLN(4,RPLVPTR),@CF00806                         0960
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         0962
*   CALL ICBVIO00;                  /* READ CIR              @Y30LB25*/
         L     @15,@CV00610                                        0963
         BALR  @14,@15                                             0963
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLRCODE=IOERROR             /* CK REASON CODE        @Y30LB25*/
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/
         CLC   RPLRCODE(2,RPLVPTR),@CB00588                        0965
         BNE   @RF00965                                            0965
*     DO;                           /* NO REC FND            @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         0967
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00017                                            0968
*     END;                          /*                       @Y30LB25*/
*                                                                  0969
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK THE RECORD, IF ANY                              @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0970
*   IF RPLRCODE=NORECFND×INDVSRNO^=BASSERNO/*                @Y30LB25
*                                      NO RECORD FND OR      @Y30LB25
*                                      WRONG SERIAL NO?      @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
@RF00965 CLC   RPLRCODE(2,RPLVPTR),@CB00586                        0970
         BE    @RT00970                                            0970
         L     @08,BASEVPTR                                        0970
         CLC   INDVSRNO(6,INDEXPTR),BASSERNO(@08)                  0970
         BE    @RF00970                                            0970
@RT00970 DS    0H                                                  0971
*     DO;                           /*                       @Y30LB25*/
*                                                                  0971
*       /*************************************************************/
*       /*                                                           */
*       /* CREATE A CIR FOR CSN1                             @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0972
*       CSNUMBER=ON;                /* CSN1                  @Y30LB25*/
         OI    CSNUMBER,B'00000100'                                0972
*       BCDVPTR=BASEVPTR;           /* BVR PTR               @Y30LB25*/
         L     @08,BASEVPTR                                        0973
         ST    @08,BCDVPTR                                         0973
*       CALL VUCIR;                 /*                       @Y30LB25
*                                      MAKE CIR FOR CSN1     @Y30LB25*/
         BAL   @14,VUCIR                                           0974
*       IF RPLVRETC^=FIXZERO        /* CK RETURN CODE        @Y30LB25*/
*         THEN                      /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              0975
         N     @08,@CF00815                                        0975
         LTR   @08,@08                                             0975
         BZ    @RF00975                                            0975
*         CALL PLIBMSG;             /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         0976
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00017                                            0977
*     END;                          /*                       @Y30LB25*/
*                                                                  0978
*   /*****************************************************************/
*   /*                                                               */
*   /* DELETE CIR FOR THE REPLACED CSN1                      @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0979
*   RPLVTYP=RPLVDEL;                /* DELETE                @Y30LB25*/
@RF00970 MVI   RPLVTYP(RPLVPTR),X'05'                              0979
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         0981
*   CALL ICBVIO00;                  /* DELETE CIR            @Y30LB25*/
         L     @15,@CV00610                                        0982
         BALR  @14,@15                                             0982
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              0984
         N     @08,@CF00815                                        0984
         LTR   @08,@08                                             0984
         BZ    @RF00984                                            0984
*     DO;                           /* NO REC FND            @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         0986
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00017                                            0987
*     END;                          /*                       @Y30LB25*/
*                                                                  0988
*   /*****************************************************************/
*   /*                                                               */
*   /* CREATE A CIR FOR CSN1                                 @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0989
*   CSNUMBER=ON;                    /* CSN1                  @Y30LB25*/
@RF00984 OI    CSNUMBER,B'00000100'                                0989
*   BCDVPTR=BASEVPTR;               /* BVR PTR               @Y30LB25*/
         L     @08,BASEVPTR                                        0990
         ST    @08,BCDVPTR                                         0990
*   CALL VUCIR;                     /*                       @Y30LB25
*                                      MAKE CIR FOR CSN1     @Y30LB25*/
         BAL   @14,VUCIR                                           0991
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/
*     THEN                          /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              0992
         N     @08,@CF00815                                        0992
         LTR   @08,@08                                             0992
         BZ    @RF00992                                            0992
*     CALL PLIBMSG;                 /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         0993
*   RETURN;                         /*                       @Y30LB25*/
         B     @EL00017                                            0994
*   END BVRCSN1;                    /*                       @Y30LB25*/
         B     @EL00017                                            0995
*                                                                  0996
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - BVRCSN2                              @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* FUNCTION - WRITE THE BVR.                             @Y30LB25*/
*   /* READ FOR CIR OF REPLACED CSN2.                        @Y30LB25*/
*   /* IF THERE IS NOT ONE OR IT DOES NOT POINT TO THE       @Y30LB25*/
*   /* BVR, CREATE A NEW CIR FOR CSN2 OF BVR AND RETURN.     @Y30LB25*/
*   /* OTHERWISE, CREATE A NEW CIR FOR THE NEW CSN2          @Y30LB25*/
*   /* AND DELETE THE OLD CSN.                               @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* INPUT -                                               @Y30LB25*/
*   /* BASE VOLUME RECORD                                    @Y30LB25*/
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* OUTPUT -                                              @Y30LB25*/
*   /* BASE VOLUME RECORD                                    @Y30LB25*/
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0996
*BVRCSN2:                           /*                       @Y30LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/
*                                                                  0996
BVRCSN2  ST    @14,@SA00018                                        0996
*   /*****************************************************************/
*   /*                                                               */
*   /* WRITE THE BVR FOR THE CARTRIDGE PAIRED WITH THE       @Y30LB25*/
*   /* ONE ENTERED                                           @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0997
*   RPLVTYP=RPLVPUT;                /* WRITE                 @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'01'                              0997
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         0999
*   CALL ICBVIO00;                  /* WRITE BVR             @Y30LB25*/
         L     @15,@CV00610                                        1000
         BALR  @14,@15                                             1000
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1002
         N     @08,@CF00815                                        1002
         LTR   @08,@08                                             1002
         BZ    @RF01002                                            1002
*     DO;                           /* NO REC FND            @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         1004
*       RETURN;                     /*                       @Y30LB25*/
@EL00018 DS    0H                                                  1005
@EF00018 DS    0H                                                  1005
@ER00018 L     @14,@SA00018                                        1005
         BR    @14                                                 1005
*     END;                          /*                       @Y30LB25*/
*                                                                  1006
*   /*****************************************************************/
*   /*                                                               */
*   /* READ FOR CIR OF REPLACED CSN2 OF THE BVR              @Y30LB25*/
*   /* IVOLKY CAN BE BLANKS FOR A NEWLY CREATED BVR.         @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1007
*   RPLVTYP=RPLVREAD;               /* READ                  @Y30LB25*/
@RF01002 MVI   RPLVTYP(RPLVPTR),X'00'                              1007
*   RPLVLOC=OFF;                    /* NO LOCATE             @Y30LB25*/
         NI    RPLVLOC(RPLVPTR),B'01111111'                        1008
*   RPLVUPD=ON;                     /* UPDATE                @Y30LB25*/
         OI    RPLVUPD(RPLVPTR),B'00000010'                        1009
*   RPLVDIR=ON;                     /* DIRECT                @Y30LB25*/
         OI    RPLVDIR(RPLVPTR),B'01000000'                        1010
*   RPLVKEY=ADDR(IKEY);             /* ADDR OF KEY           @Y30LB25*/
         LA    @08,IKEY                                            1011
         ST    @08,RPLVKEY(,RPLVPTR)                               1011
*   RPLVBUF=INDEXPTR;               /* PTR TO CIR BUF        @Y30LB25*/
         ST    INDEXPTR,RPLVBUF(,RPLVPTR)                          1012
*   RPLVBLN=LENGTH(INDEXBUF);       /* CIR BUF LENGTH        @Y30LB25*/
         MVC   RPLVBLN(4,RPLVPTR),@CF00806                         1013
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         1015
*   CALL ICBVIO00;                  /* READ CIR              @Y30LB25*/
         L     @15,@CV00610                                        1016
         BALR  @14,@15                                             1016
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLRCODE=IOERROR             /* CK REASON CODE        @Y30LB25*/
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/
         CLC   RPLRCODE(2,RPLVPTR),@CB00588                        1018
         BNE   @RF01018                                            1018
*     DO;                           /* NO REC FND            @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         1020
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00018                                            1021
*     END;                          /*                       @Y30LB25*/
*                                                                  1022
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK THE RECORD, IF ANY                              @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1023
*   IF RPLRCODE=NORECFND×INDVSRNO^=BASSERNO/*                @Y30LB25
*                                      NO RECORD FND OR      @Y30LB25
*                                      WRONG SERIAL NO?      @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
@RF01018 CLC   RPLRCODE(2,RPLVPTR),@CB00586                        1023
         BE    @RT01023                                            1023
         L     @08,BASEVPTR                                        1023
         CLC   INDVSRNO(6,INDEXPTR),BASSERNO(@08)                  1023
         BE    @RF01023                                            1023
@RT01023 DS    0H                                                  1024
*     DO;                           /*                       @Y30LB25*/
*                                                                  1024
*       /*************************************************************/
*       /*                                                           */
*       /* CREATE A CIR FOR CSN2                             @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1025
*       CSNUMBER=OFF;               /* CSN2                  @Y30LB25*/
         NI    CSNUMBER,B'11111011'                                1025
*       BCDVPTR=BASEVPTR;           /* BVR PTR               @Y30LB25*/
         L     @08,BASEVPTR                                        1026
         ST    @08,BCDVPTR                                         1026
*       CALL VUCIR;                 /*                       @Y30LB25
*                                      MAKE CIR FOR CSN2     @Y30LB25*/
         BAL   @14,VUCIR                                           1027
*       IF RPLVRETC^=FIXZERO        /* CK RETURN CODE        @Y30LB25*/
*         THEN                      /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1028
         N     @08,@CF00815                                        1028
         LTR   @08,@08                                             1028
         BZ    @RF01028                                            1028
*         CALL PLIBMSG;             /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         1029
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00018                                            1030
*     END;                          /*                       @Y30LB25*/
*                                                                  1031
*   /*****************************************************************/
*   /*                                                               */
*   /* DELETE CIR FOR THE REPLACED CSN2                      @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1032
*   RPLVTYP=RPLVDEL;                /* DELETE                @Y30LB25*/
@RF01023 MVI   RPLVTYP(RPLVPTR),X'05'                              1032
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         1034
*   CALL ICBVIO00;                  /* DELETE CIR            @Y30LB25*/
         L     @15,@CV00610                                        1035
         BALR  @14,@15                                             1035
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1037
         N     @08,@CF00815                                        1037
         LTR   @08,@08                                             1037
         BZ    @RF01037                                            1037
*     DO;                           /* NO REC FND            @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         1039
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00018                                            1040
*     END;                          /*                       @Y30LB25*/
*                                                                  1041
*   /*****************************************************************/
*   /*                                                               */
*   /* CREATE A CIR FOR CSN2                                 @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1042
*   CSNUMBER=OFF;                   /* CSN2                  @Y30LB25*/
@RF01037 NI    CSNUMBER,B'11111011'                                1042
*   BCDVPTR=BASEVPTR;               /* BVR PTR               @Y30LB25*/
         L     @08,BASEVPTR                                        1043
         ST    @08,BCDVPTR                                         1043
*   CALL VUCIR;                     /*                       @Y30LB25
*                                      MAKE CIR FOR CSN2     @Y30LB25*/
         BAL   @14,VUCIR                                           1044
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/
*     THEN                          /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1045
         N     @08,@CF00815                                        1045
         LTR   @08,@08                                             1045
         BZ    @RF01045                                            1045
*     CALL PLIBMSG;                 /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         1046
*   RETURN;                         /*                       @Y30LB25*/
         B     @EL00018                                            1047
*   END BVRCSN2;                    /*                       @Y30LB25*/
         B     @EL00018                                            1048
*                                                                  1049
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - CKCVR1                               @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* FUNCTION - UPDATE A CVR AND CIR FOR THE CSN OF THE    @Y30LB25*/
*   /* CARTRIDGE ENTERED.                                    @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* INPUT -                                               @Y30LB25*/
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* OUTPUT -                                              @Y30LB25*/
*   /* COPY VOLUME RECORD                                    @Y30LB25*/
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1049
*CKCVR1:                            /*                       @Y30LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/
*                                                                  1049
CKCVR1   ST    @14,@SA00019                                        1049
*   /*****************************************************************/
*   /*                                                               */
*   /* GET THE CVR FROM THE CSN OF THE CARTRIDGE ENTERED     @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1050
*   CKEY=INDRECKY;                  /* CVR KEY               @Y30LB25*/
         MVC   CKEY(13),INDRECKY(INDEXPTR)                         1050
*   RPLVKEY=ADDR(CKEY);             /* ADDR OF KEY           @Y30LB25*/
         LA    @08,CKEY                                            1051
         ST    @08,RPLVKEY(,RPLVPTR)                               1051
*   RPLVBUF=COPYVPTR;               /* PT TO CVR BUF         @Y30LB25*/
         ST    COPYVPTR,RPLVBUF(,RPLVPTR)                          1052
*   RPLVBLN=LENGTH(COPYBUF);        /* SET CVR BUF LENGTH    @Y30LB25*/
         MVC   RPLVBLN(4,RPLVPTR),@CF00805                         1053
*   RPLVTYP=RPLVREAD;               /* READ OPTION ON        @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'00'                              1054
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB25*/
         OI    RPLVDIR(RPLVPTR),B'01000000'                        1055
*   RPLVUPD=ON;                     /* READ FOR UPDATE       @Y30LB25*/
         OI    RPLVUPD(RPLVPTR),B'00000010'                        1056
*   RPLVLOC=OFF;                    /* NO LOCATE             @Y30LB25*/
         NI    RPLVLOC(RPLVPTR),B'01111111'                        1057
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         1059
*   CALL ICBVIO00;                  /* READ FOR CVR          @Y30LB25*/
         L     @15,@CV00610                                        1060
         BALR  @14,@15                                             1060
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1062
         N     @08,@CF00815                                        1062
         LTR   @08,@08                                             1062
         BZ    @RF01062                                            1062
*     DO;                           /* NO REC FND            @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         1064
*       RETURN;                     /*                       @Y30LB25*/
@EL00019 DS    0H                                                  1065
@EF00019 DS    0H                                                  1065
@ER00019 L     @14,@SA00019                                        1065
         BR    @14                                                 1065
*     END;                          /*                       @Y30LB25*/
*                                                                  1066
*   /*****************************************************************/
*   /*                                                               */
*   /* SET THE DOWN LEVEL SPASE FLAG                         @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1067
*   COPDLSPF=ON;                    /* DOWN LEVEL SPACE      @Y30LB25*/
*                                                                  1067
@RF01062 OI    COPDLSPF(COPYVPTR),B'01000000'                      1067
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR CORRECT RECORD                              @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1068
*   IF(CSN1USM=COPCSN1&CSN2USM=COPCSN2)×/* ALL CSNS MATCH?   @Y30LB25*/
*       (CSN1USM=COPCSN2&CSN2USM=COPCSN1)/*                  @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
         LA    @08,8                                               1068
         ALR   @08,MESGPTR                                         1068
         CLC   CSN1USM(12,@08),COPCSN1(COPYVPTR)                   1068
         BNE   @GL00025                                            1068
         CLC   CSN2USM(12,@08),COPCSN2(COPYVPTR)                   1068
         BE    @RT01068                                            1068
@GL00025 LA    @08,8                                               1068
         ALR   @08,MESGPTR                                         1068
         CLC   CSN1USM(12,@08),COPCSN2(COPYVPTR)                   1068
         BNE   @RF01068                                            1068
         CLC   CSN2USM(12,@08),COPCSN1(COPYVPTR)                   1068
         BNE   @RF01068                                            1068
@RT01068 DS    0H                                                  1069
*     DO;                           /*                       @Y30LB25*/
*                                                                  1069
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK FOR CSN1                                    @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1070
*       IF SEQNUM=ONEF1             /* CSN1?                 @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
         LA    @08,8                                               1070
         ALR   @08,MESGPTR                                         1070
         CLI   SEQNUM(@08),X'F1'                                   1070
         BNE   @RF01070                                            1070
*         DO;                       /*                       @Y30LB25*/
*                                                                  1071
*           /*********************************************************/
*           /*                                                       */
*           /* SET LIBID1                                    @Y30LB25*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1072
*           COPLIB1=COPLIB1&&COPLIB1;/* ZERO LIBID1          @Y30LB25*/
         SLR   @07,@07                                             1072
         IC    @07,COPLIB1(,COPYVPTR)                              1072
         LR    @04,@07                                             1072
         XR    @04,@07                                             1072
         STC   @04,COPLIB1(,COPYVPTR)                              1072
*           IF LUSM1=ON             /* BIT 1 ON?             @Y30LB25*/
*             THEN                  /* YES                   @Y30LB25*/
         TM    LUSM1(@08),B'10000000'                              1073
         BNO   @RF01073                                            1073
*             COP1BIT1=ON;          /* LIBID1 BIT1 ON        @Y30LB25*/
         OI    COP1BIT1(COPYVPTR),B'00000010'                      1074
*           IF LUSM2=ON             /* BIT 2 ON?             @Y30LB25*/
*             THEN                  /* YES                   @Y30LB25*/
@RF01073 TM    LUSM2+8(MESGPTR),B'01000000'                        1075
         BNO   @RF01075                                            1075
*             COP1BIT2=ON;          /* LIBID1 BIT2 ON        @Y30LB25*/
         OI    COP1BIT2(COPYVPTR),B'00000001'                      1076
*           COPCSN1=CSN1USM;        /* SET FIRST CSN         @ZM31119*/
@RF01075 LA    @08,8                                               1077
         ALR   @08,MESGPTR                                         1077
         MVC   COPCSN1(12,COPYVPTR),CSN1USM(@08)                   1077
*           COPCSN2=CSN2USM;        /* SET SECOND CSN        @ZM31119*/
         MVC   COPCSN2(12,COPYVPTR),CSN2USM(@08)                   1078
*         END;                      /*                       @Y30LB25*/
*                                                                  1079
*       /*************************************************************/
*       /*                                                           */
*       /* CSN2                                              @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1080
*       ELSE                        /* CSN2                  @Y30LB25*/
*                                                                  1080
*         /***********************************************************/
*         /*                                                         */
*         /* SET LIBID2                                      @Y30LB25*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  1080
*         DO;                       /*                       @Y30LB25*/
         B     @RC01070                                            1080
@RF01070 DS    0H                                                  1081
*           COPLIB2=COPLIB2&&COPLIB2;/* ZERO LIBID2          @Y30LB25*/
         SLR   @08,@08                                             1081
         IC    @08,COPLIB2(,COPYVPTR)                              1081
         LR    @07,@08                                             1081
         XR    @07,@08                                             1081
         STC   @07,COPLIB2(,COPYVPTR)                              1081
*           IF LUSM1=ON             /* BIT 1 ON?             @Y30LB25*/
*             THEN                  /* YES                   @Y30LB25*/
         TM    LUSM1+8(MESGPTR),B'10000000'                        1082
         BNO   @RF01082                                            1082
*             COP2BIT1=ON;          /* LIBID2 BIT1 ON        @Y30LB25*/
         OI    COP2BIT1(COPYVPTR),B'00000010'                      1083
*           IF LUSM2=ON             /* BIT 2 ON?             @Y30LB25*/
*             THEN                  /* YES                   @Y30LB25*/
@RF01082 TM    LUSM2+8(MESGPTR),B'01000000'                        1084
         BNO   @RF01084                                            1084
*             COP2BIT2=ON;          /* LIBID2 BIT2 ON        @Y30LB25*/
         OI    COP2BIT2(COPYVPTR),B'00000001'                      1085
*           COPCSN1=CSN2USM;        /* SET FIRST CSN         @ZM31119*/
@RF01084 LA    @08,8                                               1086
         ALR   @08,MESGPTR                                         1086
         MVC   COPCSN1(12,COPYVPTR),CSN2USM(@08)                   1086
*           COPCSN2=CSN1USM;        /* SET SECOND CSN        @ZM31119*/
         MVC   COPCSN2(12,COPYVPTR),CSN1USM(@08)                   1087
*         END;                      /*                       @Y30LB25*/
*                                                                  1088
*       /*************************************************************/
*       /*                                                           */
*       /* UPDATE THE CVR                                    @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1089
*       COPDTREM=BLANK4;            /* NULL DATE REMOVED     @Y30LB25*/
@RC01070 MVI   COPDTREM+1(COPYVPTR),C' '                           1089
         MVC   COPDTREM+2(2,COPYVPTR),COPDTREM+1(COPYVPTR)         1089
         MVI   COPDTREM(COPYVPTR),C' '                             1089
*       COPDEST=BLANK30;            /* NULL DESTINATION      @Y30LB25*/
*                                                                  1090
         MVI   COPDEST+1(COPYVPTR),C' '                            1090
         MVC   COPDEST+2(28,COPYVPTR),COPDEST+1(COPYVPTR)          1090
         MVI   COPDEST(COPYVPTR),C' '                              1090
*       /*************************************************************/
*       /*                                                           */
*       /* WRITE THE DVR                                     @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1091
*       RPLVTYP=RPLVPUT;            /* WRITE                 @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'01'                              1091
*       RESPECIFY                   /*                       @Y30LB25*/
*         RG1 RSTD;                 /* RESTRICT REG 1        @Y30LB25*/
*       RG1=RPLVPTR;                /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         1093
*       CALL ICBVIO00;              /* WRITE CVR             @Y30LB25*/
         L     @15,@CV00610                                        1094
         BALR  @14,@15                                             1094
*       RESPECIFY                   /*                       @Y30LB25*/
*         RG1 UNRSTD;               /* UNRESTRICT REG 1      @Y30LB25*/
*       IF RPLVRETC^=FIXZERO        /* CHECK RETN CODE       @Y30LB25*/
*         THEN                      /*                       @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1096
         N     @08,@CF00815                                        1096
         LTR   @08,@08                                             1096
         BZ    @RF01096                                            1096
*         CALL PLIBMSG;             /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         1097
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00019                                            1098
*     END;                          /*                       @Y30LB25*/
*                                                                  1099
*   /*****************************************************************/
*   /*                                                               */
*   /* OTHER CARTRIDGE PAIRED WITH THE ONE ENTERED MUST      @Y30LB25*/
*   /* NOT MATCH EITHER CSN1 OR CSN2 IN THE CVR              @Y30LB25*/
*   /* FIND THE NONMATCH BY FINDING WHICH ONE THE CSN        @Y30LB25*/
*   /* ENTERED MATCHES.                                      @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1100
*   IF COPCSN1^=CSN1USM             /* NO MATCH CSN1?        @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
@RF01068 LA    @08,8                                               1100
         ALR   @08,MESGPTR                                         1100
         CLC   COPCSN1(12,COPYVPTR),CSN1USM(@08)                   1100
         BE    @RF01100                                            1100
*     DO;                           /*                       @Y30LB25*/
*       IVOLKY=COPCSN1;             /* SAVE CSN1             @Y30LB25*/
         MVC   IVOLKY(12),COPCSN1(COPYVPTR)                        1102
*       COPCSN1=CSN2USM;            /* UPDATE CVR CSN1       @Y30LB25*/
         MVC   COPCSN1(12,COPYVPTR),CSN2USM(@08)                   1103
*       COPLIB1=COPLIB1&&COPLIB1;   /* ZERO LIBID1           @Y30LB25*/
         SLR   @04,@04                                             1104
         IC    @04,COPLIB1(,COPYVPTR)                              1104
         LR    @03,@04                                             1104
         XR    @03,@04                                             1104
         STC   @03,COPLIB1(,COPYVPTR)                              1104
*       IF LUSM1=ON                 /* BIT 1 ON?             @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
         TM    LUSM1(@08),B'10000000'                              1105
         BNO   @RF01105                                            1105
*         COP1BIT1=ON;              /* LIBID1 BIT1 ON        @Y30LB25*/
         OI    COP1BIT1(COPYVPTR),B'00000010'                      1106
*       IF LUSM2=ON                 /* BIT 2 ON?             @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
@RF01105 TM    LUSM2+8(MESGPTR),B'01000000'                        1107
         BNO   @RF01107                                            1107
*         COP1BIT2=ON;              /* LIBID1 BIT2 ON        @Y30LB25*/
         OI    COP1BIT2(COPYVPTR),B'00000001'                      1108
*       COPDTREM=BLANK4;            /* NULL DATE REMOVED     @Y30LB25*/
@RF01107 MVI   COPDTREM+1(COPYVPTR),C' '                           1109
         MVC   COPDTREM+2(2,COPYVPTR),COPDTREM+1(COPYVPTR)         1109
         MVI   COPDTREM(COPYVPTR),C' '                             1109
*       COPDEST=BLANK30;            /* NULL DESTINATION      @Y30LB25*/
         MVI   COPDEST+1(COPYVPTR),C' '                            1110
         MVC   COPDEST+2(28,COPYVPTR),COPDEST+1(COPYVPTR)          1110
         MVI   COPDEST(COPYVPTR),C' '                              1110
*       CALL CVRCSN1;               /* PROC CVR CSN1 CIR     @Y30LB25*/
         BAL   @14,CVRCSN1                                         1111
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00019                                            1112
*     END;                          /*                       @Y30LB25*/
*   ELSE                            /* NO MATCH CVR CSN2     @Y30LB25*/
*     DO;                           /*                       @Y30LB25*/
@RF01100 DS    0H                                                  1115
*       IVOLKY=COPCSN2;             /* SAVE CSN2             @Y30LB25*/
         MVC   IVOLKY(12),COPCSN2(COPYVPTR)                        1115
*       COPCSN2=CSN2USM;            /* UPDATE CVR CSN2       @Y30LB25*/
         LA    @08,8                                               1116
         ALR   @08,MESGPTR                                         1116
         MVC   COPCSN2(12,COPYVPTR),CSN2USM(@08)                   1116
*       COPLIB2=COPLIB2&&COPLIB2;   /* ZERO LIBID2           @Y30LB25*/
         SLR   @04,@04                                             1117
         IC    @04,COPLIB2(,COPYVPTR)                              1117
         LR    @03,@04                                             1117
         XR    @03,@04                                             1117
         STC   @03,COPLIB2(,COPYVPTR)                              1117
*       IF LUSM1=ON                 /* BIT 1 ON?             @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
         TM    LUSM1(@08),B'10000000'                              1118
         BNO   @RF01118                                            1118
*         COP2BIT1=ON;              /* LIBID2 BIT1 ON        @Y30LB25*/
         OI    COP2BIT1(COPYVPTR),B'00000010'                      1119
*       IF LUSM2=ON                 /* BIT 2 ON?             @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
@RF01118 TM    LUSM2+8(MESGPTR),B'01000000'                        1120
         BNO   @RF01120                                            1120
*         COP2BIT2=ON;              /* LIBID2 BIT2 ON        @Y30LB25*/
         OI    COP2BIT2(COPYVPTR),B'00000001'                      1121
*       COPDTREM=BLANK4;            /* NULL DATE REMOVED     @Y30LB25*/
@RF01120 MVI   COPDTREM+1(COPYVPTR),C' '                           1122
         MVC   COPDTREM+2(2,COPYVPTR),COPDTREM+1(COPYVPTR)         1122
         MVI   COPDTREM(COPYVPTR),C' '                             1122
*       COPDEST=BLANK30;            /* NULL DESTINATION      @Y30LB25*/
         MVI   COPDEST+1(COPYVPTR),C' '                            1123
         MVC   COPDEST+2(28,COPYVPTR),COPDEST+1(COPYVPTR)          1123
         MVI   COPDEST(COPYVPTR),C' '                              1123
*       CALL CVRCSN2;               /* PROC CVR CSN2 CIR     @Y30LB25*/
         BAL   @14,CVRCSN2                                         1124
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00019                                            1125
*     END;                          /*                       @Y30LB25*/
*   END CKCVR1;                     /*                       @Y30LB25*/
         B     @EL00019                                            1127
*                                                                  1128
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - CKCVR2                               @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* FUNCTION - UPDATE A CVR AND CIR FOR THE CSN OF THE    @Y30LB25*/
*   /* OTHER CARTRIDGE TO THE PAIR FOR THE ONE ENTERED.      @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* INPUT -                                               @Y30LB25*/
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* OUTPUT -                                              @Y30LB25*/
*   /* COPY VOLUME RECORD                                    @Y30LB25*/
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1128
*CKCVR2:                            /*                       @Y30LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/
*                                                                  1128
CKCVR2   ST    @14,@SA00020                                        1128
*   /*****************************************************************/
*   /*                                                               */
*   /* GET THE CVR FROM THE CSN OF THE CARTRIDGE PAIRED      @Y30LB25*/
*   /* WITH THE ONE ENTERED                                  @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1129
*   CKEY=INDRECKY;                  /* CVR KEY               @Y30LB25*/
         MVC   CKEY(13),INDRECKY(INDEXPTR)                         1129
*   RPLVKEY=ADDR(CKEY);             /* ADDR OF CVR KEY       @Y30LB25*/
         LA    @08,CKEY                                            1130
         ST    @08,RPLVKEY(,RPLVPTR)                               1130
*   RPLVBUF=COPYVPTR;               /* PT TO CVR BUF         @Y30LB25*/
         ST    COPYVPTR,RPLVBUF(,RPLVPTR)                          1131
*   RPLVBLN=LENGTH(COPYBUF);        /* SET CVR BUF LENGTH    @Y30LB25*/
         MVC   RPLVBLN(4,RPLVPTR),@CF00805                         1132
*   RPLVTYP=RPLVREAD;               /* READ OPTION ON        @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'00'                              1133
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB25*/
         OI    RPLVDIR(RPLVPTR),B'01000000'                        1134
*   RPLVUPD=ON;                     /* READ FOR UPDATE       @Y30LB25*/
         OI    RPLVUPD(RPLVPTR),B'00000010'                        1135
*   RPLVLOC=OFF;                    /* NO LOCATE             @Y30LB25*/
         NI    RPLVLOC(RPLVPTR),B'01111111'                        1136
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         1138
*   CALL ICBVIO00;                  /* READ FOR CVR          @Y30LB25*/
         L     @15,@CV00610                                        1139
         BALR  @14,@15                                             1139
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1141
         N     @08,@CF00815                                        1141
         LTR   @08,@08                                             1141
         BZ    @RF01141                                            1141
*     DO;                           /* NO REC FND            @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         1143
*       RETURN;                     /*                       @Y30LB25*/
@EL00020 DS    0H                                                  1144
@EF00020 DS    0H                                                  1144
@ER00020 L     @14,@SA00020                                        1144
         BR    @14                                                 1144
*     END;                          /*                       @Y30LB25*/
*                                                                  1145
*   /*****************************************************************/
*   /*                                                               */
*   /* SET DOWN LEVEL SPACE FLAG                             @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1146
*   COPDLSPF=ON;                    /* DOWN LEVEL SPACE      @Y30LB25*/
*                                                                  1146
@RF01141 OI    COPDLSPF(COPYVPTR),B'01000000'                      1146
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR CORRECT RECORD                              @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1147
*   IF(CSN1USM=COPCSN1&CSN2USM=COPCSN2)×/* ALL CSNS MATCH?   @Y30LB25*/
*       (CSN1USM=COPCSN2&CSN2USM=COPCSN1)/*                  @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
         LA    @08,8                                               1147
         ALR   @08,MESGPTR                                         1147
         CLC   CSN1USM(12,@08),COPCSN1(COPYVPTR)                   1147
         BNE   @GL00028                                            1147
         CLC   CSN2USM(12,@08),COPCSN2(COPYVPTR)                   1147
         BE    @RT01147                                            1147
@GL00028 LA    @08,8                                               1147
         ALR   @08,MESGPTR                                         1147
         CLC   CSN1USM(12,@08),COPCSN2(COPYVPTR)                   1147
         BNE   @RF01147                                            1147
         CLC   CSN2USM(12,@08),COPCSN1(COPYVPTR)                   1147
         BNE   @RF01147                                            1147
@RT01147 DS    0H                                                  1148
*     DO;                           /*                       @Y30LB25*/
*                                                                  1148
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK FOR CSN1                                    @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1149
*       IF SEQNUM=ONEF1             /* CSN1?                 @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
         LA    @08,8                                               1149
         ALR   @08,MESGPTR                                         1149
         CLI   SEQNUM(@08),X'F1'                                   1149
         BNE   @RF01149                                            1149
*         DO;                       /*                       @Y30LB25*/
*                                                                  1150
*           /*********************************************************/
*           /*                                                       */
*           /* SET LIBID1                                    @Y30LB25*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1151
*           COPLIB1=COPLIB1&&COPLIB1;/* ZERO LIBID1          @Y30LB25*/
         SLR   @07,@07                                             1151
         IC    @07,COPLIB1(,COPYVPTR)                              1151
         LR    @04,@07                                             1151
         XR    @04,@07                                             1151
         STC   @04,COPLIB1(,COPYVPTR)                              1151
*           IF LUSM1=ON             /* BIT 1 ON?             @Y30LB25*/
*             THEN                  /* YES                   @Y30LB25*/
         TM    LUSM1(@08),B'10000000'                              1152
         BNO   @RF01152                                            1152
*             COP1BIT1=ON;          /* LIBID1 BIT1 ON        @Y30LB25*/
         OI    COP1BIT1(COPYVPTR),B'00000010'                      1153
*           IF LUSM2=ON             /* BIT 2 ON?             @Y30LB25*/
*             THEN                  /* YES                   @Y30LB25*/
@RF01152 TM    LUSM2+8(MESGPTR),B'01000000'                        1154
         BNO   @RF01154                                            1154
*             COP1BIT2=ON;          /* LIBID1 BIT2 ON        @Y30LB25*/
         OI    COP1BIT2(COPYVPTR),B'00000001'                      1155
*           COPCSN1=CSN1USM;        /* SET FIRST CSN         @ZM31119*/
@RF01154 LA    @08,8                                               1156
         ALR   @08,MESGPTR                                         1156
         MVC   COPCSN1(12,COPYVPTR),CSN1USM(@08)                   1156
*           COPCSN2=CSN2USM;        /* SET SECOND CSN        @ZM31119*/
         MVC   COPCSN2(12,COPYVPTR),CSN2USM(@08)                   1157
*         END;                      /*                       @Y30LB25*/
*                                                                  1158
*       /*************************************************************/
*       /*                                                           */
*       /* CSN2                                              @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1159
*       ELSE                        /* CSN2                  @Y30LB25*/
*                                                                  1159
*         /***********************************************************/
*         /*                                                         */
*         /* SET LIBID2                                      @Y30LB25*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  1159
*         DO;                       /*                       @Y30LB25*/
         B     @RC01149                                            1159
@RF01149 DS    0H                                                  1160
*           COPLIB2=COPLIB2&&COPLIB2;/* ZERO LIBID2          @Y30LB25*/
         SLR   @08,@08                                             1160
         IC    @08,COPLIB2(,COPYVPTR)                              1160
         LR    @07,@08                                             1160
         XR    @07,@08                                             1160
         STC   @07,COPLIB2(,COPYVPTR)                              1160
*           IF LUSM1=ON             /* BIT 1 ON?             @Y30LB25*/
*             THEN                  /* YES                   @Y30LB25*/
         TM    LUSM1+8(MESGPTR),B'10000000'                        1161
         BNO   @RF01161                                            1161
*             COP2BIT1=ON;          /* LIBID2 BIT1 ON        @Y30LB25*/
         OI    COP2BIT1(COPYVPTR),B'00000010'                      1162
*           IF LUSM2=ON             /* BIT 2 ON?             @Y30LB25*/
*             THEN                  /* YES                   @Y30LB25*/
@RF01161 TM    LUSM2+8(MESGPTR),B'01000000'                        1163
         BNO   @RF01163                                            1163
*             COP2BIT2=ON;          /* LIBID2 BIT2 ON        @Y30LB25*/
         OI    COP2BIT2(COPYVPTR),B'00000001'                      1164
*           COPCSN1=CSN2USM;        /* SET FIRST CSN         @ZM31119*/
@RF01163 LA    @08,8                                               1165
         ALR   @08,MESGPTR                                         1165
         MVC   COPCSN1(12,COPYVPTR),CSN2USM(@08)                   1165
*           COPCSN2=CSN1USM;        /* SET SECOND CSN        @ZM31119*/
         MVC   COPCSN2(12,COPYVPTR),CSN1USM(@08)                   1166
*         END;                      /*                       @Y30LB25*/
*                                                                  1167
*       /*************************************************************/
*       /*                                                           */
*       /* UPDATE THE CVR                                    @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1168
*       COPDTREM=BLANK4;            /* NULL DATE REMOVED     @Y30LB25*/
@RC01149 MVI   COPDTREM+1(COPYVPTR),C' '                           1168
         MVC   COPDTREM+2(2,COPYVPTR),COPDTREM+1(COPYVPTR)         1168
         MVI   COPDTREM(COPYVPTR),C' '                             1168
*       COPDEST=BLANK30;            /* NULL DESTINATION      @Y30LB25*/
*                                                                  1169
         MVI   COPDEST+1(COPYVPTR),C' '                            1169
         MVC   COPDEST+2(28,COPYVPTR),COPDEST+1(COPYVPTR)          1169
         MVI   COPDEST(COPYVPTR),C' '                              1169
*       /*************************************************************/
*       /*                                                           */
*       /* WRITE THE CVR                                     @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1170
*       RPLVTYP=RPLVPUT;            /* WRITE                 @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'01'                              1170
*       RESPECIFY                   /*                       @Y30LB25*/
*         RG1 RSTD;                 /* RESTRICT REG 1        @Y30LB25*/
*       RG1=RPLVPTR;                /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         1172
*       CALL ICBVIO00;              /* WRITE CVR             @Y30LB25*/
         L     @15,@CV00610                                        1173
         BALR  @14,@15                                             1173
*       RESPECIFY                   /*                       @Y30LB25*/
*         RG1 UNRSTD;               /* UNRESTRICT REG 1      @Y30LB25*/
*       IF RPLVRETC^=FIXZERO        /* CHECK RETN CODE       @Y30LB25*/
*         THEN                      /*                       @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1175
         N     @08,@CF00815                                        1175
         LTR   @08,@08                                             1175
         BZ    @RF01175                                            1175
*         CALL PLIBMSG;             /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         1176
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00020                                            1177
*     END;                          /*                       @Y30LB25*/
*                                                                  1178
*   /*****************************************************************/
*   /*                                                               */
*   /* THE CARTRIDGE ENTERED MUST NOT MATCH WITH EITHER      @Y30LB25*/
*   /* CSN1 OR CSN2 IN THE CVR                               @Y30LB25*/
*   /* FIND THE NONMATCH BY FINDING WHICH ONE THE CSN NOT    @Y30LB25*/
*   /* ENTERED MATCHES.                                      @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1179
*   IF COPCSN1^=CSN2USM             /* NO MATCH CSN1?        @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
@RF01147 LA    @08,8                                               1179
         ALR   @08,MESGPTR                                         1179
         CLC   COPCSN1(12,COPYVPTR),CSN2USM(@08)                   1179
         BE    @RF01179                                            1179
*     DO;                           /*                       @Y30LB25*/
*       IVOLKY=COPCSN1;             /* SAVE CSN1             @Y30LB25*/
         MVC   IVOLKY(12),COPCSN1(COPYVPTR)                        1181
*       COPCSN1=CSN1USM;            /* UPDATE CVR CSN1       @Y30LB25*/
         MVC   COPCSN1(12,COPYVPTR),CSN1USM(@08)                   1182
*       COPLIB1=COPLIB1&&COPLIB1;   /* ZERO LIBID1           @Y30LB25*/
         SLR   @04,@04                                             1183
         IC    @04,COPLIB1(,COPYVPTR)                              1183
         LR    @03,@04                                             1183
         XR    @03,@04                                             1183
         STC   @03,COPLIB1(,COPYVPTR)                              1183
*       IF LUSM1=ON                 /* BIT 1 ON?             @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
         TM    LUSM1(@08),B'10000000'                              1184
         BNO   @RF01184                                            1184
*         COP1BIT1=ON;              /* LIBID1 BIT1 ON        @Y30LB25*/
         OI    COP1BIT1(COPYVPTR),B'00000010'                      1185
*       IF LUSM2=ON                 /* BIT 2 ON?             @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
@RF01184 TM    LUSM2+8(MESGPTR),B'01000000'                        1186
         BNO   @RF01186                                            1186
*         COP1BIT2=ON;              /* LIBID1 BIT2 ON        @Y30LB25*/
         OI    COP1BIT2(COPYVPTR),B'00000001'                      1187
*       COPDTREM=BLANK4;            /* NULL DATE REMOVED     @Y30LB25*/
@RF01186 MVI   COPDTREM+1(COPYVPTR),C' '                           1188
         MVC   COPDTREM+2(2,COPYVPTR),COPDTREM+1(COPYVPTR)         1188
         MVI   COPDTREM(COPYVPTR),C' '                             1188
*       COPDEST=BLANK30;            /* NULL DESTINATION      @Y30LB25*/
         MVI   COPDEST+1(COPYVPTR),C' '                            1189
         MVC   COPDEST+2(28,COPYVPTR),COPDEST+1(COPYVPTR)          1189
         MVI   COPDEST(COPYVPTR),C' '                              1189
*       CALL CVRCSN1;               /* PROC CVR CSN1 CIR     @Y30LB25*/
         BAL   @14,CVRCSN1                                         1190
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00020                                            1191
*     END;                          /*                       @Y30LB25*/
*   ELSE                            /* NO MATCH CVR CSN2     @Y30LB25*/
*     DO;                           /*                       @Y30LB25*/
@RF01179 DS    0H                                                  1194
*       IVOLKY=COPCSN2;             /* SAVE CSN2             @Y30LB25*/
         MVC   IVOLKY(12),COPCSN2(COPYVPTR)                        1194
*       COPCSN2=CSN1USM;            /* UPDATE CVR CSN2       @Y30LB25*/
         LA    @08,8                                               1195
         ALR   @08,MESGPTR                                         1195
         MVC   COPCSN2(12,COPYVPTR),CSN1USM(@08)                   1195
*       COPLIB2=COPLIB2&&COPLIB2;   /* ZERO LIBID2           @Y30LB25*/
         SLR   @04,@04                                             1196
         IC    @04,COPLIB2(,COPYVPTR)                              1196
         LR    @03,@04                                             1196
         XR    @03,@04                                             1196
         STC   @03,COPLIB2(,COPYVPTR)                              1196
*       IF LUSM1=ON                 /* BIT 1 ON?             @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
         TM    LUSM1(@08),B'10000000'                              1197
         BNO   @RF01197                                            1197
*         COP2BIT1=ON;              /* LIBID2 BIT1 ON        @Y30LB25*/
         OI    COP2BIT1(COPYVPTR),B'00000010'                      1198
*       IF LUSM2=ON                 /* BIT 2 ON?             @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
@RF01197 TM    LUSM2+8(MESGPTR),B'01000000'                        1199
         BNO   @RF01199                                            1199
*         COP2BIT2=ON;              /* LIBID2 BIT2 ON        @Y30LB25*/
         OI    COP2BIT2(COPYVPTR),B'00000001'                      1200
*       COPDTREM=BLANK4;            /* NULL DATE REMOVED     @Y30LB25*/
@RF01199 MVI   COPDTREM+1(COPYVPTR),C' '                           1201
         MVC   COPDTREM+2(2,COPYVPTR),COPDTREM+1(COPYVPTR)         1201
         MVI   COPDTREM(COPYVPTR),C' '                             1201
*       COPDEST=BLANK30;            /* NULL DESTINATION      @Y30LB25*/
         MVI   COPDEST+1(COPYVPTR),C' '                            1202
         MVC   COPDEST+2(28,COPYVPTR),COPDEST+1(COPYVPTR)          1202
         MVI   COPDEST(COPYVPTR),C' '                              1202
*       CALL CVRCSN2;               /* PROC CVR CSN2 CIR     @Y30LB25*/
         BAL   @14,CVRCSN2                                         1203
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00020                                            1204
*     END;                          /*                       @Y30LB25*/
*   END CKCVR2;                     /*                       @Y30LB25*/
         B     @EL00020                                            1206
*                                                                  1207
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - CVRCSN1                              @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* FUNCTION - WRITE THE CVR.                             @Y30LB25*/
*   /* READ FOR CIR OF REPLACED CSN1.                        @Y30LB25*/
*   /* IF THERE IS NOT ONE OR IT DOES NOT POINT TO THE       @Y30LB25*/
*   /* CVR, CREATE A NEW CIR FOR CSN1 OF CVR AND RETURN.     @Y30LB25*/
*   /* OTHERWISE, CREATE A NEW CIR FOR THE NEW CSN1          @Y30LB25*/
*   /* AND DELETE THE OLD CSN.                               @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* INPUT -                                               @Y30LB25*/
*   /* COPY VOLUME RECORD                                    @Y30LB25*/
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* OUTPUT -                                              @Y30LB25*/
*   /* COPY VOLUME RECORD                                    @Y30LB25*/
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1207
*CVRCSN1:                           /*                       @Y30LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/
*                                                                  1207
CVRCSN1  ST    @14,@SA00021                                        1207
*   /*****************************************************************/
*   /*                                                               */
*   /* WRITE THE CVR FOR THE CARTRIDGE ENTERED               @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1208
*   RPLVTYP=RPLVPUT;                /* WRITE                 @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'01'                              1208
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         1210
*   CALL ICBVIO00;                  /* WRITE CVR             @Y30LB25*/
         L     @15,@CV00610                                        1211
         BALR  @14,@15                                             1211
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1213
         N     @08,@CF00815                                        1213
         LTR   @08,@08                                             1213
         BZ    @RF01213                                            1213
*     DO;                           /* NO REC FND            @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         1215
*       RETURN;                     /*                       @Y30LB25*/
@EL00021 DS    0H                                                  1216
@EF00021 DS    0H                                                  1216
@ER00021 L     @14,@SA00021                                        1216
         BR    @14                                                 1216
*     END;                          /*                       @Y30LB25*/
*                                                                  1217
*   /*****************************************************************/
*   /*                                                               */
*   /* READ FOR CIR OF REPLACED CSN1 OF THE CVR              @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1218
*   RPLVTYP=RPLVREAD;               /* READ                  @Y30LB25*/
@RF01213 MVI   RPLVTYP(RPLVPTR),X'00'                              1218
*   RPLVLOC=OFF;                    /* NO LOCATE             @Y30LB25*/
         NI    RPLVLOC(RPLVPTR),B'01111111'                        1219
*   RPLVUPD=ON;                     /* UPDATE                @Y30LB25*/
         OI    RPLVUPD(RPLVPTR),B'00000010'                        1220
*   RPLVDIR=ON;                     /* DIRECT                @Y30LB25*/
         OI    RPLVDIR(RPLVPTR),B'01000000'                        1221
*   RPLVKEY=ADDR(IKEY);             /* ADDR OF KEY           @Y30LB25*/
         LA    @08,IKEY                                            1222
         ST    @08,RPLVKEY(,RPLVPTR)                               1222
*   RPLVBUF=INDEXPTR;               /* PTR TO CIR BUF        @Y30LB25*/
         ST    INDEXPTR,RPLVBUF(,RPLVPTR)                          1223
*   RPLVBLN=LENGTH(INDEXBUF);       /* CIR BUF LENGTH        @Y30LB25*/
         MVC   RPLVBLN(4,RPLVPTR),@CF00806                         1224
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         1226
*   CALL ICBVIO00;                  /* READ CIR              @Y30LB25*/
         L     @15,@CV00610                                        1227
         BALR  @14,@15                                             1227
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLRCODE=IOERROR             /* CK REASON CODE        @Y30LB25*/
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/
         CLC   RPLRCODE(2,RPLVPTR),@CB00588                        1229
         BNE   @RF01229                                            1229
*     DO;                           /* NO REC FND            @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         1231
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00021                                            1232
*     END;                          /*                       @Y30LB25*/
*                                                                  1233
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK THE RECORD, IF ANY                              @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1234
*   IF RPLRCODE=NORECFND×INDVSRNO^=COPSERNO/*                @Y30LB25
*                                      NO RECORD FND OR      @Y30LB25
*                                      WRONG SERIAL NO?      @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
@RF01229 CLC   RPLRCODE(2,RPLVPTR),@CB00586                        1234
         BE    @RT01234                                            1234
         CLC   INDVSRNO(6,INDEXPTR),COPSERNO(COPYVPTR)             1234
         BE    @RF01234                                            1234
@RT01234 DS    0H                                                  1235
*     DO;                           /*                       @Y30LB25*/
*                                                                  1235
*       /*************************************************************/
*       /*                                                           */
*       /* CREATE A CIR FOR CSN1                             @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1236
*       CSNUMBER=ON;                /* CSN1                  @Y30LB25*/
         OI    CSNUMBER,B'00000100'                                1236
*       BCDVPTR=COPYVPTR;           /* CVR PTR               @Y30LB25*/
         ST    COPYVPTR,BCDVPTR                                    1237
*       CALL VUCIR;                 /*                       @Y30LB25
*                                      MAKE CIR FOR CSN1     @Y30LB25*/
         BAL   @14,VUCIR                                           1238
*       IF RPLVRETC^=FIXZERO        /* CK RETURN CODE        @Y30LB25*/
*         THEN                      /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1239
         N     @08,@CF00815                                        1239
         LTR   @08,@08                                             1239
         BZ    @RF01239                                            1239
*         CALL PLIBMSG;             /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         1240
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00021                                            1241
*     END;                          /*                       @Y30LB25*/
*                                                                  1242
*   /*****************************************************************/
*   /*                                                               */
*   /* DELETE CIR FOR THE REPLACED CSN1                      @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1243
*   RPLVTYP=RPLVDEL;                /* DELETE                @Y30LB25*/
@RF01234 MVI   RPLVTYP(RPLVPTR),X'05'                              1243
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         1245
*   CALL ICBVIO00;                  /* DELETE CIR            @Y30LB25*/
         L     @15,@CV00610                                        1246
         BALR  @14,@15                                             1246
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1248
         N     @08,@CF00815                                        1248
         LTR   @08,@08                                             1248
         BZ    @RF01248                                            1248
*     DO;                           /* NO REC FND            @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         1250
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00021                                            1251
*     END;                          /*                       @Y30LB25*/
*                                                                  1252
*   /*****************************************************************/
*   /*                                                               */
*   /* CREATE A CIR FOR CSN1                                 @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1253
*   CSNUMBER=ON;                    /* CSN1                  @Y30LB25*/
@RF01248 OI    CSNUMBER,B'00000100'                                1253
*   BCDVPTR=COPYVPTR;               /* CVR PTR               @Y30LB25*/
         ST    COPYVPTR,BCDVPTR                                    1254
*   CALL VUCIR;                     /*                       @Y30LB25
*                                      MAKE CIR FOR CSN1     @Y30LB25*/
         BAL   @14,VUCIR                                           1255
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/
*     THEN                          /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1256
         N     @08,@CF00815                                        1256
         LTR   @08,@08                                             1256
         BZ    @RF01256                                            1256
*     CALL PLIBMSG;                 /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         1257
*   RETURN;                         /*                       @Y30LB25*/
         B     @EL00021                                            1258
*   END CVRCSN1;                    /*                       @Y30LB25*/
         B     @EL00021                                            1259
*                                                                  1260
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - CVRCSN2                              @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* FUNCTION - WRITE THE CVR.                             @Y30LB25*/
*   /* READ FOR CIR OF REPLACED CSN2.                        @Y30LB25*/
*   /* IF THERE IS NOT ONE OR IT DOES NOT POINT TO THE       @Y30LB25*/
*   /* CVR, CREATE A NEW CIR FOR CSN2 OF CVR AND RETURN.     @Y30LB25*/
*   /* OTHERWISE, CREATE A NEW CIR FOR THE NEW CSN2          @Y30LB25*/
*   /* AND DELETE THE OLD CSN.                               @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* INPUT -                                               @Y30LB25*/
*   /* COPY VOLUME RECORD                                    @Y30LB25*/
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* OUTPUT -                                              @Y30LB25*/
*   /* COPY VOLUME RECORD                                    @Y30LB25*/
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1260
*CVRCSN2:                           /*                       @Y30LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/
*                                                                  1260
CVRCSN2  ST    @14,@SA00022                                        1260
*   /*****************************************************************/
*   /*                                                               */
*   /* WRITE THE CVR FOR THE CARTRIDGE PAIRED WITH THE       @Y30LB25*/
*   /* ONE ENTERED                                           @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1261
*   RPLVTYP=RPLVPUT;                /* WRITE                 @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'01'                              1261
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         1263
*   CALL ICBVIO00;                  /* WRITE CVR             @Y30LB25*/
         L     @15,@CV00610                                        1264
         BALR  @14,@15                                             1264
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1266
         N     @08,@CF00815                                        1266
         LTR   @08,@08                                             1266
         BZ    @RF01266                                            1266
*     DO;                           /* NO REC FND            @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         1268
*       RETURN;                     /*                       @Y30LB25*/
@EL00022 DS    0H                                                  1269
@EF00022 DS    0H                                                  1269
@ER00022 L     @14,@SA00022                                        1269
         BR    @14                                                 1269
*     END;                          /*                       @Y30LB25*/
*                                                                  1270
*   /*****************************************************************/
*   /*                                                               */
*   /* READ FOR CIR OF REPLACED CSN2 OF THE CVR              @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1271
*   RPLVTYP=RPLVREAD;               /* READ                  @Y30LB25*/
@RF01266 MVI   RPLVTYP(RPLVPTR),X'00'                              1271
*   RPLVLOC=OFF;                    /* NO LOCATE             @Y30LB25*/
         NI    RPLVLOC(RPLVPTR),B'01111111'                        1272
*   RPLVUPD=ON;                     /* UPDATE                @Y30LB25*/
         OI    RPLVUPD(RPLVPTR),B'00000010'                        1273
*   RPLVDIR=ON;                     /* DIRECT                @Y30LB25*/
         OI    RPLVDIR(RPLVPTR),B'01000000'                        1274
*   RPLVKEY=ADDR(IKEY);             /* ADDR OF KEY           @Y30LB25*/
         LA    @08,IKEY                                            1275
         ST    @08,RPLVKEY(,RPLVPTR)                               1275
*   RPLVBUF=INDEXPTR;               /* PTR TO CIR BUF        @Y30LB25*/
         ST    INDEXPTR,RPLVBUF(,RPLVPTR)                          1276
*   RPLVBLN=LENGTH(INDEXBUF);       /* CIR BUF LENGTH        @Y30LB25*/
         MVC   RPLVBLN(4,RPLVPTR),@CF00806                         1277
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         1279
*   CALL ICBVIO00;                  /* READ CIR              @Y30LB25*/
         L     @15,@CV00610                                        1280
         BALR  @14,@15                                             1280
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLRCODE=IOERROR             /* CK REASON CODE        @Y30LB25*/
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/
         CLC   RPLRCODE(2,RPLVPTR),@CB00588                        1282
         BNE   @RF01282                                            1282
*     DO;                           /* NO REC FND            @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         1284
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00022                                            1285
*     END;                          /*                       @Y30LB25*/
*                                                                  1286
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK THE RECORD, IF ANY                              @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1287
*   IF RPLRCODE=NORECFND×INDVSRNO^=COPSERNO/*                @Y30LB25
*                                      NO RECORD FND OR      @Y30LB25
*                                      WRONG SERIAL NO?      @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
@RF01282 CLC   RPLRCODE(2,RPLVPTR),@CB00586                        1287
         BE    @RT01287                                            1287
         CLC   INDVSRNO(6,INDEXPTR),COPSERNO(COPYVPTR)             1287
         BE    @RF01287                                            1287
@RT01287 DS    0H                                                  1288
*     DO;                           /*                       @Y30LB25*/
*                                                                  1288
*       /*************************************************************/
*       /*                                                           */
*       /* CREATE A CIR FOR CSN2                             @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1289
*       CSNUMBER=OFF;               /* CSN2                  @Y30LB25*/
         NI    CSNUMBER,B'11111011'                                1289
*       BCDVPTR=COPYVPTR;           /* CVR PTR               @Y30LB25*/
         ST    COPYVPTR,BCDVPTR                                    1290
*       CALL VUCIR;                 /*                       @Y30LB25
*                                      MAKE CIR FOR CSN2     @Y30LB25*/
         BAL   @14,VUCIR                                           1291
*       IF RPLVRETC^=FIXZERO        /* CK RETURN CODE        @Y30LB25*/
*         THEN                      /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1292
         N     @08,@CF00815                                        1292
         LTR   @08,@08                                             1292
         BZ    @RF01292                                            1292
*         CALL PLIBMSG;             /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         1293
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00022                                            1294
*     END;                          /*                       @Y30LB25*/
*                                                                  1295
*   /*****************************************************************/
*   /*                                                               */
*   /* DELETE CIR FOR THE REPLACED CSN2                      @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1296
*   RPLVTYP=RPLVDEL;                /* DELETE                @Y30LB25*/
@RF01287 MVI   RPLVTYP(RPLVPTR),X'05'                              1296
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         1298
*   CALL ICBVIO00;                  /* DELETE CIR            @Y30LB25*/
         L     @15,@CV00610                                        1299
         BALR  @14,@15                                             1299
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1301
         N     @08,@CF00815                                        1301
         LTR   @08,@08                                             1301
         BZ    @RF01301                                            1301
*     DO;                           /* NO REC FND            @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         1303
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00022                                            1304
*     END;                          /*                       @Y30LB25*/
*                                                                  1305
*   /*****************************************************************/
*   /*                                                               */
*   /* CREATE A CIR FOR CSN2                                 @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1306
*   CSNUMBER=OFF;                   /* CSN2                  @Y30LB25*/
@RF01301 NI    CSNUMBER,B'11111011'                                1306
*   BCDVPTR=COPYVPTR;               /* CVR PTR               @Y30LB25*/
         ST    COPYVPTR,BCDVPTR                                    1307
*   CALL VUCIR;                     /*                       @Y30LB25
*                                      MAKE CIR FOR CSN2     @Y30LB25*/
         BAL   @14,VUCIR                                           1308
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/
*     THEN                          /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1309
         N     @08,@CF00815                                        1309
         LTR   @08,@08                                             1309
         BZ    @RF01309                                            1309
*     CALL PLIBMSG;                 /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         1310
*   RETURN;                         /*                       @Y30LB25*/
         B     @EL00022                                            1311
*   END CVRCSN2;                    /*                       @Y30LB25*/
         B     @EL00022                                            1312
*                                                                  1313
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - NONEFND                              @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* FUNCTION - READ FOR A BVR. IF ONE IS FOUND,           @Y30LB25*/
*   /* THEN CREATE A DVR AND ITS CIRS, AND WRITE THEM.       @Y30LB25*/
*   /* IF NONE IS FOUND, THEN CREATE AN INACTIVE BVR         @Y30LB25*/
*   /* AND ITS CIRS, CHAIN THE BVR INTO THE NGVR,            @Y30LB25*/
*   /* AND WRITE THEM.                                       @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* INPUT -                                               @Y30LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* OUTPUT -                                              @Y30LB25*/
*   /* BASE VOLUME RECORD                                    @Y30LB25*/
*   /* CARTRIDGE INDEX RECORDS                               @Y30LB25*/
*   /* DUPLICATE VOLUME RECORD                               @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1313
*NONEFND:                           /*                       @Y30LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/
*                                                                  1313
NONEFND  ST    @14,@SA00023                                        1313
*   /*****************************************************************/
*   /*                                                               */
*   /* READ FOR A BVR                                        @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1314
*   BVOLKY=VOLIDUSM;                /* SET VOLID             @Y30LB25*/
         MVC   BVOLKY(6),VOLIDUSM+8(MESGPTR)                       1314
*   RPLVTYP=RPLVREAD;               /* READ                  @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'00'                              1315
*   RPLVLOC=ON;                     /* LOCATE READ           @Y30LB25*/
         OI    RPLVLOC(RPLVPTR),B'10000000'                        1316
*   RPLVUPD=OFF;                    /* NO UPDATE             @Y30LB25*/
         NI    RPLVUPD(RPLVPTR),B'11111101'                        1317
*   RPLVDIR=ON;                     /* DIRECT                @Y30LB25*/
         OI    RPLVDIR(RPLVPTR),B'01000000'                        1318
*   RPLVKEY=ADDR(BKEY);             /* ADDR OF KEY           @Y30LB25*/
         LA    @08,BKEY                                            1319
         ST    @08,RPLVKEY(,RPLVPTR)                               1319
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         1321
*   CALL ICBVIO00;                  /* READ FOR BVR          @Y30LB25*/
         L     @15,@CV00610                                        1322
         BALR  @14,@15                                             1322
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLRCODE=IOERROR             /* CK REASON CODE        @Y30LB25*/
*     THEN                          /* I/O ERROR             @Y30LB25*/
         CLC   RPLRCODE(2,RPLVPTR),@CB00588                        1324
         BNE   @RF01324                                            1324
*     DO;                           /*                       @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         1326
*       RETURN;                     /*                       @Y30LB25*/
@EL00023 DS    0H                                                  1327
@EF00023 DS    0H                                                  1327
@ER00023 L     @14,@SA00023                                        1327
         BR    @14                                                 1327
*     END;                          /*                       @Y30LB25*/
*                                                                  1328
*   /*****************************************************************/
*   /*                                                               */
*   /* NO BVR FOUND                                          @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1329
*   IF RPLRCODE=NORECFND            /* NO REC FOUND?         @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
@RF01324 CLC   RPLRCODE(2,RPLVPTR),@CB00586                        1329
         BNE   @RF01329                                            1329
*     DO;                           /*                       @Y30LB25*/
*                                                                  1330
*       /*************************************************************/
*       /*                                                           */
*       /* CREATE A BVR                                      @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1331
*       RPLRCODE=RPLRCODE&&RPLRCODE;/* ZERO REASON CODE      @Y30LB25*/
         XC    RPLRCODE(2,RPLVPTR),RPLRCODE(RPLVPTR)               1331
*       RPLVRETC=RPLVRETC&&RPLVRETC;/* ZERO RETURN CODE      @Y30LB25*/
         XC    RPLVRETC(2,RPLVPTR),RPLVRETC(RPLVPTR)               1332
*       CALL CRTBVR;                /* CREATE BVR            @Y30LB25*/
         BAL   @14,CRTBVR                                          1333
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00023                                            1334
*     END;                          /*                       @Y30LB25*/
*                                                                  1335
*   /*****************************************************************/
*   /*                                                               */
*   /* BVR WAS FOUND                                         @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1336
*   ELSE                            /* BVR WAS FOUND         @Y30LB25*/
*     DO;                           /*                       @Y30LB25*/
*                                                                  1336
@RF01329 DS    0H                                                  1337
*       /*************************************************************/
*       /*                                                           */
*       /* CREATE A DVR                                      @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1337
*       RPLRCODE=RPLRCODE&&RPLRCODE;/* ZERO REASON CODE      @Y30LB25*/
         XC    RPLRCODE(2,RPLVPTR),RPLRCODE(RPLVPTR)               1337
*       RPLVRETC=RPLVRETC&&RPLVRETC;/* ZERO RETURN CODE      @Y30LB25*/
         XC    RPLVRETC(2,RPLVPTR),RPLVRETC(RPLVPTR)               1338
*       CALL CRTDVR;                /* CREATE DVR            @Y30LB25*/
         BAL   @14,CRTDVR                                          1339
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00023                                            1340
*     END;                          /*                       @Y30LB25*/
*   END NONEFND;                    /*                       @Y30LB25*/
*                                                                  1343
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - CRTBVR                               @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* FUNCTION - INITIALIZE AND WRITE A BVR AND ITS CIRS.   @Y30LB25*/
*   /* CHAIN THE BVR INTO THE NGVR.                          @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* INPUT -                                               @Y30LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* OUTPUT -                                              @Y30LB25*/
*   /* BASE VOLUME RECORD                                    @Y30LB25*/
*   /* CARTRIDGE INDEX RECORDS                               @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1343
*CRTBVR:                            /*                       @Y30LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/
*                                                                  1343
CRTBVR   ST    @14,@SA00024                                        1343
*   /*****************************************************************/
*   /*                                                               */
*   /* INITIALIZE AND SET-UP THE BVR                         @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1344
*   BASEBUF=BASEBUF&&BASEBUF;       /* ZERO BVR BUFFER       @Y30LB25*/
         XC    BASEBUF(224),BASEBUF                                1344
*   BASNAME=BKEY;                   /* SET BVR KEY           @Y30LB25*/
         L     @08,BASEVPTR                                        1345
         MVC   BASNAME(13,@08),BKEY                                1345
*   BASBASVR=ON;                    /* BVR FLAG              @Y30LB25*/
         OI    BASBASVR(@08),B'00100000'                           1346
*   IF SEQNUM=ONEF1                 /* CSN1?                 @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
         LA    @04,8                                               1347
         ALR   @04,MESGPTR                                         1347
         CLI   SEQNUM(@04),X'F1'                                   1347
         BNE   @RF01347                                            1347
*     DO;                           /*                       @Y30LB25*/
*       BASCSN1=CSN1USM;            /* SET CSN1              @Y30LB25*/
         MVC   BASCSN1(12,@08),CSN1USM(@04)                        1349
*       BASCSN2=CSN2USM;            /* INIT CSN2             @YM31076*/
         MVC   BASCSN2(12,@08),CSN2USM(@04)                        1350
*       BASLIB2=FIX2FS;             /* INIT LIBID2           @Y30LB25*/
         L     @03,@CF00550                                        1351
         STC   @03,BASLIB2(,@08)                                   1351
*       BASLIB1=BASLIB1&&BASLIB1;   /* ZERO LIBID1           @Y30LB25*/
         SLR   @03,@03                                             1352
         IC    @03,BASLIB1(,@08)                                   1352
         LR    @15,@03                                             1352
         XR    @15,@03                                             1352
         STC   @15,BASLIB1(,@08)                                   1352
*       IF LUSM1=ON                 /* BIT 1 ON?             @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
         TM    LUSM1(@04),B'10000000'                              1353
         BNO   @RF01353                                            1353
*         BAS1BIT1=ON;              /* LIBID1 BIT 1 ON       @Y30LB25*/
         OI    BAS1BIT1(@08),B'00000010'                           1354
*       IF LUSM2=ON                 /* BIT 2 ON?             @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
@RF01353 TM    LUSM2+8(MESGPTR),B'01000000'                        1355
         BNO   @RF01355                                            1355
*         BAS1BIT2=ON;              /* LIBID1 BIT 2 ON       @Y30LB25*/
         L     @08,BASEVPTR                                        1356
         OI    BAS1BIT2(@08),B'00000001'                           1356
*     END;                          /*                       @Y30LB25*/
*   ELSE                            /* CSN2                  @Y30LB25*/
*     DO;                           /*                       @Y30LB25*/
         B     @RC01347                                            1358
@RF01347 DS    0H                                                  1359
*       BASCSN2=CSN1USM;            /* SET CSN2              @Y30LB25*/
         L     @08,BASEVPTR                                        1359
         LA    @04,8                                               1359
         ALR   @04,MESGPTR                                         1359
         MVC   BASCSN2(12,@08),CSN1USM(@04)                        1359
*       BASCSN1=CSN2USM;            /* INIT CSN1             @YM31076*/
         MVC   BASCSN1(12,@08),CSN2USM(@04)                        1360
*       BASLIB1=FIX2FS;             /* INIT LIBID1           @Y30LB25*/
         L     @03,@CF00550                                        1361
         STC   @03,BASLIB1(,@08)                                   1361
*       BASLIB2=BASLIB2&&BASLIB2;   /* ZERO LIBID2           @Y30LB25*/
         SLR   @03,@03                                             1362
         IC    @03,BASLIB2(,@08)                                   1362
         LR    @15,@03                                             1362
         XR    @15,@03                                             1362
         STC   @15,BASLIB2(,@08)                                   1362
*       IF LUSM1=ON                 /* BIT 1 ON?             @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
         TM    LUSM1(@04),B'10000000'                              1363
         BNO   @RF01363                                            1363
*         BAS2BIT1=ON;              /* LIBID2 BIT 1 ON       @Y30LB25*/
         OI    BAS2BIT1(@08),B'00000010'                           1364
*       IF LUSM2=ON                 /* BIT 2 ON?             @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
@RF01363 TM    LUSM2+8(MESGPTR),B'01000000'                        1365
         BNO   @RF01365                                            1365
*         BAS2BIT2=ON;              /* LIBID2 BIT 2 ON       @Y30LB25*/
         L     @08,BASEVPTR                                        1366
         OI    BAS2BIT2(@08),B'00000001'                           1366
*     END;                          /*                       @Y30LB25*/
@RF01365 DS    0H                                                  1368
*   BASDLSF=ON;                     /* DOWN LEVEL SPACE      @Y30LB25*/
@RC01347 L     @08,BASEVPTR                                        1368
         OI    BASDLSF(@08),B'10000000'                            1368
*   BASBKLMT=FIXONE;                /* BKUP LIMIT = 1        @Y30LB25*/
         MVI   BASBKLMT(@08),X'01'                                 1369
*   BASINAC=ON;                     /* INACTIVE VOL          @Y30LB25*/
         OI    BASINAC(@08),B'00000100'                            1370
*   BASFRESP=FIX2FS;                /* # FREE CYLDERS        @Y30LB25*/
         L     @04,@CF00550                                        1371
         STH   @04,BASFRESP(,@08)                                  1371
*   BASLEXT=FIX2FS;                 /* LARGE FREE EXTENT     @Y30LB25*/
         STH   @04,BASLEXT(,@08)                                   1372
*   BASFREXT=FIX4FS;                /* # FREE EXTENTS        @Y30LB25*/
         MVC   BASFREXT(4,@08),@CF00552                            1373
*   BASEXPDT=FIX4FS;                /* EXPIR DATE            @Y30LB25*/
         MVC   BASEXPDT(4,@08),@CB00552                            1374
*   BASPREV=BLANK6;                 /* PREV BVR PTR          @Y30LB25*/
         MVI   BASPREV+1(@08),C' '                                 1375
         MVC   BASPREV+2(4,@08),BASPREV+1(@08)                     1375
         MVI   BASPREV(@08),C' '                                   1375
*   BASNEXTV=BLANK6;                /* NEXT BVR PTR          @Y30LB25*/
         MVI   BASNEXTV+1(@08),C' '                                1376
         MVC   BASNEXTV+2(4,@08),BASNEXTV+1(@08)                   1376
         MVI   BASNEXTV(@08),C' '                                  1376
*   BASKLCPY=BLANK13;               /* KEY LATEST COPY       @Y30LB25*/
         MVC   BASKLCPY(13,@08),@CC00575                           1377
*   BASDLMTD=BLANK4;                /* LAST MOUNT DATE       @Y30LB25*/
         MVI   BASDLMTD+1(@08),C' '                                1378
         MVC   BASDLMTD+2(2,@08),BASDLMTD+1(@08)                   1378
         MVI   BASDLMTD(@08),C' '                                  1378
*   BASDTREM=BLANK4;                /* EJECT DATE            @Y30LB25*/
         MVI   BASDTREM+1(@08),C' '                                1379
         MVC   BASDTREM+2(2,@08),BASDTREM+1(@08)                   1379
         MVI   BASDTREM(@08),C' '                                  1379
*   BASDESCR=BLANK30;               /* DESCRIPTION           @Y30LB25*/
         MVI   BASDESCR+1(@08),C' '                                1380
         MVC   BASDESCR+2(28,@08),BASDESCR+1(@08)                  1380
         MVI   BASDESCR(@08),C' '                                  1380
*   BASOWNER=BLANK10;               /* OWNER                 @Y30LB25*/
         MVI   BASOWNER+1(@08),C' '                                1381
         MVC   BASOWNER+2(8,@08),BASOWNER+1(@08)                   1381
         MVI   BASOWNER(@08),C' '                                  1381
*   BASDEST=BLANK30;                /* DEST AFTER EJECT      @Y30LB25*/
         MVI   BASDEST+1(@08),C' '                                 1382
         MVC   BASDEST+2(28,@08),BASDEST+1(@08)                    1382
         MVI   BASDEST(@08),C' '                                   1382
*   BASRECOV=BLANK6;                /* SERIAL # RECOVERY     @Y30LB25*/
         MVI   BASRECOV+1(@08),C' '                                1383
         MVC   BASRECOV+2(4,@08),BASRECOV+1(@08)                   1383
         MVI   BASRECOV(@08),C' '                                  1383
*   BASGROUP=BLANK8;                /* GROUP NAME            @Y30LB25*/
*                                                                  1384
         MVI   BASGROUP+1(@08),C' '                                1384
         MVC   BASGROUP+2(6,@08),BASGROUP+1(@08)                   1384
         MVI   BASGROUP(@08),C' '                                  1384
*   /*****************************************************************/
*   /*                                                               */
*   /* CHAIN THE BVR INTO THE NGVR BVR CHAIN                 @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1385
*   GRPFLG=OFF;                     /* NON-GROUPED           @Y30LB25*/
         NI    GRPFLG,B'11101111'                                  1385
*   CALL ICBVUCHI(FIXZERO,BASEVPTR,RPLVPTR,BYTEPASS);/*      @Y30LB25
*                                      CHAIN BVR INTO NGVR           */
         ST    RPLVPTR,@TF00001                                    1386
         L     @15,@CV00614                                        1386
         LA    @01,@AL01386                                        1386
         BALR  @14,@15                                             1386
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/
*     THEN                          /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1387
         N     @08,@CF00815                                        1387
         LTR   @08,@08                                             1387
         BZ    @RF01387                                            1387
*     DO;                           /*                       @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         1389
*       RETURN;                     /*                       @Y30LB25*/
@EL00024 DS    0H                                                  1390
@EF00024 DS    0H                                                  1390
@ER00024 L     @14,@SA00024                                        1390
         BR    @14                                                 1390
*     END;                          /*                       @Y30LB25*/
*                                                                  1391
*   /*****************************************************************/
*   /*                                                               */
*   /* WRITE THE NEW BVR                                     @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1392
*   RPLVBLN=LENGTH(BASEBUF);        /* BVR BUF LENGTH        @Y30LB25*/
@RF01387 LA    @08,224                                             1392
         ST    @08,RPLVBLN(,RPLVPTR)                               1392
*   RPLVRLN=LENGTH(BASEBUF);        /* BVR LENGTH            @Y30LB25*/
         ST    @08,RPLVRLN(,RPLVPTR)                               1393
*   RPLVBUF=BASEVPTR;               /* BVR BUF PTR           @Y30LB25*/
         L     @08,BASEVPTR                                        1394
         ST    @08,RPLVBUF(,RPLVPTR)                               1394
*   RPLVUPD=OFF;                    /* NEW RECORD            @Y30LB25*/
         NI    RPLVUPD(RPLVPTR),B'11111101'                        1395
*   RPLVDIR=OFF;                    /* NO DIRECT             @Y30LB25*/
*   RPLVLOC=OFF;                    /* NO LOCATE             @Y30LB25*/
         NI    RPLVDIR(RPLVPTR),B'00111111'                        1397
*   RPLVTYP=RPLVPUT;                /* WRITE                 @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'01'                              1398
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         1400
*   CALL ICBVIO00;                  /* WRITE NEW BVR         @Y30LB25*/
         L     @15,@CV00610                                        1401
         BALR  @14,@15                                             1401
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/
*     THEN                          /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1403
         N     @08,@CF00815                                        1403
         LTR   @08,@08                                             1403
         BZ    @RF01403                                            1403
*     DO;                           /*                       @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         1405
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00024                                            1406
*     END;                          /*                       @Y30LB25*/
*                                                                  1407
*   /*****************************************************************/
*   /*                                                               */
*   /* CREATE THE CIRS FOR THE BVR                           @YM31076*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1408
*   BCDVPTR=BASEVPTR;               /* SET UP FOR BVR        @YM31076*/
@RF01403 L     @08,BASEVPTR                                        1408
         ST    @08,BCDVPTR                                         1408
*   CALL CRT2CIR;                   /* CREATE CVIRS          @YM31076*/
         BAL   @14,CRT2CIR                                         1409
*   END CRTBVR;                     /*                       @Y30LB25*/
         B     @EL00024                                            1410
*                                                                  1411
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - CRTDVR                               @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* FUNCTION - LOCATE THE FIRST AVAILABLE DVR KEY.        @Y30LB25*/
*   /* INITIALIZE AND WRITE A DVR AND ITS CIRS.              @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* INPUT -                                               @Y30LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* OUTPUT -                                              @Y30LB25*/
*   /* DUPLICATE VOLUME RECORD                               @Y30LB25*/
*   /* CARTRIDGE INDEX RECORDS                               @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1411
*CRTDVR:                            /*                       @Y30LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/
*                                                                  1411
CRTDVR   ST    @14,@SA00025                                        1411
*   /*****************************************************************/
*   /*                                                               */
*   /* FIND AN ID FOR THE DVR                                @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1412
*   DVOLKY=VOLIDUSM;                /* SET VOLID             @Y30LB25*/
         MVC   DVOLKY(6),VOLIDUSM+8(MESGPTR)                       1412
*   RPLVTYP=RPLVREAD;               /* READ                  @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'00'                              1413
*   RPLVLOC=ON;                     /* LOCATE                @Y30LB25*/
*   RPLVDIR=ON;                     /* DIRECT                @Y30LB25*/
         OI    RPLVLOC(RPLVPTR),B'11000000'                        1415
*   RPLVUPD=OFF;                    /* NO UPDATE             @Y30LB25*/
         NI    RPLVUPD(RPLVPTR),B'11111101'                        1416
*   RPLVKEY=ADDR(DKEY);             /* ADDR OF KEY           @Y30LB25*/
         LA    @08,DKEY                                            1417
         ST    @08,RPLVKEY(,RPLVPTR)                               1417
*   DIDKY=FIXZERO;                  /* START DVR 0           @Y30LB25*/
         MVI   DIDKY,X'00'                                         1418
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         1420
*   A=FIXONE;                       /* LOOP CONTROL          @Y30LB25*/
         LA    A,1                                                 1421
*   DO WHILE A=1;                   /* FIND AVAIL DVR        @Y30LB25*/
         B     @DE01422                                            1422
@DL01422 DS    0H                                                  1423
*     DIDKY=DIDKY+FIXONE;           /* NEXT KEY              @Y30LB25*/
         LA    @08,1                                               1423
         SLR   @04,@04                                             1423
         IC    @04,DIDKY                                           1423
         ALR   @08,@04                                             1423
         STC   @08,DIDKY                                           1423
*     CALL ICBVIO00;                /* READ FOR DVR          @Y30LB25*/
         L     @15,@CV00610                                        1424
         BALR  @14,@15                                             1424
*     IF RPLVRETC^=FIXZERO×DIDKY=FIX255/* ERROR?             @Y30LB25*/
*       THEN                        /* YES                   @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1425
         N     @08,@CF00815                                        1425
         LTR   @08,@08                                             1425
         BNZ   @RT01425                                            1425
         CLI   DIDKY,255                                           1425
         BNE   @RF01425                                            1425
@RT01425 DS    0H                                                  1426
*       A=FIXZERO;                  /* END LOOP              @Y30LB25*/
         SLR   A,A                                                 1426
*   END;                            /*                       @Y30LB25*/
@RF01425 DS    0H                                                  1427
@DE01422 C     A,@CF00045                                          1427
         BE    @DL01422                                            1427
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC=FIXZERO×RPLRCODE=IOERROR/* ERROR?            @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1429
         N     @08,@CF00815                                        1429
         LTR   @08,@08                                             1429
         BZ    @RT01429                                            1429
         CLC   RPLRCODE(2,RPLVPTR),@CB00588                        1429
         BNE   @RF01429                                            1429
@RT01429 DS    0H                                                  1430
*     DO;                           /*                       @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         1431
*       RETURN;                     /*                       @Y30LB25*/
@EL00025 DS    0H                                                  1432
@EF00025 DS    0H                                                  1432
@ER00025 L     @14,@SA00025                                        1432
         BR    @14                                                 1432
*     END;                          /*                       @Y30LB25*/
*   RPLRCODE=RPLRCODE&&RPLRCODE;    /* ZERO REASON CODE      @Y30LB25*/
@RF01429 XC    RPLRCODE(2,RPLVPTR),RPLRCODE(RPLVPTR)               1434
*   RPLVRETC=RPLVRETC&&RPLVRETC;    /* ZERO RETURN CODE      @Y30LB25*/
*                                                                  1435
         XC    RPLVRETC(2,RPLVPTR),RPLVRETC(RPLVPTR)               1435
*   /*****************************************************************/
*   /*                                                               */
*   /* INITIALIZE AND SET-UP THE DVR                         @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1436
*   DUPVBUF=DUPVBUF&&DUPVBUF;       /* ZERO DVR BUFFER       @Y30LB25*/
         XC    DUPVBUF(224),DUPVBUF                                1436
*   DUPNO=DIDKY;                    /* SET AVAIL DVR #       @Y30LB25*/
         L     @08,DUPVPTR                                         1437
         MVC   DUPNO(1,@08),DIDKY                                  1437
*   DUPD=D4BLANKS;                  /* D & 4 BLANKS          @Y30LB25*/
         MVC   DUPD(5,@08),@CC00466                                1438
*   DUPSERNO=VOLIDUSM;              /* SET VOLID             @Y30LB25*/
         LA    @04,8                                               1439
         ALR   @04,MESGPTR                                         1439
         MVC   DUPSERNO(6,@08),VOLIDUSM(@04)                       1439
*   DUPBLANK=BLANK1;                /* 1 BLANK               @Y30LB25*/
         MVI   DUPBLANK(@08),C' '                                  1440
*   DUPDUPLR=ON;                    /* DVR FLAG              @Y30LB25*/
         OI    DUPDUPLR(@08),B'00000100'                           1441
*   IF SEQNUM=ONEF1                 /* CSN1?                 @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
         CLI   SEQNUM(@04),X'F1'                                   1442
         BNE   @RF01442                                            1442
*     DO;                           /*                       @Y30LB25*/
*       DUPCSN1=CSN1USM;            /* SET CSN1              @Y30LB25*/
         MVC   DUPCSN1(12,@08),CSN1USM(@04)                        1444
*       DUPCSN2=CSN2USM;            /* INIT CSN2             @YM31076*/
         MVC   DUPCSN2(12,@08),CSN2USM(@04)                        1445
*       DUPLIB2=FIX2FS;             /* INIT LIBID2           @Y30LB25*/
         L     @03,@CF00550                                        1446
         STC   @03,DUPLIB2(,@08)                                   1446
*       DUPLIB1=DUPLIB1&&DUPLIB1;   /* ZERO LIBID1           @Y30LB25*/
         SLR   @03,@03                                             1447
         IC    @03,DUPLIB1(,@08)                                   1447
         LR    @15,@03                                             1447
         XR    @15,@03                                             1447
         STC   @15,DUPLIB1(,@08)                                   1447
*       IF LUSM1=ON                 /* BIT 1 ON?             @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
         TM    LUSM1(@04),B'10000000'                              1448
         BNO   @RF01448                                            1448
*         DUP1BIT1=ON;              /* LIBID1 BIT 1 ON       @Y30LB25*/
         OI    DUP1BIT1(@08),B'00000010'                           1449
*       IF LUSM2=ON                 /* BIT 2 ON?             @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
@RF01448 TM    LUSM2+8(MESGPTR),B'01000000'                        1450
         BNO   @RF01450                                            1450
*         DUP1BIT2=ON;              /* LIBID1 BIT 2 ON       @Y30LB25*/
         L     @08,DUPVPTR                                         1451
         OI    DUP1BIT2(@08),B'00000001'                           1451
*     END;                          /*                       @Y30LB25*/
*   ELSE                            /* CSN2                  @Y30LB25*/
*     DO;                           /*                       @Y30LB25*/
         B     @RC01442                                            1453
@RF01442 DS    0H                                                  1454
*       DUPCSN2=CSN1USM;            /* SET CSN2              @Y30LB25*/
         L     @08,DUPVPTR                                         1454
         LA    @04,8                                               1454
         ALR   @04,MESGPTR                                         1454
         MVC   DUPCSN2(12,@08),CSN1USM(@04)                        1454
*       DUPCSN1=CSN2USM;            /* INIT CSN1             @YM31076*/
         MVC   DUPCSN1(12,@08),CSN2USM(@04)                        1455
*       DUPLIB1=FIX2FS;             /* INIT LIBID1           @Y30LB25*/
         L     @03,@CF00550                                        1456
         STC   @03,DUPLIB1(,@08)                                   1456
*       DUPLIB2=DUPLIB2&&DUPLIB2;   /* ZERO LIBID2           @Y30LB25*/
         SLR   @03,@03                                             1457
         IC    @03,DUPLIB2(,@08)                                   1457
         LR    @15,@03                                             1457
         XR    @15,@03                                             1457
         STC   @15,DUPLIB2(,@08)                                   1457
*       IF LUSM1=ON                 /* BIT 1 ON?             @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
         TM    LUSM1(@04),B'10000000'                              1458
         BNO   @RF01458                                            1458
*         DUP2BIT1=ON;              /* LIBID2 BIT 1 ON       @Y30LB25*/
         OI    DUP2BIT1(@08),B'00000010'                           1459
*       IF LUSM2=ON                 /* BIT 2 ON?             @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
@RF01458 TM    LUSM2+8(MESGPTR),B'01000000'                        1460
         BNO   @RF01460                                            1460
*         DUP2BIT2=ON;              /* LIBID2 BIT 2 ON       @Y30LB25*/
         L     @08,DUPVPTR                                         1461
         OI    DUP2BIT2(@08),B'00000001'                           1461
*     END;                          /*                       @Y30LB25*/
*                                                                  1462
@RF01460 DS    0H                                                  1463
*   /*****************************************************************/
*   /*                                                               */
*   /* WRITE THE NEW DVR                                     @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1463
*   RPLVBUF=DUPVPTR;                /* DVR BUF PTR           @Y30LB25*/
@RC01442 L     @08,DUPVPTR                                         1463
         ST    @08,RPLVBUF(,RPLVPTR)                               1463
*   RPLVUPD=OFF;                    /* NEW RECORD            @Y30LB25*/
         NI    RPLVUPD(RPLVPTR),B'11111101'                        1464
*   RPLVLOC=OFF;                    /* NO LOCATE             @Y30LB25*/
         NI    RPLVLOC(RPLVPTR),B'01111111'                        1465
*   RPLVTYP=RPLVPUT;                /* WRITE                 @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'01'                              1466
*   RPLVRLN=LENGTH(DUPV);           /* DVR LENGTH            @Y30LB25*/
         MVC   RPLVRLN(4,RPLVPTR),@CF00807                         1467
*   RPLVBLN=LENGTH(DUPVBUF);        /* DVR BUF LENGTH        @Y30LB25*/
         MVC   RPLVBLN(4,RPLVPTR),@CF00804                         1468
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         1470
*   CALL ICBVIO00;                  /* WRITE NEW DVR         @Y30LB25*/
         L     @15,@CV00610                                        1471
         BALR  @14,@15                                             1471
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/
*     THEN                          /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1473
         N     @08,@CF00815                                        1473
         LTR   @08,@08                                             1473
         BZ    @RF01473                                            1473
*     DO;                           /*                       @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         1475
*       RETURN;                     /*                       @Y30LB25*/
         B     @EL00025                                            1476
*     END;                          /*                       @Y30LB25*/
*                                                                  1477
*   /*****************************************************************/
*   /*                                                               */
*   /* CREATE THE CIRS FOR THE DVR                           @YM31076*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1478
*   BCDVPTR=DUPVPTR;                /* SET UP FOR DVR        @YM31076*/
@RF01473 L     @08,DUPVPTR                                         1478
         ST    @08,BCDVPTR                                         1478
*   CALL CRT2CIR;                   /* CREATE THE CIRS       @YM31076*/
         BAL   @14,CRT2CIR                                         1479
*   END CRTDVR;                     /*                       @Y30LB25*/
         B     @EL00025                                            1480
*                                                                  1481
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - CRT2CIR                              @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* FUNCTION - SET UP FOR THE CREATION OF CIRS            @Y30LB25*/
*   /* FOR BVR, CVR, OR DVR.                                 @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* INPUT -                                               @Y30LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/
*   /* BASE VOLUME RECORD PTR IN BCDVPTR                     @Y30LB25*/
*   /* COPY VOLUME RECORD PTR IN BCDVPTR                     @Y30LB25*/
*   /* DUPLICATE VOLUME RECORD PTR IN BCDVPTR                @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* OUTPUT -                                              @Y30LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1481
*CRT2CIR:                           /*                       @Y30LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/
*                                                                  1481
CRT2CIR  ST    @14,@SA00026                                        1481
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR CREATE A CIR FOR CSN1                       @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1482
*   CSNUMBER=ON;                    /* CSN1                  @Y30LB25*/
         OI    CSNUMBER,B'00000100'                                1482
*   CALL VUCIR;                     /*                       @Y30LB25
*                                      CREATE CIR FOR        @Y30LB25
*                                      CSN1                  @Y30LB25*/
         BAL   @14,VUCIR                                           1483
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/
*     THEN                          /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1484
         N     @08,@CF00815                                        1484
         LTR   @08,@08                                             1484
         BZ    @RF01484                                            1484
*     DO;                           /*                       @Y30LB25*/
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         1486
*       RETURN;                     /*                       @Y30LB25*/
@EL00026 DS    0H                                                  1487
@EF00026 DS    0H                                                  1487
@ER00026 L     @14,@SA00026                                        1487
         BR    @14                                                 1487
*     END;                          /*                       @Y30LB25*/
*                                                                  1488
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR CREATE A CIR FOR CSN2                       @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1489
*   CSNUMBER=OFF;                   /* CSN2                  @Y30LB25*/
@RF01484 NI    CSNUMBER,B'11111011'                                1489
*   CALL VUCIR;                     /*                       @Y30LB25
*                                      CREATE CIR FOR        @Y30LB25
*                                      CSN2                  @Y30LB25*/
         BAL   @14,VUCIR                                           1490
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/
*     THEN                          /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1491
         N     @08,@CF00815                                        1491
         LTR   @08,@08                                             1491
         BZ    @RF01491                                            1491
*     CALL PLIBMSG;                 /* MSG TO LIBRARIAN      @Y30LB25*/
         BAL   @14,PLIBMSG                                         1492
*   RETURN;                         /*                       @Y30LB25*/
         B     @EL00026                                            1493
*   END CRT2CIR;                    /*                       @Y30LB25*/
         B     @EL00026                                            1494
*                                                                  1495
*   /*****************************************************************/
*   /*                                                               */
*   /* ENTRY NAME - ICBVUCIR                                 @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* FUNCTION - CREATE, UPDATE, AND WRITE A CIR FOR THE    @Y30LB25*/
*   /* BVR OR CVR OR DVR ASSOCIATED WITH THE INPUT           @Y30LB25*/
*   /* CSN AND VOLID. VVIC. DATA SET MUST BE RESERVED BY     @Y30LB25*/
*   /* THE CALLER.                                           @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* INPUT -                                               @Y30LB25*/
*   /* MSVC REQUEST PARAMETER LIST PTR IN RPLVPTR            @Y30LB25*/
*   /* BASE VOLUME RECORD PTR IN BCDVPTR                     @Y30LB25*/
*   /* COPY VOLUME RECORD PTR IN BCDVPTR                     @Y30LB25*/
*   /* DUPLICATE VOLUME RECORD PTR IN BCDVPTR                @Y30LB25*/
*   /* FLAG IN PASSBYTE                                      @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* OUTPUT -                                              @Y30LB25*/
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/
*   /* MSVC REQUEST PARAMETER - RETURN CODE IF               @Y30LB25*/
*   /* AN ERROR                                              @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1495
*ICBVUCIR:                          /*                       @Y30LB25*/
*   ENTRY(PTRBCDV,PTRRPLV,PASSBYTE);/*                       @Y30LB25*/
*                                                                  1495
@EP01495 MVC   @PC00001(12),0(@01)                                 1495
*   /*****************************************************************/
*   /*                                                               */
*   /* DECLARES FOR PASSED PARAMETERS                        @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1496
*   DCL                                                            1496
*     PTRBCDV PTR(31);              /* PTR TO BVR, CVR,      @Y30LB25
*                                      OR DVR                @Y30LB25*/
*   DCL                                                            1497
*     PTRRPLV PTR(31);              /* RPLV PTR              @Y30LB25*/
*   DCL                                                            1498
*     PASSBYTE CHAR(2);             /* CSN NUMBER            @Y30LB25*/
*                                                                  1499
*   /*****************************************************************/
*   /*                                                               */
*   /* INITIALIZE                                            @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1499
*   BCDVPTR=PTRBCDV;                /* SET RECORD PTR        @Y30LB25*/
         L     @08,@PC00001                                        1499
         L     @08,PTRBCDV(,@08)                                   1499
         ST    @08,BCDVPTR                                         1499
*   RPLVPTR=PTRRPLV;                /* SET RPLV PTR          @Y30LB25*/
         L     @08,@PC00001+4                                      1500
         L     RPLVPTR,PTRRPLV(,@08)                               1500
*   WORKAREA=WORKAREA&&WORKAREA;    /* ZERO WORK AREA        @Y30LB25*/
         XC    WORKAREA(19),WORKAREA                               1501
*   BYTEPASS=PASSBYTE;              /* GET CSN # FLAG        #Y30LB25*/
         L     @08,@PC00001+8                                      1502
         MVC   BYTEPASS(2),PASSBYTE(@08)                           1502
*   GROUPPTR=ADDR(GROUPBUF);        /* ADDR GRP BUF          @Y30LB25*/
         LA    @08,GROUPBUF                                        1503
         ST    @08,GROUPPTR                                        1503
*   COPYVPTR=ADDR(COPYBUF);         /* ADDR CVR BUF          @Y30LB25*/
         LA    COPYVPTR,COPYBUF                                    1504
*   BASEVPTR=ADDR(BASEBUF);         /* ADDR BVR BUF          @Y30LB25*/
         LA    @08,BASEBUF                                         1505
         ST    @08,BASEVPTR                                        1505
*   INDEXPTR=ADDR(INDEXBUF);        /* ADDR CIR BUF          @Y30LB25*/
         LA    INDEXPTR,INDEXBUF                                   1506
*   DUPVPTR=ADDR(DUPVBUF);          /* ADDR DUP BUF          @Y30LB25*/
         LA    @08,DUPVBUF                                         1507
         ST    @08,DUPVPTR                                         1507
*   DIDKY=FIXONE;                   /* SET DVR KEY ID        @Y30LB25*/
         MVI   DIDKY,X'01'                                         1508
*   CIDKY=FIXONE;                   /* SET CVR KEY ID        @Y30LB25*/
         MVI   CIDKY,X'01'                                         1509
*   CALL VUCIR;                     /* PROCESS CIR           #Y30LB25*/
         BAL   @14,VUCIR                                           1510
*   RETURN;                         /*                       #Y30LB25*/
         B     @EL00001                                            1511
*                                                                  1512
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE VUCIR IS CODED SO THAT COMMON ENTRY         @Y30LB25*/
*   /* CODE IN ICBVUCIR CAN BE USED BY THIS MODULE           @Y30LB25*/
*   /* AND BY OTHER MODULES. OTHER MODULES CALL              @Y30LB25*/
*   /* ENTRY ICBVUCIR. THIS MODULE CALLS PROCEDURE           @Y30LB25*/
*   /* VUCIR.                                                @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1512
*VUCIR:                             /*                       @Y30LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/
*                                                                  1512
VUCIR    ST    @14,@SA00027                                        1512
*   /*****************************************************************/
*   /*                                                               */
*   /* CREATE A CIR FOR CSN1 OR CSN2                         @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1513
*   INDEXBUF=INDEXBUF&&INDEXBUF;    /* ZERO CIR BUFFER       @Y30LB25*/
         XC    INDEXBUF(36),INDEXBUF                               1513
*   IF CSNUMBER=ON                  /* CSN1?                 @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
         TM    CSNUMBER,B'00000100'                                1514
         BNO   @RF01514                                            1514
*     INDSERNO=BCDCSN1;             /* CIR FOR CSN1          @Y30LB25*/
         L     @08,BCDVPTR                                         1515
         MVC   INDSERNO(12,INDEXPTR),BCDCSN1(@08)                  1515
*   ELSE                            /* CSN2                  @Y30LB25*/
*     INDSERNO=BCDCSN2;             /* CIR FOR CSN2          @Y30LB25*/
         B     @RC01514                                            1516
@RF01514 L     @08,BCDVPTR                                         1516
         MVC   INDSERNO(12,INDEXPTR),BCDCSN2(@08)                  1516
*   INDI=I;                         /* SET CIR INDECATOR     @Y30LB25*/
@RC01514 MVI   INDI(INDEXPTR),C'I'                                 1517
*   INDINDEX=ON;                    /* CIR FLAG SET ON       @Y30LB25*/
         OI    INDINDEX(INDEXPTR),B'00001000'                      1518
*   INDRECKY=BCDNAME;               /* BVR, CVR, DVR KEY     @Y30LB25*/
*                                                                  1519
         L     @08,BCDVPTR                                         1519
         MVC   INDRECKY(13,INDEXPTR),BCDNAME(@08)                  1519
*   /*****************************************************************/
*   /*                                                               */
*   /* WRITE THE CIR                                         @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1520
*   RPLVBLN=LENGTH(INDEXBUF);       /* CIR BUFFER LENGTH     @Y30LB25*/
         LA    @08,36                                              1520
         ST    @08,RPLVBLN(,RPLVPTR)                               1520
*   RPLVRLN=LENGTH(INDEXBUF);       /* CIR LENGTH            @Y30LB25*/
         ST    @08,RPLVRLN(,RPLVPTR)                               1521
*   RPLVBUF=INDEXPTR;               /* ADDR OF CIR BUF       @Y30LB25*/
         ST    INDEXPTR,RPLVBUF(,RPLVPTR)                          1522
*   RPLVUPD=OFF;                    /* NO UPDATE             @Y30LB25*/
         NI    RPLVUPD(RPLVPTR),B'11111101'                        1523
*   RPLVTYP=RPLVPUT;                /* PUT NEW RECORD        @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'01'                              1524
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* SET RPLV PTR          @Y30LB25*/
         LR    RG1,RPLVPTR                                         1526
*   CALL ICBVIO00;                  /* WRITE CIR             @Y30LB25*/
         L     @15,@CV00610                                        1527
         BALR  @14,@15                                             1527
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLRCODE=IOERROR×RPLVRETC=FIXZERO/* CK CONDITIONS     @Y30LB25*/
*     THEN                          /*                       @Y30LB25*/
         CLC   RPLRCODE(2,RPLVPTR),@CB00588                        1529
         BE    @RT01529                                            1529
         LH    @08,RPLVRETC(,RPLVPTR)                              1529
         N     @08,@CF00815                                        1529
         LTR   @08,@08                                             1529
         BZ    @RT01529                                            1529
*     RETURN;                       /*                       @Y30LB25*/
*                                                                  1530
*   /*****************************************************************/
*   /*                                                               */
*   /* CIR ALREADY EXISTS                                    @Y30LB25*/
*   /* GET THE CIR                                           @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1531
*   RPLRCODE=RPLRCODE&&RPLRCODE;    /* ZERO REASON CODE      @Y30LB25*/
         XC    RPLRCODE(2,RPLVPTR),RPLRCODE(RPLVPTR)               1531
*   RPLVRETC=RPLVRETC&&RPLVRETC;    /* ZERO RETURN CODE      @Y30LB25*/
         XC    RPLVRETC(2,RPLVPTR),RPLVRETC(RPLVPTR)               1532
*   IVOLKY=INDSERNO;                /* SET SERIAL NUM        @VS32198*/
         MVC   IVOLKY(12),INDSERNO(INDEXPTR)                       1533
*   RPLVKEY=ADDR(IKEY);             /* ADDR OF KEY           @Y30LB25*/
         LA    @08,IKEY                                            1534
         ST    @08,RPLVKEY(,RPLVPTR)                               1534
*   RPLVUPD=ON;                     /* UPDATE                @Y30LB25*/
         OI    RPLVUPD(RPLVPTR),B'00000010'                        1535
*   RPLVTYP=RPLVREAD;               /* READ                  @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'00'                              1536
*   RPLVDIR=ON;                     /* DIRECT                @Y30LB25*/
         OI    RPLVDIR(RPLVPTR),B'01000000'                        1537
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         1539
*   CALL ICBVIO00;                  /* READ FOR CIR          @Y30LB25*/
         L     @15,@CV00610                                        1540
         BALR  @14,@15                                             1540
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/
*     THEN                          /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1542
         N     @08,@CF00815                                        1542
         LTR   @08,@08                                             1542
         BNZ   @RT01542                                            1542
*     RETURN;                       /*                       @Y30LB25*/
*                                                                  1543
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK IF THE CIR IS FOR THE CORRECT RECORD            @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1544
*   IF INDRECKY=BCDNAME             /* CIR EXISTS WITH       @Y30LB25*/
*     THEN                          /* CORRECT VOLID?        @Y30LB25*/
         L     @08,BCDVPTR                                         1544
         CLC   INDRECKY(13,INDEXPTR),BCDNAME(@08)                  1544
         BE    @RT01544                                            1544
*     RETURN;                       /* YES                   @Y30LB25*/
*                                                                  1545
*   /*****************************************************************/
*   /*                                                               */
*   /* CIR IS FOR THE WRONG RECORD, DELETE THE CIR           @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1546
*   RPLVDIR=OFF;                    /* NO DIRECT             @Y30LB25*/
         NI    RPLVDIR(RPLVPTR),B'10111111'                        1546
*   RPLVTYP=RPLVDEL;                /* DELETE                @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'05'                              1547
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         1549
*   CALL ICBVIO00;                  /* DELETE CIR            @Y30LB25*/
         L     @15,@CV00610                                        1550
         BALR  @14,@15                                             1550
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/
*     THEN                          /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1552
         N     @08,@CF00815                                        1552
         LTR   @08,@08                                             1552
         BNZ   @RT01552                                            1552
*     RETURN;                       /*                       @Y30LB25*/
*                                                                  1553
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK IF CIR WAS FOR A DVR                            @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1554
*   IF INDALPHA=D                   /* DVR?                  @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
         CLI   INDALPHA(INDEXPTR),C'D'                             1554
         BNE   @RF01554                                            1554
*     DO;                           /*                       @Y30LB25*/
*       CALL FIXDVR;                /* CORRECT DVR           @Y30LB25*/
         BAL   @14,FIXDVR                                          1556
*       RETURN;                     /*                       @Y30LB25*/
@EL00027 DS    0H                                                  1557
@EF00027 DS    0H                                                  1557
@ER00027 L     @14,@SA00027                                        1557
         BR    @14                                                 1557
*     END;                          /*                       @Y30LB25*/
*   ELSE                            /* BVR OR CVR?           @Y30LB25*/
*                                                                  1559
*     /***************************************************************/
*     /*                                                             */
*     /* CHECK IF CIR WAS FOR A BVR                          @Y30LB25*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  1559
*     IF INDEXREC=FIXZERO           /* BVR?                  @Y30LB25*/
*       THEN                        /* YES                   @Y30LB25*/
@RF01554 CLI   INDEXREC(INDEXPTR),0                                1559
         BNE   @RF01559                                            1559
*       DO;                         /*                       @Y30LB25*/
*         CALL FIXBVR;              /* CORRECT BVR           @Y30LB25*/
         BAL   @14,FIXBVR                                          1561
*         RETURN;                   /*                       @Y30LB25*/
         B     @EL00027                                            1562
*       END;                        /*                       @Y30LB25*/
*     ELSE                          /* IS A CVR              @Y30LB25*/
*                                                                  1564
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK IF CIR WAS FOR A CVR                        @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1564
*       DO;                         /*                       @Y30LB25*/
@RF01559 DS    0H                                                  1565
*         CALL FIXCVR;              /* CORRECT CVR           @Y30LB25*/
         BAL   @14,FIXCVR                                          1565
*         RETURN;                   /*                       @Y30LB25*/
         B     @EL00027                                            1566
*       END;                        /*                       @Y30LB25*/
*   END VUCIR;                      /*                       @Y30LB25*/
         B     @EL00027                                            1568
*                                                                  1569
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - FIXDVR                               @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* FUNCTION - DELETE THE DVR. DELETE THE CIR FOR THE     @Y30LB25*/
*   /* OTHER CSN IN THE DVR IF ONE EXISTS AND POINTS         @Y30LB25*/
*   /* TO THIS DELETED DVR. WRITE THE NEWLY CREATED CIR.     @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* INPUT -                                               @Y30LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/
*   /* DUPLICATE VOLUME RECORD                               @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* OUTPUT -                                              @Y30LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1569
*FIXDVR:                            /*                       @Y30LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/
*                                                                  1569
FIXDVR   ST    @14,@SA00028                                        1569
*   /*****************************************************************/
*   /*                                                               */
*   /* GET THE DVR                                           @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1570
*   DKEY=INDRECKY;                  /* SET RECD KEY          @Y30LB25*/
         MVC   DKEY(13),INDRECKY(INDEXPTR)                         1570
*   RPLVKEY=ADDR(DKEY);             /* ADDR OF KEY           @Y30LB25*/
         LA    @08,DKEY                                            1571
         ST    @08,RPLVKEY(,RPLVPTR)                               1571
*   RPLVBUF=ADDR(BCDRECBF);         /* PTR TO BUFFER         @Y30LB25*/
         LA    @08,BCDRECBF                                        1572
         ST    @08,RPLVBUF(,RPLVPTR)                               1572
*   RPLVBLN=LENGTH(BCDRECBF);       /* DVR BUFFER LENGTH     @Y30LB25*/
         MVC   RPLVBLN(4,RPLVPTR),@CF00804                         1573
*   RPLVTYP=RPLVREAD;               /* READ                  @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'00'                              1574
*   RPLVDIR=ON;                     /* DIRECT                @Y30LB25*/
         OI    RPLVDIR(RPLVPTR),B'01000000'                        1575
*   RPLVUPD=ON;                     /* UPDATE                @Y30LB25*/
         OI    RPLVUPD(RPLVPTR),B'00000010'                        1576
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* SET RPLV PTR          @Y30LB25*/
         LR    RG1,RPLVPTR                                         1578
*   CALL ICBVIO00;                  /* READ DVR              @Y30LB25*/
         L     @15,@CV00610                                        1579
         BALR  @14,@15                                             1579
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC^=FIXZERO            /* CHECK RETN CODE       @Y30LB25*/
*     THEN                          /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1581
         N     @08,@CF00815                                        1581
         LTR   @08,@08                                             1581
         BNZ   @RT01581                                            1581
*     RETURN;                       /*                       @Y30LB25*/
*                                                                  1582
*   /*****************************************************************/
*   /*                                                               */
*   /* DELETE THE DVR                                        @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1583
*   RPLVTYP=RPLVDEL;                /* DELETE                @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'05'                              1583
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* SET RPLV PTR          @Y30LB25*/
         LR    RG1,RPLVPTR                                         1585
*   CALL ICBVIO00;                  /* DELETE DVR            @Y30LB25*/
         L     @15,@CV00610                                        1586
         BALR  @14,@15                                             1586
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC^=FIXZERO            /* CHECK RETN CODE       @Y30LB25*/
*     THEN                          /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1588
         N     @08,@CF00815                                        1588
         LTR   @08,@08                                             1588
         BNZ   @RT01588                                            1588
*     RETURN;                       /*                       @Y30LB25*/
*                                                                  1589
*   /*****************************************************************/
*   /*                                                               */
*   /* GET THE OTHER CIR FOR THE CSN                         @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1590
*   BCDTEMP=DUPVPTR;                /* SAVE DVR PTR          @Y30LB25*/
         L     BCDTEMP,DUPVPTR                                     1590
*   DUPVPTR=ADDR(BCDRECBF);         /* DVR MAPPING           @Y30LB25*/
         LA    @08,BCDRECBF                                        1591
         ST    @08,DUPVPTR                                         1591
*   IF DUPCSN1^=INDSERNO            /* FIND CORRECT CSN      @Y30LB25*/
*     THEN                          /*                       @Y30LB25*/
         CLC   DUPCSN1(12,@08),INDSERNO(INDEXPTR)                  1592
         BE    @RF01592                                            1592
*     IVOLKY=DUPCSN1;               /* KEY OF OTHER CSN      @Y30LB25*/
         MVC   IVOLKY(12),DUPCSN1(@08)                             1593
*   ELSE                            /*                       @Y30LB25*/
*     IVOLKY=DUPCSN2;               /* KEY OF OTHER CSN      @Y30LB25*/
         B     @RC01592                                            1594
@RF01592 L     @08,DUPVPTR                                         1594
         MVC   IVOLKY(12),DUPCSN2(@08)                             1594
*   RPLVKEY=ADDR(IKEY);             /* ADDR OF KEY           @Y30LB25*/
@RC01592 LA    @08,IKEY                                            1595
         ST    @08,RPLVKEY(,RPLVPTR)                               1595
*   RPLVBLN=LENGTH(INDEXBUF);       /* CIR BUFFER LENGTH     @Y30LB25*/
         MVC   RPLVBLN(4,RPLVPTR),@CF00806                         1596
*   RPLVBUF=INDEXPTR;               /* ADDR OF CIR BUF       @Y30LB25*/
         ST    INDEXPTR,RPLVBUF(,RPLVPTR)                          1597
*   RPLVUPD=ON;                     /* UPDATE                @Y30LB25*/
         OI    RPLVUPD(RPLVPTR),B'00000010'                        1598
*   RPLVDIR=ON;                     /* DIRECT                @Y30LB25*/
         OI    RPLVDIR(RPLVPTR),B'01000000'                        1599
*   RPLVTYP=RPLVREAD;               /* READ RECORD           @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'00'                              1600
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* SET RPLV PTR          @Y30LB25*/
         LR    RG1,RPLVPTR                                         1602
*   CALL ICBVIO00;                  /* READ CIR              @Y30LB25*/
         L     @15,@CV00610                                        1603
         BALR  @14,@15                                             1603
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC^=FIXZERO            /* I/O ERROR OR NO       @Y30LB25*/
*     THEN                          /* CIR EXISTS            @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1605
         N     @08,@CF00815                                        1605
         LTR   @08,@08                                             1605
         BNZ   @RT01605                                            1605
*     RETURN;                       /*                       @Y30LB25*/
*                                                                  1606
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK IF THE CIR IS FOR THE CORRECT RECORD            @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1607
*   IF INDRECKY=DUPNAME             /* PT TO RIGHT           @Y30LB25*/
*     THEN                          /* RECORD?               @Y30LB25*/
         L     @08,DUPVPTR                                         1607
         CLC   INDRECKY(13,INDEXPTR),DUPNAME(@08)                  1607
         BNE   @RF01607                                            1607
*     DO;                           /* YES                   @Y30LB25*/
*                                                                  1608
*       /*************************************************************/
*       /*                                                           */
*       /* DELETE THE CIR                                    @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1609
*       RPLVTYP=RPLVDEL;            /* DELETE                @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'05'                              1609
*       RPLVDIR=OFF;                /* NO DIRECT             @Y30LB25*/
         NI    RPLVDIR(RPLVPTR),B'10111111'                        1610
*       RESPECIFY                   /*                       @Y30LB25*/
*         RG1 RSTD;                 /* RESTRICT REG 1        @Y30LB25*/
*       RG1=RPLVPTR;                /* SET RPLV PTR          @Y30LB25*/
         LR    RG1,RPLVPTR                                         1612
*       CALL ICBVIO00;              /* DELETE CIR            @Y30LB25*/
         L     @15,@CV00610                                        1613
         BALR  @14,@15                                             1613
*       RESPECIFY                   /*                       @Y30LB25*/
*         RG1 UNRSTD;               /* UNRESTRICT REG 1      @Y30LB25*/
*       IF RPLVRETC^=FIXZERO        /* CK RETN CODE          @Y30LB25*/
*         THEN                      /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1615
         N     @08,@CF00815                                        1615
         LTR   @08,@08                                             1615
         BNZ   @RT01615                                            1615
*         RETURN;                   /*                       @Y30LB25*/
*     END;                          /*                       @Y30LB25*/
*                                                                  1617
*   /*****************************************************************/
*   /*                                                               */
*   /* NOW CREATE THE CIR, ONE WILL NOT EXIST                @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1618
*   DUPVPTR=BCDTEMP;                /* RESTORE DVR PTR       @Y30LB25*/
@RF01607 ST    BCDTEMP,DUPVPTR                                     1618
*   CALL CWCIR;                     /* CREATE/WRITE          @Y30LB25
*                                      NEW CIR               @Y30LB25*/
         BAL   @14,CWCIR                                           1619
*   RETURN;                         /*                       @Y30LB25*/
@EL00028 DS    0H                                                  1620
@EF00028 DS    0H                                                  1620
@ER00028 L     @14,@SA00028                                        1620
         BR    @14                                                 1620
*   END FIXDVR;                     /*                       @Y30LB25*/
         B     @EL00028                                            1621
*                                                                  1622
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - FIXCVR                               @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* FUNCTION - DELETE THE CVR. DELETE THE CIR FOR THE     @Y30LB25*/
*   /* OTHER CSN IN THE CVR IF ONE EXISTS AND POINTS         @Y30LB25*/
*   /* TO THIS DELETED CVR. WRITE THE NEWLY CREATED CIR.     @Y30LB25*/
*   /* UPDATE THE BVR OF THE DELETED CVR.                    @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* INPUT -                                               @Y30LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/
*   /* COPY VOLUME RECORD                                    @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* OUTPUT -                                              @Y30LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1622
*FIXCVR:                            /*                       @Y30LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/
*                                                                  1622
FIXCVR   ST    @14,@SA00029                                        1622
*   /*****************************************************************/
*   /*                                                               */
*   /* GET THE CVR                                           @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1623
*   CKEY=INDRECKY;                  /* SET RECD KEY          @Y30LB25*/
         MVC   CKEY(13),INDRECKY(INDEXPTR)                         1623
*   RPLVKEY=ADDR(CKEY);             /* ADDR OF CVR KEY       @Y30LB25*/
         LA    @08,CKEY                                            1624
         ST    @08,RPLVKEY(,RPLVPTR)                               1624
*   RPLVBUF=COPYVPTR;               /* PTR TO BUFFER         @Y30LB25*/
         ST    COPYVPTR,RPLVBUF(,RPLVPTR)                          1625
*   RPLVBLN=LENGTH(COPYBUF);        /* CVR BUFFER LENGTH     @Y30LB25*/
         MVC   RPLVBLN(4,RPLVPTR),@CF00805                         1626
*   RPLVTYP=RPLVREAD;               /* READ                  @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'00'                              1627
*   RPLVDIR=ON;                     /* DIRECT                @Y30LB25*/
         OI    RPLVDIR(RPLVPTR),B'01000000'                        1628
*   RPLVUPD=ON;                     /* UPDATE                @Y30LB25*/
         OI    RPLVUPD(RPLVPTR),B'00000010'                        1629
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* SET RPLV PTR          @Y30LB25*/
         LR    RG1,RPLVPTR                                         1631
*   CALL ICBVIO00;                  /* READ CVR              @Y30LB25*/
         L     @15,@CV00610                                        1632
         BALR  @14,@15                                             1632
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC^=FIXZERO            /* CHECK RETN CODE       @Y30LB25*/
*     THEN                          /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1634
         N     @08,@CF00815                                        1634
         LTR   @08,@08                                             1634
         BNZ   @RT01634                                            1634
*     RETURN;                       /*                       @Y30LB25*/
*                                                                  1635
*   /*****************************************************************/
*   /*                                                               */
*   /* DELETE THE CVR                                        @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1636
*   RPLVUPD=OFF;                    /* NO UPDATE             @Y30LB25*/
         NI    RPLVUPD(RPLVPTR),B'11111101'                        1636
*   RPLVTYP=RPLVDEL;                /* DELETE                @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'05'                              1637
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* SET RPLV PTR          @Y30LB25*/
         LR    RG1,RPLVPTR                                         1639
*   CALL ICBVIO00;                  /* DELETE CVR            @Y30LB25*/
         L     @15,@CV00610                                        1640
         BALR  @14,@15                                             1640
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC^=FIXZERO            /* CHECK RETN CODE       @Y30LB25*/
*     THEN                          /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1642
         N     @08,@CF00815                                        1642
         LTR   @08,@08                                             1642
         BNZ   @RT01642                                            1642
*     RETURN;                       /*                       @Y30LB25*/
*                                                                  1643
*   /*****************************************************************/
*   /*                                                               */
*   /* UPDATE CVR'S BVR                                      @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1644
*   ADDSUB=OFF;                     /* REMOVE CVR            @Y30LB25*/
         NI    ADDSUB,B'10111111'                                  1644
*   CALL PBVR1;                     /* UPDATE CVR'S BVR      @Y30LB25*/
         BAL   @14,PBVR1                                           1645
*   IF RPLVRETC^=FIXZERO            /* CHECK RETN CODE       @Y30LB25*/
*     THEN                          /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1646
         N     @08,@CF00815                                        1646
         LTR   @08,@08                                             1646
         BNZ   @RT01646                                            1646
*     RETURN;                       /*                       @Y30LB25*/
*                                                                  1647
*   /*****************************************************************/
*   /*                                                               */
*   /* GET THE CIR                                           @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1648
*   IF COPCSN1^=INDSERNO            /* FIND CORRECT CSN      @Y30LB25*/
*     THEN                          /*                       @Y30LB25*/
         CLC   COPCSN1(12,COPYVPTR),INDSERNO(INDEXPTR)             1648
         BE    @RF01648                                            1648
*     IVOLKY=COPCSN1;               /* KEY OF OTHER CSN      @Y30LB25*/
         MVC   IVOLKY(12),COPCSN1(COPYVPTR)                        1649
*   ELSE                            /*                       @Y30LB25*/
*     IVOLKY=COPCSN2;               /* KEY OF OTHER CSN      @Y30LB25*/
         B     @RC01648                                            1650
@RF01648 MVC   IVOLKY(12),COPCSN2(COPYVPTR)                        1650
*   RPLVKEY=ADDR(IKEY);             /* ADDR OF KEY           @Y30LB25*/
@RC01648 LA    @08,IKEY                                            1651
         ST    @08,RPLVKEY(,RPLVPTR)                               1651
*   RPLVBLN=LENGTH(INDEXBUF);       /* CIR BUFFER LENGTH     @Y30LB25*/
         MVC   RPLVBLN(4,RPLVPTR),@CF00806                         1652
*   RPLVBUF=INDEXPTR;               /* ADDR OF CIR BUF       @Y30LB25*/
         ST    INDEXPTR,RPLVBUF(,RPLVPTR)                          1653
*   RPLVUPD=ON;                     /* UPDATE                @Y30LB25*/
         OI    RPLVUPD(RPLVPTR),B'00000010'                        1654
*   RPLVDIR=ON;                     /* DIRECT                @Y30LB25*/
         OI    RPLVDIR(RPLVPTR),B'01000000'                        1655
*   RPLVTYP=RPLVREAD;               /* READ RECORD           @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'00'                              1656
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* SET RPLV PTR          @Y30LB25*/
         LR    RG1,RPLVPTR                                         1658
*   CALL ICBVIO00;                  /* READ CIR              @Y30LB25*/
         L     @15,@CV00610                                        1659
         BALR  @14,@15                                             1659
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC^=FIXZERO            /* I/O ERROR OR NO       @Y30LB25*/
*     THEN                          /* CIR EXISTS            @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1661
         N     @08,@CF00815                                        1661
         LTR   @08,@08                                             1661
         BNZ   @RT01661                                            1661
*     RETURN;                       /*                       @Y30LB25*/
*                                                                  1662
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK THAT CIR POINTS TO CORRECT MSVC RECORD          @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1663
*   IF INDRECKY=COPNAME             /* PT TO RIGHT           @Y30LB25*/
*     THEN                          /* RECORD?               @Y30LB25*/
         CLC   INDRECKY(13,INDEXPTR),COPNAME(COPYVPTR)             1663
         BNE   @RF01663                                            1663
*     DO;                           /* YES                   @Y30LB25*/
*                                                                  1664
*       /*************************************************************/
*       /*                                                           */
*       /* CORRECT CIR - DELETE IT                           @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1665
*       RPLVTYP=RPLVDEL;            /* DELETE                @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'05'                              1665
*       RPLVDIR=OFF;                /* NO DIRECT             @Y30LB25*/
         NI    RPLVDIR(RPLVPTR),B'10111111'                        1666
*       RESPECIFY                   /*                       @Y30LB25*/
*         RG1 RSTD;                 /* RESTRICT REG 1        @Y30LB25*/
*       RG1=RPLVPTR;                /* SET RPLV PTR          @Y30LB25*/
         LR    RG1,RPLVPTR                                         1668
*       CALL ICBVIO00;              /* DELETE CIR            @Y30LB25*/
         L     @15,@CV00610                                        1669
         BALR  @14,@15                                             1669
*       RESPECIFY                   /*                       @Y30LB25*/
*         RG1 UNRSTD;               /* UNRESTRICT REG 1      @Y30LB25*/
*       IF RPLVRETC^=FIXZERO        /* CK RETN CODE          @Y30LB25*/
*         THEN                      /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1671
         N     @08,@CF00815                                        1671
         LTR   @08,@08                                             1671
         BNZ   @RT01671                                            1671
*         RETURN;                   /*                       @Y30LB25*/
*     END;                          /*                       @Y30LB25*/
*                                                                  1673
*   /*****************************************************************/
*   /*                                                               */
*   /* NOW CREATE THE CIR, ONE WILL NOT EXIST                @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1674
*   CALL CWCIR;                     /* CREATE/WRITE          @Y30LB25
*                                      NEW CIR               @Y30LB25*/
@RF01663 BAL   @14,CWCIR                                           1674
*   RETURN;                         /*                       @Y30LB25*/
@EL00029 DS    0H                                                  1675
@EF00029 DS    0H                                                  1675
@ER00029 L     @14,@SA00029                                        1675
         BR    @14                                                 1675
*   END FIXCVR;                     /*                       @Y30LB25*/
         B     @EL00029                                            1676
*                                                                  1677
*   /*****************************************************************/
*   /*                                                               */
*   /* ENTRY NAME - ICBVUBVR                                 @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* FUNCTION - UPDATE THE NUMBER OF BACKUP COPIES OR      @Y30LB25*/
*   /* THE NUMBER OF COPIES, AND IF NECESSARY THE KEY        @Y30LB25*/
*   /* OF THE LATEST COPY IN THE BVR.                        @Y30LB25*/
*   /* WITH ADDSUB OF THE CALLER MUST FIRST DELETE           @Y30LB25*/
*   /* THE CVR.                                              @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* INPUT -                                               @Y30LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/
*   /* COPY VOLUME RECORD                                    @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* OUTPUT -                                              @Y30LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/
*   /* BASE VOLUME RECORD                                    @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1677
*ICBVUBVR:                          /*                       @Y30LB25*/
*   ENTRY(PTRCOPYV,PTRRPLV,PASSBYTE);/*                      @Y30LB25*/
*                                                                  1677
@EP01677 MVC   @PC00001+12(4),0(@01)                               1677
         MVC   @PC00001+4(8),4(@01)                                1677
*   /*****************************************************************/
*   /*                                                               */
*   /* DECLARES FOR PASSED PARAMETERS                        @Y30LB25*/
*   /* PTRRPLV AND PASSBYTE ARE DECLARED IN ICBVUCIR.        @Y30LB25*/
*   /* PASSBTYE IS USED TO DETERMINE ADD OR SUBTRACT.        @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1678
*   DCL                                                            1678
*     PTRCOPYV PTR(31);             /* PTR TO CVR            @Y30LB25*/
*   DCL                                                            1679
*     SAVCVRPT PTR(31);             /* SAVE CVR BUF PTR      @Y30LB25*/
*   COPYVPTR=PTRCOPYV;              /* SET CVR PTR           @Y30LB25*/
         L     @08,@PC00001+12                                     1680
         L     COPYVPTR,PTRCOPYV(,@08)                             1680
*   RPLVPTR=PTRRPLV;                /* SET RPLV PTR          @Y30LB25*/
         L     @08,@PC00001+4                                      1681
         L     RPLVPTR,PTRRPLV(,@08)                               1681
*   BYTEPASS=PASSBYTE;              /* GET CSN # FLAG        @Y30LB25*/
         L     @08,@PC00001+8                                      1682
         MVC   BYTEPASS(2),PASSBYTE(@08)                           1682
*   CIDKY=FIXONE;                   /* SET KEY ID            @Y30LB25*/
         MVI   CIDKY,X'01'                                         1683
*   CALL PBVR1;                     /* PROCESS BVR           @Y30LB25*/
         BAL   @14,PBVR1                                           1684
*   RETURN;                         /*                       @Y30LB25*/
         B     @EL00001                                            1685
*                                                                  1686
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE PBVR1 IS CODED SO THAT COMMON ENTRY         @Y30LB25*/
*   /* CODE IN ICBVUBVR CAN BE USED BY THIS MODULE           @Y30LB25*/
*   /* AND BY OTHER MODULES. OTHER MODULES CALL              @Y30LB25*/
*   /* ENTRY ICBVUBVR. THIS MODULE CALLS PROCEDURE           @Y30LB25*/
*   /* PBVR1.                                                @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1686
*PBVR1:                             /*                       @Y30LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/
*                                                                  1686
PBVR1    ST    @14,@SA00030                                        1686
*   /*****************************************************************/
*   /*                                                               */
*   /* GET THE BVR                                           @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1687
*   SAVCVRPT=COPYVPTR;              /* SAVE CVR BUF PTR      @Y30LB25*/
         LR    SAVCVRPT,COPYVPTR                                   1687
*   BVOLKY=COPSERNO;                /* SET VOLID IN KEY      @Y30LB25*/
         MVC   BVOLKY(6),COPSERNO(COPYVPTR)                        1688
*   RPLVKEY=ADDR(BKEY);             /* ADDR OF KEY           @Y30LB25*/
         LA    @04,BKEY                                            1689
         ST    @04,RPLVKEY(,RPLVPTR)                               1689
*   RPLVBUF=ADDR(BCDRECBF);         /* SET BUFFER PTR        @Y30LB25*/
         LA    @04,BCDRECBF                                        1690
         ST    @04,RPLVBUF(,RPLVPTR)                               1690
*   RPLVBLN=LENGTH(BCDRECBF);       /* BVR BUFFER LENGTH     @Y30LB25*/
         MVC   RPLVBLN(4,RPLVPTR),@CF00804                         1691
*   RPLVTYP=RPLVREAD;               /* READ OPTION ON        @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'00'                              1692
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB25*/
*   RPLVLOC=OFF;                    /* NO LOCATE READ        @Y30LB25*/
         OI    RPLVDIR(RPLVPTR),B'01000000'                        1694
         NI    RPLVLOC(RPLVPTR),B'01111111'                        1694
*   RPLVUPD=ON;                     /* UPDATE ON             @Y30LB25*/
         OI    RPLVUPD(RPLVPTR),B'00000010'                        1695
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         1697
*   CALL ICBVIO00;                  /* READ BVR              @Y30LB25*/
         L     @15,@CV00610                                        1698
         BALR  @14,@15                                             1698
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC^=FIXZERO            /* CHECK RETN CODE       @Y30LB25*/
*     THEN                          /* ERROR                 @Y30LB25*/
         LH    @04,RPLVRETC(,RPLVPTR)                              1700
         N     @04,@CF00815                                        1700
         LTR   @04,@04                                             1700
         BNZ   @RT01700                                            1700
*     RETURN;                       /*                       @Y30LB25*/
*                                                                  1701
*   /*****************************************************************/
*   /*                                                               */
*   /* SET NUMBER OF COPIES AND/OR BACKUPS                   @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1702
*   BCDTEMP=BASEVPTR;               /* SAVE BVR PTR          @Y30LB25
*                                      FOR INTERNAL CALL     @Y30LB25*/
         L     BCDTEMP,BASEVPTR                                    1702
*   BASEVPTR=ADDR(BCDRECBF);        /* BVR MAPPING           @Y30LB25*/
         LA    @04,BCDRECBF                                        1703
         ST    @04,BASEVPTR                                        1703
*   IF COPBKUP=ON&ADDSUB=OFF        /* DELETE BKUP CVR?      @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
         TM    COPBKUP(COPYVPTR),B'00001000'                       1704
         BNO   @RF01704                                            1704
         TM    ADDSUB,B'01000000'                                  1704
         BNZ   @RF01704                                            1704
*     DO;                           /*                       @Y30LB25*/
*       BASNBKUP=BASNBKUP-FIXONE;   /* DECREM BKUP CNT       @Y30LB25*/
         SLR   @15,@15                                             1706
         IC    @15,BASNBKUP(,@04)                                  1706
         BCTR  @15,0                                               1706
         STC   @15,BASNBKUP(,@04)                                  1706
*       BASNCOPY=BASNCOPY-FIXONE;   /* DECREM COPY CNT       @Y30LB25*/
         SLR   @15,@15                                             1707
         IC    @15,BASNCOPY(,@04)                                  1707
         BCTR  @15,0                                               1707
         STC   @15,BASNCOPY(,@04)                                  1707
*     END;                          /*                       @Y30LB25*/
*   ELSE                            /*                       @Y30LB25*/
*     IF ADDSUB=OFF                 /* DELETE CVR?           @Y30LB25*/
*       THEN                        /* YES                   @Y30LB25*/
         B     @RC01704                                            1709
@RF01704 TM    ADDSUB,B'01000000'                                  1709
         BNZ   @RF01709                                            1709
*       BASNCOPY=BASNCOPY-FIXONE;   /* DECREM COPY CNT       @Y30LB25*/
         L     @04,BASEVPTR                                        1710
         SLR   @15,@15                                             1710
         IC    @15,BASNCOPY(,@04)                                  1710
         BCTR  @15,0                                               1710
         STC   @15,BASNCOPY(,@04)                                  1710
*   IF COPBKUP=ON&ADDSUB=ON         /* ADD BKUP CVR?         @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
@RF01709 DS    0H                                                  1711
@RC01704 TM    COPBKUP(COPYVPTR),B'00001000'                       1711
         BNO   @RF01711                                            1711
         TM    ADDSUB,B'01000000'                                  1711
         BNO   @RF01711                                            1711
*     DO;                           /*                       @Y30LB25*/
*       BASNBKUP=BASNBKUP+FIXONE;   /* INCREM BKUP CNT       @Y30LB25*/
         L     @04,BASEVPTR                                        1713
         LA    @15,1                                               1713
         SLR   @14,@14                                             1713
         IC    @14,BASNBKUP(,@04)                                  1713
         ALR   @14,@15                                             1713
         STC   @14,BASNBKUP(,@04)                                  1713
*       BASNCOPY=BASNCOPY+FIXONE;   /* INCREM COPY CNT       @Y30LB25*/
         SLR   @14,@14                                             1714
         IC    @14,BASNCOPY(,@04)                                  1714
         ALR   @15,@14                                             1714
         STC   @15,BASNCOPY(,@04)                                  1714
*       BASKLCPY=COPNAME;           /* NEW LATEST COPY       @Y30LB25*/
         MVC   BASKLCPY(13,@04),COPNAME(COPYVPTR)                  1715
*     END;                          /*                       @Y30LB25*/
*   ELSE                            /*                       @Y30LB25*/
*     IF ADDSUB=ON                  /* ADD CVR?              @Y30LB25*/
*       THEN                        /* YES                   @Y30LB25*/
         B     @RC01711                                            1717
@RF01711 TM    ADDSUB,B'01000000'                                  1717
         BNO   @RF01717                                            1717
*       DO;                         /*                       @Y30LB25*/
*         BASNCOPY=BASNCOPY+FIXONE; /* INCREM COPY CNT       @Y30LB25*/
         L     @04,BASEVPTR                                        1719
         LA    @15,1                                               1719
         SLR   @14,@14                                             1719
         IC    @14,BASNCOPY(,@04)                                  1719
         ALR   @15,@14                                             1719
         STC   @15,BASNCOPY(,@04)                                  1719
*         BASKLCPY=COPNAME;         /* NEW LATEST COPY       @Y30LB25*/
         MVC   BASKLCPY(13,@04),COPNAME(COPYVPTR)                  1720
*       END;                        /*                       @Y30LB25*/
*   IF BASNCOPY=FIXZERO             /* ANY COPIES?           @Y30LB25*/
*     THEN                          /* NO                    @Y30LB25*/
@RF01717 DS    0H                                                  1722
@RC01711 L     @04,BASEVPTR                                        1722
         CLI   BASNCOPY(@04),0                                     1722
         BNE   @RF01722                                            1722
*     BASKLCPY=BLANK13;             /* NO LATEST COPY        @Y30LB25*/
*                                                                  1723
         MVC   BASKLCPY(13,@04),@CC00575                           1723
*   /*****************************************************************/
*   /*                                                               */
*   /* WRITE THE BVR                                         @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1724
*   RPLVTYP=RPLVPUT;                /* SET PUT ON            @Y30LB25*/
@RF01722 MVI   RPLVTYP(RPLVPTR),X'01'                              1724
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* RPLV ADDR             @Y30LB25*/
         LR    RG1,RPLVPTR                                         1726
*   CALL ICBVIO00;                  /* WRITE BVR             @Y30LB25*/
         L     @15,@CV00610                                        1727
         BALR  @14,@15                                             1727
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC^=FIXZERO            /* CHECK RETN CODE       @Y30LB25*/
*     THEN                          /* ERROR                 @Y30LB25*/
         LH    @04,RPLVRETC(,RPLVPTR)                              1729
         N     @04,@CF00815                                        1729
         LTR   @04,@04                                             1729
         BNZ   @RT01729                                            1729
*     RETURN;                       /*                       @Y30LB25*/
*                                                                  1730
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK IF A LATEST COPY WAS DELETED                    @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1731
*   IF ADDSUB=OFF&BASNCOPY^=FIXZERO&/* WAS LATEST COPY       @Y30LB25*/
*       COPNAME=BASKLCPY            /* DELETED?              @VS32198*/
*     THEN                          /* YES                   @Y30LB25*/
         TM    ADDSUB,B'01000000'                                  1731
         BNZ   @RF01731                                            1731
         L     @04,BASEVPTR                                        1731
         CLI   BASNCOPY(@04),0                                     1731
         BE    @RF01731                                            1731
         CLC   COPNAME(13,COPYVPTR),BASKLCPY(@04)                  1731
         BNE   @RF01731                                            1731
*     CALL LCVRKY;                  /* UPDATE LATEST COPY    @Y30LB25*/
         BAL   @14,LCVRKY                                          1732
*   BASEVPTR=BCDTEMP;               /* RESTORE BVR PTR       @Y30LB25
*                                      FOR INTERNAL CALL     @Y30LB25*/
@RF01731 ST    BCDTEMP,BASEVPTR                                    1733
*   RETURN;                         /*                       @Y30LB25*/
@EL00030 DS    0H                                                  1734
@EF00030 DS    0H                                                  1734
@ER00030 L     @14,@SA00030                                        1734
         BR    @14                                                 1734
*   END PBVR1;                      /*                       @Y30LB25*/
         B     @EL00030                                            1735
*                                                                  1736
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - LCVRKY                               @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* FUNCTION - FIND THE NEW LATEST CVR AND PLACE          @Y30LB25*/
*   /* ITS KEY INTO THE BVR.                                 @Y30LB25*/
*   /* THE OLD LATEST CVR MUST HAVE BEEN DELETED.            @Y30LB25*/
*   /* (OLD LATEST CVR IS IN THE CVR BUFFER AND ITS KEY      @Y30LB25*/
*   /* IS SET UP FOR A READ. ALSO, THE UPDATED BVR IS        @Y30LB25*/
*   /* IN ITS BUFFER AND ITS KEY IS SET UP FOR A READ.)      @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* INPUT -                                               @Y30LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/
*   /* COPY VOLUME RECORD                                    @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* OUTPUT -                                              @Y30LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/
*   /* BASE VOLUME RECORD                                    @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1736
*LCVRKY:                            /*                       @Y30LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/
*                                                                  1736
LCVRKY   ST    @14,@SA00031                                        1736
*   /*****************************************************************/
*   /*                                                               */
*   /* FIND THE NEW LATEST CVR KEY                           @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1737
*   CKEY=COPNAME;                   /* SET CVR KEY           @Y30LB25*/
         MVC   CKEY(13),COPNAME(COPYVPTR)                          1737
*   RPLVKEY=ADDR(CKEY);             /* ADDR OF CVR KEY       @Y30LB25*/
         LA    @04,CKEY                                            1738
         ST    @04,RPLVKEY(,RPLVPTR)                               1738
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB25*/
*   RPLVLOC=ON;                     /* READ LOCATE           @Y30LB25*/
         OI    RPLVDIR(RPLVPTR),B'11000000'                        1740
*   RPLVTYP=RPLVREAD;               /* READ OPTION ON        @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'00'                              1741
*   RPLVUPD=OFF;                    /* NO READ FOR UPDATE    @Y30LB25*/
         NI    RPLVUPD(RPLVPTR),B'11111101'                        1742
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* SET RPLV PTR          @Y30LB25*/
         LR    RG1,RPLVPTR                                         1744
*   DO WHILE CIDKY>1;               /* FIND LATEST CVR       @Y30LB25*/
         B     @DE01745                                            1745
@DL01745 DS    0H                                                  1746
*     CIDKY=CIDKY-FIXONE;           /* LOOP CONTROL          @Y30LB25*/
         SLR   @04,@04                                             1746
         IC    @04,CIDKY                                           1746
         BCTR  @04,0                                               1746
         STC   @04,CIDKY                                           1746
*     CALL ICBVIO00;                /* READ CVR              @Y30LB25*/
         L     @15,@CV00610                                        1747
         BALR  @14,@15                                             1747
*     IF RPLRCODE=IOERROR           /* CHECK RETURN CODE     @Y30LB25*/
*       THEN                        /* ERROR                 @Y30LB25*/
         CLC   RPLRCODE(2,RPLVPTR),@CB00588                        1748
         BE    @RT01748                                            1748
*       RETURN;                     /*                       @Y30LB25*/
*     IF RPLVRETC=FIXZERO           /* CVR FOUND?            @Y30LB25*/
*       THEN                        /* YES                   @Y30LB25*/
         LH    @04,RPLVRETC(,RPLVPTR)                              1750
         N     @04,@CF00815                                        1750
         LTR   @04,@04                                             1750
         BNZ   @RF01750                                            1750
*       CIDKY=FIXZERO;              /* LOOP CONTROL          @Y30LB25*/
         MVI   CIDKY,X'00'                                         1751
*   END;                            /*                       @Y30LB25*/
@RF01750 DS    0H                                                  1752
@DE01745 CLI   CIDKY,1                                             1752
         BH    @DL01745                                            1752
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*                                                                  1753
*   /*****************************************************************/
*   /*                                                               */
*   /* LASTEST CVR KEY WAS FOUND                             @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1754
*   IF CIDKY=FIXZERO                /* LATEST CVR FOUND?     @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
         CLI   CIDKY,0                                             1754
         BNE   @RF01754                                            1754
*     DO;                           /*                       @Y30LB25*/
*                                                                  1755
*       /*************************************************************/
*       /*                                                           */
*       /* GET THE BVR'S CVR                                 @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1756
*       COPYVPTR=RPLVBUF;           /* PT TO LATEST CVR      @Y30LB25*/
         L     COPYVPTR,RPLVBUF(,RPLVPTR)                          1756
*       TEMPCKEY=COPNAME;           /* GET KEY               @Y30LB25*/
         MVC   TEMPCKEY(13),COPNAME(COPYVPTR)                      1757
*       COPYVPTR=SAVCVRPT;          /* MAPPING OF CVR        @Y30LB25*/
         LR    COPYVPTR,SAVCVRPT                                   1758
*       RPLVKEY=ADDR(BKEY);         /* ADDR OF KEY           @Y30LB25*/
         LA    @08,BKEY                                            1759
         ST    @08,RPLVKEY(,RPLVPTR)                               1759
*       RPLVBUF=ADDR(BCDRECBF);     /* SET BUFFER PTR        @Y30LB25*/
         LA    @08,BCDRECBF                                        1760
         ST    @08,RPLVBUF(,RPLVPTR)                               1760
*       RPLVBLN=LENGTH(BCDRECBF);   /* BVR BUFFER LENGTH     @Y30LB25*/
         MVC   RPLVBLN(4,RPLVPTR),@CF00804                         1761
*       RPLVLOC=OFF;                /* LOCATE OFF            @Y30LB25*/
         NI    RPLVLOC(RPLVPTR),B'01111111'                        1762
*       RPLVUPD=ON;                 /* READ FOR UPDATE       @Y30LB25*/
         OI    RPLVUPD(RPLVPTR),B'00000010'                        1763
*       RPLVDIR=ON;                 /* DIRECT                @Y30LB25*/
         OI    RPLVDIR(RPLVPTR),B'01000000'                        1764
*       RESPECIFY                   /*                       @Y30LB25*/
*         RG1 RSTD;                 /* RESTRICT REG 1        @Y30LB25*/
*       RG1=RPLVPTR;                /* PTR TO RPLV           @Y30LB25*/
         LR    RG1,RPLVPTR                                         1766
*       CALL ICBVIO00;              /* READ BVR              @Y30LB25*/
         L     @15,@CV00610                                        1767
         BALR  @14,@15                                             1767
*       RESPECIFY                   /*                       @Y30LB25*/
*         RG1 UNRSTD;               /* UNRESTRICT REG 1      @Y30LB25*/
*       IF RPLVRETC^=FIXZERO        /* CHECK RETURN CODE     @Y30LB25*/
*         THEN                      /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1769
         N     @08,@CF00815                                        1769
         LTR   @08,@08                                             1769
         BNZ   @RT01769                                            1769
*         RETURN;                   /*                       @Y30LB25*/
*                                                                  1770
*       /*************************************************************/
*       /*                                                           */
*       /* UPDATE THE KEY OF THE LATEST CVR IN THE BVR       @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1771
*       BASKLCPY=TEMPCKEY;          /* NEW LATEST COPY       @Y30LB25*/
*                                                                  1771
         L     @08,BASEVPTR                                        1771
         MVC   BASKLCPY(13,@08),TEMPCKEY                           1771
*       /*************************************************************/
*       /*                                                           */
*       /* WRITE THE BVR                                     @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1772
*       RPLVTYP=RPLVPUT;            /* SET PUT ON            @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'01'                              1772
*       RESPECIFY                   /*                       @Y30LB25*/
*         RG1 RSTD;                 /* RESTRICT REG 1        @Y30LB25*/
*       RG1=RPLVPTR;                /* SET PTR TO RPLV       @Y30LB25*/
         LR    RG1,RPLVPTR                                         1774
*       CALL ICBVIO00;              /* WRITE BVR             @Y30LB25*/
         L     @15,@CV00610                                        1775
         BALR  @14,@15                                             1775
*       RESPECIFY                   /*                       @Y30LB25*/
*         RG1 UNRSTD;               /* UNRESTRICT REG 1      @Y30LB25*/
*     END;                          /*                       @Y30LB25*/
*   RETURN;                         /*                       @Y30LB25*/
@EL00031 DS    0H                                                  1778
@EF00031 DS    0H                                                  1778
@ER00031 L     @14,@SA00031                                        1778
         BR    @14                                                 1778
*   END LCVRKY;                     /*                       @Y30LB25*/
         B     @EL00031                                            1779
*                                                                  1780
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - FIXBVR                               @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* FUNCTION - FOR BVR WITH NO COPIES, DELETE IT.         @Y30LB25*/
*   /* IF GROUPED, GET GVR, UPDATE IT AND CHAIN THE          @Y30LB25*/
*   /* BVR OUT OF THE GVR.                                   @Y30LB25*/
*   /* WRITE THE NEWLY CREATE CIR.                           @Y30LB25*/
*   /* ALSO, IF IT EXISTS MAKE A DVR INTO A BVR.             @Y30LB25*/
*   /* FOR A BVR WITH COPIES, INDICATE CSNS AS BEING         @Y30LB25*/
*   /* REASSIGNED, AND WRITE THE BVR.                        @Y30LB25*/
*   /* WRITE THE NEWLY CREATED CIR.                          @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* INPUT -                                               @Y30LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/
*   /* BASE VOLUME RECORD                                    @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* OUTPUT -                                              @Y30LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/
*   /* BASE VOLUME RECORD                                    @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1780
*FIXBVR:                            /*                       @Y30LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/
*                                                                  1780
FIXBVR   ST    @14,@SA00032                                        1780
*   /*****************************************************************/
*   /*                                                               */
*   /* GET THE BVR                                           @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1781
*   BKEY=INDRECKY;                  /* SET RECD KEY          @Y30LB25*/
         MVC   BKEY(13),INDRECKY(INDEXPTR)                         1781
*   RPLVKEY=ADDR(BKEY);             /* ADDR OF KEY           @Y30LB25*/
         LA    @08,BKEY                                            1782
         ST    @08,RPLVKEY(,RPLVPTR)                               1782
*   RPLVBUF=ADDR(BCDRECBF);         /* PTR TO BUFFER         @Y30LB25*/
         LA    @08,BCDRECBF                                        1783
         ST    @08,RPLVBUF(,RPLVPTR)                               1783
*   RPLVBLN=LENGTH(BCDRECBF);       /* BVR BUFFER LENGTH     @Y30LB25*/
         MVC   RPLVBLN(4,RPLVPTR),@CF00804                         1784
*   RPLVTYP=RPLVREAD;               /* READ                  @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'00'                              1785
*   RPLVDIR=ON;                     /* DIRECT                @Y30LB25*/
         OI    RPLVDIR(RPLVPTR),B'01000000'                        1786
*   RPLVUPD=ON;                     /* UPDATE                @Y30LB25*/
         OI    RPLVUPD(RPLVPTR),B'00000010'                        1787
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* SET RPLV PTR          @Y30LB25*/
         LR    RG1,RPLVPTR                                         1789
*   CALL ICBVIO00;                  /* READ BVR              @Y30LB25*/
         L     @15,@CV00610                                        1790
         BALR  @14,@15                                             1790
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   IF RPLVRETC^=FIXZERO            /* CHECK RETN CODE       @Y30LB25*/
*     THEN                          /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1792
         N     @08,@CF00815                                        1792
         LTR   @08,@08                                             1792
         BNZ   @RT01792                                            1792
*     RETURN;                       /*                       @Y30LB25*/
*   BCDTEMP=BASEVPTR;               /* SAVE BVR PTR          @Y30LB25*/
         L     BCDTEMP,BASEVPTR                                    1794
*   BASEVPTR=ADDR(BCDRECBF);        /* BVR                   @Y30LB25*/
*                                                                  1795
         LA    @08,BCDRECBF                                        1795
         ST    @08,BASEVPTR                                        1795
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK FOR COPIES                                      @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1796
*   IF BASNCOPY=FIXZERO             /* ANY COPIES?           @Y30LB25*/
*     THEN                          /* NO                    @Y30LB25*/
         CLI   BASNCOPY(@08),0                                     1796
         BNE   @RF01796                                            1796
*     DO;                           /*                       @Y30LB25*/
*                                                                  1797
*       /*************************************************************/
*       /*                                                           */
*       /* NO COPIES, DELETE THE BVR                         @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1798
*       RPLVTYP=RPLVDEL;            /* DELETE                @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'05'                              1798
*       RESPECIFY                   /*                       @Y30LB25*/
*         RG1 RSTD;                 /* RESTRICT REG 1        @Y30LB25*/
*       RG1=RPLVPTR;                /* SET RPLV PTR          @Y30LB25*/
         LR    RG1,RPLVPTR                                         1800
*       CALL ICBVIO00;              /* DELETE BVR            @Y30LB25*/
         L     @15,@CV00610                                        1801
         BALR  @14,@15                                             1801
*       RESPECIFY                   /*                       @Y30LB25*/
*         RG1 UNRSTD;               /* UNRESTRICT REG 1      @Y30LB25*/
*       IF RPLVRETC^=FIXZERO        /* CHECK RETN CODE       @Y30LB25*/
*         THEN                      /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1803
         N     @08,@CF00815                                        1803
         LTR   @08,@08                                             1803
         BNZ   @RT01803                                            1803
*         RETURN;                   /*                       @Y30LB25*/
*                                                                  1804
*       /*************************************************************/
*       /*                                                           */
*       /* GET THE CIR FOR THE CORRECT CSN                   @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1805
*       IF BASCSN1^=INDSERNO        /* FIND CORRECT CSN      @Y30LB25*/
*         THEN                      /*                       @Y30LB25*/
         L     @08,BASEVPTR                                        1805
         CLC   BASCSN1(12,@08),INDSERNO(INDEXPTR)                  1805
         BE    @RF01805                                            1805
*         IVOLKY=BASCSN1;           /* KEY OF CSN            @Y30LB25*/
         MVC   IVOLKY(12),BASCSN1(@08)                             1806
*       ELSE                        /*                       @Y30LB25*/
*         IVOLKY=BASCSN2;           /* KEY OF OTHER CSN      @Y30LB25*/
         B     @RC01805                                            1807
@RF01805 L     @08,BASEVPTR                                        1807
         MVC   IVOLKY(12),BASCSN2(@08)                             1807
*       RPLVKEY=ADDR(IKEY);         /* ADDR OF KEY           @Y30LB25*/
@RC01805 LA    @08,IKEY                                            1808
         ST    @08,RPLVKEY(,RPLVPTR)                               1808
*       RPLVBLN=LENGTH(INDEXBUF);   /* CIR BUFFER LENGTH     @Y30LB25*/
         MVC   RPLVBLN(4,RPLVPTR),@CF00806                         1809
*       RPLVBUF=INDEXPTR;           /* ADDR OF CIR BUF       @Y30LB25*/
         ST    INDEXPTR,RPLVBUF(,RPLVPTR)                          1810
*       RPLVUPD=ON;                 /* UPDATE                @Y30LB25*/
         OI    RPLVUPD(RPLVPTR),B'00000010'                        1811
*       RPLVDIR=ON;                 /* DIRECT                @Y30LB25*/
         OI    RPLVDIR(RPLVPTR),B'01000000'                        1812
*       RPLVTYP=RPLVREAD;           /* READ RECORD           @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'00'                              1813
*       RESPECIFY                   /*                       @Y30LB25*/
*         RG1 RSTD;                 /* RESTRICT REG 1        @Y30LB25*/
*       RG1=RPLVPTR;                /* SET RPLV PTR          @Y30LB25*/
         LR    RG1,RPLVPTR                                         1815
*       CALL ICBVIO00;              /* READ CIR              @Y30LB25*/
         L     @15,@CV00610                                        1816
         BALR  @14,@15                                             1816
*       RESPECIFY                   /*                       @Y30LB25*/
*         RG1 UNRSTD;               /* UNRESTRICT REG 1      @Y30LB25*/
*       IF RPLVRETC^=FIXZERO        /* I/O ERROR OR NO       @Y30LB25*/
*         THEN                      /* CIR EXISTS            @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1818
         N     @08,@CF00815                                        1818
         LTR   @08,@08                                             1818
         BNZ   @RT01818                                            1818
*         RETURN;                   /*                       @Y30LB25*/
*                                                                  1819
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK IF CIR POINTS TO THE DELETE BVR             @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1820
*       IF INDRECKY=BASNAME         /* PT TO RIGHT           @Y30LB25*/
*         THEN                      /* RECORD?               @Y30LB25*/
         L     @08,BASEVPTR                                        1820
         CLC   INDRECKY(13,INDEXPTR),BASNAME(@08)                  1820
         BNE   @RF01820                                            1820
*         DO;                       /* YES                   @Y30LB25*/
*                                                                  1821
*           /*********************************************************/
*           /*                                                       */
*           /* DELETE THE CIR                                @Y30LB25*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1822
*           RPLVTYP=RPLVDEL;        /* DELETE                @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'05'                              1822
*           RESPECIFY               /*                       @Y30LB25*/
*             RG1 RSTD;             /* RESTRICT REG 1        @Y30LB25*/
*           RG1=RPLVPTR;            /* SET RPLV PTR          @Y30LB25*/
         LR    RG1,RPLVPTR                                         1824
*           CALL ICBVIO00;          /* DELETE CIR            @Y30LB25*/
         L     @15,@CV00610                                        1825
         BALR  @14,@15                                             1825
*           RESPECIFY               /*                       @Y30LB25*/
*             RG1 UNRSTD;           /* UNRESTRICT REG 1      @Y30LB25*/
*           IF RPLVRETC^=FIXZERO    /* CK RETN CODE          @Y30LB25*/
*             THEN                  /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1827
         N     @08,@CF00815                                        1827
         LTR   @08,@08                                             1827
         BNZ   @RT01827                                            1827
*             RETURN;               /*                       @Y30LB25*/
*         END;                      /*                       @Y30LB25*/
*                                                                  1829
*       /*************************************************************/
*       /*                                                           */
*       /* UPDATE THE GVR OR NGVR FOR THE DELETED BVR        @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1830
*       CALL PDELTBVR;              /* UPDATE, WRITE GVR     @Y30LB25*/
@RF01820 BAL   @14,PDELTBVR                                        1830
*       IF RPLVRETC^=FIXZERO        /* CHECK RETN CODE       @Y30LB25*/
*         THEN                      /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1831
         N     @08,@CF00815                                        1831
         LTR   @08,@08                                             1831
         BNZ   @RT01831                                            1831
*         RETURN;                   /*                       @Y30LB25
*                                      CHAIN BVR OUT OF      @Y30LB25
*                                      GVR, AND MAKE         @Y30LB25
*                                      LATEST DVR A BVR      @Y30LB25*/
*     END;                          /*                       @Y30LB25*/
*                                                                  1833
*   /*****************************************************************/
*   /*                                                               */
*   /* THE BVR HAS COPIES                                    @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1834
*   ELSE                            /* HAS COPIES            @Y30LB25*/
*     DO;                           /*                       @Y30LB25*/
*                                                                  1834
         B     @RC01796                                            1834
@RF01796 DS    0H                                                  1835
*       /*************************************************************/
*       /*                                                           */
*       /* WRITE THE BVR                                     @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1835
*       BASLIB1=FIX1F;              /* INSURE NULL           @Y30LB25*/
         L     @08,BASEVPTR                                        1835
         MVI   BASLIB1(@08),X'FF'                                  1835
*       BASLIB2=FIX1F;              /* INSURE NULL           @Y30LB25*/
         MVI   BASLIB2(@08),X'FF'                                  1836
*       BASREASS=ON;                /* CSNS REASSIGNED       @Y30LB25*/
         OI    BASREASS(@08),B'00100000'                           1837
*       RPLVDIR=OFF;                /* NO DIRECT             @Y30LB25*/
         NI    RPLVDIR(RPLVPTR),B'10111111'                        1838
*       RPLVTYP=RPLVPUT;            /* WRITE                 @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'01'                              1839
*       RESPECIFY                   /*                       @Y30LB25*/
*         RG1 RSTD;                 /* RESTRICT REG 1        @Y30LB25*/
*       RG1=RPLVPTR;                /* SET RPLV PTR          @Y30LB25*/
         LR    RG1,RPLVPTR                                         1841
*       CALL ICBVIO00;              /* WRITE BVR             @Y30LB25*/
         L     @15,@CV00610                                        1842
         BALR  @14,@15                                             1842
*       RESPECIFY                   /*                       @Y30LB25*/
*         RG1 UNRSTD;               /* UNRESTRICT REG 1      @Y30LB25*/
*       IF RPLVRETC^=FIXZERO        /* CHECK RETN CODE       @Y30LB25*/
*         THEN                      /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1844
         N     @08,@CF00815                                        1844
         LTR   @08,@08                                             1844
         BNZ   @RT01844                                            1844
*         RETURN;                   /*                       @Y30LB25*/
*                                                                  1845
*       /*************************************************************/
*       /*                                                           */
*       /* GET THE CIR FOR THE CORRECT CSN                   @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1846
*       IF BASCSN1^=INDSERNO        /* FIND CORRECT CSN      @Y30LB25*/
*         THEN                      /*                       @Y30LB25*/
         L     @08,BASEVPTR                                        1846
         CLC   BASCSN1(12,@08),INDSERNO(INDEXPTR)                  1846
         BE    @RF01846                                            1846
*         IVOLKY=BASCSN1;           /* KEY OF CSN            @Y30LB25*/
         MVC   IVOLKY(12),BASCSN1(@08)                             1847
*       ELSE                        /*                       @Y30LB25*/
*         IVOLKY=BASCSN2;           /* KEY OF OTHER CSN      @Y30LB25*/
         B     @RC01846                                            1848
@RF01846 L     @08,BASEVPTR                                        1848
         MVC   IVOLKY(12),BASCSN2(@08)                             1848
*       RPLVKEY=ADDR(IKEY);         /* ADDR OF KEY           @Y30LB25*/
@RC01846 LA    @08,IKEY                                            1849
         ST    @08,RPLVKEY(,RPLVPTR)                               1849
*       RPLVBLN=LENGTH(INDEXBUF);   /* CIR BUFFER LENGTH     @Y30LB25*/
         MVC   RPLVBLN(4,RPLVPTR),@CF00806                         1850
*       RPLVBUF=INDEXPTR;           /* ADDR OF CIR BUF       @Y30LB25*/
         ST    INDEXPTR,RPLVBUF(,RPLVPTR)                          1851
*       RPLVUPD=ON;                 /* UPDATE                @Y30LB25*/
         OI    RPLVUPD(RPLVPTR),B'00000010'                        1852
*       RPLVDIR=ON;                 /* DIRECT                @Y30LB25*/
         OI    RPLVDIR(RPLVPTR),B'01000000'                        1853
*       RPLVTYP=RPLVREAD;           /* READ RECORD           @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'00'                              1854
*       RESPECIFY                   /*                       @Y30LB25*/
*         RG1 RSTD;                 /* RESTRICT REG 1        @Y30LB25*/
*       RG1=RPLVPTR;                /* SET RPLV PTR          @Y30LB25*/
         LR    RG1,RPLVPTR                                         1856
*       CALL ICBVIO00;              /* READ CIR              @Y30LB25*/
         L     @15,@CV00610                                        1857
         BALR  @14,@15                                             1857
*       RESPECIFY                   /*                       @Y30LB25*/
*         RG1 UNRSTD;               /* UNRESTRICT REG 1      @Y30LB25*/
*       IF RPLVRETC^=FIXZERO        /* I/O ERROR OR NO       @Y30LB25*/
*         THEN                      /* CIR EXISTS            @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1859
         N     @08,@CF00815                                        1859
         LTR   @08,@08                                             1859
         BNZ   @RT01859                                            1859
*         RETURN;                   /*                       @Y30LB25*/
*                                                                  1860
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK IF THE CIR POINTS TO THE WRITTEN BVR        @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1861
*       IF INDRECKY=BASNAME         /* PT TO RIGHT           @Y30LB25*/
*         THEN                      /* RECORD?               @Y30LB25*/
         L     @08,BASEVPTR                                        1861
         CLC   INDRECKY(13,INDEXPTR),BASNAME(@08)                  1861
         BNE   @RF01861                                            1861
*         DO;                       /* YES                   @Y30LB25*/
*                                                                  1862
*           /*********************************************************/
*           /*                                                       */
*           /* DELETE THE CIR                                @Y30LB25*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1863
*           RPLVTYP=RPLVDEL;        /* DELETE                @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'05'                              1863
*           RPLVDIR=OFF;            /* NO DIRECT             @Y30LB25*/
         NI    RPLVDIR(RPLVPTR),B'10111111'                        1864
*           RESPECIFY               /*                       @Y30LB25*/
*             RG1 RSTD;             /* RESTRICT REG 1        @Y30LB25*/
*           RG1=RPLVPTR;            /* SET RPLV PTR          @Y30LB25*/
         LR    RG1,RPLVPTR                                         1866
*           CALL ICBVIO00;          /* DELETE CIR            @Y30LB25*/
         L     @15,@CV00610                                        1867
         BALR  @14,@15                                             1867
*           RESPECIFY               /*                       @Y30LB25*/
*             RG1 UNRSTD;           /* UNRESTRICT REG 1      @Y30LB25*/
*           IF RPLVRETC^=FIXZERO    /* CK RETN CODE          @Y30LB25*/
*             THEN                  /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1869
         N     @08,@CF00815                                        1869
         LTR   @08,@08                                             1869
         BNZ   @RT01869                                            1869
*             RETURN;               /*                       @Y30LB25*/
*         END;                      /*                       @Y30LB25*/
*     END;                          /*                       @Y30LB25*/
*                                                                  1872
@RF01861 DS    0H                                                  1873
*   /*****************************************************************/
*   /*                                                               */
*   /* NOW CREATE A CIR, ONE WILL NOT EXIST                  @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1873
*   CALL CWCIR;                     /* CREATE/WRITE          @Y30LB25
*                                      NEW CIR               @Y30LB25*/
@RC01796 BAL   @14,CWCIR                                           1873
*   BASEVPTR=BCDTEMP;               /* RESTORE BVR PTR       @Y30LB25*/
         ST    BCDTEMP,BASEVPTR                                    1874
*   RETURN;                         /*                       @Y30LB25*/
@EL00032 DS    0H                                                  1875
@EF00032 DS    0H                                                  1875
@ER00032 L     @14,@SA00032                                        1875
         BR    @14                                                 1875
*   END FIXBVR;                     /*                       @Y30LB25*/
         B     @EL00032                                            1876
*                                                                  1877
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - PDELTBVR                             @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* FUNCTION - THE INPUT BVR HAS ALREADY BEEN DELETED.    @Y30LB25*/
*   /* IF THE BVR IS GROUPED, GET THE GVR, UPDATE IT, CHAIN  @Y30LB25*/
*   /* THE BVR OUT OF THE GVR, AND WRITE THE GVR.            @Y30LB25*/
*   /* LOCATE A DVR FOR THE BVR, IF ANY, AND MAKE            @Y30LB25*/
*   /* IT THE BVR. IF NO DVR IS FOUND, THEN DELETE THE       @Y30LB25*/
*   /* BVR FROM THE NGVR CHAIN OF BVRS.                      @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* INPUT -                                               @Y30LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/
*   /* BASE VOLUME RECORD                                    @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* OUTPUT -                                              @Y30LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/
*   /* BASE VOLUME RECORD                                    @Y30LB25*/
*   /* GROUP VOLUME RECORD                                   @Y30LB25*/
*   /* NON-GROUP VOLUME RECORD                               @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1877
*PDELTBVR:                          /*                       @Y30LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/
*                                                                  1877
PDELTBVR ST    @14,@SA00033                                        1877
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK IF BVR WAS GROUPED                              @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1878
*   IF BASGRPV=ON                   /* GROUPED?              @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
         L     @08,BASEVPTR                                        1878
         TM    BASGRPV(@08),B'00100000'                            1878
         BNO   @RF01878                                            1878
*     DO;                           /*                       @Y30LB25*/
*                                                                  1879
*       /*************************************************************/
*       /*                                                           */
*       /* GET THE GVR                                       @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1880
*       GROUPKY=BASGROUP;           /* SET THE KEY           @Y30LB25*/
         MVC   GROUPKY(8),BASGROUP(@08)                            1880
*       RPLVKEY=ADDR(GKEY);         /* PTR TO KEY            @Y30LB25*/
         LA    @08,GKEY                                            1881
         ST    @08,RPLVKEY(,RPLVPTR)                               1881
*       RPLVTYP=RPLVREAD;           /* READ OPTION ON        @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'00'                              1882
*       RPLVLOC=OFF;                /* NO LOCATE             @Y30LB25*/
         NI    RPLVLOC(RPLVPTR),B'01111111'                        1883
*       RPLVUPD=ON;                 /* UPDATE                @Y30LB25*/
         OI    RPLVUPD(RPLVPTR),B'00000010'                        1884
*       RPLVDIR=ON;                 /* DIRECT                @Y30LB25*/
         OI    RPLVDIR(RPLVPTR),B'01000000'                        1885
*       RPLVBUF=GROUPPTR;           /* BUFFER PTR            @Y30LB25*/
         L     @08,GROUPPTR                                        1886
         ST    @08,RPLVBUF(,RPLVPTR)                               1886
*       RPLVBLN=LENGTH(GROUPBUF);   /* BUFFER LENGTH         @Y30LB25*/
         MVC   RPLVBLN(4,RPLVPTR),@CF00805                         1887
*       RESPECIFY                                                  1888
*         RG1 RSTD;                 /* RESTRICT REG 1        @Y30LB25*/
*       RG1=RPLVPTR;                /* SET RPLV PTR          @Y30LB25*/
         LR    RG1,RPLVPTR                                         1889
*       CALL ICBVIO00;              /* GET GVR               @Y30LB25*/
         L     @15,@CV00610                                        1890
         BALR  @14,@15                                             1890
*       RESPECIFY                                                  1891
*         RG1 UNRSTD;               /* UNRESTRICT REG 1      @Y30LB25*/
*       IF RPLVRETC^=FIXZERO        /* CHECK RETURN CODE     @Y30LB25*/
*         THEN                      /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1892
         N     @08,@CF00815                                        1892
         LTR   @08,@08                                             1892
         BNZ   @RT01892                                            1892
*         RETURN;                   /*                       @Y30LB25*/
*                                                                  1893
*       /*************************************************************/
*       /*                                                           */
*       /* CHAIN THE BVR OUT OF THE GVR CHAIN OF BVRS        @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1894
*       IF BASINAC=ON THEN          /* IS VOL INACTIVE       @ZA14747*/
         L     @08,BASEVPTR                                        1894
         TM    BASINAC(@08),B'00000100'                            1894
         BNO   @RF01894                                            1894
*         GRONINAC=GRONINAC-FIXONE; /* DECREM INACT VOL #    @ZA14747*/
         L     @08,GROUPPTR                                        1895
         LH    @04,GRONINAC(,@08)                                  1895
         BCTR  @04,0                                               1895
         STH   @04,GRONINAC(,@08)                                  1895
*       ELSE                                                       1896
*         IF BASRSTD=ON THEN        /* IS VOL RESTRCTED      @ZA14747*/
         B     @RC01894                                            1896
@RF01894 L     @08,BASEVPTR                                        1896
         TM    BASRSTD(@08),B'00001000'                            1896
         BNO   @RF01896                                            1896
*           GRONRSTD=GRONRSTD-FIXONE;/* DECREM RSTD VOL CNT  @ZA14747*/
         L     @08,GROUPPTR                                        1897
         LH    @04,GRONRSTD(,@08)                                  1897
         BCTR  @04,0                                               1897
         STH   @04,GRONRSTD(,@08)                                  1897
*         ELSE                                                     1898
*           IF BASGENUS=ON THEN     /* IS VOL GEN USE        @ZA14747*/
         B     @RC01896                                            1898
@RF01896 L     @08,BASEVPTR                                        1898
         TM    BASGENUS(@08),B'00010000'                           1898
         BNO   @RF01898                                            1898
*             GRONGEN=GRONGEN-FIXONE;/* DECREM GENUSE CNT    @ZA14747*/
         L     @08,GROUPPTR                                        1899
         LH    @04,GRONGEN(,@08)                                   1899
         BCTR  @04,0                                               1899
         STH   @04,GRONGEN(,@08)                                   1899
*       GRPFLG=ON;                  /* SET GROUP FLAG        @Y30LB25*/
@RF01898 DS    0H                                                  1900
@RC01896 DS    0H                                                  1900
@RC01894 OI    GRPFLG,B'00010000'                                  1900
*       CALL ICBVUCHO(GROUPPTR,BASEVPTR,RPLVPTR,BYTEPASS);/* @Y30LB25
*                                      CHAIN BVR OUT GVR     @Y30LB25*/
         ST    RPLVPTR,@TF00001                                    1901
         L     @15,@CV00615                                        1901
         LA    @01,@AL01901                                        1901
         BALR  @14,@15                                             1901
*       IF RPLVRETC^=FIXZERO        /* CHECK RETURN CODE     @Y30LB25*/
*         THEN                      /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1902
         N     @08,@CF00815                                        1902
         LTR   @08,@08                                             1902
         BNZ   @RT01902                                            1902
*         RETURN;                   /*                       @Y30LB25*/
*                                                                  1903
*       /*************************************************************/
*       /*                                                           */
*       /* REESTABLISH RPLV FOR UPDATE OF GVR                @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1904
*       GROUPKY=BASGROUP;           /* SET THE KEY           @Y30LB25*/
         L     @08,BASEVPTR                                        1904
         MVC   GROUPKY(8),BASGROUP(@08)                            1904
*       RPLVKEY=ADDR(GKEY);         /* PTR TO KEY            @Y30LB25*/
         LA    @08,GKEY                                            1905
         ST    @08,RPLVKEY(,RPLVPTR)                               1905
*       RPLVTYP=RPLVREAD;           /* READ OPTION ON        @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'00'                              1906
*       RPLVLOC=OFF;                /* NO LOCATE             @Y30LB25*/
         NI    RPLVLOC(RPLVPTR),B'01111111'                        1907
*       RPLVUPD=ON;                 /* UPDATE                @Y30LB25*/
         OI    RPLVUPD(RPLVPTR),B'00000010'                        1908
*       RPLVDIR=ON;                 /* DIRECT                @Y30LB25*/
         OI    RPLVDIR(RPLVPTR),B'01000000'                        1909
*       RPLVBUF=ADDR(GRECBF);       /* BUFFER PTR            @Y30LB25*/
         LA    @08,GRECBF                                          1910
         ST    @08,RPLVBUF(,RPLVPTR)                               1910
*       RPLVBLN=LENGTH(GRECBF);     /* BUFFER LENGTH         @Y30LB25*/
         MVC   RPLVBLN(4,RPLVPTR),@CF00805                         1911
*       RESPECIFY                                                  1912
*         RG1 RSTD;                 /* RESTRICT REG 1        @Y30LB25*/
*       RG1=RPLVPTR;                /* SET RPLV PTR          @Y30LB25*/
         LR    RG1,RPLVPTR                                         1913
*       CALL ICBVIO00;              /* GET GVR               @Y30LB25*/
         L     @15,@CV00610                                        1914
         BALR  @14,@15                                             1914
*       IF RPLVRETC^=FIXZERO        /* CHECK RETURN CODE     @Y30LB25*/
*         THEN                      /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1915
         N     @08,@CF00815                                        1915
         LTR   @08,@08                                             1915
         BNZ   @RT01915                                            1915
*         RETURN;                   /*                       @Y30LB25*/
*                                                                  1916
*       /*************************************************************/
*       /*                                                           */
*       /* WRITE THE GVR                                     @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1917
*       RPLVTYP=RPLVPUT;            /* WRITE FOR GVR         @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'01'                              1917
*       RPLVBUF=GROUPPTR;           /* PTR TO GVR            @Y30LB25*/
         L     @08,GROUPPTR                                        1918
         ST    @08,RPLVBUF(,RPLVPTR)                               1918
*       CALL ICBVIO00;              /* GET GVR               @Y30LB25*/
         L     @15,@CV00610                                        1919
         BALR  @14,@15                                             1919
*       RESPECIFY                                                  1920
*         RG1 UNRSTD;               /* UNRESTRICT REG 1      @Y30LB25*/
*       IF RPLVRETC^=FIXZERO        /* CHECK RETURN CODE     @Y30LB25*/
*         THEN                      /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1921
         N     @08,@CF00815                                        1921
         LTR   @08,@08                                             1921
         BNZ   @RT01921                                            1921
*         RETURN;                   /*                       @Y30LB25*/
*       IF BASINAC=OFF&             /* VOL INACTIVE          @ZA14747*/
*           BASGENUS=ON THEN        /* VOL GENERAL USE       @ZA14747*/
         L     @08,BASEVPTR                                        1923
         TM    BASGENUS(@08),B'00010000'                           1923
         BNO   @RF01923                                            1923
         TM    BASINAC(@08),B'00000100'                            1923
         BNZ   @RF01923                                            1923
*         DO;                       /*                       @ZA14747*/
*           ADDSUBSL=OFF;           /* DELETE SLOT           @ZA14747*/
         NI    ADDSUBSL,B'11111101'                                1925
*           EXPSLOT=OFF;            /* NO EXPIR DATE         @ZA14747*/
         NI    EXPSLOT,B'01111111'                                 1926
*           CALL ICBVUEXT(GROUPPTR,BASEVPTR,RPLVPTR,BYTEPASS);/*   1927
*                                      DELETE A SLOT         @ZA14747*/
         ST    RPLVPTR,@TF00001                                    1927
         L     @15,@CV00617                                        1927
         LA    @01,@AL01927                                        1927
         BALR  @14,@15                                             1927
*           IF RPLVRETC^=FIXZERO THEN/* CHECK RETURN CODE    @ZA14747*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1928
         N     @08,@CF00815                                        1928
         LTR   @08,@08                                             1928
         BNZ   @RT01928                                            1928
*             RETURN;               /*                       @ZA14747*/
*         END;                      /*                       @ZA14747*/
*     END;                          /*                       @Y30LB25*/
*                                                                  1931
@RF01923 DS    0H                                                  1932
*   /*****************************************************************/
*   /*                                                               */
*   /* READ FOR A DVR FOR THE DELETED BVR                    @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1932
*   DVOLKY=BASSERNO;                /* SET VOLID IN KEY      @Y30LB25*/
@RF01878 L     @08,BASEVPTR                                        1932
         MVC   DVOLKY(6),BASSERNO(@08)                             1932
*   DIDKY=FIXONE;                   /* SET KEY               @Y30LB25*/
         MVI   DIDKY,X'01'                                         1933
*   RPLVKEY=ADDR(DKEY);             /* ADDR OF KEY           @Y30LB25*/
         LA    @08,DKEY                                            1934
         ST    @08,RPLVKEY(,RPLVPTR)                               1934
*   RPLVTYP=RPLVREAD;               /* READ OPTION ON        @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'00'                              1935
*   RPLVLOC=OFF;                    /* NO LOCATE             @Y30LB25*/
         NI    RPLVLOC(RPLVPTR),B'01111111'                        1936
*   RPLVUPD=ON;                     /* SET UPDATE            @Y30LB25*/
         OI    RPLVUPD(RPLVPTR),B'00000010'                        1937
*   RPLVKGE=ON;                     /* READ KEY = OR >       @Y30LB25*/
         OI    RPLVKGE(RPLVPTR),B'00000100'                        1938
*   RPLVBUF=DUPVPTR;                /* BUFFER PTR            @Y30LB25*/
         L     @08,DUPVPTR                                         1939
         ST    @08,RPLVBUF(,RPLVPTR)                               1939
*   RPLVBLN=LENGTH(DUPVBUF);        /* BUFFER LENGTH         @Y30LB25*/
         MVC   RPLVBLN(4,RPLVPTR),@CF00804                         1940
*   RESPECIFY                                                      1941
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* SET RPLV PTR          @Y30LB25*/
         LR    RG1,RPLVPTR                                         1942
*   CALL ICBVIO00;                  /* READ FOR DVR          @Y30LB25*/
         L     @15,@CV00610                                        1943
         BALR  @14,@15                                             1943
*   RESPECIFY                                                      1944
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   RPLVKGE=OFF;                    /* NO > OR =             @Y30LB25*/
         NI    RPLVKGE(RPLVPTR),B'11111011'                        1945
*   IF RPLRCODE=IOERROR             /* CHECK REASON CODE     @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
         CLC   RPLRCODE(2,RPLVPTR),@CB00588                        1946
         BE    @RT01946                                            1946
*     RETURN;                       /*                       @Y30LB25*/
*                                                                  1947
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK IF A DVR WAS FOUND                              @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1948
*   IF DKY^=DUPD×DVOLKY^=DUPSERNO   /* DVR FOUND?            @Y30LB25*/
*     THEN                          /* NO                    @Y30LB25*/
*                                                                  1948
         L     @08,DUPVPTR                                         1948
         CLC   DKY(5),DUPD(@08)                                    1948
         BNE   @RT01948                                            1948
         CLC   DVOLKY(6),DUPSERNO(@08)                             1948
         BE    @RF01948                                            1948
@RT01948 DS    0H                                                  1949
*     /***************************************************************/
*     /*                                                             */
*     /* NO DVR WAS FOUND, BUT BVR WAS NOT GROUPED           @Y30LB25*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  1949
*     IF BASGRPV=OFF                /* BVR NOT GRPD?         @Y30LB25*/
*       THEN                        /* YES                   @Y30LB25*/
         L     @08,BASEVPTR                                        1949
         TM    BASGRPV(@08),B'00100000'                            1949
         BNZ   @RF01949                                            1949
*       DO;                         /*                       @Y30LB25*/
*                                                                  1950
*         /***********************************************************/
*         /*                                                         */
*         /* CHAIN THE BVR OUT OF THE NGVR                   @Y30LB25*/
*         /* CHAIN OF BVRS                                   @Y30LB25*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  1951
*         GRPFLG=OFF;               /* NON-GROUPED           @Y30LB25*/
         NI    GRPFLG,B'11101111'                                  1951
*         CALL ICBVUCHO(FIXZERO,BASEVPTR,RPLVPTR,BYTEPASS);/*      1952
*                                                            @Y30LB25
*                                      CHAIN BVR OUT NGVR    @Y30LB25*/
         ST    RPLVPTR,@TF00001                                    1952
         L     @15,@CV00615                                        1952
         LA    @01,@AL01952                                        1952
         BALR  @14,@15                                             1952
*         RETURN;                   /*                       @Y30LB25*/
@EL00033 DS    0H                                                  1953
@EF00033 DS    0H                                                  1953
@ER00033 L     @14,@SA00033                                        1953
         BR    @14                                                 1953
*       END;                        /*                       @Y30LB25*/
*     ELSE                          /* GROUPED               @Y30LB25*/
*       RETURN;                     /*                       @Y30LB25*/
*                                                                  1955
*   /*****************************************************************/
*   /*                                                               */
*   /* A DVR WAS FOUND, MAKE IT INTO A BVR                   @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1956
*   ELSE                            /* DVR WAS FOUND         @Y30LB25*/
*     DO;                           /*                       @Y30LB25*/
*                                                                  1956
@RF01948 DS    0H                                                  1957
*       /*************************************************************/
*       /*                                                           */
*       /* CHECK IF DELETED BVR WAS GROUPED                  @Y30LB25*/
*       /* OR NON-GROUPED                                    @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1957
*       IF BASGRPV=ON               /* BVR GROUPED?          @Y30LB25*/
*         THEN                      /* YES                   @Y30LB25*/
         L     @08,BASEVPTR                                        1957
         TM    BASGRPV(@08),B'00100000'                            1957
         BNO   @RF01957                                            1957
*         DO;                       /*                       @Y30LB25*/
*           GRPDV=ON;               /* GROUPED FLAG ON       @Y30LB25*/
         OI    GRPDV,B'10000000'                                   1959
*           CALL ICBVUDBR(DUPVPTR,PTRBASEV,RPLVPTR,BYTEPASS,/*     1960
*                                                            @Y30LB25*/
*               FIXZERO,FIXZERO);   /*                       @Y30LB25
*                                      MAKE DVR A BVR        @Y30LB25*/
         ST    RPLVPTR,@TF00001                                    1960
         L     @15,@CV00616                                        1960
         LA    @01,@AL01960                                        1960
         BALR  @14,@15                                             1960
*           IF RPLVRETC^=FIXZERO    /* CHECK RETURN CODE     @Y30LB25*/
*             THEN                  /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1961
         N     @08,@CF00815                                        1961
         LTR   @08,@08                                             1961
         BNZ   @RT01961                                            1961
*             RETURN;               /*                       @Y30LB25*/
*                                                                  1962
*           /*********************************************************/
*           /*                                                       */
*           /* CHAIN THE NEW BVR INTO THE NGVR               @Y30LB25*/
*           /* CHAIN OF BVRS                                 @Y30LB25*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1963
*           GRPFLG=OFF;             /* NON-GROUPED           @Y30LB25*/
         NI    GRPFLG,B'11101111'                                  1963
*           CALL ICBVUCHI(FIXZERO,PTRBASEV,RPLVPTR,BYTEPASS);/*    1964
*                                                            @Y30LB25
*                                      CHAIN BVR IN NGVR     @Y30LB25*/
         ST    RPLVPTR,@TF00001                                    1964
         L     @15,@CV00614                                        1964
         LA    @01,@AL01964                                        1964
         BALR  @14,@15                                             1964
*           IF RPLVRETC^=FIXZERO    /* CHECK RETURN CODE     @Y30LB25*/
*             THEN                  /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1965
         N     @08,@CF00815                                        1965
         LTR   @08,@08                                             1965
         BNZ   @RT01965                                            1965
*             RETURN;               /*                       @Y30LB25*/
*         END;                      /*                       @Y30LB25*/
*                                                                  1967
*       /*************************************************************/
*       /*                                                           */
*       /* THE DELETED BVR WAS NOT GROUPED                   @Y30LB25*/
*       /* CREATE A BVR AND IT WILL ALREADY BE               @Y30LB25*/
*       /* CHAINED INTO THE NGVR CHAIN OF BVRS               @Y30LB25*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1968
*       ELSE                        /* NOT GROUPED           @Y30LB25*/
*         DO;                       /*                       @Y30LB25*/
         B     @RC01957                                            1968
@RF01957 DS    0H                                                  1969
*           GRPDV=OFF;              /* GROUPED FLAG OFF      @Y30LB25*/
         NI    GRPDV,B'01111111'                                   1969
*           IF BASFIRST=ON          /* 1ST BVR IN CHAIN?     @Y30LB25*/
*             THEN                  /* YES                   @Y30LB25*/
         L     @08,BASEVPTR                                        1970
         TM    BASFIRST(@08),B'00010000'                           1970
         BNO   @RF01970                                            1970
*             FRSTDV=ON;            /* SET 1ST FLG ON        @Y30LB25*/
         OI    FRSTDV,B'01000000'                                  1971
*           IF BASLAST=ON           /* LAST BVR IN CHAIN?    @Y30LB25*/
*             THEN                  /* YES                   @Y30LB25*/
@RF01970 L     @08,BASEVPTR                                        1972
         TM    BASLAST(@08),B'00001000'                            1972
         BNO   @RF01972                                            1972
*             LASTDV=ON;            /* SET LAST FLG ON       @Y30LB25*/
         OI    LASTDV,B'00100000'                                  1973
*           CALL ICBVUDBR(DUPVPTR,PTRBASEV,RPLVPTR,BYTEPASS,/*     1974
*                                                            @Y30LB25*/
*               BASPREV,BASNEXTV);  /*                       @Y30LB25
*                                      MAKE DVR A BVR        @Y30LB25*/
@RF01972 MVC   @AL00001(16),@AL01974                               1974
         ST    RPLVPTR,@TF00001                                    1974
         L     @08,BASEVPTR                                        1974
         LA    @04,BASPREV(,@08)                                   1974
         ST    @04,@AL00001+16                                     1974
         LA    @08,BASNEXTV(,@08)                                  1974
         ST    @08,@AL00001+20                                     1974
         L     @15,@CV00616                                        1974
         LA    @01,@AL00001                                        1974
         BALR  @14,@15                                             1974
*           IF RPLVRETC^=FIXZERO    /* CHECK RETURN CODE     @Y30LB25*/
*             THEN                  /* ERROR                 @Y30LB25*/
         LH    @08,RPLVRETC(,RPLVPTR)                              1975
         N     @08,@CF00815                                        1975
         LTR   @08,@08                                             1975
         BNZ   @RT01975                                            1975
*             RETURN;               /*                       @Y30LB25*/
*         END;                      /*                       @Y30LB25*/
*     END;                          /*                       @Y30LB25*/
*                                                                  1978
@RC01957 DS    0H                                                  1979
*   /*****************************************************************/
*   /*                                                               */
*   /* WRITE THE NEWLY CREATED BVR                           @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1979
*   RPLVTYP=RPLVPUT;                /* WRITE BVR             @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'01'                              1979
*   RPLVBUF=PTRBASEV;               /* PTR TO BVR            @Y30LB25*/
         L     @08,PTRBASEV                                        1980
         ST    @08,RPLVBUF(,RPLVPTR)                               1980
*   RPLVUPD=OFF;                    /* NEW RECORD            @Y30LB25*/
         NI    RPLVUPD(RPLVPTR),B'11111101'                        1981
*   RPLVBLN=LENGTH(BASEBUF);        /* SET BUF LENGTH        @Y30LB25*/
         LA    @08,224                                             1982
         ST    @08,RPLVBLN(,RPLVPTR)                               1982
*   RPLVRLN=LENGTH(BASEBUF);        /* SET BVR LENGTH        @Y30LB25*/
         ST    @08,RPLVRLN(,RPLVPTR)                               1983
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* SET PTR TO RPLV       @Y30LB25*/
         LR    RG1,RPLVPTR                                         1985
*   CALL ICBVIO00;                  /* WRITE BVR             @Y30LB25*/
         L     @15,@CV00610                                        1986
         BALR  @14,@15                                             1986
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   RETURN;                         /*                       @Y30LB25*/
         B     @EL00033                                            1988
*   END PDELTBVR;                   /*                       @Y30LB25*/
         B     @EL00033                                            1989
*                                                                  1990
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEDURE NAME - CWCIR                                @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* FUNCTION - CREATE AND WRITE A CIR.                    @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* INPUT -                                               @Y30LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/
*   /*                                                       @Y30LB25*/
*   /* OUTPUT -                                              @Y30LB25*/
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1990
*CWCIR:                             /*                       @Y30LB25*/
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/
*                                                                  1990
CWCIR    ST    @14,@SA00034                                        1990
*   /*****************************************************************/
*   /*                                                               */
*   /* CREATE AND INITIALIZE A CIR                           @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1991
*   INDEXBUF=INDEXBUF&&INDEXBUF;    /* ZERO CIR BUFFER       @Y30LB25*/
         XC    INDEXBUF(36),INDEXBUF                               1991
*   IF CSNUMBER=ON                  /* CSN1?                 @Y30LB25*/
*     THEN                          /* YES                   @Y30LB25*/
         TM    CSNUMBER,B'00000100'                                1992
         BNO   @RF01992                                            1992
*     INDSERNO=BCDCSN1;             /* CIR FOR CSN1          @Y30LB25*/
         L     @08,BCDVPTR                                         1993
         MVC   INDSERNO(12,INDEXPTR),BCDCSN1(@08)                  1993
*   ELSE                            /* CSN2                  @Y30LB25*/
*     INDSERNO=BCDCSN2;             /* CIR FOR CSN2          @Y30LB25*/
         B     @RC01992                                            1994
@RF01992 L     @08,BCDVPTR                                         1994
         MVC   INDSERNO(12,INDEXPTR),BCDCSN2(@08)                  1994
*   INDI=I;                         /* SET CIR INDECATOR     @Y30LB25*/
@RC01992 MVI   INDI(INDEXPTR),C'I'                                 1995
*   INDINDEX=ON;                    /* CIR FLAG SET ON       @Y30LB25*/
         OI    INDINDEX(INDEXPTR),B'00001000'                      1996
*   INDRECKY=BCDNAME;               /* BVR, CVR, DVR KEY     @Y30LB25*/
*                                                                  1997
         L     @08,BCDVPTR                                         1997
         MVC   INDRECKY(13,INDEXPTR),BCDNAME(@08)                  1997
*   /*****************************************************************/
*   /*                                                               */
*   /* WRITE THE NEW CIR                                     @Y30LB25*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1998
*   RPLVBLN=LENGTH(INDEXBUF);       /* CIR BUFFER LENGTH     @Y30LB25*/
         LA    @08,36                                              1998
         ST    @08,RPLVBLN(,RPLVPTR)                               1998
*   RPLVRLN=LENGTH(INDEXBUF);       /* CIR LENGTH            @Y30LB25*/
         ST    @08,RPLVRLN(,RPLVPTR)                               1999
*   RPLVBUF=INDEXPTR;               /* ADDR OF CIR BUF       @Y30LB25*/
         ST    INDEXPTR,RPLVBUF(,RPLVPTR)                          2000
*   RPLVUPD=OFF;                    /* NO UPDATE             @Y30LB25*/
         NI    RPLVUPD(RPLVPTR),B'11111101'                        2001
*   RPLVTYP=RPLVPUT;                /* PUT NEW RECORD        @Y30LB25*/
         MVI   RPLVTYP(RPLVPTR),X'01'                              2002
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/
*   RG1=RPLVPTR;                    /* SET RPLV PTR          @Y30LB25*/
         LR    RG1,RPLVPTR                                         2004
*   CALL ICBVIO00;                  /* WRITE CIR FOR CSN1    @Y30LB25*/
         L     @15,@CV00610                                        2005
         BALR  @14,@15                                             2005
*   RESPECIFY                       /*                       @Y30LB25*/
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/
*   RETURN;                         /*                       @Y30LB25*/
@EL00034 DS    0H                                                  2007
@EF00034 DS    0H                                                  2007
@ER00034 L     @14,@SA00034                                        2007
         BR    @14                                                 2007
*   END CWCIR;                      /*                       @Y30LB25*/
*   RESPECIFY                       /*                       @Y30LB25*/
*     RPLVPTR UNRSTD;               /* UNRESTRICT REG 2      @Y30LB25*/
*   END ICBVMS00                    /* THE END               @Y30LB25*/
*                                                                  2010
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.     */
*/*%INCLUDE SYSLIB  (IEZVVICB)                                       */
*/*%INCLUDE SYSLIB  (IEZRPLV )                                       */
*/*%INCLUDE SYSLIB  (IEZMESG )                                       */
*/*%INCLUDE SYSLIB  (IEZINDEX)                                       */
*/*%INCLUDE SYSLIB  (IEZGROUP)                                       */
*/*%INCLUDE SYSLIB  (IEZBCDV )                                       */
*/*%INCLUDE SYSLIB  (IEZBASEV)                                       */
*/*%INCLUDE SYSLIB  (IEZCOPYV)                                       */
*/*%INCLUDE SYSLIB  (IEZDUPV )                                       */
*/*%INCLUDE SYSLIB  (IEZMSGRQ)                                       */
*                                                                  2010
*       ;                                                          2010
         B     @EL00001                                            2010
@DATA    DS    0H
         DS    0F
@AL01386 EQU   *                       LIST WITH   4 ARGUMENT(S)
@AL01952 DC    A(@CF00083)             LIST WITH   4 ARGUMENT(S)
         DC    A(BASEVPTR)
         DC    A(@TF00001)
         DC    A(BYTEPASS)
@AL01901 EQU   *                       LIST WITH   4 ARGUMENT(S)
@AL01927 DC    A(GROUPPTR)             LIST WITH   4 ARGUMENT(S)
         DC    A(BASEVPTR)
         DC    A(@TF00001)
         DC    A(BYTEPASS)
@AL01960 EQU   *                       LIST WITH   6 ARGUMENT(S)
@AL01974 DC    A(DUPVPTR)              LIST WITH   4 ARGUMENT(S)
         DC    A(PTRBASEV)
         DC    A(@TF00001)
         DC    A(BYTEPASS)
         DC    A(@CF00083)
         DC    A(@CF00083)
@AL01964 DC    A(@CF00083)             LIST WITH   4 ARGUMENT(S)
         DC    A(PTRBASEV)
         DC    A(@TF00001)
         DC    A(BYTEPASS)
         DS    0F
@SA00001 DS    18F
@PC00001 DS    4F
@SA00004 DS    1F
@SA00007 DS    1F
@SA00008 DS    1F
@SA00009 DS    1F
@SA00005 DS    1F
@SA00006 DS    1F
@SA00026 DS    1F
@SA00027 DS    1F
@SA00010 DS    1F
@SA00011 DS    1F
@SA00015 DS    1F
@SA00019 DS    1F
@SA00023 DS    1F
@SA00012 DS    1F
@SA00016 DS    1F
@SA00020 DS    1F
@SA00013 DS    1F
@SA00014 DS    1F
@SA00017 DS    1F
@SA00018 DS    1F
@SA00021 DS    1F
@SA00022 DS    1F
@SA00024 DS    1F
@SA00025 DS    1F
@SA00028 DS    1F
@SA00032 DS    1F
@SA00029 DS    1F
@SA00030 DS    1F
@SA00033 DS    0F
@SA00031 DS    0F
@SA00034 DS    0F
@SA00002 DS    0F
@SA00003 DS    0F
         DS    1F
@AL00001 DS    6A
@TF00001 DS    F
         DS    0F
@CF00083 DC    F'0'
@CF00045 DC    F'1'
@CF00806 DC    F'36'
@CF00807 DC    F'65'
@CF00805 DC    F'164'
@CF00804 DC    F'224'
@CF00546 DC    F'255'
@CF00584 DC    F'412'
@CF00552 DC    XL4'FFFFFFFF'
@CF00815 DC    XL4'0000FFFF'
@CF00550 DC    XL4'FFFF'
@CV00610 DC    V(ICBVIO00)
@CV00611 DC    V(ICBVRR00)
@CV00612 DC    V(ICBVJL00)
@CV00613 DC    V(ICBVOP00)
@CV00614 DC    V(ICBVUCHI)
@CV00615 DC    V(ICBVUCHO)
@CV00616 DC    V(ICBVUDBR)
@CV00617 DC    V(ICBVUEXT)
         DS    0D
GROUPPTR DS    A
BCDVPTR  DS    A
BASEVPTR DS    A
DUPVPTR  DS    A
PTRBASEV DS    A
MESLEN   DC    AL2(68)
@CC00575 DC    C'             '
@CC00572 EQU   @CC00575
@CC00466 DC    C'D    '
@CC00555 DC    C'04'
@CC00557 DC    C'0A'
@CC00559 DC    C'0D'
@CC00561 DC    C'83'
@CB00552 DC    X'FFFFFFFF'
@CB00586 DC    X'0208'
@CB00588 DC    X'0209'
MSGRQ    DS    CL32
         ORG   MSGRQ
MSGID    DS    FL4
MSGRPLV  DS    AL4
MSGRLEN  DS    BL1
MSGREPLY DS    AL3
MSGLEN1  DS    BL1
MSGTEXT1 DS    AL3
MSGLEN2  DS    BL1
MSGTEXT2 DS    AL3
MSGLEN3  DS    BL1
MSGTEXT3 DS    AL3
MSGLEN4  DS    BL1
MSGTEXT4 DS    AL3
MSGLEN5  DS    BL1
MSGTEXT5 DS    AL3
         ORG   MSGRQ+32
GROUPBUF DS    CL164
GRECBF   DS    CL164
BASEBUF  DS    CL224
COPYBUF  DS    CL164
INDEXBUF DS    CL36
DUPVBUF  DS    CL224
BCDRECBF DS    CL224
GKEY     DS    CL13
         ORG   GKEY
GKY      DC    CL3'G  '
GROUPKY  DS    CL8
GBLKKY   DC    CL1' '
GIDKY    DC    XL1'00'
         ORG   GKEY+13
         DS    CL3
BKEY     DS    CL13
         ORG   BKEY
BKY      DC    CL5'V    '
BVOLKY   DS    CL6
BBLKKY   DC    CL1' '
BIDKY    DC    XL1'00'
         ORG   BKEY+13
         DS    CL3
DKEY     DS    CL13
         ORG   DKEY
DKY      DC    CL5'D    '
DVOLKY   DS    CL6
DBLKKY   DC    CL1' '
DIDKY    DS    FL1
         ORG   DKEY+13
         DS    CL3
CKEY     DS    CL13
         ORG   CKEY
CKY      DC    CL5'V    '
CVOLKY   DS    CL6
CBLKKY   DC    CL1' '
CIDKY    DS    FL1
         ORG   CKEY+13
         DS    CL3
IKEY     DS    CL13
         ORG   IKEY
IKY      DC    CL1'I'
IVOLKY   DS    CL12
         ORG   IKEY+13
         DS    CL3
WORKAREA DS    CL19
         ORG   WORKAREA
REACODE  DS    CL2
RETCODE  DS    CL2
TEMPCKEY DS    CL13
BYTEPASS DS    CL2
         ORG   BYTEPASS
GRPDV    DS    BL1
FRSTDV   EQU   BYTEPASS+0
LASTDV   EQU   BYTEPASS+0
GRPFLG   EQU   BYTEPASS+0
ADDSUBGR EQU   BYTEPASS+0
CSNUMBER EQU   BYTEPASS+0
ADDSUBSL EQU   BYTEPASS+0
RPLVFLG  EQU   BYTEPASS+0
EXPSLOT  DS    BL1
ADDSUB   EQU   BYTEPASS+1
@NM00029 EQU   BYTEPASS+1
         ORG   WORKAREA+19
         DS    CL1
VMSPATCH DS    CL400
         ORG   VMSPATCH
@NM00030 DC    400X'00'
         ORG   VMSPATCH+400
MSG412   DS    CL52
         ORG   MSG412
MSG      DC    CL7'MESSAGE'
FILL2    DC    CL1' '
IDMSG    DS    CL2
FILL3    DC    CL2'  '
CODELAB  DC    CL4'CODE'
FILL4    DC    CL1' '
MSGTCODE DS    CL1
FILL5    DC    CL2'  '
VOLID    DS    CL6
FILL7    DC    CL1' '
CSN1     DS    CL12
FILL6    DC    CL1' '
CSN2     DS    CL12
         ORG   MSG412+52
@00      EQU   00                      EQUATES FOR REGISTERS 0-15
@01      EQU   01
@02      EQU   02
@03      EQU   03
@04      EQU   04
@05      EQU   05
@06      EQU   06
@07      EQU   07
@08      EQU   08
@09      EQU   09
@10      EQU   10
@11      EQU   11
@12      EQU   12
@13      EQU   13
@14      EQU   14
@15      EQU   15
SAVCVRPT EQU   @08
A        EQU   @03
BCDTEMP  EQU   @03
COPYVPTR EQU   @06
INDEXPTR EQU   @07
MESGPTR  EQU   @05
VVIPTR   EQU   @03
RPLVPTR  EQU   @02
RG0      EQU   @00
RG1      EQU   @01
RG14     EQU   @14
RG10     EQU   @10
RG11     EQU   @11
RG12     EQU   @12
RG13     EQU   @13
RG15     EQU   @15
RG2      EQU   @02
RG3      EQU   @03
RG4      EQU   @04
RG5      EQU   @05
RG6      EQU   @06
RG7      EQU   @07
RG8      EQU   @08
RG9      EQU   @09
VVICB    EQU   0
VVIFLGA  EQU   VVICB+15
VVIFLG0  EQU   VVIFLGA
RPLV     EQU   0
RPLTCBPR EQU   RPLV+8
RPLVVICB EQU   RPLV+12
RPLFLAGA EQU   RPLV+28
RPLRCODE EQU   RPLV+32
RPLVRETC EQU   RPLV+34
RPLVSAM  EQU   RPLV+56
RPLVTYP  EQU   RPLVSAM+2
RPLVBUF  EQU   RPLVSAM+32
RPLVKEY  EQU   RPLVSAM+36
RPLVOPT  EQU   RPLVSAM+40
RPLVLOC  EQU   RPLVOPT
RPLVDIR  EQU   RPLVOPT
RPLVKGE  EQU   RPLVOPT
RPLVUPD  EQU   RPLVOPT+1
RPLVRLN  EQU   RPLVSAM+48
RPLVBLN  EQU   RPLVSAM+52
RPLVUTIL EQU   RPLV+132
MESG     EQU   0
MESCODE  EQU   MESG+4
MESGBUF  EQU   MESG+8
INDEX    EQU   0
INDNAME  EQU   INDEX
INDI     EQU   INDNAME
INDSERNO EQU   INDNAME+1
INDTYPE  EQU   INDEX+13
INDINDEX EQU   INDTYPE
INDRECKY EQU   INDEX+15
INDPREFX EQU   INDRECKY
INDALPHA EQU   INDPREFX
INDVSRNO EQU   INDRECKY+5
INDRECID EQU   INDRECKY+11
INDEXREC EQU   INDRECID+1
GROUP    EQU   0
GRONAME  EQU   GROUP
GROID    EQU   GRONAME+11
GROFLAGA EQU   GROUP+13
GROTYPE  EQU   GROFLAGA
GRONGEN  EQU   GROUP+30
GRONRSTD EQU   GROUP+32
GRONINAC EQU   GROUP+34
GROERRTS EQU   GROUP+56
BCDV     EQU   0
BCDNAME  EQU   BCDV
BCDPREFX EQU   BCDNAME
BCDID    EQU   BCDNAME+11
BCDFLAGA EQU   BCDV+14
BCDTYPE  EQU   BCDFLAGA
BCDFLAGB EQU   BCDFLAGA+2
BCDRCVYF EQU   BCDV+20
BCDSATIA EQU   BCDRCVYF
BCDMISCF EQU   BCDRCVYF+2
BCDCSN1  EQU   BCDV+24
BCDLIB1  EQU   BCDV+36
BCDLID1  EQU   BCDLIB1
BCDCSN2  EQU   BCDV+37
BCDLIB2  EQU   BCDV+49
BCDLID2  EQU   BCDLIB2
BASEV    EQU   0
BASNAME  EQU   BASEV
BASSERNO EQU   BASNAME+5
BASID    EQU   BASNAME+11
BASFLAGA EQU   BASEV+14
BASTYPE  EQU   BASFLAGA
BASBASVR EQU   BASTYPE
BASDLSF  EQU   BASFLAGA+2
BASGRPV  EQU   BASFLAGA+2
BASGENUS EQU   BASFLAGA+2
BASRSTD  EQU   BASFLAGA+2
BASINAC  EQU   BASFLAGA+2
BASBIND  EQU   BASFLAGA+2
BASEXCL  EQU   BASFLAGA+2
BASDAERA EQU   BASFLAGA+3
BASRONLY EQU   BASFLAGA+3
BASREASS EQU   BASFLAGA+3
BASFIRST EQU   BASFLAGA+3
BASLAST  EQU   BASFLAGA+3
BASRCVYF EQU   BASEV+20
BASSATIA EQU   BASRCVYF
BASMISCF EQU   BASRCVYF+2
BASCSN1  EQU   BASEV+24
BASLIB1  EQU   BASEV+36
BASLID1  EQU   BASLIB1
BAS1BIT1 EQU   BASLID1
BAS1BIT2 EQU   BASLID1
BASCSN2  EQU   BASEV+37
BASLIB2  EQU   BASEV+49
BASLID2  EQU   BASLIB2
BAS2BIT1 EQU   BASLID2
BAS2BIT2 EQU   BASLID2
BASPREV  EQU   BASEV+50
BASNEXTV EQU   BASEV+56
BASNCOPY EQU   BASEV+62
BASNBKUP EQU   BASEV+63
BASBKLMT EQU   BASEV+64
BASFRESP EQU   BASEV+68
BASLEXT  EQU   BASEV+70
BASFREXT EQU   BASEV+72
BASKLCPY EQU   BASEV+76
BASCOPID EQU   BASKLCPY+11
BASDLMTD EQU   BASEV+92
BASEXPDT EQU   BASEV+96
BASDTREM EQU   BASEV+100
BASDESCR EQU   BASEV+104
BASOWNER EQU   BASEV+134
BASDEST  EQU   BASEV+144
BASRECOV EQU   BASEV+174
BASGROUP EQU   BASEV+180
COPYV    EQU   0
COPNAME  EQU   COPYV
COPSERNO EQU   COPNAME+5
COPID    EQU   COPNAME+11
COPFLAGA EQU   COPYV+14
COPTYPE  EQU   COPFLAGA
COPBKUP  EQU   COPFLAGA+2
COPDLSPF EQU   COPFLAGA+3
COPRCVYF EQU   COPYV+20
COPSATIA EQU   COPRCVYF
COPMISCF EQU   COPRCVYF+2
COPCSN1  EQU   COPYV+24
COPLIB1  EQU   COPYV+36
COPLID1  EQU   COPLIB1
COP1BIT1 EQU   COPLID1
COP1BIT2 EQU   COPLID1
COPCSN2  EQU   COPYV+37
COPLIB2  EQU   COPYV+49
COPLID2  EQU   COPLIB2
COP2BIT1 EQU   COPLID2
COP2BIT2 EQU   COPLID2
COPDTREM EQU   COPYV+54
COPDEST  EQU   COPYV+88
DUPV     EQU   0
DUPNAME  EQU   DUPV
DUPD     EQU   DUPNAME
DUPSERNO EQU   DUPNAME+5
DUPID    EQU   DUPNAME+11
DUPBLANK EQU   DUPID
DUPNO    EQU   DUPID+1
DUPFLAGA EQU   DUPV+14
DUPTYPE  EQU   DUPFLAGA
DUPDUPLR EQU   DUPTYPE
DUPRCVYF EQU   DUPV+20
DUPCSN1  EQU   DUPV+24
DUPLIB1  EQU   DUPV+36
DUPLID1  EQU   DUPLIB1
DUP1BIT1 EQU   DUPLID1
DUP1BIT2 EQU   DUPLID1
DUPCSN2  EQU   DUPV+37
DUPLIB2  EQU   DUPV+49
DUPLID2  EQU   DUPLIB2
DUP2BIT1 EQU   DUPLID2
DUP2BIT2 EQU   DUPLID2
SMSG     EQU   0
CODESM   EQU   SMSG+1
VOLIDSM  EQU   SMSG+8
VFSM     EQU   SMSG+14
CECART   EQU   VFSM
SECVOL   EQU   VFSM
EXCLATTB EQU   VFSM
BINDATTB EQU   VFSM
RONLYATB EQU   VFSM
CSN1SM   EQU   SMSG+24
CSN2SM   EQU   SMSG+36
USMSG    EQU   0
CODEUSM  EQU   USMSG+1
ADDRUSM  EQU   USMSG+2
LUSM     EQU   ADDRUSM
LUSM1    EQU   LUSM
LUSM2    EQU   LUSM
CSN1USM  EQU   USMSG+4
CSN2USM  EQU   USMSG+16
VOLIDUSM EQU   USMSG+28
SEQNUM   EQU   USMSG+34
PTRBCDV  EQU   0
PTRRPLV  EQU   0
PASSBYTE EQU   0
PTRCOPYV EQU   0
SMSGCOPY EQU   SMSG
VOLIDCSM EQU   SMSGCOPY+12
NEWCSN   EQU   SMSGCOPY+20
OLDCSN   EQU   SMSGCOPY+32
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS
@NM00027 EQU   SMSGCOPY+18
@NM00026 EQU   SMSGCOPY+10
EJECTCD  EQU   SMSGCOPY+9
POSTCD   EQU   SMSGCOPY+8
@NM00025 EQU   SMSGCOPY
@NM00028 EQU   USMSG+35
XUSM     EQU   ADDRUSM+1
YUSM     EQU   ADDRUSM
ZUSM     EQU   ADDRUSM
LENUSM   EQU   USMSG
ZSM      EQU   SMSG+23
@NM00024 EQU   SMSG+15
@NM00023 EQU   VFSM
SCRATCH  EQU   VFSM
@NM00022 EQU   VFSM
MSGIDSM  EQU   SMSG+2
LENSM    EQU   SMSG
@NM00021 EQU   DUPV+50
DUPRES4  EQU   DUPLIB2
DUPRES3  EQU   DUPLIB1
DUPMISCF EQU   DUPRCVYF+2
DUPSATIA EQU   DUPRCVYF
@NM00020 EQU   DUPV+18
@NM00019 EQU   DUPFLAGA+2
DUPRES2  EQU   DUPTYPE
DUPRES1  EQU   DUPTYPE
DUPRES5  EQU   DUPV+13
@NM00018 EQU   COPYV+136
COPFREXT EQU   COPYV+132
COPLEXT  EQU   COPYV+130
COPFRESP EQU   COPYV+128
COPOWNER EQU   COPYV+118
COPDESCR EQU   COPYV+58
COPDATE  EQU   COPYV+50
COPRES5  EQU   COPLIB2
COPRES4  EQU   COPLIB1
@NM00017 EQU   COPMISCF
COPHOLD  EQU   COPMISCF
COPRES3  EQU   COPSATIA
COPVSMIS EQU   COPSATIA
COPIVCPY EQU   COPSATIA
COPIVCRE EQU   COPSATIA
@NM00016 EQU   COPYV+18
@NM00015 EQU   COPFLAGA+3
COPRONLY EQU   COPFLAGA+3
COPDAERA EQU   COPFLAGA+2
COPEXCL  EQU   COPFLAGA+2
COPBIND  EQU   COPFLAGA+2
COPRSTD  EQU   COPFLAGA+2
COPGENUS EQU   COPFLAGA+2
COPVSAM  EQU   COPFLAGA+2
COPGROUP EQU   COPFLAGA+2
COPRES2  EQU   COPTYPE
COPCOPYV EQU   COPTYPE
COPRES1  EQU   COPTYPE
COPRES6  EQU   COPYV+13
COPNO    EQU   COPID+1
COPBLANK EQU   COPID
COPV     EQU   COPNAME
@NM00014 EQU   BASEV+192
BASXPDT2 EQU   BASEV+188
BASRES6  EQU   BASEV+89
BASCOPNO EQU   BASCOPID+1
BASCOPBK EQU   BASCOPID
BASCOPSN EQU   BASKLCPY+5
BASCOPV  EQU   BASKLCPY
@NM00013 EQU   BASEV+65
BASRES5  EQU   BASLIB2
BASRES4  EQU   BASLIB1
BASRES3  EQU   BASMISCF
BASHOLD  EQU   BASMISCF
BASRES8  EQU   BASSATIA
BASVSMIS EQU   BASSATIA
BASIVCPY EQU   BASSATIA
BASIVCRE EQU   BASSATIA
BASCPUID EQU   BASEV+18
@NM00012 EQU   BASFLAGA+3
BASNOCPY EQU   BASFLAGA+2
BASRES2  EQU   BASTYPE
BASRES1  EQU   BASTYPE
BASRES7  EQU   BASEV+13
BASZERO  EQU   BASID+1
BASBLANK EQU   BASID
BASEVKEY EQU   BASNAME
BCD2BIT2 EQU   BCDLID2
BCD2BIT1 EQU   BCDLID2
BCDRES8  EQU   BCDLIB2
BCD1BIT2 EQU   BCDLID1
BCD1BIT1 EQU   BCDLID1
BCDRE10  EQU   BCDLIB1
BCDRES7A EQU   BCDMISCF
BCDHOLD  EQU   BCDMISCF
BCDRES7  EQU   BCDSATIA
BCDVSMIS EQU   BCDSATIA
BCDIVCPY EQU   BCDSATIA
BCDIVCRE EQU   BCDSATIA
BCDCPUID EQU   BCDV+18
BCDRES5  EQU   BCDFLAGB+1
BCDREASS EQU   BCDFLAGB+1
BCDRES4  EQU   BCDFLAGB
BCDRES3  EQU   BCDTYPE
BCDDUP   EQU   BCDTYPE
BCDRES2  EQU   BCDTYPE
BCDCOPY  EQU   BCDTYPE
BCDBASE  EQU   BCDTYPE
BCDRES1  EQU   BCDTYPE
BCDRES9  EQU   BCDV+13
BCDINDEX EQU   BCDID+1
BCDBLNK2 EQU   BCDID
BCDSERNO EQU   BCDNAME+5
BCDBLNK1 EQU   BCDPREFX+1
BCDALPHA EQU   BCDPREFX
@NM00011 EQU   GROUP+136
GROADDR  EQU   GROUP+106
GROOWNER EQU   GROUP+96
GRORESSP EQU   GROUP+95
GROCONUS EQU   GROUP+94
GRODESCR EQU   GROUP+64
GROERRTM EQU   GROERRTS+4
GROERRDT EQU   GROERRTS
GRORETPD EQU   GROUP+52
GROFREXT EQU   GROUP+48
GROFRESP EQU   GROUP+44
GROSTRSH EQU   GROUP+40
GROSSPD  EQU   GROUP+38
GROPSPD  EQU   GROUP+36
GROPCENT EQU   GROUP+29
GROLSN   EQU   GROUP+23
GROFSN   EQU   GROUP+17
@NM00010 EQU   GROFLAGA+2
GROMSG1  EQU   GROFLAGA+2
GRORETN  EQU   GROFLAGA+2
GRORLSE  EQU   GROFLAGA+2
GRORONLY EQU   GROFLAGA+2
GRODAERA EQU   GROFLAGA+2
GROEXCL  EQU   GROFLAGA+2
GROBIND  EQU   GROFLAGA+2
GRORES1  EQU   GROTYPE
GROGVR   EQU   GROTYPE
GROZERO  EQU   GROID+1
GROBLANK EQU   GROID
GROVVGRP EQU   GRONAME+3
GROG     EQU   GRONAME
@NM00009 EQU   INDEX+28
INDBLNK2 EQU   INDRECID
INDBLNK1 EQU   INDPREFX+1
INDRES2  EQU   INDTYPE
INDRES1  EQU   INDTYPE
@NM00008 EQU   MESCODE+1
MESOPCD  EQU   MESCODE
MESLNGTH EQU   MESG
@NM00007 EQU   RPLVSAM+44
@NM00006 EQU   RPLVOPT
@NM00005 EQU   RPLVOPT
RPLVNEXT EQU   RPLVOPT
@NM00004 EQU   RPLVSAM+28
RPLVACB  EQU   RPLVSAM+24
@NM00003 EQU   RPLVSAM+3
@NM00002 EQU   RPLVSAM
@NM00001 EQU   RPLV+42
RPLVDATE EQU   RPLV+38
RPLRMSCC EQU   RPLV+36
RPLVTLEN EQU   RPLV+30
RPLVRES1 EQU   RPLFLAGA+1
RPLVJRNL EQU   RPLFLAGA
RPLJRCVY EQU   RPLFLAGA
RPLVVOP  EQU   RPLFLAGA
RPLVVIN  EQU   RPLFLAGA
RPLVCOMP EQU   RPLFLAGA
RPLVPROG EQU   RPLFLAGA
RPLVPOST EQU   RPLFLAGA
RPLFTIME EQU   RPLFLAGA
RPLVRSV3 EQU   RPLV+24
RPLVRSV2 EQU   RPLV+20
RPLVRSV1 EQU   RPLV+16
RPLASCBP EQU   RPLTCBPR
RPLVECB  EQU   RPLV+4
RPLVQPTR EQU   RPLV
VVIUNUSD EQU   VVICB+116
VVINUSDC EQU   VVICB+112
VVITPFCH EQU   VVICB+108
VVIDVMEL EQU   VVICB+104
VVIVBSTF EQU   VVICB+100
VVISSOBA EQU   VVICB+96
VVIVSCRA EQU   VVICB+92
VVISTPTB EQU   VVICB+88
VVIDVMTA EQU   VVICB+84
VVIJUCB  EQU   VVICB+80
VVIIUCB  EQU   VVICB+76
VVIRES6  EQU   VVICB+72
VVIRES5  EQU   VVICB+68
VVIRES4  EQU   VVICB+64
VVIUCB   EQU   VVICB+60
VVIVJL   EQU   VVICB+56
VVIVRR   EQU   VVICB+52
VVIQLSPL EQU   VVICB+48
VVIQRPL2 EQU   VVICB+44
VVIQRPL1 EQU   VVICB+40
VVIRES3  EQU   VVICB+36
VVIVQMP  EQU   VVICB+32
VVIECB1  EQU   VVICB+28
VVICATAD EQU   VVICB+24
VVIDCBAD EQU   VVICB+20
VVIACBAD EQU   VVICB+16
VVIFLG7  EQU   VVIFLGA
VVIFLG6  EQU   VVIFLGA
VVIFLG5  EQU   VVIFLGA
VVIFLG4  EQU   VVIFLGA
VVIFLG3  EQU   VVIFLGA
VVIFLG2  EQU   VVIFLGA
VVIFLG1  EQU   VVIFLGA
VVIALCON EQU   VVICB+14
VVICPUID EQU   VVICB+12
VVIUCAT  EQU   VVICB+4
VVICID   EQU   VVICB
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS
@RT00135 EQU   @EL00001
@RT00142 EQU   @EL00001
@RF00153 EQU   @EL00001
@RF00207 EQU   @EL00003
@RF00256 EQU   @EL00005
@RF00357 EQU   @EL00007
@RF00444 EQU   @EL00008
@RF00579 EQU   @EL00011
@RF00651 EQU   @EL00012
@RF00711 EQU   @EL00013
@RF00728 EQU   @EL00013
@RF00764 EQU   @EL00014
@RF00781 EQU   @EL00014
@RF00832 EQU   @EL00015
@RF00911 EQU   @EL00016
@RF00975 EQU   @EL00017
@RF00992 EQU   @EL00017
@RF01028 EQU   @EL00018
@RF01045 EQU   @EL00018
@RF01096 EQU   @EL00019
@RF01175 EQU   @EL00020
@RF01239 EQU   @EL00021
@RF01256 EQU   @EL00021
@RF01292 EQU   @EL00022
@RF01309 EQU   @EL00022
@RF01355 EQU   @RC01347
@RF01450 EQU   @RC01442
@RF01491 EQU   @EL00026
@RT01529 EQU   @EL00027
@RT01542 EQU   @EL00027
@RT01544 EQU   @EL00027
@RT01552 EQU   @EL00027
@RT01581 EQU   @EL00028
@RT01588 EQU   @EL00028
@RT01605 EQU   @EL00028
@RT01615 EQU   @EL00028
@RT01634 EQU   @EL00029
@RT01642 EQU   @EL00029
@RT01646 EQU   @EL00029
@RT01661 EQU   @EL00029
@RT01671 EQU   @EL00029
@RT01700 EQU   @EL00030
@RT01729 EQU   @EL00030
@RT01748 EQU   @EL00031
@RT01769 EQU   @EL00031
@RF01754 EQU   @EL00031
@RT01792 EQU   @EL00032
@RT01803 EQU   @EL00032
@RT01818 EQU   @EL00032
@RT01827 EQU   @EL00032
@RT01831 EQU   @EL00032
@RT01844 EQU   @EL00032
@RT01859 EQU   @EL00032
@RT01869 EQU   @EL00032
@RT01892 EQU   @EL00033
@RT01902 EQU   @EL00033
@RT01915 EQU   @EL00033
@RT01921 EQU   @EL00033
@RT01928 EQU   @EL00033
@RT01946 EQU   @EL00033
@RF01949 EQU   @EL00033
@RT01961 EQU   @EL00033
@RT01965 EQU   @EL00033
@RT01975 EQU   @EL00033
@ENDDATA EQU   *
         END   ICBVMS00,(C'PLS1923',0603,76348)

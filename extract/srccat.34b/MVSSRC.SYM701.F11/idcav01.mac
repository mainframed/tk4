         TITLE '*************** IDCAV01: ADDV FUNCTION SUPPORT ROUTINE *
                ********'
        MACRO
        GETMAIN &R,&LV=
        L     REG15,0(REG1)           GDTTBL ADDRESS
        L     REG15,GDTPRL(REG15)     PROL ROUTINE ADDRESS
        CNOP  2,4                     BOUNDARY ALIGNMENT
        LA    REG14,*+14              RETURN ADDRESS
        BALR  REG1,REG15              LINKAGE TO PROL ROUTINE
        DC    A(MODID)                MODULE ID ADDRESS
        DC    A(@SIZDATD)             AUTOMATIC STORAGE SIZE ADDRESS
        MEND
IDCAV01  CSECT ,                                                   0002
@MAINENT DS    0H                                                  0002
         USING *,@15                                               0002
         B     @PROLOG                                             0002
         DC    AL1(16)                                             0002
         DC    C'IDCAV01   77.067'                                 0002
         DROP  @15
@PROLOG  STM   @14,@12,12(@13)                                     0002
         BALR  @08,0                                               0002
@PSTART  LA    @09,4095(,@08)                                      0002
         LA    @10,4095(,@09)                                      0002
         LA    @12,4095(,@10)                                      0002
         USING @PSTART,@08                                         0002
         USING @PSTART+4095,@09                                    0002
         USING @PSTART+8190,@10                                    0002
         USING @PSTART+12285,@12                                   0002
         L     @00,@SIZDATD                                        0002
         GETMAIN  R,LV=(0)
         LR    @11,@01                                             0002
         USING @DATD,@11                                           0002
         ST    @13,@SA00001+4                                      0002
         LM    @00,@01,20(@13)                                     0002
         ST    @11,8(,@13)                                         0002
         LR    @13,@11                                             0002
         MVC   @PC00001(12),0(@01)                                 0002
*   OLDERID2=NEWERID2;                                             0327
         L     @15,@PC00001                                        0327
         L     @14,GDTTR2(,@15)                                    0327
         MVC   @TS00001(95),NEWERID2(@14)                          0327
         MVC   OLDERID2(95,@14),@TS00001                           0327
*   NEWID2='AV01';                  /*                       #Y30LB31*/
*                                                                  0328
         MVC   NEWID2(4,@14),@CC01587                              0328
*   /*****************************************************************/
*   /*                                                               */
*   /* TAKE A FULL REGION DUMP UPON ENTRY TO MODULE          #Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0329
*   IF GDTDBG=NULLPTR THEN                                         0329
         L     @15,GDTDBG(,@15)                                    0329
         LTR   @15,@15                                             0329
         BZ    @RT00329                                            0329
*     ;                                                            0330
*   ELSE                                                           0331
*     CALL IDCDB010(GDTTBL,'AVBG'); /*                       #Y30LB31*/
*                                                                  0331
         L     @15,@PC00001                                        0331
         ST    @15,@AL00001                                        0331
         LA    @14,@CC01764                                        0331
         ST    @14,@AL00001+4                                      0331
         MVI   @AL00001+4,X'80'                                    0331
         L     @15,GDTDBG(,@15)                                    0331
         LA    @01,@AL00001                                        0331
         BALR  @14,@15                                             0331
*   /*****************************************************************/
*   /*                                                               */
*   /* SETUP ADDRESSABILITY TO THE ARGUMENT LISTS            #Y30LB31*/
*   /* CONSTRUCTED BY ADDV. IF APPROPRIATE, ZERO OUT THESE LISTS AND */
*   /* INITIALIZE THE HEADERS USED FOR DEBUGGING.            #Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0332
*   ADDVTBL=''B;                    /* ZERO INTERNAL TABLE   #Y30LB31*/
@RT00329 XC    ADDVTBL(59),ADDVTBL                                 0332
*   ADDVHDR='ADDVTBL';              /* SET ADDV TABLE ID     #Y30LB31*/
         MVI   ADDVHDR+7,C' '                                      0333
         MVC   ADDVHDR(7),@CC01766                                 0333
*   MSVIVOL#=VOLVAL;                /*                       #Y30LB31*/
         L     @03,@PC00001+4                                      0334
         L     @03,FDTPTR(,@03)                                    0334
         MVC   MSVIVOL#(6),VOLVAL(@03)                             0334
*   DDSTRU=ADDR(PRINTTBL);          /* PRINT ARGUMENT LIST   #Y30LB31*/
         LA    @15,PRINTTBL                                        0335
         ST    @15,DDSTRU                                          0335
*   PRINTTBL=''B;                   /* ZERO PRINT ARG LIST   #Y30LB31*/
         XC    PRINTTBL(28),PRINTTBL                               0336
*   PRINTHDR='DARGLIST';            /* PRINT ARG LIST ID     #Y30LB31*/
         MVC   PRINTHDR(8),@CC01767                                0337
*   VOLBUF=''B;                     /* ZERO OUT BUFFER       @Y30LB31*/
         XC    VOLBUF(232),VOLBUF                                  0338
*   VOLHDR='VOLREC';                /* VOL REC BUFFER ID     @Y30LB31*/
         MVI   VOLHDR+6,C' '                                       0339
         MVI   VOLHDR+7,C' '                                       0339
         MVC   VOLHDR(6),@CC01768                                  0339
*   BASEVPTR=ADDR(VOLREC);          /* BASE VOL REC FORMAT   @Y30LB31*/
         LA    @15,VOLREC                                          0340
         LR    BASEVPTR,@15                                        0340
*   COPYVPTR=ADDR(VOLREC);          /* COPY VOL REC FORMAT   @Y30LB31*/
         ST    @15,COPYVPTR                                        0341
*   DUPVPTR=ADDR(VOLREC);           /* DUPLICATE REC FORMAT  @Y30LB31*/
         LR    DUPVPTR,@15                                         0342
*   BCDVPTR=ADDR(VOLREC);           /* COMMON REC FIELDS MAP @Y30LB31*/
         LR    BCDVPTR,@15                                         0343
*   TEMPBUFF=''B;                   /* ZERO TEMPBUFF         @ZDR2054*/
         XC    TEMPBUFF(232),TEMPBUFF                              0344
*   TEMPHDR='REPVOL';               /* REPLACE VOLUME        @ZDR2054*/
         MVI   TEMPHDR+6,C' '                                      0345
         MVI   TEMPHDR+7,C' '                                      0345
         MVC   TEMPHDR(6),@CC01769                                 0345
*   TEMPPTR=ADDR(TEMPBUF);          /* TEMP COPY VOL BUF     @ZDR2054*/
         LA    TEMPPTR,TEMPBUF                                     0346
*   GRPBUF=''B;                     /* ZERO OUT GROUP BUFFER @Y30LB31*/
         XC    GRPBUF(172),GRPBUF                                  0347
*   GRPHDR='GROUPREC';              /* GROUP REC BUFFER ID   @Y30LB31*/
         MVC   GRPHDR(8),@CC01770                                  0348
*   GROUPPTR=ADDR(GRPREC);          /* GROUP REC FORMATTER   @Y30LB31*/
         LA    @02,GRPREC                                          0349
         ST    @02,GROUPPTR                                        0349
*   AV01DEFV=''B;                   /* ZERO DEF TBL + EXTS   #Y30LB31*/
         XC    AV01DEFV(212),AV01DEFV                              0350
*   AVDEFVID='DEFLIST';             /* DEFINE TBL IDENTIFIER #Y30LB31*/
         MVI   AVDEFVID+7,C' '                                     0351
         MVC   AVDEFVID(7),@CC01771                                0351
*   DEFVPTR=ADDR(AVDEFV);           /* MSSC DEFINE ARG LIST  @Y30LB31*/
         LA    @02,AVDEFV                                          0352
         ST    @02,DEFVPTR                                         0352
*   AVDVEID='DEFVE';                /* DEF TBL EXTENSIONS ID @Y30LB31*/
         MVI   AVDVEID+5,C' '                                      0353
         MVC   AVDVEID+6(2),AVDVEID+5                              0353
         MVC   AVDVEID(5),@CC01772                                 0353
*   DEFVEPTR=ADDR(AVDEFVE);         /* MSVC DEFINE ARG LIST  @Y30LB31*/
         LA    @02,AVDEFVE                                         0354
         ST    @02,DEFVEPTR                                        0354
*   AVALLAGL=''B;                   /* ZERO OUT ALLAGL       #Y30LB31*/
         XC    AVALLAGL(39),AVALLAGL                               0355
*   AVALLID='ALLAGL';               /* ARG LIST IDENTIFIER   @Y30LB31*/
         MVI   AVALLID+6,C' '                                      0356
         MVI   AVALLID+7,C' '                                      0356
         MVC   AVALLID(6),@CC01773                                 0356
*   RESPECIFY                                                      0357
*     ALLAGL BASED(ADDR(AVALLTBL)); /*                       #Y30LB31*/
*   AVMDAGL=''B;                    /* ZERO OUT MDAGL        #Y30LB31*/
         XC    AVMDAGL(37),AVMDAGL                                 0358
*   RESPECIFY                                                      0359
*     MDAGL BASED(ADDR(AVMDAGL));   /*                       @Y30LB31*/
*   AVVS1AGL=''B;                   /*                       #Y30LB31*/
         XC    AVVS1AGL(74),AVVS1AGL                               0360
*   RESPECIFY                                                      0361
*     VS1AGL BASED(ADDR(AVVS1AGL)); /*                       #Y30LB31*/
*   RFY                                                            0362
*     EXCLAGL BASED(ADDR(AVEXCLST));/*                       @YD00175*/
*                                                                  0363
*   /*****************************************************************/
*   /*                                                               */
*   /* ENQUEUE ON THE VOLUME SERIAL NO. TO INSURE THE VOLUME #Y30LB31*/
*   /* RECORD IS NOT UPDATED DURING ADDV PROCESSING.         #Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0363
*   RNMLEN=LENGTH(RNAME);           /*                       #Y30LB31*/
         MVI   RNMLEN,X'16'                                        0363
*   RNMTRAIL=ENQUEUE;               /*                       @ZA05119*/
         MVC   RNMTRAIL(16),ENQUEUE                                0364
*   RNMSERNO=VOLVAL;                /*                       #Y30LB31*/
         MVC   RNMSERNO(6),VOLVAL(@03)                             0365
*   CALL IDCSANQ0(GDTTBL,EXCL,WAIT,MAJORNM,MINORNM);/*       #Y30LB31*/
*                                                                  0366
         MVC   @AL00001+4(12),@AL00366                             0366
         L     @15,@PC00001                                        0366
         ST    @15,@AL00001                                        0366
         LA    @14,MINORNM                                         0366
         ST    @14,@AL00001+16                                     0366
         MVI   @AL00001+16,X'80'                                   0366
         L     @15,GDTENQ(,@15)                                    0366
         LA    @01,@AL00001                                        0366
         BALR  @14,@15                                             0366
*   /*****************************************************************/
*   /*                                                               */
*   /* CHECK OUT THE VOLUME TO BE ACTIVATED.                 #Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0367
*   CALL SETUPRTN;                  /*                       #Y30LB31*/
         BAL   @14,SETUPRTN                                        0367
*   RESPECIFY                                                      0368
*     RTNREG RSTD;                                                 0368
*   TESTRC=RTNREG;                                                 0369
         LR    TESTRC,RTNREG                                       0369
*   RESPECIFY                                                      0370
*     RTNREG UNRSTD;                /*                       #Y30LB31*/
*   IF TESTRC^=0 THEN               /*                       #Y30LB31*/
         LTR   TESTRC,TESTRC                                       0371
         BZ    @RF00371                                            0371
*     LASTCOND=LASTCC12;            /*                       #Y30LB31*/
*                                                                  0372
         L     @02,@PC00001+8                                      0372
         MVC   LASTCOND(2,@02),@CH00606                            0372
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCEED WITH ACTIVATE REQUEST IF NO CONFLICTS EXIST.  @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0373
*   IF LASTCOND=0 THEN              /*                       #Y30LB31*/
@RF00371 SLR   @02,@02                                             0373
         L     @15,@PC00001+8                                      0373
         CH    @02,LASTCOND(,@15)                                  0373
         BNE   @RF00373                                            0373
*     IF BCDBASE=ON×ADDR(RVOL)^=NULLPTR THEN/*               @ZDR2054*/
*                                                                  0374
         TM    BCDBASE(BCDVPTR),B'00100000'                        0374
         BO    @RT00374                                            0374
         L     @15,@PC00001+4                                      0374
         C     @02,FDTPTR+36(,@15)                                 0374
         BE    @RF00374                                            0374
@RT00374 DS    0H                                                  0375
*       /*************************************************************/
*       /*                                                           */
*       /* ACTIVATE A UNIQUE BASE VOLUME                     @ZDR2054*/
*       /* OR REPLACE A BASE WITH A COPY VOLUME.             @ZDR2054*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0375
*       DO;                         /*                       #Y30LB31*/
*         CALL UNIQVRTN;            /*                       #Y30LB31*/
         BAL   @14,UNIQVRTN                                        0376
*         RESPECIFY                                                0377
*           RTNREG RSTD;                                           0377
*         TESTRC=RTNREG;                                           0378
         LR    TESTRC,RTNREG                                       0378
*         RESPECIFY                                                0379
*           RTNREG UNRSTD;          /*                       #Y30LB31*/
*         LASTCOND=MAX(LASTCOND,TESTRC);/*                   #Y30LB31*/
         L     @02,@PC00001+8                                      0380
         LH    @15,LASTCOND(,@02)                                  0380
         CR    @15,TESTRC                                          0380
         BNL   *+6
         LR    @15,TESTRC                                          0380
         STH   @15,LASTCOND(,@02)                                  0380
*       END;                        /*                       #Y30LB31*/
*                                                                  0381
*   /*****************************************************************/
*   /*                                                               */
*   /* ACTIVATE A COPY OR DUPLICATE VOLUME.                  #Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0382
*     ELSE                          /*                               */
*       DO;                                                        0382
         B     @RC00374                                            0382
@RF00374 DS    0H                                                  0383
*         CALL DUPVRTN;                                            0383
         BAL   @14,DUPVRTN                                         0383
*         RESPECIFY                                                0384
*           RTNREG RSTD;                                           0384
*         TESTRC=RTNREG;                                           0385
         LR    TESTRC,RTNREG                                       0385
*         RESPECIFY                                                0386
*           RTNREG UNRSTD;                                         0386
*         LASTCOND=MAX(LASTCOND,TESTRC);                           0387
         L     @02,@PC00001+8                                      0387
         LH    @15,LASTCOND(,@02)                                  0387
         CR    @15,TESTRC                                          0387
         BNL   *+6
         LR    @15,TESTRC                                          0387
         STH   @15,LASTCOND(,@02)                                  0387
*       END;                                                       0388
*                                                                  0388
*   /*****************************************************************/
*   /*                                                               */
*   /* IF A UNIT WAS DYNAMICALLY ALLOCATED DURING            #Y30LB31*/
*   /* PROCESSING, DEALLOCATE IT.                            #Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0389
*   IF ALLOCFLG=ON THEN             /*                       #Y30LB31*/
@RC00374 DS    0H                                                  0389
@RF00373 TM    ALLOCFLG,B'00000100'                                0389
         BNO   @RF00389                                            0389
*     DO;                           /*                       #Y30LB31*/
*       CALL IDCSADL0(GDTTBL,ALLAGL);/*                      #Y30LB31*/
         L     @02,@PC00001                                        0391
         ST    @02,@AL00001                                        0391
         LA    @15,AVALLTBL                                        0391
         ST    @15,@AL00001+4                                      0391
         MVI   @AL00001+4,X'80'                                    0391
         L     @15,GDTDLC(,@02)                                    0391
         LA    @01,@AL00001                                        0391
         BALR  @14,@15                                             0391
*       RESPECIFY                                                  0392
*         RTNREG RSTD;                                             0392
*       TESTRC=RTNREG;                                             0393
         LR    TESTRC,RTNREG                                       0393
*       RESPECIFY                                                  0394
*         RTNREG UNRSTD;            /*                       #Y30LB31*/
*                                                                  0394
*       /*************************************************************/
*       /*                                                           */
*       /* UPDATE THE FINAL CONDITION CODE ONLY IF UDEALLOC  #Y30LB31*/
*       /* RETURN CODE IS HIGHER. IF UDEALLOC FAILED, ITS RET CODE   */
*       /*                                                   #Y30LB31*/
*       /* IS 4.                                             #Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0395
*       LASTCOND=MAX(LASTCOND,TESTRC);/*                     #Y30LB31*/
         L     @02,@PC00001+8                                      0395
         LH    @15,LASTCOND(,@02)                                  0395
         CR    @15,TESTRC                                          0395
         BNL   *+6
         LR    @15,TESTRC                                          0395
         STH   @15,LASTCOND(,@02)                                  0395
*     END;                          /*                       #Y30LB31*/
*                                                                  0396
*   /*****************************************************************/
*   /*                                                               */
*   /* IF A MINOR ERROR OCCURRED DURING PROCESSING BUT THE   #Y30LB31*/
*   /* VOLUME WAS SUCESSFULLY ACTIVATED AND RELABELED, INSURE THE    */
*   /*                                                       #Y30LB31*/
*   /* FINAL CONDITION CODE IS AT LEAST 4.                   #Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0397
*   IF CC04FLG=ON THEN              /*                       #Y30LB31*/
@RF00389 TM    CC04FLG,B'10000000'                                 0397
         BNO   @RF00397                                            0397
*     LASTCOND=MAX(LASTCOND,LASTCC04);/*                     #Y30LB31*/
*                                                                  0398
         L     @15,@PC00001+8                                      0398
         LH    @14,LASTCOND(,@15)                                  0398
         LA    @07,4                                               0398
         CR    @14,@07                                             0398
         BNL   *+6
         LR    @14,@07                                             0398
         STH   @14,LASTCOND(,@15)                                  0398
*   /*****************************************************************/
*   /*                                                               */
*   /* RELEASE THE ENQUEUE ESTABLISHED AT THE START OF THE   @Y30LB31*/
*   /* PROGRAM.                                              #Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0399
*   RNMSERNO=VOLVAL;                /*                       #Y30LB31*/
@RF00397 L     @15,@PC00001+4                                      0399
         L     @01,FDTPTR(,@15)                                    0399
         MVC   RNMSERNO(6),VOLVAL(@01)                             0399
*   RNMTRAIL=ENQUEUE;               /*                       @ZA05119*/
         MVC   RNMTRAIL(16),ENQUEUE                                0400
*   CALL IDCSADQ0(GDTTBL,MAJORNM,MINORNM);/*                 #Y30LB31*/
*                                                                  0401
         L     @15,@PC00001                                        0401
         ST    @15,@AL00001                                        0401
         LA    @14,@CC01635                                        0401
         ST    @14,@AL00001+4                                      0401
         LA    @14,MINORNM                                         0401
         ST    @14,@AL00001+8                                      0401
         MVI   @AL00001+8,X'80'                                    0401
         L     @15,GDTDEQ(,@15)                                    0401
         LA    @01,@AL00001                                        0401
         BALR  @14,@15                                             0401
*   /*****************************************************************/
*   /*                                                               */
*   /* ISSUE APPROPRIATE EOJ MESSAGE                         @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0402
*   PRINTTBL=''B;                   /*                       @Y30LB31*/
         XC    PRINTTBL(28),PRINTTBL                               0402
*   DARGSMOD=UNIVMSGS;              /*                       @Y30LB31*/
         L     @15,DDSTRU                                          0403
         MVC   DARGSMOD(3,@15),@CC01732                            0403
*   DARGDBP=ADDR(LASTCOND);         /*                       @Y30LB31*/
         L     @14,@PC00001+8                                      0404
         ST    @14,DARGDBP(,@15)                                   0404
*   DARGILP=LENGTH(LASTCOND);       /*                       @Y30LB31*/
         MVC   DARGILP(2,@15),@CH00156                             0405
*   IF LASTCOND>LASTCC08 THEN       /*                       @Y30LB31*/
         LH    @14,LASTCOND(,@14)                                  0406
         C     @14,@CF00182                                        0406
         BNH   @RF00406                                            0406
*     DARGSENT=MSG3003I;            /*                       @Y30LB31*/
         MVI   DARGSENT(@15),X'03'                                 0407
*   ELSE                            /*                       @Y30LB31*/
*     DARGSENT=MSG0001I;            /*                       @Y30LB31*/
         B     @RC00406                                            0408
@RF00406 L     @01,DDSTRU                                          0408
         MVI   DARGSENT(@01),X'01'                                 0408
*   CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*                  @Y30LB31*/
@RC00406 L     @15,@PC00001                                        0409
         ST    @15,@AL00001                                        0409
         LA    @14,@CF00117                                        0409
         ST    @14,@AL00001+4                                      0409
         LA    @14,DDSTRU                                          0409
         ST    @14,@AL00001+8                                      0409
         MVI   @AL00001+8,X'80'                                    0409
         L     @15,GDTPRT(,@15)                                    0409
         LA    @01,@AL00001                                        0409
         BALR  @14,@15                                             0409
*                                                                  0410
*   /*****************************************************************/
*   /*                                                               */
*   /* TAKE A FULL REGION DUMP UPON EXIT FROM MODULE.        @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0410
*   IF GDTDBG=NULLPTR THEN                                         0410
         L     @15,@PC00001                                        0410
         L     @15,GDTDBG(,@15)                                    0410
         LTR   @15,@15                                             0410
         BZ    @RT00410                                            0410
*     ;                                                            0411
*   ELSE                                                           0412
*     CALL IDCDB010(GDTTBL,'AVND'); /*                       @Y30LB31*/
*                                                                  0412
         L     @15,@PC00001                                        0412
         ST    @15,@AL00001                                        0412
         LA    @14,@CC01785                                        0412
         ST    @14,@AL00001+4                                      0412
         MVI   @AL00001+4,X'80'                                    0412
         L     @15,GDTDBG(,@15)                                    0412
         LA    @01,@AL00001                                        0412
         BALR  @14,@15                                             0412
*   /*****************************************************************/
*   /*                                                               */
*   /* RETURN TO THE AMS EXECUTIVE, PASSING THE FINAL COND   @Y30LB31*/
*   /* CODE FROM ADDV.                                       @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0413
*   CALL IDCSAEP0(GDTTBL,MODID,LASTCOND);                          0413
*                                                                  0413
@RT00410 L     @15,@PC00001                                        0413
         ST    @15,@AL00001                                        0413
         LA    @14,MODID                                           0413
         ST    @14,@AL00001+4                                      0413
         L     @14,@PC00001+8                                      0413
         ST    @14,@AL00001+8                                      0413
         MVI   @AL00001+8,X'80'                                    0413
         L     @15,GDTEPL(,@15)                                    0413
         LA    @01,@AL00001                                        0413
         BALR  @14,@15                                             0413
*   /*****************************************************************/
*   /*                                                               */
*   /*                                                       @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0414
*                                                                  0414
*/********************************************************** @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* PROCEDURE NAME - SETUPRTN                                @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* FUNCTION - DIRECTS THE CHECKOUT OF USER SPECIFICATIONS   @Y30LB31*/
*/*            FROM THE COMMAND STATEMENT AGAINST THE        @Y30LB31*/
*/*            PRESENT STATUS OF THE VOL BEING ACTIVATED.    @Y30LB31*/
*/*            CALLS VTYPERTN TO DETERMINE WHETHER A BASE,   @Y30LB31*/
*/*            COPY, OR DUPLICATE VOLUME IS BEING ACTIVATD.  @Y30LB31*/
*/*            CALLS RWCKRTN TO CHECK FOR A READONLY OR      @Y30LB31*/
*/*            READWRITE CONFLICT IF THE VOLUME SERIAL NO.   @Y30LB31*/
*/*            IS TO BE CHANGED.  CALLS ALLOCRTN TO CHECK    @Y30LB31*/
*/*            OUT THE UNIT REQUIREMENTS.  MSG IDC3092I   @Y30LB31   */
*/*            IS ISSUED IF FILE PARM IS REQUIRED.           @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* INPUT - FDTTBL, PRINTTBL FOR MESSAGES                    @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* OUTPUT - RETURN CODE OF 0 INDICATES SUCCESSFUL VOLUME    @Y30LB31*/
*/*          CHECKOUT.                                       @Y30LB31*/
*/*          RETURN CODE OF 4 IF CHECKOUT FAILED AND VOLUME  @Y30LB31*/
*/*          CANNOT BE ACTIVATED.                            @Y30LB31*/
*/*                                                          @Y30LB31*/
*/********************************************************** @Y30LB31*/
*                                                                  0414
*SETUPRTN:                                                         0414
*   PROCEDURE OPTIONS(NOSAVEAREA,NOSAVE);/*                  @Y30LB31*/
*                                                                  0414
@EL00001 L     @13,4(,@13)                                         0414
@EF00001 L     @00,@SIZDATD                                        0414
         LR    @01,@11                                             0414
         FREEMAIN R,LV=(0),A=(1)
@ER00001 LM    @14,@12,12(@13)                                     0414
         BR    @14                                                 0414
SETUPRTN DS    0H                                                  0415
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL CONDITION CODE.                                 @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0415
*   DCL                                                            0415
*     SETUPRC FIXED(15);            /*                       @Y30LB31*/
*                                                                  0415
*   /*****************************************************************/
*   /*                                                               */
*   /* SAVE THE RETURN ADDRESS OF CALLER SINCE THERE IS NO   @Y30LB31*/
*   /* SAVEAREA. REG 14 WILL BE RESTORED UPON EXIT.          @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0416
*   RESPECIFY                                                      0416
*     REG14 RSTD;                   /*                       @ZDR2054*/
*   RETADDR1=REG14;                 /*                       @Y30LB31*/
         ST    REG14,RETADDR1                                      0417
*   RESPECIFY                                                      0418
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   OLDERID2=NEWERID2;                                             0419
         L     @15,@PC00001                                        0419
         L     @15,GDTTR2(,@15)                                    0419
         MVC   @TS00001(95),NEWERID2(@15)                          0419
         MVC   OLDERID2(95,@15),@TS00001                           0419
*   NEWID2='AVUP';                  /*                       @Y30LB31*/
*                                                                  0420
         MVC   NEWID2(4,@15),@CC01790                              0420
*   /*****************************************************************/
*   /*                                                               */
*   /* INITIALIZE TO ZERO THE CONDITION CODE USED WITHIN     @Y30LB31*/
*   /* THIS PROCEDURE.                                       @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0421
*   SETUPRC=LASTCC00;               /*                       @Y30LB31*/
*                                                                  0421
         SLR   @15,@15                                             0421
         STH   @15,SETUPRC                                         0421
*   /*****************************************************************/
*   /*                                                               */
*   /* CALL VTYPERTN TO DETERMINE THE TYPE OF VOLUME BEING   @Y30LB31*/
*   /* ACTIVATED AND WHETHER IT CAN BE ACTIVATED.            @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0422
*   CALL VTYPERTN;                  /*                       @Y30LB31*/
         BAL   @14,VTYPERTN                                        0422
*   RESPECIFY                                                      0423
*     RTNREG RSTD;                                                 0423
*   TESTRC=RTNREG;                                                 0424
         LR    TESTRC,RTNREG                                       0424
*   RESPECIFY                                                      0425
*     RTNREG UNRSTD;                /*                       @Y30LB31*/
*                                                                  0425
*   /*****************************************************************/
*   /*                                                               */
*   /* TEST RETURN CODE FROM VTYPERTN. IF THE VOLUME CHECK   @Y30LB31*/
*   /* OUT FAILED, UPDATE THE CONDITION AND EXIT FROM THIS PROC.     */
*   /*                                                       @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0426
*   IF TESTRC^=0 THEN               /*                       @Y30LB31*/
         LTR   TESTRC,TESTRC                                       0426
         BZ    @RF00426                                            0426
*     SETUPRC=4;                    /*                       @Y30LB31*/
*                                                                  0427
         MVC   SETUPRC(2),@CH00043                                 0427
*   /*****************************************************************/
*   /*                                                               */
*   /* NEXT, CHECK FOR A READONLY - READWRITE CONFLICT IF    @Y30LB31*/
*   /* THE VOLUME SERIAL NO. IS TO BE CHANGED.               @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0428
*   ELSE                            /*                       @Y30LB31*/
*     DO;                           /*                       @Y30LB31*/
         B     @RC00426                                            0428
@RF00426 DS    0H                                                  0429
*       IF ADDR(NSER)^=NULLPTR THEN /*                       @Y30LB31*/
         L     @15,@PC00001+4                                      0429
         L     @15,FDTPTR+20(,@15)                                 0429
         LTR   @15,@15                                             0429
         BZ    @RF00429                                            0429
*         DO;                       /*                       @Y30LB31*/
*           CALL RWCKRTN;           /*                       @Y30LB31*/
         BAL   @14,RWCKRTN                                         0431
*           RESPECIFY                                              0432
*             RTNREG RSTD;                                         0432
*           TESTRC=RTNREG;                                         0433
         LR    TESTRC,RTNREG                                       0433
*           RESPECIFY                                              0434
*             RTNREG UNRSTD;        /*                       @Y30LB31*/
*                                                                  0434
*           /*********************************************************/
*           /*                                                       */
*           /* TEST RETURN CODE FROM RWCKRTN. IF THE VOLUME  @Y30LB31*/
*           /* ATTRIBUTE CHECKOUT FAILED, UPDATE THE CONDITION CODE  */
*           /* BUT CONTINUE CHECKING FOR ERRORS.             @Y30LB31*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  0435
*           IF TESTRC^=0 THEN       /*                       @Y30LB31*/
         LTR   TESTRC,TESTRC                                       0435
         BZ    @RF00435                                            0435
*             SETUPRC=4;            /*                       @Y30LB31*/
         MVC   SETUPRC(2),@CH00043                                 0436
*         END;                      /*                       @Y30LB31*/
*                                                                  0437
@RF00435 DS    0H                                                  0438
*       /*************************************************************/
*       /*                                                           */
*       /* FINALLY, CHECK OUT THE UNIT REQUIREMENTS NEEDED FOR       */
*       /*                                                   @Y30LB31*/
*       /* THIS ACTIVATE REQUEST. IF FILE IS NOT SPECIFIED, 1) A UNIT*/
*       /* CAN BE DYNAMICALLY ALLOCATED IF A BASE VOLUME IS BEING    */
*       /* ACTIVATED AND RELABELED OR IF THE VOLUME IS A GENERAL-USE */
*       /* VOLUME FOR A GROUP OTHER THAN SYSGROUP AND HAS DOWN LEVEL */
*       /* SPACE, AND IN EITHER CASE THE VOLUME IS NOT CURRENTLY     */
*       /* FLAGGED DUE TO A PREVIOUS RENAME FAILURE, 2) A UNIT IS NOT*/
*       /* REQUIRED IF A BASE VOLUME WITHOUT A DOWN LEVEL SPACE      */
*       /* PROBLEM IS ONLY BEING ACTIVATED, OTHERWISE, 3) A UNIT IS  */
*       /* REQUIRED WITH DEFERRED MOUNT BECAUSE THE BASE, COPY, OR   */
*       /* DUPLICATE WILL HAVE A SERIAL MISMATCH AT THE TIME THE     */
*       /* VOLUME IS MOUNTED TO UPDATE THE VOLUME LABEL, 4) A UNIT IS*/
*       /* NOT REQUIRED FOR ACTIVATING A COPY VOLUME WITHOUT         */
*       /* PERFORMING A RENAME. ISSUE AN ERROR MESSAGE IF FILE IS NOT*/
*       /* SPECIFIED BUT A UNIT IS REQUIRED.                 @G24LB23*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0438
*       IF ADDR(FILE)=NULLPTR THEN  /*                       #Y30LB31*/
@RF00429 L     @15,@PC00001+4                                      0438
         L     @15,FDTPTR+28(,@15)                                 0438
         LTR   @15,@15                                             0438
         BNZ   @RF00438                                            0438
*         IF(BCDBASE=ON&BCDVSMIS=OFF)×ADDR(RVOL)^=NULLPTR THEN     0439
         TM    BCDBASE(BCDVPTR),B'00100000'                        0439
         BNO   @GL00002                                            0439
         TM    BCDVSMIS(BCDVPTR),B'00100000'                       0439
         BZ    @RT00439                                            0439
@GL00002 L     @15,@PC00001+4                                      0439
         L     @15,FDTPTR+36(,@15)                                 0439
         LTR   @15,@15                                             0439
         BNZ   @RT00439                                            0439
*           ;                       /*                       @G24LB23*/
*         ELSE                      /*                       #Y30LB31*/
*           DO;                     /*                       #Y30LB31*/
*             SETUPRC=4;            /*                       #Y30LB31*/
         MVC   SETUPRC(2),@CH00043                                 0442
*             PRINTTBL=''B;         /*                       #Y30LB31*/
         XC    PRINTTBL(28),PRINTTBL                               0443
*             DARGSMOD=COMMSGS;     /*                       #Y30LB31*/
         L     @15,DDSTRU                                          0444
         MVC   DARGSMOD(3,@15),@CC01697                            0444
*             DARGSENT=MSG3092I;    /* STID=CM014            #Y30LB31*/
         MVI   DARGSENT(@15),X'0E'                                 0445
*             CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*        #Y30LB31*/
         L     @15,@PC00001                                        0446
         ST    @15,@AL00001                                        0446
         LA    @14,@CF00117                                        0446
         ST    @14,@AL00001+4                                      0446
         LA    @14,DDSTRU                                          0446
         ST    @14,@AL00001+8                                      0446
         MVI   @AL00001+8,X'80'                                    0446
         L     @15,GDTPRT(,@15)                                    0446
         LA    @01,@AL00001                                        0446
         BALR  @14,@15                                             0446
*           END;                    /*                       #Y30LB31*/
*                                                                  0447
*       /*************************************************************/
*       /*                                                           */
*       /* IF A BASE VOLUME IS BEING ACTIVATED AND A NEW SERIAL      */
*       /*                                                   #Y30LB31*/
*       /* NO. IS NOT REQUESTED, AND EITHER THE DOWN LEVEL SPACE FLAG*/
*       /* IS OFF OR ELSE THE VOLUME IS NOT A GENERAL-USE VOLUME     */
*       /* BELONGING TO A GROUP OTHER THAN SYSGROUP, DISREGARD THE   */
*       /* FILE SPECIFICATION. OTHERWISE, CHECK OUT THE UNIT         */
*       /* ALLOCATED VIA THE FILE PARM BECAUSE VOLUME MOUNTS WILL BE */
*       /* REQUIRED.                                         @G24LB23*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0448
*       ELSE                        /*                       #Y30LB31*/
*         IF BCDBASE=ON&BCDVSMIS=OFF&ADDR(NSER)=NULLPTR&/*   @G24LB23*/
*             (BASDLSF=OFF×BASGENUS=OFF×(BASGENUS=ON&/*      @G24LB23*/
*             BASGROUP=SYSGROUP))   /*                       @G24LB23*/
*           THEN                                                   0448
         B     @RC00438                                            0448
@RF00438 TM    BCDBASE(BCDVPTR),B'00100000'                        0448
         BNO   @RF00448                                            0448
         TM    BCDVSMIS(BCDVPTR),B'00100000'                       0448
         BNZ   @RF00448                                            0448
         L     @15,@PC00001+4                                      0448
         L     @15,FDTPTR+20(,@15)                                 0448
         LTR   @15,@15                                             0448
         BNZ   @RF00448                                            0448
         TM    BASDLSF(BASEVPTR),B'10010000'                       0448
         BNO   @RT00448                                            0448
         TM    BASGENUS(BASEVPTR),B'00010000'                      0448
         BNO   @RF00448                                            0448
         CLC   BASGROUP(8,BASEVPTR),@CC01670                       0448
         BE    @RT00448                                            0448
*           ;                       /* UNIT IS NOT REQUIRED  #Y30LB31*/
*         ELSE                      /*                       #Y30LB31*/
*           DO;                     /*                       #Y30LB31*/
@RF00448 DS    0H                                                  0451
*             CALL ALLOCRTN;        /*                       #Y30LB31*/
         BAL   @14,ALLOCRTN                                        0451
*             RESPECIFY                                            0452
*               RTNREG RSTD;                                       0452
*             TESTRC=RTNREG;                                       0453
         LR    TESTRC,RTNREG                                       0453
*             RESPECIFY                                            0454
*               RTNREG UNRSTD;      /*                       #Y30LB31*/
*             IF TESTRC^=0 THEN     /*                       #Y30LB31*/
         LTR   TESTRC,TESTRC                                       0455
         BZ    @RF00455                                            0455
*               SETUPRC=4;          /*                       #Y30LB31*/
         MVC   SETUPRC(2),@CH00043                                 0456
*           END;                    /*                       #Y30LB31*/
*                                                                  0457
@RF00455 DS    0H                                                  0458
*       /*************************************************************/
*       /*                                                           */
*       /* CLOSE DO GROUP THAT CHECKED FOR READWRITE AND UNIT        */
*       /*                                                   #Y30LB31*/
*       /* REQUIREMENTS.                                     #Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0458
*     END;                          /*                       #Y30LB31*/
*                                                                  0458
@RT00448 DS    0H                                                  0458
@RC00438 DS    0H                                                  0459
*   /*****************************************************************/
*   /*                                                               */
*   /* RESTORE REG 14 WITH THE RETURN ADDRESS OF THE CALLER  #Y30LB31*/
*   /* AND EXIT FROM SETUPRTN, PASSING THE CONDITION CODE IN REG 15. */
*   /*                                                       #Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0459
*   RESPECIFY                                                      0459
*     REG14 RSTD;                   /*                       @ZDR2054*/
@RC00426 DS    0H                                                  0460
*   REG14=RETADDR1;                 /*                       #Y30LB31*/
         L     REG14,RETADDR1                                      0460
*   RESPECIFY                                                      0461
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   RETURN CODE(SETUPRC);           /*                       #Y30LB31*/
         LH    @15,SETUPRC                                         0462
@EL00002 DS    0H                                                  0462
@EF00002 DS    0H                                                  0462
@ER00002 BR    @14                                                 0462
*   END SETUPRTN;                   /*                       #Y30LB31*/
*                                                                  0464
*/****************************************************************** */
*/*                                                          #Y30LB31*/
*/* PROCEDURE NAME - VTYPERTN                                #Y30LB31*/
*/*                                                          #Y30LB31*/
*/* FUNCTION - DETERMINES FROM THE COMMAND STATEMENT PARMS   #Y30LB31*/
*/*            THE TYPE OF VOLUME TO BE ACTIVATED.  CALLS    #Y30LB31*/
*/*            CKCSNLEN TO VERIFY THE CARTRIDGE SERIAL NO.   #Y30LB31*/
*/*            LENGTH IF CART IS SPECIFIED.                  #Y30LB31*/
*/*            CALLS RVVIRTN TO READ THE APPROPRIATE         #Y30LB31*/
*/*            RECORDS.  CALLS VOLCKRTN TO CHECK FOR         #Y30LB31*/
*/*            CONFLICTS WHICH PROHIBIT THE ACTIVATE.        #Y30LB31*/
*/*            MESSAGES, IDC3089I AND IDC3072I, ARE ISSUED.  #Y30LB31*/
*/*                                                          #Y30LB31*/
*/* INPUT - FDTTBL, ADDVTBL, PRINTTBL FOR MESSAGES, BASEV    #Y30LB31*/
*/*         AND GROUP FOR THE BASE AND GROUP RECORDS.        #Y30LB31*/
*/*                                                          @Y30LB31*/
*/* OUTPUT - RETURN CODE OF 4 INDICATES                      @Y30LB31*/
*/*          (1) RECORD NOT RETRIEVED FROM INVENTORY,        @Y30LB31*/
*/*          (2) POSSIBLE DUPLICATE AND BASE VOL MIX-UP.    @Y30LB31 */
*/*          (3) READWRITE SPECIFIED BUT GROUP IS READONLY.  @Y30LB31*/
*/*          (4) CSN LENGTH INVALID.  NO RECORD READ.       @Y30LB31 */
*/*          RETURN CODE OF 0 INDICATES SUCCESSFUL VOLUME    @Y30LB31*/
*/*          DETERMINATION FOR ACTIVATE REQUESTS.            @Y30LB31*/
*/*                                                          @Y30LB31*/
*/****************************************************************** */
*                                                                  0464
*VTYPERTN:                                                         0464
*   PROCEDURE OPTIONS(NOSAVEAREA,NOSAVE);/*                  @Y30LB31*/
*                                                                  0464
VTYPERTN DS    0H                                                  0465
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL CONDITION CODE.                                 @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0465
*   DCL                                                            0465
*     VTYPERC FIXED(15);            /*                       @Y30LB31*/
*                                                                  0465
*   /*****************************************************************/
*   /*                                                               */
*   /* SAVE THE RETURN ADDRESS OF CALLER SINCE THERE IS      @Y30LB31*/
*   /* NO SAVEAREA. REG 14 WILL BE RESTORED UPON EXIT.       @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0466
*   RESPECIFY                                                      0466
*     REG14 RSTD;                   /*                       @ZDR2054*/
*   RETADDR2=REG14;                 /*                       #Y30LB31*/
         ST    REG14,RETADDR2                                      0467
*   RESPECIFY                                                      0468
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   OLDERID2=NEWERID2;                                             0469
         L     @04,@PC00001                                        0469
         L     @04,GDTTR2(,@04)                                    0469
         MVC   @TS00001(95),NEWERID2(@04)                          0469
         MVC   OLDERID2(95,@04),@TS00001                           0469
*   NEWID2='AVVT';                  /*                       @Y30LB31*/
*                                                                  0470
         MVC   NEWID2(4,@04),@CC01798                              0470
*   /*****************************************************************/
*   /*                                                               */
*   /* INITIALIZE TO ZERO THE CONDITION CODE USED            @Y30LB31*/
*   /* WITHIN THIS PROCEDURE.                                @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0471
*   VTYPERC=LASTCC00;               /*                       @Y30LB31*/
         SLR   @15,@15                                             0471
         LR    VTYPERC,@15                                         0471
*                                                                  0472
*   /*****************************************************************/
*   /*                                                               */
*   /* IF A COPY VOLUME IS TO BE ACTIVATED,                  @ZDR2054*/
*   /* WITHOUT BEING RENAMED TO REPLACE A BASE VOLUME,       @ZDR2054*/
*   /* THEN ITS BASE VOLUME MUST BE READ FOR CHECKING        @ZDR2054*/
*   /* OF CONDITIONS WHICH WILL PREVENT THE ACTIVATE.        @ZDR2054*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0472
*   IF ADDR(RVOL)^=NULLPTR THEN     /*                       @ZDR2054*/
         L     @04,@PC00001+4                                      0472
         C     @15,FDTPTR+36(,@04)                                 0472
         BE    @RF00472                                            0472
*     DO;                           /*                       @ZDR2054*/
*       RECTYPE=BASE;               /*                       @ZDR2054*/
         MVC   RECTYPE(4),@CC01660                                 0474
*       CALL RVVIRTN;               /*                       @ZDR2054*/
         BAL   @14,RVVIRTN                                         0475
*       RESPECIFY                                                  0476
*         RTNREG RSTD;                                             0476
*       TESTRC=RTNREG;                                             0477
         LR    TESTRC,RTNREG                                       0477
*       RESPECIFY                                                  0478
*         RTNREG UNRSTD;            /*                       @ZDR2054*/
*       IF TESTRC^=0 THEN                                          0479
         LTR   TESTRC,TESTRC                                       0479
         BZ    @RF00479                                            0479
*         VTYPERC=4;                /*                       @ZDR2054*/
         LA    VTYPERC,4                                           0480
*     END;                          /*                       @ZDR2054*/
*                                                                  0481
@RF00479 DS    0H                                                  0482
*   /*****************************************************************/
*   /*                                                               */
*   /* SET APPROPRIATE RECORD TYPE TO BE RETRIEVED FROM      @Y30LB31*/
*   /* THE INVENTORY                                         @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0482
*   IF ADDR(CDATE)^=NULLPTR THEN    /*                       @Y30LB31*/
@RF00472 L     @04,@PC00001+4                                      0482
         L     @04,FDTPTR+4(,@04)                                  0482
         LTR   @04,@04                                             0482
         BZ    @RF00482                                            0482
*     RECTYPE=COPY;                 /* SPECIFIC COPY RECORD  @Y30LB31*/
         MVC   RECTYPE(4),@CC01664                                 0483
*   ELSE                            /*                       @Y30LB31*/
*     IF ADDR(CART)^=NULLPTR THEN   /*                       @Y30LB31*/
         B     @RC00482                                            0484
@RF00482 L     @04,@PC00001+4                                      0484
         L     @04,FDTPTR+16(,@04)                                 0484
         LTR   @04,@04                                             0484
         BZ    @RF00484                                            0484
*       DO;                         /*                       @Y30LB31*/
*         RECTYPE=UNKN;             /* UNKNOWN RECORD TYPE   @Y30LB31*/
*                                                                  0486
         MVC   RECTYPE(4),@CC01662                                 0486
*         /***********************************************************/
*         /*                                                         */
*         /* MOVE THE CARTRIDGE SERIAL NO. TO A WORKAREA     @Y30LB31*/
*         /* AND CALL CKCSNLEN TO VALIDATE THE CSN LENGTH AND TO     */
*         /* ADJUST IT FROM 11 TO 12 BYTES IF NECESSARY.     @Y30LB31*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  0487
*         CSNWKA=CARTVAL;           /*                       @Y30LB31*/
         MVC   CSNWKA(12),CARTVAL(@04)                             0487
*         CALL CKCSNLEN(CSNWKA,CARTLEN);/*                   @Y30LB31*/
         LA    @15,CSNWKA                                          0488
         ST    @15,@AL00001                                        0488
         ST    @04,@AL00001+4                                      0488
         LA    @01,@AL00001                                        0488
         BAL   @14,CKCSNLEN                                        0488
*         RESPECIFY                                                0489
*           RTNREG RSTD;                                           0489
*         TESTRC=RTNREG;                                           0490
         LR    TESTRC,RTNREG                                       0490
*         RESPECIFY                                                0491
*           RTNREG UNRSTD;          /*                       @Y30LB31*/
*                                                                  0491
*         /***********************************************************/
*         /*                                                         */
*         /* TEST THE RETURN CODE FROM CKCSNLEN. IF THE CSN  @Y30LB31*/
*         /* LENGTH IS INVALID, UPDATE THE COND CODE AND EXIT FROM   */
*         /* THIS PROC.                                      @Y30LB31*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  0492
*         IF TESTRC^=0 THEN         /*                       @Y30LB31*/
         LTR   TESTRC,TESTRC                                       0492
         BZ    @RF00492                                            0492
*           VTYPERC=4;              /*                       @Y30LB31*/
         LA    VTYPERC,4                                           0493
*       END;                        /*                       @Y30LB31*/
*     ELSE                          /*                       @Y30LB31*/
*       RECTYPE=DUP;                /* DUPLICATE VOLUME REC  @Y30LB31*/
         B     @RC00484                                            0495
@RF00484 MVC   RECTYPE(4),@CC01656                                 0495
*                                                                  0496
*   /*****************************************************************/
*   /*                                                               */
*   /* RETRIEVE THE DESIGNATED RECORD FROM INVENTORY.        @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0496
*   IF VTYPERC=0 THEN               /*                       @Y30LB31*/
@RC00484 DS    0H                                                  0496
@RC00482 LTR   VTYPERC,VTYPERC                                     0496
         BNZ   @RF00496                                            0496
*     DO;                           /*                       @Y30LB31*/
*       CALL RVVIRTN;               /*                       @Y30LB31*/
         BAL   @14,RVVIRTN                                         0498
*       RESPECIFY                                                  0499
*         RTNREG RSTD;                                             0499
*       TESTRC=RTNREG;                                             0500
         LR    TESTRC,RTNREG                                       0500
*       RESPECIFY                                                  0501
*         RTNREG UNRSTD;            /*                       @Y30LB31*/
*                                                                  0501
*       /*************************************************************/
*       /*                                                           */
*       /* TEST THE RETURN CODE FROM RVVIRTN. IF THE READ    @Y30LB31*/
*       /* FAILED, UPDATE THE CONDITION CODE AND EXIT FROM VTYPERTN. */
*       /*                                                   @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0502
*       IF TESTRC=4 THEN            /*                       @Y30LB31*/
         LA    @04,4                                               0502
         CR    TESTRC,@04                                          0502
         BNE   @RF00502                                            0502
*         VTYPERC=4;                /*                       @Y30LB31*/
*                                                                  0503
         LR    VTYPERC,@04                                         0503
*       /*************************************************************/
*       /*                                                           */
*       /* IF A DUPLICATE RECORD WAS RETRIEVED WHEN A        @Y30LB31*/
*       /* PARTICULAR CARTRIDGE SERIAL NO. WAS NOT SPECIFIED, ADDV   */
*       /* CANNOT DETERMINE WHETHER THE BASE VOLUME OR THIS DUPLICATE*/
*       /* WITH THE SAME VOLUME SERIAL NO. IS TO BE ACTIVATED. OUTPUT*/
*       /* MESSAGE IDC3089I AND EXIT FROM VTYPERTN.          @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0504
*       ELSE                        /*                       @Y30LB31*/
*         IF RECTYPE=DUP THEN       /*                       @Y30LB31*/
         B     @RC00502                                            0504
@RF00502 CLC   RECTYPE(4),@CC01656                                 0504
         BNE   @RF00504                                            0504
*           IF TESTRC^=LASTCC08 THEN/*                       @Y30LB31*/
         C     TESTRC,@CF00182                                     0505
         BE    @RF00505                                            0505
*             DO;                   /*                       @Y30LB31*/
*               VTYPERC=4;          /*                       @Y30LB31*/
         LA    VTYPERC,4                                           0507
*               PRINTTBL=''B;       /*                       @Y30LB31*/
         XC    PRINTTBL(28),PRINTTBL                               0508
*               DARGSMOD=COMMSGS;   /*                       @Y30LB31*/
         L     @04,DDSTRU                                          0509
         MVC   DARGSMOD(3,@04),@CC01697                            0509
*               DARGSENT=MSG3089I;  /* STID = CM017          @Y30LB31*/
         MVI   DARGSENT(@04),X'11'                                 0510
*               DARGDBP=ADDR(VOLVAL);/*                      @Y30LB31*/
         L     @15,@PC00001+4                                      0511
         L     @15,FDTPTR(,@15)                                    0511
         LA    @14,VOLVAL(,@15)                                    0511
         ST    @14,DARGDBP(,@04)                                   0511
*               DARGILP=VOLLEN;     /*                       @Y30LB31*/
         SLR   @14,@14                                             0512
         IC    @14,VOLLEN(,@15)                                    0512
         STH   @14,DARGILP(,@04)                                   0512
*               CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*      @Y30LB31*/
         L     @04,@PC00001                                        0513
         ST    @04,@AL00001                                        0513
         LA    @15,@CF00117                                        0513
         ST    @15,@AL00001+4                                      0513
         LA    @15,DDSTRU                                          0513
         ST    @15,@AL00001+8                                      0513
         MVI   @AL00001+8,X'80'                                    0513
         L     @15,GDTPRT(,@04)                                    0513
         LA    @01,@AL00001                                        0513
         BALR  @14,@15                                             0513
*             END;                  /*                       @Y30LB31*/
*                                                                  0514
*       /*************************************************************/
*       /*                                                           */
*       /* SINCE A DUPLICATE                                 @Y30LB31*/
*       /* RECORD WAS NOT FOUND, ADDV CAN ACTIVATE THE BASE VOL.     */
*       /* RETRIEVE THE BASE VOLUME RECORD.                  @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0515
*           ELSE                    /*                       @Y30LB31*/
*             DO;                   /*                       @Y30LB31*/
         B     @RC00505                                            0515
@RF00505 DS    0H                                                  0516
*               RECTYPE=BASE;       /*                       @Y30LB31*/
         MVC   RECTYPE(4),@CC01660                                 0516
*               CALL RVVIRTN;       /*                       @Y30LB31*/
         BAL   @14,RVVIRTN                                         0517
*               RESPECIFY                                          0518
*                 RTNREG RSTD;                                     0518
*               TESTRC=RTNREG;                                     0519
         LR    TESTRC,RTNREG                                       0519
*               RESPECIFY                                          0520
*                 RTNREG UNRSTD;    /*                       @Y30LB31*/
*                                                                  0520
*               /*****************************************************/
*               /*                                                   */
*               /* TEST THE RETURN CODE FROM RVVIRTN. IF     @Y30LB31*/
*               /* THE BASE RECORD COULD NOT BE RETRIEVED, UPDATE THE*/
*               /* COND CODE AND EXIT FROM VTYPERTN.         @Y30LB31*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  0521
*               IF TESTRC^=0 THEN   /*                       @Y30LB31*/
         LTR   TESTRC,TESTRC                                       0521
         BZ    @RF00521                                            0521
*                 VTYPERC=4;        /*                       @Y30LB31*/
         LA    VTYPERC,4                                           0522
*             END;                  /*                       @Y30LB31*/
*                                                                  0523
@RF00521 DS    0H                                                  0524
*       /*************************************************************/
*       /*                                                           */
*       /* CLOSE DO GROUP THAT READS A VOLUME RECORD.        @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0524
*     END;                          /*                       @Y30LB31*/
@RC00505 DS    0H                                                  0524
@RF00504 DS    0H                                                  0524
@RC00502 DS    0H                                                  0525
*                                                                  0525
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THE RECORD FOR THE VOLUME BEING ACTIVATED WAS      @Y30LB31*/
*   /* RETRIEVED, CHECK THE VOLUME RECORD FOR CONDITIONS WHICH WILL  */
*   /* PREVENT THE ACTIVATE.                                 @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0525
*   IF VTYPERC=0 THEN               /*                       @Y30LB31*/
@RF00496 LTR   VTYPERC,VTYPERC                                     0525
         BNZ   @RF00525                                            0525
*     DO;                           /*                       @Y30LB31*/
*       CALL VOLCKRTN;              /*                       @Y30LB31*/
         BAL   @14,VOLCKRTN                                        0527
*       RESPECIFY                                                  0528
*         RTNREG RSTD;                                             0528
*       TESTRC=RTNREG;                                             0529
         LR    TESTRC,RTNREG                                       0529
*       RESPECIFY                                                  0530
*         RTNREG UNRSTD;            /*                       @Y30LB31*/
*                                                                  0530
*       /*************************************************************/
*       /*                                                           */
*       /* TEST RETURN CODE FROM VOLCKRTN. IF THE VOL        @Y30LB31*/
*       /* CHECK OUT FAILED, THE VOL CANNOT BE ACTIVATED. UPDATE THE */
*       /*                                                   @Y30LB31*/
*       /* COND CODE AND EXIT FROM VTYPERTN.                 @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0531
*       IF TESTRC^=0 THEN           /*                       @Y30LB31*/
         LTR   TESTRC,TESTRC                                       0531
         BZ    @RF00531                                            0531
*         VTYPERC=4;                /*                       @Y30LB31*/
*                                                                  0532
         LA    VTYPERC,4                                           0532
*       /*************************************************************/
*       /*                                                           */
*       /* IF A GENERAL-USE BASE VOLUME IS BEING             @ZDR2054*/
*       /* ACTIVATED OR IS BEING REPLACED WITH A COPY        @ZDR2054*/
*       /* RETRIEVE THE GROUP RECORD FOR THIS BASE VOLUME    @ZDR2054*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0533
*       ELSE                        /*                       @Y30LB31*/
*         IF BCDBASE=ON×ADDR(RVOL)^=NULLPTR THEN/*           @ZDR2054*/
         B     @RC00531                                            0533
@RF00531 TM    BCDBASE(BCDVPTR),B'00100000'                        0533
         BO    @RT00533                                            0533
         L     @04,@PC00001+4                                      0533
         L     @04,FDTPTR+36(,@04)                                 0533
         LTR   @04,@04                                             0533
         BZ    @RF00533                                            0533
@RT00533 DS    0H                                                  0534
*           IF BASGENUS=ON×COPGENUS=ON/*                     @ZDR2054*/
*             THEN                                                 0534
         TM    BASGENUS(BASEVPTR),B'00010000'                      0534
         BO    @RT00534                                            0534
         L     @04,COPYVPTR                                        0534
         TM    COPGENUS(@04),B'00100000'                           0534
         BNO   @RF00534                                            0534
@RT00534 DS    0H                                                  0535
*             DO;                   /*                       @Y30LB31*/
*               RECTYPE=GRP;        /*                       @Y30LB31*/
         MVC   RECTYPE(4),@CC01658                                 0536
*               CALL RVVIRTN;       /*                       @Y30LB31*/
         BAL   @14,RVVIRTN                                         0537
*               RESPECIFY                                          0538
*                 RTNREG RSTD;                                     0538
*               TESTRC=RTNREG;                                     0539
         LR    TESTRC,RTNREG                                       0539
*               RESPECIFY                                          0540
*                 RTNREG UNRSTD;    /*                       @Y30LB31*/
*                                                                  0540
*               /*****************************************************/
*               /*                                                   */
*               /* TEST THE RETURN CODE FROM RVVIRTN.        @Y30LB31*/
*               /* IF THE GROUP RECORD COULD NOT BE READ, UPDATE THE */
*               /* CONDITION CODE AND EXIT FROM VTYPERTN.    @Y30LB31*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  0541
*               IF TESTRC^=0 THEN   /*                       @Y30LB31*/
         LTR   TESTRC,TESTRC                                       0541
         BZ    @RF00541                                            0541
*                 VTYPERC=4;        /*                       @Y30LB31*/
*                                                                  0542
         LA    VTYPERC,4                                           0542
*               /*****************************************************/
*               /*                                                   */
*               /* AN ERROR EXISTS IF READWRITE IS SPECIFIED @Y30LB31*/
*               /* BUT GROUP IS READONLY. UPDATE CONDITION CODE.     */
*               /* OUTPUT MESSAGE IDC3072I AND EXIT FROM VTYPERTN.   */
*               /*                                           @Y30LB31*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  0543
*               ELSE                /*                       @Y30LB31*/
*                 IF GRORONLY=ON THEN/*                      @Y30LB31*/
         B     @RC00541                                            0543
@RF00541 L     @04,GROUPPTR                                        0543
         TM    GRORONLY(@04),B'00010000'                           0543
         BNO   @RF00543                                            0543
*                   IF ADDR(RWOPT)^=NULLPTR THEN/*           @Y30LB31*/
         L     @04,@PC00001+4                                      0544
         L     @04,FDTPTR+24(,@04)                                 0544
         LTR   @04,@04                                             0544
         BZ    @RF00544                                            0544
*                     DO;           /*                       @Y30LB31*/
*                       VTYPERC=4;  /*                       @Y30LB31*/
         LA    VTYPERC,4                                           0546
*                       PRINTTBL=''B;/*                      @Y30LB31*/
         XC    PRINTTBL(28),PRINTTBL                               0547
*                       DARGSMOD=COMMSGS;/*                  @Y30LB31*/
         L     @04,DDSTRU                                          0548
         MVC   DARGSMOD(3,@04),@CC01697                            0548
*                       DARGSENT=MSG3072I;/* STID=CM034      @Y30LB31*/
         MVI   DARGSENT(@04),X'22'                                 0549
*                       CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*    0550
*                                                            @Y30LB31*/
         L     @04,@PC00001                                        0550
         ST    @04,@AL00001                                        0550
         LA    @15,@CF00117                                        0550
         ST    @15,@AL00001+4                                      0550
         LA    @15,DDSTRU                                          0550
         ST    @15,@AL00001+8                                      0550
         MVI   @AL00001+8,X'80'                                    0550
         L     @15,GDTPRT(,@04)                                    0550
         LA    @01,@AL00001                                        0550
         BALR  @14,@15                                             0550
*                     END;          /*                       @Y30LB31*/
*                                                                  0551
*               /*****************************************************/
*               /*                                                   */
*               /* CLOSE DO GROUP WHICH READS AND CHECKS OUT @Y30LB31*/
*               /* THE GROUP RECORD.                         @Y30LB31*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  0552
*             END;                  /*                       @Y30LB31*/
*                                                                  0552
@RF00544 DS    0H                                                  0552
@RF00543 DS    0H                                                  0552
@RC00541 DS    0H                                                  0553
*       /*************************************************************/
*       /*                                                           */
*       /* CLOSE THE DO GROUP WHICH CALLS VOLCKRTN.          @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0553
*     END;                          /*                       @Y30LB31*/
*                                                                  0553
@RF00534 DS    0H                                                  0553
@RF00533 DS    0H                                                  0553
@RC00531 DS    0H                                                  0554
*   /*****************************************************************/
*   /*                                                               */
*   /* RESTORE REG 14 TO RETURN ADDRESS OF INVOKER.          @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0554
*   RESPECIFY                                                      0554
*     REG14 RSTD;                   /*                       @ZDR2054*/
@RF00525 DS    0H                                                  0555
*   REG14=RETADDR2;                 /*                       @Y30LB31*/
         L     REG14,RETADDR2                                      0555
*   RESPECIFY                                                      0556
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*                                                                  0556
*   /*****************************************************************/
*   /*                                                               */
*   /* RETURN TO CALLER WITH THE CONDITION CODE SETTING      @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0557
*   RETURN CODE(VTYPERC);           /*                       @Y30LB31*/
         LR    @15,VTYPERC                                         0557
@EL00003 DS    0H                                                  0557
@EF00003 DS    0H                                                  0557
@ER00003 BR    @14                                                 0557
*   END VTYPERTN;                   /*                       @Y30LB31*/
*                                                                  0559
*/********************************************************** @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* PROCEDURE NAME - RVVIRTN                                 @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* FUNCTION - READS A BASE, COPY, DUPLICATE, OR GROUP       @Y30LB31*/
*/*            RECORD.  IF CARTRIDGE SERIAL NO. IS THE ONLY  @Y30LB31*/
*/*            IDENTIFICATION, RVVIRTN READS A RECORD OF     @Y30LB31*/
*/*            UNKNOWN TYPE.  CALLS SSCMSG TO OUTPUT ANY     @Y30LB31*/
*/*            MSSC ERROR MESSAGES.  MESSAGES, IDC3081I,     @Y30LB31*/
*/*            IDC2080I, AND IDC2079I, MAY BE ISSUED.        @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* INPUT - FDTTBL, ADDVTBL, VOLUME RECORD BUFFER,           @Y30LB31*/
*/*         GROUP BUFFER, AND PRINTTBL FOR MESSAGES.         @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* OUTPUT - RETURN CODE OF 4 IF READ FAILED.                @Y30LB31*/
*/*          RETURN CODE OF 8 IF NO DUPLICATE RECORD FOUND.  @Y30LB31*/
*/*          RETURN CODE OF 0 INDICATES SUCCESSFUL READ AND  @Y30LB31*/
*/*          BUFFER CONTAINS A BASE, COPY, DUPLICATE OR      @Y30LB31*/
*/*          GROUP RECORD.                                   @Y30LB31*/
*/*                                                          @Y30LB31*/
*/********************************************************** @Y30LB31*/
*                                                                  0559
*RVVIRTN:                                                          0559
*   PROCEDURE OPTIONS(NOSAVEAREA,NOSAVE);/*                  @Y30LB31*/
*                                                                  0559
RVVIRTN  DS    0H                                                  0560
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL DECLARATIONS                                    @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0560
*   DCL                                                            0560
*     RVRTNRC FIXED(15);            /* INTERNAL CONDITION CODE     0560
*                                                            @Y30LB31*/
*   DCL                                                            0561
*     RCNOREC BIT(32)               /* RECORD NOT FOUND COND @Y30LB31*/
*         CONSTANT('00000208'X);    /*                       @Y30LB31*/
*   DCL                                                            0562
*     CDATEWKA CHAR(4);             /* PACKED DECIMAL WKA    @Y30LB31*/
*   DCL                                                            0563
*     SEQ#DFLT FIXED(31) CONSTANT(1);/* SEQ NO. DEFAULT      @Y30LB31*/
*                                                                  0563
*   /*****************************************************************/
*   /*                                                               */
*   /* SETUP STORAGE AREA TO BUILD MSVC RVVI PARM            @Y30LB31*/
*   /* LIST TO READ A RECORD FROM MSVI.                      @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0564
*   DCL                                                            0564
*     1 AV01RVVI BDY(WORD),         /*                       @Y30LB31*/
*      2 AVRVVIID CHAR(8),          /* RVVI ARG LIST ID      @Y30LB31*/
*      2 AVRVVI CHAR(LENGTH(RVVI)) BDY(WORD);/*              @Y30LB31*/
*                                                                  0564
*   /*****************************************************************/
*   /*                                                               */
*   /* SAVE THE RETURN ADDRESS OF CALLER SINCE THERE IS NO   @Y30LB31*/
*   /* SAVEAREA. REG 14 WILL BE RESTORED UPON EXIT.          @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0565
*   RESPECIFY                                                      0565
*     REG14 RSTD;                   /*                       @ZDR2054*/
*   RETADDR3=REG14;                 /*                       @Y30LB31*/
         ST    REG14,RETADDR3                                      0566
*   RESPECIFY                                                      0567
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   OLDERID2=NEWERID2;                                             0568
         L     @15,@PC00001                                        0568
         L     @15,GDTTR2(,@15)                                    0568
         MVC   @TS00001(95),NEWERID2(@15)                          0568
         MVC   OLDERID2(95,@15),@TS00001                           0568
*   NEWID2='AVRV';                  /*                       @Y30LB31*/
*                                                                  0569
         MVC   NEWID2(4,@15),@CC01813                              0569
*   /*****************************************************************/
*   /*                                                               */
*   /* INITIALIZE TO ZERO THE CONDITION CODE USED WITHIN     @Y30LB31*/
*   /* THIS PROCEDURE.                                       @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0570
*   RVRTNRC=LASTCC00;               /*                       @Y30LB31*/
*                                                                  0570
         SLR   @15,@15                                             0570
         LR    RVRTNRC,@15                                         0570
*   /*****************************************************************/
*   /*                                                               */
*   /* INITIALIZE MSVC READ PARM LIST. INITIALIZE THE RVVI   @Y30LB31*/
*   /* FIELDS COMMON TO ALL READ REQUESTS.                   @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0571
*   AVRVVIID='RVVI';                /*                       @Y30LB31*/
         MVI   AVRVVIID+4,C' '                                     0571
         MVC   AVRVVIID+5(3),AVRVVIID+4                            0571
         MVC   AVRVVIID(4),@CC01814                                0571
*   RVVIPTR=ADDR(AVRVVI);           /*                       @Y30LB31*/
         LA    @14,AVRVVI                                          0572
         ST    @14,RVVIPTR                                         0572
*   RVVI=''B;                       /*                       @Y30LB31*/
         XC    RVVI(68,@14),RVVI(@14)                              0573
*   RVVLNGTH=RVVLEN;                /*                       @Y30LB31*/
         LH    @03,RVVLEN                                          0574
         ST    @03,RVVLNGTH(,@14)                                  0574
*   RVVCODE=RVVOP;                  /*                       @Y30LB31*/
         MVI   RVVCODE(@14),X'87'                                  0575
*   RVVRDR=ON;                      /*                       @Y30LB31*/
*                                                                  0576
         OI    RVVRDR(@14),B'10000000'                             0576
*   /*****************************************************************/
*   /*                                                               */
*   /* SET THE VOLUME SERIAL NO. AND BUFFER FIELDS IN THE    @Y30LB31*/
*   /* PARM LIST IF A VOLUME RECORD IS BEING READ.           @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0577
*   IF RECTYPE^=GRP THEN            /*                       @Y30LB31*/
         CLC   RECTYPE(4),@CC01658                                 0577
         BE    @RF00577                                            0577
*     DO;                           /*                       @Y30LB31*/
*       RVVOLUME=VOLVAL;            /*                       @Y30LB31*/
         L     @03,@PC00001+4                                      0579
         L     @01,FDTPTR(,@03)                                    0579
         MVC   RVVOLUME(6,@14),VOLVAL(@01)                         0579
*       RVVSVOL=ON;                 /*                       @Y30LB31*/
         OI    RVVSVOL(@14),B'00000001'                            0580
*       IF ADDR(RVOL)^=NULLPTR&RECTYPE=BASE THEN/*           @ZDR2054*/
         C     @15,FDTPTR+36(,@03)                                 0581
         BE    @RF00581                                            0581
         CLC   RECTYPE(4),@CC01660                                 0581
         BNE   @RF00581                                            0581
*         DO;                       /*                       @ZDR2054*/
*           BASEVPTR=ADDR(TEMPBUF); /*                       @ZA17143*/
         LA    @15,TEMPBUF                                         0583
         LR    BASEVPTR,@15                                        0583
*           RVVRTBUF=ADDR(TEMPBUF); /*                       @ZDR2054*/
         ST    @15,RVVRTBUF(,@14)                                  0584
*           RVVBUFLN=LENGTH(TEMPBUF);/*                      @ZDR2054*/
         MVC   RVVBUFLN(2,@14),@CH01996                            0585
*         END;                      /*                       @ZDR2054*/
*       ELSE                        /*                       @ZDR2054*/
*         DO;                       /*                       @ZDR2054*/
         B     @RC00581                                            0587
@RF00581 DS    0H                                                  0588
*           RVVRTBUF=ADDR(VOLREC);  /*                       @Y30LB31*/
         L     @15,RVVIPTR                                         0588
         LA    @14,VOLREC                                          0588
         ST    @14,RVVRTBUF(,@15)                                  0588
*           RVVBUFLN=LENGTH(VOLREC);/*                       @Y30LB31*/
         MVC   RVVBUFLN(2,@15),@CH01996                            0589
*         END;                      /*                       @ZDR2054*/
*     END;                          /*                       @Y30LB31*/
*                                                                  0591
@RC00581 DS    0H                                                  0592
*   /*****************************************************************/
*   /*                                                               */
*   /* INITIALIZE THE FOLLOWING FIELD TO READ A BASE         @Y30LB31*/
*   /* VOLUME RECORD.                                        @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0592
*   IF RECTYPE=BASE THEN            /*                       @Y30LB31*/
@RF00577 CLC   RECTYPE(4),@CC01660                                 0592
         BNE   @RF00592                                            0592
*     RVVBVRCD=ON;                  /*                       @Y30LB31*/
*                                                                  0593
         L     @01,RVVIPTR                                         0593
         OI    RVVBVRCD(@01),B'10000000'                           0593
*   /*****************************************************************/
*   /*                                                               */
*   /* INITIALIZE THE FOLLOWING FIELDS TO READ A SPECIFIC    @Y30LB31*/
*   /* COPY VOLUME RECORD.                                   @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0594
*   ELSE                            /*                       @Y30LB31*/
*     IF RECTYPE=COPY THEN          /*                       @Y30LB31*/
         B     @RC00592                                            0594
@RF00592 CLC   RECTYPE(4),@CC01664                                 0594
         BNE   @RF00594                                            0594
*       DO;                         /*                       @Y30LB31*/
*         RVVCPYRC=ON;              /*                       @Y30LB31*/
         L     @15,RVVIPTR                                         0596
         OI    RVVCPYRC(@15),B'00100000'                           0596
*         CVD(DATEVAL,CDATEWKA);    /*                       @Y30LB31*/
         L     @14,@PC00001+4                                      0597
         L     @01,FDTPTR+8(,@14)                                  0597
         L     @03,DATEVAL(,@01)                                   0597
         CVD   @03,@TS00001                                        0597
         MVC   CDATEWKA(4),@TS00001+4                              0597
*         RVVCDATE=CDATEWKA;        /*                       @Y30LB31*/
         MVC   RVVCDATE(4,@15),CDATEWKA                            0598
*         RVVSDTE=ON;               /*                       @Y30LB31*/
         OI    RVVSDTE(@15),B'00100000'                            0599
*         IF ADDR(SEQ#)^=NULLPTR THEN/*                      @Y30LB31*/
         L     @14,FDTPTR+12(,@14)                                 0600
         LTR   @14,@14                                             0600
         BZ    @RF00600                                            0600
*           DO;                     /*                       @Y30LB31*/
*             RVVRDSEQ=SEQ#VAL;     /*                       @Y30LB31*/
         MVC   RVVRDSEQ(1,@15),SEQ#VAL+3(@14)                      0602
*             RVVSSEQ=ON;           /*                       @Y30LB31*/
         OI    RVVSSEQ(@15),B'00010000'                            0603
*           END;                    /*                       @Y30LB31*/
*       END;                        /*                       @Y30LB31*/
*                                                                  0605
*   /*****************************************************************/
*   /*                                                               */
*   /* INITIALIZE THE FOLLOWING FIELD TO READ A              @Y30LB31*/
*   /* DUPLICATE VOLUME RECORD.                              @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0606
*     ELSE                          /*                       @Y30LB31*/
*       IF RECTYPE=DUP THEN         /*                       @Y30LB31*/
         B     @RC00594                                            0606
@RF00594 CLC   RECTYPE(4),@CC01656                                 0606
         BNE   @RF00606                                            0606
*         RVVDUPRC=ON;              /*                       @Y30LB31*/
*                                                                  0607
         L     @01,RVVIPTR                                         0607
         OI    RVVDUPRC(@01),B'00010000'                           0607
*   /*****************************************************************/
*   /*                                                               */
*   /* INTIIALIZE THE FOLLOWING FIELDS TO READ A RECORD      @Y30LB31*/
*   /* OF UNKNOWN TYPE SINCE THE CARTRIDGE SERIAL NO. IS PROVIDED    */
*   /*                                                       @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0608
*       ELSE                        /*                       @Y30LB31*/
*         IF RECTYPE=UNKN THEN      /*                       @Y30LB31*/
         B     @RC00606                                            0608
@RF00606 CLC   RECTYPE(4),@CC01662                                 0608
         BNE   @RF00608                                            0608
*           DO;                     /*                       @Y30LB31*/
*             RVVRUNKN=ON;          /*                       @Y30LB31*/
         L     @15,RVVIPTR                                         0610
         OI    RVVRUNKN(@15),B'00001000'                           0610
*             RVVRDCSN=CSNWKA;      /*                       @Y30LB31*/
         MVC   RVVRDCSN(12,@15),CSNWKA                             0611
*             RVVSCSN=ON;           /*                       @Y30LB31*/
         OI    RVVSCSN(@15),B'00001000'                            0612
*           END;                    /*                       @Y30LB31*/
*                                                                  0613
*   /*****************************************************************/
*   /*                                                               */
*   /* INITIALIZE THE FOLLOWING FIELDS TO READ A             @Y30LB31*/
*   /* GROUP RECORD.                                         @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0614
*         ELSE                      /*                       @Y30LB31*/
*           DO;                     /*                       @Y30LB31*/
         B     @RC00608                                            0614
@RF00608 DS    0H                                                  0615
*             RVVGRPRC=ON;          /*                       @Y30LB31*/
         L     @15,RVVIPTR                                         0615
         OI    RVVGRPRC(@15),B'01000000'                           0615
*             RVVGROUP=BASGROUP;    /*                       @Y30LB31*/
         MVC   RVVGROUP(8,@15),BASGROUP(BASEVPTR)                  0616
*             RVVSGRP=ON;           /*                       @Y30LB31*/
         OI    RVVSGRP(@15),B'10000000'                            0617
*             RVVRTBUF=ADDR(GRPREC);/*                       @Y30LB31*/
         LA    @14,GRPREC                                          0618
         ST    @14,RVVRTBUF(,@15)                                  0618
*             RVVBUFLN=LENGTH(GRPREC);/*                     @Y30LB31*/
         MVC   RVVBUFLN(2,@15),@CH01997                            0619
*           END;                    /*                       @Y30LB31*/
*                                                                  0621
*   /*****************************************************************/
*   /*                                                               */
*   /* TAKE A SYMBOLIC DUMP OF THE RVVI PARM LIST            @Y30LB31*/
*   /* BEFORE THE READ.                                      @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0621
*   IF GDTDBG=NULLPTR THEN                                         0621
@RC00608 DS    0H                                                  0621
@RC00606 DS    0H                                                  0621
@RC00594 DS    0H                                                  0621
@RC00592 L     @15,@PC00001                                        0621
         L     @15,GDTDBG(,@15)                                    0621
         LTR   @15,@15                                             0621
         BZ    @RT00621                                            0621
*     ;                                                            0622
*   ELSE                                                           0623
*     DO;                                                          0623
*       DMPINDEX=ADDR(AVDMPLST);    /*                       @Y30LB31*/
         LA    DMPINDEX,AVDMPLST                                   0624
*       DMPITMNM='AV01RVVI';                                       0625
         MVC   DMPITMNM(8,DMPINDEX),@CC01816                       0625
*       DMPITMPT=ADDR(AV01RVVI);                                   0626
         LA    @03,AV01RVVI                                        0626
         ST    @03,DMPITMPT(,DMPINDEX)                             0626
*       DMPITMLN=LENGTH(AV01RVVI);                                 0627
         MVC   DMPITMLN(2,DMPINDEX),@CH01998                       0627
*       DMPITMTP='H';                                              0628
         MVI   DMPITMTP(DMPINDEX),C'H'                             0628
*       DMPINDEX=DMPINDEX+DMPELEMT;                                0629
*                                                                  0629
         LA    @03,16                                              0629
         ALR   DMPINDEX,@03                                        0629
*       /*************************************************************/
*       /*                                                           */
*       /*                                                   @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0630
*       DMPITMNM='ADDVTBL';                                        0630
         MVI   DMPITMNM+7(DMPINDEX),C' '                           0630
         MVC   DMPITMNM(7,DMPINDEX),@CC01766                       0630
*       DMPITMPT=ADDR(ADDVTBL);                                    0631
         LA    @15,ADDVTBL                                         0631
         ST    @15,DMPITMPT(,DMPINDEX)                             0631
*       DMPITMLN=LENGTH(ADDVTBL);                                  0632
         MVC   DMPITMLN(2,DMPINDEX),@CH01999                       0632
*       DMPITMTP='H';                                              0633
         MVI   DMPITMTP(DMPINDEX),C'H'                             0633
*       DMPINDEX=DMPINDEX+DMPELEMT; /*                       @Y30LB31*/
         ALR   DMPINDEX,@03                                        0634
*       DMPTRM=DMPTRMVL;                                           0635
         MVI   DMPTRM(DMPINDEX),X'FF'                              0635
*     END;                          /*                       @Y30LB31*/
*   IF GDTDBG=NULLPTR THEN                                         0637
@RT00621 L     @15,@PC00001                                        0637
         L     @15,GDTDBG(,@15)                                    0637
         LTR   @15,@15                                             0637
         BZ    @RT00637                                            0637
*     ;                                                            0638
*   ELSE                                                           0639
*     CALL IDCDB010(GDTTBL,'AVRD',ADDR(AVDMPLST));/*         @Y30LB31*/
*                                                                  0639
         L     @15,@PC00001                                        0639
         ST    @15,@AL00001                                        0639
         LA    @14,@CC01818                                        0639
         ST    @14,@AL00001+4                                      0639
         LA    @14,AVDMPLST                                        0639
         ST    @14,@AFTEMPS                                        0639
         LA    @14,@AFTEMPS                                        0639
         ST    @14,@AL00001+8                                      0639
         MVI   @AL00001+8,X'80'                                    0639
         L     @15,GDTDBG(,@15)                                    0639
         LA    @01,@AL00001                                        0639
         BALR  @14,@15                                             0639
*   /*****************************************************************/
*   /*                                                               */
*   /* READ THE RECORD SPECIFIED IN THE RVVI PARM LIST.      @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0640
*   CALL IDCSASS0(GDTTBL,VVIC,RVVIPTR,REASON);/*             @Y30LB31*/
@RT00637 L     @02,@PC00001                                        0640
         ST    @02,@AL00001                                        0640
         LA    @15,VVIC                                            0640
         ST    @15,@AL00001+4                                      0640
         LA    @15,RVVIPTR                                         0640
         ST    @15,@AL00001+8                                      0640
         LA    @15,REASON                                          0640
         ST    @15,@AL00001+12                                     0640
         MVI   @AL00001+12,X'80'                                   0640
         L     @15,GDTSSC(,@02)                                    0640
         LA    @01,@AL00001                                        0640
         BALR  @14,@15                                             0640
*   RESPECIFY                                                      0641
*     RTNREG RSTD;                                                 0641
*   TESTRC=RTNREG;                                                 0642
         LR    TESTRC,RTNREG                                       0642
*   RESPECIFY                                                      0643
*     RTNREG UNRSTD;                /*                       @Y30LB31*/
*                                                                  0644
*   /*****************************************************************/
*   /*                                                               */
*   /* TEST RETURN CODE FROM READ ATTEMPT. IF READ FAILED    @Y30LB31*/
*   /* BECAUSE NO DUPLICATE FOUND, THIS IS A SPECIAL CASE TO VERIFY  */
*   /* THAT ONLY ONE VOLUME EXISTS WITH THE GIVEN SERIAL NO. @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0644
*   IF TESTRC^=0 THEN               /*                       @Y30LB31*/
         LTR   TESTRC,TESTRC                                       0644
         BZ    @RF00644                                            0644
*     IF RECTYPE=DUP&REASON=RCNOREC THEN/*                   @Y30LB31*/
         CLC   RECTYPE(4),@CC01656                                 0645
         BNE   @RF00645                                            0645
         CLC   REASON(4),@CF01807                                  0645
         BNE   @RF00645                                            0645
*       RVRTNRC=LASTCC08;           /*                       @Y30LB31*/
*                                                                  0646
         LA    RVRTNRC,8                                           0646
*   /*****************************************************************/
*   /*                                                               */
*   /* THE READ FAILED. PRINT A MESSAGE WITH THE MSIC        @Y30LB31*/
*   /* REASON CODE. THEN PRINT AN ACCOMPANYING SECONDARY MSG TO      */
*   /* IDENTIFY THE RECORD TYPE THAT COULD NOT BE RETRIEVED. MESSAGE */
*   /* IDC3081I, IDC2080I, OR IDC2079I IS O/P.               @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0647
*     ELSE                          /*                       @Y30LB31*/
*       DO;                         /*                       @Y30LB31*/
         B     @RC00645                                            0647
@RF00645 DS    0H                                                  0648
*         RVRTNRC=4;                /*                       @Y30LB31*/
         LA    RVRTNRC,4                                           0648
*         CALL SSCMSG(REASON);      /* PRINT MSVC MSG        @Y30LB31*/
         LA    @15,REASON                                          0649
         ST    @15,@AL00001                                        0649
         LA    @01,@AL00001                                        0649
         BAL   @14,SSCMSG                                          0649
*         PRINTTBL=''B;             /*                       @Y30LB31*/
         XC    PRINTTBL(28),PRINTTBL                               0650
*         DARGSMOD=COMMSGS;         /*                       @Y30LB31*/
         L     @15,DDSTRU                                          0651
         MVC   DARGSMOD(3,@15),@CC01697                            0651
*         IF RECTYPE=COPY THEN      /*                       @Y30LB31*/
         CLC   RECTYPE(4),@CC01664                                 0652
         BNE   @RF00652                                            0652
*           DO;                     /*                       @Y30LB31*/
*             DARGSENT=MSG3081I;    /* STID = CM025          @Y30LB31*/
         MVI   DARGSENT(@15),X'19'                                 0654
*             DARGDBP=ADDR(CDATEWKA);/*                      @Y30LB31*/
         LA    @14,CDATEWKA                                        0655
         ST    @14,DARGDBP(,@15)                                   0655
*             DARGILP=LENGTH(CDATEWKA);/*                    @Y30LB31*/
         LA    @14,4                                               0656
         STH   @14,DARGILP(,@15)                                   0656
*             DARGCNT=1;            /*                       @Y30LB31*/
         LA    @03,1                                               0657
         STH   @03,DARGCNT(,@15)                                   0657
*             DARGINS(1)=1;         /*                       @Y30LB31*/
         STH   @03,DARGINS(,@15)                                   0658
*             IF ADDR(SEQ#)^=NULLPTR THEN/*                  @Y30LB31*/
         L     @03,@PC00001+4                                      0659
         L     @03,FDTPTR+12(,@03)                                 0659
         LTR   @03,@03                                             0659
         BZ    @RF00659                                            0659
*               DO;                 /*                       @Y30LB31*/
*                 DARGDTM(1)=ADDR(SEQ#VAL);/*                @Y30LB31*/
         ST    @03,DARGDTM(,@15)                                   0661
*                 DARGINL(1)=LENGTH(SEQ#VAL);/*              @Y30LB31*/
         STH   @14,DARGINL(,@15)                                   0662
*               END;                /*                       @Y30LB31*/
*             ELSE                  /*                       @Y30LB31*/
*               DO;                 /*                       @Y30LB31*/
         B     @RC00659                                            0664
@RF00659 DS    0H                                                  0665
*                 DARGDTM(1)=ADDR(SEQ#DFLT);/*               @Y30LB31*/
         L     @15,DDSTRU                                          0665
         LA    @14,@CF00222                                        0665
         ST    @14,DARGDTM(,@15)                                   0665
*                 DARGINL(1)=LENGTH(SEQ#DFLT);/*             @Y30LB31*/
         MVC   DARGINL(2,@15),@CH00043                             0666
*               END;                /*                       @Y30LB31*/
*           END;                    /*                       @Y30LB31*/
*         ELSE                      /*                       @Y30LB31*/
*           IF RECTYPE=DUP THEN                                    0669
         B     @RC00652                                            0669
@RF00652 CLC   RECTYPE(4),@CC01656                                 0669
         BE    @RT00669                                            0669
*             ;                     /* NO MSG ISSUED         @Y30LB31*/
*           ELSE                    /*                       @Y30LB31*/
*             IF RECTYPE=GRP THEN   /*                       @Y30LB31*/
         CLC   RECTYPE(4),@CC01658                                 0671
         BNE   @RF00671                                            0671
*               DO;                 /*                       @Y30LB31*/
*                 DARGSENT=MSG2079I;/* STID = CM027          @Y30LB31*/
         L     @15,DDSTRU                                          0673
         MVI   DARGSENT(@15),X'1B'                                 0673
*                 DARGDBP=ADDR(BASGROUP);/*                  @Y30LB31*/
         LA    @14,BASGROUP(,BASEVPTR)                             0674
         ST    @14,DARGDBP(,@15)                                   0674
*                 DARGILP=LENGTH(BASGROUP);/*                @Y30LB31*/
         MVC   DARGILP(2,@15),@CH00182                             0675
*               END;                /*                       @Y30LB31*/
*             ELSE                  /*                       @Y30LB31*/
*               DO;                 /*                       @Y30LB31*/
         B     @RC00671                                            0677
@RF00671 DS    0H                                                  0678
*                 DARGSENT=MSG2080I;/* STID = CM026          @Y30LB31*/
         L     @15,DDSTRU                                          0678
         MVI   DARGSENT(@15),X'1A'                                 0678
*                 DARGDBP=ADDR(VOLVAL);/*                    @Y30LB31*/
         L     @14,@PC00001+4                                      0679
         L     @14,FDTPTR(,@14)                                    0679
         LA    @03,VOLVAL(,@14)                                    0679
         ST    @03,DARGDBP(,@15)                                   0679
*                 DARGILP=VOLLEN;   /*                       @Y30LB31*/
         SLR   @03,@03                                             0680
         IC    @03,VOLLEN(,@14)                                    0680
         STH   @03,DARGILP(,@15)                                   0680
*               END;                /*                       @Y30LB31*/
*                                                                  0681
*         /***********************************************************/
*         /*                                                         */
*         /* PRINT SECONDARY MSG, IF REQUIRED.               @Y30LB31*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  0682
*         IF DARGSENT^=NOENT# THEN  /*                       @Y30LB31*/
@RC00671 DS    0H                                                  0682
@RT00669 DS    0H                                                  0682
@RC00652 L     @01,DDSTRU                                          0682
         CLI   DARGSENT(@01),0                                     0682
         BE    @RF00682                                            0682
*           CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*          @Y30LB31*/
*                                                                  0683
         L     @15,@PC00001                                        0683
         ST    @15,@AL00001                                        0683
         LA    @14,@CF00117                                        0683
         ST    @14,@AL00001+4                                      0683
         LA    @14,DDSTRU                                          0683
         ST    @14,@AL00001+8                                      0683
         MVI   @AL00001+8,X'80'                                    0683
         L     @15,GDTPRT(,@15)                                    0683
         LA    @01,@AL00001                                        0683
         BALR  @14,@15                                             0683
*         /***********************************************************/
*         /*                                                         */
*         /* CLOSE DO GROUP THAT HANDLES READ FAILURE.       @Y30LB31*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  0684
*       END;                        /*                       @Y30LB31*/
*                                                                  0684
@RF00682 DS    0H                                                  0685
*   /*****************************************************************/
*   /*                                                               */
*   /* RESTORE REG 14 WITH THE RETURN ADDRESS OF CALLER,     @Y30LB31*/
*   /* VTYPERTN. EXIT FROM RVVIRTN PASSING CONDITION CODE IN REG 15. */
*   /*                                                       @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0685
*   RESPECIFY                                                      0685
*     REG14 RSTD;                   /*                       @ZDR2054*/
@RC00645 DS    0H                                                  0685
@RF00644 DS    0H                                                  0686
*   REG14=RETADDR3;                 /*                       @Y30LB31*/
         L     REG14,RETADDR3                                      0686
*   RESPECIFY                                                      0687
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   RETURN CODE(RVRTNRC);           /*                       @Y30LB31*/
         LR    @15,RVRTNRC                                         0688
@EL00004 DS    0H                                                  0688
@EF00004 DS    0H                                                  0688
@ER00004 BR    @14                                                 0688
*   END RVVIRTN;                    /*                       @Y30LB31*/
*                                                                  0690
*/********************************************************** @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* PROCEDURE NAME - VOLCKRTN                                @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* FUNCTION - CHECKS THE VOLUME RECORD FOR CONFLICTS THAT   @Y30LB31*/
*/*            PROHIBIT ACTIVATING THE VOLUME.  ISSUES       @Y30LB31*/
*/*            MESSAGES IDC3720I, IDC3067I, IDC3097I,        @Y30LB31*/
*/*            IDC3096I, IDC3095I, IDC3721I AND IDC2764I     @ZDR2054*/
*/*            FOR THE PARTICULAR ERROR THAT EXISTS.         @ZDR2054*/
*/*                                                          @Y30LB31*/
*/* INPUT - FDTTBL, BCDV (COMMON RECORD FORMAT), COPYV,      @Y30LB31*/
*/*         PRINTTBL, BASEV                                  @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* OUTPUT - RET CODE OF 0 INDICATES SUCCESSFUL CHECKOUT.  @Y30LB31  */
*/*          RETURN CODE OF 4 INDICATES A CONFLICT EXISTS.   @Y30LB31*/
*/*          VOLUME CANNOT BE ACTIVATED.  APPROPRIATE MSGS   @Y30LB31*/
*/*          WERE ISSUED.                                    @Y30LB31*/
*/*                                                          @Y30LB31*/
*/********************************************************** @Y30LB31*/
*                                                                  0690
*VOLCKRTN:                                                         0690
*   PROCEDURE OPTIONS(NOSAVEAREA,NOSAVE);/*                  @Y30LB31*/
*                                                                  0690
VOLCKRTN DS    0H                                                  0691
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL CONDITION CODE.                                 @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0691
*   DCL                                                            0691
*     VOLCKRC FIXED(15);            /*                       @Y30LB31*/
*                                                                  0691
*   /*****************************************************************/
*   /*                                                               */
*   /* SAVE CALLERS RETURN ADDR SINCE THERE IS NO SAVE       @Y30LB31*/
*   /* AREA. REG 14 WILL BE RESTORED UPON EXIT FROM THIS PROC.       */
*   /*                                                       @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0692
*   RESPECIFY                                                      0692
*     REG14 RSTD;                   /*                       @ZDR2054*/
*   RETADDR3=REG14;                 /*                       @Y30LB31*/
         ST    REG14,RETADDR3                                      0693
*   RESPECIFY                                                      0694
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   OLDERID2=NEWERID2;                                             0695
         L     @15,@PC00001                                        0695
         L     @14,GDTTR2(,@15)                                    0695
         MVC   @TS00001(95),NEWERID2(@14)                          0695
         MVC   OLDERID2(95,@14),@TS00001                           0695
*   NEWID2='AVVO';                  /*                       @Y30LB31*/
*                                                                  0696
         MVC   NEWID2(4,@14),@CC01824                              0696
*   /*****************************************************************/
*   /*                                                               */
*   /* INITIALIZE TO ZERO THE COND CODE SET BY THIS PROC.    @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0697
*   VOLCKRC=LASTCC00;               /*                       @Y30LB31*/
*                                                                  0697
         SLR   VOLCKRC,VOLCKRC                                     0697
*   /*****************************************************************/
*   /*                                                               */
*   /* ISSUE AN ERROR MESSAGE AND EXIT FROM THIS PROCEDURE   @Y30LB31*/
*   /* IF THE VOLUME TO BE ACTIVATED                         @Y30LB31*/
*   /* IS A BASE VOLUME THAT IS ALREADY ACTIVE. THE ACTIVE   @Y30LB31*/
*   /* STATUS OF OTHER VOLUME TYPES IS NOT CHECKED SINCE IT IS       */
*   /*                                                       @Y30LB31*/
*   /* NOT MAINTAINED IN THE MSVI BECAUSE BY DEFINITION THESE VOL    */
*   /*                                                       @Y30LB31*/
*   /* TYPES ARE ALWAYS INACTIVE.                            @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0698
*   IF BCDBASE=ON&BASINAC=OFF THEN  /*                       @Y30LB31*/
         TM    BCDBASE(BCDVPTR),B'00100000'                        0698
         BNO   @RF00698                                            0698
         TM    BASINAC(BASEVPTR),B'00000100'                       0698
         BNZ   @RF00698                                            0698
*     DO;                           /*                       @Y30LB31*/
*       VOLCKRC=4;                  /*                       @Y30LB31*/
         LA    VOLCKRC,4                                           0700
*       PRINTTBL=''B;               /*                       @Y30LB31*/
         XC    PRINTTBL(28),PRINTTBL                               0701
*       DARGSMOD=ADDVMSGS;          /*                       @Y30LB31*/
         L     @14,DDSTRU                                          0702
         MVC   DARGSMOD(3,@14),@CC01687                            0702
*       DARGSENT=MSG3721I;          /* STID=AV02             @Y30LB31*/
         MVI   DARGSENT(@14),X'02'                                 0703
*       DARGDBP=ADDR(VOLVAL);       /*                       @Y30LB31*/
         L     @03,@PC00001+4                                      0704
         L     @03,FDTPTR(,@03)                                    0704
         LA    @02,VOLVAL(,@03)                                    0704
         ST    @02,DARGDBP(,@14)                                   0704
*       DARGILP=VOLLEN;             /*                       @Y30LB31*/
         SLR   @02,@02                                             0705
         IC    @02,VOLLEN(,@03)                                    0705
         STH   @02,DARGILP(,@14)                                   0705
*       CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*              @Y30LB31*/
         ST    @15,@AL00001                                        0706
         LA    @14,@CF00117                                        0706
         ST    @14,@AL00001+4                                      0706
         LA    @14,DDSTRU                                          0706
         ST    @14,@AL00001+8                                      0706
         MVI   @AL00001+8,X'80'                                    0706
         L     @15,GDTPRT(,@15)                                    0706
         LA    @01,@AL00001                                        0706
         BALR  @14,@15                                             0706
*     END;                          /*                       @Y30LB31*/
*   ELSE                            /*                       @Y30LB31*/
*     DO;                           /*                       @Y30LB31*/
*                                                                  0708
         B     @RC00698                                            0708
@RF00698 DS    0H                                                  0709
*       /*************************************************************/
*       /*                                                           */
*       /* ISSUE AN ERROR MSG IF A COPY IS TO BE ACTIVATED THAT      */
*       /*                                                   @Y30LB31*/
*       /* IS OWNED BY VSAM, BUT DOES NOT REPLACE A BASE VOLUME,     */
*       /*                                                   @ZDR2054*/
*       /* THEN EXIT FROM THIS PROC.                         @ZDR2054*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0709
*       IF BCDCOPY=ON&COPVSAM=ON&ADDR(RVOL)=NULLPTR THEN/*   @ZDR2054*/
         TM    BCDCOPY(BCDVPTR),B'00010000'                        0709
         BNO   @RF00709                                            0709
         L     @01,COPYVPTR                                        0709
         TM    COPVSAM(@01),B'01000000'                            0709
         BNO   @RF00709                                            0709
         L     @15,@PC00001+4                                      0709
         L     @14,FDTPTR+36(,@15)                                 0709
         LTR   @14,@14                                             0709
         BNZ   @RF00709                                            0709
*         DO;                       /*                       @Y30LB31*/
*           VOLCKRC=4;              /*                       @Y30LB31*/
         LA    VOLCKRC,4                                           0711
*           PRINTTBL=''B;           /*                       @Y30LB31*/
         XC    PRINTTBL(28),PRINTTBL                               0712
*           DARGSMOD=COMMSGS;       /*                       @Y30LB31*/
         L     @14,DDSTRU                                          0713
         MVC   DARGSMOD(3,@14),@CC01697                            0713
*           DARGSENT=MSG3067I;      /* STID=CM041            @Y30LB31*/
         MVI   DARGSENT(@14),X'29'                                 0714
*           DARGDBP=ADDR(VOLVAL);   /*                       @Y30LB31*/
         L     @15,FDTPTR(,@15)                                    0715
         LA    @03,VOLVAL(,@15)                                    0715
         ST    @03,DARGDBP(,@14)                                   0715
*           DARGILP=VOLLEN;         /*                       @Y30LB31*/
         SLR   @03,@03                                             0716
         IC    @03,VOLLEN(,@15)                                    0716
         STH   @03,DARGILP(,@14)                                   0716
*           CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*          @Y30LB31*/
         L     @15,@PC00001                                        0717
         ST    @15,@AL00001                                        0717
         LA    @14,@CF00117                                        0717
         ST    @14,@AL00001+4                                      0717
         LA    @14,DDSTRU                                          0717
         ST    @14,@AL00001+8                                      0717
         MVI   @AL00001+8,X'80'                                    0717
         L     @15,GDTPRT(,@15)                                    0717
         LA    @01,@AL00001                                        0717
         BALR  @14,@15                                             0717
*         END;                      /*                       @Y30LB31*/
*       ELSE                        /*                       @Y30LB31*/
*         DO;                       /*                       @Y30LB31*/
*                                                                  0719
         B     @RC00709                                            0719
@RF00709 DS    0H                                                  0720
*           /*********************************************************/
*           /*                                                       */
*           /* ISSUE AN ERROR MSG IF A DUPLICATE IS TO BE    @ZDR2054*/
*           /* ACTIVATED BUT A NEW VOL SERIAL NO. WAS NOT SPECIFIED. */
*           /*                                               @ZDR2054*/
*           /* ISSUE AN ERROR MSG IF A COPY IS TO BE ACTIVATED,      */
*           /*                                               @ZDR2054*/
*           /* BUT NEITHER NEW SERIAL NUMBER OR REPLACE A BASE       */
*           /*                                               @ZDR2054*/
*           /* VOLUME WAS SPECIFIED.                         @ZDR2054*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  0720
*           IF(BCDDUP=ON&ADDR(NSER)=NULLPTR)×/*              @ZDR2054*/
*               (BCDCOPY=ON&(ADDR(NSER)=NULLPTR&ADDR(RVOL)=NULLPTR))
*             THEN                                                 0720
         TM    BCDDUP(BCDVPTR),B'00000100'                         0720
         BNO   @GL00016                                            0720
         L     @15,@PC00001+4                                      0720
         L     @15,FDTPTR+20(,@15)                                 0720
         LTR   @15,@15                                             0720
         BZ    @RT00720                                            0720
@GL00016 TM    BCDCOPY(BCDVPTR),B'00010000'                        0720
         BNO   @RF00720                                            0720
         SLR   @15,@15                                             0720
         L     @14,@PC00001+4                                      0720
         C     @15,FDTPTR+20(,@14)                                 0720
         BNE   @RF00720                                            0720
         C     @15,FDTPTR+36(,@14)                                 0720
         BNE   @RF00720                                            0720
@RT00720 DS    0H                                                  0721
*             DO;                   /*                       @Y30LB31*/
*               VOLCKRC=4;          /*                       @Y30LB31*/
         LA    VOLCKRC,4                                           0722
*               PRINTTBL=''B;       /*                       @Y30LB31*/
         XC    PRINTTBL(28),PRINTTBL                               0723
*               DARGSMOD=ADDVMSGS;  /*                       @Y30LB31*/
         L     @15,DDSTRU                                          0724
         MVC   DARGSMOD(3,@15),@CC01687                            0724
*               DARGSENT=MSG3720I;  /* STID=AV01             @Y30LB31*/
         MVI   DARGSENT(@15),X'01'                                 0725
*               DARGDBP=ADDR(VOLVAL);/*                      @Y30LB31*/
         L     @14,@PC00001+4                                      0726
         L     @14,FDTPTR(,@14)                                    0726
         LA    @03,VOLVAL(,@14)                                    0726
         ST    @03,DARGDBP(,@15)                                   0726
*               DARGILP=VOLLEN;     /*                       @Y30LB31*/
         SLR   @03,@03                                             0727
         IC    @03,VOLLEN(,@14)                                    0727
         STH   @03,DARGILP(,@15)                                   0727
*               CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*      @Y30LB31*/
         L     @15,@PC00001                                        0728
         ST    @15,@AL00001                                        0728
         LA    @14,@CF00117                                        0728
         ST    @14,@AL00001+4                                      0728
         LA    @14,DDSTRU                                          0728
         ST    @14,@AL00001+8                                      0728
         MVI   @AL00001+8,X'80'                                    0728
         L     @15,GDTPRT(,@15)                                    0728
         LA    @01,@AL00001                                        0728
         BALR  @14,@15                                             0728
*             END;                  /*                       @Y30LB31*/
*                                                                  0729
*           /*********************************************************/
*           /*                                                       */
*           /* CHECK FOR ACTIVATE OF A COPY VOLUME           @ZDR2054*/
*           /* THAT REPLACES A BASE VOLUME.                  @ZDR2054*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  0730
*           IF ADDR(RVOL)^=NULLPTR THEN                            0730
@RF00720 SLR   @15,@15                                             0730
         L     @14,@PC00001+4                                      0730
         C     @15,FDTPTR+36(,@14)                                 0730
         BE    @RF00730                                            0730
*             DO;                   /*                       @ZDR2054*/
*                                                                  0731
*               /*****************************************************/
*               /*                                                   */
*               /* CHECK FOR CARTRIDGES REASSIGNED.          @ZDR2054*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  0732
*               IF BASREASS=OFF THEN/*                       @ZA17143*/
         TM    BASREASS(BASEVPTR),B'00100000'                      0732
         BNZ   @RF00732                                            0732
*                 DO;               /* NOT REASS             @ZDR2054*/
*                                                                  0733
*                   /*************************************************/
*                   /*                                               */
*                   /* CHECK FOR CARTRIDGES NOT IN THE MSF.  @ZDR2054*/
*                   /*                                               */
*                   /*************************************************/
*                                                                  0734
*                   IF BASLIB1=NULLIB&/*                     @ZA17143*/
*                       BASLIB2=NULLIB THEN/*                @ZA17143*/
         CLI   BASLIB1(BASEVPTR),255                               0734
         BNE   @RF00734                                            0734
         CLI   BASLIB2(BASEVPTR),255                               0734
         BNE   @RF00734                                            0734
*                     DO;           /*                       @ZDR2054*/
*                                                                  0735
*                       /*********************************************/
*                       /*                                           */
*                       /* INITIALIZE THE DEFLIST FOR RENAME OF THE  */
*                       /*                                   @ZDR2054*/
*                       /* BASE VOLUME TO ITSELF.            @ZDR2054*/
*                       /*                                           */
*                       /*********************************************/
*                                                                  0736
*                       AVDEFV=''B; /*                       @ZDR2054*/
         XC    AVDEFV(132),AVDEFV                                  0736
*                       DEFVRNTR=ON;/*                       @ZDR2054*/
         L     @14,DEFVPTR                                         0737
         OI    DEFVRNTR(@14),B'00000100'                           0737
*                       DEFVVFLG=NOCHANGE;/*                 @ZDR2054*/
         MVI   DEFVVFLG(@14),X'FF'                                 0738
*                       DEFVOLD=BASSERNO;/*                  @ZA17143*/
         MVC   DEFVOLD(6,@14),BASSERNO(BASEVPTR)                   0739
*                       DEFVNVOL=BASSERNO;/*                 @ZA17143*/
         MVC   DEFVNVOL(6,@14),BASSERNO(BASEVPTR)                  0740
*                       DEFVCSN1=BASCSN1;/*                  @ZA17143*/
*                                                                  0741
         MVC   DEFVCSN1(12,@14),BASCSN1(BASEVPTR)                  0741
*                       /*********************************************/
*                       /*                                           */
*                       /* INSURE CARTRIDGES NOT ENTERED WHILE       */
*                       /*                                   @ZDR2054*/
*                       /* MSVC WAS DISABLED.                @ZDR2054*/
*                       /*                                           */
*                       /*********************************************/
*                                                                  0742
*                                                                  0742
*                       /*********************************************/
*                       /*                                           */
*                       /* DUMP OF INITIALIZED PARM LIST FOR MSVC    */
*                       /* DEFINE MACRO                      @ZDR2054*/
*                       /*                                           */
*                       /*********************************************/
*                                                                  0742
*                       IF GDTDBG=NULLPTR THEN                     0742
         L     @14,@PC00001                                        0742
         C     @15,GDTDBG(,@14)                                    0742
         BE    @RT00742                                            0742
*                         ;                                        0743
*                       ELSE                                       0744
*                         DO;                                      0744
*                           DMPINDEX=ADDR(AVDMPLST);/*       @ZDR2054*/
         LA    DMPINDEX,AVDMPLST                                   0745
*                           DMPITMNM='AV01DEFV';                   0746
         MVC   DMPITMNM(8,DMPINDEX),@CC01826                       0746
*                           DMPITMPT=ADDR(AV01DEFV);               0747
         LA    @03,AV01DEFV                                        0747
         ST    @03,DMPITMPT(,DMPINDEX)                             0747
*                           DMPITMLN=LENGTH(AV01DEFV);             0748
         MVC   DMPITMLN(2,DMPINDEX),@CH02000                       0748
*                           DMPITMTP='H';                          0749
         MVI   DMPITMTP(DMPINDEX),C'H'                             0749
*                           DMPINDEX=DMPINDEX+DMPELEMT;            0750
*                                                                  0750
         LA    @03,16                                              0750
         ALR   DMPINDEX,@03                                        0750
*                           /*****************************************/
*                           /*                                       */
*                           /*                               @ZDR2054*/
*                           /*                                       */
*                           /*****************************************/
*                                                                  0751
*                           DMPITMNM='ADDVTBL';                    0751
         MVI   DMPITMNM+7(DMPINDEX),C' '                           0751
         MVC   DMPITMNM(7,DMPINDEX),@CC01766                       0751
*                           DMPITMPT=ADDR(ADDVTBL);                0752
         LA    @15,ADDVTBL                                         0752
         ST    @15,DMPITMPT(,DMPINDEX)                             0752
*                           DMPITMLN=LENGTH(ADDVTBL);              0753
         MVC   DMPITMLN(2,DMPINDEX),@CH01999                       0753
*                           DMPITMTP='H';                          0754
         MVI   DMPITMTP(DMPINDEX),C'H'                             0754
*                           DMPINDEX=DMPINDEX+DMPELEMT;/*    @ZDR2054*/
         ALR   DMPINDEX,@03                                        0755
*                           DMPTRM=DMPTRMVL;                       0756
         MVI   DMPTRM(DMPINDEX),X'FF'                              0756
*                         END;      /*                       @ZDR2054*/
*                       IF GDTDBG=NULLPTR THEN                     0758
@RT00742 L     @15,@PC00001                                        0758
         L     @15,GDTDBG(,@15)                                    0758
         LTR   @15,@15                                             0758
         BZ    @RT00758                                            0758
*                         ;                                        0759
*                       ELSE                                       0760
*                         CALL IDCDB010(GDTTBL,'AVRN',ADDR(AVDMPLST));
         L     @15,@PC00001                                        0760
         ST    @15,@AL00001                                        0760
         LA    @14,@CC01827                                        0760
         ST    @14,@AL00001+4                                      0760
         LA    @14,AVDMPLST                                        0760
         ST    @14,@AFTEMPS+4                                      0760
         LA    @14,@AFTEMPS+4                                      0760
         ST    @14,@AL00001+8                                      0760
         MVI   @AL00001+8,X'80'                                    0760
         L     @15,GDTDBG(,@15)                                    0760
         LA    @01,@AL00001                                        0760
         BALR  @14,@15                                             0760
*                                   /*                       @ZDR2054*/
*                                                                  0761
*                       /*********************************************/
*                       /*                                           */
*                       /* ISSUE THE USSC MACRO TO INVOKE THE ICBDEFV*/
*                       /* (DEFINE) MACRO TO PERFORM A RENAME OF THE */
*                       /* VOLUME TO ITSELF TO TEST WHETHER THE      */
*                       /* CARTRIDGES ARE IN THE LIBRARY.    @ZDR2054*/
*                       /*                                           */
*                       /*********************************************/
*                                                                  0761
*                       CALL IDCSASS0(GDTTBL,DEFINE,DEFVPTR,REASON,
*                           ECBCODE);/*                      @ZDR2054*/
@RT00758 L     @02,@PC00001                                        0761
         ST    @02,@AL00001                                        0761
         LA    @15,DEFINE                                          0761
         ST    @15,@AL00001+4                                      0761
         LA    @15,DEFVPTR                                         0761
         ST    @15,@AL00001+8                                      0761
         LA    @15,REASON                                          0761
         ST    @15,@AL00001+12                                     0761
         LA    @15,ECBCODE                                         0761
         ST    @15,@AL00001+16                                     0761
         MVI   @AL00001+16,X'80'                                   0761
         L     @15,GDTSSC(,@02)                                    0761
         LA    @01,@AL00001                                        0761
         BALR  @14,@15                                             0761
*                       RESPECIFY                                  0762
*                         RTNREG RSTD;                             0762
*                       TESTRC=RTNREG;                             0763
         LR    TESTRC,RTNREG                                       0763
*                       RESPECIFY                                  0764
*                         RTNREG UNRSTD;/*                   @ZDR2054*/
*                                                                  0764
*                       /*********************************************/
*                       /*                                           */
*                       /* IF ANY CARTRIDGES WERE FOUND, THE MESSAGE:*/
*                       /* CARTRIDGES STILL IN MASS STORAGE FACILITY */
*                       /* IS WRITTEN AND THE RETURN CODE IS SET TO  */
*                       /* 4.                                @ZDR2054*/
*                       /*                                           */
*                       /*********************************************/
*                                                                  0765
*                       IF TESTRC=0×(TESTRC=4&REASON=NOCSN1)×/*    0765
*                                                            @ZDR2054*/
*                           (TESTRC=4&REASON=NOCSN2) THEN/*  @ZDR2054*/
         LTR   TESTRC,TESTRC                                       0765
         BZ    @RT00765                                            0765
         C     TESTRC,@CF00043                                     0765
         BNE   @GL00021                                            0765
         CLC   REASON(4),@CF01682                                  0765
         BE    @RT00765                                            0765
@GL00021 C     TESTRC,@CF00043                                     0765
         BNE   @RF00765                                            0765
         CLC   REASON(4),@CF01684                                  0765
         BNE   @RF00765                                            0765
@RT00765 DS    0H                                                  0766
*                         DO;       /*                       @ZDR2054*/
*                           VOLCKRC=4;/*                     @ZDR2054*/
         LA    VOLCKRC,4                                           0767
*                           PRINTTBL=''B;/*                  @ZDR2054*/
         XC    PRINTTBL(28),PRINTTBL                               0768
*                           DARGSMOD=ADDVMSGS;/*             @ZDR2054*/
         L     @15,DDSTRU                                          0769
         MVC   DARGSMOD(3,@15),@CC01687                            0769
*                           DARGSENT=MSG2764I;/* STID=AV08   @ZDR2054*/
         MVI   DARGSENT(@15),X'08'                                 0770
*                           CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*
*                                                            @ZDR2054*/
         L     @15,@PC00001                                        0771
         ST    @15,@AL00001                                        0771
         LA    @14,@CF00117                                        0771
         ST    @14,@AL00001+4                                      0771
         LA    @14,DDSTRU                                          0771
         ST    @14,@AL00001+8                                      0771
         MVI   @AL00001+8,X'80'                                    0771
         L     @15,GDTPRT(,@15)                                    0771
         LA    @01,@AL00001                                        0771
         BALR  @14,@15                                             0771
*                         END;      /*                       @ZDR2054*/
*                                                                  0772
*                       /*********************************************/
*                       /*                                           */
*                       /* IF DEFINE FAILED BECAUSE OF INSUFFICIENT  */
*                       /* STORAGE, THE CONDITION CODE IS SET TO 4.  */
*                       /*                                   @ZDR2054*/
*                       /*                                           */
*                       /*********************************************/
*                                                                  0773
*                       ELSE        /*                       @ZDR2054*/
*                         IF TESTRC=8 THEN/*                 @ZDR2054*/
         B     @RC00765                                            0773
@RF00765 C     TESTRC,@CF00182                                     0773
         BNE   @RF00773                                            0773
*                           VOLCKRC=LASTCC04;/*              @ZDR2054*/
*                                                                  0774
         LA    VOLCKRC,4                                           0774
*                       /*********************************************/
*                       /*                                           */
*                       /* CLOSE DO GROUP WHICH CHECKS CARTS NOT IN  */
*                       /* MSF.                              @ZDR2054*/
*                       /*                                           */
*                       /*********************************************/
*                                                                  0775
*                     END;          /*                       @ZDR2054*/
*                                                                  0775
*                   /*************************************************/
*                   /*                                               */
*                   /* IF THE CARTRIDGES ARE IN THE MSF OR ARE       */
*                   /*                                       @ZDR2054*/
*                   /* NOT REASSIGNED ISSUE MESSAGE: UNABLE TO       */
*                   /*                                       @ZDR2054*/
*                   /* REPLACE THE BASE VOLUME. SET THE      @ZDR2054*/
*                   /* RETURN CODE TO 4.                     @ZDR2054*/
*                   /*                                               */
*                   /*************************************************/
*                                                                  0776
*                   ELSE                                           0776
*                     DO;           /*                       @ZDR2054*/
         B     @RC00734                                            0776
@RF00734 DS    0H                                                  0777
*                       VOLCKRC=4;  /*                       @ZDR2054*/
         LA    VOLCKRC,4                                           0777
*                       PRINTTBL=''B;/*                      @ZDR2054*/
         XC    PRINTTBL(28),PRINTTBL                               0778
*                       DARGSMOD=ADDVMSGS;/*                 @ZDR2054*/
         L     @15,DDSTRU                                          0779
         MVC   DARGSMOD(3,@15),@CC01687                            0779
*                       DARGSENT=MSG3726I;/* STID=AV07       @ZDR2054*/
         MVI   DARGSENT(@15),X'07'                                 0780
*                       CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*    0781
*                                                            @ZDR2054*/
         L     @15,@PC00001                                        0781
         ST    @15,@AL00001                                        0781
         LA    @14,@CF00117                                        0781
         ST    @14,@AL00001+4                                      0781
         LA    @14,DDSTRU                                          0781
         ST    @14,@AL00001+8                                      0781
         MVI   @AL00001+8,X'80'                                    0781
         L     @15,GDTPRT(,@15)                                    0781
         LA    @01,@AL00001                                        0781
         BALR  @14,@15                                             0781
*                     END;          /*                       @ZDR2054*/
*                                                                  0782
*                   /*************************************************/
*                   /*                                               */
*                   /* CLOSE DO GROUP WHICH CHECKS FOR CARTS         */
*                   /* REASSIGNED.                           @ZDR2054*/
*                   /*                                               */
*                   /*************************************************/
*                                                                  0783
*                 END;              /*                       @ZDR2054*/
*                                                                  0783
@RC00734 DS    0H                                                  0784
*               /*****************************************************/
*               /*                                                   */
*               /* CLOSE DO GROUP WHICH CHECKS FOR BASE      @ZDR2054*/
*               /* VOLUME REPLACEMENT.                       @ZDR2054*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  0784
*             END;                  /*                       @ZDR2054*/
*                                                                  0784
@RF00732 DS    0H                                                  0785
*           /*********************************************************/
*           /*                                                       */
*           /* ISSUE AN ERROR MSG IF THE VOLUME IS FLAGGED FOR       */
*           /*                                               #Y30LB31*/
*           /* RECOVERY REASONS AS UNUSABLE.                 #Y30LB31*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  0785
*           IF BCDSATIA^=ZEROES THEN/*                       @Y30LB31*/
@RF00730 CLC   BCDSATIA(2,BCDVPTR),@CB01654                        0785
         BE    @RF00785                                            0785
*             DO;                   /*                       #Y30LB31*/
*               PRINTTBL=''B;       /*                       #Y30LB31*/
         XC    PRINTTBL(28),PRINTTBL                               0787
*               DARGSMOD=COMMSGS;   /*                       #Y30LB31*/
         L     @15,DDSTRU                                          0788
         MVC   DARGSMOD(3,@15),@CC01697                            0788
*               DARGDBP=ADDR(VOLVAL);/*                      #Y30LB31*/
         L     @14,@PC00001+4                                      0789
         L     @14,FDTPTR(,@14)                                    0789
         LA    @03,VOLVAL(,@14)                                    0789
         ST    @03,DARGDBP(,@15)                                   0789
*               DARGILP=VOLLEN;     /*                       #Y30LB31*/
*                                                                  0790
         SLR   @03,@03                                             0790
         IC    @03,VOLLEN(,@14)                                    0790
         STH   @03,DARGILP(,@15)                                   0790
*               /*****************************************************/
*               /*                                                   */
*               /* ISSUE MSG IDC3097I IF THE VOLUME IS INCOMPLETELY  */
*               /*                                           @Y30LB31*/
*               /* CREATED.                                  @Y30LB31*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  0791
*               IF BCDIVCRE=ON THEN /*                       @Y30LB31*/
         TM    BCDIVCRE(BCDVPTR),B'10000000'                       0791
         BNO   @RF00791                                            0791
*                 DO;               /*                       @Y30LB31*/
*                   VOLCKRC=4;      /*                       @Y30LB31*/
         LA    VOLCKRC,4                                           0793
*                   DARGSENT=MSG3097I;/* STID=CM03           @Y30LB31*/
         MVI   DARGSENT(@15),X'03'                                 0794
*                 END;              /*                       @Y30LB31*/
*                                                                  0795
*               /*****************************************************/
*               /*                                                   */
*               /* ISSUE MSG IDC3096I IF THE VOLUME IS AN    @Y30LB31*/
*               /* INCOMPLETE COPY.                          @Y30LB31*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  0796
*               ELSE                /*                       @Y30LB31*/
*                 IF BCDIVCPY=ON THEN/*                      @Y30LB31*/
         B     @RC00791                                            0796
@RF00791 TM    BCDIVCPY(BCDVPTR),B'01000000'                       0796
         BNO   @RF00796                                            0796
*                   DO;             /*                       @Y30LB31*/
*                     VOLCKRC=4;    /*                       @Y30LB31*/
         LA    VOLCKRC,4                                           0798
*                     DARGSENT=MSG3096I;/* STID=CM06         @Y30LB31*/
         L     @01,DDSTRU                                          0799
         MVI   DARGSENT(@01),X'06'                                 0799
*                   END;            /*                       @Y30LB31*/
*                                                                  0800
*               /*****************************************************/
*               /*                                                   */
*               /* ISSUE MSG IDC3095I IF THE VOLUME HAS A SERIAL     */
*               /*                                           @Y30LB31*/
*               /* MISMATCH AND A NEW SERIAL WAS NOT SPECIFIED.      */
*               /*                                           @Y30LB31*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  0801
*                 ELSE              /*                       @Y30LB31*/
*                   IF BCDVSMIS=ON&ADDR(NSER)=NULLPTR THEN/* @Y30LB31*/
         B     @RC00796                                            0801
@RF00796 TM    BCDVSMIS(BCDVPTR),B'00100000'                       0801
         BNO   @RF00801                                            0801
         L     @15,@PC00001+4                                      0801
         L     @15,FDTPTR+20(,@15)                                 0801
         LTR   @15,@15                                             0801
         BNZ   @RF00801                                            0801
*                     DO;           /*                       @Y30LB31*/
*                       VOLCKRC=4;  /*                       @Y30LB31*/
         LA    VOLCKRC,4                                           0803
*                       DARGSENT=MSG3095I;/* STID = CM09     @Y30LB31*/
         L     @01,DDSTRU                                          0804
         MVI   DARGSENT(@01),X'09'                                 0804
*                     END;          /*                       @Y30LB31*/
*                                                                  0805
*               /*****************************************************/
*               /*                                                   */
*               /* PRINT THE APPROPRIATE MESSAGE IF THE VOLUME IS    */
*               /*                                           @Y30LB31*/
*               /* FLAGGED FOR A CONDITION FROM WHICH ADDV CANNOT    */
*               /* RECOVER.                                  @Y30LB31*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  0806
*               IF DARGSENT^=0 THEN /*                       @Y30LB31*/
@RF00801 DS    0H                                                  0806
@RC00796 DS    0H                                                  0806
@RC00791 L     @01,DDSTRU                                          0806
         CLI   DARGSENT(@01),0                                     0806
         BE    @RF00806                                            0806
*                 CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*    @Y30LB31*/
         L     @15,@PC00001                                        0807
         ST    @15,@AL00001                                        0807
         LA    @14,@CF00117                                        0807
         ST    @14,@AL00001+4                                      0807
         LA    @14,DDSTRU                                          0807
         ST    @14,@AL00001+8                                      0807
         MVI   @AL00001+8,X'80'                                    0807
         L     @15,GDTPRT(,@15)                                    0807
         LA    @01,@AL00001                                        0807
         BALR  @14,@15                                             0807
*             END;                  /*                       @Y30LB31*/
@RF00806 DS    0H                                                  0809
*         END;                      /*                       @Y30LB31*/
@RF00785 DS    0H                                                  0810
*     END;                          /*                       @Y30LB31*/
*                                                                  0810
@RC00709 DS    0H                                                  0811
*   /*****************************************************************/
*   /*                                                               */
*   /* RESTORE REG 14 WITH THE RETURN ADDRESS OF THE CALLER  @Y30LB31*/
*   /* AND EXIT FROM VOLCKRTN. PASS THE CONDITION CODE IN REG 15.    */
*   /*                                                       @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0811
*   RESPECIFY                                                      0811
*     REG14 RSTD;                   /*                       @ZDR2054*/
@RC00698 DS    0H                                                  0812
*   REG14=RETADDR3;                 /*                       @Y30LB31*/
         L     REG14,RETADDR3                                      0812
*   RESPECIFY                                                      0813
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   RETURN CODE(VOLCKRC);           /*                       @Y30LB31*/
         LR    @15,VOLCKRC                                         0814
@EL00005 DS    0H                                                  0814
@EF00005 DS    0H                                                  0814
@ER00005 BR    @14                                                 0814
*   END VOLCKRTN;                   /*                       @Y30LB31*/
*                                                                  0816
*/********************************************************** @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* PROCEDURE NAME - RWCKRTN                                 @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* FUNCTION - CHECKS THE CURRENT VOLUME MOUNTING ATTR       @Y30LB31*/
*/*            BUTES TO INSURE THERE IS NO READ ONLY         @Y30LB31*/
*/*            CONFLICT WHICH PREVENTS THE VOLUME SERIAL     @Y30LB31*/
*/*            NO. FROM BEING CHANGED.  CALLS RENAMRTN TO    @Y30LB31*/
*/*            OBTAIN THE VOLUME ATTRIBUTES.  ISSUES MSG    @Y30LB31 */
*/*            IDC3090I.                                     @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* INPUT - FDTTBL, PRINTTBL FOR MESSAGES, CMMSG FOR MSSC    @Y30LB31*/
*/*         MESSAGE WHICH CONTAINS VOLUME ATTRIBUTES,        @Y30LB31*/
*/*         BASEV AND BCDV FOR VOLUME RECORD,             @Y30LB31   */
*/*         GROUP RECORD.                                    @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* OUTPUT- RETURN CODE OF 0 INDICATES ATTRIBUTE CHECKOUT    @Y30LB31*/
*/*         SUCCESSFUL AND ATTRIBUTES RECORDED IN ADDVTBL.   @Y30LB31*/
*/*         RETURN CODE OF 4 INDICATES -                     @Y30LB31*/
*/*         (1) VOLUME ATTRIBUTES COULD NOT BE OBTAINED      @Y30LB31*/
*/*         (2) READ WRITE REQUIRED BUT NOT SPECIFIED,       @Y30LB31*/
*/*         (3) READ WRITE SPECIFIED BUT GROUP IS READ ONLY  @Y30LB31*/
*/*                                                          @Y30LB31*/
*/********************************************************** @Y30LB31*/
*                                                                  0816
*RWCKRTN:                                                          0816
*   PROCEDURE OPTIONS(NOSAVEAREA,NOSAVE);/*                  @Y30LB31*/
*                                                                  0816
RWCKRTN  DS    0H                                                  0817
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL CONDITION CODE.                                 @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0817
*   DCL                                                            0817
*     RWCKRC FIXED(15);             /*                       @Y30LB31*/
*                                                                  0817
*   /*****************************************************************/
*   /*                                                               */
*   /* SAVE THE RETURN ADDRESS OF CALLER SINCE THERE IS NO   @Y30LB31*/
*   /* SAVEAREA. REG 14 WILL BE RESTORED UPON EXIT.          @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0818
*   RESPECIFY                                                      0818
*     REG14 RSTD;                   /*                       @ZDR2054*/
*   RETADDR2=REG14;                 /*                       @Y30LB31*/
         ST    REG14,RETADDR2                                      0819
*   RESPECIFY                                                      0820
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   OLDERID2=NEWERID2;                                             0821
         L     @05,@PC00001                                        0821
         L     @05,GDTTR2(,@05)                                    0821
         MVC   @TS00001(95),NEWERID2(@05)                          0821
         MVC   OLDERID2(95,@05),@TS00001                           0821
*   NEWID2='AVRW';                  /*                       @Y30LB31*/
*                                                                  0822
         MVC   NEWID2(4,@05),@CC01832                              0822
*   /*****************************************************************/
*   /*                                                               */
*   /* INITIALIZE TO ZERO THE CONDITION CODE USED WITHIN     @Y30LB31*/
*   /* THIS PROCEDURE.                                       @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0823
*   RWCKRC=LASTCC00;                /*                       @Y30LB31*/
*                                                                  0823
         SLR   RWCKRC,RWCKRC                                       0823
*   /*****************************************************************/
*   /*                                                               */
*   /* OBTAIN THE CURRENT VOLUME MOUNTING ATTRIBUTES FROM    @Y30LB31*/
*   /* THE MSSC MSG THAT IS RETURNED FROM THE FOLLOWING      @Y30LB31*/
*   /* RENAME REQUEST ISSUED BY RENAMRTN.                    @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0824
*   MSGFLG=ON;                      /*                       @Y30LB31*/
         OI    MSGFLG,B'00010000'                                  0824
*   RENAMTYP=DUMMY;                 /* IDENTIFY RENAME TYPE  @Y30LB31*/
         MVC   RENAMTYP(8),@CC01672                                0825
*   CALL RENAMRTN;                  /*                       @Y30LB31*/
         BAL   @14,RENAMRTN                                        0826
*   RESPECIFY                                                      0827
*     RTNREG RSTD;                                                 0827
*   TESTRC=RTNREG;                                                 0828
         LR    TESTRC,RTNREG                                       0828
*   RESPECIFY                                                      0829
*     RTNREG UNRSTD;                /*                       @Y30LB31*/
*                                                                  0829
*   /*****************************************************************/
*   /*                                                               */
*   /* TEST RETURN CODE FROM RENAMRTN. IF THE MSSC RENAME    @Y30LB31*/
*   /* ORDER FAILED, THE ATTRIBUTES WERE NOT RETURNED. UPDATE THE    */
*   /* CONDITION CODE. EXIT FROM THIS PROCEDURE.             @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0830
*   IF TESTRC^=0 THEN               /*                       @Y30LB31*/
         LTR   TESTRC,TESTRC                                       0830
         BZ    @RF00830                                            0830
*     RWCKRC=4;                     /*                       @Y30LB31*/
*                                                                  0831
         LA    RWCKRC,4                                            0831
*   /*****************************************************************/
*   /*                                                               */
*   /* THE VOLUMES ATTRIBUTES WERE SUCCESSFULLY OBTAINED.    @Y30LB31*/
*   /* CHECK FOR A READONLY - READWRITE CONFLICT. AN ERROR EXISTS IF */
*   /* (1) READWRITE WAS SPECIFIED FOR A READONLY GENERAL USE VOLUME */
*   /* AND THE GROUP IS ALSO READONLY OR (2) READWRITE WAS NOT       */
*   /* SPECIFIED FOR A VOLUME THAT IS READONLY AND IS A COPY OR      */
*   /* DUPLICATE OR BASE THAT IS NOT A GENERAL USE VOLUME. MESSAGE   */
*   /* IDC3090I IS PRINTED FOR THIS ERROR.                   @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0832
*   ELSE                            /*                       @Y30LB31*/
*     DO;                           /*                       @Y30LB31*/
         B     @RC00830                                            0832
@RF00830 DS    0H                                                  0833
*       CMMSGPTR=ECBMSPTR+ECBLEN;   /*                       @Y30LB31*/
         LA    CMMSGPTR,4                                          0833
         AL    CMMSGPTR,ECBMSPTR                                   0833
*       IF CMRONLY=ON THEN          /*                       @Y30LB31*/
         TM    CMRONLY(CMMSGPTR),B'00000010'                       0834
         BNO   @RF00834                                            0834
*         IF(BCDBASE=ON&BASGENUS=ON&GRORONLY=ON)×/*          @Y30LB31*/
*             ADDR(RWOPT)=NULLPTR&  /*                       @Y30LB31*/
*             (BCDCOPY=ON×BCDDUP=ON×(BCDBASE=ON&/*           @Y30LB31*/
*             BASGENUS=OFF)) THEN   /*                       @Y30LB31*/
         TM    BCDBASE(BCDVPTR),B'00100000'                        0835
         BNO   @GL00026                                            0835
         TM    BASGENUS(BASEVPTR),B'00010000'                      0835
         BNO   @GL00026                                            0835
         L     @05,GROUPPTR                                        0835
         TM    GRORONLY(@05),B'00010000'                           0835
         BO    @RT00835                                            0835
@GL00026 L     @05,@PC00001+4                                      0835
         L     @05,FDTPTR+24(,@05)                                 0835
         LTR   @05,@05                                             0835
         BNZ   @RF00835                                            0835
         TM    BCDCOPY(BCDVPTR),B'00010100'                        0835
         BNZ   @RT00835                                            0835
         TM    BCDBASE(BCDVPTR),B'00100000'                        0835
         BNO   @RF00835                                            0835
         TM    BASGENUS(BASEVPTR),B'00010000'                      0835
         BNZ   @RF00835                                            0835
@RT00835 DS    0H                                                  0836
*           DO;                     /*                       @Y30LB31*/
*             RWCKRC=4;             /*                       @Y30LB31*/
         LA    RWCKRC,4                                            0837
*             PRINTTBL=''B;         /*                       @Y30LB31*/
         XC    PRINTTBL(28),PRINTTBL                               0838
*             DARGSMOD=COMMSGS;     /*                       @Y30LB31*/
         L     @05,DDSTRU                                          0839
         MVC   DARGSMOD(3,@05),@CC01697                            0839
*             DARGSENT=MSG3090I;    /* STID=CM016            @Y30LB31*/
         MVI   DARGSENT(@05),X'10'                                 0840
*             DARGDBP=ADDR(VOLVAL); /*                       @Y30LB31*/
         L     @03,@PC00001+4                                      0841
         L     @03,FDTPTR(,@03)                                    0841
         LA    @15,VOLVAL(,@03)                                    0841
         ST    @15,DARGDBP(,@05)                                   0841
*             DARGILP=VOLLEN;       /*                       @Y30LB31*/
         SLR   @15,@15                                             0842
         IC    @15,VOLLEN(,@03)                                    0842
         STH   @15,DARGILP(,@05)                                   0842
*             CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*        @Y30LB31*/
         L     @05,@PC00001                                        0843
         ST    @05,@AL00001                                        0843
         LA    @03,@CF00117                                        0843
         ST    @03,@AL00001+4                                      0843
         LA    @03,DDSTRU                                          0843
         ST    @03,@AL00001+8                                      0843
         MVI   @AL00001+8,X'80'                                    0843
         L     @15,GDTPRT(,@05)                                    0843
         LA    @01,@AL00001                                        0843
         BALR  @14,@15                                             0843
*           END;                    /*                       @Y30LB31*/
*                                                                  0844
*       /*************************************************************/
*       /*                                                           */
*       /* SAVE THE CURRENT VOL ATTRIBUTES RETURNED IN THE MSSC      */
*       /*                                                   @Y30LB31*/
*       /* RENAME MESSAGE UNLESS A READONLY-READWRITE CONFLICT       */
*       /* EXISTS. NOTE THAT IDCAV01 HAS SET THE DEFAULT ATTRIBUTE   */
*       /* VALUES.                                           @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0845
*       IF RWCKRC=0 THEN            /*                       @Y30LB31*/
@RF00835 DS    0H                                                  0845
@RF00834 LTR   RWCKRC,RWCKRC                                       0845
         BNZ   @RF00845                                            0845
*         DO;                       /*                       @Y30LB31*/
*           IF CMDERAS=ON THEN      /*                       @Y30LB31*/
         TM    CMDERAS(CMMSGPTR),B'00100000'                       0847
         BNO   @RF00847                                            0847
*             OLDDEFLG=ON;          /* DERAS=ON, NDERAS=OFF  @Y30LB31*/
         OI    OLDDEFLG,B'01000000'                                0848
*           IF CMEXCL=ON THEN       /*                       @Y30LB31*/
@RF00847 TM    CMEXCL(CMMSGPTR),B'00010000'                        0849
         BNO   @RF00849                                            0849
*             OLDEXFLG=ON;          /* EXCL=ON, SHARED=OFF   @Y30LB31*/
         OI    OLDEXFLG,B'00100000'                                0850
*           IF CMBIND=ON THEN       /*                       @Y30LB31*/
@RF00849 TM    CMBIND(CMMSGPTR),B'00000100'                        0851
         BNO   @RF00851                                            0851
*             OLDBIFLG=ON;          /* BIND=ON, NOBIND=OFF   @Y30LB31*/
         OI    OLDBIFLG,B'10000000'                                0852
*           IF CMRONLY=ON THEN      /*                       @Y30LB31*/
@RF00851 TM    CMRONLY(CMMSGPTR),B'00000010'                       0853
         BNO   @RF00853                                            0853
*             OLDROFLG=ON;          /* RONLY=ON, RW=OFF      @Y30LB31*/
         OI    OLDROFLG,B'00010000'                                0854
*         END;                      /*                       @Y30LB31*/
*                                                                  0855
@RF00853 DS    0H                                                  0856
*       /*************************************************************/
*       /*                                                           */
*       /* FREE THE MESSAGE STORAGE AREA.                    @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0856
*       CALL IDCSAFS0(GDTTBL,ECBMSPTR);/*                    @Y30LB31*/
@RF00845 L     @05,@PC00001                                        0856
         ST    @05,@AL00001                                        0856
         LA    @15,ECBMSPTR                                        0856
         ST    @15,@AL00001+4                                      0856
         L     @15,GDTFSP(,@05)                                    0856
         LA    @01,@AL00001                                        0856
         BALR  @14,@15                                             0856
*     END;                          /*                       @Y30LB31*/
*                                                                  0857
*   /*****************************************************************/
*   /*                                                               */
*   /* RESTORE REG 14 WITH THE RETURN ADDRESS OF CALLER.     @Y30LB31*/
*   /* EXIT FROM RWCKRTN. PASS CONDITION CODE IN REG 15.     @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0858
*   RESPECIFY                                                      0858
*     REG14 RSTD;                   /*                       @ZDR2054*/
@RC00830 DS    0H                                                  0859
*   REG14=RETADDR2;                 /*                       @Y30LB31*/
         L     REG14,RETADDR2                                      0859
*   RESPECIFY                                                      0860
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   RETURN CODE(RWCKRC);            /*                       @Y30LB31*/
         LR    @15,RWCKRC                                          0861
@EL00006 DS    0H                                                  0861
@EF00006 DS    0H                                                  0861
@ER00006 BR    @14                                                 0861
*   END RWCKRTN;                    /*                       @Y30LB31*/
*                                                                  0863
*/********************************************************** @Y30LB31*/
*/*                                                          @Y30LB31*/
*/*PROCEDURE NAME - RENAMRTN                                 @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* FUNCTION - CHANGES THE VOLUME SERIAL NO. IN THE CART     @Y30LB31*/
*/*            LABELS AND IN THE INVENTORY.  CALLS SSCMSG    @Y30LB31*/
*/*            TO PRINT A MESSAGE WITH MSSC REASON CODE IF   @Y30LB31*/
*/*            THE MSC RENAME ORDER FAILED.  NO OTHER MSGS   @Y30LB31*/
*/*            ARE ISSUED.                                   @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* INPUT - FDTTBL, ADDVTBL, DEFLIST, DEFVE, BCDV, CMMSG     @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* OUTPUT - RETURN CODE OF 0 INDICATES SUCCESSFUL RENAME    @Y30LB31*/
*/*          AND ADDVTBL UPDATED.                            @Y30LB31*/
*/*          RETURN CODE OF 4 INDICATES RENAME FAILED.       @Y30LB31*/
*/*                                                          @Y30LB31*/
*/********************************************************** @Y30LB31*/
*                                                                  0863
*RENAMRTN:                                                         0863
*   PROCEDURE OPTIONS(NOSAVEAREA,NOSAVE);/*                  @Y30LB31*/
*                                                                  0863
RENAMRTN DS    0H                                                  0864
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL DECLARATIONS.                                   @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0864
*   DCL                                                            0864
*     RENAMRC FIXED(15);            /* LOCAL CONDITION CODE  @Y30LB31*/
*   DCL                                                            0865
*     NOCHANGE BIT(8) CONSTANT('FF'X);/*                     @Y30LB31*/
*                                                                  0865
*   /*****************************************************************/
*   /*                                                               */
*   /* SAVE THE RETURN ADDRESS OF CALLER SINCE THERE IS NO   @Y30LB31*/
*   /* SAVEAREA. REG 14 WILL BE RESTORED UPON EXIT.          @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0866
*   RESPECIFY                                                      0866
*     REG14 RSTD;                   /*                       @ZDR2054*/
*   RETADDR3=REG14;                 /*                       @Y30LB31*/
         ST    REG14,RETADDR3                                      0867
*   RESPECIFY                                                      0868
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   OLDERID2=NEWERID2;                                             0869
         L     @15,@PC00001                                        0869
         L     @15,GDTTR2(,@15)                                    0869
         MVC   @TS00001(95),NEWERID2(@15)                          0869
         MVC   OLDERID2(95,@15),@TS00001                           0869
*   NEWID2='AVNM';                  /*                       @Y30LB31*/
*                                                                  0870
         MVC   NEWID2(4,@15),@CC01838                              0870
*   /*****************************************************************/
*   /*                                                               */
*   /* INITIALIZE TO ZERO THE CONDITION CODE USED WITHIN     @Y30LB31*/
*   /* THIS PROCEDURE. ZERO THE PARM LISTS BEFORE INITIALIZING.      */
*   /*                                                       @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0871
*   RENAMRC=LASTCC00;               /*                       @Y30LB31*/
         SLR   RENAMRC,RENAMRC                                     0871
*   DEFLIST=''B;                    /*                       @Y30LB31*/
         L     @01,DEFVPTR                                         0872
         XC    DEFLIST(132,@01),DEFLIST(@01)                       0872
*   DEFVE=''B;                      /*                       @Y30LB31*/
*                                                                  0873
         L     @01,DEFVEPTR                                        0873
         XC    DEFVE(64,@01),DEFVE(@01)                            0873
*   /*****************************************************************/
*   /*                                                               */
*   /* IF AN ACTIVE OR INACTIVE RENAME REQUEST IS SPECIFIED  @Y30LB31*/
*   /* N ADDVTBL, INITIALIZE THE PARM LISTS AS FOLLOWS.      @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0874
*   IF RENAMTYP=ACTIVE×RENAMTYP=INACTIVE THEN/*              @Y30LB31*/
         CLC   RENAMTYP(8),@CC01666                                0874
         BE    @RT00874                                            0874
         CLC   RENAMTYP(8),@CC01668                                0874
         BNE   @RF00874                                            0874
@RT00874 DS    0H                                                  0875
*     DO;                           /*                       @Y30LB31*/
*       IF RENAMTYP=ACTIVE THEN     /*                       @Y30LB31*/
         CLC   RENAMTYP(8),@CC01666                                0876
         BNE   @RF00876                                            0876
*         DEFVRNM=ON;               /*                       @Y30LB31*/
         L     @01,DEFVPTR                                         0877
         OI    DEFVRNM(@01),B'00100000'                            0877
*       ELSE                        /*                       @Y30LB31*/
*         DO;                       /*                       @Y30LB31*/
         B     @RC00876                                            0878
@RF00876 DS    0H                                                  0879
*           DEFVRNTR=ON;            /*                       @Y30LB31*/
         L     @15,DEFVPTR                                         0879
         OI    DEFVRNTR(@15),B'00000100'                           0879
*           DEFVCSN1=BCDCSN1;       /*                       @Y30LB31*/
         MVC   DEFVCSN1(12,@15),BCDCSN1(BCDVPTR)                   0880
*         END;                      /*                       @Y30LB31*/
*       DEFVOLD=VOLVAL;             /*                       @Y30LB31*/
@RC00876 L     @15,DEFVPTR                                         0882
         L     @14,@PC00001+4                                      0882
         L     @01,FDTPTR(,@14)                                    0882
         MVC   DEFVOLD(6,@15),VOLVAL(@01)                          0882
*       DEFVNVOL=NSERVAL;           /*                       @Y30LB31*/
*                                                                  0883
         L     @01,FDTPTR+20(,@14)                                 0883
         MVC   DEFVNVOL(6,@15),NSERVAL(@01)                        0883
*       /*************************************************************/
*       /*                                                           */
*       /* UPDATE THE VOLUME ATTRIBUTES IN CONJUNCTION WITH  @Y30LB31*/
*       /* THE RENAME REQUEST.                               @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0884
*       IF NEWVFFLG=ON&ONLYROSW=OFF THEN/*                   @Y30LB31*/
         TM    NEWVFFLG,B'00001000'                                0884
         BNO   @RF00884                                            0884
         TM    ONLYROSW,B'10000000'                                0884
         BNZ   @RF00884                                            0884
*         DO;                       /*                       @Y30LB31*/
*           IF NEWDEFLG=ON THEN     /*                       @Y30LB31*/
         TM    NEWDEFLG,B'00000100'                                0886
         BNO   @RF00886                                            0886
*             DEFVSEC=ON;           /*                       @Y30LB31*/
         OI    DEFVSEC(@15),B'00100000'                            0887
*           IF NEWEXFLG=ON THEN     /*                       @Y30LB31*/
@RF00886 TM    NEWEXFLG,B'00000010'                                0888
         BNO   @RF00888                                            0888
*             DEFVEXCL=ON;          /*                       @Y30LB31*/
         L     @01,DEFVPTR                                         0889
         OI    DEFVEXCL(@01),B'00010000'                           0889
*           IF NEWBIFLG=ON THEN     /*                       @Y30LB31*/
@RF00888 TM    NEWBIFLG,B'00001000'                                0890
         BNO   @RF00890                                            0890
*             DEFVBIND=ON;          /*                       @Y30LB31*/
*                                                                  0891
         L     @01,DEFVPTR                                         0891
         OI    DEFVBIND(@01),B'00000100'                           0891
*           /*********************************************************/
*           /*                                                       */
*           /* DO NOT SET READONLY IF VOLUME SERIAL NO. IS   @Y30LB31*/
*           /* TO BE CHANGED UNTIL THE VOLUME LABEL IS UPDATED.      */
*           /*                                               @Y30LB31*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  0892
*           IF NEWROFLG=ON THEN     /*                       @Y30LB31*/
@RF00890 TM    NEWROFLG,B'00000001'                                0892
         BNO   @RF00892                                            0892
*             IF ADDR(NSER)=NULLPTR THEN/*                   @Y30LB31*/
         L     @15,@PC00001+4                                      0893
         L     @15,FDTPTR+20(,@15)                                 0893
         LTR   @15,@15                                             0893
         BNZ   @RF00893                                            0893
*               DEFVWINH=ON;        /*                       @Y30LB31*/
         L     @01,DEFVPTR                                         0894
         OI    DEFVWINH(@01),B'00000010'                           0894
*         END;                      /*                       @Y30LB31*/
*                                                                  0895
*       /*************************************************************/
*       /*                                                           */
*       /* INDICATE NO CHANGE IF THE VOLUME ATTRIBUTES ARE   @Y30LB31*/
*       /* NOT TO BE UPDATED.                                @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0896
*       ELSE                        /*                       @Y30LB31*/
*         DEFVVFLG=NOCHANGE;        /*                       @Y30LB31*/
*                                                                  0896
         B     @RC00884                                            0896
@RF00884 L     @01,DEFVPTR                                         0896
         MVI   DEFVVFLG(@01),X'FF'                                 0896
*       /*************************************************************/
*       /*                                                           */
*       /* ONLY IF THE VOLUME BEING ACTIVATED HAS NOT BEEN   @Y30LB31*/
*       /* PREVIOUSLY FLAGGED FOR A SERIAL MISMATCH ARE THE MSVC     */
*       /* EXTENSIONS TO DEFLIST TO BE INITIALIZED.          @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0897
*       IF BCDVSMIS=OFF THEN        /*                       @Y30LB31*/
@RC00884 TM    BCDVSMIS(BCDVPTR),B'00100000'                       0897
         BNZ   @RF00897                                            0897
*         DO;                       /*                       @Y30LB31*/
*           DEFVVEXT=DEFVEPTR;      /*                       @Y30LB31*/
         L     @15,DEFVEPTR                                        0899
         L     @14,DEFVPTR                                         0899
         ST    @15,DEFVVEXT(,@14)                                  0899
*           DEFLNGTH=DEFLEN;        /*                       @Y30LB31*/
         LH    @14,DEFLEN                                          0900
         ST    @14,DEFLNGTH(,@15)                                  0900
*           DEFSRCVY=ON;            /*                       @Y30LB31*/
         OI    DEFSRCVY(@15),B'10000000'                           0901
*           DEFLAMIS=ON;            /*                       @Y30LB31*/
         OI    DEFLAMIS(@15),B'00100000'                           0902
*           DEFLABEL=VOLVAL;        /* SAVE VOL LABEL        @Y30LB31*/
         L     @14,@PC00001+4                                      0903
         L     @01,FDTPTR(,@14)                                    0903
         MVC   DEFLABEL(6,@15),VOLVAL(@01)                         0903
*           DEFPVLAB=ON;            /*                       @Y30LB31*/
         OI    DEFPVLAB(@15),B'01000000'                           0904
*         END;                      /*                       @Y30LB31*/
*     END;                          /*                       @Y30LB31*/
*                                                                  0907
*   /*****************************************************************/
*   /*                                                               */
*   /* IF A DUMMY RENAME REQUEST IS SPECIFIED IN ADDVTBL,    @Y30LB31*/
*   /* THE VOLUME IS RENAMED WITH ITS SAME SERIAL NUMBER. INIT THE   */
*   /* PARM LIST AS FOLLOWS.                                 @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0907
*   ELSE                            /*                       @Y30LB31*/
*     IF RENAMTYP=DUMMY THEN        /*                       @Y30LB31*/
         B     @RC00874                                            0907
@RF00874 CLC   RENAMTYP(8),@CC01672                                0907
         BNE   @RF00907                                            0907
*       DO;                         /*                       @Y30LB31*/
*         DEFVRNTR=ON;              /*                       @Y30LB31*/
         L     @15,DEFVPTR                                         0909
         OI    DEFVRNTR(@15),B'00000100'                           0909
*         DEFVCSN1=BCDCSN1;         /*                       @Y30LB31*/
         MVC   DEFVCSN1(12,@15),BCDCSN1(BCDVPTR)                   0910
*         DEFVOLD=VOLVAL;           /*                       @Y30LB31*/
         L     @14,@PC00001+4                                      0911
         L     @14,FDTPTR(,@14)                                    0911
         MVC   DEFVOLD(6,@15),VOLVAL(@14)                          0911
*         DEFVNVOL=VOLVAL;          /*                       @Y30LB31*/
         MVC   DEFVNVOL(6,@15),VOLVAL(@14)                         0912
*         DEFVVFLG=NOCHANGE;        /*                       @Y30LB31*/
         MVI   DEFVVFLG(@15),X'FF'                                 0913
*       END;                        /*                       @Y30LB31*/
*                                                                  0914
*   /*****************************************************************/
*   /*                                                               */
*   /* IF A BACKOUT RENAME REQUEST IS SPECIFIED IN           @Y30LB31*/
*   /* DDVTBL, THE ORIGINAL VOLUME SERIAL NO. IS RESTORED. NITIALIZE */
*   /* THE PARM LISTS AS FOLLOWS.                            @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0915
*     ELSE                          /*                       @Y30LB31*/
*       DO;                         /*                       @Y30LB31*/
         B     @RC00907                                            0915
@RF00907 DS    0H                                                  0916
*         DEFVRNM=ON;               /*                       @Y30LB31*/
         L     @15,DEFVPTR                                         0916
         OI    DEFVRNM(@15),B'00100000'                            0916
*         DEFVOLD=NSERVAL;          /*                       @Y30LB31*/
         L     @14,@PC00001+4                                      0917
         L     @01,FDTPTR+20(,@14)                                 0917
         MVC   DEFVOLD(6,@15),NSERVAL(@01)                         0917
*         DEFVNVOL=VOLVAL;          /*                       @Y30LB31*/
*                                                                  0918
         L     @01,FDTPTR(,@14)                                    0918
         MVC   DEFVNVOL(6,@15),VOLVAL(@01)                         0918
*         /***********************************************************/
*         /*                                                         */
*         /* RESTORE THE ORIGINAL VOLUME ATTRIBUTES IF THEY  @Y30LB31*/
*         /* WERE CHANGED.                                   @Y30LB31*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  0919
*         IF NEWVFFLG=ON THEN       /*                       @Y30LB31*/
         TM    NEWVFFLG,B'00001000'                                0919
         BNO   @RF00919                                            0919
*           DO;                     /*                       @Y30LB31*/
*             IF OLDDEFLG=ON THEN   /*                       @Y30LB31*/
         TM    OLDDEFLG,B'01000000'                                0921
         BNO   @RF00921                                            0921
*               DEFVSEC=ON;         /*                       @Y30LB31*/
         OI    DEFVSEC(@15),B'00100000'                            0922
*             IF OLDEXFLG=ON THEN   /*                       @Y30LB31*/
@RF00921 TM    OLDEXFLG,B'00100000'                                0923
         BNO   @RF00923                                            0923
*               DEFVEXCL=ON;        /*                       @Y30LB31*/
         L     @01,DEFVPTR                                         0924
         OI    DEFVEXCL(@01),B'00010000'                           0924
*             IF OLDBIFLG=ON THEN   /*                       @Y30LB31*/
@RF00923 TM    OLDBIFLG,B'10000000'                                0925
         BNO   @RF00925                                            0925
*               DEFVBIND=ON;        /*                       @Y30LB31*/
         L     @01,DEFVPTR                                         0926
         OI    DEFVBIND(@01),B'00000100'                           0926
*             IF OLDROFLG=ON THEN   /*                       @Y30LB31*/
@RF00925 TM    OLDROFLG,B'00010000'                                0927
         BNO   @RF00927                                            0927
*               DEFVWINH=ON;        /*                       @Y30LB31*/
         L     @01,DEFVPTR                                         0928
         OI    DEFVWINH(@01),B'00000010'                           0928
*           END;                    /*                       @Y30LB31*/
*         ELSE                      /*                       @Y30LB31*/
*           DEFVVFLG=NOCHANGE;      /*                       @Y30LB31*/
         B     @RC00919                                            0930
@RF00919 L     @01,DEFVPTR                                         0930
         MVI   DEFVVFLG(@01),X'FF'                                 0930
*         DEFVVEXT=DEFVEPTR;        /*                       @Y30LB31*/
@RC00919 L     @15,DEFVEPTR                                        0931
         L     @14,DEFVPTR                                         0931
         ST    @15,DEFVVEXT(,@14)                                  0931
*         DEFLNGTH=DEFLEN;          /*                       @Y30LB31*/
         LH    @14,DEFLEN                                          0932
         ST    @14,DEFLNGTH(,@15)                                  0932
*         DEFDUP=ON;                /*                       @Y30LB31*/
*                                                                  0933
         OI    DEFDUP(@15),B'00100000'                             0933
*         /***********************************************************/
*         /*                                                         */
*         /* CLEAR THE RECOVERY DATA FROM THE INVENTORY ONLY @Y30LB31*/
*         /* IF SET INITIALLY BY THIS ADDV REQUEST.          @Y30LB31*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  0934
*         IF BCDVSMIS=OFF THEN      /*                       @Y30LB31*/
         TM    BCDVSMIS(BCDVPTR),B'00100000'                       0934
         BNZ   @RF00934                                            0934
*           DO;                     /*                       @Y30LB31*/
*             DEFCRCVY=ON;          /*                       @Y30LB31*/
         OI    DEFCRCVY(@15),B'01000000'                           0936
*             DEFLAMIS=ON;          /*                       @Y30LB31*/
         OI    DEFLAMIS(@15),B'00100000'                           0937
*             DEFLABEL=BLANKIT;     /*                       @Y30LB31*/
         MVI   DEFLABEL+1(@15),C' '                                0938
         MVC   DEFLABEL+2(4,@15),DEFLABEL+1(@15)                   0938
         MVI   DEFLABEL(@15),C' '                                  0938
*             DEFPVLAB=ON;          /*                       @Y30LB31*/
         OI    DEFPVLAB(@15),B'01000000'                           0939
*           END;                    /*                       @Y30LB31*/
*       END;                        /*                       @Y30LB31*/
@RF00934 DS    0H                                                  0942
*                                                                  0942
*   /*****************************************************************/
*   /*                                                               */
*   /* TAKE A SYMBOLIC DUMP OF THE DEFINE ORDER PARM LIST    @Y30LB31*/
*   /* BEFORE THE RENAME REQUEST IS EXECUTED.                @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0942
*   IF GDTDBG=NULLPTR THEN                                         0942
@RC00907 DS    0H                                                  0942
@RC00874 L     @15,@PC00001                                        0942
         L     @15,GDTDBG(,@15)                                    0942
         LTR   @15,@15                                             0942
         BZ    @RT00942                                            0942
*     ;                                                            0943
*   ELSE                                                           0944
*     DO;                                                          0944
*       DMPINDEX=ADDR(AVDMPLST);    /*                       @Y30LB31*/
         LA    DMPINDEX,AVDMPLST                                   0945
*       DMPITMNM='AV01DEFV';                                       0946
         MVC   DMPITMNM(8,DMPINDEX),@CC01826                       0946
*       DMPITMPT=ADDR(AV01DEFV);                                   0947
         LA    @03,AV01DEFV                                        0947
         ST    @03,DMPITMPT(,DMPINDEX)                             0947
*       DMPITMLN=LENGTH(AV01DEFV);                                 0948
         MVC   DMPITMLN(2,DMPINDEX),@CH02000                       0948
*       DMPITMTP='H';                                              0949
         MVI   DMPITMTP(DMPINDEX),C'H'                             0949
*       DMPINDEX=DMPINDEX+DMPELEMT;                                0950
*                                                                  0950
         LA    @03,16                                              0950
         ALR   DMPINDEX,@03                                        0950
*       /*************************************************************/
*       /*                                                           */
*       /*                                                   @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  0951
*       DMPITMNM='ADDVTBL';                                        0951
         MVI   DMPITMNM+7(DMPINDEX),C' '                           0951
         MVC   DMPITMNM(7,DMPINDEX),@CC01766                       0951
*       DMPITMPT=ADDR(ADDVTBL);                                    0952
         LA    @15,ADDVTBL                                         0952
         ST    @15,DMPITMPT(,DMPINDEX)                             0952
*       DMPITMLN=LENGTH(ADDVTBL);                                  0953
         MVC   DMPITMLN(2,DMPINDEX),@CH01999                       0953
*       DMPITMTP='H';                                              0954
         MVI   DMPITMTP(DMPINDEX),C'H'                             0954
*       DMPINDEX=DMPINDEX+DMPELEMT; /*                       @Y30LB31*/
         ALR   DMPINDEX,@03                                        0955
*       DMPTRM=DMPTRMVL;                                           0956
         MVI   DMPTRM(DMPINDEX),X'FF'                              0956
*     END;                          /*                       @Y30LB31*/
*   IF GDTDBG=NULLPTR THEN                                         0958
@RT00942 L     @15,@PC00001                                        0958
         L     @15,GDTDBG(,@15)                                    0958
         LTR   @15,@15                                             0958
         BZ    @RT00958                                            0958
*     ;                                                            0959
*   ELSE                                                           0960
*     CALL IDCDB010(GDTTBL,'AVBN',ADDR(AVDMPLST));/*         @Y30LB31*/
*                                                                  0960
         L     @15,@PC00001                                        0960
         ST    @15,@AL00001                                        0960
         LA    @14,@CC01839                                        0960
         ST    @14,@AL00001+4                                      0960
         LA    @14,AVDMPLST                                        0960
         ST    @14,@AFTEMPS+8                                      0960
         LA    @14,@AFTEMPS+8                                      0960
         ST    @14,@AL00001+8                                      0960
         MVI   @AL00001+8,X'80'                                    0960
         L     @15,GDTDBG(,@15)                                    0960
         LA    @01,@AL00001                                        0960
         BALR  @14,@15                                             0960
*   /*****************************************************************/
*   /*                                                               */
*   /* CHANGE THE VOLUME SERIAL NO. IN THE CART LABELS AND   @Y30LB31*/
*   /* MSVI.                                                 @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0961
*   CALL IDCSASS0(GDTTBL,DEFINE,DEFVPTR,REASON,ECBCODE,/*    @Y30LB31*/
*       ECBMSPTR);                  /*                       @Y30LB31*/
@RT00958 L     @02,@PC00001                                        0961
         ST    @02,@AL00001                                        0961
         LA    @15,DEFINE                                          0961
         ST    @15,@AL00001+4                                      0961
         LA    @15,DEFVPTR                                         0961
         ST    @15,@AL00001+8                                      0961
         LA    @15,REASON                                          0961
         ST    @15,@AL00001+12                                     0961
         LA    @15,ECBCODE                                         0961
         ST    @15,@AL00001+16                                     0961
         LA    @15,ECBMSPTR                                        0961
         ST    @15,@AL00001+20                                     0961
         MVI   @AL00001+20,X'80'                                   0961
         L     @15,GDTSSC(,@02)                                    0961
         LA    @01,@AL00001                                        0961
         BALR  @14,@15                                             0961
*   RESPECIFY                                                      0962
*     RTNREG RSTD;                                                 0962
*   TESTRC=RTNREG;                                                 0963
         LR    TESTRC,RTNREG                                       0963
*   RESPECIFY                                                      0964
*     RTNREG UNRSTD;                /*                       @Y30LB31*/
*                                                                  0965
*   /*****************************************************************/
*   /*                                                               */
*   /* TEST RETURN CODE FROM DSM DEFINE ORDER. TREAT A       @Y30LB31*/
*   /* MSVI I/O ERROR AS A MINOR ERROR FOR THE DSM RENAME IS DONE.   */
*   /*                                                       @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0965
*   IF TESTRC=12 THEN               /*                       @Y30LB31*/
         C     TESTRC,@CF00606                                     0965
         BNE   @RF00965                                            0965
*     DO;                           /*                       @Y30LB31*/
*       TESTRC=0;                   /*                       @Y30LB31*/
         SLR   TESTRC,TESTRC                                       0967
*       CC04FLG=ON;                 /*                       @Y30LB31*/
         OI    CC04FLG,B'10000000'                                 0968
*     END;                          /*                       @Y30LB31*/
*                                                                  0969
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THE MSC RENAME FAILED, UPDATE THE COND CODE. PRINT @Y30LB31*/
*   /* A MESSAGE WITH THE MSSC REASON CODE AND EXIT FROM THIS        */
*   /* PROCEDURE.                                            @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0970
*   IF TESTRC^=0 THEN               /*                       @Y30LB31*/
@RF00965 LTR   TESTRC,TESTRC                                       0970
         BZ    @RF00970                                            0970
*     DO;                           /*                       @Y30LB31*/
*       RENAMRC=4;                  /*                       @Y30LB31*/
         LA    @02,4                                               0972
         LR    RENAMRC,@02                                         0972
*       IF TESTRC=4 THEN            /*                       @Y30LB31*/
         CR    TESTRC,@02                                          0973
         BNE   @RF00973                                            0973
*         CALL SSCMSG(REASON,ECBCODE);/*                     @Y30LB31*/
         LA    @15,REASON                                          0974
         ST    @15,@AL00001                                        0974
         LA    @15,ECBCODE                                         0974
         ST    @15,@AL00001+4                                      0974
         LA    @01,@AL00001                                        0974
         BAL   @14,SSCMSG                                          0974
*     END;                          /*                       @Y30LB31*/
*                                                                  0975
*   /*****************************************************************/
*   /*                                                               */
*   /* THE VOL SERIAL NO. WAS SUCCESSFULLY CHANGED IN THE    @Y30LB31*/
*   /* CART LABELS AND MSVI. SAVE THE NEW IDENTIFICATION OF THE      */
*   /*                                                       @Y30LB31*/
*   /* VOLUME AND FREE THE MESSAGE STORAGE AREA IF THE CALLER OF     */
*   /*                                                       @Y30LB31*/
*   /* THIS PROCEDURE DOES NOT REQUIRE IT.                   @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0976
*   ELSE                            /*                       @Y30LB31*/
*     DO;                           /*                       @Y30LB31*/
         B     @RC00970                                            0976
@RF00970 DS    0H                                                  0977
*       CMMSGPTR=ECBMSPTR+ECBLEN;   /*                       @Y30LB31*/
         LA    CMMSGPTR,4                                          0977
         AL    CMMSGPTR,ECBMSPTR                                   0977
*       MSVIVOL#=CMNEWVOL;          /*                       @Y30LB31*/
         MVC   MSVIVOL#(6),CMNEWVOL(CMMSGPTR)                      0978
*       IF MSGFLG=OFF THEN          /*                       @Y30LB31*/
         TM    MSGFLG,B'00010000'                                  0979
         BNZ   @RF00979                                            0979
*         CALL IDCSAFS0(GDTTBL,ECBMSPTR);/*                  @Y30LB31*/
         L     @15,@PC00001                                        0980
         ST    @15,@AL00001                                        0980
         LA    @14,ECBMSPTR                                        0980
         ST    @14,@AL00001+4                                      0980
         L     @15,GDTFSP(,@15)                                    0980
         LA    @01,@AL00001                                        0980
         BALR  @14,@15                                             0980
*     END;                          /*                       @Y30LB31*/
*                                                                  0981
@RF00979 DS    0H                                                  0982
*   /*****************************************************************/
*   /*                                                               */
*   /* RESTORE THE RETURN ADDRESS OF THE CALLER TO REG 14 AND RETURN */
*   /* TO CALLER, PASSING THE CONDITION CODE IN REG 15.      @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0982
*   RESPECIFY                                                      0982
*     REG14 RSTD;                   /*                       @ZDR2054*/
@RC00970 DS    0H                                                  0983
*   REG14=RETADDR3;                 /*                       @Y30LB31*/
         L     REG14,RETADDR3                                      0983
*   RESPECIFY                                                      0984
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   RETURN CODE(RENAMRC);           /*                       @Y30LB31*/
         LR    @15,RENAMRC                                         0985
@EL00007 DS    0H                                                  0985
@EF00007 DS    0H                                                  0985
@ER00007 BR    @14                                                 0985
*   END RENAMRTN;                   /*                       @Y30LB31*/
*                                                                  0987
*/********************************************************** @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* PROCEDURE NAME - ALLOCRTN                                @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* FUNCTION - IF NO FILE PARAMETER IS SPECIFIED, EITHER     @YD00175*/
*/*            SELECTS AN EXCLUSIVE UNIT FOR REUSE OR        @YD00175*/
*/*            DYNAMICALLY ALLOCATES A UNIT. VERIFIES THAT   @YD00175*/
*/*            THE UNIT FROM THE FILE PARAMETER IS VIRTUAL.  @YD00175*/
*/*            OBTAINS EXCLUSIVE CONTROL OF THE UNIT         @YD00175*/
*/*            NO MESSAGES ARE ISSUED BY THIS ROUTINE.       @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* INPUT - FDTTBL                                           @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* OUTPUT - RETURN CODE OF 0 INDICATES SUCCESSFUL ALLOC-    @Y30LB31*/
*/*          TION AND CHECK OUT AND UPDATED ADDVTBL.         @Y30LB31*/
*/*          RETURN CODE OF 4 INDICATES DYNAMIC ALLOCATION   @Y30LB31*/
*/*          FAILED OR UNIT NOT VIRTUAL OR EXCLUSIVELY       @Y30LB31*/
*/*          ASSIGNED TO ADDV.                               @Y30LB31*/
*/*                                                          @Y30LB31*/
*/********************************************************** @Y30LB31*/
*                                                                  0987
*ALLOCRTN:                                                         0987
*   PROCEDURE OPTIONS(NOSAVEAREA,NOSAVE);/*                  @Y30LB31*/
*                                                                  0987
ALLOCRTN DS    0H                                                  0988
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL CONDITION CODE.                                 @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0988
*   DCL                                                            0988
*     ALLOCRC FIXED(15);            /*                       @Y30LB31*/
*                                                                  0988
*   /*****************************************************************/
*   /*                                                               */
*   /* SETUP STORAGE AREA TO BUILD CKAGL FOR UNIT CHECKOUT.  @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0989
*   DCL                                                            0989
*     AVCKAGL CHAR(LENGTH(CKAGL)) BDY(WORD);/*               @Y30LB31*/
*                                                                  0989
*   /*****************************************************************/
*   /*                                                               */
*   /* SAVE THE RETURN ADDRESS OF CALLER SINCE THERE IS NO   @Y30LB31*/
*   /* SAVEAREA. REG 14 WILL BE RESTORED UPON EXIT.          @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0990
*   RESPECIFY                                                      0990
*     REG14 RSTD;                   /*                       @ZDR2054*/
*   RETADDR3=REG14;                 /*                       @Y30LB31*/
         ST    REG14,RETADDR3                                      0991
*   RESPECIFY                                                      0992
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   OLDERID2=NEWERID2;                                             0993
         L     @15,@PC00001                                        0993
         L     @14,GDTTR2(,@15)                                    0993
         MVC   @TS00001(95),NEWERID2(@14)                          0993
         MVC   OLDERID2(95,@14),@TS00001                           0993
*   NEWID2='AVAL';                  /*                       @Y30LB31*/
*                                                                  0994
         MVC   NEWID2(4,@14),@CC01845                              0994
*   /*****************************************************************/
*   /*                                                               */
*   /* INITIALIZE TO ZERO THE CONDITION CODE USED BY THIS    @Y30LB31*/
*   /* PROCEDURE.                                            @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0995
*   ALLOCRC=LASTCC00;               /*                       @Y30LB31*/
*                                                                  0995
         SLR   @14,@14                                             0995
         LR    ALLOCRC,@14                                         0995
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THE FILE PARAMETER IS NOT SPECIFIED, LOOK FOR      @YD00175*/
*   /* A FILE THAT WE CAN REUSE THAT IS ALREADY ALLOCATED    @YD00175*/
*   /* FOR EXCLUSIVE CONTROL OF THE VOLUME                   @YD00175*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  0996
*   IF ADDR(FILE)=NULLPTR THEN      /*                       @Y30LB31*/
         L     @03,@PC00001+4                                      0996
         C     @14,FDTPTR+28(,@03)                                 0996
         BNE   @RF00996                                            0996
*     DO;                           /*                       @Y30LB31*/
*       EXCLAGL=''B;                /*                       @YD00175*/
         LA    @02,AVEXCLST                                        0998
         XC    EXCLAGL(23,@02),EXCLAGL(@02)                        0998
*       EXCLDDP=ADDR(AUNITDDN);     /*                       @YD00175*/
         LA    @14,AUNITDDN                                        0999
         ST    @14,EXCLDDP(,@02)                                   0999
*       EXCLUCBP=ADDR(AUNITUCB);    /*                       @YD00175*/
         LA    @14,AUNITUCB                                        1000
         ST    @14,EXCLUCBP(,@02)                                  1000
*       EXCLVOL=VOLVAL;             /*                       @YD00175*/
*                                                                  1001
         L     @14,@PC00001+4                                      1001
         L     @01,FDTPTR(,@14)                                    1001
         MVC   EXCLVOL(6,@02),VOLVAL(@01)                          1001
*       /*************************************************************/
*       /*                                                           */
*       /* ISSUE UMSSUNIT TO SELECT EXCLUSIVE UNIT           @YD00175*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1002
*       CALL IDCSA060(GDTTBL,SELECTX,EXCLAGL);/*             @YD00175*/
         ST    @15,@AL00001                                        1002
         LA    @14,SELECTX                                         1002
         ST    @14,@AL00001+4                                      1002
         ST    @02,@AL00001+8                                      1002
         MVI   @AL00001+8,X'80'                                    1002
         L     @15,GDTUNT(,@15)                                    1002
         LA    @01,@AL00001                                        1002
         BALR  @14,@15                                             1002
*       RESPECIFY                                                  1003
*         RTNREG RSTD;                                             1003
*       TESTRC=RTNREG;                                             1004
         LR    TESTRC,RTNREG                                       1004
*       RESPECIFY                                                  1005
*         RTNREG UNRSTD;            /*                       @YD00175*/
*                                                                  1005
*       /*************************************************************/
*       /*                                                           */
*       /* IF THE RETURN CODE IS NOT ZERO, EXIT FROM PROC    @YD00175*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1006
*       IF TESTRC>0 THEN                                           1006
         LTR   TESTRC,TESTRC                                       1006
         BNP   @RF01006                                            1006
*         ALLOCRC=LASTCC04;         /*                       @YD00175*/
*                                                                  1007
         LA    ALLOCRC,4                                           1007
*       /*************************************************************/
*       /*                                                           */
*       /* BIT IF WE DID NOT GET A UCB FROM UMSSUNIT,        @YD00175*/
*       /* DYMANICALLY ALLOCATE THE UNIT                     @YD00175*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1008
*       ELSE                                                       1008
*         DO;                       /*                       @YD00175*/
         B     @RC01006                                            1008
@RF01006 DS    0H                                                  1009
*           IF AUNITUCB=0 THEN                                     1009
         L     @15,AUNITUCB                                        1009
         LTR   @15,@15                                             1009
         BNZ   @RF01009                                            1009
*             DO;                   /*                       @YD00175*/
*               ALLOPTVL=ON;        /*                       @Y30LB31*/
         LA    @02,AVALLTBL                                        1011
         OI    ALLOPTVL(@02),B'10000000'                           1011
*               ALLVLCNT=1;         /*                       @YD00175*/
         MVI   ALLVLCNT(@02),X'01'                                 1012
*               ALLUNCNT=1;         /*                       @Y30LB31*/
         MVI   ALLUNCNT(@02),X'01'                                 1013
*               ALLOPTPV=ON;        /*                       @Y30LB31*/
         OI    ALLOPTPV(@02),B'00100000'                           1014
*               ALLULP=ADDR(AVUNLST);/*                      @Y30LB31*/
         LA    @15,AVUNLST                                         1015
         ST    @15,ALLULP(,@02)                                    1015
*               AVUNCNT=1;          /*                       @Y30LB31*/
         LA    @15,1                                               1016
         STH   @15,AVUNCNT                                         1016
*               AVUNLEN=LENGTH(DEV3330V);/*                  @Y30LB31*/
         MVC   AVUNLEN(2),@CH00298                                 1017
*               AVUNVAL=DEV3330V;   /*                       @Y30LB31*/
         MVI   AVUNVAL+5,C' '                                      1018
         MVC   AVUNVAL+6(2),AVUNVAL+5                              1018
         MVC   AVUNVAL(5),@CC01616                                 1018
*               ALLVLP=ADDR(AVVOLLST);/*                     @Y30LB31*/
         LA    @14,AVVOLLST                                        1019
         ST    @14,ALLVLP(,@02)                                    1019
*               SERCNT=1;           /*                       @Y30LB31*/
         STH   @15,SERCNT                                          1020
*               SERLEN=VOLLEN;      /*                       @Y30LB31*/
         L     @15,@PC00001+4                                      1021
         L     @15,FDTPTR(,@15)                                    1021
         SLR   @14,@14                                             1021
         IC    @14,VOLLEN(,@15)                                    1021
         STH   @14,SERLEN                                          1021
*               SERNO=VOLVAL;       /*                       @Y30LB31*/
         MVC   SERNO(6),VOLVAL(@15)                                1022
*               CALL IDCSAAL0(GDTTBL,ALLAGL);/*              @Y30LB31*/
         L     @15,@PC00001                                        1023
         ST    @15,@AL00001                                        1023
         ST    @02,@AL00001+4                                      1023
         MVI   @AL00001+4,X'80'                                    1023
         L     @15,GDTALC(,@15)                                    1023
         LA    @01,@AL00001                                        1023
         BALR  @14,@15                                             1023
*               RESPECIFY                                          1024
*                 RTNREG RSTD;                                     1024
*               TESTRC=RTNREG;                                     1025
         LR    TESTRC,RTNREG                                       1025
*               RESPECIFY                                          1026
*                 RTNREG UNRSTD;    /*                       @Y30LB31*/
*                                                                  1026
*               /*****************************************************/
*               /*                                                   */
*               /* TEST RETURN CODE FROM DYNAMIC ALLOCATION REQUEST  */
*               /*                                           @Y30LB31*/
*               /* AND EXIT FROM THIS PROC IF DYNAMIC ALLOCATION     */
*               /* FAILED.                                   @Y30LB31*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  1027
*               IF TESTRC^=0 THEN   /*                       @Y30LB31*/
         LTR   TESTRC,TESTRC                                       1027
         BZ    @RF01027                                            1027
*                 ALLOCRC=4;        /*                       @Y30LB31*/
*                                                                  1028
         LA    ALLOCRC,4                                           1028
*               /*****************************************************/
*               /*                                                   */
*               /* SAVE THE DDNAME OF THE DYNAMICALLY ALLOCATED      */
*               /*                                           @Y30LB31*/
*               /* UNIT AND SET AN INDICATOR FOR UDEALLOC AT EOJ.    */
*               /*                                           @Y30LB31*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  1029
*               ELSE                /*                       @Y30LB31*/
*                 DO;               /*                       @Y30LB31*/
         B     @RC01027                                            1029
@RF01027 DS    0H                                                  1030
*                   ALLOCFLG=ON;    /*                       @Y30LB31*/
         OI    ALLOCFLG,B'00000100'                                1030
*                   AUNITDDN=ALLDDN;/*                       @Y30LB31*/
         LA    @15,AVALLTBL                                        1031
         MVC   AUNITDDN(8),ALLDDN(@15)                             1031
*                 END;              /*                       @Y30LB31*/
*                                                                  1032
*               /*****************************************************/
*               /*                                                   */
*               /* CLOSE DO GROUP FOR DYNAMIC ALLOCATION.    @Y30LB31*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  1033
*             END;                  /*                       @Y30LB31*/
*         END;                      /*                       @YD00175*/
*     END;                          /*                       @YD00175*/
*                                                                  1035
*   /*****************************************************************/
*   /*                                                               */
*   /* DYNAMIC ALLOCATION IS NOT REQUIRED. SAVE THE DDNAME   @Y30LB31*/
*   /* OF THE UNIT OBTAINED VIA THE FILE PARM.               @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1036
*   ELSE                            /*                       @Y30LB31*/
*     AUNITDDN=FILEVAL;             /*                       @Y30LB31*/
         B     @RC00996                                            1036
@RF00996 L     @15,@PC00001+4                                      1036
         L     @01,FDTPTR+28(,@15)                                 1036
         MVC   AUNITDDN(8),FILEVAL(@01)                            1036
*                                                                  1037
*   /*****************************************************************/
*   /*                                                               */
*   /* SETUP CKAGL TO VERIFY THAT THE DEVICE IS              @Y30LB31*/
*   /* VIRTUAL.                                              @YD00175*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1037
*   IF ALLOCRC=0&ADDR(FILE)=NULLPTR THEN                           1037
@RC00996 SLR   @15,@15                                             1037
         CR    ALLOCRC,@15                                         1037
         BNE   @RF01037                                            1037
         L     @14,@PC00001+4                                      1037
         C     @15,FDTPTR+28(,@14)                                 1037
         BNE   @RF01037                                            1037
*     DO;                           /*                       @YD00175*/
*       RESPECIFY                                                  1039
*         CKAGL BASED(ADDR(AVCKAGL));/*                      @Y30LB31*/
*       CKAGL=''B;                  /*                       @Y30LB31*/
         LA    @14,AVCKAGL                                         1040
         XC    CKAGL(29,@14),CKAGL(@14)                            1040
*       CKTESTVT=ON;                /*                       @Y30LB31*/
         OI    CKTESTVT(@14),B'10000000'                           1041
*       CKDDNAME=AUNITDDN;          /*                       @Y30LB31*/
         MVC   CKDDNAME(8,@14),AUNITDDN                            1042
*       CKUCBPTR=ADDR(AUNITUCB);    /* RETURNED BY UMSSUNIT  @Y30LB31*/
*                                                                  1043
         LA    @03,AUNITUCB                                        1043
         ST    @03,CKUCBPTR(,@14)                                  1043
*       /*************************************************************/
*       /*                                                           */
*       /* TAKE A SYMBOLIC DUMP OF CKAGL BEFORE CHECKING OUT @Y30LB31*/
*       /* THE UNIT.                                         @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1044
*       IF GDTDBG=NULLPTR THEN                                     1044
         L     @14,@PC00001                                        1044
         C     @15,GDTDBG(,@14)                                    1044
         BE    @RT01044                                            1044
*         ;                                                        1045
*       ELSE                                                       1046
*         DO;                                                      1046
*           DMPINDEX=ADDR(AVDMPLST);/*                       @Y30LB31*/
         LA    DMPINDEX,AVDMPLST                                   1047
*           DMPITMNM='AVCKAGL';                                    1048
         MVI   DMPITMNM+7(DMPINDEX),C' '                           1048
         MVC   DMPITMNM(7,DMPINDEX),@CC01848                       1048
*           DMPITMPT=ADDR(AVCKAGL);                                1049
         LA    @03,AVCKAGL                                         1049
         ST    @03,DMPITMPT(,DMPINDEX)                             1049
*           DMPITMLN=LENGTH(CKAGL);                                1050
         MVC   DMPITMLN(2,DMPINDEX),@CH00885                       1050
*           DMPITMTP='H';                                          1051
         MVI   DMPITMTP(DMPINDEX),C'H'                             1051
*           DMPINDEX=DMPINDEX+DMPELEMT;                            1052
*                                                                  1052
         LA    @03,16                                              1052
         ALR   DMPINDEX,@03                                        1052
*           /*********************************************************/
*           /*                                                       */
*           /*                                               @Y30LB31*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1053
*           DMPITMNM='ADDVTBL';                                    1053
         MVI   DMPITMNM+7(DMPINDEX),C' '                           1053
         MVC   DMPITMNM(7,DMPINDEX),@CC01766                       1053
*           DMPITMPT=ADDR(ADDVTBL);                                1054
         LA    @15,ADDVTBL                                         1054
         ST    @15,DMPITMPT(,DMPINDEX)                             1054
*           DMPITMLN=LENGTH(ADDVTBL);                              1055
         MVC   DMPITMLN(2,DMPINDEX),@CH01999                       1055
*           DMPITMTP='H';                                          1056
         MVI   DMPITMTP(DMPINDEX),C'H'                             1056
*           DMPINDEX=DMPINDEX+DMPELEMT;                            1057
*                                                                  1057
         ALR   DMPINDEX,@03                                        1057
*           /*********************************************************/
*           /*                                                       */
*           /*                                               @Y30LB31*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1058
*           DMPTRM=DMPTRMVL;                                       1058
         MVI   DMPTRM(DMPINDEX),X'FF'                              1058
*         END;                      /*                       @Y30LB31*/
*       IF GDTDBG=NULLPTR THEN                                     1060
@RT01044 L     @15,@PC00001                                        1060
         L     @15,GDTDBG(,@15)                                    1060
         LTR   @15,@15                                             1060
         BZ    @RT01060                                            1060
*         ;                                                        1061
*       ELSE                                                       1062
*         CALL IDCDB010(GDTTBL,'AVCK',ADDR(AVDMPLST));/*     @Y30LB31*/
*                                                                  1062
         L     @15,@PC00001                                        1062
         ST    @15,@AL00001                                        1062
         LA    @14,@CC01849                                        1062
         ST    @14,@AL00001+4                                      1062
         LA    @14,AVDMPLST                                        1062
         ST    @14,@AFTEMPS+12                                     1062
         LA    @14,@AFTEMPS+12                                     1062
         ST    @14,@AL00001+8                                      1062
         MVI   @AL00001+8,X'80'                                    1062
         L     @15,GDTDBG(,@15)                                    1062
         LA    @01,@AL00001                                        1062
         BALR  @14,@15                                             1062
*       /*************************************************************/
*       /*                                                           */
*       /* PERFORM THE UNIT CHECK OUT.                       @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1063
*       CALL IDCSA060(GDTTBL,CHECK,CKAGL);/*                 @Y30LB31*/
@RT01060 L     @02,@PC00001                                        1063
         ST    @02,@AL00001                                        1063
         LA    @15,CHECK                                           1063
         ST    @15,@AL00001+4                                      1063
         LA    @15,AVCKAGL                                         1063
         ST    @15,@AL00001+8                                      1063
         MVI   @AL00001+8,X'80'                                    1063
         L     @15,GDTUNT(,@02)                                    1063
         LA    @01,@AL00001                                        1063
         BALR  @14,@15                                             1063
*       RESPECIFY                                                  1064
*         RTNREG RSTD;                                             1064
*       TESTRC=RTNREG;                                             1065
         LR    TESTRC,RTNREG                                       1065
*       RESPECIFY                                                  1066
*         RTNREG UNRSTD;            /*                       @Y30LB31*/
*       IF TESTRC^=0 THEN           /*                       @Y30LB31*/
         LTR   TESTRC,TESTRC                                       1067
         BZ    @RF01067                                            1067
*         ALLOCRC=4;                /*                       @Y30LB31*/
         LA    ALLOCRC,4                                           1068
*     END;                          /*                       @Y30LB31*/
*                                                                  1069
@RF01067 DS    0H                                                  1070
*   /*****************************************************************/
*   /*                                                               */
*   /* IF NO ERRORS, GET EXCLUSIVE USE OF VOLUME             @YD00175*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1070
*   IF ALLOCRC=0 THEN                                              1070
@RF01037 LTR   ALLOCRC,ALLOCRC                                     1070
         BNZ   @RF01070                                            1070
*     DO;                           /*                       @YD00175*/
*       EXCLAGL=''B;                /*                       @YD00175*/
         LA    @02,AVEXCLST                                        1072
         XC    EXCLAGL(23,@02),EXCLAGL(@02)                        1072
*       EXCLUCBP=ADDR(AUNITUCB);    /*                       @YD00175*/
         LA    @15,AUNITUCB                                        1073
         ST    @15,EXCLUCBP(,@02)                                  1073
*       EXCLDDP=ADDR(AUNITDDN);     /*                       @YD00175*/
*                                                                  1074
         LA    @15,AUNITDDN                                        1074
         ST    @15,EXCLDDP(,@02)                                   1074
*       /*************************************************************/
*       /*                                                           */
*       /* ISSUE UMSSUNIT TO GET EXCLUSIVE CONTROL           @YD00175*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1075
*       CALL IDCSA060(GDTTBL,CHANGEX,EXCLAGL);/*             @YD00175*/
         L     @15,@PC00001                                        1075
         ST    @15,@AL00001                                        1075
         LA    @14,CHANGEX                                         1075
         ST    @14,@AL00001+4                                      1075
         ST    @02,@AL00001+8                                      1075
         MVI   @AL00001+8,X'80'                                    1075
         L     @15,GDTUNT(,@15)                                    1075
         LA    @01,@AL00001                                        1075
         BALR  @14,@15                                             1075
*       RESPECIFY                                                  1076
*         RTNREG RSTD;                                             1076
*       TESTRC=RTNREG;                                             1077
         LR    TESTRC,RTNREG                                       1077
*       RESPECIFY                                                  1078
*         RTNREG UNRSTD;            /*                       @YD00175*/
*       IF TESTRC>0 THEN                                           1079
         LTR   TESTRC,TESTRC                                       1079
         BNP   @RF01079                                            1079
*         ALLOCRC=LASTCC04;         /*                       @YD00175*/
         LA    ALLOCRC,4                                           1080
*     END;                          /*                       @YD00175*/
*                                                                  1081
@RF01079 DS    0H                                                  1082
*   /*****************************************************************/
*   /*                                                               */
*   /* RESTORE REG 14 WITH THE RETURN ADDR OF CALLER. EXIT   @Y30LB31*/
*   /* FROM ALLOCRTN PASSING THE COND CODE IN REG 15.        @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1082
*   RESPECIFY                                                      1082
*     REG14 RSTD;                   /*                       @ZDR2054*/
@RF01070 DS    0H                                                  1083
*   REG14=RETADDR3;                 /*                       @Y30LB31*/
         L     REG14,RETADDR3                                      1083
*   RESPECIFY                                                      1084
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   RETURN CODE(ALLOCRC);           /*                       @Y30LB31*/
         LR    @15,ALLOCRC                                         1085
@EL00008 DS    0H                                                  1085
@EF00008 DS    0H                                                  1085
@ER00008 BR    @14                                                 1085
*   END ALLOCRTN;                   /*                       @Y30LB31*/
*                                                                  1087
*/********************************************************** @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* PROCEDURE NAME - UNIQVRTN                                @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* FUNCTION - DIRECTS THE ACTIVATE, VOLUME ATTRIBUTE UPDATE @Y30LB31*/
*/*            AND OPTIONAL NEW SERIAL NO. UPDATE FOR A BASE @Y30LB31*/
*/*            VOLUME.  DIRECTS REPLACING A BASE VOLUME WITH @ZDR2054*/
*/*            A COPY VOLUME WITHOUT RENAMING THE COPY       @ZDR2054*/
*/*            VOLUME.  CALLS ADDRTN FOR THE ACTIVATE AND    @ZDR2054*/
*/*            VOL ATTR UPDATE.  IF NEWSERIAL IS SPECIFIED,  @ZDR2054*/
*/*            CALLS SECCKRTN, CLABLRTN, AND VLABLRTN.       @Y30LB31*/
*/*            ISSUES MESSAGES IDC0722I AND IDC0724I.        @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* INPUT - FDTTBL, ADDVTBL, PRINTTBL FOR MSGS               @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* OUTPUT - RETURN CODE OF 0 INDICATES VOLUME ACTIVATED     @Y30LB31*/
*/*          AND RELABELED IF REQUESTED.                     @Y30LB31*/
*/*          RETURN CODE OF 8 INDICATES VOLUME HAS BEEN      @Y30LB31*/
*/*          ACTIVATED BUT ATTRIBUTES NOT UPDATED, OR        @Y30LB31*/
*/*          THE NEW SERIAL NOT UPDATED IN THE CARTRIDGE     @Y30LB31*/
*/*          OR VOLUME LABEL, OR THE MISMATCH RECOVERY FLAG  @Y30LB31*/
*/*          NOT CLEARED FROM THE INVENTORY.                 @Y30LB31*/
*/*          RETURN CODE OF 12 INDICATES VOLUME COULD NOT BE @Y30LB31*/
*/*          ACTIVATED.                                      @Y30LB31*/
*/*                                                          @Y30LB31*/
*/********************************************************** @Y30LB31*/
*                                                                  1087
*UNIQVRTN:                                                         1087
*   PROCEDURE OPTIONS(NOSAVEAREA,NOSAVE);/*                  @Y30LB31*/
*                                                                  1087
UNIQVRTN DS    0H                                                  1088
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL CONDITION CODE.                                 @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1088
*   DCL                                                            1088
*     UNIQVRC FIXED(15);            /*                       @Y30LB31*/
*                                                                  1088
*   /*****************************************************************/
*   /*                                                               */
*   /* SAVE CALLERS RETURN ADDRESS SINCE THERE IS NO FULL    @Y30LB31*/
*   /* SAVEAREA AND AUTOMATIC SAVING OF REGISTERS.           @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1089
*   RESPECIFY                                                      1089
*     REG14 RSTD;                   /*                       @ZDR2054*/
*   RETADDR1=REG14;                 /*                       @Y30LB31*/
         ST    REG14,RETADDR1                                      1090
*   RESPECIFY                                                      1091
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   OLDERID2=NEWERID2;                                             1092
         L     @02,@PC00001                                        1092
         L     @02,GDTTR2(,@02)                                    1092
         MVC   @TS00001(95),NEWERID2(@02)                          1092
         MVC   OLDERID2(95,@02),@TS00001                           1092
*   NEWID2='AVUQ';                  /*                       @Y30LB31*/
*                                                                  1093
         MVC   NEWID2(4,@02),@CC01854                              1093
*   /*****************************************************************/
*   /*                                                               */
*   /* INITIALIZE TO ZERO THE CONDITION CODE SET BY THIS     @Y30LB31*/
*   /* PROCEDURE.                                            @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1094
*   UNIQVRC=LASTCC00;               /*                       @Y30LB31*/
*                                                                  1094
         SLR   @02,@02                                             1094
         STH   @02,UNIQVRC                                         1094
*   /*****************************************************************/
*   /*                                                               */
*   /* ACTIVATE THE VOLUME AND IF NOT ALREADY OBTAINED BY    @Y30LB31*/
*   /* SETUPRTN DETERMINE THE CURRENT ATTRIBUTES OF THE VOL FROM THE */
*   /* MESSAGE DATA RETURNED FROM THE ACTIVATE OPERATION.    @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1095
*   CALL ADDRTN;                    /*                       @Y30LB31*/
         BAL   @14,ADDRTN                                          1095
*   RESPECIFY                                                      1096
*     RTNREG RSTD;                                                 1096
*   TESTRC=RTNREG;                                                 1097
         LR    TESTRC,RTNREG                                       1097
*   RESPECIFY                                                      1098
*     RTNREG UNRSTD;                /*                       @Y30LB31*/
*                                                                  1098
*   /*****************************************************************/
*   /*                                                               */
*   /* IF AN ERROR WAS ENCOUNTERED WHILE ACTIVATING THE VOL, @Y30LB31*/
*   /* THE VOLUME PROCESSING IS DISCONTINUED.                @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1099
*   IF TESTRC^=0 THEN               /*                       @Y30LB31*/
         LTR   TESTRC,TESTRC                                       1099
         BZ    @RF01099                                            1099
*     IF TESTRC=LASTCC08 THEN       /*                       @Y30LB31*/
         LA    @02,8                                               1100
         CR    TESTRC,@02                                          1100
         BNE   @RF01100                                            1100
*       UNIQVRC=LASTCC08;           /* VOL IS ACTIVE         @Y30LB31*/
         STH   @02,UNIQVRC                                         1101
*     ELSE                          /*                       @Y30LB31*/
*       UNIQVRC=LASTCC12;           /* VOL IS NOT ACTIVE     @Y30LB31*/
         B     @RC01100                                            1102
@RF01100 MVC   UNIQVRC(2),@CH00606                                 1102
*                                                                  1103
*   /*****************************************************************/
*   /*                                                               */
*   /* CONTINUE PROCESSING IF A NEW VOLUME SERIAL NO. IS     @Y30LB31*/
*   /* SPECIFIED AND NO ERRORS HAVE BEEN ENCOUNTERED.        @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1103
*   IF ADDR(NSER)^=NULLPTR&UNIQVRC=0 THEN/*                  @Y30LB31*/
@RC01100 DS    0H                                                  1103
@RF01099 SLR   @15,@15                                             1103
         L     @14,@PC00001+4                                      1103
         C     @15,FDTPTR+20(,@14)                                 1103
         BE    @RF01103                                            1103
         CH    @15,UNIQVRC                                         1103
         BNE   @RF01103                                            1103
*     DO;                           /*                       @Y30LB31*/
*                                                                  1104
*       /*************************************************************/
*       /*                                                           */
*       /* UNLESS THE ORIGINAL VOLUME SERIAL NO. IS BEING    @Y30LB31*/
*       /* RESTORED, VERIFY THAT THE VOLUME IS NONVSAM AND PASSWORD  */
*       /*                                                   @Y30LB31*/
*       /* CHECK THE PROTECTED DATASETS.                     @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1105
*       IF BRECOVSW=OFF THEN        /*                       @Y30LB31*/
         TM    BRECOVSW,B'00000001'                                1105
         BNZ   @RF01105                                            1105
*         DO;                       /*                       @Y30LB31*/
*           CALL SECCKRTN;          /*                       @Y30LB31*/
         BAL   @14,SECCKRTN                                        1107
*           RESPECIFY                                              1108
*             RTNREG RSTD;                                         1108
*           TESTRC=RTNREG;                                         1109
         LR    TESTRC,RTNREG                                       1109
*           RESPECIFY                                              1110
*             RTNREG UNRSTD;        /*                       @Y30LB31*/
*                                                                  1110
*           /*********************************************************/
*           /*                                                       */
*           /* EXIT FROM THIS PROCEDURE IF THE SECURITY CHECK        */
*           /*                                               @Y30LB31*/
*           /* FAILED. THE CONDITION CODE IS SET TO 8 BECAUSE THE    */
*           /* VOLUME HAS BEEN ACTIVATED.                    @Y30LB31*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1111
*           IF TESTRC^=0 THEN       /*                       @Y30LB31*/
         LTR   TESTRC,TESTRC                                       1111
         BZ    @RF01111                                            1111
*             UNIQVRC=LASTCC08;     /*                       @Y30LB31*/
         MVC   UNIQVRC(2),@CH00182                                 1112
*         END;                      /*                       @Y30LB31*/
*                                                                  1113
@RF01111 DS    0H                                                  1114
*       /*************************************************************/
*       /*                                                           */
*       /* UPDATE THE CARTRIDGE LABELS WITH THE NEW VOLUME   @Y30LB31*/
*       /* SERIAL NO. THEN ACTIVATE THE VOLUME AGAIN SINCE THE CART  */
*       /*                                                   @Y30LB31*/
*       /* LABEL UPDATE ALSO DEACTIVATED THE VOLUME. CALL CLABLRTN TO*/
*       /* DIRECT THESE OPERATIONS.                          @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1114
*       IF UNIQVRC=0 THEN           /*                       @Y30LB31*/
@RF01105 LH    @15,UNIQVRC                                         1114
         LTR   @15,@15                                             1114
         BNZ   @RF01114                                            1114
*         DO;                       /*                       @Y30LB31*/
*           CALL CLABLRTN;          /*                       @Y30LB31*/
         BAL   @14,CLABLRTN                                        1116
*           RESPECIFY                                              1117
*             RTNREG RSTD;                                         1117
*           TESTRC=RTNREG;                                         1118
         LR    TESTRC,RTNREG                                       1118
*           RESPECIFY                                              1119
*             RTNREG UNRSTD;        /*                       @Y30LB31*/
*                                                                  1119
*           /*********************************************************/
*           /*                                                       */
*           /* TEST THE RETURN CODE FROM CLABLRTN. IF AN     @Y30LB31*/
*           /* ERROR OCCURRED, SET THE CONDITION CODE ACCORDING TO   */
*           /* THE                                           @Y30LB31*/
*           /* ACTIVE OR INACTIVE STATUS OF THE VOL.         @Y30LB31*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1120
*           IF TESTRC^=0 THEN       /*                       @Y30LB31*/
         LTR   TESTRC,TESTRC                                       1120
         BZ    @RF01120                                            1120
*             IF TESTRC=LASTCC04 THEN/*                      @Y30LB31*/
*                                                                  1121
         C     TESTRC,@CF00043                                     1121
         BNE   @RF01121                                            1121
*               /*****************************************************/
*               /*                                                   */
*               /* IF THE PRELIMINARY ACTIVATE AND SECURITY  @Y30LB31*/
*               /* CHECK WERE BYPASSED, THE VOLUME HAS NOT BEEN      */
*               /* ACTIVATED.                                @Y30LB31*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  1122
*               IF BRECOVSW=ON THEN /*                       @Y30LB31*/
         TM    BRECOVSW,B'00000001'                                1122
         BNO   @RF01122                                            1122
*                 UNIQVRC=LASTCC12; /*                       @Y30LB31*/
*                                                                  1123
         MVC   UNIQVRC(2),@CH00606                                 1123
*           /*********************************************************/
*           /*                                                       */
*           /* ALTHOUGH THE CART LABEL UPDATE FAILED         @Y30LB31*/
*           /* THE VOL THAT HAS BEEN ACTIVATED. ISSUE MESSAGE        */
*           /* IDC0724I INDICATING THE VOLUME SERIAL NO. COULD NOT BE*/
*           /* CHANGED.                                      @Y30LB31*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1124
*               ELSE                /*                       @Y30LB31*/
*                 DO;               /*                       @Y30LB31*/
         B     @RC01122                                            1124
@RF01122 DS    0H                                                  1125
*                   UNIQVRC=LASTCC08;/*                      @Y30LB31*/
         MVC   UNIQVRC(2),@CH00182                                 1125
*                   PRINTTBL=''B;   /*                       @Y30LB31*/
         XC    PRINTTBL(28),PRINTTBL                               1126
*                   DARGSMOD=ADDVMSGS;/*                     @Y30LB31*/
         L     @15,DDSTRU                                          1127
         MVC   DARGSMOD(3,@15),@CC01687                            1127
*                   DARGSENT=MSG0724I;/* STID=AV05           @Y30LB31*/
         MVI   DARGSENT(@15),X'05'                                 1128
*                   DARGDBP=ADDR(MSVIVOL#);/*                @Y30LB31*/
         LA    @14,MSVIVOL#                                        1129
         ST    @14,DARGDBP(,@15)                                   1129
*                   DARGILP=LENGTH(MSVIVOL#);/*              @Y30LB31*/
         MVC   DARGILP(2,@15),@CH00159                             1130
*                   CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*  @Y30LB31*/
         L     @15,@PC00001                                        1131
         ST    @15,@AL00001                                        1131
         LA    @14,@CF00117                                        1131
         ST    @14,@AL00001+4                                      1131
         LA    @14,DDSTRU                                          1131
         ST    @14,@AL00001+8                                      1131
         MVI   @AL00001+8,X'80'                                    1131
         L     @15,GDTPRT(,@15)                                    1131
         LA    @01,@AL00001                                        1131
         BALR  @14,@15                                             1131
*                 END;              /*                       @Y30LB31*/
*                                                                  1132
*           /*********************************************************/
*           /*                                                       */
*           /* THE VOLUME COULD NOT BE ACTIVATED FOLLOWING   @Y30LB31*/
*           /* THE CART LABEL UPDATE.                        @Y30LB31*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1133
*             ELSE                  /*                       @Y30LB31*/
*               UNIQVRC=LASTCC12;   /*                       @Y30LB31*/
*                                                                  1133
         B     @RC01121                                            1133
@RF01121 MVC   UNIQVRC(2),@CH00606                                 1133
*           /*********************************************************/
*           /*                                                       */
*           /* FOLLOWING THE CART LABEL UPDATE PROCEED TO    @Y30LB31*/
*           /* CHANGE THE VOLUME SERIAL NO. IN THE VOLUME LABEL &    */
*           /* CLEAR                                         @Y30LB31*/
*           /* THE SERIAL-MISMATCH FLAG FROM THE INVENTORY. ALSO SET */
*           /*                                               @Y30LB31*/
*           /* READONLY ATTRIBUTE IF NEC. CALL VLABLRTN TO DIRECT    */
*           /* THESE                                         @Y30LB31*/
*           /* OPERATIONS.                                   @Y30LB31*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1134
*           ELSE                    /*                       @Y30LB31*/
*             DO;                   /*                       @Y30LB31*/
         B     @RC01120                                            1134
@RF01120 DS    0H                                                  1135
*               CALL VLABLRTN;      /*                       @Y30LB31*/
         BAL   @14,VLABLRTN                                        1135
*               RESPECIFY                                          1136
*                 RTNREG RSTD;                                     1136
*               TESTRC=RTNREG;                                     1137
         LR    TESTRC,RTNREG                                       1137
*               RESPECIFY                                          1138
*                 RTNREG UNRSTD;    /*                       @Y30LB31*/
*                                                                  1138
*               /*****************************************************/
*               /*                                                   */
*               /* SET THE COND CODE TO 8 IF THE VOL LABEL   @Y30LB31*/
*               /* UPDATE FAILED BECAUSE THE VOL IS ACTIVE, ALTHOUGH */
*               /* NOT FULLY RELABELED.                      @Y30LB31*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  1139
*               IF TESTRC^=0 THEN   /*                       @Y30LB31*/
         LTR   TESTRC,TESTRC                                       1139
         BZ    @RF01139                                            1139
*                 UNIQVRC=LASTCC08; /*                       @Y30LB31*/
         MVC   UNIQVRC(2),@CH00182                                 1140
*             END;                  /*                       @Y30LB31*/
*                                                                  1141
@RF01139 DS    0H                                                  1142
*           /*********************************************************/
*           /*                                                       */
*           /* CLOSE DO GROUP WHICH DIRECTED THE UPDATE OF   @Y30LB31*/
*           /* BOTH CART AND VOL LABELS.                     @Y30LB31*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1142
*         END;                      /*                       @Y30LB31*/
*                                                                  1142
@RC01120 DS    0H                                                  1143
*       /*************************************************************/
*       /*                                                           */
*       /* CLOSE THE DO GROUP WHICH PROCESSED THE NEW VOLUME @Y30LB31*/
*       /* SERIAL NO.                                        @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1143
*     END;                          /*                       @Y30LB31*/
@RF01114 DS    0H                                                  1144
*                                                                  1144
*   /*****************************************************************/
*   /*                                                               */
*   /* ISSUE AN INFORMATIVE MESSAGE IF THE VOLUME HAS BEEN   @Y30LB31*/
*   /* ACTIVATED ALTHOUGH ALL FUNCTION COULD NOT BE COMPLETED.       */
*   /*                                                       @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1144
*   IF(ADDR(NSER)=NULLPTR&UNIQVRC=0)×/*                      @Y30LB31*/
*       UNIQVRC=LASTCC08 THEN       /*                       @Y30LB31*/
@RF01103 SLR   @15,@15                                             1144
         L     @14,@PC00001+4                                      1144
         C     @15,FDTPTR+20(,@14)                                 1144
         BNE   @GL00036                                            1144
         CH    @15,UNIQVRC                                         1144
         BE    @RT01144                                            1144
@GL00036 CLC   UNIQVRC(2),@CH00182                                 1144
         BNE   @RF01144                                            1144
@RT01144 DS    0H                                                  1145
*     DO;                           /*                       @Y30LB31*/
*       PRINTTBL=''B;               /*                       @Y30LB31*/
         XC    PRINTTBL(28),PRINTTBL                               1146
*       DARGSMOD=ADDVMSGS;          /*                       @Y30LB31*/
         L     @15,DDSTRU                                          1147
         MVC   DARGSMOD(3,@15),@CC01687                            1147
*       DARGSENT=MSG0722I;          /* STID = AV03           @Y30LB31*/
         MVI   DARGSENT(@15),X'03'                                 1148
*       DARGDBP=ADDR(MSVIVOL#);     /*                       @Y30LB31*/
         LA    @14,MSVIVOL#                                        1149
         ST    @14,DARGDBP(,@15)                                   1149
*       DARGILP=LENGTH(MSVIVOL#);   /*                       @Y30LB31*/
         MVC   DARGILP(2,@15),@CH00159                             1150
*       CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*              @Y30LB31*/
         L     @15,@PC00001                                        1151
         ST    @15,@AL00001                                        1151
         LA    @14,@CF00117                                        1151
         ST    @14,@AL00001+4                                      1151
         LA    @14,DDSTRU                                          1151
         ST    @14,@AL00001+8                                      1151
         MVI   @AL00001+8,X'80'                                    1151
         L     @15,GDTPRT(,@15)                                    1151
         LA    @01,@AL00001                                        1151
         BALR  @14,@15                                             1151
*     END;                          /*                       @Y30LB31*/
*                                                                  1152
*   /*****************************************************************/
*   /*                                                               */
*   /* RESTORE REGISTER 14 WITH THE RETURN ADDRESS OF THE    @Y30LB31*/
*   /* CALLER AND EXIT FROM UNIQVRTN. PASS THE CONDITION CODE IN     */
*   /* REGISTER 15.                                          @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1153
*   RESPECIFY                                                      1153
*     REG14 RSTD;                   /*                       @ZDR2054*/
@RF01144 DS    0H                                                  1154
*   REG14=RETADDR1;                 /*                       @Y30LB31*/
         L     REG14,RETADDR1                                      1154
*   RESPECIFY                                                      1155
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   RETURN CODE(UNIQVRC);           /*                       @Y30LB31*/
         LH    @15,UNIQVRC                                         1156
@EL00009 DS    0H                                                  1156
@EF00009 DS    0H                                                  1156
@ER00009 BR    @14                                                 1156
*   END UNIQVRTN;                   /*                       @Y30LB31*/
*                                                                  1158
*/********************************************************** @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* PROCEDURE NAME - ADDRTN                                  @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* FUNCTION -  CALLS ACTVRTN TO ACTIVATE THE VOLUME         @Y30LB31*/
*/*            UNLESS THE ORIGINAL SERIAL NO. OF A BASE      @Y30LB31*/
*/*            VOLUME IS BEING RESTORED.  THEN               @Y30LB31*/
*/*             DETERMINES WHETHER THE VOLUME ATTRIBUTES     @Y30LB31*/
*/*             MUST BE UPDATED AND CALLS NEWVFTN TO CHANGE  @Y30LB31*/
*/*             THE ATTRIBUTES.  NO MESSAGES ARE ISSUED IN   @Y30LB31*/
*/*             THIS PROCEDURE.                              @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* INPUT - FDTTBL, ADDVTBL, BASEV, CMMSG, GROUP          @Y30LB31   */
*/*                                                          @Y30LB31*/
*/* OUTPUT -  RETURN CODE OF 0 INDICATES 1) VOLUME ACTIVATED @Y30LB31*/
*/*           AND ATTRIBUTES UPDATED, IF REQUIRED.         @Y30LB31  */
*/*          OR 2) IF THE ORIGINAL VOLUME SERIAL NO. IS      @Y30LB31*/
*/*          BEING RESTORED, THE CURRENT VOL ATTRIBUTES      @Y30LB31*/
*/*          WERE CHECKED FOR UPDATE.                       @Y30LB31 */
*/*           RETURN CODE OF 4 INDICATES VOLUME COULD NOT BE @Y30LB31*/
*/*           ACTIVATED.                                     @Y30LB31*/
*/*           RETURN CODE OF 8 INDICATES VOLUME IS ACTIVE    @Y30LB31*/
*/*           BUT ATTRIBUTES COULD NOT BE UPDATED.           @Y30LB31*/
*/*                                                          @Y30LB31*/
*/********************************************************** @Y30LB31*/
*                                                                  1158
*ADDRTN:                                                           1158
*   PROCEDURE OPTIONS(NOSAVEAREA,NOSAVE);/*                  @Y30LB31*/
*                                                                  1158
ADDRTN   DS    0H                                                  1159
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL CONDITION CODE.                                 @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1159
*   DCL                                                            1159
*     ADDRC FIXED(15);              /*                       @Y30LB31*/
*                                                                  1159
*   /*****************************************************************/
*   /*                                                               */
*   /* SAVE THE RETURN ADDRESS OF CALLER SINCE THERE IS NO   @Y30LB31*/
*   /* SAVEAREA. REG 14 WILL BE RESTORED UPON EXIT.          @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1160
*   RESPECIFY                                                      1160
*     REG14 RSTD;                   /*                       @ZDR2054*/
*   RETADDR2=REG14;                 /*                       @Y30LB31*/
         ST    REG14,RETADDR2                                      1161
*   RESPECIFY                                                      1162
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   OLDERID2=NEWERID2;                                             1163
         L     @05,@PC00001                                        1163
         L     @05,GDTTR2(,@05)                                    1163
         MVC   @TS00001(95),NEWERID2(@05)                          1163
         MVC   OLDERID2(95,@05),@TS00001                           1163
*   NEWID2='AVAD';                  /*                       @Y30LB31*/
*                                                                  1164
         MVC   NEWID2(4,@05),@CC01863                              1164
*   /*****************************************************************/
*   /*                                                               */
*   /* ZERO THE CONDITION CODE USED IN THIS PROCEDURE.       @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1165
*   ADDRC=LASTCC00;                 /*                       @Y30LB31*/
*                                                                  1165
         SLR   @02,@02                                             1165
         LR    ADDRC,@02                                           1165
*   /*****************************************************************/
*   /*                                                               */
*   /* BYPASS THE ACTIVATE AND SECURITY CHECK                @Y30LB31*/
*   /* IF THE ORIGINAL VOLUME SERIAL NO. IS BEING RESTORED. MERELY,  */
*   /* DETERMINE WHETHER THE CURRENT VOLUME ATTRIBUTES MUST BE       */
*   /* UPDATED.                                              @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1166
*   IF ADDR(NSER)^=NULLPTR&BCDVSMIS=ON&/*                    @Y30LB31*/
*       NSERVAL=BASRECOV THEN       /*                       @Y30LB31*/
         L     @05,@PC00001+4                                      1166
         L     @05,FDTPTR+20(,@05)                                 1166
         CR    @05,@02                                             1166
         BE    @RF01166                                            1166
         TM    BCDVSMIS(BCDVPTR),B'00100000'                       1166
         BNO   @RF01166                                            1166
         CLC   NSERVAL(6,@05),BASRECOV(BASEVPTR)                   1166
         BNE   @RF01166                                            1166
*     BRECOVSW=ON;                  /*                       @Y30LB31*/
         OI    BRECOVSW,B'00000001'                                1167
*   ELSE                            /*                       @Y30LB31*/
*     DO;                           /*                       @Y30LB31*/
*                                                                  1168
         B     @RC01166                                            1168
@RF01166 DS    0H                                                  1169
*       /*************************************************************/
*       /*                                                           */
*       /* ACTIVATE THE VOLUME AND IF THE VOLUME SERIAL NO IS        */
*       /*                                                   @Y30LB31*/
*       /* NOT BEING CHANGED, SAVE THE CURRENT VOLUME ATTRIBUTES AS  */
*       /* IDENTIFIED IN THE ACTIVATE MESSAGE.               @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1169
*       IF ADDR(NSER)=NULLPTR THEN  /*                       @Y30LB31*/
         L     @05,@PC00001+4                                      1169
         L     @05,FDTPTR+20(,@05)                                 1169
         LTR   @05,@05                                             1169
         BNZ   @RF01169                                            1169
*         MSGFLG=ON;                /*                       @Y30LB31*/
         OI    MSGFLG,B'00010000'                                  1170
*       ELSE                        /*                       @Y30LB31*/
*         MSGFLG=OFF;               /*                       @Y30LB31*/
         B     @RC01169                                            1171
@RF01169 NI    MSGFLG,B'11101111'                                  1171
*       CALL ACTVRTN;               /*                       @Y30LB31*/
@RC01169 BAL   @14,ACTVRTN                                         1172
*       RESPECIFY                                                  1173
*         RTNREG RSTD;                                             1173
*       TESTRC=RTNREG;                                             1174
         LR    TESTRC,RTNREG                                       1174
*       RESPECIFY                                                  1175
*         RTNREG UNRSTD;            /*                       @Y30LB31*/
*                                                                  1175
*       /*************************************************************/
*       /*                                                           */
*       /* TEST RETURN CODE FROM ACTVRTN. IF THE ACTIVATE    @Y30LB31*/
*       /* FAILED, EXIT FROM THIS PROCEDURE WITH AN ERROR COND CODE. */
*       /*                                                   @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1176
*       IF TESTRC^=0 THEN           /*                       @Y30LB31*/
         LTR   TESTRC,TESTRC                                       1176
         BZ    @RF01176                                            1176
*         ADDRC=4;                  /*                       @Y30LB31*/
*                                                                  1177
         LA    ADDRC,4                                             1177
*       /*************************************************************/
*       /*                                                           */
*       /* THE VOLUME IS NOW ACTIVE. SAVE THE VOLUME ATTRIBUTES      */
*       /*                                                   @Y30LB31*/
*       /* FROM THE MSSC ACTIVATE MSG IF THE MSG WAS RETURNED. THEN  */
*       /* RELEASE THE MESSAGE STOREAGE AREA. NOTE THAT IDCAV01 SET  */
*       /* THE DEFAULT ATTRIBUTE VALUES.                     @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1178
*       ELSE                        /*                       @Y30LB31*/
*         IF MSGFLG=ON THEN         /*                       @Y30LB31*/
         B     @RC01176                                            1178
@RF01176 TM    MSGFLG,B'00010000'                                  1178
         BNO   @RF01178                                            1178
*           DO;                     /*                       @Y30LB31*/
*             CMMSGPTR=ECBMSPTR+ECBLEN;/*                    @Y30LB31*/
         LA    CMMSGPTR,4                                          1180
         AL    CMMSGPTR,ECBMSPTR                                   1180
*             IF CMDERAS=ON THEN    /*                       @Y30LB31*/
         TM    CMDERAS(CMMSGPTR),B'00100000'                       1181
         BNO   @RF01181                                            1181
*               OLDDEFLG=ON;        /*                       @Y30LB31*/
         OI    OLDDEFLG,B'01000000'                                1182
*             IF CMEXCL=ON THEN     /*                       @Y30LB31*/
@RF01181 TM    CMEXCL(CMMSGPTR),B'00010000'                        1183
         BNO   @RF01183                                            1183
*               OLDEXFLG=ON;        /*                       @Y30LB31*/
         OI    OLDEXFLG,B'00100000'                                1184
*             IF CMBIND=ON THEN     /*                       @Y30LB31*/
@RF01183 TM    CMBIND(CMMSGPTR),B'00000100'                        1185
         BNO   @RF01185                                            1185
*               OLDBIFLG=ON;        /*                       @Y30LB31*/
         OI    OLDBIFLG,B'10000000'                                1186
*             IF CMRONLY=ON THEN    /*                       @Y30LB31*/
@RF01185 TM    CMRONLY(CMMSGPTR),B'00000010'                       1187
         BNO   @RF01187                                            1187
*               OLDROFLG=ON;        /*                       @Y30LB31*/
         OI    OLDROFLG,B'00010000'                                1188
*             CALL IDCSAFS0(GDTTBL,ECBMSPTR);/*              @Y30LB31*/
@RF01187 L     @05,@PC00001                                        1189
         ST    @05,@AL00001                                        1189
         LA    @02,ECBMSPTR                                        1189
         ST    @02,@AL00001+4                                      1189
         L     @15,GDTFSP(,@05)                                    1189
         LA    @01,@AL00001                                        1189
         BALR  @14,@15                                             1189
*           END;                    /*                       @Y30LB31*/
*                                                                  1190
*       /*************************************************************/
*       /*                                                           */
*       /* CLOSE DO GROUP WHICH DIRECTS THE VOLUME ACTIVATE. @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1191
*     END;                          /*                       @Y30LB31*/
*                                                                  1191
@RF01178 DS    0H                                                  1191
@RC01176 DS    0H                                                  1192
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THE BASE VOLUME BEING ACTIVATED IS GENERAL-USE     @G24LB23*/
*   /* AND NEW SERIAL IS NOT SPECIFIED, THE VOLUME IS NOT GOING TO BE*/
*   /* MOUNTED. THEREFORE CALL DLSPRTN TO DETERMINE IF VOLUME SHOULD */
*   /* BE MOUNTED.                                           @G24LB23*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1192
*   IF ADDR(NSER)=NULLPTR&BASGENUS=ON&ADDRC=0 THEN/*         @G24LB23*/
@RC01166 SLR   @05,@05                                             1192
         L     @02,@PC00001+4                                      1192
         C     @05,FDTPTR+20(,@02)                                 1192
         BNE   @RF01192                                            1192
         TM    BASGENUS(BASEVPTR),B'00010000'                      1192
         BNO   @RF01192                                            1192
         CR    ADDRC,@05                                           1192
         BNE   @RF01192                                            1192
*     DO;                           /*                       @G24LB23*/
*       CALL DLSPRTN;               /*                       @G24LB23*/
*                                                                  1194
         BAL   @14,DLSPRTN                                         1194
*       /*************************************************************/
*       /*                                                           */
*       /* TEST RETURN CODE. IF BAD RETURN, EXIT FROM THIS   @G24LB23*/
*       /* PROCEDURE WITH AN ERROR COND CODE.                @G24LB23*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1195
*       RESPECIFY                                                  1195
*         RTNREG RSTD;                                             1195
*       TESTRC=RTNREG;                                             1196
         LR    TESTRC,RTNREG                                       1196
*       RESPECIFY                                                  1197
*         RTNREG UNRSTD;            /*                       @G24LB23*/
*       ADDRC=TESTRC;               /*                       @G24LB23*/
         LR    ADDRC,TESTRC                                        1198
*     END;                          /*                       @G24LB23*/
*                                                                  1200
*   /*****************************************************************/
*   /*                                                               */
*   /* DETERMINE WHETHER THE CURRENT VOLUME ATTRIBUTES MUST  #Y30LB31*/
*   /* BE UPDATED TO AGREE WITH A GROUP OR TO BE CHANGED FROM        */
*   /* READONLY BECAUSE READWRITE IS SPECIFIED.              #Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1200
*   IF ADDRC=0 THEN                 /*                       #Y30LB31*/
@RF01192 LTR   ADDRC,ADDRC                                         1200
         BNZ   @RF01200                                            1200
*     IF BASGENUS=ON THEN           /*                       #Y30LB31*/
         TM    BASGENUS(BASEVPTR),B'00010000'                      1201
         BNO   @RF01201                                            1201
*       DO;                         /*                       #Y30LB31*/
*                                                                  1202
*         /***********************************************************/
*         /*                                                         */
*         /* UPDATE THE VOLUME BIND/NOBIND ATTRIBUTE TO      #Y30LB31*/
*         /* AGREE WITH THE GROUP.                           @Y30LB31*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  1203
*         IF GROBIND=OFF&OLDBIFLG=OFF THEN/*                 @Y30LB31*/
         L     @05,GROUPPTR                                        1203
         TM    GROBIND(@05),B'10000000'                            1203
         BNZ   @RF01203                                            1203
         TM    OLDBIFLG,B'10000000'                                1203
         BNZ   @RF01203                                            1203
*           NEWBIFLG=OFF;           /* VOL ATTR NOT CHANGED  @Y30LB31*/
         NI    NEWBIFLG,B'11110111'                                1204
*         ELSE                      /*                       @Y30LB31*/
*           IF GROBIND=ON&OLDBIFLG=ON THEN/*                 @Y30LB31*/
         B     @RC01203                                            1205
@RF01203 L     @05,GROUPPTR                                        1205
         TM    GROBIND(@05),B'10000000'                            1205
         BNO   @RF01205                                            1205
         TM    OLDBIFLG,B'10000000'                                1205
         BNO   @RF01205                                            1205
*             NEWBIFLG=ON;          /* VOL ATTR NOT CHANGED  @Y30LB31*/
         OI    NEWBIFLG,B'00001000'                                1206
*           ELSE                    /*                       @Y30LB31*/
*             DO;                   /*                       @Y30LB31*/
         B     @RC01205                                            1207
@RF01205 DS    0H                                                  1208
*               NEWVFFLG=ON;        /*                       @Y30LB31*/
*               GRPMSFLG=ON;        /*                       @Y30LB31*/
         OI    NEWVFFLG,B'00001010'                                1209
*               IF GROBIND=OFF THEN /*                       @Y30LB31*/
         L     @05,GROUPPTR                                        1210
         TM    GROBIND(@05),B'10000000'                            1210
         BNZ   @RF01210                                            1210
*                 NEWBIFLG=OFF;     /* VOL ATTR CHANGED      @Y30LB31*/
         NI    NEWBIFLG,B'11110111'                                1211
*               ELSE                /*                       @Y30LB31*/
*                 NEWBIFLG=ON;      /* VOL ATTR CHANGED      @Y30LB31*/
         B     @RC01210                                            1212
@RF01210 OI    NEWBIFLG,B'00001000'                                1212
*             END;                  /*                       @Y30LB31*/
*                                                                  1213
@RC01210 DS    0H                                                  1214
*         /***********************************************************/
*         /*                                                         */
*         /* UPDATE THE VOLUME DASDERASE/NODASDERASE         @Y30LB31*/
*         /* ATTRIBUTE TO AGREE WITH THE GROUP.              @Y30LB31*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  1214
*         IF GRODAERA=OFF&OLDDEFLG=OFF THEN/*                @Y30LB31*/
@RC01205 DS    0H                                                  1214
@RC01203 L     @05,GROUPPTR                                        1214
         TM    GRODAERA(@05),B'00100000'                           1214
         BNZ   @RF01214                                            1214
         TM    OLDDEFLG,B'01000000'                                1214
         BNZ   @RF01214                                            1214
*           NEWDEFLG=OFF;           /* VOL ATTR NOT CHANGED  @Y30LB31*/
         NI    NEWDEFLG,B'11111011'                                1215
*         ELSE                      /*                       @Y30LB31*/
*           IF GRODAERA=ON&OLDDEFLG=ON THEN/*                @Y30LB31*/
         B     @RC01214                                            1216
@RF01214 L     @05,GROUPPTR                                        1216
         TM    GRODAERA(@05),B'00100000'                           1216
         BNO   @RF01216                                            1216
         TM    OLDDEFLG,B'01000000'                                1216
         BNO   @RF01216                                            1216
*             NEWDEFLG=ON;          /* VOL ATTR NOT CHANGED  @Y30LB31*/
         OI    NEWDEFLG,B'00000100'                                1217
*           ELSE                    /*                       @Y30LB31*/
*             DO;                   /*                       @Y30LB31*/
         B     @RC01216                                            1218
@RF01216 DS    0H                                                  1219
*               NEWVFFLG=ON;        /*                       @Y30LB31*/
*               GRPMSFLG=ON;        /*                       @Y30LB31*/
         OI    NEWVFFLG,B'00001010'                                1220
*               IF GRODAERA=OFF THEN/*                       @Y30LB31*/
         L     @05,GROUPPTR                                        1221
         TM    GRODAERA(@05),B'00100000'                           1221
         BNZ   @RF01221                                            1221
*                 NEWDEFLG=OFF;     /* VOL ATTR CHANGED      @Y30LB31*/
         NI    NEWDEFLG,B'11111011'                                1222
*               ELSE                /*                       @Y30LB31*/
*                 NEWDEFLG=ON;      /* VOL ATTR CHANGED      @Y30LB31*/
         B     @RC01221                                            1223
@RF01221 OI    NEWDEFLG,B'00000100'                                1223
*             END;                  /*                       @Y30LB31*/
*                                                                  1224
@RC01221 DS    0H                                                  1225
*         /***********************************************************/
*         /*                                                         */
*         /* UPDATE THE VOLUME EXCLUSIVE/SHARED ATTRIBUTE TO @Y30LB31*/
*         /* AGREE WITH THE GROUP.                           @Y30LB31*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  1225
*         IF GROEXCL=OFF&OLDEXFLG=OFF THEN/*                 @Y30LB31*/
@RC01216 DS    0H                                                  1225
@RC01214 L     @05,GROUPPTR                                        1225
         TM    GROEXCL(@05),B'01000000'                            1225
         BNZ   @RF01225                                            1225
         TM    OLDEXFLG,B'00100000'                                1225
         BNZ   @RF01225                                            1225
*           NEWEXFLG=OFF;           /* VOL ATTR NOT CHANGED  @Y30LB31*/
         NI    NEWEXFLG,B'11111101'                                1226
*         ELSE                      /*                       @Y30LB31*/
*           IF GROEXCL=ON&OLDEXFLG=ON THEN/*                 @Y30LB31*/
         B     @RC01225                                            1227
@RF01225 L     @05,GROUPPTR                                        1227
         TM    GROEXCL(@05),B'01000000'                            1227
         BNO   @RF01227                                            1227
         TM    OLDEXFLG,B'00100000'                                1227
         BNO   @RF01227                                            1227
*             NEWEXFLG=ON;          /* VOL ATTR NOT CHANGED  @Y30LB31*/
         OI    NEWEXFLG,B'00000010'                                1228
*           ELSE                    /*                       @Y30LB31*/
*             DO;                   /*                       @Y30LB31*/
         B     @RC01227                                            1229
@RF01227 DS    0H                                                  1230
*               NEWVFFLG=ON;        /*                       @Y30LB31*/
*               GRPMSFLG=ON;        /*                       @Y30LB31*/
         OI    NEWVFFLG,B'00001010'                                1231
*               IF GROEXCL=OFF THEN /*                       @Y30LB31*/
         L     @05,GROUPPTR                                        1232
         TM    GROEXCL(@05),B'01000000'                            1232
         BNZ   @RF01232                                            1232
*                 NEWEXFLG=OFF;     /* CHANGE VOL ATTR       @Y30LB31*/
         NI    NEWEXFLG,B'11111101'                                1233
*               ELSE                /*                       @Y30LB31*/
*                 NEWEXFLG=ON;      /* CHANGE VOL ATTR       @Y30LB31*/
         B     @RC01232                                            1234
@RF01232 OI    NEWEXFLG,B'00000010'                                1234
*             END;                  /*                       @Y30LB31*/
*                                                                  1235
@RC01232 DS    0H                                                  1236
*         /***********************************************************/
*         /*                                                         */
*         /* UPDATE THE VOLUME READONLY/READWRITE ATTRIBUTE  @Y30LB31*/
*         /* TO AGREE WITH THE GROUP. NOTE. THESE ATTRIBUTES MUST BE */
*         /* TESTED LAST BECAUSE SPECIAL SWITCHES DEPEND UPON WHETHER*/
*         /* OR NOT VOLUME ATTRIBUTES OTHER THAN READONLY/READWRITE  */
*         /* ARE ALSO BEING CHANGED.                         @Y30LB31*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  1236
*         IF GRORONLY=OFF&OLDROFLG=OFF THEN/*                @Y30LB31*/
@RC01227 DS    0H                                                  1236
@RC01225 L     @05,GROUPPTR                                        1236
         TM    GRORONLY(@05),B'00010000'                           1236
         BNZ   @RF01236                                            1236
         TM    OLDROFLG,B'00010000'                                1236
         BNZ   @RF01236                                            1236
*           NEWROFLG=OFF;           /* VOL ATTR NOT CHANGED  @Y30LB31*/
         NI    NEWROFLG,B'11111110'                                1237
*         ELSE                      /*                       @Y30LB31*/
*           IF GRORONLY=ON&OLDROFLG=ON THEN/*                @Y30LB31*/
         B     @RC01236                                            1238
@RF01236 L     @05,GROUPPTR                                        1238
         TM    GRORONLY(@05),B'00010000'                           1238
         BNO   @RF01238                                            1238
         TM    OLDROFLG,B'00010000'                                1238
         BNO   @RF01238                                            1238
*             NEWROFLG=ON;          /* VOL ATTR NOT CHANGED  @Y30LB31*/
         OI    NEWROFLG,B'00000001'                                1239
*           ELSE                    /*                       @Y30LB31*/
*             DO;                   /*                       @Y30LB31*/
*                                                                  1240
         B     @RC01238                                            1240
@RF01238 DS    0H                                                  1241
*               /*****************************************************/
*               /*                                                   */
*               /* SET A SWITCH TO INDICATE                  @Y30LB31*/
*               /* MESSAGES IDC0073I OR IDC2725I ARE TO BE ISSUED IF */
*               /* THE ATTRIBUTES ARE BEING CHANGED BY DEFAULT TO    */
*               /* AGREE WITH THE GROUP. IF READWRITE HAS BEEN       */
*               /* SPECIFIED BY THE USER AND IS THE ONLY ATTRIBUTE TO*/
*               /* BE SET, THESE MESSAGES ARE NOT ISSUED.    @Y30LB31*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  1241
*               GRPMSFLG=ON;        /*                       @Y30LB31*/
         OI    GRPMSFLG,B'00000010'                                1241
*               IF GRORONLY=OFF THEN/*                       @Y30LB31*/
         L     @05,GROUPPTR                                        1242
         TM    GRORONLY(@05),B'00010000'                           1242
         BNZ   @RF01242                                            1242
*                 DO;               /*                       @Y30LB31*/
*                   NEWROFLG=OFF;   /*                       @Y30LB31*/
         NI    NEWROFLG,B'11111110'                                1244
*                   IF NEWVFFLG=OFF&ADDR(RWOPT)^=NULLPTR THEN/*    1245
*                                                            @Y30LB31*/
         TM    NEWVFFLG,B'00001000'                                1245
         BNZ   @RF01245                                            1245
         L     @05,@PC00001+4                                      1245
         L     @05,FDTPTR+24(,@05)                                 1245
         LTR   @05,@05                                             1245
         BZ    @RF01245                                            1245
*                     GRPMSFLG=OFF; /*                       @Y30LB31*/
         NI    GRPMSFLG,B'11111101'                                1246
*                 END;              /*                       @Y30LB31*/
*               ELSE                /*                       @Y30LB31*/
*                 DO;               /*                       @Y30LB31*/
         B     @RC01242                                            1248
@RF01242 DS    0H                                                  1249
*                   NEWROFLG=ON;    /*                       @Y30LB31*/
*                                                                  1249
         OI    NEWROFLG,B'00000001'                                1249
*                   /*************************************************/
*                   /*                                               */
*                   /* IF READONLY IS THE ONLY ATTRIBUTE BEING SET TO*/
*                   /*                                       @Y30LB31*/
*                   /* AGREE WITH THE GROUP, SET A SWITCH TO AVOID   */
*                   /* ISSUING MESSAGE IDC0073I OR IDC2725I MORE THAN*/
*                   /* ONCE DURING PROGRAM EXECUTION.        @Y30LB31*/
*                   /*                                               */
*                   /*************************************************/
*                                                                  1250
*                   IF NEWVFFLG=OFF THEN/*                   @Y30LB31*/
         TM    NEWVFFLG,B'00001000'                                1250
         BNZ   @RF01250                                            1250
*                     ONLYROSW=ON;  /*                       @Y30LB31*/
         OI    ONLYROSW,B'10000000'                                1251
*                 END;              /*                       @Y30LB31*/
*                                                                  1252
@RF01250 DS    0H                                                  1253
*               /*****************************************************/
*               /*                                                   */
*               /* THE SWITCH THAT INDICATES VOLUME ATTRIBUTES       */
*               /*                                           @Y30LB31*/
*               /* UST BE UPDATED IS NOT SET UNTIL ALL               */
*               /* READONLY/READWRITE SPECIAL CHECKS HAVE BEEN MADE. */
*               /*                                           @Y30LB31*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  1253
*               NEWVFFLG=ON;        /*                       @Y30LB31*/
@RC01242 OI    NEWVFFLG,B'00001000'                                1253
*             END;                  /*                       @Y30LB31*/
*                                                                  1254
*         /***********************************************************/
*         /*                                                         */
*         /* CLOSE DO GROUP WHICH CONTRASTED VOLUME AND GROUP        */
*         /*                                                 @Y30LB31*/
*         /* ATTRIBUTES.                                     @Y30LB31*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  1255
*       END;                        /*                       @Y30LB31*/
*                                                                  1255
*   /*****************************************************************/
*   /*                                                               */
*   /* SINCE THE BASE VOLUME DOES NOT BELONG TO A GROUP,     @Y30LB31*/
*   /* CHANGE THE VOLUME ATTRIBUTES ONLY IF READWRITE IS SPECIFIED   */
*   /* AND THE VOLUME IS READONLY. THE OTHER ATTRIBUTES ARE NOT      */
*   /* CHANGED. THE DEFAULT ATTRIBUTES WERE INITIALIZED TO OFF IN    */
*   /* IDCAV01 PROC.                                         @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1256
*     ELSE                          /*                       @Y30LB31*/
*       IF ADDR(RWOPT)^=NULLPTR&OLDROFLG=ON THEN/*           @Y30LB31*/
         B     @RC01201                                            1256
@RF01201 L     @05,@PC00001+4                                      1256
         L     @05,FDTPTR+24(,@05)                                 1256
         LTR   @05,@05                                             1256
         BZ    @RF01256                                            1256
         TM    OLDROFLG,B'00010000'                                1256
         BNO   @RF01256                                            1256
*         DO;                       /*                       @Y30LB31*/
*           NEWVFFLG=ON;            /*                       @Y30LB31*/
         OI    NEWVFFLG,B'00001000'                                1258
*           NEWROFLG=OFF;           /* READWRITE=OFF         @Y30LB31*/
         NI    NEWROFLG,B'11111110'                                1259
*           IF OLDBIFLG=ON THEN     /*                       @Y30LB31*/
         TM    OLDBIFLG,B'10000000'                                1260
         BNO   @RF01260                                            1260
*             NEWBIFLG=ON;          /*                       @Y30LB31*/
         OI    NEWBIFLG,B'00001000'                                1261
*           IF OLDEXFLG=ON THEN     /*                       @Y30LB31*/
@RF01260 TM    OLDEXFLG,B'00100000'                                1262
         BNO   @RF01262                                            1262
*             NEWEXFLG=ON;          /*                       @Y30LB31*/
         OI    NEWEXFLG,B'00000010'                                1263
*           IF OLDDEFLG=ON THEN     /*                       @Y30LB31*/
@RF01262 TM    OLDDEFLG,B'01000000'                                1264
         BNO   @RF01264                                            1264
*             NEWDEFLG=ON;          /*                       @Y30LB31*/
         OI    NEWDEFLG,B'00000100'                                1265
*         END;                      /*                       @Y30LB31*/
@RF01264 DS    0H                                                  1267
*                                                                  1267
*   /*****************************************************************/
*   /*                                                               */
*   /* UPDATE THE VOLUME ATTRIBUTES IF NECESSARY. IF THE     @Y30LB31*/
*   /* VOLUME SERIAL NO. IS BEING CHANGED, DO NOT UPDATE THE ATTRI-  */
*   /* BUTES AT THIS TIME BUT IN CONJUNCTION WITH THE SUBSEQUENT MSC */
*   /* RENAME OPERATION.                                     @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1267
*   IF ADDRC=0 THEN                 /*                       @Y30LB31*/
@RF01256 DS    0H                                                  1267
@RC01201 DS    0H                                                  1267
@RF01200 SLR   @05,@05                                             1267
         CR    ADDRC,@05                                           1267
         BNE   @RF01267                                            1267
*     IF NEWVFFLG=ON&ADDR(NSER)=NULLPTR THEN/*               @Y30LB31*/
         TM    NEWVFFLG,B'00001000'                                1268
         BNO   @RF01268                                            1268
         L     @15,@PC00001+4                                      1268
         C     @05,FDTPTR+20(,@15)                                 1268
         BNE   @RF01268                                            1268
*       DO;                         /*                       @Y30LB31*/
*         CALL NEWVFRTN;            /*                       @Y30LB31*/
         BAL   @14,NEWVFRTN                                        1270
*         RESPECIFY                                                1271
*           RTNREG RSTD;                                           1271
*         TESTRC=RTNREG;                                           1272
         LR    TESTRC,RTNREG                                       1272
*         RESPECIFY                                                1273
*           RTNREG UNRSTD;          /*                       @Y30LB31*/
*                                                                  1273
*         /***********************************************************/
*         /*                                                         */
*         /* TEST THE RETURN CODE FROM NEWVFRTN. IF THE      @Y30LB31*/
*         /* REQUEST FAILED TO UPDATE THE ATTRIBUTES, UPDATE THE COND*/
*         /* CODE AND EXIT FROM THIS PROCEDURE.              @Y30LB31*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  1274
*         IF TESTRC^=0 THEN         /*                       @Y30LB31*/
         LTR   TESTRC,TESTRC                                       1274
         BZ    @RF01274                                            1274
*           ADDRC=LASTCC08;         /*                       @Y30LB31*/
         LA    ADDRC,8                                             1275
*       END;                        /*                       @Y30LB31*/
*                                                                  1276
@RF01274 DS    0H                                                  1277
*   /*****************************************************************/
*   /*                                                               */
*   /* RESTORE THE RETURN ADDRESS OF THE CALLER IN REG 14    @Y30LB31*/
*   /* AND RETURN TO CALLER, PASSING THE CONDITION CODE IN REG 15.   */
*   /*                                                       @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1277
*   RESPECIFY                                                      1277
*     REG14 RSTD;                   /*                       @ZDR2054*/
@RF01268 DS    0H                                                  1277
@RF01267 DS    0H                                                  1278
*   REG14=RETADDR2;                 /*                       @Y30LB31*/
         L     REG14,RETADDR2                                      1278
*   RESPECIFY                                                      1279
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   RETURN CODE(ADDRC);             /*                       @Y30LB31*/
         LR    @15,ADDRC                                           1280
@EL00010 DS    0H                                                  1280
@EF00010 DS    0H                                                  1280
@ER00010 BR    @14                                                 1280
*   END ADDRTN;                     /*                       @Y30LB31*/
*                                                                  1282
*/********************************************************** @G24LB23*/
*/*                                                          @G24LB23*/
*/* PROCEDURE NAME - DLSPRTN                                 @G24LB23*/
*/*                                                          @G24LB23*/
*/* FUNCTION - CHECKS A VOLUME BEING ACTIVATED FOR A DOWN    @G24LB23*/
*/*            LEVEL SPACE CONDITION.  IF THE VOLUME HAS DOWN@G24LB23*/
*/*            LEVEL SPACE AND BELONGS TO A GROUP OTHER      @G24LB23*/
*/*            THAN SYSGROUP, MAKES CERTAIN THAT EITHER      @G24LB23*/
*/*            THE VOLUME GETS MOUNTED OR THAT AN ERROR      @G24LB23*/
*/*            CONDITION IS NOTED.                           @G24LB23*/
*/*                                                          @G24LB23*/
*/* INPUT - FDTTBL, BASEV, ADDVTBL, MDAGL                    @G24LB23*/
*/*                                                          @G24LB23*/
*/* OUTPUT - RETURN CODE 0 INDICATES NOT A DOWN LEVEL        @G24LB23*/
*/*          SPACE CONDITION OR ELSE THE VOLUME WAS          @G24LB23*/
*/*          SUCCESSFULLY MOUNTED.                           @G24LB23*/
*/*          RETURN CODE 8 INDICATES ATTEMPT TO MOUNT THE    @G24LB23*/
*/*          VOLUME FAILED AND THE DEACTIVATE WHICH          @G24LB23*/
*/*          FOLLOWED ALSO FAILED.                           @G24LB23*/
*/*          RETURN CODE 12 INDICATES ATTEMPT TO MOUNT       @G24LB23*/
*/*          THE VOLUME FAILED AND THE VOLUME HAS BEEN       @G24LB23*/
*/*          DEACTIVATED.                                    @G24LB23*/
*/*                                                          @G24LB23*/
*/********************************************************** @G24LB23*/
*                                                                  1282
*DLSPRTN:                                                          1282
*   PROCEDURE OPTIONS(NOSAVEAREA,NOSAVE);/*                  @G24LB23*/
*                                                                  1282
DLSPRTN  DS    0H                                                  1283
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL CONDITION CODE                                  @G24LB23*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1283
*   DCL                                                            1283
*     DLSRC FIXED(15);              /*                       @G24LB23*/
*                                                                  1283
*   /*****************************************************************/
*   /*                                                               */
*   /* RETURN ADDRESS                                        @G24LB23*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1284
*   DCL                                                            1284
*     DLSRET FIXED(31);             /*                       @G24LB23*/
*                                                                  1284
*   /*****************************************************************/
*   /*                                                               */
*   /* SAVE THE RETURN ADDRESS OF CALLER SINCE THERE IS      @G24LB23*/
*   /* NO SAVEAREA. REG 14 WILL BE RESTORED UPON EXIT.       @G24LB23*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1285
*   RESPECIFY                                                      1285
*     REG14 RSTD;                   /*                       @G24LB23*/
*   DLSRET=REG14;                   /*                       @G24LB23*/
         ST    REG14,DLSRET                                        1286
*   RESPECIFY                                                      1287
*     REG14 UNRSTD;                 /*                       @G24LB23*/
*   OLDERID2=NEWERID2;                                             1288
         L     @04,@PC00001                                        1288
         L     @04,GDTTR2(,@04)                                    1288
         MVC   @TS00001(95),NEWERID2(@04)                          1288
         MVC   OLDERID2(95,@04),@TS00001                           1288
*   NEWID2='AVDL';                  /*                       @G24LB23*/
*                                                                  1289
         MVC   NEWID2(4,@04),@CC01872                              1289
*   /*****************************************************************/
*   /*                                                               */
*   /* ZERO OUT THE CONDITION CODE USED WITHIN THIS          @G24LB23*/
*   /* PROCEDURE                                             @G24LB23*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1290
*   DLSRC=LASTCC00;                 /*                       @G24LB23*/
*                                                                  1290
         SLR   DLSRC,DLSRC                                         1290
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THE DOWN LEVEL SPACE FLAG IS ON AND THE            @G24LB23*/
*   /* VOLUME BELONGS TO A GROUP OTHER THAN SYSGROUP, MAKE SURE THE  */
*   /* VOLUME GETS MOUNTED                                   @G24LB23*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1291
*   IF BASDLSF=ON&BASGROUP^=SYSGROUP/*                       @G24LB23*/
*     THEN                          /*                       @G24LB23*/
         TM    BASDLSF(BASEVPTR),B'10000000'                       1291
         BNO   @RF01291                                            1291
         CLC   BASGROUP(8,BASEVPTR),@CC01670                       1291
         BE    @RF01291                                            1291
*     DO;                           /*                       @G24LB23*/
*                                                                  1292
*       /*************************************************************/
*       /*                                                           */
*       /* DYNAMICALLY ALLOCATE A UNIT IF THE UNIT           @G24LB23*/
*       /* IS NOT ALREADY ALLOCATED                          @G24LB23*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1293
*       IF AUNITDDN=NODDNAME THEN   /*                       @G24LB23*/
         CLC   AUNITDDN(8),@CB01651                                1293
         BNE   @RF01293                                            1293
*         DO;                       /*                       @G24LB23*/
*           CALL ALLOCRTN;          /*                       @G24LB23*/
         BAL   @14,ALLOCRTN                                        1295
*           RESPECIFY                                              1296
*             RTNREG RSTD;                                         1296
*           TESTRC=RTNREG;                                         1297
         LR    TESTRC,RTNREG                                       1297
*           RESPECIFY                                              1298
*             RTNREG UNRSTD;        /*                       @G24LB23*/
*         END;                      /*                       @G24LB23*/
*                                                                  1299
*       /*************************************************************/
*       /*                                                           */
*       /* CALL AN AMS SYSTEM ADAPTER ROUTINE                @G24LB23*/
*       /* TO MOUNT THE VOLUME                               @G24LB23*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1300
*       IF TESTRC=0 THEN                                           1300
@RF01293 LTR   TESTRC,TESTRC                                       1300
         BNZ   @RF01300                                            1300
*         DO;                       /*                       @G24LB23*/
*                                                                  1301
*           /*********************************************************/
*           /*                                                       */
*           /* INITIALIZE THE MOUNT-DEMOUNT ARGUMENT LIST    @G24LB23*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1302
*           MDDDNAME=AUNITDDN;      /*                       @G24LB23*/
         LA    @04,AVMDAGL                                         1302
         MVC   MDDDNAME(8,@04),AUNITDDN                            1302
*           MDUCBPTR=ADDR(AUNITUCB);/*                       @G24LB23*/
         LA    @02,AUNITUCB                                        1303
         ST    @02,MDUCBPTR(,@04)                                  1303
*           MDLABEL=BASSERNO;       /*                       @G24LB23*/
         MVC   MDLABEL(6,@04),BASSERNO(BASEVPTR)                   1304
*           AMDTYPE=MOUNT;          /*                       @G24LB23*/
         MVC   AMDTYPE(8),MOUNT                                    1305
*           CALL IDCSA060(GDTTBL,AMDTYPE,MDAGL);/*           @G24LB23*/
         L     @02,@PC00001                                        1306
         ST    @02,@AL00001                                        1306
         LA    @15,AMDTYPE                                         1306
         ST    @15,@AL00001+4                                      1306
         ST    @04,@AL00001+8                                      1306
         MVI   @AL00001+8,X'80'                                    1306
         L     @15,GDTUNT(,@02)                                    1306
         LA    @01,@AL00001                                        1306
         BALR  @14,@15                                             1306
*           RESPECIFY                                              1307
*             RTNREG RSTD;                                         1307
*           TESTRC=RTNREG;                                         1308
         LR    TESTRC,RTNREG                                       1308
*           RESPECIFY                                              1309
*             RTNREG UNRSTD;        /*                       @G24LB23*/
*         END;                      /*                       @G24LB23*/
*                                                                  1310
*       /*************************************************************/
*       /*                                                           */
*       /* IF VOLUME COULD NOT BE MOUNTED, DEACTIVATE        @G24LB23*/
*       /* THE VOLUME                                        @G24LB23*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1311
*       IF TESTRC^=0 THEN                                          1311
@RF01300 LTR   TESTRC,TESTRC                                       1311
         BZ    @RF01311                                            1311
*         DO;                       /*                       @G24LB23*/
*           DEFLIST=''B;            /*                       @G24LB23*/
         L     @02,DEFVPTR                                         1313
         XC    DEFLIST(132,@02),DEFLIST(@02)                       1313
*           DEFVDACT=ON;            /*                       @G24LB23*/
         OI    DEFVDACT(@02),B'00000001'                           1314
*           DEFVOLD=BASSERNO;       /*                       @G24LB23*/
         MVC   DEFVOLD(6,@02),BASSERNO(BASEVPTR)                   1315
*           CALL IDCSASS0(GDTTBL,DEFINE,DEFVPTR,REASON,ECBCODE,ECBMSPTR
*               );                  /*                       @G24LB23*/
         L     @02,@PC00001                                        1316
         ST    @02,@AL00001                                        1316
         LA    @15,DEFINE                                          1316
         ST    @15,@AL00001+4                                      1316
         LA    @15,DEFVPTR                                         1316
         ST    @15,@AL00001+8                                      1316
         LA    @15,REASON                                          1316
         ST    @15,@AL00001+12                                     1316
         LA    @15,ECBCODE                                         1316
         ST    @15,@AL00001+16                                     1316
         LA    @15,ECBMSPTR                                        1316
         ST    @15,@AL00001+20                                     1316
         MVI   @AL00001+20,X'80'                                   1316
         L     @15,GDTSSC(,@02)                                    1316
         LA    @01,@AL00001                                        1316
         BALR  @14,@15                                             1316
*           RESPECIFY                                              1317
*             RTNREG RSTD;                                         1317
*           TESTRC=RTNREG;                                         1318
         LR    TESTRC,RTNREG                                       1318
*           RESPECIFY                                              1319
*             RTNREG UNRSTD;        /*                       @G24LB23*/
*                                                                  1319
*           /*********************************************************/
*           /*                                                       */
*           /* PRINT MESSAGE IDC3114I                        @G24LB23*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1320
*           PRINTTBL=''B;           /*                       @G24LB23*/
         XC    PRINTTBL(28),PRINTTBL                               1320
*           DARGSMOD=COMMSGS;       /*                       @G24LB23*/
         L     @02,DDSTRU                                          1321
         MVC   DARGSMOD(3,@02),@CC01697                            1321
*           DARGSENT=MSG3114I;      /*                       @G24LB23*/
         MVI   DARGSENT(@02),X'46'                                 1322
*           DARGDBP=ADDR(BASSERNO); /*                       @G24LB23*/
         LA    @15,BASSERNO(,BASEVPTR)                             1323
         ST    @15,DARGDBP(,@02)                                   1323
*           DARGILP=LENGTH(BASSERNO);/*                      @G24LB23*/
         MVC   DARGILP(2,@02),@CH00159                             1324
*           CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*          @G24LB23*/
*                                                                  1325
         L     @02,@PC00001                                        1325
         ST    @02,@AL00001                                        1325
         LA    @15,@CF00117                                        1325
         ST    @15,@AL00001+4                                      1325
         LA    @15,DDSTRU                                          1325
         ST    @15,@AL00001+8                                      1325
         MVI   @AL00001+8,X'80'                                    1325
         L     @15,GDTPRT(,@02)                                    1325
         LA    @01,@AL00001                                        1325
         BALR  @14,@15                                             1325
*           /*********************************************************/
*           /*                                                       */
*           /* IF DEACTIVATE FAILED, SET CONDITION CODE TO   @G24LB23*/
*           /* 8 AND PRINT MESSAGE IDC0722I. ELSE PRINT MESSAGE      */
*           /* IDC2075I AND SET CONDITION CODE TO 12         @G24LB23*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1326
*           IF TESTRC^=0&TESTRC^=12 THEN                           1326
         LTR   TESTRC,TESTRC                                       1326
         BZ    @RF01326                                            1326
         C     TESTRC,@CF00606                                     1326
         BE    @RF01326                                            1326
*             DO;                   /*                       @G24LB23*/
*               DLSRC=LASTCC08;     /*                       @G24LB23*/
         LA    DLSRC,8                                             1328
*               DARGSMOD=ADDVMSGS;  /*                       @G24LB23*/
         L     @04,DDSTRU                                          1329
         MVC   DARGSMOD(3,@04),@CC01687                            1329
*               DARGSENT=MSG0722I;  /*                       @G24LB23*/
         MVI   DARGSENT(@04),X'03'                                 1330
*               CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*      @G24LB23*/
         L     @04,@PC00001                                        1331
         ST    @04,@AL00001                                        1331
         LA    @15,@CF00117                                        1331
         ST    @15,@AL00001+4                                      1331
         LA    @15,DDSTRU                                          1331
         ST    @15,@AL00001+8                                      1331
         MVI   @AL00001+8,X'80'                                    1331
         L     @15,GDTPRT(,@04)                                    1331
         LA    @01,@AL00001                                        1331
         BALR  @14,@15                                             1331
*             END;                  /*                       @G24LB23*/
*           ELSE                                                   1333
*             DO;                   /*                       @G24LB23*/
         B     @RC01326                                            1333
@RF01326 DS    0H                                                  1334
*               DLSRC=LASTCC12;     /*                       @G24LB23*/
         LA    DLSRC,12                                            1334
*               DARGSENT=MSG2075I;  /*                       @G24LB23*/
         L     @04,DDSTRU                                          1335
         MVI   DARGSENT(@04),X'1F'                                 1335
*               CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*      @G24LB23*/
         L     @04,@PC00001                                        1336
         ST    @04,@AL00001                                        1336
         LA    @15,@CF00117                                        1336
         ST    @15,@AL00001+4                                      1336
         LA    @15,DDSTRU                                          1336
         ST    @15,@AL00001+8                                      1336
         MVI   @AL00001+8,X'80'                                    1336
         L     @15,GDTPRT(,@04)                                    1336
         LA    @01,@AL00001                                        1336
         BALR  @14,@15                                             1336
*             END;                  /*                       @G24LB23*/
*         END;                      /*                       @G24LB23*/
*       ELSE                                                       1339
*         DO;                       /*                       @G24LB23*/
*                                                                  1339
         B     @RC01311                                            1339
@RF01311 DS    0H                                                  1340
*           /*********************************************************/
*           /*                                                       */
*           /* DEMOUNT THE VOLUME                            @G24LB23*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1340
*           MDWAIT=ON;              /*                       @G24LB23*/
         LA    @04,AVMDAGL                                         1340
         OI    MDWAIT(@04),B'00010000'                             1340
*           AMDTYPE=DEMOUNT;        /*                       @G24LB23*/
         MVC   AMDTYPE(8),DEMOUNT                                  1341
*           CALL IDCSA060(GDTTBL,AMDTYPE,MDAGL);/*           @G24LB23*/
         L     @15,@PC00001                                        1342
         ST    @15,@AL00001                                        1342
         LA    @14,AMDTYPE                                         1342
         ST    @14,@AL00001+4                                      1342
         ST    @04,@AL00001+8                                      1342
         MVI   @AL00001+8,X'80'                                    1342
         L     @15,GDTUNT(,@15)                                    1342
         LA    @01,@AL00001                                        1342
         BALR  @14,@15                                             1342
*         END;                      /*                       @G24LB23*/
*     END;                          /*                       @G24LB23*/
*                                                                  1344
@RC01311 DS    0H                                                  1345
*   /*****************************************************************/
*   /*                                                               */
*   /* RESTORE THE RETURN ADDRESS                            @G24LB23*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1345
*   RESPECIFY                                                      1345
*     REG14 RSTD;                   /*                       @G24LB23*/
@RF01291 DS    0H                                                  1346
*   REG14=DLSRET;                   /*                       @G24LB23*/
         L     REG14,DLSRET                                        1346
*   RESPECIFY                                                      1347
*     REG14 UNRSTD;                 /*                       @G24LB23*/
*   RETURN CODE(DLSRC);             /*                       @G24LB23*/
         LR    @15,DLSRC                                           1348
@EL00011 DS    0H                                                  1348
@EF00011 DS    0H                                                  1348
@ER00011 BR    @14                                                 1348
*   END DLSPRTN;                    /*                       @G24LB23*/
*                                                                  1350
*/********************************************************** #Y30LB31*/
*/*                                                          #Y30LB31*/
*/* PROCEDURE NAME - ACTVRTN                                 #Y30LB31*/
*/*                                                          #Y30LB31*/
*/* FUNCTION - MAKES THE INACTIVE VOLUME ACTIVE AND THUS     #Y30LB31*/
*/*            AVAILABLE FOR MOUNTING.  BUILDS THE MSSC      #Y30LB31*/
*/*            DEFINE PARM LIST FOR THE ACTIVATE REQUEST.    #Y30LB31*/
*/*            CALLS SSCMSG TO PRINT A MESSAGE CONTAINING    #Y30LB31*/
*/*            THE MSS  REASON CODE IF THE MSC DEFINE ORDER  #Y30LB31*/
*/*            FAILED.  MSG IDC2075I IS ISSUED IF ACTIVATE   #Y30LB31*/
*/*            FAILED.                                       #Y30LB31*/
*/*                                                          #Y30LB31*/
*/* INPUT -  ADDVTBL, BCDV, DARGLIST FOR MESSAGES.           #Y30LB31*/
*/*                                                          #Y30LB31*/
*/* OUTPUT - RETURN CODE OF 0 INDICATES ACTIVATE SUCCESSFUL  #Y30LB31*/
*/*          AND CC04FLG MAY BE SET IF MSVC ENCOUNTERED AN   #Y30LB31*/
*/*          I/O ERROR.                                      #Y30LB31*/
*/*          RETURN CODE OF 4 INDICATES ACTIVATE FAILED.     #Y30LB31*/
*/*                                                          #Y30LB31*/
*/********************************************************** #Y30LB31*/
*                                                                  1350
*ACTVRTN:                                                          1350
*   PROCEDURE OPTIONS(NOSAVEAREA,NOSAVE);/*                  #Y30LB31*/
*                                                                  1350
ACTVRTN  DS    0H                                                  1351
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL CONDITION CODE.                                 #Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1351
*   DCL                                                            1351
*     ACTVRC FIXED(15);             /*                       #Y30LB31*/
*                                                                  1351
*   /*****************************************************************/
*   /*                                                               */
*   /* SAVE THE RETURN ADDRESS OF CALLER SINCE THERE IS NO   #Y30LB31*/
*   /* SAVEAREA. REG14 WILL BE RESTORED UPON EXIT.           #Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1352
*   RESPECIFY                                                      1352
*     REG14 RSTD;                   /*                       @ZDR2054*/
*   RETADDR3=REG14;                 /*                       #Y30LB31*/
         ST    REG14,RETADDR3                                      1353
*   RESPECIFY                                                      1354
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   OLDERID2=NEWERID2;                                             1355
         L     @15,@PC00001                                        1355
         L     @14,GDTTR2(,@15)                                    1355
         MVC   @TS00001(95),NEWERID2(@14)                          1355
         MVC   OLDERID2(95,@14),@TS00001                           1355
*   NEWID2='AVAC';                  /*                       @Y30LB31*/
*                                                                  1356
         MVC   NEWID2(4,@14),@CC01877                              1356
*   /*****************************************************************/
*   /*                                                               */
*   /* ZERO OUT THE CONDITION CODE USED WITHIN THIS PROC.    @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1357
*   ACTVRC=LASTCC00;                /*                       @Y30LB31*/
*                                                                  1357
         SLR   @14,@14                                             1357
         LR    ACTVRC,@14                                          1357
*   /*****************************************************************/
*   /*                                                               */
*   /* INITIALIZE THE DEFINE PARM LIST AND ACTIVATE THE VOL  @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1358
*   DEFLIST=''B;                    /*                       @Y30LB31*/
         L     @03,DEFVPTR                                         1358
         XC    DEFLIST(132,@03),DEFLIST(@03)                       1358
*   DEFVE=''B;                      /*                       @Y30LB31*/
         L     @01,DEFVEPTR                                        1359
         XC    DEFVE(64,@01),DEFVE(@01)                            1359
*   DEFVACT=ON;                     /*                       @Y30LB31*/
         OI    DEFVACT(@03),B'00000010'                            1360
*   DEFVCSN1=BCDCSN1;               /*                       @Y30LB31*/
*                                                                  1361
         MVC   DEFVCSN1(12,@03),BCDCSN1(BCDVPTR)                   1361
*   /*****************************************************************/
*   /*                                                               */
*   /* TAKE A SYMBOLIC DUMP OF THE DEFINE PARM LIST BEFORE   @Y30LB31*/
*   /* THE ACTIVATE IS REQUESTED.                            @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1362
*   IF GDTDBG=NULLPTR THEN                                         1362
         C     @14,GDTDBG(,@15)                                    1362
         BE    @RT01362                                            1362
*     ;                                                            1363
*   ELSE                                                           1364
*     DO;                                                          1364
*       DMPINDEX=ADDR(AVDMPLST);    /*                       @Y30LB31*/
         LA    DMPINDEX,AVDMPLST                                   1365
*       DMPITMNM='AV01DEFV';                                       1366
         MVC   DMPITMNM(8,DMPINDEX),@CC01826                       1366
*       DMPITMPT=ADDR(AV01DEFV);                                   1367
         LA    @03,AV01DEFV                                        1367
         ST    @03,DMPITMPT(,DMPINDEX)                             1367
*       DMPITMLN=LENGTH(AV01DEFV);                                 1368
         MVC   DMPITMLN(2,DMPINDEX),@CH02000                       1368
*       DMPITMTP='H';                                              1369
         MVI   DMPITMTP(DMPINDEX),C'H'                             1369
*       DMPINDEX=DMPINDEX+DMPELEMT;                                1370
*                                                                  1370
         LA    @03,16                                              1370
         ALR   DMPINDEX,@03                                        1370
*       /*************************************************************/
*       /*                                                           */
*       /*                                                   @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1371
*       DMPITMNM='ADDVTBL';                                        1371
         MVI   DMPITMNM+7(DMPINDEX),C' '                           1371
         MVC   DMPITMNM(7,DMPINDEX),@CC01766                       1371
*       DMPITMPT=ADDR(ADDVTBL);                                    1372
         LA    @15,ADDVTBL                                         1372
         ST    @15,DMPITMPT(,DMPINDEX)                             1372
*       DMPITMLN=LENGTH(ADDVTBL);                                  1373
         MVC   DMPITMLN(2,DMPINDEX),@CH01999                       1373
*       DMPITMTP='H';                                              1374
         MVI   DMPITMTP(DMPINDEX),C'H'                             1374
*       DMPINDEX=DMPINDEX+DMPELEMT; /*                       @Y30LB31*/
         ALR   DMPINDEX,@03                                        1375
*       DMPTRM=DMPTRMVL;                                           1376
         MVI   DMPTRM(DMPINDEX),X'FF'                              1376
*     END;                          /*                       @Y30LB31*/
*   IF GDTDBG=NULLPTR THEN                                         1378
@RT01362 L     @15,@PC00001                                        1378
         L     @15,GDTDBG(,@15)                                    1378
         LTR   @15,@15                                             1378
         BZ    @RT01378                                            1378
*     ;                                                            1379
*   ELSE                                                           1380
*     CALL IDCDB010(GDTTBL,'AVDF',ADDR(AVDMPLST));/*         @Y30LB31*/
*                                                                  1380
         L     @15,@PC00001                                        1380
         ST    @15,@AL00001                                        1380
         LA    @14,@CC01878                                        1380
         ST    @14,@AL00001+4                                      1380
         LA    @14,AVDMPLST                                        1380
         ST    @14,@AFTEMPS+16                                     1380
         LA    @14,@AFTEMPS+16                                     1380
         ST    @14,@AL00001+8                                      1380
         MVI   @AL00001+8,X'80'                                    1380
         L     @15,GDTDBG(,@15)                                    1380
         LA    @01,@AL00001                                        1380
         BALR  @14,@15                                             1380
*   /*****************************************************************/
*   /*                                                               */
*   /* ACTIVATE THE VOLUME SPECIFIED IN THE DEFINE PARM LIST @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1381
*   CALL IDCSASS0(GDTTBL,DEFINE,DEFVPTR,REASON,ECBCODE,ECBMSPTR);/*
*                                                            @Y30LB31*/
@RT01378 L     @02,@PC00001                                        1381
         ST    @02,@AL00001                                        1381
         LA    @15,DEFINE                                          1381
         ST    @15,@AL00001+4                                      1381
         LA    @15,DEFVPTR                                         1381
         ST    @15,@AL00001+8                                      1381
         LA    @15,REASON                                          1381
         ST    @15,@AL00001+12                                     1381
         LA    @15,ECBCODE                                         1381
         ST    @15,@AL00001+16                                     1381
         LA    @15,ECBMSPTR                                        1381
         ST    @15,@AL00001+20                                     1381
         MVI   @AL00001+20,X'80'                                   1381
         L     @15,GDTSSC(,@02)                                    1381
         LA    @01,@AL00001                                        1381
         BALR  @14,@15                                             1381
*   RESPECIFY                                                      1382
*     RTNREG RSTD;                                                 1382
*   TESTRC=RTNREG;                                                 1383
         LR    TESTRC,RTNREG                                       1383
*   RESPECIFY                                                      1384
*     RTNREG UNRSTD;                /*                       @Y30LB31*/
*                                                                  1384
*   /*****************************************************************/
*   /*                                                               */
*   /* TEST RETURN CODE FROM MSC DEFINE ORDER. IF THE VOL    @Y30LB31*/
*   /* WAS ACTIVATED BUT MSVC ENCOUNTERED AN I/O ERROR, TREAT THIS AS*/
*   /* A MINOR ERROR REQUIRING AN EOJ CONDITION CODE OF AT LEAST 4.  */
*   /*                                                       @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1385
*   IF TESTRC=12 THEN               /*                       @Y30LB31*/
         C     TESTRC,@CF00606                                     1385
         BNE   @RF01385                                            1385
*     DO;                           /*                       @Y30LB31*/
*       TESTRC=0;                   /*                       @Y30LB31*/
         SLR   TESTRC,TESTRC                                       1387
*       CC04FLG=ON;                 /*                       @Y30LB31*/
         OI    CC04FLG,B'10000000'                                 1388
*     END;                          /*                       @Y30LB31*/
*                                                                  1390
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THE ACTIVATE FAILED, PRINT A MESSAGE WITH THE MSSC @Y30LB31*/
*   /* REASON CODE AND SECONDARY MSG IDC2075I. EXIT FROM PROC.       */
*   /*                                                       @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1390
*   IF TESTRC^=0 THEN               /*                       @Y30LB31*/
@RF01385 LTR   TESTRC,TESTRC                                       1390
         BZ    @RF01390                                            1390
*     DO;                           /*                       @Y30LB31*/
*       ACTVRC=4;                   /*                       @Y30LB31*/
         LA    @02,4                                               1392
         LR    ACTVRC,@02                                          1392
*       IF TESTRC=4 THEN            /*                       @Y30LB31*/
         CR    TESTRC,@02                                          1393
         BNE   @RF01393                                            1393
*         CALL SSCMSG(REASON,ECBCODE);/*                     @Y30LB31*/
         LA    @15,REASON                                          1394
         ST    @15,@AL00001                                        1394
         LA    @15,ECBCODE                                         1394
         ST    @15,@AL00001+4                                      1394
         LA    @01,@AL00001                                        1394
         BAL   @14,SSCMSG                                          1394
*       PRINTTBL=''B;               /*                       @Y30LB31*/
@RF01393 XC    PRINTTBL(28),PRINTTBL                               1395
*       DARGSMOD=COMMSGS;           /*                       @Y30LB31*/
         L     @15,DDSTRU                                          1396
         MVC   DARGSMOD(3,@15),@CC01697                            1396
*       DARGSENT=MSG2075I;          /* STID=CM031            @Y30LB31*/
         MVI   DARGSENT(@15),X'1F'                                 1397
*       DARGDBP=ADDR(MSVIVOL#);     /*                       @Y30LB31*/
         LA    @14,MSVIVOL#                                        1398
         ST    @14,DARGDBP(,@15)                                   1398
*       DARGILP=LENGTH(MSVIVOL#);   /*                       @Y30LB31*/
         MVC   DARGILP(2,@15),@CH00159                             1399
*       CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*              @Y30LB31*/
         L     @15,@PC00001                                        1400
         ST    @15,@AL00001                                        1400
         LA    @14,@CF00117                                        1400
         ST    @14,@AL00001+4                                      1400
         LA    @14,DDSTRU                                          1400
         ST    @14,@AL00001+8                                      1400
         MVI   @AL00001+8,X'80'                                    1400
         L     @15,GDTPRT(,@15)                                    1400
         LA    @01,@AL00001                                        1400
         BALR  @14,@15                                             1400
*     END;                          /*                       @Y30LB31*/
*                                                                  1401
*   /*****************************************************************/
*   /*                                                               */
*   /* FREE THE MESSAGE STORAGE AREA IF THE CALLER OF THIS   @Y30LB31*/
*   /* PROCEDURE DOES NOT REQUIRE THE MESSAGE TO BE SAVED.   @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1402
*   ELSE                            /*                       @Y30LB31*/
*     IF MSGFLG=OFF THEN            /*                       @Y30LB31*/
         B     @RC01390                                            1402
@RF01390 TM    MSGFLG,B'00010000'                                  1402
         BNZ   @RF01402                                            1402
*       CALL IDCSAFS0(GDTTBL,ECBMSPTR);/*                    @Y30LB31*/
*                                                                  1403
         L     @15,@PC00001                                        1403
         ST    @15,@AL00001                                        1403
         LA    @14,ECBMSPTR                                        1403
         ST    @14,@AL00001+4                                      1403
         L     @15,GDTFSP(,@15)                                    1403
         LA    @01,@AL00001                                        1403
         BALR  @14,@15                                             1403
*   /*****************************************************************/
*   /*                                                               */
*   /* RESTORE THE RETURN ADDRESS OF THE CALLER TO REG 14 AND        */
*   /*                                                       @Y30LB31*/
*   /* RETURN TO CALLER, PASSING THE CONDITON CODE IN REG 15.        */
*   /*                                                       @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1404
*   RESPECIFY                                                      1404
*     REG14 RSTD;                   /*                       @ZDR2054*/
@RF01402 DS    0H                                                  1404
@RC01390 DS    0H                                                  1405
*   REG14=RETADDR3;                 /*                       @Y30LB31*/
         L     REG14,RETADDR3                                      1405
*   RESPECIFY                                                      1406
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   RETURN CODE(ACTVRC);            /*                       @Y30LB31*/
         LR    @15,ACTVRC                                          1407
@EL00012 DS    0H                                                  1407
@EF00012 DS    0H                                                  1407
@ER00012 BR    @14                                                 1407
*   END ACTVRTN;                    /*                       @Y30LB31*/
*                                                                  1409
*/********************************************************** @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* PROCEDURE NAME - NEWVFRTN                                @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* FUNCTION - UPDATE THE VOLUME MOUNTING ATTRIBUTES (BIND/  @Y30LB31*/
*/*            NOBIND, EXCLUSIVE/SHARED, DASDERASE/NDERAS,   @Y30LB31*/
*/*            READONLY/READWRITE).  BUILDS THE DEFINE PARM  @Y30LB31*/
*/*            LIST FOR THE CHANGE-VOLUME-FLAGS REQUEST.     @Y30LB31*/
*/*            CALLS SSCMSG TO PRINT A MSG CONTAINING THE    @Y30LB31*/
*/*            MSSC REASON CODE IF THE REQUEST FAILED. MSGS  @Y30LB31*/
*/*            IDC2093I, IDC0073I, IDC0725I, AND BOTH        @Y30LB31*/
*/*            VERSIONS OF IDC2091I ARE ISSUED BY THIS PROC. @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* INPUT - FDTTBL, ADDVTBL, PRINTTBL FOR MESSAGES,          @Y30LB31*/
*/*         DEFLIST AND DEFVE.                               @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* OUTPUT - RETURN CODE OF 0 INDICATES ATTRIBUTES UPDATED   @Y30LB31*/
*/*          AND CC04FLG MAY BE SET IN ADDVTBL IF MSVC HAD   @Y30LB31*/
*/*          AN I/O ERROR.                                   @Y30LB31*/
*/*          RETURN CODE OF 4 INDICATES ATTRIBUTES NOT       @Y30LB31*/
*/*          UPDATED AND APPROPRIATE MESSAGES WERE PRINTED.  @Y30LB31*/
*/*                                                          @Y30LB31*/
*/********************************************************** @Y30LB31*/
*                                                                  1409
*NEWVFRTN:                                                         1409
*   PROCEDURE OPTIONS(NOSAVEAREA,NOSAVE);/*                  @Y30LB31*/
*                                                                  1409
NEWVFRTN DS    0H                                                  1410
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL CONDITION CODE.                                 @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1410
*   DCL                                                            1410
*     NEWVFRC FIXED(15);            /*                       @Y30LB31*/
*                                                                  1410
*   /*****************************************************************/
*   /*                                                               */
*   /* SAVE THE RETURN ADDRESS OF CALLER SINCE THERE IS NO   @Y30LB31*/
*   /* SAVEAREA. REG 14 WILL BE RESTORED UPON EXIT.          @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1411
*   RESPECIFY                                                      1411
*     REG14 RSTD;                   /*                       @ZDR2054*/
*   RETADDR3=REG14;                 /*                       @Y30LB31*/
         ST    REG14,RETADDR3                                      1412
*   RESPECIFY                                                      1413
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   OLDERID2=NEWERID2;                                             1414
         L     @15,@PC00001                                        1414
         L     @15,GDTTR2(,@15)                                    1414
         MVC   @TS00001(95),NEWERID2(@15)                          1414
         MVC   OLDERID2(95,@15),@TS00001                           1414
*   NEWID2='AVVF';                  /*                       @Y30LB31*/
*                                                                  1415
         MVC   NEWID2(4,@15),@CC01883                              1415
*   /*****************************************************************/
*   /*                                                               */
*   /* ZERO THE CONDITION CODE USED WITHIN THIS PROCEDURE.   @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1416
*   NEWVFRC=LASTCC00;               /*                       @Y30LB31*/
*                                                                  1416
         SLR   @15,@15                                             1416
         STH   @15,NEWVFRC                                         1416
*   /*****************************************************************/
*   /*                                                               */
*   /* INITIALIZE THE DEFLIST FOR THE UPDATE VOLUME ATTRI    @Y30LB31*/
*   /* REQUEST.                                              @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1417
*   DEFLIST=''B;                    /*                       @Y30LB31*/
         L     @15,DEFVPTR                                         1417
         XC    DEFLIST(132,@15),DEFLIST(@15)                       1417
*   DEFVE=''B;                      /*                       @Y30LB31*/
         L     @01,DEFVEPTR                                        1418
         XC    DEFVE(64,@01),DEFVE(@01)                            1418
*   DEFVOLD=MSVIVOL#;               /*                       @Y30LB31*/
         MVC   DEFVOLD(6,@15),MSVIVOL#                             1419
*   IF NEWDEFLG=ON THEN             /*                       @Y30LB31*/
         TM    NEWDEFLG,B'00000100'                                1420
         BNO   @RF01420                                            1420
*     DEFVSEC=ON;                   /*                       @Y30LB31*/
         OI    DEFVSEC(@15),B'00100000'                            1421
*   IF NEWEXFLG=ON THEN             /*                       @Y30LB31*/
@RF01420 TM    NEWEXFLG,B'00000010'                                1422
         BNO   @RF01422                                            1422
*     DEFVEXCL=ON;                  /*                       @Y30LB31*/
         L     @01,DEFVPTR                                         1423
         OI    DEFVEXCL(@01),B'00010000'                           1423
*   IF NEWBIFLG=ON THEN             /*                       @Y30LB31*/
@RF01422 TM    NEWBIFLG,B'00001000'                                1424
         BNO   @RF01424                                            1424
*     DEFVBIND=ON;                  /*                       @Y30LB31*/
         L     @01,DEFVPTR                                         1425
         OI    DEFVBIND(@01),B'00000100'                           1425
*   IF NEWROFLG=ON THEN             /*                       @Y30LB31*/
@RF01424 TM    NEWROFLG,B'00000001'                                1426
         BNO   @RF01426                                            1426
*     DEFVWINH=ON;                  /*                       @Y30LB31*/
*                                                                  1427
         L     @01,DEFVPTR                                         1427
         OI    DEFVWINH(@01),B'00000010'                           1427
*   /*****************************************************************/
*   /*                                                               */
*   /* SETUP THE MSVC DEFINE EXTENSION LIST IF THE SERIAL    @Y30LB31*/
*   /* MISMATCH AND RECOVERY DATA MUST BE CLEARED FROM THE MSVI      */
*   /* BECAUSE THE VOLUME HAS BEEN RELABELED DURING THIS ADDV        */
*   /* REQUEST. OTHERWISE, THERE ARE NO MSVC EXTENSIONS.     @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1428
*   IF ADDR(NSER)^=NULLPTR THEN     /*                       @Y30LB31*/
@RF01426 L     @15,@PC00001+4                                      1428
         L     @15,FDTPTR+20(,@15)                                 1428
         LTR   @15,@15                                             1428
         BZ    @RF01428                                            1428
*     DO;                           /*                       @Y30LB31*/
*       DEFVVEXT=DEFVEPTR;          /*                       @Y30LB31*/
         L     @15,DEFVEPTR                                        1430
         L     @14,DEFVPTR                                         1430
         ST    @15,DEFVVEXT(,@14)                                  1430
*       DEFLNGTH=DEFLEN;            /*                       @Y30LB31*/
         LH    @14,DEFLEN                                          1431
         ST    @14,DEFLNGTH(,@15)                                  1431
*       DEFCRCVY=ON;                /*                       @Y30LB31*/
         OI    DEFCRCVY(@15),B'01000000'                           1432
*       DEFLAMIS=ON;                /*                       @Y30LB31*/
         OI    DEFLAMIS(@15),B'00100000'                           1433
*       DEFLABEL=BLANKIT;           /*                       @Y30LB31*/
         MVI   DEFLABEL+1(@15),C' '                                1434
         MVC   DEFLABEL+2(4,@15),DEFLABEL+1(@15)                   1434
         MVI   DEFLABEL(@15),C' '                                  1434
*       DEFPVLAB=ON;                /*                       @Y30LB31*/
         OI    DEFPVLAB(@15),B'01000000'                           1435
*     END;                          /*                       @Y30LB31*/
*                                                                  1436
*   /*****************************************************************/
*   /*                                                               */
*   /* TAKE A SYMBOLIC DUMP OF DEFLIST BEFORE UPDATING THE   @Y30LB31*/
*   /* ATTRIBUTES.                                           @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1437
*   IF GDTDBG=NULLPTR THEN                                         1437
@RF01428 L     @15,@PC00001                                        1437
         L     @15,GDTDBG(,@15)                                    1437
         LTR   @15,@15                                             1437
         BZ    @RT01437                                            1437
*     ;                                                            1438
*   ELSE                                                           1439
*     DO;                                                          1439
*       DMPINDEX=ADDR(AVDMPLST);    /*                       @Y30LB31*/
         LA    DMPINDEX,AVDMPLST                                   1440
*       DMPITMNM='AV01DEFV';                                       1441
         MVC   DMPITMNM(8,DMPINDEX),@CC01826                       1441
*       DMPITMPT=ADDR(AV01DEFV);                                   1442
         LA    @03,AV01DEFV                                        1442
         ST    @03,DMPITMPT(,DMPINDEX)                             1442
*       DMPITMLN=LENGTH(AV01DEFV);                                 1443
         MVC   DMPITMLN(2,DMPINDEX),@CH02000                       1443
*       DMPITMTP='H';                                              1444
         MVI   DMPITMTP(DMPINDEX),C'H'                             1444
*       DMPINDEX=DMPINDEX+DMPELEMT; /*                       @Y30LB31*/
         LA    @03,16                                              1445
         ALR   DMPINDEX,@03                                        1445
*       DMPITMNM='ADDVTBL';                                        1446
         MVI   DMPITMNM+7(DMPINDEX),C' '                           1446
         MVC   DMPITMNM(7,DMPINDEX),@CC01766                       1446
*       DMPITMPT=ADDR(ADDVTBL);                                    1447
         LA    @15,ADDVTBL                                         1447
         ST    @15,DMPITMPT(,DMPINDEX)                             1447
*       DMPITMLN=LENGTH(ADDVTBL);                                  1448
         MVC   DMPITMLN(2,DMPINDEX),@CH01999                       1448
*       DMPITMTP='H';                                              1449
         MVI   DMPITMTP(DMPINDEX),C'H'                             1449
*       DMPINDEX=DMPINDEX+DMPELEMT; /*                       @Y30LB31*/
         ALR   DMPINDEX,@03                                        1450
*       DMPTRM=DMPTRMVL;                                           1451
         MVI   DMPTRM(DMPINDEX),X'FF'                              1451
*     END;                          /*                       @Y30LB31*/
*   IF GDTDBG=NULLPTR THEN                                         1453
@RT01437 L     @15,@PC00001                                        1453
         L     @15,GDTDBG(,@15)                                    1453
         LTR   @15,@15                                             1453
         BZ    @RT01453                                            1453
*     ;                                                            1454
*   ELSE                                                           1455
*     CALL IDCDB010(GDTTBL,'AVAT',ADDR(AVDMPLST));/*         @Y30LB31*/
*                                                                  1455
         L     @15,@PC00001                                        1455
         ST    @15,@AL00001                                        1455
         LA    @14,@CC01884                                        1455
         ST    @14,@AL00001+4                                      1455
         LA    @14,AVDMPLST                                        1455
         ST    @14,@AFTEMPS+20                                     1455
         LA    @14,@AFTEMPS+20                                     1455
         ST    @14,@AL00001+8                                      1455
         MVI   @AL00001+8,X'80'                                    1455
         L     @15,GDTDBG(,@15)                                    1455
         LA    @01,@AL00001                                        1455
         BALR  @14,@15                                             1455
*   /*****************************************************************/
*   /*                                                               */
*   /* REQUEST THE VOLUME ATTRIBUTE CHANGE VIA THE MSC       @Y30LB31*/
*   /* DEFINE ORDER.                                         @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1456
*   CALL IDCSASS0(GDTTBL,DEFINE,DEFVPTR,REASON,ECBCODE,ECBMSPTR);/*
*                                                            @Y30LB31*/
@RT01453 L     @02,@PC00001                                        1456
         ST    @02,@AL00001                                        1456
         LA    @15,DEFINE                                          1456
         ST    @15,@AL00001+4                                      1456
         LA    @15,DEFVPTR                                         1456
         ST    @15,@AL00001+8                                      1456
         LA    @15,REASON                                          1456
         ST    @15,@AL00001+12                                     1456
         LA    @15,ECBCODE                                         1456
         ST    @15,@AL00001+16                                     1456
         LA    @15,ECBMSPTR                                        1456
         ST    @15,@AL00001+20                                     1456
         MVI   @AL00001+20,X'80'                                   1456
         L     @15,GDTSSC(,@02)                                    1456
         LA    @01,@AL00001                                        1456
         BALR  @14,@15                                             1456
*   RESPECIFY                                                      1457
*     RTNREG RSTD;                                                 1457
*   TESTRC=RTNREG;                                                 1458
         LR    TESTRC,RTNREG                                       1458
*   RESPECIFY                                                      1459
*     RTNREG UNRSTD;                /*                       @Y30LB31*/
*                                                                  1459
*   /*****************************************************************/
*   /*                                                               */
*   /* TEST RETURN CODE FROM THE MSC DEFINE ORDER. IF THE    @Y30LB31*/
*   /* ATTRIBUTES WERE UPDATED BUT MSVC ENCOUNTERED AN I/O ERROR,    */
*   /* TREAT THIS AS A MINOR ERROR REQUIRING AN EOJ CONDITION CODE OF*/
*   /* AT LEAST 4.                                           @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1460
*   IF TESTRC=12 THEN               /*                       @Y30LB31*/
         C     TESTRC,@CF00606                                     1460
         BNE   @RF01460                                            1460
*     DO;                           /*                       @Y30LB31*/
*       TESTRC=0;                   /*                       @Y30LB31*/
         SLR   TESTRC,TESTRC                                       1462
*       CC04FLG=ON;                 /*                       @Y30LB31*/
         OI    CC04FLG,B'10000000'                                 1463
*     END;                          /*                       @Y30LB31*/
*                                                                  1465
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THE REPLACE VOLUME ATTRIBUTE REQUEST FAILED, PRINT @Y30LB31*/
*   /* SECONDARY MESSAGE.                                    @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1465
*   IF TESTRC^=0 THEN               /*                       @Y30LB31*/
@RF01460 LTR   TESTRC,TESTRC                                       1465
         BZ    @RF01465                                            1465
*     DO;                           /*                       @Y30LB31*/
*       NEWVFRC=4;                  /*                       @Y30LB31*/
         LA    @02,4                                               1467
         STH   @02,NEWVFRC                                         1467
*       IF TESTRC=4 THEN            /*                       @Y30LB31*/
         CR    TESTRC,@02                                          1468
         BNE   @RF01468                                            1468
*         CALL SSCMSG(REASON,ECBCODE);/*                     @Y30LB31*/
         LA    @15,REASON                                          1469
         ST    @15,@AL00001                                        1469
         LA    @15,ECBCODE                                         1469
         ST    @15,@AL00001+4                                      1469
         LA    @01,@AL00001                                        1469
         BAL   @14,SSCMSG                                          1469
*       PRINTTBL=''B;               /*                       @Y30LB31*/
*                                                                  1470
@RF01468 XC    PRINTTBL(28),PRINTTBL                               1470
*       /*************************************************************/
*       /*                                                           */
*       /* IF THE VOLUME SERIAL NO. WAS CHANGED DURING THIS  @Y30LB31*/
*       /* ADDV REQUEST, THE ONLY ATTRIBUTE SET AT THIS TIME         */
*       /* FOLLOWING THE VOL RELABELING IS THE READONLY ATTRI. PRINT */
*       /* MESSAGE IDC2091I SINCE READONLY WAS NOT SET.      @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1471
*       IF ADDR(NSER)^=NULLPTR THEN /*                       @Y30LB31*/
         L     @15,@PC00001+4                                      1471
         L     @15,FDTPTR+20(,@15)                                 1471
         LTR   @15,@15                                             1471
         BZ    @RF01471                                            1471
*         DO;                       /*                       @Y30LB31*/
*           DARGSMOD=COMMSGS;       /*                       @Y30LB31*/
         L     @15,DDSTRU                                          1473
         MVC   DARGSMOD(3,@15),@CC01697                            1473
*           DARGSENT=MSG2091A;      /* STID=CM015            @Y30LB31*/
         MVI   DARGSENT(@15),X'0F'                                 1474
*           DARGDBP=ADDR(MSVIVOL#); /*                       @Y30LB31*/
         LA    @14,MSVIVOL#                                        1475
         ST    @14,DARGDBP(,@15)                                   1475
*           DARGILP=LENGTH(MSVIVOL#);/*                      @Y30LB31*/
         MVC   DARGILP(2,@15),@CH00159                             1476
*         END;                      /*                       @Y30LB31*/
*                                                                  1477
*       /*************************************************************/
*       /*                                                           */
*       /* IF THE VOLUME SERIAL NO. WAS NOT CHANGED BUT THE  @Y30LB31*/
*       /* VOLUME IS A GENERAL-USE BASE VOLUME, THE ATTRIBUTES WERE  */
*       /* BEING CHANGED TO AGREE WITH THE GROUP. PRINT MESSAGE      */
*       /* IDC2093I SINCE THE VOLUME ATTRIBUTES DO NOT AGREE WITH THE*/
*       /* GROUP.                                            @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1478
*       ELSE                        /*                       @Y30LB31*/
*         IF GRPMSFLG=ON THEN       /*                       @Y30LB31*/
         B     @RC01471                                            1478
@RF01471 TM    GRPMSFLG,B'00000010'                                1478
         BNO   @RF01478                                            1478
*           DO;                     /*                       @Y30LB31*/
*             DARGSMOD=COMMSGS;     /*                       @Y30LB31*/
         L     @15,DDSTRU                                          1480
         MVC   DARGSMOD(3,@15),@CC01697                            1480
*             DARGSENT=MSG2093I;    /* STID=CM054            @Y30LB31*/
         MVI   DARGSENT(@15),X'36'                                 1481
*             DARGDBP=ADDR(BASGROUP);/*                      @Y30LB31*/
         LA    @14,BASGROUP(,BASEVPTR)                             1482
         ST    @14,DARGDBP(,@15)                                   1482
*             DARGILP=LENGTH(BASGROUP);/*                    @Y30LB31*/
         MVC   DARGILP(2,@15),@CH00182                             1483
*           END;                    /*                       @Y30LB31*/
*                                                                  1484
*       /*************************************************************/
*       /*                                                           */
*       /* IF THE ADDV REQUEST DID NOT INVOLVE A SERIAL NO.  @Y30LB31*/
*       /* CHANGE OR GENERAL-USE VOLUME BUT READWRITE WAS SPECIFIED, */
*       /* ISSUE MSG IDC2091I SINCE READWRITE WAS NOT SET.   @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1485
*       IF DARGSMOD=NOMODID THEN    /*                       @Y30LB31*/
@RF01478 DS    0H                                                  1485
@RC01471 L     @15,DDSTRU                                          1485
         CLC   DARGSMOD(3,@15),@CB01647                            1485
         BNE   @RF01485                                            1485
*         DO;                       /*                       @Y30LB31*/
*           DARGSMOD=ADDVMSGS;      /*                       @Y30LB31*/
         MVC   DARGSMOD(3,@15),@CC01687                            1487
*           DARGSENT=MSG2091B;      /* STID=AV04             @Y30LB31*/
         MVI   DARGSENT(@15),X'04'                                 1488
*           DARGDBP=ADDR(MSVIVOL#); /*                       @Y30LB31*/
         LA    @14,MSVIVOL#                                        1489
         ST    @14,DARGDBP(,@15)                                   1489
*           DARGILP=LENGTH(MSVIVOL#);/*                      @Y30LB31*/
         MVC   DARGILP(2,@15),@CH00159                             1490
*         END;                      /*                       @Y30LB31*/
*       CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*              @Y30LB31*/
@RF01485 L     @15,@PC00001                                        1492
         ST    @15,@AL00001                                        1492
         LA    @14,@CF00117                                        1492
         ST    @14,@AL00001+4                                      1492
         LA    @14,DDSTRU                                          1492
         ST    @14,@AL00001+8                                      1492
         MVI   @AL00001+8,X'80'                                    1492
         L     @15,GDTPRT(,@15)                                    1492
         LA    @01,@AL00001                                        1492
         BALR  @14,@15                                             1492
*     END;                          /*                       @Y30LB31*/
*                                                                  1494
*   /*****************************************************************/
*   /*                                                               */
*   /* OUTPUT THE APPROPRIATE INFORMATIVE MESSAGE UNLESS A   @Y30LB31*/
*   /* MESSAGE WAS OUTPUT EARLIER WHEN THE CARTRIDGE LABELS WERE     */
*   /* UPDATED.                                              @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1494
*   ELSE                            /*                       @Y30LB31*/
*     DO;                           /*                       @Y30LB31*/
         B     @RC01465                                            1494
@RF01465 DS    0H                                                  1495
*       PRINTTBL=''B;               /*                       @Y30LB31*/
*                                                                  1495
         XC    PRINTTBL(28),PRINTTBL                               1495
*       /*************************************************************/
*       /*                                                           */
*       /* THE VOLUME ATTRIBUTES WERE UPDATED BY DEFAULT TO  @Y30LB31*/
*       /* AGREE WITH THE GROUP.                             @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1496
*       IF GRPMSFLG=ON THEN         /*                       @Y30LB31*/
         TM    GRPMSFLG,B'00000010'                                1496
         BNO   @RF01496                                            1496
*         DO;                       /*                       @Y30LB31*/
*           DARGSMOD=COMMSGS;       /*                       @Y30LB31*/
         L     @15,DDSTRU                                          1498
         MVC   DARGSMOD(3,@15),@CC01697                            1498
*           DARGSENT=MSG0073I;      /* STID=CM033            @Y30LB31*/
         MVI   DARGSENT(@15),X'21'                                 1499
*           DARGDBP=ADDR(BASGROUP); /*                       @Y30LB31*/
         LA    @14,BASGROUP(,BASEVPTR)                             1500
         ST    @14,DARGDBP(,@15)                                   1500
*           DARGILP=LENGTH(BASGROUP);/*                      @Y30LB31*/
         MVC   DARGILP(2,@15),@CH00182                             1501
*         END;                      /*                       @Y30LB31*/
*                                                                  1502
*       /*************************************************************/
*       /*                                                           */
*       /* THE READWRITE ATTRIBUTE IS BEING UPDATED BY       @Y30LB31*/
*       /* REQUEST.                                          @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1503
*       ELSE                        /*                       @Y30LB31*/
*         IF ADDR(NSER)=NULLPTR THEN/*                       @Y30LB31*/
         B     @RC01496                                            1503
@RF01496 L     @15,@PC00001+4                                      1503
         L     @15,FDTPTR+20(,@15)                                 1503
         LTR   @15,@15                                             1503
         BNZ   @RF01503                                            1503
*           DO;                     /*                       @Y30LB31*/
*             DARGSMOD=ADDVMSGS;    /*                       @Y30LB31*/
         L     @15,DDSTRU                                          1505
         MVC   DARGSMOD(3,@15),@CC01687                            1505
*             DARGSENT=MSG0725I;    /* STID=AV06             @Y30LB31*/
         MVI   DARGSENT(@15),X'06'                                 1506
*             DARGDBP=ADDR(MSVIVOL#);/*                      @Y30LB31*/
         LA    @14,MSVIVOL#                                        1507
         ST    @14,DARGDBP(,@15)                                   1507
*             DARGILP=LENGTH(MSVIVOL#);/*                    @Y30LB31*/
         MVC   DARGILP(2,@15),@CH00159                             1508
*           END;                    /*                       @Y30LB31*/
*       IF DARGSMOD^=NOMODID THEN   /*                       @Y30LB31*/
@RF01503 DS    0H                                                  1510
@RC01496 L     @01,DDSTRU                                          1510
         CLC   DARGSMOD(3,@01),@CB01647                            1510
         BE    @RF01510                                            1510
*         CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*            @Y30LB31*/
*                                                                  1511
         L     @15,@PC00001                                        1511
         ST    @15,@AL00001                                        1511
         LA    @14,@CF00117                                        1511
         ST    @14,@AL00001+4                                      1511
         LA    @14,DDSTRU                                          1511
         ST    @14,@AL00001+8                                      1511
         MVI   @AL00001+8,X'80'                                    1511
         L     @15,GDTPRT(,@15)                                    1511
         LA    @01,@AL00001                                        1511
         BALR  @14,@15                                             1511
*       /*************************************************************/
*       /*                                                           */
*       /* FREE THE MESSAGE STORAGE AREA.                    @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1512
*       CALL IDCSAFS0(GDTTBL,ECBMSPTR);/*                    @Y30LB31*/
@RF01510 L     @15,@PC00001                                        1512
         ST    @15,@AL00001                                        1512
         LA    @14,ECBMSPTR                                        1512
         ST    @14,@AL00001+4                                      1512
         L     @15,GDTFSP(,@15)                                    1512
         LA    @01,@AL00001                                        1512
         BALR  @14,@15                                             1512
*     END;                          /*                       @Y30LB31*/
*                                                                  1513
*   /*****************************************************************/
*   /*                                                               */
*   /* RESTORE THE RETURN ADDRESS OF THE CALLER TO REG 14    @Y30LB31*/
*   /* AND RETURN TO CALLER, PASSING THE CONDITION CODE IN REG 15.   */
*   /*                                                       @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1514
*   RESPECIFY                                                      1514
*     REG14 RSTD;                   /*                       @ZDR2054*/
@RC01465 DS    0H                                                  1515
*   REG14=RETADDR3;                 /*                       @Y30LB31*/
         L     REG14,RETADDR3                                      1515
*   RESPECIFY                                                      1516
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   RETURN CODE(NEWVFRC);           /*                       @Y30LB31*/
         LH    @15,NEWVFRC                                         1517
@EL00013 DS    0H                                                  1517
@EF00013 DS    0H                                                  1517
@ER00013 BR    @14                                                 1517
*   END NEWVFRTN;                   /*                       @Y30LB31*/
*                                                                  1519
*/********************************************************** @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* PROCEDURE NAME - SECCKRTN                                @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* FUNCTION - DIRECTS THE VSAM AND SECURITY CHECK REQUIRED  @Y30LB31*/
*/*            BEFORE CHANGING THE VOL SERIAL NO.  CALLS     @Y30LB31*/
*/*            ALLOCRTN IF A UNIT ON WHICH TO MOUNT THE VOL  @Y30LB31*/
*/*            MUST BE DYNAMICALLY ALLOCATED.  CALLS         @Y30LB31*/
*/*            VPREPRTN TO MOUNT THE VOL IF THE VOL ALREADY  @Y30LB31*/
*/*            HAS A VOL SERIAL MISMATCH.  CALLS VTOCKRTN TO @Y30LB31*/
*/*            PERFORM THE VTOC SECURITY AND VSAM CHECKS.    @YD00175*/
*/*            NO MSGS ARE ISSUED BY THIS PROC.              @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* INPUT -  ADDVTBL, BCDV COMMON VOL RECORD FIELDS.         @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* OUTPUT - A RETURN CODE OF 0 INDICATES THE SECURITY CHECK @Y30LB31*/
*/*          FOR A BASE VOL WAS SUCCESSFUL OR THAT THE VSAM  @Y30LB31*/
*/*          STATUS WAS RETRIEVED FOR A DUPLICATE VOL.       @Y30LB31*/
*/*          A RETURN CODE OF 4 INDICATES THE VOL COULD NOT  @Y30LB31*/
*/*          BE MOUNTED FOR THE VTOC CHECK OR THAT THE VTOC  @Y30LB31*/
*/*          CHECK WAS UNSUCCESSFUL.                         @Y30LB31*/
*/*                                                          @Y30LB31*/
*/*********************************************************  @Y30LB31*/
*                                                                  1519
*SECCKRTN:                                                         1519
*   PROCEDURE OPTIONS(NOSAVEAREA,NOSAVE);/*                  @Y30LB31*/
*                                                                  1519
SECCKRTN DS    0H                                                  1520
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL CONDITION CODE.                                 @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1520
*   DCL                                                            1520
*     SECCKRC FIXED(15);            /*                       @Y30LB31*/
*                                                                  1520
*   /*****************************************************************/
*   /*                                                               */
*   /* SAVE THE CALLERS RETURN ADDRESS AND RESTORE UPON EXIT @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1521
*   RESPECIFY                                                      1521
*     REG14 RSTD;                   /*                       @ZDR2054*/
*   RETADDR2=REG14;                 /*                       @Y30LB31*/
         ST    REG14,RETADDR2                                      1522
*   RESPECIFY                                                      1523
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   OLDERID2=NEWERID2;                                             1524
         L     @15,@PC00001                                        1524
         L     @15,GDTTR2(,@15)                                    1524
         MVC   @TS00001(95),NEWERID2(@15)                          1524
         MVC   OLDERID2(95,@15),@TS00001                           1524
*   NEWID2='AVSE';                  /*                       @Y30LB31*/
*                                                                  1525
         MVC   NEWID2(4,@15),@CC01889                              1525
*   /*****************************************************************/
*   /*                                                               */
*   /* INITIALIZE TO ZERO THE CONDITION CODE USED WITHIN     @Y30LB31*/
*   /* THIS PROC.                                            @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1526
*   SECCKRC=LASTCC00;               /*                       @Y30LB31*/
*                                                                  1526
         SLR   @15,@15                                             1526
         STH   @15,SECCKRC                                         1526
*   /*****************************************************************/
*   /*                                                               */
*   /* DYNAMICALLY ALLOCATE A UNIT AND MOUNT THE VOLUME IF   @Y30LB31*/
*   /* THE UNIT IS NOT ALREADY ALLOCATED.                    @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1527
*   IF AUNITDDN=NODDNAME THEN       /*                       @Y30LB31*/
         CLC   AUNITDDN(8),@CB01651                                1527
         BNE   @RF01527                                            1527
*     DO;                           /*                       @Y30LB31*/
*       CALL ALLOCRTN;              /*                       @Y30LB31*/
         BAL   @14,ALLOCRTN                                        1529
*       RESPECIFY                                                  1530
*         RTNREG RSTD;                                             1530
*       TESTRC=RTNREG;                                             1531
         LR    TESTRC,RTNREG                                       1531
*       RESPECIFY                                                  1532
*         RTNREG UNRSTD;            /*                       @Y30LB31*/
*                                                                  1532
*       /*************************************************************/
*       /*                                                           */
*       /* EXIT FROM THIS PROCEDURE IF DYNAMIC ALLOCATION    @Y30LB31*/
*       /* FAILED.                                           @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1533
*       IF TESTRC^=0 THEN           /*                       @Y30LB31*/
         LTR   TESTRC,TESTRC                                       1533
         BZ    @RF01533                                            1533
*         SECCKRC=4;                /*                       @Y30LB31*/
         MVC   SECCKRC(2),@CH00043                                 1534
*     END;                          /*                       @Y30LB31*/
*                                                                  1535
*   /*****************************************************************/
*   /*                                                               */
*   /* CALL AN AMS SYSTEM ADAPTER ROUTINE TO MOUNT THE VOL   @Y30LB31*/
*   /* IF A VOLUME SERIAL MISMATCH EXISTS BETWEEN THE CART AND VOL   */
*   /* LABELS. OTHERWISE, AN OPEN VTOC EXECUTED BY THE VOLUME        */
*   /*                                                       @Y30LB31*/
*   /* SERVICES ROUTINE WILL CAUSE THE VOL TO BE MOUNTED.    @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1536
*   ELSE                            /*                       @Y30LB31*/
*     IF BCDBASE=ON&BCDSATIA=ZEROES THEN                           1536
         B     @RC01527                                            1536
@RF01527 TM    BCDBASE(BCDVPTR),B'00100000'                        1536
         BNO   @RF01536                                            1536
         CLC   BCDSATIA(2,BCDVPTR),@CB01654                        1536
         BE    @RT01536                                            1536
*       ;                           /* NO SPECIAL MNT        @Y30LB31*/
*     ELSE                          /*                       @Y30LB31*/
*       DO;                         /*                       @Y30LB31*/
@RF01536 DS    0H                                                  1539
*         MOUNTFLG=ON;              /* VOL MOUNT REQUESTED   @Y30LB31*/
*         WAITFLG=OFF;              /*                       @Y30LB31*/
         OI    MOUNTFLG,B'01000000'                                1540
         NI    WAITFLG,B'11011111'                                 1540
*         VPREPVOL=MSVIVOL#;        /*                       @Y30LB31*/
         MVC   VPREPVOL(6),MSVIVOL#                                1541
*         CALL VPREPRTN;            /*                       @Y30LB31*/
         BAL   @14,VPREPRTN                                        1542
*         RESPECIFY                                                1543
*           RTNREG RSTD;                                           1543
*         TESTRC=RTNREG;                                           1544
         LR    TESTRC,RTNREG                                       1544
*         RESPECIFY                                                1545
*           RTNREG UNRSTD;          /*                       @Y30LB31*/
*                                                                  1545
*         /***********************************************************/
*         /*                                                         */
*         /* EXIT FROM THIS PROC IF THE SPECIAL MOUNT        @Y30LB31*/
*         /* FAILED FOR THE VOL WITH A SERIAL MISMATCH.      @Y30LB31*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  1546
*         IF TESTRC^=0 THEN         /*                       @Y30LB31*/
         LTR   TESTRC,TESTRC                                       1546
         BZ    @RF01546                                            1546
*           SECCKRC=4;              /*                       @Y30LB31*/
         MVC   SECCKRC(2),@CH00043                                 1547
*       END;                        /*                       @Y30LB31*/
@RF01546 DS    0H                                                  1549
*                                                                  1549
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THERE IS NO PROBLEM MOUNTING THE VOLUME FOR THE    @Y30LB31*/
*   /* SECURITY AND VSAM CHECK OUT, CALL VTOCKRTN TO PERFORM THIS    */
*   /* VTOC FUNCTION.                                        @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1549
*   IF SECCKRC=0 THEN               /*                       @Y30LB31*/
@RT01536 DS    0H                                                  1549
@RC01527 LH    @15,SECCKRC                                         1549
         LTR   @15,@15                                             1549
         BNZ   @RF01549                                            1549
*     DO;                           /*                       @Y30LB31*/
*       CALL VTOCKRTN;              /*                       @Y30LB31*/
         BAL   @14,VTOCKRTN                                        1551
*       RESPECIFY                                                  1552
*         RTNREG RSTD;                                             1552
*       TESTRC=RTNREG;                                             1553
         LR    TESTRC,RTNREG                                       1553
*       RESPECIFY                                                  1554
*         RTNREG UNRSTD;            /*                       @Y30LB31*/
*                                                                  1554
*       /*************************************************************/
*       /*                                                           */
*       /* SET AN UNSUCCESSFUL CONDITION CODE IF THE VSAM    @Y30LB31*/
*       /* AND SECURITY CHECK COULD NOT BE PERFORMED.        @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1555
*       IF TESTRC^=0 THEN           /*                       @Y30LB31*/
         LTR   TESTRC,TESTRC                                       1555
         BZ    @RF01555                                            1555
*         SECCKRC=4;                /*                       @Y30LB31*/
         MVC   SECCKRC(2),@CH00043                                 1556
*     END;                          /*                       @Y30LB31*/
*                                                                  1557
@RF01555 DS    0H                                                  1558
*   /*****************************************************************/
*   /*                                                               */
*   /* RESTORE REG 14 TO THE RETURN ADDRESS OF THE CALLER    @Y30LB31*/
*   /* AND EXIT FROM SECCKRTN. PASS THE CONDITION CODE IN REG 15.    */
*   /*                                                       @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1558
*   RESPECIFY                                                      1558
*     REG14 RSTD;                   /*                       @ZDR2054*/
@RF01549 DS    0H                                                  1559
*   REG14=RETADDR2;                 /*                       @Y30LB31*/
         L     REG14,RETADDR2                                      1559
*   RESPECIFY                                                      1560
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   RETURN CODE(SECCKRC);           /*                       @Y30LB31*/
         LH    @15,SECCKRC                                         1561
@EL00014 DS    0H                                                  1561
@EF00014 DS    0H                                                  1561
@ER00014 BR    @14                                                 1561
*   END SECCKRTN;                   /*                       @Y30LB31*/
*                                                                  1563
*/********************************************************** @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* PROCEDURE NAME - VPREPRTN                                @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* FUNCTION - MOUNTS AND DEMOUNTS THE                       @Y30LB31*/
*/*            VOLUME AND FOLLOWING A DEMOUNT RELEASES       @Y30LB31*/
*/*            THE RESERVE SET BY THE VOL SERVICES ROUTINES  @Y30LB31*/
*/*            WHICH CHECKED THE VTOC OR UPDATED THE VOL     @Y30LB31*/
*/*            LABEL.  NO MESSAGES ARE ISSUED BY THIS PROC.  @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* INPUT -  ADDVTBL, MDAGL.                                 @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* OUTPUT - A RETURN CODE OF 0 INDICATES VOL SUCCESSFULLY   @Y30LB31*/
*/*          MOUNTED OR DEMOUNTED.  A RETURN CODE OF 4       @Y30LB31*/
*/*          INDICATES A MOUNT OR DEMOUNT FAILURE.           @Y30LB31*/
*/*                                                          @Y30LB31*/
*/********************************************************** @Y30LB31*/
*                                                                  1563
*VPREPRTN:                                                         1563
*   PROCEDURE OPTIONS(NOSAVEAREA,NOSAVE);/*                  @Y30LB31*/
*                                                                  1563
VPREPRTN DS    0H                                                  1564
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL CONDITION CODE.                                 @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1564
*   DCL                                                            1564
*     VPREPRC FIXED(15);            /*                       @Y30LB31*/
*                                                                  1564
*   /*****************************************************************/
*   /*                                                               */
*   /* SAVE THE CALLERS RETURN ADDRESS AND RESTORE IT UPON   @Y30LB31*/
*   /* EXIT.                                                 @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1565
*   RESPECIFY                                                      1565
*     REG14 RSTD;                   /*                       @ZDR2054*/
*   RETADDR3=REG14;                 /*                       @Y30LB31*/
         ST    REG14,RETADDR3                                      1566
*   RESPECIFY                                                      1567
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   OLDERID2=NEWERID2;                                             1568
         L     @15,@PC00001                                        1568
         L     @14,GDTTR2(,@15)                                    1568
         MVC   @TS00001(95),NEWERID2(@14)                          1568
         MVC   OLDERID2(95,@14),@TS00001                           1568
*   NEWID2='AVVP';                  /*                       @Y30LB31*/
*                                                                  1569
         MVC   NEWID2(4,@14),@CC01896                              1569
*   /*****************************************************************/
*   /*                                                               */
*   /* ZERO OUT THE CONDITION CODE SET BY THIS PROC.         @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1570
*   VPREPRC=LASTCC00;               /*                       @Y30LB31*/
*                                                                  1570
         SLR   VPREPRC,VPREPRC                                     1570
*   /*****************************************************************/
*   /*                                                               */
*   /* IF A VOL DEMOUNT WAS REQUESTED, RELEASE THE           @ZA05125*/
*   /* RESERVE SET BY EITHER IDCVS01 WHEN CHECKING THE VTOC OR BY    */
*   /* IDCVS02 WHEN UPDATING THE VOL LABEL.                  @ZA05125*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1571
*   IF MOUNTFLG=OFF THEN            /*                       @ZA05125*/
         TM    MOUNTFLG,B'01000000'                                1571
         BNZ   @RF01571                                            1571
*     DO;                           /*                       @ZA05125*/
*       RNMSERNO=VPREPVOL;          /*                       @ZA05125*/
         MVC   RNMSERNO(6),VPREPVOL                                1573
*       RNMTRAIL=RESERVE;           /*                       @ZA05119*/
         MVC   RNMTRAIL(16),RESERVE                                1574
*       CALL IDCSADQ0(GDTTBL,MAJORNM,MINORNM);/*             @ZA05125*/
         ST    @15,@AL00001                                        1575
         LA    @14,@CC01635                                        1575
         ST    @14,@AL00001+4                                      1575
         LA    @14,MINORNM                                         1575
         ST    @14,@AL00001+8                                      1575
         MVI   @AL00001+8,X'80'                                    1575
         L     @15,GDTDEQ(,@15)                                    1575
         LA    @01,@AL00001                                        1575
         BALR  @14,@15                                             1575
*     END;                          /*                       @ZA05125*/
*                                                                  1576
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THE MOUNT-DEMOUNT ARGUMENT LIST HAS NOT BEEN       @Y30LB31*/
*   /* INITIALIZED, DO SO. THEN REUSE THE LIST FOR EACH SUBSEQUENT   */
*   /* REQUEST IN ORDER NOT TO DESTROY THE ENQUEUE FLAG SET BY THE   */
*   /* MOUNT ROUTINE AND USED BY THE DEMOUNT ROUTINE THAT IS @Y30LB31*/
*   /* INVOKED.                                              @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1577
*   IF MDDDNAME=NODDNAME THEN       /*                       @Y30LB31*/
@RF01571 LA    @15,AVMDAGL                                         1577
         CLC   MDDDNAME(8,@15),@CB01651                            1577
         BNE   @RF01577                                            1577
*     DO;                           /*                       @Y30LB31*/
*       MDDDNAME=AUNITDDN;          /*                       @Y30LB31*/
         MVC   MDDDNAME(8,@15),AUNITDDN                            1579
*       MDUCBPTR=ADDR(AUNITUCB);    /*                       @Y30LB31*/
         LA    @14,AUNITUCB                                        1580
         ST    @14,MDUCBPTR(,@15)                                  1580
*     END;                          /*                       @Y30LB31*/
*   MDLABEL=VPREPVOL;               /*                       @Y30LB31*/
@RF01577 LA    @15,AVMDAGL                                         1582
         MVC   MDLABEL(6,@15),VPREPVOL                             1582
*   IF WAITFLG=ON THEN              /*                       @Y30LB31*/
         TM    WAITFLG,B'00100000'                                 1583
         BNO   @RF01583                                            1583
*     MDWAIT=ON;                    /*                       @Y30LB31*/
         OI    MDWAIT(@15),B'00010000'                             1584
*   ELSE                            /*                       @Y30LB31*/
*     MDWAIT=OFF;                   /*                       @Y30LB31*/
         B     @RC01583                                            1585
@RF01583 LA    @15,AVMDAGL                                         1585
         NI    MDWAIT(@15),B'11101111'                             1585
*   IF MOUNTFLG=ON THEN             /*                       @Y30LB31*/
@RC01583 TM    MOUNTFLG,B'01000000'                                1586
         BNO   @RF01586                                            1586
*     AMDTYPE=MOUNT;                /*                       @Y30LB31*/
         MVC   AMDTYPE(8),MOUNT                                    1587
*   ELSE                            /*                       @Y30LB31*/
*     AMDTYPE=DEMOUNT;              /*                       @Y30LB31*/
*                                                                  1588
         B     @RC01586                                            1588
@RF01586 MVC   AMDTYPE(8),DEMOUNT                                  1588
*   /*****************************************************************/
*   /*                                                               */
*   /* TAKE A SYMBOLIC DUMP OF THE MOUNT-DEMOUNT PARM LIST   @Y30LB31*/
*   /* BEFORE INVOKING THE MOUNT-DEMOUNT ROUTINE             @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1589
*   IF GDTDBG=NULLPTR THEN                                         1589
@RC01586 L     @15,@PC00001                                        1589
         L     @15,GDTDBG(,@15)                                    1589
         LTR   @15,@15                                             1589
         BZ    @RT01589                                            1589
*     ;                                                            1590
*   ELSE                                                           1591
*     DO;                                                          1591
*       DMPINDEX=ADDR(AVDMPLST);    /*                       @Y30LB31*/
         LA    DMPINDEX,AVDMPLST                                   1592
*       DMPITMNM='AVMDAGL';                                        1593
         MVI   DMPITMNM+7(DMPINDEX),C' '                           1593
         MVC   DMPITMNM(7,DMPINDEX),@CC01897                       1593
*       DMPITMPT=ADDR(AVMDAGL);                                    1594
         LA    @03,AVMDAGL                                         1594
         ST    @03,DMPITMPT(,DMPINDEX)                             1594
*       DMPITMLN=LENGTH(AVMDAGL);                                  1595
         MVC   DMPITMLN(2,DMPINDEX),@CH02001                       1595
*       DMPITMTP='H';                                              1596
         MVI   DMPITMTP(DMPINDEX),C'H'                             1596
*       DMPINDEX=DMPINDEX+DMPELEMT;                                1597
*                                                                  1597
         LA    @03,16                                              1597
         ALR   DMPINDEX,@03                                        1597
*       /*************************************************************/
*       /*                                                           */
*       /*                                                   @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1598
*       DMPITMNM='ADDVTBL';                                        1598
         MVI   DMPITMNM+7(DMPINDEX),C' '                           1598
         MVC   DMPITMNM(7,DMPINDEX),@CC01766                       1598
*       DMPITMPT=ADDR(ADDVTBL);                                    1599
         LA    @15,ADDVTBL                                         1599
         ST    @15,DMPITMPT(,DMPINDEX)                             1599
*       DMPITMLN=LENGTH(ADDVTBL);                                  1600
         MVC   DMPITMLN(2,DMPINDEX),@CH01999                       1600
*       DMPITMTP='H';                                              1601
         MVI   DMPITMTP(DMPINDEX),C'H'                             1601
*       DMPINDEX=DMPINDEX+DMPELEMT;                                1602
*                                                                  1602
         ALR   DMPINDEX,@03                                        1602
*       /*************************************************************/
*       /*                                                           */
*       /*                                                   @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1603
*       DMPTRM=DMPTRMVL;                                           1603
         MVI   DMPTRM(DMPINDEX),X'FF'                              1603
*     END;                          /*                       @Y30LB31*/
*   IF GDTDBG=NULLPTR THEN                                         1605
@RT01589 L     @15,@PC00001                                        1605
         L     @15,GDTDBG(,@15)                                    1605
         LTR   @15,@15                                             1605
         BZ    @RT01605                                            1605
*     ;                                                            1606
*   ELSE                                                           1607
*     CALL IDCDB010(GDTTBL,'AVMD',ADDR(AVDMPLST));/*         @Y30LB31*/
*                                                                  1607
         L     @15,@PC00001                                        1607
         ST    @15,@AL00001                                        1607
         LA    @14,@CC01898                                        1607
         ST    @14,@AL00001+4                                      1607
         LA    @14,AVDMPLST                                        1607
         ST    @14,@AFTEMPS+24                                     1607
         LA    @14,@AFTEMPS+24                                     1607
         ST    @14,@AL00001+8                                      1607
         MVI   @AL00001+8,X'80'                                    1607
         L     @15,GDTDBG(,@15)                                    1607
         LA    @01,@AL00001                                        1607
         BALR  @14,@15                                             1607
*   /*****************************************************************/
*   /*                                                               */
*   /* MOUNT OR DEMOUNT THE VOLUME AS REQUESTED.             @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1608
*   CALL IDCSA060(GDTTBL,AMDTYPE,MDAGL);/*                   @Y30LB31*/
@RT01605 L     @02,@PC00001                                        1608
         ST    @02,@AL00001                                        1608
         LA    @15,AMDTYPE                                         1608
         ST    @15,@AL00001+4                                      1608
         LA    @15,AVMDAGL                                         1608
         ST    @15,@AL00001+8                                      1608
         MVI   @AL00001+8,X'80'                                    1608
         L     @15,GDTUNT(,@02)                                    1608
         LA    @01,@AL00001                                        1608
         BALR  @14,@15                                             1608
*   RESPECIFY                                                      1609
*     RTNREG RSTD;                                                 1609
*   TESTRC=RTNREG;                                                 1610
         LR    TESTRC,RTNREG                                       1610
*   RESPECIFY                                                      1611
*     RTNREG UNRSTD;                /*                       @Y30LB31*/
*   IF TESTRC=4 THEN                /*                       @Y30LB31*/
         LA    @02,4                                               1612
         CR    TESTRC,@02                                          1612
         BNE   @RF01612                                            1612
*     VPREPRC=4;                    /*                       @Y30LB31*/
*                                                                  1613
         LR    VPREPRC,@02                                         1613
*   /*****************************************************************/
*   /*                                                               */
*   /* RESTORE REG 14 WITH THE RETURN ADDRESS OF THE CALLER  @ZA05125*/
*   /* AND EXIT FROM UPREPRTN. PASS THE CONDITION CODE IN REG 15.    */
*   /*                                                       @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1614
*   RESPECIFY                                                      1614
*     REG14 RSTD;                   /*                       @ZDR2054*/
@RF01612 DS    0H                                                  1615
*   REG14=RETADDR3;                 /*                       @Y30LB31*/
         L     REG14,RETADDR3                                      1615
*   RESPECIFY                                                      1616
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   RETURN CODE(VPREPRC);           /*                       @Y30LB31*/
         LR    @15,VPREPRC                                         1617
@EL00015 DS    0H                                                  1617
@EF00015 DS    0H                                                  1617
@ER00015 BR    @14                                                 1617
*   END VPREPRTN;                   /*                       @Y30LB31*/
*                                                                  1619
*/********************************************************** @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* PROCEDURE NAME - VTOCKRTN                                @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* FUNCTION - FOR A BASE VOL, CHECKS FOR WRITE-LEVEL        @Y30LB31*/
*/*            PROTECTED DATA SETS, UNEXPIRED DATA SETS,     @Y30LB31*/
*/*            AND NON-VSAM STATUS ONLY.  FOR A DUPLICATE    @Y30LB31*/
*/*            VOL, RETRIEVES THE VSAM OWNERSHIP STATUS FOR  @Y30LB31*/
*/*            SUBSEQUENT TESTING.  NO MESSAGES ARE ISSUED   @Y30LB31*/
*/*            BY THIS PROC.                                 @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* INPUT - FDTTBL, ADDVTBL, BCDV FOR VOLUME RECORD.         @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* OUTPUT - A RETURN CODE OF 0 INDICATES A SUCCESSFUL       @Y30LB31*/
*/*          SECURITY CHECK OR THE VSAM STATUS WAS           @Y30LB31*/
*/*          RETRIEVED.  A RETURN CODE OF 4 INDICATES        @Y30LB31*/
*/*          AN UNSUCCESSFUL SECURITY CHECK, OR FAILURE      @YD00175*/
*/*          TO RETRIEVE THE VSAM STATUS FROM THE VTOC.      @YD00175*/
*/*                                                          @Y30LB31*/
*/********************************************************** @Y30LB31*/
*                                                                  1619
*VTOCKRTN:                                                         1619
*   PROCEDURE OPTIONS(NOSAVEAREA,NOSAVE);/*                  @Y30LB31*/
*                                                                  1619
VTOCKRTN DS    0H                                                  1620
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL CONDITION CODE.                                 @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1620
*   DCL                                                            1620
*     VTOCKRC FIXED(15);            /*                       @Y30LB31*/
*                                                                  1620
*   /*****************************************************************/
*   /*                                                               */
*   /* DEFINE A COMMON AREA TO                               @Y30LB31*/
*   /* TO DESCRIBE THE TYPE OF VOL SERVICE REQUEST.          @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1621
*   DCL                                                            1621
*     AVS1TEST CHAR(8);             /*                       @Y30LB31*/
*   DCL                                                            1622
*     IDCVS01 CHAR(8) CONSTANT('IDCVS01 ');/*                @Y30LB31*/
*                                                                  1622
*   /*****************************************************************/
*   /*                                                               */
*   /* SAVE THE CALLERS RETURN ADDRESS AND RESTORE           @Y30LB31*/
*   /* IT UPON EXIT.                                         @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1623
*   RESPECIFY                                                      1623
*     REG14 RSTD;                   /*                       @ZDR2054*/
*   RETADDR3=REG14;                 /*                       @Y30LB31*/
         ST    REG14,RETADDR3                                      1624
*   RESPECIFY                                                      1625
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   OLDERID2=NEWERID2;                                             1626
         L     @05,@PC00001                                        1626
         L     @05,GDTTR2(,@05)                                    1626
         MVC   @TS00001(95),NEWERID2(@05)                          1626
         MVC   OLDERID2(95,@05),@TS00001                           1626
*   NEWID2='AVVC';                  /*                       @G24LB23*/
*                                                                  1627
         MVC   NEWID2(4,@05),@CC01906                              1627
*   /*****************************************************************/
*   /*                                                               */
*   /* ZERO OUT THE CONDITION CODE SET BY THIS PROC.         @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1628
*   VTOCKRC=LASTCC00;               /*                       @Y30LB31*/
*                                                                  1628
         SLR   @15,@15                                             1628
         LR    VTOCKRC,@15                                         1628
*   /*****************************************************************/
*   /*                                                               */
*   /* SETUP THE ARG LIST TO BE PASSED TO THE VOL SERV       @Y30LB31*/
*   /* ROUTINE FOR THE VTOC CHECK. THEN SET THOSE FIELDS COMMON      */
*   /*                                                       @Y30LB31*/
*   /* TO EITHER THE VSAM OR SECURITY REQUEST.               @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1629
*   VSRES=ON;                       /*                       @Y30LB31*/
         LA    @05,AVVS1AGL                                        1629
         OI    VSRES(@05),B'10000000'                              1629
*   VSUCBP=ADDR(AUNITUCB);          /*                       @Y30LB31*/
         LA    @14,AUNITUCB                                        1630
         ST    @14,VSUCBP(,@05)                                    1630
*   VSVOLP=ADDR(MSVIVOL#);          /*                       @Y30LB31*/
         LA    @14,MSVIVOL#                                        1631
         ST    @14,VSVOLP(,@05)                                    1631
*   VSFILEP=ADDR(AUNITDDN);         /*                       @Y30LB31*/
*                                                                  1632
         LA    @14,AUNITDDN                                        1632
         ST    @14,VSFILEP(,@05)                                   1632
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THE VOL IS A BASE VOL, CHECK FOR WRITE-LEVEL       @Y30LB31*/
*   /* PASSWORD PROTECTED DATA SETS, UNEXPIRED DATA SETS, AND        */
*   /*                                                       @Y30LB31*/
*   /* NON-VSAM STATUS ONLY.                                 @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1633
*   IF BCDBASE=ON THEN              /*                       @Y30LB31*/
         TM    BCDBASE(BCDVPTR),B'00100000'                        1633
         BNO   @RF01633                                            1633
*     DO;                           /*                       @Y30LB31*/
*       VSWRITE=ON;                 /*                       @Y30LB31*/
*       VSNOVSAM=ON;                /*                       @Y30LB31*/
         OI    VSWRITE(@05),B'10001000'                            1636
*       IF ADDR(PFILE)^=NULLPTR THEN/*                       @Y30LB31*/
         L     @14,@PC00001+4                                      1637
         L     @14,FDTPTR+32(,@14)                                 1637
         CR    @14,@15                                             1637
         BE    @RF01637                                            1637
*         VSPFILEP=ADDR(PFILE);     /*                       @Y30LB31*/
         ST    @14,VSPFILEP(,@05)                                  1638
*       AVS1TEST=SECCHECK;          /*                       @Y30LB31*/
@RF01637 MVC   AVS1TEST(8),SECCHECK                                1639
*     END;                          /*                       @Y30LB31*/
*                                                                  1640
*   /*****************************************************************/
*   /*                                                               */
*   /* FOR A DUPLICATE VOL BYPASS THE SECURITY CHECK AND     @Y30LB31*/
*   /* RETRIEVE THE VSAM OWNERSHIP STATUS.                   @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1641
*   ELSE                            /*                       @Y30LB31*/
*     DO;                           /*                       @Y30LB31*/
         B     @RC01633                                            1641
@RF01633 DS    0H                                                  1642
*       VSVSFLAG=ON;                /*                       @Y30LB31*/
         LA    @05,AVVS1AGL                                        1642
         OI    VSVSFLAG(@05),B'00100000'                           1642
*       AVS1TEST=GETVTOC;           /*                       @Y30LB31*/
         MVC   AVS1TEST(8),GETVTOC                                 1643
*     END;                          /*                       @Y30LB31*/
*                                                                  1645
*   /*****************************************************************/
*   /*                                                               */
*   /* TAKE A SYMBOLIC DUMP OF THE VOL SERVICES PARM LIST    @Y30LB31*/
*   /* BEFORE CHECKING THE VTOC.                             @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1645
*   IF GDTDBG=NULLPTR THEN                                         1645
@RC01633 L     @05,@PC00001                                        1645
         L     @05,GDTDBG(,@05)                                    1645
         LTR   @05,@05                                             1645
         BZ    @RT01645                                            1645
*     ;                                                            1646
*   ELSE                                                           1647
*     DO;                                                          1647
*       DMPINDEX=ADDR(AVDMPLST);    /*                       @Y30LB31*/
         LA    DMPINDEX,AVDMPLST                                   1648
*       DMPITMNM='AVVS1AGL';                                       1649
         MVC   DMPITMNM(8,DMPINDEX),@CC01907                       1649
*       DMPITMPT=ADDR(AVVS1AGL);                                   1650
         LA    @05,AVVS1AGL                                        1650
         ST    @05,DMPITMPT(,DMPINDEX)                             1650
*       DMPITMLN=LENGTH(AVVS1AGL);                                 1651
         MVC   DMPITMLN(2,DMPINDEX),@CH02002                       1651
*       DMPITMTP='H';                                              1652
         MVI   DMPITMTP(DMPINDEX),C'H'                             1652
*       DMPINDEX=DMPINDEX+DMPELEMT;                                1653
*                                                                  1653
         LA    @05,16                                              1653
         ALR   DMPINDEX,@05                                        1653
*       /*************************************************************/
*       /*                                                           */
*       /*                                                   @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1654
*       DMPITMNM='ADDVTBL';                                        1654
         MVI   DMPITMNM+7(DMPINDEX),C' '                           1654
         MVC   DMPITMNM(7,DMPINDEX),@CC01766                       1654
*       DMPITMPT=ADDR(ADDVTBL);                                    1655
         LA    @03,ADDVTBL                                         1655
         ST    @03,DMPITMPT(,DMPINDEX)                             1655
*       DMPITMLN=LENGTH(ADDVTBL);                                  1656
         MVC   DMPITMLN(2,DMPINDEX),@CH01999                       1656
*       DMPITMTP='H';                                              1657
         MVI   DMPITMTP(DMPINDEX),C'H'                             1657
*       DMPINDEX=DMPINDEX+DMPELEMT;                                1658
*                                                                  1658
         ALR   DMPINDEX,@05                                        1658
*       /*************************************************************/
*       /*                                                           */
*       /*                                                   @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1659
*       DMPTRM=DMPTRMVL;                                           1659
         MVI   DMPTRM(DMPINDEX),X'FF'                              1659
*     END;                          /*                       @Y30LB31*/
*   IF GDTDBG=NULLPTR THEN                                         1661
@RT01645 L     @05,@PC00001                                        1661
         L     @05,GDTDBG(,@05)                                    1661
         LTR   @05,@05                                             1661
         BZ    @RT01661                                            1661
*     ;                                                            1662
*   ELSE                                                           1663
*     CALL IDCDB010(GDTTBL,'AVS1',ADDR(AVDMPLST));/*         @Y30LB31*/
*                                                                  1663
         L     @05,@PC00001                                        1663
         ST    @05,@AL00001                                        1663
         LA    @15,@CC01908                                        1663
         ST    @15,@AL00001+4                                      1663
         LA    @15,AVDMPLST                                        1663
         ST    @15,@AFTEMPS+28                                     1663
         LA    @15,@AFTEMPS+28                                     1663
         ST    @15,@AL00001+8                                      1663
         MVI   @AL00001+8,X'80'                                    1663
         L     @15,GDTDBG(,@05)                                    1663
         LA    @01,@AL00001                                        1663
         BALR  @14,@15                                             1663
*   /*****************************************************************/
*   /*                                                               */
*   /* CALL THE VOLUME SERVICE ROUTINE WHICH PERFORMS THE    @Y30LB31*/
*   /* VTOC CHECK.                                           @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1664
*   CALL IDCSACL0(GDTTBL,IDCVS01,AVS1TEST,VS1AGL);/*         @Y30LB31*/
@RT01661 L     @05,@PC00001                                        1664
         ST    @05,@AL00001                                        1664
         LA    @02,@CC01905                                        1664
         ST    @02,@AL00001+4                                      1664
         LA    @02,AVS1TEST                                        1664
         ST    @02,@AL00001+8                                      1664
         LA    @02,AVVS1AGL                                        1664
         ST    @02,@AL00001+12                                     1664
         MVI   @AL00001+12,X'80'                                   1664
         L     @15,GDTCAL(,@05)                                    1664
         LA    @01,@AL00001                                        1664
         BALR  @14,@15                                             1664
*   RESPECIFY                                                      1665
*     RTNREG RSTD;                                                 1665
*   TESTRC=RTNREG;                                                 1666
         LR    TESTRC,RTNREG                                       1666
*   RESPECIFY                                                      1667
*     RTNREG UNRSTD;                /*                       @Y30LB31*/
*                                                                  1667
*   /*****************************************************************/
*   /*                                                               */
*   /* PROCESS THE RETURN CODE FROM THE VOL SERVICE          @Y30LB31*/
*   /* ROUTINE.                                              @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1668
*   IF TESTRC=4 THEN                /*                       @Y30LB31*/
         LA    @05,4                                               1668
         CR    TESTRC,@05                                          1668
         BNE   @RF01668                                            1668
*     VTOCKRC=4;                    /* SECURITY CHECK FAILED OR VSAM
*                                                            @Y30LB31
*                                      STATUS NOT RETRIEVED. @Y30LB31*/
         LR    VTOCKRC,@05                                         1669
*   ELSE                            /*                       @Y30LB31*/
*     IF TESTRC=8 THEN              /*                       @Y30LB31*/
         B     @RC01668                                            1670
@RF01668 C     TESTRC,@CF00182                                     1670
         BNE   @RF01670                                            1670
*       CC04FLG=ON;                 /* A PASSWORD PROTECTED D.S. NOT
*                                                            @Y30LB31
*                                      CLOSED.               @Y30LB31*/
         OI    CC04FLG,B'10000000'                                 1671
*                                                                  1672
*   /*****************************************************************/
*   /*                                                               */
*   /* CLOSE THE VTOC IF NOT CLOSED BY THE VOL SERVICES      @Y30LB31*/
*   /* ROUTINE.                                              @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1672
*   IF VSIOP^=NULLPTR THEN          /*                       @Y30LB31*/
@RF01670 DS    0H                                                  1672
@RC01668 LA    @05,AVVS1AGL                                        1672
         L     @15,VSIOP(,@05)                                     1672
         LTR   @15,@15                                             1672
         BZ    @RF01672                                            1672
*     DO;                           /*                       @Y30LB31*/
*       CALL IDCIOCL0(GDTTBL,VSIOP);/*                       @Y30LB31*/
         L     @02,@PC00001                                        1674
         ST    @02,@AL00001                                        1674
         LA    @05,VSIOP(,@05)                                     1674
         ST    @05,@AL00001+4                                      1674
         MVI   @AL00001+4,X'80'                                    1674
         L     @15,GDTCLS(,@02)                                    1674
         LA    @01,@AL00001                                        1674
         BALR  @14,@15                                             1674
*       RESPECIFY                                                  1675
*         RTNREG RSTD;                                             1675
*       TESTRC=RTNREG;                                             1676
         LR    TESTRC,RTNREG                                       1676
*       RESPECIFY                                                  1677
*         RTNREG UNRSTD;            /*                       @Y30LB31*/
*                                                                  1677
*       /*************************************************************/
*       /*                                                           */
*       /* SET THE EOJ COND CODE FLAG IF THE CLOSE FAILED.   @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1678
*       IF TESTRC^=0 THEN           /*                       @Y30LB31*/
         LTR   TESTRC,TESTRC                                       1678
         BZ    @RF01678                                            1678
*         CC04FLG=ON;               /*                       @Y30LB31*/
         OI    CC04FLG,B'10000000'                                 1679
*     END;                          /*                       @Y30LB31*/
*                                                                  1680
@RF01678 DS    0H                                                  1681
*   /*****************************************************************/
*   /*                                                               */
*   /* RELEASE THE RESERVE SET BY THE VOL SERVICES           @Y30LB31*/
*   /* ROUTINE IF THE NEW VOL SERIAL NO. PROCESSING MUST     @Y30LB31*/
*   /* TERMINATE.                                            @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1681
*   IF VTOCKRC^=0 THEN              /*                       @Y30LB31*/
@RF01672 LTR   VTOCKRC,VTOCKRC                                     1681
         BZ    @RF01681                                            1681
*     DO;                           /*                       @Y30LB31*/
*       RNMSERNO=MSVIVOL#;          /*                       @Y30LB31*/
         MVC   RNMSERNO(6),MSVIVOL#                                1683
*       RNMTRAIL=RESERVE;           /*                       @ZA05119*/
         MVC   RNMTRAIL(16),RESERVE                                1684
*       CALL IDCSADQ0(GDTTBL,MAJORNM,MINORNM);/*             @Y30LB31*/
         L     @05,@PC00001                                        1685
         ST    @05,@AL00001                                        1685
         LA    @15,@CC01635                                        1685
         ST    @15,@AL00001+4                                      1685
         LA    @15,MINORNM                                         1685
         ST    @15,@AL00001+8                                      1685
         MVI   @AL00001+8,X'80'                                    1685
         L     @15,GDTDEQ(,@05)                                    1685
         LA    @01,@AL00001                                        1685
         BALR  @14,@15                                             1685
*     END;                          /*                       @Y30LB31*/
*                                                                  1686
*   /*****************************************************************/
*   /*                                                               */
*   /* RESTORE REG14 WITH THE RETURN ADDRESS OF THE CALLER   @Y30LB31*/
*   /* AND EXIT FROM VTOCKRTN. PASS THE CONDITION CODE IN REG 15.    */
*   /*                                                       @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1687
*   RESPECIFY                                                      1687
*     REG14 RSTD;                   /*                       @ZDR2054*/
@RF01681 DS    0H                                                  1688
*   REG14=RETADDR3;                 /*                       @Y30LB31*/
         L     REG14,RETADDR3                                      1688
*   RESPECIFY                                                      1689
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   RETURN CODE(VTOCKRC);           /*                       @Y30LB31*/
         LR    @15,VTOCKRC                                         1690
@EL00016 DS    0H                                                  1690
@EF00016 DS    0H                                                  1690
@ER00016 BR    @14                                                 1690
*   END VTOCKRTN;                   /*                       @Y30LB31*/
*                                                                  1692
*/********************************************************** @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* PROCEDURE NAME - CLABLRTN                                @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* FUNCTION - DIRECTS THE VOLUME DEMOUNT, MSC RENAME        @Y30LB31*/
*/*            TO CHANGE THE VOLUME SERIAL NO. IN THE        @Y30LB31*/
*/*            CARTRIDGE LABELS, AND THE ACTIVATE WHICH      @Y30LB31*/
*/*            PREPARES THE VOL FOR THE VOL LABEL UPDATE.    @Y30LB31*/
*/*            CALLS VPREPRTN, RENAMRTN, AND ACTVRTN.        @Y30LB31*/
*/*            ISSUES MESSAGES IDC2093I, IDC2091I,           @Y30LB31*/
*/*            IDC0073I, IDC0064I, AND IDC0725I.             @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* INPUT - ADDVTBL, PRINTTBL FOR MESSAGES,                  @Y30LB31*/
*/*         BASEV AND BCDV FOR VOLUME RECORD.                @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* OUTPUT - RETURN CODE OF 0 INDICATES BOTH A SUCCESSFUL    @Y30LB31*/
*/*          CART LABEL UPDATE AND VOL ACTIVATE.  RETURN     @Y30LB31*/
*/*          CODE OF 4 INDICATES A BASE VOL COULD NOT BE     @Y30LB31*/
*/*          DEMOUNTED FOR THE CART LABEL UPDATE, OR THAT    @Y30LB31*/
*/*          THE CART LABEL UPDATE FAILED.  RETURN CODE OF   @Y30LB31*/
*/*          EIGHT INDICATES VOL ACTIVATE FAILED.            @Y30LB31*/
*/*                                                          @Y30LB31*/
*/********************************************************** @Y30LB31*/
*                                                                  1692
*CLABLRTN:                                                         1692
*   PROCEDURE OPTIONS(NOSAVEAREA,NOSAVE);/*                  @Y30LB31*/
*                                                                  1692
CLABLRTN DS    0H                                                  1693
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL CONDITION CODE.                                 @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1693
*   DCL                                                            1693
*     CLABLRC FIXED(15);            /*                       @Y30LB31*/
*                                                                  1693
*   /*****************************************************************/
*   /*                                                               */
*   /* SAVE THE CALLERS RETURN ADDRESS AND RESTORE IT        @Y30LB31*/
*   /* UPON EXIT.                                            @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1694
*   RESPECIFY                                                      1694
*     REG14 RSTD;                   /*                       @ZDR2054*/
*   RETADDR2=REG14;                 /*                       @Y30LB31*/
         ST    REG14,RETADDR2                                      1695
*   RESPECIFY                                                      1696
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   OLDERID2=NEWERID2;                                             1697
         L     @15,@PC00001                                        1697
         L     @15,GDTTR2(,@15)                                    1697
         MVC   @TS00001(95),NEWERID2(@15)                          1697
         MVC   OLDERID2(95,@15),@TS00001                           1697
*   NEWID2='AVCL';                  /*                       @Y30LB31*/
*                                                                  1698
         MVC   NEWID2(4,@15),@CC01913                              1698
*   /*****************************************************************/
*   /*                                                               */
*   /* ZERO OUT THE CONDITION CODE SET BY THIS PROC.         @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1699
*   CLABLRC=LASTCC00;               /*                       @Y30LB31*/
*                                                                  1699
         SLR   @15,@15                                             1699
         STH   @15,CLABLRC                                         1699
*   /*****************************************************************/
*   /*                                                               */
*   /* A BASE VOLUME MUST BE DEMOUNTED TO UPDATE THE CART    @Y30LB31*/
*   /* LABELS UNLESS THE SECURITY CHECK WAS BYPASSED. WHENEVER       */
*   /*                                                       @Y30LB31*/
*   /* THE ORIGINAL VOL SERIAL NO. IS BEING RESTORED DUE TO A        */
*   /*                                                       @Y30LB31*/
*   /* PREVIOUS RENAME FAILURE, THE SECURITY CHECK IS BYPASSED.      */
*   /*                                                       @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1700
*   IF BCDBASE=ON&BRECOVSW=OFF THEN /*                       @Y30LB31*/
         TM    BCDBASE(BCDVPTR),B'00100000'                        1700
         BNO   @RF01700                                            1700
         TM    BRECOVSW,B'00000001'                                1700
         BNZ   @RF01700                                            1700
*     DO;                           /*                       @Y30LB31*/
*       RENAMTYP=ACTIVE;            /*                       @Y30LB31*/
         MVC   RENAMTYP(8),@CC01666                                1702
*       MOUNTFLG=OFF;               /* DEMOUNT REQUEST       @Y30LB31*/
*       WAITFLG=ON;                 /*                       @Y30LB31*/
         OI    WAITFLG,B'00100000'                                 1704
         NI    MOUNTFLG,B'10111111'                                1704
*       VPREPVOL=MSVIVOL#;          /*                       @Y30LB31*/
         MVC   VPREPVOL(6),MSVIVOL#                                1705
*       CALL VPREPRTN;              /*                       @Y30LB31*/
         BAL   @14,VPREPRTN                                        1706
*       RESPECIFY                                                  1707
*         RTNREG RSTD;                                             1707
*       TESTRC=RTNREG;                                             1708
         LR    TESTRC,RTNREG                                       1708
*       RESPECIFY                                                  1709
*         RTNREG UNRSTD;            /*                       @Y30LB31*/
*                                                                  1709
*       /*************************************************************/
*       /*                                                           */
*       /* EXIT FROM THIS PROC IF THE DEMOUNT FAILED.        @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1710
*       IF TESTRC^=0 THEN           /*                       @Y30LB31*/
         LTR   TESTRC,TESTRC                                       1710
         BZ    @RF01710                                            1710
*         CLABLRC=4;                /*                       @Y30LB31*/
         MVC   CLABLRC(2),@CH00043                                 1711
*     END;                          /*                       @Y30LB31*/
*                                                                  1712
*   /*****************************************************************/
*   /*                                                               */
*   /* INDICATE THE CART LABELS OF AN INACTIVE VOL ARE TO    @Y30LB31*/
*   /* BE UPDATED IF THE VOL IS A DUPLICATE OR BASE VOL THAT @Y30LB31*/
*   /* IS BEING RESTORED.                                    @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1713
*   ELSE                            /*                       @Y30LB31*/
*     RENAMTYP=INACTIVE;            /*                       @Y30LB31*/
         B     @RC01700                                            1713
@RF01700 MVC   RENAMTYP(8),@CC01668                                1713
*                                                                  1714
*   /*****************************************************************/
*   /*                                                               */
*   /* CALL RENAMRTN TO UPDATE THE CART LABELS WITH THE      @Y30LB31*/
*   /* NEW VOL SERIAL NO. AND OPTIONAL NEW VOL ATTRIBUTES.   @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1714
*   IF CLABLRC=0 THEN               /*                       @Y30LB31*/
@RC01700 LH    @15,CLABLRC                                         1714
         LTR   @15,@15                                             1714
         BNZ   @RF01714                                            1714
*     DO;                           /*                       @Y30LB31*/
*       MSGFLG=OFF;                 /* DO NOT SAVE RENAME MSG      1716
*                                                            @Y30LB31*/
         NI    MSGFLG,B'11101111'                                  1716
*       CALL RENAMRTN;              /*                       @Y30LB31*/
         BAL   @14,RENAMRTN                                        1717
*       RESPECIFY                                                  1718
*         RTNREG RSTD;                                             1718
*       TESTRC=RTNREG;                                             1719
         LR    TESTRC,RTNREG                                       1719
*       RESPECIFY                                                  1720
*         RTNREG UNRSTD;            /*                       @Y30LB31*/
*                                                                  1720
*       /*************************************************************/
*       /*                                                           */
*       /* IF THE CART LABEL UPDATE FAILED EXIT FROM THIS    @Y30LB31*/
*       /* PROC. ALSO, IF THE VOL ATTRIBUTES WERE TO BE UPDATED FOR  */
*       /*                                                   @Y30LB31*/
*       /* AN ACTIVE BASE VOL, ISSUE THE APPROPRIATE ERROR MSG.      */
*       /*                                                   @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1721
*       IF TESTRC^=0 THEN           /*                       @Y30LB31*/
         LTR   TESTRC,TESTRC                                       1721
         BZ    @RF01721                                            1721
*         DO;                       /*                       @Y30LB31*/
*           CLABLRC=4;              /*                       @Y30LB31*/
         MVC   CLABLRC(2),@CH00043                                 1723
*           IF NEWVFFLG=ON&BCDBASE=ON&/*                     @Y30LB31*/
*               BRECOVSW=OFF THEN   /*                       @Y30LB31*/
         TM    NEWVFFLG,B'00001000'                                1724
         BNO   @RF01724                                            1724
         TM    BCDBASE(BCDVPTR),B'00100000'                        1724
         BNO   @RF01724                                            1724
         TM    BRECOVSW,B'00000001'                                1724
         BNZ   @RF01724                                            1724
*             DO;                   /*                       @Y30LB31*/
*               PRINTTBL=''B;       /*                       @Y30LB31*/
*                                                                  1726
         XC    PRINTTBL(28),PRINTTBL                               1726
*               /*****************************************************/
*               /*                                                   */
*               /* THE VOL ATTRIBUTES WERE BEING IMPLICITLY UPDATED  */
*               /* TO AGREE WITH THE GROUP, BUT COULD NOT BE SET     */
*               /*                                           @Y30LB31*/
*               /* DUE TO AN ERROR.                          @Y30LB31*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  1727
*               IF GRPMSFLG=ON THEN /*                       @Y30LB31*/
         TM    GRPMSFLG,B'00000010'                                1727
         BNO   @RF01727                                            1727
*                 DO;               /*                       @Y30LB31*/
*                   DARGSMOD=COMMSGS;/*                      @Y30LB31*/
         L     @15,DDSTRU                                          1729
         MVC   DARGSMOD(3,@15),@CC01697                            1729
*                   DARGSENT=MSG2093I;/* STID=CM054          @Y30LB31*/
         MVI   DARGSENT(@15),X'36'                                 1730
*                   DARGDBP=ADDR(BASGROUP);/*                @Y30LB31*/
         LA    @14,BASGROUP(,BASEVPTR)                             1731
         ST    @14,DARGDBP(,@15)                                   1731
*                   DARGILP=LENGTH(BASGROUP);/*              @Y30LB31*/
         MVC   DARGILP(2,@15),@CH00182                             1732
*                 END;              /*                       @Y30LB31*/
*                                                                  1733
*               /*****************************************************/
*               /*                                                   */
*               /* THE READWRITE ATTRIBUTE WAS REQUESTED     @Y30LB31*/
*               /* BUT COULD NOT BE SET.                     @Y30LB31*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  1734
*               ELSE                /*                       @Y30LB31*/
*                 DO;               /*                       @Y30LB31*/
         B     @RC01727                                            1734
@RF01727 DS    0H                                                  1735
*                   DARGSMOD=ADDVMSGS;/*                     @Y30LB31*/
         L     @15,DDSTRU                                          1735
         MVC   DARGSMOD(3,@15),@CC01687                            1735
*                   DARGSENT=MSG2091B;/* STID=AV04           @Y30LB31*/
         MVI   DARGSENT(@15),X'04'                                 1736
*                   DARGDBP=ADDR(MSVIVOL#);/*                @Y30LB31*/
         LA    @14,MSVIVOL#                                        1737
         ST    @14,DARGDBP(,@15)                                   1737
*                   DARGILP=LENGTH(MSVIVOL#);/*              @Y30LB31*/
         MVC   DARGILP(2,@15),@CH00159                             1738
*                 END;              /*                       @Y30LB31*/
*               CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*      @Y30LB31*/
@RC01727 L     @15,@PC00001                                        1740
         ST    @15,@AL00001                                        1740
         LA    @14,@CF00117                                        1740
         ST    @14,@AL00001+4                                      1740
         LA    @14,DDSTRU                                          1740
         ST    @14,@AL00001+8                                      1740
         MVI   @AL00001+8,X'80'                                    1740
         L     @15,GDTPRT(,@15)                                    1740
         LA    @01,@AL00001                                        1740
         BALR  @14,@15                                             1740
*             END;                  /*                       @Y30LB31*/
*                                                                  1741
*           /*********************************************************/
*           /*                                                       */
*           /* CLOSE DO GROUP WHICH PROCESSED UNSUCCESSFUL   @Y30LB31*/
*           /* CART LABEL UPDATE.                            @Y30LB31*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1742
*         END;                      /*                       @Y30LB31*/
*                                                                  1742
*       /*************************************************************/
*       /*                                                           */
*       /* ISSUE INFORMATIVE MESSAGES FOR A SUCCESSFUL       @Y30LB31*/
*       /* CART LABEL UPDATE WITH THE NEW VOL SERIAL NO. AND OPTIONAL*/
*       /* NEW VOL ATTRIBUTES. THEN ACTIVATE THE VOLUME FOR THE      */
*       /*                                                   @Y30LB31*/
*       /* SUBSEQUENT VOL LABEL UPDATE.                      @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1743
*       ELSE                        /*                       @Y30LB31*/
*         DO;                       /*                       @Y30LB31*/
         B     @RC01721                                            1743
@RF01721 DS    0H                                                  1744
*           PRINTTBL=''B;           /*                       @Y30LB31*/
         XC    PRINTTBL(28),PRINTTBL                               1744
*           DARGSMOD=COMMSGS;       /*                       @Y30LB31*/
         L     @15,DDSTRU                                          1745
         MVC   DARGSMOD(3,@15),@CC01697                            1745
*           DARGSENT=MSG0064I;      /* STID=CM046            @Y30LB31*/
         MVI   DARGSENT(@15),X'2E'                                 1746
*           CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*          @Y30LB31*/
*                                                                  1747
         L     @15,@PC00001                                        1747
         ST    @15,@AL00001                                        1747
         LA    @14,@CF00117                                        1747
         ST    @14,@AL00001+4                                      1747
         LA    @14,DDSTRU                                          1747
         ST    @14,@AL00001+8                                      1747
         MVI   @AL00001+8,X'80'                                    1747
         L     @15,GDTPRT(,@15)                                    1747
         LA    @01,@AL00001                                        1747
         BALR  @14,@15                                             1747
*           /*********************************************************/
*           /*                                                       */
*           /* ISSUE THE APPROPRIATE MSG IF THE VOL          @Y30LB31*/
*           /* ATTRIBUTES WERE ALSO UPDATED.                 @Y30LB31*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1748
*           IF NEWVFFLG=ON&ONLYROSW=OFF/*                    @Y30LB31*/
*             THEN                  /*                       @Y30LB31*/
         TM    NEWVFFLG,B'00001000'                                1748
         BNO   @RF01748                                            1748
         TM    ONLYROSW,B'10000000'                                1748
         BNZ   @RF01748                                            1748
*             DO;                   /*                       @Y30LB31*/
*                                                                  1749
*               /*****************************************************/
*               /*                                                   */
*               /* ISSUE MSG IDC0073I IF THE VOL             @Y30LB31*/
*               /* ATTRIBUTES WERE IMPLICITLY CHANGED TO AGREE WITH  */
*               /* THE                                       @Y30LB31*/
*               /* GROUP. ALSO, THE GROUP-MSG-SWITCH IS TURNED OFF TO*/
*               /* AVOID                                     @Y30LB31*/
*               /* ISSUING THE SAME MESSAGE AGAIN IF READONLY MUST BE*/
*               /* SET                                       @Y30LB31*/
*               /* FOLLOWING THE VOL LABEL UPDATE.           @Y30LB31*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  1750
*               IF GRPMSFLG=ON THEN /*                       @Y30LB31*/
         TM    GRPMSFLG,B'00000010'                                1750
         BNO   @RF01750                                            1750
*                 DO;               /*                       @Y30LB31*/
*                   GRPMSFLG=OFF;   /*                       @Y30LB31*/
         NI    GRPMSFLG,B'11111101'                                1752
*                   DARGSMOD=COMMSGS;/*                      @Y30LB31*/
         L     @15,DDSTRU                                          1753
         MVC   DARGSMOD(3,@15),@CC01697                            1753
*                   DARGSENT=MSG0073I;/* STID=CM033          @Y30LB31*/
         MVI   DARGSENT(@15),X'21'                                 1754
*                   DARGDBP=ADDR(BASGROUP);/*                @Y30LB31*/
         LA    @14,BASGROUP(,BASEVPTR)                             1755
         ST    @14,DARGDBP(,@15)                                   1755
*                   DARGILP=LENGTH(BASGROUP);/*              @Y30LB31*/
         MVC   DARGILP(2,@15),@CH00182                             1756
*                 END;              /*                       @Y30LB31*/
*                                                                  1757
*               /*****************************************************/
*               /*                                                   */
*               /* ISSUE MSG IDC0725I THAT THE REQUESTED     @Y30LB31*/
*               /* READWRITE ATTRIBUTE WAS SUCCESSFULLY SET. @Y30LB31*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  1758
*               ELSE                /*                       @Y30LB31*/
*                 DO;               /*                       @Y30LB31*/
         B     @RC01750                                            1758
@RF01750 DS    0H                                                  1759
*                   DARGSMOD=ADDVMSGS;/*                     @Y30LB31*/
         L     @15,DDSTRU                                          1759
         MVC   DARGSMOD(3,@15),@CC01687                            1759
*                   DARGSENT=MSG0725I;/* STID=AV06           @Y30LB31*/
         MVI   DARGSENT(@15),X'06'                                 1760
*                   DARGDBP=ADDR(MSVIVOL#);/*                @Y30LB31*/
         LA    @14,MSVIVOL#                                        1761
         ST    @14,DARGDBP(,@15)                                   1761
*                   DARGILP=LENGTH(MSVIVOL#);/*              @Y30LB31*/
         MVC   DARGILP(2,@15),@CH00159                             1762
*                 END;              /*                       @Y30LB31*/
*               CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*      @Y30LB31*/
@RC01750 L     @15,@PC00001                                        1764
         ST    @15,@AL00001                                        1764
         LA    @14,@CF00117                                        1764
         ST    @14,@AL00001+4                                      1764
         LA    @14,DDSTRU                                          1764
         ST    @14,@AL00001+8                                      1764
         MVI   @AL00001+8,X'80'                                    1764
         L     @15,GDTPRT(,@15)                                    1764
         LA    @01,@AL00001                                        1764
         BALR  @14,@15                                             1764
*             END;                  /*                       @Y30LB31*/
*                                                                  1765
*           /*********************************************************/
*           /*                                                       */
*           /* ACTIVATE THE VOLUME FOLLOWING THE MSC         @Y30LB31*/
*           /* RENAME OPERATION THAT UPDATED THE CART LABELS.        */
*           /*                                               @Y30LB31*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1766
*           MSGFLG=OFF;             /* DO NOT SAVE ACTIVATE MSG    1766
*                                                            @Y30LB31*/
@RF01748 NI    MSGFLG,B'11101111'                                  1766
*           CALL ACTVRTN;           /*                       @Y30LB31*/
         BAL   @14,ACTVRTN                                         1767
*           RESPECIFY                                              1768
*             RTNREG RSTD;                                         1768
*           TESTRC=RTNREG;                                         1769
         LR    TESTRC,RTNREG                                       1769
*           RESPECIFY                                              1770
*             RTNREG UNRSTD;        /*                       @Y30LB31*/
*                                                                  1770
*           /*********************************************************/
*           /*                                                       */
*           /* IF THE ACTIVATE FAILED, SET THE CONDITION     @Y30LB31*/
*           /* CODE TO INDICATE ONLY CART LABEL UPDATE WAS           */
*           /* SUCCESSFUL.                                   @Y30LB31*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1771
*           IF TESTRC^=0 THEN       /*                       @Y30LB31*/
         LTR   TESTRC,TESTRC                                       1771
         BZ    @RF01771                                            1771
*             CLABLRC=LASTCC08;     /*                       @Y30LB31*/
*                                                                  1772
         MVC   CLABLRC(2),@CH00182                                 1772
*           /*********************************************************/
*           /*                                                       */
*           /* CLOSE DO GROUP WHICH PROCESSED THE SUCCESSFUL @Y30LB31*/
*           /* CART LABEL UPDATE FOLLOWED BY A VOLUME ACTIVATE.      */
*           /*                                               @Y30LB31*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1773
*         END;                      /*                       @Y30LB31*/
*                                                                  1773
@RF01771 DS    0H                                                  1774
*       /*************************************************************/
*       /*                                                           */
*       /* CLOSE DO GROUP WHICH DIRECTED THE CART LABEL UPDATE       */
*       /*                                                   @Y30LB31*/
*       /* AND ACTIVATE.                                     @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1774
*     END;                          /*                       @Y30LB31*/
*                                                                  1774
@RC01721 DS    0H                                                  1775
*   /*****************************************************************/
*   /*                                                               */
*   /* RESTORE REG14 WITH THE RETURN ADDRESS OF THE CALLER   @Y30LB31*/
*   /* AND EXIT FROM CLABLRTN. PASS THE CONDITION CODE IN REG 15     */
*   /*                                                       @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1775
*   RESPECIFY                                                      1775
*     REG14 RSTD;                   /*                       @ZDR2054*/
@RF01714 DS    0H                                                  1776
*   REG14=RETADDR2;                 /*                       @Y30LB31*/
         L     REG14,RETADDR2                                      1776
*   RESPECIFY                                                      1777
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   RETURN CODE(CLABLRC);           /*                       @Y30LB31*/
         LH    @15,CLABLRC                                         1778
@EL00017 DS    0H                                                  1778
@EF00017 DS    0H                                                  1778
@ER00017 BR    @14                                                 1778
*   END CLABLRTN;                   /*                       @Y30LB31*/
*                                                                  1780
*/********************************************************** @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* PROCEDURE NAME - VLABLRTN                                @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* FUNCTION - DIRECTS THE VOLUME LABEL UPDATE FOR THE NEW   @Y30LB31*/
*/*            VOL SER NO., CLEARING OF THE SERIAL MISMATCH  @Y30LB31*/
*/*            FLAG FROM THE MSVI, AND IF REQUIRED, A VOLUME @Y30LB31*/
*/*            DEMOUNT AND READONLY ATTR UPDATE.  CALLS      @Y30LB31*/
*/*            VPREPRTN, VS2RTN, MVRRTN, AND NEWFRTN TO      @Y30LB31*/
*/*            PERFORM THESE FUNCTIONS.  MESSAGES IDC3070I,  @Y30LB31*/
*/*            IDC0086I, IDC2093I, AND IDC2091I ARE ISSUED   @Y30LB31*/
*/*            IN THIS PROC.                                 @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* INPUT - ADDVTBL, PRINTTBL FOR MSGS, BASEV AND            @Y30LB31*/
*/*         BCDV FOR VOLUME RECORD                           @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* OUTPUT - A RETURN CODE OF 0 INDICATES VOL LABEL UPDATED  @Y30LB31*/
*/*          WITH NEW VOL SER NO.AND READONLY ATTR SET IF    @Y30LB31*/
*/*          NECESSARY.                                      @Y30LB31*/
*/*          A RETURN CODE OF 4 INDICATES THAT NEITHER THE   @Y30LB31*/
*/*          VOL LABEL NOR READONLY ATTR WAS UPDATED.        @Y30LB31*/
*/*          A RETURN CODE OF 8 INDICATES THAT THE VOL LABEL @Y30LB31*/
*/*          WAS UPDATED BUT EITHER THE MISMATCH FLAG COULD  @Y30LB31*/
*/*          NOT BE CLEARED FROM THE MSVI OR READONLY COULD  @Y30LB31*/
*/*          NOT BE SET.                                     @Y30LB31*/
*/*                                                          @Y30LB31*/
*/********************************************************** @Y30LB31*/
*                                                                  1780
*VLABLRTN:                                                         1780
*   PROCEDURE OPTIONS(NOSAVEAREA,NOSAVE);/*                  @Y30LB31*/
*                                                                  1780
VLABLRTN DS    0H                                                  1781
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL CONDITION CODE.                                 @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1781
*   DCL                                                            1781
*     VLABLRC FIXED(15);            /*                       @Y30LB31*/
*                                                                  1781
*   /*****************************************************************/
*   /*                                                               */
*   /* SAVE CALLERS RETURN ADDRESS AND RESTORE IT UPON EXIT  @Y30LB31*/
*   /* FOR THIS PROC. INITIALIZE TO ZERO THE CONDITION CODE USED BY  */
*   /* THIS PROC.                                            @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1782
*   RESPECIFY                                                      1782
*     REG14 RSTD;                   /*                       @ZDR2054*/
*   RETADDR2=REG14;                 /*                       #Y30LB31*/
         ST    REG14,RETADDR2                                      1783
*   RESPECIFY                                                      1784
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   OLDERID2=NEWERID2;                                             1785
         L     @04,@PC00001                                        1785
         L     @04,GDTTR2(,@04)                                    1785
         MVC   @TS00001(95),NEWERID2(@04)                          1785
         MVC   OLDERID2(95,@04),@TS00001                           1785
*   NEWID2='AVVL';                  /*                       @Y30LB31*/
         MVC   NEWID2(4,@04),@CC01918                              1786
*   VLABLRC=LASTCC00;               /*                       @Y30LB31*/
*                                                                  1787
         SLR   VLABLRC,VLABLRC                                     1787
*   /*****************************************************************/
*   /*                                                               */
*   /* A SPECIAL VOLUME MOUNT IS REQUIRED DUE TO THE EXISTING VOL SER*/
*   /* MISMATCH UNLESS THE VOL BEING RELABELED IS A          @Y30LB31*/
*   /* DUPLICATE THAT IS STILL MOUNTED FROM THE EARLIER VSAM @Y30LB31*/
*   /* CHECK OUT.                                            @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1788
*   IF BCDDUP=ON THEN                                              1788
         TM    BCDDUP(BCDVPTR),B'00000100'                         1788
         BO    @RT01788                                            1788
*     ;                             /* NO SPECIAL MOUNT      @Y30LB31*/
*   ELSE                            /*                       @Y30LB31*/
*     DO;                           /*                       @Y30LB31*/
*       MOUNTFLG=ON;                /*                       @Y30LB31*/
*       WAITFLG=OFF;                /*                       @Y30LB31*/
         OI    MOUNTFLG,B'01000000'                                1792
         NI    WAITFLG,B'11011111'                                 1792
*       VPREPVOL=MSVIVOL#;          /*                       @Y30LB31*/
         MVC   VPREPVOL(6),MSVIVOL#                                1793
*       CALL VPREPRTN;              /*                       @Y30LB31*/
         BAL   @14,VPREPRTN                                        1794
*       RESPECIFY                                                  1795
*         RTNREG RSTD;                                             1795
*       TESTRC=RTNREG;                                             1796
         LR    TESTRC,RTNREG                                       1796
*       RESPECIFY                                                  1797
*         RTNREG UNRSTD;            /*                       @Y30LB31*/
*                                                                  1797
*       /*************************************************************/
*       /*                                                           */
*       /* IF THE VOLUME CANNOT BE MOUNTED, ISSUE MSG        @Y30LB31*/
*       /* IDC3070I DESCRIBING THE FAILURE TO UPDATE THE VOL SER NO. */
*       /*                                                   @Y30LB31*/
*       /* IN THE VOL LABEL. BEFORE EXITING FROM THIS PROCEDURE,     */
*       /*                                                   @Y30LB31*/
*       /* ISSUE A MSG THAT READONLY COULD NOT BE SET, IR REQUIRED.  */
*       /*                                                   @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1798
*       IF TESTRC^=0 THEN           /*                       @Y30LB31*/
         LTR   TESTRC,TESTRC                                       1798
         BZ    @RF01798                                            1798
*         DO;                       /*                       @Y30LB31*/
*           VLABLRC=4;              /*                       @Y30LB31*/
         LA    VLABLRC,4                                           1800
*           PRINTTBL=''B;           /*                       @Y30LB31*/
         XC    PRINTTBL(28),PRINTTBL                               1801
*           DARGSMOD=COMMSGS;       /*                       @Y30LB31*/
         L     @04,DDSTRU                                          1802
         MVC   DARGSMOD(3,@04),@CC01697                            1802
*           DARGSENT=MSG3070I;      /* STID=CM036            @Y30LB31*/
         MVI   DARGSENT(@04),X'24'                                 1803
*           CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*          @Y30LB31*/
         L     @04,@PC00001                                        1804
         ST    @04,@AL00001                                        1804
         LA    @15,@CF00117                                        1804
         ST    @15,@AL00001+4                                      1804
         LA    @15,DDSTRU                                          1804
         ST    @15,@AL00001+8                                      1804
         MVI   @AL00001+8,X'80'                                    1804
         L     @15,GDTPRT(,@04)                                    1804
         LA    @01,@AL00001                                        1804
         BALR  @14,@15                                             1804
*         END;                      /*                       @Y30LB31*/
*     END;                          /*                       @Y30LB31*/
@RF01798 DS    0H                                                  1807
*                                                                  1807
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THERE ARE NO ERRORS, CALL VS2RTN TO UPDATE THE VOL @Y30LB31*/
*   /* LABEL WITH THE NEW VOL SERIAL NO.                     @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1807
*   IF VLABLRC=0 THEN               /*                       @Y30LB31*/
@RT01788 LTR   VLABLRC,VLABLRC                                     1807
         BNZ   @RF01807                                            1807
*     DO;                           /*                       @Y30LB31*/
*       CALL VS2RTN;                /*                       @Y30LB31*/
         BAL   @14,VS2RTN                                          1809
*       RESPECIFY                                                  1810
*         RTNREG RSTD;                                             1810
*       TESTRC=RTNREG;                                             1811
         LR    TESTRC,RTNREG                                       1811
*       RESPECIFY                                                  1812
*         RTNREG UNRSTD;            /*                       @Y30LB31*/
*                                                                  1812
*       /*************************************************************/
*       /*                                                           */
*       /* IF THE NEW SERIAL NO. COULD NOT BE UPDATED IN THE @Y30LB31*/
*       /* VOL LABEL, PROCEED TO DEQUEUE THE RESERVE SET BY THE VOL  */
*       /*                                                   @Y30LB31*/
*       /* SERVICES ROUTINES AND OUTPUT THE READONLY MSG IF APPRO.   */
*       /*                                                   @Y30LB31*/
*       /* THEN EXIT FROM THIS PROC.                         @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1813
*       IF TESTRC^=0 THEN           /*                       @Y30LB31*/
         LTR   TESTRC,TESTRC                                       1813
         BZ    @RF01813                                            1813
*         VLABLRC=4;                /*                       @Y30LB31*/
*                                                                  1814
         LA    VLABLRC,4                                           1814
*       /*************************************************************/
*       /*                                                           */
*       /* FOR A SUCCESSFUL VOL LABEL UPDATE, ISSUE          @Y30LB31*/
*       /* INFORMATIVE MESSAGE IDC0086I.                     @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1815
*       ELSE                        /*                       @Y30LB31*/
*         DO;                       /*                       @Y30LB31*/
         B     @RC01813                                            1815
@RF01813 DS    0H                                                  1816
*           PRINTTBL=''B;           /*                       @Y30LB31*/
         XC    PRINTTBL(28),PRINTTBL                               1816
*           DARGSMOD=COMMSGS;       /*                       @Y30LB31*/
         L     @06,DDSTRU                                          1817
         MVC   DARGSMOD(3,@06),@CC01697                            1817
*           DARGSENT=MSG0086I;      /* STID=CM020            @Y30LB31*/
         MVI   DARGSENT(@06),X'14'                                 1818
*           CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*          @Y30LB31*/
*                                                                  1819
         L     @06,@PC00001                                        1819
         ST    @06,@AL00001                                        1819
         LA    @04,@CF00117                                        1819
         ST    @04,@AL00001+4                                      1819
         LA    @04,DDSTRU                                          1819
         ST    @04,@AL00001+8                                      1819
         MVI   @AL00001+8,X'80'                                    1819
         L     @15,GDTPRT(,@06)                                    1819
         LA    @01,@AL00001                                        1819
         BALR  @14,@15                                             1819
*           /*********************************************************/
*           /*                                                       */
*           /* FOLLOWING A SUCCESSFUL VOL LABEL UPDATE CLEAR @Y30LB31*/
*           /* THE SERIAL MISMATCH FLAG FROM THE MSVI IF READONLY    */
*           /* DOES NOT HAVE TO BE SET.                      @Y30LB31*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1820
*           IF NEWROFLG=OFF THEN    /*                       @Y30LB31*/
         TM    NEWROFLG,B'00000001'                                1820
         BNZ   @RF01820                                            1820
*             DO;                   /*                       @Y30LB31*/
*               CALL MVRRTN;        /*                       @Y30LB31*/
         BAL   @14,MVRRTN                                          1822
*               RESPECIFY                                          1823
*                 RTNREG RSTD;                                     1823
*               TESTRC=RTNREG;                                     1824
         LR    TESTRC,RTNREG                                       1824
*               RESPECIFY                                          1825
*                 RTNREG UNRSTD;    /*                       @Y30LB31*/
*                                                                  1825
*               /*****************************************************/
*               /*                                                   */
*               /* IF THE MISMATCH FLAG COULD NOT BE CLEARED SET THE */
*               /* CONDITION CODE TO 8 BECAUSE THE VOL HAS BEEN      */
*               /*                                           @Y30LB31*/
*               /* ACTIVATED.                                @Y30LB31*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  1826
*               IF TESTRC^=0 THEN   /*                       @Y30LB31*/
         LTR   TESTRC,TESTRC                                       1826
         BZ    @RF01826                                            1826
*                 VLABLRC=LASTCC08; /*                       @Y30LB31*/
         LA    VLABLRC,8                                           1827
*             END;                  /*                       @Y30LB31*/
@RF01826 DS    0H                                                  1829
*         END;                      /*                       @Y30LB31*/
*                                                                  1829
@RF01820 DS    0H                                                  1830
*       /*************************************************************/
*       /*                                                           */
*       /* IF READONLY DOES NOT HAVE TO BE SET OR ERRORS     @Y30LB31*/
*       /* HAVE BEEN ENCOUNTERED, RELEASE THE RESERVE SET BY ONE OF  */
*       /*                                                   @Y30LB31*/
*       /* THE VOLUME SERVICES ROUTINES. THEN OUTPUT THE READONLY-NOT*/
*       /*                                                   @Y30LB31*/
*       /* -SET MSG BEFORE EXITING FROM THIS PROC.           @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1830
*       IF NEWROFLG=OFF×VLABLRC^=0 THEN/*                    @Y30LB31*/
@RC01813 TM    NEWROFLG,B'00000001'                                1830
         BZ    @RT01830                                            1830
         LTR   VLABLRC,VLABLRC                                     1830
         BZ    @RF01830                                            1830
@RT01830 DS    0H                                                  1831
*         DO;                       /*                       @Y30LB31*/
*           RNMSERNO=MSVIVOL#;      /*                       @Y30LB31*/
         MVC   RNMSERNO(6),MSVIVOL#                                1832
*           RNMTRAIL=RESERVE;       /*                       @ZA05119*/
         MVC   RNMTRAIL(16),RESERVE                                1833
*           CALL IDCSADQ0(GDTTBL,MAJORNM,MINORNM);/*         @Y30LB31*/
         L     @06,@PC00001                                        1834
         ST    @06,@AL00001                                        1834
         LA    @04,@CC01635                                        1834
         ST    @04,@AL00001+4                                      1834
         LA    @04,MINORNM                                         1834
         ST    @04,@AL00001+8                                      1834
         MVI   @AL00001+8,X'80'                                    1834
         L     @15,GDTDEQ(,@06)                                    1834
         LA    @01,@AL00001                                        1834
         BALR  @14,@15                                             1834
*         END;                      /*                       @Y30LB31*/
*                                                                  1835
*       /*************************************************************/
*       /*                                                           */
*       /* IF READONLY IS TO BE SET AND NO ERRORS HAVE BEEN  @Y30LB31*/
*       /* ENCOUNTERED, DEMOUNT THE VOL IN ORDER TO UPDATE THE VOLUME*/
*       /* ATTRIBUTES TO READONLY.                           @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1836
*       ELSE                        /*                       @Y30LB31*/
*         DO;                       /*                       @Y30LB31*/
         B     @RC01830                                            1836
@RF01830 DS    0H                                                  1837
*           MOUNTFLG=OFF;           /*                       @Y30LB31*/
*           WAITFLG=ON;             /*                       @Y30LB31*/
         OI    WAITFLG,B'00100000'                                 1838
         NI    MOUNTFLG,B'10111111'                                1838
*           VPREPVOL=MSVIVOL#;      /*                       @Y30LB31*/
         MVC   VPREPVOL(6),MSVIVOL#                                1839
*           CALL VPREPRTN;          /*                       @Y30LB31*/
         BAL   @14,VPREPRTN                                        1840
*           RESPECIFY                                              1841
*             RTNREG RSTD;                                         1841
*           TESTRC=RTNREG;                                         1842
         LR    TESTRC,RTNREG                                       1842
*           RESPECIFY                                              1843
*             RTNREG UNRSTD;        /*                       @Y30LB31*/
*                                                                  1843
*           /*********************************************************/
*           /*                                                       */
*           /* IF THE VOL DEMOUNT FAILED, THE VOL ATTRIBUTES CANNOT  */
*           /* BE UPDATED. PROCEED TO OUTPUT THE APPROPRIATE ERROR SG*/
*           /* AND TO CLEAR THE SERIAL MISMATCH FLAG FROM THE MSVI.  */
*           /*                                               @Y30LB31*/
*           /*                                                       */
*           /*********************************************************/
*                                                                  1844
*           IF TESTRC^=0 THEN       /*                       @Y30LB31*/
         LTR   TESTRC,TESTRC                                       1844
         BZ    @RF01844                                            1844
*             VLABLRC=LASTCC08;     /*                       @Y30LB31*/
         LA    VLABLRC,8                                           1845
*         END;                      /*                       @Y30LB31*/
*                                                                  1846
@RF01844 DS    0H                                                  1847
*       /*************************************************************/
*       /*                                                           */
*       /* CLOSE DO GROUP THAT HANDLED THE VOL LABEL UPDATE, @Y30LB31*/
*       /* DEQUEUE, AND DEMOUNT.                             @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1847
*     END;                          /*                       @Y30LB31*/
@RC01830 DS    0H                                                  1848
*                                                                  1848
*   /*****************************************************************/
*   /*                                                               */
*   /* DETERMINE WHETHER THE VOL ATTRIBUTES ARE TO BE UPDATED TO     */
*   /* READONLY FOLLOWING THE VOL LABEL UPDATE.              @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1848
*   IF NEWROFLG=ON THEN             /*                       @Y30LB31*/
@RF01807 TM    NEWROFLG,B'00000001'                                1848
         BNO   @RF01848                                            1848
*     DO;                           /*                       @Y30LB31*/
*                                                                  1849
*       /*************************************************************/
*       /*                                                           */
*       /* IF ERRORS HAVE BEEN ENCOUNTERED, BYPASS SETTTING READONLY.*/
*       /* PRINT MSG IDC2093I IF THE VOL ATTRS ARE BEING     @Y30LB31*/
*       /* IMPLICITLY CHANGED TO AGREE WITH THE GROUP. IF THIS MSG   */
*       /*                                                   @Y30LB31*/
*       /* HAS BEEN ISSUED EARLIER, PRINT MSG IDC2091I INSTEAD SINCE */
*       /*                                                   @Y30LB31*/
*       /* READONLY IS THE ONLY ATTR NOT IMPLICITLY CHANGED. @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1850
*       IF VLABLRC^=0 THEN          /*                       @Y30LB31*/
         LTR   VLABLRC,VLABLRC                                     1850
         BZ    @RF01850                                            1850
*         DO;                       /*                       @Y30LB31*/
*           PRINTTBL=''B;           /*                       @Y30LB31*/
         XC    PRINTTBL(28),PRINTTBL                               1852
*           DARGSMOD=COMMSGS;       /*                       @Y30LB31*/
         L     @06,DDSTRU                                          1853
         MVC   DARGSMOD(3,@06),@CC01697                            1853
*           IF GRPMSFLG=ON THEN     /*                       @Y30LB31*/
         TM    GRPMSFLG,B'00000010'                                1854
         BNO   @RF01854                                            1854
*             DO;                   /*                       @Y30LB31*/
*               DARGSENT=MSG2093I;  /* STID=CM054            @Y30LB31*/
         MVI   DARGSENT(@06),X'36'                                 1856
*               DARGDBP=ADDR(BASGROUP);/*                    @Y30LB31*/
         LA    @04,BASGROUP(,BASEVPTR)                             1857
         ST    @04,DARGDBP(,@06)                                   1857
*               DARGILP=LENGTH(BASGROUP);/*                  @Y30LB31*/
         MVC   DARGILP(2,@06),@CH00182                             1858
*             END;                  /*                       @Y30LB31*/
*           ELSE                    /*                       @Y30LB31*/
*             DO;                   /*                       @Y30LB31*/
         B     @RC01854                                            1860
@RF01854 DS    0H                                                  1861
*               DARGSENT=MSG2091A;  /* STID=CM015            @Y30LB31*/
         L     @04,DDSTRU                                          1861
         MVI   DARGSENT(@04),X'0F'                                 1861
*               DARGDBP=ADDR(MSVIVOL#);/*                    @Y30LB31*/
         LA    @15,MSVIVOL#                                        1862
         ST    @15,DARGDBP(,@04)                                   1862
*               DARGILP=LENGTH(MSVIVOL#);/*                  @Y30LB31*/
         MVC   DARGILP(2,@04),@CH00159                             1863
*             END;                  /*                       @Y30LB31*/
*           CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*          @Y30LB31*/
@RC01854 L     @04,@PC00001                                        1865
         ST    @04,@AL00001                                        1865
         LA    @15,@CF00117                                        1865
         ST    @15,@AL00001+4                                      1865
         LA    @15,DDSTRU                                          1865
         ST    @15,@AL00001+8                                      1865
         MVI   @AL00001+8,X'80'                                    1865
         L     @15,GDTPRT(,@04)                                    1865
         LA    @01,@AL00001                                        1865
         BALR  @14,@15                                             1865
*         END;                      /*                       @Y30LB31*/
*                                                                  1866
*       /*************************************************************/
*       /*                                                           */
*       /* SINCE NO ERRORS HAVE BEEN ENCOUNTERED, CALL NEWVFRTN TO   */
*       /* SET THE READONLY VOL ATTR TO AGREE WITH THE GROUP AND TO  */
*       /* CLEAR THE MISMATCH FLAG FROM THE VOL RECORD IN CONJUNCTION*/
*       /* WITH THE ATTR UPDATE.                             @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1867
*       ELSE                        /*                       @Y30LB31*/
*         DO;                       /*                       @Y30LB31*/
         B     @RC01850                                            1867
@RF01850 DS    0H                                                  1868
*           CALL NEWVFRTN;          /*                       @Y30LB31*/
         BAL   @14,NEWVFRTN                                        1868
*           RESPECIFY                                              1869
*             RTNREG RSTD;                                         1869
*           TESTRC=RTNREG;                                         1870
         LR    TESTRC,RTNREG                                       1870
*           RESPECIFY                                              1871
*             RTNREG UNRSTD;        /*                       @Y30LB31*/
*           IF TESTRC^=0 THEN       /*                       @Y30LB31*/
         LTR   TESTRC,TESTRC                                       1872
         BZ    @RF01872                                            1872
*             VLABLRC=LASTCC08;     /*                       @Y30LB31*/
         LA    VLABLRC,8                                           1873
*         END;                      /*                       @Y30LB31*/
*                                                                  1874
@RF01872 DS    0H                                                  1875
*       /*************************************************************/
*       /*                                                           */
*       /* IF READONLY COULD NOT BE SET BUT THE NEW VOL SER NO. HAS  */
*       /* BEEN SUCCESSFULLY UPDATED IN THE VOL LABEL, THE   @Y30LB31*/
*       /* SERIAL MISMATCH FLAG CAN BE CLEARED FROM THE MSVI.        */
*       /*                                                   @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1875
*       IF VLABLRC>LASTCC04 THEN    /*                       @Y30LB31*/
@RC01850 C     VLABLRC,@CF00043                                    1875
         BNH   @RF01875                                            1875
*         DO;                       /*                       @Y30LB31*/
*           CALL MVRRTN;            /*                       @Y30LB31*/
         BAL   @14,MVRRTN                                          1877
*           RESPECIFY                                              1878
*             RTNREG RSTD;                                         1878
*           TESTRC=RTNREG;                                         1879
         LR    TESTRC,RTNREG                                       1879
*           RESPECIFY                                              1880
*             RTNREG UNRSTD;        /*                       @Y30LB31*/
*           IF TESTRC^=0 THEN       /*                       @Y30LB31*/
         LTR   TESTRC,TESTRC                                       1881
         BZ    @RF01881                                            1881
*             VLABLRC=LASTCC08;     /*                       @Y30LB31*/
         LA    VLABLRC,8                                           1882
*         END;                      /*                       @Y30LB31*/
*                                                                  1883
@RF01881 DS    0H                                                  1884
*       /*************************************************************/
*       /*                                                           */
*       /* CLOSE THE DO GROUP WHICH PROCESSED THE READONLY   @Y30LB31*/
*       /* UPDATE REQUEST.                                   @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1884
*     END;                          /*                       @Y30LB31*/
*                                                                  1884
@RF01875 DS    0H                                                  1885
*   /*****************************************************************/
*   /*                                                               */
*   /* RESTORE REG 14 TO THE RETURN ADDRESS OF THE CALLER    @Y30LB31*/
*   /* AND EXIT FROM VLABLRTN. PASS THE CONDITION CODE IN REG 15.    */
*   /*                                                       @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1885
*   RESPECIFY                                                      1885
*     REG14 RSTD;                   /*                       @ZDR2054*/
@RF01848 DS    0H                                                  1886
*   REG14=RETADDR2;                 /*                       @Y30LB31*/
         L     REG14,RETADDR2                                      1886
*   RESPECIFY                                                      1887
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   RETURN CODE(VLABLRC);           /*                       @Y30LB31*/
         LR    @15,VLABLRC                                         1888
@EL00018 DS    0H                                                  1888
@EF00018 DS    0H                                                  1888
@ER00018 BR    @14                                                 1888
*   END VLABLRTN;                   /*                       @Y30LB31*/
*                                                                  1890
*/********************************************************** @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* PROCEDURE NAME - VS2RTN                                  @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* FUNCTION - UPDATES THE VOLUME LABEL WITH THE NEW VOLUME  @Y30LB31*/
*/*            SERIAL NO.  NO MESSAGES ARE ISSUED BY THIS    @Y30LB31*/
*/*            PROC.                                         @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* INPUT - ADDVTBL, BCDV FOR VOLUME RECORD, AND             @Y30LB31*/
*/*         VS2AGL.                                          @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* OUTPUT - A RETURN CODE OF 0 INDICATES A SUCCESSFUL VOL   @Y30LB31*/
*/*          LABEL UPDATE.  ADDVTBL MAY BE UPDATED.          @Y30LB31*/
*/*          A RETURN CODE OF 4 INDICATES THE VOL LABEL      @Y30LB31*/
*/*          UPDATE FAILED.                                  @Y30LB31*/
*/*                                                          @Y30LB31*/
*/********************************************************** @Y30LB31*/
*                                                                  1890
*VS2RTN:                                                           1890
*   PROCEDURE OPTIONS(NOSAVEAREA,NOSAVE);/*                  @Y30LB31*/
*                                                                  1890
VS2RTN   DS    0H                                                  1891
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL CONDITION CODE.                                 @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1891
*   DCL                                                            1891
*     VS2RTNRC FIXED(15);           /*                       @Y30LB31*/
*                                                                  1891
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL DECLARATIONS. SETUP STORAGE AREA TO BUILD THE PARM LIST */
*   /* FOR THE SECOND VOLUME SERVICES ROUTINE WHICH          @Y30LB31*/
*   /* READS AND UPDATES VOL LABELS.                         @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1892
*   DCL                                                            1892
*     AVVS2AGL CHAR(LENGTH(VS2AGL)) BDY(WORD);/*             @Y30LB31*/
*   DCL                                                            1893
*     IDCVS02 CHAR(8) CONSTANT('IDCVS02 ');/*                @Y30LB31*/
*                                                                  1893
*   /*****************************************************************/
*   /*                                                               */
*   /* SAVE THE CALLERS RETURN ADDRESS AND RESTORE IT UPON   @Y30LB31*/
*   /* EXIT FROM THIS PROC. INITIALIZE TO ZERO THE CONDITION CODE    */
*   /* USED BY THIS PROC.                                    @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1894
*   RESPECIFY                                                      1894
*     REG14 RSTD;                   /*                       @ZDR2054*/
*   RETADDR3=REG14;                 /*                       @Y30LB31*/
         ST    REG14,RETADDR3                                      1895
*   RESPECIFY                                                      1896
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   OLDERID2=NEWERID2;                                             1897
         L     @15,@PC00001                                        1897
         L     @15,GDTTR2(,@15)                                    1897
         MVC   @TS00001(95),NEWERID2(@15)                          1897
         MVC   OLDERID2(95,@15),@TS00001                           1897
*   NEWID2='AVS2';                  /*                       @Y30LB31*/
         MVC   NEWID2(4,@15),@CC01928                              1898
*   VS2RTNRC=LASTCC00;              /*                       @Y30LB31*/
*                                                                  1899
         SLR   VS2RTNRC,VS2RTNRC                                   1899
*   /*****************************************************************/
*   /*                                                               */
*   /* INITIALIZE THE VS2 PARM LIST TO SET THE NEW VOLUME    @Y30LB31*/
*   /* SERIAL NO. IN THE VOL LABEL.                          @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1900
*   RESPECIFY                                                      1900
*     VS2AGL BASED(ADDR(AVVS2AGL)); /*                       @Y30LB31*/
*   VS2AGL=''B;                     /*                       @Y30LB31*/
         LA    @15,AVVS2AGL                                        1901
         XC    VS2AGL(52,@15),VS2AGL(@15)                          1901
*   VSVOLUME=MSVIVOL#;              /*                       @Y30LB31*/
         MVC   VSVOLUME(6,@15),MSVIVOL#                            1902
*   VSVOLPTR=ADDR(MSVIVOL#);        /* NEW VOL SERIAL NO.    @Y30LB31*/
         LA    @14,MSVIVOL#                                        1903
         ST    @14,VSVOLPTR(,@15)                                  1903
*   VSVOLSER=ON;                    /* UPDATE VOL SER FLAG   @Y30LB31*/
         OI    VSVOLSER(@15),B'01000000'                           1904
*   VSDDNAME=AUNITDDN;              /*                       @Y30LB31*/
*                                                                  1905
         MVC   VSDDNAME(8,@15),AUNITDDN                            1905
*   /*****************************************************************/
*   /*                                                               */
*   /* REQUEST A RESERVE BE SET DURING THE VOL LABEL UPDATE UNLESS A */
*   /* PREVIOUS RESERVE SET BY THE VTOC VOL SERVICES         @Y30LB31*/
*   /* ROUTINE IS STILL IN EFFECT FOR A DUPLICATE VOL.       @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1906
*   IF BCDBASE=ON×BCDCOPY=ON THEN   /*                       @Y30LB31*/
         TM    BCDBASE(BCDVPTR),B'00110000'                        1906
         BZ    @RF01906                                            1906
*     DO;                           /*                       @Y30LB31*/
*       VS2RES=ON;                  /*                       @Y30LB31*/
         OI    VS2RES(@15),B'10000000'                             1908
*       VSUCBPTR=ADDR(AUNITUCB);    /*                       @Y30LB31*/
         LA    @06,AUNITUCB                                        1909
         ST    @06,VSUCBPTR(,@15)                                  1909
*     END;                          /*                       @Y30LB31*/
*                                                                  1910
*   /*****************************************************************/
*   /*                                                               */
*   /* TAKE A SYMBOLIC DUMP OF THE VS2 PARM LIST BEFORE      @Y30LB31*/
*   /* INVOKING THE VOLUME SERVICES ROUTINE THAT UPDATES THE VOL     */
*   /*                                                       @Y30LB31*/
*   /* LABEL.                                                @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1911
*   IF GDTDBG=NULLPTR THEN                                         1911
@RF01906 L     @06,@PC00001                                        1911
         L     @06,GDTDBG(,@06)                                    1911
         LTR   @06,@06                                             1911
         BZ    @RT01911                                            1911
*     ;                                                            1912
*   ELSE                                                           1913
*     DO;                                                          1913
*       DMPINDEX=ADDR(AVDMPLST);    /*                       @Y30LB31*/
         LA    DMPINDEX,AVDMPLST                                   1914
*       DMPITMNM='AVVS2AGL';                                       1915
         MVC   DMPITMNM(8,DMPINDEX),@CC01931                       1915
*       DMPITMPT=ADDR(AVVS2AGL);                                   1916
         LA    @06,AVVS2AGL                                        1916
         ST    @06,DMPITMPT(,DMPINDEX)                             1916
*       DMPITMLN=LENGTH(AVVS2AGL);                                 1917
         MVC   DMPITMLN(2,DMPINDEX),@CH02003                       1917
*       DMPITMTP='H';                                              1918
         MVI   DMPITMTP(DMPINDEX),C'H'                             1918
*       DMPINDEX=DMPINDEX+DMPELEMT;                                1919
*                                                                  1919
         LA    @06,16                                              1919
         ALR   DMPINDEX,@06                                        1919
*       /*************************************************************/
*       /*                                                           */
*       /*                                                   @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1920
*       DMPITMNM='ADDVTBL';                                        1920
         MVI   DMPITMNM+7(DMPINDEX),C' '                           1920
         MVC   DMPITMNM(7,DMPINDEX),@CC01766                       1920
*       DMPITMPT=ADDR(ADDVTBL);                                    1921
         LA    @03,ADDVTBL                                         1921
         ST    @03,DMPITMPT(,DMPINDEX)                             1921
*       DMPITMLN=LENGTH(ADDVTBL);                                  1922
         MVC   DMPITMLN(2,DMPINDEX),@CH01999                       1922
*       DMPITMTP='H';                                              1923
         MVI   DMPITMTP(DMPINDEX),C'H'                             1923
*       DMPINDEX=DMPINDEX+DMPELEMT; /*                       @Y30LB31*/
         ALR   DMPINDEX,@06                                        1924
*       DMPTRM=DMPTRMVL;                                           1925
         MVI   DMPTRM(DMPINDEX),X'FF'                              1925
*     END;                          /*                       @Y30LB31*/
*   IF GDTDBG=NULLPTR THEN                                         1927
@RT01911 L     @06,@PC00001                                        1927
         L     @06,GDTDBG(,@06)                                    1927
         LTR   @06,@06                                             1927
         BZ    @RT01927                                            1927
*     ;                                                            1928
*   ELSE                                                           1929
*     CALL IDCDB010(GDTTBL,'AVNS',ADDR(AVDMPLST));/*         @Y30LB31*/
*                                                                  1929
         L     @06,@PC00001                                        1929
         ST    @06,@AL00001                                        1929
         LA    @15,@CC01932                                        1929
         ST    @15,@AL00001+4                                      1929
         LA    @15,AVDMPLST                                        1929
         ST    @15,@AFTEMPS+32                                     1929
         LA    @15,@AFTEMPS+32                                     1929
         ST    @15,@AL00001+8                                      1929
         MVI   @AL00001+8,X'80'                                    1929
         L     @15,GDTDBG(,@06)                                    1929
         LA    @01,@AL00001                                        1929
         BALR  @14,@15                                             1929
*   /*****************************************************************/
*   /*                                                               */
*   /* INVOKE THE SECOND VOLUME SERVICES ROUTINE TO PERFORM THE VOL  */
*   /* LABEL UPDATE FOR THE NEW VOL SER NO.                  @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1930
*   CALL IDCSACL0(GDTTBL,IDCVS02,PUTLABEL,VS2AGL);/*         @Y30LB31*/
@RT01927 L     @06,@PC00001                                        1930
         ST    @06,@AL00001                                        1930
         LA    @02,@CC01927                                        1930
         ST    @02,@AL00001+4                                      1930
         LA    @02,PUTLABEL                                        1930
         ST    @02,@AL00001+8                                      1930
         LA    @02,AVVS2AGL                                        1930
         ST    @02,@AL00001+12                                     1930
         MVI   @AL00001+12,X'80'                                   1930
         L     @15,GDTCAL(,@06)                                    1930
         LA    @01,@AL00001                                        1930
         BALR  @14,@15                                             1930
*   RESPECIFY                                                      1931
*     RTNREG RSTD;                                                 1931
*   TESTRC=RTNREG;                                                 1932
         LR    TESTRC,RTNREG                                       1932
*   RESPECIFY                                                      1933
*     RTNREG UNRSTD;                /*                       @Y30LB31*/
*                                                                  1934
*   /*****************************************************************/
*   /*                                                               */
*   /* TEST THE RETURN CODE FROM THE REQUEST TO UPDATE THE   @Y30LB31*/
*   /* VOL LABEL. IF THE UPDATE WAS SUCCESSFUL BUT THE VTOC COULD NOT*/
*   /* BE CLOSED BY THE VOL SERV ROUTINE, TREAT THIS AS A    @Y30LB31*/
*   /* MINOR ERROR REQUIRING AN EOJ FINAL CONDITION CODE OF AT       */
*   /*                                                       @Y30LB31*/
*   /* LEAST 4.                                              @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1934
*   IF TESTRC=8 THEN                /*                       @Y30LB31*/
         C     TESTRC,@CF00182                                     1934
         BNE   @RF01934                                            1934
*     CC04FLG=ON;                   /*                       @Y30LB31*/
*                                                                  1935
         OI    CC04FLG,B'10000000'                                 1935
*   /*****************************************************************/
*   /*                                                               */
*   /* EXIT WITH AN UNSUCCESSFUL CONDITION CODE IF THE VOL   @Y30LB31*/
*   /* UPDATE FAILED.                                        @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1936
*   ELSE                            /*                       @Y30LB31*/
*     IF TESTRC=4 THEN              /*                       @Y30LB31*/
         B     @RC01934                                            1936
@RF01934 LA    @06,4                                               1936
         CR    TESTRC,@06                                          1936
         BNE   @RF01936                                            1936
*       VS2RTNRC=4;                 /*                       @Y30LB31*/
*                                                                  1937
         LR    VS2RTNRC,@06                                        1937
*   /*****************************************************************/
*   /*                                                               */
*   /* RESTORE REG 14 WITH THE CALLERS RETURN ADDRESS AND    @Y30LB31*/
*   /* EXIT FROM THIS PROC. PASS THE CONDITION CODE TO THE CALLER IN */
*   /* REG 15.                                               @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1938
*   RESPECIFY                                                      1938
*     REG14 RSTD;                   /*                       @ZDR2054*/
@RF01936 DS    0H                                                  1938
@RC01934 DS    0H                                                  1939
*   REG14=RETADDR3;                 /*                       @Y30LB31*/
         L     REG14,RETADDR3                                      1939
*   RESPECIFY                                                      1940
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   RETURN CODE(VS2RTNRC);          /*                       @Y30LB31*/
         LR    @15,VS2RTNRC                                        1941
@EL00019 DS    0H                                                  1941
@EF00019 DS    0H                                                  1941
@ER00019 BR    @14                                                 1941
*   END VS2RTN;                     /*                       @Y30LB31*/
*                                                                  1943
*/********************************************************** @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* PROCEDURE NAME - MVRRTN                                  @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* FUNCTION - CLEARS THE VOLUME SERIAL MISMATCH FLAG FROM   @Y30LB31*/
*/*            THE VOL RECORD IN THE MSVI.  CALLS SSCMSG TO  @Y30LB31*/
*/*            OUTPUT A MSSC REASON CODE MESSAGE IF THE      @Y30LB31*/
*/*            UPDATE FAILS.  ALSO ISSUES A SECONDARY ERROR  @Y30LB31*/
*/*            MSG IDC2065I.                                 @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* INPUT - ADDVTBL, PRINTTBL FOR MESSAGES                   @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* OUTPUT - A RETURN CODE OF 0 INDICATES THE MISMATCH FLAG  @Y30LB31*/
*/*          WAS CLEARED.  ADDVTBL MAY BE UPDATED.           @Y30LB31*/
*/*          A RETURN CODE OF 4 INDICATES THE MISMATCH FLAG  @Y30LB31*/
*/*          WAS NOT CLEARED.                                @Y30LB31*/
*/*                                                          @Y30LB31*/
*/********************************************************** @Y30LB31*/
*                                                                  1943
*MVRRTN:                                                           1943
*   PROCEDURE OPTIONS(NOSAVEAREA,NOSAVE);/*                  @Y30LB31*/
*                                                                  1943
MVRRTN   DS    0H                                                  1944
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL CONDITION CODE.                                 @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1944
*   DCL                                                            1944
*     MVRRTNRC FIXED(15);           /*                       @Y30LB31*/
*                                                                  1944
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL DECLARATIONS. SETUP A STORAGE AREA TO BUILD     @Y30LB31*/
*   /* THE MSVC MODIFY-VOL-RECORD PARM LIST.                 @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1945
*   DCL                                                            1945
*     1 AV01MVR BDY(WORD),          /*                       @Y30LB31*/
*      2 AVMVRHDR CHAR(8),          /* MVR ARG LIST ID       @Y30LB31*/
*      2 AVMVRTBL CHAR(LENGTH(MVR));/*                       @Y30LB31*/
*                                                                  1945
*   /*****************************************************************/
*   /*                                                               */
*   /* SAVE THE CALLERS RETURN ADDRESS AND RESTORE UPON EXIT FROM    */
*   /* THIS PROC. INITIALIZE TO ZERO THE CONDITION CODE USED BY THIS */
*   /* PROC.                                                 @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1946
*   RESPECIFY                                                      1946
*     REG14 RSTD;                   /*                       @ZDR2054*/
*   RETADDR3=REG14;                 /*                       @Y30LB31*/
         ST    REG14,RETADDR3                                      1947
*   RESPECIFY                                                      1948
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   OLDERID2=NEWERID2;                                             1949
         L     @06,@PC00001                                        1949
         L     @15,GDTTR2(,@06)                                    1949
         MVC   @TS00001(95),NEWERID2(@15)                          1949
         MVC   OLDERID2(95,@15),@TS00001                           1949
*   NEWID2='AVMV';                  /*                       @Y30LB31*/
         MVC   NEWID2(4,@15),@CC01940                              1950
*   MVRRTNRC=LASTCC00;              /*                       @Y30LB31*/
*                                                                  1951
         SLR   @15,@15                                             1951
         LR    MVRRTNRC,@15                                        1951
*   /*****************************************************************/
*   /*                                                               */
*   /* INITIALIZE THE MVR PARM LIST TO CLEAR THE SERIAL      @Y30LB31*/
*   /* MISMATCH RECOVERY FLAG FROM THE MSVI.                 @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1952
*   AVMVRHDR='MVR';                 /*                       @Y30LB31*/
         MVI   AVMVRHDR+3,C' '                                     1952
         MVC   AVMVRHDR+4(4),AVMVRHDR+3                            1952
         MVC   AVMVRHDR(3),@CC01941                                1952
*   AVMVRTBL=''B;                   /*                       @Y30LB31*/
         XC    AVMVRTBL(88),AVMVRTBL                               1953
*   MVRPTR=ADDR(AVMVRTBL);          /*                       @Y30LB31*/
         LA    @14,AVMVRTBL                                        1954
         ST    @14,MVRPTR                                          1954
*   MVRLNGTH=MVRLEN;                /*                       @Y30LB31*/
         LH    @03,MVRLEN                                          1955
         ST    @03,MVRLNGTH(,@14)                                  1955
*   MVRCODE=MVROP;                  /*                       @Y30LB31*/
         XC    MVRCODE+1(3,@14),MVRCODE+1(@14)                     1956
         MVI   MVRCODE(@14),X'85'                                  1956
*   MVRCLMIS=ON;                    /*                       @Y30LB31*/
         OI    MVRCLMIS(@14),B'00000001'                           1957
*   MVRBVOL=MSVIVOL#;               /*                       @Y30LB31*/
         MVC   MVRBVOL(6,@14),MSVIVOL#                             1958
*   MVRFLBAS=ON;                    /*                       @Y30LB31*/
         OI    MVRFLBAS(@14),B'00100000'                           1959
*   MVRLABEL=BLANKIT;               /*                       @Y30LB31*/
         MVI   MVRLABEL+1(@14),C' '                                1960
         MVC   MVRLABEL+2(4,@14),MVRLABEL+1(@14)                   1960
         MVI   MVRLABEL(@14),C' '                                  1960
*   MVRFLLAB=ON;                    /*                       @Y30LB31*/
*                                                                  1961
         OI    MVRFLLAB(@14),B'00000001'                           1961
*   /*****************************************************************/
*   /*                                                               */
*   /* TAKE A SYMBOLIC DUMP OF THE MODIFY-VOL-REC PARM LIST  @Y30LB31*/
*   /* BEFORE INVOKING MSVC TO CLEAR THE MISMATCH FLAG FROM THE      */
*   /*                                                       @Y30LB31*/
*   /* VOL RECORD.                                           @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1962
*   IF GDTDBG=NULLPTR THEN                                         1962
         C     @15,GDTDBG(,@06)                                    1962
         BE    @RT01962                                            1962
*     ;                                                            1963
*   ELSE                                                           1964
*     DO;                                                          1964
*       DMPINDEX=ADDR(AVDMPLST);    /*                       @Y30LB31*/
         LA    DMPINDEX,AVDMPLST                                   1965
*       DMPITMNM='AV01MVR';                                        1966
         MVI   DMPITMNM+7(DMPINDEX),C' '                           1966
         MVC   DMPITMNM(7,DMPINDEX),@CC01942                       1966
*       DMPITMPT=ADDR(AV01MVR);                                    1967
         LA    @06,AV01MVR                                         1967
         ST    @06,DMPITMPT(,DMPINDEX)                             1967
*       DMPITMLN=LENGTH(AV01MVR);                                  1968
         MVC   DMPITMLN(2,DMPINDEX),@CH02004                       1968
*       DMPITMTP='H';                                              1969
         MVI   DMPITMTP(DMPINDEX),C'H'                             1969
*       DMPINDEX=DMPINDEX+DMPELEMT; /*                       @Y30LB31*/
         LA    @06,16                                              1970
         ALR   DMPINDEX,@06                                        1970
*       DMPITMNM='ADDVTBL';                                        1971
         MVI   DMPITMNM+7(DMPINDEX),C' '                           1971
         MVC   DMPITMNM(7,DMPINDEX),@CC01766                       1971
*       DMPITMPT=ADDR(ADDVTBL);                                    1972
         LA    @03,ADDVTBL                                         1972
         ST    @03,DMPITMPT(,DMPINDEX)                             1972
*       DMPITMLN=LENGTH(ADDVTBL);                                  1973
         MVC   DMPITMLN(2,DMPINDEX),@CH01999                       1973
*       DMPITMTP='H';                                              1974
         MVI   DMPITMTP(DMPINDEX),C'H'                             1974
*       DMPINDEX=DMPINDEX+DMPELEMT; /*                       @Y30LB31*/
         ALR   DMPINDEX,@06                                        1975
*       DMPTRM=DMPTRMVL;                                           1976
         MVI   DMPTRM(DMPINDEX),X'FF'                              1976
*     END;                          /*                       @Y30LB31*/
*   IF GDTDBG=NULLPTR THEN                                         1978
@RT01962 L     @06,@PC00001                                        1978
         L     @06,GDTDBG(,@06)                                    1978
         LTR   @06,@06                                             1978
         BZ    @RT01978                                            1978
*     ;                                                            1979
*   ELSE                                                           1980
*     CALL IDCDB010(GDTTBL,'AVSM',ADDR(AVDMPLST));/*         @Y30LB31*/
*                                                                  1980
         L     @06,@PC00001                                        1980
         ST    @06,@AL00001                                        1980
         LA    @15,@CC01943                                        1980
         ST    @15,@AL00001+4                                      1980
         LA    @15,AVDMPLST                                        1980
         ST    @15,@AFTEMPS+36                                     1980
         LA    @15,@AFTEMPS+36                                     1980
         ST    @15,@AL00001+8                                      1980
         MVI   @AL00001+8,X'80'                                    1980
         L     @15,GDTDBG(,@06)                                    1980
         LA    @01,@AL00001                                        1980
         BALR  @14,@15                                             1980
*   /*****************************************************************/
*   /*                                                               */
*   /* INVOKE MSVC TO CLEAR THE SERIAL MISMATCH FLAG FROM    @Y30LB31*/
*   /* THE INVENTORY RECORD.                                 @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1981
*   CALL IDCSASS0(GDTTBL,VVIC,MVRPTR,REASON);/*              @Y30LB31*/
@RT01978 L     @06,@PC00001                                        1981
         ST    @06,@AL00001                                        1981
         LA    @02,VVIC                                            1981
         ST    @02,@AL00001+4                                      1981
         LA    @02,MVRPTR                                          1981
         ST    @02,@AL00001+8                                      1981
         LA    @02,REASON                                          1981
         ST    @02,@AL00001+12                                     1981
         MVI   @AL00001+12,X'80'                                   1981
         L     @15,GDTSSC(,@06)                                    1981
         LA    @01,@AL00001                                        1981
         BALR  @14,@15                                             1981
*   RESPECIFY                                                      1982
*     RTNREG RSTD;                                                 1982
*   TESTRC=RTNREG;                                                 1983
         LR    TESTRC,RTNREG                                       1983
*   RESPECIFY                                                      1984
*     RTNREG UNRSTD;                /*                       @Y30LB31*/
*                                                                  1984
*   /*****************************************************************/
*   /*                                                               */
*   /* IF MSVC ENCOUNTERED AN I/O ERROR UPDATING THE INVEN- TORY,    */
*   /* TREAT THIS AS A MINOR ERROR REQUIRING AN EOJ FINAL    @Y30LB31*/
*   /* CONDITION CODE OF AT LEAST 4.                         @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1985
*   IF TESTRC=12 THEN               /*                       @Y30BL31*/
         C     TESTRC,@CF00606                                     1985
         BNE   @RF01985                                            1985
*     DO;                           /*                       @Y30LB31*/
*       TESTRC=LASTCC00;            /*                       @Y30LB31*/
         SLR   TESTRC,TESTRC                                       1987
*       CC04FLG=ON;                 /*                       @Y30LB31*/
         OI    CC04FLG,B'10000000'                                 1988
*     END;                          /*                       @Y30LB31*/
*                                                                  1990
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THE MISMATCH FLAG COULD NOT BE CLEARED FROM THE    @Y30LB31*/
*   /* VOLUME RECORD, ISSUE THE APPROPRIATE MESSAGE CONTAINING THE   */
*   /* MSSC REASON CODE. ISSUE A SECONDARY ERR MSG IDC2065I  @Y30LB31*/
*   /* RELATING THAT THE MISMATCH FLAG COULD NOT BE CLEARED. @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1990
*   IF TESTRC^=0 THEN               /*                       @Y30LB31*/
@RF01985 LTR   TESTRC,TESTRC                                       1990
         BZ    @RF01990                                            1990
*     DO;                           /*                       @Y30LB31*/
*       MVRRTNRC=4;                 /*                       @Y30LB31*/
         LA    MVRRTNRC,4                                          1992
*       CALL SSCMSG(REASON);        /*                       @Y30LB31*/
*                                                                  1993
         LA    @06,REASON                                          1993
         ST    @06,@AL00001                                        1993
         LA    @01,@AL00001                                        1993
         BAL   @14,SSCMSG                                          1993
*       /*************************************************************/
*       /*                                                           */
*       /* OUTPUT SECONDARY ERROR MSG IDC2065I.              @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  1994
*       PRINTTBL=''B;               /*                       @Y30LB31*/
         XC    PRINTTBL(28),PRINTTBL                               1994
*       DARGSMOD=COMMSGS;           /*                       @Y30LB31*/
         L     @06,DDSTRU                                          1995
         MVC   DARGSMOD(3,@06),@CC01697                            1995
*       DARGSENT=MSG2065I;          /* STID=CM045            @Y30LB31*/
         MVI   DARGSENT(@06),X'2D'                                 1996
*       CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*              @Y30LB31*/
         L     @06,@PC00001                                        1997
         ST    @06,@AL00001                                        1997
         LA    @15,@CF00117                                        1997
         ST    @15,@AL00001+4                                      1997
         LA    @15,DDSTRU                                          1997
         ST    @15,@AL00001+8                                      1997
         MVI   @AL00001+8,X'80'                                    1997
         L     @15,GDTPRT(,@06)                                    1997
         LA    @01,@AL00001                                        1997
         BALR  @14,@15                                             1997
*     END;                          /*                       @Y30LB31*/
*                                                                  1998
*   /*****************************************************************/
*   /*                                                               */
*   /* RESTORE REG 14 WITH CALLERS RETURN ADDRESS AND EXIT   @Y30LB31*/
*   /* FROM MVRRTN. PASS THE CONDITION CODE IN REG 15.       @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  1999
*   RESPECIFY                                                      1999
*     REG14 RSTD;                   /*                       @ZDR2054*/
@RF01990 DS    0H                                                  2000
*   REG14=RETADDR3;                 /*                       @Y30LB31*/
         L     REG14,RETADDR3                                      2000
*   RESPECIFY                                                      2001
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   RETURN CODE(MVRRTNRC);          /*                       @Y30LB31*/
         LR    @15,MVRRTNRC                                        2002
@EL00020 DS    0H                                                  2002
@EF00020 DS    0H                                                  2002
@ER00020 BR    @14                                                 2002
*   END MVRRTN;                     /*                       @Y30LB31*/
*                                                                  2004
*/********************************************************** @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* PROCEDURE NAME - DUPVRTN                                 @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* FUNCTION - DIRECTS THE ACTIVATE, VOLUME ATTRIBUTE        @Y30LB31*/
*/*            UPDATE, AND NEW SERIAL NO. UPDATE FOR A       @Y30LB31*/
*/*            COPY OR DUPLICATE VOLUME.  CALLS CLABLRTN     @Y30LB31*/
*/*            TO UPDATE THE CARTRIDGE LABELS.  CALLS        @Y30LB31*/
*/*            SECCKRTN TO CHECK VSAM STATUS OF A DUPLICATE  @Y30LB31*/
*/*            VOLUME.  CALLS BKOUTRTN IF THE DUPLICATE      @Y30LB31*/
*/*            VOL IS OWNED BY VSAM.  CALLS VLABLRTN TO      @Y30LB31*/
*/*            UPDATE THE VOLUME LABEL.  ISSUES MESSAGES,    @Y30LB31*/
*/*            IDC3070I, IDC0722I.                           @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* INPUT - ADDVTBL, PRINTTBL FOR MESSAGES, VS1AGL,          @Y30LB31*/
*/*         BCDV FORMAT FOR VOLUME RECORD                   @Y30LB31 */
*/*                                                          @Y30LB31*/
*/* OUTPUT - RETURN CODE OF 0 INDICATES VOLUME               @Y30LB31*/
*/*          SUCCESSFULLY ACTIVATED WITH NEW VOLUME          @Y30LB31*/
*/*          SERIAL NO.  RETURN CODE OF 8 INDICATES          @Y30LB31*/
*/*          VOLUME ACTIVATED WITH ERRORS.  RETURN CODE      @Y30LB31*/
*/*          OF 12 INDICATES 1)THE CARTRIDGE LABELS COULD    @Y30LB31*/
*/*          NOT BE UPDATED, OR 2)FOLLOWING THE CART LABEL   @Y30LB31*/
*/*          UPDATE THE ACTIVATE FAILED, OR 3)A DUPLICATE    @Y30LB31*/
*/*          VOL IS OWNED BY VSAM.                           @Y30LB31*/
*/*                                                          @Y30LB31*/
*/********************************************************** @Y30LB31*/
*                                                                  2004
*DUPVRTN:                                                          2004
*   PROCEDURE OPTIONS(NOSAVEAREA,NOSAVE);/*                  @Y30LB31*/
*                                                                  2004
DUPVRTN  DS    0H                                                  2005
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL CONDITION CODE.                                 @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2005
*   DCL                                                            2005
*     DUPVRC FIXED(15);             /*                       @Y30LB31*/
*                                                                  2005
*   /*****************************************************************/
*   /*                                                               */
*   /* SAVE THE CALLERS RETURN ADDRESS AND RESTORE IT UPON   @Y30LB31*/
*   /* EXIT.                                                 @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2006
*   RESPECIFY                                                      2006
*     REG14 RSTD;                   /*                       @ZDR2054*/
*   RETADDR1=REG14;                 /*                       @Y30LB31*/
         ST    REG14,RETADDR1                                      2007
*   RESPECIFY                                                      2008
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   OLDERID2=NEWERID2;                                             2009
         L     @15,@PC00001                                        2009
         L     @15,GDTTR2(,@15)                                    2009
         MVC   @TS00001(95),NEWERID2(@15)                          2009
         MVC   OLDERID2(95,@15),@TS00001                           2009
*   NEWID2='AVDU';                  /*                       @Y30LB31*/
*                                                                  2010
         MVC   NEWID2(4,@15),@CC01948                              2010
*   /*****************************************************************/
*   /*                                                               */
*   /* ZERO OUT THE CONDITION CODE SET BY THIS PROC.         @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2011
*   DUPVRC=LASTCC00;                /*                       @Y30LB31*/
*                                                                  2011
         SLR   @15,@15                                             2011
         STH   @15,DUPVRC                                          2011
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THE VOLUME IS READONLY, SET READWRITE WHEN         @Y30LB31*/
*   /* SETTING THE NEW VOL SERIAL NO. IN THE CARTRIDGE LABELS.       */
*   /*                                                       @Y30LB31*/
*   /* THIS ALLOWS THE NEW VOL SERIAL NO. TO BE WRITTEN IN THE       */
*   /*                                                       @Y30LB31*/
*   /* LABEL OF THE VOLUME. THE OTHER VOL ATTRIBUTES ARE NOT @Y30LB31*/
*   /* CHANGED. THE DEFAULT VALUES FOR THE NEW VOL ATTRIBUTES        */
*   /*                                                       @Y30LB31*/
*   /* HAVE BEEN INITIALIZED TO OFF BY THE MAIN PROC IDCAV01.        */
*   /*                                                       @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2012
*   IF OLDROFLG=ON THEN             /*                       @Y30LB31*/
         TM    OLDROFLG,B'00010000'                                2012
         BNO   @RF02012                                            2012
*     DO;                           /*                       @Y30LB31*/
*       NEWVFFLG=ON;                /* UPDATE VOL ATTRIBUTES @Y30LB31*/
         OI    NEWVFFLG,B'00001000'                                2014
*       NEWROFLG=OFF;               /* SET READWRITE         @Y30LB31*/
         NI    NEWROFLG,B'11111110'                                2015
*       IF OLDBIFLG=ON THEN         /*                       @Y30LB31*/
         TM    OLDBIFLG,B'10000000'                                2016
         BNO   @RF02016                                            2016
*         NEWBIFLG=ON;              /*                       @Y30LB31*/
         OI    NEWBIFLG,B'00001000'                                2017
*       IF OLDDEFLG=ON THEN         /*                       @Y30LB31*/
@RF02016 TM    OLDDEFLG,B'01000000'                                2018
         BNO   @RF02018                                            2018
*         NEWDEFLG=ON;              /*                       @Y30LB31*/
         OI    NEWDEFLG,B'00000100'                                2019
*       IF OLDEXFLG=ON THEN         /*                       @Y30LB31*/
@RF02018 TM    OLDEXFLG,B'00100000'                                2020
         BNO   @RF02020                                            2020
*         NEWEXFLG=ON;              /*                       @Y30LB31*/
         OI    NEWEXFLG,B'00000010'                                2021
*     END;                          /*                       @Y30LB31*/
@RF02020 DS    0H                                                  2023
*                                                                  2023
*   /*****************************************************************/
*   /*                                                               */
*   /* CALL CLABLRTN TO DIRECT THE CARTRIDGE UPDATE AND      @Y30LB31*/
*   /* ACTIVATE OF THE COPY OR DUPLICATE VOLUME. THE NEW VOL @Y30LB31*/
*   /* SERIAL NO. WILL BE SET IN THE CARTRIDGE LABELS, MSC   @Y30LB31*/
*   /* TABLES, AND MSVI.                                     @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2023
*   CALL CLABLRTN;                  /*                       @Y30LB31*/
@RF02012 BAL   @14,CLABLRTN                                        2023
*   RESPECIFY                                                      2024
*     RTNREG RSTD;                                                 2024
*   TESTRC=RTNREG;                                                 2025
         LR    TESTRC,RTNREG                                       2025
*   RESPECIFY                                                      2026
*     RTNREG UNRSTD;                /*                       @Y30LB31*/
*                                                                  2026
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THE MSC RENAME OR ACTIVATE FAILED, EXIT FROM THIS PROC.    */
*   /*                                                       @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2027
*   IF TESTRC^=0 THEN               /*                       @Y30LB31*/
         LTR   TESTRC,TESTRC                                       2027
         BZ    @RF02027                                            2027
*     DUPVRC=LASTCC12;              /*                       @Y30LB31*/
*                                                                  2028
         MVC   DUPVRC(2),@CH00606                                  2028
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THE VOL IS A DUPLICATE, DETERMINE WHETHER IT IS    @Y30LB31*/
*   /* OWNED BY VSAM. SINCE VSAM STATUS IS NOT MAINTAINED IN THE     */
*   /* MSVI, THIS CHECK IS NOT MADE UNTIL THE VOL IS         @Y30LB31*/
*   /* ACTIVATED AND CAN BE MOUNTED FOR THE CHECK.           @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2029
*   ELSE                            /*                       @Y30LB31*/
*     IF BCDDUP=ON THEN             /*                       @Y30LB31*/
         B     @RC02027                                            2029
@RF02027 TM    BCDDUP(BCDVPTR),B'00000100'                         2029
         BNO   @RF02029                                            2029
*       DO;                         /*                       @Y30LB31*/
*         CALL SECCKRTN;            /*                       @Y30LB31*/
         BAL   @14,SECCKRTN                                        2031
*         RESPECIFY                                                2032
*           RTNREG RSTD;                                           2032
*         TESTRC=RTNREG;                                           2033
         LR    TESTRC,RTNREG                                       2033
*         RESPECIFY                                                2034
*           RTNREG UNRSTD;          /*                       @Y30LB31*/
*                                                                  2034
*         /***********************************************************/
*         /*                                                         */
*         /* IF THE VSAM STATUS COULD NOT BE DETERMINED, NO FURTHER  */
*         /* PROCESSING CAN BE DONE. ISSUE MSG IDC3070I      @Y30LB31*/
*         /* INDICATING THE NEW VOL SERIAL NO. HAS NOT BEEN SET IN   */
*         /* THE                                             @Y30LB31*/
*         /* VOLUME LABEL. THEN EXIT FROM THIS PROCEDURE.    @Y30LB31*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  2035
*         IF TESTRC^=0 THEN         /*                       @Y30LB31*/
         LTR   TESTRC,TESTRC                                       2035
         BZ    @RF02035                                            2035
*           DO;                     /*                       @Y30LB31*/
*             DUPVRC=LASTCC08;      /*                       @Y30LB31*/
         MVC   DUPVRC(2),@CH00182                                  2037
*             PRINTTBL=''B;         /*                       @Y30LB31*/
         XC    PRINTTBL(28),PRINTTBL                               2038
*             DARGSMOD=COMMSGS;     /*                       @Y30LB31*/
         L     @15,DDSTRU                                          2039
         MVC   DARGSMOD(3,@15),@CC01697                            2039
*             DARGSENT=MSG3070I;    /* STID=CM036            @Y30LB31*/
         MVI   DARGSENT(@15),X'24'                                 2040
*             CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*        @Y30LB31*/
         L     @15,@PC00001                                        2041
         ST    @15,@AL00001                                        2041
         LA    @14,@CF00117                                        2041
         ST    @14,@AL00001+4                                      2041
         LA    @14,DDSTRU                                          2041
         ST    @14,@AL00001+8                                      2041
         MVI   @AL00001+8,X'80'                                    2041
         L     @15,GDTPRT(,@15)                                    2041
         LA    @01,@AL00001                                        2041
         BALR  @14,@15                                             2041
*           END;                    /*                       @Y30LB31*/
*                                                                  2042
*         /***********************************************************/
*         /*                                                         */
*         /* IF THE VOLUME IS OWNED BY VSAM, RESTORE THE     @Y30LB31*/
*         /* DUPLICATE VOL TO ITS ORIGINAL STATUS.           @Y30LB31*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  2043
*         ELSE                      /*                       @Y30LB31*/
*           IF VSVSAM=ON THEN       /*                       @Y30LB31*/
         B     @RC02035                                            2043
@RF02035 LA    @15,AVVS1AGL                                        2043
         TM    VSVSAM(@15),B'10000000'                             2043
         BNO   @RF02043                                            2043
*             DO;                   /*                       @Y30LB31*/
*               CALL BKOUTRTN;      /*                       @Y30LB31*/
         BAL   @14,BKOUTRTN                                        2045
*               RESPECIFY                                          2046
*                 RTNREG RSTD;                                     2046
*               TESTRC=RTNREG;                                     2047
         LR    TESTRC,RTNREG                                       2047
*               RESPECIFY                                          2048
*                 RTNREG UNRSTD;    /*                       @Y30LB31*/
*                                                                  2048
*               /*****************************************************/
*               /*                                                   */
*               /* IF THE VOLUME COULD NOT BE RESTORED       @Y30LB31*/
*               /* TO ITS ORIGINAL STATUS, SET THE CONDITION CODE TO */
*               /* INDICATE THE VOLUME HAS BEEN ACTIVATED WITH       */
*               /* ERRORS. THEN EXIT FROM THIS PROC.         @Y30LB31*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  2049
*               IF TESTRC^=0 THEN   /*                       @Y30LB31*/
         LTR   TESTRC,TESTRC                                       2049
         BZ    @RF02049                                            2049
*                 DUPVRC=LASTCC08;  /*                       @Y30LB31*/
*                                                                  2050
         MVC   DUPVRC(2),@CH00182                                  2050
*               /*****************************************************/
*               /*                                                   */
*               /* EXIT FROM THIS PROC FOLLOWING THE         @Y30LB31*/
*               /* SUCCESSFUL RESTORE AND DEACTIVATE.        @Y30LB31*/
*               /*                                                   */
*               /*****************************************************/
*                                                                  2051
*               ELSE                /*                       @Y30LB31*/
*                 DUPVRC=LASTCC12;  /*                       @Y30LB31*/
         B     @RC02049                                            2051
@RF02049 MVC   DUPVRC(2),@CH00606                                  2051
*             END;                  /*                       @Y30LB31*/
*                                                                  2052
@RC02049 DS    0H                                                  2053
*         /***********************************************************/
*         /*                                                         */
*         /* CLOSE DO GROUP WHICH CHECKED VSAM STATUS FOR A  @Y30LB31*/
*         /* DUPLICATE VOLUME.                               @Y30LB31*/
*         /*                                                         */
*         /***********************************************************/
*                                                                  2053
*       END;                        /*                       @Y30LB31*/
@RF02043 DS    0H                                                  2053
@RC02035 DS    0H                                                  2054
*                                                                  2054
*   /*****************************************************************/
*   /*                                                               */
*   /* CALL VLABLRTN TO DIRECT THE SERIAL NO. CHANGE IN THE VOLUME   */
*   /* LABEL AND THE CLEARING OF THE SERIAL MISMATCH         @Y30LB31*/
*   /* FLAG FROM THE MSVI.                                   @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2054
*   IF DUPVRC=0 THEN                /*                       @Y30LB31*/
@RF02029 DS    0H                                                  2054
@RC02027 LH    @15,DUPVRC                                          2054
         LTR   @15,@15                                             2054
         BNZ   @RF02054                                            2054
*     DO;                           /*                       @Y30LB31*/
*       CALL VLABLRTN;              /*                       @Y30LB31*/
         BAL   @14,VLABLRTN                                        2056
*       RESPECIFY                                                  2057
*         RTNREG RSTD;                                             2057
*       TESTRC=RTNREG;                                             2058
         LR    TESTRC,RTNREG                                       2058
*       RESPECIFY                                                  2059
*         RTNREG UNRSTD;            /*                       @Y30LB31*/
*                                                                  2059
*       /*************************************************************/
*       /*                                                           */
*       /* IF THE VOLUME LABEL UPDATE FAILED, SET THE        @Y30LB31*/
*       /* CONDITION CODE TO INDICATE THE VOLUME HAS BEEN ACTIVATED  */
*       /*                                                   @Y30LB31*/
*       /* WITH ERRORS.                                      @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  2060
*       IF TESTRC^=0 THEN           /*                       @Y30LB31*/
         LTR   TESTRC,TESTRC                                       2060
         BZ    @RF02060                                            2060
*         DUPVRC=LASTCC08;          /*                       @Y30LB31*/
         MVC   DUPVRC(2),@CH00182                                  2061
*     END;                          /*                       @Y30LB31*/
*                                                                  2062
@RF02060 DS    0H                                                  2063
*   /*****************************************************************/
*   /*                                                               */
*   /* ISSUE INFORMATIVE MSG, IDC0722I, IF THE               @Y30LB31*/
*   /* CONDITION CODE INDICATES THE VOLUME HAS BEEN ACTIVATED.       */
*   /*                                                       @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2063
*   IF DUPVRC=LASTCC08 THEN         /*                       @Y30LB31*/
@RF02054 CLC   DUPVRC(2),@CH00182                                  2063
         BNE   @RF02063                                            2063
*     DO;                           /*                       @Y30LB31*/
*       PRINTTBL=''B;               /*                       @Y30LB31*/
         XC    PRINTTBL(28),PRINTTBL                               2065
*       DARGSMOD=ADDVMSGS;          /*                       @Y30LB31*/
         L     @15,DDSTRU                                          2066
         MVC   DARGSMOD(3,@15),@CC01687                            2066
*       DARGSENT=MSG0722I;          /*                       @Y30LB31*/
         MVI   DARGSENT(@15),X'03'                                 2067
*       DARGDBP=ADDR(MSVIVOL#);     /*                       @Y30LB31*/
         LA    @14,MSVIVOL#                                        2068
         ST    @14,DARGDBP(,@15)                                   2068
*       DARGILP=LENGTH(MSVIVOL#);   /*                       @Y30LB31*/
         MVC   DARGILP(2,@15),@CH00159                             2069
*       CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*              @Y30LB31*/
         L     @15,@PC00001                                        2070
         ST    @15,@AL00001                                        2070
         LA    @14,@CF00117                                        2070
         ST    @14,@AL00001+4                                      2070
         LA    @14,DDSTRU                                          2070
         ST    @14,@AL00001+8                                      2070
         MVI   @AL00001+8,X'80'                                    2070
         L     @15,GDTPRT(,@15)                                    2070
         LA    @01,@AL00001                                        2070
         BALR  @14,@15                                             2070
*     END;                          /*                       @Y30LB31*/
*                                                                  2071
*   /*****************************************************************/
*   /*                                                               */
*   /* RESTORE REG14 WITH THE RETURN ADDRESS OF THE CALLER   @Y30LB31*/
*   /* AND EXIT FROM DUPVRTN. PASS THE CONDITION CODE IN     @Y30LB31*/
*   /* REG 15.                                               @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2072
*   RESPECIFY                                                      2072
*     REG14 RSTD;                   /*                       @ZDR2054*/
@RF02063 DS    0H                                                  2073
*   REG14=RETADDR1;                 /*                       @Y30LB31*/
         L     REG14,RETADDR1                                      2073
*   RESPECIFY                                                      2074
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   RETURN CODE(DUPVRC);            /*                       @Y30LB31*/
         LH    @15,DUPVRC                                          2075
@EL00021 DS    0H                                                  2075
@EF00021 DS    0H                                                  2075
@ER00021 BR    @14                                                 2075
*   END DUPVRTN;                    /*                       @Y30LB31*/
*                                                                  2077
*/********************************************************** @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* PROCEDURE NAME - BKOUTRTN                                @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* FUNCTION - CALLS VPREPRTN TO DEMOUNT A DUPLICATE VOLUME  @Y30LB31*/
*/*            THAT HAS BEEN ACTIVATED BUT FOUND TO BE       @Y30LB31*/
*/*            VSAM.  CALLS RENAMRTN TO RESTORE THE          @Y30LB31*/
*/*            ORIGINAL VOLUME SERIAL NO. IN THE             @Y30LB31*/
*/*            CARTRIDGE LABELS AND INVENTORY RECORD AND TO  @Y30LB31*/
*/*            DEACTIVATE THE VOLUME.  ISSUES MESSAGES       @Y30LB31*/
*/*            IDC3062I, IDC0063I, AND IDC3067I.             @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* INPUT - ADDVTBL, PRINTTBL FOR MESSAGES.                  @Y30LB31*/
*/*                                                          @Y30LB31*/
*/* OUTPUT - RETURN CODE OF 0 INDICATES ORIGINAL             @Y30LB31*/
*/*          VOLUME SERIAL RESTORED AND VOLUME               @Y30LB31*/
*/*          DEACTIVATED.  RETURN CODE OF 4 INDICATES EITHER @Y30LB31*/
*/*          THE DEMOUNT FAILED THAT IS REQUIRED FOR THE     @Y30LB31*/
*/*          BACKOUT OPERATIONS, OR THE ORIGINAL SERIAL NO.  @Y30LB31*/
*/*          COULD NOT BE RESTORED.                          @Y30LB31*/
*/*                                                          @Y30LB31*/
*/********************************************************** @Y30LB31*/
*                                                                  2077
*BKOUTRTN:                                                         2077
*   PROCEDURE OPTIONS(NOSAVEAREA,NOSAVE);/*                  @Y30LB31*/
*                                                                  2077
BKOUTRTN DS    0H                                                  2078
*   /*****************************************************************/
*   /*                                                               */
*   /* LOCAL CONDITION CODE.                                 @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2078
*   DCL                                                            2078
*     BKOUTRC FIXED(15);            /*                       @Y30LB31*/
*                                                                  2078
*   /*****************************************************************/
*   /*                                                               */
*   /* SAVE THE CALLERS RETURN ADDRESS AND RESTORE IT UPON   @Y30LB31*/
*   /* EXIT.                                                 @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2079
*   RESPECIFY                                                      2079
*     REG14 RSTD;                   /*                       @ZDR2054*/
*   RETADDR2=REG14;                 /*                       @Y30LB31*/
         ST    REG14,RETADDR2                                      2080
*   RESPECIFY                                                      2081
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   OLDERID2=NEWERID2;                                             2082
         L     @15,@PC00001                                        2082
         L     @14,GDTTR2(,@15)                                    2082
         MVC   @TS00001(95),NEWERID2(@14)                          2082
         MVC   OLDERID2(95,@14),@TS00001                           2082
*   NEWID2='AVBK';                  /*                       @Y30LB31*/
*                                                                  2083
         MVC   NEWID2(4,@14),@CC01954                              2083
*   /*****************************************************************/
*   /*                                                               */
*   /* ZERO OUT CONDITION CODE SET BY THIS PROC.             @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2084
*   BKOUTRC=LASTCC00;               /*                       @Y30LB31*/
*                                                                  2084
         SLR   @14,@14                                             2084
         STH   @14,BKOUTRC                                         2084
*   /*****************************************************************/
*   /*                                                               */
*   /* ISSUE MSG IDC3067I IDENTIFYING THE VOLUME AS          @Y30LB31*/
*   /* VSAM AND NOT TO BE ACTIVATED.                         @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2085
*   PRINTTBL=''B;                   /*                       @Y30LB31*/
         XC    PRINTTBL(28),PRINTTBL                               2085
*   DARGSMOD=COMMSGS;               /*                       @Y30LB31*/
         L     @14,DDSTRU                                          2086
         MVC   DARGSMOD(3,@14),@CC01697                            2086
*   DARGSENT=MSG3067I;              /* STID=CM041            @Y30LB31*/
         MVI   DARGSENT(@14),X'29'                                 2087
*   DARGDBP=ADDR(MSVIVOL#);         /*                       @Y30LB31*/
         LA    @05,MSVIVOL#                                        2088
         ST    @05,DARGDBP(,@14)                                   2088
*   DARGILP=LENGTH(MSVIVOL#);       /*                       @Y30LB31*/
         MVC   DARGILP(2,@14),@CH00159                             2089
*   CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*                  @Y30LB31*/
*                                                                  2090
         ST    @15,@AL00001                                        2090
         LA    @14,@CF00117                                        2090
         ST    @14,@AL00001+4                                      2090
         LA    @14,DDSTRU                                          2090
         ST    @14,@AL00001+8                                      2090
         MVI   @AL00001+8,X'80'                                    2090
         L     @15,GDTPRT(,@15)                                    2090
         LA    @01,@AL00001                                        2090
         BALR  @14,@15                                             2090
*   /*****************************************************************/
*   /*                                                               */
*   /* DEMOUNT THE VOLUME IN ORDER TO ISSUE THE MSC RENAME   @Y30LB31*/
*   /* ORDER TO RESTORE THE ORIGINAL VOLUME SERIAL NO.       @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2091
*   MOUNTFLG=OFF;                   /* DEMOUNT REQUIRED      @Y30LB31*/
*   WAITFLG=ON;                     /* WAIT TO DEMOUNT FINISH      2092
*                                                            @Y30LB31*/
         OI    WAITFLG,B'00100000'                                 2092
         NI    MOUNTFLG,B'10111111'                                2092
*   VPREPVOL=MSVIVOL#;              /*                       @Y30LB31*/
         MVC   VPREPVOL(6),MSVIVOL#                                2093
*   CALL VPREPRTN;                  /*                       @Y30LB31*/
         BAL   @14,VPREPRTN                                        2094
*   RESPECIFY                                                      2095
*     RTNREG RSTD;                                                 2095
*   TESTRC=RTNREG;                                                 2096
         LR    TESTRC,RTNREG                                       2096
*   RESPECIFY                                                      2097
*     RTNREG UNRSTD;                /*                       @Y30LB31*/
*                                                                  2097
*   /*****************************************************************/
*   /*                                                               */
*   /* IF THE DEMOUNT FAILED, PROCEED TO                     @Y30BL31*/
*   /* ISSUE MSG IDC3062I BEFORE EXITING FROM THIS PROC.     @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2098
*   IF TESTRC^=0 THEN               /*                       @Y30LB31*/
         LTR   TESTRC,TESTRC                                       2098
         BZ    @RF02098                                            2098
*     BKOUTRC=4;                    /*                       @Y30LB31*/
*                                                                  2099
         MVC   BKOUTRC(2),@CH00043                                 2099
*   /*****************************************************************/
*   /*                                                               */
*   /* FOLLOWING THE SUCCESSFUL DEMOUNT, RESTORE THE         @Y30LB31*/
*   /* ORIGINAL VOLUME SERIAL NO. AND DEACTIVATE THE VOLUME. @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2100
*   ELSE                            /*                       @Y30LB31*/
*     DO;                           /*                       @Y30LB31*/
         B     @RC02098                                            2100
@RF02098 DS    0H                                                  2101
*       RENAMTYP=BACKOUT;           /*                       @Y30LB31*/
         MVC   RENAMTYP(8),@CC01674                                2101
*       MSGFLG=OFF;                 /* DO NOT SAVE RENAME MSG      2102
*                                                            @Y30LB31*/
         NI    MSGFLG,B'11101111'                                  2102
*       CALL RENAMRTN;              /*                       @Y30LB31*/
         BAL   @14,RENAMRTN                                        2103
*       RESPECIFY                                                  2104
*         RTNREG RSTD;                                             2104
*       TESTRC=RTNREG;                                             2105
         LR    TESTRC,RTNREG                                       2105
*       RESPECIFY                                                  2106
*         RTNREG UNRSTD;            /*                       @Y30LB31*/
*                                                                  2106
*       /*************************************************************/
*       /*                                                           */
*       /* TEST RETURN CODE FROM THE BACKOUT OPERATION.      @Y30LB31*/
*       /* ISSUE MSG IDC0063I IF THE ORIGINAL VOLUME SERIAL NO. WAS  */
*       /*                                                   @Y30LB31*/
*       /* SUCCESSFULLY RESTORED.                            @Y30LB31*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  2107
*       IF TESTRC=0 THEN            /*                       @Y30LB31*/
         LTR   TESTRC,TESTRC                                       2107
         BNZ   @RF02107                                            2107
*         DO;                       /*                       @Y30LB31*/
*           PRINTTBL=''B;           /*                       @Y30LB31*/
         XC    PRINTTBL(28),PRINTTBL                               2109
*           DARGSMOD=COMMSGS;       /*                       @Y30LB31*/
         L     @15,DDSTRU                                          2110
         MVC   DARGSMOD(3,@15),@CC01697                            2110
*           DARGSENT=MSG0063I;      /* STID=CM047            @Y30LB31*/
         MVI   DARGSENT(@15),X'2F'                                 2111
*           CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*          @Y30LB31*/
         L     @15,@PC00001                                        2112
         ST    @15,@AL00001                                        2112
         LA    @14,@CF00117                                        2112
         ST    @14,@AL00001+4                                      2112
         LA    @14,DDSTRU                                          2112
         ST    @14,@AL00001+8                                      2112
         MVI   @AL00001+8,X'80'                                    2112
         L     @15,GDTPRT(,@15)                                    2112
         LA    @01,@AL00001                                        2112
         BALR  @14,@15                                             2112
*         END;                      /*                       @Y30LB31*/
*       ELSE                        /*                       @Y30LB31*/
*         BKOUTRC=4;                /*                       @Y30LB31*/
         B     @RC02107                                            2114
@RF02107 MVC   BKOUTRC(2),@CH00043                                 2114
*     END;                          /*                       @Y30BL31*/
@RC02107 DS    0H                                                  2116
*                                                                  2116
*   /*****************************************************************/
*   /*                                                               */
*   /* FOR EITHER A VOLUME DEMOUNT                           @Y30LB31*/
*   /* FAILURE OR MSC RENAME FAILURE, ISSUE MSG IDC3062I SINCE       */
*   /*                                                       @Y30LB31*/
*   /* THE ORIGINAL VOLUME SERIAL NO. COULD NOT BE RESTORED IN       */
*   /*                                                       @Y30LB31*/
*   /* THE CARTRIDGE LABELS AND INVENTORY RECORD. THE VOLUME @Y30LB31*/
*   /* HAS BEEN ACTIVATED BUT A SERIAL MISMATCH EXISTS IN THE        */
*   /*                                                       @Y30LB31*/
*   /* CARTRIDGE AND VOLUME LABELS.                          @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2116
*   IF BKOUTRC^=0 THEN              /*                       @Y30LB31*/
@RC02098 LH    @15,BKOUTRC                                         2116
         LTR   @15,@15                                             2116
         BZ    @RF02116                                            2116
*     DO;                           /*                       @Y30LB31*/
*       PRINTTBL=''B;               /*                       @Y30LB31*/
         XC    PRINTTBL(28),PRINTTBL                               2118
*       DARGSMOD=COMMSGS;           /*                       @Y30LB31*/
         L     @15,DDSTRU                                          2119
         MVC   DARGSMOD(3,@15),@CC01697                            2119
*       DARGSENT=MSG3062I;          /* STID=CM048            @Y30LB31*/
         MVI   DARGSENT(@15),X'30'                                 2120
*       CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*              @Y30LB31*/
         L     @15,@PC00001                                        2121
         ST    @15,@AL00001                                        2121
         LA    @14,@CF00117                                        2121
         ST    @14,@AL00001+4                                      2121
         LA    @14,DDSTRU                                          2121
         ST    @14,@AL00001+8                                      2121
         MVI   @AL00001+8,X'80'                                    2121
         L     @15,GDTPRT(,@15)                                    2121
         LA    @01,@AL00001                                        2121
         BALR  @14,@15                                             2121
*     END;                          /*                       @Y30LB31*/
*                                                                  2122
*   /*****************************************************************/
*   /*                                                               */
*   /* RESTORE REG 14 WITH THE RETURN ADDRESS OF THE CALLER AND EXIT */
*   /* FROM BKOUTRTN. PASS THE CONDITION CODE IN             @Y30LB31*/
*   /* REG 15.                                               @Y30LB31*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2123
*   RESPECIFY                                                      2123
*     REG14 RSTD;                   /*                       @ZDR2054*/
@RF02116 DS    0H                                                  2124
*   REG14=RETADDR2;                 /*                       @Y30LB31*/
         L     REG14,RETADDR2                                      2124
*   RESPECIFY                                                      2125
*     REG14 UNRSTD;                 /*                       @ZDR2054*/
*   RETURN CODE(BKOUTRC);           /*                       @Y30LB31*/
         LH    @15,BKOUTRC                                         2126
@EL00022 DS    0H                                                  2126
@EF00022 DS    0H                                                  2126
@ER00022 BR    @14                                                 2126
*   END BKOUTRTN;                   /*                       @Y30LB31*/
*                                                                  2128
*/****************************************************************** */
*/*                                                          @Y30LB32*/
*/*  PROCEDURE NAME - CKCSNLEN (FSR SUBROUTINE)              @Y30LB32*/
*/*                                                          @Y30LB32*/
*/*  FUNCTION - CHECKS LENGTH OF CARTRIDGE SERIAL NUMBER     @Y30LB32*/
*/*             IF THE LENGTH OF THE CSN IS LESS THEN ELEVEN,@Y30LB32*/
*/*             ISSUES MESSAGE IDC2099I, IF CSN IS ELEVEN    @Y30LB32*/
*/*             A BLANK CHARACTER IS INSERTED AS THE FOURTH  @Y30LB32*/
*/*             CHARACTER                                    @Y30LB32*/
*/*                                                          @Y30LB32*/
*/*  INPUT - CSN, LENGTH OF CSN                              @Y30LB32*/
*/*                                                          @Y30LB32*/
*/*  OUTPUT - CSN, RETURN CODE IN REGISTER 15(RETURN CODE    @Y30LB32*/
*/*           ZERO IF CSN VALID AND FOUR IF CSN INVALID)     @Y30LB32*/
*/*                                                          @Y30LB32*/
*/********************************************************************/
*                                                                  2128
*CKCSNLEN:                          /*                       @Y30LB32*/
*   PROCEDURE(CKCSNVAL,             /* CSN VALUE             @Y30LB32*/
*       CKLENGTH)                   /* LENGTH OF CSN         @Y30LB32*/
*       OPTIONS(NOSAVE,NOSAVEAREA); /*                       @Y30LB32*/
*                                                                  2128
CKCSNLEN MVC   @PC00023(8),0(@01)                                  2128
*   /*****************************************************************/
*   /*                                                               */
*   /* DECLARATIONS FOR CKCSNLEN SUBROUTINE                  @Y30LB32*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2129
*   DCL                                                            2129
*     CKCSNVAL CHAR(12);            /* CSN VALUE             @Y30LB32*/
*   DCL                                                            2130
*     CKCSNADJ CHAR(12);            /* FOR ADJUSTED CSN      @Y30LB32*/
*   DCL                                                            2131
*     CKLENGTH FIXED(8);            /* LENGTH OF CSN         @Y30LB32*/
*   DCL                                                            2132
*     CKRETPTR PTR(31);             /* SAVE RETURN ADDR      @Y30LB32*/
*   DCL                                                            2133
*     CKSAVPTR PTR(31);             /* TO SAVE POINTER       @Y30LB32*/
*   DCL                                                            2134
*     CKPRTTAB CHAR(20) BDY(WORD);  /* PRINT TABLE AREA      @Y30LB32*/
*   DCL                                                            2135
*     CKCOND FIXED(15);                                            2135
*                                                                  2135
*   /*****************************************************************/
*   /*                                                               */
*   /* DECLARATIONS OF CONSTANTS                             @Y30LB32*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2136
*   DCL                                                            2136
*     CKBLANK CHAR(1) CONSTANT(' ');/* BLANK TO INSERT IN    @Y30LB32
*                                      CSN                   @Y30LB32*/
*   DCL                                                            2137
*     CKELEVEN BIT(8) CONSTANT('0B'X);/* TO CHECK LENGTH     @Y30LB32
*                                      OF CSN AGAINST        @Y30LB32*/
*   DCL                                                            2138
*     CKMSGID CHAR(3) CONSTANT('CM0');/* MODULE MESSAGE ID   @Y30LB32*/
*   DCL                                                            2139
*     MSG2099I PTR(8) CONSTANT(1);  /* INVALID CSN MSG       @Y30LB32*/
*                                                                  2140
*   /*****************************************************************/
*   /*                                                               */
*   /* THIS IS THE START OF THE CHECK CSN SUBROUTINE         @Y30LB32*/
*   /* THE CALLERS RETURN ADDRESS IS SAVED                   @Y30LB32*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2140
*   CKRETPTR=REG14;                 /*                       @Y30LB32*/
         LR    CKRETPTR,REG14                                      2140
*   OLDERID2=NEWERID2;                                             2141
         L     @02,@PC00001                                        2141
         L     @02,GDTTR2(,@02)                                    2141
         MVC   @TS00001(95),NEWERID2(@02)                          2141
         MVC   OLDERID2(95,@02),@TS00001                           2141
*   NEWID2='CKLN';                  /*                       @Y30LB32*/
*                                                                  2142
         MVC   NEWID2(4,@02),@CC01972                              2142
*   /*****************************************************************/
*   /*                                                               */
*   /* SAVE POINTER TO CALLERS PRINT TABLE,                  @Y30LB32*/
*   /* INITIALIZE THE PRINT ARGUMENT LIST                    @Y30LB32*/
*   /* AND CONDITION CODE TO ZEROES                          @Y30LB32*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2143
*   CKSAVPTR=DDSTRU;                /*                       @Y30LB32*/
         L     @02,DDSTRU                                          2143
         ST    @02,CKSAVPTR                                        2143
*   DDSTRU=ADDR(CKPRTTAB);          /*                       @Y30LB32*/
         LA    @02,CKPRTTAB                                        2144
         ST    @02,DDSTRU                                          2144
*   CKPRTTAB=''B;                   /*                       @Y30LB32*/
         XC    CKPRTTAB(20),CKPRTTAB                               2145
*   CKCOND=''B;                     /*                       @Y30LB32*/
*                                                                  2146
         SLR   CKCOND,CKCOND                                       2146
*   /*****************************************************************/
*   /*                                                               */
*   /* CSN IS CHECKED FOR LENGTH OF ELEVEN CHARACTERS        @Y30LB32*/
*   /* OR MORE                                               @Y30LB32*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2147
*   IF CKLENGTH>=CKELEVEN THEN      /*                       @Y30LB32*/
*                                                                  2147
         L     @02,@PC00023+4                                      2147
         CLI   CKLENGTH(@02),11                                    2147
         BL    @RF02147                                            2147
*     /***************************************************************/
*     /*                                                             */
*     /* CSN IS CHECKED FOR LENGTH OF ELEVEN AND IF IT IS    @Y30LB32*/
*     /* ELEVEN A BLANK CHARACTER IS INSERTED AS FOURTH      @Y30LB32*/
*     /* CHARACTER                                           @Y30LB32*/
*     /*                                                             */
*     /***************************************************************/
*                                                                  2148
*     IF CKLENGTH=CKELEVEN THEN     /*                       @Y30LB32*/
         CLI   CKLENGTH(@02),11                                    2148
         BNE   @RF02148                                            2148
*       DO;                         /*                       @Y30LB32*/
*         CKCSNADJ(4:4)=CKBLANK;    /*                       @Y30LB32*/
         MVI   CKCSNADJ+3,C' '                                     2150
*         CKCSNADJ(5:12)=CKCSNVAL(4:11);/*                   @Y30LB32*/
         L     @02,@PC00023                                        2151
         MVC   CKCSNADJ+4(8),CKCSNVAL+3(@02)                       2151
*         CKCSNVAL(4:12)=CKCSNADJ(4:12);/*                   @Y30LB32*/
         MVC   CKCSNVAL+3(9,@02),CKCSNADJ+3                        2152
*       END;                        /*                       @Y30LB32*/
*     ELSE                                                         2154
*       ;                           /*                       @Y30LB32*/
*                                                                  2154
@RF02148 DS    0H                                                  2155
*   /*****************************************************************/
*   /*                                                               */
*   /* IF CSN IS LESS THEN ELEVEN CHARACTERS ERROR           @Y30LB32*/
*   /* MESSAGE IDC2099I IS WRITTEN AND CONDITION CODE SET    @Y30LB32*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2155
*   ELSE                            /*                       @Y30LB32*/
*     DO;                           /*                       @Y30LB32*/
         B     @RC02147                                            2155
@RF02147 DS    0H                                                  2156
*       DARGSMOD=CKMSGID;           /*                       @Y30LB32*/
         L     @02,DDSTRU                                          2156
         MVC   DARGSMOD(3,@02),@CC01697                            2156
*       DARGSENT=MSG2099I;          /*                       @Y30LB32*/
         MVI   DARGSENT(@02),X'01'                                 2157
*       DARGDBP=ADDR(CKCSNVAL);     /*                       @Y30LB32*/
         L     @15,@PC00023                                        2158
         ST    @15,DARGDBP(,@02)                                   2158
*       DARGILP=LENGTH(CKCSNVAL);   /*                       @Y30LB32*/
         MVC   DARGILP(2,@02),@CH00606                             2159
*       DARGRETP=''B;               /*                       @Y30LB32*/
         SLR   @15,@15                                             2160
         ST    @15,DARGRETP(,@02)                                  2160
*       CALL AMSTP011(GDTTBL,PRTFILE,DDSTRU);/*              @Y30LB32*/
         L     @02,@PC00001                                        2161
         ST    @02,@AL00001                                        2161
         LA    @15,@CF00117                                        2161
         ST    @15,@AL00001+4                                      2161
         LA    @15,DDSTRU                                          2161
         ST    @15,@AL00001+8                                      2161
         MVI   @AL00001+8,X'80'                                    2161
         L     @15,GDTPRT(,@02)                                    2161
         LA    @01,@AL00001                                        2161
         BALR  @14,@15                                             2161
*       CKCOND=4;                   /*                       @Y30LB32*/
         LA    CKCOND,4                                            2162
*     END;                          /*                       @Y30LB32*/
*                                                                  2163
*   /*****************************************************************/
*   /*                                                               */
*   /* RESTORE PRINT AREA POINTER AND RETURN ADDRESS AND     @Y30LB32*/
*   /* RETURN CONTROL TO CALLING FSR                         @Y30LB32*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2164
*   DDSTRU=CKSAVPTR;                /*                       @Y30LB32*/
@RC02147 L     @02,CKSAVPTR                                        2164
         ST    @02,DDSTRU                                          2164
*   REG14=CKRETPTR;                 /*                       @Y30LB32*/
         LR    REG14,CKRETPTR                                      2165
*   RETURN CODE(CKCOND);            /*                       @Y30LB32*/
         LR    @15,CKCOND                                          2166
@EL00023 DS    0H                                                  2166
@EF00023 DS    0H                                                  2166
@ER00023 BR    @14                                                 2166
*   END CKCSNLEN;                   /*                       @Y30LB32*/
*                                                                  2168
*/***********************************************************@Y30LB39*/
*/* PROCEDURE NAME - SSCMSG                                  @Y30LB39*/
*/*                                                          @Y30LB39*/
*/* FUNCTION - THIS ROUTINE PRINTS MESSAGES                  @Y30LB39*/
*/*   FROM IDCTSSS0 OR IDCTSCM0 AS DICTATED BY THE MSSC      @Y30LB39*/
*/*   REASON CODE OR THE ECB POST CODE, EITHER ONE PASSED AS @Y30LB39*/
*/*   INPUT ARGUMENTS.                                       @Y30LB39*/
*/*                                                          @Y30LB39*/
*/*   THE REASON CODE IS PASSED TO THIS ROUTINE FROM THE     @Y30LB39*/
*/*   CALLER IN SSRCODE, AND THE ECB POST CODE IS PASSED     @Y30LB39*/
*/*   IN SSECBCD.                                            @Y30LB39*/
*/*                                                          @Y30LB39*/
*/*   ONLY ONE MESSAGE IS PRINTED. IF THE REASON CODE        @Y30LB39*/
*/*   CONTAINS A NUMBER GREATER THAN ZERO, IT IS USED AS     @Y30LB39*/
*/*   THE INDICATION TO CALL UPRINT TO READ IN THE FIRST     @Y30LB39*/
*/*   STATIC TEXT ENTRY FROM IDCTSSS0.  THAT ENTRY CONTAINS  @Y30LB39*/
*/*   AN ARRAY OF THE MESSAGE INDICES USED TO PRINT THE      @Y30LB39*/
*/*   MSSC REASON CODE MESSAGE. THE ARRAY IS SCANNED FOR THE @Y30LB39*/
*/*   REASON CODE THAT WAS PASSED AS THE FIRST PARAMETER.    @Y30LB39*/
*/*   IF THE ARRAY CONTAINS AN ENTRY WITH THAT VALUE, THE    @Y30LB39*/
*/*   ARRAY INDEX IS USED TO PRINT THE MESSAGE.  IF THE      @Y30LB39*/
*/*   REASON CODE IS NOT FOUND IN THE ARRAY, THE REASON      @Y30LB39*/
*/*   CODE IS USED AS BLOCK DATA WHEN PRINTING THE "LAST"    @Y30LB39*/
*/*   STATIC TEXT ENTRY IN THE TEXT MODULE.                  @Y30LB39*/
*/*                                                          @Y30LB39*/
*/*   IF THE REASON CODE FIELD IS ZERO, THE ECB POST CODE    @Y30LB39*/
*/*   IS INSERTED AS BLOCK DATA INTO A GENERAL MESSAGE IN    @Y30LB39*/
*/*   STATIC TEXT MODULE IDCTSCM0.                           @Y30LB39*/
*/*                                                          @Y30LB39*/
*/* INPUT - REASON CODE AS FIRST ARGUMENT, OPTIONALLY THE    @Y30LB39*/
*/*         ECB CODE AS THE SECOND ARGUMENT.                 @Y30LB39*/
*/*                                                          @Y30LB39*/
*/* OUTPUT - PRINTED MESSAGE AND RETURN CODE OF ZERO.        @Y30LB39*/
*/*                                                          @Y30LB39*/
*/***********************************************************@Y30LB39*/
*                                                                  2168
*                                   /*                       @Y30LB39*/
*SSCMSG:                                                           2168
*   PROCEDURE(SSRCODE,              /* SSC RETURN CODE       @Y30LB39*/
*       SSECBCD);                   /* ECB POST CODE         @Y30LB39
*                                                            @Y30LB39*/
SSCMSG   STM   @14,@12,@SA00024                                    2168
         MVC   @PC00024(8),0(@01)                                  2168
*                                   /*                       @Y30LB39*/
*                                                                  2169
*   /*****************************************************************/
*   /*                                                               */
*   /*                                                       @Y30LB39*/
*   /* DECLARATIONS FOR THE SSCMSG PROCEDURE                 @Y30LB39*/
*   /*                                                       @Y30LB39*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2169
*                                   /*                       @Y30LB39
*                                                            @Y30LB39*/
*                                                                  2169
*   /*****************************************************************/
*   /*                                                               */
*   /*                                                       @Y30LB39*/
*   /* THE NEXT TWO DECLARES ARE FOR THE TWO INPUT           @Y30LB39*/
*   /* ARGUMENTS. 1ST - MSSC REASON CODE OR                  @Y30LB39*/
*   /* 2ND - MSSC POST CODE                                  @Y30LB39*/
*   /*                                                       @Y30LB39*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2169
*                                   /*                       @Y30LB39*/
*   DCL                                                            2169
*     1 SSRCODE FIXED(31),          /*                       @Y30LB39*/
*       3 * FIXED(15),              /*                       @Y30LB39*/
*       3 SSRHALF FIXED(15);        /* 1ST ARG REASON CODE   @Y30LB39*/
*   DCL                                                            2170
*     SSECBCD PTR(8);               /* 2ND ARG POST CODE     @Y30LB39
*                                                            @Y30LB39
*                                                            @Y30LB39*/
*                                                                  2170
*   /*****************************************************************/
*   /*                                                               */
*   /*                                                       @Y30LB39*/
*   /* DECLARE THE DYNAMIC AREA NEEDED TO POINT TO AND       @Y30LB39*/
*   /* CONTAIN THE "LOCAL" PRINT ARGUMENT LIST               @Y30LB39*/
*   /*                                                       @Y30LB39*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2171
*                                   /*                       @Y30LB39*/
*   DCL                                                            2171
*     SSDLPTR PTR(31);              /*                       @Y30LB39*/
*   DCL                                                            2172
*     SSDRGLT CHAR(LENGTH(DARGLIST));/*                      @Y30LB39
*                                                            @Y30LB39*/
*                                                                  2172
*   /*****************************************************************/
*   /*                                                               */
*   /*                                                       @Y30LB39*/
*   /* THE NEXT DECLARE IS FOR THE INDEX WHICH IS            @Y30LB39*/
*   /* INCREMENTED WHILE SEARCHING THE ARRAY OF              @Y30LB39*/
*   /* REASON CODES AND, UPON FINDING THE CORRECT            @Y30LB39*/
*   /* REASON CODE, IS PASSED TO PRINT MODULE AS THE         @Y30LB39*/
*   /* INDEX OF THE MESSAGE NUMBER TO BE PRINTED.            @Y30LB39*/
*   /*                                                       @Y30LB39*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2173
*                                   /*                       @Y30LB39*/
*   DECLARE                                                        2173
*     ENTRYNUM FIXED(8) UNSIGNED;   /*                       @Y30LB39
*                                                            @Y30LB39*/
*                                                                  2173
*   /*****************************************************************/
*   /*                                                               */
*   /*                                                       @Y30LB39*/
*   /* THE NEXT DECLARE IS FOR THE COMMON MESSAGE            @Y30LB39*/
*   /* NUMBER TO IDENTIFY THE ECB POST CODE                  @Y30LB39*/
*   /* MESSAGE CONTAINED IN STATIC TEXT MODULE               @Y30LB39*/
*   /* IDCTSCM0.                                             @Y30LB39*/
*   /*                                                       @Y30LB39*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2174
*                                   /*                       @Y30LB39*/
*   DECLARE                                                        2174
*     SSMSGNUM FIXED(8) STATIC LOCAL INIT(56);/*             @Y30LB39
*                                                            @Y30LB39*/
*                                                                  2174
*   /*****************************************************************/
*   /*                                                               */
*   /*                                                       @Y30LB39*/
*   /* THE NEXT DECLARE IS FOR THE ARRAY WHICH IS            @Y30LB39*/
*   /* SEARCHED FOR THE REASON CODE CORRESPONDING            @Y30LB39*/
*   /* TO THE MESSAGE INDEX AND ULTIMATELY, THE              @Y30LB39*/
*   /* MESSAGE TEXT TO BE PRINTED TO THE USER TELLING        @Y30LB39*/
*   /* HIM OF THE EXACT REASON FOR THE MSSC FAILURE.         @Y30LB39*/
*   /*                                                       @Y30LB39*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2175
*                                   /*                       @Y30LB39*/
*   DECLARE                                                        2175
*     1 SSINXLST BDY(WORD),         /*                       @Y30LB39*/
*       3 SSARRAY(60) FIXED(15);    /*                       @Y30LB39
*                                                            @Y30LB39*/
*                                                                  2175
*   /*****************************************************************/
*   /*                                                               */
*   /*                                                       @Y30LB39*/
*   /* THE NEXT DECLARATION IS FOR THE MESSAGE ID            @Y30LB39*/
*   /* USED BY THE STATIC TEXT MODULE - IDCTSSS0.            @Y30LB39*/
*   /*                                                       @Y30LB39*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2176
*                                   /*                       @Y30LB39*/
*   DECLARE                                                        2176
*     SSMODSS0 CHAR(3) STATIC INIT('SS0');/*                 @Y30LB39
*                                                            @Y30LB39*/
*                                                                  2176
*   /*****************************************************************/
*   /*                                                               */
*   /*                                                       @Y30LB39*/
*   /* THE NEXT DECLARATION IS FOR THE MESSAGE ID            @Y30LB39*/
*   /* USED BY THE STATIC TEXT MODULE - IDCTSCMO.            @Y30LB39*/
*   /*                                                       @Y30LB39*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2177
*                                   /*                       @Y30LB39*/
*   DECLARE                                                        2177
*     SSMODCM0 CHAR(3) STATIC INIT('CM0');/*                 @Y30LB39
*                                                            @Y30LB39*/
*                                   /*                       @Y30LB39*/
*                                                                  2178
*   /*****************************************************************/
*   /*                                                               */
*   /* ISSUE UTRACE MACRO TO PROVIDE A TRACK OF FLOW         @Y30LB39*/
*   /* ON CONTROL WITHIN THE SSMSG MODULE.                   @Y30LB39*/
*   /* THIS WILL PLACE THE IDENTIFIER SPECIFIED IN           @Y30LB39*/
*   /* A SEPARATE INTRA-MODULE TRACE TABLE.                  @Y30LB39*/
*   /*                                                       @Y30LB39*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2178
*                                   /*                       @Y30LB39*/
*   OLDERID2=NEWERID2;                                             2178
         L     @15,@PC00001                                        2178
         L     @14,GDTTR2(,@15)                                    2178
         MVC   @TS00001(95),NEWERID2(@14)                          2178
         MVC   OLDERID2(95,@14),@TS00001                           2178
*   NEWID2='SSAA';                  /*                       @Y30LB39
*                                                            @Y30LB39*/
*                                                                  2179
         MVC   NEWID2(4,@14),@CC01994                              2179
*   /*****************************************************************/
*   /*                                                               */
*   /*                                                       @Y30LB39*/
*   /* ESTABLISH ADDRESSABILITY TO THE DYNAMIC               @Y30LB39*/
*   /* ARGUMENT LIST.                                        @Y30LB39*/
*   /*                                                       @Y30LB39*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2180
*                                   /*                       @Y30LB39*/
*   SSDLPTR=ADDR(SSDRGLT);          /*                       @Y30LB39
*                                                            @Y30LB39*/
*                                                                  2180
         LA    @14,SSDRGLT                                         2180
         ST    @14,SSDLPTR                                         2180
*   /*****************************************************************/
*   /*                                                               */
*   /*                                                       @Y30LB39*/
*   /* IF THE REASON CODE IS NOT ZERO, READ IN THE           @Y30LB39*/
*   /* ARRAY FROM THE STATIC TEXT MODULE - IDCTSSS0.         @Y30LB39*/
*   /*                                                       @Y30LB39*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2181
*                                   /*                       @Y30LB39*/
*   IF SSRCODE>0 THEN                                              2181
         L     @07,@PC00024                                        2181
         L     @07,SSRCODE(,@07)                                   2181
         LTR   @07,@07                                             2181
         BNP   @RF02181                                            2181
*     DO;                           /*                       @Y30LB39
*                                                            @Y30LB39*/
*                                                                  2182
*       /*************************************************************/
*       /*                                                           */
*       /*                                                   @Y30LB39*/
*       /* CLEAR THE DYNAMIC ARGUMENT LIST AND               @Y30LB39*/
*       /* INITIALIZE THE PRINT ARGUMENT LIST TO READ        @Y30LB39*/
*       /* IN THE ARRAY WHICH CONTAINS THE MSSC REASON       @Y30LB39*/
*       /* CODES.                                            @Y30LB39*/
*       /*                                                   @Y30LB39*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  2183
*                                   /*                       @Y30LB39*/
*       SSDRGLT=''B;                /*                       @Y30LB39*/
         XC    SSDRGLT(20),SSDRGLT                                 2183
*       SSDLPTR->DARGRETP=ADDR(SSINXLST);/*                  @Y30LB39*/
         LA    @03,SSINXLST                                        2184
         ST    @03,DARGRETP(,@14)                                  2184
*       SSDLPTR->DARGSMOD=SSMODSS0; /*                       @Y30LB39*/
         MVC   DARGSMOD(3,@14),SSMODSS0                            2185
*       SSDLPTR->DARGSENT=1;        /*                       @Y30LB39*/
         MVI   DARGSENT(@14),X'01'                                 2186
*       SSDLPTR->DARGRETL=LENGTH(SSINXLST);/*                @Y30LB39
*                                                            @Y30LB39*/
*                                                                  2187
         MVC   DARGRETL(2,@14),@CH02005                            2187
*       /*************************************************************/
*       /*                                                           */
*       /*                                                   @Y30LB39*/
*       /* ISSUE UPRINT MACRO TO READ IN THE SEARCH          @Y30LB39*/
*       /* ARRAY.                                            @Y30LB39*/
*       /*                                                   @Y30LB39*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  2188
*                                   /*                       @Y30LB39*/
*       CALL AMSTP011(GDTTBL,PRTFILE,SSDLPTR);/*             @Y30LB39
*                                                            @Y30LB39*/
*                                                                  2188
         ST    @15,@AL00001                                        2188
         LA    @03,@CF00117                                        2188
         ST    @03,@AL00001+4                                      2188
         LA    @03,SSDLPTR                                         2188
         ST    @03,@AL00001+8                                      2188
         MVI   @AL00001+8,X'80'                                    2188
         L     @15,GDTPRT(,@15)                                    2188
         LA    @01,@AL00001                                        2188
         BALR  @14,@15                                             2188
*       /*************************************************************/
*       /*                                                           */
*       /*                                                   @Y30LB39*/
*       /* BEGIN DO LOOP TO SEARCH FOR THE MESSAGE           @Y30LB39*/
*       /* INDEX CORRESPONDING TO THE REASON CODE            @Y30LB39*/
*       /* PASSED AS THE FIRST ARGUMENT.                     @Y30LB39*/
*       /* THE DO LOOP BEGINS WITH THE SECOND ARRAY          @Y30LB39*/
*       /* ENTRY SINCE THE FIRST IS REQUIRED BY THE          @Y30LB39*/
*       /* SEARCH ARRAY ITSELF.                              @Y30LB39*/
*       /* THE SEARCH CONTINUES UNTIL THE REASON CODE        @Y30LB39*/
*       /* IS FOUND, AT WHICH TIME THE SEARCH INDEX          @Y30LB39*/
*       /* IS PASSED TO THE PRINT MODULE TO PRINT            @Y30LB39*/
*       /* THE MESSAGE ASSOCIATED WITH THAT PARTICULAR       @Y30LB39*/
*       /* REASON CODE.                                      @Y30LB39*/
*       /* IF THERE IS NO MATCH FOUND IN THE ARRAY,          @Y30LB39*/
*       /* THEN THE INDEX WILL BE THE LAST POSITION IN       @Y30LB39*/
*       /* ARRAY. THIS WILL BE THE INDICATION THAT           @Y30LB39*/
*       /* THE REASON CODE ITSELF SHOULD BE PRINTED.         @Y30LB39*/
*       /*                                                   @Y30LB39*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  2189
*                                   /*                       @Y30LB39*/
*       ENTRYNUM=1;                 /*                       @Y30LB39*/
         LA    ENTRYNUM,1                                          2189
*       DO UNTIL(SSRHALF=SSARRAY(ENTRYNUM)×SSARRAY(ENTRYNUM)=0);   2190
@DL02190 DS    0H                                                  2191
*         ENTRYNUM=ENTRYNUM+1;      /*                       @Y30LB39*/
         AL    ENTRYNUM,@CF00222                                   2191
*       END;                        /*                       @Y30LB39
*                                                            @Y30LB39*/
*                                                                  2192
@DE02190 L     @03,@PC00024                                        2192
         LR    @15,ENTRYNUM                                        2192
         ALR   @15,@15                                             2192
         LH    @15,SSARRAY-2(@15)                                  2192
         CH    @15,SSRHALF(,@03)                                   2192
         BE    @DC02190                                            2192
         SLR   @14,@14                                             2192
         CR    @15,@14                                             2192
         BNE   @DL02190                                            2192
@DC02190 DS    0H                                                  2193
*       /*************************************************************/
*       /*                                                           */
*       /*                                                   @Y30LB39*/
*       /* THE CORRECT INDEX HAS BEEN FOUND                  @Y30LB39*/
*       /*                                                   @Y30LB39*/
*       /* CLEAR THE DYNAMIC ARGUMENT LIST AND FILL          @Y30LB39*/
*       /* OUT THE PRINT ARGUMENT FIELDS WITH EITHER:        @Y30LB39*/
*       /* 1) THE INDEX CORRESPONDING TO THE REASON          @Y30LB39*/
*       /* CODE OR                                           @Y30LB39*/
*       /* 2) THE LAST INDEX AND THE REASON CODE             @Y30LB39*/
*       /* ITSELF AS A STATIC TEXT INSERT.                   @Y30LB39*/
*       /*                                                   @Y30LB39*/
*       /*                                                           */
*       /*************************************************************/
*                                                                  2193
*                                   /*                       @Y30LB39*/
*       SSDRGLT=''B;                /*                       @Y30LB39*/
         XC    SSDRGLT(20),SSDRGLT                                 2193
*       SSDLPTR->DARGSMOD=SSMODSS0; /*                       @Y30LB39*/
         L     @07,SSDLPTR                                         2194
         MVC   DARGSMOD(3,@07),SSMODSS0                            2194
*       SSDLPTR->DARGSENT=ENTRYNUM; /*                       @Y30LB39*/
         STC   ENTRYNUM,DARGSENT(,@07)                             2195
*       IF SSARRAY(ENTRYNUM)=0 THEN /*                       @Y30LB39*/
         CR    @15,@14                                             2196
         BNE   @RF02196                                            2196
*         DO;                       /*                       @Y30LB39*/
*           SSDLPTR->DARGDBP=ADDR(SSRCODE);/*                @Y30LB39*/
         ST    @03,DARGDBP(,@07)                                   2198
*           SSDLPTR->DARGILP=LENGTH(SSRCODE);/*              @Y30LB39*/
         MVC   DARGILP(2,@07),@CH00043                             2199
*         END;                      /*                       @Y30LB39*/
*     END;                          /*                       @Y30LB39*/
*                                   /*                       @Y30LB39*/
*                                                                  2202
*   /*****************************************************************/
*   /*                                                               */
*   /*                                                       @Y30LB39*/
*   /* THE FIRST ARGUMENT WAS ZERO, INDICATING THAT          @Y30LB39*/
*   /* THIS ROUTINE IS TO PRINT OUT THE ECB POST             @Y30LB39*/
*   /* CODE. THEREFORE, CLEAR THE DYNAMIC ARGUMENT           @Y30LB39*/
*   /* LIST AND FILL OUT THE PRINT ARGUMENT FIELDS           @Y30LB39*/
*   /* SO THE STATIC TEXT MODULE, IDCTSCM0, WILL             @Y30LB39*/
*   /* PRINT OUT THE MESSAGE ASSOCIATED WITH THE             @Y30LB39*/
*   /* POST CODE.                                            @Y30LB39*/
*   /*                                                       @Y30LB39*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2202
*                                   /*                       @Y30LB39*/
*   ELSE                            /*                       @Y30LB39*/
*     DO;                           /*                       @Y30LB39*/
         B     @RC02181                                            2202
@RF02181 DS    0H                                                  2203
*       SSDRGLT=''B;                /*                       @Y30LB39*/
         XC    SSDRGLT(20),SSDRGLT                                 2203
*       SSDLPTR->DARGSMOD=SSMODCM0; /*                       @Y30LB39*/
         L     @15,SSDLPTR                                         2204
         MVC   DARGSMOD(3,@15),SSMODCM0                            2204
*       SSDLPTR->DARGSENT=SSMSGNUM; /*                       @Y30LB39*/
         MVC   DARGSENT(1,@15),SSMSGNUM                            2205
*       SSDLPTR->DARGDBP=ADDR(SSECBCD);/*                    @Y30LB39*/
         L     @14,@PC00024+4                                      2206
         ST    @14,DARGDBP(,@15)                                   2206
*       SSDLPTR->DARGILP=LENGTH(SSECBCD);/*                  @Y30LB39*/
         MVC   DARGILP(2,@15),@CH00222                             2207
*     END;                          /*                       @Y30LB39
*                                                            @Y30LB39*/
*                                                                  2208
*   /*****************************************************************/
*   /*                                                               */
*   /*                                                       @Y30LB39*/
*   /* ISSUE UPRINT MACRO TO PRINT THE REASON                @Y30LB39*/
*   /* CODE MESSAGE OR THE ECB POST CODE MESSAGE.            @Y30LB39*/
*   /*                                                       @Y30LB39*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2209
*                                   /*                       @Y30LB39*/
*   CALL AMSTP011(GDTTBL,PRTFILE,SSDLPTR);/*                 @Y30LB39
*                                                            @Y30LB39*/
*                                                                  2209
@RC02181 L     @15,@PC00001                                        2209
         ST    @15,@AL00001                                        2209
         LA    @14,@CF00117                                        2209
         ST    @14,@AL00001+4                                      2209
         LA    @14,SSDLPTR                                         2209
         ST    @14,@AL00001+8                                      2209
         MVI   @AL00001+8,X'80'                                    2209
         L     @15,GDTPRT(,@15)                                    2209
         LA    @01,@AL00001                                        2209
         BALR  @14,@15                                             2209
*   /*****************************************************************/
*   /*                                                               */
*   /*                                                       @Y30LB39*/
*   /* RETURN TO CALLER WITH A RETURN CODE OF ZERO           @Y30LB39*/
*   /*                                                       @Y30LB39*/
*   /*                                                               */
*   /*****************************************************************/
*                                                                  2210
*                                   /*                       @Y30LB39
*                                                            @Y30LB39*/
*   RETURN CODE(0);                 /*                       @Y30LB39
*                                                            @Y30LB39*/
         SLR   @15,@15                                             2210
         L     @14,@SA00024                                        2210
         LM    @00,@12,@SA00024+8                                  2210
         BR    @14                                                 2210
*   END SSCMSG;                     /*                       @Y30LB39*/
*   END IDCAV01                     /*                       @Y30LB31*/
*                                                                  2212
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.     */
*/*%INCLUDE SYSLIB  (AMSDF01 )                                       */
*/*%INCLUDE SYSLIB  (AMSDF00 )                                       */
*/*@INCLUDE SYSLIB  (AMSDF02 )                                       */
*/*%INCLUDE SYSLIB  (IDCDF04 )                                       */
*/*%INCLUDE SYSLIB  (IDCCSAV )                                       */
*/*%INCLUDE SYSLIB  (IEZBASEV)                                       */
*/*%INCLUDE SYSLIB  (IEZCOPYV)                                       */
*/*%INCLUDE SYSLIB  (IEZDUPV )                                       */
*/*%INCLUDE SYSLIB  (IEZBCDV )                                       */
*/*%INCLUDE SYSLIB  (IEZGROUP)                                       */
*/*%INCLUDE SYSLIB  (IEZRVVI )                                       */
*/*%INCLUDE SYSLIB  (IEZMVR  )                                       */
*/*%INCLUDE SYSLIB  (IEZDEFVE)                                       */
*/*%INCLUDE SYSLIB  (IDCDF50 )                                       */
*/*%INCLUDE SYSLIB  (IDCDF52 )                                       */
*                                                                  2212
*       ;                                                          2212
@DATA    DS    0H
@CH00156 DC    H'2'
@CH00298 DC    H'5'
@CH00159 DC    H'6'
@CH00885 DC    H'29'
@CH02001 DC    H'37'
@CH02003 DC    H'52'
@CH01999 DC    H'59'
@CH02002 DC    H'74'
@CH01998 DC    H'76'
@CH02004 DC    H'96'
@CH02005 DC    H'120'
@CH01997 DC    H'164'
@CH02000 DC    H'212'
@CH01996 DC    H'224'
         DS    0F
@AL00366 DC    A(EXCL)                 LIST WITH   3 ARGUMENT(S)
         DC    A(WAIT)
         DC    A(@CC01635)
@DATD    DSECT
         DS    0F
@SA00001 DS    18F
@PC00001 DS    3F
@PC00023 DS    2F
@SA00024 DS    15F
@PC00024 DS    2F
@AL00001 DS    6A
@AFTEMPS DS    10F
IDCAV01  CSECT
         DS    0F
@CF00117 DC    F'0'
@CF00222 DC    F'1'
@CH00222 EQU   @CF00222+2
@CF00043 DC    F'4'
@CH00043 EQU   @CF00043+2
@CF00182 DC    F'8'
@CH00182 EQU   @CF00182+2
@CF00606 DC    F'12'
@CH00606 EQU   @CF00606+2
@CF01807 DC    XL4'00000208'
@CF01682 DC    XL4'26'
@CF01684 DC    XL4'2A'
@DATD    DSECT
         DS    0D
LISTSCAN DS    A
IOCSPTR  DS    A
OPNPTR   DS    A
DDSTRU   DS    A
FSADDR   DS    A
ERCNVADR DS    A
CCMSGPTR DS    A
CTMSGPTR DS    A
ELEMENT  DS    F
COPYVPTR DS    A
GROUPPTR DS    A
RVVIPTR  DS    A
MVRPTR   DS    A
DEFVPTR  DS    A
DEFVEPTR DS    A
REASON   DS    F
ECBMSPTR DS    A
RETADDR1 DS    F
RETADDR2 DS    F
RETADDR3 DS    F
DLSRET   DS    F
CKSAVPTR DS    A
SSDLPTR  DS    A
LISTPTR  DS    A
SETUPRC  DS    H
UNIQVRC  DS    H
NEWVFRC  DS    H
SECCKRC  DS    H
CLABLRC  DS    H
DUPVRC   DS    H
BKOUTRC  DS    H
SETRC    DS    H
LISTLN   DS    FL1
         DS    0D
@TS00001 DS    CL95
         DS    CL1
AV01DEFV DS    CL212
         ORG   AV01DEFV
AVDEFVID DS    CL8
AVDEFV   DS    CL132
AVDVEID  DS    CL8
AVDEFVE  DS    CL64
         ORG   AV01DEFV+212
MSGPARMS DS    CL36
         ORG   MSGPARMS
PRINTHDR DS    CL8
PRINTTBL DS    CL28
         ORG   MSGPARMS+36
AVDMPLST DS    CL33
         DS    CL3
AVMDAGL  DS    CL37
         DS    CL3
AVVS1AGL DS    CL74
         DS    CL2
AVEXCLST DS    CL23
AMDTYPE  DS    CL8
         DS    CL1
AVALLAGL DS    CL39
         ORG   AVALLAGL
AVALLID  DS    CL8
AVALLTBL DS    CL31
         ORG   AVALLAGL+39
         DS    CL1
AVUNLST  DS    CL12
         ORG   AVUNLST
AVUNCNT  DS    FL2
AVUNLEN  DS    FL2
AVUNVAL  DS    CL8
         ORG   AVUNLST+12
AVVOLLST DS    CL10
         ORG   AVVOLLST
SERCNT   DS    FL2
SERLEN   DS    FL2
SERNO    DS    CL6
         ORG   AVVOLLST+10
         DS    CL2
VOLBUF   DS    CL232
         ORG   VOLBUF
VOLHDR   DS    CL8
VOLREC   DS    CL224
         ORG   VOLBUF+232
GRPBUF   DS    CL172
         ORG   GRPBUF
GRPHDR   DS    CL8
GRPREC   DS    CL164
         ORG   GRPBUF+172
TEMPBUFF DS    CL232
         ORG   TEMPBUFF
TEMPHDR  DS    CL8
TEMPBUF  DS    CL224
         ORG   TEMPBUFF+232
ECBCODE  DS    CL1
MINORNM  DS    CL23
         ORG   MINORNM
RNMLEN   DS    FL1
RNAME    DS    CL22
         ORG   RNAME
RNMSERNO DS    CL6
RNMTRAIL DS    CL16
         ORG   MINORNM+23
ADDVTBL  DS    CL59
         ORG   ADDVTBL
ADDVHDR  DS    CL8
RECTYPE  DS    CL4
RENAMTYP DS    CL8
AUNITDDN DS    CL8
AUNITUCB DS    AL4
CSNWKA   DS    CL12
VPREPVOL DS    CL6
MSVIVOL# DS    CL6
@NM00132 DS    BL2
         ORG   @NM00132
CC04FLG  DS    BL1
MOUNTFLG EQU   @NM00132+0
WAITFLG  EQU   @NM00132+0
MSGFLG   EQU   @NM00132+0
NEWVFFLG EQU   @NM00132+0
ALLOCFLG EQU   @NM00132+0
GRPMSFLG EQU   @NM00132+0
BRECOVSW EQU   @NM00132+0
ONLYROSW DS    BL1
@NM00133 EQU   @NM00132+1
         ORG   ADDVTBL+58
ATTRFLGS DS    BL1
         ORG   ATTRFLGS
OLDBIFLG DS    BL1
OLDDEFLG EQU   ATTRFLGS+0
OLDEXFLG EQU   ATTRFLGS+0
OLDROFLG EQU   ATTRFLGS+0
NEWBIFLG EQU   ATTRFLGS+0
NEWDEFLG EQU   ATTRFLGS+0
NEWEXFLG EQU   ATTRFLGS+0
NEWROFLG EQU   ATTRFLGS+0
         ORG   ADDVTBL+59
CDATEWKA DS    CL4
         DS    CL1
AV01RVVI DS    CL76
         ORG   AV01RVVI
AVRVVIID DS    CL8
AVRVVI   DS    CL68
         ORG   AV01RVVI+76
AVCKAGL  DS    CL29
AVS1TEST DS    CL8
         DS    CL3
AVVS2AGL DS    CL52
AV01MVR  DS    CL96
         ORG   AV01MVR
AVMVRHDR DS    CL8
AVMVRTBL DS    CL88
         ORG   AV01MVR+96
CKCSNADJ DS    CL12
CKPRTTAB DS    CL20
SSDRGLT  DS    CL20
SSINXLST DS    CL120
         ORG   SSINXLST
SSARRAY  DS    60H
         ORG   SSINXLST+120
         ORG   *+1-(*-@DATD)/(*-@DATD) INSURE DSECT DATA
@ENDDATD EQU   *
IDCAV01  CSECT
         DS    0F
@SIZDATD DC    AL1(0)
         DC    AL3(@ENDDATD-@DATD)
         DS    0D
RVVLEN   DC    AL2(68)
MVRLEN   DC    AL2(88)
DEFLEN   DC    AL2(64)
SSMSGNUM DC    AL1(56)
@CC01635 DC    C'SYSZAMS '
@CC01666 DC    C'ACTIVE  '
@CC01668 DC    C'INACTIVE'
@CC01670 DC    C'SYSGROUP'
@CC01672 DC    C'DUMMY   '
@CC01674 DC    C'BACKOUT '
@CC01767 DC    C'DARGLIST'
@CC01770 DC    C'GROUPREC'
@CC01816 DC    C'AV01RVVI'
@CC01826 DC    C'AV01DEFV'
@CC01905 DC    C'IDCVS01 '
@CC01907 DC    C'AVVS1AGL'
@CC01927 DC    C'IDCVS02 '
@CC01931 DC    C'AVVS2AGL'
@CC01766 DC    C'ADDVTBL'
@CC01771 DC    C'DEFLIST'
@CC01848 DC    C'AVCKAGL'
@CC01897 DC    C'AVMDAGL'
@CC01942 DC    C'AV01MVR'
@CC01768 DC    C'VOLREC'
@CC01769 DC    C'REPVOL'
@CC01773 DC    C'ALLAGL'
@CC01616 DC    C'3330V'
@CC01772 DC    C'DEFVE'
@CC01587 EQU   @CC01816
@CC01656 DC    C'DUP '
@CC01658 DC    C'GRP '
@CC01660 DC    C'BASE'
@CC01662 DC    C'UNKN'
@CC01664 DC    C'COPY'
@CC01764 DC    C'AVBG'
@CC01785 DC    C'AVND'
@CC01790 DC    C'AVUP'
@CC01798 DC    C'AVVT'
@CC01813 DC    C'AVRV'
@CC01814 DC    C'RVVI'
@CC01818 DC    C'AVRD'
@CC01824 DC    C'AVVO'
@CC01827 DC    C'AVRN'
@CC01832 DC    C'AVRW'
@CC01838 DC    C'AVNM'
@CC01839 DC    C'AVBN'
@CC01845 DC    C'AVAL'
@CC01849 EQU   @CC01848
@CC01854 DC    C'AVUQ'
@CC01863 DC    C'AVAD'
@CC01872 DC    C'AVDL'
@CC01877 DC    C'AVAC'
@CC01878 DC    C'AVDF'
@CC01883 DC    C'AVVF'
@CC01884 DC    C'AVAT'
@CC01889 DC    C'AVSE'
@CC01896 DC    C'AVVP'
@CC01898 EQU   @CC01897
@CC01906 DC    C'AVVC'
@CC01908 DC    C'AVS1'
@CC01913 DC    C'AVCL'
@CC01918 DC    C'AVVL'
@CC01928 DC    C'AVS2'
@CC01932 DC    C'AVNS'
@CC01940 DC    C'AVMV'
@CC01943 DC    C'AVSM'
@CC01948 DC    C'AVDU'
@CC01954 DC    C'AVBK'
@CC01972 DC    C'CKLN'
@CC01994 DC    C'SSAA'
@CC01687 EQU   @CC01816
@CC01697 DC    C'CM0'
@CC01732 DC    C'UV0'
@CC01941 DC    C'MVR'
@CB01651 DC    X'0000000000000000'
@CB01647 EQU   @CB01651
@CB01654 EQU   @CB01651
ALL      DC    CL3'ALL'
FORMAT   DC    CL4'FORM'
HSECOND  DC    CL4'HSEC'
CLOCK    DC    CL4'KLOK'
SETZERO  DC    CL4'ZERO'
SETBLANK DC    CL4'BLNK'
NOSET    DC    CL4'NSET'
OVERRIDE DC    CL4'OVRD'
ACQUIRE  DC    CL8'ACQUIRE '
RELINQ   DC    CL8'RELINQ  '
MOUNT    DC    CL8'MOUNT   '
DEMOUNT  DC    CL8'DEMOUNT '
DEFINE   DC    CL8'DEFINE  '
MOVE     DC    CL8'MOVE    '
TRACEQ   DC    CL8'TRACEQ  '
COPYTABL DC    CL8'COPYTABL'
COPYCRTG DC    CL8'COPYCRTG'
COPYVOL  DC    CL8'COPYVOL '
VVIC     DC    CL8'VVIC    '
TUNE     DC    CL8'TUNE    '
NAMES    DC    CL4'NAME'
UNIT     DC    CL4'UNIT'
SHR      DC    CL4'SHR '
EXCL     DC    CL4'EXCL'
NOWAIT   DC    CL4'NWAI'
WAIT     DC    CL4'WAIT'
SECCHECK DC    CL8'SECCHECK'
SCRVTOC  DC    CL8'SCRVTOC '
GETVTOC  DC    CL8'GETVTOC '
PUTVTOC  DC    CL8'PUTVTOC '
RECATLG  DC    CL8'RECATLG '
INITVOL  DC    CL8'INITVOL '
CHECK    DC    CL8'CHECK   '
POSTUCB  DC    CL8'POSTUCB '
GET      DC    CL8'GET     '
PUT      DC    CL8'PUT     '
CLOSE    DC    CL8'CLOSE   '
OPEN     DC    CL8'OPEN    '
RVOPENR  DC    CL8'OPENR   '
RVRDCNT  DC    CL8'READCNT '
RVREADKD DC    CL8'READKD  '
RVSPACCR DC    CL8'SPACCR  '
RVFWRITE DC    CL8'FWRITE  '
RVWRITER DC    CL8'WRITEREC'
PUTLABEL DC    CL8'PUTLABEL'
GETLABEL DC    CL8'GETLABEL'
CANCEL   DC    CL8'CANCEL  '
SET      DC    CL8'SET     '
SELECTX  DC    CL8'SELECTX '
CHANGEX  DC    CL8'CHANGEX '
SELECTDD DC    CL8'SELECTDD'
SELECTDS DC    CL8'SELECTDS'
TBLREST  DC    CL8'TBLREST '
NULLIFYC DC    CL8'NULLIFYC'
RDMSC    DC    CL8'RDMSC   '
RDMSCTBL DC    CL8'RDMSCTBL'
RDCARTLB DC    CL8'RDCARTLB'
AUDITCEL DC    CL8'AUDITCEL'
RDSTGAD  DC    CL8'RDSTGAD '
MODIFYC  DC    CL8'MODIFYC '
MODID    DC    CL4'AV01'
FIXAREA  DS    CL569
         ORG   FIXAREA
@NM00129 DC    256X'00'
@NM00130 DC    256X'00'
@NM00131 DC    57X'00'
         ORG   FIXAREA+569
RESERVE  DC    CL16'.VIRTUAL.RESERVE'
ENQUEUE  DC    CL16'.VIRTUAL.ENQUEUE'
SSMODSS0 DC    CL3'SS0'
SSMODCM0 DC    CL3'CM0'
@00      EQU   00                      EQUATES FOR REGISTERS 0-15
@01      EQU   01
@02      EQU   02
@03      EQU   03
@04      EQU   04
@05      EQU   05
@06      EQU   06
@07      EQU   07
@08      EQU   08
@09      EQU   09
@10      EQU   10
@11      EQU   11
@12      EQU   12
@13      EQU   13
@14      EQU   14
@15      EQU   15
ENTRYNUM EQU   @02
CKCOND   EQU   @03
CKRETPTR EQU   @04
MVRRTNRC EQU   @04
VS2RTNRC EQU   @04
VLABLRC  EQU   @05
VTOCKRC  EQU   @04
VPREPRC  EQU   @04
ACTVRC   EQU   @05
DLSRC    EQU   @05
ADDRC    EQU   @04
ALLOCRC  EQU   @04
RENAMRC  EQU   @05
RWCKRC   EQU   @04
VOLCKRC  EQU   @04
RVRTNRC  EQU   @04
VTYPERC  EQU   @05
TEMPPTR  EQU   @02
BCDVPTR  EQU   @06
DUPVPTR  EQU   @02
BASEVPTR EQU   @07
CMMSGPTR EQU   @02
DMPINDEX EQU   @02
TESTRC   EQU   @03
REG8     EQU   @08
REG9     EQU   @09
REG10    EQU   @10
REG12    EQU   @12
RTNREG   EQU   @15
REG14    EQU   @14
DEFVR1   EQU   @01
REG0     EQU   @00
REG1     EQU   @01
REG11    EQU   @11
REG13    EQU   @13
REG15    EQU   @15
REG2     EQU   @02
REG3     EQU   @03
REG4     EQU   @04
REG5     EQU   @05
REG6     EQU   @06
REG7     EQU   @07
IDCSACL0 EQU   0
IDCSAEP0 EQU   0
IDCSAFS0 EQU   0
IDCSAAL0 EQU   0
IDCSADL0 EQU   0
IDCSASS0 EQU   0
IDCSANQ0 EQU   0
IDCSADQ0 EQU   0
IDCSA060 EQU   0
TRACE1   EQU   0
OLDERID1 EQU   TRACE1
TRACE2   EQU   0
OLDERID2 EQU   TRACE2
NEWID2   EQU   TRACE2+95
NEWERID2 EQU   5
CIRAGL   EQU   0
CIRTYPE  EQU   CIRAGL
ALLAGL   EQU   0
ALLDDN   EQU   ALLAGL+4
ALLULP   EQU   ALLAGL+12
ALLVLP   EQU   ALLAGL+16
ALLSTS   EQU   ALLAGL+24
ALLDSP   EQU   ALLAGL+25
ALLORG   EQU   ALLAGL+26
ALLOPT   EQU   ALLAGL+28
ALLOPTVL EQU   ALLOPT
ALLOPTPV EQU   ALLOPT
ALLVLCNT EQU   ALLAGL+29
ALLUNCNT EQU   ALLAGL+30
RACFAGL  EQU   0
RACFFLG1 EQU   RACFAGL
RACFFLG2 EQU   RACFAGL+1
RACFFLG3 EQU   RACFAGL+2
RACFFLG4 EQU   RACFAGL+3
UNITABL  EQU   0
UNITADR  EQU   UNITABL+4
@NM00017 EQU   UNITADR
UNITSTAT EQU   UNITABL+6
IDCIOCL0 EQU   0
IOCSTR   EQU   0
IOCDSO   EQU   IOCSTR+16
IOCRFM   EQU   IOCSTR+17
IOCMAC   EQU   IOCSTR+18
IOCMAC2  EQU   IOCSTR+19
IOCCHP   EQU   IOCSTR+20
IOCMSG   EQU   IOCSTR+21
IOCRBA   EQU   IOCSTR+40
IOCTTR   EQU   IOCRBA
IOCMEM   EQU   IOCSTR+44
IOCNWM   EQU   IOCSTR+48
IOCREL   EQU   IOCSTR+60
OPNAGL   EQU   0
OPNOPT   EQU   OPNAGL
OPNRFM   EQU   OPNAGL+1
OPNTYP   EQU   OPNAGL+2
OPNMOD   EQU   OPNAGL+3
OPNDEV   EQU   OPNAGL+24
OPNDSO   EQU   OPNAGL+41
OPNOPT2  EQU   OPNAGL+42
IOINFOPT EQU   0
UVOLLIST EQU   0
UVOLENT  EQU   UVOLLIST+2
AMSTP011 EQU   0
DARGLIST EQU   0
DARGDBP  EQU   DARGLIST
DARGRETP EQU   DARGLIST+4
DARGSTID EQU   DARGLIST+8
DARGSMOD EQU   DARGSTID
DARGSENT EQU   DARGSTID+3
DARGILP  EQU   DARGLIST+12
DARGCNT  EQU   DARGLIST+14
DARGRETL EQU   DARGLIST+16
DARGARY  EQU   DARGLIST+20
DARGINS  EQU   DARGARY
DARGINL  EQU   DARGARY+2
DARGDTM  EQU   DARGARY+4
FMTLIST  EQU   0
FMTFLGS  EQU   FMTLIST
FMTSPF   EQU   FMTLIST+2
FMTRFNO  EQU   FMTSPF
FMTILEN  EQU   FMTRFNO
FMTIOFF  EQU   FMTLIST+4
FMTTRBC  EQU   FMTIOFF
FMTSTO   EQU   FMTTRBC
FMTOCOL  EQU   FMTLIST+6
FMTCNVF  EQU   FMTLIST+10
ERCNVTAB EQU   0
ERTYPE   EQU   ERCNVTAB
EROPER   EQU   ERCNVTAB+1
EROSOPER EQU   ERCNVTAB+2
ERCATRC  EQU   ERCNVTAB+16
ERCPLPT  EQU   ERCNVTAB+20
IDCDB010 EQU   0
DMPITM   EQU   0
DMPITMNM EQU   DMPITM
DMPITMPT EQU   DMPITM+8
DMPITMLN EQU   DMPITM+12
DMPITMTP EQU   DMPITM+14
DMPARY   EQU   0
DMPTRM   EQU   0
CCMSG    EQU   0
CMMSG    EQU   0
CMVOLFLG EQU   CMMSG+6
CMDERAS  EQU   CMVOLFLG
CMEXCL   EQU   CMVOLFLG
CMBIND   EQU   CMVOLFLG
CMRONLY  EQU   CMVOLFLG
CMNEWVOL EQU   CMMSG+8
CTMSG    EQU   0
CTARRAY  EQU   CTMSG+4
MDAGL    EQU   0
MDUCBPTR EQU   MDAGL+8
MDDDNAME EQU   MDAGL+12
MDLABEL  EQU   MDAGL+24
MDFLAGS  EQU   MDAGL+30
MDWAIT   EQU   MDFLAGS
MDVTOC   EQU   MDAGL+32
PUAGL    EQU   0
CKAGL    EQU   0
CKUCBPTR EQU   CKAGL+8
CKDDNAME EQU   CKAGL+12
CKFLAGS  EQU   CKAGL+28
CKTESTVT EQU   CKFLAGS
EXCLAGL  EQU   0
EXCLUCBP EQU   EXCLAGL+8
EXCLDDP  EQU   EXCLAGL+12
EXCLVOL  EQU   EXCLAGL+16
EXCLFLAG EQU   EXCLAGL+22
EXOARG   EQU   0
EXOPT    EQU   EXOARG+32
EXFLG    EQU   EXOARG+33
EXGARG   EQU   0
EXWRARG  EQU   0
EXRWCHR  EQU   EXWRARG+26
EXSPACE  EQU   EXWRARG+36
EXPARG   EQU   0
EXPDATA  EQU   EXPARG+12
EXPDATAB EQU   0
EXPARRAY EQU   EXPDATAB+4
VS2AGL   EQU   0
VSUCBPTR EQU   VS2AGL+8
VSVOLPTR EQU   VS2AGL+20
VSLABOPT EQU   VS2AGL+28
VSVOLSER EQU   VSLABOPT
VSVOLUME EQU   VS2AGL+29
VS2MSG   EQU   VS2AGL+35
VS2RESOP EQU   VS2AGL+36
VS2RES   EQU   VS2RESOP
VSDDNAME EQU   VS2AGL+37
VS1AGL   EQU   0
VSUCBP   EQU   VS1AGL+8
VSVOLP   EQU   VS1AGL+12
VSFILEP  EQU   VS1AGL+16
VSIOP    EQU   VS1AGL+20
VSPFILEP EQU   VS1AGL+48
VSSECOPT EQU   VS1AGL+68
VSNOVSAM EQU   VSSECOPT
VSWRITE  EQU   VSSECOPT
VSVTOPT  EQU   VS1AGL+69
VSVSFLAG EQU   VSVTOPT
VSCATOPT EQU   VS1AGL+70
VSRETURN EQU   VS1AGL+71
VSVSAM   EQU   VSRETURN
VSMSG    EQU   VS1AGL+72
VSRESOPT EQU   VS1AGL+73
VSRES    EQU   VSRESOPT
RCTAGL   EQU   0
RCTOPT   EQU   RCTAGL+8
STAEPARM EQU   0
STARCVY  EQU   STAEPARM+52
STARETRY EQU   STAEPARM+53
VOLLABEL EQU   0
SV82LIST EQU   0
@NM00073 EQU   SV82LIST+4
SV82DCBP EQU   @NM00073
@NM00074 EQU   SV82LIST+12
SV82WRKP EQU   @NM00074
SRTAGL   EQU   0
LCTINFO  EQU   0
LCTFLAGS EQU   LCTINFO+32
UCTAGL   EQU   0
UCTFLAGS EQU   UCTAGL+68
SELAGL   EQU   0
SELFLAGS EQU   SELAGL+22
DATESAGL EQU   0
DATESOPT EQU   DATESAGL+20
VS3AGL   EQU   0
VS3FLAGS EQU   VS3AGL+58
VSDVTOC  EQU   0
VSDSTAT  EQU   0
VSDSFLG1 EQU   VSDSTAT+16
VSDFLG2  EQU   VSDSTAT+17
VSDSCR   EQU   0
VSDSCRFL EQU   VSDSCR+4
VSDUSAGE EQU   0
VSDDORG  EQU   VSDUSAGE+9
VSDALLOC EQU   VSDUSAGE+10
VSDUSEF  EQU   VSDUSAGE+11
VSDDSORG EQU   VSDUSAGE+16
VSDBLOCK EQU   0
VSDSPACE EQU   VSDBLOCK+12
VSDARRAY EQU   VSDBLOCK+16
VSDVARY  EQU   VSDARRAY+48
VOL      EQU   0
VOLLEN   EQU   VOL
VOLVAL   EQU   VOL+1
CDATE    EQU   0
DATE     EQU   0
DATEVAL  EQU   DATE
SEQ#     EQU   0
SEQ#VAL  EQU   SEQ#
CART     EQU   0
CARTLEN  EQU   CART
CARTVAL  EQU   CART+1
NSER     EQU   0
NSERVAL  EQU   NSER+1
RWOPT    EQU   0
FILE     EQU   0
FILEVAL  EQU   FILE+1
PFILE    EQU   0
@NM00093 EQU   PFILE+2
RVOL     EQU   0
BASEV    EQU   0
BASNAME  EQU   BASEV
BASSERNO EQU   BASNAME+5
BASID    EQU   BASNAME+11
BASFLAGA EQU   BASEV+14
BASTYPE  EQU   BASFLAGA
BASDLSF  EQU   BASFLAGA+2
BASGENUS EQU   BASFLAGA+2
BASINAC  EQU   BASFLAGA+2
BASREASS EQU   BASFLAGA+3
BASRCVYF EQU   BASEV+20
BASSATIA EQU   BASRCVYF
BASMISCF EQU   BASRCVYF+2
BASCSN1  EQU   BASEV+24
BASLIB1  EQU   BASEV+36
BASLID1  EQU   BASLIB1
BASLIB2  EQU   BASEV+49
BASLID2  EQU   BASLIB2
BASKLCPY EQU   BASEV+76
BASCOPID EQU   BASKLCPY+11
BASRECOV EQU   BASEV+174
BASGROUP EQU   BASEV+180
COPYV    EQU   0
COPNAME  EQU   COPYV
COPID    EQU   COPNAME+11
COPFLAGA EQU   COPYV+14
COPTYPE  EQU   COPFLAGA
COPVSAM  EQU   COPFLAGA+2
COPGENUS EQU   COPFLAGA+2
COPRCVYF EQU   COPYV+20
COPSATIA EQU   COPRCVYF
COPMISCF EQU   COPRCVYF+2
COPLIB1  EQU   COPYV+36
COPLID1  EQU   COPLIB1
COPLIB2  EQU   COPYV+49
COPLID2  EQU   COPLIB2
DUPV     EQU   0
DUPNAME  EQU   DUPV
DUPID    EQU   DUPNAME+11
DUPFLAGA EQU   DUPV+14
DUPTYPE  EQU   DUPFLAGA
DUPRCVYF EQU   DUPV+20
DUPLIB1  EQU   DUPV+36
DUPLID1  EQU   DUPLIB1
DUPLIB2  EQU   DUPV+49
DUPLID2  EQU   DUPLIB2
BCDV     EQU   0
BCDNAME  EQU   BCDV
BCDPREFX EQU   BCDNAME
BCDID    EQU   BCDNAME+11
BCDFLAGA EQU   BCDV+14
BCDTYPE  EQU   BCDFLAGA
BCDBASE  EQU   BCDTYPE
BCDCOPY  EQU   BCDTYPE
BCDDUP   EQU   BCDTYPE
BCDFLAGB EQU   BCDFLAGA+2
BCDRCVYF EQU   BCDV+20
BCDSATIA EQU   BCDRCVYF
BCDIVCRE EQU   BCDSATIA
BCDIVCPY EQU   BCDSATIA
BCDVSMIS EQU   BCDSATIA
BCDMISCF EQU   BCDRCVYF+2
BCDCSN1  EQU   BCDV+24
BCDLIB1  EQU   BCDV+36
BCDLID1  EQU   BCDLIB1
BCDLIB2  EQU   BCDV+49
BCDLID2  EQU   BCDLIB2
GROUP    EQU   0
GRONAME  EQU   GROUP
GROID    EQU   GRONAME+11
GROFLAGA EQU   GROUP+13
GROTYPE  EQU   GROFLAGA
GROBIND  EQU   GROFLAGA+2
GROEXCL  EQU   GROFLAGA+2
GRODAERA EQU   GROFLAGA+2
GRORONLY EQU   GROFLAGA+2
GROERRTS EQU   GROUP+56
RVVI     EQU   0
RVVLNGTH EQU   RVVI
RVVOPCOD EQU   RVVI+4
RVVCODE  EQU   RVVOPCOD
RVVOLUME EQU   RVVI+8
RVVGROUP EQU   RVVI+14
RVVBUFLN EQU   RVVI+30
RVVRTBUF EQU   RVVI+32
RVVCDATE EQU   RVVI+38
RVVRDSEQ EQU   RVVI+43
RVVRDCSN EQU   RVVI+44
RVVFLAGA EQU   RVVI+58
RVVRMODE EQU   RVVFLAGA
RVVRDR   EQU   RVVRMODE
RVVCHAIN EQU   RVVFLAGA+1
RVVRDRCD EQU   RVVFLAGA+2
RVVBVRCD EQU   RVVRDRCD
RVVGRPRC EQU   RVVRDRCD
RVVCPYRC EQU   RVVRDRCD
RVVDUPRC EQU   RVVRDRCD
RVVRUNKN EQU   RVVRDRCD
RVVRTEST EQU   RVVFLAGA+3
RVVCPYTP EQU   RVVFLAGA+4
RVVSPEC  EQU   RVVFLAGA+5
RVVSGRP  EQU   RVVSPEC
RVVSDTE  EQU   RVVSPEC
RVVSSEQ  EQU   RVVSPEC
RVVSCSN  EQU   RVVSPEC
RVVSVOL  EQU   RVVSPEC
MVR      EQU   0
MVRLNGTH EQU   MVR
MVRCODE  EQU   MVR+4
MVRFLAGA EQU   MVR+8
MVRFLBAS EQU   MVRFLAGA
MVRFLLAB EQU   MVRFLAGA
MVRCLMIS EQU   MVRFLAGA+1
MVRBVOL  EQU   MVR+12
MVRLABEL EQU   MVR+76
DEFLIST  EQU   0
DEFVFLG  EQU   DEFLIST+6
DEFVRNM  EQU   DEFVFLG
DEFVRNTR EQU   DEFVFLG
DEFVACT  EQU   DEFVFLG
DEFVDACT EQU   DEFVFLG
DEFVLIB  EQU   DEFLIST+7
DEFVOLD  EQU   DEFLIST+8
DEFVVFLG EQU   DEFLIST+14
DEFVSEC  EQU   DEFVVFLG
DEFVEXCL EQU   DEFVVFLG
DEFVBIND EQU   DEFVVFLG
DEFVWINH EQU   DEFVVFLG
DEFVNVOL EQU   DEFLIST+16
DEFVCSN1 EQU   DEFLIST+24
DEFVDATA EQU   DEFLIST+56
DEFVVEXT EQU   DEFLIST+128
DEFVE    EQU   0
DEFLNGTH EQU   DEFVE
DEFLABEL EQU   DEFVE+49
DEFFLAGA EQU   DEFVE+55
DEFPVLAB EQU   DEFFLAGA
DEFFLAGB EQU   DEFVE+56
DEFSETFL EQU   DEFFLAGB
DEFSRCVY EQU   DEFSETFL
DEFCRCVY EQU   DEFSETFL
DEFRECFL EQU   DEFFLAGB+1
DEFLAMIS EQU   DEFRECFL
DEFTYPFL EQU   DEFFLAGB+2
DEFDUP   EQU   DEFTYPFL
DEFNULFL EQU   DEFFLAGB+3
AMSTP041 EQU   0
AMSTP042 EQU   0
AMSTP043 EQU   0
AMSTP044 EQU   0
IDCIOCO0 EQU   0
IDCIOGT0 EQU   0
IDCIOIT0 EQU   0
IDCIOOP0 EQU   0
IDCIOPO0 EQU   0
IDCIOPT0 EQU   0
IDCIOSI0 EQU   0
IDCIOST0 EQU   0
IDCIOTM0 EQU   0
IDCIOVY0 EQU   0
IDCIO050 EQU   0
IDCSACA0 EQU   0
IDCSACR0 EQU   0
IDCSADE0 EQU   0
IDCSAFP0 EQU   0
IDCSAGP0 EQU   0
IDCSAGS0 EQU   0
IDCSAID0 EQU   0
IDCSALC0 EQU   0
IDCSALD0 EQU   0
IDCSALK0 EQU   0
IDCSAPR0 EQU   0
IDCSAPT0 EQU   0
IDCSAQL0 EQU   0
IDCSARC0 EQU   0
IDCSARK0 EQU   0
IDCSARV0 EQU   0
IDCSASC0 EQU   0
IDCSASI0 EQU   0
IDCSASN0 EQU   0
IDCSAST0 EQU   0
IDCSATI0 EQU   0
IDCSAUC0 EQU   0
IDCSAWO0 EQU   0
IDCST010 EQU   0
IDCTPER0 EQU   0
LISTTEST EQU   0
NEWERID1 EQU   5
GDTTBL   EQU   0
GDTTR1   EQU   GDTTBL+8
GDTTR2   EQU   GDTTBL+12
GDTDBG   EQU   GDTTBL+40
GDTSTC   EQU   GDTTBL+44
GDTPRT   EQU   GDTTBL+48
GDTESS   EQU   GDTTBL+52
GDTESA   EQU   GDTTBL+56
GDTRST   EQU   GDTTBL+60
GDTRES   EQU   GDTTBL+64
GDTCAL   EQU   GDTTBL+68
GDTGSP   EQU   GDTTBL+72
GDTFSP   EQU   GDTTBL+76
GDTGPL   EQU   GDTTBL+80
GDTFPL   EQU   GDTTBL+84
GDTLOD   EQU   GDTTBL+88
GDTDEL   EQU   GDTTBL+92
GDTPRL   EQU   GDTTBL+96
GDTEPL   EQU   GDTTBL+100
GDTTIM   EQU   GDTTBL+104
GDTIIO   EQU   GDTTBL+108
GDTTIO   EQU   GDTTBL+112
GDTOPN   EQU   GDTTBL+124
GDTCLS   EQU   GDTTBL+128
GDTGET   EQU   GDTTBL+132
GDTPUT   EQU   GDTTBL+136
GDTPOS   EQU   GDTTBL+140
GDTCPY   EQU   GDTTBL+144
GDTCAT   EQU   GDTTBL+148
GDTSNP   EQU   GDTTBL+164
GDTVFY   EQU   GDTTBL+172
GDTUID   EQU   GDTTBL+192
GDTPMT   EQU   GDTTBL+196
GDTCIR   EQU   GDTTBL+200
GDTLNK   EQU   GDTTBL+204
GDTALC   EQU   GDTTBL+208
GDTDLC   EQU   GDTTBL+212
GDTQAL   EQU   GDTTBL+216
GDTSTW   EQU   GDTTBL+220
GDTSSC   EQU   GDTTBL+224
GDTENQ   EQU   GDTTBL+228
GDTRSV   EQU   GDTTBL+232
GDTDEQ   EQU   GDTTBL+236
GDTSFO   EQU   GDTTBL+240
GDTWTO   EQU   GDTTBL+244
GDTSCR   EQU   GDTTBL+248
GDTUNT   EQU   GDTTBL+252
GDTRCT   EQU   GDTTBL+256
GDTIFO   EQU   GDTTBL+260
GDTEXP   EQU   GDTTBL+264
GDTSTA   EQU   GDTTBL+268
GDTERR   EQU   GDTTBL+272
GDTUNC   EQU   GDTTBL+276
GDTLOC   EQU   GDTTBL+280
GDTRCK   EQU   GDTTBL+284
FDTTBL   EQU   0
FDTPTR   EQU   FDTTBL+8
LASTCOND EQU   0
CKCSNVAL EQU   0
CKLENGTH EQU   0
SSRCODE  EQU   0
SSRHALF  EQU   SSRCODE+2
SSECBCD  EQU   0
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS
@NM00134 EQU   SSRCODE
FDTVERB  EQU   FDTTBL
GDTECT   EQU   GDTTBL+188
GDTPSB   EQU   GDTTBL+184
GDTUPT   EQU   GDTTBL+180
GDTCMB   EQU   GDTTBL+176
GDTSPR   EQU   GDTTBL+168
@NM00001 EQU   GDTTBL+160
GDTABH   EQU   GDTTBL+156
GDTABT   EQU   GDTTBL+152
GDTTOH   EQU   GDTTBL+120
GDTRIP   EQU   GDTTBL+116
GDTIOH   EQU   GDTTBL+36
GDTSAH   EQU   GDTTBL+32
GDTTPH   EQU   GDTTBL+28
GDTRIH   EQU   GDTTBL+24
GDTSTH   EQU   GDTTBL+20
GDTDBH   EQU   GDTTBL+16
GDTPRM   EQU   GDTTBL+4
GDTHDR   EQU   GDTTBL
@NM00128 EQU   DEFVE+60
@NM00127 EQU   DEFNULFL
DEFNEXPD EQU   DEFNULFL
DEFNDESC EQU   DEFNULFL
DEFNGRP  EQU   DEFNULFL
@NM00126 EQU   DEFTYPFL
DEFCOPY  EQU   DEFTYPFL
DEFRSTD  EQU   DEFTYPFL
DEFGENUS EQU   DEFTYPFL
@NM00125 EQU   DEFRECFL
DEFCREAT EQU   DEFRECFL
DEFICOPY EQU   DEFRECFL
@NM00124 EQU   DEFSETFL
@NM00123 EQU   DEFFLAGA
DEFPBKUP EQU   DEFFLAGA
DEFPTO   EQU   DEFFLAGA
DEFPDESC EQU   DEFFLAGA
DEFPGRO  EQU   DEFFLAGA
DEFPFOR  EQU   DEFFLAGA
DEFBKUPN EQU   DEFVE+48
DEFFOR   EQU   DEFVE+46
DEFTO    EQU   DEFVE+42
DEFDESCR EQU   DEFVE+12
DEFGROUP EQU   DEFVE+4
DEFTLAB  EQU   DEFVDATA+71
DEFR60   EQU   DEFVDATA+43
DEFOWNID EQU   DEFVDATA+29
DEFR55   EQU   DEFVDATA+3
DEFACSEC EQU   DEFVDATA+2
DEFR50   EQU   DEFVDATA
DEFVECB  EQU   DEFLIST+52
DEFVASID EQU   DEFLIST+50
@NM00122 EQU   DEFLIST+48
DEFVCSN2 EQU   DEFLIST+36
@NM00121 EQU   DEFLIST+22
@NM00120 EQU   DEFLIST+15
@NM00119 EQU   DEFVVFLG
@NM00118 EQU   DEFVVFLG
@NM00117 EQU   DEFVVFLG
DEFVCECT EQU   DEFVVFLG
DEFVLID  EQU   DEFVLIB
@NM00116 EQU   DEFVLIB
DEFVELTR EQU   DEFVFLG
DEFVREP  EQU   DEFVFLG
DEFVELM  EQU   DEFVFLG
DEFVCR   EQU   DEFVFLG
@NM00115 EQU   DEFLIST+5
DEFVOPCD EQU   DEFLIST+4
DEFVLEN  EQU   DEFLIST
@NM00114 EQU   MVR+82
MVRBLNK1 EQU   MVR+75
MVRBKUPN EQU   MVR+74
MVRCSN   EQU   MVR+62
MVRTO    EQU   MVR+58
MVRDES   EQU   MVR+28
MVRGROUP EQU   MVR+20
MVRFOR   EQU   MVR+18
@NM00113 EQU   MVRFLAGA+2
MVRCICPY EQU   MVRFLAGA+2
MVRCIVCF EQU   MVRFLAGA+2
MVRSLMIS EQU   MVRFLAGA+1
MVRNEXPD EQU   MVRFLAGA+1
MVRNDESC EQU   MVRFLAGA+1
MVRBKUP  EQU   MVRFLAGA+1
MVRNGRP  EQU   MVRFLAGA+1
MVRRSTD  EQU   MVRFLAGA+1
MVRGEN   EQU   MVRFLAGA+1
MVRFLBK  EQU   MVRFLAGA
MVRFLCSN EQU   MVRFLAGA
MVRFLTO  EQU   MVRFLAGA
MVRFLDES EQU   MVRFLAGA
MVRFLGRO EQU   MVRFLAGA
MVRFLFOR EQU   MVRFLAGA
@NM00112 EQU   MVRCODE+1
MVROPCD  EQU   MVRCODE
@NM00111 EQU   RVVI+64
RVVSDUP  EQU   RVVSPEC
RVVSCPY  EQU   RVVSPEC
RVVSEXP  EQU   RVVSPEC
@NM00110 EQU   RVVCPYTP
RVVCPLHD EQU   RVVCPYTP
RVVLCOPY EQU   RVVCPYTP
RVVOBKUP EQU   RVVCPYTP
RVVLBKUP EQU   RVVCPYTP
RVVBPLHD EQU   RVVRTEST
RVVDVOL  EQU   RVVRTEST
RVVACTV  EQU   RVVRTEST
RVVINACT EQU   RVVRTEST
RVVRSTD  EQU   RVVRTEST
RVVGSVOL EQU   RVVRTEST
RVVTHOLD EQU   RVVRTEST
RVVEXPDT EQU   RVVRTEST
RVVALL   EQU   RVVRDRCD
RVVCPURC EQU   RVVRDRCD
RVVCIRCD EQU   RVVRDRCD
@NM00109 EQU   RVVCHAIN
RVVNGVOL EQU   RVVCHAIN
RVVGPVOL EQU   RVVCHAIN
@NM00108 EQU   RVVRMODE
RVVRDCH  EQU   RVVRMODE
RVVRDNR  EQU   RVVRMODE
RVVDUPID EQU   RVVI+57
RVVCPYID EQU   RVVI+56
RVVBLNK1 EQU   RVVI+42
RVVEXPIR EQU   RVVI+36
@NM00107 EQU   RVVI+28
RVVAREA  EQU   RVVI+24
RVVARLN  EQU   RVVI+22
@NM00106 EQU   RVVOPCOD+1
@NM00105 EQU   GROUP+136
GROADDR  EQU   GROUP+106
GROOWNER EQU   GROUP+96
GRORESSP EQU   GROUP+95
GROCONUS EQU   GROUP+94
GRODESCR EQU   GROUP+64
GROERRTM EQU   GROERRTS+4
GROERRDT EQU   GROERRTS
GRORETPD EQU   GROUP+52
GROFREXT EQU   GROUP+48
GROFRESP EQU   GROUP+44
GROSTRSH EQU   GROUP+40
GROSSPD  EQU   GROUP+38
GROPSPD  EQU   GROUP+36
GRONINAC EQU   GROUP+34
GRONRSTD EQU   GROUP+32
GRONGEN  EQU   GROUP+30
GROPCENT EQU   GROUP+29
GROLSN   EQU   GROUP+23
GROFSN   EQU   GROUP+17
@NM00104 EQU   GROFLAGA+2
GROMSG1  EQU   GROFLAGA+2
GRORETN  EQU   GROFLAGA+2
GRORLSE  EQU   GROFLAGA+2
GRORES1  EQU   GROTYPE
GROGVR   EQU   GROTYPE
GROZERO  EQU   GROID+1
GROBLANK EQU   GROID
GROVVGRP EQU   GRONAME+3
GROG     EQU   GRONAME
BCD2BIT2 EQU   BCDLID2
BCD2BIT1 EQU   BCDLID2
BCDRES8  EQU   BCDLIB2
BCDCSN2  EQU   BCDV+37
BCD1BIT2 EQU   BCDLID1
BCD1BIT1 EQU   BCDLID1
BCDRE10  EQU   BCDLIB1
BCDRES7A EQU   BCDMISCF
BCDHOLD  EQU   BCDMISCF
BCDRES7  EQU   BCDSATIA
BCDCPUID EQU   BCDV+18
BCDRES5  EQU   BCDFLAGB+1
BCDREASS EQU   BCDFLAGB+1
BCDRES4  EQU   BCDFLAGB
BCDRES3  EQU   BCDTYPE
BCDRES2  EQU   BCDTYPE
BCDRES1  EQU   BCDTYPE
BCDRES9  EQU   BCDV+13
BCDINDEX EQU   BCDID+1
BCDBLNK2 EQU   BCDID
BCDSERNO EQU   BCDNAME+5
BCDBLNK1 EQU   BCDPREFX+1
BCDALPHA EQU   BCDPREFX
@NM00103 EQU   DUPV+50
DUP2BIT2 EQU   DUPLID2
DUP2BIT1 EQU   DUPLID2
DUPRES4  EQU   DUPLIB2
DUPCSN2  EQU   DUPV+37
DUP1BIT2 EQU   DUPLID1
DUP1BIT1 EQU   DUPLID1
DUPRES3  EQU   DUPLIB1
DUPCSN1  EQU   DUPV+24
DUPMISCF EQU   DUPRCVYF+2
DUPSATIA EQU   DUPRCVYF
@NM00102 EQU   DUPV+18
@NM00101 EQU   DUPFLAGA+2
DUPRES2  EQU   DUPTYPE
DUPDUPLR EQU   DUPTYPE
DUPRES1  EQU   DUPTYPE
DUPRES5  EQU   DUPV+13
DUPNO    EQU   DUPID+1
DUPBLANK EQU   DUPID
DUPSERNO EQU   DUPNAME+5
DUPD     EQU   DUPNAME
@NM00100 EQU   COPYV+136
COPFREXT EQU   COPYV+132
COPLEXT  EQU   COPYV+130
COPFRESP EQU   COPYV+128
COPOWNER EQU   COPYV+118
COPDEST  EQU   COPYV+88
COPDESCR EQU   COPYV+58
COPDTREM EQU   COPYV+54
COPDATE  EQU   COPYV+50
COP2BIT2 EQU   COPLID2
COP2BIT1 EQU   COPLID2
COPRES5  EQU   COPLIB2
COPCSN2  EQU   COPYV+37
COP1BIT2 EQU   COPLID1
COP1BIT1 EQU   COPLID1
COPRES4  EQU   COPLIB1
COPCSN1  EQU   COPYV+24
@NM00099 EQU   COPMISCF
COPHOLD  EQU   COPMISCF
COPRES3  EQU   COPSATIA
COPVSMIS EQU   COPSATIA
COPIVCPY EQU   COPSATIA
COPIVCRE EQU   COPSATIA
@NM00098 EQU   COPYV+18
@NM00097 EQU   COPFLAGA+3
COPDLSPF EQU   COPFLAGA+3
COPRONLY EQU   COPFLAGA+3
COPDAERA EQU   COPFLAGA+2
COPEXCL  EQU   COPFLAGA+2
COPBIND  EQU   COPFLAGA+2
COPBKUP  EQU   COPFLAGA+2
COPRSTD  EQU   COPFLAGA+2
COPGROUP EQU   COPFLAGA+2
COPRES2  EQU   COPTYPE
COPCOPYV EQU   COPTYPE
COPRES1  EQU   COPTYPE
COPRES6  EQU   COPYV+13
COPNO    EQU   COPID+1
COPBLANK EQU   COPID
COPSERNO EQU   COPNAME+5
COPV     EQU   COPNAME
@NM00096 EQU   BASEV+192
BASXPDT2 EQU   BASEV+188
BASDEST  EQU   BASEV+144
BASOWNER EQU   BASEV+134
BASDESCR EQU   BASEV+104
BASDTREM EQU   BASEV+100
BASEXPDT EQU   BASEV+96
BASDLMTD EQU   BASEV+92
BASRES6  EQU   BASEV+89
BASCOPNO EQU   BASCOPID+1
BASCOPBK EQU   BASCOPID
BASCOPSN EQU   BASKLCPY+5
BASCOPV  EQU   BASKLCPY
BASFREXT EQU   BASEV+72
BASLEXT  EQU   BASEV+70
BASFRESP EQU   BASEV+68
@NM00095 EQU   BASEV+65
BASBKLMT EQU   BASEV+64
BASNBKUP EQU   BASEV+63
BASNCOPY EQU   BASEV+62
BASNEXTV EQU   BASEV+56
BASPREV  EQU   BASEV+50
BAS2BIT2 EQU   BASLID2
BAS2BIT1 EQU   BASLID2
BASRES5  EQU   BASLIB2
BASCSN2  EQU   BASEV+37
BAS1BIT2 EQU   BASLID1
BAS1BIT1 EQU   BASLID1
BASRES4  EQU   BASLIB1
BASRES3  EQU   BASMISCF
BASHOLD  EQU   BASMISCF
BASRES8  EQU   BASSATIA
BASVSMIS EQU   BASSATIA
BASIVCPY EQU   BASSATIA
BASIVCRE EQU   BASSATIA
BASCPUID EQU   BASEV+18
@NM00094 EQU   BASFLAGA+3
BASLAST  EQU   BASFLAGA+3
BASFIRST EQU   BASFLAGA+3
BASRONLY EQU   BASFLAGA+3
BASDAERA EQU   BASFLAGA+3
BASEXCL  EQU   BASFLAGA+2
BASBIND  EQU   BASFLAGA+2
BASRSTD  EQU   BASFLAGA+2
BASGRPV  EQU   BASFLAGA+2
BASNOCPY EQU   BASFLAGA+2
BASRES2  EQU   BASTYPE
BASBASVR EQU   BASTYPE
BASRES1  EQU   BASTYPE
BASRES7  EQU   BASEV+13
BASZERO  EQU   BASID+1
BASBLANK EQU   BASID
BASEVKEY EQU   BASNAME
PFILEVAL EQU   @NM00093+1
PFILELEN EQU   @NM00093
PFILECNT EQU   PFILE
FILELEN  EQU   FILE
NSERLEN  EQU   NSER
VSDDSN   EQU   VSDARRAY+4
VSDVOLCT EQU   VSDARRAY
VSDFMT0  EQU   VSDBLOCK+8
VSDVTOCS EQU   VSDBLOCK+4
VSDELEM  EQU   VSDBLOCK
VSDFREE  EQU   VSDUSAGE+24
VSDALLC  EQU   VSDUSAGE+19
VSDDSOR3 EQU   VSDDSORG+2
@NM00092 EQU   VSDDSORG
VSDSCAL  EQU   VSDUSAGE+12
@NM00091 EQU   VSDUSEF
VSDCALFR EQU   VSDUSEF
@NM00090 EQU   VSDALLOC
VSDABSTR EQU   VSDALLOC
VSDABLK  EQU   VSDALLOC
VSDATRK  EQU   VSDALLOC
VSDACYL  EQU   VSDALLOC
@NM00089 EQU   VSDDORG
VSDOU    EQU   VSDDORG
VSDOIS   EQU   VSDDORG
VSDODA   EQU   VSDDORG
VSDOUN   EQU   VSDDORG
VSDOPS   EQU   VSDDORG
VSDOPO   EQU   VSDDORG
VSDEXTS  EQU   VSDUSAGE+8
VSDSECAL EQU   VSDUSAGE+4
VSDFTRK  EQU   VSDUSAGE+2
VSDTRKS  EQU   VSDUSAGE
@NM00088 EQU   VSDSCR+5
@NM00087 EQU   VSDSCRFL
VSDVSAM  EQU   VSDSCRFL
VSDCATLC EQU   VSDSCRFL
VSDACBPT EQU   VSDSCR
@NM00086 EQU   VSDSTAT+29
VSDPRTC  EQU   VSDSTAT+25
VSDCAT   EQU   VSDSTAT+22
VSDEXP   EQU   VSDSTAT+20
VSDCRE   EQU   VSDSTAT+18
@NM00085 EQU   VSDFLG2
VSDRACF  EQU   VSDFLG2
VSDERROR EQU   VSDFLG2
VSDPROT  EQU   VSDFLG2
VSDPWW   EQU   VSDFLG2
VSDPWR   EQU   VSDFLG2
@NM00084 EQU   VSDSFLG1
VSDCVSAM EQU   VSDSFLG1
VSDCATLG EQU   VSDSFLG1
VSDVSAME EQU   VSDSFLG1
VSDVSAMC EQU   VSDSFLG1
VSDVTOCE EQU   VSDSFLG1
VSDVTOCC EQU   VSDSFLG1
VSDOWNER EQU   VSDSTAT+8
VSDEXPIR EQU   VSDSTAT+4
VSDCREAT EQU   VSDSTAT
VSDFRCCL EQU   VSDVTOC+21
@NM00083 EQU   VSDVTOC+20
VSDFREXT EQU   VSDVTOC+16
@NM00082 EQU   VSDVTOC+15
VSDFRTRK EQU   VSDVTOC+11
@NM00081 EQU   VSDVTOC+10
VSDFRCYL EQU   VSDVTOC+6
@NM00080 EQU   VSDVTOC
@NM00079 EQU   VS3FLAGS
VS3SYSNM EQU   VS3FLAGS
VS3UNCAT EQU   VS3FLAGS
VS3SCR   EQU   VS3FLAGS
VS3USAGE EQU   VS3FLAGS
VS3STAT  EQU   VS3FLAGS
VS3DD    EQU   VS3AGL+50
VS3VOL   EQU   VS3AGL+44
VS3POOL  EQU   VS3AGL+40
VS3DEV   EQU   VS3AGL+36
VS3UCBP  EQU   VS3AGL+32
VS3CREAT EQU   VS3AGL+28
VS3EXPIR EQU   VS3AGL+24
VS3AST   EQU   VS3AGL+22
VS3LEVLN EQU   VS3AGL+20
VS3LEVP  EQU   VS3AGL+16
VS3EXDSP EQU   VS3AGL+12
VS3LISTP EQU   VS3AGL+8
VS3HEAD  EQU   VS3AGL
@NM00078 EQU   DATESOPT
DATDAYOP EQU   DATESOPT
DATDTEOP EQU   DATESOPT
DATSUB   EQU   DATESOPT
DATADD   EQU   DATESOPT
DATRETRN EQU   DATESAGL+16
DATDAYS  EQU   DATESAGL+12
DATDATE  EQU   DATESAGL+8
DATHEAD  EQU   DATESAGL
@NM00077 EQU   SELFLAGS
SELVOL   EQU   SELAGL+16
SELDDNP  EQU   SELAGL+12
SELUCBP  EQU   SELAGL+8
SELHEAD  EQU   SELAGL
@NM00076 EQU   UCTFLAGS
UCTVSCAT EQU   UCTFLAGS
UCTDD    EQU   UCTAGL+60
UCTVOLP  EQU   UCTAGL+56
UCTACBP  EQU   UCTAGL+52
UCTDSN   EQU   UCTAGL+8
UCTHEAD  EQU   UCTAGL
@NM00075 EQU   LCTFLAGS
LCTVSCAT EQU   LCTFLAGS
LCTOWNER EQU   LCTINFO+24
LCTEXPIR EQU   LCTINFO+20
LCTCREAT EQU   LCTINFO+16
LCTACBP  EQU   LCTINFO+12
LCTMULVC EQU   LCTINFO+8
LCTHEAD  EQU   LCTINFO
SRTWORKP EQU   SRTAGL+28
SRTFLDLN EQU   SRTAGL+24
SRTPOSIT EQU   SRTAGL+20
SRTLEN   EQU   SRTAGL+16
SRTNUM   EQU   SRTAGL+12
SRTADDR  EQU   SRTAGL+8
SRTHEAD  EQU   SRTAGL
SV82DEBP EQU   SV82WRKP
SV82TTRP EQU   SV82LIST+8
SV82VOLP EQU   SV82DCBP
SV82UCBP EQU   SV82LIST+1
SV82CODE EQU   SV82LIST
VOLRESV3 EQU   VOLLABEL+55
VOLOWNER EQU   VOLLABEL+45
VOLRESV1 EQU   VOLLABEL+20
VOLVTOC  EQU   VOLLABEL+15
VOLSECTY EQU   VOLLABEL+14
VOLSERNO EQU   VOLLABEL+8
VOLNO    EQU   VOLLABEL+7
VOLLABI  EQU   VOLLABEL+4
VOLKEY   EQU   VOLLABEL
STAVTTR  EQU   STAEPARM+54
@NM00072 EQU   STARETRY
STAVTOC  EQU   STARETRY
STAOFF   EQU   STARETRY
STAIO05  EQU   STARETRY
@NM00071 EQU   STARCVY
STACLEAR EQU   STARCVY
STAVPOST EQU   STARCVY
STAVENQ  EQU   STARCVY
STAVDMNT EQU   STARCVY
STAVMNT  EQU   STARCVY
STATCB   EQU   STAEPARM+48
STARTADD EQU   STAEPARM+44
STAEXSAV EQU   STAEPARM+40
STARTSAV EQU   STAEPARM+36
STARTTR  EQU   STAEPARM+32
@NM00070 EQU   STAEPARM+30
STARVOL  EQU   STAEPARM+24
STARUCB  EQU   STAEPARM+20
@NM00069 EQU   STAEPARM+18
STAVVOL  EQU   STAEPARM+12
STAVUCB  EQU   STAEPARM+8
STAHEAD  EQU   STAEPARM
RCTDSET  EQU   RCTAGL+32
RCTNVOL  EQU   RCTAGL+26
RCTOVOL  EQU   RCTAGL+20
RCTNDEV  EQU   RCTAGL+16
RCTODEV  EQU   RCTAGL+12
@NM00068 EQU   RCTAGL+10
@NM00067 EQU   RCTOPT
RCTVOL   EQU   RCTOPT
RCTDEV   EQU   RCTOPT
RCTHEAD  EQU   RCTAGL
@NM00066 EQU   VSRESOPT
VSREAL   EQU   VSRESOPT
@NM00065 EQU   VSMSG
VSTOV    EQU   VSMSG
VSFROMV  EQU   VSMSG
@NM00064 EQU   VSRETURN
VSUCAT   EQU   VSRETURN
@NM00063 EQU   VSCATOPT
VSLIST   EQU   VSCATOPT
VSSERIAL EQU   VSCATOPT
VSDEVICE EQU   VSCATOPT
@NM00062 EQU   VSVTOPT
VSALTTRK EQU   VSVTOPT
VSTIME   EQU   VSVTOPT
VSUCMAST EQU   VSSECOPT
VSOPCAT  EQU   VSSECOPT
VSUCTEST EQU   VSSECOPT
VSREAD   EQU   VSSECOPT
VSNONONV EQU   VSSECOPT
VSMASTER EQU   VSSECOPT
VSODEVP  EQU   VS1AGL+64
VSOSERP  EQU   VS1AGL+60
VSDEVP   EQU   VS1AGL+56
VSSERP   EQU   VS1AGL+52
VSPSWDP  EQU   VS1AGL+44
VSCATDDP EQU   VS1AGL+40
VSACBP   EQU   VS1AGL+36
VSCATP   EQU   VS1AGL+32
VSNXTATP EQU   VS1AGL+28
VSNUMATP EQU   VS1AGL+24
VSHEAD   EQU   VS1AGL
VSVTOCPT EQU   VS2AGL+48
@NM00061 EQU   VS2AGL+45
@NM00060 EQU   VS2RESOP
VS2REAL  EQU   VS2RESOP
@NM00059 EQU   VS2MSG
VS2TOV   EQU   VS2MSG
@NM00058 EQU   VSLABOPT
VSNOVTOC EQU   VSLABOPT
VSOWNER  EQU   VSLABOPT
VSIOBKPT EQU   VS2AGL+24
VSOWNPTR EQU   VS2AGL+16
VSVTOCSZ EQU   VS2AGL+12
VS2HEAD  EQU   VS2AGL
EXPDATAL EQU   EXPARRAY+6
@NM00057 EQU   EXPARRAY+5
EXPKEYLN EQU   EXPARRAY+4
EXPDATAP EQU   EXPARRAY
EXPRECNO EQU   EXPDATAB
EXPCCHHR EQU   EXPARG+16
EXPCTLBK EQU   EXPARG+8
EXPHEAD  EQU   EXPARG
EXRWFUN  EQU   EXWRARG+46
@NM00056 EQU   EXSPACE+8
@NM00055 EQU   EXSPACE+6
@NM00054 EQU   EXSPACE+4
@NM00053 EQU   EXSPACE+1
@NM00052 EQU   EXSPACE
EXRWKDLN EQU   EXWRARG+32
@NM00051 EQU   EXWRARG+31
EXRECNUM EQU   EXRWCHR+4
EXHH     EQU   EXRWCHR+2
EXCC     EQU   EXRWCHR
EXCCWCNT EQU   EXWRARG+24
EXLOCPTR EQU   EXWRARG+20
EXRWDARE EQU   EXWRARG+16
EXRWIOAR EQU   EXWRARG+12
EXRWCTBL EQU   EXWRARG+8
EXRWRES  EQU   EXWRARG
EXGDATAL EQU   EXGARG+30
@NM00050 EQU   EXGARG+29
EXGKEYLN EQU   EXGARG+28
EXGDATAP EQU   EXGARG+24
EXGRECNO EQU   EXGARG+20
EXGCCHH2 EQU   EXGARG+16
EXGCCHH1 EQU   EXGARG+12
EXGCTLBK EQU   EXGARG+8
EXGHEAD  EQU   EXGARG
EXOVTH   EQU   EXFLG
EXORVT   EQU   EXFLG
EXORDS   EQU   EXFLG
EXOSPK   EQU   EXFLG
EXORVS   EQU   EXFLG
@NM00049 EQU   EXFLG
EXOREAD  EQU   EXFLG
@NM00048 EQU   EXOPT
EXOREP   EQU   EXOPT
EXOVTOC  EQU   EXOPT
EXONEW   EQU   EXOPT
EXOPASS  EQU   EXOPT
EXOLAB   EQU   EXOPT
EXOTAB   EQU   EXOPT
EXOCTLBK EQU   EXOARG+28
EXOEXT   EQU   EXOARG+24
EXOUCB   EQU   EXOARG+20
EXOVSN   EQU   EXOARG+16
EXODSN   EQU   EXOARG+12
EXODDN   EQU   EXOARG+8
EXOHEAD  EQU   EXOARG
@NM00047 EQU   EXCLFLAG
EXCLMNT  EQU   EXCLFLAG
EXCLHEAD EQU   EXCLAGL
@NM00046 EQU   CKFLAGS
CKDMTABL EQU   CKFLAGS
CKRETTYP EQU   CKFLAGS
CKLABELP EQU   CKAGL+24
CKDATYPE EQU   CKAGL+20
CKHEAD   EQU   CKAGL
PULABELP EQU   PUAGL+16
PUTTRPTR EQU   PUAGL+12
PUUCBPTR EQU   PUAGL+8
PUHEAD   EQU   PUAGL
MDR      EQU   MDVTOC+4
MDHH     EQU   MDVTOC+2
MDCC     EQU   MDVTOC
@NM00045 EQU   MDAGL+31
MDVTOCTR EQU   MDFLAGS
MDFORCE  EQU   MDFLAGS
MDDEQ    EQU   MDFLAGS
MDENQ    EQU   MDFLAGS
MDPOST   EQU   MDFLAGS
MDCLEAR  EQU   MDFLAGS
MDNEWVOL EQU   MDFLAGS
MDPUAGL  EQU   MDAGL+20
MDHEAD   EQU   MDAGL
CTTBLRR  EQU   CTARRAY+3
CTTBLHH  EQU   CTARRAY+2
CTTBLCC  EQU   CTARRAY+1
CTTBLID  EQU   CTARRAY
CTREALH  EQU   CTMSG+3
CTREALCC EQU   CTMSG+1
@NM00044 EQU   CTMSG
CMCSN2   EQU   CMMSG+28
CMCSN1   EQU   CMMSG+16
CMNUMCRT EQU   CMMSG+15
@NM00043 EQU   CMMSG+14
@NM00042 EQU   CMMSG+7
@NM00041 EQU   CMVOLFLG
CMSCRCRT EQU   CMVOLFLG
CMSCRVOL EQU   CMVOLFLG
CMCECART EQU   CMVOLFLG
CMOLDVOL EQU   CMMSG
CCOLDCSN EQU   CCMSG+24
CCNEWCSN EQU   CCMSG+12
@NM00040 EQU   CCMSG+10
CCVOL    EQU   CCMSG+4
@NM00039 EQU   CCMSG+2
CCEJCODE EQU   CCMSG+1
CCPSTCDE EQU   CCMSG
@NM00038 EQU   DMPARY+15
DMPARYTP EQU   DMPARY+14
DMPARYEX EQU   DMPARY+12
DMPARYIC EQU   DMPARY+10
DMPARYSZ EQU   DMPARY+8
DMPARYNM EQU   DMPARY
@NM00037 EQU   DMPITM+15
@NM00036 EQU   ERCNVTAB+24
ERDARBPT EQU   ERCPLPT
ERDYNRC  EQU   ERCATRC
ERDSNM   EQU   ERCNVTAB+12
@NM00035 EQU   ERCNVTAB+4
@NM00034 EQU   ERCNVTAB+3
@NM00033 EQU   EROSOPER
EROSUCDX EQU   EROSOPER
EROSCATL EQU   EROSOPER
@NM00032 EQU   EROPER
ERCATAL  EQU   EROPER
ERCATDL  EQU   EROPER
ERCATDE  EQU   EROPER
ERCATLC  EQU   EROPER
@NM00031 EQU   ERTYPE
ERDYNAL  EQU   ERTYPE
EROSCAT  EQU   ERTYPE
ERCATLG  EQU   ERTYPE
@NM00030 EQU   FMTCNVF+1
FMTAR    EQU   FMTCNVF+1
FMTBS    EQU   FMTCNVF+1
FMTSS    EQU   FMTCNVF+1
FMTAL    EQU   FMTCNVF+1
FMTZS    EQU   FMTCNVF+1
@NM00029 EQU   FMTCNVF
FMTPU    EQU   FMTCNVF
FMTBD    EQU   FMTCNVF
FMTBHD   EQU   FMTCNVF
FMTBHA   EQU   FMTCNVF
FMTBH    EQU   FMTCNVF
FMTOLEN  EQU   FMTLIST+8
FMTRIO   EQU   FMTOCOL
FMTSPT   EQU   FMTSTO
FMTSTL   EQU   FMTILEN
@NM00028 EQU   FMTFLGS+1
FMTSMSG  EQU   FMTFLGS+1
FMTHDF   EQU   FMTFLGS
FMTDFF   EQU   FMTFLGS
FMTSTF   EQU   FMTFLGS
FMTREPF  EQU   FMTFLGS
FMTBDF   EQU   FMTFLGS
FMTIDF   EQU   FMTFLGS
FMTSCF   EQU   FMTFLGS
FMTEOLF  EQU   FMTFLGS
DARGPCT  EQU   DARGINL
DARGREP  EQU   DARGINS
@NM00027 EQU   DARGLIST+19
DARGIND  EQU   DARGLIST+18
UVOLVOL  EQU   UVOLENT+4
UVOLDEV  EQU   UVOLENT
UVOLCNT  EQU   UVOLLIST
@NM00026 EQU   IOINFOPT
IOINFLUB EQU   IOINFOPT
IOINFTMS EQU   IOINFOPT
IOINFSUP EQU   IOINFOPT
IOINFDSN EQU   IOINFOPT
IOINFVOL EQU   IOINFOPT
IOINFDVT EQU   IOINFOPT
OPNVOL   EQU   OPNAGL+44
OPNSTRNO EQU   OPNAGL+43
@NM00025 EQU   OPNOPT2
OPNOPTJM EQU   OPNOPT2
OPNOPTNM EQU   OPNOPT2
OPNOPTAS EQU   OPNOPT2
@NM00024 EQU   OPNDSO
OPNDSOPO EQU   OPNDSO
OPNDSOIS EQU   OPNDSO
OPNDSOPS EQU   OPNDSO
OPNDSOAM EQU   OPNDSO
OPNKYL   EQU   OPNAGL+40
OPNBLK   EQU   OPNAGL+36
OPNREC   EQU   OPNAGL+32
OPNDEVIX EQU   OPNDEV+4
OPNDEVDT EQU   OPNDEV
OPNCBP   EQU   OPNAGL+20
OPNDSN   EQU   OPNAGL+16
OPNPWA   EQU   OPNAGL+12
OPNDDN   EQU   OPNAGL+8
OPNIOC   EQU   OPNAGL+4
OPNMODRP EQU   OPNMOD
OPNMODUB EQU   OPNMOD
OPNMODRS EQU   OPNMOD
OPNMODAX EQU   OPNMOD
OPNMODRR EQU   OPNMOD
OPNMODRC EQU   OPNMOD
OPNMODAC EQU   OPNMOD
OPNMODPD EQU   OPNMOD
OPNTYPSY EQU   OPNTYP
OPNTYPRV EQU   OPNTYP
OPNTYPEX EQU   OPNTYP
OPNTYPRA EQU   OPNTYP
OPNTYPXM EQU   OPNTYP
OPNTYPCI EQU   OPNTYP
OPNTYPSO EQU   OPNTYP
OPNTYPSI EQU   OPNTYP
@NM00023 EQU   OPNRFM
OPNRFMBK EQU   OPNRFM
OPNRFMSF EQU   OPNRFM
OPNRFMUN EQU   OPNRFM
OPNRFMVR EQU   OPNRFM
OPNRFMFX EQU   OPNRFM
OPNOPTSK EQU   OPNOPT
OPNOPTDR EQU   OPNOPT
OPNOPTCR EQU   OPNOPT
OPNOPTKS EQU   OPNOPT
OPNOPTBK EQU   OPNOPT
OPNOPTUP EQU   OPNOPT
OPNOPTOT EQU   OPNOPT
OPNOPTIN EQU   OPNOPT
IOCEXT   EQU   IOCSTR+64
IOCTSML  EQU   IOCREL+2
IOCTPML  EQU   IOCREL
IOCWORK  EQU   IOCSTR+56
IOCRRN   EQU   IOCSTR+52
IOCPNM   EQU   IOCNWM+2
IOCPTL   EQU   IOCNWM
IOCKYA   EQU   IOCMEM
IOCVRC   EQU   IOCTTR
IOCCBP   EQU   IOCSTR+36
IOCDSN   EQU   IOCSTR+32
IOCHURBA EQU   IOCSTR+28
IOCVOLSR EQU   IOCSTR+22
@NM00022 EQU   IOCMSG
IOCMSGSM EQU   IOCMSG
IOCMSGAE EQU   IOCMSG
IOCMSGCE EQU   IOCMSG
IOCMSGOE EQU   IOCMSG
IOCMSGOP EQU   IOCMSG
IOCCHPKG EQU   IOCMSG
IOCCHPKE EQU   IOCMSG
IOCCHPNU EQU   IOCCHP
IOCCHPUP EQU   IOCCHP
IOCCHPBK EQU   IOCCHP
IOCCHPCR EQU   IOCCHP
IOCCHPKS EQU   IOCCHP
IOCCHPSK EQU   IOCCHP
IOCCHPDR EQU   IOCCHP
IOCCHPSQ EQU   IOCCHP
IOCMACNT EQU   IOCMAC2
IOCMACER EQU   IOCMAC2
IOCMACPA EQU   IOCMAC2
IOCMACEN EQU   IOCMAC2
IOCMACCP EQU   IOCMAC2
IOCMACRR EQU   IOCMAC2
IOCMACAS EQU   IOCMAC2
IOCMACSK EQU   IOCMAC2
@NM00021 EQU   IOCMAC
IOCMACCC EQU   IOCMAC
IOCMACDR EQU   IOCMAC
IOCMACBK EQU   IOCMAC
IOCMACCR EQU   IOCMAC
IOCMACUP EQU   IOCMAC
IOCMACOT EQU   IOCMAC
IOCMACIN EQU   IOCMAC
@NM00020 EQU   IOCRFM
IOCRFMBK EQU   IOCRFM
IOCRFMSF EQU   IOCRFM
IOCRFMUN EQU   IOCRFM
IOCRFMVR EQU   IOCRFM
IOCRFMFX EQU   IOCRFM
@NM00019 EQU   IOCDSO
IOCDSOPO EQU   IOCDSO
IOCDSOIS EQU   IOCDSO
IOCDSOPS EQU   IOCDSO
IOCDSOAM EQU   IOCDSO
IOCRKP   EQU   IOCSTR+13
IOCKYL   EQU   IOCSTR+12
IOCTRN   EQU   IOCSTR+8
IOCDLN   EQU   IOCSTR+4
IOCDAD   EQU   IOCSTR
UNITVTOC EQU   UNITABL+7
@NM00018 EQU   UNITSTAT
UNITUSHR EQU   UNITSTAT
UNITXSHR EQU   UNITSTAT
UNITISHR EQU   UNITSTAT
UNITUA   EQU   @NM00017+1
UNITCHA  EQU   @NM00017
UNITUCB  EQU   UNITABL
RACFVOLS EQU   RACFAGL+16
RACFCLN  EQU   RACFAGL+12
RACFPROF EQU   RACFAGL+8
RACFENT  EQU   RACFAGL+4
@NM00016 EQU   RACFFLG4
@NM00015 EQU   RACFFLG3
RACFPRF  EQU   RACFFLG3
@NM00014 EQU   RACFFLG3
@NM00013 EQU   RACFFLG2
RACFTRD  EQU   RACFFLG2
RACFTUPD EQU   RACFFLG2
RACFTCTL EQU   RACFFLG2
@NM00012 EQU   RACFFLG2
RACFTALT EQU   RACFFLG2
RACFCSA  EQU   RACFFLG1
RACFLOGN EQU   RACFFLG1
RACFLOGF EQU   RACFFLG1
@NM00011 EQU   RACFFLG1
RACFDSTV EQU   RACFFLG1
@NM00010 EQU   RACFFLG1
@NM00009 EQU   ALLOPT
ALLOPTUN EQU   ALLOPT
ALLOPTDS EQU   ALLOPT
@NM00008 EQU   ALLORG+1
ALLORGVS EQU   ALLORG+1
@NM00007 EQU   ALLORG+1
ALLORGGS EQU   ALLORG+1
ALLORGUN EQU   ALLORG
ALLORGPO EQU   ALLORG
ALLORGMQ EQU   ALLORG
ALLORGCQ EQU   ALLORG
ALLORGCX EQU   ALLORG
ALLORGDA EQU   ALLORG
ALLORGPS EQU   ALLORG
ALLORGIS EQU   ALLORG
ALLDSPUN EQU   ALLDSP
ALLDSPCG EQU   ALLDSP
ALLDSPDE EQU   ALLDSP
ALLDSPKP EQU   ALLDSP
@NM00006 EQU   ALLDSP
ALLSTSOD EQU   ALLSTS
ALLSTSMD EQU   ALLSTS
ALLSTSNW EQU   ALLSTS
ALLSTSSR EQU   ALLSTS
@NM00005 EQU   ALLSTS
ALLPWD   EQU   ALLAGL+20
ALLDSN   EQU   ALLAGL
CIRPID   EQU   CIRAGL+28
CIRPWD   EQU   CIRAGL+24
CIRCAT   EQU   CIRAGL+20
CIRWKP   EQU   CIRAGL+16
CIRTLR   EQU   CIRAGL+12
CIRHDR   EQU   CIRAGL+8
CIRTLN   EQU   CIRAGL+6
CIRHLN   EQU   CIRAGL+4
@NM00004 EQU   CIRAGL+1
@NM00003 EQU   CIRTYPE
CIRTYPAQ EQU   CIRTYPE
CIRTYP1Q EQU   CIRTYPE
NEWID1   EQU   TRACE1+95
CALLID   EQU   OLDERID1+90
@NM00002 EQU   OLDERID1
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS
@RT00439 EQU   @RC00438
@RF00492 EQU   @RC00484
@RF00600 EQU   @RC00594
@RC00659 EQU   @RC00652
@RF00773 EQU   @RC00734
@RC00765 EQU   @RC00734
@RF00893 EQU   @RC00884
@RF00892 EQU   @RC00884
@RF00897 EQU   @RC00874
@RF00927 EQU   @RC00919
@RF00973 EQU   @RC00970
@RC01006 EQU   @RC00996
@RF01009 EQU   @RC00996
@RC01027 EQU   @RC00996
@RC01121 EQU   @RC01120
@RF01245 EQU   @RC01242
@RC01238 EQU   @RC01201
@RC01236 EQU   @RC01201
@RC01326 EQU   @RC01311
@RF01533 EQU   @RC01527
@RF01710 EQU   @RC01700
@RF01724 EQU   @RC01721
@RF02196 EQU   @RC02181
@PB00024 EQU   @EL00001
@RC01122 EQU   @RC01121
@PB00023 EQU   @PB00024
@PB00022 EQU   @PB00023
@PB00021 EQU   @PB00022
@PB00020 EQU   @PB00021
@PB00019 EQU   @PB00020
@PB00018 EQU   @PB00019
@PB00017 EQU   @PB00018
@PB00016 EQU   @PB00017
@PB00015 EQU   @PB00016
@PB00014 EQU   @PB00015
@PB00013 EQU   @PB00014
@PB00012 EQU   @PB00013
@PB00011 EQU   @PB00012
@PB00010 EQU   @PB00011
@PB00009 EQU   @PB00010
@PB00008 EQU   @PB00009
@PB00007 EQU   @PB00008
@PB00006 EQU   @PB00007
@PB00005 EQU   @PB00006
@PB00004 EQU   @PB00005
@PB00003 EQU   @PB00004
@PB00002 EQU   @PB00003
@ENDDATA EQU   *
         END   IDCAV01,(C'PLS2253',0603,77067)

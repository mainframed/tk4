         MACRO
         XSRTR &TR,&LABEL,&MSG
.*--> MACRO: XSRTR      GENERATE TRACE CODE FOR XSAVE/XRETURN . . . . .
.*                                 JOHN R. MASHEY- FEB 1970 - V.4.0   *
.*       THIS MACRO IS USED BY XSAVE AND XRETURN TO GENERATE THE      *
.*       TRACE CODE CALLS TO XSNAP OR XPRNT, OR TIMING CALLS TO XTIME.*
.*       MACROS CALLED BY THIS MACRO - XLLOK, XPRNT,XSNAP,XTIME       *
.*  * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
         GBLA  &XXLOOK             FOR COMMUNICATION 0WITH XLOOK
         GBLB &XSNAPST,&XPRNTST    GLOBALS FOR OUTPUT MACROS
         LCLA  &I                  FOR USE AS LENGTH SPECIIFICATION
         LCLB  &XSTSAV             FOR SAVING STAUS VARIABLES
         LCLC  &NAME               FOR EITHER LABEL OR CSECT
         XLOOK &TR(1),(*,SNAP,TIME)         CHECK TYPE
         AIF   (&XXLOOK LT 3).XPS  SKIP IF NOT TIME
*        XTIME ,&TR(2)
         XTIME ,&TR(2)
         MEXIT
.XPS     AIF   (&XXLOOK EQ 0 AND N'&TR GT 1 AND '&TR(2)' NE 'SNAP').XE
&NAME    SETC  '&LABEL'            ASSUME NAME IS LABEL
         AIF   (T'&LABEL NE 'O').XNOK1       SKIP IF LABEL EXISTS
&NAME    SETC  '&SYSECT'           USE CSECT NAME INSTEAD
         AIF   ('&SYSECT' NE '').XNOK1       SKIP IF CSECT NOT PC
&NAME    SETC  '$PRIVATE'          USE NAME FOR PRIVATE CODE (PC)
.XNOK1   AIF   (&XXLOOK EQ 2 OR '&TR(2)' EQ 'SNAP').XNSNAP
&XSTSAV  SETB  (&XPRNTST)          SAVE STATUS VARIABLE
&XPRNTST SETB  (0)                 MAKE SURE XPRNT WILL GENERATE
         AIF   (&XXLOOK EQ 1).XDFTA         SKIP- TR=* - DEFAULT
&I       SETA 2*((K'&TR)/2)        GET RIGHT TOTAL LENGTH FOR DC
         B     *+4+&I .            BRANCH AROUND MESSAGE
XX&SYSNDX.T DC C'0',CL(&I-1)&TR
         AGO   .XPRB               SKIP OVER ALTERNATE
.XDFTA   B     *+28 .              BRANCH AROUND MESSAGE
XX&SYSNDX.T DC CL24'0*** &NAME &MSG ***'
&I       SETA  24                  SET UP FOR XPRNT
.XPRB    ANOP
*        XPRNT XX&SYSNDX.T,&I      PRINT MESSAGE WITH GIVEN LENGTH
         XPRNT XX&SYSNDX.T,&I
&XPRNTST SETB  (&XSTSAV)           RESTORE PREVIOUS VALUE
         MEXIT
.XE      MNOTE 0,'**XSRTR- TR=&TR: UNKNOWN, IGNORED'
         MEXIT
.XNSNAP  ANOP
&XSTSAV  SETB  (&XSNAPST)          SAVE XSNAP STATUS, IN CASE OFF
&XSNAPST SETB  (0)                 MAKE SURE XSNAP WILL GENERATE
*        XSNAP LABEL='  MESSAGE '
         AIF   (&XXLOOK EQ 2).XDFTB         SKIP IF TR=SNAP
         XSNAP LABEL=&TR(1)
         AGO   .XSNB               SKIP OVER ALTERNATE
.XDFTB   XSNAP LABEL='*** &NAME &MSG ***'
.XSNB    ANOP
&XSNAPST SETB  (&XSTSAV)           RESTORE STATUS,IN CASE IT WAS OFF
         MEND
